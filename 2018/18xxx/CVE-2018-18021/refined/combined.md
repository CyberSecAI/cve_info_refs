=== Content from bugzilla.redhat.com_05d1ad0c_20250126_094415.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D1635475)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D1635475)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D1635475)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 1635475

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 1635475**](show_bug.cgi?id=1635475)
(CVE-2018-18021)
- [CVE-2018-18021](https://access.redhat.com/security/cve/CVE-2018-18021) kernel: Privilege escalation on arm64 via KVM hypervisor

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2018-18021 kernel: Privilege escalation on arm64 via KVM hypervisor

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED ERRATA | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2018-18021 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [1635476](show_bug.cgi?id=1635476 "CLOSED ERRATA - CVE-2018-18021 kernel: Privilege escalation on arm64 via KVM hypervisor [fedora-all]") [1635477](show_bug.cgi?id=1635477) [1635478](show_bug.cgi?id=1635478) [1635721](show_bug.cgi?id=1635721) [1637828](show_bug.cgi?id=1637828) [1637829](show_bug.cgi?id=1637829) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [1635479](show_bug.cgi?id=1635479) | | TreeView+ | [depends on](buglist.cgi?bug_id=1635475&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=1635475&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2018-10-03 03:55 UTC by Sam Fowler | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-12-10 17:45 UTC ([History](show_activity.cgi?id=1635475)) | | [CC List:](page.cgi?id=fields.html#cclist) | 50 users (show)  abhgupta acaringi airlied bhsharma bhu blc brdeoliv bskeggs dbaker dhoward drjones dvlasenk ewk fhrbata hdegoede hkrzesin hwkernel-mgr iboverma ichavero itamar jarodwilson jforbes jglisse jkacur john.j5live jokerman jonathan josef jross jstancek jwboyer kernel-maint kernel-mgr labbott lgoncalv linville matt mchehab mcressma mjg59 mlangsdo nmurray plougher rt-maint rvrbovsk steved sthangav trankin williams yozone | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability was discovered in the Linux kernel that allows an attacker to escalate privileges with using a 64-bit ARM architecture. A local attacker with permission to create KVM-based virtual machines can both panic the hypervisor by triggering an illegal exception return (resulting in a DoS) and to redirect execution elsewhere within the hypervisor with full register control, instead of causing a return to the guest. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2019-06-10 10:39:01 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | |    Links | System | ID | Private | Priority | Status | Summary | Last Updated | | Red Hat Product Errata | [RHSA-2018:3656](https://access.redhat.com/errata/RHSA-2018%3A3656) | 0 | None | None | None | 2018-11-26 23:14:53 UTC | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1635475#c0)  Sam Fowler    2018-10-03 03:55:57 UTC  ``` The Linux kernel has vulnerability on 64-bit ARM architectures that allows an attacker to escalate privileges. A local attacker with permission to create KVM-based virtual machines can both panic the hypervisor by triggering an illegal exception return (resulting in a DoS) and to redirect execution elsewhere within the hypervisor with full register control, instead of causing a return to the guest.   Reference:  <https://www.openwall.com/lists/oss-security/2018/10/02/2>   Proposed Upstream Patches:  <https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux.git/commit/?id=d26c25a9> <https://git.kernel.org/pub/scm/linux/kernel/git/arm64/linux.git/commit/?id=2a3f9345>   ```  [Comment 1](show_bug.cgi?id=1635475#c1)  Sam Fowler    2018-10-03 03:56:43 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 1635476](show_bug.cgi?id=1635476 "CLOSED ERRATA - CVE-2018-18021 kernel: Privilege escalation on arm64 via KVM hypervisor [fedora-all]")]   ```  [Comment 3](show_bug.cgi?id=1635475#c3)  Fedora Update System    2018-10-09 03:08:58 UTC  ``` kernel-4.18.12-200.fc28, kernel-headers-4.18.12-200.fc28 has been pushed to the Fedora 28 stable repository. If problems still persist, please make note of it in this bug report.   ```  [Comment 7](show_bug.cgi?id=1635475#c7)  Fedora Update System    2018-10-10 21:54:21 UTC  ``` kernel-4.18.12-100.fc27, kernel-headers-4.18.12-100.fc27 has been pushed to the Fedora 27 stable repository. If problems still persist, please make note of it in this bug report.   ```  [Comment 8](show_bug.cgi?id=1635475#c8)  errata-xmlrpc    2018-11-26 23:14:37 UTC  ``` This issue has been addressed in the following products:    Red Hat Enterprise Linux 7  Via RHSA-2018:3656 [https://access.redhat.com/errata/RHSA-2018:3656](https://access.redhat.com/errata/RHSA-2018%3A3656)   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=1635475&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from www.debian.org_ae98d0ee_20250125_150236.html ===


---

[[Date Prev](msg00243.html)][[Date Next](msg00245.html)]
[[Thread Prev](msg00243.html)][[Thread Next](msg00245.html)]
[[Date Index](maillist.html#00244)]
[[Thread Index](threads.html#00244)]

# [SECURITY] [DSA 4313-1] linux security update

---

* *To*: debian-security-announce@lists.debian.org
* *Subject*: [SECURITY] [DSA 4313-1] linux security update
* *From*: Salvatore Bonaccorso <carnil@debian.org>
* *Date*: Mon, 08 Oct 2018 20:48:42 +0000
* *Message-id*: <[[🔎]](/msgid-search/E1g9cSI-0004M0-Bl%40seger.debian.org) [E1g9cSI-0004M0-Bl@seger.debian.org](msg00244.html)>
* *Reply-to*: debian-security-announce-request@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian Security Advisory DSA-4313-1                   security@debian.org
<https://www.debian.org/security/>                     Salvatore Bonaccorso
October 08, 2018                      <https://www.debian.org/security/faq>
- -------------------------------------------------------------------------

Package        : linux
CVE ID         : CVE-2018-15471 CVE-2018-18021

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2018-15471 (XSA-270)

    Felix Wilhelm of Google Project Zero discovered a flaw in the hash
    handling of the xen-netback Linux kernel module. A malicious or
    buggy frontend may cause the (usually privileged) backend to make
    out of bounds memory accesses, potentially resulting in privilege
    escalation, denial of service, or information leaks.

    <https://xenbits.xen.org/xsa/advisory-270.html>

CVE-2018-18021

    It was discovered that the KVM subsystem on the arm64 platform does
    not properly handle the KVM_SET_ON_REG ioctl. An attacker who can
    create KVM based virtual machines can take advantage of this flaw
    for denial of service (hypervisor panic) or privilege escalation
    (arbitrarily redirect the hypervisor flow of control with full
    register control).

For the stable distribution (stretch), these problems have been fixed in
version 4.9.110-3+deb9u6.

We recommend that you upgrade your linux packages.

For the detailed security status of linux please refer to its security
tracker page at:
<https://security-tracker.debian.org/tracker/linux>

Further information about Debian Security Advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://www.debian.org/security/>

Mailing list: debian-security-announce@lists.debian.org
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEERkRAmAjBceBVMd3uBUy48xNDz0QFAlu7uMNfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldDQ2
NDQ0MDk4MDhDMTcxRTA1NTMxRERFRTA1NENCOEYzMTM0M0NGNDQACgkQBUy48xND
z0RtEg/8DXFvVd/xcV3Wz5bm2v+UUbzQwz5rsbzGZDNagWw/17c/S7HpDe3gvgSN
tw9JzMt+6ZIHTBN7owc6wNjh6e8t38rCTBaQCJwAe3plNTKI0VtamHkzozgS80mm
VSv92jLSYHx19wi9ThXkxVCKzVdTSeJv+fBi7OVJoErcKj4iSmDVHZjOsTmuCkmw
1j2Lvy8DUBdkXpS2FbG03DnszkHU62Z4gF3WCcga/TG/bOApI8dCwrb3+CDrBw/N
+IP2SGTb3MB/OK4iLJcKf5mv0Pg1bxflWRw12kRtEDk5auoYtyp9Ce9w5UqyPYtj
+zxmvytKSQWHMz3Tx5TM3rQz8LfWCFLjfiNm18NzXSg8bnznXtnL+1CypdVclJx8
gol89yjhBoMX26S426hVvMeQPntd1pg5eOtos8DwEe5SHg9gfpyMDDvuvNCcoXV2
37rYW0BeuBUfkOZnUnXR4B2T11ejuzGc33sA6WlRprele10kpR0JeT3RPxBYRoAe
O1uew8o+IPTvUsUrNorBMeaWrwzqCDmpkWJDoumyNvLKtXm9F2KVbT5cLoD1kRW+
VQ/oy7oItKRQttSbagAsipCVO9er/B4vjSAahuUnXS+OtctwJX3VFbVFyK2LYk9D
OHvDu8iDZsWc6/TDoAXlAEtzwRpwOjypvD8NaB88EQbBWaGVX6U=
=RKUP
-----END PGP SIGNATURE-----

```

---



=== Content from www.redhat.com_ccb387ee_20250126_094416.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from usn.ubuntu.com_16c65069_20250125_150235.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3931-2: Linux kernel (HWE) vulnerabilities

2 April 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [linux-aws-hwe](/security/cves?package=linux-aws-hwe) - Linux kernel for Amazon Web Services (AWS-HWE) systems
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel
* [linux-oracle](/security/cves?package=linux-oracle) - Linux kernel for Oracle Cloud systems

## Details

USN-3931-1 fixed vulnerabilities in the Linux kernel for Ubuntu 18.04

LTS. This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 18.04 LTS for Ubuntu

16.04 LTS and for the Linux Azure kernel for Ubuntu 14.04 LTS.

M. Vefa Bicakci and Andy Lutomirski discovered that the kernel did not

properly set up all arguments to an error handler callback used when

running as a paravirtualized guest. An unprivileged attacker in a

paravirtualized guest VM could use this to cause a denial of service (guest

VM crash). ([CVE-2018-14678](/security/CVE-2018-14678))

It was discovered that the KVM implementation in the Linux kernel on ARM

64bit processors did not properly handle some ioctls. An attacker with the

privilege to create KVM-based virtual machines could use this to cause a

denial of service (host system crash) or execute arbitrary code in the

host. ([CVE-2018-18021](/security/CVE-2018-18021))

Mathias Payer and Hui Peng discovered a use-after-free vulnerability in the

Advanced Linux Sound Architecture (ALSA) subsystem. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2018-19824](/security/CVE-2018-19824))

Shlomi Oberman, Yuli Shapiro, and Ran Menscher discovered an information

leak in the Bluetooth implementation of the Linux kernel. An attacker

within Bluetooth range could use this to expose sensitive information

(kernel memory). ([CVE-2019-3459](/security/CVE-2019-3459), [CVE-2019-3460](/security/CVE-2019-3460))

Jann Horn discovered that the KVM implementation in the Linux kernel

contained a use-after-free vulnerability. An attacker in a guest VM with

access to /dev/kvm could use this to cause a denial of service (guest VM

crash). ([CVE-2019-6974](/security/CVE-2019-6974))

Jim Mattson and Felix Wilhelm discovered a use-after-free vulnerability in

the KVM subsystem of the Linux kernel, when using nested virtual machines.

A local attacker in a guest VM could use this to cause a denial of service

(system crash) or possibly execute arbitrary code in the host system.

([CVE-2019-7221](/security/CVE-2019-7221))

Felix Wilhelm discovered that an information leak vulnerability existed in

the KVM subsystem of the Linux kernel, when nested virtualization is used.

A local attacker could use this to expose sensitive information (host

system memory to a guest VM). ([CVE-2019-7222](/security/CVE-2019-7222))

Jann Horn discovered that the eBPF implementation in the Linux kernel was

insufficiently hardened against Spectre V1 attacks. A local attacker could

use this to expose sensitive information. ([CVE-2019-7308](/security/CVE-2019-7308))

It was discovered that a use-after-free vulnerability existed in the user-

space API for crypto (af\_alg) implementation in the Linux kernel. A local

attacker could use this to cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2019-8912](/security/CVE-2019-8912))

It was discovered that the Linux kernel did not properly deallocate memory

when handling certain errors while reading files. A local attacker could

use this to cause a denial of service (excessive memory consumption).

([CVE-2019-8980](/security/CVE-2019-8980))

Jann Horn discovered that the mmap implementation in the Linux kernel did

not properly check for the mmap minimum address in some situations. A local

attacker could use this to assist exploiting a kernel NULL pointer

dereference vulnerability. ([CVE-2019-9213](/security/CVE-2019-9213))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.15.0-1010-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle)
  -
  [4.15.0-1010.12~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle/4.15.0-1010.12~16.04.1)
* [linux-image-4.15.0-1029-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [4.15.0-1029.31~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/4.15.0-1029.31~16.04.1)
* [linux-image-4.15.0-1035-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws-hwe)
  -
  [4.15.0-1035.37~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-aws-hwe/4.15.0-1035.37~16.04.1)
* [linux-image-4.15.0-1041-azure](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure)
  -
  [4.15.0-1041.45](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure/4.15.0-1041.45)
* [linux-image-4.15.0-47-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [4.15.0-47.50~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/4.15.0-47.50~16.04.1)
* [linux-image-4.15.0-47-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-47.50~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-47.50~16.04.1)
* [linux-image-4.15.0-47-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [4.15.0-47.50~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/4.15.0-47.50~16.04.1)
* [linux-image-aws-hwe](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-hwe)
  -
  [4.15.0.1035.35](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-hwe/4.15.0.1035.35)
* [linux-image-azure](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure)
  -
  [4.15.0.1041.45](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure/4.15.0.1041.45)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1029.43](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1029.43)
* [linux-image-generic-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.47.68](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.47.68)
* [linux-image-generic-lpae-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.47.68](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.47.68)
* [linux-image-gke](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1029.43](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1029.43)
* [linux-image-lowlatency-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.47.68](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.47.68)
* [linux-image-oem](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.47.68](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.47.68)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle)
  -
  [4.15.0.1010.4](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle/4.15.0.1010.4)
* [linux-image-virtual-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.47.68](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.47.68)

##### Ubuntu 14.04

* [linux-image-4.15.0-1041-azure](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure)
  -
  [4.15.0-1041.45~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-azure/4.15.0-1041.45~14.04.1)
* [linux-image-azure](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure)
  -
  [4.15.0.1041.28](https://launchpad.net/ubuntu/%2Bsource/linux-meta-azure/4.15.0.1041.28)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-14678](/security/CVE-2018-14678)
* [CVE-2018-18021](/security/CVE-2018-18021)
* [CVE-2018-19824](/security/CVE-2018-19824)
* [CVE-2019-3459](/security/CVE-2019-3459)
* [CVE-2019-3460](/security/CVE-2019-3460)
* [CVE-2019-6974](/security/CVE-2019-6974)
* [CVE-2019-7221](/security/CVE-2019-7221)
* [CVE-2019-7222](/security/CVE-2019-7222)
* [CVE-2019-7308](/security/CVE-2019-7308)
* [CVE-2019-8912](/security/CVE-2019-8912)
* [CVE-2019-8980](/security/CVE-2019-8980)
* [CVE-2019-9213](/security/CVE-2019-9213)

## Related notices

* [USN-3931-1](/security/notices/USN-3931-1)
* [USN-3821-1](/security/notices/USN-3821-1)
* [USN-3821-2](/security/notices/USN-3821-2)
* [USN-3933-2](/security/notices/USN-3933-2)
* [USN-3933-1](/security/notices/USN-3933-1)
* [USN-3930-2](/security/notices/USN-3930-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-3930-1](/security/notices/USN-3930-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from cdn.kernel.org_ba084385_20250125_150220.html ===
commit 7da07a3216a00aa3c523db4539fc6914497d0576
Author: Greg Kroah-Hartman
Date: Wed Oct 3 16:59:28 2018 -0700
Linux 4.18.12
commit c483061d46103aa34daa8e53545a8a3f8cde5c2d
Author: Sakari Ailus
Date: Tue Sep 11 05:32:37 2018 -0400
media: v4l: event: Prevent freeing event subscriptions while accessed
commit ad608fbcf166fec809e402d548761768f602702c upstream.
The event subscriptions are added to the subscribed event list while
holding a spinlock, but that lock is subsequently released while still
accessing the subscription object. This makes it possible to unsubscribe
the event --- and freeing the subscription object's memory --- while
the subscription object is simultaneously accessed.
Prevent this by adding a mutex to serialise the event subscription and
unsubscription. This also gives a guarantee to the callback ops that the
add op has returned before the del op is called.
This change also results in making the elems field less special:
subscriptions are only added to the event list once they are fully
initialised.
Signed-off-by: Sakari Ailus
Reviewed-by: Hans Verkuil
Reviewed-by: Laurent Pinchart
Cc: stable@vger.kernel.org # for 4.14 and up
Fixes: c3b5b0241f62 ("V4L/DVB: V4L: Events: Add backend")
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Greg Kroah-Hartman
commit 926415e1e4c94e452a258eeddad18db8d66a69cc
Author: Marc Zyngier
Date: Thu Sep 27 16:53:22 2018 +0100
arm64: KVM: Sanitize PSTATE.M when being set from userspace
commit 2a3f93459d689d990b3ecfbe782fec89b97d3279 upstream.
Not all execution modes are valid for a guest, and some of them
depend on what the HW actually supports. Let's verify that what
userspace provides is compatible with both the VM settings and
the HW capabilities.
Cc:
Fixes: 0d854a60b1d7 ("arm64: KVM: enable initialization of a 32bit vcpu")
Reviewed-by: Christoffer Dall
Reviewed-by: Mark Rutland
Reviewed-by: Dave Martin
Signed-off-by: Marc Zyngier
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 5fddc4cd7aecaaa13bafd20dda499eb7248d3273
Author: Michael Bringmann
Date: Thu Sep 20 11:45:13 2018 -0500
powerpc/pseries: Fix unitialized timer reset on migration
commit 8604895a34d92f5e186ceb931b0d1b384030ea3d upstream.
After migration of a powerpc LPAR, the kernel executes code to
update the system state to reflect new platform characteristics.
Such changes include modifications to device tree properties provided
to the system by PHYP. Property notifications received by the
post\_mobility\_fixup() code are passed along to the kernel in general
through a call to of\_update\_property() which in turn passes such
events back to all modules through entries like the '.notifier\_call'
function within the NUMA module.
When the NUMA module updates its state, it resets its event timer. If
this occurs after a previous call to stop\_topology\_update() or on a
system without VPHN enabled, the code runs into an unitialized timer
structure and crashes. This patch adds a safety check along this path
toward the problem code.
An example crash log is as follows.
ibmvscsi 30000081: Re-enabling adapter!
------------[ cut here ]------------
kernel BUG at kernel/time/timer.c:958!
Oops: Exception in kernel mode, sig: 5 [#1]
LE SMP NR\_CPUS=2048 NUMA pSeries
Modules linked in: nfsv3 nfs\_acl nfs tcp\_diag udp\_diag inet\_diag lockd unix\_diag af\_packet\_diag netlink\_diag grace fscache sunrpc xts vmx\_crypto pseries\_rng sg binfmt\_misc ip\_tables xfs libcrc32c sd\_mod ibmvscsi ibmveth scsi\_transport\_srp dm\_mirror dm\_region\_hash dm\_log dm\_mod
CPU: 11 PID: 3067 Comm: drmgr Not tainted 4.17.0+ #179
...
NIP mod\_timer+0x4c/0x400
LR reset\_topology\_timer+0x40/0x60
Call Trace:
0xc0000003f9407830 (unreliable)
reset\_topology\_timer+0x40/0x60
dt\_update\_callback+0x100/0x120
notifier\_call\_chain+0x90/0x100
\_\_blocking\_notifier\_call\_chain+0x60/0x90
of\_property\_notify+0x90/0xd0
of\_update\_property+0x104/0x150
update\_dt\_property+0xdc/0x1f0
pseries\_devicetree\_update+0x2d0/0x510
post\_mobility\_fixup+0x7c/0xf0
migration\_store+0xa4/0xc0
kobj\_attr\_store+0x30/0x60
sysfs\_kf\_write+0x64/0xa0
kernfs\_fop\_write+0x16c/0x240
\_\_vfs\_write+0x40/0x200
vfs\_write+0xc8/0x240
ksys\_write+0x5c/0x100
system\_call+0x58/0x6c
Fixes: 5d88aa85c00b ("powerpc/pseries: Update CPU maps when device tree is updated")
Cc: stable@vger.kernel.org # v3.10+
Signed-off-by: Michael Bringmann
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 7f3a5baeacdfbecacfb0bcd147fd30171ea5f9dd
Author: Thiago Jung Bauermann
Date: Thu Sep 20 01:38:58 2018 -0300
powerpc/pkeys: Fix reading of ibm, processor-storage-keys property
commit c716a25b9b70084e1144f77423f5aedd772ea478 upstream.
scan\_pkey\_feature() uses of\_property\_read\_u32\_array() to read the
ibm,processor-storage-keys property and calls be32\_to\_cpu() on the
value it gets. The problem is that of\_property\_read\_u32\_array() already
returns the value converted to the CPU byte order.
The value of pkeys\_total ends up more or less sane because there's a min()
call in pkey\_initialize() which reduces pkeys\_total to 32. So in practice
the kernel ignores the fact that the hypervisor reserved one key for
itself (the device tree advertises 31 keys in my test VM).
This is wrong, but the effect in practice is that when a process tries to
allocate the 32nd key, it gets an -EINVAL error instead of -ENOSPC which
would indicate that there aren't any keys available
Fixes: cf43d3b26452 ("powerpc: Enable pkey subsystem")
Cc: stable@vger.kernel.org # v4.16+
Signed-off-by: Thiago Jung Bauermann
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 4faeadc4f7b5deafc160132c3eb67eb4ae841b38
Author: Christophe Leroy
Date: Mon Sep 10 06:09:04 2018 +0000
powerpc: fix csum\_ipv6\_magic() on little endian platforms
commit 85682a7e3b9c664995ad477520f917039afdc330 upstream.
On little endian platforms, csum\_ipv6\_magic() keeps len and proto in
CPU byte order. This generates a bad results leading to ICMPv6 packets
from other hosts being dropped by powerpc64le platforms.
In order to fix this, len and proto should be converted to network
byte order ie bigendian byte order. However checksumming 0x12345678
and 0x56341278 provide the exact same result so it is enough to
rotate the sum of len and proto by 1 byte.
PPC32 only support bigendian so the fix is needed for PPC64 only
Fixes: e9c4943a107b ("powerpc: Implement csum\_ipv6\_magic in assembly")
Reported-by: Jianlin Shi
Reported-by: Xin Long
Cc:  # 4.18+
Signed-off-by: Christophe Leroy
Tested-by: Xin Long
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 31d2bff9f6963d0dca0b31b4a68ef4ab79457ce6
Author: Michael Neuling
Date: Thu Sep 13 15:33:47 2018 +1000
KVM: PPC: Book3S HV: Fix guest r11 corruption with POWER9 TM workarounds
commit f14040bca89258b8a1c71e2112e430462172ce93 upstream.
When we come into the softpatch handler (0x1500), we use r11 to store
the HSRR0 for later use by the denorm handler.
We also use the softpatch handler for the TM workarounds for
POWER9. Unfortunately, in kvmppc\_interrupt\_hv we later store r11 out
to the vcpu assuming it's still what we got from userspace.
This causes r11 to be corrupted in the VCPU and hence when we restore
the guest, we get a corrupted r11. We've seen this when running TM
tests inside guests on P9.
This fixes the problem by only touching r11 in the denorm case.
Fixes: 4bb3c7a020 ("KVM: PPC: Book3S HV: Work around transactional memory bugs in POWER9")
Cc:  # 4.17+
Test-by: Suraj Jitindar Singh
Reviewed-by: Paul Mackerras
Signed-off-by: Michael Neuling
Signed-off-by: Michael Ellerman
Signed-off-by: Greg Kroah-Hartman
commit 8379aa480e9550039a966b38c1342d3e4b28a381
Author: Randy Dunlap
Date: Sat Sep 1 21:01:28 2018 -0700
x86/pti: Fix section mismatch warning/error
[ Upstream commit ff924c5a1ec7548825cc2d07980b03be4224ffac ]
Fix the section mismatch warning in arch/x86/mm/pti.c:
WARNING: vmlinux.o(.text+0x6972a): Section mismatch in reference from the function pti\_clone\_pgtable() to the function .init.text:pti\_user\_pagetable\_walk\_pte()
The function pti\_clone\_pgtable() references
the function \_\_init pti\_user\_pagetable\_walk\_pte().
This is often because pti\_clone\_pgtable lacks a \_\_init
annotation or the annotation of pti\_user\_pagetable\_walk\_pte is wrong.
FATAL: modpost: Section mismatches detected.
Fixes: 85900ea51577 ("x86/pti: Map the vsyscall page if needed")
Reported-by: kbuild test robot
Signed-off-by: Randy Dunlap
Signed-off-by: Thomas Gleixner
Cc: Andy Lutomirski
Link: https://lkml.kernel.org/r/43a6d6a3-d69d-5eda-da09-0b1c88215a2a@infradead.org
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0f40f4a21a10bf802860b27dba6bd48ad673deb7
Author: Akshu Agrawal
Date: Tue Aug 21 12:21:57 2018 +0530
clk: x86: Set default parent to 48Mhz
[ Upstream commit bded6c03e398dc6e862dc8301fb9a60175740653 ]
System clk provided in ST soc can be set to:
48Mhz, non-spread
25Mhz, spread
To get accurate rate, we need it to set it at non-spread
option which is 48Mhz.
Signed-off-by: Akshu Agrawal
Reviewed-by: Daniel Kurtz
Fixes: 421bf6a1f061 ("clk: x86: Add ST oscout platform clock")
Signed-off-by: Stephen Boyd
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d948acce9a0cc0445ea6d05652bb3d56ea107da4
Author: Mika Westerberg
Date: Thu Aug 30 11:50:13 2018 +0300
i2c: i801: Allow ACPI AML access I/O ports not reserved for SMBus
[ Upstream commit 7fd6d98b89f382d414e1db528e29a67bbd749457 ]
Commit 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict
with PCI BAR") made it possible for AML code to access SMBus I/O ports
by installing custom SystemIO OpRegion handler and blocking i80i driver
access upon first AML read/write to this OpRegion.
However, while ThinkPad T560 does have SystemIO OpRegion declared under
the SMBus device, it does not access any of the SMBus registers:
Device (SMBU)
{
...
OperationRegion (SMBP, PCI\_Config, 0x50, 0x04)
Field (SMBP, DWordAcc, NoLock, Preserve)
{
, 5,
TCOB, 11,
Offset (0x04)
}
Name (TCBV, 0x00)
Method (TCBS, 0, NotSerialized)
{
If ((TCBV == 0x00))
{
TCBV = (\\_SB.PCI0.SMBU.TCOB << 0x05)
}
Return (TCBV) /\* \\_SB\_.PCI0.SMBU.TCBV \*/
}
OperationRegion (TCBA, SystemIO, TCBS (), 0x10)
Field (TCBA, ByteAcc, NoLock, Preserve)
{
Offset (0x04),
, 9,
CPSC, 1
}
}
Problem with the current approach is that it blocks all I/O port access
and because this system has touchpad connected to the SMBus controller
after first AML access (happens during suspend/resume cycle) the
touchpad fails to work anymore.
Fix this so that we allow ACPI AML I/O port access if it does not touch
the region reserved for the SMBus.
Fixes: 7ae81952cda ("i2c: i801: Allow ACPI SystemIO OpRegion to conflict with PCI BAR")
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=200737
Reported-by: Yussuf Khalil
Signed-off-by: Mika Westerberg
Reviewed-by: Jean Delvare
Signed-off-by: Wolfram Sang
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 31b5f66e90b22b5ac06bc00a309e3cd7ea3fa05a
Author: Marc Zyngier
Date: Fri Aug 24 15:08:30 2018 +0100
arm/arm64: smccc-1.1: Handle function result as parameters
[ Upstream commit 755a8bf5579d22eb5636685c516d8dede799e27b ]
If someone has the silly idea to write something along those lines:
extern u64 foo(void);
void bar(struct arm\_smccc\_res \*res)
{
arm\_smccc\_1\_1\_smc(0xbad, foo(), res);
}
they are in for a surprise, as this gets compiled as:
0000000000000588 :
588: a9be7bfd stp x29, x30, [sp, #-32]!
58c: 910003fd mov x29, sp
590: f9000bf3 str x19, [sp, #16]
594: aa0003f3 mov x19, x0
598: aa1e03e0 mov x0, x30
59c: 94000000 bl 0 <\_mcount>
5a0: 94000000 bl 0
5a4: aa0003e1 mov x1, x0
5a8: d4000003 smc #0x0
5ac: b4000073 cbz x19, 5b8
5b0: a9000660 stp x0, x1, [x19]
5b4: a9010e62 stp x2, x3, [x19, #16]
5b8: f9400bf3 ldr x19, [sp, #16]
5bc: a8c27bfd ldp x29, x30, [sp], #32
5c0: d65f03c0 ret
5c4: d503201f nop
The call to foo "overwrites" the x0 register for the return value,
and we end up calling the wrong secure service.
A solution is to evaluate all the parameters before assigning
anything to specific registers, leading to the expected result:
0000000000000588 :
588: a9be7bfd stp x29, x30, [sp, #-32]!
58c: 910003fd mov x29, sp
590: f9000bf3 str x19, [sp, #16]
594: aa0003f3 mov x19, x0
598: aa1e03e0 mov x0, x30
59c: 94000000 bl 0 <\_mcount>
5a0: 94000000 bl 0
5a4: aa0003e1 mov x1, x0
5a8: d28175a0 mov x0, #0xbad
5ac: d4000003 smc #0x0
5b0: b4000073 cbz x19, 5bc
5b4: a9000660 stp x0, x1, [x19]
5b8: a9010e62 stp x2, x3, [x19, #16]
5bc: f9400bf3 ldr x19, [sp, #16]
5c0: a8c27bfd ldp x29, x30, [sp], #32
5c4: d65f03c0 ret
Reported-by: Julien Grall
Signed-off-by: Marc Zyngier
Signed-off-by: Will Deacon
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c1baf3699d84af8dc242010263c91f6e2a0ce701
Author: Marc Zyngier
Date: Fri Aug 24 15:08:29 2018 +0100
arm/arm64: smccc-1.1: Make return values unsigned long
[ Upstream commit 1d8f574708a3fb6f18c85486d0c5217df893c0cf ]
An unfortunate consequence of having a strong typing for the input
values to the SMC call is that it also affects the type of the
return values, limiting r0 to 32 bits and r{1,2,3} to whatever
was passed as an input.
Let's turn everything into "unsigned long", which satisfies the
requirements of both architectures, and allows for the full
range of return values.
Reported-by: Julien Grall
Signed-off-by: Marc Zyngier
Signed-off-by: Will Deacon
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8ad1f551f802d7441938fca54a9459abdd169ab6
Author: Emily Deng
Date: Tue Aug 28 20:52:40 2018 +0800
drm/amdgpu: Need to set moved to true when evict bo
[ Upstream commit 6ddd9769db4fc11a98bd7e58be1764e47fdb8384 ]
Fix the VMC page fault when the running sequence is as below:
1.amdgpu\_gem\_create\_ioctl
2.ttm\_bo\_swapout->amdgpu\_vm\_bo\_invalidate, as not called
amdgpu\_vm\_bo\_base\_init, so won't called
list\_add\_tail(&base->bo\_list, &bo->va). Even the bo was evicted,
it won't set the bo\_base->moved.
3.drm\_gem\_open\_ioctl->amdgpu\_vm\_bo\_base\_init, here only called
list\_move\_tail(&base->vm\_status, &vm->evicted), but not set the
bo\_base->moved.
4.amdgpu\_vm\_bo\_map->amdgpu\_vm\_bo\_insert\_map, as the bo\_base->moved is
not set true, the function amdgpu\_vm\_bo\_insert\_map will call
list\_move(&bo\_va->base.vm\_status, &vm->moved)
5.amdgpu\_cs\_ioctl won't validate the swapout bo, as it is only in the
moved list, not in the evict list. So VMC page fault occurs.
Signed-off-by: Emily Deng
Reviewed-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 68327465ccdbf5c5ebc8972ed03a224d871fd364
Author: Tony Lindgren
Date: Mon Aug 27 19:18:21 2018 -0700
ARM: dts: omap4-droid4: Fix emmc errors seen on some devices
[ Upstream commit 2d59bb602314a4b2593fde267734266b5e872dd0 ]
Otherwise we can get the following errors occasionally on some devices:
mmc1: tried to HW reset card, got error -110
mmcblk1: error -110 requesting status
mmcblk1: recovery failed!
print\_req\_error: I/O error, dev mmcblk1, sector 14329
...
I have one device that hits this error almost on every boot, and another
one that hits it only rarely with the other ones I've used behave without
problems. I'm not sure if the issue is related to a particular eMMC card
model, but in case it is, both of the machines with issues have:
# cat /sys/class/mmc\_host/mmc1/mmc1:0001/manfid \
/sys/class/mmc\_host/mmc1/mmc1:0001/oemid \
/sys/class/mmc\_host/mmc1/mmc1:0001/name
0x000045
0x0100
SEM16G
and the working ones have:
0x000011
0x0100
016G92
Note that "ti,non-removable" is different as omap\_hsmmc\_reg\_get() does not
call omap\_hsmmc\_disable\_boot\_regulators() if no\_regulator\_off\_init is set.
And currently we set no\_regulator\_off\_init only for "ti,non-removable" and
not for "non-removable". It seems that we should have "non-removable" with
some other mmc generic property behave in the same way instead of having to
use a non-generic property. But let's fix the issue first.
Fixes: 7e2f8c0ae670 ("ARM: dts: Add minimal support for motorola droid 4
xt894")
Cc: Marcel Partap
Cc: Merlijn Wajer
Cc: Michael Scott
Cc: NeKit
Cc: Pavel Machek
Cc: Sebastian Reichel
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit b32e647a83751bc24d7ef7522915005b2bac9200
Author: James Smart
Date: Thu Aug 9 16:00:14 2018 -0700
nvme-fcloop: Fix dropped LS's to removed target port
[ Upstream commit afd299ca996929f4f98ac20da0044c0cdc124879 ]
When a targetport is removed from the config, fcloop will avoid calling
the LS done() routine thinking the targetport is gone. This leaves the
initiator reset/reconnect hanging as it waits for a status on the
Create\_Association LS for the reconnect.
Change the filter in the LS callback path. If tport null (set when
failed validation before "sending to remote port"), be sure to call
done. This was the main bug. But, continue the logic that only calls
done if tport was set but there is no remoteport (e.g. case where
remoteport has been removed, thus host doesn't expect a completion).
Signed-off-by: James Smart
Signed-off-by: Christoph Hellwig
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 22670e847f7ca72a4e871d00eaa7c720ff94ef6f
Author: Linus Walleij
Date: Sun Jul 15 22:09:29 2018 +0200
ata: ftide010: Add a quirk for SQ201
[ Upstream commit 46cb52ad414ac829680d0bb8cc7090ac2b577ca7 ]
The DMA is broken on this specific device for some unknown
reason (probably badly designed or plain broken interface
electronics) and will only work with PIO. Other users of
the same hardware does not have this problem.
Add a specific quirk so that this Gemini device gets
DMA turned off. Also fix up some code around passing the
port information around in probe while we're at it.
Signed-off-by: Linus Walleij
Signed-off-by: Jens Axboe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 65c96da9c684946d0874bf911fdb50a3b497cb30
Author: Rex Zhu
Date: Fri Aug 24 16:17:54 2018 +0800
drm/amdgpu: Update power state at the end of smu hw\_init.
[ Upstream commit 2ab4d0e74256fc49b7b270f63c1d1e47c2455abc ]
For SI/Kv, the power state is managed by function
amdgpu\_pm\_compute\_clocks.
when dpm enabled, we should call amdgpu\_pm\_compute\_clocks
to update current power state instand of set boot state.
this change can fix the oops when kfd driver was enabled on Kv.
Reviewed-by: Alex Deucher
Tested-by: Michel Dänzer
Signed-off-by: Rex Zhu
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 21a73b809735e50956b6151785f60aa6897c85f0
Author: Rex Zhu
Date: Fri Aug 24 17:26:23 2018 +0800
drm/amdgpu: Enable/disable gfx PG feature in rlc safe mode
[ Upstream commit 8ef23364b654d44244400d79988e677e504b21ba ]
This is required by gfx hw and can fix the rlc hang when
do s3 stree test on Cz/St.
Reviewed-by: Alex Deucher
Signed-off-by: Hang Zhou
Signed-off-by: Rex Zhu
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4adf34c33950c75b38b0b4310d5a98d497094ede
Author: Leonard Crestez
Date: Tue Jul 24 19:14:19 2018 +0300
Revert "ARM: dts: imx7d: Invert legacy PCI irq mapping"
[ Upstream commit 538d6e9d597584e80514698e24321645debde78f ]
This reverts commit 1c86c9dd82f859b474474a7fee0d5195da2c9c1d.
That commit followed the reference manual but unfortunately the imx7d
manual is incorrect.
Tested with ath9k pcie card and confirmed internally.
Signed-off-by: Leonard Crestez
Acked-by: Lucas Stach
Fixes: 1c86c9dd82f8 ("ARM: dts: imx7d: Invert legacy PCI irq mapping")
Signed-off-by: Shawn Guo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 78dabdae8108ccb7e833d8c318dcf83fecf5b55f
Author: Dan Carpenter
Date: Tue Aug 14 13:07:47 2018 +0300
hwmon: (adt7475) Make adt7475\_read\_word() return errors
[ Upstream commit f196dec6d50abb2e65fb54a0621b2f1b4d922995 ]
The adt7475\_read\_word() function was meant to return negative error
codes on failure.
Signed-off-by: Dan Carpenter
Reviewed-by: Tokunori Ikegami
Signed-off-by: Guenter Roeck
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e41ea7c77cb2ce589736856c8eaf0c9a3d9aeaaf
Author: Lothar Felten
Date: Tue Aug 14 09:09:37 2018 +0200
hwmon: (ina2xx) fix sysfs shunt resistor read access
[ Upstream commit 3ad867001c91657c46dcf6656d52eb6080286fd5 ]
fix the sysfs shunt resistor read access: return the shunt resistor
value, not the calibration register contents.
update email address
Signed-off-by: Lothar Felten
Signed-off-by: Guenter Roeck
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit aada57693e8171cd441d55459526ecb0b0c288f6
Author: Srikanth Jampala
Date: Wed Aug 22 12:40:52 2018 +0530
crypto: cavium/nitrox - fix for command corruption in queue full case with backlog submissions.
[ Upstream commit 3d7c82060d1fe65bde4023aac41a0b1bd7718e07 ]
Earlier used to post the current command without checking queue full
after backlog submissions. So, post the current command only after
confirming the space in queue after backlog submissions.
Maintain host write index instead of reading device registers
to get the next free slot to post the command.
Return -ENOSPC in queue full case.
Signed-off-by: Srikanth Jampala
Reviewed-by: Gadam Sreerama
Tested-by: Jha, Chandan
Signed-off-by: Herbert Xu
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 19f2fedf4f434978a0f19ab8eeec7974d7518b32
Author: Ganesh Goudar
Date: Fri Aug 10 18:27:41 2018 +0530
crypto: chtls - fix null dereference chtls\_free\_uld()
[ Upstream commit 65b2c12dcdb883fc015c0ec65d6c2f857e0456ac ]
call chtls\_free\_uld() only for the initialized cdev,
this fixes NULL dereference in chtls\_free\_uld()
Signed-off-by: Ganesh Goudar
Signed-off-by: Atul Gupta
Signed-off-by: Herbert Xu
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ff53d50516751b72412c98c53e968eb3e62e2f01
Author: Jacob Keller
Date: Mon Aug 20 08:12:27 2018 -0700
i40e: fix condition of WARN\_ONCE for stat strings
[ Upstream commit 07f3701387dcab3a4fb0166098fb2754a1b927e1 ]
Commit 9b10df596bd4 ("i40e: use WARN\_ONCE to replace the commented
BUG\_ON size check") introduced a warning check to make sure
that the size of the stat strings was always the expected value. This
code accidentally inverted the check of the data pointer. Fix this so
that we accurately count the size of the stats we copied in.
This fixes an erroneous WARN kernel splat that occurs when requesting
ethtool statistics.
Signed-off-by: Jacob Keller
Tested-by: Andrew Bowers
Tested-by: Mauro S M Rodrigues
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit be97150c4a540d6d98bee479de2d270a55efb400
Author: Martyna Szapar
Date: Tue Aug 7 17:11:23 2018 -0700
i40e: Fix for Tx timeouts when interface is brought up if DCB is enabled
[ Upstream commit fa38e30ac73fbb01d7e5d0fd1b12d412fa3ac3ee ]
If interface is connected to switch port configured for DCB there are
TX timeouts when bringing up interface. Problem started appearing after
adding in i40e driver code mqprio hardware offload mode. In function
i40e\_vsi\_configure\_bw\_alloc was added resetting BW rate which should
be executing when mqprio qdisc is removed but was also when there was
no mqprio qdisc added and DCB was enabled. In this patch was added
additional check for DCB flag so now when DCB is enabled the correct
DCB configs from before mqprio patch are restored.
Signed-off-by: Martyna Szapar
Tested-by: Andrew Bowers
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4ef71783033a4073bab655609c7279b34ab78da1
Author: Sebastian Basierski
Date: Tue Jul 31 18:16:00 2018 +0200
ixgbe: fix driver behaviour after issuing VFLR
[ Upstream commit 939b701ad63314f5aa90dcd3d866f73954945209 ]
Since VFLR doesn't clear VFMBMEM (VF Mailbox Memory)
and is not re-enabling queues correctly we should fix
this behavior.
Signed-off-by: Sebastian Basierski
Tested-by: Andrew Bowers
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3e8566205e04196b67a75cb0bc7218b5d3f00804
Author: Bo Chen
Date: Mon Jul 23 09:01:30 2018 -0700
e1000: ensure to free old tx/rx rings in set\_ringparam()
[ Upstream commit ee400a3f1bfe7004a3e14b81c38ccc5583c26295 ]
In 'e1000\_set\_ringparam()', the tx\_ring and rx\_ring are updated with new value
and the old tx/rx rings are freed only when the device is up. There are resource
leaks on old tx/rx rings when the device is not up. This bug is reported by COD,
a tool for testing kernel module binaries I am building.
This patch fixes the bug by always calling 'kfree()' on old tx/rx rings in
'e1000\_set\_ringparam()'.
Signed-off-by: Bo Chen
Reviewed-by: Alexander Duyck
Tested-by: Aaron Brown
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f9b0af8f9ad5ef703d66e6bdae25e34d8a764f34
Author: Bo Chen
Date: Mon Jul 23 09:01:29 2018 -0700
e1000: check on netif\_running() before calling e1000\_up()
[ Upstream commit cf1acec008f8d7761aa3fd7c4bca7e17b2d2512d ]
When the device is not up, the call to 'e1000\_up()' from the error handling path
of 'e1000\_set\_ringparam()' causes a kernel oops with a null-pointer
dereference. The null-pointer dereference is triggered in function
'e1000\_alloc\_rx\_buffers()' at line 'buffer\_info = ℞\_ring->buffer\_info[i]'.
This bug was reported by COD, a tool for testing kernel module binaries I am
building. This bug was also detected by KFI from Dr. Kai Cong.
This patch fixes the bug by checking on 'netif\_running()' before calling
'e1000\_up()' in 'e1000\_set\_ringparam()'.
Signed-off-by: Bo Chen
Acked-by: Alexander Duyck
Tested-by: Aaron Brown
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1ca43c80d80f0e2e6f4f3942ab2e024104c64586
Author: Jesse Brandeburg
Date: Thu Aug 9 06:29:01 2018 -0700
ice: Fix potential return of uninitialized value
[ Upstream commit dab0588fb616c1774bbf108eab1749dda4ac6942 ]
In ice\_vsi\_setup\_[tx|rx]\_rings, err is uninitialized which can result in
a garbage value return to the caller. Fix that.
Signed-off-by: Jesse Brandeburg
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0753c86efc6c1f62de843f5f1001ed38aff639cd
Author: Anirudh Venkataramanan
Date: Thu Aug 9 06:29:00 2018 -0700
ice: Fix a few null pointer dereference issues
[ Upstream commit c7f2c42b80ed6009f44e355aefc1e40db9485a9d ]
1) When ice\_ena\_msix\_range() fails to reserve vectors, a devm\_kfree()
warning was seen in the error flow path. So check pf->irq\_tracker
before use in ice\_clear\_interrupt\_scheme().
2) In ice\_vsi\_cfg(), check vsi->netdev before use.
3) In ice\_get\_link\_status, check link\_up before use.
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 939817cd00d233ecd9fafa5abd30d243f9dd6ad5
Author: Quentin Monnet
Date: Thu Aug 23 17:46:25 2018 +0100
tools: bpftool: return from do\_event\_pipe() on bad arguments
[ Upstream commit 785e76d7a2051a9e28b9134d5388a45b16f5eb72 ]
When command line parsing fails in the while loop in do\_event\_pipe()
because the number of arguments is incorrect or because the keyword is
unknown, an error message is displayed, but bpftool remains stuck in
the loop. Make sure we exit the loop upon failure.
Fixes: f412eed9dfde ("tools: bpftool: add simple perf event output reader")
Signed-off-by: Quentin Monnet
Reviewed-by: Jakub Kicinski
Signed-off-by: Daniel Borkmann
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1dec7a1e6a54d057ac6c851b74d21edefb7f8a90
Author: Brett Creeley
Date: Thu Aug 9 06:28:58 2018 -0700
ice: Set VLAN flags correctly
[ Upstream commit 5d8778d803e21f235e9bc727b5bd619f02abb88b ]
In the struct ice\_aqc\_vsi\_props the field port\_vlan\_flags is an
overloaded term because it is used for both port VLANs (PVLANs) and
regular VLANs. This is an issue and is very confusing especially when
dealing with VFs because normal VLANs and port VLANs are not the same.
To fix this the field was renamed to vlan\_flags and all of the #define's
labeled \*\_PVLAN\_\* were renamed to \*\_VLAN\_\* if they are not specific to
port VLANs.
Also in ice\_vsi\_manage\_vlan\_stripping, set the ICE\_AQ\_VSI\_VLAN\_MODE\_ALL
bit to allow the driver to add a VLAN tag to all packets it sends.
Signed-off-by: Brett Creeley
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1c83a5aa0f263ff49b35d6f72579b282dd9c0019
Author: Jacob Keller
Date: Thu Aug 9 06:28:57 2018 -0700
ice: Use order\_base\_2 to calculate higher power of 2
[ Upstream commit 1eb43fc754485d772b1165118a8fb80c385f0492 ]
Currently, we use a combination of ilog2 and is\_power\_of\_2() to
calculate the next power of 2 for the qcount. This appears to be causing
a warning on some combinations of GCC and the Linux kernel:
MODPOST 1 modules
WARNING: "\_\_\_\_ilog2\_NaN" [ice.ko] undefined!
This appears to because because GCC realizes that qcount could be zero
in some circumstances and thus attempts to link against the
intentionally undefined \_\_\_ilog2\_NaN function.
The order\_base\_2 function is intentionally defined to return 0 when
passed 0 as an argument, and thus will be safe to use here.
This not only fixes the warning but makes the resulting code slightly
cleaner, and is really what we should have used originally.
Also update the comment to make it more clear that we are rounding up,
not just incrementing the ilog2 of qcount unconditionally.
Signed-off-by: Jacob Keller
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1dd0b6ce76ee1c60f2a7f3cd222872bf42ef10ca
Author: Anirudh Venkataramanan
Date: Thu Aug 9 06:28:56 2018 -0700
ice: Fix bugs in control queue processing
[ Upstream commit 3d6b640efcc1b07709b42dd2e9609401c6f88633 ]
This patch is a consolidation of multiple bug fixes for control queue
processing.
1) In ice\_clean\_adminq\_subtask() remove unnecessary reads/writes to
registers. The bits PFINT\_FW\_CTL, PFINT\_MBX\_CTL and PFINT\_SB\_CTL
are not set when an interrupt arrives, which means that clearing them
again can be omitted.
2) Get an accurate value in "pending" by re-reading the control queue
head register from the hardware.
3) Fix a corner case involving lost control queue messages by checking
for new control messages (using ice\_ctrlq\_pending) before exiting the
cleanup routine.
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9289b179fc4e20d663ffb6ce24721b6973d139c7
Author: Preethi Banala
Date: Thu Aug 9 06:28:55 2018 -0700
ice: Clean control queues only when they are initialized
[ Upstream commit b29bc220e2c7bd494a4605defcd93b18d5a8cf86 ]
Clean control queues only when they are initialized. One of the ways to
validate if the basic initialization is done is by checking value of
cq->sq.head and cq->rq.head variables that specify the register address.
This patch adds a check to avoid NULL pointer dereference crash when tried
to shutdown uninitialized control queue.
Signed-off-by: Preethi Banala
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 32d99e3e63c73f77d30a5f9ecca950a7cd7d62c4
Author: Jacob Keller
Date: Thu Aug 9 06:28:54 2018 -0700
ice: Report stats for allocated queues via ethtool stats
[ Upstream commit f8ba7db850350319348b6d3c276f8ba19bc098ef ]
It is not safe to have the string table for statistics change order or
size over the lifetime of a given netdevice. This is because of the
nature of the 3-step process for obtaining stats. First, user space
performs a request for the size of the strings table. Second it performs
a separate request for the strings themselves, after allocating space
for the table. Third, it requests the stats themselves, also allocating
space for the table.
If the size decreased, there is potential to see garbage data or stats
values. In the worst case, we could potentially see stats values become
mis-aligned with their strings, so that it looks like a statistic is
being reported differently than it actually is.
Even worse, if the size increased, there is potential that the strings
table or stats table was not allocated large enough and the stats code
could access and write to memory it should not, potentially resulting in
undefined behavior and system crashes.
It isn't even safe if the size always changes under the RTNL lock. This
is because the calls take place over multiple user space commands, so it
is not possible to hold the RTNL lock for the entire duration of
obtaining strings and stats. Further, not all consumers of the ethtool
API are the user space ethtool program, and it is possible that one
assumes the strings will not change (valid under the current contract),
and thus only requests the stats values when requesting stats in a loop.
Finally, it's not possible in the general case to detect when the size
changes, because it is quite possible that one value which could impact
the stat size increased, while another decreased. This would result in
the same total number of stats, but reordering them so that stats no
longer line up with the strings they belong to. Since only size changes
aren't enough, we would need some sort of hash or token to determine
when the strings no longer match. This would require extending the
ethtool stats commands, but there is no more space in the relevant
structures.
The real solution to resolve this would be to add a completely new API
for stats, probably over netlink.
In the ice driver, the only thing impacting the stats that is not
constant is the number of queues. Instead of reporting stats for each
used queue, report stats for each allocated queue. We do not change the
number of queues allocated for a given netdevice, as we pass this into
the alloc\_etherdev\_mq() function to set the num\_tx\_queues and
num\_rx\_queues.
This resolves the potential bugs at the slight cost of displaying many
queue statistics which will not be activated.
Signed-off-by: Jacob Keller
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c0f20df3b1fcc494cda24bb651be7043c5cbdc82
Author: Anirudh Venkataramanan
Date: Thu Aug 9 06:28:51 2018 -0700
ice: Fix multiple static analyser warnings
[ Upstream commit 4381147df9098706caa5cf9fda37e53b2fe4871f ]
This patch fixes the following smatch errors:
1) Fix "odd binop '0x0 & 0xc'" when performing the bitwise-and with a
constant value of zero (ICE\_AQC\_GSET\_RSS\_LUT\_TABLE\_SIZE\_128\_FLAG).
Remove a similar bitwise-and with 0 in ice\_add\_marker\_act() and use the
right mask ICE\_LG\_ACT\_GENERIC\_OFFSET\_M in the expression.
2) Fix a similar issue "odd binop '0x0 & 0x1800' in ice\_req\_irq\_msix\_misc.
3) Fix "odd binop '0x380000 & 0x7fff8'" in ice\_add\_marker\_act(). Also, use
a new define ICE\_LG\_ACT\_GENERIC\_OFF\_RX\_DESC\_PROF\_IDX instead of magic
number '7'.
4) Fix warn: odd binop '0x0 & 0x18' in ice\_set\_dflt\_vsi\_ctx() by removing
unnecessary logic to explicitly unset bits 3 and 4 in port\_vlan\_bits.
These bits are unset already by the memset on ctxt->info.
Reported-by: Dan Carpenter
Signed-off-by: Anirudh Venkataramanan
Tested-by: Tony Brelinski
Signed-off-by: Jeff Kirsher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1801431dc7aa7f833dda0a64f66f38890796edc9
Author: Huazhong Tan
Date: Thu Aug 23 11:37:15 2018 +0800
net: hns3: fix page\_offset overflow when CONFIG\_ARM64\_64K\_PAGES
[ Upstream commit 27a5959308559fa6afcaa4e6cd81d25bcb2dda7c ]
When enable the config item "CONFIG\_ARM64\_64K\_PAGES", the size of
PAGE\_SIZE is 65536(64K). But the type of page\_offset is u16, it will
overflow. So change it to u32, when "CONFIG\_ARM64\_64K\_PAGES" enabled.
Fixes: 76ad4f0ee747 ("net: hns3: Add support of HNS3 Ethernet Driver for hip08 SoC")
Signed-off-by: Huazhong Tan
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 374eb417162b5f8f36b15ac854cd8faf60fa5aa5
Author: Huazhong Tan
Date: Thu Aug 23 11:10:12 2018 +0800
net: hns: fix skb->truesize underestimation
[ Upstream commit b1ccd4c0ab6ef499f47dd84ed4920502a7147bba ]
skb->truesize is not meant to be tracking amount of used bytes in a skb,
but amount of reserved/consumed bytes in memory.
For instance, if we use a single byte in last page fragment, we have to
account the full size of the fragment.
So skb\_add\_rx\_frag needs to calculate the length of the entire buffer into
turesize.
Fixes: 9cbe9fd5214e ("net: hns: optimize XGE capability by reducing cpu usage")
Signed-off-by: Huazhong tan
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 2d4a7923868606a4252ba11b296a09baa3355aa5
Author: Huazhong Tan
Date: Thu Aug 23 11:10:10 2018 +0800
net: hns: fix length and page\_offset overflow when CONFIG\_ARM64\_64K\_PAGES
[ Upstream commit 3ed614dce3ca9912d22be215ff0f11104b69fe62 ]
When enable the config item "CONFIG\_ARM64\_64K\_PAGES", the size of PAGE\_SIZE
is 65536(64K). But the type of length and page\_offset are u16, they will
overflow. So change them to u32.
Fixes: 6fe6611ff275 ("net: add Hisilicon Network Subsystem hnae framework support")
Signed-off-by: Huazhong Tan
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d96820d46bc315f669789e18d4aef76d3bc71cc0
Author: Kevin Yang
Date: Wed Aug 22 17:43:15 2018 -0400
tcp\_bbr: in restart from idle, see if we should exit PROBE\_RTT
[ Upstream commit 5490b32dce6932ea7ee8e3b2f76db2957c92af6e ]
This patch fix the case where BBR does not exit PROBE\_RTT mode when
it restarts from idle. When BBR restarts from idle and if BBR is in
PROBE\_RTT mode, BBR should check if it's time to exit PROBE\_RTT. If
yes, then BBR should exit PROBE\_RTT mode and restore the cwnd to its
full value.
Fixes: 0f8782ea1497 ("tcp\_bbr: add BBR congestion control")
Signed-off-by: Kevin Yang
Signed-off-by: Neal Cardwell
Reviewed-by: Yuchung Cheng
Reviewed-by: Soheil Hassas Yeganeh
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e5e63d2bb9b2ce5cc84081ecd39c8b04779fe119
Author: Kevin Yang
Date: Wed Aug 22 17:43:14 2018 -0400
tcp\_bbr: add bbr\_check\_probe\_rtt\_done() helper
[ Upstream commit fb99886224294b2291d267da41395022fa4200e2 ]
This patch add a helper function bbr\_check\_probe\_rtt\_done() to
1. check the condition to see if bbr should exit probe\_rtt mode;
2. process the logic of exiting probe\_rtt mode.
Fixes: 0f8782ea1497 ("tcp\_bbr: add BBR congestion control")
Signed-off-by: Kevin Yang
Signed-off-by: Neal Cardwell
Signed-off-by: Yuchung Cheng
Reviewed-by: Soheil Hassas Yeganeh
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit a66193f585ebc3c63fb3b6c767bd20191b5820a2
Author: Samuel Mendoza-Jonas
Date: Wed Aug 22 14:57:44 2018 +1000
net/ncsi: Fixup .dumpit message flags and ID check in Netlink handler
[ Upstream commit 3d0371b313b84ba7c16ebf2526a7a34f1c57b19e ]
The ncsi\_pkg\_info\_all\_nl() .dumpit handler is missing the NLM\_F\_MULTI
flag, causing additional package information after the first to be lost.
Also fixup a sanity check in ncsi\_write\_package\_info() to reject out of
range package IDs.
Signed-off-by: Samuel Mendoza-Jonas
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9d028c09d1cf21b33030e137905846c8bebea768
Author: Emily Deng
Date: Wed Aug 22 20:18:25 2018 +0800
amdgpu: fix multi-process hang issue
[ Upstream commit 2f40c6eac74a2a60921cdec9e9a8a57e88e31434 ]
SWDEV-146499: hang during multi vulkan process testing
cause:
the second frame's PREAMBLE\_IB have clear-state
and LOAD actions, those actions ruin the pipeline
that is still doing process in the previous frame's
work-load IB.
fix:
need insert pipeline sync if have context switch for
SRIOV (because only SRIOV will report PREEMPTION flag
to UMD)
Signed-off-by: Monk Liu
Signed-off-by: Emily Deng
Reviewed-by: Christian König
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8824ceb2580c20ac16bc235f0efe0bd461c36864
Author: Christian König
Date: Tue Aug 21 15:09:39 2018 +0200
drm/amdgpu: fix preamble handling
[ Upstream commit d98ff24e8e9be3329eea7c84d5e244d0c1cd0ab3 ]
At this point the command submission can still be interrupted.
Signed-off-by: Christian König
Acked-by: Alex Deucher
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8483f3b7f4243f8c871d3d93e53ec11561088c18
Author: Christian König
Date: Thu Aug 16 12:01:03 2018 +0200
drm/amdgpu: fix VM clearing for the root PD
[ Upstream commit 8604ffcbf04f8f4f3f55a9e46e5ff948b2ed4290 ]
We need to figure out the address after validating the BO, not before.
Signed-off-by: Christian König
Reviewed-by: Felix Kuehling
Reviewed-by: Junwei Zhang
Reviewed-by: Huang Rui
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit a5c7547b45b43fd1e48fb4b34ea30261043356b9
Author: John Fastabend
Date: Wed Aug 22 08:37:37 2018 -0700
bpf: sockmap: write\_space events need to be passed to TCP handler
[ Upstream commit 9b2e0388bec8ec5427403e23faff3b58dd1c3200 ]
When sockmap code is using the stream parser it also handles the write
space events in order to handle the case where (a) verdict redirects
skb to another socket and (b) the sockmap then sends the skb but due
to memory constraints (or other EAGAIN errors) needs to do a retry.
But the initial code missed a third case where the
skb\_send\_sock\_locked() triggers an sk\_wait\_event(). A typically case
would be when sndbuf size is exceeded. If this happens because we
do not pass the write\_space event to the lower layers we never wake
up the event and it will wait for sndtimeo. Which as noted in ktls
fix may be rather large and look like a hang to the user.
To reproduce the best test is to reduce the sndbuf size and send
1B data chunks to stress the memory handling. To fix this pass the
event from the upper layer to the lower layer.
Signed-off-by: John Fastabend
Signed-off-by: Daniel Borkmann
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9c3d97879505f51a1b0f80d9b7418bce84b11a06
Author: John Fastabend
Date: Wed Aug 22 08:37:32 2018 -0700
tls: possible hang when do\_tcp\_sendpages hits sndbuf is full case
[ Upstream commit 67db7cd249e71f64346f481b629724376d063e08 ]
Currently, the lower protocols sk\_write\_space handler is not called if
TLS is sending a scatterlist via tls\_push\_sg. However, normally
tls\_push\_sg calls do\_tcp\_sendpage, which may be under memory pressure,
that in turn may trigger a wait via sk\_wait\_event. Typically, this
happens when the in-flight bytes exceed the sdnbuf size. In the normal
case when enough ACKs are received sk\_write\_space() will be called and
the sk\_wait\_event will be woken up allowing it to send more data
and/or return to the user.
But, in the TLS case because the sk\_write\_space() handler does not
wake up the events the above send will wait until the sndtimeo is
exceeded. By default this is MAX\_SCHEDULE\_TIMEOUT so it look like a
hang to the user (especially this impatient user). To fix this pass
the sk\_write\_space event to the lower layers sk\_write\_space event
which in the TCP case will wake any pending events.
I observed the above while integrating sockmap and ktls. It
initially appeared as test\_sockmap (modified to use ktls) occasionally
hanging. To reliably reproduce this reduce the sndbuf size and stress
the tls layer by sending many 1B sends. This results in every byte
needing a header and each byte individually being sent to the crypto
layer.
Signed-off-by: John Fastabend
Acked-by: Dave Watson
Signed-off-by: Daniel Borkmann
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit a0be77d6d94081333dbe79f531f2dc2866e58d94
Author: Daniel Borkmann
Date: Wed Aug 22 18:09:17 2018 +0200
bpf, sockmap: fix sock hash count in alloc\_sock\_hash\_elem
[ Upstream commit eb29429d81e31b191f3b2bd19cf820279cec6463 ]
When we try to allocate a new sock hash entry and the allocation
fails, then sock hash map fails to reduce the map element counter,
meaning we keep accounting this element although it was never used.
Fix it by dropping the element counter on error.
Fixes: 81110384441a ("bpf: sockmap, add hash map support")
Signed-off-by: Daniel Borkmann
Acked-by: John Fastabend
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit efed642bc585c8d26bdba3b4de97d78057874bcf
Author: Daniel Borkmann
Date: Tue Aug 21 15:55:00 2018 +0200
bpf, sockmap: fix sock\_hash\_alloc and reject zero-sized keys
[ Upstream commit b845c898b2f1ea458d5453f0fa1da6e2dfce3bb4 ]
Currently, it is possible to create a sock hash map with key size
of 0 and have the kernel return a fd back to user space. This is
invalid for hash maps (and kernel also hasn't been tested for zero
key size support in general at this point). Thus, reject such
configuration.
Fixes: 81110384441a ("bpf: sockmap, add hash map support")
Signed-off-by: Daniel Borkmann
Acked-by: John Fastabend
Acked-by: Song Liu
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0a9fd2a9875bd60afc0f8f9316e9ce63a1eb4e87
Author: Pavel Machek
Date: Wed Aug 1 22:28:21 2018 +0200
ARM: dts: omap4-droid4: fix vibrations on Droid 4
[ Upstream commit f4efa74c09a7eddcc12cd13208f78743763f6e7a ]
Vibration GPIOs don't have anything to do with wakeup. Move it to
normal section; this fixes vibrations on Droid 4.
Fixes: a5effd968301 ("ARM: dts: omap4-droid4: Add vibrator")
Signed-off-by: Pavel Machek
Reviewed-by: Sebastian Reichel
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f7468a7160e1086a7960d6fea8735f49c3c3c900
Author: Tony Lindgren
Date: Wed Aug 8 01:07:06 2018 -0700
bus: ti-sysc: Fix no\_console\_suspend handling
[ Upstream commit 4f3530f4a41d49c41015020cd9a5ed5c95b5d2db ]
If no\_console\_suspend is set, we should keep console enabled during suspend.
Lets fix this by only producing a warning if we can't idle hardware during
suspend.
Fixes: ef55f8215a78 ("bus: ti-sysc: Improve suspend and resume handling")
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit b8f4b96768c08e9273b67e720be0d6287f1ac291
Author: Ludovic Desroches
Date: Mon Aug 20 10:54:45 2018 +0200
mmc: android-goldfish: fix bad logic of sg\_copy\_{from,to}\_buffer conversion
[ Upstream commit 17e96d8516e31c3cb52cb8e2ee79d1d2e6948c11 ]
The conversion to sg\_copy\_{from,to}\_buffer has been done in the wrong
way. sg\_copy\_to\_buffer is a copy from an SG list to a linear buffer so
it can't replace memcpy(dest, host->virt\_base, data->sg->length) where
dest is the virtual address of the SG. Same for sg\_copy\_from\_buffer
but in the opposite way.
Signed-off-by: Ludovic Desroches
Suggested-by: Douglas Gilbert
Fixes: 53d7e098ba08 ("mmc: android-goldfish: use sg\_copy\_{from,to}\_buffer")
Signed-off-by: Ulf Hansson
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d02aee5cf4ea78f2343a6bdb298cba47350a05b6
Author: Ludovic Desroches
Date: Mon Aug 20 10:54:44 2018 +0200
mmc: atmel-mci: fix bad logic of sg\_copy\_{from,to}\_buffer conversion
[ Upstream commit 19f5e9e015675fcdbf2c20e804b2e84e80201454 ]
The conversion to sg\_copy\_{from,to}\_buffer has been done in the wrong
way. sg\_copy\_to\_buffer is a copy from an SG list to a linear buffer so
it can't replace memcpy(buf + offset, &value, remaining) where buf is
the virtual address of the SG. Same for sg\_copy\_to\_buffer but in the
opposite way.
Signed-off-by: Ludovic Desroches
Suggested-by: Douglas Gilbert
Fixes: 5b4277814e3f ("mmc: atmel-mci: use sg\_copy\_{from,to}\_buffer")
Signed-off-by: Ulf Hansson
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1a7a1ad290d4006500e798e850dfab0385a8af9c
Author: Eric Sandeen
Date: Thu Aug 16 21:44:02 2018 -0500
isofs: reject hardware sector size > 2048 bytes
[ Upstream commit 09a4e0be5826aa66c4ce9954841f110ffe63ef4f ]
The largest block size supported by isofs is ISOFS\_BLOCK\_SIZE (2048), but
isofs\_fill\_super calls sb\_min\_blocksize and sets the blocksize to the
device's logical block size if it's larger than what we ended up with after
option parsing.
If for some reason we try to mount a hard 4k device as an isofs filesystem,
we'll set opt.blocksize to 4096, and when we try to read the superblock
we found via:
block = iso\_blknum << (ISOFS\_BLOCK\_BITS - s->s\_blocksize\_bits)
with s\_blocksize\_bits greater than ISOFS\_BLOCK\_BITS, we'll have a negative
shift and the bread will fail somewhat cryptically:
isofs\_fill\_super: bread failed, dev=sda, iso\_blknum=17, block=-2147483648
It seems best to just catch and clearly reject mounts of such a device.
Reported-by: Bryan Gurney
Signed-off-by: Eric Sandeen
Signed-off-by: Jan Kara
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 2da832f43da5f4b5c0ffc1d2a3f180130795730d
Author: Anson Huang
Date: Tue Jul 31 00:56:49 2018 +0800
thermal: of-thermal: disable passive polling when thermal zone is disabled
[ Upstream commit 152395fd03d4ce1e535a75cdbf58105e50587611 ]
When thermal zone is in passive mode, disabling its mode from
sysfs is NOT taking effect at all, it is still polling the
temperature of the disabled thermal zone and handling all thermal
trips, it makes user confused. The disabling operation should
disable the thermal zone behavior completely, for both active and
passive mode, this patch clears the passive\_delay when thermal
zone is disabled and restores it when it is enabled.
Signed-off-by: Anson Huang
Signed-off-by: Eduardo Valentin
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6a3f378b76149f668afe92aa562f795f3af56a89
Author: Tomer Tayar
Date: Mon Aug 20 00:01:45 2018 +0300
qed: Avoid sending mailbox commands when MFW is not responsive
[ Upstream commit b310974e041913231b6e3d5d475d4df55c312301 ]
Keep sending mailbox commands to the MFW when it is not responsive ends up
with a redundant amount of timeout expiries.
This patch prints the MCP status on the first command which is not
responded, and blocks the following commands.
Since the (un)load request commands might be not responded due to other
PFs, the patch also adds the option to skip the blocking upon a failure.
Signed-off-by: Tomer Tayar
Signed-off-by: Ariel Elior
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c36724c6478067e0acac3d2700ad6fee55e36dea
Author: Tomer Tayar
Date: Mon Aug 20 00:01:44 2018 +0300
qed: Prevent a possible deadlock during driver load and unload
[ Upstream commit eaa50fc59e5841910987e90b0438b2643041f508 ]
The MFW manages an internal lock to prevent concurrent hardware
(de)initialization of different PFs.
This, together with the busy-waiting for the MFW's responses for commands,
might lead to a deadlock during concurrent load or unload of PFs.
This patch adds the option to sleep within the busy-waiting, and uses it
for the (un)load requests (which are not sent from an interrupt context) to
prevent the possible deadlock.
Signed-off-by: Tomer Tayar
Signed-off-by: Ariel Elior
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1e85fc417c114e6186071fae46850c167593d152
Author: Tomer Tayar
Date: Mon Aug 20 00:01:43 2018 +0300
qed: Wait for MCP halt and resume commands to take place
[ Upstream commit 76271809f49056f079e202bf6513d17b0d6dd34d ]
Successive iterations of halting and resuming the management chip (MCP)
might fail, since currently the driver doesn't wait for these operations to
actually take place.
This patch prevents the driver from moving forward before the operations
are reflected in the state register.
Signed-off-by: Tomer Tayar
Signed-off-by: Ariel Elior
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c91ab927a8b7116967e8ed4d108ab7a44c06cfd4
Author: Tomer Tayar
Date: Mon Aug 20 00:01:42 2018 +0300
qed: Wait for ready indication before rereading the shmem
[ Upstream commit f00d25f3154b676fcea4502a25b94bd7f142ca74 ]
The MFW might be reset and re-update its shared memory.
Upon the detection of such a reset the driver rereads this memory, but it
has to wait till the data is valid.
This patch adds the missing wait for a data ready indication.
Signed-off-by: Tomer Tayar
Signed-off-by: Ariel Elior
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 67eb28b0f832136b8af0a8f3d9831c450b4d20ae
Author: Tony Lindgren
Date: Wed Aug 8 01:07:05 2018 -0700
bus: ti-sysc: Fix module register ioremap for larger offsets
[ Upstream commit 0ef8e3bb974af56346b34393e643d491d9141c66 ]
We can have the interconnect target module control registers pretty
much anywhere within the module range. The current code attempts an
incomplete optimization of the ioremap size but does it wrong and
it only works for registers at the beginning of the module.
Let's just use the largest control register to calculate the ioremap
size. The ioremapped range is for most part cached anyways so there
is no need for size optimization. Let's also update the comments
accordingly.
Fixes: 0eecc636e5a2 ("bus: ti-sysc: Add minimal TI sysc interconnect
target driver")
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3609bd6105c1f41a508dad682686078d3a880662
Author: Tony Lindgren
Date: Wed Aug 8 01:07:04 2018 -0700
ARM: OMAP2+: Fix module address for modules using mpu\_rt\_idx
[ Upstream commit 1dbcb97c656eed1a244c960b8b3a469c3d20ce7b ]
If we use device tree data for a module interconnect target we want
to map the control registers from the module start. Legacy hwmod platform
data however is using child IP offsets for cpsw module with mpu\_rt\_idx.
In cases where we have the interconnect target module already using device
tree data with legacy hwmod platform data still around, the sysc register
area is not adjusted for mpu\_rt\_idx causing wrong registers being accessed.
Let's fix the issue for mixed dts and platform data mode by ioremapping
the module registers using child IP offset if mpu\_rt\_idx is set. For
device tree only data there's no reason to use mpu\_rt\_idx.
Fixes: 6c72b3550672 ("ARM: OMAP2+: Parse module IO range from dts for legacy
"ti,hwmods" support")
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1fcd5e01d26e99461d4f00b660d43632a81a3306
Author: Tony Lindgren
Date: Wed Aug 8 01:07:03 2018 -0700
ARM: OMAP2+: Fix null hwmod for ti-sysc debug
[ Upstream commit 4769c003e0fcff0ee001a9102e2605bdaa5880f0 ]
We may call omap\_hwmod\_parse\_module\_range() with no hwmod allocated yet
and may have debug enabled. Let's fix this by checking for hwmod before
trying to use it's name.
Fixes: 6c72b3550672 ("ARM: OMAP2+: Parse module IO range from dts for legacy
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4435064439c68cfa80a7a1ec69733db7b9030884
Author: Dave Martin
Date: Thu Sep 27 16:53:21 2018 +0100
arm64: KVM: Tighten guest core register access from userspace
commit d26c25a9d19b5976b319af528886f89cf455692d upstream.
We currently allow userspace to access the core register file
in about any possible way, including straddling multiple
registers and doing unaligned accesses.
This is not the expected use of the ABI, and nobody is actually
using it that way. Let's tighten it by explicitly checking
the size and alignment for each field of the register file.
Cc:
Fixes: 2f4a07c5f9fe ("arm64: KVM: guest one-reg interface")
Reviewed-by: Christoffer Dall
Reviewed-by: Mark Rutland
Signed-off-by: Dave Martin
[maz: rewrote Dave's initial patch to be more easily backported]
Signed-off-by: Marc Zyngier
Signed-off-by: Will Deacon
Signed-off-by: Greg Kroah-Hartman
commit 12a7e915c5069849fb0ab697a7ef9c48aedd0685
Author: Steve Wise
Date: Fri Aug 31 07:16:03 2018 -0700
RDMA/uverbs: Atomically flush and mark closed the comp event queue
commit 67e3816842fe6414d629c7515b955952ec40c7d7 upstream.
Currently a uverbs completion event queue is flushed of events in
ib\_uverbs\_comp\_event\_close() with the queue spinlock held and then
released. Yet setting ev\_queue->is\_closed is not set until later in
uverbs\_hot\_unplug\_completion\_event\_file().
In between the time ib\_uverbs\_comp\_event\_close() releases the lock and
uverbs\_hot\_unplug\_completion\_event\_file() acquires the lock, a completion
event can arrive and be inserted into the event queue by
ib\_uverbs\_comp\_handler().
This can cause a "double add" list\_add warning or crash depending on the
kernel configuration, or a memory leak because the event is never dequeued
since the queue is already closed down.
So add setting ev\_queue->is\_closed = 1 to ib\_uverbs\_comp\_event\_close().
Cc: stable@vger.kernel.org
Fixes: 1e7710f3f656 ("IB/core: Change completion channel to use the reworked objects schema")
Signed-off-by: Steve Wise
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit cbbb9f08566ef3f08e842812b93eae063133f9e2
Author: Mika Westerberg
Date: Wed Sep 26 15:39:28 2018 -0500
ACPI / hotplug / PCI: Don't scan for non-hotplug bridges if slot is not bridge
commit f188b99f0b2d33794b4af8a225f95d1e968c0a3f upstream.
HP 6730b laptop has an ethernet NIC connected to one of the PCIe root
ports. The root ports themselves are native PCIe hotplug capable. Now,
during boot after PCI devices are scanned the BIOS triggers ACPI bus check
directly to the NIC:
ACPI: \\_SB\_.PCI0.RP06.NIC\_: Bus check in hotplug\_event()
It is not clear why it is sending bus check but regardless the ACPI hotplug
notify handler calls enable\_slot() directly (instead of going through
acpiphp\_check\_bridge() as there is no bridge), which ends up handling
special case for non-hotplug bridges with native PCIe hotplug. This
results a crash of some kind but the reporter only sees black screen so it
is hard to figure out the exact spot and what actually happens. Based on
a few fix proposals it was tracked to crash somewhere inside
pci\_assign\_unassigned\_bridge\_resources().
In any case we should not really be in that special branch at all because
the ACPI notify happened to a slot that is not a PCI bridge (it is just a
regular PCI device).
Fix this so that we only go to that special branch if we are calling
enable\_slot() for a bridge (e.g., the ACPI notification was for the
bridge).
Link: https://bugzilla.kernel.org/show\_bug.cgi?id=201127
Fixes: 84c8b58ed3ad ("ACPI / hotplug / PCI: Don't scan bridges managed by native hotplug")
Reported-by: Peter Anemone
Signed-off-by: Mika Westerberg
Signed-off-by: Bjorn Helgaas
Reviewed-by: Rafael J. Wysocki
CC: stable@vger.kernel.org # v4.18+
Signed-off-by: Greg Kroah-Hartman
commit 0c7898792c9a9e61b799ef37706cd29a97eb3e67
Author: Michael J. Ruhl
Date: Thu Sep 20 12:59:14 2018 -0700
IB/hfi1: Fix destroy\_qp hang after a link down
commit b4a4957d3d1c328b733fce783b7264996f866ad2 upstream.
rvt\_destroy\_qp() cannot complete until all in process packets have
been released from the underlying hardware. If a link down event
occurs, an application can hang with a kernel stack similar to:
cat /proc//stack
quiesce\_qp+0x178/0x250 [hfi1]
rvt\_reset\_qp+0x23d/0x400 [rdmavt]
rvt\_destroy\_qp+0x69/0x210 [rdmavt]
ib\_destroy\_qp+0xba/0x1c0 [ib\_core]
nvme\_rdma\_destroy\_queue\_ib+0x46/0x80 [nvme\_rdma]
nvme\_rdma\_free\_queue+0x3c/0xd0 [nvme\_rdma]
nvme\_rdma\_destroy\_io\_queues+0x88/0xd0 [nvme\_rdma]
nvme\_rdma\_error\_recovery\_work+0x52/0xf0 [nvme\_rdma]
process\_one\_work+0x17a/0x440
worker\_thread+0x126/0x3c0
kthread+0xcf/0xe0
ret\_from\_fork+0x58/0x90
0xffffffffffffffff
quiesce\_qp() waits until all outstanding packets have been freed.
This wait should be momentary. During a link down event, the cleanup
handling does not ensure that all packets caught by the link down are
flushed properly.
This is caused by the fact that the freeze path and the link down
event is handled the same. This is not correct. The freeze path
waits until the HFI is unfrozen and then restarts PIO. A link down
is not a freeze event. The link down path cannot restart the PIO
until link is restored. If the PIO path is restarted before the link
comes up, the application (QP) using the PIO path will hang (until
link is restored).
Fix by separating the linkdown path from the freeze path and use the
link down path for link down events.
Close a race condition sc\_disable() by acquiring both the progress
and release locks.
Close a race condition in sc\_stop() by moving the setting of the flag
bits under the alloc lock.
Cc:  # 4.9.x+
Fixes: 7724105686e7 ("IB/hfi1: add driver files")
Reviewed-by: Mike Marciniszyn
Signed-off-by: Michael J. Ruhl
Signed-off-by: Dennis Dalessandro
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit b34ba9e024085b15ec7d7726e7180466dcf843de
Author: Michael J. Ruhl
Date: Thu Sep 20 12:59:05 2018 -0700
IB/hfi1: Fix context recovery when PBC has an UnsupportedVL
commit d623500b3c4efd8d4e945ac9003c6b87b469a9ab upstream.
If a packet stream uses an UnsupportedVL (virtual lane), the send
engine will not send the packet, and it will not indicate that an
error has occurred. This will cause the packet stream to block.
HFI has 8 virtual lanes available for packet streams. Each lane can
be enabled or disabled using the UnsupportedVL mask. If a lane is
disabled, adding a packet to the send context must be disallowed.
The current mask for determining unsupported VLs defaults to 0 (allow
all). This is incorrect. Only the VLs that are defined should be
allowed.
Determine which VLs are disabled (mtu == 0), and set the appropriate
unsupported bit in the mask. The correct mask will allow the send
engine to error on the invalid VL, and error recovery will work
correctly.
Cc:  # 4.9.x+
Fixes: 7724105686e7 ("IB/hfi1: add driver files")
Reviewed-by: Mike Marciniszyn
Reviewed-by: Lukasz Odzioba
Signed-off-by: Michael J. Ruhl
Signed-off-by: Dennis Dalessandro
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit bcc5f9f5e11ec53dddb95e2e454a8305d0ffb522
Author: Michael J. Ruhl
Date: Thu Sep 20 12:58:56 2018 -0700
IB/hfi1: Invalid user input can result in crash
commit 94694d18cf27a6faad91487a38ce516c2b16e7d9 upstream.
If the number of packets in a user sdma request does not match
the actual iovectors being sent, sdma\_cleanup can be called on
an uninitialized request structure, resulting in a crash similar
to this:
BUG: unable to handle kernel NULL pointer dereference at 0000000000000008
IP: [] \_\_sdma\_txclean+0x57/0x1e0 [hfi1]
PGD 8000001044f61067 PUD 1052706067 PMD 0
Oops: 0000 [#1] SMP
CPU: 30 PID: 69912 Comm: upsm Kdump: loaded Tainted: G OE
------------ 3.10.0-862.el7.x86\_64 #1
Hardware name: Intel Corporation S2600KPR/S2600KPR, BIOS
SE5C610.86B.01.01.0019.101220160604 10/12/2016
task: ffff8b331c890000 ti: ffff8b2ed1f98000 task.ti: ffff8b2ed1f98000
RIP: 0010:[] [] \_\_sdma\_txclean+0x57/0x1e0
[hfi1]
RSP: 0018:ffff8b2ed1f9bab0 EFLAGS: 00010286
RAX: 0000000000008b2b RBX: ffff8b2adf6e0000 RCX: 0000000000000000
RDX: 00000000000000a0 RSI: ffff8b2e9eedc540 RDI: ffff8b2adf6e0000
RBP: ffff8b2ed1f9bad8 R08: 0000000000000000 R09: ffffffffc0b04a06
R10: ffff8b331c890190 R11: ffffe6ed00bf1840 R12: ffff8b3315480000
R13: ffff8b33154800f0 R14: 00000000fffffff2 R15: ffff8b2e9eedc540
FS: 00007f035ac47740(0000) GS:ffff8b331e100000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 0000000000000008 CR3: 0000000c03fe6000 CR4: 00000000001607e0
Call Trace:
[] user\_sdma\_send\_pkts+0xdcd/0x1990 [hfi1]
[] ? gup\_pud\_range+0x140/0x290
[] ? hfi1\_mmu\_rb\_insert+0x155/0x1b0 [hfi1]
[] hfi1\_user\_sdma\_process\_request+0xc5b/0x11b0 [hfi1]
[] hfi1\_aio\_write+0xba/0x110 [hfi1]
[] do\_sync\_readv\_writev+0x7b/0xd0
[] do\_readv\_writev+0xce/0x260
[] ? tty\_ldisc\_deref+0x19/0x20
[] ? n\_tty\_ioctl+0xe0/0xe0
[] vfs\_writev+0x35/0x60
[] SyS\_writev+0x7f/0x110
[] system\_call\_fastpath+0x1c/0x21
Code: 06 49 c7 47 18 00 00 00 00 0f 87 89 01 00 00 5b 41 5c 41 5d 41 5e 41 5f
5d c3 66 2e 0f 1f 84 00 00 00 00 00 48 8b 4e 10 48 89 fb <48> 8b 51 08 49 89 d4
83 e2 0c 41 81 e4 00 e0 00 00 48 c1 ea 02
RIP [] \_\_sdma\_txclean+0x57/0x1e0 [hfi1]
RSP
CR2: 0000000000000008
There are two exit points from user\_sdma\_send\_pkts(). One (free\_tx)
merely frees the slab entry and one (free\_txreq) cleans the sdma\_txreq
prior to freeing the slab entry. The free\_txreq variation can only be
called after one of the sdma\_init\*() variations has been called.
In the panic case, the slab entry had been allocated but not inited.
Fix the issue by exiting through free\_tx thus avoiding sdma\_clean().
Cc:  # 4.9.x+
Fixes: 7724105686e7 ("IB/hfi1: add driver files")
Reviewed-by: Mike Marciniszyn
Reviewed-by: Lukasz Odzioba
Signed-off-by: Michael J. Ruhl
Signed-off-by: Dennis Dalessandro
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Jason Gunthorpe
commit 2cced23e54834ebef19152b5246b1209329b27e0
Author: Ira Weiny
Date: Thu Sep 20 12:58:46 2018 -0700
IB/hfi1: Fix SL array bounds check
commit 0dbfaa9f2813787679e296eb5476e40938ab48c8 upstream.
The SL specified by a user needs to be a valid SL.
Add a range check to the user specified SL value which protects from
running off the end of the SL to SC table.
CC: stable@vger.kernel.org
Fixes: 7724105686e7 ("IB/hfi1: add driver files")
Signed-off-by: Ira Weiny
Signed-off-by: Dennis Dalessandro
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit fa22f4874e9409bcb321839ceefeadb88e423b9f
Author: Bart Van Assche
Date: Mon Sep 17 18:10:05 2018 -0700
IB/srp: Avoid that sg\_reset -d ${srp\_device} triggers an infinite loop
commit ee92efe41cf358f4b99e73509f2bfd4733609f26 upstream.
Use different loop variables for the inner and outer loop. This avoids
that an infinite loop occurs if there are more RDMA channels than
target->req\_ring\_size.
Fixes: d92c0da71a35 ("IB/srp: Add multichannel support")
Cc:
Signed-off-by: Bart Van Assche
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit ebc51114fa51756d627022f2fc4f202bfeef1b22
Author: Aaron Ma
Date: Tue Sep 18 09:32:22 2018 -0700
Input: elantech - enable middle button of touchpad on ThinkPad P72
commit 91a97507323e1ad4bfc10f4a5922e67cdaf8b3cd upstream.
Adding 2 new touchpad IDs to support middle button support.
Cc: stable@vger.kernel.org
Signed-off-by: Aaron Ma
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit f44f3d0a9e9fbfb800a2a98c02bac5772baedf90
Author: Matthew Wilcox
Date: Tue Sep 11 21:27:44 2018 -0700
filesystem-dax: Fix use of zero page
commit b90ca5cc32f59bb214847c6855959702f00c6801 upstream.
Use my\_zero\_pfn instead of ZERO\_PAGE(), and pass the vaddr to it instead
of zero so it works on MIPS and s390 who reference the vaddr to select a
zero page.
Cc:
Fixes: 91d25ba8a6b0 ("dax: use common 4k zero page for dax mmap reads")
Signed-off-by: Matthew Wilcox
Reviewed-by: Ross Zwisler
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit 7ebfc8f69a37bb28380c97819fd6437eec37dd8c
Author: Toshi Kani
Date: Fri Sep 14 08:51:14 2018 -0600
ext2, dax: set ext2\_dax\_aops for dax files
commit 9e796c9db93b4840d1b00e550eea26db7cb741e2 upstream.
Sync syscall to DAX file needs to flush processor cache, but it
currently does not flush to existing DAX files. This is because
'ext2\_da\_aops' is set to address\_space\_operations of existing DAX
files, instead of 'ext2\_dax\_aops', since S\_DAX flag is set after
ext2\_set\_aops() in the open path.
Similar to ext4, change ext2\_iget() to initialize i\_flags before
ext2\_set\_aops().
Fixes: fb094c90748f ("ext2, dax: introduce ext2\_dax\_aops")
Signed-off-by: Toshi Kani
Suggested-by: Jan Kara
Cc: Jan Kara
Cc: Dan Williams
Cc: "Theodore Ts'o"
Cc: Andreas Dilger
Cc:
Signed-off-by: Jan Kara
Signed-off-by: Greg Kroah-Hartman
commit 2436ce1bad9ec8756d2c6626b794ddac67cd86ef
Author: Dave Jiang
Date: Wed Sep 5 13:31:40 2018 -0700
uaccess: Fix is\_source param for check\_copy\_size() in copy\_to\_iter\_mcsafe()
commit dfb06cba8c73c0704710b2e3fbe2c35ac66a01b4 upstream.
copy\_to\_iter\_mcsafe() is passing in the is\_source parameter as "false"
to check\_copy\_size(). This is different than what copy\_to\_iter() does.
Also, the addr parameter passed to check\_copy\_size() is the source so
therefore we should be passing in "true" instead.
Fixes: 8780356ef630 ("x86/asm/memcpy\_mcsafe: Define copy\_to\_iter\_mcsafe()")
Cc:
Reported-by: Fan Du
Signed-off-by: Dave Jiang
Reviewed-by: Vishal Verma
Reported-by: Wenwei Tao
Signed-off-by: Dan Williams
Signed-off-by: Greg Kroah-Hartman
commit dc38ebde8a524c88ec3d6c5e7e4906d95fa6cbac
Author: Alan Stern
Date: Mon Sep 10 13:58:51 2018 -0400
USB: remove LPM management from usb\_driver\_claim\_interface()
commit c183813fcee44a249339b7c46e1ad271ca1870aa upstream.
usb\_driver\_claim\_interface() disables and re-enables Link Power
Management, but it shouldn't do either one, for the reasons listed
below. This patch removes the two LPM-related function calls from the
routine.
The reason for disabling LPM in the analogous function
usb\_probe\_interface() is so that drivers won't have to deal with
unwanted LPM transitions in their probe routine. But
usb\_driver\_claim\_interface() doesn't call the driver's probe routine
(or any other callbacks), so that reason doesn't apply here.
Furthermore, no driver other than usbfs will ever call
usb\_driver\_claim\_interface() unless it is already bound to another
interface in the same device, which means disabling LPM here would be
redundant. usbfs doesn't interact with LPM at all.
Lastly, the error return from usb\_unlocked\_disable\_lpm() isn't handled
properly; the code doesn't clean up its earlier actions before
returning.
Signed-off-by: Alan Stern
Fixes: 8306095fd2c1 ("USB: Disable USB 3.0 LPM in critical sections.")
CC:
Signed-off-by: Greg Kroah-Hartman
commit de425c9ae7bf74f9eea429eebf96dd2f627a28a6
Author: Sebastian Andrzej Siewior
Date: Tue Sep 11 10:00:44 2018 +0200
Revert "usb: cdc-wdm: Fix a sleep-in-atomic-context bug in service\_outstanding\_interrupt()"
commit e871db8d78df1c411032cbb3acfdf8930509360e upstream.
This reverts commit 6e22e3af7bb3a7b9dc53cb4687659f6e63fca427.
The bug the patch describes to, has been already fixed in commit
2df6948428542 ("USB: cdc-wdm: don't enable interrupts in USB-giveback")
so need to this, revert it.
Fixes: 6e22e3af7bb3 ("usb: cdc-wdm: Fix a sleep-in-atomic-context bug in service\_outstanding\_interrupt()")
Cc: stable
Signed-off-by: Sebastian Andrzej Siewior
Signed-off-by: Greg Kroah-Hartman
commit 8badb9b1af73c407181d44806820d494e3c3c9c3
Author: Oliver Neukum
Date: Wed Sep 5 12:07:03 2018 +0200
USB: usbdevfs: restore warning for nonsensical flags
commit 81e0403b26d94360abd1f6a57311337973bc82cd upstream.
If we filter flags before they reach the core we need to generate our
own warnings.
Signed-off-by: Oliver Neukum
Fixes: 0cb54a3e47cb ("USB: debugging code shouldn't alter control flow")
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit b5376ef73d3333db5989367b3aa9c0d9e7f0e619
Author: Oliver Neukum
Date: Wed Sep 5 12:07:02 2018 +0200
USB: usbdevfs: sanitize flags more
commit 7a68d9fb851012829c29e770621905529bd9490b upstream.
Requesting a ZERO\_PACKET or not is sensible only for output.
In the input direction the device decides.
Likewise accepting short packets makes sense only for input.
This allows operation with panic\_on\_warn without opening up
a local DOS.
Signed-off-by: Oliver Neukum
Reported-by: syzbot+843efa30c8821bd69f53@syzkaller.appspotmail.com
Fixes: 0cb54a3e47cb ("USB: debugging code shouldn't alter control flow")
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 8e2842a2e17589b1e01fc0cdb4314aecf0e2b577
Author: Bin Liu
Date: Mon Sep 17 11:40:22 2018 -0500
usb: musb: dsps: do not disable CPPI41 irq in driver teardown
commit 783f3b4e9ec50491c21746e7e05ec6c39c21f563 upstream.
TI AM335x CPPI 4.1 module uses a single register bit for CPPI interrupts
in both musb controllers. So disabling the CPPI irq in one musb driver
breaks the other musb module.
Since musb is already disabled before tearing down dma controller in
musb\_remove(), it is safe to not disable CPPI irq in
musb\_dma\_controller\_destroy().
Fixes: 255348289f71 ("usb: musb: dsps: Manage CPPI 4.1 DMA interrupt in DSPS")
Cc: stable@vger.kernel.org
Signed-off-by: Bin Liu
Signed-off-by: Greg Kroah-Hartman
commit 608677656ac2c02fbab0fc569ec0629ef9a5e71c
Author: Harry Pan
Date: Fri Sep 14 16:58:16 2018 +0800
usb: core: safely deal with the dynamic quirk lists
commit 16c4cb19fa85c648a803752eb63cac0ef69231c2 upstream.
Applying dynamic usbcore quirks in early booting when the slab is
not yet ready would cause kernel panic of null pointer dereference
because the quirk\_count has been counted as 1 while the quirk\_list
was failed to allocate.
i.e.,
[ 1.044970] BUG: unable to handle kernel NULL pointer dereference at (null)
[ 1.044995] IP: [] usb\_detect\_quirks+0x88/0xd1
[ 1.045016] PGD 0
[ 1.045026] Oops: 0000 [#1] PREEMPT SMP
[ 1.046986] gsmi: Log Shutdown Reason 0x03
[ 1.046995] Modules linked in:
[ 1.047008] CPU: 0 PID: 81 Comm: kworker/0:3 Not tainted 4.4.154 #28
[ 1.047016] Hardware name: Google Coral/Coral, BIOS Google\_Coral.10068.27.0 12/04/2017
[ 1.047028] Workqueue: usb\_hub\_wq hub\_event
[ 1.047037] task: ffff88017a321c80 task.stack: ffff88017a384000
[ 1.047044] RIP: 0010:[] [] usb\_detect\_quirks+0x88/0xd1
To tackle this odd, let's balance the quirk\_count to 0 when the kcalloc
call fails, and defer the quirk setting into a lower level callback
which ensures that the kernel memory management has been initialized.
Fixes: 027bd6cafd9a ("usb: core: Add "quirks" parameter for usbcore")
Signed-off-by: Harry Pan
Acked-by: Kai-Heng Feng
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 7b169e33a3bc9040e06988b2bc15e83d2af80358
Author: Heikki Krogerus
Date: Wed Sep 19 10:58:05 2018 +0300
usb: roles: Take care of driver module reference counting
commit 5c54fcac9a9de559b444ac63ec3cd82f1d157a0b upstream.
This fixes potential "BUG: unable to handle kernel paging
request at ..." from happening.
Cc:
Acked-by: Hans de Goede
Tested-by: Hans de Goede
Signed-off-by: Heikki Krogerus
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Greg Kroah-Hartman
commit 95b273c4038cc3f9c2fb5e24fedd3484500c536a
Author: Alan Stern
Date: Mon Sep 10 14:00:53 2018 -0400
USB: handle NULL config in usb\_find\_alt\_setting()
commit c9a4cb204e9eb7fa7dfbe3f7d3a674fa530aa193 upstream.
usb\_find\_alt\_setting() takes a pointer to a struct usb\_host\_config as
an argument; it searches for an interface with specified interface and
alternate setting numbers in that config. However, it crashes if the
usb\_host\_config pointer argument is NULL.
Since this is a general-purpose routine, available for use in many
places, we want to to be more robust. This patch makes it return NULL
whenever the config argument is NULL.
Signed-off-by: Alan Stern
Reported-by: syzbot+19c3aaef85a89d451eac@syzkaller.appspotmail.com
CC:
Signed-off-by: Greg Kroah-Hartman
commit f3a6a40b3793168f1f342aa7f2d97c82c97f24b6
Author: Alan Stern
Date: Mon Sep 10 13:59:59 2018 -0400
USB: fix error handling in usb\_driver\_claim\_interface()
commit bd729f9d67aa9a303d8925bb8c4f06af25f407d1 upstream.
The syzbot fuzzing project found a use-after-free bug in the USB
core. The bug was caused by usbfs not unbinding from an interface
when the USB device file was closed, which led another process to
attempt the unbind later on, after the private data structure had been
deallocated.
The reason usbfs did not unbind the interface at the appropriate time
was because it thought the interface had never been claimed in the
first place. This was caused by the fact that
usb\_driver\_claim\_interface() does not clean up properly when
device\_bind\_driver() returns an error. Although the error code gets
passed back to the caller, the iface->dev.driver pointer remains set
and iface->condition remains equal to USB\_INTERFACE\_BOUND.
This patch adds proper error handling to usb\_driver\_claim\_interface().
Signed-off-by: Alan Stern
Reported-by: syzbot+f84aa7209ccec829536f@syzkaller.appspotmail.com
CC:
Signed-off-by: Greg Kroah-Hartman
commit 2c2860d0e8764e07c3016742eed8cb059c78d224
Author: Marek Szyprowski
Date: Mon Sep 3 16:49:37 2018 +0200
regulator: Fix 'do-nothing' value for regulators without suspend state
commit 3edd79cf5a44b12dbb13bc320f5788aed6562b36 upstream.
Some regulators don't have all states defined and in such cases regulator
core should not assume anything. However in current implementation
of of\_get\_regulation\_constraints() DO\_NOTHING\_IN\_SUSPEND enable value was
set only for regulators which had suspend node defined, otherwise the
default 0 value was used, what means DISABLE\_IN\_SUSPEND. This lead to
broken system suspend/resume on boards, which had simple regulator
constraints definition (without suspend state nodes).
To avoid further mismatches between the default and uninitialized values
of the suspend enabled/disabled states, change the values of the them,
so default '0' means DO\_NOTHING\_IN\_SUSPEND.
Fixes: 72069f9957a1: regulator: leave one item to record whether regulator is enabled
Signed-off-by: Marek Szyprowski
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit ad023c0c3613e517d21ad95b6f8572503db6e3bd
Author: Yu Zhao
Date: Wed Sep 19 15:30:51 2018 -0600
regulator: fix crash caused by null driver data
commit fb6de923ca3358a91525552b4907d4cb38730bdd upstream.
dev\_set\_drvdata() needs to be called before device\_register()
exposes device to userspace. Otherwise kernel crashes after it
gets null pointer from dev\_get\_drvdata() when userspace tries
to access sysfs entries.
[Removed backtrace for length -- broonie]
Signed-off-by: Yu Zhao
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit bc9f63756ac87d767abe3ff040e6f937a95da9d0
Author: Geert Uytterhoeven
Date: Wed Sep 5 10:49:39 2018 +0200
spi: rspi: Fix interrupted DMA transfers
commit 8dbbaa47b96f6ea5f09f922b4effff3c505cd8cf upstream.
When interrupted, wait\_event\_interruptible\_timeout() returns
-ERESTARTSYS, and the SPI transfer in progress will fail, as expected:
m25p80 spi0.0: SPI transfer failed: -512
spi\_master spi0: failed to transfer one message from queue
However, as the underlying DMA transfers may not have completed, all
subsequent SPI transfers may start to fail:
spi\_master spi0: receive timeout
qspi\_transfer\_out\_in() returned -110
m25p80 spi0.0: SPI transfer failed: -110
spi\_master spi0: failed to transfer one message from queue
Fix this by calling dmaengine\_terminate\_all() not only for timeouts, but
also for errors.
This can be reproduced on r8a7991/koelsch, using "hd /dev/mtd0" followed
by CTRL-C.
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit f9ca5597ab702405fee8138a9be7108017d72828
Author: Geert Uytterhoeven
Date: Wed Sep 5 10:49:38 2018 +0200
spi: rspi: Fix invalid SPI use during system suspend
commit c1ca59c22c56930b377a665fdd1b43351887830b upstream.
If the SPI queue is running during system suspend, the system may lock
up.
Fix this by stopping/restarting the queue during system suspend/resume,
by calling spi\_master\_suspend()/spi\_master\_resume() from the PM
callbacks. In-kernel users will receive an -ESHUTDOWN error while
system suspend/resume is in progress.
Based on a patch for sh-msiof by Gaku Inami.
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 2469b01fa5143a88c632248283d9fee788ceceb2
Author: Hiromitsu Yamasaki
Date: Wed Sep 5 10:49:37 2018 +0200
spi: sh-msiof: Fix handling of write value for SISTR register
commit 31a5fae4c5a009898da6d177901d5328051641ff upstream.
This patch changes writing to the SISTR register according to the H/W
user's manual.
The TDREQ bit and RDREQ bits of SISTR are read-only, and must be written
their initial values of zero.
Signed-off-by: Hiromitsu Yamasaki
[geert: reword]
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 38274415d1180966c082c2db8cb0faabc626f8e6
Author: Gaku Inami
Date: Wed Sep 5 10:49:36 2018 +0200
spi: sh-msiof: Fix invalid SPI use during system suspend
commit ffa69d6a16f686efe45269342474e421f2aa58b2 upstream.
If the SPI queue is running during system suspend, the system may lock
up.
Fix this by stopping/restarting the queue during system suspend/resume
by calling spi\_master\_suspend()/spi\_master\_resume() from the PM
callbacks. In-kernel users will receive an -ESHUTDOWN error while
system suspend/resume is in progress.
Signed-off-by: Gaku Inami
Signed-off-by: Hiromitsu Yamasaki
[geert: Cleanup, reword]
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit a2b9280113522c7a7608c02933bc66da3e87da84
Author: Marcel Ziswiler
Date: Wed Aug 29 08:47:57 2018 +0200
spi: tegra20-slink: explicitly enable/disable clock
commit 7001cab1dabc0b72b2b672ef58a90ab64f5e2343 upstream.
Depending on the SPI instance one may get an interrupt storm upon
requesting resp. interrupt unless the clock is explicitly enabled
beforehand. This has been observed trying to bring up instance 4 on
T20.
Signed-off-by: Marcel Ziswiler
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 825e12a2ed63cb166648a03d0a83f15e8ebc2760
Author: Alexander Shishkin
Date: Tue Sep 18 16:10:48 2018 +0300
intel\_th: Fix resource handling for ACPI glue layer
commit ebe4582281d6e90972f057318a6edea14810ea48 upstream.
The core of the driver expects the resource array from the glue layer
to be indexed by even numbers, as is the case for 64-bit PCI resources.
This doesn't hold true for others, ACPI in this instance, which leads
to an out-of-bounds access and an ioremap() on whatever address that
access fetches.
This patch fixes the problem by reading resource array differently based
on whether the 64-bit flag is set, which would indicate PCI glue layer.
Signed-off-by: Alexander Shishkin
Fixes: ebc57e399b8e ("intel\_th: Add ACPI glue layer")
CC: stable@vger.kernel.org # v4.17+
Signed-off-by: Greg Kroah-Hartman
commit c3b92e93b23a1b6fed026acc39a8fef715bb9e4e
Author: Alexander Shishkin
Date: Tue Sep 18 16:10:47 2018 +0300
intel\_th: Fix device removal logic
commit 8801922cd94c918e4dc3a108ecaa500c4d40583f upstream.
Commit a753bfcfdb1f ("intel\_th: Make the switch allocate its subdevices")
brings in new subdevice addition/removal logic that's broken for "host
mode": the SWITCH device has no children to begin with, which is not
handled in the code. This results in a null dereference bug later down
the path.
This patch fixes the subdevice removal code to handle host mode correctly.
Signed-off-by: Alexander Shishkin
Fixes: a753bfcfdb1f ("intel\_th: Make the switch allocate its subdevices")
CC: stable@vger.kernel.org # v4.14+
Signed-off-by: Greg Kroah-Hartman
commit 98e1a83c338e4f3377c842ee7d60a5c36a30f0b3
Author: Christophe Leroy
Date: Fri Sep 14 10:32:50 2018 +0000
serial: cpm\_uart: return immediately from console poll
commit be28c1e3ca29887e207f0cbcd294cefe5074bab6 upstream.
kgdb expects poll function to return immediately and
returning NO\_POLL\_CHAR when no character is available.
Fixes: f5316b4aea024 ("kgdb,8250,pl011: Return immediately from console poll")
Cc: Jason Wessel
Cc:
Signed-off-by: Christophe Leroy
Signed-off-by: Greg Kroah-Hartman
commit e91bf9073b44f3be71b80687a58e8fc1e8d25dd1
Author: Jan Kiszka
Date: Sun Aug 26 19:49:32 2018 +0200
serial: mvebu-uart: Fix reporting of effective CSIZE to userspace
commit e0bf2d4982fe7d9ddaf550dd023803ea286f47fc upstream.
Apparently, this driver (or the hardware) does not support character
length settings. It's apparently running in 8-bit mode, but it makes
userspace believe it's in 5-bit mode. That makes tcsetattr with CS8
incorrectly fail, breaking e.g. getty from busybox, thus the login shell
on ttyMVx.
Fix by hard-wiring CS8 into c\_cflag.
Signed-off-by: Jan Kiszka
Fixes: 30530791a7a0 ("serial: mvebu-uart: initial support for Armada-3700 serial port")
Cc: stable  # 4.6+
Signed-off-by: Greg Kroah-Hartman
commit 5d554763aaac8009646301fd14b05607ec01d965
Author: Uwe Kleine-König
Date: Thu Sep 20 14:11:17 2018 +0200
serial: imx: restore handshaking irq for imx1
commit 7e620984b62532783912312e334f3c48cdacbd5d upstream.
Back in 2015 when irda was dropped from the driver imx1 was broken. This
change reintroduces the support for the third interrupt of the UART.
Fixes: afe9cbb1a6ad ("serial: imx: drop support for IRDA")
Cc: stable
Signed-off-by: Uwe Kleine-König
Reviewed-by: Leonard Crestez
Signed-off-by: Greg Kroah-Hartman
commit 98ecfdf49ff73c87a5ab8fa7ba1f22db67da6f29
Author: Stefan Agner
Date: Tue Aug 28 12:44:24 2018 +0200
tty: serial: lpuart: avoid leaking struct tty\_struct
commit 3216c622a24b0ebb9c159a8d1daf7f17a106b3f5 upstream.
The function tty\_port\_tty\_get() gets a reference to the tty. Since
the code is not using tty\_port\_tty\_set(), the reference is kept
even after closing the tty.
Avoid using tty\_port\_tty\_get() by directly access the tty instance.
Since lpuart\_start\_rx\_dma() is called from the .startup() and
.set\_termios() callback, it is safe to assume the tty instance is
valid.
Cc: stable@vger.kernel.org # v4.9+
Fixes: 5887ad43ee02 ("tty: serial: fsl\_lpuart: Use cyclic DMA for Rx")
Signed-off-by: Stefan Agner
Signed-off-by: Greg Kroah-Hartman
commit fdbbdfeeb699535138be3274c615233c1af42aac
Author: Feng Tang
Date: Thu Sep 20 10:58:28 2018 +0800
x86/mm: Expand static page table for fixmap space
commit 05ab1d8a4b36ee912b7087c6da127439ed0a903e upstream.
We met a kernel panic when enabling earlycon, which is due to the fixmap
address of earlycon is not statically setup.
Currently the static fixmap setup in head\_64.S only covers 2M virtual
address space, while it actually could be in 4M space with different
kernel configurations, e.g. when VSYSCALL emulation is disabled.
So increase the static space to 4M for now by defining FIXMAP\_PMD\_NUM to 2,
and add a build time check to ensure that the fixmap is covered by the
initial static page tables.
Fixes: 1ad83c858c7d ("x86\_64,vsyscall: Make vsyscall emulation configurable")
Suggested-by: Thomas Gleixner
Signed-off-by: Feng Tang
Signed-off-by: Thomas Gleixner
Tested-by: kernel test robot
Reviewed-by: Juergen Gross  (Xen parts)
Cc: H Peter Anvin
Cc: Peter Zijlstra
Cc: Michal Hocko
Cc: Yinghai Lu
Cc: Dave Hansen
Cc: Andi Kleen
Cc: Andy Lutomirsky
Cc: stable@vger.kernel.org
Link: https://lkml.kernel.org/r/20180920025828.23699-1-feng.tang@intel.com
Signed-off-by: Greg Kroah-Hartman
commit 41a770d90b88f1aec1796f931973a6a3ba368234
Author: Damien Le Moal
Date: Thu Sep 27 10:55:13 2018 +0900
block: fix deadline elevator drain for zoned block devices
commit 854f31ccdd7964c9c2e68da234a3a8aedb51cf6b upstream.
When the deadline scheduler is used with a zoned block device, writes
to a zone will be dispatched one at a time. This causes the warning
message:
deadline: forced dispatching is broken (nr\_sorted=X), please report this
to be displayed when switching to another elevator with the legacy I/O
path while write requests to a zone are being retained in the scheduler
queue.
Prevent this message from being displayed when executing
elv\_drain\_elevator() for a zoned block device. \_\_blk\_drain\_queue() will
loop until all writes are dispatched and completed, resulting in the
desired elevator queue drain without extensive modifications to the
deadline code itself to handle forced-dispatch calls.
Signed-off-by: Damien Le Moal
Fixes: 8dc8146f9c92 ("deadline-iosched: Introduce zone locking support")
Cc: stable@vger.kernel.org
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 0051646c2cc2fbb9ff134a80775c0dc23baa7d35
Author: Andy Whitcroft
Date: Thu Sep 20 09:09:48 2018 -0600
floppy: Do not copy a kernel pointer to user memory in FDGETPRM ioctl
commit 65eea8edc315589d6c993cf12dbb5d0e9ef1fe4e upstream.
The final field of a floppy\_struct is the field "name", which is a pointer
to a string in kernel memory. The kernel pointer should not be copied to
user memory. The FDGETPRM ioctl copies a floppy\_struct to user memory,
including this "name" field. This pointer cannot be used by the user
and it will leak a kernel address to user-space, which will reveal the
location of kernel code and data and undermine KASLR protection.
Model this code after the compat ioctl which copies the returned data
to a previously cleared temporary structure on the stack (excluding the
name pointer) and copy out to userspace from there. As we already have
an inparam union with an appropriate member and that memory is already
cleared even for read only calls make use of that as a temporary store.
Based on an initial patch by Brian Belleville.
CVE-2018-7755
Signed-off-by: Andy Whitcroft
Broke up long line.
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit acee207b7cc92b3f057086e1df972b3020caa54a
Author: Dmitry Osipenko
Date: Tue Jul 17 19:10:38 2018 +0300
gpio: tegra: Fix tegra\_gpio\_irq\_set\_type()
[ Upstream commit f78709a5d4114edc21a5d86586ed5e56e284f2bd ]
Commit 36b312792b97 ("gpiolib: Respect error code of ->get\_direction()")
broke tegra\_gpio\_irq\_set\_type() because requesting of GPIO direction must
be done after enabling GPIO function for a pin.
This patch fixes drivers probe failure like this:
gpio gpiochip0: (tegra-gpio): gpiochip\_lock\_as\_irq: cannot get GPIO direction
tegra-gpio 6000d000.gpio: unable to lock Tegra GPIO 144 as IRQ
Fixes: 36b312792b97 ("gpiolib: Respect error code of ->get\_direction()")
Signed-off-by: Dmitry Osipenko
Acked-by: Jon Hunter
Tested-by: Jon Hunter
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit dbb2a1e3bb371c9e757a47e68045513599409c83
Author: Sandipan Das
Date: Thu Jul 26 22:47:33 2018 +0530
perf tests: Fix indexing when invoking subtests
[ Upstream commit aa90f9f9554616d5738f7bedb4a8f0e5e14d1bc6 ]
Recently, the subtest numbering was changed to start from 1. While it
is fine for displaying results, this should not be the case when the
subtests are actually invoked.
Typically, the subtests are stored in zero-indexed arrays and invoked
based on the index passed to the main test function. Since the index
now starts from 1, the second subtest in the array (index 1) gets
invoked instead of the first (index 0). This applies to all of the
following subtests but for the last one, the subtest always fails
because it does not meet the boundary condition of the subtest index
being lesser than the number of subtests.
This can be observed on powerpc64 and x86\_64 systems running Fedora 28
as shown below.
Before:
# perf test "builtin clang support"
55: builtin clang support :
55.1: builtin clang compile C source to IR : Ok
55.2: builtin clang compile C source to ELF object : FAILED!
# perf test "LLVM search and compile"
38: LLVM search and compile :
38.1: Basic BPF llvm compile : Ok
38.2: kbuild searching : Ok
38.3: Compile source for BPF prologue generation : Ok
38.4: Compile source for BPF relocation : FAILED!
# perf test "BPF filter"
40: BPF filter :
40.1: Basic BPF filtering : Ok
40.2: BPF pinning : Ok
40.3: BPF prologue generation : Ok
40.4: BPF relocation checker : FAILED!
After:
# perf test "builtin clang support"
55: builtin clang support :
55.1: builtin clang compile C source to IR : Ok
55.2: builtin clang compile C source to ELF object : Ok
# perf test "LLVM search and compile"
38: LLVM search and compile :
38.1: Basic BPF llvm compile : Ok
38.2: kbuild searching : Ok
38.3: Compile source for BPF prologue generation : Ok
38.4: Compile source for BPF relocation : Ok
# perf test "BPF filter"
40: BPF filter :
40.1: Basic BPF filtering : Ok
40.2: BPF pinning : Ok
40.3: BPF prologue generation : Ok
40.4: BPF relocation checker : Ok
Signed-off-by: Sandipan Das
Reported-by: Arnaldo Carvalho de Melo
Tested-by: Arnaldo Carvalho de Melo
Cc: Heiko Carstens
Cc: Hendrik Brueckner
Cc: Jiri Olsa
Cc: Martin Schwidefsky
Cc: Naveen N. Rao
Cc: Ravi Bangoria
Cc: Thomas Richter
Fixes: 9ef0112442bd ("perf test: Fix subtest number when showing results")
Link: http://lkml.kernel.org/r/20180726171733.33208-1-sandipan@linux.ibm.com
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6b07342e25961dbd483671c130cc85603462806a
Author: Maxime Ripard
Date: Thu May 17 15:37:59 2018 +0200
drm/vc4: plane: Expand the lower bits by repeating the higher bits
[ Upstream commit 3257ec797d3a8c5232389eb1952d4451e80f3931 ]
The vc4 HVS uses an internal RGB888 representation of the frames, and will
by default expand formats using a lower depth using zeros.
This causes an issue when we try to use other compositing software such as
pixman that fill the missing bits by repeating the higher significant bits.
As such, we can't check the display output in a reliable way by doing a
software composition and an hardware one and compare both.
To prevent this, force the same behaviour so that we can do such things.
Signed-off-by: Maxime Ripard
Signed-off-by: Eric Anholt
Link: https://patchwork.freedesktop.org/patch/msgid/20180517133759.25626-1-maxime.ripard@bootlin.com
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c94ce4bf1aff06fef71b83000255920018824f17
Author: Kevin Hilman
Date: Mon May 21 13:08:32 2018 -0700
ARM: dts: dra7: fix DCAN node addresses
[ Upstream commit 949bdcc8a97c6078f21c8d4966436b117f2e4cd3 ]
Fix the DT node addresses to match the reg property addresses,
which were verified to match the TRM:
http://www.ti.com/lit/pdf/sprui30
Cc: Roger Quadros
Signed-off-by: Kevin Hilman
Acked-by: Roger Quadros
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e80225d36dca7c1897dc3b6107ee9ee87fafc9a4
Author: Eric Anholt
Date: Fri Mar 16 15:04:34 2018 -0700
drm/vc4: Add missing formats to vc4\_format\_mod\_supported().
[ Upstream commit 1e871d65e375280757833d9fce91dda71980bdf5 ]
Daniel's format\_mod\_supported() patch predated Dave's for NV21/61, and
I didn't catch that when rebasing. This is a problem since the
formats are now getting validated before being passed to the driver's
atomic hooks.
Signed-off-by: Eric Anholt
Acked-by: Daniel Stone
Cc: Dave Stevenson
Fixes: 423ad7b3cbd1 ("drm/vc4: Advertise supported modifiers for planes")
Link: https://patchwork.freedesktop.org/patch/msgid/20180316220435.31416-2-eric@anholt.net
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 70b914929ad741cc27c0236819ca0d36badcb1fe
Author: William Breathitt Gray
Date: Thu May 24 16:37:46 2018 -0400
iio: 104-quad-8: Fix off-by-one error in register selection
[ Upstream commit 2873c3f0e2bd12a7612e905c920c058855f4072a ]
The reset flags operation is selected by bit 2 in the "Reset and Load
Signals Decoders" register, not bit 1.
Fixes: 28e5d3bb0325 ("iio: 104-quad-8: Add IIO support for the ACCES 104-QUAD-8")
Signed-off-by: William Breathitt Gray
Signed-off-by: Jonathan Cameron
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit b6b75c81c31abf2353829e1c68c9157baab60657
Author: Oleksandr Andrushchenko
Date: Tue Jun 12 15:03:36 2018 -0700
Input: xen-kbdfront - fix multi-touch XenStore node's locations
[ Upstream commit ce6f7d087e2b037f47349c1c36ac97678d02e394 ]
kbdif protocol describes multi-touch device parameters as a
part of frontend's XenBus configuration nodes while they
belong to backend's configuration. Fix this by reading the
parameters as defined by the protocol.
Fixes: 49aac8204da5 ("Input: xen-kbdfront - add multi-touch support")
Signed-off-by: Oleksandr Andrushchenko
Reviewed-by: Juergen Gross
Signed-off-by: Dmitry Torokhov
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 31a92226a5d59a8538de9fd9a804a75a7ec1d3bd
Author: Colin Ian King
Date: Sun May 27 22:17:02 2018 +0100
ath10k: fix memory leak of tpc\_stats
[ Upstream commit 260e629bbf441585860e21d5e10d2e88437f47c8 ]
Currently tpc\_stats is allocated and is leaked on the return
path if num\_tx\_chain is greater than WMI\_TPC\_TX\_N\_CHAIN. Avoid
this leak by performing the check on num\_tx\_chain before the
allocation of tpc\_stats.
Detected by CoverityScan, CID#1469422 ("Resource Leak")
Fixes: 4b190675ad06 ("ath10k: fix kernel panic while reading tpc\_stats")
Signed-off-by: Colin Ian King
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 5f2391032c06f71ced9b6cf15226368c50b8a99c
Author: Konstantin Khorenko
Date: Fri Jun 8 17:27:11 2018 +0300
fs/lock: skip lock owner pid translation in case we are in init\_pid\_ns
[ Upstream commit 826d7bc9f013d01e92997883d2fd0c25f4af1f1c ]
If the flock owner process is dead and its pid has been already freed,
pid translation won't work, but we still want to show flock owner pid
number when expecting /proc/$PID/fdinfo/$FD in init pidns.
Reproducer:
process A process A1 process A2
fork()--------->
exit() open()
flock()
fork()--------->
exit() sleep()
Before the patch:
================
(root@vz7)/: cat /proc/${PID\_A2}/fdinfo/3
pos: 4
flags: 02100002
mnt\_id: 257
lock: (root@vz7)/:
After the patch:
===============
(root@vz7)/:cat /proc/${PID\_A2}/fdinfo/3
pos: 4
flags: 02100002
mnt\_id: 295
lock: 1: FLOCK ADVISORY WRITE ${PID\_A1} b6:f8a61:529946 0 EOF
Fixes: 9d5b86ac13c5 ("fs/locks: Remove fl\_nspid and use fs-specific l\_pid for remote locks")
Signed-off-by: Konstantin Khorenko
Acked-by: Andrey Vagin
Reviewed-by: Benjamin Coddington
Signed-off-by: Jeff Layton
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 00b438869cbe414d9a92419dcf702a0a74b679c5
Author: Brian Norris
Date: Mon Jun 11 14:09:43 2018 -0700
ath10k: snoc: use correct bus-specific pointer in RX retry
[ Upstream commit 426a0f0b5a2fe1df3496ba299ee3521159dba302 ]
We're 'ath10k\_snoc', not 'ath10k\_pci'. This probably means we're
accessing junk data in ath10k\_snoc\_rx\_replenish\_retry(), unless
'ath10k\_snoc' and 'ath10k\_pci' happen to have very similar struct
layouts.
Noticed by inspection.
Fixes: d915105231ca ("ath10k: add hif rx methods for wcn3990")
Signed-off-by: Brian Norris
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 06c21f7423e7eabbe85dd18d4de8e9f6bc69400d
Author: YueHaibing
Date: Fri Jun 1 19:25:48 2018 +0800
ath10k: fix incorrect size of dma\_free\_coherent in ath10k\_ce\_alloc\_src\_ring\_64
[ Upstream commit 5a211627004e2cddd0ab8b9df19e5fb0bbe97634 ]
sizeof(struct ce\_desc) should be a copy-paste mistake
just use sizeof(struct ce\_desc\_64) to avoid mem leak
Fixes: b7ba83f7c414 ("ath10k: add support for shadow register for WNC3990")
Signed-off-by: YueHaibing
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 10db0e22fb8c50db736e5294af33fae43e950fe6
Author: Hugo Lefeuvre
Date: Wed Jun 13 21:04:38 2018 -0400
staging: pi433: fix race condition in pi433\_ioctl
[ Upstream commit 6de4ef65a8c6f53ce7eef06666410bc3b6e4b624 ]
In the PI433\_IOC\_WR\_TX\_CFG case in pi433\_ioctl, instance->tx\_cfg is
modified via
copy\_from\_user(&instance->tx\_cfg, argp, sizeof(struct pi433\_tx\_cfg)))
without any kind of synchronization. In the case where two threads
would execute this same command concurrently the tx\_cfg field might
enter in an inconsistent state.
Additionally: if ioctl(PI433\_IOC\_WR\_TX\_CFG) and write() execute
concurrently the tx config might be modified while it is being
copied to the fifo, resulting in potential data corruption.
Fix: Get instance->tx\_cfg\_lock before modifying tx config in the
PI433\_IOC\_WR\_TX\_CFG case in pi433\_ioctl.
Also, do not copy data directly from user space to instance->tx\_cfg.
Instead use a temporary buffer allowing future checks for correctness
of copied data and simpler code.
Signed-off-by: Hugo Lefeuvre
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit fff64d9fb3817fee88ce211bd4fef94558d877be
Author: Christophe JAILLET
Date: Sun Jun 10 19:45:32 2018 +0200
EDAC, altera: Fix an error handling path in altr\_s10\_sdram\_probe()
[ Upstream commit 9d72fe1ce81bc757ecb6d57b58e5fd95b9ad1b26 ]
If regmap\_write() fails, we should release some resources as done in all
the other error handling paths of the function.
Signed-off-by: Christophe JAILLET
Reviewed-by: Thor Thayer
Cc: linux-edac
Link: http://lkml.kernel.org/r/20180610174532.22071-1-christophe.jaillet@wanadoo.fr
Fixes: e9918d7fafae ("EDAC, altera: Handle SDRAM Uncorrectable Errors on Stratix10")
Signed-off-by: Borislav Petkov
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0855e6e1ac14f7e7f742e70bf9bbc6a1cdf0769e
Author: Johan Hovold
Date: Tue Jun 12 14:43:34 2018 +0200
EDAC: Fix memleak in module init error path
[ Upstream commit 4708aa85d50cc6e962dfa8acf5ad4e0d290a21db ]
Make sure to use put\_device() to free the initialised struct device so
that resources managed by driver core also gets released in the event of
a registration failure.
Signed-off-by: Johan Hovold
Cc: Denis Kirjanov
Cc: Mauro Carvalho Chehab
Cc: linux-edac
Fixes: 2d56b109e3a5 ("EDAC: Handle error path in edac\_mc\_sysfs\_init() properly")
Link: http://lkml.kernel.org/r/20180612124335.6420-1-johan@kernel.org
Signed-off-by: Borislav Petkov
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6e67b33dbe432215868bbfb57dfff90d18347409
Author: J. Bruce Fields
Date: Wed Jun 13 15:21:35 2018 -0400
nfsd: fix corrupted reply to badly ordered compound
[ Upstream commit 5b7b15aee641904ae269be9846610a3950cbd64c ]
We're encoding a single op in the reply but leaving the number of ops
zero, so the reply makes no sense.
Somewhat academic as this isn't a case any real client will hit, though
in theory perhaps that could change in a future protocol extension.
Reviewed-by: Jeff Layton
Signed-off-by: J. Bruce Fields
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit af4b12c54b3be0d46bffdba1debb811270784110
Author: Nadav Amit
Date: Mon Jun 4 06:58:14 2018 -0700
gpio: Fix wrong rounding in gpio-menz127
[ Upstream commit 7279d9917560bbd0d82813d6bf00490a82c06783 ]
men\_z127\_debounce() tries to round up and down, but uses functions which
are only suitable when the divider is a power of two, which is not the
case. Use the appropriate ones.
Found by static check. Compile tested.
Fixes: f436bc2726c64 ("gpio: add driver for MEN 16Z127 GPIO controller")
Signed-off-by: Nadav Amit
Signed-off-by: Linus Walleij
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8463cd689be0bf1d27a34ef00a8ffe63c1d89c02
Author: Jessica Yu
Date: Tue Jun 5 10:22:52 2018 +0200
module: exclude SHN\_UNDEF symbols from kallsyms api
[ Upstream commit 9f2d1e68cf4d641def734adaccfc3823d3575e6c ]
Livepatch modules are special in that we preserve their entire symbol
tables in order to be able to apply relocations after module load. The
unwanted side effect of this is that undefined (SHN\_UNDEF) symbols of
livepatch modules are accessible via the kallsyms api and this can
confuse symbol resolution in livepatch (klp\_find\_object\_symbol()) and
cause subtle bugs in livepatch.
Have the module kallsyms api skip over SHN\_UNDEF symbols. These symbols
are usually not available for normal modules anyway as we cut down their
symbol tables to just the core (non-undefined) symbols, so this should
really just affect livepatch modules. Note that this patch doesn't
affect the display of undefined symbols in /proc/kallsyms.
Reported-by: Josh Poimboeuf
Tested-by: Josh Poimboeuf
Reviewed-by: Josh Poimboeuf
Signed-off-by: Jessica Yu
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 163ac07ff0b29ba45e1e0dd39fe520adee472118
Author: Liam Girdwood
Date: Thu Jun 14 20:26:42 2018 +0100
ASoC: dapm: Fix potential DAI widget pointer deref when linking DAIs
[ Upstream commit e01b4f624278d5efe5fb5da585ca371947b16680 ]
Sometime a component or topology may configure a DAI widget with no
private data leading to a dev\_dbg() dereferencne of this data.
Fix this to check for non NULL private data and let users know if widget
is missing DAI.
Signed-off-by: Liam Girdwood
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 2edaabf0e58dda612c5096bf925749dd10681e4a
Author: Johan Hovold
Date: Tue Jun 12 14:43:35 2018 +0200
EDAC, i7core: Fix memleaks and use-after-free on probe and remove
[ Upstream commit 6c974d4dfafe5e9ee754f2a6fba0eb1864f1649e ]
Make sure to free and deregister the addrmatch and chancounts devices
allocated during probe in all error paths. Also fix use-after-free in a
probe error path and in the remove success path where the devices were
being put before before deregistration.
Signed-off-by: Johan Hovold
Cc: Mauro Carvalho Chehab
Cc: linux-edac
Fixes: 356f0a30860d ("i7core\_edac: change the mem allocation scheme to make Documentation/kobject.txt happy")
Link: http://lkml.kernel.org/r/20180612124335.6420-2-johan@kernel.org
Signed-off-by: Borislav Petkov
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1e4b176959fb817a3bbf6bc74310ba4a13ef39ae
Author: Kuninori Morimoto
Date: Tue Jun 12 05:52:17 2018 +0000
ASoC: rsnd: SSI parent cares SWSP bit
[ Upstream commit 203cdf51f28820bee7893b4be392847418e6f4ec ]
SSICR has SWSP bit (= Serial WS Polarity) which decides WS pin 1st
channel polarity (low or hi). This bit shouldn't exchange after running.
Current SSI "parent" doesn't care SSICR, just controls clock only.
Because of this behavior, if platform uses SSI0 as playback,
SSI1 as capture, and if user starts capture -> playback order,
SSI0 SSICR::SWSP bit exchanged 0 -> 1 during captureing, and it makes
capture noise.
This patch cares SSICR on SSI parent, too.
Special thanks to Yokoyama-san
Reported-by: Hiroyuki Yokoyama
Signed-off-by: Kuninori Morimoto
Tested-by: Hiroyuki Yokoyama
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8d07efbdf84f47b935c8bb4e5998050375295764
Author: Geert Uytterhoeven
Date: Thu Jun 7 15:50:48 2018 +0200
ASoC: rt1305: Use ULL suffixes for 64-bit constants
[ Upstream commit 4f29b663c08d369fe320a148179996c94cf7d01b ]
With gcc 4.1.2:
sound/soc/codecs/rt1305.c: In function ‘rt1305\_calibrate’:
sound/soc/codecs/rt1305.c:1069: warning: integer constant is too large for ‘long’ type
sound/soc/codecs/rt1305.c:1086: warning: integer constant is too large for ‘long’ type
Add the missing "ULL" suffixes to fix this.
Fixes: 29bc643ddd7efb74 ("ASoC: rt1305: Add RT1305/RT1306 amplifier driver")
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3e28a96b87f64bc4cbb3a254793fa609df7f2bcc
Author: Hans de Goede
Date: Sun Jun 3 15:42:32 2018 +0200
ASoC: Intel: bytcr\_rt5640: Fix Acer Iconia 8 over-current detect threshold
[ Upstream commit f12a0a3c4cc6f594d7c2ea361f2396ae5c518d2c ]
Change the over-current detect threshold on the Acer Iconia 8 from
2000ua to 1500uA, this fixes headset button presses not being detected.
Signed-off-by: Hans de Goede
Acked-by: Pierre-Louis Bossart
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ebce61bb2c864c0c16bd86502e1259be385b0139
Author: Shivasharan S
Date: Mon Jun 4 03:45:10 2018 -0700
scsi: megaraid\_sas: Update controller info during resume
[ Upstream commit c3b10a55abc943a526aaecd7e860b15671beb906 ]
There is a possibility that firmware on the controller was upgraded before
system was suspended. During resume, driver needs to read updated
controller properties.
Signed-off-by: Shivasharan S
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit b38977a366258758245d2e335ddc4735bbfb445c
Author: Jan Kundrát
Date: Mon Jun 4 16:34:25 2018 +0200
spi: orion: fix CS GPIO handling again
[ Upstream commit fb9acf5f1f21f1de193523ff780bda375b4c2e21 ]
The code did not de-assert any CS GPIOs before probing slaves. This
means that several CS signals could be active at once, garbling the
communication. Whether this was actually a problem depended on the type
of the SPI device attached (so my "spidev" for userspace access worked
correctly because its probe was effectively a no-op), and on the state
of the GPIO pins at SoC's boot.
The code was already iterating through all DT children of the SPI
controller, so this change re-uses that loop for CS GPIO setup as well.
This means that this might change the number of the HW CS signal which
is picked for all GPIO CS devices. Previously, the lowest one was used,
but we now use the first one from the DT.
With this move of the code, we can also finally initialize each GPIO CS
lane before registering the SPI controller (which in turn probes for
slaves).
I tried to fix this in 544248623b95 already, but that only did it half
way by registering the GPIOs properly. That patch failed to set their
logic signals early enough, though.
Signed-off-by: Jan Kundrát
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d731684c4496963824fecff6f1227738bff7b165
Author: Xiaofei Tan
Date: Thu May 31 20:50:44 2018 +0800
scsi: hisi\_sas: Fix the conflict between dev gone and host reset
[ Upstream commit d2fc401e47529d9ffd2673a5395d56002e31ad98 ]
There is a possible conflict when a device is removed and host reset occurs
concurrently.
The reason is that then the device is notified as gone, we try to clear the
ITCT, which is notified via an interrupt. The dev gone function pends on
this event with a completion, which is completed when the ITCT interrupt
occurs.
But host reset will disable all interrupts, the wait\_for\_completion() may
wait indefinitely.
This patch adds an semaphore to synchronise this two processes. The
semaphore is taken by the host reset as the basis of synchronising.
Signed-off-by: Xiaofei Tan
Signed-off-by: John Garry
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 2f7b94ebaa193a08544809c2eef011137e5700c3
Author: Andreas Gruenbacher
Date: Tue Jun 19 15:10:55 2018 -0700
iomap: complete partial direct I/O writes synchronously
[ Upstream commit ebf00be37de35788cad72f4f20b4a39e30c0be4a ]
According to xfstest generic/240, applications seem to expect direct I/O
writes to either complete as a whole or to fail; short direct I/O writes
are apparently not appreciated. This means that when only part of an
asynchronous direct I/O write succeeds, we can either fail the entire
write, or we can wait for the partial write to complete and retry the
remaining write as buffered I/O. The old \_\_blockdev\_direct\_IO helper
has code for waiting for partial writes to complete; the new
iomap\_dio\_rw iomap helper does not.
The above mentioned fallback mode is needed for gfs2, which doesn't
allow block allocations under direct I/O to avoid taking cluster-wide
exclusive locks. As a consequence, an asynchronous direct I/O write to
a file range that contains a hole will result in a short write. In that
case, wait for the short write to complete to allow gfs2 to recover.
Signed-off-by: Andreas Gruenbacher
Signed-off-by: Christoph Hellwig
Reviewed-by: Darrick J. Wong
Signed-off-by: Darrick J. Wong
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 939dd916dc25cb110c798fd427d39ade5b40b1ca
Author: Zhouyang Jia
Date: Tue Jun 12 11:13:00 2018 +0800
scsi: bnx2i: add error handling for ioremap\_nocache
[ Upstream commit aa154ea885eb0c2407457ce9c1538d78c95456fa ]
When ioremap\_nocache fails, the lack of error-handling code may cause
unexpected results.
This patch adds error-handling code after calling ioremap\_nocache.
Signed-off-by: Zhouyang Jia
Reviewed-by: Johannes Thumshirn
Acked-by: Manish Rangankar
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 074e4687846ed41ec2c9d0b34ebb0632961f75d2
Author: Kan Liang
Date: Tue Jun 5 08:38:45 2018 -0700
perf/x86/intel/lbr: Fix incomplete LBR call stack
[ Upstream commit 0592e57b24e7e05ec1f4c50b9666c013abff7017 ]
LBR has a limited stack size. If a task has a deeper call stack than
LBR's stack size, only the overflowed part is reported. A complete call
stack may not be reconstructed by perf tool.
Current code doesn't access all LBR registers. It only read the ones
below the TOS. The LBR registers above the TOS will be discarded
unconditionally.
When a CALL is captured, the TOS is incremented by 1 , modulo max LBR
stack size. The LBR HW only records the call stack information to the
register which the TOS points to. It will not touch other LBR
registers. So the registers above the TOS probably still store the valid
call stack information for an overflowed call stack, which need to be
reported.
To retrieve complete call stack information, we need to start from TOS,
read all LBR registers until an invalid entry is detected.
0s can be used to detect the invalid entry, because:
- When a RET is captured, the HW zeros the LBR register which TOS points
to, then decreases the TOS.
- The LBR registers are reset to 0 when adding a new LBR event or
scheduling an existing LBR event.
- A taken branch at IP 0 is not expected
The context switch code is also modified to save/restore all valid LBR
registers. Furthermore, the LBR registers, which don't have valid call
stack information, need to be reset in restore, because they may be
polluted while swapped out.
Here is a small test program, tchain\_deep.
Its call stack is deeper than 32.
noinline void f33(void)
{
int i;
for (i = 0; i < 10000000;) {
if (i%2)
i++;
else
i++;
}
}
noinline void f32(void)
{
f33();
}
noinline void f31(void)
{
f32();
}
... ...
noinline void f1(void)
{
f2();
}
int main()
{
f1();
}
Here is the test result on SKX. The max stack size of SKX is 32.
Without the patch:
$ perf record -e cycles --call-graph lbr -- ./tchain\_deep
$ perf report --stdio
#
# Children Self Command Shared Object Symbol
# ........ ........ ........... ................ .................
#
100.00% 99.99% tchain\_deep tchain\_deep [.] f33
|
--99.99%--f30
f31
f32
f33
With the patch:
$ perf record -e cycles --call-graph lbr -- ./tchain\_deep
$ perf report --stdio
# Children Self Command Shared Object Symbol
# ........ ........ ........... ................ ..................
#
99.99% 0.00% tchain\_deep tchain\_deep [.] f1
|
---f1
f2
f3
f4
f5
f6
f7
f8
f9
f10
f11
f12
f13
f14
f15
f16
f17
f18
f19
f20
f21
f22
f23
f24
f25
f26
f27
f28
f29
f30
f31
f32
f33
Signed-off-by: Kan Liang
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Peter Zijlstra
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Stephane Eranian
Cc: Vince Weaver
Cc: Alexander Shishkin
Cc: Thomas Gleixner
Cc: acme@kernel.org
Cc: eranian@google.com
Link: https://lore.kernel.org/lkml/1528213126-4312-1-git-send-email-kan.liang@linux.intel.com
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 09468e65ec7db8d002102143ea0d94bc4e7f3786
Author: Eric Anholt
Date: Wed Jun 6 10:48:51 2018 -0700
drm/v3d: Take a lock across GPU scheduler job creation and queuing.
[ Upstream commit 7122b68b8a9692dcc3acf89595f04c492872115f ]
Between creation and queueing of a job, you need to prevent any other
job from being created and queued. Otherwise the scheduler's fences
may be signaled out of seqno order.
v2: move mutex unlock to the error label.
Signed-off-by: Eric Anholt
Fixes: 57692c94dcbe ("drm/v3d: Introduce a new DRM driver for Broadcom V3D V3.x+")
Link: https://patchwork.freedesktop.org/patch/msgid/20180606174851.12433-1-eric@anholt.net
Reviewed-by: Lucas Stach
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit dbdef3dff35bcdef02521d6ab1c9ace112f0417b
Author: Laurent Pinchart
Date: Fri Jun 8 15:21:15 2018 +0300
arm64: dts: renesas: Fix VSPD registers range
[ Upstream commit e21adc781bb45e810f1c396c4bc2c1624a4c25b9 ]
The VSPD and FCPVD nodes have overlapping register ranges, as the FCPVD
devices are mapped in the memory range usually used by the VSP LUT and
CLU, which are not present in the VSPD. Fix this by shortening the VSPD
registers range to 0x5000.
Fixes: 9f8573e38a0b ("arm64: dts: renesas: r8a7795: Add VSP instances")
Fixes: 291e0c4994d0 ("arm64: dts: r8a7795: Add support for R-Car H3 ES2.0")
Fixes: f06ffdfbdd90 ("arm64: dts: r8a7796: Add VSP instances")
Fixes: b4f92030d5d3 ("arm64: dts: renesas: r8a77970: add VSPD support")
Fixes: 295952a183d3 ("arm64: dts: renesas: r8a77995: add VSP instances")
Fixes: 85cb3229218a ("arm64: dts: renesas: r8a77965: Add VSP instances")
Reported-by: Simon Horman
Reported-by: Geert Uytterhoeven
Signed-off-by: Laurent Pinchart
Reviewed-by: Geert Uytterhoeven
Signed-off-by: Simon Horman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 56984081650a02cc326f9abecad027fc28279f00
Author: Masahiro Yamada
Date: Mon Apr 16 23:47:43 2018 +0900
MIPS: boot: fix build rule of vmlinux.its.S
[ Upstream commit 67e09db507db3e1642ddce512a4313d20addd6e5 ]
As Documentation/kbuild/makefile.txt says, it is a typical mistake
to forget the FORCE prerequisite for the rule invoked by if\_changed.
Add the FORCE to the prerequisite, but it must be filtered-out from
the files passed to the 'cat' command. Because this rule generates
.vmlinux.its.S.cmd, vmlinux.its.S must be specified as targets so
that the .cmd file is included.
Signed-off-by: Masahiro Yamada
Patchwork: https://patchwork.linux-mips.org/patch/19097/
Signed-off-by: Paul Burton
Cc: Kees Cook
Cc: linux-kernel@vger.kernel.org
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d0f7fbdb1cf98e37b3c61b503d41578517cede1c
Author: Stephen Boyd
Date: Thu Jun 21 19:27:16 2018 -0700
HID: i2c-hid: Use devm to allocate i2c\_hid struct
[ Upstream commit d6f83894110de247a81392ab7ef89e5498df7e80 ]
Use devm here to save some lines and prepare for bulk regulator usage in
this driver. Otherwise, when we devm bulk get regulators we'll free the
containing i2c\_hid structure and try to put regulator pointers from
freed memory.
Cc: Benjamin Tissoires
Cc: Hans de Goede
Cc: Andy Shevchenko
Cc: Dmitry Torokhov
Cc: Doug Anderson
Signed-off-by: Stephen Boyd
Acked-by: Benjamin Tissoires
Signed-off-by: Jiri Kosina
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 46066a10dd7acaedfb681c878ed483e5d641fb72
Author: Zhouyang Jia
Date: Thu Jun 14 21:37:17 2018 +0800
HID: hid-ntrig: add error handling for sysfs\_create\_group
[ Upstream commit 44d4d51de9a3534a2b63d69efda02a10e66541e4 ]
When sysfs\_create\_group fails, the lack of error-handling code may
cause unexpected results.
This patch adds error-handling code after calling sysfs\_create\_group.
Signed-off-by: Zhouyang Jia
Signed-off-by: Jiri Kosina
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d79cdff5728575d95f6cbdcda62fc5936abc8698
Author: Viresh Kumar
Date: Fri May 25 16:01:49 2018 +0530
arm: dts: mediatek: Add missing cooling device properties for CPUs
[ Upstream commit 0c7f7a5150023f3c6f0b27c4d4940ce3dfaf62cc ]
The cooling device properties, like "#cooling-cells" and
"dynamic-power-coefficient", should either be present for all the CPUs
of a cluster or none. If these are present only for a subset of CPUs of
a cluster then things will start falling apart as soon as the CPUs are
brought online in a different order. For example, this will happen
because the operating system looks for such properties in the CPU node
it is trying to bring up, so that it can register a cooling device.
Add such missing properties.
Signed-off-by: Viresh Kumar
Signed-off-by: Matthias Brugger
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 65470af8b10d9522aa4045cb2f587ede860bb1b0
Author: Frederic Weisbecker
Date: Tue Jun 26 04:58:48 2018 +0200
perf/hw\_breakpoint: Split attribute parse and commit
[ Upstream commit 9a4903dde2c8633c5fcf887b98c4e047a6154a54 ]
arch\_validate\_hwbkpt\_settings() mixes up attribute check and commit into
a single code entity. Therefore the validation may return an error due to
incorrect atributes while still leaving halfway modified architecture
breakpoint data.
This is harmless when we deal with a new breakpoint but it becomes a
problem when we modify an existing breakpoint.
Split attribute parse and commit to fix that. The architecture is
passed a "struct arch\_hw\_breakpoint" to fill on top of the new attr
and the core takes care about copying the backend data once it's fully
validated. The architectures then need to implement the new API.
Original-patch-by: Andy Lutomirski
Reported-by: Linus Torvalds
Signed-off-by: Frederic Weisbecker
Cc: Alexander Shishkin
Cc: Andy Lutomirski
Cc: Arnaldo Carvalho de Melo
Cc: Arnaldo Carvalho de Melo
Cc: Benjamin Herrenschmidt
Cc: Catalin Marinas
Cc: Chris Zankel
Cc: Jiri Olsa
Cc: Joel Fernandes
Cc: Mark Rutland
Cc: Max Filippov
Cc: Michael Ellerman
Cc: Namhyung Kim
Cc: Paul Mackerras
Cc: Peter Zijlstra
Cc: Rich Felker
Cc: Thomas Gleixner
Cc: Will Deacon
Cc: Yoshinori Sato
Link: http://lkml.kernel.org/r/1529981939-8231-2-git-send-email-frederic@kernel.org
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 7f22023170f77dedd8b622c279ccaf62377c330a
Author: Randy Dunlap
Date: Sat Jun 16 19:02:03 2018 -0700
Documentation/process: fix reST table border error
[ Upstream commit cccd289f12d0e827070c847b1ff96ba02eb20eaf ]
Fix reST error in Documentation/process/:
Documentation/process/2.Process.rst:131: ERROR: Malformed table.
Bottom/header table border does not match top border.
Fixes: 8962e40c1993 ("docs: update kernel versions and dates in tables")
Signed-off-by: Randy Dunlap
Cc: Jonathan Corbet
Cc: Tim Bird
Signed-off-by: Jonathan Corbet
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 53b56e401d930d9d0ae148975c5c34f46df27b11
Author: Leon Romanovsky
Date: Sun Jun 24 11:23:47 2018 +0300
RDMA/uverbs: Don't overwrite NULL pointer with ZERO\_SIZE\_PTR
[ Upstream commit a5cc9831af05e658543593abaee45a29d061bac4 ]
Number of specs is provided by user and in valid case can be equal to zero.
Such argument causes to call to kcalloc() with zero-length request and in
return the ZERO\_SIZE\_PTR is assigned. This pointer is different from NULL
and makes various if (..) checks to success.
Fixes: b6ba4a9aa59f ("IB/uverbs: Add support for flow counters")
Signed-off-by: Leon Romanovsky
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1da59841eea9bd521e1b42cb7b7eece12247019e
Author: Ethan Tuttle
Date: Tue Jun 19 21:31:08 2018 -0700
ARM: mvebu: declare asm symbols as character arrays in pmsu.c
[ Upstream commit d0d378ff451a66e486488eec842e507d28145813 ]
With CONFIG\_FORTIFY\_SOURCE, memcpy uses the declared size of operands to
detect buffer overflows. If src or dest is declared as a char, attempts to
copy more than byte will result in a fortify\_panic().
Address this problem in mvebu\_setup\_boot\_addr\_wa() by declaring
mvebu\_boot\_wa\_start and mvebu\_boot\_wa\_end as character arrays. Also remove
a couple addressof operators to avoid "arithmetic on pointer to an
incomplete type" compiler error.
See commit 54a7d50b9205 ("x86: mark kprobe templates as character arrays,
not single characters") for a similar fix.
Fixes "detected buffer overflow in memcpy" error during init on some mvebu
systems (armada-370-xp, armada-375):
(fortify\_panic) from (mvebu\_setup\_boot\_addr\_wa+0xb0/0xb4)
(mvebu\_setup\_boot\_addr\_wa) from (mvebu\_v7\_cpu\_pm\_init+0x154/0x204)
(mvebu\_v7\_cpu\_pm\_init) from (do\_one\_initcall+0x7c/0x1a8)
(do\_one\_initcall) from (kernel\_init\_freeable+0x1bc/0x254)
(kernel\_init\_freeable) from (kernel\_init+0x8/0x114)
(kernel\_init) from (ret\_from\_fork+0x14/0x2c)
Signed-off-by: Ethan Tuttle
Tested-by: Ethan Tuttle
Signed-off-by: Gregory CLEMENT
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3fc862c26744005261ee430450d3571d07d86458
Author: Daniel Vetter
Date: Fri May 25 19:39:24 2018 +0300
drm/omap: gem: Fix mm\_list locking
[ Upstream commit 5117bd898e8c0a31e8ab3a9b8523aecf0706e997 ]
- None of the list walkings where protected.
- Switch to a mutex since the list walking at device resume time can
sleep when pinning buffers through the tiler.
Only thing we need to be careful with here is that while we walk the
list we can't unreference any gem objects, since the final unref would
result in a recursive deadlock. But the only functions that walk the
list is the device resume and debugfs dumping, so all safe.
Signed-off-by: Daniel Vetter
Reviewed-by: Tomi Valkeinen
Reviewed-by: Laurent Pinchart
Signed-off-by: Laurent Pinchart
Signed-off-by: Tomi Valkeinen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f7867f358bfec376bd4c423b97a00580856171ad
Author: Tony Lindgren
Date: Tue Jun 19 02:43:35 2018 -0700
wlcore: Add missing PM call for wlcore\_cmd\_wait\_for\_event\_or\_timeout()
[ Upstream commit 4ec7cece87b3ed21ffcd407c62fb2f151a366bc1 ]
Otherwise we can get:
WARNING: CPU: 0 PID: 55 at drivers/net/wireless/ti/wlcore/io.h:84
I've only seen this few times with the runtime PM patches enabled
so this one is probably not needed before that. This seems to
work currently based on the current PM implementation timer. Let's
apply this separately though in case others are hitting this issue.
Signed-off-by: Tony Lindgren
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 13c4f14d8cf264f889186ec991533923c11993ac
Author: Johannes Berg
Date: Wed Jun 20 08:58:28 2018 +0200
bitfield: fix \*\_encode\_bits()
[ Upstream commit e7d4a95da86e0b048702765bbdcdc968aaf312e7 ]
There's a bug in \*\_encode\_bits() in using ~field\_multiplier() for
the check whether or not the constant value fits into the field,
this is wrong and clearly ~field\_mask() was intended. This was
triggering for me for both constant and non-constant values.
Additionally, make this case actually into an compile error.
Declaring the extern function that will never exist with just a
warning is pointless as then later we'll just get a link error.
While at it, also fix the indentation in those lines I'm touching.
Finally, as suggested by Andy Shevchenko, add some tests and for
that introduce also u8 helpers. The tests don't compile without
the fix, showing that it's necessary.
Fixes: 00b0c9b82663 ("Add primitives for manipulating bitfields both in host- and fixed-endian.")
Reviewed-by: Andy Shevchenko
Signed-off-by: Johannes Berg
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1ae0268dc54e6657605216669eefab4268165237
Author: Stefan Agner
Date: Sun Jun 17 12:33:50 2018 +0200
brcmsmac: fix wrap around in conversion from constant to s16
[ Upstream commit c9a61469fc97672a08b2f798830a55ea6e03dc4a ]
The last value in the log\_table wraps around to a negative value
since s16 has a value range of -32768 to 32767. This is not what
the table intends to represent. Use the closest positive value
32767.
This fixes a warning seen with clang:
drivers/net/wireless/broadcom/brcm80211/brcmsmac/phy/phy\_qmath.c:216:2: warning:
implicit conversion from 'int' to 's16' (aka 'short') changes
value from 32768
to -32768 [-Wconstant-conversion]
32768
^~~~~
1 warning generated.
Fixes: 4c0bfeaae9f9 ("brcmsmac: fix array out-of-bounds access in qm\_log10")
Cc: Tobias Regnery
Signed-off-by: Stefan Agner
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit af1c6a743c9891585625114d2ccd91eb794c999f
Author: Dan Carpenter
Date: Tue Jun 5 14:31:39 2018 +0300
rndis\_wlan: potential buffer overflow in rndis\_wlan\_auth\_indication()
[ Upstream commit ae636fb1554833ee5133ca47bf4b2791b6739c52 ]
This is a static checker fix, not something I have tested. The issue
is that on the second iteration through the loop, we jump forward by
le32\_to\_cpu(auth\_req->length) bytes. The problem is that if the length
is more than "buflen" then we end up with a negative "buflen". A
negative buflen is type promoted to a high positive value and the loop
continues but it's accessing beyond the end of the buffer.
I believe the "auth\_req->length" comes from the firmware and if the
firmware is malicious or buggy, you're already toasted so the impact of
this bug is probably not very severe.
Fixes: 030645aceb3d ("rndis\_wlan: handle 802.11 indications from device")
Signed-off-by: Dan Carpenter
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 35ba785489480a7ac54d3287ef15374c574c03a7
Author: Lorenzo Bianconi
Date: Mon Jun 4 11:19:41 2018 +0200
mt76x2: fix mrr idx/count estimation in mt76x2\_mac\_fill\_tx\_status()
[ Upstream commit 2d1e9be0016230f3707812243561fbd16f1aea4b ]
Fix mcs and attempt count estimation in mt76x2\_mac\_fill\_tx\_status routine
if the number of tx retries reported by the hw is grater than
IEEE80211\_TX\_MAX\_RATES
Fixes: 7bc04215a66b ("mt76: add driver code for MT76x2e")
Signed-off-by: Lorenzo Bianconi
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 882791abd11d3020694baa72b2782ad5a98da2e1
Author: Niklas Cassel
Date: Mon Jun 18 17:00:49 2018 +0300
ath10k: transmit queued frames after processing rx packets
[ Upstream commit 3f04950f32d5d592ab4fcaecac2178558a6f7437 ]
When running iperf on ath10k SDIO, TX can stop working:
iperf -c 192.168.1.1 -i 1 -t 20 -w 10K
[ 3] 0.0- 1.0 sec 2.00 MBytes 16.8 Mbits/sec
[ 3] 1.0- 2.0 sec 3.12 MBytes 26.2 Mbits/sec
[ 3] 2.0- 3.0 sec 3.25 MBytes 27.3 Mbits/sec
[ 3] 3.0- 4.0 sec 655 KBytes 5.36 Mbits/sec
[ 3] 4.0- 5.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 5.0- 6.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 6.0- 7.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 7.0- 8.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 8.0- 9.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 9.0-10.0 sec 0.00 Bytes 0.00 bits/sec
[ 3] 0.0-10.3 sec 9.01 MBytes 7.32 Mbits/sec
There are frames in the ieee80211\_txq and there are frames that have
been removed from from this queue, but haven't yet been sent on the wire
(num\_pending\_tx).
When num\_pending\_tx reaches max\_num\_pending\_tx, we will stop the queues
by calling ieee80211\_stop\_queues().
As frames that have previously been sent for transmission
(num\_pending\_tx) are completed, we will decrease num\_pending\_tx and wake
the queues by calling ieee80211\_wake\_queue(). ieee80211\_wake\_queue()
does not call wake\_tx\_queue, so we might still have frames in the
queue at this point.
While the queues were stopped, the socket buffer might have filled up,
and in order for user space to write more, we need to free the frames
in the queue, since they are accounted to the socket. In order to free
them, we first need to transmit them.
This problem cannot be reproduced on low-latency devices, e.g. pci,
since they call ath10k\_mac\_tx\_push\_pending() from
ath10k\_htt\_txrx\_compl\_task(). ath10k\_htt\_txrx\_compl\_task() is not called
on high-latency devices.
Fix the problem by calling ath10k\_mac\_tx\_push\_pending(), after
processing rx packets, just like for low-latency devices, also in the
SDIO case. Since we are calling ath10k\_mac\_tx\_push\_pending() directly,
we also need to export it.
Signed-off-by: Niklas Cassel
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9f81b08ad8eaa4dad0a9ea70d13e60d5c04853cc
Author: Jernej Skrabec
Date: Mon Jun 25 14:02:46 2018 +0200
drm/sun4i: Fix releasing node when enumerating enpoints
[ Upstream commit 367c359aa8637b15ee8df6335c5a29b7623966ec ]
sun4i\_drv\_add\_endpoints() has a memory leak since it uses of\_node\_put()
when remote is equal to NULL and does nothing when remote has a valid
pointer.
Invert the logic to fix memory leak.
Signed-off-by: Jernej Skrabec
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/20180625120304.7543-7-jernej.skrabec@siol.net
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 900812a0d318954400d20b0190c7d788b4ff2cc2
Author: Brandon Maier
Date: Tue Jun 26 12:50:48 2018 -0500
net: phy: xgmiitorgmii: Check phy\_driver ready before accessing
[ Upstream commit ab4e6ee578e88a659938db8fbf33720bc048d29c ]
Since a phy\_device is added to the global mdio\_bus list during
phy\_device\_register(), but a phy\_device's phy\_driver doesn't get
attached until phy\_probe(). It's possible of\_phy\_find\_device() in
xgmiitorgmii will return a valid phy with a NULL phy\_driver. Leading to
a NULL pointer access during the memcpy().
Fixes this Oops:
Unable to handle kernel NULL pointer dereference at virtual address 00000000
pgd = c0004000
[00000000] \*pgd=00000000
Internal error: Oops: 5 [#1] PREEMPT SMP ARM
Modules linked in:
CPU: 0 PID: 1 Comm: swapper/0 Not tainted 4.14.40 #1
Hardware name: Xilinx Zynq Platform
task: ce4c8d00 task.stack: ce4ca000
PC is at memcpy+0x48/0x330
LR is at xgmiitorgmii\_probe+0x90/0xe8
pc : [] lr : [] psr: 20000013
sp : ce4cbb54 ip : 00000000 fp : ce4cbb8c
r10: 00000000 r9 : 00000000 r8 : c0c49178
r7 : 00000000 r6 : cdc14718 r5 : ce762800 r4 : cdc14710
r3 : 00000000 r2 : 00000054 r1 : 00000000 r0 : cdc14718
Flags: nzCv IRQs on FIQs on Mode SVC\_32 ISA ARM Segment none
Control: 18c5387d Table: 0000404a DAC: 00000051
Process swapper/0 (pid: 1, stack limit = 0xce4ca210)
...
[] (memcpy) from [] (xgmiitorgmii\_probe+0x90/0xe8)
[] (xgmiitorgmii\_probe) from [] (mdio\_probe+0x28/0x34)
[] (mdio\_probe) from [] (driver\_probe\_device+0x254/0x414)
[] (driver\_probe\_device) from [] (\_\_device\_attach\_driver+0xac/0x10c)
[] (\_\_device\_attach\_driver) from [] (bus\_for\_each\_drv+0x84/0xc8)
[] (bus\_for\_each\_drv) from [] (\_\_device\_attach+0xd0/0x134)
[] (\_\_device\_attach) from [] (device\_initial\_probe+0x1c/0x20)
[] (device\_initial\_probe) from [] (bus\_probe\_device+0x98/0xa0)
[] (bus\_probe\_device) from [] (device\_add+0x43c/0x5d0)
[] (device\_add) from [] (mdio\_device\_register+0x34/0x80)
[] (mdio\_device\_register) from [] (of\_mdiobus\_register+0x170/0x30c)
[] (of\_mdiobus\_register) from [] (macb\_probe+0x710/0xc00)
[] (macb\_probe) from [] (platform\_drv\_probe+0x44/0x80)
[] (platform\_drv\_probe) from [] (driver\_probe\_device+0x254/0x414)
[] (driver\_probe\_device) from [] (\_\_driver\_attach+0x10c/0x118)
[] (\_\_driver\_attach) from [] (bus\_for\_each\_dev+0x8c/0xd0)
[] (bus\_for\_each\_dev) from [] (driver\_attach+0x2c/0x30)
[] (driver\_attach) from [] (bus\_add\_driver+0x50/0x260)
[] (bus\_add\_driver) from [] (driver\_register+0x88/0x108)
[] (driver\_register) from [] (\_\_platform\_driver\_register+0x50/0x58)
[] (\_\_platform\_driver\_register) from [] (macb\_driver\_init+0x24/0x28)
[] (macb\_driver\_init) from [] (do\_one\_initcall+0x60/0x1a4)
[] (do\_one\_initcall) from [] (kernel\_init\_freeable+0x15c/0x1f8)
[] (kernel\_init\_freeable) from [] (kernel\_init+0x18/0x124)
[] (kernel\_init) from [] (ret\_from\_fork+0x14/0x20)
Code: ba000002 f5d1f03c f5d1f05c f5d1f07c (e8b151f8)
---[ end trace 3e4ec21905820a1f ]---
Signed-off-by: Brandon Maier
Reviewed-by: Andrew Lunn
Reviewed-by: Florian Fainelli
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d0a4b7b3792f7650c57aedb6ac514fd608d64859
Author: Jernej Skrabec
Date: Mon Jun 25 14:02:56 2018 +0200
drm/sun4i: Enable DW HDMI PHY clock
[ Upstream commit 09773c532d30187f86a142901c27c93e629ce6ba ]
Current DW HDMI PHY code never prepares and enables PHY clock after it is
created. It's just used as it is. This may work in some cases, but it's
clearly wrong. Fix it by adding proper calls to enable/disable PHY
clock.
Fixes: 4f86e81748fe ("drm/sun4i: Add support for H3 HDMI PHY variant")
Signed-off-by: Jernej Skrabec
Signed-off-by: Maxime Ripard
Link: https://patchwork.freedesktop.org/patch/msgid/20180625120304.7543-17-jernej.skrabec@siol.net
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c247a4bf53b6d70830f1a7190d404425fe8a806c
Author: Ben Greear
Date: Mon Jun 18 17:00:56 2018 +0300
ath10k: protect ath10k\_htt\_rx\_ring\_free with rx\_ring.lock
[ Upstream commit 168f75f11fe68455e0d058a818ebccfc329d8685 ]
While debugging driver crashes related to a buggy firmware
crashing under load, I noticed that ath10k\_htt\_rx\_ring\_free
could be called without being under lock. I'm not sure if this
is the root cause of the crash or not, but it seems prudent to
protect it.
Originally tested on 4.16+ kernel with ath10k-ct 10.4 firmware
running on 9984 NIC.
Signed-off-by: Ben Greear
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit fcd12823cd576544556e4ba852204bc34be3e257
Author: Brandon Maier
Date: Tue Jun 26 12:50:50 2018 -0500
net: phy: xgmiitorgmii: Check read\_status results
[ Upstream commit 8d0752d11312be830c33e84dfd1016e6a47c2938 ]
We're ignoring the result of the attached phy device's read\_status().
Return it so we can detect errors.
Signed-off-by: Brandon Maier
Reviewed-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6cdfe3ed6c9d75db5d028f285c57890faa000c80
Author: Kai-Heng Feng
Date: Thu Jun 28 15:28:24 2018 +0800
ALSA: hda: Add AZX\_DCAPS\_PM\_RUNTIME for AMD Raven Ridge
[ Upstream commit 1adca4b0cd65c14cb8b8c9c257720385869c3d5f ]
This patch can make audio controller in AMD Raven Ridge gets runtime
suspended to D3, to save ~1W power when it's not in use.
Cc: Vijendar Mukunda
Signed-off-by: Kai-Heng Feng
Signed-off-by: Takashi Iwai
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3dc220c5253ebc8bc454d14c604816738d4bc2a5
Author: Dan Carpenter
Date: Wed Jun 27 11:56:53 2018 +0300
ASoC: qdsp6: qdafe: fix some off by one bugs
[ Upstream commit c54c1c5ee8e73b7cb752834e52e2129b1dab00bd ]
The > should be >= or we could read one element beyond the end of the
port\_maps[] array.
Fixes: 7fa2d70f9766 ("ASoC: qdsp6: q6afe: Add q6afe driver")
Signed-off-by: Dan Carpenter
Acked-by: Srinivas Kandagatla
Signed-off-by: Mark Brown
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 49fc6188cdb6a1aad28e57058b2a07c4b8a03889
Author: Zhouyang Jia
Date: Mon Jun 11 00:39:20 2018 -0400
media: tm6000: add error handling for dvb\_register\_adapter
[ Upstream commit e95d7c6eb94c634852eaa5ff4caf3db05b5d2e86 ]
When dvb\_register\_adapter fails, the lack of error-handling code may
cause unexpected results.
This patch adds error-handling code after calling dvb\_register\_adapter.
Signed-off-by: Zhouyang Jia
[hans.verkuil@cisco.com: use pr\_err and fix typo: adater -> adapter]
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6c695a374b0b21a7bb42c53aa0c4238577c2280d
Author: Rosen Penev
Date: Sat Jun 16 19:17:50 2018 -0700
staging: mt7621-dts: Fix remaining pcie warnings
[ Upstream commit d0233204fbc10f003d1ef077f57341c2feca4002 ]
This currently fixes the remaining dtb warnings:
Node /pcie@1e140000/pcie0 has a reg or ranges property, but no unit name
Node /pcie@1e140000/pcie1 has a reg or ranges property, but no unit name
Node /pcie@1e140000/pcie2 has a reg or ranges property, but no unit name
Node /pcie@1e140000/pcie0 node name is not "pci" or "pcie"
Node /pcie@1e140000/pcie0 missing ranges for PCI bridge (or not a bridge)
Node /pcie@1e140000/pcie0 missing bus-range for PCI bridge
Node /pcie@1e140000/pcie1 node name is not "pci" or "pcie"
Node /pcie@1e140000/pcie1 missing ranges for PCI bridge (or not a bridge)
Node /pcie@1e140000/pcie1 missing bus-range for PCI bridge
Node /pcie@1e140000/pcie2 node name is not "pci" or "pcie"
Node /pcie@1e140000/pcie2 missing ranges for PCI bridge (or not a bridge)
Node /pcie@1e140000/pcie2 missing bus-range for PCI bridge
Warning (unit\_address\_format): Failed prerequisite 'pci\_bridge'
Warning (pci\_device\_reg): Failed prerequisite 'pci\_bridge'
Warning (pci\_device\_bus\_num): Failed prerequisite 'pci\_bridge'
device\_type was removed since according to documentation, it's deprecated
for pci(e) devices.
Signed-off-by: Rosen Penev
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 7a887d2a1f91b8a0856735ddc8bf6d38b06e2b5a
Author: Christophe JAILLET
Date: Mon Jun 11 19:30:35 2018 +0200
serial: pxa: Fix an error handling path in 'serial\_pxa\_probe()'
[ Upstream commit 95a0e656580fab3128c7bee5f660c50784f53651 ]
If port.line is out of range, we still need to release some resources, or
we will leak them.
Fixes: afc7851fab83 ("serial: pxa: Fix out-of-bounds access through serial port index")
Signed-off-by: Christophe JAILLET
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e8db58e3d80bf4c739450a3f0791022bde391cb4
Author: Geert Uytterhoeven
Date: Thu Jun 14 15:48:08 2018 +0200
arm64: dts: renesas: salvator-common: Fix adv7482 decimal unit addresses
[ Upstream commit c5a884838ce34681200b5a45b2330177036affd0 ]
With recent dtc and W=1:
...salvator-x.dtb: Warning (graph\_port): /soc/i2c@e66d8000/video-receiver@70/port@10: graph node unit address error, expected "a"
...salvator-x.dtb: Warning (graph\_port): /soc/i2c@e66d8000/video-receiver@70/port@11: graph node unit address error, expected "b"
Unit addresses are always hexadecimal (without prefix), while the bases
of reg property values depend on their prefixes.
Fixes: 908001d778eba06e ("arm64: dts: renesas: salvator-common: Add ADV7482 support")
Signed-off-by: Geert Uytterhoeven
Reviewed-by: Rob Herring
Acked-by: Kieran Bingham
Signed-off-by: Simon Horman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e65f712ea9369fcb7c1824d3eaa6dd19caa22482
Author: Zhouyang Jia
Date: Tue Jun 12 12:36:25 2018 +0800
drivers/tty: add error handling for pcmcia\_loop\_config
[ Upstream commit 85c634e919bd6ef17427f26a52920aeba12e16ee ]
When pcmcia\_loop\_config fails, the lack of error-handling code may
cause unexpected results.
This patch adds error-handling code after calling pcmcia\_loop\_config.
Signed-off-by: Zhouyang Jia
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 5208cebb4ca394b9809d37035c6e3c66c3ef2f9c
Author: Kamal Heib
Date: Tue Jun 19 20:04:08 2018 +0300
staging: mt7621-eth: Fix memory leak in mtk\_add\_mac() error path
[ Upstream commit 85e1d42663a0c163002961d2685be952067b0dc2 ]
Fix memory leak in error path of mtk\_add\_mac() by make sure to free
the allocated netdev.
Fixes: e3cbf478f846 ('staging: mt7621-eth: add the drivers core files')
Signed-off-by: Kamal Heib
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6cbaed5c50ac046fdad63fef1463201750407e44
Author: Akinobu Mita
Date: Sun May 6 10:19:18 2018 -0400
media: ov772x: allow i2c controllers without I2C\_FUNC\_PROTOCOL\_MANGLING
[ Upstream commit 0b964d183cbf3f95a062ad9f3eec87ffa2790558 ]
The ov772x driver only works when the i2c controller have
I2C\_FUNC\_PROTOCOL\_MANGLING. However, many i2c controller drivers don't
support it.
The reason that the ov772x requires I2C\_FUNC\_PROTOCOL\_MANGLING is that
it doesn't support repeated starts.
This changes the reading ov772x register method so that it doesn't
require I2C\_FUNC\_PROTOCOL\_MANGLING by calling two separated i2c messages.
Cc: Laurent Pinchart
Cc: Hans Verkuil
Cc: Wolfram Sang
Reviewed-by: Jacopo Mondi
Signed-off-by: Akinobu Mita
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 47da213433ae898f92a1f5c2e66196fdbcbc2a18
Author: Alistair Strachan
Date: Tue Jun 19 17:57:35 2018 -0700
staging: android: ashmem: Fix mmap size validation
[ Upstream commit 8632c614565d0c5fdde527889601c018e97b6384 ]
The ashmem driver did not check that the size/offset of the vma passed
to its .mmap() function was not larger than the ashmem object being
mapped. This could cause mmap() to succeed, even though accessing parts
of the mapping would later fail with a segmentation fault.
Ensure an error is returned by the ashmem\_mmap() function if the vma
size is larger than the ashmem object size. This enables safer handling
of the problem in userspace.
Cc: Todd Kjos
Cc: devel@driverdev.osuosl.org
Cc: linux-kernel@vger.kernel.org
Cc: kernel-team@android.com
Cc: Joel Fernandes
Signed-off-by: Alistair Strachan
Acked-by: Joel Fernandes (Google)
Reviewed-by: Martijn Coenen
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 20d705e92eb785f1ad0e3260825d627f6633629c
Author: Akinobu Mita
Date: Sun May 6 10:19:19 2018 -0400
media: ov772x: add checks for register read errors
[ Upstream commit 30f3b17eaf4913e9e56be15915ce57aae69db701 ]
This change adds checks for register read errors and returns correct
error code.
Cc: Laurent Pinchart
Cc: Hans Verkuil
Reviewed-by: Jacopo Mondi
Signed-off-by: Akinobu Mita
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit eab10433598a6003eea8e7c05ee5ea3d8efda4b7
Author: Javier Martinez Canillas
Date: Sat Jun 9 08:22:45 2018 -0400
media: omap3isp: zero-initialize the isp cam\_xclk{a,b} initial data
[ Upstream commit 2ec7debd44b49927a6e2861521994cc075a389ed ]
The struct clk\_init\_data init variable is declared in the isp\_xclk\_init()
function so is an automatic variable allocated in the stack. But it's not
explicitly zero-initialized, so some init fields are left uninitialized.
This causes the data structure to have undefined values that may confuse
the common clock framework when the clock is registered.
For example, the uninitialized .flags field could have the CLK\_IS\_CRITICAL
bit set, causing the framework to wrongly prepare the clk on registration.
This leads to the isp\_xclk\_prepare() callback being called, which in turn
calls to the omap3isp\_get() function that increments the isp dev refcount.
Since this omap3isp\_get() call is unexpected, this leads to an unbalanced
omap3isp\_get() call that prevents the requested IRQ to be later enabled,
due the refcount not being 0 when the correct omap3isp\_get() call happens.
Fixes: 9b28ee3c9122 ("[media] omap3isp: Use the common clock framework")
Signed-off-by: Javier Martinez Canillas
Reviewed-by: Sebastian Reichel
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 870878d2c9419c4d45a898502b06bd8f8f7d18d4
Author: Akinobu Mita
Date: Sun Jun 10 11:42:26 2018 -0400
media: soc\_camera: ov772x: correct setting of banding filter
[ Upstream commit 22216ec41e919682c15345e95928f266e8ba6f9e ]
The banding filter ON/OFF is controlled via bit 5 of COM8 register. It
is attempted to be enabled in ov772x\_set\_params() by the following line.
ret = ov772x\_mask\_set(client, COM8, BNDF\_ON\_OFF, 1);
But this unexpectedly results disabling the banding filter, because the
mask and set bits are exclusive.
On the other hand, ov772x\_s\_ctrl() correctly sets the bit by:
ret = ov772x\_mask\_set(client, COM8, BNDF\_ON\_OFF, BNDF\_ON\_OFF);
The same fix was already applied to non-soc\_camera version of ov772x
driver in the commit commit a024ee14cd36 ("media: ov772x: correct setting
of banding filter")
Cc: Jacopo Mondi
Cc: Laurent Pinchart
Cc: Hans Verkuil
Signed-off-by: Akinobu Mita
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 39a372355b5af5aaea17861662dd6118d87363f5
Author: Akinobu Mita
Date: Sun Jun 10 11:42:01 2018 -0400
media: s3c-camif: ignore -ENOIOCTLCMD from v4l2\_subdev\_call for s\_power
[ Upstream commit 30ed2b83343bd1e07884ca7355dac70d25ffc158 ]
When the subdevice doesn't provide s\_power core ops callback, the
v4l2\_subdev\_call for s\_power returns -ENOIOCTLCMD. If the subdevice
doesn't have the special handling for its power saving mode, the s\_power
isn't required. So -ENOIOCTLCMD from the v4l2\_subdev\_call should be
ignored.
Cc: Hans Verkuil
Signed-off-by: Akinobu Mita
Acked-by: Sylwester Nawrocki
Signed-off-by: Sakari Ailus
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8086828bed84415f9e1caf5eef123c3cca8122a6
Author: Bob Copeland
Date: Thu Jun 21 08:25:48 2018 -0400
ath10k: use locked skb\_dequeue for rx completions
[ Upstream commit 62652555c616cad23a572f76cb5e870ab5395191 ]
In our environment we are occasionally seeing the following stack trace
in ath10k:
Unable to handle kernel paging request at virtual address 0000a800
pgd = c0204000
[0000a800] \*pgd=00000000
Internal error: Oops: 17 [#1] SMP ARM
Modules linked in: dwc3 dwc3\_of\_simple phy\_qcom\_dwc3 nf\_nat xt\_connmark
CPU: 0 PID: 0 Comm: swapper/0 Not tainted 4.9.31 #2
Hardware name: Generic DT based system
task: c09f4f40 task.stack: c09ee000
PC is at kfree\_skb\_list+0x1c/0x2c
LR is at skb\_release\_data+0x6c/0x108
pc : [] lr : [] psr: 200f0113
sp : c09efb68 ip : c09efb80 fp : c09efb7c
r10: 00000000 r9 : 00000000 r8 : 043fddd1
r7 : bf15d160 r6 : 00000000 r5 : d4ca2f00 r4 : ca7c6480
r3 : 000000a0 r2 : 01000000 r1 : c0a57470 r0 : 0000a800
Flags: nzCv IRQs on FIQs on Mode SVC\_32 ISA ARM Segment none
Control: 10c5787d Table: 56e6006a DAC: 00000051
Process swapper/0 (pid: 0, stack limit = 0xc09ee210)
Stack: (0xc09efb68 to 0xc09f0000)
fb60: ca7c6480 d4ca2f00 c09efb9c c09efb80 c065da5c c065dcb4
fb80: d4ca2f00 00000000 dcbf8400 bf15d160 c09efbb4 c09efba0 c065db28 c065d9fc
fba0: d4ca2f00 00000000 c09efbcc c09efbb8 c065db48 c065db04 d4ca2f00 00000000
fbc0: c09efbe4 c09efbd0 c065ddd0 c065db38 d4ca2f00 00000000 c09efc64 c09efbe8
fbe0: bf09bd00 c065dd10 00000003 7fffffff c09efc24 dcbfc9c0 01200000 00000000
fc00: 00000000 00000000 ddb7e440 c09e9440 c09efc48 1d195000 c09efc7c c09efc28
fc20: c027bb68 c028aa00 ddb7e4f8 bf13231c ddb7e454 0004091f bf154571 d4ca2f00
fc40: dcbf8d00 ca7c5df6 bf154538 01200000 00000000 bf154538 c09efd1c c09efc68
fc60: bf132458 bf09bbbc ca7c5dec 00000041 bf154538 bf154539 000007bf bf154545
fc80: bf154538 bf154538 bf154538 bf154538 bf154538 00000000 00000000 000016c1
fca0: 00000001 c09efcb0 01200000 00000000 00000000 00000000 00000000 00000001
fcc0: bf154539 00000041 00000000 00000007 00000000 000000d0 ffffffff 3160ffff
fce0: 9ad93e97 3e973160 7bf09ad9 0004091f d4ca2f00 c09efdb0 dcbf94e8 00000000
fd00: dcbf8d00 01200000 00000000 dcbf8d00 c09efd44 c09efd20 bf132544 bf132130
fd20: dcbf8d00 00000000 d4ca2f00 c09efdb0 00000001 d4ca2f00 c09efdec c09efd48
fd40: bf133630 bf1324d0 ca7c5cc0 000007c0 c09efd88 c09efd70 c0764230 c02277d8
fd60: 200f0113 ffffffff dcbf94c8 bf000000 dcbf93b0 dcbf8d00 00000040 dcbf945c
fd80: dcbf94e8 00000000 c09efdcc 00000000 c09efd90 c09efd90 00000000 00000024
fda0: dcbf8d00 00000000 00000005 dcbf8d00 c09efdb0 c09efdb0 00000000 00000040
fdc0: c09efdec dcbf8d00 dcbfc9c0 c09ed140 00000040 00000000 00000100 00000040
fde0: c09efe14 c09efdf0 bf1739b4 bf132840 dcbfc9c0 ddb82140 c09ed140 1d195000
fe00: 00000001 00000100 c09efe64 c09efe18 c067136c bf173958 ddb7fac8 c09f0d00
fe20: 001df678 0000012c c09efe28 c09efe28 c09efe30 c09efe30 c0a7fb28 ffffe000
fe40: c09f008c 00000003 00000008 c0a598c0 00000100 c09f0080 c09efeb4 c09efe68
fe60: c02096e0 c0671278 c0494584 00000080 dd5c3300 c09f0d00 00000004 001df677
fe80: 0000000a 00200100 dd5c3300 00000000 00000000 c09eaa70 00000060 dd410800
fea0: c09ee000 00000000 c09efecc c09efeb8 c0227944 c02094c4 00000000 00000000
fec0: c09efef4 c09efed0 c0268b64 c02278ac de802000 c09f1b1c c09eff20 c0a16cc0
fee0: de803000 c09ee000 c09eff1c c09efef8 c020947c c0268ae0 c02103dc 600f0013
ff00: ffffffff c09eff54 ffffe000 c09ee000 c09eff7c c09eff20 c021448c c0209424
ff20: 00000001 00000000 00000000 c021ddc0 00000000 00000000 c09f1024 00000001
ff40: ffffe000 c09f1078 00000000 c09eff7c c09eff80 c09eff70 c02103ec c02103dc
ff60: 600f0013 ffffffff 00000051 00000000 c09eff8c c09eff80 c0763cc4 c02103bc
ff80: c09effa4 c09eff90 c025f0e4 c0763c98 c0a59040 c09f1000 c09effb4 c09effa8
ffa0: c075efe0 c025efd4 c09efff4 c09effb8 c097dcac c075ef7c ffffffff ffffffff
ffc0: 00000000 c097d6c4 00000000 c09c1a28 c0a59294 c09f101c c09c1a24 c09f61c0
ffe0: 4220406a 512f04d0 00000000 c09efff8 4220807c c097d95c 00000000 00000000
[] (kfree\_skb\_list) from [] (skb\_release\_data+0x6c/0x108)
[] (skb\_release\_data) from [] (skb\_release\_all+0x30/0x34)
[] (skb\_release\_all) from [] (\_\_kfree\_skb+0x1c/0x9c)
[] (\_\_kfree\_skb) from [] (consume\_skb+0xcc/0xd8)
[] (consume\_skb) from [] (ieee80211\_rx\_napi+0x150/0x82c [mac80211])
[] (ieee80211\_rx\_napi [mac80211]) from [] (ath10k\_htt\_t2h\_msg\_handler+0x15e8/0x19c4 [ath10k\_core])
[] (ath10k\_htt\_t2h\_msg\_handler [ath10k\_core]) from [] (ath10k\_htt\_t2h\_msg\_handler+0x16d4/0x19c4 [ath10k\_core])
[] (ath10k\_htt\_t2h\_msg\_handler [ath10k\_core]) from [] (ath10k\_htt\_txrx\_compl\_task+0xdfc/0x12cc [ath10k\_core])
[] (ath10k\_htt\_txrx\_compl\_task [ath10k\_core]) from [] (ath10k\_pci\_napi\_poll+0x68/0xf4 [ath10k\_pci])
[] (ath10k\_pci\_napi\_poll [ath10k\_pci]) from [] (net\_rx\_action+0x100/0x33c)
[] (net\_rx\_action) from [] (\_\_do\_softirq+0x228/0x31c)
[] (\_\_do\_softirq) from [] (irq\_exit+0xa4/0x114)
The trace points to a corrupt skb inside kfree\_skb(), seemingly because
one of the shared skb queues is getting corrupted. Most of the skb queues
ath10k uses are local to a single call stack, but three are shared among
multiple codepaths:
- rx\_msdus\_q,
- rx\_in\_ord\_compl\_q, and
- tx\_fetch\_ind\_q
Of the three, the first two are manipulated using the unlocked skb\_queue
functions without any additional lock protecting them. Use the locked
variants of skb\_queue\_\* functions to protect these manipulations.
Signed-off-by: Bob Copeland
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 11750fe66e26f0c3757486b4a54d97a9a61d539e
Author: Petr Machata
Date: Thu Jun 28 18:56:33 2018 +0200
selftests: forwarding: Tweak tc filters for mirror-to-gretap tests
[ Upstream commit ec9fdc99f5a6a2cfe4061e807fcb0cc1129f0a2d ]
When running mirror\_gre\_bridge\_1d\_vlan tests on veth, several issues
cause spurious failures:
- vlan\_ethtype should be ip, not ipv6 even in mirror-to-ip6gretap case,
because the overlay packet is still IPv4.
- Similarly ip\_proto matches the innermost IP protocol, so can't be used
to filter out GRE packet. Drop the corresponding condition.
- Because the above fixes the filters to match in slow path as well,
they need to be made skip\_hw so as not to double-count packets.
Signed-off-by: Petr Machata
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit a4c7557bc547c2e0f43c41bd48d040a8386b2c0a
Author: Nicholas Mc Guire
Date: Fri Jun 29 19:07:42 2018 +0200
ALSA: snd-aoa: add of\_node\_put() in error path
[ Upstream commit 222bce5eb88d1af656419db04bcd84b2419fb900 ]
Both calls to of\_find\_node\_by\_name() and of\_get\_next\_child() return a
node pointer with refcount incremented thus it must be explicidly
decremented here after the last usage. As we are assured to have a
refcounted np either from the initial
of\_find\_node\_by\_name(NULL, name); or from the of\_get\_next\_child(gpio, np)
in the while loop if we reached the error code path below, an
x of\_node\_put(np) is needed.
Signed-off-by: Nicholas Mc Guire
Fixes: commit f3d9478b2ce4 ("[ALSA] snd-aoa: add snd-aoa")
Signed-off-by: Takashi Iwai
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 5f6b9cd5c5f22603363b181adb5671f6d17e7a4e
Author: Thomas Gleixner
Date: Tue Jun 26 15:21:32 2018 +0200
posix-timers: Sanitize overrun handling
[ Upstream commit 78c9c4dfbf8c04883941445a195276bb4bb92c76 ]
The posix timer overrun handling is broken because the forwarding functions
can return a huge number of overruns which does not fit in an int. As a
consequence timer\_getoverrun(2) and siginfo::si\_overrun can turn into
random number generators.
The k\_clock::timer\_forward() callbacks return a 64 bit value now. Make
k\_itimer::ti\_overrun[\_last] 64bit as well, so the kernel internal
accounting is correct. 3Remove the temporary (int) casts.
Add a helper function which clamps the overrun value returned to user space
via timer\_getoverrun(2) or siginfo::si\_overrun limited to a positive value
between 0 and INT\_MAX. INT\_MAX is an indicator for user space that the
overrun value has been clamped.
Reported-by: Team OWL337
Signed-off-by: Thomas Gleixner
Acked-by: John Stultz
Cc: Peter Zijlstra
Cc: Michael Kerrisk
Link: https://lkml.kernel.org/r/20180626132705.018623573@linutronix.de
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c0d08296a291d9998dc63cabd795aa56fd511375
Author: Thomas Gleixner
Date: Tue Jun 26 15:21:31 2018 +0200
posix-timers: Make forward callback return s64
[ Upstream commit 6fec64e1c92d5c715c6d0f50786daa7708266bde ]
The posix timer ti\_overrun handling is broken because the forwarding
functions can return a huge number of overruns which does not fit in an
int. As a consequence timer\_getoverrun(2) and siginfo::si\_overrun can turn
into random number generators.
As a first step to address that let the timer\_forward() callbacks return
the full 64 bit value.
Cast it to (int) temporarily until k\_itimer::ti\_overrun is converted to
64bit and the conversion to user space visible values is sanitized.
Reported-by: Team OWL337
Signed-off-by: Thomas Gleixner
Acked-by: John Stultz
Cc: Peter Zijlstra
Cc: Michael Kerrisk
Link: https://lkml.kernel.org/r/20180626132704.922098090@linutronix.de
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 90f955af43fe7d7c975abce7bed8966ff12aa3ab
Author: Akinobu Mita
Date: Tue Jun 26 00:22:41 2018 +0900
iio: accel: adxl345: convert address field usage in iio\_chan\_spec
[ Upstream commit 9048f1f18a70a01eaa3c8e7166fdb2538929d780 ]
Currently the address field in iio\_chan\_spec is filled with an accel
data register address for the corresponding axis.
In preparation for adding calibration offset support, this sets the
address field to the index of accel data registers instead of the actual
register address.
This change makes it easier to access both accel registers and
calibration offset registers with fewer lines of code as these are
located in X-axis, Y-axis, Z-axis order.
Cc: Eva Rachel Retuya
Cc: Andy Shevchenko
Cc: Jonathan Cameron
Signed-off-by: Akinobu Mita
Signed-off-by: Jonathan Cameron
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f1915d5162a92d5d5e24aec054417eefea075184
Author: Peter Rosin
Date: Thu Mar 29 15:10:54 2018 +0200
mtd: rawnand: atmel: add module param to avoid using dma
[ Upstream commit efc6362c6f8c1e74b340e2611f1b35e7d557ce7b ]
On a sama5d31 with a Full-HD dual LVDS panel (132MHz pixel clock) NAND
flash accesses have a tendency to cause display disturbances. Add a
module param to disable DMA from the NAND controller, since that fixes
the display problem for me.
Signed-off-by: Peter Rosin
Reviewed-by: Boris Brezillon
Signed-off-by: Miquel Raynal
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ff9ac7d9bddaf104ede4578d4d1783fbee7841da
Author: Vasily Gorbik
Date: Sun Jun 17 00:30:43 2018 +0200
s390/extmem: fix gcc 8 stringop-overflow warning
[ Upstream commit 6b2ddf33baec23dace85bd647e3fc4ac070963e8 ]
arch/s390/mm/extmem.c: In function '\_\_segment\_load':
arch/s390/mm/extmem.c:436:2: warning: 'strncat' specified bound 7 equals
source length [-Wstringop-overflow=]
strncat(seg->res\_name, " (DCSS)", 7);
What gcc complains about here is the misuse of strncat function, which
in this case does not limit a number of bytes taken from "src", so it is
in the end the same as strcat(seg->res\_name, " (DCSS)");
Keeping in mind that a res\_name is 15 bytes, strncat in this case
would overflow the buffer and write 0 into alignment byte between the
fields in the struct. To avoid that increasing res\_name size to 16,
and reusing strlcat.
Reviewed-by: Heiko Carstens
Signed-off-by: Vasily Gorbik
Signed-off-by: Martin Schwidefsky
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6143a4525c3e97bb56b6e5ccd09c7b89f648873a
Author: Vasily Gorbik
Date: Mon Jun 25 14:30:42 2018 +0200
s390/scm\_blk: correct numa\_node in scm\_blk\_dev\_setup
[ Upstream commit d642d6262f4fcfa5d200ec6e218c17f0c15b3390 ]
The numa\_node field of the tag\_set struct has to be explicitly
initialized, otherwise it stays as 0, which is a valid numa node id and
cause memory allocation failure if node 0 is offline.
Acked-by: Sebastian Ott
Signed-off-by: Vasily Gorbik
Signed-off-by: Martin Schwidefsky
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0c6df6d17ab43cdb5c889d49149aeb9160e6cb45
Author: Vasily Gorbik
Date: Sun Jun 24 09:21:59 2018 +0200
s390/dasd: correct numa\_node in dasd\_alloc\_queue
[ Upstream commit b17e3abb0af404cb62ad4ef1a5962f58b06e2b78 ]
The numa\_node field of the tag\_set struct has to be explicitly
initialized, otherwise it stays as 0, which is a valid numa node id and
cause memory allocation failure if node 0 is offline.
Acked-by: Stefan Haberland
Signed-off-by: Vasily Gorbik
Signed-off-by: Martin Schwidefsky
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 04937aaaf8c795481580c323d91ee40a74cc66af
Author: Thomas Gleixner
Date: Mon Jul 2 09:34:29 2018 +0200
alarmtimer: Prevent overflow for relative nanosleep
[ Upstream commit 5f936e19cc0ef97dbe3a56e9498922ad5ba1edef ]
Air Icy reported:
UBSAN: Undefined behaviour in kernel/time/alarmtimer.c:811:7
signed integer overflow:
1529859276030040771 + 9223372036854775807 cannot be represented in type 'long long int'
Call Trace:
alarm\_timer\_nsleep+0x44c/0x510 kernel/time/alarmtimer.c:811
\_\_do\_sys\_clock\_nanosleep kernel/time/posix-timers.c:1235 [inline]
\_\_se\_sys\_clock\_nanosleep kernel/time/posix-timers.c:1213 [inline]
\_\_x64\_sys\_clock\_nanosleep+0x326/0x4e0 kernel/time/posix-timers.c:1213
do\_syscall\_64+0xb8/0x3a0 arch/x86/entry/common.c:290
alarm\_timer\_nsleep() uses ktime\_add() to add the current time and the
relative expiry value. ktime\_add() has no sanity checks so the addition
can overflow when the relative timeout is large enough.
Use ktime\_add\_safe() which has the necessary sanity checks in place and
limits the result to the valid range.
Fixes: 9a7adcf5c6de ("timers: Posix interface for alarm-timers")
Reported-by: Team OWL337
Signed-off-by: Thomas Gleixner
Cc: John Stultz
Link: https://lkml.kernel.org/r/alpine.DEB.2.21.1807020926360.1595@nanos.tec.linutronix.de
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4add6942e51ec39a3f9f183700b6bcc3669629d1
Author: Heiko Carstens
Date: Mon Jul 2 10:54:02 2018 +0200
s390/sysinfo: add missing #ifdef CONFIG\_PROC\_FS
[ Upstream commit 9f35b818a2f90fb6cb291aa0c9f835d4f0974a9a ]
Get rid of this compile warning for !PROC\_FS:
CC arch/s390/kernel/sysinfo.o
arch/s390/kernel/sysinfo.c:275:12: warning: 'sysinfo\_show' defined but not used [-Wunused-function]
static int sysinfo\_show(struct seq\_file \*m, void \*v)
Signed-off-by: Heiko Carstens
Signed-off-by: Martin Schwidefsky
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ab0fd80d87471c34912c3691ccfb6d1741f330f3
Author: Ravi Chandra Sadineni
Date: Wed Jun 27 10:55:02 2018 -0700
ACPI / button: increment wakeup count only when notified
[ Upstream commit 7c058c7c74b3dbeb7d157c273959f87faf710350 ]
Because acpi\_lid\_initialize\_state() is called on every system
resume and it triggers acpi\_lid\_notify\_state() which invokes
acpi\_pm\_wakeup\_event() for the lid device, the lid's wakeup count is
incremented even if the lid was not the source of the event that woke up
the system. That behavior confuses user space deamons using
wakeup\_count to identify the potential system wakeup source. To avoid
the confusion, only trigger acpi\_pm\_wakeup\_event() in the
acpi\_button\_notify() path and don't do that in the
acpi\_lid\_initialize\_state() path.
Signed-off-by: Ravi Chandra Sadineni
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f2514c04f556215cda3a4be98ea0215f72187988
Author: João Paulo Rechi Vita
Date: Fri Jun 29 15:12:46 2018 -0700
platform/x86: asus-wireless: Fix uninitialized symbol usage
[ Upstream commit eca4c4e47eb0658ad251f0bff465e23c055377da ]
'ret' will not be initialized if acpi\_evaluate\_integer() returns through
an error path, so it should not be used in this case. This fixes the
following Smatch static analyser error:
drivers/platform/x86/asus-wireless.c:76 asus\_wireless\_method() error:
uninitialized symbol 'ret'.
Reported-by: Dan Carpenter
Signed-off-by: João Paulo Rechi Vita
Signed-off-by: Andy Shevchenko
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 677b34aa38ed7ba6bd1a10883917e5d0b373ff3f
Author: Alexey Kardashevskiy
Date: Fri Jun 1 18:06:16 2018 +1000
powerpc/powernv/ioda2: Reduce upper limit for DMA window size
[ Upstream commit d3d4ffaae439981e1e441ebb125aa3588627c5d8 ]
We use PHB in mode1 which uses bit 59 to select a correct DMA window.
However there is mode2 which uses bits 59:55 and allows up to 32 DMA
windows per a PE.
Even though documentation does not clearly specify that, it seems that
the actual hardware does not support bits 59:55 even in mode1, in other
words we can create a window as big as 1<<58 but DMA simply won't work.
This reduces the upper limit from 59 to 55 bits to let the userspace know
about the hardware limits.
Fixes: 7aafac11e3 "powerpc/powernv/ioda2: Gracefully fail if too many TCE levels requested"
Signed-off-by: Alexey Kardashevskiy
Signed-off-by: Michael Ellerman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ee1df10ae020bfa35589722ace79cc565991919a
Author: Alagu Sankar
Date: Fri Jun 29 16:28:00 2018 +0300
ath10k: sdio: set skb len for all rx packets
[ Upstream commit 8530b4e7b22bc3bd8240579f3844c73947cd5f71 ]
Without this, packets larger than 1500 will silently be dropped.
Easily reproduced by sending a ping packet with a size larger
than 1500.
Co-Developed-by: Niklas Cassel
Signed-off-by: Alagu Sankar
Signed-off-by: Niklas Cassel
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit bd9b4e60690281a2e2f555d7d6e7dc9afcaa3f44
Author: Alagu Sankar
Date: Fri Jun 29 16:27:56 2018 +0300
ath10k: sdio: use same endpoint id for all packets in a bundle
[ Upstream commit 679e1f07c86221b7183dd69df7068fd42d0041f6 ]
All packets in a bundle should use the same endpoint id as the
first lookahead.
This matches how things are done is ath6kl, however,
this patch can theoretically handle several bundles
in ath10k\_sdio\_mbox\_rx\_process\_packets().
Without this patch we get lots of errors about invalid endpoint id:
ath10k\_sdio mmc2:0001:1: invalid endpoint in look-ahead: 224
ath10k\_sdio mmc2:0001:1: failed to get pending recv messages: -12
ath10k\_sdio mmc2:0001:1: failed to process pending SDIO interrupts: -12
Co-Developed-by: Niklas Cassel
Signed-off-by: Alagu Sankar
Signed-off-by: Niklas Cassel
Signed-off-by: Kalle Valo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 420c37a784a77244b5e22e10209f86903537d6fe
Author: Julia Lawall
Date: Sun Jul 1 19:32:04 2018 +0200
usb: wusbcore: security: cast sizeof to int for comparison
[ Upstream commit d3ac5598c5010a8999978ebbcca3b1c6188ca36b ]
Comparing an int to a size, which is unsigned, causes the int to become
unsigned, giving the wrong result. usb\_get\_descriptor can return a
negative error code.
A simplified version of the semantic match that finds this problem is as
follows: (http://coccinelle.lip6.fr/)
//
@@
int x;
expression e,e1;
identifier f;
@@
\*x = f(...);
... when != x = e1
when != if (x < 0 || ...) { ... return ...; }
\*x < sizeof(e)
//
Signed-off-by: Julia Lawall
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 90c00dd1798d4e1cddc312fc6fbd0c2f204f332f
Author: Bart Van Assche
Date: Thu Jun 28 13:48:57 2018 -0500
scsi: target: Avoid that EXTENDED COPY commands trigger lock inversion
[ Upstream commit 36d4cb460bcbe2a1323732a6e4bb9dd783284368 ]
The approach for adding a device to the devices\_idr data structure and for
removing it is as follows:
\* &dev->dev\_group.cg\_item is initialized before a device is added to
devices\_idr.
\* If the reference count of a device drops to zero then
target\_free\_device() removes the device from devices\_idr.
\* All devices\_idr manipulations are protected by device\_mutex.
This means that increasing the reference count of a device is sufficient to
prevent removal from devices\_idr and also that it is safe access
dev\_group.cg\_item for any device that is referenced by devices\_idr. Use
this to modify target\_find\_device() and target\_for\_each\_device() such that
these functions no longer introduce a dependency between device\_mutex and
the configfs root inode mutex.
Note: it is safe to pass a NULL pointer to config\_item\_put() and also to
config\_item\_get\_unless\_zero().
This patch prevents that lockdep reports the following complaint:
======================================================
WARNING: possible circular locking dependency detected
4.12.0-rc1-dbg+ #1 Not tainted
------------------------------------------------------
rmdir/12053 is trying to acquire lock:
(device\_mutex#2){+.+.+.}, at: []
target\_free\_device+0xae/0xf0 [target\_core\_mod]
but task is already holding lock:
(&sb->s\_type->i\_mutex\_key#14){++++++}, at: []
vfs\_rmdir+0x50/0x140
which lock already depends on the new lock.
the existing dependency chain (in reverse order) is:
-> #1 (&sb->s\_type->i\_mutex\_key#14){++++++}:
lock\_acquire+0x59/0x80
down\_write+0x36/0x70
configfs\_depend\_item+0x3a/0xb0 [configfs]
target\_depend\_item+0x13/0x20 [target\_core\_mod]
target\_xcopy\_locate\_se\_dev\_e4\_iter+0x87/0x100 [target\_core\_mod]
target\_devices\_idr\_iter+0x16/0x20 [target\_core\_mod]
idr\_for\_each+0x39/0xc0
target\_for\_each\_device+0x36/0x50 [target\_core\_mod]
target\_xcopy\_locate\_se\_dev\_e4+0x28/0x80 [target\_core\_mod]
target\_xcopy\_do\_work+0x2e9/0xdd0 [target\_core\_mod]
process\_one\_work+0x1ca/0x3f0
worker\_thread+0x49/0x3b0
kthread+0x109/0x140
ret\_from\_fork+0x31/0x40
-> #0 (device\_mutex#2){+.+.+.}:
\_\_lock\_acquire+0x101f/0x11d0
lock\_acquire+0x59/0x80
\_\_mutex\_lock+0x7e/0x950
mutex\_lock\_nested+0x16/0x20
target\_free\_device+0xae/0xf0 [target\_core\_mod]
target\_core\_dev\_release+0x10/0x20 [target\_core\_mod]
config\_item\_put+0x6e/0xb0 [configfs]
configfs\_rmdir+0x1a6/0x300 [configfs]
vfs\_rmdir+0xb7/0x140
do\_rmdir+0x1f4/0x200
SyS\_rmdir+0x11/0x20
entry\_SYSCALL\_64\_fastpath+0x23/0xc2
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(&sb->s\_type->i\_mutex\_key#14);
lock(device\_mutex#2);
lock(&sb->s\_type->i\_mutex\_key#14);
lock(device\_mutex#2);
\*\*\* DEADLOCK \*\*\*
3 locks held by rmdir/12053:
#0: (sb\_writers#10){.+.+.+}, at: []
mnt\_want\_write+0x1f/0x50
#1: (&sb->s\_type->i\_mutex\_key#14/1){+.+.+.}, at: []
do\_rmdir+0x15e/0x200
#2: (&sb->s\_type->i\_mutex\_key#14){++++++}, at: []
vfs\_rmdir+0x50/0x140
stack backtrace:
CPU: 3 PID: 12053 Comm: rmdir Not tainted 4.12.0-rc1-dbg+ #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS
1.0.0-prebuilt.qemu-project.org 04/01/2014
Call Trace:
dump\_stack+0x86/0xcf
print\_circular\_bug+0x1c7/0x220
\_\_lock\_acquire+0x101f/0x11d0
lock\_acquire+0x59/0x80
\_\_mutex\_lock+0x7e/0x950
mutex\_lock\_nested+0x16/0x20
target\_free\_device+0xae/0xf0 [target\_core\_mod]
target\_core\_dev\_release+0x10/0x20 [target\_core\_mod]
config\_item\_put+0x6e/0xb0 [configfs]
configfs\_rmdir+0x1a6/0x300 [configfs]
vfs\_rmdir+0xb7/0x140
do\_rmdir+0x1f4/0x200
SyS\_rmdir+0x11/0x20
entry\_SYSCALL\_64\_fastpath+0x23/0xc2
Signed-off-by: Bart Van Assche
[Rebased to handle conflict withe target\_find\_device removal]
Signed-off-by: Mike Christie
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d08b7218cea00dded98edc96f52d8822901498aa
Author: Breno Leitao
Date: Tue Jun 26 17:35:16 2018 -0300
scsi: ibmvscsi: Improve strings handling
[ Upstream commit 1262dc09dc9ae7bf4ad00b6a2c5ed6a6936bcd10 ]
Currently an open firmware property is copied into partition\_name variable
without keeping a room for \0.
Later one, this variable (partition\_name), which is 97 bytes long, is
strncpyed into ibmvcsci\_host\_data->madapter\_info->partition\_name, which is
96 bytes long, possibly truncating it 'again' and removing the \0.
This patch simply decreases the partition name to 96 and just copy using
strlcpy() which guarantees that the string is \0 terminated. I think there
is no issue if this there is a truncation in this very first copy, i.e,
when the open firmware property is read and copied into the driver for the
very first time;
This issue also causes the following warning on GCC 8:
drivers/scsi/ibmvscsi/ibmvscsi.c:281:2: warning: strncpy output may be truncated copying 96 bytes from a string of length 96 [-Wstringop-truncation]
...
inlined from ibmvscsi\_probe at drivers/scsi/ibmvscsi/ibmvscsi.c:2221:7:
drivers/scsi/ibmvscsi/ibmvscsi.c:265:3: warning: strncpy specified bound 97 equals destination size [-Wstringop-truncation]
CC: Bart Van Assche
CC: Tyrel Datwyler
Signed-off-by: Breno Leitao
Acked-by: Tyrel Datwyler
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 7369c88b59a9b4ecddad2e14d82ba4ce6c7aa160
Author: Bart Van Assche
Date: Fri Jun 22 14:54:49 2018 -0700
scsi: klist: Make it safe to use klists in atomic context
[ Upstream commit 624fa7790f80575a4ec28fbdb2034097dc18d051 ]
In the scsi\_transport\_srp implementation it cannot be avoided to
iterate over a klist from atomic context when using the legacy block
layer instead of blk-mq. Hence this patch that makes it safe to use
klists in atomic context. This patch avoids that lockdep reports the
following:
WARNING: SOFTIRQ-safe -> SOFTIRQ-unsafe lock order detected
Possible interrupt unsafe locking scenario:
CPU0 CPU1
---- ----
lock(&(&k->k\_lock)->rlock);
local\_irq\_disable();
lock(&(&q->\_\_queue\_lock)->rlock);
lock(&(&k->k\_lock)->rlock);
lock(&(&q->\_\_queue\_lock)->rlock);
stack backtrace:
Workqueue: kblockd blk\_timeout\_work
Call Trace:
dump\_stack+0xa4/0xf5
check\_usage+0x6e6/0x700
\_\_lock\_acquire+0x185d/0x1b50
lock\_acquire+0xd2/0x260
\_raw\_spin\_lock+0x32/0x50
klist\_next+0x47/0x190
device\_for\_each\_child+0x8e/0x100
srp\_timed\_out+0xaf/0x1d0 [scsi\_transport\_srp]
scsi\_times\_out+0xd4/0x410 [scsi\_mod]
blk\_rq\_timed\_out+0x36/0x70
blk\_timeout\_work+0x1b5/0x220
process\_one\_work+0x4fe/0xad0
worker\_thread+0x63/0x5a0
kthread+0x1c1/0x1e0
ret\_from\_fork+0x24/0x30
See also commit c9ddf73476ff ("scsi: scsi\_transport\_srp: Fix shost to
rport translation").
Signed-off-by: Bart Van Assche
Cc: Martin K. Petersen
Cc: James Bottomley
Acked-by: Greg Kroah-Hartman
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9d6b653c050973971b1ab8791d445b692871ab0c
Author: Jean-Christophe Dubois
Date: Sun Jul 1 00:10:50 2018 +0200
thermal: i.MX: Allow thermal probe to fail gracefully in case of bad calibration.
[ Upstream commit be926ceeb4efc3bf44cb9b56f5c71aac9b1f8bbe ]
Without this fix, the thermal probe on i.MX6 might trigger a division
by zero exception later in the probe if the calibration does fail.
Note: This linux behavior (Division by zero in kernel) has been triggered
on a Qemu i.MX6 emulation where parameters in nvmem were not set. With this
fix the division by zero is not triggeed anymore as the thermal probe does
fail early.
Signed-off-by: Jean-Christophe Dubois
Reviewed-by: Fabio Estevam
Signed-off-by: Eduardo Valentin
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 92e96ad168ea8772b32bd6fe0d36d989b65feb58
Author: Bart Van Assche
Date: Fri Jun 22 14:53:01 2018 -0700
scsi: target/iscsi: Make iscsit\_ta\_authentication() respect the output buffer size
[ Upstream commit 35bea5c84fd13c643cce63f0b5cd4b148f8c901d ]
Fixes: e48354ce078c ("iscsi-target: Add iSCSI fabric support for target v4.1")
Signed-off-by: Bart Van Assche
Reviewed-by: Mike Christie
Cc: Mike Christie
Cc: Christoph Hellwig
Cc: Hannes Reinecke
Signed-off-by: Martin K. Petersen
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6cf7be0267f7f5943fc038f47d314e66407a60f5
Author: Viresh Kumar
Date: Fri May 25 16:01:48 2018 +0530
ARM: dts: ls1021a: Add missing cooling device properties for CPUs
[ Upstream commit 47768f372eae030db6fab5225f9504a820d2c07f ]
The cooling device properties, like "#cooling-cells" and
"dynamic-power-coefficient", should either be present for all the CPUs
of a cluster or none. If these are present only for a subset of CPUs of
a cluster then things will start falling apart as soon as the CPUs are
brought online in a different order. For example, this will happen
because the operating system looks for such properties in the CPU node
it is trying to bring up, so that it can register a cooling device.
Add such missing properties.
Signed-off-by: Viresh Kumar
Signed-off-by: Shawn Guo
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit f0c6c6ec02a133bacfe5ef93f3e40d8a612c9df8
Author: Jan Beulich
Date: Mon Jul 2 04:47:57 2018 -0600
x86/entry/64: Add two more instruction suffixes
[ Upstream commit 6709812f094d96543b443645c68daaa32d3d3e77 ]
Sadly, other than claimed in:
a368d7fd2a ("x86/entry/64: Add instruction suffix")
... there are two more instances which want to be adjusted.
As said there, omitting suffixes from instructions in AT&T mode is bad
practice when operand size cannot be determined by the assembler from
register operands, and is likely going to be warned about by upstream
gas in the future (mine does already).
Add the other missing suffixes here as well.
Signed-off-by: Jan Beulich
Cc: Andy Lutomirski
Cc: Borislav Petkov
Cc: Brian Gerst
Cc: Denys Vlasenko
Cc: H. Peter Anvin
Cc: Josh Poimboeuf
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Link: http://lkml.kernel.org/r/5B3A02DD02000078001CFB78@prv1-mh.provo.novell.com
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 06f91031931aa727e1479878de487e303648c5a2
Author: Dave Gerlach
Date: Thu Jun 21 14:43:08 2018 +0530
ARM: hwmod: RTC: Don't assume lock/unlock will be called with irq enabled
[ Upstream commit 6d609b35c815ba20132b7b64bcca04516bb17c56 ]
When the RTC lock and unlock functions were introduced it was likely
assumed that they would always be called from irq enabled context, hence
the use of local\_irq\_disable/enable. This is no longer true as the
RTC+DDR path makes a late call during the suspend path after irqs
have been disabled to enable the RTC hwmod which calls both unlock and
lock, leading to IRQs being reenabled through the local\_irq\_enable call
in omap\_hwmod\_rtc\_lock call.
To avoid this change the local\_irq\_disable/enable to
local\_irq\_save/restore to ensure that from whatever context this is
called the proper IRQ configuration is maintained.
Signed-off-by: Dave Gerlach
Signed-off-by: Keerthy
Signed-off-by: Tony Lindgren
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 11a88b9218e7b41a2d773593cca2c6fe557d118c
Author: Andy Shevchenko
Date: Fri Jun 29 22:31:10 2018 +0300
x86/tsc: Add missing header to tsc\_msr.c
[ Upstream commit dbd0fbc76c77daac08ddd245afdcbade0d506e19 ]
Add a missing header otherwise compiler warns about missed prototype:
CC arch/x86/kernel/tsc\_msr.o
arch/x86/kernel/tsc\_msr.c:73:15: warning: no previous prototype for ‘cpu\_khz\_from\_msr’ [-Wmissing-prototypes]
unsigned long cpu\_khz\_from\_msr(void)
^~~~~~~~~~~~~~~~
Signed-off-by: Andy Shevchenko
Signed-off-by: Thomas Gleixner
Cc: "H. Peter Anvin"
Cc: Pavel Tatashin
Link: https://lkml.kernel.org/r/20180629193113.84425-4-andriy.shevchenko@linux.intel.com
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 2bffdc28ee6029df705996f6b5566ccd049673c6
Author: Bart Van Assche
Date: Mon Jul 2 10:06:51 2018 -0700
include/rdma/opa\_addr.h: Fix an endianness issue
[ Upstream commit 4eefd62c17a9a5e7576207e84f3d2b4f73aba750 ]
IB\_MULTICAST\_LID\_BASE is defined as follows:
#define IB\_MULTICAST\_LID\_BASE cpu\_to\_be16(0xC000)
Hence use be16\_to\_cpu() to convert it to CPU endianness. Compile-tested
only.
Fixes: af808ece5ce9 ("IB/SA: Check dlid before SA agent queries for ClassPortInfo")
Signed-off-by: Bart Van Assche
Cc: Venkata Sandeep Dhanalakota
Cc: Mike Marciniszyn
Cc: Dennis Dalessandro
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit b40f2ec52bf5647c4a1e71d73cd5a37a650f2944
Author: Maor Gottlieb
Date: Sun Jul 1 15:50:17 2018 +0300
IB/mlx5: Fix GRE flow specification
[ Upstream commit a93b632c4531ff50c43d658447a45cbc11f488fd ]
Currently the driver sets the mask of the gre\_protocol to 0xffff
without consideration in the user request.
Fix it by copy the mask from the verbs spec.
Fixes: da2f22ae7707 ("IB/mlx5: Add support for GRE flow specification")
Signed-off-by: Maor Gottlieb
Reviewed-by: Ariel Levkovich
Signed-off-by: Leon Romanovsky
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c26fc717b13ba97901add97c7ef91c6b8a5921f5
Author: Peter Seiderer
Date: Thu Mar 15 15:13:22 2018 -0400
media: staging/imx: fill vb2\_v4l2\_buffer field entry
[ Upstream commit a38d4b71cb7a12b65317f4e3d59883a918957719 ]
- fixes gstreamer v4l2src warning:
0:00:00.716640334 349 0x164f720 WARN v4l2bufferpool gstv4l2bufferpool.c:1195:gst\_v4l2\_buffer\_pool\_dqbuf: Driver should never set v4l2\_buffer.field to ANY
- fixes v4l2-compliance test failure:
Streaming ioctls:
test read/write: OK (Not Supported)
Video Capture:
Buffer: 0 Sequence: 0 Field: Any Timestamp: 58.383658s
fail: v4l2-test-buffers.cpp(297): g\_field() == V4L2\_FIELD\_ANY
Signed-off-by: Peter Seiderer
Reviewed-by: Steve Longerbeam
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 0bd77cd5c2dac5a21bfe16eb61c9e449f8ab24e3
Author: Toshiaki Makita
Date: Tue Jul 3 16:31:32 2018 +0900
vhost\_net: Avoid tx vring kicks during busyloop
[ Upstream commit 027b17603b030f1334ade079b7a3e986569c956b ]
Under heavy load vhost busypoll may run without suppressing
notification. For example tx zerocopy callback can push tx work while
handle\_tx() is running, then busyloop exits due to vhost\_has\_work()
condition and enables notification but immediately reenters handle\_tx()
because the pushed work was tx. In this case handle\_tx() tries to
disable notification again, but when using event\_idx it by design
cannot. Then busyloop will run without suppressing notification.
Another example is the case where handle\_tx() tries to enable
notification but avail idx is advanced so disables it again. This case
also leads to the same situation with event\_idx.
The problem is that once we enter this situation busyloop does not work
under heavy load for considerable amount of time, because notification
is likely to happen during busyloop and handle\_tx() immediately enables
notification after notification happens. Specifically busyloop detects
notification by vhost\_has\_work() and then handle\_tx() calls
vhost\_enable\_notify(). Because the detected work was the tx work, it
enters handle\_tx(), and enters busyloop without suppression again.
This is likely to be repeated, so with event\_idx we are almost not able
to suppress notification in this case.
To fix this, poll the work instead of enabling notification when
busypoll is interrupted by something. IMHO vhost\_has\_work() is kind of
interruption rather than a signal to completely cancel the busypoll, so
let's run busypoll after the necessary work is done.
Signed-off-by: Toshiaki Makita
Acked-by: Jason Wang
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit af58a41db9cc506bb323982a3d2e56a21fad9934
Author: Alexey Khoroshilov
Date: Fri Jun 29 17:49:22 2018 -0400
media: fsl-viu: fix error handling in viu\_of\_probe()
[ Upstream commit 662a99e145661c2b35155cf375044deae9b79896 ]
viu\_of\_probe() ignores fails in i2c\_get\_adapter(),
tries to unlock uninitialized mutex on error path.
The patch streamlining the error handling in viu\_of\_probe().
Found by Linux Driver Verification project (linuxtesting.org).
Signed-off-by: Alexey Khoroshilov
Signed-off-by: Hans Verkuil
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ec0e373a62147960a4ab8692e33e0658ccccc9b1
Author: Hari Bathini
Date: Thu Jun 28 10:49:56 2018 +0530
powerpc/kdump: Handle crashkernel memory reservation failure
[ Upstream commit 8950329c4a64c6d3ca0bc34711a1afbd9ce05657 ]
Memory reservation for crashkernel could fail if there are holes around
kdump kernel offset (128M). Fail gracefully in such cases and print an
error message.
Signed-off-by: Hari Bathini
Tested-by: David Gibson
Reviewed-by: Dave Young
Signed-off-by: Michael Ellerman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4fd56423854c4a811a671762fbd3f5505ec1ff45
Author: Tarick Bedeir
Date: Mon Jul 2 14:02:34 2018 -0700
IB/mlx4: Test port number before querying type.
[ Upstream commit f1228867adaf8890826f2b59e4caddb1c5cc2df7 ]
rdma\_ah\_find\_type() can reach into ib\_device->port\_immutable with a
potentially out-of-bounds port number, so check that the port number is
valid first.
Fixes: 44c58487d51a ("IB/core: Define 'ib' and 'roce' rdma\_ah\_attr types")
Signed-off-by: Tarick Bedeir
Reviewed-by: Leon Romanovsky
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 76e2bf1d322a899d1d5a5e855dc5072922ec860e
Author: Sylwester Nawrocki
Date: Tue May 15 05:21:45 2018 -0400
media: exynos4-is: Prevent NULL pointer dereference in \_\_isp\_video\_try\_fmt()
[ Upstream commit 7c1b9a5aeed91bef98988ac0fcf38c8c1f4f9a3a ]
This patch fixes potential NULL pointer dereference as indicated
by the following static checker warning:
drivers/media/platform/exynos4-is/fimc-isp-video.c:408 isp\_video\_try\_fmt\_mplane()
error: NULL dereference inside function '\_\_isp\_video\_try\_fmt(isp, &f->fmt.pix\_mp, (0))()'.
Fixes: 34947b8aebe3: ("[media] exynos4-is: Add the FIMC-IS ISP capture DMA driver")
Reported-by: Dan Carpenter
Signed-off-by: Sylwester Nawrocki
Signed-off-by: Mauro Carvalho Chehab
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 203ae10a4713a8ee70775182b3cf0dc4052ca124
Author: Dan Carpenter
Date: Wed Jul 4 12:32:12 2018 +0300
IB/core: type promotion bug in rdma\_rw\_init\_one\_mr()
[ Upstream commit c2d7c8ff89b22ddefb1ac2986c0d48444a667689 ]
"nents" is an unsigned int, so if ib\_map\_mr\_sg() returns a negative
error code then it's type promoted to a high unsigned int which is
treated as success.
Fixes: a060b5629ab0 ("IB/core: generic RDMA READ/WRITE API")
Signed-off-by: Dan Carpenter
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 16fc25226707f4ac91844fe5117c16956f37908f
Author: Dan Carpenter
Date: Wed Jul 4 12:58:02 2018 +0300
RDMA/bnxt\_re: Fix a bunch of off by one bugs in qplib\_fp.c
[ Upstream commit c1dfc0114c901b4f46c85ceff0491debf2b2a2ec ]
The srq->swq[] is allocated in bnxt\_qplib\_create\_srq(). It has
srq->hwq.max\_elements elements so these tests should be > instead of >=
or we might go beyond the end of the array.
Fixes: 1ac5a4047975 ("RDMA/bnxt\_re: Add bnxt\_re RoCE driver")
Signed-off-by: Dan Carpenter
Acked-by: Selvin Xavier
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6a4d21a7664b3b2a62b7bf9fbd0b89b52c30acef
Author: Leon Romanovsky
Date: Sun Jul 1 19:36:24 2018 +0300
RDMA/i40w: Hold read semaphore while looking after VMA
[ Upstream commit 5d9a2b0e28759e319a623da33940dbb3ce952b7d ]
VMA lookup is supposed to be performed while mmap\_sem is held.
Fixes: f26c7c83395b ("i40iw: Add 2MB page support")
Signed-off-by: Leon Romanovsky
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 5ae7031fea6aca491cdc15dd28b2b93f8c7c4b11
Author: Dan Carpenter
Date: Wed Jul 4 12:57:11 2018 +0300
RDMA/bnxt\_re: Fix a couple off by one bugs
[ Upstream commit 474e5a86067e5f12c97d1db8b170c7f45b53097a ]
The sgid\_tbl->tbl[] array is allocated in bnxt\_qplib\_alloc\_sgid\_tbl().
It has sgid\_tbl->max elements. So the > should be >= to prevent
accessing one element beyond the end of the array.
Fixes: 1ac5a4047975 ("RDMA/bnxt\_re: Add bnxt\_re RoCE driver")
Signed-off-by: Dan Carpenter
Acked-by: Selvin Xavier
Signed-off-by: Jason Gunthorpe
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit be853349a4a9784eac564fec0467ad68595e617f
Author: Ganesh Goudar
Date: Wed Jul 4 17:49:33 2018 +0530
cxgb4: Fix the condition to check if the card is T5
[ Upstream commit dfecc759e64b0ea581468fe2359836f1998deac9 ]
Use 'chip\_ver' rather than 'chip' to check if the card
is T5.
Fixes: e8d452923ae6 ("cxgb4: clean up init\_one")
Signed-off-by: Ganesh Goudar
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 69b921bdab4be3885582b3badc4f992c78677b83
Author: Guoqing Jiang
Date: Mon Jul 2 16:26:24 2018 +0800
md-cluster: clear another node's suspend\_area after the copy is finished
[ Upstream commit 010228e4a932ca1e8365e3b58c8e1e44c16ff793 ]
When one node leaves cluster or stops the resyncing
(resync or recovery) array, then other nodes need to
call recover\_bitmaps to continue the unfinished task.
But we need to clear suspend\_area later after other
nodes copy the resync information to their bitmap
(by call bitmap\_copy\_from\_slot). Otherwise, all nodes
could write to the suspend\_area even the suspend\_area
is not handled by any node, because area\_resyncing
returns 0 at the beginning of raid1\_write\_request.
Which means one node could write suspend\_area while
another node is resyncing the same area, then data
could be inconsistent.
So let's clear suspend\_area later to avoid above issue
with the protection of bm lock. Also it is straightforward
to clear suspend\_area after nodes have copied the resync
info to bitmap.
Signed-off-by: Guoqing Jiang
Reviewed-by: NeilBrown
Signed-off-by: Shaohua Li
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit dd5ac3dcb22eb0f30cfa3137542fdec260bca0ef
Author: Wesley Chalmers
Date: Tue May 29 17:45:05 2018 -0400
drm/amd/display: fix use of uninitialized memory
[ Upstream commit f3e077d95ca0a016fdf3d6b1e97a9910dfdaff17 ]
DML does not calculate chroma values for RQ when surface is not YUV, but DC
will unconditionally use the uninitialized values for HW programming.
This does not cause visual corruption since HW will ignore garbage chroma
values when surface is not YUV, but causes presubmission tests to fail
golden value comparison.
Signed-off-by: Wesley Chalmers
Signed-off-by: Eryk Brol
Reviewed-by: Wenjing Liu
Acked-by: Harry Wentland
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e21238f1be65530a0d747e9f91202820fe73ce32
Author: Gustavo A. R. Silva
Date: Wed Jul 4 08:22:11 2018 -0500
drm/amd/display/dc/dce: Fix multiple potential integer overflows
[ Upstream commit 6f3472a993e7cb63cde5d818dcabc8e42fc03744 ]
Add suffix ULL to constant 5 and cast variables target\_pix\_clk\_khz and
feedback\_divider to uint64\_t in order to avoid multiple potential integer
overflows and give the compiler complete information about the proper
arithmetic to use.
Notice that such constant and variables are used in contexts that
expect expressions of type uint64\_t (64 bits, unsigned). The current
casts to uint64\_t effectively apply to each expression as a whole,
but they do not prevent them from being evaluated using 32-bit
arithmetic instead of 64-bit arithmetic.
Also, once the expressions are properly evaluated using 64-bit
arithmentic, there is no need for the parentheses that enclose
them.
Addresses-Coverity-ID: 1460245 ("Unintentional integer overflow")
Addresses-Coverity-ID: 1460286 ("Unintentional integer overflow")
Addresses-Coverity-ID: 1460401 ("Unintentional integer overflow")
Fixes: 4562236b3bc0 ("drm/amd/dc: Add dc display driver (v2)")
Signed-off-by: Gustavo A. R. Silva
Reviewed-by: Harry Wentland
Signed-off-by: Alex Deucher
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9fa1c8f4b9b2e919330840a98fac32ae2817fae9
Author: Benjamin Tissoires
Date: Mon Jun 25 09:51:48 2018 +0200
power: remove possible deadlock when unregistering power\_supply
[ Upstream commit 3ffa6583e24e1ad1abab836d24bfc9d2308074e5 ]
If a device gets removed right after having registered a power\_supply node,
we might enter in a deadlock between the remove call (that has a lock on
the parent device) and the deferred register work.
Allow the deferred register work to exit without taking the lock when
we are in the remove state.
Stack trace on a Ubuntu 16.04:
[16072.109121] INFO: task kworker/u16:2:1180 blocked for more than 120 seconds.
[16072.109127] Not tainted 4.13.0-41-generic #46~16.04.1-Ubuntu
[16072.109129] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[16072.109132] kworker/u16:2 D 0 1180 2 0x80000000
[16072.109142] Workqueue: events\_power\_efficient power\_supply\_deferred\_register\_work
[16072.109144] Call Trace:
[16072.109152] \_\_schedule+0x3d6/0x8b0
[16072.109155] schedule+0x36/0x80
[16072.109158] schedule\_preempt\_disabled+0xe/0x10
[16072.109161] \_\_mutex\_lock.isra.2+0x2ab/0x4e0
[16072.109166] \_\_mutex\_lock\_slowpath+0x13/0x20
[16072.109168] ? \_\_mutex\_lock\_slowpath+0x13/0x20
[16072.109171] mutex\_lock+0x2f/0x40
[16072.109174] power\_supply\_deferred\_register\_work+0x2b/0x50
[16072.109179] process\_one\_work+0x15b/0x410
[16072.109182] worker\_thread+0x4b/0x460
[16072.109186] kthread+0x10c/0x140
[16072.109189] ? process\_one\_work+0x410/0x410
[16072.109191] ? kthread\_create\_on\_node+0x70/0x70
[16072.109194] ret\_from\_fork+0x35/0x40
[16072.109199] INFO: task test:2257 blocked for more than 120 seconds.
[16072.109202] Not tainted 4.13.0-41-generic #46~16.04.1-Ubuntu
[16072.109204] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[16072.109206] test D 0 2257 2256 0x00000004
[16072.109208] Call Trace:
[16072.109211] \_\_schedule+0x3d6/0x8b0
[16072.109215] schedule+0x36/0x80
[16072.109218] schedule\_timeout+0x1f3/0x360
[16072.109221] ? check\_preempt\_curr+0x5a/0xa0
[16072.109224] ? ttwu\_do\_wakeup+0x1e/0x150
[16072.109227] wait\_for\_completion+0xb4/0x140
[16072.109230] ? wait\_for\_completion+0xb4/0x140
[16072.109233] ? wake\_up\_q+0x70/0x70
[16072.109236] flush\_work+0x129/0x1e0
[16072.109240] ? worker\_detach\_from\_pool+0xb0/0xb0
[16072.109243] \_\_cancel\_work\_timer+0x10f/0x190
[16072.109247] ? device\_del+0x264/0x310
[16072.109250] ? \_\_wake\_up+0x44/0x50
[16072.109253] cancel\_delayed\_work\_sync+0x13/0x20
[16072.109257] power\_supply\_unregister+0x37/0xb0
[16072.109260] devm\_power\_supply\_release+0x11/0x20
[16072.109263] release\_nodes+0x110/0x200
[16072.109266] devres\_release\_group+0x7c/0xb0
[16072.109274] wacom\_remove+0xc2/0x110 [wacom]
[16072.109279] hid\_device\_remove+0x6e/0xd0 [hid]
[16072.109284] device\_release\_driver\_internal+0x158/0x210
[16072.109288] device\_release\_driver+0x12/0x20
[16072.109291] bus\_remove\_device+0xec/0x160
[16072.109293] device\_del+0x1de/0x310
[16072.109298] hid\_destroy\_device+0x27/0x60 [hid]
[16072.109303] usbhid\_disconnect+0x51/0x70 [usbhid]
[16072.109308] usb\_unbind\_interface+0x77/0x270
[16072.109311] device\_release\_driver\_internal+0x158/0x210
[16072.109315] device\_release\_driver+0x12/0x20
[16072.109318] usb\_driver\_release\_interface+0x77/0x80
[16072.109321] proc\_ioctl+0x20f/0x250
[16072.109325] usbdev\_do\_ioctl+0x57f/0x1140
[16072.109327] ? \_\_wake\_up+0x44/0x50
[16072.109331] usbdev\_ioctl+0xe/0x20
[16072.109336] do\_vfs\_ioctl+0xa4/0x600
[16072.109339] ? vfs\_write+0x15a/0x1b0
[16072.109343] SyS\_ioctl+0x79/0x90
[16072.109347] entry\_SYSCALL\_64\_fastpath+0x24/0xab
[16072.109349] RIP: 0033:0x7f20da807f47
[16072.109351] RSP: 002b:00007ffc422ae398 EFLAGS: 00000246 ORIG\_RAX: 0000000000000010
[16072.109353] RAX: ffffffffffffffda RBX: 00000000010b8560 RCX: 00007f20da807f47
[16072.109355] RDX: 00007ffc422ae3a0 RSI: 00000000c0105512 RDI: 0000000000000009
[16072.109356] RBP: 0000000000000000 R08: 00007ffc422ae3e0 R09: 0000000000000010
[16072.109357] R10: 00000000000000a6 R11: 0000000000000246 R12: 0000000000000000
[16072.109359] R13: 00000000010b8560 R14: 00007ffc422ae2e0 R15: 0000000000000000
Reported-and-tested-by: Richard Hughes
Tested-by: Aaron Skomra
Signed-off-by: Benjamin Tissoires
Fixes: 7f1a57fdd6cb ("power\_supply: Fix possible NULL pointer dereference on early uevent")
Signed-off-by: Sebastian Reichel
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit ff8aa171ef8c6fde8305ee3de843f2c08b24f966
Author: Vasily Gorbik
Date: Sun Jun 24 12:17:43 2018 +0200
s390/mm: correct allocate\_pgste proc\_handler callback
[ Upstream commit 5bedf8aa03c28cb8dc98bdd32a41b66d8f7d3eaa ]
Since proc\_dointvec does not perform value range control,
proc\_dointvec\_minmax should be used to limit value range, which is
clearly intended here, as the internal representation of the value:
unsigned int alloc\_pgste:1;
In fact it currently works, since we have
mm->context.alloc\_pgste = page\_table\_allocate\_pgste || ...
... since commit 23fefe119ceb5 ("s390/kvm: avoid global config of vm.alloc\_pgste=1")
Before that it was
mm->context.alloc\_pgste = page\_table\_allocate\_pgste;
which was broken. That was introduced with commit 0b46e0a3ec0d7 ("s390/kvm:
remove delayed reallocation of page tables for KVM").
Fixes: 0b46e0a3ec0d7 ("s390/kvm: remove delayed reallocation of page tables for KVM")
Acked-by: Christian Borntraeger
Reviewed-by: Heiko Carstens
Signed-off-by: Vasily Gorbik
Signed-off-by: Martin Schwidefsky
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 596ee3e366eb6d26c3c27fe852e847efac817d85
Author: Niklas Cassel
Date: Tue Jun 12 16:06:10 2018 +0200
iommu/msm: Don't call iommu\_device\_{,un}link from atomic context
[ Upstream commit 379521462e4add27f3514da8e4ab1fd7a54fe1c7 ]
Fixes the following splat during boot:
BUG: sleeping function called from invalid context at kernel/locking/mutex.c:747
in\_atomic(): 1, irqs\_disabled(): 128, pid: 77, name: kworker/2:1
4 locks held by kworker/2:1/77:
#0: (ptrval) ((wq\_completion)"events"){+.+.}, at: process\_one\_work+0x1fc/0x8fc
#1: (ptrval) (deferred\_probe\_work){+.+.}, at: process\_one\_work+0x1fc/0x8fc
#2: (ptrval) (&dev->mutex){....}, at: \_\_device\_attach+0x40/0x178
#3: (ptrval) (msm\_iommu\_lock){....}, at: msm\_iommu\_add\_device+0x28/0xcc
irq event stamp: 348
hardirqs last enabled at (347): [] kfree+0xe0/0x3c0
hardirqs last disabled at (348): [] \_raw\_spin\_lock\_irqsave+0x2c/0x68
softirqs last enabled at (0): [] copy\_process.part.5+0x280/0x1a68
softirqs last disabled at (0): [<00000000>] (null)
Preemption disabled at:
[<00000000>] (null)
CPU: 2 PID: 77 Comm: kworker/2:1 Not tainted 4.17.0-rc5-wt-ath-01075-gaca0516bb4cf #239
Hardware name: Generic DT based system
Workqueue: events deferred\_probe\_work\_func
[] (unwind\_backtrace) from [] (show\_stack+0x20/0x24)
[] (show\_stack) from [] (dump\_stack+0xa0/0xcc)
[] (dump\_stack) from [] (\_\_\_might\_sleep+0x1f8/0x2d4)
ath10k\_sdio mmc2:0001:1: Direct firmware load for ath10k/QCA9377/hw1.0/board-2.bin failed with error -2
[] (\_\_\_might\_sleep) from [] (\_\_might\_sleep+0x70/0xa8)
[] (\_\_might\_sleep) from [] (\_\_mutex\_lock+0x50/0xb28)
[] (\_\_mutex\_lock) from [] (mutex\_lock\_nested+0x2c/0x34)
ath10k\_sdio mmc2:0001:1: board\_file api 1 bmi\_id N/A crc32 544289f7
[] (mutex\_lock\_nested) from [] (kernfs\_find\_and\_get\_ns+0x30/0x5c)
[] (kernfs\_find\_and\_get\_ns) from [] (sysfs\_add\_link\_to\_group+0x28/0x58)
[] (sysfs\_add\_link\_to\_group) from [] (iommu\_device\_link+0x50/0xb4)
[] (iommu\_device\_link) from [] (msm\_iommu\_add\_device+0xa0/0xcc)
[] (msm\_iommu\_add\_device) from [] (add\_iommu\_group+0x3c/0x64)
[] (add\_iommu\_group) from [] (bus\_for\_each\_dev+0x84/0xc4)
[] (bus\_for\_each\_dev) from [] (bus\_set\_iommu+0xd0/0x10c)
[] (bus\_set\_iommu) from [] (msm\_iommu\_probe+0x5b8/0x66c)
[] (msm\_iommu\_probe) from [] (platform\_drv\_probe+0x60/0xbc)
[] (platform\_drv\_probe) from [] (driver\_probe\_device+0x30c/0x4cc)
[] (driver\_probe\_device) from [] (\_\_device\_attach\_driver+0xac/0x14c)
[] (\_\_device\_attach\_driver) from [] (bus\_for\_each\_drv+0x68/0xc8)
[] (bus\_for\_each\_drv) from [] (\_\_device\_attach+0xe4/0x178)
[] (\_\_device\_attach) from [] (device\_initial\_probe+0x1c/0x20)
[] (device\_initial\_probe) from [] (bus\_probe\_device+0x98/0xa0)
[] (bus\_probe\_device) from [] (deferred\_probe\_work\_func+0x74/0x198)
[] (deferred\_probe\_work\_func) from [] (process\_one\_work+0x2c4/0x8fc)
[] (process\_one\_work) from [] (worker\_thread+0x2c4/0x5cc)
[] (worker\_thread) from [] (kthread+0x180/0x188)
[] (kthread) from [] (ret\_from\_fork+0x14/0x20)
Fixes: 42df43b36163 ("iommu/msm: Make use of iommu\_device\_register interface")
Signed-off-by: Niklas Cassel
Reviewed-by: Vivek Gautam
Signed-off-by: Joerg Roedel
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c4ea4d6928bd47cc5c4a3e5676c776cad453efc3
Author: Michael Scott
Date: Tue Jun 19 16:44:06 2018 -0700
6lowpan: iphc: reset mac\_header after decompress to fix panic
[ Upstream commit 03bc05e1a4972f73b4eb8907aa373369e825c252 ]
After decompression of 6lowpan socket data, an IPv6 header is inserted
before the existing socket payload. After this, we reset the
network\_header value of the skb to account for the difference in payload
size from prior to decompression + the addition of the IPv6 header.
However, we fail to reset the mac\_header value.
Leaving the mac\_header value untouched here, can cause a calculation
error in net/packet/af\_packet.c packet\_rcv() function when an
AF\_PACKET socket is opened in SOCK\_RAW mode for use on a 6lowpan
interface.
On line 2088, the data pointer is moved backward by the value returned
from skb\_mac\_header(). If skb->data is adjusted so that it is before
the skb->head pointer (which can happen when an old value of mac\_header
is left in place) the kernel generates a panic in net/core/skbuff.c
line 1717.
This panic can be generated by BLE 6lowpan interfaces (such as bt0) and
802.15.4 interfaces (such as lowpan0) as they both use the same 6lowpan
sources for compression and decompression.
Signed-off-by: Michael Scott
Acked-by: Alexander Aring
Acked-by: Jukka Rissanen
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d3f86dceb54c6915ac2c5741264c68a3223fc2cb
Author: Johan Hovold
Date: Wed Jul 4 17:02:18 2018 +0200
USB: serial: kobil\_sct: fix modem-status error handling
[ Upstream commit a420b5d939ee58f1d950f0ea782834056520aeaa ]
Make sure to return -EIO in case of a short modem-status read request.
While at it, split the debug message to not include the (zeroed)
transfer-buffer content in case of errors.
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Johan Hovold
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 41086956a32b8e70e606e95c194b68051e3af0a6
Author: Jian-Hong Pan
Date: Fri May 25 17:54:52 2018 +0800
Bluetooth: Add a new Realtek 8723DE ID 0bda:b009
[ Upstream commit 45ae68b8cfc25bdbffc11248001c47ab1b76ff6e ]
Without this patch we cannot turn on the Bluethooth adapter on HP
14-bs007la.
T: Bus=01 Lev=02 Prnt=03 Port=00 Cnt=01 Dev#= 4 Spd=12 MxCh= 0
D: Ver= 1.10 Cls=e0(wlcon) Sub=01 Prot=01 MxPS=64 #Cfgs= 1
P: Vendor=0bda ProdID=b009 Rev= 2.00
S: Manufacturer=Realtek
S: Product=802.11n WLAN Adapter
S: SerialNumber=00e04c000001
C:\* #Ifs= 2 Cfg#= 1 Atr=e0 MxPwr=500mA
I:\* If#= 0 Alt= 0 #EPs= 3 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=81(I) Atr=03(Int.) MxPS= 16 Ivl=1ms
E: Ad=02(O) Atr=02(Bulk) MxPS= 64 Ivl=0ms
E: Ad=82(I) Atr=02(Bulk) MxPS= 64 Ivl=0ms
I:\* If#= 1 Alt= 0 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 0 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 0 Ivl=1ms
I: If#= 1 Alt= 1 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 9 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 9 Ivl=1ms
I: If#= 1 Alt= 2 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 17 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 17 Ivl=1ms
I: If#= 1 Alt= 3 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 25 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 25 Ivl=1ms
I: If#= 1 Alt= 4 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 33 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 33 Ivl=1ms
I: If#= 1 Alt= 5 #EPs= 2 Cls=e0(wlcon) Sub=01 Prot=01 Driver=btusb
E: Ad=03(O) Atr=01(Isoc) MxPS= 49 Ivl=1ms
E: Ad=83(I) Atr=01(Isoc) MxPS= 49 Ivl=1ms
Signed-off-by: Jian-Hong Pan
Signed-off-by: Marcel Holtmann
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 9032c7d6d57f3accf8b9546f668d5ec9412f7d17
Author: Zhen Lei
Date: Wed Jun 6 10:18:46 2018 +0800
iommu/amd: make sure TLB to be flushed before IOVA freed
[ Upstream commit 3c120143f584360a13614787e23ae2cdcb5e5ccd ]
Although the mapping has already been removed in the page table, it maybe
still exist in TLB. Suppose the freed IOVAs is reused by others before the
flush operation completed, the new user can not correctly access to its
meomory.
Signed-off-by: Zhen Lei
Fixes: b1516a14657a ('iommu/amd: Implement flush queue')
Signed-off-by: Joerg Roedel
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 8ae46971d69e888a0fd3569d3adae0aeef7d9c4a
Author: Sudeep Holla
Date: Mon Jun 18 16:54:32 2018 +0100
power: vexpress: fix corruption in notifier registration
[ Upstream commit 09bebb1adb21ecd04adf7ccb3b06f73e3a851e93 ]
Vexpress platforms provide two different restart handlers: SYS\_REBOOT
that restart the entire system, while DB\_RESET only restarts the
daughter board containing the CPU. DB\_RESET is overridden by SYS\_REBOOT
if it exists.
notifier\_chain\_register used in register\_restart\_handler by design
relies on notifiers to be registered once only, however vexpress restart
notifier can get registered twice. When this happen it corrupts list
of notifiers, as result some notifiers can be not called on proper
event, traverse on list can be cycled forever, and second unregister
can access already freed memory.
So far, since this was the only restart handler in the system, no issue
was observed even if the same notifier was registered twice. However
commit 6c5c0d48b686 ("watchdog: sp805: add restart handler") added
support for SP805 restart handlers and since the system under test
contains two vexpress restart and two SP805 watchdog instances, it was
observed that during the boot traversing the restart handler list looped
forever as there's a cycle in that list resulting in boot hang.
This patch fixes the issues by ensuring that the notifier is installed
only once.
Cc: Sebastian Reichel
Signed-off-by: Sudeep Holla
Fixes: 46c99ac66222 ("power/reset: vexpress: Register with kernel restart handler")
Signed-off-by: Sebastian Reichel
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 3c8527e5a6e42c12c2afcf03d224ca67efcf9dc5
Author: Anton Vasilyev
Date: Fri Jul 6 15:32:53 2018 +0300
uwb: hwa-rc: fix memory leak at probe
[ Upstream commit 11b71782c1d10d9bccc31825cf84291cd7588a1e ]
hwarc\_probe() allocates memory for hwarc, but does not free it
if uwb\_rc\_add() or hwarc\_get\_version() fail.
Found by Linux Driver Verification project (linuxtesting.org).
Signed-off-by: Anton Vasilyev
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit cb39b07bf5f961eb1c5d29bf5d392b9f3461f7e2
Author: Geert Uytterhoeven
Date: Fri Jul 6 11:08:36 2018 +0200
serial: sh-sci: Stop RX FIFO timer during port shutdown
[ Upstream commit c5a9262fa8bfed0dddc7466ef10fcd292e2af61b ]
The RX FIFO timer may be armed when the port is shut down, hence the
timer function may still be called afterwards.
Fix this race condition by deleting the timer during port shutdown.
Fixes: 039403765e5da3c6 ("serial: sh-sci: SCIFA/B RX FIFO software timeout")
Signed-off-by: Geert Uytterhoeven
Reviewed-by: Simon Horman
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 741b2c3b62cf8033587b24d0c44231054dbc1e4e
Author: Johan Hovold
Date: Tue Jul 3 12:05:48 2018 +0200
misc: sram: enable clock before registering regions
[ Upstream commit d5b9653dd2bb7a2b1c8cc783c5d3b607bbb6b271 ]
Make sure to enable the clock before registering regions and exporting
partitions to user space at which point we must be prepared for I/O.
Fixes: ee895ccdf776 ("misc: sram: fix enabled clock leak on error path")
Signed-off-by: Johan Hovold
Reviewed-by: Vladimir Zapolskiy
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 919618d2323473a43865384fecfd5113cc62b0dc
Author: Hans de Goede
Date: Wed May 23 15:33:21 2018 +0200
power: supply: axp288\_charger: Fix initial constant\_charge\_current value
[ Upstream commit f2a42595f0865886a2d40524b0e9d15600848670 ]
We should look at val which contains the value read from the register,
not ret which is always 0 on a successful read.
Signed-off-by: Hans de Goede
Fixes: eac53b3664f59 ("power: supply: axp288\_charger: Drop platform\_data dependency")
Signed-off-by: Sebastian Reichel
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit df09a796560af5a8954993d1fca30f44a033c4df
Author: Colin Ian King
Date: Mon Jul 2 14:27:35 2018 +0100
staging: rts5208: fix missing error check on call to rtsx\_write\_register
[ Upstream commit c5fae4f4fd28189b1062fb8ef7b21fec37cb8b17 ]
Currently the check on error return from the call to rtsx\_write\_register
is checking the error status from the previous call. Fix this by adding
in the missing assignment of retval.
Detected by CoverityScan, CID#709877
Fixes: fa590c222fba ("staging: rts5208: add support for rts5208 and rts5288")
Signed-off-by: Colin Ian King
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e3deb9b3c252ecca24ef274bd1f178e5f4d5c7c1
Author: Dan Williams
Date: Fri Jul 6 09:08:01 2018 -0700
x86/numa\_emulation: Fix emulated-to-physical node mapping
[ Upstream commit 3b6c62f363a19ce82bf378187ab97c9dc01e3927 ]
Without this change the distance table calculation for emulated nodes
may use the wrong numa node and report an incorrect distance.
Signed-off-by: Dan Williams
Cc: David Rientjes
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: Wei Yang
Cc: linux-mm@kvack.org
Link: http://lkml.kernel.org/r/153089328103.27680.14778434392225818887.stgit@dwillia2-desk3.amr.corp.intel.com
Signed-off-by: Ingo Molnar
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit bb2ca3d777d94c3851b380cfd8918425458a3c86
Author: Yunsheng Lin
Date: Fri Jul 6 11:28:02 2018 +0100
net: hns3: Fix get\_vector ops in hclgevf\_main module
[ Upstream commit 03718db97bfb57535f3aa8110f0cbe0c616a67c0 ]
The hclgevf\_free\_vector function expects the caller to pass
the vector\_id to it, and hclgevf\_put\_vector pass vector to
it now, which will cause vector allocation problem.
This patch fixes it by converting vector into vector\_id before
calling hclgevf\_free\_vector.
Fixes: e2cb1dec9779 ("net: hns3: Add HNS3 VF HCL(Hardware Compatibility Layer) Support")
Signed-off-by: Yunsheng Lin
Signed-off-by: Peng Li
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 6739fc895c8090916c5518030625b2d01ac03379
Author: Yunsheng Lin
Date: Fri Jul 6 11:28:01 2018 +0100
net: hns3: Fix warning bug when doing lp selftest
[ Upstream commit d7099d15478e89edb9bc6c6e3ab4cd341884a367 ]
The napi\_alloc\_skb is excepted to be called under the
non-preemptible code path when it is called by hns3\_clean\_rx\_ring
during loopback selftest, otherwise the below warning will be
logged:
[ 92.420780] BUG: using smp\_processor\_id() in preemptible
[00000000] code: ethtool/1873
[ 92.463202] check\_preemption\_disabled+0xf8/0x100
[ 92.467893] debug\_smp\_processor\_id+0x1c/0x28
[ 92.472239] \_\_napi\_alloc\_skb+0x30/0x130
[ 92.476158] hns3\_clean\_rx\_ring+0x118/0x5f0 [hns3]
[ 92.480941] hns3\_self\_test+0x32c/0x4d0 [hns3]
[ 92.485375] ethtool\_self\_test+0xdc/0x1e8
[ 92.489372] dev\_ethtool+0x1020/0x1da8
[ 92.493109] dev\_ioctl+0x188/0x3a0
[ 92.496499] sock\_do\_ioctl+0xf4/0x208
[ 92.500148] sock\_ioctl+0x228/0x3e8
[ 92.503626] do\_vfs\_ioctl+0xc4/0x880
[ 92.507189] SyS\_ioctl+0x94/0xa8
[ 92.510404] el0\_svc\_naked+0x30/0x34
This patch fix it by disabling preemption when calling
hns3\_clean\_rx\_ring during loopback selftest.
Fixes: c39c4d98dc65 ("net: hns3: Add mac loopback selftest support in hns3 driver")
Signed-off-by: Yunsheng Lin
Signed-off-by: Peng Li
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 87dbcb1ce9c2cc7def3c8f96733bcea2bd32af43
Author: Yunsheng Lin
Date: Fri Jul 6 11:27:56 2018 +0100
net: hns3: Fix for mac pause not disable in pfc mode
[ Upstream commit 6d0ec65cb5810f9bf08671be008785bb8c84d39f ]
When pfc pause mode is enable, the mac pause mode need to be
disabled, otherwise the pfc pause packet will not be sent when
congestion happens.
This patch fixes by disabling the mac pause when pfc pause is
enabled.
Fixes: 848440544b41 ("net: hns3: Add support of TX Scheduler & Shaper to HNS3 driver")
Signed-off-by: Yunsheng Lin
Signed-off-by: Peng Li
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 4a659cb2f0fd7a1d8ddebc687e922cc10bff719b
Author: Fuyun Liang
Date: Fri Jul 6 11:27:59 2018 +0100
net: hns3: Fix for mailbox message truncated problem
[ Upstream commit ead5bd4d35c0a14d5ce1474177718c678dff5205 ]
The payload of mailbox message is 16 byte and the value of
HCLGE\_MBX\_MAX\_ARQ\_MSG\_SIZE is 8. A message truncated problem will
happen when mailbox message is converted to ARQ message. This patch
replaces HCLGE\_MBX\_MAX\_ARQ\_MSG\_SIZE with the size of ARQ message in
hclgevf\_mbx\_handler to fix this problem.
Fixes: b11a0bb231f3 ("net: hns3: Add mailbox support to VF driver")
Signed-off-by: Fuyun Liang
Signed-off-by: Peng Li
Signed-off-by: Salil Mehta
Signed-off-by: David S. Miller
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1bb1252b4e788fd8bcab9a2b4aebcffa2f49c30a
Author: Uwe Kleine-König
Date: Thu Jun 28 09:57:42 2018 +0200
siox: don't create a thread without starting it
[ Upstream commit e890591413819eeb604207ad3261ba617b2ec0bb ]
When a siox master device is registered a kthread is created that is
only started when triggered by userspace. So this thread might be in
TASK\_UNINTERRUPTIBLE state for long and trigger a warning
[ 241.130465] INFO: task siox-0:626 blocked for more than 120 seconds.
with the respective debug settings enabled. It might be right to put an
unstarted thread to TASK\_IDLE (in kernel/kthread.c:kthread()) instead,
but independant of this discussion it is cleaner for
siox\_master\_register() to start the thread immediately. The effect is
that it enters its own waiting state and then stays in state TASK\_IDLE
which doesn't trigger the above warning.
As siox\_poll\_thread() uses some variables of the device the
initialisation of these is moved before thread creation.
Acked-by: Peter Zijlstra (Intel)
Signed-off-by: Uwe Kleine-König
Acked-by: Gavin Schenk
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit e83bd606a14e2e423db7b161907eae6fb4b80976
Author: Dan Carpenter
Date: Wed Jul 4 12:33:34 2018 +0300
vmci: type promotion bug in qp\_host\_get\_user\_memory()
[ Upstream commit 7fb2fd4e25fc1fb10dcb30b5519de257cfeae84c ]
The problem is that if get\_user\_pages\_fast() fails and returns a
negative error code, it gets type promoted to a high positive value and
treated as a success.
Fixes: 06164d2b72aa ("VMCI: queue pairs implementation.")
Signed-off-by: Dan Carpenter
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 46ba8d1156e78b4d05c3f05d8d902832bfb33965
Author: Wei Yongjun
Date: Sat May 26 09:45:59 2018 +0000
misc: ibmvmc: Use GFP\_ATOMIC under spin lock
[ Upstream commit 97b715b62e5b4c6edb75d023f556fd09a46cb4e1 ]
The function alloc\_dma\_buffer() is called from ibmvmc\_add\_buffer(),
in which a spin lock be held here, so we should use GFP\_ATOMIC when
a lock is held.
Fixes: 0eca353e7ae7 ("misc: IBM Virtual Management Channel Driver (VMC)")
Signed-off-by: Wei Yongjun
Reviewed-by: Bryant G. Ly
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 1d3de3d5e2749c6345daf4f05afc2134be5fe31b
Author: Matt Ranostay
Date: Fri Jun 8 23:58:15 2018 -0700
tsl2550: fix lux1\_input error in low light
[ Upstream commit ce054546cc2c26891cefa2f284d90d93b52205de ]
ADC channel 0 photodiode detects both infrared + visible light,
but ADC channel 1 just detects infrared. However, the latter is a bit
more sensitive in that range so complete darkness or low light causes
a error condition in which the chan0 - chan1 is negative that
results in a -EAGAIN.
This patch changes the resulting lux1\_input sysfs attribute message from
"Resource temporarily unavailable" to a user-grokable lux value of 0.
Cc: Arnd Bergmann
Cc: Greg Kroah-Hartman
Signed-off-by: Matt Ranostay
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit c9bcfbebca4074dfb6db597f00747d1106cb08d2
Author: Akinobu Mita
Date: Mon Jun 25 00:05:21 2018 +0900
iio: adc: ina2xx: avoid kthread\_stop() with stale task\_struct
[ Upstream commit 7d6cd21d82bacab2d1786fe5e989e4815b75d9a3 ]
When the buffer is enabled for ina2xx driver, a dedicated kthread is
invoked to capture mesurement data. When the buffer is disabled, the
kthread is stopped.
However if the kthread gets register access errors, it immediately exits
and when the malfunctional buffer is disabled, the stale task\_struct
pointer is accessed as there is no kthread to be stopped.
A similar issue in the usbip driver is prevented by kthread\_get\_run and
kthread\_stop\_put helpers by increasing usage count of the task\_struct.
This change applies the same solution.
Cc: Stefan Brüns
Cc: Jonathan Cameron
Signed-off-by: Akinobu Mita
Fixes: c43a102e67db ("iio: ina2xx: add support for TI INA2xx Power Monitors")
Signed-off-by: Jonathan Cameron
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit d08aa810ddd189e2e8e84b1a0ce09621dfd35cd1
Author: Stafford Horne
Date: Mon Jun 25 21:45:37 2018 +0900
crypto: skcipher - Fix -Wstringop-truncation warnings
[ Upstream commit cefd769fd0192c84d638f66da202459ed8ad63ba ]
As of GCC 9.0.0 the build is reporting warnings like:
crypto/ablkcipher.c: In function ‘crypto\_ablkcipher\_report’:
crypto/ablkcipher.c:374:2: warning: ‘strncpy’ specified bound 64 equals destination size [-Wstringop-truncation]
strncpy(rblkcipher.geniv, alg->cra\_ablkcipher.geniv ?: "",
^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
sizeof(rblkcipher.geniv));
~~~~~~~~~~~~~~~~~~~~~~~~~
This means the strnycpy might create a non null terminated string. Fix this by
explicitly performing '\0' termination.
Cc: Greg Kroah-Hartman
Cc: Arnd Bergmann
Cc: Max Filippov
Cc: Eric Biggers
Cc: Nick Desaulniers
Signed-off-by: Stafford Horne
Signed-off-by: Herbert Xu
Signed-off-by: Sasha Levin
Signed-off-by: Greg Kroah-Hartman


=== Content from git.kernel.org_fd8cfca4_20250125_150206.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=d26c25a9d19b5976b319af528886f89cf455692d)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=d26c25a9d19b5976b319af528886f89cf455692d)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d26c25a9d19b5976b319af528886f89cf455692d)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=d26c25a9d19b5976b319af528886f89cf455692d)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Dave Martin <Dave.Martin@arm.com> | 2018-09-27 16:53:21 +0100 |
| --- | --- | --- |
| committer | Will Deacon <will.deacon@arm.com> | 2018-10-01 14:38:05 +0100 |
| commit | [d26c25a9d19b5976b319af528886f89cf455692d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d26c25a9d19b5976b319af528886f89cf455692d) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=d26c25a9d19b5976b319af528886f89cf455692d)) | |
| tree | [a7d45ee45745dda7244f599d6374486672535417](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=d26c25a9d19b5976b319af528886f89cf455692d) | |
| parent | [031e6e6b4e1277e76e73a6ab209095ad9bf3ce52](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=031e6e6b4e1277e76e73a6ab209095ad9bf3ce52) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=d26c25a9d19b5976b319af528886f89cf455692d&id2=031e6e6b4e1277e76e73a6ab209095ad9bf3ce52)) | |
| download | [linux-d26c25a9d19b5976b319af528886f89cf455692d.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-d26c25a9d19b5976b319af528886f89cf455692d.tar.gz) | |

arm64: KVM: Tighten guest core register access from userspaceWe currently allow userspace to access the core register file
in about any possible way, including straddling multiple
registers and doing unaligned accesses.
This is not the expected use of the ABI, and nobody is actually
using it that way. Let's tighten it by explicitly checking
the size and alignment for each field of the register file.
Cc: <stable@vger.kernel.org>
Fixes: 2f4a07c5f9fe ("arm64: KVM: guest one-reg interface")
Reviewed-by: Christoffer Dall <christoffer.dall@arm.com>
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Signed-off-by: Dave Martin <Dave.Martin@arm.com>
[maz: rewrote Dave's initial patch to be more easily backported]
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Will Deacon <will.deacon@arm.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=d26c25a9d19b5976b319af528886f89cf455692d)

| -rw-r--r-- | [arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm64/kvm/guest.c?id=d26c25a9d19b5976b319af528886f89cf455692d) | 45 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 45 insertions, 0 deletions

| diff --git a/arch/arm64/kvm/guest.c b/arch/arm64/kvm/guest.cindex 07256b08226c0c..3088463bafc1fa 100644--- a/[arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/kvm/guest.c?id=031e6e6b4e1277e76e73a6ab209095ad9bf3ce52)+++ b/[arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/kvm/guest.c?id=d26c25a9d19b5976b319af528886f89cf455692d)@@ -57,6 +57,45 @@ static u64 core\_reg\_offset\_from\_id(u64 id) return id & ~(KVM\_REG\_ARCH\_MASK | KVM\_REG\_SIZE\_MASK | KVM\_REG\_ARM\_CORE); } +static int validate\_core\_offset(const struct kvm\_one\_reg \*reg)+{+ u64 off = core\_reg\_offset\_from\_id(reg->id);+ int size;++ switch (off) {+ case KVM\_REG\_ARM\_CORE\_REG(regs.regs[0]) ...+ KVM\_REG\_ARM\_CORE\_REG(regs.regs[30]):+ case KVM\_REG\_ARM\_CORE\_REG(regs.sp):+ case KVM\_REG\_ARM\_CORE\_REG(regs.pc):+ case KVM\_REG\_ARM\_CORE\_REG(regs.pstate):+ case KVM\_REG\_ARM\_CORE\_REG(sp\_el1):+ case KVM\_REG\_ARM\_CORE\_REG(elr\_el1):+ case KVM\_REG\_ARM\_CORE\_REG(spsr[0]) ...+ KVM\_REG\_ARM\_CORE\_REG(spsr[KVM\_NR\_SPSR - 1]):+ size = sizeof(\_\_u64);+ break;++ case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.vregs[0]) ...+ KVM\_REG\_ARM\_CORE\_REG(fp\_regs.vregs[31]):+ size = sizeof(\_\_uint128\_t);+ break;++ case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.fpsr):+ case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.fpcr):+ size = sizeof(\_\_u32);+ break;++ default:+ return -EINVAL;+ }++ if (KVM\_REG\_SIZE(reg->id) == size &&+ IS\_ALIGNED(off, size / sizeof(\_\_u32)))+ return 0;++ return -EINVAL;+}+ static int get\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) { /\*@@ -76,6 +115,9 @@ static int get\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) (off + (KVM\_REG\_SIZE(reg->id) / sizeof(\_\_u32))) >= nr\_regs) return -ENOENT; + if (validate\_core\_offset(reg))+ return -EINVAL;+ if (copy\_to\_user(uaddr, ((u32 \*)regs) + off, KVM\_REG\_SIZE(reg->id))) return -EFAULT; @@ -98,6 +140,9 @@ static int set\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) (off + (KVM\_REG\_SIZE(reg->id) / sizeof(\_\_u32))) >= nr\_regs) return -ENOENT; + if (validate\_core\_offset(reg))+ return -EINVAL;+ if (KVM\_REG\_SIZE(reg->id) > sizeof(tmp)) return -EINVAL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 15:00:43 +0000



=== Content from git.kernel.org_d4b666a0_20250125_150205.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Marc Zyngier <marc.zyngier@arm.com> | 2018-09-27 16:53:22 +0100 |
| --- | --- | --- |
| committer | Will Deacon <will.deacon@arm.com> | 2018-10-01 14:38:26 +0100 |
| commit | [2a3f93459d689d990b3ecfbe782fec89b97d3279](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)) | |
| tree | [fe727ff9274645032d41c463d5c3593b4760f1dd](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279) | |
| parent | [d26c25a9d19b5976b319af528886f89cf455692d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d26c25a9d19b5976b319af528886f89cf455692d) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279&id2=d26c25a9d19b5976b319af528886f89cf455692d)) | |
| download | [linux-2a3f93459d689d990b3ecfbe782fec89b97d3279.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-2a3f93459d689d990b3ecfbe782fec89b97d3279.tar.gz) | |

arm64: KVM: Sanitize PSTATE.M when being set from userspaceNot all execution modes are valid for a guest, and some of them
depend on what the HW actually supports. Let's verify that what
userspace provides is compatible with both the VM settings and
the HW capabilities.
Cc: <stable@vger.kernel.org>
Fixes: 0d854a60b1d7 ("arm64: KVM: enable initialization of a 32bit vcpu")
Reviewed-by: Christoffer Dall <christoffer.dall@arm.com>
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Reviewed-by: Dave Martin <Dave.Martin@arm.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Will Deacon <will.deacon@arm.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)

| -rw-r--r-- | [arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm64/kvm/guest.c?id=2a3f93459d689d990b3ecfbe782fec89b97d3279) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 1 deletions

| diff --git a/arch/arm64/kvm/guest.c b/arch/arm64/kvm/guest.cindex 3088463bafc1fa..a6c9fbaeaefcdd 100644--- a/[arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/kvm/guest.c?id=d26c25a9d19b5976b319af528886f89cf455692d)+++ b/[arch/arm64/kvm/guest.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/kvm/guest.c?id=2a3f93459d689d990b3ecfbe782fec89b97d3279)@@ -152,17 +152,25 @@ static int set\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) }  if (off == KVM\_REG\_ARM\_CORE\_REG(regs.pstate)) {- u32 mode = (\*(u32 \*)valp) & PSR\_AA32\_MODE\_MASK;+ u64 mode = (\*(u64 \*)valp) & PSR\_AA32\_MODE\_MASK; switch (mode) { case PSR\_AA32\_MODE\_USR:+ if (!system\_supports\_32bit\_el0())+ return -EINVAL;+ break; case PSR\_AA32\_MODE\_FIQ: case PSR\_AA32\_MODE\_IRQ: case PSR\_AA32\_MODE\_SVC: case PSR\_AA32\_MODE\_ABT: case PSR\_AA32\_MODE\_UND:+ if (!vcpu\_el1\_is\_32bit(vcpu))+ return -EINVAL;+ break; case PSR\_MODE\_EL0t: case PSR\_MODE\_EL1t: case PSR\_MODE\_EL1h:+ if (vcpu\_el1\_is\_32bit(vcpu))+ return -EINVAL; break; default: err = -EINVAL; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 15:00:42 +0000



=== Content from access.redhat.com_faa939eb_20250126_094417.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# RHSA-2018:3656 Important: kernel-alt security and bug fix update

Updated 2018-11-26T14:49:35+00:00 -
English

* No translations currently exist.

The kernel-alt packages provide the Linux kernel version 4.x.

Red Hat Product Security has rated this update as having Important security impact. Common Vulnerability Scoring System (CVSS) base scores, which give detailed severity ratings, are available for each vulnerability from the CVE links in the References section.

Security Fixes are described in

## Subscriber exclusive content

A Red Hat subscription provides unlimited access to our knowledgebase, tools, and much more.

### Current Customers and Partners

Log in for full access

[Log In](https://access.redhat.com/login?redirectTo=https://access.redhat.com/articles/3714391)

### New to Red Hat?

[Learn more about Red Hat subscriptions](/subscription-value/)

### Using a Red Hat product through a public cloud?

[How to access this content](https://access.redhat.com/articles/public-cloud-marketplace-access)

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close

×
#### Request a English Translation

Are you sure you want to request a translation?
We appreciate your interest in having Red Hat content localized to your language. Please note that excessive use of this feature could cause delays in getting specific content you are interested in translated.
Close
 [Request Japanese Translation](/articles/3714391?rate=GSSNzXda_OIm84HYgzAEsDEZCBHNMJoi6vKvtI29FtI "Request Japanese Translation") [Request Chinese Translation](/articles/3714391?rate=H-CtpucsyFM_jfdc4OGUTAcMVeYjoCRwT-zlFb_FH6I "Request Chinese Translation") [Request Korean Translation](/articles/3714391?rate=dVMnQDA-yKByUHWb0PNlJgZZjEmqvqeY3Hq9-D0apFA "Request Korean Translation")

×
#### Generating Machine Translation

Loading…
We are generating a machine translation for this content. Depending on the length of the content, this process could take a while.

Cancel



=== Content from usn.ubuntu.com_4978137e_20250125_150231.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3821-2: Linux kernel (Xenial HWE) vulnerabilities

14 November 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-lts-xenial](/security/cves?package=linux-lts-xenial) - Linux hardware enablement kernel from Xenial for Trusty

## Details

USN-3821-1 fixed vulnerabilities in the Linux kernel for Ubuntu 16.04

LTS. This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 16.04 LTS for Ubuntu

14.04 LTS.

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly ensure that xattr information remained in inode

bodies. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash).

([CVE-2018-10880](/security/CVE-2018-10880))

It was discovered that the alarmtimer implementation in the Linux kernel

contained an integer overflow vulnerability. A local attacker could use

this to cause a denial of service. ([CVE-2018-13053](/security/CVE-2018-13053))

Wen Xu discovered that the f2fs filesystem implementation in the Linux

kernel did not properly validate metadata. An attacker could use this to

construct a malicious f2fs image that, when mounted, could cause a denial

of service (system crash). ([CVE-2018-13096](/security/CVE-2018-13096))

Wen Xu and Po-Ning Tseng discovered that the btrfs filesystem

implementation in the Linux kernel did not properly handle relocations in

some situations. An attacker could use this to construct a malicious btrfs

image that, when mounted, could cause a denial of service (system crash).

([CVE-2018-14609](/security/CVE-2018-14609))

Wen Xu discovered that the HFS+ filesystem implementation in the Linux

kernel did not properly handle malformed catalog data in some situations.

An attacker could use this to construct a malicious HFS+ image that, when

mounted, could cause a denial of service (system crash). ([CVE-2018-14617](/security/CVE-2018-14617))

Jann Horn discovered that the procfs file system implementation in the

Linux kernel did not properly restrict the ability to inspect the kernel

stack of an arbitrary task. A local attacker could use this to expose

sensitive information. ([CVE-2018-17972](/security/CVE-2018-17972))

It was discovered that the KVM implementation in the Linux kernel on ARM

64bit processors did not properly handle some ioctls. An attacker with the

privilege to create KVM-based virtual machines could use this to cause a

denial of service (host system crash) or execute arbitrary code in the

host. ([CVE-2018-18021](/security/CVE-2018-18021))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 14.04

* [linux-image-4.4.0-1034-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.4.0-1034.37](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.4.0-1034.37)
* [linux-image-4.4.0-139-generic](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)
* [linux-image-4.4.0-139-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial)
  -
  [4.4.0-139.165~14.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-lts-xenial/4.4.0-139.165~14.04.1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-10880](/security/CVE-2018-10880)
* [CVE-2018-13053](/security/CVE-2018-13053)
* [CVE-2018-13096](/security/CVE-2018-13096)
* [CVE-2018-14609](/security/CVE-2018-14609)
* [CVE-2018-14617](/security/CVE-2018-14617)
* [CVE-2018-17972](/security/CVE-2018-17972)
* [CVE-2018-18021](/security/CVE-2018-18021)

## Related notices

* [USN-3821-1](/security/notices/USN-3821-1)
* [USN-3871-4](/security/notices/USN-3871-4)
* [USN-3871-1](/security/notices/USN-3871-1)
* [USN-3871-5](/security/notices/USN-3871-5)
* [USN-3871-3](/security/notices/USN-3871-3)
* [USN-4118-1](/security/notices/USN-4118-1)
* [USN-4094-1](/security/notices/USN-4094-1)
* [USN-3880-2](/security/notices/USN-3880-2)
* [USN-3835-1](/security/notices/USN-3835-1)
* [USN-3832-1](/security/notices/USN-3832-1)
* [USN-3880-1](/security/notices/USN-3880-1)
* [USN-3931-1](/security/notices/USN-3931-1)
* [USN-3931-2](/security/notices/USN-3931-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from usn.ubuntu.com_41abda16_20250125_150232.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3931-1: Linux kernel vulnerabilities

2 April 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-oem](/security/cves?package=linux-oem) - Linux kernel for OEM processors
* [linux-oracle](/security/cves?package=linux-oracle) - Linux kernel for Oracle Cloud systems
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2

## Details

M. Vefa Bicakci and Andy Lutomirski discovered that the kernel did not

properly set up all arguments to an error handler callback used when

running as a paravirtualized guest. An unprivileged attacker in a

paravirtualized guest VM could use this to cause a denial of service (guest

VM crash). ([CVE-2018-14678](/security/CVE-2018-14678))

It was discovered that the KVM implementation in the Linux kernel on ARM

64bit processors did not properly handle some ioctls. An attacker with the

privilege to create KVM-based virtual machines could use this to cause a

denial of service (host system crash) or execute arbitrary code in the

host. ([CVE-2018-18021](/security/CVE-2018-18021))

Mathias Payer and Hui Peng discovered a use-after-free vulnerability in the

Advanced Linux Sound Architecture (ALSA) subsystem. A physically proximate

attacker could use this to cause a denial of service (system crash).

([CVE-2018-19824](/security/CVE-2018-19824))

Shlomi Oberman, Yuli Shapiro, and Ran Menscher discovered an information

leak in the Bluetooth implementation of the Linux kernel. An attacker

within Bluetooth range could use this to expose sensitive information

(kernel memory). ([CVE-2019-3459](/security/CVE-2019-3459), [CVE-2019-3460](/security/CVE-2019-3460))

Jann Horn discovered that the KVM implementation in the Linux kernel

contained a use-after-free vulnerability. An attacker in a guest VM with

access to /dev/kvm could use this to cause a denial of service (guest VM

crash). ([CVE-2019-6974](/security/CVE-2019-6974))

Jim Mattson and Felix Wilhelm discovered a use-after-free vulnerability in

the KVM subsystem of the Linux kernel, when using nested virtual machines.

A local attacker in a guest VM could use this to cause a denial of service

(system crash) or possibly execute arbitrary code in the host system.

([CVE-2019-7221](/security/CVE-2019-7221))

Felix Wilhelm discovered that an information leak vulnerability existed in

the KVM subsystem of the Linux kernel, when nested virtualization is used.

A local attacker could use this to expose sensitive information (host

system memory to a guest VM). ([CVE-2019-7222](/security/CVE-2019-7222))

Jann Horn discovered that the eBPF implementation in the Linux kernel was

insufficiently hardened against Spectre V1 attacks. A local attacker could

use this to expose sensitive information. ([CVE-2019-7308](/security/CVE-2019-7308))

It was discovered that a use-after-free vulnerability existed in the user-

space API for crypto (af\_alg) implementation in the Linux kernel. A local

attacker could use this to cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2019-8912](/security/CVE-2019-8912))

It was discovered that the Linux kernel did not properly deallocate memory

when handling certain errors while reading files. A local attacker could

use this to cause a denial of service (excessive memory consumption).

([CVE-2019-8980](/security/CVE-2019-8980))

Jann Horn discovered that the mmap implementation in the Linux kernel did

not properly check for the mmap minimum address in some situations. A local

attacker could use this to assist exploiting a kernel NULL pointer

dereference vulnerability. ([CVE-2019-9213](/security/CVE-2019-9213))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-4.15.0-1010-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle)
  -
  [4.15.0-1010.12](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle/4.15.0-1010.12)
* [linux-image-4.15.0-1029-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [4.15.0-1029.31](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/4.15.0-1029.31)
* [linux-image-4.15.0-1031-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [4.15.0-1031.31](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/4.15.0-1031.31)
* [linux-image-4.15.0-1033-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.15.0-1033.35](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.15.0-1033.35)
* [linux-image-4.15.0-1035-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.15.0-1035.37](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.15.0-1035.37)
* [linux-image-4.15.0-1035-oem](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oem)
  -
  [4.15.0-1035.40](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oem/4.15.0-1035.40)
* [linux-image-4.15.0-47-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.15.0-47.50](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.15.0-47.50)
* [linux-image-4.15.0-47-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-47.50](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-47.50)
* [linux-image-4.15.0-47-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.15.0-47.50](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.15.0-47.50)
* [linux-image-4.15.0-47-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-47.50](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-47.50)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws)
  -
  [4.15.0.1035.34](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws/4.15.0.1035.34)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1029.31](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1029.31)
* [linux-image-generic](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.47.49](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.47.49)
* [linux-image-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.47.49](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.47.49)
* [linux-image-gke](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1029.31](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1029.31)
* [linux-image-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm)
  -
  [4.15.0.1031.31](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm/4.15.0.1031.31)
* [linux-image-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.47.49](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.47.49)
* [linux-image-oem](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oem)
  -
  [4.15.0.1035.40](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oem/4.15.0.1035.40)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle)
  -
  [4.15.0.1010.13](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle/4.15.0.1010.13)
* [linux-image-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2)
  -
  [4.15.0.1033.31](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2/4.15.0.1033.31)
* [linux-image-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.47.49](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.47.49)
* [linux-image-virtual](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.47.49](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.47.49)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-14678](/security/CVE-2018-14678)
* [CVE-2018-18021](/security/CVE-2018-18021)
* [CVE-2018-19824](/security/CVE-2018-19824)
* [CVE-2019-3459](/security/CVE-2019-3459)
* [CVE-2019-3460](/security/CVE-2019-3460)
* [CVE-2019-6974](/security/CVE-2019-6974)
* [CVE-2019-7221](/security/CVE-2019-7221)
* [CVE-2019-7222](/security/CVE-2019-7222)
* [CVE-2019-7308](/security/CVE-2019-7308)
* [CVE-2019-8912](/security/CVE-2019-8912)
* [CVE-2019-8980](/security/CVE-2019-8980)
* [CVE-2019-9213](/security/CVE-2019-9213)

## Related notices

* [USN-3931-2](/security/notices/USN-3931-2)
* [USN-3821-1](/security/notices/USN-3821-1)
* [USN-3821-2](/security/notices/USN-3821-2)
* [USN-3933-2](/security/notices/USN-3933-2)
* [USN-3933-1](/security/notices/USN-3933-1)
* [USN-3930-2](/security/notices/USN-3930-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-3930-1](/security/notices/USN-3930-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from usn.ubuntu.com_c4356cc4_20250125_150229.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3821-1: Linux kernel vulnerabilities

14 November 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2
* [linux-snapdragon](/security/cves?package=linux-snapdragon) - Linux kernel for Snapdragon processors

## Details

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly ensure that xattr information remained in inode

bodies. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash).

([CVE-2018-10880](/security/CVE-2018-10880))

It was discovered that the alarmtimer implementation in the Linux kernel

contained an integer overflow vulnerability. A local attacker could use

this to cause a denial of service. ([CVE-2018-13053](/security/CVE-2018-13053))

Wen Xu discovered that the f2fs filesystem implementation in the Linux

kernel did not properly validate metadata. An attacker could use this to

construct a malicious f2fs image that, when mounted, could cause a denial

of service (system crash). ([CVE-2018-13096](/security/CVE-2018-13096))

Wen Xu and Po-Ning Tseng discovered that the btrfs filesystem

implementation in the Linux kernel did not properly handle relocations in

some situations. An attacker could use this to construct a malicious btrfs

image that, when mounted, could cause a denial of service (system crash).

([CVE-2018-14609](/security/CVE-2018-14609))

Wen Xu discovered that the HFS+ filesystem implementation in the Linux

kernel did not properly handle malformed catalog data in some situations.

An attacker could use this to construct a malicious HFS+ image that, when

mounted, could cause a denial of service (system crash). ([CVE-2018-14617](/security/CVE-2018-14617))

Jann Horn discovered that the procfs file system implementation in the

Linux kernel did not properly restrict the ability to inspect the kernel

stack of an arbitrary task. A local attacker could use this to expose

sensitive information. ([CVE-2018-17972](/security/CVE-2018-17972))

It was discovered that the KVM implementation in the Linux kernel on ARM

64bit processors did not properly handle some ioctls. An attacker with the

privilege to create KVM-based virtual machines could use this to cause a

denial of service (host system crash) or execute arbitrary code in the

host. ([CVE-2018-18021](/security/CVE-2018-18021))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.4.0-1037-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [4.4.0-1037.43](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/4.4.0-1037.43)
* [linux-image-4.4.0-1072-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.4.0-1072.82](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.4.0-1072.82)
* [linux-image-4.4.0-1100-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.4.0-1100.108](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.4.0-1100.108)
* [linux-image-4.4.0-1104-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon)
  -
  [4.4.0-1104.109](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon/4.4.0-1104.109)
* [linux-image-4.4.0-139-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-powerpc-e500mc](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-powerpc-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-powerpc64-emb](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)
* [linux-image-4.4.0-139-powerpc64-smp](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.4.0-139.165](https://launchpad.net/ubuntu/%2Bsource/linux/4.4.0-139.165)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-10880](/security/CVE-2018-10880)
* [CVE-2018-13053](/security/CVE-2018-13053)
* [CVE-2018-13096](/security/CVE-2018-13096)
* [CVE-2018-14609](/security/CVE-2018-14609)
* [CVE-2018-14617](/security/CVE-2018-14617)
* [CVE-2018-17972](/security/CVE-2018-17972)
* [CVE-2018-18021](/security/CVE-2018-18021)

## Related notices

* [USN-3871-4](/security/notices/USN-3871-4)
* [USN-3871-1](/security/notices/USN-3871-1)
* [USN-3871-5](/security/notices/USN-3871-5)
* [USN-3871-3](/security/notices/USN-3871-3)
* [USN-3821-2](/security/notices/USN-3821-2)
* [USN-4118-1](/security/notices/USN-4118-1)
* [USN-4094-1](/security/notices/USN-4094-1)
* [USN-3880-2](/security/notices/USN-3880-2)
* [USN-3835-1](/security/notices/USN-3835-1)
* [USN-3832-1](/security/notices/USN-3832-1)
* [USN-3880-1](/security/notices/USN-3880-1)
* [USN-3931-1](/security/notices/USN-3931-1)
* [USN-3931-2](/security/notices/USN-3931-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from access.redhat.com_13aa8cb8_20250125_150206.html ===

Note: Our personalized web services require that your browser be enabled for JavaScript and cookies

[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

[Red Hat Product Errata](/errata)
RHSA-2018:3656 - Security Advisory

Issued:
2018-11-26
Updated:
2018-11-26
# RHSA-2018:3656 - Security Advisory

* [Overview](#overview)
* [Updated Packages](#packages)

## Synopsis

Important: kernel-alt security and bug fix update

## Type/Severity

Security Advisory: Important

## Red Hat Insights patch analysis

Identify and remediate systems affected by this advisory.

[View affected systems](https://console.redhat.com/insights/patch/advisories/RHSA-2018%3A3656)

## Topic

An update for kernel-alt is now available for Red Hat Enterprise Linux 7.

Red Hat Product Security has rated this update as having a security impact of Important. A Common Vulnerability Scoring System (CVSS) base score, which gives a detailed severity rating, is available for each vulnerability from the CVE link(s) in the References section.

## Description

The kernel-alt packages provide the Linux kernel version 4.x.

Security Fix(es):

* kernel: Use-after-free in the vmacache\_flush\_all function resulting in a possible privilege escalation (CVE-2018-17182)
* kernel: Privilege escalation on arm64 via KVM hypervisor (CVE-2018-18021)

For more details about the security issue(s), including the impact, a CVSS score, and other related information, refer to the CVE page(s) listed in the References section.

Bug Fix(es):

These updated kernel packages include also numerous bug fixes. Space precludes documenting all of the bug fixes in this advisory. See the descriptions in the related Knowledge Article: <https://access.redhat.com/articles/3714391>

## Solution

For details on how to apply this update, which includes the changes described in this advisory, refer to:

<https://access.redhat.com/articles/11258>

The system must be rebooted for this update to take effect.

## Affected Products

* Red Hat Enterprise Linux for ARM 64 7 aarch64
* Red Hat Enterprise Linux for Power 9 7 ppc64le
* Red Hat Enterprise Linux for IBM System z (Structure A) 7 s390x

## Fixes

* [BZ - 1631205](https://bugzilla.redhat.com/show_bug.cgi?id=1631205)
  - CVE-2018-17182 kernel: Use-after-free in the vmacache\_flush\_all function resulting in a possible privilege escalation
* [BZ - 1635475](https://bugzilla.redhat.com/show_bug.cgi?id=1635475)
  - CVE-2018-18021 kernel: Privilege escalation on arm64 via KVM hypervisor

## CVEs

* [CVE-2018-17182](https://www.redhat.com/security/data/cve/CVE-2018-17182.html)
* [CVE-2018-18021](https://www.redhat.com/security/data/cve/CVE-2018-18021.html)

## References

* <https://access.redhat.com/security/updates/classification/#important>
* <https://access.redhat.com/articles/3714391>

**Note:**
More recent versions of these packages may be available.
Click a package name for more details.
## Red Hat Enterprise Linux for ARM 64 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-115.2.2.el7a.src.rpm | SHA-256: a443c71ddcb98ee630ed3b87cd9ad6bd66c311ab8bfef7cfd0def38813bb5cb6 |
| aarch64 | |
| kernel-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: dcfa5faf10dc45f636fa4adeeb55cf23357fcddc553c8debcf16a1d5c2557a9d |
| kernel-abi-whitelists-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7d8b0eb169dda16807adb4d4ca3f9e570bc64746c9ad207ad767aab4973168ca |
| kernel-debug-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: d7a21290f8962f09c1b6f5666e0367f0b45566a0d2124e1c54b5d715a42497e6 |
| kernel-debug-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 54f0d05a0e98a9b32d944f48bc2fee874f864d5a1d4f8bdf1ca4e32c7f5d6a4f |
| kernel-debug-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 54f0d05a0e98a9b32d944f48bc2fee874f864d5a1d4f8bdf1ca4e32c7f5d6a4f |
| kernel-debug-devel-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: d1ef7be96f74b1c92b78c63b28c59cd2574278be37699133f90588a860e9f080 |
| kernel-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 274988be754f1bf0d89c9e697492bcc98d32e0d1eab08862df49f232d4e73356 |
| kernel-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 274988be754f1bf0d89c9e697492bcc98d32e0d1eab08862df49f232d4e73356 |
| kernel-debuginfo-common-aarch64-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 31a4d228e81cbf01e61e73a4a29bc9505d106aba297bfdde87af371ec3bdaa5d |
| kernel-debuginfo-common-aarch64-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 31a4d228e81cbf01e61e73a4a29bc9505d106aba297bfdde87af371ec3bdaa5d |
| kernel-devel-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: df9136faa356b02b4e389c62d17b71d5ef510ca39f6baeabe78068a1c67051a3 |
| kernel-doc-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7deb0a9fc933383d246928cc29bab89d0d1c4b87bdf766a26df7f4ff4b7cc0f6 |
| kernel-doc-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7deb0a9fc933383d246928cc29bab89d0d1c4b87bdf766a26df7f4ff4b7cc0f6 |
| kernel-headers-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 1120b46f644affee950206aa5db90376ee8b000956ac107e5ede91baaf510a27 |
| kernel-tools-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 08f70cb42b3ff71fe61f97ae9906221e5fe8630b32a46384c52fa9555645a763 |
| kernel-tools-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: ee8562f8d628de1cb50f0d41538378e0972e5d1ac87b08d7d47e769dea5a5cb2 |
| kernel-tools-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: ee8562f8d628de1cb50f0d41538378e0972e5d1ac87b08d7d47e769dea5a5cb2 |
| kernel-tools-libs-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 14bb7b27cd4e6c2b0fed9a11d45a9ef1bd78ab677b5ca311b8f4f8c61e9a6f6b |
| kernel-tools-libs-devel-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 297df0839d4a76c4bfa7c0024a0837a10d5053b9e5e78ff648e5533f209c34b4 |
| perf-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: efecf53f9f27a89de0a64513d9a7e6b477c2ed977697048475de3acfde20922a |
| perf-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 750796bd0819017b25f14bacb8afa61a4a60f34d264c3aa9764c09e182950e77 |
| perf-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 750796bd0819017b25f14bacb8afa61a4a60f34d264c3aa9764c09e182950e77 |
| python-perf-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: 541c33c6b12a14275f570e4521c3a6922bc94f9da3d3fb6c4b11aa208493a9e0 |
| python-perf-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: bc6722e4e6277f22f060a54df1006f249457feb14d089a50637674cd71ece4b7 |
| python-perf-debuginfo-4.14.0-115.2.2.el7a.aarch64.rpm | SHA-256: bc6722e4e6277f22f060a54df1006f249457feb14d089a50637674cd71ece4b7 |

## Red Hat Enterprise Linux for Power 9 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-115.2.2.el7a.src.rpm | SHA-256: a443c71ddcb98ee630ed3b87cd9ad6bd66c311ab8bfef7cfd0def38813bb5cb6 |
| ppc64le | |
| kernel-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: f96250ecc666b28691c49c34ad667c200a44f2173ee1fce756cf7b083e2f1a42 |
| kernel-abi-whitelists-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7d8b0eb169dda16807adb4d4ca3f9e570bc64746c9ad207ad767aab4973168ca |
| kernel-bootwrapper-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: eeae604b48d0a2ad9a1314dacc7c605343f6a49b8407e393a704277a98882d0e |
| kernel-debug-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 21e98182ceceff934b78767984ec7e47c1c9fa28073cda150590bf23a9b5cef8 |
| kernel-debug-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 8f12f54a40ca87c7cde4c344f109e83a0b901031b65f8cab7a19a550dc13203d |
| kernel-debug-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 8f12f54a40ca87c7cde4c344f109e83a0b901031b65f8cab7a19a550dc13203d |
| kernel-debug-devel-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 16a1ab761c83911cbf2b494afcd44244f1067976952182b2c78037ad8f426476 |
| kernel-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 08dc6338ce1dbcc775d4614df274718e0418101a433c868b97705da6d28999d2 |
| kernel-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 08dc6338ce1dbcc775d4614df274718e0418101a433c868b97705da6d28999d2 |
| kernel-debuginfo-common-ppc64le-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 27afc70e25ec9eee8e5a0cf769aed77e52bb5f167ed62a1a0ae9172cd5cbb57f |
| kernel-debuginfo-common-ppc64le-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 27afc70e25ec9eee8e5a0cf769aed77e52bb5f167ed62a1a0ae9172cd5cbb57f |
| kernel-devel-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 2ed8399060991e22ebca601fd675c39458dd4cb1079399153be10272d4c98461 |
| kernel-doc-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7deb0a9fc933383d246928cc29bab89d0d1c4b87bdf766a26df7f4ff4b7cc0f6 |
| kernel-headers-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 4fc786721a37b0348c9398db10cb68552f174d47ae109fde1238cc53a9dc30bf |
| kernel-tools-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: cb580a2d4fea9885142758007e05365ac70d57784b518699a5186f90b82214ea |
| kernel-tools-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 9f22998c757b070d9b16fa03a51568b329fafe9966f86c8f99d97f0570371553 |
| kernel-tools-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 9f22998c757b070d9b16fa03a51568b329fafe9966f86c8f99d97f0570371553 |
| kernel-tools-libs-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 20d934defd162d50d11bc01427685cda96cb00c92ad62b3dea557579596f16dd |
| kernel-tools-libs-devel-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 9ca7e7da1f3c56b2a0a0006dacc7d02fc7a819c427440ce4e92ef5ead9e8f6f2 |
| perf-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 3b441d30848b17183cf019830f7c93e8e302a193f52323b210e6e31a9a9e4c60 |
| perf-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: b7e01eeb18cc5cb5d619139cbad9b204585e0fed06cde5f284b4ef1c8f04ee77 |
| perf-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: b7e01eeb18cc5cb5d619139cbad9b204585e0fed06cde5f284b4ef1c8f04ee77 |
| python-perf-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 42273bf91802009f40c280828641dbde2a8febcc0628f984e0db64d12ef394c7 |
| python-perf-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 17d0e3e412b71da77f0b24d535c64c3eb8c6d56cc98940c454c14c91bc451e77 |
| python-perf-debuginfo-4.14.0-115.2.2.el7a.ppc64le.rpm | SHA-256: 17d0e3e412b71da77f0b24d535c64c3eb8c6d56cc98940c454c14c91bc451e77 |

## Red Hat Enterprise Linux for IBM System z (Structure A) 7

| SRPM | |
| --- | --- |
| kernel-alt-4.14.0-115.2.2.el7a.src.rpm | SHA-256: a443c71ddcb98ee630ed3b87cd9ad6bd66c311ab8bfef7cfd0def38813bb5cb6 |
| s390x | |
| kernel-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 73d73d2bfccb90573d77c919f4e0d7b77fc20d46d1c0eeff21b1daab6c664734 |
| kernel-abi-whitelists-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7d8b0eb169dda16807adb4d4ca3f9e570bc64746c9ad207ad767aab4973168ca |
| kernel-debug-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: c00c3b4499675f3772a0f855733303e59e2445b98a3b706548f0a382d3d58999 |
| kernel-debug-debuginfo-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 27577c894a77cf97948a895dc3c6fd3bcbef4152efd1ac4f4ca11a65aa7ef220 |
| kernel-debug-devel-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 752627790a08adc3877c4f0dee1c1b0b7c0d46ee8f30995ca8897d7e26b415fc |
| kernel-debuginfo-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: c9ccd729426367ee1690a71ffaf56a6835d70c0d69fca286c85d8e174818f410 |
| kernel-debuginfo-common-s390x-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 3e687cd50153c3cfa4cf6da9c5e745877ccbee69fe959f0cfab035b58716fd91 |
| kernel-devel-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 0ed3f11b9814f1bb298d9568b968ced870ea5d58a6670f5c0ae3e358f29aca5d |
| kernel-doc-4.14.0-115.2.2.el7a.noarch.rpm | SHA-256: 7deb0a9fc933383d246928cc29bab89d0d1c4b87bdf766a26df7f4ff4b7cc0f6 |
| kernel-headers-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 690fc1e51e6c14e71ed9894435f996e88dcc68f07253266eb571b317d8726461 |
| kernel-kdump-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: eba835fcccad442a57349802dfa17dc9de43d3d120e5eb1994889d06d9bf2e5c |
| kernel-kdump-debuginfo-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 9a88429ff534b63b9f55d2e8b3f67b7b3828895d63049847fa713bf5d47c7d1f |
| kernel-kdump-devel-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 7953e02a03bfa8ef3ab8f9012506f4756197e85ec3115805f82243bd4eeb3aea |
| perf-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 28956eb0a694418d6feb80047c106e9be9c83c13ee7d51d9477df4e52ae019fc |
| perf-debuginfo-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 78b119d92670bb710dd698acf96400008670f405eb2c7b5d531501cb4135226b |
| python-perf-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 0d21180b08370cfa0146752b7d70855e50574ccd04f9371a1d0b40a42e333c79 |
| python-perf-debuginfo-4.14.0-115.2.2.el7a.s390x.rpm | SHA-256: 35ce9b7efb7cd7eab61610a5f0e9fe353fc833f8cad3a3dc16969fe9e3cadaae |

The Red Hat security contact is secalert@redhat.com.
More contact details at <https://access.redhat.com/security/team/contact/>.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.openwall.com_dfa5da1f_20250125_150237.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20181002160713.GE23872@arm.com>
Date: Tue, 2 Oct 2018 17:07:14 +0100
From: Will Deacon <will.deacon@....com>
To: oss-security@...ts.openwall.com
Cc: marc.zyngier@....com
Subject: arm64 Linux kernel: Privilege escalation by taking control of the
 KVM hypervisor

Hi all,

Whilst reviewing some proposed arm64 KVM changes, it became apparent that
the sanity checking for the KVM_SET_ON_REG ioctl() on arm64 does not
correctly handle a number of cases:

	- Unaligned register accesses and accesses that span multiple
	  registers can bypass PSTATE sanity checking

	- The PSTATE sanity checking fails to take into account the
	  capabilities of the physical CPU, or the configuration of
	  the virtual CPU

This allows an attacker with permission to create KVM-based virtual machines
to both panic the hypervisor by triggering an illegal exception return
(resulting in a DoS) and to redirect execution elsewhere within the
hypervisor with full register control, instead of causing a return to the
guest.

This has been fixed by upstream commits:

d26c25a9d19b ("arm64: KVM: Tighten guest core register access from userspace")
2a3f93459d68 ("arm64: KVM: Sanitize PSTATE.M when being set from userspace")

which are being backported and applied to all active -stable kernels.

32-bit Arm is unaffected by this issue.

There has not yet been a CVE requested for this (mainly because I don't know
how to do it).

Thanks,

Will

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.redhat.com_0e3f30d6_20250126_094413.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from access.redhat.com_f3632052_20250126_094418.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)

  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Product Documentation](https://access.redhat.com/documentation)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)

  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform)
  [All Product Docs](//docs.redhat.com/en/products/)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)

  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Classifications](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Severety Ratings](https://access.redhat.com/security/security-updates/#/cve)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)

  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

 Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

# Severity ratings

## Understanding Red Hat security ratings

Red Hat Product Security rates the severity of security issues found
in Red Hat products using a four-point scale (Low, Moderate,
Important, and Critical), as well as including a separate Common
Vulnerability Scoring System (CVSS) base score. These scoring systems
provide a prioritized risk assessment to help you understand and
schedule upgrades to your systems, enabling informed decisions on the
risk each issue places on your unique environment.

The four-point scale tells you how serious Red Hat considers an issue
to be, helping you judge the severity and determine the most important
updates. The scale takes into account the potential risk based on a technical analysis of the exact flaw and its type. The risk level of a flaw does not change if an exploit or worm is later released for a flaw, or if one is available before the release of a fix. A flaw will only be re-evaluated if new technical details emerge.

The following table provides severity ratings for Red Hat products and systems. For flaws specific to AI models, see [Red Hat security ratings for AI models](https://access.redhat.com/security/ai).

| **Severity ratings** | **Security flaw description** |
| --- | --- |
| **Critical impact** | This rating is given to flaws that could be easily exploited by a remote unauthenticated attacker and lead to system compromise (arbitrary code execution) without requiring user interaction, or easily cause system compromise via inference end points on AI systems. Flaws that require authentication, local or physical access to a system, or an unlikely configuration are not classified as Critical impact. These are the types of vulnerabilities that can be exploited by worms. |
| **Important impact** | This rating is given to flaws that can easily compromise the confidentiality, integrity or availability of resources. These are the types of vulnerabilities that allow local or authenticated users to gain additional privileges, allow unauthenticated remote users to view resources that should otherwise be protected by authentication or other controls, allow authenticated remote users to execute arbitrary code, allow remote users to cause a denial of service, or can cause system compromise via inference end points on AI systems. |
| **Moderate impact** | This rating is given to flaws that may be more difficult to exploit but could still lead to some compromise of the confidentiality, integrity or availability of resources under certain circumstances. It is also given to flaws that could be exploited to cause denial of service-like conditions on AI systems via an inference end point, or allow attackers to steal other users’ data from the AI system without authorization. These are the types of vulnerabilities that could have had a Critical or Important impact but are less easily exploited based on a technical evaluation of the flaw and/or affect unlikely configurations. || **Low impact** | This rating is given to all other issues that may have a security impact. These are the types of vulnerabilities that are believed to require unlikely circumstances to be able to be exploited, or where a successful exploit would give minimal consequences. This includes flaws that are present in a program’s source code but to which no current or theoretically possible, but unproven, exploitation vectors exist or were found during the technical analysis of the flaw. |

A Red Hat security advisory can contain fixes for more than one
vulnerability and for packages for more than one product (such as both
Red Hat Enterprise Linux 7 and 8). Each issue in an advisory has a
severity rating for each product. The overall severity of an advisory
is the highest severity out of all the individual issues, across all
the products the advisory targets. For simplicity, advisories only
show the overall severity. The advisories contain links to the
relevant entries in Red Hat's bug-tracking system, where you can
examine individual severity ratings and additional commentary, as well
as links to the relevant pages in Red Hat’s CVE database.

When a technology—enabled and most likely used by default—completely
blocks the exploitation of a particular vulnerability across all
architectures, we will adjust the severity level. When a technology
reduces the risk of a vulnerability, we may adjust the severity level
and give an explanation of the decision in the bug-tracking  and CVE
database entries.

## Common Vulnerability Scoring System (CVSS)

Common Vulnerability Scoring System (CVSS) base scores provide
additional guidance about a vulnerability, giving a detailed severity
rating by scoring the constant aspects of a vulnerability: Attack
Vector, Attack Complexity, User Interaction, Privileges Required,
Scope, Confidentiality, Integrity, and Availability.

CVSS version 2 base metrics are available for all vulnerabilities from
2009-2016, as well as selected earlier vulnerabilities. In 2016, Red
Hat adopted the CVSS v3 standard, and all vulnerabilities going
forward will use version 3.1 for scoring. These scores are found on
the
[CVE pages](https://access.redhat.com/security/security-updates/#/cve)
(linked from the References section of each Red Hat Security Advisory).

Red Hat does not solely use the CVSS rating to determine the priority
with which flaws are fixed, or to determine the severity rating of the
vulnerability. It is used as a guideline to identify and describe key
metrics of a flaw, however the priority for which flaws are fixed is
determined by the overall severity of the flaw using the
aforementioned four-point scale.  CVSS is meant to help customers
prioritize the order in which they remediate flaws.

### CVSS v3 Base Metrics

The CVSS v3 base metrics group covers the constant aspects of a
vulnerability:

* Attack Vector (AV) - Expresses the "remoteness" of the attack and
  how the vulnerability is exploited.
* Attack Complexity (AC) - Speaks to the difficulty of executing an
  attack and what factors are needed for it to be successful. (Along
  with User Interaction, Attack Complexity was formerly part of the
  Access Complexity metric.).
* User Interaction (UI) - Determines whether the attack requires an
  active human to participate or if the attack can be automated.
* Privileges Required (PR) - Documents the level of user
  authentication required for the attack to be successful. (This
  replaces the former Authentication metric.).
* Scope (S) - Determines whether an attacker can impact a component
  beyond its security scope/authority.
* Confidentiality (C) - Determines whether unauthorized parties can
  access data and to what extent.
* Integrity (I) - Measures the impact to the trustworthiness and
  veracity of data.
* Availability (A) - Refers to the impact to accessibility of data or
  services for authorized users.

A formula translates these measurements into a single, numerical base
score, ranging from 0.0 (no risk) to 10.0 (highest risk). Refer to
[Common Vulnerability Scoring System v3.1: User Guide](https://www.first.org/cvss/user-guide)
for detailed descriptions of the base metrics. It is important to note
that the CVSS base metrics were designed to be used with the other
CVSS metric groups, notably the Temporal and Environmental metrics, to
provide an accurate representation of risk in customer environments.
Alone, the Base metrics offer a shallow view of the vulnerability
itself without accounting for deployment or the environment.

### How Red Hat Uses CVSS v3 Base Metrics

We aim to comply with the CVSS v3 standard when assigning base scores,
and Red Hat uses base metrics that reflect how a vulnerability affects
our products specifically.  In addition, we do not use the Qualitative
Severity Rating Scale in the CVSS v3.1 User Guide to rate severity,
and our severity ratings are always based on the aforementioned
four-point scale.  In some circumstances, it may not be obvious why a
flaw received a particular score. The following are some common
vulnerability types with our interpretation and typical scoring:

#### Libraries

It is not always possible to know how third-party applications use
libraries, making it difficult to give accurate CVSS v3 base metrics
for flaws in system libraries. When rating these flaws, we take into
account the way the library is used by applications that we ship, and
also look at other popular software that may use the library in a way
that would cause an issue to be of higher severity, and adjust the
score appropriately.

#### Other Common Scores

Flaws where a local, unprivileged user can cause a kernel to crash
(denial of service) typically score 5.5 (for example,
[CVE-2019-9213](https://access.redhat.com/security/cve/CVE-2019-9213)).

Flaws that allow a local, unprivileged user to escalate their
privileges to root typically score 7.8 (for example,
[CVE-2019-18634](https://access.redhat.com/security/cve/CVE-2019-18634)).

Cross-site scripting flaws are generally scored as having Low impact
to Integrity and/or Confidentiality, with no impact to Availability,
in line with scoring from other vendors and NVD. A typical score for
these flaws is 6.1 (for example,
[CVE-2020-11023](https://access.redhat.com/security/cve/CVE-2020-11023)).

### Base Score Variations Across Products

It is common for a given CVE-named vulnerability to have several
different CVSS base metrics, depending on the product, version, and
architecture. Examples of this include:

* A vulnerability that only affected some architectures. For example,
  [CVE-2019-15031](https://access.redhat.com/security/cve/CVE-2019-15031)
  only affected PowerPC.
* A vulnerability that is mitigated by source code protection
  mechanisms on some platforms. For example,
  [CVE-2018-1125](https://access.redhat.com/security/cve/CVE-2018-1125)
  could have led to arbitrary code execution on Red Hat Enterprise
  Linux, but it is only a denial of service because it was compiled
  with FORTIFY protections.
* A vulnerability that affected more than one product.  For example,
  [CVE-2020-14060](https://access.redhat.com/security/cve/CVE-2020-14060)
  affected a component in both OpenShift and OpenStack.  The severity
  to OpenStack was lower (Low) as compared to OpenShift (Moderate)
  based on its usage; the overall vulnerability itself was rated
  Important.

If CVSS v3 base scores are significantly different across products, we
note that separately wherever possible. If we do not split the score,
we report the metric that gives the highest CVSS v3 base score (the
worst-case outcome).

### Differences Between NVD and Red Hat Scores

For open source software shipped by multiple vendors, the CVSS base
scores may vary for each vendor's version, depending on the version
they ship, how they ship it, the platform, and even how the software
is compiled. This makes scoring vulnerabilities difficult for
third-party vulnerability databases, such as NVD, who can give only a
single CVSS base score to each vulnerability, or when comparing to
other vendors who score based on the characteristics of use in their
own products. See the
[National Vulnerability Database](https://nvd.nist.gov/vuln-metrics/cvss)
for more information regarding NVD security ratings.

These differences can cause the scores to vary widely. Other reasons
may include how the source code was compiled with certain compiler
flags or hardening technologies that reduce or eliminate the security
severity of a flaw, or how the software is used within the product.
Software running standalone may suffer from a flaw, but its use within
a product may preclude the vulnerable code from ever being used in a
way that could be exploited.

For example, NVD may rate a flaw in a particular service as having
High Impact on the CVSS CIA Triad (Confidentiality, Integrity,
Availability) where the service in question is typically run as the
root user with full privileges on a system. However, in a Red Hat
product, the service may be specifically configured to run as a
dedicated non-privileged user running entirely in a SELinux sandbox,
greatly reducing the immediate impact from compromise, resulting in
Low impact.

For these reasons, we recommend that, whenever possible, you use a
CVSS base score provided by Red Hat in preference to a score from a
third party. Please
[let us know](https://access.redhat.com/site/security/team/contact/)
if you believe we have given an incorrect CVSS v3 base score for a
particular vulnerability. We are happy to discuss and update if
needed.

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com)

### Help

* [Contact Customer Portal](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Systems Status

### About

* [Red Hat Subscription Value](https://access.redhat.com/subscription-value)
* [About Red Hat](https://www.redhat.com/about/)
* [Red Hat Jobs](http://jobs.redhat.com)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

Copyright © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)

×
### Formatting Tips

Here are the common uses of Markdown.

Code blocks
```
~~~
Code surrounded in tildes is easier to read
~~~
```

Links/URLs`[Red Hat Customer Portal](https://access.redhat.com)`

[Learn more](/help/markdown)
Close



=== Content from xenbits.xen.org_9f5b018a_20250126_094413.html ===

# Information

| Advisory | [XSA-270](advisory-270.html) |
| --- | --- |
| Public release | 2018-08-14 17:00 |
| Updated | 2018-08-20 09:46 |
| Version | 3 |
| CVE(s) | [CVE-2018-15471](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15471) |
| Title | Linux netback driver OOB access in hash handling |

# Files

<advisory-270.txt> (signed advisory file)

<xsa270.patch>
# Advisory

---

```

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

            Xen Security Advisory CVE-2018-15471 / XSA-270
                              version 3

           Linux netback driver OOB access in hash handling

UPDATES IN VERSION 3
====================

CVE assigned.

ISSUE DESCRIPTION
=================

Linux's netback driver allows frontends to control mapping of requests
to request queues.  When processing a request to set or change this
mapping, some input validation was missing or flawed.

IMPACT
======

A malicious or buggy frontend may cause the (usually privileged)
backend to make out of bounds memory accesses, potentially resulting
in one or more of privilege escalation, Denial of Service (DoS), or
information leaks.

VULNERABLE SYSTEMS
==================

Linux kernel versions from 4.7 onwards are affected.

MITIGATION
==========

There is no known mitigation.

CREDITS
=======

This issue was discovered by Felix Wilhelm of Google Project Zero.

RESOLUTION
==========

Applying the attached patch resolves this issue.

xsa270.patch           Linux 4.7 ... 4.17

$ sha256sum xsa270*
[392868c37c1fe0d16c36086208fd0fc045c1baf8ab9b207995bce72681cb8c54  xsa270.patch](xsa270.patch)
$

DEPLOYMENT DURING EMBARGO
=========================

Deployment of the patches and/or mitigations described above (or
others which are substantially similar) is permitted during the
embargo, even on public-facing systems with untrusted guest users and
administrators.

But: Distribution of updated software is prohibited (except to other
members of the predisclosure list).

Predisclosure list members who wish to deploy significantly different
patches and/or mitigations, please contact the Xen Project Security
Team.

(Note: this during-embargo deployment notice is retained in
post-embargo publicly released Xen Project advisories, even though it
is then no longer applicable.  This is to enable the community to have
oversight of the Xen Project Security Team's decisionmaking.)

For more information about permissible uses of embargoed information,
consult the Xen Project community's agreed Security Policy:
  <http://www.xenproject.org/security-policy.html>
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQEcBAEBCAAGBQJbeo4MAAoJEIP+FMlX6CvZOpsH/34RpIZaTTVsZWCVyNotieFf
yLfCqu+9bbRVNEqYDq6NViFrj9I6WwvLpp8s7HZheJvdXlyIO1cYCen4QX8VSPqI
VaRD7Jcu99drK1hy/t80AbicS+t9qvew97SzjG+MIIJZK7dnxG/Q0nbHLCg0zdCg
5G+pOTl17DK+4eM7Z1duo2BK1sxCms6I/YJVFfkGjC99vXKYAj2GAWGxVbiEwDWT
4jvf3R3w5athJNR4Lf6FxDz6MzvHaYNFQKikc0AMaTcO5HubumGXQQn5JQelAAno
O6ujB25kF1j29A2PwYvBSxBDTD4uWQeWiv9kWML1YmzsQv1cy6Un0vwXtNhhb6s=
=SC+y
-----END PGP SIGNATURE-----

```

---

Xenproject.org Security Team


=== Content from github.com_2f2fb680_20250125_150222.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F2a3f93459d689d990b3ecfbe782fec89b97d3279)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F2a3f93459d689d990b3ecfbe782fec89b97d3279)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/2a3f93459d689d990b3ecfbe782fec89b97d3279)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

arm64: KVM: Sanitize PSTATE.M when being set from userspace

[Browse files](/torvalds/linux/tree/2a3f93459d689d990b3ecfbe782fec89b97d3279)
Browse the repository at this point in the history

```
Not all execution modes are valid for a guest, and some of them
depend on what the HW actually supports. Let's verify that what
userspace provides is compatible with both the VM settings and
the HW capabilities.

Cc: <stable@vger.kernel.org>
Fixes: [0d854a6](https://github.com/torvalds/linux/commit/0d854a60b1d7d39a37b25dd28f63cfa0df637b91) ("arm64: KVM: enable initialization of a 32bit vcpu")
Reviewed-by: Christoffer Dall <christoffer.dall@arm.com>
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Reviewed-by: Dave Martin <Dave.Martin@arm.com>
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Will Deacon <will.deacon@arm.com>
```

* Loading branch information

[![@wildea01](https://avatars.githubusercontent.com/u/8912388?s=40&v=4)](/wildea01)

Marc Zyngier
authored and
[wildea01](/torvalds/linux/commits?author=wildea01 "View all commits by wildea01")
committed
Oct 1, 2018

1 parent
[d26c25a](/torvalds/linux/commit/d26c25a9d19b5976b319af528886f89cf455692d)

commit 2a3f934

Showing
**1 changed file**
with
**9 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

10 changes: 9 additions & 1 deletion

10
[arch/arm64/kvm/guest.c](#diff-c5a9a39de44c513d59630f30234a8b7495900a314619e3a4f46610ab631faf05 "arch/arm64/kvm/guest.c")

Show comments

[View file](/torvalds/linux/blob/2a3f93459d689d990b3ecfbe782fec89b97d3279/arch/arm64/kvm/guest.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -152,17 +152,25 @@ static int set\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) |
|  |  | } |
|  |  |  |
|  |  | if (off == KVM\_REG\_ARM\_CORE\_REG(regs.pstate)) { |
|  |  | u32 mode = (\*(u32 \*)valp) & PSR\_AA32\_MODE\_MASK; |
|  |  | u64 mode = (\*(u64 \*)valp) & PSR\_AA32\_MODE\_MASK; |
|  |  | switch (mode) { |
|  |  | case PSR\_AA32\_MODE\_USR: |
|  |  | if (!system\_supports\_32bit\_el0()) |
|  |  | return -EINVAL; |
|  |  | break; |
|  |  | case PSR\_AA32\_MODE\_FIQ: |
|  |  | case PSR\_AA32\_MODE\_IRQ: |
|  |  | case PSR\_AA32\_MODE\_SVC: |
|  |  | case PSR\_AA32\_MODE\_ABT: |
|  |  | case PSR\_AA32\_MODE\_UND: |
|  |  | if (!vcpu\_el1\_is\_32bit(vcpu)) |
|  |  | return -EINVAL; |
|  |  | break; |
|  |  | case PSR\_MODE\_EL0t: |
|  |  | case PSR\_MODE\_EL1t: |
|  |  | case PSR\_MODE\_EL1h: |
|  |  | if (vcpu\_el1\_is\_32bit(vcpu)) |
|  |  | return -EINVAL; |
|  |  | break; |
|  |  | default: |
|  |  | err = -EINVAL; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2a3f934`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F2a3f93459d689d990b3ecfbe782fec89b97d3279) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_45a53eee_20250125_150223.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fd26c25a9d19b5976b319af528886f89cf455692d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fd26c25a9d19b5976b319af528886f89cf455692d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/d26c25a9d19b5976b319af528886f89cf455692d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

arm64: KVM: Tighten guest core register access from userspace

[Browse files](/torvalds/linux/tree/d26c25a9d19b5976b319af528886f89cf455692d)
Browse the repository at this point in the history

```
We currently allow userspace to access the core register file
in about any possible way, including straddling multiple
registers and doing unaligned accesses.

This is not the expected use of the ABI, and nobody is actually
using it that way. Let's tighten it by explicitly checking
the size and alignment for each field of the register file.

Cc: <stable@vger.kernel.org>
Fixes: [2f4a07c](https://github.com/torvalds/linux/commit/2f4a07c5f9fe4a5cdb9867e1e2fcab3165846ea7) ("arm64: KVM: guest one-reg interface")
Reviewed-by: Christoffer Dall <christoffer.dall@arm.com>
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Signed-off-by: Dave Martin <Dave.Martin@arm.com>
[maz: rewrote Dave's initial patch to be more easily backported]
Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
Signed-off-by: Will Deacon <will.deacon@arm.com>
```

* Loading branch information

[![@wildea01](https://avatars.githubusercontent.com/u/8912388?s=40&v=4)](/wildea01)

Dave Martin
authored and
[wildea01](/torvalds/linux/commits?author=wildea01 "View all commits by wildea01")
committed
Oct 1, 2018

1 parent
[031e6e6](/torvalds/linux/commit/031e6e6b4e1277e76e73a6ab209095ad9bf3ce52)

commit d26c25a

Showing
**1 changed file**
with
**45 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

45 changes: 45 additions & 0 deletions

45
[arch/arm64/kvm/guest.c](#diff-c5a9a39de44c513d59630f30234a8b7495900a314619e3a4f46610ab631faf05 "arch/arm64/kvm/guest.c")

Show comments

[View file](/torvalds/linux/blob/d26c25a9d19b5976b319af528886f89cf455692d/arch/arm64/kvm/guest.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,6 +57,45 @@ static u64 core\_reg\_offset\_from\_id(u64 id) |
|  |  | return id & ~(KVM\_REG\_ARCH\_MASK | KVM\_REG\_SIZE\_MASK | KVM\_REG\_ARM\_CORE); |
|  |  | } |
|  |  |  |
|  |  | static int validate\_core\_offset(const struct kvm\_one\_reg \*reg) |
|  |  | { |
|  |  | u64 off = core\_reg\_offset\_from\_id(reg->id); |
|  |  | int size; |
|  |  |  |
|  |  | switch (off) { |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(regs.regs[0]) ... |
|  |  | KVM\_REG\_ARM\_CORE\_REG(regs.regs[30]): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(regs.sp): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(regs.pc): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(regs.pstate): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(sp\_el1): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(elr\_el1): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(spsr[0]) ... |
|  |  | KVM\_REG\_ARM\_CORE\_REG(spsr[KVM\_NR\_SPSR - 1]): |
|  |  | size = sizeof(\_\_u64); |
|  |  | break; |
|  |  |  |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.vregs[0]) ... |
|  |  | KVM\_REG\_ARM\_CORE\_REG(fp\_regs.vregs[31]): |
|  |  | size = sizeof(\_\_uint128\_t); |
|  |  | break; |
|  |  |  |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.fpsr): |
|  |  | case KVM\_REG\_ARM\_CORE\_REG(fp\_regs.fpcr): |
|  |  | size = sizeof(\_\_u32); |
|  |  | break; |
|  |  |  |
|  |  | default: |
|  |  | return -EINVAL; |
|  |  | } |
|  |  |  |
|  |  | if (KVM\_REG\_SIZE(reg->id) == size && |
|  |  | IS\_ALIGNED(off, size / sizeof(\_\_u32))) |
|  |  | return 0; |
|  |  |  |
|  |  | return -EINVAL; |
|  |  | } |
|  |  |  |
|  |  | static int get\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) |
|  |  | { |
|  |  | /\* |
| Expand All | | @@ -76,6 +115,9 @@ static int get\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) |
|  |  | (off + (KVM\_REG\_SIZE(reg->id) / sizeof(\_\_u32))) >= nr\_regs) |
|  |  | return -ENOENT; |
|  |  |  |
|  |  | if (validate\_core\_offset(reg)) |
|  |  | return -EINVAL; |
|  |  |  |
|  |  | if (copy\_to\_user(uaddr, ((u32 \*)regs) + off, KVM\_REG\_SIZE(reg->id))) |
|  |  | return -EFAULT; |
|  |  |  |
| Expand All | | @@ -98,6 +140,9 @@ static int set\_core\_reg(struct kvm\_vcpu \*vcpu, const struct kvm\_one\_reg \*reg) |
|  |  | (off + (KVM\_REG\_SIZE(reg->id) / sizeof(\_\_u32))) >= nr\_regs) |
|  |  | return -ENOENT; |
|  |  |  |
|  |  | if (validate\_core\_offset(reg)) |
|  |  | return -EINVAL; |
|  |  |  |
|  |  | if (KVM\_REG\_SIZE(reg->id) > sizeof(tmp)) |
|  |  | return -EINVAL; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d26c25a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2Fd26c25a9d19b5976b319af528886f89cf455692d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.redhat.com_2a70f6e3_20250126_094414.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/solutions/security-approach)
* [English](/en/solutions/security-approach)
* [Français](/fr/solutions/security-approach)
* [Deutsch](/de/solutions/security-approach)
* [Italiano](/it/solutions/security-approach)
* [日本語](/ja/solutions/security-approach)
* [한국어](/ko/solutions/security-approach)
* [Português](/pt-br/solutions/security-approach)
* [Español](/es/solutions/security-approach)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/solutions/security-approach)
* [English](/en/solutions/security-approach)
* [Français](/fr/solutions/security-approach)
* [Deutsch](/de/solutions/security-approach)
* [Italiano](/it/solutions/security-approach)
* [日本語](/ja/solutions/security-approach)
* [한국어](/ko/solutions/security-approach)
* [Português](/pt-br/solutions/security-approach)
* [Español](/es/solutions/security-approach)

## Security

### Red Hat Product Security

Red Hat believes that everyone, everywhere, is entitled to quality information needed to mitigate security and privacy risks, as well as the access to do so. We strive to protect communities of customers, contributors, and partners from digital security threats. We believe open source principles are the best way to achieve this.

![Illustration of secure applications and technology within the cloud](/rhdc/managed-files/RH_BRAND_007283_01_MECH_Security_FullColor_Grey_0.svg)

## Red Hat's security principles

Our open source security principles are baked into our products, services, and support

#### Defense in depth

Failure or compromise of a single layer or component of a system should not compromise the system as a whole.

#### Separation of duty

No one person, entity, or system identity should have full control or access to all elements of a policy, process, or system.

#### Secure by design

Security is not an add-on, afterthought, or checklist.

#### Secure by default

The default system configuration should have all reasonable security controls enabled and all services and features not needed for basic operation disabled.

#### Least privilege

Individuals, system identities, roles, entities, or execution contexts, be they human or automation, should be scoped to include only the access to resources required to complete the assigned and expected task or business duties.

#### Transparency

The open source principle of transparency should also apply to security issues and data, including designs, algorithms, and source code, all of which should be freely available when reasonable.

#### Understand the threat

Effective defense of a system must consider the nature of the actual threat or risk that is being mitigated or defended against so the appropriate responses are utilized.

## What we do:

* [Compliance and certification](/en/solutions/compliance-approach "Red Hat compliance and certification")
* [Incident response](https://access.redhat.com/security/vulnerability-management)
* [Hybrid cloud security](/en/solutions/hybrid-cloud-security-approach "Red Hat’s approach to hybrid cloud security")
* [Secure software development practices](https://www.redhat.com/en/topics/security/red-hat-sdl)
* [Security in the Red Hat product pathway](https://www.redhat.com/en/solutions/product-pathway-security)

#### Additional information:

* Latest publications
  + [Forbes Technology Council articles](https://www.forbes.com/councils/forbestechcouncil/people/vincentdanen/)
  + [Red Hat's Collaboration with the OpenSSF and OSV.dev Yields Results: Red Hat Security Data Now Available in the OSV Format](https://openssf.org/blog/2024/11/01/red-hats-collaboration-with-the-openssf-and-osv-dev-yields-results-red-hat-security-data-now-available-in-the-osv-format/)
* [Product Security publications](https://access.redhat.com/security/publications)
* [Security blogs](/en/blog/channel/security)
* [Security data](https://access.redhat.com/security/data)
* [Security glossary](https://access.redhat.com/security/glossary)

## Learn about Red Hat's approach to security and compliance

![](https://static.redhat.com/libs/redhat/marketing/latest/trustarc/trustecm/images/Warning-Icon-sm.svg)

![Play the video](/rhdc/managed-files/security-video-thumbnail-image.jpg)

  Video of HAViT5ufC08

Red Hat’s approach to security and compliance: the job is never done. Video duration: 2:21

## Security in open source software

### Upstream community leadership

### Review, track, and select packages for release

### Static code analysis

### Security hardening and quality assurance testing

### Secure distribution of digitally signed packages

### Continuous security updates

[How security hardening works in Red Hat Enterprise Linux](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/security_hardening/index)

## Security in Red Hat offerings

[![Red Hat Enterprise Linux](https://static.redhat.com/libs/redhat/brand-assets/2/products/red-hat-enterprise-linux--stacked.svg)](https://access.redhat.com/products/red-hat-enterprise-linux/ "Red Hat Enterprise Linux")

The leading enterprise Linux operating system, certified on hundreds of clouds and with thousands of vendors. Built-in tools help you ensure compliance and increase security.

[Learn more](https://access.redhat.com/products/red-hat-enterprise-linux/)

[![Red Hat OpenShift](https://static.redhat.com/libs/redhat/brand-assets/2/products/red-hat-openshift.svg)](/en/technologies/cloud-computing/openshift "Red Hat OpenShift")

An enterprise-ready Kubernetes container platform with full-stack automated operations to manage hybrid cloud and multicloud deployments. Increase container security with built-in capabilities for policies and controls.

[Learn more](/en/technologies/cloud-computing/openshift)

[![Red Hat Ansible Automation Platform](https://static.redhat.com/libs/redhat/brand-assets/2/products/red-hat-ansible-automation-platform.svg)](/en/technologies/management/ansible "Red Hat Ansible Automation Platform")

A platform for implementing consistent enterprise-wide automation, no matter where you are in your automation journey. Reduce the risks caused by misconfigurations and manual errors with automation, and streamline your security operations while integrating security into the process, with access control, logging and auditing capabilities.

[Learn more](/en/technologies/management/ansible)

| Design | Build | Run | Manage | Adapt |
| --- | --- | --- | --- | --- |
| [Red Hat Consulting](/en/services/consulting "Consulting: IT experts solving tough business problems") | [Red Hat OpenShift Container Platform](/en/technologies/cloud-computing/openshift "Red Hat OpenShift enterprise application platform") | [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux "Red Hat Enterprise Linux operating system") | [Red Hat Advanced Cluster Management for Kubernetes](/en/technologies/management/advanced-cluster-management "Red Hat Advanced Cluster Management for Kubernetes") | [Red Hat Insights](/en/technologies/management/insights "Red Hat Insights") |
| [Red Hat Services](/en/services "Red Hat Services & Support") | [Red Hat Application Services](/en/products/application-foundations "Red Hat Application Foundations") | [Red Hat Enterprise Linux CoreOS](/en/technologies/cloud-computing/openshift/what-was-coreos "What was CoreOS and CoreOS container Linux") | [Red Hat Ansible Automation Platform](/en/technologies/management/ansible "Red Hat Ansible Automation Platform") | [Red Hat Security Advisories](https://access.redhat.com/security/updates/advisory) |
| [Red Hat Training](/en/services/training-and-certification "Training and Certification") | [Red Hat 3scale API Management](/en/technologies/jboss-middleware/3scale "Red Hat 3scale API Management") | [Red Hat OpenStack Services on OpenShift](/en/technologies/cloud-computing/openstack-services-on-openshift "Red Hat OpenStack Services on OpenShift") | [Red Hat Satellite](/en/technologies/management/satellite "Red Hat Satellite") |  |
|  |  | [Red Hat Storage](/en/technologies/all-products#storage-products "All Red Hat products") | [Red Hat Certificate System](/en/technologies/cloud-computing/certificate-system "Red Hat Certificate System") |  |
|  |  |  | [Red Hat Directory Server](/en/technologies/cloud-computing/directory-server "Red Hat Directory Server - centralize user identity") |  |

## Learn more about Red Hat's approach to security

[Talk to a Red Hatter](/en/contact)

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/solutions/security-approach)
* [English](/en/solutions/security-approach)
* [Français](/fr/solutions/security-approach)
* [Deutsch](/de/solutions/security-approach)
* [Italiano](/it/solutions/security-approach)
* [日本語](/ja/solutions/security-approach)
* [한국어](/ko/solutions/security-approach)
* [Português](/pt-br/solutions/security-approach)
* [Español](/es/solutions/security-approach)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from www.debian.org_2c992b25_20250126_094412.html ===

[![Debian](../Pics/openlogo-50.png)](../ "Debian Home")

[Skip Quicknav](#content)

* [Blog](https://bits.debian.org/ "Bits from Debian")
* [Micronews](https://micronews.debian.org "Micronews from Debian")
* [Planet](https://planet.debian.org/ "The Planet of Debian")

[Security Information](./)
/
Debian security FAQ

# Debian security FAQ

1. [I received a DSA via debian-security-announce, how can I upgrade the vulnerable packages?](#buthow)- [The signature on your advisories does not verify correctly!](#signature)- [How is security handled in Debian?](#handling)- [Why are you fiddling with an old version of that package?](#oldversion)- [The version number for a package indicates that I am still running a vulnerable version!](#version)- [I received an advisory, but the build for one processor architecture seems to be missing.](#archismissing)- [How is security handled for unstable?](#unstable)- [How is security handled for testing?](#testing)- [How is security handled for contrib, non-free and non-free-firmware?](#contrib)- [The advisory says unstable is fixed in version 1.2.3-1, but unstable has 1.2.5-1, what's up?](#sidversionisold)- [Why are there no official mirrors for security.debian.org?](#mirror)- [I've seen DSA 100 and DSA 102, now where is DSA 101?](#missing)- [How can I reach the security team?](#contact)- [I guess I found a security problem, what should I do?](#discover)- [What am I supposed to do with a security problem in one of my packages?](#care)- [I tried to download a package listed in one of the security advisories, but I got a `file not found' error.](#enofile)- [I've got a bugfix, can I upload to security.debian.org directly?](#upload)- [I've got a bugfix, can I upload to proposed-updates instead?](#ppu)- [I'm pretty sure my packages are fine, how can I upload them?](#SecurityUploadQueue)- [How can I help with security?](#help)- [What is the scope of proposed-updates?](#proposed-updates)- [How is the security team composed?](#composing)- [How long will security updates be provided?](#lifespan)- [How can I check the integrity of packages?](#check)- [What to do if a random package breaks after a security update?](#break)- [What is a CVE identifier?](#cvewhat)- [Does Debian issue a DSA for every CVE id?](#cvedsa)- [Can Debian assign CVE identifiers?](#cveget)- [Does Debian have a vulnerability disclosure policy?](#disclosure-policy)- [Our vulnerability management tool has shown that the following issues are open (list of CVEs with random CVSS scores). When are those going to be fixed?](#cve-severity-assessment)- [What does local (remote) mean?](#localremote)

*Q: I received a DSA via debian-security-announce, how can I upgrade the vulnerable packages?*

A: As the DSA mail says, you should upgrade the packages affected by the
announced vulnerability. You can do this by just upgrading (after
updating the list of available packages with apt-get update)
every package in your system with apt-get upgrade or by
upgrading just a particular package, with apt-get install
*package*.

The announcement mail mentions the source package in which the vulnerability
was present. Therefore, you should update all the binary packages from
that source package. To check the binary packages to update, visit
https://packages.debian.org/src:*source-package-name* and
click on *[show ... binary packages]* for the distribution you
are updating.

It may also be necessary to restart a service or a running process. The
command [checkrestart](https://manpages.debian.org/checkrestart)
included in the package
[debian-goodies](https://packages.debian.org/debian-goodies)
might help to find which ones.

*Q: The signature on your advisories does not verify correctly!*

A: This is most likely a problem on your end. The
[debian-security-announce](https://lists.debian.org/debian-security-announce/)
list has a filter that only allows messages with a correct signature
from one of the security team members to be posted.

Most likely some piece of mail software on your end slightly changes
the message that breaks the signature. Make sure your software does
not do any MIME encoding or decoding, or tab/space conversions.

Known culprits are fetchmail (with the mimedecode option enabled),
formail (from procmail 3.14 only) and evolution.

*Q: How is security handled in Debian?*

A: Once the security team receives a notification of an incident,
one or more members review it and consider its impact on the stable
release of Debian (i.e. if it's vulnerable or not).
If our system is vulnerable, we work on a fix for the
problem. The package maintainer is contacted as well, if they didn't
contact the security team already. Finally, the fix is tested and
new packages are prepared, which are then compiled on all stable
architectures and uploaded afterwards. After all of that is done,
an advisory is published.

*Q: Why are you fiddling with an old version of that package?*

The most important guideline when making a new package that fixes a
security problem is to make as few changes as possible. Our users and
developers are relying on the exact behaviour of a release once it is made,
so any change we make can possibly break someone's system. This is
especially true in case of libraries: make sure you never change the
Application Program Interface (API) or Application Binary Interface (ABI),
no matter how small the change is.

This means that moving to a new upstream version is not a good solution,
instead the relevant changes should be backported. Generally upstream
maintainers are willing to help if needed, if not the Debian security team
might be able to help.

In some cases it is not possible to backport a security fix, for example
when large amounts of source code need to be modified or rewritten. If that
happens it might be necessary to move to a new upstream version, but this
has to be coordinated with the security team beforehand.

*Q: The version number for a package indicates that I am still running
a vulnerable version!*

A: Instead of upgrading to a new release we backport security fixes to
the version that was shipped in the stable release. The reason we do
this is to make sure that a release changes as little as possible
so things will not change or break unexpectedly as a result of a
security fix. You can check if you are running a secure version of
a package by looking at the package changelog, or comparing its
exact version number with the version indicated in the Debian
Security Advisory.

*Q: I received an advisory, but the build for one
processor architecture seems to be missing.*

A: Generally the Security Team releases an advisory with builds of the updated
packages for all architectures that Debian supports. However, some architectures
are slower than others and it may happen that builds for most architectures
are ready while some are still missing. These smaller archs represent a small
fraction of our user base. Depending on the urgency of the issue
we may decide to release the advisory forthwith. The missing builds will be
installed as soon as they come available, but no further notice of this will
be given. Of course we will never release an advisory where the i386 or amd64
builds are not present.

*Q: How is security handled for unstable?*

A: Security for unstable is primarily handled by package maintainers, not
by the Debian Security Team. Although the security team may upload
high-urgency security-only fixes when maintainers are noticed to be
inactive, support for stable will always have priority.
If you want to have a secure (and stable) server you are strongly encouraged
to stay with stable.

*Q: How is security handled for testing?*

A: Security for testing benefits from the security efforts of the entire
project for unstable. However, there is a minimum two-day migration delay,
and sometimes security fixes can be held up by transitions. The Security
Team helps to move along those transitions holding back important
security uploads, but this is not always possible and delays may occur.
Especially in the months after a new stable release, when many new versions
are uploaded to unstable, security fixes for testing may lag behind.
If you want to have a secure (and stable) server you are strongly
encouraged to stay with stable.

*Q: How is security handled for contrib,
non-free and non-free-firmware?*

A: The short answer is: it's not. Contrib, non-free and non-free-firmware aren't official
parts of the Debian Distribution and are not released, and thus not
supported by the security team. Some non-free packages are distributed
without source or without a license allowing the distribution of modified
versions. In those cases no security fixes can be made at all. If it
is possible to fix the problem, and the package maintainer or someone else
provides correct updated packages, then the security team will generally
process them and release an advisory.

*Q: The advisory says unstable is fixed in
version 1.2.3-1, but unstable has 1.2.5-1, what's up?*

A: We try to list the first version in unstable that fixed the problem.
Sometimes the maintainer has uploaded even newer versions in the meantime.
Compare the version in unstable with the version we indicate. If it's the
same or higher, you should be safe from this vulnerability. If you want to
be sure, you can check the package changelog with apt-get changelog
package-name and search for the entry announcing the fix.

*Q: Why are there no official mirrors for security.debian.org?*

A: Actually, there are. There are several official mirrors, implemented
through DNS aliases. The purpose of security.debian.org is to make security
updates available as quickly and easily as possible.

Encouraging the use of unofficial mirrors would add extra complexity
that is usually not needed and that can cause frustration if these
mirrors are not kept up to date.

*Q: I've seen DSA 100 and DSA 102, now where is DSA 101?*

A: Several vendors (mostly of GNU/Linux, but also of BSD
derivatives) coordinate security advisories for some incidents and
agree to a particular timeline so that all vendors are able to
release an advisory at the same time. This was decided in order to
not discriminate some vendors that need more time (e.g. when the
vendor has to pass packages through lengthy QA tests or has to
support several architectures or binary distributions). Our own
security team also prepares advisories in advance. Every now and
then, other security issues have to be dealt with before the parked
advisory could be released, and hence temporarily leaving out one or
more advisories by number.

*Q: How can I reach the security team?*

A: Security information can be sent to security@debian.org or
team@security.debian.org, both of which are read by the members of
the security team.

If desired, email can be encrypted with the Debian Security
Contact key (key ID [0x0D59D2B15144766A14D241C66BAF400B05C3E651](https://keyserver.ubuntu.com/pks/lookup?op=get&search=0x0d59d2b15144766a14d241c66baf400b05c3e651)). For the OpenPGP keys of individual team members, please
refer to the [keyring.debian.org](https://keyring.debian.org/)
keyserver.

*Q: I guess I found a security problem, what should I do?*

A: If you learn about a security problem, either in one of your own
packages or in someone else's please always contact the security team. If
the Debian security team confirms the vulnerability and other vendors are
likely to be vulnerable as well, they usually contact other vendors as
well. If the vulnerability is not yet public they will try to coordinate
security advisories with the other vendors, so all major distributions are
in sync.

If the vulnerability is already publicly known, be sure to file a bug
report in the Debian BTS, and tag it security.

If you are a Debian maintainer, [see below](#care).

*Q: What am I supposed to do with a security problem in one of
my packages?*

A: If you learn of a security problem, either in your package or
someone else's please always contact the security team via email at
team@security.debian.org. They keep track
of outstanding security problems, can help maintainers with
security problems or fix problems on their own, are responsible for
sending out security advisories and maintaining
security.debian.org.

The [Developer's Reference](../doc/developers-reference/pkgs.html#bug-security) has complete instructions on what to do.

It's particularly important that you don't upload to any other
distribution other than unstable without prior agreement by the
security team, because bypassing them will cause confusion and more
work.

*Q: I tried to download a package listed in one of the security
advisories, but I got a `file not found' error.*

A: Whenever a newer bugfix supersedes an older package on
security.debian.org, chances are high that the old package will be
removed by the time the new one gets installed. Hence, you'll get
this `file not found' error. We don't want to distribute packages
with known security bugs longer than absolutely necessary.

Please use the packages from the latest security advisories, which are
distributed through the [debian-security-announce](https://lists.debian.org/debian-security-announce/) mailing list. It's best to simply run
`apt-get update` before upgrading the package.

*Q: I've got a bugfix, can I upload to security.debian.org directly?*

A: No, you can't. The archive at security.debian.org is maintained
by the security team, who have to approve all packages. You should
instead send patches or proper source packages to the security team
via team@security.debian.org. They will be
reviewed by the security team and eventually uploaded, either with
or without modifications.

The [Developer's Reference](../doc/developers-reference/pkgs.html#bug-security) has complete instructions on what to do.

*Q: I've got a bugfix, can I upload to proposed-updates instead?*

A: Technically speaking, you can. However, you should not do this,
since this interferes badly with the work of the security team.
Packages from security.debian.org will be copied into the
proposed-updates directory automatically. If a package with the
same or a higher version number is already installed into the
archive, the security update will be rejected by the archive
system. That way, the stable distribution will end up without a
security update for this package instead, unless the wrong
packages in the proposed-updates directory were rejected. Please contact the
security team instead and include all details of the vulnerability
and attach the source files (i.e. diff.gz and dsc files) to your mail.

The [Developer's Reference](../doc/developers-reference/pkgs.html#bug-security) has complete instructions on what to do.

*Q: I'm pretty sure my packages are fine,
how can I upload them?*

A: If you are very sure that your packages don't break anything, that the
version is sane (i.e. greater than the version in stable and less than the
version in testing/unstable), that you didn't change the behaviour of the
package, despite the corresponding security problem, that you compiled it
for the correct distribution (that is `oldstable-security` or
`stable-security`), that the package contains the original
source if the package is new on security.debian.org, that you can confirm
the patch against the most recent version is clean and only touches the
corresponding security problem (check with `interdiff -z` and
both `.diff.gz` files), that you have proofread the patch at
least thrice, and that `debdiff` doesn't display any changes,
you may upload the files into the incoming directory
`ftp://ftp.security.upload.debian.org/pub/SecurityUploadQueue` on the
security.debian.org directly. Please send a notification with all details
and links to team@security.debian.org as well.

*Q: How can I help with security?*

A: Please review each problem before reporting it to
security@debian.org. If you are able to provide patches, that
would speed up the process. Do not simply forward bugtraq mails,
because we already receive them — but do provide us with
additional information about things reported on bugtraq.

A good way to get started with security work is helping
out on the Debian Security Tracker ([instructions](https://security-tracker.debian.org/tracker/data/report)).

*Q: What is the scope of proposed-updates?*

A: This directory contains packages which are proposed to enter the
next revision of Debian stable. Whenever packages are uploaded by
a maintainer for the stable distribution, they end up in the
proposed-updates directory. Since stable is meant to be stable, no
automatic updates are made. The security team will upload fixed
packages mentioned in their advisories to stable, however they will
be placed in proposed-updates first. Every couple of months the
Stable Release Manager checks the list of packages in
proposed-updates and discusses whether a package is suited for
stable or not. This is compiled into another revision of stable
(e.g. 2.2r3 or 2.2r4). Packages that don't fit will probably be
rejected and dropped from proposed-updates as well.

Note that the packages uploaded by maintainers (not by the security team)
in the proposed-updates/ directory are not supported by the security
team.

*Q: How is the security team composed?*

A: The Debian security team consists of
[several officers and secretaries](../intro/organization#security).
The security team itself appoints people to join the team.

*Q: How long will security updates be provided?*

A: The security team will support a stable distribution for
three years after its release. It is not possible to support three
distributions; supporting two simultaneously is already difficult
enough.

*Q: How can I check the integrity of packages?*

A: This process involve checking the Release file signature against
the [public key](https://ftp-master.debian.org/keys.html) used for the archive. The Release file contains the
checksums of Packages and Sources files, which contain
checksums of binary and source packages. Detailed instruction on how
to check packages integrity can be found in the [Debian Securing Manual](../doc/manuals/securing-debian-howto/ch7#s-deb-pack-sign).

*Q: What to do if a random package breaks after a security update?*

A: First of all, you should figure out why the package breaks and
how it is connected to the security update, then contact the
security team if it is serious or the stable release manager if it
is less serious. We're talking about random packages that break
after a security update of a different package. If you can't
figure out what's going wrong but have a correction, talk to the
security team as well. You may be redirected to the stable release
manager though.

*Q: What is a CVE identifier?*

A: The Common Vulnerabilities and Exposures project assignes
unique names, called CVE identifiers, to specific security
vulnerabilities, to make it easier to uniquely refer to a specific
issue. More information can be found at [Wikipedia](https://en.wikipedia.org/wiki/Common_Vulnerabilities_and_Exposures).

*Q: Does Debian issue a DSA for every CVE id?*

A: The Debian security team keeps track of every issued CVE identifier,
connect it to the relevant Debian package and assess its impact in a
Debian context - the fact that something is assigned a CVE id does not
necessarily imply that the issue is a serious threat to a Debian system.
This information is tracked in the
[Debian Security Tracker](https://security-tracker.debian.org)
and for the issues that are considered serious a Debian Security Advisory
will be issued.

Low-impact issues not qualifying for a DSA can be fixed in the next
release of Debian, in a point release of the current stable or oldstable
distributions, or are included in a DSA when that is being issued for a
more serious vulnerability.

*Q: Can Debian assign CVE identifiers?*

A: Debian is a CVE Numbering Authority and can assign ids, but per
CVE policy only to yet-undisclosed issues. If you have an undisclosed
security vulnerability for software in Debian and would like to get an
identifier for it, contact the Debian Security Team. For cases where the
vulnerability is already public, we advise to follow the procedure
detailed in the [CVE OpenSource Request HOWTO](https://github.com/RedHatProductSecurity/CVE-HOWTO).

*Q: Does Debian have a vulnerability disclosure policy?*

A: Debian has published a [vulnerability
disclosure policy](disclosure-policy) as part of its participation in the CVE
program.

*Q: Our vulnerability management tool
has shown that the following issues are open (list of CVEs with random CVSS
scores). When are those going to be fixed?*

A: Debian does not provide CVSS scores and doesn't use CVSS scores from
external sources when triaging security issues.

You can check the state of every single CVE ID in the Debian Security Tracker by accessing
it by [ID](https://security-tracker.debian.org/tracker/CVE-ID).

The "Notes" section will contain additional information, e.g. that a security issue doesn't
warrant a Debian security update, but might get fixed in a subsequent point release.

A list of packages for which a Security update is planned can be found at the
[dsa-needed list](https://salsa.debian.org/security-tracker-team/security-tracker/raw/master/data/dsa-needed.txt).

If you find an error in triage data, you're very welcome to report it. The Debian Security Team will
however not generally react to requests asking for more specific information, you should instead contact
the vendor of your vulnerability management tool, after all they are the ones who alerted you about a
security issue and not Debian.

# Deprecated Debian security FAQ

*Q: What does local (remote) mean?*

**The field *Problem type* in DSA mails is not used since April 2014.**

A: Some advisories cover vulnerabilities that cannot be identified
with the classic scheme of local and remote exploitability. Some
vulnerabilities cannot be exploited from remote, i.e. don't
correspond to a daemon listening to a network port. If they can be
exploited by special files that could be provided via the network
while the vulnerable service is not permanently connected with the
network, we write local (remote) in such cases.

Such vulnerabilities are somewhat between local and remote
vulnerabilities and often cover archives that could be provided
through the network, e.g. as mail attachment or from a download
page.

---

Back to the [Debian Project homepage](../).

---

This page is also available in the following languages:
Select your language
dansk
Deutsch
español
français
Italiano
Nederlands
polski
Português
suomi
svenska
Русский (Russkij)
中文(简)
中文(HK)
中文(繁)
日本語 (Nihongo)

How to set [the default document language](../intro/cn)

---

**[Home](/)**

* [About](../intro/about)
  + [Social Contract](../social_contract)
  + [Code of Conduct](../code_of_conduct)
  + [Free Software](../intro/free)
  + [Legal Info](../legal)
* [Help Debian](../intro/help)

* [Getting Debian](../distrib/)
  + [Network install](../distrib/netinst)
  + [CD/USB ISO images](../CD/)
  + [Pure Blends](../blends/)
  + [Debian Packages](../distrib/packages)
  + [Developers' Corner](../devel/)

* [News](../News/)
  + [Project News](../News/weekly/)
  + [Events](../events/)
* [Documentation](../doc/)
  + [Release Info](../releases/)
  + [Debian Wiki](https://wiki.debian.org/)

* [Support](../support)
  + [Debian International](../international/)
  + [Security Information](../security/)
  + [Bug reports](../Bugs/)
  + [Mailing Lists](../MailingLists/)

* [Site map](../sitemap)
* [Search](https://search.debian.org/)
* [The Debian Blog](https://bits.debian.org)
* [Debian Micronews](https://micronews.debian.org)
* [Debian Planet](https://planet.debian.org)

See our [contact page](../contact) to get in touch. Web site source code is [available](https://salsa.debian.org/webmaster-team/webwml).

Last Modified: Fri, Oct 6 21:55:11 UTC 2023

Last Built: Sat, Jan 11 19:35:55 UTC 2025

Copyright © 1997-2023 [SPI](https://www.spi-inc.org/) and others; See [license terms](../license)

Debian is a registered [trademark](../trademark) of Software in the Public Interest, Inc.


