=== Content from sourceware.org_ed6a7f6d_20250124_120049.html ===


Sourceware Bugzilla – Bug 24039
integer overflow in libiberty, heap overflow will be triggered
Last modified: 2024-08-06 00:15:41 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=24039&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=24039&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 24039**](show_bug.cgi?id=24039)
- integer overflow in libiberty, heap overflow will be triggered

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
integer overflow in libiberty, heap overflow will be triggered

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED MOVED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | binutils | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=binutils "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | binutils ([show other bugs](buglist.cgi?component=binutils&product=binutils&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 2.32 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 critical | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Not yet assigned to anyone | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-12-27 14:08 UTC by tfx | | --- | --- | | Modified: | 2024-08-06 00:15 UTC ([History](show_activity.cgi?id=24039)) | | CC List: | 4 users (show)  nickc rschiron tfx\_sec zhuyan34 | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=88783> | | [Host:](page.cgi?id=fields.html#cf_gcchost "A custom Free Text field in this installation of Bugzilla.") |  | | [Target:](page.cgi?id=fields.html#cf_gcctarget "A custom Free Text field in this installation of Bugzilla.") |  | | [Build:](page.cgi?id=fields.html#cf_gccbuild "A custom Free Text field in this installation of Bugzilla.") |  | | [Last reconfirmed:](page.cgi?id=fields.html#cf_reconfirmed_on "A custom Date/Time field in this installation of Bugzilla.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**nm -C POC**](attachment.cgi?id=11495 "View the content of the attachment") (89 bytes, application/octet-stream)  [2018-12-27 14:08 UTC](#attach_11495 "Go to the comment associated with the attachment"), tfx | [Details](attachment.cgi?id=11495&action=edit) | | [**fix CVE-2018-20673**](attachment.cgi?id=11991 "View the content of the attachment") (669 bytes, patch)  [2019-09-12 07:54 UTC](#attach_11991 "Go to the comment associated with the attachment"), Yan Zhu | [Details](attachment.cgi?id=11991&action=edit) | [Diff](attachment.cgi?id=11991&action=diff) | | [View All](attachment.cgi?bugid=24039&action=viewall)  [Add an attachment](attachment.cgi?bugid=24039&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=24039&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=24039#c0)  tfx    2018-12-27 14:08:36 UTC  ``` Created [attachment 11495](attachment.cgi?id=11495 "nm -C POC") [[details]](attachment.cgi?id=11495&action=edit "nm -C POC") nm -C POC  I use 32bit binutils in 64bit Ubuntu 16.04.4 LTS.  The trigger command is ./nm -C POC  The source Code show as follow in cplus-dem.c  >2246      work->tmpl_argvec = XNEWVEC (char *, r);  //sizeof(char*) * r >2247      work->ntmpl_args = r; >2248      for (i = 0; i < r; i++) >2249   	work->tmpl_argvec[i] = 0;   Integer overflow when r > 0x40000000 in line 2246, that will trigger heap overflow in in line 2249.  There are several similar problems in libiberty.  The part of crash output show as follow. ================================================================= ==17964==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf44fea80 at pc 0x08837adf bp 0xffaceb68 sp 0xffaceb60 WRITE of size 4 at 0xf44fea80 thread T0     #0 0x8837ade  (./nm-new+0x8837ade)     #1 0x881916b  (./nm-new+0x881916b)     #2 0x880ad63  (./nm-new+0x880ad63)     #3 0x88029fe  (./nm-new+0x88029fe)     #4 0x8185166  (./nm-new+0x8185166)     #5 0x81472ea  (./nm-new+0x81472ea)     #6 0x815268b  (./nm-new+0x815268b)     #7 0x814d966  (./nm-new+0x814d966)     #8 0x8146040  (./nm-new+0x8146040)     #9 0x81441aa  (./nm-new+0x81441aa)     #10 0xf7c8e636  (/lib/i386-linux-gnu/libc.so.6+0x18636)     #11 0x8069dfc  (./nm-new+0x8069dfc)  0xf44fea80 is located 0 bytes to the right of 251581056-byte region [0xe5511800,0xf44fea80) allocated by thread T0 here:     #0 0x8115823  (./nm-new+0x8115823)     #1 0x89e6bd9  (./nm-new+0x89e6bd9)     #2 0x881916b  (./nm-new+0x881916b)     #3 0x880ad63  (./nm-new+0x880ad63)     #4 0x88029fe  (./nm-new+0x88029fe)     #5 0x8185166  (./nm-new+0x8185166)  SUMMARY: AddressSanitizer: heap-buffer-overflow (./nm-new+0x8837ade) Shadow bytes around the buggy address:   0x3e89fd00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e89fd10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e89fd20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e89fd30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e89fd40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x3e89fd50:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e89fd60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e89fd70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e89fd80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e89fd90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e89fda0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Heap right redzone:      fb   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack partial redzone:   f4   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb ==17964==ABORTING 00000000 AAborted ```  [Comment 1](show_bug.cgi?id=24039#c1)  tfx    2019-01-05 01:50:44 UTC  ``` I use latest binutils with debug info. crash output show as follow.   binutils/nm-new -C POC ================================================================= ==9029==ERROR: AddressSanitizer: heap-buffer-overflow on address 0xf3bfea80 at pc 0x083ba887 bp 0xffabcac8 sp 0xffabcac0 WRITE of size 4 at 0xf3bfea80 thread T0     #0 0x83ba886 in demangle_template ./binutils-gdb/libiberty/./cplus-dem.c:2249:23     #1 0x83b8c2e in demangle_signature ./binutils-gdb/libiberty/./cplus-dem.c:1709:18     #2 0x83b62da in internal_cplus_demangle ./binutils-gdb/libiberty/./cplus-dem.c:1258:14     #3 0x83b5143 in cplus_demangle ./binutils-gdb/libiberty/./cplus-dem.c:919:9     #4 0x815d092 in bfd_demangle ./binutils-gdb/bfd/bfd.c:2254:9     #5 0x81460a0 in print_symname ./binutils-gdb/binutils/nm.c:423:19     #6 0x8145035 in print_symbol_info_bsd ./binutils-gdb/binutils/nm.c:1565:3     #7 0x8149d87 in print_symbol ./binutils-gdb/binutils/nm.c:903:3     #8 0x8148828 in print_symbols ./binutils-gdb/binutils/nm.c:1102:7     #9 0x8146fdb in display_rel_file ./binutils-gdb/binutils/nm.c:1215:5     #10 0x8144a11 in display_file ./binutils-gdb/binutils/nm.c:1335:7     #11 0x814424f in main ./binutils-gdb/binutils/nm.c:1816:12     #12 0xf7d3f636 in __libc_start_main (/lib/i386-linux-gnu/libc.so.6+0x18636)     #13 0x806be08 in _start (./binutils-gdb/binutils/nm-new+0x806be08)  0xf3bfea80 is located 0 bytes to the right of 251581056-byte region [0xe4c11800,0xf3bfea80) allocated by thread T0 here:     #0 0x8112215 in malloc  asan_malloc_linux.cc:146:3     #1 0x83e6659 in xmalloc ./binutils-gdb/libiberty/./xmalloc.c:147:12     #2 0x83b8c2e in demangle_signature ./binutils-gdb/libiberty/./cplus-dem.c:1709:18     #3 0x83b62da in internal_cplus_demangle ./binutils-gdb/libiberty/./cplus-dem.c:1258:14     #4 0x83b5143 in cplus_demangle ./binutils-gdb/libiberty/./cplus-dem.c:919:9     #5 0x815d092 in bfd_demangle ./binutils-gdb/bfd/bfd.c:2254:9  SUMMARY: AddressSanitizer: heap-buffer-overflow ./binutils-gdb/libiberty/./cplus-dem.c:2249:23 in demangle_template Shadow bytes around the buggy address:   0x3e77fd00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e77fd10: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e77fd20: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e77fd30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x3e77fd40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x3e77fd50:[fa]fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e77fd60: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e77fd70: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e77fd80: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e77fd90: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x3e77fda0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==9029==ABORTING ```  [Comment 2](show_bug.cgi?id=24039#c2)  Nick Clifton    2019-01-09 16:25:39 UTC  ``` Hi tfx,    Thanks for reporting this problem.  Unfortunately the cplus-dem.c   source file is part of the libiberty library, which is maintained   by gcc rather than the binutils.  (It is used by the binutils, but   not maintained by us).  Please could you report this problem here:  <https://gcc.gnu.org/bugzilla/enter_bug.cgi?product=gcc>  Cheers   Nick ```  [Comment 3](show_bug.cgi?id=24039#c3)  rschiron    2019-01-14 14:02:47 UTC  ``` New bug was created in gcc project: <https://gcc.gnu.org/bugzilla/show_bug.cgi?id=88783> ```  [Comment 4](show_bug.cgi?id=24039#c4)  Yan Zhu    2019-09-12 07:54:04 UTC  ``` Created [attachment 11991](attachment.cgi?id=11991&action=diff "fix CVE-2018-20673") [[details]](attachment.cgi?id=11991&action=edit "fix CVE-2018-20673") fix CVE-2018-20673  Add a check before using the variable r ```  [Comment 5](show_bug.cgi?id=24039#c5)  Yan Zhu    2019-09-12 07:55:29 UTC  ``` Comment on [attachment 11991](attachment.cgi?id=11991&action=diff "fix CVE-2018-20673") [[details]](attachment.cgi?id=11991&action=edit "fix CVE-2018-20673") fix CVE-2018-20673  the binutils version is 2.31.1 ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=24039)
* - [XML](show_bug.cgi?ctype=xml&id=24039)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=24039)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=24039&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=24039&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


