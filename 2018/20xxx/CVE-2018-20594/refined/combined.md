=== Content from github.com_99fc2e36_20250125_070822.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhs-web%2Fhsweb-framework%2Fissues%2F107)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhs-web%2Fhsweb-framework%2Fissues%2F107)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=hs-web%2Fhsweb-framework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hs-web](/hs-web)
/
**[hsweb-framework](/hs-web/hsweb-framework)**
Public

* [Notifications](/login?return_to=%2Fhs-web%2Fhsweb-framework) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2Fhs-web%2Fhsweb-framework)
* [Star
   8.4k](/login?return_to=%2Fhs-web%2Fhsweb-framework)

* [Code](/hs-web/hsweb-framework)
* [Issues
  4](/hs-web/hsweb-framework/issues)
* [Pull requests
  0](/hs-web/hsweb-framework/pulls)
* [Discussions](/hs-web/hsweb-framework/discussions)
* [Actions](/hs-web/hsweb-framework/actions)
* [Projects
  0](/hs-web/hsweb-framework/projects)
* [Wiki](/hs-web/hsweb-framework/wiki)
* [Security](/hs-web/hsweb-framework/security)
* [Insights](/hs-web/hsweb-framework/pulse)

Additional navigation options

* [Code](/hs-web/hsweb-framework)
* [Issues](/hs-web/hsweb-framework/issues)
* [Pull requests](/hs-web/hsweb-framework/pulls)
* [Discussions](/hs-web/hsweb-framework/discussions)
* [Actions](/hs-web/hsweb-framework/actions)
* [Projects](/hs-web/hsweb-framework/projects)
* [Wiki](/hs-web/hsweb-framework/wiki)
* [Security](/hs-web/hsweb-framework/security)
* [Insights](/hs-web/hsweb-framework/pulse)

# 安全问题 #107

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[安全问题](#top)#107Copy linkAssignees [![zhou-hao](https://avatars.githubusercontent.com/u/7791838?s=64&u=6c8ada98400302407888bacf52651dc2e6b616dc&v=4)](/zhou-hao)Labels[bug](https://github.com/hs-web/hsweb-framework/issues?q=state%3Aopen%20label%3A%22bug%22)[重要程度:重要](https://github.com/hs-web/hsweb-framework/issues?q=state%3Aopen%20label%3A%22%E9%87%8D%E8%A6%81%E7%A8%8B%E5%BA%A6%3A%E9%87%8D%E8%A6%81%22)Milestone[3.0.5](https://github.com/hs-web/hsweb-framework/milestone/6)[![@QiAnXinCodeSafe](https://avatars.githubusercontent.com/u/39950310?u=8c4ad8c2174ba78c0604614a6e2feced07521ce6&v=4&size=80)](/QiAnXinCodeSafe)
## Description

[![@QiAnXinCodeSafe](https://avatars.githubusercontent.com/u/39950310?u=8c4ad8c2174ba78c0604614a6e2feced07521ce6&v=4&size=48)](/QiAnXinCodeSafe)[QiAnXinCodeSafe](https://github.com/QiAnXinCodeSafe)opened [on Dec 29, 2018](https://github.com/hs-web/hsweb-framework/issues/107#issue-394754711)

您好：

我是360代码卫士的工作人员，在我们的开源项目代码审计中发现hsweb-framework中存在如下三个安全问题。

一：反射型xss

1. 问题描述:

   [![default](https://user-images.githubusercontent.com/39950310/50532193-e3e16700-0b50-11e9-96ee-acb508704ac7.png)](https://user-images.githubusercontent.com/39950310/50532193-e3e16700-0b50-11e9-96ee-acb508704ac7.png)

   在FlowableModelManagerController.java文件中，接受了uri中的modelld和type参数 ，但由于未作校验（我对swagger不熟，它的注解应该是没有约束力的吧，只是方便生成开发文档？），当modelId不存在时，程序将直接在页面中输出type，导致xss漏洞
2. 复现步骤:

   由于该框架我没有搭建起来，只是做代码审计，没有复现，如果您对漏洞有疑问，我可以进行复现。后面两个也一样
3. 日志内容:

二：csrf

1. 问题描述:

   [![default](https://user-images.githubusercontent.com/39950310/50532473-a7176f00-0b54-11e9-9d9e-af24c430e99a.png)](https://user-images.githubusercontent.com/39950310/50532473-a7176f00-0b54-11e9-9d9e-af24c430e99a.png)

   在OAuth2ClientController.java文件中的callback方法中，用户认证完成后没有将请求中的state参数与session中的state进行对比，恶意攻击者可以通过csrf攻击进行账户劫持。
2. 复现步骤:
3. 日志内容:

三：路径遍历导致任意文件读取

1. 问题描述:

   [![default](https://user-images.githubusercontent.com/39950310/50532668-86044d80-0b57-11e9-8f0f-5ad3d85076a2.png)](https://user-images.githubusercontent.com/39950310/50532668-86044d80-0b57-11e9-8f0f-5ad3d85076a2.png)

   在FileManagerDevToolsController.java文件中，多个方法中没有对请求中的参数做过滤，导致路径遍历，以read方法为例，攻击者可能通过../进行回溯来读取系统文件/etc/passwd等敏感文件，虽然这些功能应该是只有管理员才能进行的操作，但是正常情况下就算是管理员，框架也不应该允许读取系统文件（毕竟不能保证管理员账号的安全，这只是增加了攻击的成本和难度）。
2. 复现步骤:
3. 日志内容:

还望及时修复

## Metadata

### Assignees

* [![@zhou-hao](https://avatars.githubusercontent.com/u/7791838?s=64&u=6c8ada98400302407888bacf52651dc2e6b616dc&v=4)zhou-hao](/zhou-hao)
### Labels

[bug](https://github.com/hs-web/hsweb-framework/issues?q=state%3Aopen%20label%3A%22bug%22)[重要程度:重要](https://github.com/hs-web/hsweb-framework/issues?q=state%3Aopen%20label%3A%22%E9%87%8D%E8%A6%81%E7%A8%8B%E5%BA%A6%3A%E9%87%8D%E8%A6%81%22)
### Type

No type
### Projects

No projects
### Milestone

* [3.0.5](https://github.com/hs-web/hsweb-framework/milestone/6)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0ee89252_20250125_070820.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhs-web%2Fhsweb-framework%2Fcommit%2Fb72a2275ed21240296c6539bae1049c56abb542f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhs-web%2Fhsweb-framework%2Fcommit%2Fb72a2275ed21240296c6539bae1049c56abb542f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=hs-web%2Fhsweb-framework)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[hs-web](/hs-web)
/
**[hsweb-framework](/hs-web/hsweb-framework)**
Public

* [Notifications](/login?return_to=%2Fhs-web%2Fhsweb-framework) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2Fhs-web%2Fhsweb-framework)
* [Star
   8.4k](/login?return_to=%2Fhs-web%2Fhsweb-framework)

* [Code](/hs-web/hsweb-framework)
* [Issues
  4](/hs-web/hsweb-framework/issues)
* [Pull requests
  0](/hs-web/hsweb-framework/pulls)
* [Discussions](/hs-web/hsweb-framework/discussions)
* [Actions](/hs-web/hsweb-framework/actions)
* [Projects
  0](/hs-web/hsweb-framework/projects)
* [Wiki](/hs-web/hsweb-framework/wiki)
* [Security](/hs-web/hsweb-framework/security)
* [Insights](/hs-web/hsweb-framework/pulse)

Additional navigation options

* [Code](/hs-web/hsweb-framework)
* [Issues](/hs-web/hsweb-framework/issues)
* [Pull requests](/hs-web/hsweb-framework/pulls)
* [Discussions](/hs-web/hsweb-framework/discussions)
* [Actions](/hs-web/hsweb-framework/actions)
* [Projects](/hs-web/hsweb-framework/projects)
* [Wiki](/hs-web/hsweb-framework/wiki)
* [Security](/hs-web/hsweb-framework/security)
* [Insights](/hs-web/hsweb-framework/pulse)

## Commit

[Permalink](/hs-web/hsweb-framework/commit/b72a2275ed21240296c6539bae1049c56abb542f)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fix [#107](https://github.com/hs-web/hsweb-framework/issues/107) 修复反射型xss

[Browse files](/hs-web/hsweb-framework/tree/b72a2275ed21240296c6539bae1049c56abb542f)
Browse the repository at this point in the history

* Loading branch information

[![@zhou-hao](https://avatars.githubusercontent.com/u/7791838?s=40&v=4)](/zhou-hao)

[zhou-hao](/hs-web/hsweb-framework/commits?author=zhou-hao "View all commits by zhou-hao")
committed
Dec 29, 2018

1 parent
[f4b0f02](/hs-web/hsweb-framework/commit/f4b0f02fa3baf7b6d69aa05aa2b9de3a76ddd9c3)

commit b72a227

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**46 additions**
and
**42 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow

  + enums

    - hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/enums/ModelType.java
      [ModelType.java](#diff-cfee762ee8afaee1181335d6e44e1be4ab275eebace675e44450e2f07add1040)
  + web

    - hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/web/FlowableModelManagerController.java
      [FlowableModelManagerController.java](#diff-ab235dced49e9fb1c06150ae757325c444d132b1b6c65f50286d0fcd193ef731)

## There are no files selected for viewing

9 changes: 9 additions & 0 deletions

9
[...-system-workflow-local/src/main/java/org/hswebframework/web/workflow/enums/ModelType.java](#diff-cfee762ee8afaee1181335d6e44e1be4ab275eebace675e44450e2f07add1040 "hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/enums/ModelType.java")

Show comments

[View file](/hs-web/hsweb-framework/blob/b72a2275ed21240296c6539bae1049c56abb542f/hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/enums/ModelType.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,9 @@ |
|  |  | package org.hswebframework.web.workflow.enums; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @author zhouhao |
|  |  | \* @since 3.0.5 |
|  |  | \*/ |
|  |  | public enum ModelType { |
|  |  | bpmn, json |
|  |  | } |

79 changes: 37 additions & 42 deletions

79
[...cal/src/main/java/org/hswebframework/web/workflow/web/FlowableModelManagerController.java](#diff-ab235dced49e9fb1c06150ae757325c444d132b1b6c65f50286d0fcd193ef731 "hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/web/FlowableModelManagerController.java")

Show comments

[View file](/hs-web/hsweb-framework/blob/b72a2275ed21240296c6539bae1049c56abb542f/hsweb-system/hsweb-system-workflow/hsweb-system-workflow-local/src/main/java/org/hswebframework/web/workflow/web/FlowableModelManagerController.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -8,6 +8,7 @@ |
|  |  | import io.swagger.annotations.Api; |
|  |  | import io.swagger.annotations.ApiOperation; |
|  |  | import io.swagger.annotations.ApiParam; |
|  |  | import lombok.SneakyThrows; |
|  |  | import lombok.extern.slf4j.Slf4j; |
|  |  | import org.activiti.bpmn.converter.BpmnXMLConverter; |
|  |  | import org.activiti.bpmn.model.BpmnModel; |
| Expand All | | @@ -33,6 +34,7 @@ |
|  |  | import org.hswebframework.web.commons.entity.PagerResult; |
|  |  | import org.hswebframework.web.commons.entity.param.QueryParamEntity; |
|  |  | import org.hswebframework.web.controller.message.ResponseMessage; |
|  |  | import org.hswebframework.web.workflow.enums.ModelType; |
|  |  | import org.hswebframework.web.workflow.util.QueryUtils; |
|  |  | import org.hswebframework.web.workflow.web.request.ModelCreateRequest; |
|  |  | import org.springframework.beans.factory.annotation.Autowired; |
| Expand Down  Expand Up | | @@ -132,58 +134,51 @@ public ResponseMessage<Deployment> deployModel(@PathVariable String modelId) thr |
|  |  | @GetMapping(value = "export/{modelId}/{type}") |
|  |  | @ApiOperation("导出模型") |
|  |  | @Authorize(action = "export") |
|  |  | @SneakyThrows |
|  |  | public void export(@PathVariable("modelId") @ApiParam("模型ID") String modelId, |
|  |  | @PathVariable("type") @ApiParam(value = "类型", allowableValues = "bpmn,json", example = "json") String type, |
|  |  | @PathVariable("type") @ApiParam(value = "类型", allowableValues = "bpmn,json", example = "json") |
|  |  | ModelType type, |
|  |  | @ApiParam(hidden = true) HttpServletResponse response) { |
|  |  | try { |
|  |  | Model modelData = repositoryService.getModel(modelId); |
|  |  | BpmnJsonConverter jsonConverter = new BpmnJsonConverter(); |
|  |  | byte[] modelEditorSource = repositoryService.getModelEditorSource(modelData.getId()); |
|  |  |  |
|  |  | JsonNode editorNode = new ObjectMapper().readTree(modelEditorSource); |
|  |  | BpmnModel bpmnModel = jsonConverter.convertToBpmnModel(editorNode); |
|  |  |  |
|  |  | // 处理异常 |
|  |  | if (bpmnModel.getMainProcess() == null) { |
|  |  | response.setStatus(HttpStatus.UNPROCESSABLE\_ENTITY.value()); |
|  |  | response.getOutputStream().println("no main process, can't export for dimension: " + type); |
|  |  | response.flushBuffer(); |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | String filename = ""; |
|  |  | byte[] exportBytes = null; |
|  |  |  |
|  |  | String mainProcessId = bpmnModel.getMainProcess().getId(); |
|  |  | Model modelData = repositoryService.getModel(modelId); |
|  |  | if (modelData == null) { |
|  |  | throw new NotFoundException("模型不存在"); |
|  |  | } |
|  |  | BpmnJsonConverter jsonConverter = new BpmnJsonConverter(); |
|  |  | byte[] modelEditorSource = repositoryService.getModelEditorSource(modelData.getId()); |
|  |  |  |
|  |  | if ("bpmn".equals(type)) { |
|  |  | JsonNode editorNode = new ObjectMapper().readTree(modelEditorSource); |
|  |  | BpmnModel bpmnModel = jsonConverter.convertToBpmnModel(editorNode); |
|  |  |  |
|  |  | BpmnXMLConverter xmlConverter = new BpmnXMLConverter(); |
|  |  | exportBytes = xmlConverter.convertToXML(bpmnModel); |
|  |  | // 处理异常 |
|  |  | if (bpmnModel.getMainProcess() == null) { |
|  |  | throw new UnsupportedOperationException("无法导出模型文件:" + type); |
|  |  | } |
|  |  |  |
|  |  | filename = mainProcessId + ".bpmn20.xml"; |
|  |  | } else if ("json".equals(type)) { |
|  |  | String filename = ""; |
|  |  | byte[] exportBytes = null; |
|  |  |  |
|  |  | exportBytes = modelEditorSource; |
|  |  | filename = mainProcessId + ".json"; |
|  |  | String mainProcessId = bpmnModel.getMainProcess().getId(); |
|  |  |  |
|  |  | } else { |
|  |  | throw new UnsupportedOperationException("不支持的格式:" + type); |
|  |  | } |
|  |  | if (type == ModelType.bpmn) { |
|  |  | BpmnXMLConverter xmlConverter = new BpmnXMLConverter(); |
|  |  | exportBytes = xmlConverter.convertToXML(bpmnModel); |
|  |  | filename = mainProcessId + ".bpmn20.xml"; |
|  |  | } else if (type == ModelType.json) { |
|  |  | exportBytes = modelEditorSource; |
|  |  | filename = mainProcessId + ".json"; |
|  |  |  |
|  |  | response.setCharacterEncoding("UTF-8"); |
|  |  | response.setContentType("application/octet-stream"); |
|  |  | response.setHeader("Content-Disposition", "attachment; filename=" + URLEncoder.encode(filename, "UTF-8")); |
|  |  | } else { |
|  |  | throw new UnsupportedOperationException("不支持的格式:" + type); |
|  |  | } |
|  |  |  |
|  |  | /\*创建输入流\*/ |
|  |  | try (ByteArrayInputStream in = new ByteArrayInputStream(exportBytes)) { |
|  |  | IOUtils.copy(in, response.getOutputStream()); |
|  |  | response.flushBuffer(); |
|  |  | in.close(); |
|  |  | } |
|  |  | response.setCharacterEncoding("UTF-8"); |
|  |  | response.setContentType("application/octet-stream"); |
|  |  | response.setHeader("Content-Disposition", "attachment; filename=" + URLEncoder.encode(filename, "UTF-8")); |
|  |  |  |
|  |  | } catch (Exception e) { |
|  |  | log.error("导出model的xml文件失败：modelId={}, type={}", modelId, type, e); |
|  |  | /\*创建输入流\*/ |
|  |  | try (ByteArrayInputStream in = new ByteArrayInputStream(exportBytes)) { |
|  |  | IOUtils.copy(in, response.getOutputStream()); |
|  |  | response.flushBuffer(); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b72a227`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fhs-web%2Fhsweb-framework%2Fcommit%2Fb72a2275ed21240296c6539bae1049c56abb542f) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


