```
{
  "vulnerability": {
    "cve_id": "CVE-2018-20583",
    "description": "Cross-site scripting (XSS) vulnerability in the PHP League CommonMark library versions 0.15.6 through 0.18.x before 0.18.1 allows remote attackers to insert unsafe URLs into HTML (even if allow_unsafe_links is false) via a newline character (e.g., writing javascript as javascri%0apt).",
    "affected_versions": ">= 0.15.6, < 0.18.1",
    "patched_versions": "0.18.1",
    "root_cause": "The URL normalization process in affected versions of the library failed to properly re-encode newline characters (`\\n`) after decoding them from `%0A`. This occurred because the regex used in the normalization process lacked the `s` modifier, causing it to not match newline characters.",
    "weaknesses": [
      "CWE-79"
    ],
    "impact": "An attacker can inject malicious JavaScript into a web page by crafting a Markdown link containing a newline character in the URL's protocol (e.g., `javascri%0Apt:`). When a user clicks on such a link, the browser executes the malicious JavaScript, leading to XSS.",
     "attack_vector": "Network",
    "required_capabilities": "The attacker needs to be able to inject crafted markdown content, typically in scenarios where user-provided content is rendered by the vulnerable library. No special privileges are needed on the server running the code. The user must interact with the crafted link (e.g. clicking on it).",
     "details": "The vulnerability arises from an inadequate URL normalization process. The library first decodes the URL, then re-encodes it. The regex used in the re-encoding step failed to match and re-encode newline characters, which were introduced via the `%0A` encoding. This resulted in the output HTML containing a newline character within the `href` attribute, which browsers ignore, allowing the execution of the embedded `javascript:`.",
    "remediation": "Upgrade to version 0.18.1 or later of the `league/commonmark` library. If HTML output is cached, purge and/or regenerate the cache."
  }
}
```