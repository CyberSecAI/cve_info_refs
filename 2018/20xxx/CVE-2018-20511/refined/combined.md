=== Content from usn.ubuntu.com_905599e4_20250125_183411.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4118-1: Linux kernel (AWS) vulnerabilities

2 September 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-aws-hwe](/security/cves?package=linux-aws-hwe) - Linux kernel for Amazon Web Services (AWS-HWE) systems

## Details

It was discovered that the alarmtimer implementation in the Linux kernel

contained an integer overflow vulnerability. A local attacker could use

this to cause a denial of service. ([CVE-2018-13053](/security/CVE-2018-13053))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly track inode validations. An attacker could use this

to construct a malicious XFS image that, when mounted, could cause a denial

of service (system crash). ([CVE-2018-13093](/security/CVE-2018-13093))

Wen Xu discovered that the f2fs file system implementation in the Linux

kernel did not properly validate metadata. An attacker could use this to

construct a malicious f2fs image that, when mounted, could cause a denial

of service (system crash). ([CVE-2018-13096](/security/CVE-2018-13096), [CVE-2018-13097](/security/CVE-2018-13097), [CVE-2018-13098](/security/CVE-2018-13098),

[CVE-2018-13099](/security/CVE-2018-13099), [CVE-2018-13100](/security/CVE-2018-13100), [CVE-2018-14614](/security/CVE-2018-14614), [CVE-2018-14615](/security/CVE-2018-14615),

[CVE-2018-14616](/security/CVE-2018-14616))

Wen Xu and Po-Ning Tseng discovered that btrfs file system implementation

in the Linux kernel did not properly validate metadata. An attacker could

use this to construct a malicious btrfs image that, when mounted, could

cause a denial of service (system crash). ([CVE-2018-14609](/security/CVE-2018-14609), [CVE-2018-14610](/security/CVE-2018-14610),

[CVE-2018-14611](/security/CVE-2018-14611), [CVE-2018-14612](/security/CVE-2018-14612), [CVE-2018-14613](/security/CVE-2018-14613))

Wen Xu discovered that the HFS+ filesystem implementation in the Linux

kernel did not properly handle malformed catalog data in some situations.

An attacker could use this to construct a malicious HFS+ image that, when

mounted, could cause a denial of service (system crash). ([CVE-2018-14617](/security/CVE-2018-14617))

Vasily Averin and Pavel Tikhomirov discovered that the cleancache subsystem

of the Linux kernel did not properly initialize new files in some

situations. A local attacker could use this to expose sensitive

information. ([CVE-2018-16862](/security/CVE-2018-16862))

Hui Peng and Mathias Payer discovered that the Option USB High Speed driver

in the Linux kernel did not properly validate metadata received from the

device. A physically proximate attacker could use this to cause a denial of

service (system crash). ([CVE-2018-19985](/security/CVE-2018-19985))

Hui Peng and Mathias Payer discovered that the USB subsystem in the Linux

kernel did not properly handle size checks when handling an extra USB

descriptor. A physically proximate attacker could use this to cause a

denial of service (system crash). ([CVE-2018-20169](/security/CVE-2018-20169))

Zhipeng Xie discovered that an infinite loop could be triggered in the CFS

Linux kernel process scheduler. A local attacker could possibly use this to

cause a denial of service. ([CVE-2018-20784](/security/CVE-2018-20784))

It was discovered that a use-after-free error existed in the block layer

subsystem of the Linux kernel when certain failure conditions occurred. A

local attacker could possibly use this to cause a denial of service (system

crash) or possibly execute arbitrary code. ([CVE-2018-20856](/security/CVE-2018-20856))

Eli Biham and Lior Neumann discovered that the Bluetooth implementation in

the Linux kernel did not properly validate elliptic curve parameters during

Diffie-Hellman key exchange in some situations. An attacker could use this

to expose sensitive information. ([CVE-2018-5383](/security/CVE-2018-5383))

It was discovered that the Intel Wi-Fi device driver in the Linux kernel did

not properly validate certain Tunneled Direct Link Setup (TDLS). A

physically proximate attacker could use this to cause a denial of service

(Wi-Fi disconnect). ([CVE-2019-0136](/security/CVE-2019-0136))

It was discovered that a heap buffer overflow existed in the Marvell

Wireless LAN device driver for the Linux kernel. An attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2019-10126](/security/CVE-2019-10126))

It was discovered that the Bluetooth UART implementation in the Linux

kernel did not properly check for missing tty operations. A local attacker

could use this to cause a denial of service. ([CVE-2019-10207](/security/CVE-2019-10207))

Amit Klein and Benny Pinkas discovered that the Linux kernel did not

sufficiently randomize IP ID values generated for connectionless networking

protocols. A remote attacker could use this to track particular Linux

devices. ([CVE-2019-10638](/security/CVE-2019-10638))

Amit Klein and Benny Pinkas discovered that the location of kernel

addresses could be exposed by the implementation of connection-less network

protocols in the Linux kernel. A remote attacker could possibly use this to

assist in the exploitation of another vulnerability in the Linux kernel.

([CVE-2019-10639](/security/CVE-2019-10639))

Adam Zabrocki discovered that the Intel i915 kernel mode graphics driver in

the Linux kernel did not properly restrict mmap() ranges in some

situations. A local attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-11085](/security/CVE-2019-11085))

It was discovered that an integer overflow existed in the Linux kernel when

reference counting pages, leading to potential use-after-free issues. A

local attacker could use this to cause a denial of service (system crash)

or possibly execute arbitrary code. ([CVE-2019-11487](/security/CVE-2019-11487))

Jann Horn discovered that a race condition existed in the Linux kernel when

performing core dumps. A local attacker could use this to cause a denial of

service (system crash) or expose sensitive information. ([CVE-2019-11599](/security/CVE-2019-11599))

It was discovered that a null pointer dereference vulnerability existed in

the LSI Logic MegaRAID driver in the Linux kernel. A local attacker could

use this to cause a denial of service (system crash). ([CVE-2019-11810](/security/CVE-2019-11810))

It was discovered that a race condition leading to a use-after-free existed

in the Reliable Datagram Sockets (RDS) protocol implementation in the Linux

kernel. The RDS protocol is disabled via blocklist by default in Ubuntu.

If enabled, a local attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-11815](/security/CVE-2019-11815))

It was discovered that the ext4 file system implementation in the Linux

kernel did not properly zero out memory in some situations. A local

attacker could use this to expose sensitive information (kernel memory).

([CVE-2019-11833](/security/CVE-2019-11833))

It was discovered that the Bluetooth Human Interface Device Protocol (HIDP)

implementation in the Linux kernel did not properly verify strings were

NULL terminated in certain situations. A local attacker could use this to

expose sensitive information (kernel memory). ([CVE-2019-11884](/security/CVE-2019-11884))

It was discovered that a NULL pointer dereference vulnerabilty existed in

the Near-field communication (NFC) implementation in the Linux kernel. An

attacker could use this to cause a denial of service (system crash).

([CVE-2019-12818](/security/CVE-2019-12818))

It was discovered that the MDIO bus devices subsystem in the Linux kernel

improperly dropped a device reference in an error condition, leading to a

use-after-free. An attacker could use this to cause a denial of service

(system crash). ([CVE-2019-12819](/security/CVE-2019-12819))

It was discovered that a NULL pointer dereference vulnerability existed in

the Near-field communication (NFC) implementation in the Linux kernel. A

local attacker could use this to cause a denial of service (system crash).

([CVE-2019-12984](/security/CVE-2019-12984))

Jann Horn discovered a use-after-free vulnerability in the Linux kernel

when accessing LDT entries in some situations. A local attacker could use

this to cause a denial of service (system crash) or possibly execute

arbitrary code. ([CVE-2019-13233](/security/CVE-2019-13233))

Jann Horn discovered that the ptrace implementation in the Linux kernel did

not properly record credentials in some situations. A local attacker could

use this to cause a denial of service (system crash) or possibly gain

administrative privileges. ([CVE-2019-13272](/security/CVE-2019-13272))

It was discovered that the GTCO tablet input driver in the Linux kernel did

not properly bounds check the initial HID report sent by the device. A

physically proximate attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-13631](/security/CVE-2019-13631))

It was discovered that the floppy driver in the Linux kernel did not

properly validate meta data, leading to a buffer overread. A local attacker

could use this to cause a denial of service (system crash).

([CVE-2019-14283](/security/CVE-2019-14283))

It was discovered that the floppy driver in the Linux kernel did not

properly validate ioctl() calls, leading to a division-by-zero. A local

attacker could use this to cause a denial of service (system crash).

([CVE-2019-14284](/security/CVE-2019-14284))

Tuba Yavuz discovered that a race condition existed in the DesignWare USB3

DRD Controller device driver in the Linux kernel. A physically proximate

attacker could use this to cause a denial of service. ([CVE-2019-14763](/security/CVE-2019-14763))

It was discovered that an out-of-bounds read existed in the QLogic QEDI

iSCSI Initiator Driver in the Linux kernel. A local attacker could possibly

use this to expose sensitive information (kernel memory). ([CVE-2019-15090](/security/CVE-2019-15090))

It was discovered that the Raremono AM/FM/SW radio device driver in the

Linux kernel did not properly allocate memory, leading to a use-after-free.

A physically proximate attacker could use this to cause a denial of service

or possibly execute arbitrary code. ([CVE-2019-15211](/security/CVE-2019-15211))

It was discovered at a double-free error existed in the USB Rio 500 device

driver for the Linux kernel. A physically proximate attacker could use this

to cause a denial of service. ([CVE-2019-15212](/security/CVE-2019-15212))

It was discovered that a race condition existed in the Advanced Linux Sound

Architecture (ALSA) subsystem of the Linux kernel, leading to a potential

use-after-free. A physically proximate attacker could use this to cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2019-15214](/security/CVE-2019-15214))

It was discovered that a race condition existed in the CPiA2 video4linux

device driver for the Linux kernel, leading to a use-after-free. A

physically proximate attacker could use this to cause a denial of service

(system crash) or possibly execute arbitrary code. ([CVE-2019-15215](/security/CVE-2019-15215))

It was discovered that a race condition existed in the Softmac USB Prism54

device driver in the Linux kernel. A physically proximate attacker could

use this to cause a denial of service (system crash). ([CVE-2019-15220](/security/CVE-2019-15220))

It was discovered that a use-after-free vulnerability existed in the

AppleTalk implementation in the Linux kernel if an error occurs during

initialization. A local attacker could use this to cause a denial of

service (system crash). ([CVE-2019-15292](/security/CVE-2019-15292))

It was discovered that the Empia EM28xx DVB USB device driver

implementation in the Linux kernel contained a use-after-free vulnerability

when disconnecting the device. An attacker could use this to cause a denial

of service (system crash). ([CVE-2019-2024](/security/CVE-2019-2024))

It was discovered that the USB video device class implementation in the

Linux kernel did not properly validate control bits, resulting in an out of

bounds buffer read. A local attacker could use this to possibly expose

sensitive information (kernel memory). ([CVE-2019-2101](/security/CVE-2019-2101))

It was discovered that the Marvell Wireless LAN device driver in the Linux

kernel did not properly validate the BSS descriptor. A local attacker could

possibly use this to cause a denial of service (system crash) or possibly

execute arbitrary code. ([CVE-2019-3846](/security/CVE-2019-3846))

Jason Wang discovered that an infinite loop vulnerability existed in the

virtio net driver in the Linux kernel. A local attacker in a guest VM could

possibly use this to cause a denial of service in the host system.

([CVE-2019-3900](/security/CVE-2019-3900))

Daniele Antonioli, Nils Ole Tippenhauer, and Kasper B. Rasmussen discovered

that the Bluetooth protocol BR/EDR specification did not properly require

sufficiently strong encryption key lengths. A physically proximate attacker

could use this to expose sensitive information. ([CVE-2019-9506](/security/CVE-2019-9506))

It was discovered that the Appletalk IP encapsulation driver in the Linux

kernel did not properly prevent kernel addresses from being copied to user

space. A local attacker with the CAP\_NET\_ADMIN capability could use this to

expose sensitive information. ([CVE-2018-20511](/security/CVE-2018-20511))

It was discovered that a race condition existed in the USB YUREX device

driver in the Linux kernel. A physically proximate attacker could use this

to cause a denial of service (system crash). ([CVE-2019-15216](/security/CVE-2019-15216))

It was discovered that the Siano USB MDTV receiver device driver in the

Linux kernel made improper assumptions about the device characteristics. A

physically proximate attacker could use this cause a denial of service

(system crash). ([CVE-2019-15218](/security/CVE-2019-15218))

It was discovered that the Line 6 POD USB device driver in the Linux kernel

did not properly validate data size information from the device. A

physically proximate attacker could use this to cause a denial of service

(system crash). ([CVE-2019-15221](/security/CVE-2019-15221))

Muyu Yu discovered that the CAN implementation in the Linux kernel in some

situations did not properly restrict the field size when processing

outgoing frames. A local attacker with CAP\_NET\_ADMIN privileges could use

this to execute arbitrary code. ([CVE-2019-3701](/security/CVE-2019-3701))

Vladis Dronov discovered that the debug interface for the Linux kernel's

HID subsystem did not properly validate passed parameters in some

situations. A local privileged attacker could use this to cause a denial of

service (infinite loop). ([CVE-2019-3819](/security/CVE-2019-3819))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-4.15.0-1047-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.15.0-1047.49](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.15.0-1047.49)
* [linux-image-aws](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws)
  -
  [4.15.0.1047.46](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws/4.15.0.1047.46)

##### Ubuntu 16.04

* [linux-image-4.15.0-1047-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws-hwe)
  -
  [4.15.0-1047.49~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-aws-hwe/4.15.0-1047.49~16.04.1)
* [linux-image-aws-hwe](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-hwe)
  -
  [4.15.0.1047.47](https://launchpad.net/ubuntu/%2Bsource/linux-meta-aws-hwe/4.15.0.1047.47)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-13053](/security/CVE-2018-13053)
* [CVE-2018-13093](/security/CVE-2018-13093)
* [CVE-2018-13096](/security/CVE-2018-13096)
* [CVE-2018-13097](/security/CVE-2018-13097)
* [CVE-2018-13098](/security/CVE-2018-13098)
* [CVE-2018-13099](/security/CVE-2018-13099)
* [CVE-2018-13100](/security/CVE-2018-13100)
* [CVE-2018-14609](/security/CVE-2018-14609)
* [CVE-2018-14610](/security/CVE-2018-14610)
* [CVE-2018-14611](/security/CVE-2018-14611)
* [CVE-2018-14612](/security/CVE-2018-14612)
* [CVE-2018-14613](/security/CVE-2018-14613)
* [CVE-2018-14614](/security/CVE-2018-14614)
* [CVE-2018-14615](/security/CVE-2018-14615)
* [CVE-2018-14616](/security/CVE-2018-14616)
* [CVE-2018-14617](/security/CVE-2018-14617)
* [CVE-2018-16862](/security/CVE-2018-16862)
* [CVE-2018-19985](/security/CVE-2018-19985)
* [CVE-2018-20169](/security/CVE-2018-20169)
* [CVE-2018-20511](/security/CVE-2018-20511)
* [CVE-2018-20784](/security/CVE-2018-20784)
* [CVE-2018-20856](/security/CVE-2018-20856)
* [CVE-2018-5383](/security/CVE-2018-5383)
* [CVE-2019-0136](/security/CVE-2019-0136)
* [CVE-2019-10126](/security/CVE-2019-10126)
* [CVE-2019-10207](/security/CVE-2019-10207)
* [CVE-2019-10638](/security/CVE-2019-10638)
* [CVE-2019-10639](/security/CVE-2019-10639)
* [CVE-2019-11085](/security/CVE-2019-11085)
* [CVE-2019-11487](/security/CVE-2019-11487)
* [CVE-2019-11599](/security/CVE-2019-11599)
* [CVE-2019-11810](/security/CVE-2019-11810)
* [CVE-2019-11815](/security/CVE-2019-11815)
* [CVE-2019-11833](/security/CVE-2019-11833)
* [CVE-2019-11884](/security/CVE-2019-11884)
* [CVE-2019-12818](/security/CVE-2019-12818)
* [CVE-2019-12819](/security/CVE-2019-12819)
* [CVE-2019-12984](/security/CVE-2019-12984)
* [CVE-2019-13233](/security/CVE-2019-13233)
* [CVE-2019-13272](/security/CVE-2019-13272)
* [CVE-2019-13631](/security/CVE-2019-13631)
* [CVE-2019-14283](/security/CVE-2019-14283)
* [CVE-2019-14284](/security/CVE-2019-14284)
* [CVE-2019-14763](/security/CVE-2019-14763)
* [CVE-2019-15090](/security/CVE-2019-15090)
* [CVE-2019-15211](/security/CVE-2019-15211)
* [CVE-2019-15212](/security/CVE-2019-15212)
* [CVE-2019-15214](/security/CVE-2019-15214)
* [CVE-2019-15215](/security/CVE-2019-15215)
* [CVE-2019-15216](/security/CVE-2019-15216)
* [CVE-2019-15218](/security/CVE-2019-15218)
* [CVE-2019-15220](/security/CVE-2019-15220)
* [CVE-2019-15221](/security/CVE-2019-15221)
* [CVE-2019-15292](/security/CVE-2019-15292)
* [CVE-2019-2024](/security/CVE-2019-2024)
* [CVE-2019-2101](/security/CVE-2019-2101)
* [CVE-2019-3701](/security/CVE-2019-3701)
* [CVE-2019-3819](/security/CVE-2019-3819)
* [CVE-2019-3846](/security/CVE-2019-3846)
* [CVE-2019-3900](/security/CVE-2019-3900)
* [CVE-2019-9506](/security/CVE-2019-9506)

## Related notices

* [USN-3821-1](/security/notices/USN-3821-1)
* [USN-4094-1](/security/notices/USN-4094-1)
* [USN-3821-2](/security/notices/USN-3821-2)
* [USN-4708-1](/security/notices/USN-4708-1)
* [USN-4709-1](/security/notices/USN-4709-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-4115-1](/security/notices/USN-4115-1)
* [USN-3910-2](/security/notices/USN-3910-2)
* [USN-3910-1](/security/notices/USN-3910-1)
* [USN-4211-2](/security/notices/USN-4211-2)
* [USN-4211-1](/security/notices/USN-4211-1)
* [USN-4116-1](/security/notices/USN-4116-1)
* [USN-4095-1](/security/notices/USN-4095-1)
* [USN-4095-2](/security/notices/USN-4095-2)
* [USN-4351-1](/security/notices/USN-4351-1)
* [USN-4145-1](/security/notices/USN-4145-1)
* [USN-4147-1](/security/notices/USN-4147-1)
* [USN-4117-1](/security/notices/USN-4117-1)
* [USN-4093-1](/security/notices/USN-4093-1)
* [USN-4114-1](/security/notices/USN-4114-1)
* [USN-4068-2](/security/notices/USN-4068-2)
* [USN-4068-1](/security/notices/USN-4068-1)
* [USN-4069-2](/security/notices/USN-4069-2)
* [USN-4069-1](/security/notices/USN-4069-1)
* [USN-4008-1](/security/notices/USN-4008-1)
* [USN-4008-3](/security/notices/USN-4008-3)
* [USN-4005-1](/security/notices/USN-4005-1)
* [USN-4076-1](/security/notices/USN-4076-1)
* [USN-4286-1](/security/notices/USN-4286-1)
* [USN-4286-2](/security/notices/USN-4286-2)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

Â© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from git.kernel.org_8074b5cd_20250125_183403.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Willy Tarreau <w@1wt.eu> | 2018-09-12 07:36:35 +0200 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2018-09-13 10:35:57 -0700 |
| commit | [9824dfae5741275473a23a7ed5756c7b6efacc9d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)) | |
| tree | [60fb9379f5c1fd396025a630e9d21f0742e70563](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d) | |
| parent | [018349d70f28a78d5343b3660cb66e1667005f8a](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=018349d70f28a78d5343b3660cb66e1667005f8a) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d&id2=018349d70f28a78d5343b3660cb66e1667005f8a)) | |
| download | [linux-9824dfae5741275473a23a7ed5756c7b6efacc9d.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-9824dfae5741275473a23a7ed5756c7b6efacc9d.tar.gz) | |

net/appletalk: fix minor pointer leak to userspace in SIOCFINDIPDDPRTFields ->dev and ->next of struct ipddp\_route may be copied to
userspace on the SIOCFINDIPDDPRT ioctl. This is only accessible
to CAP\_NET\_ADMIN though. Let's manually copy the relevant fields
instead of using memcpy().
BugLink: http://blog.infosectcbr.com.au/2018/09/linux-kernel-infoleaks.html
Cc: Jann Horn <jannh@google.com>
Signed-off-by: Willy Tarreau <w@1wt.eu>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)

| -rw-r--r-- | [drivers/net/appletalk/ipddp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/net/appletalk/ipddp.c?id=9824dfae5741275473a23a7ed5756c7b6efacc9d) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 2 deletions

| diff --git a/drivers/net/appletalk/ipddp.c b/drivers/net/appletalk/ipddp.cindex 9375cef2242053..3d27616d9c8554 100644--- a/[drivers/net/appletalk/ipddp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/net/appletalk/ipddp.c?id=018349d70f28a78d5343b3660cb66e1667005f8a)+++ b/[drivers/net/appletalk/ipddp.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/net/appletalk/ipddp.c?id=9824dfae5741275473a23a7ed5756c7b6efacc9d)@@ -283,8 +283,12 @@ static int ipddp\_ioctl(struct net\_device \*dev, struct ifreq \*ifr, int cmd) case SIOCFINDIPDDPRT: spin\_lock\_bh(&ipddp\_route\_lock); rp = \_\_ipddp\_find\_route(&rcp);- if (rp)- memcpy(&rcp2, rp, sizeof(rcp2));+ if (rp) {+ memset(&rcp2, 0, sizeof(rcp2));+ rcp2.ip = rp->ip;+ rcp2.at = rp->at;+ rcp2.flags = rp->flags;+ } spin\_unlock\_bh(&ipddp\_route\_lock);  if (rp) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 18:32:40 +0000



=== Content from lists.debian.org_402492cb_20250125_183407.html ===


---

[[Date Prev](msg00033.html)][[Date Next](msg00035.html)]
[[Thread Prev](msg00033.html)][[Thread Next](msg00035.html)]
[[Date Index](maillist.html#00034)]
[[Thread Index](threads.html#00034)]

# [SECURITY] [DLA 1731-1] linux security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1731-1] linux security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 27 Mar 2019 16:39:16 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/5b0c3bb681fa14cd501e68257f162910bfd3e179.camel%40debian.org)Â [5b0c3bb681fa14cd501e68257f162910bfd3e179.camel@debian.org](msg00034.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux
Version        : 3.16.64-1
CVE ID         : CVE-2016-10741 CVE-2017-5753 CVE-2017-13305 CVE-2018-3639
                 CVE-2018-5848 CVE-2018-5953 CVE-2018-12896 CVE-2018-13053
                 CVE-2018-16862 CVE-2018-16884 CVE-2018-17972 CVE-2018-18281
                 CVE-2018-18690 CVE-2018-18710 CVE-2018-19824 CVE-2018-19985
                 CVE-2018-20169 CVE-2018-20511 CVE-2019-3701 CVE-2019-3819
                 CVE-2019-6974 CVE-2019-7221 CVE-2019-7222 CVE-2019-9213

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2016-10741

    A race condition was discovered in XFS that would result in a
    crash (BUG). A local user permitted to write to an XFS volume
    could use this for denial of service.

CVE-2017-5753

    Further instances of code that was vulnerable to Spectre variant 1
    (bounds-check bypass) have been mitigated.

CVE-2017-13305

    A memory over-read was discovered in the keys subsystem's
    encrypted key type. A local user could use this for denial of
    service or possibly to read sensitive information.

CVE-2018-3639 (SSB)

    Multiple researchers have discovered that Speculative Store Bypass
    (SSB), a feature implemented in many processors, could be used to
    read sensitive information from another context. In particular,
    code in a software sandbox may be able to read sensitive
    information from outside the sandbox. This issue is also known as
    Spectre variant 4.

    This update fixes bugs in the mitigations for SSB for AMD
    processors.

CVE-2018-5848

    The wil6210 wifi driver did not properly validate lengths in scan
    and connection requests, leading to a possible buffer overflow.
    On systems using this driver, a local user with the CAP_NET_ADMIN
    capability could use this for denial of service (memory corruption
    or crash) or potentially for privilege escalation.

CVE-2018-5953

    The swiotlb subsystem printed kernel memory addresses to the
    system log, which could help a local attacker to exploit other
    vulnerabilities.

CVE-2018-12896, CVE-2018-13053

    Team OWL337 reported possible integer overflows in the POSIX
    timer implementation. These might have some security impact.

CVE-2018-16862

    Vasily Averin and Pavel Tikhomirov from Virtuozzo Kernel Team
    discovered that the cleancache memory management feature did not
    invalidate cached data for deleted files. On Xen guests using the
    tmem driver, local users could potentially read data from other
    users' deleted files if they were able to create new files on the
    same volume.

CVE-2018-16884

    A flaw was found in the NFS 4.1 client implementation. Mounting
    NFS shares in multiple network namespaces at the same time could
    lead to a user-after-free. Local users might be able to use this
    for denial of service (memory corruption or crash) or possibly
    for privilege escalation.

    This can be mitigated by disabling unprivileged users from
    creating user namespaces, which is the default in Debian.

CVE-2018-17972

    Jann Horn reported that the /proc/*/stack files in procfs leaked
    sensitive data from the kernel. These files are now only readable
    by users with the CAP_SYS_ADMIN capability (usually only root)

CVE-2018-18281

    Jann Horn reported a race condition in the virtual memory manager
    that can result in a process briefly having access to memory after
    it is freed and reallocated. A local user permitted to create
    containers could possibly exploit this for denial of service
    (memory corruption) or for privilege escalation.

CVE-2018-18690

    Kanda Motohiro reported that XFS did not correctly handle some
    xattr (extended attribute) writes that require changing the disk
    format of the xattr. A user with access to an XFS volume could use
    this for denial of service.

CVE-2018-18710

    It was discovered that the cdrom driver does not correctly
    validate the parameter to the CDROM_SELECT_DISC ioctl. A user with
    access to a cdrom device could use this to read sensitive
    information from the kernel or to cause a denial of service
    (crash).

CVE-2018-19824

    Hui Peng and Mathias Payer discovered a use-after-free bug in the
    USB audio driver. A physically present attacker able to attach a
    specially designed USB device could use this for privilege
    escalation.

CVE-2018-19985

    Hui Peng and Mathias Payer discovered a missing bounds check in the
    hso USB serial driver. A physically present user able to attach a
    specially designed USB device could use this to read sensitive
    information from the kernel or to cause a denial of service
    (crash).

CVE-2018-20169

    Hui Peng and Mathias Payer discovered missing bounds checks in the
    USB core. A physically present attacker able to attach a specially
    designed USB device could use this to cause a denial of service
    (crash) or possibly for privilege escalation.

CVE-2018-20511

    InfoSect reported an information leak in the AppleTalk IP/DDP
    implemntation. A local user with CAP_NET_ADMIN capability could
    use this to read sensitive information from the kernel.

CVE-2019-3701

    Muyu Yu and Marcus Meissner reported that the CAN gateway
    implementation allowed the frame length to be modified, typically
    resulting in out-of-bounds memory-mapped I/O writes.  On a system
    with CAN devices present, a local user with CAP_NET_ADMIN
    capability in the initial net namespace could use this to cause a
    crash (oops) or other hardware-dependent impact.

CVE-2019-3819

    A potential infinite loop was discovered in the HID debugfs
    interface exposed under /sys/kernel/debug/hid. A user with access
    to these files could use this for denial of service.

    This interface is only accessible to root by default, which fully
    mitigates the issue.

CVE-2019-6974

    Jann Horn reported a use-after-free bug in KVM. A local user
    with access to /dev/kvm could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation.

CVE-2019-7221

    Jim Mattson and Felix Wilhelm reported a user-after-free bug in
    KVM's nested VMX implementation. On systems with Intel CPUs, a
    local user with access to /dev/kvm could use this to cause a
    denial of service (memory corruption or crash) or possibly for
    privilege escalation.

    Nested VMX is disabled by default, which fully mitigates the
    issue.

CVE-2019-7222

    Felix Wilhelm reported an information leak in KVM for x86.
    A local user with access to /dev/kvm could use this to read
    sensitive information from the kernel.

CVE-2019-9213

    Jann Horn reported that privileged tasks could cause stack
    segments, including those in other processes, to grow downward to
    address 0. On systems lacking SMAP (x86) or PAN (ARM), this
    exacerbated other vulnerabilities: a null pointer dereference
    could be exploited for privilege escalation rather than only for
    denial of service.

For Debian 8 "Jessie", these problems have been fixed in version
3.16.64-1.

We recommend that you upgrade your linux packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpqXvulsOYFu.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from usn.ubuntu.com_c681e6d7_20250125_183410.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-4094-1: Linux kernel vulnerabilities

13 August 2019

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-gke-4.15](/security/cves?package=linux-gke-4.15) - Linux kernel for Google Container Engine (GKE) systems
* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-oem](/security/cves?package=linux-oem) - Linux kernel for OEM processors
* [linux-oracle](/security/cves?package=linux-oracle) - Linux kernel for Oracle Cloud systems
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2
* [linux-snapdragon](/security/cves?package=linux-snapdragon) - Linux kernel for Snapdragon processors

## Details

It was discovered that the alarmtimer implementation in the Linux kernel

contained an integer overflow vulnerability. A local attacker could use

this to cause a denial of service. ([CVE-2018-13053](/security/CVE-2018-13053))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly track inode validations. An attacker could use this

to construct a malicious XFS image that, when mounted, could cause a denial

of service (system crash). ([CVE-2018-13093](/security/CVE-2018-13093))

Wen Xu discovered that the f2fs file system implementation in the

Linux kernel did not properly validate metadata. An attacker could

use this to construct a malicious f2fs image that, when mounted,

could cause a denial of service (system crash). ([CVE-2018-13097](/security/CVE-2018-13097),

[CVE-2018-13099](/security/CVE-2018-13099), [CVE-2018-13100](/security/CVE-2018-13100), [CVE-2018-14614](/security/CVE-2018-14614), [CVE-2018-14616](/security/CVE-2018-14616),

[CVE-2018-13096](/security/CVE-2018-13096), [CVE-2018-13098](/security/CVE-2018-13098), [CVE-2018-14615](/security/CVE-2018-14615))

Wen Xu and Po-Ning Tseng discovered that btrfs file system

implementation in the Linux kernel did not properly validate

metadata. An attacker could use this to construct a malicious

btrfs image that, when mounted, could cause a denial of service

(system crash). ([CVE-2018-14610](/security/CVE-2018-14610), [CVE-2018-14611](/security/CVE-2018-14611), [CVE-2018-14612](/security/CVE-2018-14612),

[CVE-2018-14613](/security/CVE-2018-14613), [CVE-2018-14609](/security/CVE-2018-14609))

Wen Xu discovered that the HFS+ filesystem implementation in the Linux

kernel did not properly handle malformed catalog data in some situations.

An attacker could use this to construct a malicious HFS+ image that, when

mounted, could cause a denial of service (system crash). ([CVE-2018-14617](/security/CVE-2018-14617))

Vasily Averin and Pavel Tikhomirov discovered that the cleancache subsystem

of the Linux kernel did not properly initialize new files in some

situations. A local attacker could use this to expose sensitive

information. ([CVE-2018-16862](/security/CVE-2018-16862))

Hui Peng and Mathias Payer discovered that the USB subsystem in the Linux

kernel did not properly handle size checks when handling an extra USB

descriptor. A physically proximate attacker could use this to cause a

denial of service (system crash). ([CVE-2018-20169](/security/CVE-2018-20169))

It was discovered that a use-after-free error existed in the block layer

subsystem of the Linux kernel when certain failure conditions occurred. A

local attacker could possibly use this to cause a denial of service (system

crash) or possibly execute arbitrary code. ([CVE-2018-20856](/security/CVE-2018-20856))

Eli Biham and Lior Neumann discovered that the Bluetooth implementation in

the Linux kernel did not properly validate elliptic curve parameters during

Diffie-Hellman key exchange in some situations. An attacker could use this

to expose sensitive information. ([CVE-2018-5383](/security/CVE-2018-5383))

It was discovered that a heap buffer overflow existed in the Marvell

Wireless LAN device driver for the Linux kernel. An attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2019-10126](/security/CVE-2019-10126))

Andrei Vlad Lutas and Dan Lutas discovered that some x86 processors

incorrectly handle SWAPGS instructions during speculative execution. A

local attacker could use this to expose sensitive information (kernel

memory). ([CVE-2019-1125](/security/CVE-2019-1125))

It was discovered that the PowerPC dlpar implementation in the Linux kernel

did not properly check for allocation errors in some situations. A local

attacker could possibly use this to cause a denial of service (system

crash). ([CVE-2019-12614](/security/CVE-2019-12614))

It was discovered that a NULL pointer dereference vulnerabilty existed in

the Near-field communication (NFC) implementation in the Linux kernel. An

attacker could use this to cause a denial of service (system crash).

([CVE-2019-12818](/security/CVE-2019-12818))

It was discovered that the MDIO bus devices subsystem in the Linux kernel

improperly dropped a device reference in an error condition, leading to a

use-after-free. An attacker could use this to cause a denial of service

(system crash). ([CVE-2019-12819](/security/CVE-2019-12819))

It was discovered that a NULL pointer dereference vulnerability existed in

the Near-field communication (NFC) implementation in the Linux kernel. A

local attacker could use this to cause a denial of service (system crash).

([CVE-2019-12984](/security/CVE-2019-12984))

Jann Horn discovered a use-after-free vulnerability in the Linux kernel

when accessing LDT entries in some situations. A local attacker could use

this to cause a denial of service (system crash) or possibly execute

arbitrary code. ([CVE-2019-13233](/security/CVE-2019-13233))

Jann Horn discovered that the ptrace implementation in the Linux kernel did

not properly record credentials in some situations. A local attacker could

use this to cause a denial of service (system crash) or possibly gain

administrative privileges. ([CVE-2019-13272](/security/CVE-2019-13272))

It was discovered that the Empia EM28xx DVB USB device driver

implementation in the Linux kernel contained a use-after-free vulnerability

when disconnecting the device. An attacker could use this to cause a denial

of service (system crash). ([CVE-2019-2024](/security/CVE-2019-2024))

It was discovered that the USB video device class implementation in the

Linux kernel did not properly validate control bits, resulting in an out of

bounds buffer read. A local attacker could use this to possibly expose

sensitive information (kernel memory). ([CVE-2019-2101](/security/CVE-2019-2101))

It was discovered that the Marvell Wireless LAN device driver in the Linux

kernel did not properly validate the BSS descriptor. A local attacker could

possibly use this to cause a denial of service (system crash) or possibly

execute arbitrary code. ([CVE-2019-3846](/security/CVE-2019-3846))

It was discovered that the Appletalk IP encapsulation driver in the Linux

kernel did not properly prevent kernel addresses from being copied to user

space. A local attacker with the CAP\_NET\_ADMIN capability could use this to

expose sensitive information. ([CVE-2018-20511](/security/CVE-2018-20511))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-4.15.0-1021-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle)
  -
  [4.15.0-1021.23](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle/4.15.0-1021.23)
* [linux-image-4.15.0-1040-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [4.15.0-1040.42](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/4.15.0-1040.42)
* [linux-image-4.15.0-1040-gke](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-4.15)
  -
  [4.15.0-1040.42](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gke-4.15/4.15.0-1040.42)
* [linux-image-4.15.0-1042-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [4.15.0-1042.42](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/4.15.0-1042.42)
* [linux-image-4.15.0-1043-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.15.0-1043.46](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.15.0-1043.46)
* [linux-image-4.15.0-1050-oem](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oem)
  -
  [4.15.0-1050.57](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oem/4.15.0-1050.57)
* [linux-image-4.15.0-1060-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon)
  -
  [4.15.0-1060.66](https://launchpad.net/ubuntu/%2Bsource/linux-snapdragon/4.15.0-1060.66)
* [linux-image-4.15.0-58-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.15.0-58.64](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.15.0-58.64)
* [linux-image-4.15.0-58-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-58.64](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-58.64)
* [linux-image-4.15.0-58-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed)
  -
  [4.15.0-58.64](https://launchpad.net/ubuntu/%2Bsource/linux-signed/4.15.0-58.64)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1040.42](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1040.42)
* [linux-image-generic](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.58.60](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.58.60)
* [linux-image-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.58.60](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.58.60)
* [linux-image-gke](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-4.15)
  -
  [4.15.0.1040.43](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-4.15/4.15.0.1040.43)
* [linux-image-gke-4.15](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-4.15)
  -
  [4.15.0.1040.43](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gke-4.15/4.15.0.1040.43)
* [linux-image-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm)
  -
  [4.15.0.1042.42](https://launchpad.net/ubuntu/%2Bsource/linux-meta-kvm/4.15.0.1042.42)
* [linux-image-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.58.60](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.58.60)
* [linux-image-oem](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oem)
  -
  [4.15.0.1050.54](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oem/4.15.0.1050.54)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle)
  -
  [4.15.0.1021.24](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle/4.15.0.1021.24)
* [linux-image-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2)
  -
  [4.15.0.1043.41](https://launchpad.net/ubuntu/%2Bsource/linux-meta-raspi2/4.15.0.1043.41)
* [linux-image-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux-meta-snapdragon)
  -
  [4.15.0.1060.63](https://launchpad.net/ubuntu/%2Bsource/linux-meta-snapdragon/4.15.0.1060.63)
* [linux-image-virtual](https://launchpad.net/ubuntu/%2Bsource/linux-meta)
  -
  [4.15.0.58.60](https://launchpad.net/ubuntu/%2Bsource/linux-meta/4.15.0.58.60)

##### Ubuntu 16.04

* [linux-image-4.15.0-1021-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle)
  -
  [4.15.0-1021.23~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-oracle/4.15.0-1021.23~16.04.1)
* [linux-image-4.15.0-1040-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp)
  -
  [4.15.0-1040.42~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-gcp/4.15.0-1040.42~16.04.1)
* [linux-image-4.15.0-58-generic](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [4.15.0-58.64~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/4.15.0-58.64~16.04.1)
* [linux-image-4.15.0-58-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-58.64~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-58.64~16.04.1)
* [linux-image-4.15.0-58-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe)
  -
  [4.15.0-58.64~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-signed-hwe/4.15.0-58.64~16.04.1)
* [linux-image-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1040.54](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1040.54)
* [linux-image-generic-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.58.79](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.58.79)
* [linux-image-generic-lpae-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.58.79](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.58.79)
* [linux-image-gke](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp)
  -
  [4.15.0.1040.54](https://launchpad.net/ubuntu/%2Bsource/linux-meta-gcp/4.15.0.1040.54)
* [linux-image-lowlatency-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.58.79](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.58.79)
* [linux-image-oem](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.58.79](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.58.79)
* [linux-image-oracle](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle)
  -
  [4.15.0.1021.15](https://launchpad.net/ubuntu/%2Bsource/linux-meta-oracle/4.15.0.1021.15)
* [linux-image-virtual-hwe-16.04](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe)
  -
  [4.15.0.58.79](https://launchpad.net/ubuntu/%2Bsource/linux-meta-hwe/4.15.0.58.79)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-13053](/security/CVE-2018-13053)
* [CVE-2018-13093](/security/CVE-2018-13093)
* [CVE-2018-13096](/security/CVE-2018-13096)
* [CVE-2018-13097](/security/CVE-2018-13097)
* [CVE-2018-13098](/security/CVE-2018-13098)
* [CVE-2018-13099](/security/CVE-2018-13099)
* [CVE-2018-13100](/security/CVE-2018-13100)
* [CVE-2018-14609](/security/CVE-2018-14609)
* [CVE-2018-14610](/security/CVE-2018-14610)
* [CVE-2018-14611](/security/CVE-2018-14611)
* [CVE-2018-14612](/security/CVE-2018-14612)
* [CVE-2018-14613](/security/CVE-2018-14613)
* [CVE-2018-14614](/security/CVE-2018-14614)
* [CVE-2018-14615](/security/CVE-2018-14615)
* [CVE-2018-14616](/security/CVE-2018-14616)
* [CVE-2018-14617](/security/CVE-2018-14617)
* [CVE-2018-16862](/security/CVE-2018-16862)
* [CVE-2018-20169](/security/CVE-2018-20169)
* [CVE-2018-20511](/security/CVE-2018-20511)
* [CVE-2018-20856](/security/CVE-2018-20856)
* [CVE-2018-5383](/security/CVE-2018-5383)
* [CVE-2019-10126](/security/CVE-2019-10126)
* [CVE-2019-1125](/security/CVE-2019-1125)
* [CVE-2019-12614](/security/CVE-2019-12614)
* [CVE-2019-12818](/security/CVE-2019-12818)
* [CVE-2019-12819](/security/CVE-2019-12819)
* [CVE-2019-12984](/security/CVE-2019-12984)
* [CVE-2019-13233](/security/CVE-2019-13233)
* [CVE-2019-13272](/security/CVE-2019-13272)
* [CVE-2019-2024](/security/CVE-2019-2024)
* [CVE-2019-2101](/security/CVE-2019-2101)
* [CVE-2019-3846](/security/CVE-2019-3846)

## Related notices

* [USN-3821-1](/security/notices/USN-3821-1)
* [USN-4118-1](/security/notices/USN-4118-1)
* [USN-3821-2](/security/notices/USN-3821-2)
* [USN-4708-1](/security/notices/USN-4708-1)
* [USN-4709-1](/security/notices/USN-4709-1)
* [USN-3932-1](/security/notices/USN-3932-1)
* [USN-3932-2](/security/notices/USN-3932-2)
* [USN-3879-1](/security/notices/USN-3879-1)
* [USN-3879-2](/security/notices/USN-3879-2)
* [USN-4116-1](/security/notices/USN-4116-1)
* [USN-4095-1](/security/notices/USN-4095-1)
* [USN-4095-2](/security/notices/USN-4095-2)
* [USN-4351-1](/security/notices/USN-4351-1)
* [USN-4117-1](/security/notices/USN-4117-1)
* [USN-4093-1](/security/notices/USN-4093-1)
* [USN-4096-1](/security/notices/USN-4096-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

Â© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from lkml.org_99bec78d_20250125_183408.html ===


| [lkml.org](/) | Ã‚ | [[lkml]](/lkml) Ã‚Â  [[2018]](/lkml/2018) Ã‚Â  [[Sep]](/lkml/2018/9) Ã‚Â  [[27]](/lkml/2018/9/27) Ã‚Â  [[last100]](/lkml/last100) Ã‚Â  [RSS Feed](/rss.php)Views: [wrap][no wrap] Ã‚Â  [[headers]](/lkml/mheaders/2018/9/27/480)Ã‚Â  [[forward]](/lkml/bounce/2018/9/27/480)Ã‚ | Ã‚ |
| --- | --- | --- | --- |
| Messages in this thread  * [First message in thread](/lkml/2018/9/27/409) * [Greg Kroah-Hartman](/lkml/2018/9/27/409)   + [Greg Kroah-Hartman](/lkml/2018/9/27/402)   + [Greg Kroah-Hartman](/lkml/2018/9/27/403)   + [Greg Kroah-Hartman](/lkml/2018/9/27/404)   + [Greg Kroah-Hartman](/lkml/2018/9/27/406)   + [Greg Kroah-Hartman](/lkml/2018/9/27/407)   + [Greg Kroah-Hartman](/lkml/2018/9/27/408)   + [Greg Kroah-Hartman](/lkml/2018/9/27/410)   + [Greg Kroah-Hartman](/lkml/2018/9/27/411)   + [Greg Kroah-Hartman](/lkml/2018/9/27/412)   + [Greg Kroah-Hartman](/lkml/2018/9/27/413)   + [Greg Kroah-Hartman](/lkml/2018/9/27/414)   + [Greg Kroah-Hartman](/lkml/2018/9/27/415)   + [Greg Kroah-Hartman](/lkml/2018/9/27/416)   + [Greg Kroah-Hartman](/lkml/2018/9/27/418)   + [Greg Kroah-Hartman](/lkml/2018/9/27/419)   + [Greg Kroah-Hartman](/lkml/2018/9/27/420)   + [Greg Kroah-Hartman](/lkml/2018/9/27/421)   + [Greg Kroah-Hartman](/lkml/2018/9/27/422)   + [Greg Kroah-Hartman](/lkml/2018/9/27/423)   + [Greg Kroah-Hartman](/lkml/2018/9/27/424)   + [Greg Kroah-Hartman](/lkml/2018/9/27/425)   + [Greg Kroah-Hartman](/lkml/2018/9/27/426)   + [Greg Kroah-Hartman](/lkml/2018/9/27/427)   + [Greg Kroah-Hartman](/lkml/2018/9/27/428)   + [Greg Kroah-Hartman](/lkml/2018/9/27/429)   + [Greg Kroah-Hartman](/lkml/2018/9/27/430)   + [Greg Kroah-Hartman](/lkml/2018/9/27/431)   + [Greg Kroah-Hartman](/lkml/2018/9/27/432)   + [Greg Kroah-Hartman](/lkml/2018/9/27/433)   + [Greg Kroah-Hartman](/lkml/2018/9/27/434)   + [Greg Kroah-Hartman](/lkml/2018/9/27/435)   + [Greg Kroah-Hartman](/lkml/2018/9/27/436)   + [Greg Kroah-Hartman](/lkml/2018/9/27/437)   + [Greg Kroah-Hartman](/lkml/2018/9/27/439)   + [Greg Kroah-Hartman](/lkml/2018/9/27/440)   + [Greg Kroah-Hartman](/lkml/2018/9/27/441)   + [Greg Kroah-Hartman](/lkml/2018/9/27/442)   + [Greg Kroah-Hartman](/lkml/2018/9/27/443)   + [Greg Kroah-Hartman](/lkml/2018/9/27/444)   + [Greg Kroah-Hartman](/lkml/2018/9/27/445)   + [Greg Kroah-Hartman](/lkml/2018/9/27/446)   + [Greg Kroah-Hartman](/lkml/2018/9/27/447)   + [Greg Kroah-Hartman](/lkml/2018/9/27/448)   + [Greg Kroah-Hartman](/lkml/2018/9/27/450)   + [Greg Kroah-Hartman](/lkml/2018/9/27/451)   + [Greg Kroah-Hartman](/lkml/2018/9/27/452)   + [Greg Kroah-Hartman](/lkml/2018/9/27/453)   + [Greg Kroah-Hartman](/lkml/2018/9/27/454)   + [Greg Kroah-Hartman](/lkml/2018/9/27/455)   + [Greg Kroah-Hartman](/lkml/2018/9/27/456)   + [Greg Kroah-Hartman](/lkml/2018/9/27/457)   + [Greg Kroah-Hartman](/lkml/2018/9/27/458)   + [Greg Kroah-Hartman](/lkml/2018/9/27/459)   + [Greg Kroah-Hartman](/lkml/2018/9/27/460)   + [Greg Kroah-Hartman](/lkml/2018/9/27/461)   + [Greg Kroah-Hartman](/lkml/2018/9/27/462)   + [Greg Kroah-Hartman](/lkml/2018/9/27/463)   + [Greg Kroah-Hartman](/lkml/2018/9/27/464)   + [Greg Kroah-Hartman](/lkml/2018/9/27/465)   + [Greg Kroah-Hartman](/lkml/2018/9/27/466)     - [=?UTF-8?Q?Holger\_Hoffst=c3=a4tte?=](/lkml/2018/9/27/688)       * [Greg Kroah-Hartman](/lkml/2018/9/27/788)         + [=?UTF-8?Q?Holger\_Hoffst=c3=a4tte?=](/lkml/2018/9/27/825)   + [Greg Kroah-Hartman](/lkml/2018/9/27/467)   + [Greg Kroah-Hartman](/lkml/2018/9/27/468)   + [Greg Kroah-Hartman](/lkml/2018/9/27/469)   + [Greg Kroah-Hartman](/lkml/2018/9/27/470)   + [Greg Kroah-Hartman](/lkml/2018/9/27/471)   + [Greg Kroah-Hartman](/lkml/2018/9/27/472)   + [Greg Kroah-Hartman](/lkml/2018/9/27/473)   + [Greg Kroah-Hartman](/lkml/2018/9/27/475)   + [Greg Kroah-Hartman](/lkml/2018/9/27/476)   + [Greg Kroah-Hartman](/lkml/2018/9/27/477)   + [Greg Kroah-Hartman](/lkml/2018/9/27/478)   + [Greg Kroah-Hartman](/lkml/2018/9/27/479)   + Greg Kroah-Hartman   + [Greg Kroah-Hartman](/lkml/2018/9/27/481)   + [Greg Kroah-Hartman](/lkml/2018/9/27/482)   + [Greg Kroah-Hartman](/lkml/2018/9/27/483)   + [Greg Kroah-Hartman](/lkml/2018/9/27/484)   + [Greg Kroah-Hartman](/lkml/2018/9/27/525)   + [Greg Kroah-Hartman](/lkml/2018/9/27/526)   + [Greg Kroah-Hartman](/lkml/2018/9/27/527)   + [Greg Kroah-Hartman](/lkml/2018/9/27/528)   + [Greg Kroah-Hartman](/lkml/2018/9/27/529)   + [Greg Kroah-Hartman](/lkml/2018/9/27/530)   + [Greg Kroah-Hartman](/lkml/2018/9/27/531)   + [Greg Kroah-Hartman](/lkml/2018/9/27/534)   + [Greg Kroah-Hartman](/lkml/2018/9/27/535)   + [Greg Kroah-Hartman](/lkml/2018/9/27/536)   + [Greg Kroah-Hartman](/lkml/2018/9/27/1264)   + [Rafael David Tinoco](/lkml/2018/9/27/1325)     - [Greg Kroah-Hartman](/lkml/2018/9/28/202)   + [Shuah Khan](/lkml/2018/9/27/1332)     - [Greg Kroah-Hartman](/lkml/2018/9/28/200)   + [Guenter Roeck](/lkml/2018/9/28/15)     - [Greg Kroah-Hartman](/lkml/2018/9/28/201)   + [Greg Kroah-Hartman](/lkml/2018/9/27/1406)  Patch in this message  * [Get diff 1](/lkml/diff/2018/9/27/480/1) | / | | | From | Greg Kroah-Hartman <> | | --- | --- | | Subject | [PATCH 4.18 03/88] net/appletalk: fix minor pointer leak to userspace in SIOCFINDIPDDPRT | | Date | Thu, 27 Sep 2018 11:02:44 +0200 | |  | | --- | --- | --- | --- | --- | --- | --- | --- |  ``` 4.18-stable review patch.  If anyone has any objections, please let me know.------------------From: Willy Tarreau <w@1wt.eu>[ Upstream commit 9824dfae5741275473a23a7ed5756c7b6efacc9d ]Fields ->dev and ->next of struct ipddp_route may be copied touserspace on the SIOCFINDIPDDPRT ioctl. This is only accessibleto CAP_NET_ADMIN though. Let's manually copy the relevant fieldsinstead of using memcpy().BugLink: <http://blog.infosectcbr.com.au/2018/09/linux-kernel-infoleaks.html>Cc: Jann Horn <jannh@google.com>Signed-off-by: Willy Tarreau <w@1wt.eu>Signed-off-by: David S. Miller <davem@davemloft.net>Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>--- drivers/net/appletalk/ipddp.c |    8 ++++++-- 1 file changed, 6 insertions(+), 2 deletions(-)--- a/drivers/net/appletalk/ipddp.c+++ b/drivers/net/appletalk/ipddp.c@@ -283,8 +283,12 @@ static int ipddp_ioctl(struct net_device                 case SIOCFINDIPDDPRT: 			spin_lock_bh(&ipddp_route_lock); 			rp = __ipddp_find_route(&rcp);-			if (rp)-				memcpy(&rcp2, rp, sizeof(rcp2));+			if (rp) {+				memset(&rcp2, 0, sizeof(rcp2));+				rcp2.ip    = rp->ip;+				rcp2.at    = rp->at;+				rcp2.flags = rp->flags;+			} 			spin_unlock_bh(&ipddp_route_lock);  			if (rp) { ``` | \ |
| Ã‚ |
| Ã‚ | \ | Ã‚ | / |
| Ã‚ | | Last update: 2018-09-27 11:16 Ã‚Â Ã‚Â  [from the cache]Ã‚Â©2003-2020 [Jasper Spaans](http://blog.jasper.es/)|hosted at [Digital Ocean](https://www.digitalocean.com/?refcode=9a8e99d24cf9) and my Meterkast|[Read the blog](http://blog.jasper.es/categories.html#lkml-ref) | Ã‚ |



=== Content from github.com_bf8f2a39_20250125_183406.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9824dfae5741275473a23a7ed5756c7b6efacc9d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9824dfae5741275473a23a7ed5756c7b6efacc9d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/9824dfae5741275473a23a7ed5756c7b6efacc9d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

net/appletalk: fix minor pointer leak to userspace in SIOCFINDIPDDPRT

[Browse files](/torvalds/linux/tree/9824dfae5741275473a23a7ed5756c7b6efacc9d)
Browse the repository at this point in the history

```
Fields ->dev and ->next of struct ipddp_route may be copied to
userspace on the SIOCFINDIPDDPRT ioctl. This is only accessible
to CAP_NET_ADMIN though. Let's manually copy the relevant fields
instead of using memcpy().

BugLink: <http://blog.infosectcbr.com.au/2018/09/linux-kernel-infoleaks.html>
Cc: Jann Horn <jannh@google.com>
Signed-off-by: Willy Tarreau <w@1wt.eu>
Signed-off-by: David S. Miller <davem@davemloft.net>
```

* Loading branch information

[![@wtarreau](https://avatars.githubusercontent.com/u/8141789?s=40&v=4)](/wtarreau) [![@davem330](https://avatars.githubusercontent.com/u/1053866?s=40&v=4)](/davem330)

[wtarreau](/torvalds/linux/commits?author=wtarreau "View all commits by wtarreau")
authored and
[davem330](/torvalds/linux/commits?author=davem330 "View all commits by davem330")
committed
Sep 13, 2018

1 parent
[018349d](/torvalds/linux/commit/018349d70f28a78d5343b3660cb66e1667005f8a)

commit 9824dfa

Showing
**1 changed file**
with
**6 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

8 changes: 6 additions & 2 deletions

8
[drivers/net/appletalk/ipddp.c](#diff-c18a051f4b39dea920cbb0aab848884b539088679adb5922a985ea5c8349e8d3 "drivers/net/appletalk/ipddp.c")

Show comments

[View file](/torvalds/linux/blob/9824dfae5741275473a23a7ed5756c7b6efacc9d/drivers/net/appletalk/ipddp.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -283,8 +283,12 @@ static int ipddp\_ioctl(struct net\_device \*dev, struct ifreq \*ifr, int cmd) |
|  |  | case SIOCFINDIPDDPRT: |
|  |  | spin\_lock\_bh(&ipddp\_route\_lock); |
|  |  | rp = \_\_ipddp\_find\_route(&rcp); |
|  |  | if (rp) |
|  |  | memcpy(&rcp2, rp, sizeof(rcp2)); |
|  |  | if (rp) { |
|  |  | memset(&rcp2, 0, sizeof(rcp2)); |
|  |  | rcp2.ip = rp->ip; |
|  |  | rcp2.at = rp->at; |
|  |  | rcp2.flags = rp->flags; |
|  |  | } |
|  |  | spin\_unlock\_bh(&ipddp\_route\_lock); |
|  |  |  |
|  |  | if (rp) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9824dfa`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9824dfae5741275473a23a7ed5756c7b6efacc9d) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from lists.debian.org_e8e5a924_20250125_183408.html ===


---

[[Date Prev](msg00003.html)][[Date Next](msg00005.html)]
[[Thread Prev](msg00003.html)][[Thread Next](msg00005.html)]
[[Date Index](maillist.html#00004)]
[[Thread Index](threads.html#00004)]

# [SECURITY] [DLA 1731-2] linux regression update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1731-2] linux regression update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Mon, 01 Apr 2019 19:38:55 +0100
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/0bf51c1af1a79e50dbcbf751dd485d87e28a16e6.camel%40debian.org)Â [0bf51c1af1a79e50dbcbf751dd485d87e28a16e6.camel@debian.org](msg00004.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
Package        : linux
Version        : 3.16.64-2
CVE ID         : CVE-2016-10741 CVE-2017-5753 CVE-2017-13305 CVE-2018-3639
                 CVE-2018-5848 CVE-2018-5953 CVE-2018-12896 CVE-2018-13053
                 CVE-2018-16862 CVE-2018-16884 CVE-2018-17972 CVE-2018-18281
                 CVE-2018-18690 CVE-2018-18710 CVE-2018-19824 CVE-2018-19985
                 CVE-2018-20169 CVE-2018-20511 CVE-2019-3701 CVE-2019-3819
                 CVE-2019-6974 CVE-2019-7221 CVE-2019-7222 CVE-2019-9213
Debian Bug     : 925919

The linux update issued as DLA-1731-1 caused a regression in the
vmxnet3 (VMware virtual network adapter) driver.  This update corrects
that regression, and an earlier regression in the CIFS network
filesystem implementation introduced in DLA-1422-1.  For reference the
original advisory text follows.

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2016-10741

    A race condition was discovered in XFS that would result in a
    crash (BUG). A local user permitted to write to an XFS volume
    could use this for denial of service.

CVE-2017-5753

    Further instances of code that was vulnerable to Spectre variant 1
    (bounds-check bypass) have been mitigated.

CVE-2017-13305

    A memory over-read was discovered in the keys subsystem's
    encrypted key type. A local user could use this for denial of
    service or possibly to read sensitive information.

CVE-2018-3639 (SSB)

    Multiple researchers have discovered that Speculative Store Bypass
    (SSB), a feature implemented in many processors, could be used to
    read sensitive information from another context. In particular,
    code in a software sandbox may be able to read sensitive
    information from outside the sandbox. This issue is also known as
    Spectre variant 4.

    This update fixes bugs in the mitigations for SSB for AMD
    processors.

CVE-2018-5848

    The wil6210 wifi driver did not properly validate lengths in scan
    and connection requests, leading to a possible buffer overflow.
    On systems using this driver, a local user with the CAP_NET_ADMIN
    capability could use this for denial of service (memory corruption
    or crash) or potentially for privilege escalation.

CVE-2018-5953

    The swiotlb subsystem printed kernel memory addresses to the
    system log, which could help a local attacker to exploit other
    vulnerabilities.

CVE-2018-12896, CVE-2018-13053

    Team OWL337 reported possible integer overflows in the POSIX
    timer implementation. These might have some security impact.

CVE-2018-16862

    Vasily Averin and Pavel Tikhomirov from Virtuozzo Kernel Team
    discovered that the cleancache memory management feature did not
    invalidate cached data for deleted files. On Xen guests using the
    tmem driver, local users could potentially read data from other
    users' deleted files if they were able to create new files on the
    same volume.

CVE-2018-16884

    A flaw was found in the NFS 4.1 client implementation. Mounting
    NFS shares in multiple network namespaces at the same time could
    lead to a user-after-free. Local users might be able to use this
    for denial of service (memory corruption or crash) or possibly
    for privilege escalation.

    This can be mitigated by disabling unprivileged users from
    creating user namespaces, which is the default in Debian.

CVE-2018-17972

    Jann Horn reported that the /proc/*/stack files in procfs leaked
    sensitive data from the kernel. These files are now only readable
    by users with the CAP_SYS_ADMIN capability (usually only root)

CVE-2018-18281

    Jann Horn reported a race condition in the virtual memory manager
    that can result in a process briefly having access to memory after
    it is freed and reallocated. A local user permitted to create
    containers could possibly exploit this for denial of service
    (memory corruption) or for privilege escalation.

CVE-2018-18690

    Kanda Motohiro reported that XFS did not correctly handle some
    xattr (extended attribute) writes that require changing the disk
    format of the xattr. A user with access to an XFS volume could use
    this for denial of service.

CVE-2018-18710

    It was discovered that the cdrom driver does not correctly
    validate the parameter to the CDROM_SELECT_DISC ioctl. A user with
    access to a cdrom device could use this to read sensitive
    information from the kernel or to cause a denial of service
    (crash).

CVE-2018-19824

    Hui Peng and Mathias Payer discovered a use-after-free bug in the
    USB audio driver. A physically present attacker able to attach a
    specially designed USB device could use this for privilege
    escalation.

CVE-2018-19985

    Hui Peng and Mathias Payer discovered a missing bounds check in the
    hso USB serial driver. A physically present user able to attach a
    specially designed USB device could use this to read sensitive
    information from the kernel or to cause a denial of service
    (crash).

CVE-2018-20169

    Hui Peng and Mathias Payer discovered missing bounds checks in the
    USB core. A physically present attacker able to attach a specially
    designed USB device could use this to cause a denial of service
    (crash) or possibly for privilege escalation.

CVE-2018-20511

    InfoSect reported an information leak in the AppleTalk IP/DDP
    implemntation. A local user with CAP_NET_ADMIN capability could
    use this to read sensitive information from the kernel.

CVE-2019-3701

    Muyu Yu and Marcus Meissner reported that the CAN gateway
    implementation allowed the frame length to be modified, typically
    resulting in out-of-bounds memory-mapped I/O writes.  On a system
    with CAN devices present, a local user with CAP_NET_ADMIN
    capability in the initial net namespace could use this to cause a
    crash (oops) or other hardware-dependent impact.

CVE-2019-3819

    A potential infinite loop was discovered in the HID debugfs
    interface exposed under /sys/kernel/debug/hid. A user with access
    to these files could use this for denial of service.

    This interface is only accessible to root by default, which fully
    mitigates the issue.

CVE-2019-6974

    Jann Horn reported a use-after-free bug in KVM. A local user
    with access to /dev/kvm could use this to cause a denial of
    service (memory corruption or crash) or possibly for privilege
    escalation.

CVE-2019-7221

    Jim Mattson and Felix Wilhelm reported a user-after-free bug in
    KVM's nested VMX implementation. On systems with Intel CPUs, a
    local user with access to /dev/kvm could use this to cause a
    denial of service (memory corruption or crash) or possibly for
    privilege escalation.

    Nested VMX is disabled by default, which fully mitigates the
    issue.

CVE-2019-7222

    Felix Wilhelm reported an information leak in KVM for x86.
    A local user with access to /dev/kvm could use this to read
    sensitive information from the kernel.

CVE-2019-9213

    Jann Horn reported that privileged tasks could cause stack
    segments, including those in other processes, to grow downward to
    address 0. On systems lacking SMAP (x86) or PAN (ARM), this
    exacerbated other vulnerabilities: a null pointer dereference
    could be exploited for privilege escalation rather than only for
    denial of service.

For Debian 8 "Jessie", these problems have been fixed in version
3.16.64-1.

We recommend that you upgrade your linux packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings - Debian developer, member of kernel, installer and LTS teams

```

**Attachment:
[signature.asc](pgpaSRAek_d5H.pgp)**

*Description:* This is a digitally signed message part

---



=== Content from cdn.kernel.org_02880cf4_20250125_183405.html ===
commit 2f411a0873a9daa20ae16cf5879d11bbea267582
Author: Greg Kroah-Hartman
Date: Sat Sep 29 02:56:03 2018 -0700
Linux 4.18.11
commit e5bd6aca70efa763752aadc033027018a2aa8670
Author: Geert Uytterhoeven
Date: Tue Aug 21 11:53:03 2018 +0200
spi: Fix double IDR allocation with DT aliases
commit 04b2d03a75652bda989de1595048f0501dc0c0a0 upstream.
If the SPI bus number is provided by a DT alias, idr\_alloc() is called
twice, leading to:
WARNING: CPU: 1 PID: 1 at drivers/spi/spi.c:2179 spi\_register\_controller+0x11c/0x5d8
couldn't get idr
Fix this by moving the handling of fixed SPI bus numbers up, before the
DT handling code fills in ctlr->bus\_num.
Fixes: 1a4327fbf4554d5b ("spi: fix IDR collision on systems with both fixed and dynamic SPI bus numbers")
Signed-off-by: Geert Uytterhoeven
Tested-by: Fabio Estevam
Signed-off-by: Mark Brown
Cc: Sudip Mukherjee
Cc: Kirill Kapranov
Signed-off-by: Greg Kroah-Hartman
commit 4fda8face67c15d9e9a016e552963bf72e7fde84
Author: Steve Wise
Date: Fri Aug 31 07:15:56 2018 -0700
iw\_cxgb4: only allow 1 flush on user qps
commit 308aa2b8f7b7db3332a7d41099fd37851fb793b2 upstream.
Once the qp has been flushed, it cannot be flushed again. The user qp
flush logic wasn't enforcing it however. The bug can cause
touch-after-free crashes like:
Unable to handle kernel paging request for data at address 0x000001ec
Faulting instruction address: 0xc008000016069100
Oops: Kernel access of bad area, sig: 11 [#1]
...
NIP [c008000016069100] flush\_qp+0x80/0x480 [iw\_cxgb4]
LR [c00800001606cd6c] c4iw\_modify\_qp+0x71c/0x11d0 [iw\_cxgb4]
Call Trace:
[c00800001606cd6c] c4iw\_modify\_qp+0x71c/0x11d0 [iw\_cxgb4]
[c00800001606e868] c4iw\_ib\_modify\_qp+0x118/0x200 [iw\_cxgb4]
[c0080000119eae80] ib\_security\_modify\_qp+0xd0/0x3d0 [ib\_core]
[c0080000119c4e24] ib\_modify\_qp+0xc4/0x2c0 [ib\_core]
[c008000011df0284] iwcm\_modify\_qp\_err+0x44/0x70 [iw\_cm]
[c008000011df0fec] destroy\_cm\_id+0xcc/0x370 [iw\_cm]
[c008000011ed4358] rdma\_destroy\_id+0x3c8/0x520 [rdma\_cm]
[c0080000134b0540] ucma\_close+0x90/0x1b0 [rdma\_ucm]
[c000000000444da4] \_\_fput+0xe4/0x2f0
So fix flush\_qp() to only flush the wq once.
Cc: stable@vger.kernel.org
Signed-off-by: Steve Wise
Signed-off-by: Jason Gunthorpe
Signed-off-by: Greg Kroah-Hartman
commit 61b5194808f405fbf901f7c8280333cad0ec9768
Author: Nadav Amit
Date: Thu Sep 13 13:18:52 2018 -0700
vmw\_balloon: include asm/io.h
commit a3b92ee6fc171d7c9d9b6b829b7fef169210440c upstream.
Fix a build error due to missing virt\_to\_phys()
Reported-by: kbuild test robot
Fixes: f0a1bf29d821b ("vmw\_balloon: fix inflation with batching")
Cc: stable@vger.kernel.org
Cc: Xavier Deguillard
Signed-off-by: Nadav Amit
Signed-off-by: Greg Kroah-Hartman
commit ac586a2ffe31d77d3b6325708e5b4bfac6976f1b
Author: Steve Muckle
Date: Fri Aug 31 15:42:17 2018 -0700
sched/fair: Fix vruntime\_normalized() for remote non-migration wakeup
commit d0cdb3ce8834332d918fc9c8ff74f8a169ec9abe upstream.
When a task which previously ran on a given CPU is remotely queued to
wake up on that same CPU, there is a period where the task's state is
TASK\_WAKING and its vruntime is not normalized. This is not accounted
for in vruntime\_normalized() which will cause an error in the task's
vruntime if it is switched from the fair class during this time.
For example if it is boosted to RT priority via rt\_mutex\_setprio(),
rq->min\_vruntime will not be subtracted from the task's vruntime but
it will be added again when the task returns to the fair class. The
task's vruntime will have been erroneously doubled and the effective
priority of the task will be reduced.
Note this will also lead to inflation of all vruntimes since the doubled
vruntime value will become the rq's min\_vruntime when other tasks leave
the rq. This leads to repeated doubling of the vruntime and priority
penalty.
Fix this by recognizing a WAKING task's vruntime as normalized only if
sched\_remote\_wakeup is true. This indicates a migration, in which case
the vruntime would have been normalized in migrate\_task\_rq\_fair().
Based on a similar patch from John Dias .
Suggested-by: Peter Zijlstra
Tested-by: Dietmar Eggemann
Signed-off-by: Steve Muckle
Signed-off-by: Peter Zijlstra (Intel)
Cc: Chris Redpath
Cc: John Dias
Cc: Linus Torvalds
Cc: Miguel de Dios
Cc: Morten Rasmussen
Cc: Patrick Bellasi
Cc: Paul Turner
Cc: Quentin Perret
Cc: Thomas Gleixner
Cc: Todd Kjos
Cc: kernel-team@android.com
Fixes: b5179ac70de8 ("sched/fair: Prepare to fix fairness problems on migration")
Link: http://lkml.kernel.org/r/20180831224217.169476-1-smuckle@google.com
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit ec215095ac28e564e1eddf333fd85394b6908be4
Author: Toshi Kani
Date: Sat Sep 15 21:37:59 2018 -0400
ext4, dax: set ext4\_dax\_aops for dax files
commit cce6c9f7e6029caee45c459db5b3e78fec6973cb upstream.
Sync syscall to DAX file needs to flush processor cache, but it
currently does not flush to existing DAX files. This is because
'ext4\_da\_aops' is set to address\_space\_operations of existing DAX
files, instead of 'ext4\_dax\_aops', since S\_DAX flag is set after
ext4\_set\_aops() in the open path.
New file
--------
lookup\_open
ext4\_create
\_\_ext4\_new\_inode
ext4\_set\_inode\_flags // Set S\_DAX flag
ext4\_set\_aops // Set aops to ext4\_dax\_aops
Existing file
-------------
lookup\_open
ext4\_lookup
ext4\_iget
ext4\_set\_aops // Set aops to ext4\_da\_aops
ext4\_set\_inode\_flags // Set S\_DAX flag
Change ext4\_iget() to initialize i\_flags before ext4\_set\_aops().
Fixes: 5f0663bb4a64 ("ext4, dax: introduce ext4\_dax\_aops")
Signed-off-by: Toshi Kani
Signed-off-by: Theodore Ts'o
Suggested-by: Jan Kara
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit e2dd3371bfd1bb30163d0cac205aa212be4bdf36
Author: Toshi Kani
Date: Sat Sep 15 21:23:41 2018 -0400
ext4, dax: add ext4\_bmap to ext4\_dax\_aops
commit 94dbb63117e82253c9592816aa4465f0a9c94850 upstream.
Ext4 mount path calls .bmap to the journal inode. This currently
works for the DAX mount case because ext4\_iget() always set
'ext4\_da\_aops' to any regular files.
In preparation to fix ext4\_iget() to set 'ext4\_dax\_aops' for ext4
DAX files, add ext4\_bmap() to 'ext4\_dax\_aops', since bmap works for
DAX inodes.
Fixes: 5f0663bb4a64 ("ext4, dax: introduce ext4\_dax\_aops")
Signed-off-by: Toshi Kani
Signed-off-by: Theodore Ts'o
Suggested-by: Jan Kara
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit d60e0a56ac37edda1a62a0a38e9c93dbf7752b1a
Author: Eric Biggers
Date: Sat Sep 15 14:28:26 2018 -0400
ext4: show test\_dummy\_encryption mount option in /proc/mounts
commit 338affb548c243d2af25b1ca628e67819350de6b upstream.
When in effect, add "test\_dummy\_encryption" to \_ext4\_show\_options() so
that it is shown in /proc/mounts and other relevant procfs files.
Signed-off-by: Eric Biggers
Signed-off-by: Theodore Ts'o
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit da7a6e25fe8e8376b0848500494c645a5f12ce4b
Author: Li Dongyang
Date: Sat Sep 15 17:11:25 2018 -0400
ext4: don't mark mmp buffer head dirty
commit fe18d649891d813964d3aaeebad873f281627fbc upstream.
Marking mmp bh dirty before writing it will make writeback
pick up mmp block later and submit a write, we don't want the
duplicate write as kmmpd thread should have full control of
reading and writing the mmp block.
Another reason is we will also have random I/O error on
the writeback request when blk integrity is enabled, because
kmmpd could modify the content of the mmp block(e.g. setting
new seq and time) while the mmp block is under I/O requested
by writeback.
Signed-off-by: Li Dongyang
Signed-off-by: Theodore Ts'o
Reviewed-by: Andreas Dilger
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 705bcb551648b0f93e6bd196888972df8a043040
Author: Theodore Ts'o
Date: Mon Sep 3 22:25:01 2018 -0400
ext4: fix online resizing for bigalloc file systems with a 1k block size
commit 5f8c10936fab2b69a487400f2872902e597dd320 upstream.
An online resize of a file system with the bigalloc feature enabled
and a 1k block size would be refused since ext4\_resize\_begin() did not
understand s\_first\_data\_block is 0 for all bigalloc file systems, even
when the block size is 1k.
Signed-off-by: Theodore Ts'o
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit d47e119158ec3b7c5033f7c5d96576cdd682fdbe
Author: Theodore Ts'o
Date: Mon Sep 3 22:19:43 2018 -0400
ext4: fix online resize's handling of a too-small final block group
commit f0a459dec5495a3580f8d784555e6f8f3bf7f263 upstream.
Avoid growing the file system to an extent so that the last block
group is too small to hold all of the metadata that must be stored in
the block group.
This problem can be triggered with the following reproducer:
umount /mnt
mke2fs -F -m0 -b 4096 -t ext4 -O resize\_inode,^has\_journal \
-E resize=1073741824 /tmp/foo.img 128M
mount /tmp/foo.img /mnt
truncate --size 1708M /tmp/foo.img
resize2fs /dev/loop0 295400
umount /mnt
e2fsck -fy /tmp/foo.img
Reported-by: Torsten Hilbrich
Signed-off-by: Theodore Ts'o
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 2d0cd272e096cf41abae5ab22640836d00307edc
Author: Theodore Ts'o
Date: Sat Sep 1 14:42:14 2018 -0400
ext4: recalucate superblock checksum after updating free blocks/inodes
commit 4274f516d4bc50648a4d97e4f67ecbd7b65cde4a upstream.
When mounting the superblock, ext4\_fill\_super() calculates the free
blocks and free inodes and stores them in the superblock. It's not
strictly necessary, since we don't use them any more, but it's nice to
keep them roughly aligned to reality.
Since it's not critical for file system correctness, the code doesn't
call ext4\_commit\_super(). The problem is that it's in
ext4\_commit\_super() that we recalculate the superblock checksum. So
if we're not going to call ext4\_commit\_super(), we need to call
ext4\_superblock\_csum\_set() to make sure the superblock checksum is
consistent.
Most of the time, this doesn't matter, since we end up calling
ext4\_commit\_super() very soon thereafter, and definitely by the time
the file system is unmounted. However, it doesn't work in this
sequence:
mke2fs -Fq -t ext4 /dev/vdc 128M
mount /dev/vdc /vdc
cp xfstests/git-versions /vdc
godown /vdc
umount /vdc
mount /dev/vdc
tune2fs -l /dev/vdc
With this commit, the "tune2fs -l" no longer fails.
Reported-by: Chengguang Xu
Signed-off-by: Theodore Ts'o
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit a4cb1bf267a6db789655f05810dfb328e130a14c
Author: Theodore Ts'o
Date: Sat Sep 1 12:45:04 2018 -0400
ext4: avoid arithemetic overflow that can trigger a BUG
commit bcd8e91f98c156f4b1ebcfacae675f9cfd962441 upstream.
A maliciously crafted file system can cause an overflow when the
results of a 64-bit calculation is stored into a 32-bit length
parameter.
https://bugzilla.kernel.org/show\_bug.cgi?id=200623
Signed-off-by: Theodore Ts'o
Reported-by: Wen Xu
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 976eeff67a3ad52c8337e3e10d10ae0a93e7f1ec
Author: Theodore Ts'o
Date: Mon Aug 27 09:22:45 2018 -0400
ext4: avoid divide by zero fault when deleting corrupted inline directories
commit 4d982e25d0bdc83d8c64e66fdeca0b89240b3b85 upstream.
A specially crafted file system can trick empty\_inline\_dir() into
reading past the last valid entry in a inline directory, and then run
into the end of xattr marker. This will trigger a divide by zero
fault. Fix this by using the size of the inline directory instead of
dir->i\_size.
Also clean up error reporting in \_\_ext4\_check\_dir\_entry so that the
message is clearer and more understandable --- and avoids the division
by zero trap if the size passed in is zero. (I'm not sure why we
coded it that way in the first place; printing offset % size is
actually more confusing and less useful.)
https://bugzilla.kernel.org/show\_bug.cgi?id=200933
Signed-off-by: Theodore Ts'o
Reported-by: Wen Xu
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit fdad4e17dc61310f9099d868ac6e528313b1ca9d
Author: Theodore Ts'o
Date: Mon Aug 27 01:47:09 2018 -0400
ext4: check to make sure the rename(2)'s destination is not freed
commit b50282f3241acee880514212d88b6049fb5039c8 upstream.
If the destination of the rename(2) system call exists, the inode's
link count (i\_nlinks) must be non-zero. If it is, the inode can end
up on the orphan list prematurely, leading to all sorts of hilarity,
including a use-after-free.
https://bugzilla.kernel.org/show\_bug.cgi?id=200931
Signed-off-by: Theodore Ts'o
Reported-by: Wen Xu
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 52ef74c21c277e50de771fc722d814a830b3036b
Author: Gustavo A. R. Silva
Date: Thu Aug 16 15:30:38 2018 -0500
tty: vt\_ioctl: fix potential Spectre v1
commit e97267cb4d1ee01ca0929638ec0fcbb0904f903d upstream.
vsa.console is indirectly controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability.
This issue was detected with the help of Smatch:
drivers/tty/vt/vt\_ioctl.c:711 vt\_ioctl() warn: potential spectre issue
'vc\_cons' [r]
Fix this by sanitizing vsa.console before using it to index vc\_cons
Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].
[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva
Reviewed-by: Alan Cox
Signed-off-by: Greg Kroah-Hartman
commit 5a5338e45009de6834778c34a026f735d5caba04
Author: Alex Deucher
Date: Tue Sep 18 15:28:24 2018 -0500
drm/amdgpu: add new polaris pci id
commit 30f3984ede683b98a4e8096e200df78bf0609b4f upstream.
Add new pci id.
Reviewed-by: Rex Zhu
Signed-off-by: Alex Deucher
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 4cd5d680d8154ee3a061f6b36f1a4df6efa2da6c
Author: Emil Lundmark
Date: Mon May 28 16:27:11 2018 +0200
drm: udl: Destroy framebuffer only if it was initialized
commit fcb74da1eb8edd3a4ef9b9724f88ed709d684227 upstream.
This fixes a NULL pointer dereference that can happen if the UDL
driver is unloaded before the framebuffer is initialized. This can
happen e.g. if the USB device is unplugged right after it was plugged
in.
As explained by StÃ©phane Marchesin:
It happens when fbdev is disabled (which is the case for Chrome OS).
Even though intialization of the fbdev part is optional (it's done in
udlfb\_create which is the callback for fb\_probe()), the teardown isn't
optional (udl\_driver\_unload -> udl\_fbdev\_cleanup ->
udl\_fbdev\_destroy).
Note that udl\_fbdev\_cleanup \*tries\* to be conditional (you can see it
does if (!udl->fbdev)) but that doesn't work, because udl->fbdev is
always set during udl\_fbdev\_init.
Cc: stable@vger.kernel.org
Suggested-by: Sean Paul
Reviewed-by: Sean Paul
Acked-by: Daniel Vetter
Signed-off-by: Emil Lundmark
Signed-off-by: Sean Paul
Link: https://patchwork.freedesktop.org/patch/msgid/20180528142711.142466-1-lndmrk@chromium.org
Signed-off-by: Sean Paul
Signed-off-by: Greg Kroah-Hartman
commit 934df3d13fc60d8987f0b3e4920785355edf53fa
Author: Boris Brezillon
Date: Wed Jul 25 14:29:07 2018 +0200
drm/vc4: Fix the "no scaling" case on multi-planar YUV formats
commit 658d8cbd07dae22ccecf49399e18c609c4e85c53 upstream.
When there's no scaling requested ->is\_unity should be true no matter
the format.
Also, when no scaling is requested and we have a multi-planar YUV
format, we should leave ->y\_scaling[0] to VC4\_SCALING\_NONE and only
set ->x\_scaling[0] to VC4\_SCALING\_PPF.
Doing this fixes an hardly visible artifact (seen when using modetest
and a rather big overlay plane in YUV420).
Fixes: fc04023fafec ("drm/vc4: Add support for YUV planes.")
Cc:
Signed-off-by: Boris Brezillon
Reviewed-by: Eric Anholt
Link: https://patchwork.freedesktop.org/patch/msgid/20180725122907.13702-1-boris.brezillon@bootlin.com
Signed-off-by: Sean Paul
Signed-off-by: Greg Kroah-Hartman
commit 21fb862e0e3c3125dabbee740c3f0e9f95d669b9
Author: Lyude Paul
Date: Thu Aug 16 16:13:13 2018 -0400
drm/nouveau/drm/nouveau: Prevent handling ACPI HPD events too early
commit 79e765ad665da4b8aa7e9c878bd2fef837f6fea5 upstream.
On most systems with ACPI hotplugging support, it seems that we always
receive a hotplug event once we re-enable EC interrupts even if the GPU
hasn't even been resumed yet.
This can cause problems since even though we schedule hpd\_work to handle
connector reprobing for us, hpd\_work synchronizes on
pm\_runtime\_get\_sync() to wait until the device is ready to perform
reprobing. Since runtime suspend/resume callbacks are disabled before
the PM core calls ->suspend(), any calls to pm\_runtime\_get\_sync() during
this period will grab a runtime PM ref and return immediately with
-EACCES. Because we schedule hpd\_work from our ACPI HPD handler, and
hpd\_work synchronizes on pm\_runtime\_get\_sync(), this causes us to launch
a connector reprobe immediately even if the GPU isn't actually resumed
just yet. This causes various warnings in dmesg and occasionally, also
prevents some displays connected to the dedicated GPU from coming back
up after suspend. Example:
usb 1-4: USB disconnect, device number 14
usb 1-4.1: USB disconnect, device number 15
WARNING: CPU: 0 PID: 838 at drivers/gpu/drm/nouveau/include/nvkm/subdev/i2c.h:170 nouveau\_dp\_detect+0x17e/0x370 [nouveau]
CPU: 0 PID: 838 Comm: kworker/0:6 Not tainted 4.17.14-201.Lyude.bz1477182.V3.fc28.x86\_64 #1
Hardware name: LENOVO 20EQS64N00/20EQS64N00, BIOS N1EET77W (1.50 ) 03/28/2018
Workqueue: events nouveau\_display\_hpd\_work [nouveau]
RIP: 0010:nouveau\_dp\_detect+0x17e/0x370 [nouveau]
RSP: 0018:ffffa15143933cf0 EFLAGS: 00010293
RAX: 0000000000000000 RBX: ffff8cb4f656c400 RCX: 0000000000000000
RDX: ffffa1514500e4e4 RSI: ffffa1514500e4e4 RDI: 0000000001009002
RBP: ffff8cb4f4a8a800 R08: ffffa15143933cfd R09: ffffa15143933cfc
R10: 0000000000000000 R11: 0000000000000000 R12: ffff8cb4fb57a000
R13: ffff8cb4fb57a000 R14: ffff8cb4f4a8f800 R15: ffff8cb4f656c418
FS: 0000000000000000(0000) GS:ffff8cb51f400000(0000) knlGS:0000000000000000
CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
CR2: 00007f78ec938000 CR3: 000000073720a003 CR4: 00000000003606f0
DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
Call Trace:
? \_cond\_resched+0x15/0x30
nouveau\_connector\_detect+0x2ce/0x520 [nouveau]
? \_cond\_resched+0x15/0x30
? ww\_mutex\_lock+0x12/0x40
drm\_helper\_probe\_detect\_ctx+0x8b/0xe0 [drm\_kms\_helper]
drm\_helper\_hpd\_irq\_event+0xa8/0x120 [drm\_kms\_helper]
nouveau\_display\_hpd\_work+0x2a/0x60 [nouveau]
process\_one\_work+0x187/0x340
worker\_thread+0x2e/0x380
? pwq\_unbound\_release\_workfn+0xd0/0xd0
kthread+0x112/0x130
? kthread\_create\_worker\_on\_cpu+0x70/0x70
ret\_from\_fork+0x35/0x40
Code: 4c 8d 44 24 0d b9 00 05 00 00 48 89 ef ba 09 00 00 00 be 01 00 00 00 e8 e1 09 f8 ff 85 c0 0f 85 b2 01 00 00 80 7c 24 0c 03 74 02 <0f> 0b 48 89 ef e8 b8 07 f8 ff f6 05 51 1b c8 ff 02 0f 84 72 ff
---[ end trace 55d811b38fc8e71a ]---
So, to fix this we attempt to grab a runtime PM reference in the ACPI
handler itself asynchronously. If the GPU is already awake (it will have
normal hotplugging at this point) or runtime PM callbacks are currently
disabled on the device, we drop our reference without updating the
autosuspend delay. We only schedule connector reprobes when we
successfully managed to queue up a resume request with our asynchronous
PM ref.
This also has the added benefit of preventing redundant connector
reprobes from ACPI while the GPU is runtime resumed!
Signed-off-by: Lyude Paul
Cc: stable@vger.kernel.org
Cc: Karol Herbst
Bugzilla: https://bugzilla.redhat.com/show\_bug.cgi?id=1477182#c41
Signed-off-by: Lyude Paul
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 99aa61fb35ed40f5ae023549e50c3279e219de61
Author: Lyude Paul
Date: Wed Aug 15 15:00:14 2018 -0400
drm/nouveau/drm/nouveau: Use pm\_runtime\_get\_noresume() in connector\_detect()
commit 6833fb1ec120bf078e1a527c573a09d4de286224 upstream.
It's true we can't resume the device from poll workers in
nouveau\_connector\_detect(). We can however, prevent the autosuspend
timer from elapsing immediately if it hasn't already without risking any
sort of deadlock with the runtime suspend/resume operations. So do that
instead of entirely avoiding grabbing a power reference.
Signed-off-by: Lyude Paul
Reviewed-by: Karol Herbst
Acked-by: Daniel Vetter
Cc: stable@vger.kernel.org
Cc: Lukas Wunner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 9c7443a7aa646327acbaa02d16e7f7858e4e886c
Author: Lyude Paul
Date: Wed Aug 15 15:00:13 2018 -0400
drm/nouveau/drm/nouveau: Fix deadlock with fb\_helper with async RPM requests
commit 7fec8f5379fb6eddabc0aaef6d2304c366808f97 upstream.
Currently, nouveau uses the generic drm\_fb\_helper\_output\_poll\_changed()
function provided by DRM as it's output\_poll\_changed callback.
Unfortunately however, this function doesn't grab runtime PM references
early enough and even if it did-we can't block waiting for the device to
resume in output\_poll\_changed() since it's very likely that we'll need
to grab the fb\_helper lock at some point during the runtime resume
process. This currently results in deadlocking like so:
[ 246.669625] INFO: task kworker/4:0:37 blocked for more than 120 seconds.
[ 246.673398] Not tainted 4.18.0-rc5Lyude-Test+ #2
[ 246.675271] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 246.676527] kworker/4:0 D 0 37 2 0x80000000
[ 246.677580] Workqueue: events output\_poll\_execute [drm\_kms\_helper]
[ 246.678704] Call Trace:
[ 246.679753] \_\_schedule+0x322/0xaf0
[ 246.680916] schedule+0x33/0x90
[ 246.681924] schedule\_preempt\_disabled+0x15/0x20
[ 246.683023] \_\_mutex\_lock+0x569/0x9a0
[ 246.684035] ? kobject\_uevent\_env+0x117/0x7b0
[ 246.685132] ? drm\_fb\_helper\_hotplug\_event.part.28+0x20/0xb0 [drm\_kms\_helper]
[ 246.686179] mutex\_lock\_nested+0x1b/0x20
[ 246.687278] ? mutex\_lock\_nested+0x1b/0x20
[ 246.688307] drm\_fb\_helper\_hotplug\_event.part.28+0x20/0xb0 [drm\_kms\_helper]
[ 246.689420] drm\_fb\_helper\_output\_poll\_changed+0x23/0x30 [drm\_kms\_helper]
[ 246.690462] drm\_kms\_helper\_hotplug\_event+0x2a/0x30 [drm\_kms\_helper]
[ 246.691570] output\_poll\_execute+0x198/0x1c0 [drm\_kms\_helper]
[ 246.692611] process\_one\_work+0x231/0x620
[ 246.693725] worker\_thread+0x214/0x3a0
[ 246.694756] kthread+0x12b/0x150
[ 246.695856] ? wq\_pool\_ids\_show+0x140/0x140
[ 246.696888] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 246.697998] ret\_from\_fork+0x3a/0x50
[ 246.699034] INFO: task kworker/0:1:60 blocked for more than 120 seconds.
[ 246.700153] Not tainted 4.18.0-rc5Lyude-Test+ #2
[ 246.701182] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 246.702278] kworker/0:1 D 0 60 2 0x80000000
[ 246.703293] Workqueue: pm pm\_runtime\_work
[ 246.704393] Call Trace:
[ 246.705403] \_\_schedule+0x322/0xaf0
[ 246.706439] ? wait\_for\_completion+0x104/0x190
[ 246.707393] schedule+0x33/0x90
[ 246.708375] schedule\_timeout+0x3a5/0x590
[ 246.709289] ? mark\_held\_locks+0x58/0x80
[ 246.710208] ? \_raw\_spin\_unlock\_irq+0x2c/0x40
[ 246.711222] ? wait\_for\_completion+0x104/0x190
[ 246.712134] ? trace\_hardirqs\_on\_caller+0xf4/0x190
[ 246.713094] ? wait\_for\_completion+0x104/0x190
[ 246.713964] wait\_for\_completion+0x12c/0x190
[ 246.714895] ? wake\_up\_q+0x80/0x80
[ 246.715727] ? get\_work\_pool+0x90/0x90
[ 246.716649] flush\_work+0x1c9/0x280
[ 246.717483] ? flush\_workqueue\_prep\_pwqs+0x1b0/0x1b0
[ 246.718442] \_\_cancel\_work\_timer+0x146/0x1d0
[ 246.719247] cancel\_delayed\_work\_sync+0x13/0x20
[ 246.720043] drm\_kms\_helper\_poll\_disable+0x1f/0x30 [drm\_kms\_helper]
[ 246.721123] nouveau\_pmops\_runtime\_suspend+0x3d/0xb0 [nouveau]
[ 246.721897] pci\_pm\_runtime\_suspend+0x6b/0x190
[ 246.722825] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 246.723737] \_\_rpm\_callback+0x7a/0x1d0
[ 246.724721] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 246.725607] rpm\_callback+0x24/0x80
[ 246.726553] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 246.727376] rpm\_suspend+0x142/0x6b0
[ 246.728185] pm\_runtime\_work+0x97/0xc0
[ 246.728938] process\_one\_work+0x231/0x620
[ 246.729796] worker\_thread+0x44/0x3a0
[ 246.730614] kthread+0x12b/0x150
[ 246.731395] ? wq\_pool\_ids\_show+0x140/0x140
[ 246.732202] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 246.732878] ret\_from\_fork+0x3a/0x50
[ 246.733768] INFO: task kworker/4:2:422 blocked for more than 120 seconds.
[ 246.734587] Not tainted 4.18.0-rc5Lyude-Test+ #2
[ 246.735393] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 246.736113] kworker/4:2 D 0 422 2 0x80000080
[ 246.736789] Workqueue: events\_long drm\_dp\_mst\_link\_probe\_work [drm\_kms\_helper]
[ 246.737665] Call Trace:
[ 246.738490] \_\_schedule+0x322/0xaf0
[ 246.739250] schedule+0x33/0x90
[ 246.739908] rpm\_resume+0x19c/0x850
[ 246.740750] ? finish\_wait+0x90/0x90
[ 246.741541] \_\_pm\_runtime\_resume+0x4e/0x90
[ 246.742370] nv50\_disp\_atomic\_commit+0x31/0x210 [nouveau]
[ 246.743124] drm\_atomic\_commit+0x4a/0x50 [drm]
[ 246.743775] restore\_fbdev\_mode\_atomic+0x1c8/0x240 [drm\_kms\_helper]
[ 246.744603] restore\_fbdev\_mode+0x31/0x140 [drm\_kms\_helper]
[ 246.745373] drm\_fb\_helper\_restore\_fbdev\_mode\_unlocked+0x54/0xb0 [drm\_kms\_helper]
[ 246.746220] drm\_fb\_helper\_set\_par+0x2d/0x50 [drm\_kms\_helper]
[ 246.746884] drm\_fb\_helper\_hotplug\_event.part.28+0x96/0xb0 [drm\_kms\_helper]
[ 246.747675] drm\_fb\_helper\_output\_poll\_changed+0x23/0x30 [drm\_kms\_helper]
[ 246.748544] drm\_kms\_helper\_hotplug\_event+0x2a/0x30 [drm\_kms\_helper]
[ 246.749439] nv50\_mstm\_hotplug+0x15/0x20 [nouveau]
[ 246.750111] drm\_dp\_send\_link\_address+0x177/0x1c0 [drm\_kms\_helper]
[ 246.750764] drm\_dp\_check\_and\_send\_link\_address+0xa8/0xd0 [drm\_kms\_helper]
[ 246.751602] drm\_dp\_mst\_link\_probe\_work+0x51/0x90 [drm\_kms\_helper]
[ 246.752314] process\_one\_work+0x231/0x620
[ 246.752979] worker\_thread+0x44/0x3a0
[ 246.753838] kthread+0x12b/0x150
[ 246.754619] ? wq\_pool\_ids\_show+0x140/0x140
[ 246.755386] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 246.756162] ret\_from\_fork+0x3a/0x50
[ 246.756847]
Showing all locks held in the system:
[ 246.758261] 3 locks held by kworker/4:0/37:
[ 246.759016] #0: 00000000f8df4d2d ((wq\_completion)"events"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.759856] #1: 00000000e6065461 ((work\_completion)(&(&dev->mode\_config.output\_poll\_work)->work)){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.760670] #2: 00000000cb66735f (&helper->lock){+.+.}, at: drm\_fb\_helper\_hotplug\_event.part.28+0x20/0xb0 [drm\_kms\_helper]
[ 246.761516] 2 locks held by kworker/0:1/60:
[ 246.762274] #0: 00000000fff6be0f ((wq\_completion)"pm"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.762982] #1: 000000005ab44fb4 ((work\_completion)(&dev->power.work)){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.763890] 1 lock held by khungtaskd/64:
[ 246.764664] #0: 000000008cb8b5c3 (rcu\_read\_lock){....}, at: debug\_show\_all\_locks+0x23/0x185
[ 246.765588] 5 locks held by kworker/4:2/422:
[ 246.766440] #0: 00000000232f0959 ((wq\_completion)"events\_long"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.767390] #1: 00000000bb59b134 ((work\_completion)(&mgr->work)){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 246.768154] #2: 00000000cb66735f (&helper->lock){+.+.}, at: drm\_fb\_helper\_restore\_fbdev\_mode\_unlocked+0x4c/0xb0 [drm\_kms\_helper]
[ 246.768966] #3: 000000004c8f0b6b (crtc\_ww\_class\_acquire){+.+.}, at: restore\_fbdev\_mode\_atomic+0x4b/0x240 [drm\_kms\_helper]
[ 246.769921] #4: 000000004c34a296 (crtc\_ww\_class\_mutex){+.+.}, at: drm\_modeset\_backoff+0x8a/0x1b0 [drm]
[ 246.770839] 1 lock held by dmesg/1038:
[ 246.771739] 2 locks held by zsh/1172:
[ 246.772650] #0: 00000000836d0438 (&tty->ldisc\_sem){++++}, at: ldsem\_down\_read+0x37/0x40
[ 246.773680] #1: 000000001f4f4d48 (&ldata->atomic\_read\_lock){+.+.}, at: n\_tty\_read+0xc1/0x870
[ 246.775522] =============================================
After trying dozens of different solutions, I found one very simple one
that should also have the benefit of preventing us from having to fight
locking for the rest of our lives. So, we work around these deadlocks by
deferring all fbcon hotplug events that happen after the runtime suspend
process starts until after the device is resumed again.
Changes since v7:
- Fixup commit message - Daniel Vetter
Changes since v6:
- Remove unused nouveau\_fbcon\_hotplugged\_in\_suspend() - Ilia
Changes since v5:
- Come up with the (hopefully final) solution for solving this dumb
problem, one that is a lot less likely to cause issues with locking in
the future. This should work around all deadlock conditions with fbcon
brought up thus far.
Changes since v4:
- Add nouveau\_fbcon\_hotplugged\_in\_suspend() to workaround deadlock
condition that Lukas described
- Just move all of this out of drm\_fb\_helper. It seems that other DRM
drivers have already figured out other workarounds for this. If other
drivers do end up needing this in the future, we can just move this
back into drm\_fb\_helper again.
Changes since v3:
- Actually check if fb\_helper is NULL in both new helpers
- Actually check drm\_fbdev\_emulation in both new helpers
- Don't fire off a fb\_helper hotplug unconditionally; only do it if
the following conditions are true (as otherwise, calling this in the
wrong spot will cause Bad Things to happen):
- fb\_helper hotplug handling was actually inhibited previously
- fb\_helper actually has a delayed hotplug pending
- fb\_helper is actually bound
- fb\_helper is actually initialized
- Add \_\_must\_check to drm\_fb\_helper\_suspend\_hotplug(). There's no
situation where a driver would actually want to use this without
checking the return value, so enforce that
- Rewrite and clarify the documentation for both helpers.
- Make sure to return true in the drm\_fb\_helper\_suspend\_hotplug() stub
that's provided in drm\_fb\_helper.h when CONFIG\_DRM\_FBDEV\_EMULATION
isn't enabled
- Actually grab the toplevel fb\_helper lock in
drm\_fb\_helper\_resume\_hotplug(), since it's possible other activity
(such as a hotplug) could be going on at the same time the driver
calls drm\_fb\_helper\_resume\_hotplug(). We need this to check whether or
not drm\_fb\_helper\_hotplug\_event() needs to be called anyway
Signed-off-by: Lyude Paul
Reviewed-by: Karol Herbst
Acked-by: Daniel Vetter
Cc: stable@vger.kernel.org
Cc: Lukas Wunner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 563f482029d43706850ebc54a39cc31f1ed8fc19
Author: Lyude Paul
Date: Wed Aug 15 15:00:11 2018 -0400
drm/nouveau/drm/nouveau: Fix bogus drm\_kms\_helper\_poll\_enable() placement
commit d77ef138ff572409ab93d492e5e6c826ee6fb21d upstream.
Turns out this part is my fault for not noticing when reviewing
9a2eba337cace ("drm/nouveau: Fix drm poll\_helper handling"). Currently
we call drm\_kms\_helper\_poll\_enable() from nouveau\_display\_hpd\_work().
This makes basically no sense however, because that means we're calling
drm\_kms\_helper\_poll\_enable() every time we schedule the hotplug
detection work. This is also against the advice mentioned in
drm\_kms\_helper\_poll\_enable()'s documentation:
Note that calls to enable and disable polling must be strictly ordered,
which is automatically the case when they're only call from
suspend/resume callbacks.
Of course, hotplugs can't really be ordered. They could even happen
immediately after we called drm\_kms\_helper\_poll\_disable() in
nouveau\_display\_fini(), which can lead to all sorts of issues.
Additionally; enabling polling /after/ we call
drm\_helper\_hpd\_irq\_event() could also mean that we'd miss a hotplug
event anyway, since drm\_helper\_hpd\_irq\_event() wouldn't bother trying to
probe connectors so long as polling is disabled.
So; simply move this back into nouveau\_display\_init() again. The race
condition that both of these patches attempted to work around has
already been fixed properly in
d61a5c106351 ("drm/nouveau: Fix deadlock on runtime suspend")
Fixes: 9a2eba337cace ("drm/nouveau: Fix drm poll\_helper handling")
Signed-off-by: Lyude Paul
Acked-by: Karol Herbst
Acked-by: Daniel Vetter
Cc: Lukas Wunner
Cc: Peter Ujfalusi
Cc: stable@vger.kernel.org
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 0f756495557cbbaac0a392f3c160204f8b8f8131
Author: Lyude Paul
Date: Tue Aug 7 17:32:48 2018 -0400
drm/nouveau/drm/nouveau: Don't forget to cancel hpd\_work on suspend/unload
commit 2f7ca781fd382cf8dde73ed36dfdd93fd05b3332 upstream.
Currently, there's nothing in nouveau that actually cancels this work
struct. So, cancel it on suspend/unload. Otherwise, if we're unlucky
enough hpd\_work might try to keep running up until the system is
suspended.
Signed-off-by: Lyude Paul
Cc: stable@vger.kernel.org
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 86393a7e3315aa0a57e66857880a8536bab070c8
Author: Lyude Paul
Date: Wed Aug 15 15:00:15 2018 -0400
drm/nouveau: Fix deadlocks in nouveau\_connector\_detect()
commit 3e1a12754d4df5804bfca5dedf09d2ba291bdc2a upstream.
When we disable hotplugging on the GPU, we need to be able to
synchronize with each connector's hotplug interrupt handler before the
interrupt is finally disabled. This can be a problem however, since
nouveau\_connector\_detect() currently grabs a runtime power reference
when handling connector probing. This will deadlock the runtime suspend
handler like so:
[ 861.480896] INFO: task kworker/0:2:61 blocked for more than 120 seconds.
[ 861.483290] Tainted: G O 4.18.0-rc6Lyude-Test+ #1
[ 861.485158] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 861.486332] kworker/0:2 D 0 61 2 0x80000000
[ 861.487044] Workqueue: events nouveau\_display\_hpd\_work [nouveau]
[ 861.487737] Call Trace:
[ 861.488394] \_\_schedule+0x322/0xaf0
[ 861.489070] schedule+0x33/0x90
[ 861.489744] rpm\_resume+0x19c/0x850
[ 861.490392] ? finish\_wait+0x90/0x90
[ 861.491068] \_\_pm\_runtime\_resume+0x4e/0x90
[ 861.491753] nouveau\_display\_hpd\_work+0x22/0x60 [nouveau]
[ 861.492416] process\_one\_work+0x231/0x620
[ 861.493068] worker\_thread+0x44/0x3a0
[ 861.493722] kthread+0x12b/0x150
[ 861.494342] ? wq\_pool\_ids\_show+0x140/0x140
[ 861.494991] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 861.495648] ret\_from\_fork+0x3a/0x50
[ 861.496304] INFO: task kworker/6:2:320 blocked for more than 120 seconds.
[ 861.496968] Tainted: G O 4.18.0-rc6Lyude-Test+ #1
[ 861.497654] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 861.498341] kworker/6:2 D 0 320 2 0x80000080
[ 861.499045] Workqueue: pm pm\_runtime\_work
[ 861.499739] Call Trace:
[ 861.500428] \_\_schedule+0x322/0xaf0
[ 861.501134] ? wait\_for\_completion+0x104/0x190
[ 861.501851] schedule+0x33/0x90
[ 861.502564] schedule\_timeout+0x3a5/0x590
[ 861.503284] ? mark\_held\_locks+0x58/0x80
[ 861.503988] ? \_raw\_spin\_unlock\_irq+0x2c/0x40
[ 861.504710] ? wait\_for\_completion+0x104/0x190
[ 861.505417] ? trace\_hardirqs\_on\_caller+0xf4/0x190
[ 861.506136] ? wait\_for\_completion+0x104/0x190
[ 861.506845] wait\_for\_completion+0x12c/0x190
[ 861.507555] ? wake\_up\_q+0x80/0x80
[ 861.508268] flush\_work+0x1c9/0x280
[ 861.508990] ? flush\_workqueue\_prep\_pwqs+0x1b0/0x1b0
[ 861.509735] nvif\_notify\_put+0xb1/0xc0 [nouveau]
[ 861.510482] nouveau\_display\_fini+0xbd/0x170 [nouveau]
[ 861.511241] nouveau\_display\_suspend+0x67/0x120 [nouveau]
[ 861.511969] nouveau\_do\_suspend+0x5e/0x2d0 [nouveau]
[ 861.512715] nouveau\_pmops\_runtime\_suspend+0x47/0xb0 [nouveau]
[ 861.513435] pci\_pm\_runtime\_suspend+0x6b/0x180
[ 861.514165] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 861.514897] \_\_rpm\_callback+0x7a/0x1d0
[ 861.515618] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 861.516313] rpm\_callback+0x24/0x80
[ 861.517027] ? pci\_has\_legacy\_pm\_support+0x70/0x70
[ 861.517741] rpm\_suspend+0x142/0x6b0
[ 861.518449] pm\_runtime\_work+0x97/0xc0
[ 861.519144] process\_one\_work+0x231/0x620
[ 861.519831] worker\_thread+0x44/0x3a0
[ 861.520522] kthread+0x12b/0x150
[ 861.521220] ? wq\_pool\_ids\_show+0x140/0x140
[ 861.521925] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 861.522622] ret\_from\_fork+0x3a/0x50
[ 861.523299] INFO: task kworker/6:0:1329 blocked for more than 120 seconds.
[ 861.523977] Tainted: G O 4.18.0-rc6Lyude-Test+ #1
[ 861.524644] "echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
[ 861.525349] kworker/6:0 D 0 1329 2 0x80000000
[ 861.526073] Workqueue: events nvif\_notify\_work [nouveau]
[ 861.526751] Call Trace:
[ 861.527411] \_\_schedule+0x322/0xaf0
[ 861.528089] schedule+0x33/0x90
[ 861.528758] rpm\_resume+0x19c/0x850
[ 861.529399] ? finish\_wait+0x90/0x90
[ 861.530073] \_\_pm\_runtime\_resume+0x4e/0x90
[ 861.530798] nouveau\_connector\_detect+0x7e/0x510 [nouveau]
[ 861.531459] ? ww\_mutex\_lock+0x47/0x80
[ 861.532097] ? ww\_mutex\_lock+0x47/0x80
[ 861.532819] ? drm\_modeset\_lock+0x88/0x130 [drm]
[ 861.533481] drm\_helper\_probe\_detect\_ctx+0xa0/0x100 [drm\_kms\_helper]
[ 861.534127] drm\_helper\_hpd\_irq\_event+0xa4/0x120 [drm\_kms\_helper]
[ 861.534940] nouveau\_connector\_hotplug+0x98/0x120 [nouveau]
[ 861.535556] nvif\_notify\_work+0x2d/0xb0 [nouveau]
[ 861.536221] process\_one\_work+0x231/0x620
[ 861.536994] worker\_thread+0x44/0x3a0
[ 861.537757] kthread+0x12b/0x150
[ 861.538463] ? wq\_pool\_ids\_show+0x140/0x140
[ 861.539102] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 861.539815] ret\_from\_fork+0x3a/0x50
[ 861.540521]
Showing all locks held in the system:
[ 861.541696] 2 locks held by kworker/0:2/61:
[ 861.542406] #0: 000000002dbf8af5 ((wq\_completion)"events"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.543071] #1: 0000000076868126 ((work\_completion)(&drm->hpd\_work)){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.543814] 1 lock held by khungtaskd/64:
[ 861.544535] #0: 0000000059db4b53 (rcu\_read\_lock){....}, at: debug\_show\_all\_locks+0x23/0x185
[ 861.545160] 3 locks held by kworker/6:2/320:
[ 861.545896] #0: 00000000d9e1bc59 ((wq\_completion)"pm"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.546702] #1: 00000000c9f92d84 ((work\_completion)(&dev->power.work)){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.547443] #2: 000000004afc5de1 (drm\_connector\_list\_iter){.+.+}, at: nouveau\_display\_fini+0x96/0x170 [nouveau]
[ 861.548146] 1 lock held by dmesg/983:
[ 861.548889] 2 locks held by zsh/1250:
[ 861.549605] #0: 00000000348e3cf6 (&tty->ldisc\_sem){++++}, at: ldsem\_down\_read+0x37/0x40
[ 861.550393] #1: 000000007009a7a8 (&ldata->atomic\_read\_lock){+.+.}, at: n\_tty\_read+0xc1/0x870
[ 861.551122] 6 locks held by kworker/6:0/1329:
[ 861.551957] #0: 000000002dbf8af5 ((wq\_completion)"events"){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.552765] #1: 00000000ddb499ad ((work\_completion)(&notify->work)#2){+.+.}, at: process\_one\_work+0x1b3/0x620
[ 861.553582] #2: 000000006e013cbe (&dev->mode\_config.mutex){+.+.}, at: drm\_helper\_hpd\_irq\_event+0x6c/0x120 [drm\_kms\_helper]
[ 861.554357] #3: 000000004afc5de1 (drm\_connector\_list\_iter){.+.+}, at: drm\_helper\_hpd\_irq\_event+0x78/0x120 [drm\_kms\_helper]
[ 861.555227] #4: 0000000044f294d9 (crtc\_ww\_class\_acquire){+.+.}, at: drm\_helper\_probe\_detect\_ctx+0x3d/0x100 [drm\_kms\_helper]
[ 861.556133] #5: 00000000db193642 (crtc\_ww\_class\_mutex){+.+.}, at: drm\_modeset\_lock+0x4b/0x130 [drm]
[ 861.557864] =============================================
[ 861.559507] NMI backtrace for cpu 2
[ 861.560363] CPU: 2 PID: 64 Comm: khungtaskd Tainted: G O 4.18.0-rc6Lyude-Test+ #1
[ 861.561197] Hardware name: LENOVO 20EQS64N0B/20EQS64N0B, BIOS N1EET78W (1.51 ) 05/18/2018
[ 861.561948] Call Trace:
[ 861.562757] dump\_stack+0x8e/0xd3
[ 861.563516] nmi\_cpu\_backtrace.cold.3+0x14/0x5a
[ 861.564269] ? lapic\_can\_unplug\_cpu.cold.27+0x42/0x42
[ 861.565029] nmi\_trigger\_cpumask\_backtrace+0xa1/0xae
[ 861.565789] arch\_trigger\_cpumask\_backtrace+0x19/0x20
[ 861.566558] watchdog+0x316/0x580
[ 861.567355] kthread+0x12b/0x150
[ 861.568114] ? reset\_hung\_task\_detector+0x20/0x20
[ 861.568863] ? kthread\_create\_worker\_on\_cpu+0x70/0x70
[ 861.569598] ret\_from\_fork+0x3a/0x50
[ 861.570370] Sending NMI from CPU 2 to CPUs 0-1,3-7:
[ 861.571426] NMI backtrace for cpu 6 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571429] NMI backtrace for cpu 7 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571432] NMI backtrace for cpu 3 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571464] NMI backtrace for cpu 5 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571467] NMI backtrace for cpu 0 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571469] NMI backtrace for cpu 4 skipped: idling at intel\_idle+0x7f/0x120
[ 861.571472] NMI backtrace for cpu 1 skipped: idling at intel\_idle+0x7f/0x120
[ 861.572428] Kernel panic - not syncing: hung\_task: blocked tasks
So: fix this by making it so that normal hotplug handling /only/ happens
so long as the GPU is currently awake without any pending runtime PM
requests. In the event that a hotplug occurs while the device is
suspending or resuming, we can simply defer our response until the GPU
is fully runtime resumed again.
Changes since v4:
- Use a new trick I came up with using pm\_runtime\_get() instead of the
hackish junk we had before
Signed-off-by: Lyude Paul
Reviewed-by: Karol Herbst
Acked-by: Daniel Vetter
Cc: stable@vger.kernel.org
Cc: Lukas Wunner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 573eeddd45386418c70adc5d501353e38a53bd75
Author: Lyude Paul
Date: Wed Aug 15 15:00:12 2018 -0400
drm/nouveau: Remove duplicate poll\_enable() in pmops\_runtime\_suspend()
commit 611ce855420a6e8b9ff47af5f47431d52c7709f8 upstream.
Since actual hotplug notifications don't get disabled until
nouveau\_display\_fini() is called, all this will do is cause any hotplugs
that happen between this drm\_kms\_helper\_poll\_disable() call and the
actual hotplug disablement to potentially be dropped if ACPI isn't
around to help us.
Signed-off-by: Lyude Paul
Acked-by: Karol Herbst
Acked-by: Daniel Vetter
Cc: stable@vger.kernel.org
Cc: Lukas Wunner
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit aed4ca2690c2e80d86f53883ba331f4b50fffb5c
Author: Lyude Paul
Date: Thu Aug 9 18:22:05 2018 -0400
drm/nouveau: Only write DP\_MSTM\_CTRL when needed
commit b26b4590dd53e012526342e749c423e6c0e73437 upstream.
Currently, nouveau will re-write the DP\_MSTM\_CTRL register for an MST
hub every time it receives a long HPD pulse on DP. This isn't actually
necessary and additionally, has some unintended side effects.
With the P50 I've got here, rewriting DP\_MSTM\_CTRL constantly seems to
make it rather likely (1 out of 5 times usually) that bringing up MST
with it's ThinkPad dock will fail and result in sideband messages timing
out in the middle. Afterwards, successive probes don't manage to get the
dock to communicate properly over MST sideband properly.
Many times sideband message timeouts from MST hubs are indicative of
either the source or the sink dropping an ESI event, which can cause
DRM's perspective of the topology's current state to go out of sync with
reality. While it's tough to really know for sure what's happening to
the dock, using userspace tools to write to DP\_MSTM\_CTRL in the middle
of the MST link probing process does appear to make things flaky. It's
possible that when we write to DP\_MSTM\_CTRL, the function that gets
triggered to respond in the dock's firmware temporarily puts it in a
state where it might end up not reporting an ESI to the source, or ends
up dropping a sideband message we sent it.
So, to fix this we make it so that when probing an MST topology, we
respect it's current state. If the dock's already enabled, we simply
read DP\_MSTM\_CTRL and disable the topology if it's value is not what we
expected. Otherwise, we perform the normal MST probing dance. We avoid
taking any action except if the state of the MST topology actually
changes.
This fixes MST sideband message timeouts and detection failures on my
P50 with its ThinkPad dock.
Signed-off-by: Lyude Paul
Cc: stable@vger.kernel.org
Cc: Karol Herbst
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 04393d25720708f809dd877a69391c715a45d4f7
Author: Lyude Paul
Date: Thu Aug 9 18:22:06 2018 -0400
drm/nouveau: Reset MST branching unit before enabling
commit fa3cdf8d0b092c4561f9f017dfac409eb7644737 upstream.
When probing a new MST device, it's not safe to make any assumptions
about it's current state. While most well mannered MST hubs will just
disable the branching unit on hotplug disconnects, this isn't enough to
save us from various other scenarios that might have resulted in
something writing to the MST branching unit before we got control of it.
This could happen if a previous probe we tried failed, if we're booting
in kexec context and the hub is still in the state the last kernel put
it in, etc.
Luckily; there is no reason we can't just reset the branching unit
every time we enable a new topology. So, fix this by resetting it on
enabling new topologies to ensure that we always start off with a clean,
unmodified topology state on MST sinks.
This fixes occasional hard-lockups on my P50's laptop dock (e.g. AUX
times out all DPCD trasactions) observed after multiple docks, undocks,
and module reloads.
Signed-off-by: Lyude Paul
Cc: stable@vger.kernel.org
Cc: Karol Herbst
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit 1f4401ece98b6492996f67d8645b255ec37a50c5
Author: Imre Deak
Date: Wed Sep 5 13:00:05 2018 +0300
drm/i915/bdw: Increase IPS disable timeout to 100ms
commit 92a6803149465e2339f8f7f8f6415d75be80073d upstream.
During IPS disabling the current 42ms timeout value leads to occasional
timeouts, increase it to 100ms which seems to get rid of the problem.
References: https://bugs.freedesktop.org/show\_bug.cgi?id=107494
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=107562
Reported-by: Diego Viola
Tested-by: Diego Viola
Cc: Diego Viola
Cc:
Signed-off-by: Imre Deak
Reviewed-by: Ville SyrjÃ¤lÃ¤
Link: https://patchwork.freedesktop.org/patch/msgid/20180905100005.7663-1-imre.deak@intel.com
(cherry picked from commit acb3ef0ee40ea657280a4a11d9f60eb2937c0dca)
Signed-off-by: Rodrigo Vivi
Signed-off-by: Greg Kroah-Hartman
commit 1e0be23859b9098593d72c210efbacab5ec5c3b9
Author: Junxiao Bi
Date: Thu Sep 20 12:22:51 2018 -0700
ocfs2: fix ocfs2 read block panic
commit 234b69e3e089d850a98e7b3145bd00e9b52b1111 upstream.
While reading block, it is possible that io error return due to underlying
storage issue, in this case, BH\_NeedsValidate was left in the buffer head.
Then when reading the very block next time, if it was already linked into
journal, that will trigger the following panic.
[203748.702517] kernel BUG at fs/ocfs2/buffer\_head\_io.c:342!
[203748.702533] invalid opcode: 0000 [#1] SMP
[203748.702561] Modules linked in: ocfs2 ocfs2\_dlmfs ocfs2\_stack\_o2cb ocfs2\_dlm ocfs2\_nodemanager ocfs2\_stackglue configfs sunrpc dm\_switch dm\_queue\_length dm\_multipath bonding be2iscsi iscsi\_boot\_sysfs bnx2i cnic uio cxgb4i iw\_cxgb4 cxgb4 cxgb3i libcxgbi iw\_cxgb3 cxgb3 mdio ib\_iser rdma\_cm ib\_cm iw\_cm ib\_sa ib\_mad ib\_core ib\_addr ipv6 iscsi\_tcp libiscsi\_tcp libiscsi scsi\_transport\_iscsi ipmi\_devintf iTCO\_wdt iTCO\_vendor\_support dcdbas ipmi\_ssif i2c\_core ipmi\_si ipmi\_msghandler acpi\_pad pcspkr sb\_edac edac\_core lpc\_ich mfd\_core shpchp sg tg3 ptp pps\_core ext4 jbd2 mbcache2 sr\_mod cdrom sd\_mod ahci libahci megaraid\_sas wmi dm\_mirror dm\_region\_hash dm\_log dm\_mod
[203748.703024] CPU: 7 PID: 38369 Comm: touch Not tainted 4.1.12-124.18.6.el6uek.x86\_64 #2
[203748.703045] Hardware name: Dell Inc. PowerEdge R620/0PXXHP, BIOS 2.5.2 01/28/2015
[203748.703067] task: ffff880768139c00 ti: ffff88006ff48000 task.ti: ffff88006ff48000
[203748.703088] RIP: 0010:[] [] ocfs2\_read\_blocks+0x669/0x7f0 [ocfs2]
[203748.703130] RSP: 0018:ffff88006ff4b818 EFLAGS: 00010206
[203748.703389] RAX: 0000000008620029 RBX: ffff88006ff4b910 RCX: 0000000000000000
[203748.703885] RDX: 0000000000000001 RSI: 0000000000000000 RDI: 00000000023079fe
[203748.704382] RBP: ffff88006ff4b8d8 R08: 0000000000000000 R09: ffff8807578c25b0
[203748.704877] R10: 000000000f637376 R11: 000000003030322e R12: 0000000000000000
[203748.705373] R13: ffff88006ff4b910 R14: ffff880732fe38f0 R15: 0000000000000000
[203748.705871] FS: 00007f401992c700(0000) GS:ffff880bfebc0000(0000) knlGS:0000000000000000
[203748.706370] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[203748.706627] CR2: 00007f4019252440 CR3: 00000000a621e000 CR4: 0000000000060670
[203748.707124] Stack:
[203748.707371] ffff88006ff4b828 ffffffffa0609f52 ffff88006ff4b838 0000000000000001
[203748.707885] 0000000000000000 0000000000000000 ffff880bf67c3800 ffffffffa05eca00
[203748.708399] 00000000023079ff ffffffff81c58b80 0000000000000000 0000000000000000
[203748.708915] Call Trace:
[203748.709175] [] ? ocfs2\_inode\_cache\_io\_unlock+0x12/0x20 [ocfs2]
[203748.709680] [] ? ocfs2\_empty\_dir\_filldir+0x80/0x80 [ocfs2]
[203748.710185] [] ocfs2\_read\_dir\_block\_direct+0x3b/0x200 [ocfs2]
[203748.710691] [] ocfs2\_prepare\_dx\_dir\_for\_insert.isra.57+0x19f/0xf60 [ocfs2]
[203748.711204] [] ? ocfs2\_metadata\_cache\_io\_unlock+0x1f/0x30 [ocfs2]
[203748.711716] [] ocfs2\_prepare\_dir\_for\_insert+0x13a/0x890 [ocfs2]
[203748.712227] [] ? ocfs2\_check\_dir\_for\_entry+0x8e/0x140 [ocfs2]
[203748.712737] [] ocfs2\_mknod+0x4b2/0x1370 [ocfs2]
[203748.713003] [] ocfs2\_create+0x65/0x170 [ocfs2]
[203748.713263] [] vfs\_create+0xdb/0x150
[203748.713518] [] do\_last+0x815/0x1210
[203748.713772] [] ? path\_init+0xb9/0x450
[203748.714123] [] path\_openat+0x80/0x600
[203748.714378] [] ? handle\_pte\_fault+0xd15/0x1620
[203748.714634] [] do\_filp\_open+0x3a/0xb0
[203748.714888] [] ? \_\_alloc\_fd+0xa7/0x130
[203748.715143] [] do\_sys\_open+0x12c/0x220
[203748.715403] [] ? syscall\_trace\_enter\_phase1+0x11b/0x180
[203748.715668] [] ? system\_call\_after\_swapgs+0xe9/0x190
[203748.715928] [] SyS\_open+0x1e/0x20
[203748.716184] [] system\_call\_fastpath+0x18/0xd7
[203748.716440] Code: 00 00 48 8b 7b 08 48 83 c3 10 45 89 f8 44 89 e1 44 89 f2 4c 89 ee e8 07 06 11 e1 48 8b 03 48 85 c0 75 df 8b 5d c8 e9 4d fa ff ff <0f> 0b 48 8b 7d a0 e8 dc c6 06 00 48 b8 00 00 00 00 00 00 00 10
[203748.717505] RIP [] ocfs2\_read\_blocks+0x669/0x7f0 [ocfs2]
[203748.717775] RSP
Joesph ever reported a similar panic.
Link: https://oss.oracle.com/pipermail/ocfs2-devel/2013-May/008931.html
Link: http://lkml.kernel.org/r/20180912063207.29484-1-junxiao.bi@oracle.com
Signed-off-by: Junxiao Bi
Cc: Joseph Qi
Cc: Mark Fasheh
Cc: Joel Becker
Cc: Changwei Ge
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Greg Kroah-Hartman
commit 23fe9688228c87a3bfc693ba1993b7b951b591aa
Author: Jens Axboe
Date: Thu Sep 20 08:30:55 2018 -0600
libata: mask swap internal and hardware tag
commit 7ce5c8cd753f9afa8e79e9ec40351998e354f239 upstream.
hen we're comparing the hardware completion mask passed in from the
driver with the internal tag pending mask, we need to account for the
fact that the internal tag is different from the hardware tag. If not,
then we can end up either prematurely completing the internal tag (since
it's not set in the hw mask), or simply flag an error:
ata2: illegal qc\_active transition (100000000->00000001)
If the internal tag is set, then swap that with the hardware tag in this
case before comparing with what the hardware reports.
Fixes: 28361c403683 ("libata: add extra internal command")
Buglink: https://bugzilla.kernel.org/show\_bug.cgi?id=201151
Cc: stable@vger.kernel.org
Reported-by: Paul Sbarra
Tested-by: Paul Sbarra
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit f8b35f82a252999845289c5e313f841c97314851
Author: Richard Weinberger
Date: Sun Sep 16 23:57:35 2018 +0200
Revert "ubifs: xattr: Don't operate on deleted inodes"
commit f061c1cc404a618858a77aea233fde0aeaad2f2d upstream.
This reverts commit 11a6fc3dc743e22fb50f2196ec55bee5140d3c52.
UBIFS wants to assert that xattr operations are only issued on files
with positive link count. The said patch made this operations return
-ENOENT for unlinked files such that the asserts will no longer trigger.
This was wrong since xattr operations are perfectly fine on unlinked
files.
Instead the assertions need to be fixed/removed.
Cc:
Fixes: 11a6fc3dc743 ("ubifs: xattr: Don't operate on deleted inodes")
Reported-by: Koen Vandeputte
Tested-by: Joel Stanley
Signed-off-by: Richard Weinberger
Signed-off-by: Greg Kroah-Hartman
commit 94403d71bb9e515f713749de09f9dcc43f70ab40
Author: Vincent Pelletier
Date: Sun Sep 9 04:09:27 2018 +0000
scsi: target: iscsi: Use bin2hex instead of a re-implementation
commit 8c39e2699f8acb2e29782a834e56306da24937fe upstream.
Signed-off-by: Vincent Pelletier
Reviewed-by: Mike Christie
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 8e31c95fe08501af201f4e8470af1f68d52d6e7e
Author: Vincent Pelletier
Date: Sun Sep 9 04:09:26 2018 +0000
scsi: target: iscsi: Use hex2bin instead of a re-implementation
commit 1816494330a83f2a064499d8ed2797045641f92c upstream.
This change has the following effects, in order of descreasing importance:
1) Prevent a stack buffer overflow
2) Do not append an unnecessary NULL to an anyway binary buffer, which
is writing one byte past client\_digest when caller is:
chap\_string\_to\_hex(client\_digest, chap\_r, strlen(chap\_r));
The latter was found by KASAN (see below) when input value hes expected size
(32 hex chars), and further analysis revealed a stack buffer overflow can
happen when network-received value is longer, allowing an unauthenticated
remote attacker to smash up to 17 bytes after destination buffer (16 bytes
attacker-controlled and one null). As switching to hex2bin requires
specifying destination buffer length, and does not internally append any null,
it solves both issues.
This addresses CVE-2018-14633.
Beyond this:
- Validate received value length and check hex2bin accepted the input, to log
this rejection reason instead of just failing authentication.
- Only log received CHAP\_R and CHAP\_C values once they passed sanity checks.
==================================================================
BUG: KASAN: stack-out-of-bounds in chap\_string\_to\_hex+0x32/0x60 [iscsi\_target\_mod]
Write of size 1 at addr ffff8801090ef7c8 by task kworker/0:0/1021
CPU: 0 PID: 1021 Comm: kworker/0:0 Tainted: G O 4.17.8kasan.sess.connops+ #2
Hardware name: To be filled by O.E.M. To be filled by O.E.M./Aptio CRB, BIOS 5.6.5 05/19/2014
Workqueue: events iscsi\_target\_do\_login\_rx [iscsi\_target\_mod]
Call Trace:
dump\_stack+0x71/0xac
print\_address\_description+0x65/0x22e
? chap\_string\_to\_hex+0x32/0x60 [iscsi\_target\_mod]
kasan\_report.cold.6+0x241/0x2fd
chap\_string\_to\_hex+0x32/0x60 [iscsi\_target\_mod]
chap\_server\_compute\_md5.isra.2+0x2cb/0x860 [iscsi\_target\_mod]
? chap\_binaryhex\_to\_asciihex.constprop.5+0x50/0x50 [iscsi\_target\_mod]
? ftrace\_caller\_op\_ptr+0xe/0xe
? \_\_orc\_find+0x6f/0xc0
? unwind\_next\_frame+0x231/0x850
? kthread+0x1a0/0x1c0
? ret\_from\_fork+0x35/0x40
? ret\_from\_fork+0x35/0x40
? iscsi\_target\_do\_login\_rx+0x3bc/0x4c0 [iscsi\_target\_mod]
? deref\_stack\_reg+0xd0/0xd0
? iscsi\_target\_do\_login\_rx+0x3bc/0x4c0 [iscsi\_target\_mod]
? is\_module\_text\_address+0xa/0x11
? kernel\_text\_address+0x4c/0x110
? \_\_save\_stack\_trace+0x82/0x100
? ret\_from\_fork+0x35/0x40
? save\_stack+0x8c/0xb0
? 0xffffffffc1660000
? iscsi\_target\_do\_login+0x155/0x8d0 [iscsi\_target\_mod]
? iscsi\_target\_do\_login\_rx+0x3bc/0x4c0 [iscsi\_target\_mod]
? process\_one\_work+0x35c/0x640
? worker\_thread+0x66/0x5d0
? kthread+0x1a0/0x1c0
? ret\_from\_fork+0x35/0x40
? iscsi\_update\_param\_value+0x80/0x80 [iscsi\_target\_mod]
? iscsit\_release\_cmd+0x170/0x170 [iscsi\_target\_mod]
chap\_main\_loop+0x172/0x570 [iscsi\_target\_mod]
? chap\_server\_compute\_md5.isra.2+0x860/0x860 [iscsi\_target\_mod]
? rx\_data+0xd6/0x120 [iscsi\_target\_mod]
? iscsit\_print\_session\_params+0xd0/0xd0 [iscsi\_target\_mod]
? cyc2ns\_read\_begin.part.2+0x90/0x90
? \_raw\_spin\_lock\_irqsave+0x25/0x50
? memcmp+0x45/0x70
iscsi\_target\_do\_login+0x875/0x8d0 [iscsi\_target\_mod]
? iscsi\_target\_check\_first\_request.isra.5+0x1a0/0x1a0 [iscsi\_target\_mod]
? del\_timer+0xe0/0xe0
? memset+0x1f/0x40
? flush\_sigqueue+0x29/0xd0
iscsi\_target\_do\_login\_rx+0x3bc/0x4c0 [iscsi\_target\_mod]
? iscsi\_target\_nego\_release+0x80/0x80 [iscsi\_target\_mod]
? iscsi\_target\_restore\_sock\_callbacks+0x130/0x130 [iscsi\_target\_mod]
process\_one\_work+0x35c/0x640
worker\_thread+0x66/0x5d0
? flush\_rcu\_work+0x40/0x40
kthread+0x1a0/0x1c0
? kthread\_bind+0x30/0x30
ret\_from\_fork+0x35/0x40
The buggy address belongs to the page:
page:ffffea0004243bc0 count:0 mapcount:0 mapping:0000000000000000 index:0x0
flags: 0x17fffc000000000()
raw: 017fffc000000000 0000000000000000 0000000000000000 00000000ffffffff
raw: ffffea0004243c20 ffffea0004243ba0 0000000000000000 0000000000000000
page dumped because: kasan: bad access detected
Memory state around the buggy address:
ffff8801090ef680: f2 f2 f2 f2 f2 f2 f2 01 f2 f2 f2 f2 f2 f2 f2 00
ffff8801090ef700: f2 f2 f2 f2 f2 f2 f2 00 02 f2 f2 f2 f2 f2 f2 00
>ffff8801090ef780: 00 f2 f2 f2 f2 f2 f2 00 00 f2 f2 f2 f2 f2 f2 00
^
ffff8801090ef800: 00 f2 f2 f2 f2 f2 f2 00 00 00 00 02 f2 f2 f2 f2
ffff8801090ef880: f2 f2 f2 00 00 00 00 00 00 00 00 f2 f2 f2 f2 00
==================================================================
Signed-off-by: Vincent Pelletier
Reviewed-by: Mike Christie
Signed-off-by: Martin K. Petersen
Signed-off-by: Greg Kroah-Hartman
commit 31426b50594c12802e77bcba69f5f5169cdf0dd5
Author: Lubomir Rintel
Date: Mon Sep 24 13:18:34 2018 +0100
Revert "uapi/linux/keyctl.h: don't use C++ reserved keyword as a struct member name"
commit 8c0f9f5b309d627182d5da72a69246f58bde1026 upstream.
This changes UAPI, breaking iwd and libell:
ell/key.c: In function 'kernel\_dh\_compute':
ell/key.c:205:38: error: 'struct keyctl\_dh\_params' has no member named 'private'; did you mean 'dh\_private'?
struct keyctl\_dh\_params params = { .private = private,
^~~~~~~
dh\_private
This reverts commit 8a2336e549d385bb0b46880435b411df8d8200e8.
Fixes: 8a2336e549d3 ("uapi/linux/keyctl.h: don't use C++ reserved keyword as a struct member name")
Signed-off-by: Lubomir Rintel
Signed-off-by: David Howells
cc: Randy Dunlap
cc: Mat Martineau
cc: Stephan Mueller
cc: James Morris
cc: "Serge E. Hallyn"
cc: Mat Martineau
cc: Andrew Morton
cc: Linus Torvalds
cc:
Signed-off-by: James Morris
Signed-off-by: Greg Kroah-Hartman
commit bc35488686c34703e5f0909c7a6cb0b942bfcf58
Author: Alexei Starovoitov
Date: Wed Sep 12 14:06:10 2018 -0700
bpf/verifier: disallow pointer subtraction
commit dd066823db2ac4e22f721ec85190817b58059a54 upstream.
Subtraction of pointers was accidentally allowed for unpriv programs
by commit 82abbf8d2fc4. Revert that part of commit.
Fixes: 82abbf8d2fc4 ("bpf: do not allow root to mangle valid pointers")
Reported-by: Jann Horn
Acked-by: Daniel Borkmann
Signed-off-by: Alexei Starovoitov
Signed-off-by: Daniel Borkmann
Signed-off-by: Greg Kroah-Hartman
commit 909828a2920bb029f847c8d96385cba941e9790d
Author: Greg Kroah-Hartman
Date: Wed Sep 26 13:53:39 2018 +0200
Revert "rpmsg: core: add support to power domains for devices"
This reverts commit e5d9ae0077a5cf336d298002959dc0c8dcfe7b89 which is
commit fe782affd0f440a4e60e2cc81b8f2eccb2923113 upstream
Rafael reports that this patch causes problems:
> -rc2 looks good. There is a problem on dragonboard during boot that was
> introduced in v4.14.71 that I didn't notice last week. We'll bisect it
> and report back later this week. dragonboard on the other branches (4.9,
> 4.18, mainline) looks fine.
As Dan pointed out, during validation, we have bisected this issue on
a dragonboard 410c (can't find root device) to the following commit
for v4.14:
[1ed3a9307230] rpmsg: core: add support to power domains for devices
There is an on-going discussion on "[PATCH] rpmsg: core: add support
to power domains for devices" about this patch having other
dependencies and breaking something else on v4.14 as well.
so drop it.
Reported-by: Rafael Tinoco
Cc: Srinivas Kandagatla
Cc: Bjorn Andersson
Cc: Sasha Levin
Signed-off-by: Greg Kroah-Hartman
commit 946f8052f7eeb19aa07bb8249ac97fd752495317
Author: Joel Fernandes (Google)
Date: Thu Sep 20 12:22:39 2018 -0700
mm: shmem.c: Correctly annotate new inodes for lockdep
commit b45d71fb89ab8adfe727b9d0ee188ed58582a647 upstream.
Directories and inodes don't necessarily need to be in the same lockdep
class. For ex, hugetlbfs splits them out too to prevent false positives
in lockdep. Annotate correctly after new inode creation. If its a
directory inode, it will be put into a different class.
This should fix a lockdep splat reported by syzbot:
> ======================================================
> WARNING: possible circular locking dependency detected
> 4.18.0-rc8-next-20180810+ #36 Not tainted
> ------------------------------------------------------
> syz-executor900/4483 is trying to acquire lock:
> 00000000d2bfc8fe (&sb->s\_type->i\_mutex\_key#9){++++}, at: inode\_lock
> include/linux/fs.h:765 [inline]
> 00000000d2bfc8fe (&sb->s\_type->i\_mutex\_key#9){++++}, at:
> shmem\_fallocate+0x18b/0x12e0 mm/shmem.c:2602
>
> but task is already holding lock:
> 0000000025208078 (ashmem\_mutex){+.+.}, at: ashmem\_shrink\_scan+0xb4/0x630
> drivers/staging/android/ashmem.c:448
>
> which lock already depends on the new lock.
>
> -> #2 (ashmem\_mutex){+.+.}:
> \_\_mutex\_lock\_common kernel/locking/mutex.c:925 [inline]
> \_\_mutex\_lock+0x171/0x1700 kernel/locking/mutex.c:1073
> mutex\_lock\_nested+0x16/0x20 kernel/locking/mutex.c:1088
> ashmem\_mmap+0x55/0x520 drivers/staging/android/ashmem.c:361
> call\_mmap include/linux/fs.h:1844 [inline]
> mmap\_region+0xf27/0x1c50 mm/mmap.c:1762
> do\_mmap+0xa10/0x1220 mm/mmap.c:1535
> do\_mmap\_pgoff include/linux/mm.h:2298 [inline]
> vm\_mmap\_pgoff+0x213/0x2c0 mm/util.c:357
> ksys\_mmap\_pgoff+0x4da/0x660 mm/mmap.c:1585
> \_\_do\_sys\_mmap arch/x86/kernel/sys\_x86\_64.c:100 [inline]
> \_\_se\_sys\_mmap arch/x86/kernel/sys\_x86\_64.c:91 [inline]
> \_\_x64\_sys\_mmap+0xe9/0x1b0 arch/x86/kernel/sys\_x86\_64.c:91
> do\_syscall\_64+0x1b9/0x820 arch/x86/entry/common.c:290
> entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
>
> -> #1 (&mm->mmap\_sem){++++}:
> \_\_might\_fault+0x155/0x1e0 mm/memory.c:4568
> \_copy\_to\_user+0x30/0x110 lib/usercopy.c:25
> copy\_to\_user include/linux/uaccess.h:155 [inline]
> filldir+0x1ea/0x3a0 fs/readdir.c:196
> dir\_emit\_dot include/linux/fs.h:3464 [inline]
> dir\_emit\_dots include/linux/fs.h:3475 [inline]
> dcache\_readdir+0x13a/0x620 fs/libfs.c:193
> iterate\_dir+0x48b/0x5d0 fs/readdir.c:51
> \_\_do\_sys\_getdents fs/readdir.c:231 [inline]
> \_\_se\_sys\_getdents fs/readdir.c:212 [inline]
> \_\_x64\_sys\_getdents+0x29f/0x510 fs/readdir.c:212
> do\_syscall\_64+0x1b9/0x820 arch/x86/entry/common.c:290
> entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
>
> -> #0 (&sb->s\_type->i\_mutex\_key#9){++++}:
> lock\_acquire+0x1e4/0x540 kernel/locking/lockdep.c:3924
> down\_write+0x8f/0x130 kernel/locking/rwsem.c:70
> inode\_lock include/linux/fs.h:765 [inline]
> shmem\_fallocate+0x18b/0x12e0 mm/shmem.c:2602
> ashmem\_shrink\_scan+0x236/0x630 drivers/staging/android/ashmem.c:455
> ashmem\_ioctl+0x3ae/0x13a0 drivers/staging/android/ashmem.c:797
> vfs\_ioctl fs/ioctl.c:46 [inline]
> file\_ioctl fs/ioctl.c:501 [inline]
> do\_vfs\_ioctl+0x1de/0x1720 fs/ioctl.c:685
> ksys\_ioctl+0xa9/0xd0 fs/ioctl.c:702
> \_\_do\_sys\_ioctl fs/ioctl.c:709 [inline]
> \_\_se\_sys\_ioctl fs/ioctl.c:707 [inline]
> \_\_x64\_sys\_ioctl+0x73/0xb0 fs/ioctl.c:707
> do\_syscall\_64+0x1b9/0x820 arch/x86/entry/common.c:290
> entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
>
> other info that might help us debug this:
>
> Chain exists of:
> &sb->s\_type->i\_mutex\_key#9 --> &mm->mmap\_sem --> ashmem\_mutex
>
> Possible unsafe locking scenario:
>
> CPU0 CPU1
> ---- ----
> lock(ashmem\_mutex);
> lock(&mm->mmap\_sem);
> lock(ashmem\_mutex);
> lock(&sb->s\_type->i\_mutex\_key#9);
>
> \*\*\* DEADLOCK \*\*\*
>
> 1 lock held by syz-executor900/4483:
> #0: 0000000025208078 (ashmem\_mutex){+.+.}, at:
> ashmem\_shrink\_scan+0xb4/0x630 drivers/staging/android/ashmem.c:448
Link: http://lkml.kernel.org/r/20180821231835.166639-1-joel@joelfernandes.org
Signed-off-by: Joel Fernandes (Google)
Reported-by: syzbot
Reviewed-by: NeilBrown
Suggested-by: NeilBrown
Cc: Matthew Wilcox
Cc: Peter Zijlstra
Cc: Hugh Dickins
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Greg Kroah-Hartman
commit 4cdb6f01e9e5bf507a391a8cf826833d41053771
Author: Pasha Tatashin
Date: Thu Sep 20 12:22:30 2018 -0700
mm: disable deferred struct page for 32-bit arches
commit 889c695d419f19e5db52592dafbaf26143c36d1f upstream.
Deferred struct page init is needed only on systems with large amount of
physical memory to improve boot performance. 32-bit systems do not
benefit from this feature.
Jiri reported a problem where deferred struct pages do not work well with
x86-32:
[ 0.035162] Dentry cache hash table entries: 131072 (order: 7, 524288 bytes)
[ 0.035725] Inode-cache hash table entries: 65536 (order: 6, 262144 bytes)
[ 0.036269] Initializing CPU#0
[ 0.036513] Initializing HighMem for node 0 (00036ffe:0007ffe0)
[ 0.038459] page:f6780000 is uninitialized and poisoned
[ 0.038460] raw: ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff
[ 0.039509] page dumped because: VM\_BUG\_ON\_PAGE(1 && PageCompound(page))
[ 0.040038] ------------[ cut here ]------------
[ 0.040399] kernel BUG at include/linux/page-flags.h:293!
[ 0.040823] invalid opcode: 0000 [#1] SMP PTI
[ 0.041166] CPU: 0 PID: 0 Comm: swapper Not tainted 4.19.0-rc1\_pt\_jiri #9
[ 0.041694] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.11.0-20171110\_100015-anatol 04/01/2014
[ 0.042496] EIP: free\_highmem\_page+0x64/0x80
[ 0.042839] Code: 13 46 d8 c1 e8 18 5d 83 e0 03 8d 04 c0 c1 e0 06 ff 80 ec 5f 44 d8 c3 8d b4 26 00 00 00 00 ba 08 65 28 d8 89 d8 e8 fc 71 02 00 <0f> 0b 8d 76 00 8d bc 27 00 00 00 00 ba d0 b1 26 d8 89 d8 e8 e4 71
[ 0.044338] EAX: 0000003c EBX: f6780000 ECX: 00000000 EDX: d856cbe8
[ 0.044868] ESI: 0007ffe0 EDI: d838df20 EBP: d838df00 ESP: d838defc
[ 0.045372] DS: 007b ES: 007b FS: 00d8 GS: 00e0 SS: 0068 EFLAGS: 00210086
[ 0.045913] CR0: 80050033 CR2: 00000000 CR3: 18556000 CR4: 00040690
[ 0.046413] DR0: 00000000 DR1: 00000000 DR2: 00000000 DR3: 00000000
[ 0.046913] DR6: fffe0ff0 DR7: 00000400
[ 0.047220] Call Trace:
[ 0.047419] add\_highpages\_with\_active\_regions+0xbd/0x10d
[ 0.047854] set\_highmem\_pages\_init+0x5b/0x71
[ 0.048202] mem\_init+0x2b/0x1e8
[ 0.048460] start\_kernel+0x1d2/0x425
[ 0.048757] i386\_start\_kernel+0x93/0x97
[ 0.049073] startup\_32\_smp+0x164/0x168
[ 0.049379] Modules linked in:
[ 0.049626] ---[ end trace 337949378db0abbb ]---
We free highmem pages before their struct pages are initialized:
mem\_init()
set\_highmem\_pages\_init()
add\_highpages\_with\_active\_regions()
free\_highmem\_page()
.. Access uninitialized struct page here..
Because there is no reason to have this feature on 32-bit systems, just
disable it.
Link: http://lkml.kernel.org/r/20180831150506.31246-1-pavel.tatashin@microsoft.com
Fixes: 2e3ca40f03bb ("mm: relax deferred struct page requirements")
Signed-off-by: Pavel Tatashin
Reported-by: Jiri Slaby
Acked-by: Michal Hocko
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Greg Kroah-Hartman
commit 3299a0eead685bd92955e94001a519accc0ca3bd
Author: KJ Tsanaktsidis
Date: Thu Sep 20 12:22:25 2018 -0700
fork: report pid exhaustion correctly
commit f83606f5eb007adc33bc8541ede00590f477bdeb upstream.
Make the clone and fork syscalls return EAGAIN when the limit on the
number of pids /proc/sys/kernel/pid\_max is exceeded.
Currently, when the pid\_max limit is exceeded, the kernel will return
ENOSPC from the fork and clone syscalls. This is contrary to the
documented behaviour, which explicitly calls out the pid\_max case as one
where EAGAIN should be returned. It also leads to really confusing error
messages in userspace programs which will complain about a lack of disk
space when they fail to create processes/threads for this reason.
This error is being returned because alloc\_pid() uses the idr api to find
a new pid; when there are none available, idr\_alloc\_cyclic() returns
-ENOSPC, and this is being propagated back to userspace.
This behaviour has been broken before, and was explicitly fixed in
commit 35f71bc0a09a ("fork: report pid reservation failure properly"),
so I think -EAGAIN is definitely the right thing to return in this case.
The current behaviour change dates from commit 95846ecf9dac ("pid:
replace pid bitmap implementation with IDR AIP") and was I believe
unintentional.
This patch has no impact on the case where allocating a pid fails because
the child reaper for the namespace is dead; that case will still return
-ENOMEM.
Link: http://lkml.kernel.org/r/20180903111016.46461-1-ktsanaktsidis@zendesk.com
Fixes: 95846ecf9dac ("pid: replace pid bitmap implementation with IDR AIP")
Signed-off-by: KJ Tsanaktsidis
Reviewed-by: Andrew Morton
Acked-by: Michal Hocko
Cc: Gargi Sharma
Cc: Rik van Riel
Cc: Oleg Nesterov
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Greg Kroah-Hartman
commit 30938d20eb1a6e4cb62ae747f37bc9e2645c9f58
Author: Ondrej Mosnacek
Date: Wed Sep 5 09:26:41 2018 +0200
crypto: x86/aegis,morus - Do not require OSXSAVE for SSE2
commit 24568b47d48ec8c906fd0f589489a08b17e1edca upstream.
It turns out OSXSAVE needs to be checked only for AVX, not for SSE.
Without this patch the affected modules refuse to load on CPUs with SSE2
but without AVX support.
Fixes: 877ccce7cbe8 ("crypto: x86/aegis,morus - Fix and simplify CPUID checks")
Cc:  # 4.18
Reported-by: Zdenek Kaspar
Signed-off-by: Ondrej Mosnacek
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit d73ccd8bb7323b09ae4b2ef750a82262720e94cf
Author: Vaibhav Nagarnaik
Date: Fri Sep 7 15:31:29 2018 -0700
ring-buffer: Allow for rescheduling when removing pages
commit 83f365554e47997ec68dc4eca3f5dce525cd15c3 upstream.
When reducing ring buffer size, pages are removed by scheduling a work
item on each CPU for the corresponding CPU ring buffer. After the pages
are removed from ring buffer linked list, the pages are free()d in a
tight loop. The loop does not give up CPU until all pages are removed.
In a worst case behavior, when lot of pages are to be freed, it can
cause system stall.
After the pages are removed from the list, the free() can happen while
the work is rescheduled. Call cond\_resched() in the loop to prevent the
system hangup.
Link: http://lkml.kernel.org/r/20180907223129.71994-1-vnagarnaik@google.com
Cc: stable@vger.kernel.org
Fixes: 83f40318dab00 ("ring-buffer: Make removal of ring buffer pages atomic")
Reported-by: Jason Behmer
Signed-off-by: Vaibhav Nagarnaik
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 6bed4f10277b0e97922326b2ab4fa251d15482c0
Author: Mika Westerberg
Date: Wed Sep 5 14:09:54 2018 +0300
Revert "PCI: Add ACS quirk for Intel 300 series"
commit 50ca031b51106b1b46162d4e9ecccb7edc95682f upstream.
This reverts f154a718e6cc ("PCI: Add ACS quirk for Intel 300 series").
It turns out that erratum "PCH PCIe\* Controller Root Port (ACSCTLR) Appear
As Read Only" has been fixed in 300 series chipsets, even though the
datasheet [1] claims otherwise. To make ACS work properly on 300 series
root ports, revert the faulty commit.
[1] https://www.intel.com/content/dam/www/public/us/en/documents/specification-updates/300-series-c240-series-chipset-pch-spec-update.pdf
Fixes: f154a718e6cc ("PCI: Add ACS quirk for Intel 300 series")
Signed-off-by: Mika Westerberg
Signed-off-by: Bjorn Helgaas
Cc: stable@vger.kernel.org # v4.18+
Signed-off-by: Greg Kroah-Hartman
commit 6d8911403d991dfda859f5059af6f7c3071a2600
Author: Kirill Kapranov
Date: Mon Aug 13 19:48:10 2018 +0300
spi: fix IDR collision on systems with both fixed and dynamic SPI bus numbers
commit 1a4327fbf4554d5b78d75b19a13d40d6de220159 upstream.
On systems where some controllers get a dynamic ID assigned and some have
a fixed number (e.g. from ACPI tables), the current implementation might
run into an IDR collision: in case of a fixed bus number is gotten by a
driver (but not marked busy in IDR tree) and a driver with dynamic bus
number gets the same ID and predictably fails.
Fix this by means of checking-in fixed IDsin IDR as far as dynamic ones
at the moment of the controller registration.
Fixes: 9b61e302210e (spi: Pick spi bus number from Linux idr or spi alias)
Signed-off-by: Kirill Kapranov
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 1318b2c26b783f94045678c5056720a86b20a418
Author: Boris Ostrovsky
Date: Thu Jul 12 13:27:00 2018 -0400
xen/x86/vpmu: Zero struct pt\_regs before calling into sample handling code
commit 70513d58751d7c6c1a0133557b13089b9f2e3e66 upstream.
Otherwise we may leak kernel stack for events that sample user
registers.
Reported-by: Mark Rutland
Reviewed-by: Juergen Gross
Signed-off-by: Boris Ostrovsky
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit b73a161e9beff24bf1803ba393dff95a255268f9
Author: Juergen Gross
Date: Tue Sep 11 09:04:48 2018 +0200
xen/netfront: don't bug in case of too many frags
commit ad4f15dc2c70b1de5e0a64d27335962fbc9cf71c upstream.
Commit 57f230ab04d291 ("xen/netfront: raise max number of slots in
xennet\_get\_responses()") raised the max number of allowed slots by one.
This seems to be problematic in some configurations with netback using
a larger MAX\_SKB\_FRAGS value (e.g. old Linux kernel with MAX\_SKB\_FRAGS
defined as 18 instead of nowadays 17).
Instead of BUG\_ON() in this case just fall back to retransmission.
Fixes: 57f230ab04d291 ("xen/netfront: raise max number of slots in xennet\_get\_responses()")
Cc: stable@vger.kernel.org
Signed-off-by: Juergen Gross
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 5e17a1ecc44be1b9ed4bc94838749c99c9dff86b
Author: Mario Limonciello
Date: Mon Sep 10 13:01:53 2018 -0500
platform/x86: alienware-wmi: Correct a memory leak
commit ff0e9f26288d2daee4950f42b37a3d3d30d36ec1 upstream.
An ACPI buffer that was allocated was not being freed after use.
Signed-off-by: Mario Limonciello
Cc: stable@vger.kernel.org
Signed-off-by: Darren Hart (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 8879342a67a4c0986dd48f8d4381b94999ada174
Author: Mario Limonciello
Date: Mon Sep 10 13:01:52 2018 -0500
platform/x86: dell-smbios-wmi: Correct a memory leak
commit affab51082174f60ef71ced8ab5fbe71f00e9ae3 upstream.
ACPI buffers were being allocated but never freed.
Reported-by: Pinzhen Xu
Signed-off-by: Mario Limonciello
Cc: stable@vger.kernel.org
Signed-off-by: Darren Hart (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 0639ddca2c8cfdfe9b443712914de9a824908d19
Author: Masahiro Yamada
Date: Thu Sep 13 14:58:49 2018 +0900
mtd: rawnand: denali: fix a race condition when DMA is kicked
commit cf51e4b9c34407bf0c3d9b582b7837e047e1df47 upstream.
I thought the read-back of the DMA\_ENABLE register was unnecessary
(at least it is working on my boards), then deleted it in commit
586a2c52909d ("mtd: nand: denali: squash denali\_enable\_dma() helper
into caller"). Sorry, I was wrong - it caused a timing issue on
Cyclone5 SoCFPGAs.
Revive the register read-back, commenting why this is necessary.
Fixes: 586a2c52909d ("mtd: nand: denali: squash denali\_enable\_dma() helper into caller")
Cc:
Reported-by: Steffen Trumtrar
Signed-off-by: Masahiro Yamada
Reviewed-by: Miquel Raynal
Signed-off-by: Boris Brezillon
Signed-off-by: Greg Kroah-Hartman
commit f11b8aad34fa7b0ec1ca2a45d2d2a826ebf41c32
Author: Boris Brezillon
Date: Mon Sep 17 16:31:30 2018 +0200
mtd: devices: m25p80: Make sure the buffer passed in op is DMA-able
commit 4a3e85f2674cbfb81052059107d0165269778e2f upstream.
As documented in spi-mem.h, spi\_mem\_op->data.buf.{in,out} must be
DMA-able, and commit 4120f8d158ef ("mtd: spi-nor: Use the spi\_mem\_xx()
API") failed to follow this rule as buffers passed to
->{read,write}\_reg() are usually placed on the stack.
Fix that by allocating a scratch buffer and copying the data around.
Fixes: 4120f8d158ef ("mtd: spi-nor: Use the spi\_mem\_xx() API")
Reported-by: Jarkko Nikula
Cc:
Signed-off-by: Boris Brezillon
Tested-by: Jarkko Nikula
Reviewed-by: Jarkko Nikula
Signed-off-by: Greg Kroah-Hartman
commit 1501a0f2e14ea7fc0028fe17eaa4a28231af7887
Author: Takashi Sakamoto
Date: Thu Sep 13 21:31:18 2018 +0900
ALSA: oxfw: fix memory leak of private data
commit 498fe23aad8e3b5a9554f55719c537603b4476ea upstream.
Although private data of sound card instance is usually allocated in the
tail of the instance, drivers in ALSA firewire stack allocate the private
data before allocating the instance. In this case, the private data
should be released explicitly at .private\_free callback of the instance.
This commit fixes memory leak following to the above design.
Fixes: 6c29230e2a5f ('ALSA: oxfw: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 9d07f491db952d1ae98c430f7c4ef62482ec11ea
Author: Takashi Sakamoto
Date: Mon Sep 17 17:26:20 2018 +0900
ALSA: oxfw: fix memory leak of discovered stream formats at error path
commit 1064bc685d359f549f91c2d5f111965a9284f328 upstream.
After finishing discover of stream formats, ALSA OXFW driver has memory
leak of allocated memory object at error path.
This commit releases the memory object at the error path.
Fixes: 6c29230e2a5f ('ALSA: oxfw: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 82567fb0984625e5e11b89ecbfbbb4654a2a313b
Author: Takashi Sakamoto
Date: Mon Sep 17 17:26:08 2018 +0900
ALSA: oxfw: fix memory leak for model-dependent data at error path
commit ce925f088b979537f22f9e05eb923ef9822ca139 upstream.
After allocating model-dependent data, ALSA OXFW driver has memory leak
of the data at error path.
This commit releases the data at the error path.
Fixes: 6c29230e2a5f ('ALSA: oxfw: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 8e54fc8910f3d131be47d434fcde15d409ae62f1
Author: Takashi Sakamoto
Date: Mon Sep 17 17:26:41 2018 +0900
ALSA: fireworks: fix memory leak of response buffer at error path
commit c3b55e2ec9c76e7a0de2a0b1dc851fdc9440385b upstream.
After allocating memory object for response buffer, ALSA fireworks
driver has leak of the memory object at error path.
This commit releases the object at the error path.
Fixes: 7d3c1d5901aa('ALSA: fireworks: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e5301d45d01c27a8f214bedb2a93fd4ec41c1186
Author: Takashi Sakamoto
Date: Thu Sep 13 21:31:05 2018 +0900
ALSA: firewire-tascam: fix memory leak of private data
commit 8d28277c065a974873c6781d44b7bcdcd8fb4e8a upstream.
Although private data of sound card instance is usually allocated in the
tail of the instance, drivers in ALSA firewire stack allocate the private
data before allocating the instance. In this case, the private data
should be released explicitly at .private\_free callback of the instance.
This commit fixes memory leak following to the above design.
Fixes: b610386c8afb ('ALSA: firewire-tascam: deleyed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 7c57a806be787c080854e93cfbf643b9f5c18eae
Author: Takashi Sakamoto
Date: Thu Sep 13 21:30:34 2018 +0900
ALSA: firewire-digi00x: fix memory leak of private data
commit a49a83ab05e34edd6c71a4fbd062c9a7ba6d18aa upstream.
Although private data of sound card instance is usually allocated in the
tail of the instance, drivers in ALSA firewire stack allocate the private
data before allocating the instance. In this case, the private data
should be released explicitly at .private\_free callback of the instance.
This commit fixes memory leak following to the above design.
Fixes: 86c8dd7f4da3 ('ALSA: firewire-digi00x: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit e9355495975d8a6b07470aaff25073564e765e86
Author: Takashi Sakamoto
Date: Sun Sep 9 22:25:52 2018 +0900
ALSA: fireface: fix memory leak in ff400\_switch\_fetching\_mode()
commit 36f3a6e02c143a7e9e4e143e416371f67bc1fae6 upstream.
An allocated memory forgets to be released.
Fixes: 76fdb3a9e13 ('ALSA: fireface: add support for Fireface 400')
Cc:  # 4.12+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit cedfb9f8a588ea7f72d7c232fa09beadc338d9ed
Author: Willy Tarreau
Date: Sat Sep 8 08:12:21 2018 +0200
ALSA: emu10k1: fix possible info leak to userspace on SNDRV\_EMU10K1\_IOCTL\_INFO
commit 49434c6c575d2008c0abbc93e615019f39e01252 upstream.
snd\_emu10k1\_fx8010\_ioctl(SNDRV\_EMU10K1\_IOCTL\_INFO) allocates
memory using kmalloc() and partially fills it by calling
snd\_emu10k1\_fx8010\_info() before returning the resulting
structure to userspace, leaving uninitialized holes. Let's
just use kzalloc() here.
BugLink: http://blog.infosectcbr.com.au/2018/09/linux-kernel-infoleaks.html
Signed-off-by: Willy Tarreau
Cc: Jann Horn
Cc:
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit c143935a34a50e1a6dfba3da2da8809ebe90f2d1
Author: Takashi Sakamoto
Date: Sun Sep 9 22:25:12 2018 +0900
ALSA: bebob: use address returned by kmalloc() instead of kernel stack for streaming DMA mapping
commit 493626f2d87a74e6dbea1686499ed6e7e600484e upstream.
When executing 'fw\_run\_transaction()' with 'TCODE\_WRITE\_BLOCK\_REQUEST',
an address of 'payload' argument is used for streaming DMA mapping by
'firewire\_ohci' module if 'size' argument is larger than 8 byte.
Although in this case the address should not be on kernel stack, current
implementation of ALSA bebob driver uses data in kernel stack for a cue
to boot M-Audio devices. This often brings unexpected result, especially
for a case of CONFIG\_VMAP\_STACK=y.
This commit fixes the bug.
Reference: https://bugzilla.kernel.org/show\_bug.cgi?id=201021
Reference: https://forum.manjaro.org/t/firewire-m-audio-410-driver-wont-load-firmware/51165
Fixes: a2b2a7798fb6('ALSA: bebob: Send a cue to load firmware for M-Audio Firewire series')
Cc:  # v3.16+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 28114caeb0ab2edb0181866a040965cd74169571
Author: Takashi Sakamoto
Date: Mon Sep 17 17:25:24 2018 +0900
ALSA: bebob: fix memory leak for M-Audio FW1814 and ProjectMix I/O at error path
commit b1fbebd4164b3d170ad916dcd692cf843c9c065d upstream.
After allocating model-dependent data for M-Audio FW1814 and ProjectMix
I/O, ALSA bebob driver has memory leak at error path.
This commit releases the allocated data at the error path.
Fixes: 04a2c73c97eb('ALSA: bebob: delayed registration of sound card')
Cc:  # v4.7+
Signed-off-by: Takashi Sakamoto
Signed-off-by: Takashi Iwai
Signed-off-by: Greg Kroah-Hartman
commit 30100a47516788e46f8063ad2b0bdf1ef224ef1e
Author: Dmitry V. Levin
Date: Mon Aug 13 18:50:02 2018 +0300
ASoC: uapi: fix sound/skl-tplg-interface.h userspace compilation errors
commit fb504caae7ef85be159743bd4b08ecde269ba55f upstream.
Include  and consistently use types it provides
to fix the following sound/skl-tplg-interface.h userspace compilation errors:
/usr/include/sound/skl-tplg-interface.h:146:2: error: unknown type name 'u32'
u32 set\_params:2;
/usr/include/sound/skl-tplg-interface.h:147:2: error: unknown type name 'u32'
u32 rsvd:30;
/usr/include/sound/skl-tplg-interface.h:148:2: error: unknown type name 'u32'
u32 param\_id;
/usr/include/sound/skl-tplg-interface.h:149:2: error: unknown type name 'u32'
u32 max;
/usr/include/sound/skl-tplg-interface.h:166:2: error: unknown type name 'u16'
u16 module\_id;
/usr/include/sound/skl-tplg-interface.h:167:2: error: unknown type name 'u16'
u16 instance\_id;
/usr/include/sound/skl-tplg-interface.h:171:2: error: unknown type name 'u32'
u32 channels;
/usr/include/sound/skl-tplg-interface.h:172:2: error: unknown type name 'u32'
u32 freq;
/usr/include/sound/skl-tplg-interface.h:173:2: error: unknown type name 'u32'
u32 bit\_depth;
/usr/include/sound/skl-tplg-interface.h:174:2: error: unknown type name 'u32'
u32 valid\_bit\_depth;
/usr/include/sound/skl-tplg-interface.h:175:2: error: unknown type name 'u32'
u32 ch\_cfg;
/usr/include/sound/skl-tplg-interface.h:176:2: error: unknown type name 'u32'
u32 interleaving\_style;
/usr/include/sound/skl-tplg-interface.h:177:2: error: unknown type name 'u32'
u32 sample\_type;
/usr/include/sound/skl-tplg-interface.h:178:2: error: unknown type name 'u32'
u32 ch\_map;
/usr/include/sound/skl-tplg-interface.h:182:2: error: unknown type name 'u32'
u32 set\_params:2;
/usr/include/sound/skl-tplg-interface.h:183:2: error: unknown type name 'u32'
u32 rsvd:30;
/usr/include/sound/skl-tplg-interface.h:184:2: error: unknown type name 'u32'
u32 param\_id;
/usr/include/sound/skl-tplg-interface.h:185:2: error: unknown type name 'u32'
u32 caps\_size;
/usr/include/sound/skl-tplg-interface.h:186:2: error: unknown type name 'u32'
u32 caps[HDA\_SST\_CFG\_MAX];
/usr/include/sound/skl-tplg-interface.h:190:2: error: unknown type name 'u8'
u8 pipe\_id;
/usr/include/sound/skl-tplg-interface.h:191:2: error: unknown type name 'u8'
u8 pipe\_priority;
/usr/include/sound/skl-tplg-interface.h:192:2: error: unknown type name 'u16'
u16 conn\_type:4;
/usr/include/sound/skl-tplg-interface.h:193:2: error: unknown type name 'u16'
u16 rsvd:4;
/usr/include/sound/skl-tplg-interface.h:194:2: error: unknown type name 'u16'
u16 memory\_pages:8;
/usr/include/sound/skl-tplg-interface.h:200:2: error: unknown type name 'u16'
u16 module\_id;
/usr/include/sound/skl-tplg-interface.h:201:2: error: unknown type name 'u16'
u16 instance\_id;
/usr/include/sound/skl-tplg-interface.h:202:2: error: unknown type name 'u32'
u32 max\_mcps;
/usr/include/sound/skl-tplg-interface.h:203:2: error: unknown type name 'u32'
u32 mem\_pages;
/usr/include/sound/skl-tplg-interface.h:204:2: error: unknown type name 'u32'
u32 obs;
/usr/include/sound/skl-tplg-interface.h:205:2: error: unknown type name 'u32'
u32 ibs;
/usr/include/sound/skl-tplg-interface.h:206:2: error: unknown type name 'u32'
u32 vbus\_id;
/usr/include/sound/skl-tplg-interface.h:208:2: error: unknown type name 'u32'
u32 max\_in\_queue:8;
/usr/include/sound/skl-tplg-interface.h:209:2: error: unknown type name 'u32'
u32 max\_out\_queue:8;
/usr/include/sound/skl-tplg-interface.h:210:2: error: unknown type name 'u32'
u32 time\_slot:8;
/usr/include/sound/skl-tplg-interface.h:211:2: error: unknown type name 'u32'
u32 core\_id:4;
/usr/include/sound/skl-tplg-interface.h:212:2: error: unknown type name 'u32'
u32 rsvd1:4;
/usr/include/sound/skl-tplg-interface.h:214:2: error: unknown type name 'u32'
u32 module\_type:8;
/usr/include/sound/skl-tplg-interface.h:215:2: error: unknown type name 'u32'
u32 conn\_type:4;
/usr/include/sound/skl-tplg-interface.h:216:2: error: unknown type name 'u32'
u32 dev\_type:4;
/usr/include/sound/skl-tplg-interface.h:217:2: error: unknown type name 'u32'
u32 hw\_conn\_type:4;
/usr/include/sound/skl-tplg-interface.h:218:2: error: unknown type name 'u32'
u32 rsvd2:12;
/usr/include/sound/skl-tplg-interface.h:220:2: error: unknown type name 'u32'
u32 params\_fixup:8;
/usr/include/sound/skl-tplg-interface.h:221:2: error: unknown type name 'u32'
u32 converter:8;
/usr/include/sound/skl-tplg-interface.h:222:2: error: unknown type name 'u32'
u32 input\_pin\_type:1;
/usr/include/sound/skl-tplg-interface.h:223:2: error: unknown type name 'u32'
u32 output\_pin\_type:1;
/usr/include/sound/skl-tplg-interface.h:224:2: error: unknown type name 'u32'
u32 is\_dynamic\_in\_pin:1;
/usr/include/sound/skl-tplg-interface.h:225:2: error: unknown type name 'u32'
u32 is\_dynamic\_out\_pin:1;
/usr/include/sound/skl-tplg-interface.h:226:2: error: unknown type name 'u32'
u32 is\_loadable:1;
/usr/include/sound/skl-tplg-interface.h:227:2: error: unknown type name 'u32'
u32 rsvd3:11;
Fixes: 0c24fdc00244 ("ASoC: topology: Move skl-tplg-interface.h to uapi")
Signed-off-by: Dmitry V. Levin
Reviewed-by: Guenter Roeck
Signed-off-by: Mark Brown
Cc:  # v4.18
Signed-off-by: Greg Kroah-Hartman
commit 341ff629a2e9bfe1ed786cd06186bc727f0cce21
Author: Jiada Wang
Date: Mon Sep 3 07:08:58 2018 +0000
ASoC: rsnd: fixup not to call clk\_get/set under non-atomic
commit 4d230d12710646788af581ba0155d83ab48b955c upstream.
Clocking operations clk\_get/set\_rate, are non-atomic,
they shouldn't be called in soc\_pcm\_trigger() which is atomic.
Following issue was found due to execution of clk\_get\_rate() causes
sleep in soc\_pcm\_trigger(), which shouldn't be blocked.
We can reproduce this issue by following
> enable CONFIG\_DEBUG\_ATOMIC\_SLEEP=y
> compile, and boot
> mount -t debugfs none /sys/kernel/debug
> while true; do cat /sys/kernel/debug/clk/clk\_summary > /dev/null; done &
> while true; do aplay xxx; done
This patch adds support to .prepare callback, and moves non-atomic
clocking operations to it. As .prepare is non-atomic, it is always
called before trigger\_start/trigger\_stop.
BUG: sleeping function called from invalid context at kernel/locking/mutex.c:620
in\_atomic(): 1, irqs\_disabled(): 128, pid: 2242, name: aplay
INFO: lockdep is turned off.
irq event stamp: 5964
hardirqs last enabled at (5963): [] mutex\_lock\_nested+0x6e8/0x6f0
hardirqs last disabled at (5964): [] \_raw\_spin\_lock\_irqsave+0x24/0x68
softirqs last enabled at (5502): [] \_\_do\_softirq+0x560/0x10c0
softirqs last disabled at (5495): [] irq\_exit+0x160/0x25c
Preemption disabled at:[ 62.904063] [] snd\_pcm\_stream\_lock+0xb4/0xc0
CPU: 2 PID: 2242 Comm: aplay Tainted: G B C 4.9.54+ #186
Hardware name: Renesas Salvator-X board based on r8a7795 (DT)
Call trace:
[] dump\_backtrace+0x0/0x37c
[] show\_stack+0x14/0x1c
[] dump\_stack+0xfc/0x154
[] \_\_\_might\_sleep+0x57c/0x58c
[] \_\_might\_sleep+0x208/0x21c
[] mutex\_lock\_nested+0xb4/0x6f0
[] clk\_prepare\_lock+0xb0/0x184
[] clk\_core\_get\_rate+0x14/0x54
[] clk\_get\_rate+0x20/0x34
[] rsnd\_adg\_ssi\_clk\_try\_start+0x158/0x4f8 [snd\_soc\_rcar]
[] rsnd\_ssi\_init+0x668/0x7a0 [snd\_soc\_rcar]
[] rsnd\_soc\_dai\_trigger+0x4bc/0xcf8 [snd\_soc\_rcar]
[] soc\_pcm\_trigger+0x2a4/0x2d4
Fixes: e7d850dd10f4 ("ASoC: rsnd: use mod base common method on SSI-parent")
Signed-off-by: Jiada Wang
Signed-off-by: Timo Wischer
[Kuninori: tidyup for upstream]
Signed-off-by: Kuninori Morimoto
Tested-by: Hiroyuki Yokoyama
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 9e6a69b065758615c0b631e5675403e086f88c7c
Author: Andrew F. Davis
Date: Fri Aug 31 10:14:05 2018 -0500
ASoC: tas6424: Save last fault register even when clear
commit d40e3e9e44db4b3c8777f3b515ba6097ba26e3b2 upstream.
When there is no fault bit set in a fault register we skip the fault
reporting section for that register. This also skips over saving that
registers value. We save the value so we will not double report an
error, but if an error clears then returns we will also not report it
as we did not save the all cleared register value. Fix this by saving
the fault register value in the all clear path.
Signed-off-by: Andrew F. Davis
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit df231dbe93ebefdc2bd959550fe4856472113251
Author: SÃ©bastien Szymanski
Date: Thu Sep 6 11:16:00 2018 +0200
ASoC: cs4265: fix MMTLR Data switch control
commit 90a3b7f8aba3011badacd6d8121e03aa24ac79d1 upstream.
The MMTLR bit is in the CS4265\_SPDIF\_CTL2 register at address 0x12 bit 0
and not at address 0x0 bit 1. Fix this.
Signed-off-by: SÃ©bastien Szymanski
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 401e975e5950ad9f64f6348c21f6c05e65e0de91
Author: Marcel Ziswiler
Date: Tue Aug 14 00:35:56 2018 +0200
ASoC: wm9712: fix replace codec to component
commit 5e4cfadaf5b73a0801b2fa7fb007f98400ebfe6e upstream.
Since commit 143b44845d87 ("ASoC: wm9712: replace codec to component")
"wm9712-codec" got renamed to "wm9712-component", however, this change
never got propagated down to the actual board/platform drivers. E.g. on
Colibri T20 this lead to the following spew upon boot with sound/touch
being broken:
[ 2.214121] tegra-snd-wm9712 sound: ASoC: CODEC DAI wm9712-hifi not registered
[ 2.222137] tegra-snd-wm9712 sound: snd\_soc\_register\_card failed (-517)
...
[ 2.344384] tegra-snd-wm9712 sound: ASoC: CODEC DAI wm9712-hifi not registered
[ 2.351885] tegra-snd-wm9712 sound: snd\_soc\_register\_card failed (-517)
...
[ 2.668339] tegra-snd-wm9712 sound: ASoC: CODEC DAI wm9712-hifi not registered
[ 2.675811] tegra-snd-wm9712 sound: snd\_soc\_register\_card failed (-517)
...
[ 3.208408] tegra-snd-wm9712 sound: ASoC: CODEC DAI wm9712-hifi not registered
[ 3.216312] tegra-snd-wm9712 sound: snd\_soc\_register\_card failed (-517)
...
[ 3.235397] tegra-snd-wm9712 sound: ASoC: CODEC DAI wm9712-hifi not registered
[ 3.248938] tegra-snd-wm9712 sound: snd\_soc\_register\_card failed (-517)
...
[ 14.970443] ALSA device list:
[ 14.996628] No soundcards found.
This commit finally fixes this again.
Signed-off-by: Marcel Ziswiler
Acked-by: Charles Keepax
Signed-off-by: Mark Brown
Cc: stable@vger.kernel.org
Signed-off-by: Greg Kroah-Hartman
commit 58be75ff08789de700a75a12a092f4a2b778296b
Author: Suren Baghdasaryan
Date: Mon Sep 17 15:51:41 2018 +0200
NFC: Fix the number of pipes
commit e285d5bfb7e9785d289663baef252dd315e171f8 upstream.
According to ETSI TS 102 622 specification chapter 4.4 pipe identifier
is 7 bits long which allows for 128 unique pipe IDs. Because
NFC\_HCI\_MAX\_PIPES is used as the number of pipes supported and not
as the max pipe ID, its value should be 128 instead of 127.
nfc\_hci\_recv\_from\_llc extracts pipe ID from packet header using
NFC\_HCI\_FRAGMENT(0x7F) mask which allows for pipe ID value of 127.
Same happens when NCI\_HCP\_MSG\_GET\_PIPE() is being used. With
pipes array having only 127 elements and pipe ID of 127 the OOB memory
access will result.
Cc: Samuel Ortiz
Cc: Allen Pais
Cc: "David S. Miller"
Suggested-by: Dan Carpenter
Signed-off-by: Suren Baghdasaryan
Reviewed-by: Kees Cook
Cc: stable
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 0ad778eeee6d42b61bbf4494c7de22e387a2a05e
Author: Suren Baghdasaryan
Date: Mon Sep 17 15:51:40 2018 +0200
NFC: Fix possible memory corruption when handling SHDLC I-Frame commands
commit 674d9de02aa7d521ebdf66c3958758bdd9c64e11 upstream.
When handling SHDLC I-Frame commands "pipe" field used for indexing
into an array should be checked before usage. If left unchecked it
might access memory outside of the array of size NFC\_HCI\_MAX\_PIPES(127).
Malformed NFC HCI frames could be injected by a malicious NFC device
communicating with the device being attacked (remote attack vector),
or even by an attacker with physical access to the I2C bus such that
they could influence the data transfers on that bus (local attack vector).
skb->data is controlled by the attacker and has only been sanitized in
the most trivial ways (CRC check), therefore we can consider the
create\_info struct and all of its members to tainted. 'create\_info->pipe'
with max value of 255 (uint8) is used to take an offset of the
hdev->pipes array of 127 elements which can lead to OOB write.
Cc: Samuel Ortiz
Cc: Allen Pais
Cc: "David S. Miller"
Suggested-by: Kevin Deus
Signed-off-by: Suren Baghdasaryan
Acked-by: Kees Cook
Cc: stable
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 18b8a9c5dab35c3f39402e12664da6d8b2d52c43
Author: Roopa Prabhu
Date: Wed Sep 12 13:21:48 2018 -0700
net: rtnl\_configure\_link: fix dev flags changes arg to \_\_dev\_notify\_flags
[ Upstream commit 56a49d7048703f5ffdb84d3a0ee034108fba6850 ]
This fix addresses https://bugzilla.kernel.org/show\_bug.cgi?id=201071
Commit 5025f7f7d506 wrongly relied on \_\_dev\_change\_flags to notify users of
dev flag changes in the case when dev->rtnl\_link\_state = RTNL\_LINK\_INITIALIZED.
Fix it by indicating flag changes explicitly to \_\_dev\_notify\_flags.
Fixes: 5025f7f7d506 ("rtnetlink: add rtnl\_link\_state check in rtnl\_configure\_link")
Reported-By: Liam mcbirnie
Signed-off-by: Roopa Prabhu
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 1b46979978c0105988c1607a6dda4b2a7f740f7f
Author: Antoine Tenart
Date: Fri Sep 14 16:56:35 2018 +0200
net: mvpp2: let phylink manage the carrier state
[ Upstream commit 41948ccb4a856dddacfbd4d789d4fa8663fe41bb ]
Net drivers using phylink shouldn't mess with the link carrier
themselves and should let phylink manage it. The mvpp2 driver wasn't
following this best practice as the mac\_config() function made calls to
change the link carrier state. This led to wrongly reported carrier link
state which then triggered other issues. This patch fixes this
behaviour.
But the PPv2 driver relied on this misbehaviour in two cases: for fixed
links and when not using phylink (ACPI mode). The later was fixed by
adding an explicit call to link\_up(), which when the ACPI mode will use
phylink should be removed.
The fixed link case was relying on the mac\_config() function to set the
link up, as we found an issue in phylink\_start() which assumes the
carrier is off. If not, the link\_up() function is never called. To fix
this, a call to netif\_carrier\_off() is added just before phylink\_start()
so that we do not introduce a regression in the driver.
Fixes: 4bb043262878 ("net: mvpp2: phylink support")
Reported-by: Russell King
Signed-off-by: Antoine Tenart
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 001e4e5537d83d5b5814a642a47d7691de80a66f
Author: Peter Oskolkov
Date: Mon Sep 17 10:20:53 2018 -0700
net/ipv6: do not copy dst flags on rt init
[ Upstream commit 30bfd93062814d6767e452a8f5ddcd97f7e38c7e ]
DST\_NOCOUNT in dst\_entry::flags tracks whether the entry counts
toward route cache size (net->ipv6.sysctl.ip6\_rt\_max\_size).
If the flag is NOT set, dst\_ops::pcpuc\_entries counter is incremented
in dist\_init() and decremented in dst\_destroy().
This flag is tied to allocation/deallocation of dst\_entry and
should not be copied from another dst/route. Otherwise it can happen
that dst\_ops::pcpuc\_entries counter grows until no new routes can
be allocated because the counter reached ip6\_rt\_max\_size due to
DST\_NOCOUNT not set and thus no counter decrements on gc-ed routes.
Fixes: 3b6761d18bc1 ("net/ipv6: Move dst flags to booleans in fib entries")
Cc: David Ahern
Acked-by: Wei Wang
Signed-off-by: Peter Oskolkov
Reviewed-by: David Ahern
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 1328a5a40fdef0cd1c82698074b40b490558c6b6
Author: Xin Long
Date: Tue Sep 11 14:33:58 2018 +0800
ipv6: use rt6\_info members when dst is set in rt6\_fill\_node
[ Upstream commit 22d0bd82cc7cec7d9ed4bd5913f3ab65643364be ]
In inet6\_rtm\_getroute, since Commit 93531c674315 ("net/ipv6: separate
handling of FIB entries from dst based routes"), it has used rt->from
to dump route info instead of rt.
However for some route like cache, some of its information like flags
or gateway is not the same as that of the 'from' one. It caused 'ip
route get' to dump the wrong route information.
In Jianlin's testing, the output information even lost the expiration
time for a pmtu route cache due to the wrong fib6\_flags.
So change to use rt6\_info members for dst addr, src addr, flags and
gateway when it tries to dump a route entry without fibmatch set.
v1->v2:
- not use rt6i\_prefsrc.
- also fix the gw dump issue.
Fixes: 93531c674315 ("net/ipv6: separate handling of FIB entries from dst based routes")
Reported-by: Jianlin Shi
Signed-off-by: Xin Long
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b5fc7f300cdbc7d8bee3a0b77bb1a37bfa367b18
Author: Michael Chan
Date: Fri Sep 14 15:41:29 2018 -0400
bnxt\_en: Fix VF mac address regression.
[ Upstream commit 28ea334bd1657f3c43485b4a8592672fc6835fac ]
The recent commit to always forward the VF MAC address to the PF for
approval may not work if the PF driver or the firmware is older. This
will cause the VF driver to fail during probe:
bnxt\_en 0000:00:03.0 (unnamed net\_device) (uninitialized): hwrm req\_type 0xf seq id 0x5 error 0xffff
bnxt\_en 0000:00:03.0 (unnamed net\_device) (uninitialized): VF MAC address 00:00:17:02:05:d0 not approved by the PF
bnxt\_en 0000:00:03.0: Unable to initialize mac address.
bnxt\_en: probe of 0000:00:03.0 failed with error -99
We fix it by treating the error as fatal only if the VF MAC address is
locally generated by the VF.
Fixes: 707e7e966026 ("bnxt\_en: Always forward VF MAC address to the PF.")
Reported-by: Seth Forshee
Reported-by: Siwei Liu
Signed-off-by: Michael Chan
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 8ac22b327cc28dba60d350e341e96657d30ac4b5
Author: Daniel Borkmann
Date: Fri Sep 14 23:00:55 2018 +0200
tls: fix currently broken MSG\_PEEK behavior
[ Upstream commit 50c6b58a814d86a93c0f6964570f839632854044 ]
In kTLS MSG\_PEEK behavior is currently failing, strace example:
[pid 2430] socket(AF\_INET, SOCK\_STREAM, IPPROTO\_IP) = 3
[pid 2430] socket(AF\_INET, SOCK\_STREAM, IPPROTO\_IP) = 4
[pid 2430] bind(4, {sa\_family=AF\_INET, sin\_port=htons(0), sin\_addr=inet\_addr("0.0.0.0")}, 16) = 0
[pid 2430] listen(4, 10) = 0
[pid 2430] getsockname(4, {sa\_family=AF\_INET, sin\_port=htons(38855), sin\_addr=inet\_addr("0.0.0.0")}, [16]) = 0
[pid 2430] connect(3, {sa\_family=AF\_INET, sin\_port=htons(38855), sin\_addr=inet\_addr("0.0.0.0")}, 16) = 0
[pid 2430] setsockopt(3, SOL\_TCP, 0x1f /\* TCP\_??? \*/, [7564404], 4) = 0
[pid 2430] setsockopt(3, 0x11a /\* SOL\_?? \*/, 1, "\3\0033\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 40) = 0
[pid 2430] accept(4, {sa\_family=AF\_INET, sin\_port=htons(49636), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 5
[pid 2430] setsockopt(5, SOL\_TCP, 0x1f /\* TCP\_??? \*/, [7564404], 4) = 0
[pid 2430] setsockopt(5, 0x11a /\* SOL\_?? \*/, 2, "\3\0033\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 40) = 0
[pid 2430] close(4) = 0
[pid 2430] sendto(3, "test\_read\_peek", 14, 0, NULL, 0) = 14
[pid 2430] sendto(3, "\_mult\_recs\0", 11, 0, NULL, 0) = 11
[pid 2430] recvfrom(5, "test\_read\_peektest\_read\_peektest"..., 64, MSG\_PEEK, NULL, NULL) = 64
As can be seen from strace, there are two TLS records sent,
i) 'test\_read\_peek' and ii) '\_mult\_recs\0' where we end up
peeking 'test\_read\_peektest\_read\_peektest'. This is clearly
wrong, and what happens is that given peek cannot call into
tls\_sw\_advance\_skb() to unpause strparser and proceed with
the next skb, we end up looping over the current one, copying
the 'test\_read\_peek' over and over into the user provided
buffer.
Here, we can only peek into the currently held skb (current,
full TLS record) as otherwise we would end up having to hold
all the original skb(s) (depending on the peek depth) in a
separate queue when unpausing strparser to process next
records, minimally intrusive is to return only up to the
current record's size (which likely was what c46234ebb4d1
("tls: RX path for ktls") originally intended as well). Thus,
after patch we properly peek the first record:
[pid 2046] wait4(2075,
[pid 2075] socket(AF\_INET, SOCK\_STREAM, IPPROTO\_IP) = 3
[pid 2075] socket(AF\_INET, SOCK\_STREAM, IPPROTO\_IP) = 4
[pid 2075] bind(4, {sa\_family=AF\_INET, sin\_port=htons(0), sin\_addr=inet\_addr("0.0.0.0")}, 16) = 0
[pid 2075] listen(4, 10) = 0
[pid 2075] getsockname(4, {sa\_family=AF\_INET, sin\_port=htons(55115), sin\_addr=inet\_addr("0.0.0.0")}, [16]) = 0
[pid 2075] connect(3, {sa\_family=AF\_INET, sin\_port=htons(55115), sin\_addr=inet\_addr("0.0.0.0")}, 16) = 0
[pid 2075] setsockopt(3, SOL\_TCP, 0x1f /\* TCP\_??? \*/, [7564404], 4) = 0
[pid 2075] setsockopt(3, 0x11a /\* SOL\_?? \*/, 1, "\3\0033\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 40) = 0
[pid 2075] accept(4, {sa\_family=AF\_INET, sin\_port=htons(45732), sin\_addr=inet\_addr("127.0.0.1")}, [16]) = 5
[pid 2075] setsockopt(5, SOL\_TCP, 0x1f /\* TCP\_??? \*/, [7564404], 4) = 0
[pid 2075] setsockopt(5, 0x11a /\* SOL\_?? \*/, 2, "\3\0033\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 40) = 0
[pid 2075] close(4) = 0
[pid 2075] sendto(3, "test\_read\_peek", 14, 0, NULL, 0) = 14
[pid 2075] sendto(3, "\_mult\_recs\0", 11, 0, NULL, 0) = 11
[pid 2075] recvfrom(5, "test\_read\_peek", 64, MSG\_PEEK, NULL, NULL) = 14
Fixes: c46234ebb4d1 ("tls: RX path for ktls")
Signed-off-by: Daniel Borkmann
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 17eef150f66b502b4d7a27ecc7fc5b18fd5ab117
Author: Johannes Berg
Date: Thu Sep 13 14:40:55 2018 +0200
socket: fix struct ifreq size in compat ioctl
[ Upstream commit 1cebf8f143c21eb422cd0f4e27ab2ae366eb4d04 ]
As reported by Reobert O'Callahan, since Viro's commit to kill
dev\_ifsioc() we attempt to copy too much data in compat mode,
which may lead to EFAULT when the 32-bit version of struct ifreq
sits at/near the end of a page boundary, and the next page isn't
mapped.
Fix this by passing the approprate compat/non-compat size to copy
and using that, as before the dev\_ifsioc() removal. This works
because only the embedded "struct ifmap" has different size, and
this is only used in SIOCGIFMAP/SIOCSIFMAP which has a different
handler. All other parts of the union are naturally compatible.
This fixes https://bugzilla.kernel.org/show\_bug.cgi?id=199469.
Fixes: bf4405737f9f ("kill dev\_ifsioc()")
Reported-by: Robert O'Callahan
Signed-off-by: Johannes Berg
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 263baf63bdfbe69a4d9e21b73ab94d97a848c99f
Author: Andrew Lunn
Date: Fri Sep 14 23:46:12 2018 +0200
net: dsa: mv88e6xxx: Fix ATU Miss Violation
[ Upstream commit ddca24dfcf1bec608668dd44c45d49397b70f520 ]
Fix a cut/paste error and a typo which results in ATU miss violations
not being reported.
Fixes: 0977644c5005 ("net: dsa: mv88e6xxx: Decode ATU problem interrupt")
Signed-off-by: Andrew Lunn
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4188aa04910796865e608212fbb3654fcdd68836
Author: Stephen Hemminger
Date: Thu Sep 13 08:03:43 2018 -0700
hv\_netvsc: fix schedule in RCU context
[ Upstream commit 018349d70f28a78d5343b3660cb66e1667005f8a ]
When netvsc device is removed it can call reschedule in RCU context.
This happens because canceling the subchannel setup work could (in theory)
cause a reschedule when manipulating the timer.
To reproduce, run with lockdep enabled kernel and unbind
a network device from hv\_netvsc (via sysfs).
[ 160.682011] WARNING: suspicious RCU usage
[ 160.707466] 4.19.0-rc3-uio+ #2 Not tainted
[ 160.709937] -----------------------------
[ 160.712352] ./include/linux/rcupdate.h:302 Illegal context switch in RCU read-side critical section!
[ 160.723691]
[ 160.723691] other info that might help us debug this:
[ 160.723691]
[ 160.730955]
[ 160.730955] rcu\_scheduler\_active = 2, debug\_locks = 1
[ 160.762813] 5 locks held by rebind-eth.sh/1812:
[ 160.766851] #0: 000000008befa37a (sb\_writers#6){.+.+}, at: vfs\_write+0x184/0x1b0
[ 160.773416] #1: 00000000b097f236 (&of->mutex){+.+.}, at: kernfs\_fop\_write+0xe2/0x1a0
[ 160.783766] #2: 0000000041ee6889 (kn->count#3){++++}, at: kernfs\_fop\_write+0xeb/0x1a0
[ 160.787465] #3: 0000000056d92a74 (&dev->mutex){....}, at: device\_release\_driver\_internal+0x39/0x250
[ 160.816987] #4: 0000000030f6031e (rcu\_read\_lock){....}, at: netvsc\_remove+0x1e/0x250 [hv\_netvsc]
[ 160.828629]
[ 160.828629] stack backtrace:
[ 160.831966] CPU: 1 PID: 1812 Comm: rebind-eth.sh Not tainted 4.19.0-rc3-uio+ #2
[ 160.832952] Hardware name: Microsoft Corporation Virtual Machine/Virtual Machine, BIOS Hyper-V UEFI Release v1.0 11/26/2012
[ 160.832952] Call Trace:
[ 160.832952] dump\_stack+0x85/0xcb
[ 160.832952] \_\_\_might\_sleep+0x1a3/0x240
[ 160.832952] \_\_flush\_work+0x57/0x2e0
[ 160.832952] ? \_\_mutex\_lock+0x83/0x990
[ 160.832952] ? \_\_kernfs\_remove+0x24f/0x2e0
[ 160.832952] ? \_\_kernfs\_remove+0x1b2/0x2e0
[ 160.832952] ? mark\_held\_locks+0x50/0x80
[ 160.832952] ? get\_work\_pool+0x90/0x90
[ 160.832952] \_\_cancel\_work\_timer+0x13c/0x1e0
[ 160.832952] ? netvsc\_remove+0x1e/0x250 [hv\_netvsc]
[ 160.832952] ? \_\_lock\_is\_held+0x55/0x90
[ 160.832952] netvsc\_remove+0x9a/0x250 [hv\_netvsc]
[ 160.832952] vmbus\_remove+0x26/0x30
[ 160.832952] device\_release\_driver\_internal+0x18a/0x250
[ 160.832952] unbind\_store+0xb4/0x180
[ 160.832952] kernfs\_fop\_write+0x113/0x1a0
[ 160.832952] \_\_vfs\_write+0x36/0x1a0
[ 160.832952] ? rcu\_read\_lock\_sched\_held+0x6b/0x80
[ 160.832952] ? rcu\_sync\_lockdep\_assert+0x2e/0x60
[ 160.832952] ? \_\_sb\_start\_write+0x141/0x1a0
[ 160.832952] ? vfs\_write+0x184/0x1b0
[ 160.832952] vfs\_write+0xbe/0x1b0
[ 160.832952] ksys\_write+0x55/0xc0
[ 160.832952] do\_syscall\_64+0x60/0x1b0
[ 160.832952] entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
[ 160.832952] RIP: 0033:0x7fe48f4c8154
Resolve this by getting RTNL earlier. This is safe because the subchannel
work queue does trylock on RTNL and will detect the race.
Fixes: 7b2ee50c0cd5 ("hv\_netvsc: common detach logic")
Signed-off-by: Stephen Hemminger
Reviewed-by: Haiyang Zhang
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 9f2489640a57d2a8287bbb86edadd539a638b9f3
Author: Davide Caratti
Date: Fri Sep 14 12:03:18 2018 +0200
net/sched: act\_sample: fix NULL dereference in the data path
[ Upstream commit 34043d250f51368f214aed7f54c2dc29c819a8c7 ]
Matteo reported the following splat, testing the datapath of TC 'sample':
BUG: KASAN: null-ptr-deref in tcf\_sample\_act+0xc4/0x310
Read of size 8 at addr 0000000000000000 by task nc/433
CPU: 0 PID: 433 Comm: nc Not tainted 4.19.0-rc3-kvm #17
Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS ?-20180531\_142017-buildhw-08.phx2.fedoraproject.org-1.fc28 04/01/2014
Call Trace:
kasan\_report.cold.6+0x6c/0x2fa
tcf\_sample\_act+0xc4/0x310
? dev\_hard\_start\_xmit+0x117/0x180
tcf\_action\_exec+0xa3/0x160
tcf\_classify+0xdd/0x1d0
htb\_enqueue+0x18e/0x6b0
? deref\_stack\_reg+0x7a/0xb0
? htb\_delete+0x4b0/0x4b0
? unwind\_next\_frame+0x819/0x8f0
? entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
\_\_dev\_queue\_xmit+0x722/0xca0
? unwind\_get\_return\_address\_ptr+0x50/0x50
? netdev\_pick\_tx+0xe0/0xe0
? save\_stack+0x8c/0xb0
? kasan\_kmalloc+0xbe/0xd0
? \_\_kmalloc\_track\_caller+0xe4/0x1c0
? \_\_kmalloc\_reserve.isra.45+0x24/0x70
? \_\_alloc\_skb+0xdd/0x2e0
? sk\_stream\_alloc\_skb+0x91/0x3b0
? tcp\_sendmsg\_locked+0x71b/0x15a0
? tcp\_sendmsg+0x22/0x40
? \_\_sys\_sendto+0x1b0/0x250
? \_\_x64\_sys\_sendto+0x6f/0x80
? do\_syscall\_64+0x5d/0x150
? entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
? \_\_sys\_sendto+0x1b0/0x250
? \_\_x64\_sys\_sendto+0x6f/0x80
? do\_syscall\_64+0x5d/0x150
? entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
ip\_finish\_output2+0x495/0x590
? ip\_copy\_metadata+0x2e0/0x2e0
? skb\_gso\_validate\_network\_len+0x6f/0x110
? ip\_finish\_output+0x174/0x280
\_\_tcp\_transmit\_skb+0xb17/0x12b0
? \_\_tcp\_select\_window+0x380/0x380
tcp\_write\_xmit+0x913/0x1de0
? \_\_sk\_mem\_schedule+0x50/0x80
tcp\_sendmsg\_locked+0x49d/0x15a0
? tcp\_rcv\_established+0x8da/0xa30
? tcp\_set\_state+0x220/0x220
? clear\_user+0x1f/0x50
? iov\_iter\_zero+0x1ae/0x590
? \_\_fget\_light+0xa0/0xe0
tcp\_sendmsg+0x22/0x40
\_\_sys\_sendto+0x1b0/0x250
? \_\_ia32\_sys\_getpeername+0x40/0x40
? \_copy\_to\_user+0x58/0x70
? poll\_select\_copy\_remaining+0x176/0x200
? \_\_pollwait+0x1c0/0x1c0
? ktime\_get\_ts64+0x11f/0x140
? kern\_select+0x108/0x150
? core\_sys\_select+0x360/0x360
? vfs\_read+0x127/0x150
? kernel\_write+0x90/0x90
\_\_x64\_sys\_sendto+0x6f/0x80
do\_syscall\_64+0x5d/0x150
entry\_SYSCALL\_64\_after\_hwframe+0x44/0xa9
RIP: 0033:0x7fefef2b129d
Code: ff ff ff ff eb b6 0f 1f 80 00 00 00 00 48 8d 05 51 37 0c 00 41 89 ca 8b 00 85 c0 75 20 45 31 c9 45 31 c0 b8 2c 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 6b f3 c3 66 0f 1f 84 00 00 00 00 00 41 56 41
RSP: 002b:00007fff2f5350c8 EFLAGS: 00000246 ORIG\_RAX: 000000000000002c
RAX: ffffffffffffffda RBX: 000056118d60c120 RCX: 00007fefef2b129d
RDX: 0000000000002000 RSI: 000056118d629320 RDI: 0000000000000003
RBP: 000056118d530370 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 0000000000002000
R13: 000056118d5c2a10 R14: 000056118d5c2a10 R15: 000056118d5303b8
tcf\_sample\_act() tried to update its per-cpu stats, but tcf\_sample\_init()
forgot to allocate them, because tcf\_idr\_create() was called with a wrong
value of 'cpustats'. Setting it to true proved to fix the reported crash.
Reported-by: Matteo Croce
Fixes: 65a206c01e8e ("net/sched: Change act\_api and act\_xxx modules to use IDR")
Fixes: 5c5670fae430 ("net/sched: Introduce sample tc action")
Tested-by: Matteo Croce
Signed-off-by: Davide Caratti
Acked-by: Jiri Pirko
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 1708cc7ed059ec42e789bb1cc2551fbe2ece555d
Author: Paolo Abeni
Date: Thu Sep 13 16:27:21 2018 +0200
udp6: add missing checks on edumux packet processing
[ Upstream commit eb63f2964dbe36f26deac77d3016791675821ded ]
Currently the UDPv6 early demux rx code path lacks some mandatory
checks, already implemented into the normal RX code path - namely
the checksum conversion and no\_check6\_rx check.
Similar to the previous commit, we move the common processing to
an UDPv6 specific helper and call it from both edemux code path
and normal code path. In respect to the UDPv4, we need to add an
explicit check for non zero csum according to no\_check6\_rx value.
Reported-by: Jianlin Shi
Suggested-by: Xin Long
Fixes: c9f2c1ae123a ("udp6: fix socket leak on early demux")
Fixes: 2abb7cdc0dc8 ("udp: Add support for doing checksum unnecessary conversion")
Signed-off-by: Paolo Abeni
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c0d10c5d5d715355923b7577939870672b7bc03a
Author: Vasily Khoruzhick
Date: Thu Sep 13 11:12:03 2018 -0700
neighbour: confirm neigh entries when ARP packet is received
[ Upstream commit f0e0d04413fcce9bc76388839099aee93cd0d33b ]
Update 'confirmed' timestamp when ARP packet is received. It shouldn't
affect locktime logic and anyway entry can be confirmed by any higher-layer
protocol. Thus it makes sense to confirm it when ARP packet is received.
Fixes: 77d7123342dc ("neighbour: update neigh timestamps iff update is effective")
Signed-off-by: Vasily Khoruzhick
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 77971ea816ba7eee08f1c98474ef3fe05c78a4ea
Author: Sabrina Dubroca
Date: Wed Sep 12 17:44:43 2018 +0200
tls: clear key material from kernel memory when do\_tls\_setsockopt\_conf fails
[ Upstream commit c844eb46b7d43c2cf760169df5ae1d5b033af338 ]
Fixes: 3c4d7559159b ("tls: kernel TLS support")
Signed-off-by: Sabrina Dubroca
Signed-off-by: Sabrina Dubroca
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 13d1bdc70bc25de0f5a31988776bdbe90745a4cd
Author: Sabrina Dubroca
Date: Wed Sep 12 17:44:42 2018 +0200
tls: zero the crypto information from tls\_context before freeing
[ Upstream commit 86029d10af18381814881d6cce2dd6872163b59f ]
This contains key material in crypto\_send\_aes\_gcm\_128 and
crypto\_recv\_aes\_gcm\_128.
Introduce union tls\_crypto\_context, and replace the two identical
unions directly embedded in struct tls\_context with it. We can then
use this union to clean up the memory in the new tls\_ctx\_free()
function.
Fixes: 3c4d7559159b ("tls: kernel TLS support")
Signed-off-by: Sabrina Dubroca
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d8e6fc73d2ebec80de775cf77e80f777e6334bdb
Author: Sabrina Dubroca
Date: Wed Sep 12 17:44:41 2018 +0200
tls: don't copy the key out of tls12\_crypto\_info\_aes\_gcm\_128
[ Upstream commit 7cba09c6d5bc73ebbd25a353742d9ddb7a713b95 ]
There's no need to copy the key to an on-stack buffer before calling
crypto\_aead\_setkey().
Fixes: 3c4d7559159b ("tls: kernel TLS support")
Signed-off-by: Sabrina Dubroca
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6d7a3fd5cfaed3172b7dc4c2abf443fbf89650b0
Author: Paolo Abeni
Date: Thu Sep 13 16:27:20 2018 +0200
udp4: fix IP\_CMSG\_CHECKSUM for connected sockets
[ Upstream commit 2b5a921740a55c00223a797d075b9c77c42cb171 ]
commit 2abb7cdc0dc8 ("udp: Add support for doing checksum
unnecessary conversion") left out the early demux path for
connected sockets. As a result IP\_CMSG\_CHECKSUM gives wrong
values for such socket when GRO is not enabled/available.
This change addresses the issue by moving the csum conversion to a
common helper and using such helper in both the default and the
early demux rx path.
Fixes: 2abb7cdc0dc8 ("udp: Add support for doing checksum unnecessary conversion")
Signed-off-by: Paolo Abeni
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit a02ff7df6a3b4caf7cf9dfb7814a70c62642af9b
Author: BjÃ¸rn Mork
Date: Mon Sep 17 22:00:24 2018 +0200
qmi\_wwan: set DTR for modems in forced USB2 mode
[ Upstream commit 922005c7f50e7f4b2a6dbc182e9c575b4f92396b ]
Recent firmware revisions have added the ability to force
these modems to USB2 mode, hiding their SuperSpeed
capabilities from the host. The driver has been using the
SuperSpeed capability, as shown by the bcdUSB field of the
device descriptor, to detect the need to enable the DTR
quirk. This method fails when the modems are forced to
USB2 mode by the modem firmware.
Fix by unconditionally enabling the DTR quirk for the
affected device IDs.
Reported-by: Fred Veldini
Reported-by: Deshu Wen
Signed-off-by: BjÃ¸rn Mork
Reported-by: Fred Veldini
Reported-by: Deshu Wen
Signed-off-by: BjÃ¸rn Mork
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 89721b836972c366dbe670d7867c8b838d7039e7
Author: Guillaume Nault
Date: Fri Sep 14 16:28:05 2018 +0200
pppoe: fix reception of frames with no mac header
[ Upstream commit 8540827ebac6b654ab2f69c8fbce9e4fbd6304a0 ]
pppoe\_rcv() needs to look back at the Ethernet header in order to
lookup the PPPoE session. Therefore we need to ensure that the mac
header is big enough to contain an Ethernet header. Otherwise
eth\_hdr(skb)->h\_source might access invalid data.
==================================================================
BUG: KMSAN: uninit-value in \_\_get\_item drivers/net/ppp/pppoe.c:172 [inline]
BUG: KMSAN: uninit-value in get\_item drivers/net/ppp/pppoe.c:236 [inline]
BUG: KMSAN: uninit-value in pppoe\_rcv+0xcef/0x10e0 drivers/net/ppp/pppoe.c:450
CPU: 0 PID: 4543 Comm: syz-executor355 Not tainted 4.16.0+ #87
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google
01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:683
\_\_get\_item drivers/net/ppp/pppoe.c:172 [inline]
get\_item drivers/net/ppp/pppoe.c:236 [inline]
pppoe\_rcv+0xcef/0x10e0 drivers/net/ppp/pppoe.c:450
\_\_netif\_receive\_skb\_core+0x47df/0x4a90 net/core/dev.c:4562
\_\_netif\_receive\_skb net/core/dev.c:4627 [inline]
netif\_receive\_skb\_internal+0x49d/0x630 net/core/dev.c:4701
netif\_receive\_skb+0x230/0x240 net/core/dev.c:4725
tun\_rx\_batched drivers/net/tun.c:1555 [inline]
tun\_get\_user+0x740f/0x7c60 drivers/net/tun.c:1962
tun\_chr\_write\_iter+0x1d4/0x330 drivers/net/tun.c:1990
call\_write\_iter include/linux/fs.h:1782 [inline]
new\_sync\_write fs/read\_write.c:469 [inline]
\_\_vfs\_write+0x7fb/0x9f0 fs/read\_write.c:482
vfs\_write+0x463/0x8d0 fs/read\_write.c:544
SYSC\_write+0x172/0x360 fs/read\_write.c:589
SyS\_write+0x55/0x80 fs/read\_write.c:581
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
RIP: 0033:0x4447c9
RSP: 002b:00007fff64c8fc28 EFLAGS: 00000297 ORIG\_RAX: 0000000000000001
RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00000000004447c9
RDX: 000000000000fd87 RSI: 0000000020000600 RDI: 0000000000000004
RBP: 00000000006cf018 R08: 00007fff64c8fda8 R09: 00007fff00006bda
R10: 0000000000005fe7 R11: 0000000000000297 R12: 00000000004020d0
R13: 0000000000402160 R14: 0000000000000000 R15: 0000000000000000
Uninit was created at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_internal\_poison\_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188
kmsan\_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314
kmsan\_slab\_alloc+0x11/0x20 mm/kmsan/kmsan.c:321
slab\_post\_alloc\_hook mm/slab.h:445 [inline]
slab\_alloc\_node mm/slub.c:2737 [inline]
\_\_kmalloc\_node\_track\_caller+0xaed/0x11c0 mm/slub.c:4369
\_\_kmalloc\_reserve net/core/skbuff.c:138 [inline]
\_\_alloc\_skb+0x2cf/0x9f0 net/core/skbuff.c:206
alloc\_skb include/linux/skbuff.h:984 [inline]
alloc\_skb\_with\_frags+0x1d4/0xb20 net/core/skbuff.c:5234
sock\_alloc\_send\_pskb+0xb56/0x1190 net/core/sock.c:2085
tun\_alloc\_skb drivers/net/tun.c:1532 [inline]
tun\_get\_user+0x2242/0x7c60 drivers/net/tun.c:1829
tun\_chr\_write\_iter+0x1d4/0x330 drivers/net/tun.c:1990
call\_write\_iter include/linux/fs.h:1782 [inline]
new\_sync\_write fs/read\_write.c:469 [inline]
\_\_vfs\_write+0x7fb/0x9f0 fs/read\_write.c:482
vfs\_write+0x463/0x8d0 fs/read\_write.c:544
SYSC\_write+0x172/0x360 fs/read\_write.c:589
SyS\_write+0x55/0x80 fs/read\_write.c:581
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
==================================================================
Fixes: 224cf5ad14c0 ("ppp: Move the PPP drivers")
Reported-by: syzbot+f5f6080811c849739212@syzkaller.appspotmail.com
Signed-off-by: Guillaume Nault
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit b411479d52680db884ae55bfce5a78303fdf4449
Author: Colin Ian King
Date: Fri Sep 14 17:39:53 2018 +0100
net: hp100: fix always-true check for link up state
[ Upstream commit a7f38002fb69b44f8fc622ecb838665d0b8666af ]
The operation ~(p100\_inb(VG\_LAN\_CFG\_1) & HP100\_LINK\_UP) returns a value
that is always non-zero and hence the wait for the link to drop always
terminates prematurely. Fix this by using a logical not operator instead
of a bitwise complement. This issue has been in the driver since
pre-2.6.12-rc2.
Detected by CoverityScan, CID#114157 ("Logical vs. bitwise operator")
Signed-off-by: Colin Ian King
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6a9c934f04e6e6351742eb68a6899b964e1d01b5
Author: Willy Tarreau
Date: Wed Sep 12 07:36:35 2018 +0200
net/appletalk: fix minor pointer leak to userspace in SIOCFINDIPDDPRT
[ Upstream commit 9824dfae5741275473a23a7ed5756c7b6efacc9d ]
Fields ->dev and ->next of struct ipddp\_route may be copied to
userspace on the SIOCFINDIPDDPRT ioctl. This is only accessible
to CAP\_NET\_ADMIN though. Let's manually copy the relevant fields
instead of using memcpy().
BugLink: http://blog.infosectcbr.com.au/2018/09/linux-kernel-infoleaks.html
Cc: Jann Horn
Signed-off-by: Willy Tarreau
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6b4d14c57381cc142bb5ff0072c4ecf338513bf1
Author: Eric Dumazet
Date: Fri Sep 14 12:02:31 2018 -0700
ipv6: fix possible use-after-free in ip6\_xmit()
[ Upstream commit bbd6528d28c1b8e80832b3b018ec402b6f5c3215 ]
In the unlikely case ip6\_xmit() has to call skb\_realloc\_headroom(),
we need to call skb\_set\_owner\_w() before consuming original skb,
otherwise we risk a use-after-free.
Bring IPv6 in line with what we do in IPv4 to fix this.
Fixes: 1da177e4c3f41 ("Linux-2.6.12-rc2")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 288942f4a669c9121d4afd6ec6784a53a484feb1
Author: Toke HÃ¸iland-JÃ¸rgensen
Date: Thu Sep 13 16:43:07 2018 +0200
gso\_segment: Reset skb->mac\_len after modifying network header
[ Upstream commit c56cae23c6b167acc68043c683c4573b80cbcc2c ]
When splitting a GSO segment that consists of encapsulated packets, the
skb->mac\_len of the segments can end up being set wrong, causing packet
drops in particular when using act\_mirred and ifb interfaces in
combination with a qdisc that splits GSO packets.
This happens because at the time skb\_segment() is called, network\_header
will point to the inner header, throwing off the calculation in
skb\_reset\_mac\_len(). The network\_header is subsequently adjust by the
outer IP gso\_segment handlers, but they don't set the mac\_len.
Fix this by adding skb\_reset\_mac\_len() calls to both the IPv4 and IPv6
gso\_segment handlers, after they modify the network\_header.
Many thanks to Eric Dumazet for his help in identifying the cause of
the bug.
Acked-by: Dave Taht
Reviewed-by: Eric Dumazet
Signed-off-by: Toke HÃ¸iland-JÃ¸rgensen
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman

