=== Content from research.checkpoint.com_f8eccaa3_20250125_174843.html ===

[![](https://research.checkpoint.com/wp-content/uploads/2024/06/CPR-by-Check-Point-logo.svg)](https://research.checkpoint.com)

* [CONTACT US](https://research.checkpoint.com/contact/)
* [DISCLOSURE POLICY](https://research.checkpoint.com/disclosure-policy/)
* [CHECKPOINT.COM](https://www.checkpoint.com/)
* [UNDER ATTACK?](https://www.checkpoint.com/about-us/contact-incident-response/)

[![](https://research.checkpoint.com/wp-content/uploads/2024/06/CPR-by-Check-Point-logo.svg)](https://research.checkpoint.com)

* [Latest Publications](https://research.checkpoint.com/latest-publications/)
* [CPR Podcast Channel](https://research.checkpoint.com/cpr-podcast-channel/)
* [Web 3.0 Security](https://research.checkpoint.com/category/web3/)
* [Intelligence Reports](https://research.checkpoint.com/intelligence-reports/)
* Resources
  + [ThreatCloud AI](https://www.checkpoint.com/ai/)
  + [Threat Intelligence & Research](https://www.checkpoint.com/solutions/threat-intelligence-research/)
  + [Zero Day Protection](https://www.checkpoint.com/infinity/zero-day-protection/)
  + [Sandblast File Analysis](http://threatemulation.checkpoint.com/)
* [About Us](https://research.checkpoint.com/about-us/)
* [SUBSCRIBE](https://research.checkpoint.com/subscription/)

SUBSCRIBE

## CATEGORIES

* [Android Malware
  23](https://research.checkpoint.com/category/android-malware/)
* [Artificial Intelligence
  4](https://research.checkpoint.com/category/artificial-intelligence-2/)
* [ChatGPT
  3](https://research.checkpoint.com/category/chatgpt/)
* [Check Point Research Publications
  396](https://research.checkpoint.com/category/threat-research/)
* [Cloud Security
  1](https://research.checkpoint.com/category/cloud-security/)
* [CPRadio
  44](https://research.checkpoint.com/category/cpradio/)
* [Crypto
  2](https://research.checkpoint.com/category/crypto/)
* [Data & Threat Intelligence
  1](https://research.checkpoint.com/category/data-threat-intelligence/)
* [Data Analysis
  0](https://research.checkpoint.com/category/data-analysis/)
* [Demos
  22](https://research.checkpoint.com/category/demos/)
* [Global Cyber Attack Reports
  339](https://research.checkpoint.com/category/threat-intelligence-reports/)
* [How To Guides
  13](https://research.checkpoint.com/category/how-to-guides/)
* [Ransomware
  2](https://research.checkpoint.com/category/ransomware/)
* [Russo-Ukrainian War
  1](https://research.checkpoint.com/category/russo-ukrainian-war/)
* [Security Report
  1](https://research.checkpoint.com/category/security-report/)
* [Threat and data analysis
  0](https://research.checkpoint.com/category/threat-and-data-analysis/)
* [Threat Research
  172](https://research.checkpoint.com/category/threat-research-2/)
* [Web 3.0 Security
  9](https://research.checkpoint.com/category/web3/)
* [Wipers
  0](https://research.checkpoint.com/category/wipers/)

![](https://research.checkpoint.com/wp-content/uploads/2019/02/WinRAR_1021x580.jpg)

# Extracting a 19 Year Old Code Execution from WinRAR

February 20, 2019

https://research.checkpoint.com/2019/extracting-code-execution-from-winrar/

**Research by:** Nadav Grossman

#### **Introduction**

In this article, we tell the story of how we found a logical bug using the [WinAFL fuzzer](https://github.com/googleprojectzero/winafl) and exploited it in [WinRAR](https://www.win-rar.com/start.html?&L=0) to gain full control over a victim’s computer. The exploit works by just extracting an archive, and puts over [500 million users](https://www.win-rar.com/start.html?&L=0) at risk. This vulnerability has existed for over 19 years(!) and forced WinRAR to completely drop support for the vulnerable format.

#### **Background**

A few months ago, our team built a multi-processor fuzzing lab and started to fuzz binaries for Windows environments using the WinAFL fuzzer. After the good results we got from our [Adobe Research](https://research.checkpoint.com/50-adobe-cves-in-50-days/), we decided to expand our fuzzing efforts and started to fuzz WinRAR too.

One of the crashes produced by the fuzzer led us to an old, dated dynamic link library (dll) that was compiled back in 2006 without a protection mechanism (like ASLR, DEP, etc.) and is used by WinRAR.

We turned our focus and fuzzer to this “low hanging fruit” dll, and looked for a memory corruption bug that would hopefully lead to Remote Code Execution.

However, the fuzzer produced a test case with “weird” behavior. After researching this behavior, we found a logical bug: Absolute Path Traversal. From this point on it was simple to leverage this vulnerability to a remote code execution.

Perhaps it’s also worth mentioning that a substantial amount of money in various bug bounty programs is offered for these types of vulnerabilities.

[![](/wp-content/uploads/2019/02/fig1.png)**Figure 1:** Zerodium tweet on purchasing WinRAR vulnerability.](/wp-content/uploads/2019/02/fig1.png)

##### **What is WinRAR?**

WinRAR is a trialware file archiver utility for Windows which can create and view archives in RAR or ZIP file formats and unpack numerous archive file formats.

According to the [WinRAR website](https://www.win-rar.com/start.html?&L=0), over 500 million users worldwide make WinRAR the world’s most popular compression tool today.

This is what the GUI looks like:

[![](/wp-content/uploads/2019/02/fig2.png)](/wp-content/uploads/2019/02/fig2.png)

**Figure 2**: WinRAR GUI.

##### **The Fuzzing Process Background**

These are the steps taken to start fuzzing WinRAR:

1. Creation of an internal harness inside the WinRAR main function which enables us to fuzz any archive type, without stitching a specific harness for each format. This is done by patching the WinRAR executable.
2. Eliminate GUI elements such as message boxes and dialogs which require user interaction. This is also done by patching the WinRAR executable.

   There are some message boxes that pop up even in CLI mode of WinRAR.
3. Use a giant corpus from an interesting piece of research conducted around 2005 by the University of [Oulu](https://www.ee.oulu.fi/roles/ouspg/PROTOS_Test-Suite_c10-archive).
4. Fuzz the program with WinAFL using WinRAR command line switches. These force WinRAR to parse the “broken archive” and also set default passwords (“-p” for password and “-kb” for keep broken extracted files). We found those options in a WinRAR manual/help file.

After a short time of fuzzing, we found several crashes in the extraction of several archive formats such as RAR, LZH and ACE that were caused by a memory corruption vulnerability such as Out-of-Bounds Write. The exploitation of these vulnerabilities, though, is not trivial because the primitives supplied limited control over the overwritten buffer.

However, a crash related to the parsing of the ACE format caught our eye. We found that WinRAR uses a dll named `unacev2.dll` for parsing ACE archives. A quick look at this dll revealed that it’s an old dated dll compiled in 2006 without a protection mechanism. In the end, it turned out that we didn’t even need to bypass them.

##### **Build a Specific Harness**

We decided to focus on this dll because it looked like it would be quick and easy to exploit.

Also, as far as WinRAR is concerned, as long as the archive file has a *.rar* extension, it would handle it according to the file’s magic bytes, in our case – the ACE format.

To improve the fuzzer performance, and to increase the coverage only on the relevant dll, we created a specific harness for `unacev2.dll` .

To do that, we need to understand how `unacev2.dll` is used. After reverse engineering the code calling `unacev2.dll` for ACE archive extraction, we found that two exported functions should be called for extraction in the following order:

1. An initialization function named `ACEInitDll`, with the following signature:

   `INT __stdcall ACEInitDll(unknown_struct_1 *struct_1);`

   • struct\_1: pointer to an unknown struct
2. An extraction function named `ACEExtract` , with the following signature:

   `INT __stdcall ACEExtract(LPSTR ArchiveName, unknown_struct_2 *struct_2);`•`ArchiveName`: string pointer to the path to the ace file to be extracted

   •`struct_2`: pointer to an unknown struct

Both of these functions required structs that are unknown to us. We had two options to try to understand the unknown struct: reversing and debugging WinRAR, or trying to find an open source project that uses those structs.

The first option is more time consuming, so we opted to try the second one. We searched github.com for the exported function `ACEInitDll`

and found a project named [FarManager](https://github.com/FarGroup/FarManager) that uses this dll and includes a detailed header file for the unknown structs.

**Note:** The creator of this project is also the creator of WinRAR.

After loading the header files to IDA, it was much easier to understand the previously “unknown structs” to both functions (`ACEInitDll` and `ACEExtract` ),  as IDA displayed the correct name and type for each struct member.

From the headers we found in the FarManager project, we came up with the following signature:

`INT __stdcall ACEInitDll([pACEInitDllStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/UNACEFNC.H#LC90) DllData);`

`INT __stdcall ACEExtract(LPSTR ArchiveName, [pACEExtractStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/UNACEFNC.H#LC194) Extract);`

To mimic the way that WinRAR uses `unacev2.dll` , we assigned the same struct member just as WinRAR did.

We started to fuzz this specific harness, but we didn’t find new crashes and the coverage did not expand in the first few hours of the fuzzing. We tried to understand the reason for this limitation.

We started by looking for information about the ACE archive format.

##### **Understanding the ACE Format**

We didn’t find a RFC for that format, but we did find vital information over the internet.

1. Creating an ACE archive is protected by a patent. The only software that is allowed to create an ACE archive is [`WinACE`](https://web.archive.org/web/20170714193504/http%3A/winace.com%3A80/). The last version of this program was compiled in November 2007. The company’s website has been down since August 2017. However, extracting an ACE archive is not protected by a patent.

2. A pure Python project named [`acefile`](https://pypi.org/project/%3Ccode%3Eacefile%3C/code%3E%20/) is mentioned in this [Wikipedia page](https://en.wikipedia.org/wiki/ACE_%28compressed_file_format%29). Its most useful features are:

* It can extract an ACE archive.
* It contains a brief explanation about the ACE file format.
* It has a very helpful feature that prints the file format header with an explanation.

To understand the ACE file format, let’s create a simple `.txt` file (named “simple\_file.txt”), and compress it using `WinACE`. We will then check the headers of the ACE file using `acefile` .

This is **`simple_file.txt`**

[![](/wp-content/uploads/2019/02/fig3.png)](/wp-content/uploads/2019/02/fig3.png)

**Figure 3**: File before compression.

These are the options we selected in `WinACE`to create our example:

[![](/wp-content/uploads/2019/02/fig4.png)](/wp-content/uploads/2019/02/fig4.png)

**Figure 4**: WinACE compression GUI.

This option creates the subdirectories `\users\nadavgr\Documents` under the chosen extraction directory and extracts simple\_file.txt to that relative path.

**`simple_file.ace`**

[![](/wp-content/uploads/2019/02/fig5.png)](/wp-content/uploads/2019/02/fig5.png)

**Figure 5**: The simple\_file.ace produced using WinACE’s “store” compression option for visibility.

Running `acefile.py` from the [`acefile`](https://pypi.org/project/%3Ccode%3Eacefile%3C/code%3E%20/) project using headers flags displays information about the archive headers:

[![](/wp-content/uploads/2019/02/fig6.png)](/wp-content/uploads/2019/02/fig6.png)

**Figure 6**: Parsing ACE file header using acefile.py.

This results in:

[![](/wp-content/uploads/2019/02/fig7.png)](/wp-content/uploads/2019/02/fig7.png)

**Figure 7**: acefile.py header parsing output.

Notes:

* Consider each “\\” from the `filename` field in the image above as a single slash “\”, this is just python escaping.
* For clarity, the same fields are marked with the same color in the hex dump and in the output from`acefile`.

Summary of the important fields:

* **hdr\_crc (marked in pink):**Two CRC fields are present in 2 headers. If the CRC doesn’t match the data, the extraction

  is interrupted. This is the reason why the fuzzer didn’t find more paths (expand its coverage).To “solve” this issue we patched all the CRC\* checks in `unacev2.dll` .\***Note** – The CRC is a [modified implementation](https://github.com/droe/acefile/blob/master/acefile.py#LC868) of the regular [CRC-32](https://en.wikipedia.org/wiki/Cyclic_redundancy_check#CRC-32_algorithm).

* **filename (marked in green):**It contains the relative path to the file. All the directories specified in the relative path are created during the extracting process (including the file). The size of the `filename` is defined by 2 bytes (little endian) marked by a black frame in the hex dump.
* **advert (marked in yellow)**The advert field is automatically added by `WinACE`, during the creation of an ACE archive, if the archive is created using an unregistered version of `WinACE`.
* **file content:**
  + “`origsize` ” – The content’s size. The content itself is positioned after the header that defines the file (“hdr\_type” field == 1).
  + “`hdr_size` ” – The header size. Marked by a gray frame in the hex dump.
  + At offset 70 (0x46) from the second header, we can find our file content: “Hello From Check Point!”

Because the filename field contains the relative path to the file, we did some manual modification attempts to the field to see if it is vulnerable to “Path Traversal.”

For example, we added the trivial path traversal gadget “\..\” to the filename field and more complex “Path Traversal” tricks as well, but without success.

After patching all the structure checks, such as the CRC validation, we once again activated our fuzzer. After a short time of fuzzing, we entered the main fuzzing directory and found something odd. But let’s first describe our fuzzing machine for some necessary background.

#### **The Fuzzing Machine**

To increase the fuzzer performance and to prevent an I\O bottleneck, we used a RAM disk drive that uses the [ImDisk toolkit](https://sourceforge.net/projects/imdisk-toolkit/) on the fuzzing machine.

The Ram disk is mapped to drive **R:\**, and the folder tree looks like this:

[![](/wp-content/uploads/2019/02/fig8.png)](/wp-content/uploads/2019/02/fig8.png)

**Figure 8**: Fuzzer’s folders hierarchy

#### **Detecting the Path Traversal Bug**

A short time after starting the fuzzer, we found a new folder named sourbe in a surprising location, in the root of drive **R:\**

[![](/wp-content/uploads/2019/02/fig9-1024x528.png)](/wp-content/uploads/2019/02/fig9.png)

**Figure 9**: ”sourbe”, the unexpected folder which created during fuzzing.

The harness is instructed to extract the fuzzed archive to sub-directories under “output\_folders”. For example, `R:\ACE_FUZZER\output_folders\Slave_2\` . So why do we have a new folder created in the parent directory?

Inside the `sourbe` folder we found a file named `RED VERSION_¶` with the following content:

[![](/wp-content/uploads/2019/02/fig10.png)](/wp-content/uploads/2019/02/fig10.png)

**Figure 10**: Content of the file that produced by the fuzzer in the unexpected path “R:\sourbe\RED VERSION\_¶”.

This is the hex dump of the test case that triggers the vulnerability:

[![](/wp-content/uploads/2019/02/fig11.png)](/wp-content/uploads/2019/02/fig11.png)

**Figure 11**: A hex dump of the file that produced by the fuzzer in the unexpected path “R:\sourbe\RED VERSION\_¶”.

Notes:

* We made some minor changes to this test case, (such as adjusting the CRC) to make it parsable by `acefile`.
* For convenience, fields are marked with the same color in the hex dump and in

  the output from `acefile`.

[![](/wp-content/uploads/2019/02/fig12.png)](/wp-content/uploads/2019/02/fig12.png)

**Figure 12**: Header parsing output from acefile.py for the file that produced by the fuzzer in the unexpected path.

These are the first three things that we noticed when we looked at the hex dump and the output from `acefile`:

1. The fuzzer copied parts of the “advert” field to other fields:
   * The content of the compressed file is “SIO”, marked in an orange frame in the hex dump. It’s part of the advert string “\*UNREGISTERED VER**SIO**N\*”.
   * The filename field contain the string “RED VERSION\*” which is part of the advert string “\*UNREGISTE**RED VERSION\***”.
2. The path in the `filename` field was used in the extraction process as an “absolute path” instead of a relative path to the destination folder (the backslash is the root of the drive).
3. The extract file name is “RED VERSION\_¶”. It seems that the asterisk from the `filename` field was converted to an underscore and the \x14\ (0x14) value represented as “¶” in the extract file name. The other content of the `filename` field is ignored because there is a null char which terminates the string, after the \x14\ (0x14) value.

To find the constraints that caused it to ignore the destination folder and use the `filename` field as an absolute path during the extraction, we did the following attempts, based on our assumptions.

Our first assumption was the first character of the `filename` field (the ‘\’ char) triggers the vulnerability. Unfortunately, after a quick check we found out that this is not the case. After additional checks we arrived at these conclusions:

1. The first char should be a ‘/’ or a ‘\’.
2. ‘\*’ should be included in the `filename` at least once; the location doesn’t matter.

Example of a `filename` field that triggers the bug: `\some_folder\some_file*.exe` will be extracted to `C:\some_folder\some_file_.exe` , and the asterisk is converted to an underscore (\_).

Now that it worked on our fuzzing harness, it is time to test our crafted archive (e.g. exploit file) file on WinRAR.

#### **Trying the exploit on WinRAR**

At first glance, it looked like the exploit worked as expected on WinRAR, because the `sourbe` directory was created in the root of drive `C:\` . However, when we entered the “sourbe” folder (`C:\sourbe` ) we noticed that the file was **not** created.

These behaviors raised two questions:

* Why did the harness and WinRAR behave differently?
* Why were the directories that were specified in the exploit file created, and the extracted file was not created?

##### **Why did the harness and WinRAR behave differently?**

We expected that the exploit file would behave the same on WinRAR as it behaved in our harness, for the following reasons:

1. The dll (`unacev2.dll` ) extracts the files to the destination folder, and not the outer executable (WinRAR or our harness).
2. Our harness mimics WinRAR perfectly when passing parameters / struct members to the dll.

A deeper look showed that we had a false assumption in our second point. Our harness defines 4 callbacks pointers, and our implemented callbacks differ from WinRAR’s callbacks. Let’s return to our harness implementation.

We mentioned this signature when calling the exported function named `ACEInitDll`.

`INT __stdcall ACEInitDll([pACEInitDllStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/UNACEFNC.H#LC90) DllData);`

`[pACEInitDllStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/UNACEFNC.H#LC90)` is a pointer to the `[sACEInitDLLStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/UNACEFNC.H#LC90)` struct. The first member of this struct is `[tACEGlobalDataStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/STRUCS.H#LC189)`. This struct has many members, including pointers to callback functions with the following signature:

`INT (__stdcall *InfoCallbackProc) ([pACEInfoCallbackProcStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/STRUCS.H#LC73) Info);`

`INT (__stdcall *ErrorCallbackProc) ([pACEErrorCallbackProcStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/STRUCS.H#LC76) Error);`

`INT (__stdcall *RequestCallbackProc) ([pACERequestCallbackProcStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/STRUCS.H#LC79) Request);`

`INT (__stdcall *StateCallbackProc) ([pACEStateCallbackProcStruc](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/STRUCS.H#LC82) State);`

These callbacks are called by the dll (`unacev2.dll` ) during the extraction process.

The callbacks are used as external validators for operations that about to happen, such as the creation of a file, creation of a directory, overwriting a file, etc.

The external callback/validators get information about the operation that’s about to occur, for example, file extraction, and returns its decision to the dll.

If the operation is allowed, the following constant is returned to the dll: [`ACE_CALLBACK_RETURN_OK`](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/CALLBACK.H#LC110) Otherwise, if the operation is not allowed by the callback function, it returns the following constant: [`ACE_CALLBACK_RETURN_CANCEL`](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/CALLBACK.H#LC114), and the operation is aborted.

For more information about those callbacks function, see the [explanation](https://github.com/FarGroup/FarManager/blob/806c80dff3e182c1c043fad9078490a9bf962456/plugins/newarc.ex/Modules/ace/Include/ACE/includes/CALLBACK.H#LC22) from the [FarManager](https://github.com/FarGroup/FarManager/).

Our harness returned `ACE_CALLBACK_RETURN_OK`  for all the callback functions except for the `ErrorCallbackProc`, where it returned `ACE_CALLBACK_RETURN_CANCEL`.

It turns out, WinRAR does validation for the extracted `filename` (after they are extracted and created), and because of those validations in the WinRAR callback’s, the creation of the file was aborted. This means that after the file is created, it is deleted by WinRAR.

##### **WinRAR Validators / Callbacks**

This is part of the WinRAR callback’s validator pseudo-code that prevents the file creation:

[![](/wp-content/uploads/2019/02/fig13.png)](/wp-content/uploads/2019/02/fig13.png)

**Figure 13**: WinRAR validator/callback pseudo-code.

“`SourceFileName`” represents the **relative path** to the file that will be extracted.

The function does the following checks:

1. The first char does not equal “`\`” or “`/`”.
2. The File Name doesn’t start with the following strings “`..\`” or “`../`” which are gadgets for “Path Traversal”.
3. The following “Path Traversal” gadgets does not exist in the string:
   1. “`\..\`”
   2. “`\../`”
   3. “`/../`”
   4. “`/..\`”

The extraction function in `unacv2.dll` calls `StateCallbackProc` in WinRAR, and passes the `filename` field of the ACE format as the relative path to be extracted to.

The relative path is checked by the WinRAR callback’s validator. The validators return `ACE_CALLBACK_RETURN_CANCEL` to the dll, (because the `filename` field starts with backslash “\”) and the file creation is aborted.

The following string passes to the WinRAR callback’s validator:

“\sourbe\RED VERSION\_¶”

**Note**: This is the original filename with fields “\sourbe\RED VERSION\*¶”. “`unacev2.dll` ” replaces the “\*” with an underscore.

##### **Why were the folders that were specified in the exploit file created and the extracted file was not created?**

Because of a bug in the dll (“`unacev2.dll` ”), even if `ACE_CALLBACK_RETURN_CANCEL` returned from the callback, the folders specified in the relative path (`filename` field in ACE archive) will be created by the dll.

The reason for this is that `unacev2.dll` calls the external validator (callback) before the folder creation, but it checks the return value from the callbacks too late – after the creation of the folder. Therefore, it aborts the extraction operation just before writing content to the extracted file, before the call to [WriteFile](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-writefile) API.

It actually creates the extracted file, without writing content to it.  It calls to [CreateFile](https://docs.microsoft.com/en-us/windows/desktop/api/fileapi/nf-fileapi-createfilea) API

and then checks the return code from the callback function. If the return code is `ACE_CALLBACK_RETURN_CANCEL`, it actually deletes the file that previously created by the call to CreateFile API.

**Side Notes:**

* We found a way to bypass the deletion of the file, but it allows us to create empty files only. We can bypass the file deletion by adding “:” to the end of the file, which is treated as [Alternate Data Streams](https://blogs.technet.microsoft.com/askcore/2013/03/24/alternate-data-streams-in-ntfs/). If the callback returns `ACE_CALLBACK_RETURN_CANCEL`, dll tries to delete the Alternate Data Stream of the file instead of the file itself.
* There is another filter function in the dll code that **aborts** the extraction operation if the relative path string starts with “**\**” (slash)**.** This happens in the first extraction stages, before the calls to any other filter function.

  However, by adding **“\*”**or “**?**” characters (wildcard characters) to the relative path (filename field) of the compressed file, this check is skipped and the code flow can continue and (partially) trigger the Path Traversal vulnerability. This is why the exploit file which was produced by the fuzzer triggered the bug in our harness. It doesn’t trigger the bug in WinRAR because of the callback validator in the WinRAR code.

#### **Summary of Intermediate Findings**

* We found a Path Traversal vulnerability in `unacev2.dll` . It enables our harness to extract the file to an arbitrary path, and completely ignore the destination folder, and treats the extracted file relative path as the full path.
* Two constraints lead to the Path Traversal vulnerability (summarized in previous sections):

  1. The first char should be a ‘/’ or a ‘\’.

  2. ‘\*’ should be included in the `filename` at least once. The location does not matter.
* WinRAR is partially vulnerable to the Path Traversal:
  + `unacev2.dll` doesn’t abort the operation after getting the abort code from the WinRAR callback (`ACE_CALLBACK_RETURN_CANCEL`). Due to this delayed check of the return code from WinRAR callback, the directories specified in the exploit file are created.
  + The extracted file is created as well, on the full path specified in the exploit file (without content), but it is deleted right after checking the returned code from the callback (before the call to WriteFile API).
  + We found a way to bypass the deletion of the file, but it allows us to create empty files only.

#### **Finding the Root Cause**

At this point, we wanted to figure out why the destination folder is ignored, and the relative path of the archive files (`filename` field) is treated as the full path.

To achieve this goal, we could use static analysis and debugging, but we decided on a much quicker method. We used [DynamoRio](https://github.com/DynamoRIO/dynamorio) to record the code coverage in `unacev2.dll` of a regular ACE file and of our exploit file which triggered the bug. We then used the [lighthouse](https://github.com/gaasedelen/lighthouse) plugin for IDA and subtracted one coverage path from the other.

These are the results we got:

[![](/wp-content/uploads/2019/02/fig14.png)](/wp-content/uploads/2019/02/fig14.png)

**Figure 14**: Lighthouse’s coverage overview window. You can see the coverage subtraction in the “Composer” form, and one result highlighted in purple.

In the “Coverage Overview” window we can see a single result. This means there is only one basic block that was executed in the first attempt (marked in A) and wasn’t reached on the second attempt (marked in B).

The Lighthouse plugin marked the background of the diffed basic block in blue, as you can see in the image below.

[![](/wp-content/uploads/2019/02/fig15.png)](/wp-content/uploads/2019/02/fig15.png)

**Figure 15**: IDA graph view of the main bug in unacev2.dll. Lighthouse marked the background of the diffed basic block in blue.

From the code coverage results, you can understand that the exploit file is **not** going through the diffed basic block (marked in blue), but it takes the opposite basic block (the false condition, marked with a red arrow).

If the code flow goes through the false condition (red arrow) the line that is inside the green frame replaces the destination folder with `""` (empty string), and the later call to `sprintf` function, which concatenates the destination folder to the relative path of the extracted file.

The code flow to the true and false conditions, marked with green and red arrows respectively,

is influenced by the call to the function named `GetDevicePathLen` (inside the red frame).

If the result from the call to `GetDevicePathLen` equals 0, the `sprintf` looks like this:

`sprintf(final_file_path, "%s%s", destination_folder, file_relative_path);`

Otherwise:

`sprintf(final_file_path, "%s%s", "", file_relative_path);`

The last `sprintf` is the buggy code that triggers the Path Traversal vulnerability.

This means that the relative path will actually be treated as a fullpath to the file/directory that should be written/created.

Let’s look at **GetDevicePathLen** function to get a better understanding of the root cause:

[![](/wp-content/uploads/2019/02/fig16.png)](/wp-content/uploads/2019/02/fig16.png)

**Figure 16**: GetDevicePathLen code.

The relative path of the extracted file is passed to `GetDevicePathLen`.

It checks if the device or drive name prefix appears in the Path parameter, and returns the length of that string, like this:

* The function returns **3** for this path: `C:\some_folder\some_file.ext`
* The function returns **1** for this path: `\some_folder\some_file.ext`
* The function returns **15** for this path: `\\LOCALHOST\C$\some_folder\some_file.ext`
* The function returns **21** for this path: `\\?\Harddisk0Volume1\some_folder\some_file.ext`
* The function returns **0** for this path: `some_folder\some_file.ext`

If the return value from `GetDevicePathLen` is greater than 0, the relative path of the extracted file will be considered as the full path, because the destination folder is replaced by  an empty string during the call to `sprintf`, and this leads to Path Traversal vulnerability.

However, there is a function that “cleans” the relative path of the extract file, by omitting any sequences that are not allowed before the call to `GetDevicePathLen`**.**

This is a pseudo-code that cleans the path “**`CleanPath`”.**

[![](/wp-content/uploads/2019/02/fig17.png)](/wp-content/uploads/2019/02/fig17.png)

**Figure 17**: Pseudo-code of CleanPath.

The function omits trivial Path Traversal sequences like “`\..\`”  (it only omits the “`..\`” sequence if it is found in the beginning of the path)  sequence, and it omits drive sequence like: “`C:\`”**,** “`C:`”, and for an unknown reason, “`C:\C:`” as well.

Note that it doesn’t care about the first letter; the following sequence will be omitted as well: “`_:\`”, “`_:`”, “`_:\_:`” (In this case underscore represents any value).

#### **Putting It All Together**

To create an exploit file, which causes WinRAR to extract an archived file to an arbitrary path (Path Traversal),  extract to the [Startup Folder](https://support.microsoft.com/en-us/help/4026268/windows-10-change-startup-apps) (which gains code execution after reboot) instead of to the destination folder.

We should bypass two filter functions to trigger the bug.

To trigger the concatenation of an empty string to the relative path of the compressed file, instead of the destination folder:

`sprintf(final_file_path, "%s%s", "", file_relative_path);`

Instead of:

`sprintf(final_file_path, "%s%s", destination_folder, file_relative_path);`

The result from `GetDevicePathLen` function should be greater than 0.

It depends on the content of the relative path (“**file\_relative\_path”**). If the relative path starts the device path this way:

* **option 1**: `C:\some_folder\some_file.ext`
* **option 2**: `\some_folder\some_file.ext` (The first slash represents the current drive.)

The return value from `GetDevicePathLen` will be greater than 0.

However, there is a filter function in `unacev2.dll` named `CleanPath` (Figure 17) that checks if the relative path starts with **C:\** and removes it from the relative path string before the call to `GetDevicePathLen`.

It omits the “`C:\`” sequence from the **option 1** string but **doesn’t** omit “**\**” sequence from the **option 2** string.

To overcome this limitation, we can add to **option 1** another “`C:\`” sequence which will be omitted by `CleanPath` (Figure 17), and leave the relative path to the string as we wanted with one “`C:\`”,  like:

* **option 1’**: **`C:\C:\`**`some_folder\some_file.ext`  **=>**  **`C:\`**`some_folder\some_file.ext`

However, there is a callback function in WinRAR code (Figure 13), that is used as a validator/filter function. During the extraction process, `unacev2.dll` is called to the callback function that resides in the WinRAR code.

The callback function validates the relative path of the compressed file. If the blacklist sequence is found, the extraction operation will be aborted.

One of the checks that is made by the callback function is for the relative path that starts with “**\**” (slash).

But it doesn’t check for the  “`C:\`”**.** Therefore, we can use **option 1’** to **exploit the Path Traversal Vulnerability!**

We also found an **SMB attack vector**, which enables it to connect to an arbitrary IP address and create files and folders in arbitrary paths on the SMB server.

Example:

`C:\\\10.10.10.10\smb_folder_name\some_folder\some_file.ext` **=>**`\\10.10.10.10\smb_folder_name\some_folder\some_file.ext`

#### **Example of a Simple Exploit File**

We change the .ace extension to .rar extension, because WinRAR detects the format by the content of the file and not by the extension.

This is the output from `acefile`**:**

[![](/wp-content/uploads/2019/02/fig18.png)](/wp-content/uploads/2019/02/fig18.png)

**Figure 18**: Header output by acefile.py of the simple exploit file.

We trigger the vulnerability by the crafted string of the `filename` field (in green).

This archive will be extracted to `C:\some_folder\some_file.txt` no matter what the path of the destination folder is.

#### **Creating a Real Exploit**

We can gain code execution, by extracting a compressed executable file from the ACE archive to one of the [Startup Folders](https://support.microsoft.com/en-us/help/4026268/windows-10-change-startup-apps). Any files that reside in the Startup folders will be executed at boot time.

To craft an ACE archive that extracts its compressed files to the Startup folder seems to be trivial, but it’s not.

There are at least 2 Startup folders at the following paths:

1. `C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp`
2. `C:\Users\<user name>\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`

The first path of the Startup folder demands high privileges / high integrity level (in case the UAC is on). However, WinRAR runs by default with a medium integrity level.

The second path of the Startup folder demands to know the name of the user.

We can try to overcome it by creating an ACE archive with thousands of crafted compressed files, any one of which contains the path to the Startup folder but with different `<user name>`*,* and hope that it will work in our target.

#### **The Most Powerful Vector**

We have found a vector which allows us to extract a file to the Startup folder without caring about the `<user name>`**.**

By using the following `filename` field in the ACE archive:

**`C:\C:`**`C:../AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\some_file.exe`

It is translated to the following path by the `CleanPath` function (Figure 17):

`C:../AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\some_file.exe`

Because the `CleanPath` function removes the “**`C:\C:`** ” sequence**.**

Moreover, this destination folder will be ignored because the `GetDevicePathLen` function (Figure 16) will return 2 for the last “**C:**” sequence.

Let’s analyze the last path:

The sequence “`C:`” is translated by Windows to the “current directory” of the running process. In our case, it’s the current path of WinRAR.

If WinRAR is executed from its folder, the “current directory” will be this WinRAR folder: `C:\Program Files\WinRAR`

However, if WinRAR is executed by double clicking on an archive file or by right clicking on “extract” in the archive file, the “current directory” of WinRAR will be the path to the folder that the archive resides in.

[![](/wp-content/uploads/2019/02/fig19.png)](/wp-content/uploads/2019/02/fig19.png)

**Figure 19**: WinRAR’s extract options (WinRAR’s shell extension added to right click)

For example, if the archive resides in the user’s Downloads folder, the “current directory” of WinRAR will be:

`C:\Users\<user name>\Downloads`

If the archive resides in the Desktop folder, the “current directory” path will be:

`C:\Users\<user name>\Desktop`

To get from the Desktop or Downloads folder to the Startup folder, we should go back one folder  “`../`” to the “user folder”, and concatenate  the relative path to the startup directory: `AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\` to the following sequence: “`C:../`”

This is the end result:  `C:../AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\some_file.exe`

Remember that there are 2 checks against path traversal sequences:

* In the `CleanPath` function which skips such sequences.
* In WinRAR’s callback function which aborts the extraction operation.

`CleanPath` checks for the following path traversal pattern: “`\..\`”

The WinRAR’s callback function checks for the following patterns:

1. `“\..\”`
2. `“\../”`
3. `“/../”`
4. `“/..\”`

Because the first slash or backslash are not part of our sequence “`C:../`”, we can bypass the path traversal validation. However, we can only go back one folder. It’s all we need to extract a file to the Startup folder without knowing the user name.

**Note**: If we want to go back more than one folder, we should concatenate the following sequence “`/../`”. For example, “`C:../../`” and the “`/../`” sequence will be caught be the callback validator function and the extraction will be aborted.

### **Demonstration (POC)**

#### **Side Note**

Toward the end of our research, we discovered that `WinACE` created an extraction utility like `unacev2.dll` for linux which is called unace-nonfree (compiled using Watcom compiler). The source code is available.

The source code for Windows (which `unacev2.dll` was built from) is included as well, but it’s older than the last version of `unacev2.dll` , and can’t be compiled/built for Windows. In addition,  some functionality is missing in the source code – for example, the checks in Figure 17 are not included.

However, Figure 16 was taken from the source code.

We also found the Path Traversal bug in the source code. It looks like this:

[![](/wp-content/uploads/2019/02/fig20.png)](/wp-content/uploads/2019/02/fig20.png)

**Figure 20**:  The path traversal bug in the source code of unace-nonfree

---

**CVEs**:

CVE-2018-20250, CVE-2018-20251, CVE-2018-20252, CVE-2018-20253.

#### **WinRAR’s Response**

WinRAR decided to drop UNACEV2.dll from their package, and WinRAR doesn’t support ACE format from version number: “5.70 beta 1”.

Quote from [WinRAR website](https://www.win-rar.com/whatsnew.html?&L=0):

> ```
> “Nadav Grossman from Check Point Software Technologies informed us about a security vulnerability in UNACEV2.DLL library.
> Aforementioned vulnerability makes possible to create files in arbitrary folders inside or outside of destination folder
> when unpacking ACE archives.
> ```
> ```
> WinRAR used this third party library to unpack ACE archives.
> UNACEV2.DLL had not been updated since 2005 and we do not have access to its source code.
> So we decided to drop ACE archive format support to protect security of WinRAR users.
>
> We are thankful to Check Point Software Technologies for reporting  this issue.“
> ```

---

Check Point’s [SandBlast Agent](https://www.checkpoint.com/products/advanced-endpoint-protection/) Behavioral Guard protect against these threats.

Check Point’s [IPS blade](https://www.checkpoint.com/products/ips-software-blade/) provides protections against this threat: “RARLAB WinRAR ACE Format Input Validation Remote Code Execution (CVE-2018-20250)”

---

Many thanks to my colleagues **Eyal Itkin** ([@EyalItkin](https://twitter.com/eyalitkin?lang=en)) and **Omri Herscovici** ([@omriher](https://twitter.com/omriher?lang=en)) for their help in this research.

[![](https://research.checkpoint.com/wp-content/uploads/2022/10/back_arrow.svg)

GO UP](#single-post)

[BACK TO ALL POSTS](/latest-publications/)

## POPULAR POSTS

[![](https://research.checkpoint.com/wp-content/uploads/2023/01/AI-1059x529-copy.jpg)](https://research.checkpoint.com/2023/opwnai-cybercriminals-starting-to-use-chatgpt/)

* Artificial Intelligence
* ChatGPT
* Check Point Research Publications

[OPWNAI : Cybercriminals Starting to Use ChatGPT](https://research.checkpoint.com/2023/opwnai-cybercriminals-starting-to-use-chatgpt/)

[![](https://research.checkpoint.com/wp-content/uploads/2019/01/Fortnite_1021x580.jpg)](https://research.checkpoint.com/2019/hacking-fortnite/)

* Check Point Research Publications
* Threat Research

[Hacking Fortnite Accounts](https://research.checkpoint.com/2019/hacking-fortnite/)

[![](https://research.checkpoint.com/wp-content/uploads/2022/12/OpenAIchatGPT_header.jpg)](https://research.checkpoint.com/2022/opwnai-ai-that-can-save-the-day-or-hack-it-away/)

* Artificial Intelligence
* ChatGPT
* Check Point Research Publications

[OpwnAI: AI That Can Save the Day or HACK it Away](https://research.checkpoint.com/2022/opwnai-ai-that-can-save-the-day-or-hack-it-away/)

### BLOGS AND PUBLICATIONS

[![](https://research.checkpoint.com/wp-content/uploads/2020/02/CheckPointResearchTurkishRat_blog_header.jpg)](https://research.checkpoint.com/2020/the-turkish-rat-distributes-evolved-adwind-in-a-massive-ongoing-phishing-campaign/)

* Check Point Research Publications
* Global Cyber Attack Reports
* Threat Research

February 17, 2020
### “The Turkish Rat” Evolved Adwind in a Massive Ongoing Phishing Campaign

[![](https://research.checkpoint.com/wp-content/uploads/2017/08/WannaCry-Post-No-Image-1021x450.jpg)](https://research.checkpoint.com/2017/the-next-wannacry-vulnerability-is-here/)

* Check Point Research Publications

August 11, 2017
### “The Next WannaCry” Vulnerability is Here

[![](https://research.checkpoint.com/wp-content/uploads/2018/01/rubyminer.jpg)](https://research.checkpoint.com/2018/rubyminer-cryptominer-affects-30-ww-networks/)

* Check Point Research Publications

January 11, 2018
### ‘RubyMiner’ Cryptominer Affects 30% of WW Networks

[![](https://research.checkpoint.com/wp-content/uploads/2022/12/CheckPointResearchLogo_white-1-e1671590634727.png)](https://research.checkpoint.com)

* Publications
  + [Global cyber attack reports](/category/threat-intelligence-reports/)
  + [Research publications](/category/threat-research/)
  + [IPS advisories](https://advisories.checkpoint.com/advisories/)
  + [Check point blog](https://blog.checkpoint.com/)
  + [Demos](/category/demos/)
* Tools
  + [Sandblast file analysis](http://threatemulation.checkpoint.com/)
  + [ThreatCloud](https://www.checkpoint.com/infinity/threatcloud/)
  + [Threat Intelligence](https://www.checkpoint.com/solutions/threat-intelligence-research/)
  + [Zero day protection](https://www.checkpoint.com/infinity/zero-day-protection/)
  + [Live threat map](https://threatmap.checkpoint.com/)
* [About Us](https://research.checkpoint.com/about-us/)
  + [Contact Us](https://research.checkpoint.com/contact/)

### Let’s get in touch

Subscribe for cpr blogs, news and more

[Subscribe Now](/subscription/)

© 1994-2024 Check Point Software Technologies LTD. All rights reserved.

Property of [CheckPoint.com](https://www.checkpoint.com/)

[Privacy Policy](/privacy-policy/)

![](https://research.checkpoint.com/wp-content/uploads/2022/10/popup-side-image.jpg)

## SUBSCRIBE TO CYBER INTELLIGENCE REPORTS

First Name

Last Name

Country—Please choose an option—ChinaIndiaUnited StatesIndonesiaBrazilPakistanNigeriaBangladeshRussiaJapanMexicoPhilippinesVietnamEthiopiaEgyptGermanyIranTurkeyDemocratic Republic of the CongoThailandFranceUnited KingdomItalyBurmaSouth AfricaSouth KoreaColombiaSpainUkraineTanzaniaKenyaArgentinaAlgeriaPolandSudanUgandaCanadaIraqMoroccoPeruUzbekistanSaudi ArabiaMalaysiaVenezuelaNepalAfghanistanYemenNorth KoreaGhanaMozambiqueTaiwanAustraliaIvory CoastSyriaMadagascarAngolaCameroonSri LankaRomaniaBurkina FasoNigerKazakhstanNetherlandsChileMalawiEcuadorGuatemalaMaliCambodiaSenegalZambiaZimbabweChadSouth SudanBelgiumCubaTunisiaGuineaGreecePortugalRwandaCzech RepublicSomaliaHaitiBeninBurundiBoliviaHungarySwedenBelarusDominican RepublicAzerbaijanHondurasAustriaUnited Arab EmiratesIsraelSwitzerlandTajikistanBulgariaHong Kong (China)SerbiaPapua New GuineaParaguayLaosJordanEl SalvadorEritreaLibyaTogoSierra LeoneNicaraguaKyrgyzstanDenmarkFinlandSlovakiaSingaporeTurkmenistanNorwayLebanonCosta RicaCentral African RepublicIrelandGeorgiaNew ZealandRepublic of the CongoPalestineLiberiaCroatiaOmanBosnia and HerzegovinaPuerto RicoKuwaitMoldovMauritaniaPanamaUruguayArmeniaLithuaniaAlbaniaMongoliaJamaicaNamibiaLesothoQatarMacedoniaSloveniaBotswanaLatviaGambiaKosovoGuinea-BissauGabonEquatorial GuineaTrinidad and TobagoEstoniaMauritiusSwazilandBahrainTimor-LesteDjiboutiCyprusFijiReunion (France)GuyanaComorosBhutanMontenegroMacau (China)Solomon IslandsWestern SaharaLuxembourgSurinameCape VerdeMaltaGuadeloupe (France)Martinique (France)BruneiBahamasIcelandMaldivesBelizeBarbadosFrench Polynesia (France)VanuatuNew Caledonia (France)French Guiana (France)Mayotte (France)SamoaSao Tom and PrincipeSaint LuciaGuam (USA)Curacao (Netherlands)Saint Vincent and the GrenadinesKiribatiUnited States Virgin Islands (USA)GrenadaTongaAruba (Netherlands)Federated States of MicronesiaJersey (UK)SeychellesAntigua and BarbudaIsle of Man (UK)AndorraDominicaBermuda (UK)Guernsey (UK)Greenland (Denmark)Marshall IslandsAmerican Samoa (USA)Cayman Islands (UK)Saint Kitts and NevisNorthern Mariana Islands (USA)Faroe Islands (Denmark)Sint Maarten (Netherlands)Saint Martin (France)LiechtensteinMonacoSan MarinoTurks and Caicos Islands (UK)Gibraltar (UK)British Virgin Islands (UK)Aland Islands (Finland)Caribbean Netherlands (Netherlands)PalauCook Islands (NZ)Anguilla (UK)Wallis and Futuna (France)TuvaluNauruSaint Barthelemy (France)Saint Pierre and Miquelon (France)Montserrat (UK)Saint Helena, Ascension and Tristan da Cunha (UK)Svalbard and Jan Mayen (Norway)Falkland Islands (UK)Norfolk Island (Australia)Christmas Island (Australia)Niue (NZ)Tokelau (NZ)Vatican CityCocos (Keeling) Islands (Australia)Pitcairn Islands (UK)

Email

## We value your privacy!

BFSI uses cookies on this site. We use cookies to enable faster and easier experience for you. By continuing to visit this website you agree to our use of cookies.

ACCEPT
REJECT



=== Content from www.win-rar.com_f95cd942_20250125_174844.html ===


Hide Cookie Info!
×

We want you to have the best possible experience while using our service. Our website uses cookies to help improve your visit. By using this website, you consent to the use of cookies. For more detailed information regarding the use of cookies on this website, please see our ["Privacy Policy"](/cookies.html?&L=0). If you prefer not to have cookies stored within your web-browser, please adjust your browser settings accordingly.

AGREE

[![WinRAR Home](/fileadmin/templates/logo-winrar.png)](/start.html?&L=0)

Search

| Language | English |
| --- | --- |

# WinRAR - What's new in the latest version

## Version 7.10 beta 3

```

   1. RAR compression algorithm can use multiple Windows processor groups
      to utilize up to maximum supported 64 logical processors.
      It can improve RAR compression speed on systems with logical
      processors number exceeding 64 and not multiple of 64.

      Previously the maximum number of logical processors was limited
      to a single processor group size, such as 36 for 72 processors.

   2. Tree panel uses the logical sorting for folders inside of archives.
      It treats digits in folder names by their numerical value, so folders
      are sorted as "1", "2", "10" instead of "1", "10", "2".
      Such sorting was already used for folders outside of archives.

   3. Dark mode visual improvements.

   4. Bugs fixed:

      a) if new files have been added to existing semi-solid RAR archive
         created with -se or -s switches, such files could be damaged.
         This issue doesn't affect usual solid archives created with -s,
         also as non-solid archives;

      b) if internal viewer "Autodetect encoding" option was on, a wrong
         encoding name could be displayed in the viewer status bar;

      c) compressing a network share top level folder from Explorer
         context menu failed with "Cannot open" error.

```
## Version 7.10 beta 2

```

   1. Numerous dark mode improvements and fixes.

   2. "Dark mode" options in "Settings/Interface" are renamed to "Color mode".

   3. It takes less time for WinRAR items in Windows 11 context menu to
      appear, when right clicking a lot of selected archives.

   4. Exporting settings with "Export settings to file" command
      of "Options/Import and export" submenu doesn't trigger
      User Account Control prompts anymore.

   5. "Bad archive" exit code 13 is returned in the command line mode,
      when attempting to unpack a non-RAR archive with .rar file extension.

   6. "External viewer name" field in "Settings/Viewer" recognizes "\", "..\"
      or ".\" in the beginning of path, allowing to specify paths relative
      to WinRAR program folder. Paths like \utils\viewer.exe, ..\viewer.exe
      or .\viewer.exe can be helpful for WinRAR installation on USB drive
      without a fixed drive letter

   7. Bugs fixed:

      a) compression speed could be lower than expected for rare specific
         combination of source data in a non-solid archive;

      b) console RAR fell into infinite loop, when trying to process user
         input in prompts like the overwrite prompt in Windows 7;

      c) running executables from archive subfolders failed with
         "Cannot execute" error;

      d) WinRAR.ini contents could be reset if "Reuse existing window" option
         was on and multiple archives were opened in the same WinRAR window.

```
## Version 7.10 beta 1

```

   1. "Settings/General" dialog page is split to "Settings/Interface"
      and "Settings/System" pages. Dialog navigation uses vertical tabs
      instead of horizontal.

   2. WinRAR sets the dark interface mode if "Dark mode" option
      in "Settings/Interface" is on. This option can enable or disable
      the dark mode unconditionally or use Windows dark mode settings.

   3. "Large memory pages" option in "Settings/System" dialog and -mlp
      command line switch enable using 2 MB memory pages instead of
      default 4 KB, when allocating large memory areas in RAR archive
      format compression and extraction routines.

      It allows to improve archiving and, in some cases, extraction speed.
      Typically the performance gain is more significant for bigger
      compression dictionaries and slower compression methods.

      This feature requires "Lock pages in memory" privilege
      and if it is missing, WinRAR proposes to assign it to the current
      user account, making it available for other software too.
      Windows restart is necessary to activate the newly assigned privilege.

   4. "Zone value only" option in "Settings/Security" dialog controls
      if archive Mark of the Web propagation includes only the security zone
      value or all available fields.

      While additional fields, such as a download location or IP address,
      might help to identify a file source, they can be a privacy concern
      if file is shared with other persons.

   5. Switch -om[-|1][=list] controls Mark of the Web propagation
      in WinRAR and console RAR command line mode.

   6. Windows Vista and 32-bit Windows are not supported anymore.
      WinRAR and WinRAR self-extracting modules require Windows 7 x64
      or later.

   7. "Auto", "Always on" and "Disable" choices are now available
      for "Delta compression" and "x86 executable compression" options
      in "Advanced compression parameters" dialog.

      To improve the compression speed, "Auto" applies these options
      depending on the compression method, such as disabling them
      for "Fastest" and "Fast" methods. Use "Always on" to enable them
      for all methods.

   8. Name of environment variable to store the default set of RAR switches
      is changed from "RAR" to "RARINISWITCHES". It is rather typical
      for batch scripts to use "RAR" environment variable name to store
      RAR executable pathname, which led to the name conflict previously.

   9. "Completion message title" and "Completion message text" options
      on "Text" page of "Advanced SFX options" dialog allow to define
      a custom message displayed on the successful completion of SFX archive
      extraction.

      This message can also be added with "TextDone" script command.

      SFX logo and icon options are moved to the new "Logo and icon" page
      of "Advanced SFX options" dialog. Dialog navigation uses vertical tabs
      instead of horizontal.

  10. Windows 11 context menu:

      a) compression profiles in the new context menu are placed above
         extraction commands, similarly to the legacy context menu;

      b) separator lines are inserted between archive open, extraction
         and archiving command groups.

  11. When extracting a file with NTFS "Compressed" attribute,
      this attribute is assigned in the beginning of file extraction.
      Typically it reduces the extraction time compared to assigning it
      after writing the file data.

  12. When adding files to existing RAR archive, folders previously stored
      in such archive are moved to a position after newly added files.
      So folder timestamps are set after extracting all files and are not
      modified when creating files inside of these folders.

  13. Temporary file isn't created anymore for "rar ch -tl" command
      if no archive modification switches like -rr or -z have been specified.
      Modification time of newest archived file is set directly to original
      archive file, without copying the archive data. It reduces disk write
      and processing time.

  14. If archive is truncated at recovery record or quick open information
      service blocks, the additional message with truncated block type
      is displayed after the standard "Unexpected end of archive".

  15. Bugs fixed:

      a) even though the long range search isn't used with -m1 "fastest"
         compression method, switches -m1 -mcl+ or -m1 -mcl with 256MB
         or larger compression dictionary still allocated memory required
         for long range search algorithm;

      b) if "Remove redundant folders from extraction path" option was on
         when extracting a file from archive subfolder, clicking on ".."
         in the file list afterwards displayed the folder with the archive
         file instead of parent folder inside of archive;

      c) if application was started from archive and created multiple files
         with monotonically growing date, WinRAR could issue archive update
         prompts for every created file instead of a single prompt.

```
## Version 7.01

```

  1. Bugs fixed:

      a) updating an encrypted file in a solid RAR archive produced
         a corrupt archive if updated file was the first in archive,
         no password was specified when starting updating and file name
         encryption in the updated archive wasn't enabled;

      b) WinRAR 7.00 crashed after switching to "Flat folders view" mode
         from archive subfolder;

      c) switch -ep4 duplicated the specified path instead of excluding it
         when extracting;

      d) if archive created by Unix RAR version contained symlinks with
         path separator characters in target paths, these characters could be
         broken when modifying such archive with Windows RAR;

      e) invalid file name was displayed in file rename and file execute
         WinRAR error messages;

      f) SFX "Shortcut" command failed to recognize empty parameters
         defined like "Shortcut=D,"",folder", while correctly recognizing
         such parameters without quote marks like "Shortcut=D,,folder";

      g) volume reconstruction didn't work in WinRAR.exe if "rc" command
         was specified with .rev file, such as "WinRAR rc arc.part1.rev".
         Unlike RAR, WinRAR required to use only .rar file name here.

```
## Version 7.00

```

   1. Compression dictionary sizes larger than 1 GB are supported
      for RAR archive format. Depending on the amount of physically
      available memory, dictionary up to 64 GB can be selected.

      Not power of 2 dictionary sizes can be specified for dictionaries
      exceeding 4 GB. So we are not limited to 4, 8, 16, 32, 64 series
      and can use values like 5 GB or 22 GB.

      Archives with dictionaries exceeding 4 GB can be unpacked only
      by WinRAR 7.0 or newer. 64-bit WinRAR version is needed to unpack
      archives with dictionaries exceeding 1 GB.

      Increasing the dictionary size can improve the compression ratio
      for large files with distant repeated blocks, like virtual machine
      disk images. It also can be efficient for sets of large similar files
      in a solid archive, such as a collection of software ISO images
      differing by version or localization.

   2. WinRAR issues a prompt allowing to cancel or continue if dictionary
      size in extracted RAR archive exceeds "Maximum dictionary size
      allowed to extract" parameter in "Settings/Compression".
      It is done to prevent the unexpected excessive memory allocation.

      In the command line mode by default WinRAR refuses to unpack archives
      with dictionary exceeding 4 GB. Use -md or -mdx to allow
      unpacking dictionaries up to and including the specified size.
      Unlike -md, -mdx is applied to extraction only and can be
      added to RAR environment variable, not affecting archiving commands.

   3. "Define dictionary sizes" dialog in "Settings/Compression" can be used
      to customize dictionary sizes proposed in the drop down list associated
      with "Dictionary size" field in "Archive name and parameters" dialog.

   4. Alternate search algorithm, optimized to locate longer and more distant
      repeated data blocks, can be used when creating RAR archives.
      It helps to improve the compression ratio and sometimes speed
      for redundant data like big text files.

      It increases memory usage and might reduce the compression speed
      for some types of data. It can be turned on or off with
      "Long range search" options in "Advanced compression parameters" dialog
      or with -mcl[+|-] switch. If "Auto" option is selected, WinRAR applies
      the long range search depending on the compression method, dictionary
      size and other parameters.

      This algorithm is required for dictionaries exceeding 4 GB
      and turning it off is ignored for such dictionaries.

   5. Much slower and more exhaustive repeated data search and compression
      algorithm can be enabled with "Exhaustive search" option
      in "Advanced compression parameters" dialog or with -mcx switch.
      It might provide the additional compression gain for some types of
      redundant data, but at much lower compression speed.

      Long range search is needed to implement this mode efficiently,
      so the exhaustive search option activates it automatically.

      Both long range and exhaustive search option do not affect
      the compatibility of created archives. So if dictionary size
      is in 128 KB - 4 GB range, archives created with these search options
      can be unpacked by all WinRAR versions beginning from 5.0.

   6. Maximum path length limit is increased from 2047 to 65535 characters.

   7. Creating archives in RAR 4.x format isn't supported anymore.
      Options and switches specific for this format are removed.
      It doesn't affect RAR 4.x archives decompression, which is included
      into WinRAR.

   8. "Propagate Mark of the Web" option in "Settings/Security" dialog
      controls assigning the archive Mark of the Web to extracted files.
      It is possible to prohibit propagating, allow it for several
      predefined file groups, for all files or for files matching user
      defined file masks.

      Mark of the Web is the security zone information added by Internet
      browsers to downloaded files. It can be used by various software
      for security purposes.

      It is supported only by GUI WinRAR. Console RAR doesn't propagate
      Mark of the Web regardless of this option.

   9. "Attributes" column can be enabled in "Settings/File list/Columns".
      It displays file attribute abbreviations, such as 'A' for "Archive"
      and 'D' for directory.

      If file attribute isn't among those recognized by WinRAR,
      the numeric value of file attributes is also displayed.
      This value uses hexadecimal format for Windows attributes
      or octal format for Unix attributes.

  10. "Benchmark" command allows to specify the exact number of threads
      and copy results to clipboard. Information about WinRAR and Windows
      versions, CPU and memory is added to benchmark window.

  11. "Remove redundant folders from extraction path" option
      in "Settings/Paths" is now applicable also to extraction commands
      invoked from WinRAR user interface and to multiple archives
      unpacked to separate folders. It removes a destination path
      component, only if its name matches both the archive name and root
      archived folder name, provided that there are no other folders
      or files in archive root.

      For example, it will remove one of "Pictures" in the destination path
      if we unpack Pictures.rar containing the root "Pictures" folder
      to "Pictures\" destination.

      Previously it worked only for a single archive extracted from
      context menu and didn't check if archived folder name matches
      the last destination path component.

  12. "Word wrap in comment" option in "Interface" options group
      in "Settings/General" toggles the word wrap mode in archive comment
      window.

  13. Dictionary size data in archive information dialog is now available
      for .bz2, .lz, .tar.bz2, .tar.gz, .tar.lz, .tar.zst archives.

  14. Switch -ol- prohibits archiving and extracting symbolic links.

  15. Switches -sl[u] and -sm[u] recognize [k|K|m|M|g|G|t|T]
      size units for kilobytes, thousands of bytes, megabytes, millions
      of bytes, gigabytes, billions of bytes, terabytes, trillions of bytes.
      If unit character is 'b', 'B' or not present, bytes are assumed.

      Previously these switches accepted bytes only.

  16. SFX TempMode command accepts the optional @set:user parameter
      allowing to modify temporary folder permissions, so only the current
      user can access it. It prohibits a local user to replace files
      in a temporary folder if SFX is started under another account.

      It also can be enabled with "Restrict folder access" option
      in "Advanced SFX options/Modes" dialog.

      Some installers might fail to start in a folder created with
      @set:user parameter.

  17. File permissions and NTFS alternate streams are not saved for
      hard link entries. They are saved only for the source file these
      entries refer to. It allows to reduce the archive size, because
      such file properties are automatically propagated to hard links
      copies when extracting.

  18. Keyboard shortcuts, such as Ctrl+A to select all files or Alt+E to
      unpack found archives, are now functional in "Search results" window
      also while search is still in progress. Previously they were available
      only after completing search.

  19. Switch -v[unit] recognizes 't' and 'T' as terabytes and
      trillions of bytes for volume size units.

  20. Warning is issued if leading '-' character is missing in a parameter
      specified in "Additional switches" field of WinRAR archiving
      and extraction dialogs. Also it is issued for parameters lacking '-'
      in RAR environment variable and rar.ini file.

      Previously such malformed parameters were ignored silently.

  21. "Convert archives" command displays the smooth total operation progress.
      Previously the total progress was updated abruptly after converting
      an archive and was visible only when processing multiple archives.

  22. Proper progress is displayed when compressing symbolic link targets.

  23. "Integrate WinRAR into shell" option in WinRAR "Settings/Integration"
      is grayed out if "Global\Integration=0" is present in winrar.ini file.

  24. 64-bit WinRAR version uses 64-bit SFX modules by default.
      64-bit SFX modules are needed to unpack archives with dictionaries
      exceeding 1 GB.

      32-bit modules are renamed to Default32.SFX, Zip32.SFX, WinCon32.SFX.

  25. Maximum allowed dictionary size for archiving and extraction
      can be specified in gigabytes in MaxDictA and MaxDictE variables
      in "HKEY_CURRENT_USER\Software\WinRAR\Policy" Registry key.
      If these variables are smaller than corresponding values defined
      in WinRAR interface, they override interface values.

  26. Console RAR filters out character 27 from screen output. It is done
      for security reasons, because this character can be used to declare
      ANSI escape control sequences in some terminal applications.

      We are thankful to Siddharth Dushantha for bringing this issue
      to our attention.

  27. Bugs fixed:

      a) it was possible to overwrite Mark of the Web, propagated from
         archive to extracted files, and modify its security zone information
         utilizing a specially crafted .rar archive.

         We are thankful to Orange Tsai and NiNi from DEVCORE Research Team
         working with Trend Micro Zero Day Initiative for letting us know
         about this security issue.

         Unlike WinRAR, unrar.dll library doesn't propagate the archive
         Mark of the Web and leaves it to a caller application to assign it
         to extracted files. So unrar.dll isn't affected by this issue;

      b) "User defined archive extensions" field in "Settings/Integration"
         was not saved if winrar.ini was used to store settings
         and WinRAR was started under non-administrator user account.

```
## Version 6.24

```

1. Bugs fixed:

      a) WinRAR and UnRAR.dll extraction command dereferenced a null pointer
         and crashed when processing a zero length archive name
         in the archive metadata stored with -am switch.

         We are thankful to Radoslaw Madej from Check Point software
         for reporting this issue;

      b) WinRAR and UnRAR.dll extraction command overwrote extracted file
         data with contents of ::$DATA NTFS alternate data stream,
         if such stream was present in the archive. In this case
         unpacked data size and checksum could mismatch file size
         and checksum displayed in WinRAR file list. It didn't affect
         file name and type, which were displayed properly.

         We are thankful to Ata Hakcil for reporting this issue.

```
## Version 6.23

```

   1. Added extraction of XZ archives utilizing ARM64 filter.

   2. Rar$LS* temporary files, created when extracting or testing multiple
      archives from Windows context menu, are now deleted immediately.
      Previously they were deleted only on next WinRAR runs and only
      if they were at least 1 hour old.

   3. Bugs fixed:

      a) a security issue involving out of bounds write is fixed
         in RAR4 recovery volumes processing code.

         We are thankful to goodbyeselene working with Trend Micro Zero Day
         Initiative for letting us know about this bug;

      b) WinRAR could start a wrong file after a user double clicked
         an item in a specially crafted archive.

         We are thankful to Andrey Polovinkin from Group-IB Threat
         Intelligence unit for letting us know about this bug;

      c) if both NTFS and Unix time extra fields were available for a file
         in ZIP archive, extraction command ignored the second extra field
         even if it provided more time fields than first one;

      d) interface themes were applied to archive icons even if
         "Apply to archive icons" option in "Organize themes" dialog
         was turned off.

   4. win.rar GmbH highly recommends to install the latest version of WinRAR 6.23.
       You will find the latest version here: https://www.win-rar.com/download.html

```
## Version 6.22

```

   1. Bugs fixed:

      a) extracting individual files from solid archives created by
         RAR versions older than 2.0, could fail in WinRAR 6.20 and 6.21.
         It didn't affect extracting the entire archive, which was performed
         correctly;

      b) files in Unix ARJ archives could be erroneously displayed as folders
         in WinRAR file list;

      c) "Display files in Explorer" extraction option was ignored
         if "When done: Close WinRAR" option was also set and archive
         was opened in WinRAR before extracting;

      d) file size value in the internal viewer status bar didn't include
         the byte order mask field, displaying a smaller than actual size
         for Unicode files.

```
## Version 6.21

```

   1. Both file and folder modification timestamps are restored
      when unpacking TAR and TAR based archives like tar.gz and tar.bz2.
      Previously only file modification timestamps were set
      for these archive formats.

   2. Added decompression of .tar.zst archives with dictionary
      exceeding 128 MB. WinRAR 6.20 allowed such dictionary for .zst,
      but not for .tar.zst.

   3. Switches -ed and -e+d are also supported by ZIP archives.
      Previously they worked only for RAR archives.

   4. Bugs fixed:

      a) if unencrypted file was stored after encrypted in the same
         RAR archive and both files had been unpacked in the same extraction
         command, WinRAR 6.20 failed to unpack the unencrypted file;

      b) in some cases a wrong detailed reason of file open error could be
         displayed in the second line of open error message.

```
## Version 6.20

```

   1. If "Autodetect passwords" option in "Organizer passwords" dialog
      is enabled and password matching a processing archive is present
      among saved passwords, it is applied automatically. This option
      is applicable only for archives in RAR 5.0 and ZIP formats,
      which allow to verify the password validity quickly.

      There is a minor chance of incorrect password detection
      for ZIP archives if stored passwords do not include a proper one.
      If encrypted ZIP archive extraction fails, you can try to disable
      this option, repeat extraction and enter a valid password manually.

   2. If extraction command involves only a part of files in RAR archive,
      the additional archive analysis is performed when starting extraction.
      It helps to properly unpack file references even if reference source
      is not selected. It works for most of RAR archives except for volumes
      on multiple removable media and archives containing a very large
      number of references.

      Also in some cases such analysis may help to optimize the amount
      of processing data when extracting individual files from
      semi-solid archives created with -s and -se switches.

   3. "Save original archive name and time" option on "Options" page
      of archiving dialog allows to save the original archive name
      and creation time. If archive includes such saved name and time,
      they are displayed on "Info" page of "Show information" command
      and can be restored on "Options" page of same command.
      Restoring involves renaming an archive to original name and setting
      the saved time as the archive creation and modification time.

      Switch -ams or just -am together with archive modification commands
      can be used to save the archive name and time in the command line mode.
      These saved parameters are displayed in header of "l" and "v" commands
      output and can be restored with -amr switch combined with "ch" command,
      such as "rar ch -amr arc.rar". If -amr is specified, "ch" ignores
      other archive modification switches.

   4. Faster RAR5 compression of poorly compressible data on modern CPUs
      with 8 or more execution threads. This applies to all methods
      except "Fastest", which performance remains the same.

   5. "Repair" command efficiency is improved for shuffled data blocks
      in recovery record protected RAR5 archives.

   6. If file size has grown after archiving when creating non-solid
      RAR volumes, such file is stored without compression regardless of
      volume number, provided that file isn't split between volumes.
      Previously it worked only for files in the first volume.

   7. Added decompression of .zipx archives containing file references,
      provided that both reference source and target are selected
      and reference source precedes the target inside of archive.

      Typically, if .zipx archive includes file references, it is necessary
      to unpack the entire archive to extract references successfully.

   8. Added decompression of .zst long range mode archives with dictionary
      exceeding 128 MB. Previously it was possible to decompress them only
      if dictionary was 128 MB or less.

   9. If "Turn PC off", "Hibernate", "Sleep" or "Restart PC" archiving
      options are enabled in WinRAR, a prompt to confirm or cancel
      such power management action is displayed directly before starting it.
      If no selection was made by user for 30 seconds, the proposed action
      is confirmed and started automatically.

      This prompt is also displayed for -ioff switch in WinRAR command line,
      but not in console RAR command line.

  10. Context menu in WinRAR file list provides "Open in internal viewer"
      command for archive files. It can be helpful if you wish to view
      the archive raw data in internal viewer. For example, to read
      an email archive with UUE attachments included.

      Usual "View" command always displays the archive contents.
      If file is recognized as UUE archive, "View" would show UUE attachments.

  11. Recovery record size is displayed on "Archive" page of file properties
      invoked from Explorer context menu for archives in RAR5 format.
      Previously there was only "Present" instead of exact size
      for RAR5 archives.

  12. When archiving from stdin with -si switch, RAR displays the current
      amount of read bytes as the progress indicator.

  13. If wrong password is specified when adding files to encrypted
      solid RAR5 archive, a password will be requested again.
      Previous versions cancelled archiving in this case.

  14. If both options "Test archived files" and "Clear attribute "Archive"
      after compressing" or their command line -t -ac equivalents are
      enabled when archiving, "Archive" attribute will be cleared only
      if test was completed successfully. Previously it was cleared even
      when test reported errors.

  15. NoDrives value containing the bit mask to hide drives can be now
      read from "HKEY_CURRENT_USER\Software\WinRAR\Policy" Registry key,
      which allows to include it to winrar.ini if necessary.
      Its "Software\Microsoft\Windows\CurrentVersion\Policies" locations
      in HKEY_CURRENT_USER and HKEY_LOCAL_MACHINE are also supported.

      Previously only "Software\Microsoft\Windows\CurrentVersion\Policies"
      in HKEY_CURRENT_USER was recognized.

  16. Bugs fixed:

      a) archive modification commands could fail for some ZIP archives
         with file comments;

      b) fixed a memory leak when reading contents of .tar.bz2 archives;

      c) if source and resulting archive format is the same, the archive
         conversion command didn't set the original archive time
         to a newly created archive even if "Original archive time" option
         was selected in archiving parameters;

      d) if "Merge volumes contents" option in "Settings/File list" was
         turned on, the folder packed size in WinRAR file list could be
         less than expected when browsing a multivolume archive contents.
         It didn't include the packed size of file parts continuing from
         previous volume into calculation;

      e) even if "Set file security" extraction option was turned off
         by default, extraction commands in Explorer context menu still
         attempted to restore NTFS file security data;

      f) WinRAR could read data beyond the end of buffer and crash
         when unpacking files from specially crafted ZIP archive.
         We are thankful to Bakker working with Trend Micro Zero Day
         Initiative for letting us know about this bug.

```
## Version 6.11

```

   1. Added support for Gz archives with large archive comments.
      Previously the extraction command failed to unpack gz archives
      if comment size exceeded 16 KB.

   2. Archive comments in gz archives are displayed in the comment window
      and recognized by "Show information" command. Large comments are
      shown partially.

      Previous versions didn't display Gzip comments.

   3. Reserved device names followed by file extension, such as aux.txt,
      are extracted as is in Windows 11 even without "Allow potentially
      incompatible names" option or -oni command line switch.
      Unlike previous Windows versions, Windows 11 treats such names
      as usual files.

      Device names without extension, such as aux, still require these
      options to be unpacked as is regardless of Windows version.

   4. Switch -mes can be also used to suppress the password prompt
      and abort when adding files to encrypted solid archive.

   5. Additional measures to prevent extracting insecure links are
      implemented.

   6. Bugs fixed:

      a) if password exceeding 127 characters was entered when unpacking
         an encrypted archive with console RAR, text after 127th character
         could be erroneously recognized as user's input by different
         prompts issued later;

      b) wrong archived file time could be displayed in overwrite prompt
         when extracting a file from ZIP archive. It happened if such
         archive included extended file times and was created in another
         time zone. It didn't affect the actual file time, which was set
         properly upon extraction.

```
## Version 6.10

```

   1. WinRAR can unpack contents of .zst and .zipx archives utilizing
      Zstandard algorithm.

   2. Added support of Windows 11 Explorer context menus.

      Beginning from Windows 11, an application can add only a single top
      level command or submenu to Explorer context menu.

      If "Cascaded context menus" in "Integration settings" dialog is on,
      this single item is a submenu storing all necessary WinRAR commands.

      If this option is off, only one extraction command for archives
      and one archiving command for usual files are available.
      You can select these commands with "Context menu items..." button
      in "Integration settings" dialog.

   3. "Legacy context menus" option in "Settings/Integration" dialog
      can be used in Windows 11 if WinRAR commands are missing in
      "Show more options" Windows legacy context menu or in context menus
      of third party file managers. If WinRAR commands are already present
      here, keep "Legacy context menus" option turned off to prevent
      duplicating them.

      This option is not available in Windows 10 and older.

   4. Windows XP is not supported anymore. Minimum required operating
      system version is Windows Vista.

   5. "Close" item is added to "When done" list on "Advanced" page of
      archiving dialog. It closes WinRAR window, when archiving is done.

   6. "When done" list is added to "Options" page of extraction dialog.
      It allows to select an action like turning a computer off
      or closing WinRAR after completing extraction.

   7. Switch -si can be used when extracting or testing to read archive
      data from stdin, such as:

        type docs.rar | rar x -si -o+ -pmypwd dummy docs\

      Even though the archive name is ignored with this switch,
      an arbitrary dummy archive name has to specified in the command line.

      Operations requiring backward seeks are unavailable in this mode.
      It includes displaying archive comments, testing the recovery record,
      utilizing the quick open information, processing multivolume archives.

      Prompts requiring user interaction are not allowed.
      Use -o[+|-|r], -p or -mes switches to suppress such prompts.

   8. New -ep4 switch excludes the path prefix when archiving
      or extracting if this path is found in the beginning of archived name.
      Path is compared with names already prepared to store in archive,
      without drive letters and leading path separators. For example:

        rar a -ep4texts\books archive c:\texts\books\technical

      removes "text\books" from archived names, so they start
      from 'technical'.

   9. New -mes switch skips encrypted files when extracting or testing.
      It replaces the former -p- switch.

  10. New -op switch sets the destination folder for 'x' and 'e'
      extraction commands. Unlike  command line parameter,
      this switch also accepts paths without trailing path separator
      character.

  11. If 'p' command is used to print a file to stdout, informational
      messages are suppressed automatically to prevent them mixing
      with file data.

  12. "Generate archive name by mask" option and switch -ag treat only
      first two 'M' characters after 'H' as minutes. Previously any
      amount of such characters was considered as minutes.

      It makes possible to place the time field before the date,
      like -agHHMM-DDMMYY. Previous versions considered all 'M'
      in this string as minutes.

  13. Maximum allowed size of RAR5 recovery record is increased to 1000%
      of protected data size. Maximum number of RAR5 recovery volumes
      can be 10 times larger than protected RAR volumes.

      Previous WinRAR versions are not able to use the recovery record
      to repair broken archives if recovery record size exceeds 99%.
      Similarly, previous versions cannot use recovery volumes
      if their number is equal or larger than number of RAR volumes.

  14. Warning is issued if entered password exceeds the allowed limit
      of 127 characters and is truncated. Previously such passwords
      had been truncated silently.

  15. If archive includes reserved device names, the underscore character
      is inserted in the beginning of such names when extracting.
      For example, aux.txt is converted to _aux.txt. It is done to prevent
      compatibility problems with software unable to process such names.

      You can use "Allow potentially incompatible names" option
      in "Advanced" part of extraction dialog or command line -oni switch
      to avoid this conversion.

  16. WinRAR attempts to reset the file cache before testing an archive.
      It helps to verify actual data written to disk instead of reading
      a cached copy.

  17. Multiple -v switches specifying different sizes for different
      volumes are now allowed also for ZIP archives:

      WinRAR a -v100k -v200k -v300k arcname.zip

      Previously multiple -v switches were supported only for
      RAR archives.

  18. Switches -sl and -sm can be used in WinRAR.exe command
      line mode when extracting archives in any supported formats,
      provided that such archive includes unpacked file sizes.
      Previously these switches could filter files by size only in RAR
      and ZIP archives.

  19. Newer folder selection dialog is invoked when pressing "Browse" button
      in WinRAR "Settings/Paths" page, "Repair" and "Convert" commands,
      also as in few other similar places. Previously a simpler XP style
      folder selection dialog was opened.

  20. When restoring from tray after completing an operation,
      WinRAR window is positioned under other opened windows,
      to not interfere with current user activities.

  21. "650 MB CD" is removed and "2 GB volumes" is added to the list of
      predefined volume sizes in "Define volume sizes" dialog invoked
      from WinRAR "Settings/Compression".

  22. "Rename" command selects the file name part up to the final dot.
      Previously it selected the entire name.

  23. If SFX archive size exceeds 4 GB, an error message is issued
      during compression, immediately after exceeding this threshold.
      Previously this error was reported only after completing compression.

      Executables of such size cannot be started by Windows.

  24. Command line -en switch is not supported anymore.
      It created RAR4 archives without the end of archive record.

      End of archive record permits to gracefully skip external data
      like digital signatures.

  25. Bugs fixed:

      a) when editing a file inside of .rar or .zip archive,
         WinRAR created a new SFX archive instead of updating an existing
         archive if "Create SFX archive" option was set in the default
         compression profile;

      b) the total progress could be displayed incorrectly when using
         -oi, -f, -u switches or appropriate GUI options;

      c) "Find files" command with "Use all tables" option and command line
         "it" commands failed to find strings in UTF-16 encoding.

```
## Version 6.02

```

   1. ZIP SFX module refuses to process SFX commands stored in archive
      comment if such comment is resided after beginning of Authenticode
      digital signature. It is done to prevent possible attacks with
      inclusion of ZIP archive into the signature body.

      We already prohibited extracting contents of such malformed archives
      in WinRAR 6.01.

      We are thankful to Jacob Thompson - Mandiant Advantage Labs
      for reporting this issue.

   2. WinRAR uses https instead of http in the web notifier window,
      home page and themes links. It also implements additional checks
      within the web notifier. This is done to prevent a malicious web page
      from executing existing files on a user's computer. Such attack
      is only possible if the intruder has managed to spoof or otherwise
      control user's DNS records. Some other factors are also involved
      in limiting the practical application of this attack.

      We would like to express our gratitude to Igor Sak-Sakovskiy
      for bringing this issue to our attention.

   3. Where appropriate, SFX archive displays the additional line
      with detailed error information provided by operating system.

      For example, previously such archive would display "Cannot create file"
      message alone. Now this message is followed by a detailed reason
      like access denied or file being used by another process.

      In the past this extended error information was available in WinRAR,
      but not in SFX archives.

   4. Switch -idn hides archived names also in 'v' and 'l' commands.
      It can be useful if only the archive type or total information
      is needed.

   5. If -ibck -ri switches are used together, WinRAR process
      sets the priority specified in -ri switch. Previous versions ignored
      -ri and set the priority to low in the presence of -ibck switch.

   6. When using "File/Change drive" command, WinRAR saves the last folder
      of previous drive and restores it if that drive is selected again
      later.

   7. Name of unpacking file is now included into WinRAR incorrect password
      warning for RAR5 archives. It can be helpful when unpacking
      a non-solid archive containing files encrypted with different passwords.

   8. Bugs fixed:

      a) "Convert archives" command issued erroneous "The specified password
         is incorrect" message after succesfully converting RAR archive
         with encrypted file names if new password was set and archive
         was opened in WinRAR shell;

      b) if command progress window was resized up and then quickly resized
         down to original dimensions, window contents could be positioned
         incorrectly.

```
## Version 6.01

```

   1. Ctrl+A keyboard shortcut selects the entire text in WinRAR comment
      window.

   2. If -idn switch is used together with -t or -df in console RAR
      when archiving, it additionally disables "Deleting <filename>"
      or "Testing <filename>" messages, normally issued by these switches.

      Also -idn disables folder creation messages when extracting
      a file to non-existing folder.

   3. WinRAR and ZIP SFX module refuse to extract contents of ZIP SFX
      archives if ZIP central directory is resided after beginning
      of Authenticode digital signature. It is done to prevent possible
      attacks with inclusion of ZIP archive into signature body.

   4. Bugs fixed:

      a) "Convert archives" command could incorrectly convert Unicode
         comments in RAR archives.

      b) if two archive information windows had been opened from Explorer
         context menu, the compression ratio bar in the first window
         could erroneously display a value for second archive.

         It did not affect the ratio and other text details at the right
         of window. Only the vertical bar at the left could be updated
         to a wrong value;

      c) if "Wait if other WinRAR copies are active" option was enabled
         in extraction dialog, "Waiting for another WinRAR copy" title
         was not set in command progress window while waiting;

      d) when extracting a symbolic link, previous versions did not
         overwrite existing symbolic links even if user requested it
         in overwrite prompt.

```
## Version 6.00

```

   1. "Ignore" and "Ignore All" options are added to read error prompt.
      "Ignore" allows to continue processing with already read file part
      only and "Ignore All" does it for all future read errors.

      For example, if you archive a file, which portion is locked by another
      process, and if "Ignore" is selected in read error prompt,
      only a part of file preceding the unreadable region will be saved
      into archive.

      It can help to avoid interrupting lengthy archiving operations,
      though be aware that files archived with "Ignore" are incomplete.

      If switch -y is specified, "Ignore" is applied to all files by default.

      Previously available "Retry" and "Quit" options are still present
      in read error prompt as well.

   2. Exit code 12 is returned in the command line mode in case of read errors.
      This code is returned for all options in the read error prompt,
      including a newly introduced "Ignore" option.

      Previously more common fatal error code 2 was returned for read errors.

   3. If several archives are selected, "Extract archives to" option group
      in "Options" page of extraction dialog can be used to place extracted
      files to specified destination folder, to separate subfolders
      in destination folder, to separate subfolders in archive folders
      and directly to archive folders.

      It replaces "Extract archives to subfolders" option and available
      only if multiple archives are selected.

   4. New -ad2 switch places extracted files directly to archive's own folder.
      Unlike -ad1, it does not create a separate subfolder for each unpacked
      archive.

   5. "Additional switches" option in "Options" page of archiving
      and extraction dialogs allows to specify WinRAR command line switches.
      It might be useful if there is no option in WinRAR graphical interface
      matching a switch.

      Use this feature only if you are familiar with WinRAR command line
      syntax and clearly understand what specified switches are intended for.

   6. Compression parameters in "Benchmark" command are changed to
      32 MB dictionary and "Normal" method. They match RAR5 default mode
      and more suitable to estimate the typical performance of recent
      WinRAR versions than former 4 MB "Best" intended for RAR4 format.

      Latest "Benchmark" results cannot be compared with previous versions
      directly. New parameters set produces different values, likely lower
      because of eight times larger dictionary size.

   7. When unpacking a part of files from solid volume set,
      WinRAR attempts to skip volumes in the beginning and start
      extraction from volume closest to specified file and with reset
      solid statistics.

      By default WinRAR resets the solid statistics in the beginning
      of large enough solid volumes where possible. For such volumes
      extracting a part of files from the middle of volume set can be
      faster now.

      It does not affect performance when all archived files are unpacked.

   8. Previously WinRAR automatically resorted to extracting from
      first volume, when user started extraction from non-first volume
      and first volume was available. Now WinRAR does so only if all volumes
      between first and specified are also available.

   9. Warning is issued when closing WinRAR if one or more archived files
      had been modified by external apps, but failed to be saved back to
      archive, because an external app still locks them. Such warning
      includes the list of modified files and proposes to quit immediately
      and lose changes or return to WinRAR and close an editor app.

      Previous versions issued a similar warning while editing a file,
      but did not remind it again when quitting.

  10. "Move to Recycle Bin" option in "Delete archive" options group
      of extraction dialog places deleted archives to Recycle Bin
      instead of deleting them permanently.

  11. New "Clear history..." command in "Options" menu allows to remove
      names of recently opened archives in "File" menu and clear drop down
      lists with previously entered values in dialogs. For example,
      these values include archive names in archiving dialog
      and destination paths in extraction dialog.

  12. "File time" options in "Advanced" part of extraction dialog are
      now available for 7z archives. Additionally to modification time,
      WinRAR can set creation and last access time when unpacking such
      archives.

  13. ""New" submenu items" options group is added to
      "Settings/Integration/Context menu items..." dialog. You can use
      these options to remove "WinRAR archive" and "WinRAR ZIP archive"
      entries in "New" submenu of Windows context menu.

      New state of these option is applied only after you press "OK"
      both in "Context menu items" and its parent "Settings" dialog.

  14. <Max>, <Min> and <Hide> commands can be inserted before the program
      name in SFX "Setup" command to run a program in maximized,
      minimized or hidden window. For example:

      Setup=<Hide>setup.exe

  15. It is possible to specify an additional high resolution logo
      for SFX module. If such logo is present, SFX module scales
      and displays it in high DPI Windows mode, providing the better visible
      quality compared to resizing the standard logo.

      Use "High resolution SFX logo" in "Advanced SFX options" dialog
      to define such logo. In command line mode add second -iimg switch
      to set the high resolution logo.

      Recommended size of high resolution logo PNG file is 186x604 pixels.

  16. If archive currently opened in WinRAR shell was deleted or moved
      by another program, WinRAR displays "Inaccessible" before archive name
      in the window title. Also it flashes the window caption and taskbar
      button.

  17. "Total information" option in "Report" dialog is renamed to
      "Headers and totals". Now it also adds headers of report columns
      additionally to total information about listed files and archives.

  18. If archive processing is started from Windows context menu
      in multiple monitor system, WinRAR operation progress and dialogs
      use the monitor with context menu.

      While basic multiple monitor support was present in previous versions
      shell extension for mouse driven commands, now it is extended to
      operations initiated from keyboard and to dropping files to archives.

  19. New -imon<number> switch allows to select a monitor to display
      WinRAR operation progress and dialogs in the command line mode.

      Use -imon1 for primary and -imon2 for secondary monitor.
      For example, "WinRAR x -imon2 arcname" will start extraction
      on secondary monitor.

      It works only in the command line mode and does not affect
      interactive WinRAR graphical inteface also as console RAR.

  20. Switch -idn hides archived names output in archiving, extraction
      and some other commands in console RAR. Other messages and total
      percentage are not affected.

      You can use this switch to reduce visual clutter and console output
      overhead when archiving or extracting a lot of small files.

      Minor visual artifacts, such as percentage indicator overwriting
      few last characters of error messages, are possible with -idn.

  21. Former "-im - show more information" switch is changed to
      "-idv - display verbose output" for consistency with console RAR
      -id[c,d,p,q] message control options and avoid a potential name
      conflict with newer -imon switch.

      While WinRAR still recognizes both -im and -idv, in the future
      -im support can be dropped.

  22. It is allowed to add an optional %arcname% variable to compression
      profile name. Such variable will be replaced with actual archive name.
      It might be convenient when using with "Add to context menu" profile
      option. For example, you can create ZIP compression profile
      and set its name to "Add to %arcname%", to display it with actual
      ZIP archive name in context menu.

  23. Ctrl+C and Ctrl+Ins keyboard shortcuts can be used
      in "Diagnostic messages" window to copy contents to clipboard.

  24. More text is allowed in tray icon hint before a lengthy text
      is truncated. Also such text is now truncated in the middle of string,
      so both command type and completion percentage are still visible.

  25. In case of clean install, if previous version compression profiles
      are not present, "Files to store without compression" field
      in newly created predefined compression profiles is set to:

        *.rar *.zip *.cab *.7z *.ace *.arj *.bz2 *.gz *.lha *.lzh
        *.taz *.tgz *.xz *.txz

      You can change this field and save a modified value to compression
      profile later.

      Previous versions set this field to blank for clean install.

  26. Destination path history in extraction dialog treats paths like
      'folder' and 'folder\' as the same path and displays only 'folder'
      entry. Previously they occupied two entries in the history.

  27. "Enable Itanium executable compression" GUI option and -mci command
      line switch are removed. Optimized compression of Itanium executables
      is not supported anymore. WinRAR still can decompress already existing
      archives utilizing Itanium executable compression.

  28. Bugs fixed:

      a) "Lock", "Comment" and "Protect" commands could not be applied
         to several archives selected in WinRAR file list at once;

      b) SFX archive process did not terminate after completing
         extraction in Windows 10 if archive comment included "Setup"
         and "SetupCode" commands, did not include "TempMode" command
         and setup program was running for more than 8 minutes;

      c) compression profiles with quote character in profile name
         could not be invoked from Explorer context menu.

```

* [Products](https://www.win-rar.com/products-winrar.html)
* [Download](https://www.win-rar.com/download.html)
* [Industries](https://www.win-rar.com/industry.html)
* [Partner](https://www.win-rar.com/partners.html)
* [Support](https://www.win-rar.com/support.html)
* [News](https://www.win-rar.com/news.html)

[![WinRAR Facebook](/fileadmin/images/icons/fb.svg)](https://www.facebook.com/winrar/)[![X @WinRAR_RARLAB](/fileadmin/images/icons/tw.svg)](https://x.com/winrar_rarlab/)[![WinRAR Youtube](/fileadmin/images/icons/yt.svg)](https://www.youtube.com/WinRAR-RARLAB)

* [PRIVACY](/cookies.html?&L=0)
* |
* [IMPRINT](/contact.html?&L=0)

* © 2025 win.rar GmbH All rights reserved.


