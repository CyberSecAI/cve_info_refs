=== Content from github.com_eda9bd07_20250125_062705.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswoole%2Fswoole-src%2Fissues%2F1882)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswoole%2Fswoole-src%2Fissues%2F1882)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=swoole%2Fswoole-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[swoole](/swoole)
/
**[swoole-src](/swoole/swoole-src)**
Public

* [Notifications](/login?return_to=%2Fswoole%2Fswoole-src) You must be signed in to change notification settings
* [Fork
  3.2k](/login?return_to=%2Fswoole%2Fswoole-src)
* [Star
   18.6k](/login?return_to=%2Fswoole%2Fswoole-src)

* [Code](/swoole/swoole-src)
* [Issues
  93](/swoole/swoole-src/issues)
* [Pull requests
  6](/swoole/swoole-src/pulls)
* [Discussions](/swoole/swoole-src/discussions)
* [Actions](/swoole/swoole-src/actions)
* [Projects
  1](/swoole/swoole-src/projects)
* [Security](/swoole/swoole-src/security)
* [Insights](/swoole/swoole-src/pulse)

Additional navigation options

* [Code](/swoole/swoole-src)
* [Issues](/swoole/swoole-src/issues)
* [Pull requests](/swoole/swoole-src/pulls)
* [Discussions](/swoole/swoole-src/discussions)
* [Actions](/swoole/swoole-src/actions)
* [Projects](/swoole/swoole-src/projects)
* [Security](/swoole/swoole-src/security)
* [Insights](/swoole/swoole-src/pulse)

# SIGSEGV in Swoole unpack() function #1882

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[SIGSEGV in Swoole unpack() function](#top)#1882Copy linkLabels[Bug](https://github.com/swoole/swoole-src/issues?q=state%3Aopen%20label%3A%22Bug%22)[fixed](https://github.com/swoole/swoole-src/issues?q=state%3Aopen%20label%3A%22fixed%22)[![@X-C3LL](https://avatars.githubusercontent.com/u/4010240?u=fc73dd7df66192a95f0ceb7b78e06b0c95e3f7b6&v=4&size=80)](/X-C3LL)
## Description

[![@X-C3LL](https://avatars.githubusercontent.com/u/4010240?u=fc73dd7df66192a95f0ceb7b78e06b0c95e3f7b6&v=4&size=48)](/X-C3LL)[X-C3LL](https://github.com/X-C3LL)opened [on Aug 14, 2018](https://github.com/swoole/swoole-src/issues/1882#issue-350285631)
## Description:

Swoole unpack function produces a sigsegv when it calls i\_zval\_ptr\_dtor:

Tested on:

PHP 7.2.8 (cli) (built: Aug 11 2018 10:07:44) ( NTS )

Swoole: swoole-4.0.4

Backtrace:

#0 0x0000555555bc0850 in i\_zval\_ptr\_dtor (zval\_ptr=0x7ffff3866b60) at /tmp/php-7.2.8/Zend/zend\_variables.h:48

[#1](https://github.com/swoole/swoole-src/issues/1) zend\_array\_destroy (ht=0x7ffff385f3f0) at /tmp/php-7.2.8/Zend/zend\_hash.c:1308

[#2](https://github.com/swoole/swoole-src/issues/2) 0x0000555555b972a7 in \_zval\_dtor\_func (p=0x7ffff385f3f0) at /tmp/php-7.2.8/Zend/zend\_variables.c:43

[#3](https://github.com/swoole/swoole-src/issues/3) 0x00007ffff30b5496 in \_zval\_ptr\_dtor\_nogc (zval\_ptr=0x7fffffff7670) at /usr/local/include/php/Zend/zend\_variables.h:40

[#4](https://github.com/swoole/swoole-src/issues/4) swoole\_unserialize\_object (buffer=0x0, return\_value=0x7ffff38667c0, bucket\_len=1 '\001', args=0x0, flag=0) at /tmp/swoole-4.0.4/swoole\_serialize.c:1346

[#5](https://github.com/swoole/swoole-src/issues/5) 0x00007ffff30aeecd in swoole\_unserialize\_arr (buffer=0x7ffff387f04b, zvalue=0x7ffff381c120, nNumOfElements=2, flag=0) at /tmp/swoole-4.0.4/swoole\_serialize.c:829

[#6](https://github.com/swoole/swoole-src/issues/6) 0x00007ffff30b6e92 in php\_swoole\_unserialize (buffer=0x7ffff387f01a, len=70, return\_value=0x7ffff381c120, object\_args=0x0, flag=0) at /tmp/swoole-4.0.4/swoole\_serialize.c:1517

[#7](https://github.com/swoole/swoole-src/issues/7) 0x00007ffff30b70f7 in zim\_swoole\_serialize\_unpack (execute\_data=0x7ffff381c150, return\_value=0x7ffff381c120) at /tmp/swoole-4.0.4/swoole\_serialize.c:1569

[#8](https://github.com/swoole/swoole-src/issues/8) 0x0000555555d388b3 in ZEND\_DO\_FCALL\_SPEC\_RETVAL\_USED\_HANDLER () at /tmp/php-7.2.8/Zend/zend\_vm\_execute.h:1032

[#9](https://github.com/swoole/swoole-src/pull/9) execute\_ex (ex=0x7ffff381c030) at /tmp/php-7.2.8/Zend/zend\_vm\_execute.h:59768

[#10](https://github.com/swoole/swoole-src/issues/10) 0x0000555555d4c095 in zend\_execute (op\_array=0x7ffff387c2a0, return\_value=0x0) at /tmp/php-7.2.8/Zend/zend\_vm\_execute.h:63776

[#11](https://github.com/swoole/swoole-src/issues/11) 0x0000555555b9cdfb in zend\_execute\_scripts (type=8, retval=0x0, file\_count=3) at /tmp/php-7.2.8/Zend/zend.c:1496

[#12](https://github.com/swoole/swoole-src/issues/12) 0x0000555555aeba14 in php\_execute\_script (primary\_file=0x7fffffffe0c0) at /tmp/php-7.2.8/main/main.c:2590

[#13](https://github.com/swoole/swoole-src/pull/13) 0x0000555555d4f60d in do\_cli (argc=2, argv=0x5555566f2830) at /tmp/php-7.2.8/sapi/cli/php\_cli.c:1011

[#14](https://github.com/swoole/swoole-src/issues/14) 0x0000555555d507d0 in main (argc=2, argv=0x5555566f2830) at /tmp/php-7.2.8/sapi/cli/php\_cli.c:1404

[#15](https://github.com/swoole/swoole-src/issues/15) 0x00007ffff69282e1 in \_\_libc\_start\_main (main=0x555555d5014d

, argc=2, argv=0x7fffffffe518, init=, fini=, rtld\_fini=, stack\_end=0x7fffffffe508) at ../csu/libc-start.c:291

[#16](https://github.com/swoole/swoole-src/pull/16) 0x0000555555684d3a in \_start ()

Registers:

rax 0x1337 4919

rbx 0x0 0

rcx 0x14 20

rdx 0x1 1

rsi 0x7ffff3866b60 140737279060832

rdi 0x7ffff385f3f0 140737279030256

rbp 0x7fffffff7530 0x7fffffff7530

rsp 0x7fffffff7480 0x7fffffff7480

r8 0xffff 65535

r9 0x7fffffff7aac 140737488321196

r10 0x941 2369

r11 0x555555bbc584 93824998950276

r12 0x555555684d10 93824993479952

r13 0x7fffffffe510 140737488348432

r14 0x7ffff381c030 140737278754864

r15 0x7ffff386f140 140737279095104

rip 0x555555bc0850 0x555555bc0850 <zend\_array\_destroy+487>

eflags 0x10202 [ IF RF ]

cs 0x33 51

ss 0x2b 43

ds 0x0 0

es 0x0 0

fs 0x0 0

gs 0x0 0

==More info==

► 0x555555bc0850 <zend\_array\_destroy+487> mov eax, dword ptr [rax]

0x555555bc0852 <zend\_array\_destroy+489> lea edx, [rax - 1]

0x555555bc0855 <zend\_array\_destroy+492> mov rax, qword ptr [rbp - 0x48]

0x555555bc0859 <zend\_array\_destroy+496> mov dword ptr [rax], edx

0x555555bc085b <zend\_array\_destroy+498> mov rax, qword ptr [rbp - 0x48]

0x555555bc085f <zend\_array\_destroy+502> mov eax, dword ptr [rax]

0x555555bc0861 <zend\_array\_destroy+504> test eax, eax

0x555555bc0863 <zend\_array\_destroy+506> jne zend\_array\_destroy+522 <0x555555bc0873>

↓

0x555555bc0873 <zend\_array\_destroy+522> mov rax, qword ptr [rbp - 0x48]

0x555555bc0877 <zend\_array\_destroy+526> mov qword ptr [rbp - 0x50], rax

0x555555bc087b <zend\_array\_destroy+530> mov rax, qword ptr [rbp - 0x50]

43

44 static zend\_always\_inline void i\_zval\_ptr\_dtor(zval \*zval\_ptr ZEND\_FILE\_LINE\_DC)

45 {

46 if (Z\_REFCOUNTED\_P(zval\_ptr)) {

47 zend\_refcounted \*ref = Z\_COUNTED\_P(zval\_ptr);

► 48 if (!--GC\_REFCOUNT(ref)) {

49 \_zval\_dtor\_func(ref ZEND\_FILE\_LINE\_RELAY\_CC);

50 } else {

51 gc\_check\_possible\_root(ref);

52 }

53 }

---

I am not sure, but I believe that with this issue a free() on an arbitrary address(using \_val\_dtor\_func) can be done, so maybe this can be a vulnerability (but as I said, I am not sure).

## Test script:

```
<?php
$data = "e802ea7b02ea7b02227b0a010800737464436c617373018b0470726f7037130a010800737464436c617373018fc10037130a010800737464436c617373010020003713454f46";
$obj = new \Swoole\Serialize();
$sor = hex2bin($data);
$ser = $obj->unpack($sor);
echo "[+] Swoole Unserialized:\n";
var_dump($ser);
//var_dump($obj->unpack($test));
//Sigsegv 0x1337
?>
```
## Metadata

### Assignees

No one assigned

### Labels

[Bug](https://github.com/swoole/swoole-src/issues?q=state%3Aopen%20label%3A%22Bug%22)[fixed](https://github.com/swoole/swoole-src/issues?q=state%3Aopen%20label%3A%22fixed%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_53431bba_20250125_062704.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswoole%2Fswoole-src%2Fcommit%2F4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswoole%2Fswoole-src%2Fcommit%2F4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommit%2Fshow&source=header-repo&source_repo=swoole%2Fswoole-src)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[swoole](/swoole)
/
**[swoole-src](/swoole/swoole-src)**
Public

* [Notifications](/login?return_to=%2Fswoole%2Fswoole-src) You must be signed in to change notification settings
* [Fork
  3.2k](/login?return_to=%2Fswoole%2Fswoole-src)
* [Star
   18.6k](/login?return_to=%2Fswoole%2Fswoole-src)

* [Code](/swoole/swoole-src)
* [Issues
  93](/swoole/swoole-src/issues)
* [Pull requests
  6](/swoole/swoole-src/pulls)
* [Discussions](/swoole/swoole-src/discussions)
* [Actions](/swoole/swoole-src/actions)
* [Projects
  1](/swoole/swoole-src/projects)
* [Security](/swoole/swoole-src/security)
* [Insights](/swoole/swoole-src/pulse)

Additional navigation options

* [Code](/swoole/swoole-src)
* [Issues](/swoole/swoole-src/issues)
* [Pull requests](/swoole/swoole-src/pulls)
* [Discussions](/swoole/swoole-src/discussions)
* [Actions](/swoole/swoole-src/actions)
* [Projects](/swoole/swoole-src/projects)
* [Security](/swoole/swoole-src/security)
* [Insights](/swoole/swoole-src/pulse)

## Commit

[Permalink](/swoole/swoole-src/commit/4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

add buffer end check

[Browse files](/swoole/swoole-src/tree/4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76)
Browse the repository at this point in the history

* Loading branch information

[![@GXhua](https://avatars.githubusercontent.com/u/7588080?s=40&v=4)](/GXhua)

[GXhua](/swoole/swoole-src/commits?author=GXhua "View all commits by GXhua")
committed
Aug 15, 2018

1 parent
[32dcfe8](/swoole/swoole-src/commit/32dcfe8934c3e1c173fe4667c1f6af4bff7cd3f3)

commit 4cdbce5

Showing
**1 changed file**
with
**87 additions**
and
**77 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

164 changes: 87 additions & 77 deletions

164
[swoole\_serialize.c](#diff-e252171f919c7f929dab0f19c8fd52afc8722116c94b18c000da48bc759098b2 "swoole_serialize.c")

Show comments

[View file](/swoole/swoole-src/blob/4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76/swoole_serialize.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -52,8 +52,10 @@ zend\_class\_entry swoole\_serialize\_ce; |
|  |  | zend\_class\_entry \*swoole\_serialize\_class\_entry\_ptr; |
|  |  |  |
|  |  | #define SWOOLE\_SERI\_EOF "EOF" |
|  |  | #define CHECK\_STEP if(buffer>unseri\_buffer\_end){ php\_error\_docref(NULL TSRMLS\_CC, E\_ERROR, "illegal unserialize data"); return NULL;} |
|  |  |  |
|  |  | static struct \_swSeriaG swSeriaG; |
|  |  | char \*unseri\_buffer\_end = NULL; |
|  |  |  |
|  |  | void swoole\_serialize\_init(int module\_number TSRMLS\_DC) |
|  |  | { |
| Expand Down  Expand Up | | @@ -113,148 +115,149 @@ static CPINLINE void swoole\_check\_size(seriaString \*str, size\_t len) |
|  |  | } |
|  |  | } |
|  |  | #ifdef \_\_SSE2\_\_ |
|  |  |  |
|  |  | void CPINLINE swoole\_mini\_memcpy(void \*dst, const void \*src, size\_t len) |
|  |  | { |
|  |  | register unsigned char \*dd = (unsigned char\*) dst + len; |
|  |  | register const unsigned char \*ss = (const unsigned char\*) src + len; |
|  |  | switch (len) |
|  |  | { |
|  |  | case 68: \*((int\*) (dd - 68)) = \*((int\*) (ss - 68)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 64: \*((int\*) (dd - 64)) = \*((int\*) (ss - 64)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 60: \*((int\*) (dd - 60)) = \*((int\*) (ss - 60)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 56: \*((int\*) (dd - 56)) = \*((int\*) (ss - 56)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 52: \*((int\*) (dd - 52)) = \*((int\*) (ss - 52)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 48: \*((int\*) (dd - 48)) = \*((int\*) (ss - 48)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 44: \*((int\*) (dd - 44)) = \*((int\*) (ss - 44)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 40: \*((int\*) (dd - 40)) = \*((int\*) (ss - 40)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 36: \*((int\*) (dd - 36)) = \*((int\*) (ss - 36)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 32: \*((int\*) (dd - 32)) = \*((int\*) (ss - 32)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 28: \*((int\*) (dd - 28)) = \*((int\*) (ss - 28)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 24: \*((int\*) (dd - 24)) = \*((int\*) (ss - 24)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 20: \*((int\*) (dd - 20)) = \*((int\*) (ss - 20)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 16: \*((int\*) (dd - 16)) = \*((int\*) (ss - 16)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 12: \*((int\*) (dd - 12)) = \*((int\*) (ss - 12)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 8: \*((int\*) (dd - 8)) = \*((int\*) (ss - 8)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 4: \*((int\*) (dd - 4)) = \*((int\*) (ss - 4)); |
|  |  | break; |
|  |  | case 67: \*((int\*) (dd - 67)) = \*((int\*) (ss - 67)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 63: \*((int\*) (dd - 63)) = \*((int\*) (ss - 63)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 59: \*((int\*) (dd - 59)) = \*((int\*) (ss - 59)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 55: \*((int\*) (dd - 55)) = \*((int\*) (ss - 55)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 51: \*((int\*) (dd - 51)) = \*((int\*) (ss - 51)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 47: \*((int\*) (dd - 47)) = \*((int\*) (ss - 47)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 43: \*((int\*) (dd - 43)) = \*((int\*) (ss - 43)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 39: \*((int\*) (dd - 39)) = \*((int\*) (ss - 39)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 35: \*((int\*) (dd - 35)) = \*((int\*) (ss - 35)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 31: \*((int\*) (dd - 31)) = \*((int\*) (ss - 31)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 27: \*((int\*) (dd - 27)) = \*((int\*) (ss - 27)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 23: \*((int\*) (dd - 23)) = \*((int\*) (ss - 23)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 19: \*((int\*) (dd - 19)) = \*((int\*) (ss - 19)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 15: \*((int\*) (dd - 15)) = \*((int\*) (ss - 15)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 11: \*((int\*) (dd - 11)) = \*((int\*) (ss - 11)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 7: \*((int\*) (dd - 7)) = \*((int\*) (ss - 7)); |
|  |  | \*((int\*) (dd - 4)) = \*((int\*) (ss - 4)); |
|  |  | break; |
|  |  | case 3: \*((short\*) (dd - 3)) = \*((short\*) (ss - 3)); |
|  |  | dd[-1] = ss[-1]; |
|  |  | break; |
|  |  | case 66: \*((int\*) (dd - 66)) = \*((int\*) (ss - 66)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 62: \*((int\*) (dd - 62)) = \*((int\*) (ss - 62)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 58: \*((int\*) (dd - 58)) = \*((int\*) (ss - 58)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 54: \*((int\*) (dd - 54)) = \*((int\*) (ss - 54)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 50: \*((int\*) (dd - 50)) = \*((int\*) (ss - 50)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 46: \*((int\*) (dd - 46)) = \*((int\*) (ss - 46)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 42: \*((int\*) (dd - 42)) = \*((int\*) (ss - 42)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 38: \*((int\*) (dd - 38)) = \*((int\*) (ss - 38)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 34: \*((int\*) (dd - 34)) = \*((int\*) (ss - 34)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 30: \*((int\*) (dd - 30)) = \*((int\*) (ss - 30)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 26: \*((int\*) (dd - 26)) = \*((int\*) (ss - 26)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 22: \*((int\*) (dd - 22)) = \*((int\*) (ss - 22)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 18: \*((int\*) (dd - 18)) = \*((int\*) (ss - 18)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 14: \*((int\*) (dd - 14)) = \*((int\*) (ss - 14)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 10: \*((int\*) (dd - 10)) = \*((int\*) (ss - 10)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 6: \*((int\*) (dd - 6)) = \*((int\*) (ss - 6)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 2: \*((short\*) (dd - 2)) = \*((short\*) (ss - 2)); |
|  |  | break; |
|  |  | case 65: \*((int\*) (dd - 65)) = \*((int\*) (ss - 65)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 61: \*((int\*) (dd - 61)) = \*((int\*) (ss - 61)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 57: \*((int\*) (dd - 57)) = \*((int\*) (ss - 57)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 53: \*((int\*) (dd - 53)) = \*((int\*) (ss - 53)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 49: \*((int\*) (dd - 49)) = \*((int\*) (ss - 49)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 45: \*((int\*) (dd - 45)) = \*((int\*) (ss - 45)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 41: \*((int\*) (dd - 41)) = \*((int\*) (ss - 41)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 37: \*((int\*) (dd - 37)) = \*((int\*) (ss - 37)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 33: \*((int\*) (dd - 33)) = \*((int\*) (ss - 33)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 29: \*((int\*) (dd - 29)) = \*((int\*) (ss - 29)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 25: \*((int\*) (dd - 25)) = \*((int\*) (ss - 25)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 21: \*((int\*) (dd - 21)) = \*((int\*) (ss - 21)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 17: \*((int\*) (dd - 17)) = \*((int\*) (ss - 17)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 13: \*((int\*) (dd - 13)) = \*((int\*) (ss - 13)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 9: \*((int\*) (dd - 9)) = \*((int\*) (ss - 9)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 5: \*((int\*) (dd - 5)) = \*((int\*) (ss - 5)); |
|  |  | /\* no break \*/ |
|  |  | /\* no break \*/ |
|  |  | case 1: dd[-1] = ss[-1]; |
|  |  | break; |
|  |  | case 0: |
| Expand Down  Expand Up | | @@ -648,6 +651,7 @@ static void\* swoole\_unserialize\_arr(void \*buffer, zval \*zvalue, uint32\_t nNumOfE |
|  |  | //Initialize zend array |
|  |  | zend\_ulong h, nIndex, max\_index = 0; |
|  |  | uint32\_t size = cp\_zend\_hash\_check\_size(nNumOfElements); |
|  |  | CHECK\_STEP; |
|  |  | if (!size) |
|  |  | { |
|  |  | return NULL; |
| Expand Down  Expand Up | | @@ -727,6 +731,7 @@ static void\* swoole\_unserialize\_arr(void \*buffer, zval \*zvalue, uint32\_t nNumOfE |
|  |  | key\_len = \*((size\_t\*) buffer); |
|  |  | buffer += sizeof (size\_t); |
|  |  | } |
|  |  | CHECK\_STEP; |
|  |  | p->key = zend\_string\_init((char\*) buffer, key\_len, 0); |
|  |  | // h = zend\_inline\_hash\_func((char\*) buffer, key\_len); |
|  |  | h = zend\_inline\_hash\_func((char\*) buffer, key\_len); |
| Expand Down  Expand Up | | @@ -804,6 +809,7 @@ static void\* swoole\_unserialize\_arr(void \*buffer, zval \*zvalue, uint32\_t nNumOfE |
|  |  | data\_len = \*((size\_t\*) buffer); |
|  |  | buffer += sizeof (size\_t); |
|  |  | } |
|  |  | CHECK\_STEP; |
|  |  | p->val.value.str = zend\_string\_init((char\*) buffer, data\_len, 0); |
|  |  | buffer += data\_len; |
|  |  | } |
| Expand Down  Expand Up | | @@ -832,6 +838,7 @@ static void\* swoole\_unserialize\_arr(void \*buffer, zval \*zvalue, uint32\_t nNumOfE |
|  |  |  |
|  |  | } |
|  |  | ht->nNextFreeElement = max\_index; |
|  |  | CHECK\_STEP; |
|  |  |  |
|  |  | return buffer; |
|  |  |  |
| Expand Down  Expand Up | | @@ -995,7 +1002,7 @@ static void swoole\_serialize\_arr(seriaString \*buffer, zend\_array \*zvalue) |
|  |  |  |
|  |  | if (GC\_IS\_RECURSIVE(ht)) |
|  |  | { |
|  |  | ((SBucketType\*) (buffer->buffer + p))->data\_type = IS\_NULL;//reset type null |
|  |  | ((SBucketType\*) (buffer->buffer + p))->data\_type = IS\_NULL; //reset type null |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "the array has cycle ref"); |
|  |  | } |
|  |  | else |
| Expand Down  Expand Up | | @@ -1077,6 +1084,7 @@ static CPINLINE void swoole\_unserialize\_raw(void \*buffer, zval \*zvalue) |
|  |  | } |
|  |  |  |
|  |  | #if 0 |
|  |  |  |
|  |  | /\* |
|  |  | \* null |
|  |  | \*/ |
| Expand Down  Expand Up | | @@ -1250,7 +1258,7 @@ static CPINLINE zend\_class\_entry\* swoole\_try\_get\_ce(zend\_string \*class\_name) |
|  |  | zend\_throw\_exception\_ex(NULL, 0, "can not find class %s", class\_name->val TSRMLS\_CC); |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | zend\_string \*fname = swoole\_string\_init(ZEND\_STRL(PG(unserialize\_callback\_func))); |
|  |  | Z\_STR(user\_func) = fname; |
|  |  | Z\_TYPE\_INFO(user\_func) = IS\_STRING\_EX; |
| Expand Down  Expand Up | | @@ -1282,24 +1290,26 @@ static void\* swoole\_unserialize\_object(void \*buffer, zval \*return\_value, zend\_uc |
|  |  | zval property; |
|  |  | uint32\_t arr\_num = 0; |
|  |  | size\_t name\_len = \*((unsigned short\*) buffer); |
|  |  | CHECK\_STEP; |
|  |  | if (!name\_len) |
|  |  | { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "illegal unserialize data"); |
|  |  | return NULL; |
|  |  | } |
|  |  | buffer += 2; |
|  |  | zend\_string \*class\_name; |
|  |  | if (flag == UNSERIALIZE\_OBJECT\_TO\_STDCLASS) |
|  |  | if (flag == UNSERIALIZE\_OBJECT\_TO\_STDCLASS) |
|  |  | { |
|  |  | class\_name = swoole\_string\_init(ZEND\_STRL("StdClass")); |
|  |  | } |
|  |  | else |
|  |  | } |
|  |  | else |
|  |  | { |
|  |  | class\_name = swoole\_string\_init((char\*) buffer, name\_len); |
|  |  | } |
|  |  | buffer += name\_len; |
|  |  | zend\_class\_entry \*ce = swoole\_try\_get\_ce(class\_name); |
|  |  | swoole\_string\_release(class\_name); |
|  |  | CHECK\_STEP; |
|  |  |  |
|  |  | if (!ce) |
|  |  | { |
| Expand All | | @@ -1311,11 +1321,10 @@ static void\* swoole\_unserialize\_object(void \*buffer, zval \*return\_value, zend\_uc |
|  |  |  |
|  |  | object\_init\_ex(return\_value, ce); |
|  |  |  |
|  |  | zval \*data,\*d; |
|  |  | zval \*data, \*d; |
|  |  | zend\_string \*key; |
|  |  | zend\_ulong index; |
|  |  |  |
|  |  |  |
|  |  | ZEND\_HASH\_FOREACH\_KEY\_VAL(Z\_ARRVAL(property), index, key, data) |
|  |  | { |
|  |  | const char \*prop\_name, \*tmp; |
| Expand All | | @@ -1337,8 +1346,8 @@ static void\* swoole\_unserialize\_object(void \*buffer, zval \*return\_value, zend\_uc |
|  |  | zend\_unmangle\_property\_name\_ex(key, &tmp, &prop\_name, &prop\_len); |
|  |  | zend\_update\_property(ce, return\_value, prop\_name, prop\_len, data); |
|  |  | } |
|  |  | // zend\_hash\_update(Z\_OBJPROP\_P(return\_value),key,data); |
|  |  | // zend\_update\_property(ce, return\_value, ZSTR\_VAL(key), ZSTR\_LEN(key), data); |
|  |  | // zend\_hash\_update(Z\_OBJPROP\_P(return\_value),key,data); |
|  |  | // zend\_update\_property(ce, return\_value, ZSTR\_VAL(key), ZSTR\_LEN(key), data); |
|  |  | } |
|  |  | else |
|  |  | { |
| Expand Down  Expand Up | | @@ -1388,7 +1397,7 @@ static void\* swoole\_unserialize\_object(void \*buffer, zval \*return\_value, zend\_uc |
|  |  | swoole\_string\_release(fname); |
|  |  | zval\_ptr\_dtor(&ret); |
|  |  | } |
|  |  |  |
|  |  | CHECK\_STEP; |
|  |  | return buffer; |
|  |  |  |
|  |  | } |
| Expand Down  Expand Up | | @@ -1486,6 +1495,7 @@ PHPAPI int php\_swoole\_unserialize(void \*buffer, size\_t len, zval \*return\_value, |
|  |  | { |
|  |  | SBucketType type = \*(SBucketType\*) (buffer); |
|  |  | zend\_uchar real\_type = type.data\_type; |
|  |  | unseri\_buffer\_end = buffer + len; |
|  |  | buffer += sizeof (SBucketType); |
|  |  | switch (real\_type) |
|  |  | { |
| Expand All | | @@ -1511,8 +1521,8 @@ PHPAPI int php\_swoole\_unserialize(void \*buffer, size\_t len, zval \*return\_value, |
|  |  | { |
|  |  | if (swoole\_seria\_check\_eof(buffer, len) < 0) |
|  |  | { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "detect the error eof"); |
|  |  | return SW\_FALSE; |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "detect the error eof"); |
|  |  | return SW\_FALSE; |
|  |  | } |
|  |  | unser\_start = buffer - sizeof (SBucketType); |
|  |  | uint32\_t num = 0; |
| Expand All | | @@ -1526,8 +1536,8 @@ PHPAPI int php\_swoole\_unserialize(void \*buffer, size\_t len, zval \*return\_value, |
|  |  | case IS\_UNDEF: |
|  |  | if (swoole\_seria\_check\_eof(buffer, len) < 0) |
|  |  | { |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "detect the error eof"); |
|  |  | return SW\_FALSE; |
|  |  | php\_error\_docref(NULL TSRMLS\_CC, E\_NOTICE, "detect the error eof"); |
|  |  | return SW\_FALSE; |
|  |  | } |
|  |  | unser\_start = buffer - sizeof (SBucketType); |
|  |  | if (!swoole\_unserialize\_object(buffer, return\_value, type.data\_len, object\_args, flag)) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `4cdbce5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fswoole%2Fswoole-src%2Fcommit%2F4cdbce5d9bf2fe596bb6acd7d6611f9e8c253a76) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


