=== Content from gitlab.manjaro.org_245d67c1_20250125_082530.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

## Admin message

GitLab now enforces expiry dates on tokens that originally had no set expiration date. Those tokens were given an expiration date of one year later. Please review your personal access tokens, project access tokens, and group access tokens to ensure you are aware of upcoming expirations. Administrators of GitLab can find more information on how to identify and mitigate interruption in our [documentation](https://docs.gitlab.com/ee/security/token_overview.html#troubleshooting).

## Admin message

Due to an influx of spam, we had to disable account registrations. If you don't have an account yet, please write an email to support@manjaro.org, with your desired username. Sorry for the inconvenience.

* [![Packages](/uploads/-/system/group/avatar/18/package.png?width=16)
  Packages](/packages)
* [core](/packages/core)
* [![manjaro-system](/uploads/-/system/project/avatar/93/manjaro.png?width=16)
  manjaro-system](/packages/core/manjaro-system)
* [Commits](/packages/core/manjaro-system/-/commits/8208b8a)
* [8208b8a7](/packages/core/manjaro-system/-/commit/8208b8a)

**Commit
8208b8a7**

authored
Aug 28, 2018
by
[![Philip Müller's avatar](/uploads/-/system/user/avatar/2/avatar.png?width=48 "Philip Müller")](/philm)
**[Philip Müller](/philm)**

[Browse files](/packages/core/manjaro-system/-/tree/8208b8a7a6e21810ff55822ee5106bf249e1409d)

### [pkg-upd] 20180828-1

```
Note: CVE-2018-15912
```

parent
[a7cfdc2b](/packages/core/manjaro-system/-/commit/a7cfdc2b625d2fbff1ad0d58c458c3ecb7eb00cd)

* [Changes
  1](/packages/core/manjaro-system/-/commit/8208b8a7a6e21810ff55822ee5106bf249e1409d)

[Expand all](/packages/core/manjaro-system/-/commit/8208b8a?expanded=1)
[Hide whitespace changes](/packages/core/manjaro-system/-/commit/8208b8a7a6e21810ff55822ee5106bf249e1409d?action=show&controller=projects%2Fcommit&id=8208b8a&namespace_id=packages%2Fcore&project_id=manjaro-system&w=1)
[Inline](/packages/core/manjaro-system/-/commit/8208b8a?view=inline)
[Side-by-side](/packages/core/manjaro-system/-/commit/8208b8a?view=parallel)

Preview

0%

Try again

or
attach a new file

.

Cancel

You are about to add
**0
people**
to the discussion. Proceed with caution.

Finish editing this message first!

Save comment

Cancel

Please [register](/users/sign_up?redirect_to_referer=yes) or [sign in](/users/sign_in?redirect_to_referer=yes) to comment



=== Content from lists.manjaro.org_684764cd_20250125_082530.html ===

# [manjaro-security] [MSA-201808-1] Local PrivEsc, ACE, and DoS vulnerability in manjaro-system 20180716-1 and earlier

**Philip MÃ¼ller**
philm at manjaro.org

*Tue Aug 28 19:49:28 CEST 2018*

* Previous message (by thread): [[manjaro-security] [ASA-201808-8] thunderbird: multiple issues](000784.html)
* **Messages sorted by:**
  [[ date ]](date.html#785)
  [[ thread ]](thread.html#785)
  [[ subject ]](subject.html#785)
  [[ author ]](author.html#785)

---

```

Manjaro Linux Security Advisory MSA-201808-1
============================================

Severity: Medium
Date    : 2018-08-28
CVE-ID  : CVE-2018-15912
Package : manjaro-system
Type    : Local PrivEsc, ACE and DoS
Remote  : No
Link    : n/a

Summary
=======

The package manjaro-system before version 20180828-1 is vulnerable to
local PrivEsc, ACE and DoS attacks.

Resolution
==========

Upgrade to 20180828-1.

# pacman -Syu "manjaro-system>=20180828-1"

The issue was fixed via 'manjaro-system 20180828-1' [1] package.

[1] <https://gitlab.manjaro.org/packages/core/manjaro-system/commit/8208b8a>

-------- Weitergeleitete Nachricht --------
Betreff: Local PrivEsc, ACE, and DoS vulnerability in manjaro-system
20180716-1 and earlier
Datum: Tue, 28 Aug 2018 01:43:18 +0200
Von: Robin Broda <[robin at broda.me](https://lists.manjaro.org/mailman/listinfo/manjaro-security)>
An: [jonathon at manjaro.org](https://lists.manjaro.org/mailman/listinfo/manjaro-security)
Kopie (CC): [philm at manjaro.org](https://lists.manjaro.org/mailman/listinfo/manjaro-security), [eschwartz at archlinux.org](https://lists.manjaro.org/mailman/listinfo/manjaro-security)

Hello,

I have discovered an issue with one of your core Manjaro packages,
`manjaro-system` 20180716-1 and earlier.
The issue allows a local attacker to execute a Denial of Service,
Arbitrary Code Execution, and Privilege Escalation attack.

More specifically, the pacman post-upgrade hook `manjaro-update-system.sh`.
The hook stores state in several files under `/tmp/` using the naming
scheme `/tmp/cmdN` - where N is a number starting at 1.
Before the hook is ran, these files do not exist, and as such any user
(i.e. `nobody`) may create a file with the same name.

That works because /tmp/ is shared and writable by everyone,
and because the bash redirection `>` used in the hook does not
*recreate* the files
but rather opens them for writing, so if `/tmp/cmdN` does *not* exist
before running the hook
they will be created as root:root, whereas any existing files under that
name will keep their current permissions - an attacker can thus start a
TOCTOU race writing a payload to these files like so:

To set up the payload injection, a couple values have to be written into
otherwise unrelated files:
`nvidia-utils` to `/tmp/cmd1`
`` to `/tmp/cmd3`
`a` (or any arbitrary non-zero length string) to `/tmp/cmd4`

Now, an attacker can write any arbitrary list of packages or pacman
options into `/tmp/cmd5`
this causes the checks on line 60 and 69 of `manjaro-update-system.sh`
to succeed, and then run
`pacman --noconfirm -Rdd $(cat /tmp/cmd5)`, and
`pacman --noconfirm -S $(cat /tmp/cmd5 | sed 's|nvidia|nvidia-390xx|g')`

This allows a local attacker to:
- Remove arbitrary packages skipping dependency checks
- Install arbitrary packages
- Pass arbitrary options to pacman
  - This would allow for strings like `-y --config /tmp/malicious.conf
--overwrite '*' malicious-package` which:
    - Pulls fresh repos using a custom config path
    - Install the arbitrary package `malicious-package` provided by a
custom repo defined in `malicious.conf`
      - This package will run its pacman hooks (as root!)
      - using `--overwrite '*'` allows us to replace arbitrary system
files by providing them in malicious-package

An advanced Proof-of-Concept script, written by Eli Schwartz and me,
tested on a recent Manjaro ISO with manjaro-system 20180716-1, is
attached to this mail.
To execute, run the attached script as any user on a freshly booted
system and then reinstall manjaro-system
or run a full system upgrade that happens to upgrade manjaro-system.

I would advise against running the PoC on a production machine as it may
not clean up after itself.

I will be requesting a CVE at Mitre shortly after sending this mail,
which will then be updated with information about the vulnerability
shortly after the vulnerability has been fixed.

Regards,
Robin Broda

-------------- next part --------------
A non-text attachment was scrubbed...
Name: manjaro-system-exploit.sh
Type: application/x-shellscript
Size: 2297 bytes
Desc: not available
URL: <<http://lists.manjaro.org/pipermail/manjaro-security/attachments/20180828/d4b87da4/attachment.bin>>

```

---

* Previous message (by thread): [[manjaro-security] [ASA-201808-8] thunderbird: multiple issues](000784.html)
* **Messages sorted by:**
  [[ date ]](date.html#785)
  [[ thread ]](thread.html#785)
  [[ subject ]](subject.html#785)
  [[ author ]](author.html#785)

---

[More information about the manjaro-security
mailing list](https://lists.manjaro.org/mailman/listinfo/manjaro-security)


