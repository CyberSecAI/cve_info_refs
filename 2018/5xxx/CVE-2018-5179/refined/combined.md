=== Content from bugzilla.mozilla.org_f9cc3774_20250126_060157.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1435908)
* [XML](/show_bug.cgi?ctype=xml&id=1435908)

Closed
[Bug 1435908](/show_bug.cgi?id=1435908)
(CVE-2018-5182)

Opened 7 years ago
Closed 7 years ago

# Web content can open local files and local folders using drag & drop event

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Web content can open local files and local folders using drag & drop event

## Categories

### (Core :: DOM: Copy & Paste and Drag & Drop, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop#DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop)

DOM: Copy & Paste and Drag & Drop
▾

Core :: DOM: Copy & Paste and Drag & Drop
All issues with copy-and-paste and drag-and-drop can be reported here, be it with the web API or the platform backends. This includes clipboard issues.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Copy%20%26%20Paste%20and%20Drag%20%26%20Drop)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

58 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla60

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix) |
| firefox58 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix) |
| firefox59 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix) |
| firefox60 | --- | [verified](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=verified) |
| firefox61 | --- | [verified](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox58 |  | wontfix |
| firefox59 |  | wontfix |
| firefox60 |  | verified |
| firefox61 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jordi.chancel, Assigned: arai)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/6b706eda3bfffb0365f10d465e37a53e?d=mm&size=40)  [arai](/user_profile?user_id=310076)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2f44e5e3d7f8be8131ae968ecb363bd?d=mm&size=40)  [jordi.chancel](/user_profile?user_id=356614)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: reporter-external, sec-low, Whiteboard: [adv-main60+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-5182

[Keywords:](/describekeywords.cgi)

[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main60+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c29 "7 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 4 obsolete files)

| [testcase-drag-drop-local-file-opening.html](/attachment.cgi?id=8948559)  [7 years ago](#c0)  [Jordi Chancel](/user_profile?user_id=356614)   1.76 KB, text/html |  | [Details](/attachment.cgi?id=8948559&action=edit) |
| --- | --- | --- |
| [testcase-drag-drop-local-file-opening-[reduced testcase].html](/attachment.cgi?id=8948603)  [7 years ago](#c1)  [Jordi Chancel](/user_profile?user_id=356614)   1.59 KB, text/html |  | [Details](/attachment.cgi?id=8948603&action=edit) |
| [video-demo.html](/attachment.cgi?id=8948663)  [7 years ago](#c2)  [Jordi Chancel](/user_profile?user_id=356614)   315 bytes, text/html |  | [Details](/attachment.cgi?id=8948663&action=edit) |
| [Apply URL fixup in contentAreaDropListener.](/attachment.cgi?id=8953059)  [7 years ago](#c7)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   2.88 KB, patch | Gijs : [review-](#c8 "7 years ago") | [Details](/attachment.cgi?id=8953059&action=edit) | [Diff](/attachment.cgi?id=8953059&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953059) |
| [Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.](/attachment.cgi?id=8953753)  [7 years ago](#c11)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   3.14 KB, patch |  | [Details](/attachment.cgi?id=8953753&action=edit) | [Diff](/attachment.cgi?id=8953753&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953753) |
| [Validate non-URI items when dropping items.](/attachment.cgi?id=8953828)  [7 years ago](#c15)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   1.59 KB, patch |  | [Details](/attachment.cgi?id=8953828&action=edit) | [Diff](/attachment.cgi?id=8953828&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953828) |
| [Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.](/attachment.cgi?id=8954278)  [7 years ago](#c18)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   4.67 KB, patch | Gijs : [review+](#c22 "7 years ago") | [Details](/attachment.cgi?id=8954278&action=edit) | [Diff](/attachment.cgi?id=8954278&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954278) |
| [Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.](/attachment.cgi?id=8954279)  [7 years ago](#c19)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   6.26 KB, patch | Gijs : [review+](#c23 "7 years ago") | [Details](/attachment.cgi?id=8954279&action=edit) | [Diff](/attachment.cgi?id=8954279&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954279) |
| [Part 3: Pass the triggering principal when opening an URI from location bar drag and drop.](/attachment.cgi?id=8954280)  [7 years ago](#c20)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   6.67 KB, patch | Gijs : [review+](#a1898759_159069 "7 years ago") | [Details](/attachment.cgi?id=8954280&action=edit) | [Diff](/attachment.cgi?id=8954280&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954280) |
| [Part 4: Pass the triggering principal when opening an URI in non-tab browser drag and drop.](/attachment.cgi?id=8954281)  [7 years ago](#c21)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   3.48 KB, patch | Gijs : [review+](#a1898848_159069 "7 years ago") | [Details](/attachment.cgi?id=8954281&action=edit) | [Diff](/attachment.cgi?id=8954281&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954281) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1435908#c0)• 7 years ago |
|  | |

Attached file
[testcase-drag-drop-local-file-opening.html](attachment.cgi?id=8948559) (obsolete)
— [Details](attachment.cgi?id=8948559&action=edit)

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.10; rv:58.0) Gecko/20100101 Firefox/58.0
Build ID: 20180128191252
Steps to reproduce:
-1: Open the Test case in Attachments with Firefox.
-2: Try to Drag and drop the link <https://www.bankofamerica.com/> into the Addressbar or Tab bar.
Actual results:
Firefox loads the local folder: File:///etc/ .
(I will upload a demonstration video)
Expected results:
The testcase works on Firefox 58.0.1 and also on Firefox Beta 59.0b6.

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1435908#c1)• 7 years ago |
|  | |

Attached file
[testcase-drag-drop-local-file-opening-[reduced testcase].html](attachment.cgi?id=8948603)
— [Details](attachment.cgi?id=8948603&action=edit)

reduced testcase
[Attachment #8948559](/attachment.cgi?id=8948559&action=edit "testcase-drag-drop-local-file-opening.html") -
Attachment is obsolete: true

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1435908#c2)• 7 years ago |
|  | |

Attached file
[video-demo.html](attachment.cgi?id=8948663)
— [Details](attachment.cgi?id=8948663&action=edit)

Here's the demo video.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1435908#c3)• 7 years ago |
|  | |

flagging for a bounty as asked, but this rings a bell. Need to check whether this is a dupe of one qab submitted.Flags: sec-bounty?

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1435908#c4)• 7 years ago |
|  | |

More detailed information about Steps to reproduce of this local files / local folders access vulnerability:
A selected content
(like these: // , //etc/ , //etc/ , //etc///////// , ...)
on the attacker's webpage can open local files or local folders when this content is dragged and dropped into the addressbar or tab bar.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a239163_1689)• 7 years ago |

Flags: needinfo?(dveditz)

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a742076_356614)• 7 years ago |

Flags: needinfo?(jordi.chancel)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1435908#c5)• 7 years ago |
|  | |

I was thinking of [bug 1424107](/show_bug.cgi?id=1424107 "RESOLVED FIXED - Drag and dropping file: URL into new tab with rel=noopener allows opening locally stored files") and [bug 1379842](/show_bug.cgi?id=1379842 "VERIFIED FIXED - Web content can open local files by hooking drag and drop to outside of content"). Both are now fixed so obviously this is a separate case. Tooru probably knows what's going on here.Component: General → Drag and DropFlags: needinfo?(dveditz) → needinfo?(arai.unmht)Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a1294846_1689)• 7 years ago |

Group: core-security → dom-core-security

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1435908#c6)• 7 years ago |
|  | |

Currently we're checking the access based on the original string,
but apparently URIFixup that is applied later fixes "//etc/" to "file:///etc/".
so, I think we should check the access based on fixed-up string, inside contentAreaDropListener.
The change in [bug 1435910](/show_bug.cgi?id=1435910 "RESOLVED FIXED - Dragging multiple lines of text to the tab bar creates multiple tabs") will help making this process easier.Assignee: nobody → arai.unmhtStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1435908#c7)• 7 years ago |
|  | |

Attached patch

[Apply URL fixup in contentAreaDropListener.](attachment.cgi?id=8953059&action=diff) (obsolete)
— [Details](attachment.cgi?id=8953059&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953059)

Now ContentAreaDropListener.prototype.\_validateURI applies URI fixup before checking the uri.Flags: needinfo?(arai.unmht)
[Attachment #8953059](/attachment.cgi?id=8953059&action=edit "Apply URL fixup in contentAreaDropListener.") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1435908#c8)• 7 years ago |
|  | |

Comment on [attachment 8953059](/attachment.cgi?id=8953059 "Apply URL fixup in contentAreaDropListener.") [[details]](/attachment.cgi?id=8953059&action=edit "Apply URL fixup in contentAreaDropListener.") [[diff]](/attachment.cgi?id=8953059&action=diff "Apply URL fixup in contentAreaDropListener.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953059)
Apply URL fixup in contentAreaDropListener.
Review of [attachment 8953059](/attachment.cgi?id=8953059 "Apply URL fixup in contentAreaDropListener.") [[details]](/attachment.cgi?id=8953059&action=edit "Apply URL fixup in contentAreaDropListener.") [[diff]](/attachment.cgi?id=8953059&action=diff "Apply URL fixup in contentAreaDropListener.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953059):
-----------------------------------------------------------------
I added some comments to the approach in this patch.
However, I'm worried about this more generally. checkLoadURIStr tries to use fixup anyway (see <https://searchfox.org/mozilla-central/source/caps/nsScriptSecurityManager.cpp#1048> and lower). But it apparently doesn't attempt to do fixup if creating the URI initially fails. I think that's the problem we should fix instead. That may also help [bug 1427448](/show_bug.cgi?id=1427448 "RESOLVED FIXED - Some web extension API's do not account for shorthand form of file:// url"). Unfortunately I don't know how much breaks, and pushing to try risks exposing this set of bugs.
::: dom/base/contentAreaDropListener.js
@@ +134,5 @@
> + Ci.nsIURIFixup.FIXUP\_FLAG\_ALLOW\_KEYWORD\_LOOKUP;
> + let info = Services.uriFixup.getFixupURIInfo(uriString, fixupFlags);
> + if (info.fixedURI) {
> + uriStringToCheck = info.fixedURI.spec;
> + }
Instead, can you define `uri` earlier and assign info.fixedURI to it, and then not call ioService.newURI if `uri` is non-null?
@@ +142,5 @@
> .getService(Components.interfaces.nsIIOService);
> try {
> // Check that the uri is valid first and return an empty string if not.
> // It may just be plain text and should be ignored here
> + uri = ioService.newURI(uriStringToCheck);
If we're here anyway, use Services.io instead and delete the manual getting of the ioservice.
@@ +158,5 @@
> if (disallowInherit)
> flags |= secMan.DISALLOW\_INHERIT\_PRINCIPAL;
>
> let principal = this.\_getTriggeringPrincipalFromDataTransfer(dataTransfer, false);
> + secMan.checkLoadURIStrWithPrincipal(principal, uriStringToCheck, flags);
If we're guaranteed a uri instance here, shouldn't we be calling checkLoadURIWithPrincipal?
[Attachment #8953059](/attachment.cgi?id=8953059&action=edit "Apply URL fixup in contentAreaDropListener.") -
Flags: review?(gijskruitbosch+bugs) → review-

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1435908#c9)• 7 years ago |
|  | |

To rephrase the top of [comment 8](/show_bug.cgi?id=1435908#c8 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") - I am not sure that only fixing the dnd case here is the best solution. The long-term solution is passing the right principal along so that docshell stops the load and then we can stop doing all these manual checks. :jkt is working on this elsewhere already, and we :arai recently fixed [bug 1424107](/show_bug.cgi?id=1424107 "RESOLVED FIXED - Drag and dropping file: URL into new tab with rel=noopener allows opening locally stored files") - does that not help here? Do we not pass the triggering principal along correctly, or something?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1435908#c10)• 7 years ago |
|  | |

(sorry for spam)
The generic triggering principal bug :jkt is working on is [bug 1374741](/show_bug.cgi?id=1374741 "RESOLVED FIXED - Have openUILinkIn() provide the correct triggeringPrincipal").

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1435908#c11)• 7 years ago |
|  | |

Attached patch

[Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.](attachment.cgi?id=8953753&action=diff) (obsolete)
— [Details](attachment.cgi?id=8953753&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953753)

Okay, stopping early-return for non-URI case fixes the issue.
[Attachment #8953059](/attachment.cgi?id=8953059&action=edit "Apply URL fixup in contentAreaDropListener.") -
Attachment is obsolete: true
[Attachment #8953753](/attachment.cgi?id=8953753&action=edit "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1435908#c12)• 7 years ago |
|  | |

Comment on [attachment 8953753](/attachment.cgi?id=8953753 "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[details]](/attachment.cgi?id=8953753&action=edit "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[diff]](/attachment.cgi?id=8953753&action=diff "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953753)
Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.
Review of [attachment 8953753](/attachment.cgi?id=8953753 "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[details]](/attachment.cgi?id=8953753&action=edit "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[diff]](/attachment.cgi?id=8953753&action=diff "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953753):
-----------------------------------------------------------------
I'm really sorry, I think I must have been confused when I wrote my previous comment.
The nsScriptSecurityManager code will throw if you pass it something that isn't a URI. That means it'll already deny these loads. The only thing that changing nsScriptSecurityManager can do for non-valid URIs is be less strict than it is already (logically speaking - right now it throws, the thing we'd accomplish here is... making it also throw, just later. The change may still make sense for the webextension bug, I'm not sure, but that's a separate discussion.
The reason this patch works for the dnd case is that by removing the URI construction in contentAreaDropListener (which catches the cases where the URI isn't valid and returns early without doing the security check), we stop returning early. So now that code will throw (because checkLoadURI throws). That helps for this case, but it also means \_validateURI will start throwing for all the things that aren't intended to be URIs, per the comment ("It may just be plain text and should be ignored here").
In other words, we could fix this bug by just removing only that block and leaving it at that... but what would that break? Is that comment just outdated and do we already catch errors from validateURI and go "huh, I guess this isn't a URI" ? Or how does it work for the cases where the user drops/pastes plaintext?
(:bz, sorry, I CC'd you because I intended to pass this review on given I'd suggested the approach, and then realized the approach was bogus anyway. Un-CC'ing you myself now would be confusing because you'd get bugmail and then still not be able to access the bug, so leaving you here both for clarity and in case you have suggestions/ideas. Feel free to un-cc.)
[Attachment #8953753](/attachment.cgi?id=8953753&action=edit "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") -
Flags: review?(gijskruitbosch+bugs)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1435908#c13)• 7 years ago |
|  | |

here's the list of consumers of \_validateURI (reversed call tree)
ContentAreaDropListener.prototype.\_validateURI
ContentAreaDropListener.prototype.dropLinks
browserDragAndDrop.dropLinks
homeButtonObserver.onDrop => sets links as homepage
newTabButtonObserver.onDrop => opens links in new tabs
newWindowButtonObserver.onDrop => opens links in new windows
tabbrowser-tabs.drop handler => loads links in tabs
urlbar.\_getDroppableItem => returns null if dropLinks throws
urlbar.onDragOver => sets aEvent.dataTransfer.dropEffect to none
urlbar.onDrop => sets the first item to the URL bar text
DownloadsPlacesView.prototype.onDrop => downloads links
DownloadsIndicatorView.onDrop => save links
nsDocShellTreeOwner::HandleEvent => opens the first link in current tab
and opens the other links in new tabs
(done by parent. another validation is
done on parent side)
browser.drop handler => passes to this.droppedLinkHandler
(that is handleDroppedLink,
that opens links in new tabs)
So, in almost all cases the callers are going to treat the returned links as URL.
and in that case validating non-URL as URL by fixup is fine.
The only problematic case is urlbar, that sets the dropped text as URL bar content, that can be non-URL at that moment.
I'll try fixing that case.
so that we can just fix ContentAreaDropListener.prototype.\_validateURI to apply fixup in all cases.

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1435908#c14)• 7 years ago |
|  | |

(In reply to Tooru Fujisawa [:arai] from [comment #13](/show_bug.cgi?id=1435908#c13 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event"))
> urlbar.\_getDroppableItem => returns null if dropLinks throws
> urlbar.onDragOver => sets aEvent.dataTransfer.dropEffect to none
> urlbar.onDrop => sets the first item to the URL bar text
> DownloadsPlacesView.prototype.onDrop => downloads links
> ...
> The only problematic case is urlbar, that sets the dropped text as URL bar
> content, that can be non-URL at that moment.
> I'll try fixing that case.
> so that we can just fix ContentAreaDropListener.prototype.\_validateURI to
> apply fixup in all cases.
err, sorry I overlooked that it triggers command after setting the value.
so, just throwing there should also be fine.
<https://searchfox.org/mozilla-central/rev/ecb86060b4c5a9808798b81a57e79e821bb47082/browser/base/content/urlbarBindings.xml#1057-1060>
> <method name="onDrop">
> <parameter name="aEvent"/>
> <body><![CDATA[
> let droppedItem = this.\_getDroppableItem(aEvent);
> if (droppedItem) {
> this.value = droppedItem instanceof URL ? droppedItem.href : droppedItem;
> SetPageProxyState("invalid");
> this.focus();
> this.handleCommand();

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1435908#c15)• 7 years ago |
|  | |

Attached patch

[Validate non-URI items when dropping items.](attachment.cgi?id=8953828&action=diff) (obsolete)
— [Details](attachment.cgi?id=8953828&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953828)

Removed the change to nsScriptSecurityManager.
[Attachment #8953753](/attachment.cgi?id=8953753&action=edit "Check non-URI items in nsScriptSecurityManager::CheckLoadURIStrWithPrincipal.") -
Attachment is obsolete: true
[Attachment #8953828](/attachment.cgi?id=8953828&action=edit "Validate non-URI items when dropping items.") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1435908#c16)• 7 years ago |
|  | |

Comment on [attachment 8953828](/attachment.cgi?id=8953828 "Validate non-URI items when dropping items.") [[details]](/attachment.cgi?id=8953828&action=edit "Validate non-URI items when dropping items.") [[diff]](/attachment.cgi?id=8953828&action=diff "Validate non-URI items when dropping items.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953828)
Validate non-URI items when dropping items.
Review of [attachment 8953828](/attachment.cgi?id=8953828 "Validate non-URI items when dropping items.") [[details]](/attachment.cgi?id=8953828&action=edit "Validate non-URI items when dropping items.") [[diff]](/attachment.cgi?id=8953828&action=diff "Validate non-URI items when dropping items.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8953828):
-----------------------------------------------------------------
I'm sorry, I think my previous review was not clear:
(In reply to :Gijs from [comment #12](/show_bug.cgi?id=1435908#c12 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event"))
> In other words, we could fix this bug by just removing only that block and
> leaving it at that... but what would that break? Is that comment just
> outdated and do we already catch errors from validateURI and go "huh, I
> guess this isn't a URI" ? Or how does it work for the cases where the user
> drops/pastes plaintext?
As I suspected, this breaks e.g. dragging "ab cd" to the tabstrip, and having it open a web search (at least, that's what I'm seeing testing this change locally). I imagine similar things break for the other cases. We shouldn't break that.
Taking several steps back...
The proper thing to do here is to check the final URI that's loaded against the original principal that triggered such a load. In Nightly, I think this already happens for the tabstrip ( <https://dxr.mozilla.org/mozilla-central/rev/7208b6a7b11c3ed8c87a7f17c9c30a8f9583e791/browser/base/content/tabbrowser.xml#7656,7673,7681> ) note that [comment #0](/show_bug.cgi?id=1435908#c0 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") omits 60 - did this get fixed for 60 by [bug 1424107](/show_bug.cgi?id=1424107 "RESOLVED FIXED - Drag and dropping file: URL into new tab with rel=noopener allows opening locally stored files")?
I am less sure what's happening for the URL bar off-hand. We should ensure that the right triggering principal is passed there, too. Note that I think <https://dxr.mozilla.org/mozilla-central/rev/7208b6a7b11c3ed8c87a7f17c9c30a8f9583e791/browser/base/content/urlbarBindings.xml#1019-1034> should be updated to get the triggering principal off the event instead of checking browser.contentPrincipal. We should also somehow pass the triggering principal to handleCommand when executing the load.
We should probably check other callers to see if they execute loads (off-hand based on the reverse calltree in the comment, I expect e.g. the downloads button will do this too) and have similar fixes there.
There are some cases where this isn't a complete fix. Notably, dragging to some other UI elements will not actually execute a load but create a bookmark or similar.
In that case, we still need to do some kind of manual check, I guess. The problem is that in some cases we just want to paste plain text, it seems? We should avoid breaking [bug 1435910](/show_bug.cgi?id=1435910 "RESOLVED FIXED - Dragging multiple lines of text to the tab bar creates multiple tabs") . If we just fix up every line allowing for search bar fixup, we will always find a link (you can always do a search, of course) which would regress that.
So what I think we should do is both:
1) fix up callsites like the url bar, downloads button etc. to ensure they pass the right triggering principal. This will stop the load at the docshell level.
2) something similar to the first patch on this bug (now marked obsolete) that I r-'d (sorry!). Instead of checking Services.io.newURI, use fixup to get a URI. Pass the typo and search flags like the patch did. However, if the fixup info's `keywordProviderName` is non-empty, pass back the original string. This will mean that we're going to execute a search if allowed, and otherwise we won't find a URL (or, if being very liberal, we'll create a URL from a single word, but that will necessarily be an http URI so loading it should be OK). If we the `keywordProviderName` is empty we've fixed up to have a URI object in `fixedURI`. Pass the URI object (and not the uristring) to scriptSecurityManager.checkLoadURIWithPrincipal (note: not checkLoadURI\*String\*WithPrincipal), and if successful, pass back that URI's spec (not the original input).
Note that (2) is overly complicated to handle the case where a line just contains a single word. If people drag 'security' to the tabstrip or similar, they'll want a search for 'security', not loading "<http://security/>", even if that's what fixup will suggest if we don't pass the search keyword flag.
:arai, does that seem sensible? Happy to discuss this more on IRC / vidyo / bugzilla if that's helpful.
[Attachment #8953828](/attachment.cgi?id=8953828&action=edit "Validate non-URI items when dropping items.") -
Flags: review?(gijskruitbosch+bugs)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1435908#c17)• 7 years ago |
|  | |

Yes, that plan sounds good.
I've modified code and looks like they're working.
here's the same tree from ([comment #13](/show_bug.cgi?id=1435908#c13 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event")) with how principal is/was used for each case:
(reverse call tree)
ContentAreaDropListener.prototype.\_validateURI
ContentAreaDropListener.prototype.dropLinks
browserDragAndDrop.dropLinks
homeButtonObserver.onDrop => sets links as homepage
\*\* doesn't load immediately, we should rely on validation in ContentAreaDropListener \*\*
newTabButtonObserver.onDrop => opens links in new tabs
\*\* wasn't using triggering principal, FIXED \*\*
newWindowButtonObserver.onDrop => opens links in new windows
\*\* wasn't using triggering principal, FIXED \*\*
tabbrowser-tabs.drop handler => loads links in tabs
\*\* is using triggering principal, OK \*\*
urlbar.\_getDroppableItem => returns null if dropLinks throws
urlbar.onDragOver => sets aEvent.dataTransfer.dropEffect to none
\*\* doesn't use links, OK \*\*
urlbar.onDrop => loads a link
\*\* wasn't using triggering principal, FIXED \*\*
DownloadsPlacesView.prototype.onDrop => downloads links
\*\* seems to be using system principal, but I cannot locate the actual call path, NEEDS FIX? \*\*
DownloadsIndicatorView.onDrop => save links
\*\* is using system principal, NEEDS FIX \*\*
nsDocShellTreeOwner::HandleEvent => opens the first link in current tab
and opens the other links in new tabs
(done by parent. another validation is
done on parent side)
\*\* is using triggering principal for normal case, OK \*\*
\*\* wasn't using triggering principal for non-tab browser, FIXED \*\*
browser.drop handler => passes to this.droppedLinkHandler
(that is handleDroppedLink,
that opens links in new tabs)
\*\* is using triggering principal, OK \*\*
Now almost all cases use triggering principal.
Even if we don't validate the URL in ContentAreaDropListener, they can block the loading.
(but the timing is very late, like, new blank tab or new window can be opened, so it's better keeping the validation in ContentAreaDropListener anyway)
The remaining cases are download:
\* library window (DownloadsPlacesView)
\* download indicator button (DownloadsIndicatorView)
for download indicator, it seems to be possible to pass triggering principal
(it's long way tho)
(non-reverse call tree)
DownloadsIndicatorView.onDrop
saveURL
internalSave
internalPersist
nsWebBrowserPersist::SavePrivacyAwareURI
nsWebBrowserPersist::SaveURIInternal
\*\* uses system principal when creating channel \*\*
for library window, it seems to be hard.
currently download item doesn't have triggering principal information.
then, apart from ContentAreaDropListener,
creating bookmark surely doesn't validate the URL. I'll look into it (but maybe we should leave it to other bug?).
for now, I'll post patches for other already-fixed cases.

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1435908#c18)• 7 years ago |
|  | |

Attached patch

[Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.](attachment.cgi?id=8954278&action=diff)
— [Details](attachment.cgi?id=8954278&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954278)

This is the main fix that uses fixed-up URI for validation.
Now it does validation only if fixup returns non-search URL.
[Attachment #8953828](/attachment.cgi?id=8953828&action=edit "Validate non-URI items when dropping items.") -
Attachment is obsolete: true
[Attachment #8954278](/attachment.cgi?id=8954278&action=edit "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") -
Flags: review?(gijskruitbosch+bugs)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1435908#c19)• 7 years ago |
|  | |

Attached patch

[Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.](attachment.cgi?id=8954279&action=diff)
— [Details](attachment.cgi?id=8954279&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954279)

This fixes New Tab button and New Window button,
openNewTabWith and openNewWindowWith are modified to receive parameter object,
since some parameters are not used and adding more makes it complicated.
now triggering principal is passed to openLinkIn via them.
[Attachment #8954279](/attachment.cgi?id=8954279&action=edit "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") -
Flags: review?(gijskruitbosch+bugs)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1435908#c20)• 7 years ago |
|  | |

Attached patch

[Part 3: Pass the triggering principal when opening an URI from location bar drag and drop.](attachment.cgi?id=8954280&action=diff)
— [Details](attachment.cgi?id=8954280&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954280)

This fixed URL bar.
now it passes triggering principal to openUILinkIn.
and also it uses triggering principal for urlSecurityCheck.
[Attachment #8954280](/attachment.cgi?id=8954280&action=edit "Part 3: Pass the triggering principal when opening an URI from location bar drag and drop.") -
Flags: review?(gijskruitbosch+bugs)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1435908#c21)• 7 years ago |
|  | |

Attached patch

[Part 4: Pass the triggering principal when opening an URI in non-tab browser drag and drop.](attachment.cgi?id=8954281&action=diff)
— [Details](attachment.cgi?id=8954281&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954281)

I cannot locate the case that this becomes really a problem tho, just fixed at the same time.
If user drops item to xul:browser without tabbrowser, this code will be used
(but there seems to be no such case. sidebar doesn't accept drop)
now it passes the triggering principal to LoadURI.
For now, that's all I've fixed.
[Attachment #8954281](/attachment.cgi?id=8954281&action=edit "Part 4: Pass the triggering principal when opening an URI in non-tab browser drag and drop.") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1435908#c22)• 7 years ago |
|  | |

Comment on [attachment 8954278](/attachment.cgi?id=8954278 "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[details]](/attachment.cgi?id=8954278&action=edit "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[diff]](/attachment.cgi?id=8954278&action=diff "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954278)
Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.
Review of [attachment 8954278](/attachment.cgi?id=8954278 "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[details]](/attachment.cgi?id=8954278&action=edit "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[diff]](/attachment.cgi?id=8954278&action=diff "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954278):
-----------------------------------------------------------------
Thanks, and sorry for the several rounds of review here...
[Attachment #8954278](/attachment.cgi?id=8954278&action=edit "Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string.") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1435908#c23)• 7 years ago |
|  | |

Comment on [attachment 8954279](/attachment.cgi?id=8954279 "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[details]](/attachment.cgi?id=8954279&action=edit "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[diff]](/attachment.cgi?id=8954279&action=diff "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954279)
Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.
Review of [attachment 8954279](/attachment.cgi?id=8954279 "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[details]](/attachment.cgi?id=8954279&action=edit "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[diff]](/attachment.cgi?id=8954279&action=diff "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435908&attachment=8954279):
-----------------------------------------------------------------
Nice. Can you file a follow-up to just get rid of openNewTab/WindowWith? They seem like useless wrappers at this point. We have too many ways of opening tabs and windows, losing these won't hurt anyone.
::: browser/base/content/utilityOverlay.js
@@ +858,4 @@
> \* @param aShiftKey
> \* True if shift key is held. This value is used for the purpose of
> \* determining whether to open in the background.
> + \* @param aParam
Nit: match up with the actual parameter name please. :-)
@@ +868,2 @@
> if (document.documentElement.getAttribute("windowtype") == "navigator:browser")
> + aParams.charset = gBrowser.selectedBrowser.characterSet;
The test in <https://dxr.mozilla.org/mozilla-central/source/browser/base/content/test/general/browser_utilityOverlay.js#93> won't like this because `aParams` will be null. So maybe just set a default in the signature, ie `aParams = {}`
[Attachment #8954279](/attachment.cgi?id=8954279&action=edit "Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop.") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1435908#c24)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #23](/show_bug.cgi?id=1435908#c23 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event"))
> The test in
> <https://dxr.mozilla.org/mozilla-central/source/browser/base/content/test/>
> [general/browser\_utilityOverlay.js#93](https://github.com/general/browser_utilityOverlay.js/issues/93) won't like this because `aParams` will
> be null. So maybe just set a default in the signature, ie `aParams = {}`
Oh, and same thing for the window case, of course.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a1898759_159069)• 7 years ago |

[Attachment #8954280](/attachment.cgi?id=8954280&action=edit "Part 3: Pass the triggering principal when opening an URI from location bar drag and drop.") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a1898848_159069)• 7 years ago |

[Attachment #8954281](/attachment.cgi?id=8954281&action=edit "Part 4: Pass the triggering principal when opening an URI in non-tab browser drag and drop.") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1435908#c25)• 7 years ago |
|  | |

I think it's fine to deal with the download button / view and library in a follow-up bug given:
- [comment #0](/show_bug.cgi?id=1435908#c0 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") doesn't mention them
- this is sec-low anyway
- fixing the issue in the validation (which I think should help for those consumers, too?)
- number of patches already here,
- how this relates to the openUILinkIn patches + [bug 1435910](/show_bug.cgi?id=1435910 "RESOLVED FIXED - Dragging multiple lines of text to the tab bar creates multiple tabs") + [bug 1319157](/show_bug.cgi?id=1319157 "RESOLVED FIXED - Home button drop handler should urlSecurityCheck all the links in a pipe (|) separated set of URLs dropped on it")
so yeah, feel free to land and deal with any remaining issues in follow-ups.

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1435908#c26)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/e15580a14db7fabbbf106b008e1055b54e020ad8>
[Bug 1435908](/show_bug.cgi?id=1435908 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") - Part 1: Get triggering principal before loop, and use URI fixup to create URI from given string. r=Gijs
<https://hg.mozilla.org/integration/mozilla-inbound/rev/c04b1745f4ae3fd4f0fcbfcf7733bb6be5f2587f>
[Bug 1435908](/show_bug.cgi?id=1435908 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") - Part 2: Pass the triggering principal when opening an URI from new tab button and new window button drag and drop. r=Gijs
<https://hg.mozilla.org/integration/mozilla-inbound/rev/5c38100787fc4c3a88d89cdb247b6b9e81c9e796>
[Bug 1435908](/show_bug.cgi?id=1435908 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") - Part 3: Pass the triggering principal when opening an URI from location bar drag and drop. r=Gijs
<https://hg.mozilla.org/integration/mozilla-inbound/rev/9ba48fdeecd533e32fdc8c8f65d8f3c77aaad557>
[Bug 1435908](/show_bug.cgi?id=1435908 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") - Part 4: Pass the triggering principal when opening an URI in non-tab browser drag and drop. r=Gijs

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1435908#c27)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/e15580a14db7>
<https://hg.mozilla.org/mozilla-central/rev/c04b1745f4ae>
<https://hg.mozilla.org/mozilla-central/rev/5c38100787fc>
<https://hg.mozilla.org/mozilla-central/rev/9ba48fdeecd5>Status: ASSIGNED → RESOLVEDClosed: 7 years ago
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla60

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a1995062_1689)• 7 years ago |

Group: dom-core-security → core-security-release

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1435908#c28)• 7 years ago |
|  | |

Letting this ride the trains since it's a sec-low.
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix)
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1435908#c29)• 7 years ago |
|  | |

Although the effects of this bug are sec-low and does not qualify for a bug bounty, it did trigger us rewriting this code to a safer model that will potentially prevent future security issues. Accordingly we are paying a small bounty as an exception.Flags: sec-bounty? → sec-bounty+

|  | [Jordi Chancel](/user_profile?user_id=356614)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a2878462_356614)• 7 years ago |

Flags: needinfo?(jordi.chancel)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a6993427_280903)• 7 years ago |

Whiteboard: [adv-main60+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a7265384_280903)• 7 years ago |

Alias: CVE-2018-5182

|  | [Emil Ghitta, QA [:emilghitta]](/user_profile?user_id=588744) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1435908#c30)• 7 years ago |
|  | |

Hi Tooru!
It seems that I can still reproduce the issue described in [comment 0](/show_bug.cgi?id=1435908#c0 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") (while using the attachment from [comment 1](/show_bug.cgi?id=1435908#c1 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event")) using Firefox 61.0a1 (BuildId:20180506220517) and Firefox 60.0 (BuildId:20180430165945) on macOS 10.12.6 and macOS 10.13.3.
What is the expected behavior after this fix? Am I missing something?
Thanks!Flags: needinfo?(arai.unmht)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1435908#c31)• 7 years ago |
|  | |

(In reply to Emil Ghitta, QA [:emilghitta] from [comment #30](/show_bug.cgi?id=1435908#c30 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event"))
> Hi Tooru!
>
> It seems that I can still reproduce the issue described in [comment 0](/show_bug.cgi?id=1435908#c0 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event") (while
> using the attachment from [comment 1](/show_bug.cgi?id=1435908#c1 "VERIFIED FIXED - Web content can open local files and local folders using drag & drop event")) using Firefox 61.0a1
> (BuildId:20180506220517) and Firefox 60.0 (BuildId:20180430165945) on macOS
> 10.12.6 and macOS 10.13.3.
I cannot reproduce.
> What is the expected behavior after this fix?
Nothing happens.
> Am I missing something?
any chance you've saved the attachment and opening the local file?
this issue is specific to http/https content.Flags: needinfo?(arai.unmht)

|  | [Emil Ghitta, QA [:emilghitta]](/user_profile?user_id=588744) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1435908#c32)• 7 years ago |
|  | |

This issue is verified fixed using Firefox 61.0a1 (BuildId:20180506220517) and Firefox 60.0 (BuildId:20180430165945) on macOS 10.12.6 and Ubuntu 16.04 64bit.
Sorry Tooru for raising the "alarm", my bad!Status: RESOLVED → VERIFIED
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=verified)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a23579975_1689)• 6 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435908#a199210669_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1435908&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jordi Chancel](/user_profile?user_id=356614)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_91feff78_20250125_043954.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2018-11

## Security vulnerabilities fixed in Firefox 60

Announced
May 9, 2018
Impact
critical
Products
Firefox
Fixed in

* Firefox 60

#### [#CVE-2018-5154: Use-after-free with SVG animations and clip paths](#CVE-2018-5154)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while enumerating attributes during SVG animations with clip paths. This results in a potentially exploitable crash.

##### References

* [Bug 1443092](https://bugzilla.mozilla.org/show_bug.cgi?id=1443092)

#### [#CVE-2018-5155: Use-after-free with SVG animations and text paths](#CVE-2018-5155)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while adjusting layout during SVG animations with text paths. This results in a potentially exploitable crash.

##### References

* [Bug 1448774](https://bugzilla.mozilla.org/show_bug.cgi?id=1448774)

#### [#CVE-2018-5157: Same-origin bypass of PDF Viewer to view protected PDF files](#CVE-2018-5157)

Reporter
Wladimir Palant
Impact
high
##### Description

Same-origin protections for the PDF viewer can be bypassed, allowing a malicious site to intercept messages meant for the viewer. This could allow the site to retrieve PDF files restricted to viewing by an authenticated user on a third-party website.

##### References

* [Bug 1449898](https://bugzilla.mozilla.org/show_bug.cgi?id=1449898)

#### [#CVE-2018-5158: Malicious PDF can inject JavaScript into PDF Viewer](#CVE-2018-5158)

Reporter
Wladimir Palant
Impact
high
##### Description

The PDF viewer does not sufficiently sanitize PostScript calculator functions, allowing malicious JavaScript to be injected through a crafted PDF file. This JavaScript can then be run with the permissions of the PDF viewer by its worker.

##### References

* [Bug 1452075](https://bugzilla.mozilla.org/show_bug.cgi?id=1452075)

#### [#CVE-2018-5159: Integer overflow and out-of-bounds write in Skia](#CVE-2018-5159)

Reporter
Ivan Fratric
Impact
high
##### Description

An integer overflow can occur in the Skia library due to 32-bit integer use in an array without integer overflow checks, resulting in possible out-of-bounds writes. This could lead to a potentially exploitable crash triggerable by web content.

##### References

* [Bug 1441941](https://bugzilla.mozilla.org/show_bug.cgi?id=1441941)

#### [#CVE-2018-5160: Uninitialized memory use by WebRTC encoder](#CVE-2018-5160)

Reporter
Andreas Perhson
Impact
high
##### Description

WebRTC can use a `WrappedI420Buffer` pixel buffer but the owning image object can be freed while it is still in use. This can result in the WebRTC encoder using uninitialized memory, leading to a potentially exploitable crash.

##### References

* [Bug 1436117](https://bugzilla.mozilla.org/show_bug.cgi?id=1436117)

#### [#CVE-2018-5152: WebExtensions information leak through webRequest API](#CVE-2018-5152)

Reporter
Andy McKay
Impact
moderate
##### Description

WebExtensions with the appropriate permissions can attach content scripts to Mozilla sites such as accounts.firefox.com and listen to network traffic to the site through the `webRequest` API. For example, this allows for the interception of username and an encrypted password during login to Firefox Accounts. This issue does not expose synchronization traffic directly and is limited to the process of user login to the website and the data displayed to the user once logged in.

##### References

* [Bug 1415644](https://bugzilla.mozilla.org/show_bug.cgi?id=1415644)
* [Bug 1427289](https://bugzilla.mozilla.org/show_bug.cgi?id=1427289)

#### [#CVE-2018-5153: Out-of-bounds read in mixed content websocket messages](#CVE-2018-5153)

Reporter
Dennis Fuchs
Impact
moderate
##### Description

If websocket data is sent with mixed text and binary in a single message, the binary data can be corrupted. This can result in an out-of-bounds read with the read memory sent to the originating server in response.

##### References

* [Bug 1436809](https://bugzilla.mozilla.org/show_bug.cgi?id=1436809)

#### [#CVE-2018-5163: Replacing cached data in JavaScript Start-up Bytecode Cache](#CVE-2018-5163)

Reporter
Nicolas B. Pierron
Impact
moderate
##### Description

If a malicious attacker has used another vulnerability to gain full control over a content process, they may be able to replace the alternate data resources stored in the JavaScript Start-up Bytecode Cache (JSBC) for other JavaScript code. If the parent process then runs this replaced code, the executed script would be run with the parent process' privileges, escaping the sandbox on content processes.

##### References

* [Bug 1426353](https://bugzilla.mozilla.org/show_bug.cgi?id=1426353)

#### [#CVE-2018-5164: CSP not applied to all multipart content sent with multipart/x-mixed-replace](#CVE-2018-5164)

Reporter
Khalil Zhani
Impact
moderate
##### Description

Content Security Policy (CSP) is not applied correctly to all parts of multipart content sent with the `multipart/x-mixed-replace` MIME type. This could allow for script to run where CSP should block it, allowing for cross-site scripting (XSS) and other attacks.

##### References

* [Bug 1416045](https://bugzilla.mozilla.org/show_bug.cgi?id=1416045)

#### [#CVE-2018-5166: WebExtension host permission bypass through filterReponseData](#CVE-2018-5166)

Reporter
Francois Lajeunesse Robert
Impact
moderate
##### Description

WebExtensions can use request redirection and a `filterReponseData` filter to bypass host permission settings to redirect network traffic and access content from a host for which they do not have explicit user permission.

##### References

* [Bug 1437325](https://bugzilla.mozilla.org/show_bug.cgi?id=1437325)

#### [#CVE-2018-5167: Improper linkification of chrome: and javascript: content in web console and JavaScript debugger](#CVE-2018-5167)

Reporter
Wladimir Palant
Impact
moderate
##### Description

The web console and JavaScript debugger do not sanitize all output that can be hyperlinked. Both will display `chrome:` links as active, clickable hyperlinks in their output. Web sites should not be able to directly link to internal chrome pages. Additionally, the JavaScript debugger will display `javascript:` links, which users could be tricked into clicking by malicious sites.

##### References

* [Bug 1447969](https://bugzilla.mozilla.org/show_bug.cgi?id=1447969)

#### [#CVE-2018-5168: Lightweight themes can be installed without user interaction](#CVE-2018-5168)

Reporter
Wladimir Palant
Impact
moderate
##### Description

Sites can bypass security checks on permissions to install lightweight themes by manipulating the `baseURI` property of the theme element. This could allow a malicious site to install a theme without user interaction which could contain offensive or embarrassing images.

##### References

* [Bug 1449548](https://bugzilla.mozilla.org/show_bug.cgi?id=1449548)

#### [#CVE-2018-5169: Dragging and dropping link text onto home button can set home page to include chrome pages](#CVE-2018-5169)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If manipulated hyperlinked text with `chrome:` URL contained in it is dragged and dropped on the "home" icon, the home page can be reset to include a normally-unlinkable chrome page as one of the home page tabs.

##### References

* [Bug 1319157](https://bugzilla.mozilla.org/show_bug.cgi?id=1319157)

#### [#CVE-2018-5172: Pasted script from clipboard can run in the Live Bookmarks page or PDF viewer](#CVE-2018-5172)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

The Live Bookmarks page and the PDF viewer can run injected script content if a user pastes script from the clipboard into them while viewing RSS feeds or PDF files. This could allow a malicious site to socially engineer a user to copy and paste malicious script content that could then run with the context of either page but does not allow for privilege escalation.

##### References

* [Bug 1436482](https://bugzilla.mozilla.org/show_bug.cgi?id=1436482)

#### [#CVE-2018-5173: File name spoofing of Downloads panel with Unicode characters](#CVE-2018-5173)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

The filename appearing in the `Downloads` panel improperly renders some Unicode characters, allowing for the file name to be spoofed. This can be used to obscure the file extension of potentially executable files from user view in the panel.
*Note: the dialog to open the file will show the full, correct filename and whether it is executable or not.*

##### References

* [Bug 1438025](https://bugzilla.mozilla.org/show_bug.cgi?id=1438025)

#### [#CVE-2018-5174: Windows Defender SmartScreen UI runs with less secure behavior for downloaded files in Windows 10 April 2018 Update](#CVE-2018-5174)

Reporter
Jimmy
Impact
moderate
##### Description

In the Windows 10 April 2018 Update, Windows Defender SmartScreen honors the `SEE_MASK_FLAG_NO_UI` flag associated with downloaded files and will not show any UI. Files that are unknown and potentially dangerous will be allowed to run because SmartScreen will not prompt the user for a decision, and if the user is offline all files will be allowed to be opened because Windows won’t prompt the user to ask what to do. Firefox incorrectly sets this flag when downloading files, leading to less secure behavior from SmartScreen.
*Note: this issue only affects Windows 10 users running the April 2018 update or later. It does not affect other Windows users or other operating systems.*

##### References

* [Bug 1447080](https://bugzilla.mozilla.org/show_bug.cgi?id=1447080)

#### [#CVE-2018-5175: Universal CSP bypass on sites using strict-dynamic in their policies](#CVE-2018-5175)

Reporter
Masato Kinugawa
Impact
moderate
##### Description

A mechanism to bypass Content Security Policy (CSP) protections on sites that have a `script-src` policy of `'strict-dynamic'`. If a target website contains an HTML injection flaw an attacker could inject a reference to a copy of the `require.js` library that is part of Firefox’s Developer Tools, and then use a known technique using that library to bypass the CSP restrictions on executing injected scripts.

##### References

* [Bug 1432358](https://bugzilla.mozilla.org/show_bug.cgi?id=1432358)

#### [#CVE-2018-5176: JSON Viewer script injection](#CVE-2018-5176)

Reporter
Tadj Youssouf
Impact
moderate
##### Description

The JSON Viewer displays clickable hyperlinks for strings that are parseable as URLs, including `javascript:` links. If a JSON file contains malicious JavaScript script embedded as `javascript:` links, users may be tricked into clicking and running this code in the context of the JSON Viewer. This can allow for the theft of cookies and authorization tokens which are accessible to that context.

##### References

* [Bug 1442840](https://bugzilla.mozilla.org/show_bug.cgi?id=1442840)

#### [#CVE-2018-5177: Buffer overflow in XSLT during number formatting](#CVE-2018-5177)

Reporter
Guyio
Impact
moderate
##### Description

A vulnerability exists in XSLT during number formatting where a negative buffer size may be allocated in some instances, leading to a buffer overflow and crash if it occurs.

##### References

* [Bug 1451908](https://bugzilla.mozilla.org/show_bug.cgi?id=1451908)

#### [#CVE-2018-5165: Checkbox for enabling Flash protected mode is inverted in 32-bit Firefox](#CVE-2018-5165)

Reporter
David Parks
Impact
low
##### Description

In 32-bit versions of Firefox, the Adobe Flash plugin setting for "Enable Adobe Flash protected mode" is unchecked by default even though the Adobe Flash sandbox is actually enabled. The displayed state is the reverse of the true setting, resulting in user confusion. This could cause users to select this setting intending to activate it and inadvertently turn protections off.

##### References

* [Bug 1451452](https://bugzilla.mozilla.org/show_bug.cgi?id=1451452)

#### [#CVE-2018-5180: heap-use-after-free in mozilla::WebGLContext::DrawElementsInstanced](#CVE-2018-5180)

Reporter
Nils
Impact
low
##### Description

A use-after-free vulnerability can occur during WebGL operations. While this results in a potentially exploitable crash, the vulnerability is limited because the memory is freed and reused in a brief window of time during the freeing of the same callstack.

##### References

* [Bug 1444086](https://bugzilla.mozilla.org/show_bug.cgi?id=1444086)

#### [#CVE-2018-5181: Local file can be displayed in noopener tab through drag and drop of hyperlink](#CVE-2018-5181)

Reporter
Abdulrahman Alqabandi
Impact
low
##### Description

If a URL using the `file:` protocol is dragged and dropped onto an open tab that is running in a different child process the tab will open a local file corresponding to the dropped URL, contrary to policy. One way to make the target tab open more reliably in a separate process is to open it with the `noopener` keyword.

##### References

* [Bug 1424107](https://bugzilla.mozilla.org/show_bug.cgi?id=1424107)

#### [#CVE-2018-5182: Local file can be displayed from hyperlink dragged and dropped on addressbar](#CVE-2018-5182)

Reporter
Jordi Chancel
Impact
low
##### Description

If a text string that happens to be a filename in the operating system's native format is dragged and dropped onto the addressbar the specified local file will be opened. This is contrary to policy and is what would happen if the string were the equivalent `file:` URL.

##### References

* [Bug 1435908](https://bugzilla.mozilla.org/show_bug.cgi?id=1435908)

#### [#CVE-2018-5179: Service workers can self update to keep a worker running](#CVE-2018-5179)

Reporter
Yannic Bonenberger
Impact
low
##### Description

A service worker can send the "activate" event on itself periodically which allows it to run perpetually. This would allow any malicious activity, such as logging an IP address by the service worker, to occur in the background.

##### References

* [Bug 1432846](https://bugzilla.mozilla.org/show_bug.cgi?id=1432846)

#### [#CVE-2018-5151: Memory safety bugs fixed in Firefox 60](#CVE-2018-5151)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christoph Diehl, Christian Holler, Jon Coppeard, Jason Kratzer, Nathan Froyd, Paul Theriault, Ryan VanderMeulen, Tyson Smith, Sebastian Hengst, Byron Campen, Emilio Cobos Álvarez, Ronald Crane, and Phillipp reported memory safety bugs present in Firefox 59. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 60](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1445234%2C1449530%2C1437455%2C1447989%2C1438827%2C1436983%2C1435036%2C1440465%2C1439723%2C1448771%2C1453653%2C1454359%2C1432323%2C1454126%2C1436759%2C1439655%2C1448612%2C1449358%2C1367727%2C1452417)

#### [#CVE-2018-5150: Memory safety bugs fixed in Firefox 60 and Firefox ESR 52.8](#CVE-2018-5150)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christoph Diehl, Randell Jesup, Tyson Smith, Alex Gaynor, Ronald Crane, Julian Hector, Kannan Vijayan, and Jason Kratzer reported memory safety bugs present in Firefox 59 and Firefox ESR 52.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 60 and Firefox ESR 52.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1388020%2C1433609%2C1409440%2C1448705%2C1451376%2C1452202%2C1444668%2C1393367%2C1411415%2C1426129)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


