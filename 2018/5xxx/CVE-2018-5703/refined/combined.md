=== Content from groups.google.com_571f13ec_20250125_030943.html ===
[![](https://fonts.gstatic.com/s/i/productlogos/groups/v9/web-48dp/logo_groups_color_1x_web_48dp.png)Groups](./my-groups "Groups")ConversationsAll groups and messagesSend feedback to GoogleHelpTraining[Sign in](https://accounts.google.com/ServiceLogin?hl=en&passive=true&continue=https://groups.google.com&ec=GAZA0AM)[Groups](./my-groups "Groups")
## syzkaller-bugs

[Conversations](./g/syzkaller-bugs)[About](./g/syzkaller-bugs/about)[Privacy](https://policies.google.com/privacy?hl=en_US) • [Terms](https://policies.google.com/terms?hl=en_US)

Groups keyboard shortcuts have been updatedDismissSee shortcuts
# KASAN: slab-out-of-bounds Write in tcp\_v6\_syn\_recv\_sock

 2,830 viewsSkip to first unread message![syzbot's profile photo](https://lh3.googleusercontent.com/a/default-user=s40-c)
### syzbot

unread,Jan 2, 2018, 11:58:02 PM1/2/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto da...@davemloft.net, kuz...@ms2.inr.ac.ru, linux-...@vger.kernel.org, net...@vger.kernel.org, syzkall...@googlegroups.com, yosh...@linux-ipv6.orgHello,

syzkaller hit the following crash on

61233580f1f33c50e159c50e24d80ffd2ba2e06b

git://[git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/master](http://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/master)

compiler: gcc (GCC) 7.1.1 20170620

.config is attached

Raw console output is attached.

C reproducer is attached

syzkaller reproducer is attached. See <https://goo.gl/kgGztJ>

for information about syzkaller reproducers

IMPORTANT: if you fix the bug, please add the following tag to the commit:

Reported-by: syzbot+6dc95b...@syzkaller.appspotmail.com

It will help syzbot understand when the bug is fixed. See footer for

details.

If you forward the report, please keep this part and the footer.

TCP: request\_sock\_TCPv6: Possible SYN flooding on port 20002. Sending

cookies. Check SNMP counters.

==================================================================

BUG: KASAN: slab-out-of-bounds in memcpy include/linux/string.h:344 [inline]

BUG: KASAN: slab-out-of-bounds in tcp\_v6\_syn\_recv\_sock+0x628/0x23a0

net/ipv6/tcp\_ipv6.c:1144

Write of size 160 at addr ffff8801cbdd7460 by task syzkaller545407/3196

CPU: 1 PID: 3196 Comm: syzkaller545407 Not tainted 4.15.0-rc5+ #241

Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS

Google 01/01/2011

Call Trace:

 <IRQ>

 \_\_dump\_stack lib/dump\_stack.c:17 [inline]

 dump\_stack+0x194/0x257 lib/dump\_stack.c:53

 print\_address\_description+0x73/0x250 mm/kasan/report.c:252

 kasan\_report\_error mm/kasan/report.c:351 [inline]

 kasan\_report+0x25b/0x340 mm/kasan/report.c:409

 check\_memory\_region\_inline mm/kasan/kasan.c:260 [inline]

 check\_memory\_region+0x137/0x190 mm/kasan/kasan.c:267

 memcpy+0x37/0x50 mm/kasan/kasan.c:303

 memcpy include/linux/string.h:344 [inline]

 tcp\_v6\_syn\_recv\_sock+0x628/0x23a0 net/ipv6/tcp\_ipv6.c:1144

 tcp\_get\_cookie\_sock+0x102/0x540 net/ipv4/syncookies.c:213

 cookie\_v6\_check+0x177d/0x2160 net/ipv6/syncookies.c:255

 tcp\_v6\_cookie\_check net/ipv6/tcp\_ipv6.c:1008 [inline]

 tcp\_v6\_do\_rcv+0xe4d/0x11c0 net/ipv6/tcp\_ipv6.c:1316

 tcp\_v6\_rcv+0x22ee/0x2b40 net/ipv6/tcp\_ipv6.c:1510

 ip6\_input\_finish+0x36f/0x1700 net/ipv6/ip6\_input.c:284

 NF\_HOOK include/linux/netfilter.h:250 [inline]

 ip6\_input+0xe9/0x560 net/ipv6/ip6\_input.c:327

 dst\_input include/net/dst.h:466 [inline]

 ip6\_rcv\_finish+0x1a9/0x7a0 net/ipv6/ip6\_input.c:71

 NF\_HOOK include/linux/netfilter.h:250 [inline]

 ipv6\_rcv+0xf1f/0x1f80 net/ipv6/ip6\_input.c:208

 \_\_netif\_receive\_skb\_core+0x1a3e/0x3450 net/core/dev.c:4461

 \_\_netif\_receive\_skb+0x2c/0x1b0 net/core/dev.c:4526

 process\_backlog+0x203/0x740 net/core/dev.c:5205

 napi\_poll net/core/dev.c:5603 [inline]

 net\_rx\_action+0x792/0x1910 net/core/dev.c:5669

 \_\_do\_softirq+0x2d7/0xb85 kernel/softirq.c:285

 do\_softirq\_own\_stack+0x2a/0x40 arch/x86/entry/entry\_64.S:1115

 </IRQ>

 do\_softirq.part.21+0x14d/0x190 kernel/softirq.c:329

 do\_softirq kernel/softirq.c:177 [inline]

 \_\_local\_bh\_enable\_ip+0x1ee/0x230 kernel/softirq.c:182

 local\_bh\_enable include/linux/bottom\_half.h:32 [inline]

 rcu\_read\_unlock\_bh include/linux/rcupdate.h:727 [inline]

 ip6\_finish\_output2+0xba6/0x2390 net/ipv6/ip6\_output.c:121

 ip6\_finish\_output+0x2f9/0x920 net/ipv6/ip6\_output.c:146

 NF\_HOOK\_COND include/linux/netfilter.h:239 [inline]

 ip6\_output+0x1eb/0x840 net/ipv6/ip6\_output.c:163

 dst\_output include/net/dst.h:460 [inline]

 NF\_HOOK include/linux/netfilter.h:250 [inline]

 ip6\_xmit+0xd75/0x2080 net/ipv6/ip6\_output.c:269

 inet6\_csk\_xmit+0x2fc/0x580 net/ipv6/inet6\_connection\_sock.c:139

 tcp\_transmit\_skb+0x1b12/0x38b0 net/ipv4/tcp\_output.c:1176

 tcp\_write\_xmit+0x680/0x5190 net/ipv4/tcp\_output.c:2367

 \_\_tcp\_push\_pending\_frames+0xa0/0x250 net/ipv4/tcp\_output.c:2543

 tcp\_send\_fin+0x1b0/0xd20 net/ipv4/tcp\_output.c:3087

 tcp\_close+0xbe0/0xfc0 net/ipv4/tcp.c:2234

 inet\_release+0xed/0x1c0 net/ipv4/af\_inet.c:426

 inet6\_release+0x50/0x70 net/ipv6/af\_inet6.c:432

 sock\_release+0x8d/0x1e0 net/socket.c:600

 sock\_close+0x16/0x20 net/socket.c:1129

 \_\_fput+0x327/0x7e0 fs/file\_table.c:210

 \_\_\_\_fput+0x15/0x20 fs/file\_table.c:244

 task\_work\_run+0x199/0x270 kernel/task\_work.c:113

 exit\_task\_work include/linux/task\_work.h:22 [inline]

 do\_exit+0x9bb/0x1ad0 kernel/exit.c:865

 do\_group\_exit+0x149/0x400 kernel/exit.c:968

 get\_signal+0x73f/0x16c0 kernel/signal.c:2335

 do\_signal+0x94/0x1ee0 arch/x86/kernel/signal.c:809

 exit\_to\_usermode\_loop+0x214/0x310 arch/x86/entry/common.c:158

 prepare\_exit\_to\_usermode arch/x86/entry/common.c:195 [inline]

 syscall\_return\_slowpath+0x490/0x550 arch/x86/entry/common.c:264

 entry\_SYSCALL\_64\_fastpath+0x94/0x96

RIP: 0033:0x4456e9

RSP: 002b:00007fb4de631da8 EFLAGS: 00000246 ORIG\_RAX: 00000000000000ca

RAX: fffffffffffffe00 RBX: 00000000006dac3c RCX: 00000000004456e9

RDX: 0000000000000000 RSI: 0000000000000000 RDI: 00000000006dac3c

RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000

R10: 0000000000000000 R11: 0000000000000246 R12: 00000000006dac38

R13: 0100000000000000 R14: 00007fb4de6329c0 R15: 0000000000000009

Allocated by task 3196:

 save\_stack+0x43/0xd0 mm/kasan/kasan.c:447

 set\_track mm/kasan/kasan.c:459 [inline]

 kasan\_kmalloc+0xad/0xe0 mm/kasan/kasan.c:551

 kasan\_slab\_alloc+0x12/0x20 mm/kasan/kasan.c:489

 kmem\_cache\_alloc+0x12e/0x760 mm/slab.c:3544

 sk\_prot\_alloc+0x65/0x2a0 net/core/sock.c:1463

 sk\_clone\_lock+0x152/0x1570 net/core/sock.c:1649

 inet\_csk\_clone\_lock+0x92/0x4f0 net/ipv4/inet\_connection\_sock.c:781

 tcp\_create\_openreq\_child+0x9b/0x1b70 net/ipv4/tcp\_minisocks.c:449

 tcp\_v6\_syn\_recv\_sock+0x22d/0x23a0 net/ipv6/tcp\_ipv6.c:1123

 tcp\_get\_cookie\_sock+0x102/0x540 net/ipv4/syncookies.c:213

 cookie\_v6\_check+0x177d/0x2160 net/ipv6/syncookies.c:255

 tcp\_v6\_cookie\_check net/ipv6/tcp\_ipv6.c:1008 [inline]

 tcp\_v6\_do\_rcv+0xe4d/0x11c0 net/ipv6/tcp\_ipv6.c:1316

 tcp\_v6\_rcv+0x22ee/0x2b40 net/ipv6/tcp\_ipv6.c:1510

 ip6\_input\_finish+0x36f/0x1700 net/ipv6/ip6\_input.c:284

 NF\_HOOK include/linux/netfilter.h:250 [inline]

 ip6\_input+0xe9/0x560 net/ipv6/ip6\_input.c:327

 dst\_input include/net/dst.h:466 [inline]

 ip6\_rcv\_finish+0x1a9/0x7a0 net/ipv6/ip6\_input.c:71

 NF\_HOOK include/linux/netfilter.h:250 [inline]

 ipv6\_rcv+0xf1f/0x1f80 net/ipv6/ip6\_input.c:208

 \_\_netif\_receive\_skb\_core+0x1a3e/0x3450 net/core/dev.c:4461

 \_\_netif\_receive\_skb+0x2c/0x1b0 net/core/dev.c:4526

 process\_backlog+0x203/0x740 net/core/dev.c:5205

 napi\_poll net/core/dev.c:5603 [inline]

 net\_rx\_action+0x792/0x1910 net/core/dev.c:5669

 \_\_do\_softirq+0x2d7/0xb85 kernel/softirq.c:285

Freed by task 0:

(stack is not available)

The buggy address belongs to the object at ffff8801cbdd6a80

 which belongs to the cache TCP of size 2528

The buggy address is located 0 bytes to the right of

 2528-byte region [ffff8801cbdd6a80, ffff8801cbdd7460)

The buggy address belongs to the page:

page:000000006145927c count:1 mapcount:0 mapping:00000000d41dd7c1

index:0xffff8801cbdd7ffd compound\_mapcount: 0

flags: 0x2fffc0000008100(slab|head)

raw: 02fffc0000008100 ffff8801cbdd6000 ffff8801cbdd7ffd 0000000100000003

raw: ffffea00074ef120 ffff8801d82b7248 ffff8801d798b640 0000000000000000

page dumped because: kasan: bad access detected

Memory state around the buggy address:

 ffff8801cbdd7300: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

 ffff8801cbdd7380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

> ffff8801cbdd7400: 00 00 00 00 00 00 00 00 00 00 00 00 fc fc fc fc

 ^

 ffff8801cbdd7480: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc

 ffff8801cbdd7500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00

==================================================================

---

This bug is generated by a dumb bot. It may contain errors.

See <https://goo.gl/tpsmEJ> for details.

Direct all questions to syzk...@googlegroups.com.

syzbot will keep track of this bug report.

If you forgot to add the Reported-by tag, once the fix for this bug is

merged

into any tree, please reply to this email with:

#syz fix: exact-commit-title

If you want to test a patch for this bug, please reply with:

#syz test: git://repo/address.git branch

and provide the patch inline or as an attachment.

To mark this as a duplicate of another syzbot report, please reply with:

#syz dup: exact-subject-of-another-report

If it's a one-off invalid bug report, please reply with:

#syz invalid

Note: if the crash happens again, it will cause creation of a new bug

report.

Note: all commands must start from beginning of the line in the email body.

config.txt[](https://groups.google.com/group/syzkaller-bugs/attach/53ace94c0e5e5/config.txt?part=0.1)raw.log[](https://groups.google.com/group/syzkaller-bugs/attach/53ace94c0e5e5/raw.log?part=0.2)repro.txt[](https://groups.google.com/group/syzkaller-bugs/attach/53ace94c0e5e5/repro.txt?part=0.3)repro.c[](https://groups.google.com/group/syzkaller-bugs/attach/53ace94c0e5e5/repro.c?part=0.4)![Cong Wang's profile photo](//lh3.googleusercontent.com/a-/ALV-UjWXlZgI7G3TlVXaBQy0eV7MJDbfV6vQpdQdqdBpXaR_MXS-S-Nw=s40-c)
### Cong Wang

unread,Jan 3, 2018, 6:52:23 PM1/3/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto syzbot, David Miller, Alexey Kuznetsov, LKML, Linux Kernel Network Developers, syzkall...@googlegroups.com, Hideaki YOSHIFUJI, avejw...@fb.com, il...@mellanox.com, avi...@mellanox.comtls\_init() changes sk->sk\_prot from IPv6 to IPv4, which leads

to this bug. I guess IPv6 is not supported for TLS? If so, need

a check on proto in tls\_init()...

![Ozgur's profile photo](https://lh3.googleusercontent.com/a/default-user=s40-c)
### Ozgur

unread,Jan 3, 2018, 8:55:59 PM1/3/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto Cong Wang, syzbot, David Miller, Alexey Kuznetsov, LKML, Linux Kernel Network Developers, syzkall...@googlegroups.com, Hideaki YOSHIFUJI, avejw...@fb.com, il...@mellanox.com, avi...@mellanox.com

03.01.2018, 21:57, "Cong Wang" <xiyou.w...@gmail.com>:

Hello,

I think IPv6 supports with TLS.

There was a previously posted commit by Mellanox:

<https://patchwork.ozlabs.org/patch/801530/>

Ozgur

![Cong Wang's profile photo](//lh3.googleusercontent.com/a-/ALV-UjWXlZgI7G3TlVXaBQy0eV7MJDbfV6vQpdQdqdBpXaR_MXS-S-Nw=s40-c)
### Cong Wang

unread,Jan 3, 2018, 11:31:26 PM1/3/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto Ozgur, syzbot, David Miller, Alexey Kuznetsov, LKML, Linux Kernel Network Developers, syzkall...@googlegroups.com, Hideaki YOSHIFUJI, avejw...@fb.com, il...@mellanox.com, avi...@mellanox.comGood to know.

Can you resend the fix? It could probably fix another warning

reported by syzbot too.

![Dmitry Vyukov's profile photo](//lh3.googleusercontent.com/a-/ALV-UjWD-V9UlFEBYMKKt4sktu7p09vmd2beJmeX7g1hvzleKVq_EKJB=s40-c)
### Dmitry Vyukov

unread,Jan 16, 2018, 7:43:23 AM1/16/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto Cong Wang, Ozgur, syzbot, David Miller, Alexey Kuznetsov, LKML, Linux Kernel Network Developers, syzkall...@googlegroups.com, Hideaki YOSHIFUJI, avejw...@fb.com, il...@mellanox.com, avi...@mellanox.comFTR this has been assigned CVE-2018-5703

![Wei Wang's profile photo](//lh3.googleusercontent.com/a-/ALV-UjXOgCNEMnTPuRoVgz7FeV4kHakBZ0U5YoK0asKPktWARacwLbqg=s40-c)
### Wei Wang

unread,Jan 17, 2018, 6:02:54 PM1/17/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto Cong Wang, il...@mellanox.com, bor...@mellanox.com, Ozgur, syzbot, David Miller, Alexey Kuznetsov, LKML, Linux Kernel Network Developers, syzkall...@googlegroups.com, Hideaki YOSHIFUJI, avejw...@fb.com, avi...@mellanox.com, Wei WangWhat is the status on resending the patch?

(<https://patchwork.ozlabs.org/patch/801530/>)

Another slab-out-of-bound report that could be fixed by it:

syzbot has found reproducer for the following crash on

6bd39bc3da0f4a301fae69c4a32db2768f5118be

git://[git.kernel.org/pub/scm/linux/kernel/git/davem/net-next.git](http://git.kernel.org/pub/scm/linux/kernel/git/davem/net-next.git) master

compiler: gcc (GCC) 7.1.1 20170620

==================================================================

BUG: KASAN: slab-out-of-bounds in ip6\_dst\_idev

include/net/ip6\_fib.h:192 [inline]

BUG: KASAN: slab-out-of-bounds in ip6\_xmit+0x1ce9/0x2090

net/ipv6/ip6\_output.c:264

Read of size 8 at addr ffff8801d99a1018 by task syzkaller716686/3664

CPU: 0 PID: 3664 Comm: syzkaller716686 Not tainted 4.15.0-rc7+ #187

Hardware name: Google Google Compute Engine/Google Compute Engine,

BIOS Google 01/01/2011

Call Trace:

 \_\_dump\_stack lib/dump\_stack.c:17 [inline]

 dump\_stack+0x194/0x257 lib/dump\_stack.c:53

 print\_address\_description+0x73/0x250 mm/kasan/report.c:252

 kasan\_report\_error mm/kasan/report.c:351 [inline]

 kasan\_report+0x25b/0x340 mm/kasan/report.c:409

 \_\_asan\_report\_load8\_noabort+0x14/0x20 mm/kasan/report.c:430

 ip6\_dst\_idev include/net/ip6\_fib.h:192 [inline]

 ip6\_xmit+0x1ce9/0x2090 net/ipv6/ip6\_output.c:264

 inet6\_csk\_xmit+0x2fc/0x580 net/ipv6/inet6\_connection\_sock.c:139

 tcp\_transmit\_skb+0x1b1b/0x38c0 net/ipv4/tcp\_output.c:1176

 tcp\_send\_syn\_data net/ipv4/tcp\_output.c:3457 [inline]

 tcp\_connect+0x1edb/0x4090 net/ipv4/tcp\_output.c:3496

 tcp\_v4\_connect+0x15ef/0x1e70 net/ipv4/tcp\_ipv4.c:257

 \_\_inet\_stream\_connect+0x2d4/0xf00 net/ipv4/af\_inet.c:620

 tcp\_sendmsg\_fastopen net/ipv4/tcp.c:1168 [inline]

 tcp\_sendmsg\_locked+0x264e/0x3c70 net/ipv4/tcp.c:1214

 tcp\_sendmsg+0x2f/0x50 net/ipv4/tcp.c:1463

 inet\_sendmsg+0x11f/0x5e0 net/ipv4/af\_inet.c:764

 sock\_sendmsg\_nosec net/socket.c:630 [inline]

 sock\_sendmsg+0xca/0x110 net/socket.c:640

 \_\_\_sys\_sendmsg+0x320/0x8b0 net/socket.c:2020

 \_\_sys\_sendmmsg+0x1ee/0x620 net/socket.c:2110

 SYSC\_sendmmsg net/socket.c:2141 [inline]

 SyS\_sendmmsg+0x35/0x60 net/socket.c:2136

 entry\_SYSCALL\_64\_fastpath+0x23/0x9a

RIP: 0033:0x43fdd9

RSP: 002b:00007ffcaf235288 EFLAGS: 00000217 ORIG\_RAX: 0000000000000133

RAX: ffffffffffffffda RBX: 00000000004002c8 RCX: 000000000043fdd9

RDX: 0000000000000001 RSI: 00000000205f8fc8 RDI: 0000000000000004

RBP: 00000000006ca018 R08: 0000000000000000 R09: 0000000000000000

R10: 0000000020000000 R11: 0000000000000217 R12: 0000000000401740

R13: 00000000004017d0 R14: 0000000000000000 R15: 0000000000000000

![Eric Biggers's profile photo](//lh3.googleusercontent.com/a-/ALV-UjUbfVDkNQoD0Tnc7G473llH80RA2mKTjUGAGm819Q5RsAI10w=s40-c)
### Eric Biggers

unread,Apr 19, 2018, 4:32:10 AM4/19/18Reply to authorSign in to reply to authorForwardSign in to forwardDeleteYou do not have permission to delete messages in this groupCopy linkReport messageShow original messageEither email addresses are anonymous for this group or you need the view member email addresses permission to view the original messageto syzbot, da...@davemloft.net, kuz...@ms2.inr.ac.ru, linux-...@vger.kernel.org, net...@vger.kernel.org, syzkall...@googlegroups.com, yosh...@linux-ipv6.orgNo longer occurring; last occurrence was on Jan 19 (commit dda3e15231b35).

The fix was commit d91c3e17f75f2:

#syz fix: net/tls: Only attach to sockets in ESTABLISHED state

- Eric

Reply allReply to authorForward0 new messages
