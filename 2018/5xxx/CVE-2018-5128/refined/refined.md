```json
{
  "CVE-2018-5128": {
    "related_content": true,
    "summary": "The provided content describes a heap-use-after-free vulnerability in `nsTextEditorState::SetSelectionRange` within Mozilla Firefox. This vulnerability is identified as CVE-2018-5128.",
    "details": {
      "root_cause": "The vulnerability occurs because `nsTextEditorState` does not hold a reference to itself. When the type of an input element is changed, the `nsTextEditorState` object is released, leading to a use-after-free if `setSelectionRange` is called after this release due to an event handler modifying the input element's type attribute. Specifically, if the input type changes to something other than 'text', then `nsTextEditorState` will be freed.",
      "weaknesses": [
        "Heap-use-after-free",
        "Lack of proper reference counting/management for `nsTextEditorState`",
        "Race condition due to asynchronous event handling and object destruction"
      ],
      "impact": "An attacker can trigger a potentially exploitable crash by manipulating input elements, events and selection ranges during editor operations",
       "attack_vectors": "The attack vector involves a specially crafted website that uses JavaScript to manipulate input elements, specifically setting the selection range and triggering the `selectionstart` event to change the input type. This leads to a race condition where a freed `nsTextEditorState` object is accessed.",
      "attacker_capabilities": "The attacker needs the ability to execute JavaScript code on the target system. This can be achieved by tricking the user into visiting a malicious website.",
      "attacker_position": "The attacker can be a remote user who can control the website's content, including the JavaScript code.",
          "additional_notes": "The fix implemented using a `WeakPtr` to detect if `nsTextEditorState` is destroyed and avoids the use-after-free. Additionally null checks were added for `TextInputListener::mFrame` to avoid null dereferences. The vulnerability was introduced by bug 1343037, which moved selection-management responsibilities from `nsTextControlFrame` to editor state."
    }
  }
}
```