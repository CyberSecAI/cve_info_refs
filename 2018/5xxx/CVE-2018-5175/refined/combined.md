=== Content from bugzilla.mozilla.org_25210423_20250126_100513.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1447080)
* [XML](/show_bug.cgi?ctype=xml&id=1447080)

Closed
[Bug 1447080](/show_bug.cgi?id=1447080)
(CVE-2018-5174)

Opened 7 years ago
Closed 7 years ago

# Security: SEE\_MASK\_FLAG\_NO\_UI behavior changes in Windows 10, allowing SmartScreen bypass

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Security: SEE\_MASK\_FLAG\_NO\_UI behavior changes in Windows 10, allowing SmartScreen bypass

## Categories

### (Core :: Widget: Win32, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Win32#Widget%3A%20Win32)

Widget: Win32
▾

Core :: Widget: Win32
Mapping of cross platform widget interfaces to Win32 platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Win32)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

59 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla61

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | [60+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=60%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed) |
| firefox59 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix) |
| firefox60 | [+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed) |
| firefox61 | [+](/buglist.cgi?f1=cf_tracking_firefox61&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | 60+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox59 |  | wontfix |
| firefox60 | + | fixed |
| firefox61 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jafeher, Assigned: jimm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/12a94ec61fd924f763a9160dab90e6a7?d=mm&size=40)  [jafeher](/user_profile?user_id=614245)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[CVE-2007-4841](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7")

Dependency [tree](/showdependencytree.cgi?id=1447080&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1447080)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-other, sec-moderate, Whiteboard: [adv-main60+][adv-esr52.8+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-5174

[Keywords:](/describekeywords.cgi)

[csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main60+][adv-esr52.8+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

```
Steps to reproduce:

Download and run these files:
Known malware: <https://demo.smartscreen.msft.net/download/known/knownmalicious.exe>
Unknown program: <https://demo.smartscreen.msft.net/download/unknown/freevideo.exe>
Offline: Any of the above with internet on the machine off

More details about the issue:
In the next Windows Release (Redstone 4), Windows Defender SmartScreen will honor the SEE_MASK_FLAG_NO_UI flag. This flag is passed through shellexecute when a user runs an executable, or other supported file, through the firefox download manager. Edge/Windows Explorer do not pass this flag and are unaffected.

There are three problematic scenarios with this flag set:

1. Known malware will be blocked silently: Windows will not show any SmartScreen UI for these types of files, and the user will have no opportunity to override the block through Firefox. The user will not have any indication that executing the file did anything. (Current behavipo
2. Unknown file downloads will be allowed - This is a large number of files and all will be allowed. There is a chance for polymorphic malware to be bucketed within these types of files.
3. User is offline - User is unable to contact SmartScreen. All executions and file opens allowed.

SEE_MASK_FLAG_NO_UI *not* set: all 3 cases will result in a block experience for the user.

SEE_MASK_FLAG_NO_UI *is* set (current Firefox behavior): files in scenario #2 and #3 will be allowed to run even if SmartScreen would otherwise have blocked them.
```

## Attachments

### (4 files)

| [patch v.1](/attachment.cgi?id=8962342)  [7 years ago](#c10)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   1.18 KB, patch | handyman : [review+](#c25 "7 years ago")  RyanVM : [approval-mozilla-beta+](#c33 "7 years ago")  lizzard : [approval-mozilla-esr52+](#c43 "7 years ago") | [Details](/attachment.cgi?id=8962342&action=edit) | [Diff](/attachment.cgi?id=8962342&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342) |
| --- | --- | --- |
| [Win7 SmartScreen warning](/attachment.cgi?id=8962702)  [7 years ago](#c16)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   168.15 KB, image/jpeg |  | [Details](/attachment.cgi?id=8962702&action=edit) |
| [knownmalicious.exe on win10](/attachment.cgi?id=8963034)  [7 years ago](#c18)  [Romain Testard [:RT]](/user_profile?user_id=486264)   57.43 KB, image/png |  | [Details](/attachment.cgi?id=8963034&action=edit) |
| [freevideo.exe on win10](/attachment.cgi?id=8963036)  [7 years ago](#c19)  [Romain Testard [:RT]](/user_profile?user_id=486264)   75.01 KB, image/png |  | [Details](/attachment.cgi?id=8963036&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1447080#c0)• 7 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36
Steps to reproduce:
Download and run these files:
Known malware: <https://demo.smartscreen.msft.net/download/known/knownmalicious.exe>
Unknown program: <https://demo.smartscreen.msft.net/download/unknown/freevideo.exe>
Offline: Any of the above with internet on the machine off
More details about the issue:
In the next Windows Release (Redstone 4), Windows Defender SmartScreen will honor the SEE\_MASK\_FLAG\_NO\_UI flag. This flag is passed through shellexecute when a user runs an executable, or other supported file, through the firefox download manager. Edge/Windows Explorer do not pass this flag and are unaffected.
There are three problematic scenarios
1. Known malware - Blocked silently: We will not show any SmartScreen UI for these types of files, but the user will have no opportunity to override the block through firefox. The user will not have any indication that executing the file did anything.
2. Unknowns - The file is unknown to our service. This is a large number of files and all will be allowed. There is a chance for polymorphic malware to be bucketed here.
3. Offline - User is unable to contact smartscreen. Always allowed.
When SEE\_MASK\_FLAG\_NO\_UI is not set, all 3 cases will result in a block experience for the user.
Actual results:
Files are not run. They are silently blocked
Expected results:
Files are not run. They are blocked by SmartScreen.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1447080#c1)• 7 years ago |
|  | |

As best I can tell this was added in [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") for Firefox 2.0 (hi, 2006 called, it wants its flags back, etc.).
Jim, can we just drop this flag? Is there an alternative we should be using? It's not clear from [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") why this flag was added (though some of the others are more obvious).
I expect we'll want to have a fix in place for 60 given the release timelines for the spring updates in the past (april last year for that one). I don't know how we feel about 59 for this.Group: firefox-core-security → core-security
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected)
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=affected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)Component: Untriaged → Widget: Win32Flags: needinfo?(jmathies)Product: Firefox → Core

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1447080#c2)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #1](/show_bug.cgi?id=1447080#c1 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> As best I can tell this was added in [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") for Firefox 2.0 (hi, 2006
> called, it wants its flags back, etc.).
>
> Jim, can we just drop this flag? Is there an alternative we should be using?
> It's not clear from [bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7") why this flag was added (though some of the
> others are more obvious).
>
> I expect we'll want to have a fix in place for 60 given the release
> timelines for the spring updates in the past (april last year for that one).
> I don't know how we feel about 59 for this.
I think I just added that because it seemed like a good flag to pass. I don't remember any other specifics.Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1447080#c3)• 7 years ago |
|  | |

Who is jkf49@cornell.edu ? This report sounds like it was filed by a Microsoft employee, but I don't recognize the account.Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1447080#c4)• 7 years ago |
|  | |

I have no idea, but removing the flag and showing errors seems like a good thing regardless.
I don't know why this is a hidden security bug or described as a "bypass". From the description it sounds like things that SmartScreen would block are blocked, just silently, and additional things SmartScreen wouldn't block (offline) are also blocked -- perhaps a bug but not going to cause any security issues.Flags: needinfo?(dveditz) → needinfo?(jkf49)

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1447080#c5)• 7 years ago |
|  | |

Hey, I'm a dev on the smartscreen team. Sorry, it looks like I didn't update the "actual results" properly.
The security issue is the bucket of unknowns and offline.
The unknown bucket has the potential to contain things like polymorphic malware and will be allowed
Offline: running files offline will also be allowed. These could be files that would normally be blocked by smartscreen.Flags: needinfo?(jkf49)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1447080#c6)• 7 years ago |
|  | |

Dan, should we open this?Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1447080#c7)• 7 years ago |
|  | |

jafeher: I wrote a "User Story" to replace your original description that hopefully removes the confusion. Did I get it right?
(meanwhile I'll set a security rating assuming it is)User Story: (updated)Flags: needinfo?(dveditz) → needinfo?(jafeher)Keywords: [csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1447080#c8)• 7 years ago |
|  | |

Jim: we'd like this fixed in 60 so it's not too behind the Windows release. Who owns this code now?
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix)
[tracking-firefox60](/buglist.cgi?f1=cf_tracking_firefox60&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B)
[tracking-firefox61](/buglist.cgi?f1=cf_tracking_firefox61&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox61&o1=equals&v1=%2B)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [60+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=60%2B)Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a587965_279663)• 7 years ago |

Assignee: nobody → jmathiesFlags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a587972_279663)• 7 years ago |

Priority: -- → P1

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1447080#c9)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=9fe49528449fc627b96fe03ebe4757bbf67fcac1>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1447080#c10)• 7 years ago |
|  | |

Attached patch

[patch v.1](attachment.cgi?id=8962342&action=diff)
— [Details](attachment.cgi?id=8962342&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1447080#c11)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
David mind looking this one line change over? I did a little research on this flag, didn't find anything out on the net indicating this change might introduce some sort of issue. Generally looks like a safe change although I do wonder if users will start seeing error messages when executing attachments due to this. If so, hopefully those messages are useful. Not sure we want to push this out fast, I think lots of bake time is warranted here.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: review?(davidp99)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a613498_1689)• 7 years ago |

Group: core-security → layout-core-security

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1447080#c12)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
Putting this on hold after discussing with David. We're not sure we want to make these changes. Blocking #2 in particular sounds like it would produce really awful user experiences. #3 is questionable as well.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: review?(davidp99)

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1447080#c13)• 7 years ago |
|  | |

User story looks correct.
@Jim This is how SmartScreen has functioned previously. Chrome has agreed to making this same change. Any commonly downloaded file quickly get reputation in smartscreen and will be allowed. Clicking through SmartScreen once will clear mark of the web and that file will not be blocked again.
Let me know if you require any more information.Flags: needinfo?(jafeher)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1447080#c14)• 7 years ago |
|  | |

SmartScreen description off wikipedia -
"It is designed to help protect users against attacks that utilize social engineering and drive-by downloads to infect a system by scanning URLs accessed by a user against a blacklist of websites containing known threats."
<https://en.wikipedia.org/wiki/Microsoft_SmartScreen>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1447080#c15)• 7 years ago |
|  | |

Hey Romain, can Product provide some input here? Sounds like we probably want to ship this flag but there's an open question as to how annoying it might be for the user. We could tie this to a hidden pref if we think users might want a way to disable. Although I'd prefer not adding that unless we absolutely need it.Flags: needinfo?(rtestard)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1447080#c16)• 7 years ago |
|  | |

Attached image
[Win7 SmartScreen warning](attachment.cgi?id=8962702)
— [Details](attachment.cgi?id=8962702&action=edit)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a672675_279663)• 7 years ago |

User Story: (updated)

|  | [Romain Testard [:RT]](/user_profile?user_id=486264) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1447080#c17)• 7 years ago |
|  | |

(In reply to Jim Mathies [:jimm] from [comment #15](/show_bug.cgi?id=1447080#c15 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> Hey Romain, can Product provide some input here? Sounds like we probably
> want to ship this flag but there's an open question as to how annoying it
> might be for the user. We could tie this to a hidden pref if we think users
> might want a way to disable. Although I'd prefer not adding that unless we
> absolutely need it.
My understanding is that this will only impact Win10 users updating to Redstone 4 (Released Apr 10th it seems).
I tested the files provided in the user story (I run Redstone 3 with Firefox 59.0.2) and both get me a warning screen (red for the known malware and blue for the unknown program) when I attempt to run them (see attached). Can you clarify what is the actual Win10 user experience if SEE\_MASK\_FLAG\_NO\_UI is \*not\* set with Redstone 4 ?
Also do we have telemetry for how often we set that flag on Win10?Flags: needinfo?(rtestard)

|  | [Romain Testard [:RT]](/user_profile?user_id=486264) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1447080#c18)• 7 years ago |
|  | |

Attached image
[knownmalicious.exe on win10](attachment.cgi?id=8963034)
— [Details](attachment.cgi?id=8963034&action=edit)

knownmalicious.exe on win10

|  | [Romain Testard [:RT]](/user_profile?user_id=486264) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1447080#c19)• 7 years ago |
|  | |

Attached image
[freevideo.exe on win10](attachment.cgi?id=8963036)
— [Details](attachment.cgi?id=8963036&action=edit)

|  | [David Parks [:handyman]](/user_profile?user_id=506442) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1447080#c20)• 7 years ago |
|  | |

FWIW, I'd add that the "unknown program" case Romain speaks of (the freevideo.exe one) requires the user to click "More Information" to get to a prompt that allows them to run the program anyway. Since Firefox is my browser, I very rarely see this prompt so it trips me up every time. It takes me a moment to figure out what to do and I already know what to do.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1447080#c21)• 7 years ago |
|  | |

(In reply to Romain Testard [:RT] from [comment #17](/show_bug.cgi?id=1447080#c17 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> (In reply to Jim Mathies [:jimm] from [comment #15](/show_bug.cgi?id=1447080#c15 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> > Hey Romain, can Product provide some input here? Sounds like we probably
> > want to ship this flag but there's an open question as to how annoying it
> > might be for the user. We could tie this to a hidden pref if we think users
> > might want a way to disable. Although I'd prefer not adding that unless we
> > absolutely need it.
>
> My understanding is that this will only impact Win10 users updating to
> Redstone 4 (Released Apr 10th it seems).
Correct.
> I tested the files provided in the user story (I run Redstone 3 with Firefox
> 59.0.2) and both get me a warning screen (red for the known malware and blue
> for the unknown program) when I attempt to run them (see attached). Can you
> clarify what is the actual Win10 user experience if SEE\_MASK\_FLAG\_NO\_UI is
> \*not\* set with Redstone 4 ?
According to Microsoft the second two test cases would result in execution without a prompt starting in redstone 4. We still get a block in #1, but apparently we won't get the Windows warning dialog, it'll just fail silently.
> Also do we have telemetry for how often we set that flag on Win10?
We pass this to the API call that launches 3rd party apps for us, so we always pass it. The question is do we want to stop doing that.
The more I dig into this, the more I'm convinced we should take this change.Status: UNCONFIRMED → NEWEver confirmed: trueFlags: needinfo?(rtestard)

|  | [Romain Testard [:RT]](/user_profile?user_id=486264) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1447080#c22)• 7 years ago |
|  | |

Thanks. Talking about experience change between current and Redstone 4 with flag removed my understanding is it will be:
1 Known malware: currently the user sees the red screen, in Redstone 4 with flag removed the user would just see nothing (silent fail. This sounds fine to me if the security risk warrants preventing the user from running the file
2 Unknown program: currently the user sees the blue screen, in Redstone 4 with flag removed the user would still see the blue screen (no change). (I understand from the user story that there is a block in this case and I assume the blue screen as UI)
It sounds to me like we should implement the change since the user experience is only impacted in (1) in a case where known malware would now be prevented from running.
My question above on telemetry was to understand how often the average user sees the screen in scenario (2) although if my interpretation is right this will not change assuming we remove the flag so no need to look into this.Flags: needinfo?(rtestard)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1447080#c23)• 7 years ago |
|  | |

(In reply to Romain Testard [:RT] from [comment #22](/show_bug.cgi?id=1447080#c22 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> Thanks. Talking about experience change between current and Redstone 4 with
> flag removed my understanding is it will be:
> 1 Known malware: currently the user sees the red screen, in Redstone 4 with
> flag removed the user would just see nothing (silent fail. This sounds fine
> to me if the security risk warrants preventing the user from running the file
This is incorrect. Currently Firefox will trigger a blocked execution prompt in pre-redstone4 versions of Windows. In redstone4, (according to our ms friend here) current Firefox will fail silently. Landing the patch here (removing the "don't show ui" flag) will not impact Firefox behavior on pre-redtone4, with redstone4 landing the patch will trigger a blocked execution prompt.
> 2 Unknown program: currently the user sees the blue screen, in Redstone 4
> with flag removed the user would still see the blue screen (no change). (I
> understand from the user story that there is a block in this case and I
> assume the blue screen as UI)
Reversed again, but generally yes we want to fix the issue where the blue screen might not display. Landing this patch will accomplish this.
> It sounds to me like we should implement the change since the user
> experience is only impacted in (1) in a case where known malware would now
> be prevented from running.
Ok, we're going land this such that on redstone 4 and beyond, our users get prompted with warnings in all three cases here. Without this patch, those warnings would not be displayed (as they currently are in pre-redstone4 releases of Windows.)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1447080#c24)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
We've decided to take this.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: review?(davidp99)

|  | [David Parks [:handyman]](/user_profile?user_id=506442) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1447080#c25)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
Review of [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342):
-----------------------------------------------------------------
Agreed. Its too valuable to go without.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: review?(davidp99) → review+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a1917548_279663)• 7 years ago |

Blocks: [CVE-2007-4841](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1447080#c26)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
This is not a vulnerability bug. Flag change that impacts operating system security response to 3rd party content handling via Firefox.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
no
Which older supported branches are affected by this flaw?
all
If not all supported branches, which bug introduced the flaw?
[bug 394974](/show_bug.cgi?id=394974 "RESOLVED FIXED - URIs with invalid % encodings launch wrong handler on WinXP+IE7")
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
no, and this is not needed. we're going to fix this in current release, and uplift to 60 ESR.
How likely is this patch to cause regressions; how much testing does it need?
medium?
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1447080#c27)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
As a sec-moderate, this doesn't need sec-approval to land. Let's get it onto trunk and then see about uplifting it to Beta. That will need to happen within the next two weeks so we have a couple of beta left before we ship 60.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: sec-approval?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a2051552_279663)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1447080#c28)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/56bfd2178dcad46a5b611b14e31938f1d96124a0>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1447080#c29)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/56bfd2178dca>Status: NEW → RESOLVEDClosed: 7 years ago
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla61

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1447080#c30)• 7 years ago |
|  | |

Seems worth a Beta uplift request at least. What are your thoughts on ESR52 (EOL in late August)?Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1447080#c31)• 7 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #30](/show_bug.cgi?id=1447080#c30 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> Seems worth a Beta uplift request at least. What are your thoughts on ESR52
> (EOL in late August)?
Once we've verified this is 'ok', this patch can ship to pretty much any release we have right now.Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1447080#c32)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
Approval Request Comment
[Feature/Bug causing the regression]:
A newer version of Windows will ship feature changes that are impacted by this flag.
[User impact if declined]:
No warning UI when users interact with untrusted files.
[Is this code covered by automated tests?]:
yes.
[Has the fix been verified in Nightly?]:
No, we probably should ask for pi on the affected windows version. I will file a pi request.
[Needs manual test from QE? If yes, steps to reproduce]:
see user story
[List of other uplifts needed for the feature/fix]:
none
[Is the change risky?]:
no
[Why is the change risky/not risky?]:
well understood side effects.
[String changes made/needed]:
none.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a2164227_75935)• 7 years ago |

Group: layout-core-security → core-security-release

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a2230200_75935)• 7 years ago |

Flags: qe-verify+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1447080#c33)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
Approved for 60.0b13. Per Jim's PI request, let's get some extra QA attention on it as well.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1447080#c34)• 7 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/ed7be30d3141>
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1447080#c35)• 7 years ago |
|  | |

Hey jafeher, We're not seeing the prompting in Windows version 1803 (OS Build 17133.73) with our updated version of Firefox. Just want to confirm that the new behavior you describe is in the Windows build above.Flags: needinfo?(jafeher)

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1447080#c36)• 7 years ago |
|  | |

Yes this behavior should exist in that build.
Is this change available in any public beta version of firefox that I can test?Flags: needinfo?(jafeher) → needinfo?(jmathies)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1447080#c37)• 7 years ago |
|  | |

Yes, 60.0b13 was released today with this fix included.
<https://www.mozilla.org/en-US/firefox/channel/desktop/>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a2529365_279663)• 7 years ago |

Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a2529375_279663)• 7 years ago |

Flags: needinfo?(jafeher)

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1447080#c38)• 7 years ago |
|  | |

Thanks for the information.
We did not realize that Firefox/Chrome call ShellexecuteExW in different ways. There is also a Windows bug in the path that firefox calls. We are working on a fix and will get this out in an early servicing patch.
Let me know if you require any other information.Flags: needinfo?(jafeher)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a3385826_280903)• 7 years ago |

Whiteboard: [adv-main60+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1447080#c39)• 7 years ago |
|  | |

This seems to have missed the ESR52 train as well despite being tracking for 60+ and affected.Flags: needinfo?(lhenry)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1447080#c40)• 7 years ago |
|  | |

Can you create a patch for esr52 and request uplift? Thanks.Flags: needinfo?(lhenry) → needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1447080#c41)• 7 years ago |
|  | |

(In reply to Jimmy from [comment #38](/show_bug.cgi?id=1447080#c38 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> Thanks for the information.
>
> We did not realize that Firefox/Chrome call ShellexecuteExW in different
> ways. There is also a Windows bug in the path that firefox calls. We are
> working on a fix and will get this out in an early servicing patch.
>
> Let me know if you require any other information.
Thanks for the follow up. Is there something we can change on our side? The code in question is here [1]. (In reply to Liz Henry (:lizzard) (needinfo? me) from [comment #40](/show_bug.cgi?id=1447080#c40 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> Can you create a patch for esr52 and request uplift? Thanks.
The existing patch should apply cleanly there, it's a one line change. I'll flag it.Flags: needinfo?(jmathies)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1447080#c42)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
New security related behavioral change in Windows 10 needs to be enabled on our end through a minor code change.
User impact if declined:
Issues with silent failures when handling file downloads under the newest version of windows 10.
Fix Landed on Version:
60, 61.
Risk to taking this patch (and alternatives if risky):
Low risk, well understood change requested by Microsoft.
String or UUID changes made by this patch:
none.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: approval-mozilla-esr52?

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1447080#c43)• 7 years ago |
|  | |

Comment on [attachment 8962342](/attachment.cgi?id=8962342 "patch v.1") [[details]](/attachment.cgi?id=8962342&action=edit "patch v.1") [[diff]](/attachment.cgi?id=8962342&action=diff "patch v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1447080&attachment=8962342)
patch v.1
While this is a fix for a sec-moderate issue I think it warrants uplift to esr52 because it may be a widespread issue with the upcoming Windows update.
[Attachment #8962342](/attachment.cgi?id=8962342&action=edit "patch v.1") -
Flags: approval-mozilla-esr52? → approval-mozilla-esr52+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a3628954_280903)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1447080#c44)• 7 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr52/rev/621034a42acc>
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=fixed)Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a3639917_280903)• 7 years ago |

Whiteboard: [adv-main60+] → [adv-main60+][adv-esr52.8+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a3657822_280903)• 7 years ago |

Alias: CVE-2018-5174

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1447080#c45)• 7 years ago |
|  | |

Hi Jim,
I have retested this issue (followed the steps from [comment 0](/show_bug.cgi?id=1447080#c0 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass")) on Windows 10 x64 Version 1803 (OS Build 17134.5), and the prompts are still not displayed, on 52.8.1 Esr, 60.0.2 Release and 61.0b14 Beta.
It seems that Edge/Chrome blocks properly both files mentioned in [comment 0](/show_bug.cgi?id=1447080#c0 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"), when running them.
Any idea what might be wrong here, can you please take a look?Flags: needinfo?(jmathies)

|  | [Jimmy](/user_profile?user_id=614245)  Reporter |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1447080#c46)• 7 years ago |
|  | |

This fix required a change on the Windows side as well. It is going through servicing now and will be released at the end of this month. I'm not sure of the exact date.
I have validated that firefox has the same behavior as Edge/Chrome with this update.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1447080#c47)• 7 years ago |
|  | |

(In reply to Jimmy from [comment #46](/show_bug.cgi?id=1447080#c46 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass"))
> This fix required a change on the Windows side as well. It is going through
> servicing now and will be released at the end of this month. I'm not sure of
> the exact date.
>
> I have validated that firefox has the same behavior as Edge/Chrome with this
> update.
Thanks!Flags: needinfo?(jmathies)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1447080#a14038603_1689)• 6 years ago |

Group: core-security-release

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1447080#c48)• 6 years ago |
|  | |

Closing this bug as verified fixed per [comment 46](/show_bug.cgi?id=1447080#c46 "VERIFIED FIXED - Security: SEE_MASK_FLAG_NO_UI behavior changes in Windows 10, allowing SmartScreen bypass").

Status: RESOLVED → VERIFIEDFlags: qe-verify+
You need to [log in](/show_bug.cgi?id=1447080&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jim Mathies [:jimm]](/user_profile?user_id=279663)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_b4b24f78_20250125_155645.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1432358)
* [XML](/show_bug.cgi?ctype=xml&id=1432358)

Closed
[Bug 1432358](/show_bug.cgi?id=1432358)
(CVE-2018-5175)

Opened 7 years ago
Closed 7 years ago

# Universal CSP strict-dynamic bypass via require.js of browser resource

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Universal CSP strict-dynamic bypass via require.js of browser resource

## Categories

### (Core :: DOM: Security, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Security#DOM%3A%20Security)

DOM: Security
▾

Core :: DOM: Security
Native content-based security features including: Content Security Policy (CSP), Mixed Content Blocker (MCB), and Safe Browsing.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Security&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Security)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

60 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla60

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix) |
| firefox58 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix) |
| firefox59 | [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix) |
| firefox60 | [+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=verified) |
| firefox61 | --- | [verified](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | - | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox58 |  | wontfix |
| firefox59 | + | wontfix |
| firefox60 | + | verified |
| firefox61 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: masatokinugawa, Assigned: ckerschb)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=40)  [ckerschb](/user_profile?user_id=363267)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1a5bce24526a7d6f1ab89678df2d673c?d=mm&size=40)  [masatokinugawa](/user_profile?user_id=393170)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=40)  [freddy](/user_profile?user_id=428608)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### (Depends on 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1439444](/show_bug.cgi?id=1439444 "VERIFIED FIXED - Firefox nightly shows XML content as plain text"), [1439964](/show_bug.cgi?id=1439964 "RESOLVED DUPLICATE - The image is wrongly displayed if the \"View Image\" option is used"), [1443110](/show_bug.cgi?id=1443110 "RESOLVED FIXED - Crash in nsDocument::InitCSP via nsHTMLDocument::StartDocumentLoad")

[1438796](/show_bug.cgi?id=1438796 "NEW - Re-Enable test_ext_contentscript_triggeringPrincipal.js on Windows Debug")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1432358&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1432358)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: csectype-other, reporter-external, sec-moderate, Whiteboard: [domsecurity-active][adv-main60+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-5175

[Keywords:](/describekeywords.cgi)

[csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[domsecurity-active][adv-main60+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c84 "7 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c80 "7 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (7 files, 10 obsolete files)

| [csp\_bypass\_require.html](/attachment.cgi?id=8944629)  [7 years ago](#c0)  [Masato Kinugawa](/user_profile?user_id=393170)   407 bytes, text/html |  | [Details](/attachment.cgi?id=8944629&action=edit) |
| --- | --- | --- |
| [bug\_1432358\_apply\_csp\_to\_resource\_uri.patch](/attachment.cgi?id=8945065)  [7 years ago](#c11)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   2.86 KB, patch |  | [Details](/attachment.cgi?id=8945065&action=edit) | [Diff](/attachment.cgi?id=8945065&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945065) |
| [bug\_1432358\_test\_resource\_uri.patch](/attachment.cgi?id=8945066)  [7 years ago](#c13)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   3.39 KB, patch |  | [Details](/attachment.cgi?id=8945066&action=edit) | [Diff](/attachment.cgi?id=8945066&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945066) |
| [csp\_bypass\_require\_chromeurl.html](/attachment.cgi?id=8945081)  [7 years ago](#c19)  [Masato Kinugawa](/user_profile?user_id=393170)   446 bytes, text/html |  | [Details](/attachment.cgi?id=8945081&action=edit) |
| [bug\_1432358\_apply\_csp\_to\_resource\_uri.patch](/attachment.cgi?id=8945177)  [7 years ago](#c22)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   2.82 KB, patch | Gijs : [review+](#c28 "7 years ago") | [Details](/attachment.cgi?id=8945177&action=edit) | [Diff](/attachment.cgi?id=8945177&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945177) |
| [bug\_1432358\_test\_subjecttocsp.patch](/attachment.cgi?id=8945178)  [7 years ago](#c24)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   4.44 KB, patch | Gijs : [review+](#c29 "7 years ago") | [Details](/attachment.cgi?id=8945178&action=edit) | [Diff](/attachment.cgi?id=8945178&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945178) |
| [bug\_1432358\_apply\_csp\_to\_resource.patch](/attachment.cgi?id=8945420)  [7 years ago](#c30)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   2.80 KB, patch | ckerschb : [review+](#c30 "7 years ago")  abillings : [sec-approval+](#a950109_280903 "7 years ago") | [Details](/attachment.cgi?id=8945420&action=edit) | [Diff](/attachment.cgi?id=8945420&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420) |
| [bug\_1432358\_test\_subjecttocsp.patch](/attachment.cgi?id=8945421)  [7 years ago](#c31)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   5.36 KB, patch | ckerschb : [review+](#c31 "7 years ago") | [Details](/attachment.cgi?id=8945421&action=edit) | [Diff](/attachment.cgi?id=8945421&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945421) |
| [bug\_1432358\_update\_test\_triggeringPrincipal.patch](/attachment.cgi?id=8945444)  [7 years ago](#c32)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   1.66 KB, patch |  | [Details](/attachment.cgi?id=8945444&action=edit) | [Diff](/attachment.cgi?id=8945444&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945444) |
| [bug\_1432358\_update\_test\_jsonview.patch](/attachment.cgi?id=8945483)  [7 years ago](#c33)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   740 bytes, patch | Honza : [review+](#c34 "7 years ago") | [Details](/attachment.cgi?id=8945483&action=edit) | [Diff](/attachment.cgi?id=8945483&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483) |
| [bug\_1432358\_update\_overridescsp.patch](/attachment.cgi?id=8946410)  [7 years ago](#c41)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   1.98 KB, patch | kmag : [review+](#c42 "7 years ago") | [Details](/attachment.cgi?id=8946410&action=edit) | [Diff](/attachment.cgi?id=8946410&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8946410) |
| [bug\_1432358\_allow\_dropping\_csp.patch](/attachment.cgi?id=8947044)  [7 years ago](#c45)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   7.83 KB, patch |  | [Details](/attachment.cgi?id=8947044&action=edit) | [Diff](/attachment.cgi?id=8947044&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947044) |
| [bug\_1432358\_channel\_csp\_agnostic.patch](/attachment.cgi?id=8947380)  [7 years ago](#c51)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   15.06 KB, patch | smaug : [review+](#c52 "7 years ago") | [Details](/attachment.cgi?id=8947380&action=edit) | [Diff](/attachment.cgi?id=8947380&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947380) |
| [bug\_1432358\_update\_overridescsp.patch](/attachment.cgi?id=8947427)  [7 years ago](#c53)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   1.88 KB, patch | ckerschb : [review+](#a816038_363267 "7 years ago")  abillings : [sec-approval+](#a950137_280903 "7 years ago") | [Details](/attachment.cgi?id=8947427&action=edit) | [Diff](/attachment.cgi?id=8947427&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947427) |
| [bug\_1432358\_channel\_csp\_agnostic.patch](/attachment.cgi?id=8947428)  [7 years ago](#c54)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   15.06 KB, patch | ckerschb : [review+](#a816044_363267 "7 years ago")  abillings : [sec-approval+](#a950172_280903 "7 years ago") | [Details](/attachment.cgi?id=8947428&action=edit) | [Diff](/attachment.cgi?id=8947428&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947428) |
| [bug\_1432358\_fix\_xpcshell\_test.patch](/attachment.cgi?id=8950155)  [7 years ago](#c64)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   1.09 KB, patch | aryx : [review+](#a1756941_258347 "7 years ago")  ckerschb : [sec-approval+](#c65 "7 years ago") | [Details](/attachment.cgi?id=8950155&action=edit) | [Diff](/attachment.cgi?id=8950155&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8950155) |
| [bug\_1432358\_fix\_xpcshell\_test.patch](/attachment.cgi?id=8951547)  [7 years ago](#c69)  [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)   1.12 KB, patch | aryx : [review+](#a2116040_258347 "7 years ago")  ckerschb : [sec-approval+](#c70 "7 years ago") | [Details](/attachment.cgi?id=8951547&action=edit) | [Diff](/attachment.cgi?id=8951547&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8951547) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1432358#c0)• 7 years ago |
|  | |

Attached file
[csp\_bypass\_require.html](attachment.cgi?id=8944629)
— [Details](attachment.cgi?id=8944629&action=edit)

User Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0
Build ID: 20180122220231
Steps to reproduce:
The URLs located in `resource://devtools-client-jsonview/.\*` bypass CSP. ( maybe intentionally )
A `require.js` file is in the this directory and it can be used for CSP strict-dynamic bypass against any websites.
Steps to reproduce:
1. Go to attached PoC( csp\_bypass\_require.html ). This page has strict CSP rules:
<meta http-equiv="Content-Security-Policy" content="default-src 'none';script-src 'nonce-random' 'strict-dynamic'">
2. However, you can see `alert(1)`. It is executed from the following code:
<script data-main='data:,alert(1)'></script>
<script src="resource://devtools-client-jsonview/lib/require.js"></script>
Actual results:
CSP strict-dynamic is bypassed via browser resources.
Expected results:
CSP strict-dynamic should not be bypassed via browser resources.

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a434_393170)• 7 years ago |

Summary: CSP strict-dynamic bypass via require.js → Universal CSP strict-dynamic bypass via require.js of browser resource

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1432358#c1)• 7 years ago |
|  | |

FYI, the possibility of strict-dynamic bypass by `require.js` is already known.
You can find some CSP bypass variations including it from this research by Google: <https://github.com/google/security-research-pocs/tree/master/script-gadgets>

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1432358#c2)• 7 years ago |
|  | |

Honza/Christoph, do you have ideas about where this should live / where/how we can address this? Thanks!Flags: needinfo?(odvarko)Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1432358#c3)• 7 years ago |
|  | |

FWIW, this whitelisting of resource URIs is happening here:
<https://dxr.mozilla.org/mozilla-central/source/dom/security/nsCSPService.cpp#88-97>
I think the bug should live in DOM:Security since it's a CSP bug, but I don't know what the best way of addressing this problem is. Ultimately browser internals should not be affected by a page's CSP. This case makes a unified behavior tricky however.
I am happy to implement the changes here, but I don't know what's the best strategy to accomplish.Group: firefox-core-security → core-securityComponent: Untriaged → DOM: SecurityFlags: needinfo?(ckerschb)Product: Firefox → Core

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1432358#c4)• 7 years ago |
|  | |

I don't have enough experience with CSP to help here.
HonzaFlags: needinfo?(odvarko)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1432358#c5)• 7 years ago |
|  | |

I understand why we're loading the resource: url despite the CSP. Now that we don't support legacy extensions maybe we can stop doing that. But I don't understand how react.js executes the data-main if CSP is preventing inline script and eval. Does react know about strict-dynamic and dig up the nonce to create passable scripts?Assignee: nobody → ckerschbGroup: core-security → dom-core-securityStatus: UNCONFIRMED → NEWEver confirmed: trueKeywords: [csectype-other](/buglist.cgi?keywords=csectype-other&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Priority: -- → P1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1432358#c6)• 7 years ago |
|  | |

Not sure we should be exposing react to every web page. Can this resource be made non-accessible? I don't know if resource: supports that like chrome: and moz-extension:

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1432358#c7)• 7 years ago |
|  | |

Sorry, "require.js", not "react". Thinking of the wrong library.

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1432358#c8)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #5](/show_bug.cgi?id=1432358#c5 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
>I don't understand how react.js executes the data-main if CSP is preventing inline script and eval.
Basically require.js executes the following code using the data-main attribute:
script=document.createElement('script');
script.src='data:,alert(1)';
document.head.appendChild(script);
You can confirm this behavior by putting a break point here:
<https://dxr.mozilla.org/mozilla-beta/source/devtools/client/jsonview/lib/require.js#1903>
A strict-dynamic does not block the script execution via non-"parser-inserted" script elements:
<https://www.w3.org/TR/CSP3/#strict-dynamic-usage>
>Script requests which are triggered by non-"parser-inserted" script elements are allowed.
Due to this, it works.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1432358#c9)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #6](/show_bug.cgi?id=1432358#c6 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Can this resource be
> made non-accessible? I don't know if resource: supports that like chrome:
> and moz-extension:
resource: in principle supports this ([bug 863246](/show_bug.cgi?id=863246 "VERIFIED FIXED - resource:// URIs leak information (Tor 8725)")). But the JSON view executes in a content-privileged sandbox, and so I don't know if it would be possible to restrict its own script sources in this way. I would be somewhat surprised if so.
(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #3](/show_bug.cgi?id=1432358#c3 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> FWIW, this whitelisting of resource URIs is happening here:
>
> <https://dxr.mozilla.org/mozilla-central/source/dom/security/nsCSPService>.
> cpp#88-97
Like Dan, I don't think I understand why this is necessary. Why can't we just make resource: URIs obey CSP?
> Ultimately browser internals should not be affected by a page's CSP.
I agree, but certainly for the JSON viewer, the viewer has control over the relevant CSP headers because it munges the request, AIUI. Presumably it could set different headers, ie here: <https://dxr.mozilla.org/mozilla-central/rev/c4ebc8c28a33b785dfbfa533810517cc707d1ad0/devtools/client/jsonview/converter-child.js#79> ? Christoph, would that work? Why do we specialcase resource: at all?Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1432358#c10)• 7 years ago |
|  | |

(In reply to :Gijs (lower availability until Jan 27) from [comment #9](/show_bug.cgi?id=1432358#c9 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Like Dan, I don't think I understand why this is necessary. Why can't we
> just make resource: URIs obey CSP?
That decision predates my time at Mozilla. I vaguely remember when we rewrote CSP in C++ (formerly our implementation was based on JS) we already whitelisted resource URIs, I guess mostly because of extensions. Unfortunately I couldn't dig out the exact bug, only the one that introduces subjectToCSP(), but even that bug didn't change that exclusion of resource: loads for CSP [1].
Anyway, I agree with both of you, probably we don't have to specialcase resource URIs now that we don't support legacy extensions anymore. Let's see how TRY likes that and we can take it from there:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=7ef53f8052af82b2abc53de2ddcbe59969e92c4b>
[1] <https://hg.mozilla.org/integration/mozilla-inbound/rev/80b2348e3ab6#l1.109>Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1432358#c11)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_apply\_csp\_to\_resource\_uri.patch](attachment.cgi?id=8945065&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945065&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945065)

Given the TRY run and our reasoning I think we can change subjectToCSP() to include resource URIs. It seems the only test affected is browser\_jsonview\_csp\_json.js within devtools - I am not sure if this change of making resource URIs subject to CSP will affect more things within devtools.
Honza, any insights? Also we would have to fix browser\_jsonview\_csp\_json.js, any suggestions how to accomplish that?
Would it make sense to land the change but also add a pref around it, in case we have to revert the change for any reason?
[Attachment #8945065](/attachment.cgi?id=8945065&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1432358#c12)• 7 years ago |
|  | |

Honza, please have a look at [comment 11](/show_bug.cgi?id=1432358#c11 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource") - thanks!Flags: needinfo?(odvarko)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1432358#c13)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_test\_resource\_uri.patch](attachment.cgi?id=8945066&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945066&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945066)

And here is the automated test!
[Attachment #8945066](/attachment.cgi?id=8945066&action=edit "bug_1432358_test_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1432358#c14)• 7 years ago |
|  | |

Just chatted with Patrick on IRC and it seems that most likely that change of having CSP apply to resource: URIs will affect devtools a whole lot. Also given browser\_jsonview\_csp\_json.js. Exactly what we are trying to prevent, devtools code relies on. E.g. the error on the console for browser\_jsonview\_csp\_json.js is:
Content Security Policy: The page’s settings blocked the loading of a resource at resource://devtools-client-jsonview/css/main.css (“default-src”).
Content Security Policy: The page’s settings blocked the loading of a resource at resource://devtools-client-jsonview/lib/require.js (“default-src”)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1432358#c15)• 7 years ago |
|  | |

Comment on [attachment 8945065](/attachment.cgi?id=8945065 "bug_1432358_apply_csp_to_resource_uri.patch") [[details]](/attachment.cgi?id=8945065&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") [[diff]](/attachment.cgi?id=8945065&action=diff "bug_1432358_apply_csp_to_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945065)
bug\_1432358\_apply\_csp\_to\_resource\_uri.patch
Review of [attachment 8945065](/attachment.cgi?id=8945065 "bug_1432358_apply_csp_to_resource_uri.patch") [[details]](/attachment.cgi?id=8945065&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") [[diff]](/attachment.cgi?id=8945065&action=diff "bug_1432358_apply_csp_to_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945065):
-----------------------------------------------------------------
So, luckily, as far as I can tell this require.js file isn't accessible via chrome:// , for one because it's not packaged / in the same location as the chrome:// stuff, and also because chrome://devtools isn't contentaccessible . But that seems a fragile thing to rely on. Why do we need to have any exceptions here? Does more stuff break if chrome:// is subject to CSP? I guess I kind of assume that things that run in content frame scripts and so on have chrome privileges and already don't encounter CSP, irrespective of the URIs of their respective resources, and I can think of no cases where we directly intend to inject chrome:// URI stuff into web content (that is subject to CSP).
::: dom/security/nsCSPService.cpp
@@ +57,2 @@
> // protocol flag (URI\_IS\_LOCAL\_RESOURCE) with other protocols, like
> + // chrome: and moz-icon:, but those protocols are subject to CSP,
I don't really know why we shouldn't make chrome and moz-icon subject to CSP, too...
@@ +89,5 @@
> }
>
> // Other protocols are not subject to CSP and can be whitelisted:
> // \* URI\_IS\_LOCAL\_RESOURCE
> + // e.g. chrome:, data:, blob:, moz-icon:
Looks like data: and blob: also want removing from this list.
[Attachment #8945065](/attachment.cgi?id=8945065&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1432358#c16)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #14](/show_bug.cgi?id=1432358#c14 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Just chatted with Patrick on IRC and it seems that most likely that change
> of having CSP apply to resource: URIs will affect devtools a whole lot. Also
> given browser\_jsonview\_csp\_json.js. Exactly what we are trying to prevent,
> devtools code relies on. E.g. the error on the console for
> browser\_jsonview\_csp\_json.js is:
>
> Content Security Policy: The page’s settings blocked the loading of a
> resource at resource://devtools-client-jsonview/css/main.css
> (“default-src”).
> Content Security Policy: The page’s settings blocked the loading of a
> resource at resource://devtools-client-jsonview/lib/require.js
> (“default-src”)
Yes. My suggestion (poorly expressed) in [comment #9](/show_bug.cgi?id=1432358#c9 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"), is that we alter the CSP header / data when invoking the JSON viewer, and make specific exceptions for the sources we need in addition to whatever the contents of the CSP are at that point.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1432358#c17)• 7 years ago |
|  | |

Comment on [attachment 8945066](/attachment.cgi?id=8945066 "bug_1432358_test_resource_uri.patch") [[details]](/attachment.cgi?id=8945066&action=edit "bug_1432358_test_resource_uri.patch") [[diff]](/attachment.cgi?id=8945066&action=diff "bug_1432358_test_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945066)
bug\_1432358\_test\_resource\_uri.patch
Review of [attachment 8945066](/attachment.cgi?id=8945066 "bug_1432358_test_resource_uri.patch") [[details]](/attachment.cgi?id=8945066&action=edit "bug_1432358_test_resource_uri.patch") [[diff]](/attachment.cgi?id=8945066&action=diff "bug_1432358_test_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945066):
-----------------------------------------------------------------
::: dom/security/test/csp/file\_resource\_url.html
@@ +12,5 @@
> +<script>document.getElementById("regScriptDiv").textContent="allowed";</script>
> +
> +<!-- resource URL test -->
> +<script data-main='data:,document.getElementById("resourceScriptDiv").textContent="allowed;"'></script>
> +<script src="resource://devtools-client-jsonview/lib/require.js"></script>
I think we shouldn't make this dom/ test rely on the contents of a devtools bit of code.
We should make the test create its own resource: mapping dynamically (at runtime) using setSubstitutionWithFlags on the protocol handler (making sure to make the relevant resource: thing contentaccessible) and then attempt to access that from the file we load.
[Attachment #8945066](/attachment.cgi?id=8945066&action=edit "bug_1432358_test_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1432358#c18)• 7 years ago |
|  | |

(In reply to :Gijs (lower availability until Jan 27) from [comment #15](/show_bug.cgi?id=1432358#c15 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Why do we need to have any
> exceptions here? Does more stuff break if chrome:// is subject to CSP? I
> guess I kind of assume that things that run in content frame scripts and so
> on have chrome privileges and already don't encounter CSP, irrespective of
> the URIs of their respective resources, and I can think of no cases where we
> directly intend to inject chrome:// URI stuff into web content (that is
> subject to CSP).
That seems like a fair assumption. Nothing that executes with system privileges is subject to CSP, so I think it makes sense what you are suggesting and we can also make chrome: and moz-icon subject to CSP.

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1432358#c19)• 7 years ago |
|  | |

Attached file
[csp\_bypass\_require\_chromeurl.html](attachment.cgi?id=8945081)
— [Details](attachment.cgi?id=8945081&action=edit)

(In reply to :Gijs (lower availability until Jan 27) from [comment #15](/show_bug.cgi?id=1432358#c15 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
>So, luckily, as far as I can tell this require.js file isn't accessible via chrome://
I noticed require.js can be fetched via chrome:// URL also.
We can access from: chrome://browser/content//chrome/devtools/modules/devtools/client/jsonview/lib/require.js
Please take notice to the two slashes of "content//chrome". I think this is an another issue which allows path traversal.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1432358#c20)• 7 years ago |
|  | |

(In reply to Masato Kinugawa from [comment #19](/show_bug.cgi?id=1432358#c19 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Created [attachment 8945081](/attachment.cgi?id=8945081 "csp_bypass_require_chromeurl.html") [[details]](/attachment.cgi?id=8945081&action=edit "csp_bypass_require_chromeurl.html")
> csp\_bypass\_require\_chromeurl.html
>
> (In reply to :Gijs (lower availability until Jan 27) from [comment #15](/show_bug.cgi?id=1432358#c15 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> >So, luckily, as far as I can tell this require.js file isn't accessible via chrome://
> I noticed require.js can be fetched via chrome:// URL also.
> We can access from:
> chrome://browser/content//chrome/devtools/modules/devtools/client/jsonview/
> lib/require.js
> Please take notice to the two slashes of "content//chrome". I think this is
> an another issue which allows path traversal.
Please file a separate bug for this.Flags: needinfo?(masatokinugawa)

|  | [Masato Kinugawa](/user_profile?user_id=393170)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1432358#c21)• 7 years ago |
|  | |

(In reply to :Gijs (lower availability until Jan 27) from [comment #20](/show_bug.cgi?id=1432358#c20 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Please file a separate bug for this.
Filed as [bug 1432870](/show_bug.cgi?id=1432870 "VERIFIED FIXED - Path traversal on chrome:// URLs").Flags: needinfo?(masatokinugawa)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1432358#c22)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_apply\_csp\_to\_resource\_uri.patch](attachment.cgi?id=8945177&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945177&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945177)

Gijs, as agreed we should also have subjectToCSP apply to chrome: URIs in addition to resource URIs. Try seems happy overall [1], there are only two issues:
\* test\_ext\_contentscript\_triggeringPrincipal.js
\* browser\_jsonview\_csp\_json.js
Once you are fine with the patch here I will follow up with devtools folks to get those issues resolved.
[Attachment #8945065](/attachment.cgi?id=8945065&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Attachment is obsolete: true
[Attachment #8945177](/attachment.cgi?id=8945177&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1432358#c23)• 7 years ago |
|  | |

Oh, I forgot, here is the TRY run for [comment 22](/show_bug.cgi?id=1432358#c22 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"):
[1] <https://treeherder.mozilla.org/#/jobs?repo=try&revision=c2182293c22c9ea9634ff9b0c9c376fe8a940161&selectedJob=158207724>

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1432358#c24)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_test\_subjecttocsp.patch](attachment.cgi?id=8945178&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945178&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945178)

And here is the automated test where we register a resource URI. Intially I wanted to capture the precise bypass, hence the initial test was based on require.js. Anyway, this test is self contained now and registers it's own chrome URI.
[Attachment #8945066](/attachment.cgi?id=8945066&action=edit "bug_1432358_test_resource_uri.patch") -
Attachment is obsolete: true
[Attachment #8945178](/attachment.cgi?id=8945178&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: review?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1432358#c25)• 7 years ago |
|  | |

Bit busy tonight, but from a quick look at the patch, why can't we just return true for all URIs with URI\_IS\_LOCAL\_RESOURCE, rather than enumerating all the sub-cases here? Does that not cover chrome: or some other URI schemes?
That is, prior to the patch, the state was:
// some local URI schemes bad:
if (scheme == "foo") {
return true;
}
if (scheme == "bar") {
return true;
}
// all other local schemes good:
if (uri.hasFlag(local)) {
return false;
}
Which URI schemes do we actually still need to treat as "good" here? Can't we just flip the default to "all local URI schemes participate in CSP", and only make exceptions for schemes with this flag that really really don't (maybe file: which I don't currently see mentioned but presumably has this flag?) ? [Though I also don't know why file: doesn't participate in CSP, but that's a question for another bug...)Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1432358#c26)• 7 years ago |
|  | |

(In reply to :Gijs (lower availability until Jan 27) from [comment #25](/show_bug.cgi?id=1432358#c25 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Bit busy tonight, but from a quick look at the patch, why can't we just
> return true for all URIs with URI\_IS\_LOCAL\_RESOURCE, rather than enumerating
> all the sub-cases here?
Potentially we can, but I am not sure if we should do that within this bug (which most likely will be uplifted) or rather file a follow up to make sure that assumption is not breaking anything else. I think the important part here is that resource and chrome become subject to CSP, right?
One of my question is, can anyone still register it's own ProtocolHandler besides Firefox itself these days given that legacy extensions are gone? If not, then the follow up will become a little easier. What do you think?Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a199971_363267)• 7 years ago |

Status: NEW → ASSIGNED

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1432358#c27)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #26](/show_bug.cgi?id=1432358#c26 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> One of my question is, can anyone still register it's own ProtocolHandler
> besides Firefox itself these days given that legacy extensions are gone?
No. Only web-based registerProtocolHandler, which shouldn't ever get URI\_IS\_LOCAL\_RESOURCE.
> If not, then the follow up will become a little easier. What do you think?
Yep, but it's also OK to do this in a separate bug as you suggested, if that's easier.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1432358#c28)• 7 years ago |
|  | |

Comment on [attachment 8945177](/attachment.cgi?id=8945177 "bug_1432358_apply_csp_to_resource_uri.patch") [[details]](/attachment.cgi?id=8945177&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") [[diff]](/attachment.cgi?id=8945177&action=diff "bug_1432358_apply_csp_to_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945177)
bug\_1432358\_apply\_csp\_to\_resource\_uri.patch
Review of [attachment 8945177](/attachment.cgi?id=8945177 "bug_1432358_apply_csp_to_resource_uri.patch") [[details]](/attachment.cgi?id=8945177&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") [[diff]](/attachment.cgi?id=8945177&action=diff "bug_1432358_apply_csp_to_resource_uri.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945177):
-----------------------------------------------------------------
::: dom/security/nsCSPService.cpp
@@ +61,2 @@
> // <http://www.w3.org/TR/CSP2/#source-list-guid-matching>
> +
Nit: whitespace
@@ +101,5 @@
> + }
> + rv = aURI->SchemeIs("moz-icon", &match);
> + if (NS\_SUCCEEDED(rv) && match) {
> + return true;
> + }
I wonder if, given the number of scheme comparisons here, this would be better written by just getting the scheme and using EqualsLiteral. Anyway, this is certainly OK for fixing this bug if you prefer not rewriting this method that drastically.
[Attachment #8945177](/attachment.cgi?id=8945177&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1432358#c29)• 7 years ago |
|  | |

Comment on [attachment 8945178](/attachment.cgi?id=8945178 "bug_1432358_test_subjecttocsp.patch") [[details]](/attachment.cgi?id=8945178&action=edit "bug_1432358_test_subjecttocsp.patch") [[diff]](/attachment.cgi?id=8945178&action=diff "bug_1432358_test_subjecttocsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945178)
bug\_1432358\_test\_subjecttocsp.patch
Review of [attachment 8945178](/attachment.cgi?id=8945178 "bug_1432358_test_subjecttocsp.patch") [[details]](/attachment.cgi?id=8945178&action=edit "bug_1432358_test_subjecttocsp.patch") [[diff]](/attachment.cgi?id=8945178&action=diff "bug_1432358_test_subjecttocsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945178):
-----------------------------------------------------------------
::: dom/security/test/csp/test\_resource\_uri.html
@@ +33,5 @@
> + // html file does apply meta CSP of:
> + // default-src 'none'; script-src 'nonce-random' 'strict-dynamic'
> + file: "file\_resource\_uri.html",
> + result: "blocked",
> + description: "resource: URI should be blocked by CSP",
Should we have a third test that we can allow the resource again if the full URI is included in the list of script-src's in the CSP?
@@ +42,5 @@
> + resourceHandler.setSubstitution("csptest", null);
> + SimpleTest.finish();
> +}
> +
> +function ckeckResult() {
Should be 'checkResult', I think.
[Attachment #8945178](/attachment.cgi?id=8945178&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: review?(gijskruitbosch+bugs) → review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1432358#c30)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_apply\_csp\_to\_resource.patch](attachment.cgi?id=8945420&action=diff)
— [Details](attachment.cgi?id=8945420&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420)

[Carrying over r+ from Gijs]
(In reply to :Gijs (lower availability until Jan 27) from [comment #28](/show_bug.cgi?id=1432358#c28 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> I wonder if, given the number of scheme comparisons here, this would be
> better written by just getting the scheme and using EqualsLiteral. Anyway,
> this is certainly OK for fixing this bug if you prefer not rewriting this
> method that drastically.
I think that makes sense and I have considered that as well. As agreed we can clean that entire function up in a follow up bug.
[Attachment #8945177](/attachment.cgi?id=8945177&action=edit "bug_1432358_apply_csp_to_resource_uri.patch") -
Attachment is obsolete: true
[Attachment #8945420](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") -
Flags: review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1432358#c31)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_test\_subjecttocsp.patch](attachment.cgi?id=8945421&action=diff)
— [Details](attachment.cgi?id=8945421&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945421)

[Carrying over r+ from Gijs]
(In reply to :Gijs (lower availability until Jan 27) from [comment #29](/show_bug.cgi?id=1432358#c29 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Should we have a third test that we can allow the resource again if the full
> URI is included in the list of script-src's in the CSP?
I like that suggestion, thanks. I have incorporated such a test within this patch.
[Attachment #8945178](/attachment.cgi?id=8945178&action=edit "bug_1432358_test_subjecttocsp.patch") -
Attachment is obsolete: true
[Attachment #8945421](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1432358#c32)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_update\_test\_triggeringPrincipal.patch](attachment.cgi?id=8945444&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945444&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945444)

Hey Kris, within this bug we are changing the behavior of CSP and make CSP apply to chrome: and resource: URIs as well. In turn this change causes test test\_ext\_contentscript\_triggeringPrincipal.js. The test applies default-src 'none' which with the patches from this bug applied causes the file chrome://global/content/bindings/scrollbar.xml to be blocked within your test.
I don't know if this change might have bigger implications than just fixing the test, so I am relying on your input. Anyway, the \*.xml file loads uses the internal load type of TYPE\_XBL which is governed by default-src within CSP. Whitelisting chrome: within default-src fixes the test.
Am I missing something or is it fine to just update the test?
[Attachment #8945444](/attachment.cgi?id=8945444&action=edit "bug_1432358_update_test_triggeringPrincipal.patch") -
Flags: review?(kmaglione+bmo)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1432358#c33)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_update\_test\_jsonview.patch](attachment.cgi?id=8945483&action=diff) (obsolete)
— [Details](attachment.cgi?id=8945483&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483)

Honza, as discussed on IRC; let's whitelist chrome: and resource: for that particular test for now with the potential problem that the code changes within this bug might affect devtools on a broader scale. We will have to do some thorough testing to make sure devtools still work in combination with CSP.
FWIW, I am whitelisting chrome and resource within that test because of:
\* resource://devtools-client-jsonview/css/main.css
\* chrome://global/content/bindings/scrollbar.xmlFlags: needinfo?(odvarko)
[Attachment #8945483](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") -
Flags: review?(odvarko)

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1432358#c34)• 7 years ago |
|  | |

Comment on [attachment 8945483](/attachment.cgi?id=8945483 "bug_1432358_update_test_jsonview.patch") [[details]](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") [[diff]](/attachment.cgi?id=8945483&action=diff "bug_1432358_update_test_jsonview.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483)
bug\_1432358\_update\_test\_jsonview.patch
Review of [attachment 8945483](/attachment.cgi?id=8945483 "bug_1432358_update_test_jsonview.patch") [[details]](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") [[diff]](/attachment.cgi?id=8945483&action=diff "bug_1432358_update_test_jsonview.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483):
-----------------------------------------------------------------
As we discussed on Slack, whitelisting the resource: protocol looks ok.
Thanks for the patch!
Honza
[Attachment #8945483](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") -
Flags: review?(odvarko) → review+

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1432358#c35)• 7 years ago |
|  | |

Comment on [attachment 8945444](/attachment.cgi?id=8945444 "bug_1432358_update_test_triggeringPrincipal.patch") [[details]](/attachment.cgi?id=8945444&action=edit "bug_1432358_update_test_triggeringPrincipal.patch") [[diff]](/attachment.cgi?id=8945444&action=diff "bug_1432358_update_test_triggeringPrincipal.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945444)
bug\_1432358\_update\_test\_triggeringPrincipal.patch
Review of [attachment 8945444](/attachment.cgi?id=8945444 "bug_1432358_update_test_triggeringPrincipal.patch") [[details]](/attachment.cgi?id=8945444&action=edit "bug_1432358_update_test_triggeringPrincipal.patch") [[diff]](/attachment.cgi?id=8945444&action=diff "bug_1432358_update_test_triggeringPrincipal.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945444):
-----------------------------------------------------------------
I don't think this affects just this test. This test doesn't particularly rely on the scrollbar.xml binding. That binding just happens to get loaded into most content pages, and this page has a (perfectly ordinary) CSP which blocks it. If these patches are causing this test to fail because the CSP blocks scrollbar.xml from loading, it probably also breaks scrollbars on any site with a similarly strict CSP.
[Attachment #8945444](/attachment.cgi?id=8945444&action=edit "bug_1432358_update_test_triggeringPrincipal.patch") -
Flags: review?(kmaglione+bmo)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1432358#c36)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #35](/show_bug.cgi?id=1432358#c35 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> I don't think this affects just this test. This test doesn't particularly
> rely on the scrollbar.xml binding. That binding just happens to get loaded
> into most content pages, and this page has a (perfectly ordinary) CSP which
> blocks it. If these patches are causing this test to fail because the CSP
> blocks scrollbar.xml from loading, it probably also breaks scrollbars on any
> site with a similarly strict CSP.
Gijs, I guess that puts us back to the start, right? Any suggestions on how to proceed?Flags: needinfo?(gijskruitbosch+bugs)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1432358#c37)• 7 years ago |
|  | |

Depending on the principal of the stylesheet that applies those bindings, it might be enough to make content injected by system principals immune to CSP here:
<https://searchfox.org/mozilla-central/rev/062e1cf551f5bf3f0af33671b818f75a55ac497b/caps/BasePrincipal.h#136-154>
That would leave chrome: and resource: URLs subject to CSP in the general case, but allow them when they're injected by chrome.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1432358#c38)• 7 years ago |
|  | |

Re: resource:/chrome: generally: We should try Kris' suggestion from [comment #37](/show_bug.cgi?id=1432358#c37 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"). Otherwise we can limit the new behaviour to resource: and fix chrome: separately.
(In reply to Jan Honza Odvarko [:Honza] from [comment #34](/show_bug.cgi?id=1432358#c34 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Comment on [attachment 8945483](/attachment.cgi?id=8945483 "bug_1432358_update_test_jsonview.patch") [[details]](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") [[diff]](/attachment.cgi?id=8945483&action=diff "bug_1432358_update_test_jsonview.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483)
> bug\_1432358\_update\_test\_jsonview.patch
>
> Review of [attachment 8945483](/attachment.cgi?id=8945483 "bug_1432358_update_test_jsonview.patch") [[details]](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") [[diff]](/attachment.cgi?id=8945483&action=diff "bug_1432358_update_test_jsonview.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945483):
> -----------------------------------------------------------------
>
> As we discussed on Slack, whitelisting the resource: protocol looks ok.
I have to admit this patch confuses me. My understanding (though I haven't tested to verify that...) is that this patch will break the json viewer on any JSON that has strict CSP, unless we hack up the jsonview content transformer/handler (that actually includes all the resource: based script etc. ) to force a change to the CSP to always allow resource: for content viewed in the JSON viewer. But the patch only fixes 1 test file, not the jsonview behaviour...Flags: needinfo?(gijskruitbosch+bugs) → needinfo?(odvarko)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1432358#c39)• 7 years ago |
|  | |

(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from [comment #37](/show_bug.cgi?id=1432358#c37 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Depending on the principal of the stylesheet that applies those bindings, it
> might be enough to make content injected by system principals immune to CSP
> here:
>
> <https://searchfox.org/mozilla-central/rev/>
> 062e1cf551f5bf3f0af33671b818f75a55ac497b/caps/BasePrincipal.h#136-154
>
> That would leave chrome: and resource: URLs subject to CSP in the general
> case, but allow them when they're injected by chrome.
Kris, thanks for the hint, I've tried that, but it seems content is \*not\* injected by the systemPrincipal in that case, at least not for the test test\_ext\_contentscript\_triggeringPrincipal.js. Any other suggestions that I could try to incorporate?Flags: needinfo?(kmaglione+bmo)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1432358#c40)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #39](/show_bug.cgi?id=1432358#c39 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Kris, thanks for the hint, I've tried that, but it seems content is \*not\*
> injected by the systemPrincipal in that case, at least not for the test
> test\_ext\_contentscript\_triggeringPrincipal.js. Any other suggestions that I
> could try to incorporate?
Ah, I see why. So your suggestion only applies to loads of TYPE\_STYLESHEET (see [1]). But we are loading chrome://global/content/bindings/scrollbar.xml with TYPE\_XBL which then presumably uses a different code path. Probably we can do a similar whitelisting as you suggested for the \*.xml. Let me see if I can find the right place in the code for that. I think that should be doable though.
[1] <https://dxr.mozilla.org/mozilla-central/source/layout/style/nsStyleUtil.cpp#887>

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1432358#c41)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_update\_overridescsp.patch](attachment.cgi?id=8946410&action=diff) (obsolete)
— [Details](attachment.cgi?id=8946410&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8946410)

Kris, thanks for your suggestion. It all makes sense now. Loads triggered by the system should bypass the CSP of the page. I don't know why that didn't work when I first tried this morning, but having overrideCSP() return true when called on a SystemPrincipal allows loading an XBL if triggered by the system here [1].
That whitelisting in turn allows test\_ext\_contentscript\_triggeringPrincipal.js to work properly again.
Do you feel comfortable accepting that change or do we need someone else to sign off on it as well?
[1] <https://dxr.mozilla.org/mozilla-central/source/dom/security/nsCSPService.cpp#142>
[Attachment #8945444](/attachment.cgi?id=8945444&action=edit "bug_1432358_update_test_triggeringPrincipal.patch") -
Attachment is obsolete: trueFlags: needinfo?(kmaglione+bmo)
[Attachment #8946410](/attachment.cgi?id=8946410&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: review?(kmaglione+bmo)

|  | [Kris Maglione [:kmag]](/user_profile?user_id=106098) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1432358#c42)• 7 years ago |
|  | |

Comment on [attachment 8946410](/attachment.cgi?id=8946410 "bug_1432358_update_overridescsp.patch") [[details]](/attachment.cgi?id=8946410&action=edit "bug_1432358_update_overridescsp.patch") [[diff]](/attachment.cgi?id=8946410&action=diff "bug_1432358_update_overridescsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8946410)
bug\_1432358\_update\_overridescsp.patch
Review of [attachment 8946410](/attachment.cgi?id=8946410 "bug_1432358_update_overridescsp.patch") [[details]](/attachment.cgi?id=8946410&action=edit "bug_1432358_update_overridescsp.patch") [[diff]](/attachment.cgi?id=8946410&action=diff "bug_1432358_update_overridescsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8946410):
-----------------------------------------------------------------
::: caps/BasePrincipal.h
@@ +135,5 @@
>
> /\*\*
> + \* Returns true if this principal's CSP should override a document's
> + \* CSP for loads that it triggers. Currently true for system
> + \* principals and for expanded principals which subsume the document
Nit: s/ and for/,/
Also, should probably be "the system principal" rather than "system principals", since there's only ever one.
[Attachment #8946410](/attachment.cgi?id=8946410&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: review?(kmaglione+bmo) → review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1432358#c43)• 7 years ago |
|  | |

(In reply to :Gijs from [comment #38](/show_bug.cgi?id=1432358#c38 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> I have to admit this patch confuses me. My understanding (though I haven't
> tested to verify that...) is that this patch will break the json viewer on
> any JSON that has strict CSP, unless we hack up the jsonview content
> transformer/handler (that actually includes all the resource: based script
> etc. ) to force a change to the CSP to always allow resource: for content
> viewed in the JSON viewer. But the patch only fixes 1 test file, not the
> jsonview behaviour...
Gijs, I think you are right. I tried to debug that part again and it seems we are loading require.js using a resource:// URI within the JSON converter here [1]. I agree that this patch most likely will only fix the test browser\_jsonview\_csp\_json.js but most likely will cause more problems around the JSON converter in the wild (whenever a page uses a strong CSP). Currently the triggeringPrincipal for loading resource://devtools-client-jsonview/lib/require.js is a NullPrincipal so the previous patch to overrule a pages CSP has no effect on the JSON converter code.
Do you have any suggestions how to update the JSON converter code [1] so it's not subject to a page's CSP?
[1] <https://dxr.mozilla.org/mozilla-central/source/devtools/client/jsonview/converter-child.js#252>Flags: needinfo?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a638533_363267)• 7 years ago |

Whiteboard: [domsecurity-active]

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1432358#c44)• 7 years ago |
|  | |

Talked about this with Christoph out-of-band. We can either do this such that CSPs don't apply to the jsonviewer, or overwrite the CSP with our own thing that only allows our own resources and nothing else. We'll do whatever is expedient given the immediate nature of the issue.Flags: needinfo?(gijskruitbosch+bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1432358#c45)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_allow\_dropping\_csp.patch](attachment.cgi?id=8947044&action=diff) (obsolete)
— [Details](attachment.cgi?id=8947044&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947044)

Olli, within this patch we want to make chrome: and resource: URIs to become subject to CSP. In turn, this change will break the json viewer, because it loads resource: URIs, e.g. here [1] which might get blocked by a document's CSP now. Within our own testsuite this change causes browser\_jsonview\_csp\_json.js to fail.
I thought of a few things to make this work. Ultimately, I think the best approach is to allow dropping the CSP in that specific case. I tried to minimize the risk by making the function a no-op for all principals other than a NullPrincipal.
FWIW, the load uses a NullPrincipal because we explicitly reset to do so here [2].
I know it's a little hacky, but I think it's the best option we have to make this work again. What do you think?
[1] <https://dxr.mozilla.org/mozilla-central/source/devtools/client/jsonview/converter-child.js#252>
[2] <https://dxr.mozilla.org/mozilla-central/source/devtools/client/jsonview/converter-child.js#95>
[Attachment #8945483](/attachment.cgi?id=8945483&action=edit "bug_1432358_update_test_jsonview.patch") -
Attachment is obsolete: true
[Attachment #8947044](/attachment.cgi?id=8947044&action=edit "bug_1432358_allow_dropping_csp.patch") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1432358#c46)• 7 years ago |
|  | |

Honza, could you explain the jsonviewer setup? How does it even end up using csp from the json response?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1432358#c47)• 7 years ago |
|  | |

Comment on [attachment 8947044](/attachment.cgi?id=8947044 "bug_1432358_allow_dropping_csp.patch") [[details]](/attachment.cgi?id=8947044&action=edit "bug_1432358_allow_dropping_csp.patch") [[diff]](/attachment.cgi?id=8947044&action=diff "bug_1432358_allow_dropping_csp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947044)
bug\_1432358\_allow\_dropping\_csp.patch
Can't really review this atm.
It smells like we shouldn't inherit the CSP from the beginning, if we end up wanting to drop it anyhow. So, should something somewhere create a null principal without csp?
But I don't understand jsonviewer setup.
[Attachment #8947044](/attachment.cgi?id=8947044&action=edit "bug_1432358_allow_dropping_csp.patch") -
Flags: review?(bugs)

|  | [Jan Honza Odvarko [:Honza] (always need-info? me)](/user_profile?user_id=303767) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1432358#c48)• 7 years ago |
|  | |

I don't know why it's using the same CSP, but the initial setup happens in onStartRequest (converter-child.js). This method converts plain JSON into an application that is rendered instead (in the same tab/window). The HTML app is generated by initialHTML() method (in the same file)
The method also explicitly sets request.loadInfo.resetPrincipalToInheritToNullPrincipal(); (as mentioned in the previous comment) If we want to create new (and correct) principal it feels like it should be done at this place...
HonzaFlags: needinfo?(odvarko)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1432358#c49)• 7 years ago |
|  | |

Olli, initially I wanted to not even apply (or actually even parse) a CSP in that case. I thought, maybe we can detect the loading of a \*.json file in nsDocument.cpp where we apply the CSP to the document (somewhere around here [1]). The problem is that we can't reliably detect JSON loading. In the specific case of browser\_jsonview\_csp\_json.js for example we are loading the content type "text/html". Solely not applying a CSP based on the file ending is a no go anyway. So that option is out, or am I missing something?
The next thing I tried is to overwrite the principal (that holds the CSP) with yet another freshly created NullPrincipal. But that's not doable. Let me explain: This [2] resetting of the principal to inherit on the loadInfo caused the new document's nodePrincipal to be that NullPrincipal. Resetting the LoadingPrincipal on the loadInfo after the NodePrincipal has been assigned on the document has no effect in terms of querying the CSP within the CSP-code anymore, because the CSP code queries the CSP from the loadingContext (see [3]) and not from the loadInfo.
Since there is no document->SetNodePrincipal() we can not overwrite that principal anymore. The only option we have is, to get a pointer to the principal and drop the CSP, which is what my patch was doing.
I am open to better suggestions, but I can't think of anything else. Again, ideally I would like to not even parse the CSP in case of loading a \*.json, but I think that's not reliably doable.
Are you willing to reconsider my patch for an r+?
[1] <https://dxr.mozilla.org/mozilla-central/source/dom/base/nsDocument.cpp#2915>
[2] <https://dxr.mozilla.org/mozilla-central/source/devtools/client/jsonview/converter-child.js#95>
[3] <https://dxr.mozilla.org/mozilla-central/source/dom/security/nsCSPService.cpp#145>Flags: needinfo?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1432358#c50)• 7 years ago |
|  | |

I'm worried about having a principal around which first has csp and then it suddenly loses it. What guarantees no code between those states try to access csp?
Can we mark loadinfo or channel or something as don't-apply-csp? Do that before we end up setting up csp in nsDocumentFlags: needinfo?(bugs)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1432358#c51)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_channel\_csp\_agnostic.patch](attachment.cgi?id=8947380&action=diff) (obsolete)
— [Details](attachment.cgi?id=8947380&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947380)

(In reply to Olli Pettay [:smaug] from [comment #50](/show_bug.cgi?id=1432358#c50 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Can we mark loadinfo or channel or something as don't-apply-csp? Do that
> before we end up setting up csp in nsDocument
In fact I like that idea a lot - here we go. What do you think?
[Attachment #8947044](/attachment.cgi?id=8947044&action=edit "bug_1432358_allow_dropping_csp.patch") -
Attachment is obsolete: true
[Attachment #8947380](/attachment.cgi?id=8947380&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: review?(bugs)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1432358#c52)• 7 years ago |
|  | |

Comment on [attachment 8947380](/attachment.cgi?id=8947380 "bug_1432358_channel_csp_agnostic.patch") [[details]](/attachment.cgi?id=8947380&action=edit "bug_1432358_channel_csp_agnostic.patch") [[diff]](/attachment.cgi?id=8947380&action=diff "bug_1432358_channel_csp_agnostic.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947380)
bug\_1432358\_channel\_csp\_agnostic.patch
> NS\_IMETHODIMP
>+LoadInfo::SetAllowDocumentToBeAgnosticToCSP(bool aAllowDocumentToBeAgnosticToCSP)
>+{
>+ if (mInternalContentPolicyType != nsIContentPolicy::TYPE\_DOCUMENT) {
>+ MOZ\_ASSERT(false, "not available for on loads other than TYPE\_DOCUMENT");
I think "not available for loads other than..."
Yeah, I think this approach is rather clear.
[Attachment #8947380](/attachment.cgi?id=8947380&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: review?(bugs) → review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1432358#c53)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_update\_overridescsp.patch](attachment.cgi?id=8947427&action=diff)
— [Details](attachment.cgi?id=8947427&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947427)

Incorporated nits; carrying over r+ from kmag.
[Attachment #8946410](/attachment.cgi?id=8946410&action=edit "bug_1432358_update_overridescsp.patch") -
Attachment is obsolete: true

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1432358#c54)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_channel\_csp\_agnostic.patch](attachment.cgi?id=8947428&action=diff)
— [Details](attachment.cgi?id=8947428&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947428)

Incorporated nits; carrying over r+ from smaug.
[Attachment #8947380](/attachment.cgi?id=8947380&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Attachment is obsolete: true

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a816038_363267)• 7 years ago |

[Attachment #8947427](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a816044_363267)• 7 years ago |

[Attachment #8947428](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1432358#c55)• 7 years ago |
|  | |

Comment on [attachment 8945420](/attachment.cgi?id=8945420 "bug_1432358_apply_csp_to_resource.patch") [[details]](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") [[diff]](/attachment.cgi?id=8945420&action=diff "bug_1432358_apply_csp_to_resource.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420)
bug\_1432358\_apply\_csp\_to\_resource.patch
[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Not that easily, because an attacker would have to know that Firefox's file require.js looks for a script tag of 'data-main' which makes the Universal CSP bypass possible at all. See the following example:
<script data-main='data:,alert(1)'></script>
<script src="resource://devtools-client-jsonview/lib/require.js"></script>
The automatic testcase here registers it's own resource file so we don't pinpount to the weakness for require.js explicitly.
Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
No. The patch including comments does not reveal the actual problem. See explanation above.
Which older supported branches are affected by this flaw?
I don't know offhand, most likely all supported branches are affected. Resource URIs have never been subject to CSP since the introduction of our CSP code. I guess the question is, when did require.js land, but I imagine that file has also been around for a very long time.
If not all supported branches, which bug introduced the flaw?
see above.
Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
I don't have backports. I would imagine that the attached patches apply more or less cleanly to other affected branches.
How likely is this patch to cause regressions; how much testing does it need?
Not very likely, because less than %5 of webpages ship a CSP. Out of those only a very small percentage load resource:// URIs.
[Attachment #8945420](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") -
Flags: sec-approval?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1432358#c56)• 7 years ago |
|  | |

Comment on [attachment 8945421](/attachment.cgi?id=8945421 "bug_1432358_test_subjecttocsp.patch") [[details]](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") [[diff]](/attachment.cgi?id=8945421&action=diff "bug_1432358_test_subjecttocsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945421)
bug\_1432358\_test\_subjecttocsp.patch
[Security approval request comment]
See [comment 55](/show_bug.cgi?id=1432358#c55 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource").
[Attachment #8945421](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: sec-approval?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1432358#c57)• 7 years ago |
|  | |

Comment on [attachment 8947427](/attachment.cgi?id=8947427 "bug_1432358_update_overridescsp.patch") [[details]](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") [[diff]](/attachment.cgi?id=8947427&action=diff "bug_1432358_update_overridescsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947427)
bug\_1432358\_update\_overridescsp.patch
[Security approval request comment]
See [comment 55](/show_bug.cgi?id=1432358#c55 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource").
[Attachment #8947427](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: sec-approval?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1432358#c58)• 7 years ago |
|  | |

Comment on [attachment 8947428](/attachment.cgi?id=8947428 "bug_1432358_channel_csp_agnostic.patch") [[details]](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") [[diff]](/attachment.cgi?id=8947428&action=diff "bug_1432358_channel_csp_agnostic.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947428)
bug\_1432358\_channel\_csp\_agnostic.patch
[Security approval request comment]
See [comment 55](/show_bug.cgi?id=1432358#c55 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource").
[Attachment #8947428](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1432358#c59)• 7 years ago |
|  | |

Tests aren't going to get sec-approval on a sec-high rated issue until after we ship it in a release. I'll clear the sec-approval on that. You should set in-testsuite? to remember to check the tests in four weeks after we ship a release with the fix.
I'll give sec-approval+ on the patches for trunk.
You should nominate Beta and ESR52 patches for this as well.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a950109_280903)• 7 years ago |

[Attachment #8945420](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a950123_280903)• 7 years ago |

[Attachment #8945421](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: sec-approval?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a950137_280903)• 7 years ago |

[Attachment #8947427](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: sec-approval? → sec-approval+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a950172_280903)• 7 years ago |

[Attachment #8947428](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: sec-approval? → sec-approval+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a1270558_75935)• 7 years ago |

[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix)
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected)
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)
[tracking-firefox59](/buglist.cgi?f1=cf_tracking_firefox59&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B)
[tracking-firefox60](/buglist.cgi?f1=cf_tracking_firefox60&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [59+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=59%2B)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a1434536_363267)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1432358#c60)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/60852dec9e041887bea80313a70ad2a4cba745a6>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/6840396ed6ec8cdc9e77e253c1c61258a24fb987>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/27527f95cccca4927d4fee56b0dab9af11c5733f>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1432358#c61)• 7 years ago |
|  | |

Backed out for failing xpcshell's test\_ext\_contentscript\_triggeringPrincipal.js on Windows debug:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a824791e0d28623e928f9b5314cb6d948b2218ef>
Push with failures: <https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&revision=35b81e0007ab42a5c0e7ec037ee2295d6708607e&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry&filter-resultStatus=usercancel&filter-resultStatus=runnable>
Failure log: <https://treeherder.mozilla.org/logviewer.html#?job_id=161405747&repo=mozilla-inbound>
20:55:02 INFO - TEST-START | xpcshell-e10s.ini:toolkit/components/extensions/test/xpcshell/test\_ext\_contentscript\_triggeringPrincipal.js
21:00:02 WARNING - TEST-UNEXPECTED-TIMEOUT | xpcshell-e10s.ini:toolkit/components/extensions/test/xpcshell/test\_ext\_contentscript\_triggeringPrincipal.js | Test timed outFlags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1432358#c62)• 7 years ago |
|  | |

(In reply to Sebastian Hengst [:aryx][:archaeopteryx] (needinfo on intermittent or backout) from [comment #61](/show_bug.cgi?id=1432358#c61 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Backed out for failing xpcshell's
> test\_ext\_contentscript\_triggeringPrincipal.js on Windows debug:
Kris, even though the test runs quite long it works locally. I guess the problem is that we just exceed the allowed timeout of that xpcshell test. Can we somehow request a longer timeout? I know we have requestLongerTimeout() on mochitests, not sure if we have an equivalent for xcpshell tests. What do you think?Flags: needinfo?(ckerschb) → needinfo?(kmaglione+bmo)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1432358#c63)• 7 years ago |
|  | |

Use requesttimeoutfactor = number in the xpcshell.ini.
Code: <https://dxr.mozilla.org/mozilla-central/rev/2b7d42d527af582a465e49187fe387442d524a7c/testing/xpcshell/runxpcshelltests.py#667>
Example: <https://dxr.mozilla.org/mozilla-central/rev/2b7d42d527af582a465e49187fe387442d524a7c/netwerk/test/unit/xpcshell.ini#88-89>Flags: needinfo?(kmaglione+bmo)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1432358#c64)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_fix\_xpcshell\_test.patch](attachment.cgi?id=8950155&action=diff) (obsolete)
— [Details](attachment.cgi?id=8950155&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8950155)

Aryx, are you comfortable accepting this? If so, could you please also reland those patches for me by any chance?
[Attachment #8950155](/attachment.cgi?id=8950155&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: review?(aryx.bugmail)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a1756941_258347)• 7 years ago |

[Attachment #8950155](/attachment.cgi?id=8950155&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: review?(aryx.bugmail) → review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a1766506_363267)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1432358#c65)• 7 years ago |
|  | |

Comment on [attachment 8950155](/attachment.cgi?id=8950155 "bug_1432358_fix_xpcshell_test.patch") [[details]](/attachment.cgi?id=8950155&action=edit "bug_1432358_fix_xpcshell_test.patch") [[diff]](/attachment.cgi?id=8950155&action=diff "bug_1432358_fix_xpcshell_test.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8950155)
bug\_1432358\_fix\_xpcshell\_test.patch
Setting sec-approval for this part as well since it's only a test timeout update.
[Attachment #8950155](/attachment.cgi?id=8950155&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: sec-approval+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1432358#c66)• 7 years ago |
|  | |

Pushed this before lunch:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/91c948c94506089d6f40dc59d13c75ab78ce914d>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a67e95bd0ccf13faa26aaa6b56fd1d826a7608ec>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/2fa11c525da3d0c7ca58a593241c1902f2849528>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/ef7b8eef07c1181cec03246e40807d6051f971c9>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a1767295_258347)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1432358#c67)• 7 years ago |
|  | |

Backed out for failing xpcshell's test\_ext\_contentscript\_triggeringPrincipal.js on Windows debug:
<https://hg.mozilla.org/integration/mozilla-inbound/rev/5d726f46260f0d96dba2ec23d5b01375f588c6e1>
First push which ran failing jobs: <https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&revision=50145ed826265cd5e228fb7d973b871359ca2213&filter-resultStatus=testfailed&filter-resultStatus=busted&filter-resultStatus=exception&filter-resultStatus=retry>
Failure log: <https://treeherder.mozilla.org/logviewer.html#?job_id=161700807&repo=mozilla-inbound>
16:20:22 INFO - "Got CSP report for forbidden URL <http://localhost:51627/audio-source.webm?origin=page&source=pageScript-relative-url>"
16:20:22 INFO - "Got CSP report for forbidden URL <http://localhost:51627/video.webm?origin=page&source=pageScript-relative-url>"
16:20:22 INFO - "Got CSP report for forbidden URL <http://localhost:51627/video-source.webm?origin=page&source=pageScript-relative-url>"
16:20:22 INFO - <<<<<<<
16:20:22 INFO - mozcrash kill\_pid(): wait failed (-1) terminating pid 11692: error 5
16:20:22 INFO - xpcshell return code: None
16:20:22 INFO - xpcshell-e10s.ini:toolkit/components/extensions/test/xpcshell/test\_ext\_contentscript\_triggeringPrincipal.js | Process still running after test!
16:20:22 INFO - TEST-START | xpcshell-remote.ini:toolkit/components/extensions/test/xpcshell/test\_ext\_contentscript\_triggeringPrincipal.js
16:30:22 WARNING - TEST-UNEXPECTED-TIMEOUT | xpcshell-remote.ini:toolkit/components/extensions/test/xpcshell/test\_ext\_contentscript\_triggeringPrincipal.js | Test timed out
16:30:22 INFO - TEST-INFO took 600000ms
16:30:22 INFO - >>>>>>>Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1432358#c68)• 7 years ago |
|  | |

(In reply to Sebastian Hengst [:aryx][:archaeopteryx] (needinfo on intermittent or backout) from [comment #67](/show_bug.cgi?id=1432358#c67 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Backed out for failing xpcshell's
> test\_ext\_contentscript\_triggeringPrincipal.js on Windows debug:
No idea why. Kris, any idea what might be wrong? Would you be strictly against disabling the test on windows debug or is that an option?Flags: needinfo?(ckerschb) → needinfo?(kmaglione+bmo)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2102749_363267)• 7 years ago |

Depends on: [1438796](/show_bug.cgi?id=1438796 "NEW - Re-Enable test_ext_contentscript_triggeringPrincipal.js on Windows Debug")

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1432358#c69)• 7 years ago |
|  | |

Attached patch

[bug\_1432358\_fix\_xpcshell\_test.patch](attachment.cgi?id=8951547&action=diff)
— [Details](attachment.cgi?id=8951547&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8951547)

As discussed, going ahead and disabling the test to get this sec-high bug landed. I filed [Bug 1438796](/show_bug.cgi?id=1438796 "NEW - Re-Enable test_ext_contentscript_triggeringPrincipal.js on Windows Debug") to figure out the problem and re-enable the test.
[Attachment #8950155](/attachment.cgi?id=8950155&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Attachment is obsolete: trueFlags: needinfo?(kmaglione+bmo)
[Attachment #8951547](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: review?(aryx.bugmail)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2116040_258347)• 7 years ago |

[Attachment #8951547](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: review?(aryx.bugmail) → review+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1432358#c70)• 7 years ago |
|  | |

Comment on [attachment 8951547](/attachment.cgi?id=8951547 "bug_1432358_fix_xpcshell_test.patch") [[details]](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") [[diff]](/attachment.cgi?id=8951547&action=diff "bug_1432358_fix_xpcshell_test.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8951547)
bug\_1432358\_fix\_xpcshell\_test.patch
Setting sec-approval on this one as well since it's only a tmp disable of a windows debug test.
[Attachment #8951547](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: sec-approval+

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2279479_363267)• 7 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1432358#c71)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/fc871960d805efc5b3c4ac9e0682312d7bb23bda>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/a8b53e720ac7c35192eada9bf7c174df78105504>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/93dcf59ff87e075acefb7fd7634c270519a857f8>
<https://hg.mozilla.org/integration/mozilla-inbound/rev/9f37220bc5360c91a80278119a1ce2a4940d9aec>Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1432358#c72)• 7 years ago |
|  | |

Test annotation fix: <https://hg.mozilla.org/integration/mozilla-inbound/rev/d4aa33646f8bb62025644f240b71af17a854fcca>

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1432358#c73)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/fc871960d805>
<https://hg.mozilla.org/mozilla-central/rev/a8b53e720ac7>
<https://hg.mozilla.org/mozilla-central/rev/93dcf59ff87e>
<https://hg.mozilla.org/mozilla-central/rev/9f37220bc536>
<https://hg.mozilla.org/mozilla-central/rev/d4aa33646f8b>Status: ASSIGNED → RESOLVEDClosed: 7 years ago
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla60

|  | [Gingerbread Man](/user_profile?user_id=353206) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2452677_353206)• 7 years ago |

Depends on: [1439444](/show_bug.cgi?id=1439444 "VERIFIED FIXED - Firefox nightly shows XML content as plain text")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2495366_1689)• 7 years ago |

Group: dom-core-security → core-security-release

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1432358#c74)• 7 years ago |
|  | |

Comment on [attachment 8945420](/attachment.cgi?id=8945420 "bug_1432358_apply_csp_to_resource.patch") [[details]](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") [[diff]](/attachment.cgi?id=8945420&action=diff "bug_1432358_apply_csp_to_resource.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420)
bug\_1432358\_apply\_csp\_to\_resource.patch
Approval Request Comment
[Feature/Bug causing the regression]:
That problem has been around for a long time. If I would have to pick a bug (even though it's not the root cause of the problem, but allowed us to reveal the problem) then I would choose [Bug 1299483](/show_bug.cgi?id=1299483 "RESOLVED FIXED - CSP: Implement 'strict-dynamic'") - CSP: Implement 'strict-dynamic'.
[User impact if declined]:
Universal CSP bypass using browser internals.
[Is this code covered by automated tests?]:
Yes, automatet test is attached to this bug.
[Has the fix been verified in Nightly?]:
No, not yet.
[Needs manual test from QE? If yes, steps to reproduce]:
No, has automated test which is sufficient.
[List of other uplifts needed for the feature/fix]:
none
[Is the change risky?]:
There is low risk involved in a sense that a page having CSP might block a content exposed chrome: URL which gets loaded by a webpage.
[Why is the change risky/not risky?]:
see previous comment
[String changes made/needed]:
no
[Attachment #8945420](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1432358#c75)• 7 years ago |
|  | |

Comment on [attachment 8945421](/attachment.cgi?id=8945421 "bug_1432358_test_subjecttocsp.patch") [[details]](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") [[diff]](/attachment.cgi?id=8945421&action=diff "bug_1432358_test_subjecttocsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945421)
bug\_1432358\_test\_subjecttocsp.patch
Approval Request Comment
See [Comment 74](/show_bug.cgi?id=1432358#c74 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource")
[Attachment #8945421](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1432358#c76)• 7 years ago |
|  | |

Comment on [attachment 8947427](/attachment.cgi?id=8947427 "bug_1432358_update_overridescsp.patch") [[details]](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") [[diff]](/attachment.cgi?id=8947427&action=diff "bug_1432358_update_overridescsp.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947427)
bug\_1432358\_update\_overridescsp.patch
Approval Request Comment
See [Comment 74](/show_bug.cgi?id=1432358#c74 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource")
[Attachment #8947427](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1432358#c77)• 7 years ago |
|  | |

Comment on [attachment 8947428](/attachment.cgi?id=8947428 "bug_1432358_channel_csp_agnostic.patch") [[details]](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") [[diff]](/attachment.cgi?id=8947428&action=diff "bug_1432358_channel_csp_agnostic.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8947428)
bug\_1432358\_channel\_csp\_agnostic.patch
Approval Request Comment
See [Comment 74](/show_bug.cgi?id=1432358#c74 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource")
[Attachment #8947428](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1432358#c78)• 7 years ago |
|  | |

Comment on [attachment 8951547](/attachment.cgi?id=8951547 "bug_1432358_fix_xpcshell_test.patch") [[details]](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") [[diff]](/attachment.cgi?id=8951547&action=diff "bug_1432358_fix_xpcshell_test.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8951547)
bug\_1432358\_fix\_xpcshell\_test.patch
Approval Request Comment
See [Comment 74](/show_bug.cgi?id=1432358#c74 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource")
[Attachment #8951547](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2563767_363267)• 7 years ago |

Depends on: [1439964](/show_bug.cgi?id=1439964 "RESOLVED DUPLICATE - The image is wrongly displayed if the \"View Image\" option is used")

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1432358#c79)• 7 years ago |
|  | |

Comment on [attachment 8945420](/attachment.cgi?id=8945420 "bug_1432358_apply_csp_to_resource.patch") [[details]](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") [[diff]](/attachment.cgi?id=8945420&action=diff "bug_1432358_apply_csp_to_resource.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420)
bug\_1432358\_apply\_csp\_to\_resource.patch
Just discussed things we Gijs again and it seems it's probably not worth uplifting that change, given the possibility that this might break some pages.
[Attachment #8945420](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2564287_363267)• 7 years ago |

[Attachment #8945421](/attachment.cgi?id=8945421&action=edit "bug_1432358_test_subjecttocsp.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2564301_363267)• 7 years ago |

[Attachment #8947427](/attachment.cgi?id=8947427&action=edit "bug_1432358_update_overridescsp.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2564317_363267)• 7 years ago |

[Attachment #8947428](/attachment.cgi?id=8947428&action=edit "bug_1432358_channel_csp_agnostic.patch") -
Flags: approval-mozilla-beta?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2564330_363267)• 7 years ago |

[Attachment #8951547](/attachment.cgi?id=8951547&action=edit "bug_1432358_fix_xpcshell_test.patch") -
Flags: approval-mozilla-beta?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1432358#c80)• 7 years ago |
|  | |

Updating status flags per the recent discussion in the bug and with Dan on IRC. That said, it isn't clear to me if ESR52 is wontfix at this point or if we'd still want to try to ship a fix in 52.8 after this has had more opportunity for testing.
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[59+](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=59%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)Flags: in-testsuite+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=1432358#c81)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #79](/show_bug.cgi?id=1432358#c79 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Comment on [attachment 8945420](/attachment.cgi?id=8945420 "bug_1432358_apply_csp_to_resource.patch") [[details]](/attachment.cgi?id=8945420&action=edit "bug_1432358_apply_csp_to_resource.patch") [[diff]](/attachment.cgi?id=8945420&action=diff "bug_1432358_apply_csp_to_resource.patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1432358&attachment=8945420)
When we've got 6 exceptions in that code to using the protocol flag we're clearly doing something wrong. Clearly the URI\_IS\_LOCAL\_RESOURCE flag isn't as good a fit as we first thought. Maybe we need to add a special purpose URI\_SOMETHING\_CSP\_SOMETHING flag and add that to the few places left.
The specific PoC in this bug uses a copy of require.js that was not web-exposed in Firefox 52. Maybe we don't need to backport to ESR.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=1432358#c82)• 7 years ago |
|  | |

Christoph, what are your thoughts RE: the last 2 comments?Flags: needinfo?(ckerschb)

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=1432358#c83)• 7 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #82](/show_bug.cgi?id=1432358#c82 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> Christoph, what are your thoughts RE: the last 2 comments?
I agree to both of the above 2 comments. First, I don't think we should backport this to ESR. Second, probably there is a better solution than relying on URI\_IS\_LOCAL\_RESOURCE and we should revisit that decision eventually. For now, it seems like the right fix for this bug.Flags: needinfo?(ckerschb)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a2731316_75935)• 7 years ago |

[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=-)

|  | [Wayne Mery (:wsmwk)](/user_profile?user_id=29811) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a3939019_29811)• 7 years ago |

Depends on: [1443110](/show_bug.cgi?id=1443110 "RESOLVED FIXED - Crash in nsDocument::InitCSP via nsHTMLDocument::StartDocumentLoad")

|  | [Paul Theriault [:pauljt] (no longer reading bugmail)](/user_profile?user_id=434339) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a5418144_434339)• 7 years ago |

Flags: sec-bounty?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=1432358#c84)• 7 years ago |
|  | |

CSP bypass bugs should be capped to sec-moderate because (at this point, at least) it's a little-used mitigation that sites can opt in to. Even with the bypass the victim site must have a serious security bug itself.Flags: sec-bounty? → sec-bounty+Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---) → [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=1432358#c85)• 7 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #84](/show_bug.cgi?id=1432358#c84 "VERIFIED FIXED - Universal CSP strict-dynamic bypass via require.js of browser resource"))
> CSP bypass bugs should be capped to sec-moderate because (at this point, at
> least) it's a little-used mitigation that sites can opt in to. Even with the
> bypass the victim site must have a serious security bug itself.
I'm not arguing against the rating, but there are scenarios around CSP sandbox, that don't involve the web page being vulnerable.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a8195838_280903)• 7 years ago |

Whiteboard: [domsecurity-active] → [domsecurity-active][adv-main60+]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a8467345_280903)• 7 years ago |

Alias: CVE-2018-5175

|  | [Emil Ghitta, QA [:emilghitta]](/user_profile?user_id=588744) |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=1432358#c86)• 7 years ago |
|  | |

I have managed to reproduce this issue using Firefox 60.0a1(BuildId:20180122220231).
This issue is verified fixed using Firefox 61.0a1(BuildId:20180503100146) and Firefox 60.0(BuildId:20180430165945) on Windows 10 64bit, macOS 10.13.3 and Ubuntu 16.04 64bit.Status: RESOLVED → VERIFIED
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=verified)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [verified](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=verified)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a24782178_1689)• 6 years ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1432358#a200412865_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1432358&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Masato Kinugawa](/user_profile?user_id=393170)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_879d4593_20250125_155647.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2018-11

## Security vulnerabilities fixed in Firefox 60

Announced
May 9, 2018
Impact
critical
Products
Firefox
Fixed in

* Firefox 60

#### [#CVE-2018-5154: Use-after-free with SVG animations and clip paths](#CVE-2018-5154)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while enumerating attributes during SVG animations with clip paths. This results in a potentially exploitable crash.

##### References

* [Bug 1443092](https://bugzilla.mozilla.org/show_bug.cgi?id=1443092)

#### [#CVE-2018-5155: Use-after-free with SVG animations and text paths](#CVE-2018-5155)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur while adjusting layout during SVG animations with text paths. This results in a potentially exploitable crash.

##### References

* [Bug 1448774](https://bugzilla.mozilla.org/show_bug.cgi?id=1448774)

#### [#CVE-2018-5157: Same-origin bypass of PDF Viewer to view protected PDF files](#CVE-2018-5157)

Reporter
Wladimir Palant
Impact
high
##### Description

Same-origin protections for the PDF viewer can be bypassed, allowing a malicious site to intercept messages meant for the viewer. This could allow the site to retrieve PDF files restricted to viewing by an authenticated user on a third-party website.

##### References

* [Bug 1449898](https://bugzilla.mozilla.org/show_bug.cgi?id=1449898)

#### [#CVE-2018-5158: Malicious PDF can inject JavaScript into PDF Viewer](#CVE-2018-5158)

Reporter
Wladimir Palant
Impact
high
##### Description

The PDF viewer does not sufficiently sanitize PostScript calculator functions, allowing malicious JavaScript to be injected through a crafted PDF file. This JavaScript can then be run with the permissions of the PDF viewer by its worker.

##### References

* [Bug 1452075](https://bugzilla.mozilla.org/show_bug.cgi?id=1452075)

#### [#CVE-2018-5159: Integer overflow and out-of-bounds write in Skia](#CVE-2018-5159)

Reporter
Ivan Fratric
Impact
high
##### Description

An integer overflow can occur in the Skia library due to 32-bit integer use in an array without integer overflow checks, resulting in possible out-of-bounds writes. This could lead to a potentially exploitable crash triggerable by web content.

##### References

* [Bug 1441941](https://bugzilla.mozilla.org/show_bug.cgi?id=1441941)

#### [#CVE-2018-5160: Uninitialized memory use by WebRTC encoder](#CVE-2018-5160)

Reporter
Andreas Perhson
Impact
high
##### Description

WebRTC can use a `WrappedI420Buffer` pixel buffer but the owning image object can be freed while it is still in use. This can result in the WebRTC encoder using uninitialized memory, leading to a potentially exploitable crash.

##### References

* [Bug 1436117](https://bugzilla.mozilla.org/show_bug.cgi?id=1436117)

#### [#CVE-2018-5152: WebExtensions information leak through webRequest API](#CVE-2018-5152)

Reporter
Andy McKay
Impact
moderate
##### Description

WebExtensions with the appropriate permissions can attach content scripts to Mozilla sites such as accounts.firefox.com and listen to network traffic to the site through the `webRequest` API. For example, this allows for the interception of username and an encrypted password during login to Firefox Accounts. This issue does not expose synchronization traffic directly and is limited to the process of user login to the website and the data displayed to the user once logged in.

##### References

* [Bug 1415644](https://bugzilla.mozilla.org/show_bug.cgi?id=1415644)
* [Bug 1427289](https://bugzilla.mozilla.org/show_bug.cgi?id=1427289)

#### [#CVE-2018-5153: Out-of-bounds read in mixed content websocket messages](#CVE-2018-5153)

Reporter
Dennis Fuchs
Impact
moderate
##### Description

If websocket data is sent with mixed text and binary in a single message, the binary data can be corrupted. This can result in an out-of-bounds read with the read memory sent to the originating server in response.

##### References

* [Bug 1436809](https://bugzilla.mozilla.org/show_bug.cgi?id=1436809)

#### [#CVE-2018-5163: Replacing cached data in JavaScript Start-up Bytecode Cache](#CVE-2018-5163)

Reporter
Nicolas B. Pierron
Impact
moderate
##### Description

If a malicious attacker has used another vulnerability to gain full control over a content process, they may be able to replace the alternate data resources stored in the JavaScript Start-up Bytecode Cache (JSBC) for other JavaScript code. If the parent process then runs this replaced code, the executed script would be run with the parent process' privileges, escaping the sandbox on content processes.

##### References

* [Bug 1426353](https://bugzilla.mozilla.org/show_bug.cgi?id=1426353)

#### [#CVE-2018-5164: CSP not applied to all multipart content sent with multipart/x-mixed-replace](#CVE-2018-5164)

Reporter
Khalil Zhani
Impact
moderate
##### Description

Content Security Policy (CSP) is not applied correctly to all parts of multipart content sent with the `multipart/x-mixed-replace` MIME type. This could allow for script to run where CSP should block it, allowing for cross-site scripting (XSS) and other attacks.

##### References

* [Bug 1416045](https://bugzilla.mozilla.org/show_bug.cgi?id=1416045)

#### [#CVE-2018-5166: WebExtension host permission bypass through filterReponseData](#CVE-2018-5166)

Reporter
Francois Lajeunesse Robert
Impact
moderate
##### Description

WebExtensions can use request redirection and a `filterReponseData` filter to bypass host permission settings to redirect network traffic and access content from a host for which they do not have explicit user permission.

##### References

* [Bug 1437325](https://bugzilla.mozilla.org/show_bug.cgi?id=1437325)

#### [#CVE-2018-5167: Improper linkification of chrome: and javascript: content in web console and JavaScript debugger](#CVE-2018-5167)

Reporter
Wladimir Palant
Impact
moderate
##### Description

The web console and JavaScript debugger do not sanitize all output that can be hyperlinked. Both will display `chrome:` links as active, clickable hyperlinks in their output. Web sites should not be able to directly link to internal chrome pages. Additionally, the JavaScript debugger will display `javascript:` links, which users could be tricked into clicking by malicious sites.

##### References

* [Bug 1447969](https://bugzilla.mozilla.org/show_bug.cgi?id=1447969)

#### [#CVE-2018-5168: Lightweight themes can be installed without user interaction](#CVE-2018-5168)

Reporter
Wladimir Palant
Impact
moderate
##### Description

Sites can bypass security checks on permissions to install lightweight themes by manipulating the `baseURI` property of the theme element. This could allow a malicious site to install a theme without user interaction which could contain offensive or embarrassing images.

##### References

* [Bug 1449548](https://bugzilla.mozilla.org/show_bug.cgi?id=1449548)

#### [#CVE-2018-5169: Dragging and dropping link text onto home button can set home page to include chrome pages](#CVE-2018-5169)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

If manipulated hyperlinked text with `chrome:` URL contained in it is dragged and dropped on the "home" icon, the home page can be reset to include a normally-unlinkable chrome page as one of the home page tabs.

##### References

* [Bug 1319157](https://bugzilla.mozilla.org/show_bug.cgi?id=1319157)

#### [#CVE-2018-5172: Pasted script from clipboard can run in the Live Bookmarks page or PDF viewer](#CVE-2018-5172)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

The Live Bookmarks page and the PDF viewer can run injected script content if a user pastes script from the clipboard into them while viewing RSS feeds or PDF files. This could allow a malicious site to socially engineer a user to copy and paste malicious script content that could then run with the context of either page but does not allow for privilege escalation.

##### References

* [Bug 1436482](https://bugzilla.mozilla.org/show_bug.cgi?id=1436482)

#### [#CVE-2018-5173: File name spoofing of Downloads panel with Unicode characters](#CVE-2018-5173)

Reporter
Abdulrahman Alqabandi
Impact
moderate
##### Description

The filename appearing in the `Downloads` panel improperly renders some Unicode characters, allowing for the file name to be spoofed. This can be used to obscure the file extension of potentially executable files from user view in the panel.
*Note: the dialog to open the file will show the full, correct filename and whether it is executable or not.*

##### References

* [Bug 1438025](https://bugzilla.mozilla.org/show_bug.cgi?id=1438025)

#### [#CVE-2018-5174: Windows Defender SmartScreen UI runs with less secure behavior for downloaded files in Windows 10 April 2018 Update](#CVE-2018-5174)

Reporter
Jimmy
Impact
moderate
##### Description

In the Windows 10 April 2018 Update, Windows Defender SmartScreen honors the `SEE_MASK_FLAG_NO_UI` flag associated with downloaded files and will not show any UI. Files that are unknown and potentially dangerous will be allowed to run because SmartScreen will not prompt the user for a decision, and if the user is offline all files will be allowed to be opened because Windows won’t prompt the user to ask what to do. Firefox incorrectly sets this flag when downloading files, leading to less secure behavior from SmartScreen.
*Note: this issue only affects Windows 10 users running the April 2018 update or later. It does not affect other Windows users or other operating systems.*

##### References

* [Bug 1447080](https://bugzilla.mozilla.org/show_bug.cgi?id=1447080)

#### [#CVE-2018-5175: Universal CSP bypass on sites using strict-dynamic in their policies](#CVE-2018-5175)

Reporter
Masato Kinugawa
Impact
moderate
##### Description

A mechanism to bypass Content Security Policy (CSP) protections on sites that have a `script-src` policy of `'strict-dynamic'`. If a target website contains an HTML injection flaw an attacker could inject a reference to a copy of the `require.js` library that is part of Firefox’s Developer Tools, and then use a known technique using that library to bypass the CSP restrictions on executing injected scripts.

##### References

* [Bug 1432358](https://bugzilla.mozilla.org/show_bug.cgi?id=1432358)

#### [#CVE-2018-5176: JSON Viewer script injection](#CVE-2018-5176)

Reporter
Tadj Youssouf
Impact
moderate
##### Description

The JSON Viewer displays clickable hyperlinks for strings that are parseable as URLs, including `javascript:` links. If a JSON file contains malicious JavaScript script embedded as `javascript:` links, users may be tricked into clicking and running this code in the context of the JSON Viewer. This can allow for the theft of cookies and authorization tokens which are accessible to that context.

##### References

* [Bug 1442840](https://bugzilla.mozilla.org/show_bug.cgi?id=1442840)

#### [#CVE-2018-5177: Buffer overflow in XSLT during number formatting](#CVE-2018-5177)

Reporter
Guyio
Impact
moderate
##### Description

A vulnerability exists in XSLT during number formatting where a negative buffer size may be allocated in some instances, leading to a buffer overflow and crash if it occurs.

##### References

* [Bug 1451908](https://bugzilla.mozilla.org/show_bug.cgi?id=1451908)

#### [#CVE-2018-5165: Checkbox for enabling Flash protected mode is inverted in 32-bit Firefox](#CVE-2018-5165)

Reporter
David Parks
Impact
low
##### Description

In 32-bit versions of Firefox, the Adobe Flash plugin setting for "Enable Adobe Flash protected mode" is unchecked by default even though the Adobe Flash sandbox is actually enabled. The displayed state is the reverse of the true setting, resulting in user confusion. This could cause users to select this setting intending to activate it and inadvertently turn protections off.

##### References

* [Bug 1451452](https://bugzilla.mozilla.org/show_bug.cgi?id=1451452)

#### [#CVE-2018-5180: heap-use-after-free in mozilla::WebGLContext::DrawElementsInstanced](#CVE-2018-5180)

Reporter
Nils
Impact
low
##### Description

A use-after-free vulnerability can occur during WebGL operations. While this results in a potentially exploitable crash, the vulnerability is limited because the memory is freed and reused in a brief window of time during the freeing of the same callstack.

##### References

* [Bug 1444086](https://bugzilla.mozilla.org/show_bug.cgi?id=1444086)

#### [#CVE-2018-5181: Local file can be displayed in noopener tab through drag and drop of hyperlink](#CVE-2018-5181)

Reporter
Abdulrahman Alqabandi
Impact
low
##### Description

If a URL using the `file:` protocol is dragged and dropped onto an open tab that is running in a different child process the tab will open a local file corresponding to the dropped URL, contrary to policy. One way to make the target tab open more reliably in a separate process is to open it with the `noopener` keyword.

##### References

* [Bug 1424107](https://bugzilla.mozilla.org/show_bug.cgi?id=1424107)

#### [#CVE-2018-5182: Local file can be displayed from hyperlink dragged and dropped on addressbar](#CVE-2018-5182)

Reporter
Jordi Chancel
Impact
low
##### Description

If a text string that happens to be a filename in the operating system's native format is dragged and dropped onto the addressbar the specified local file will be opened. This is contrary to policy and is what would happen if the string were the equivalent `file:` URL.

##### References

* [Bug 1435908](https://bugzilla.mozilla.org/show_bug.cgi?id=1435908)

#### [#CVE-2018-5179: Service workers can self update to keep a worker running](#CVE-2018-5179)

Reporter
Yannic Bonenberger
Impact
low
##### Description

A service worker can send the "activate" event on itself periodically which allows it to run perpetually. This would allow any malicious activity, such as logging an IP address by the service worker, to occur in the background.

##### References

* [Bug 1432846](https://bugzilla.mozilla.org/show_bug.cgi?id=1432846)

#### [#CVE-2018-5151: Memory safety bugs fixed in Firefox 60](#CVE-2018-5151)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christoph Diehl, Christian Holler, Jon Coppeard, Jason Kratzer, Nathan Froyd, Paul Theriault, Ryan VanderMeulen, Tyson Smith, Sebastian Hengst, Byron Campen, Emilio Cobos Álvarez, Ronald Crane, and Phillipp reported memory safety bugs present in Firefox 59. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 60](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1445234%2C1449530%2C1437455%2C1447989%2C1438827%2C1436983%2C1435036%2C1440465%2C1439723%2C1448771%2C1453653%2C1454359%2C1432323%2C1454126%2C1436759%2C1439655%2C1448612%2C1449358%2C1367727%2C1452417)

#### [#CVE-2018-5150: Memory safety bugs fixed in Firefox 60 and Firefox ESR 52.8](#CVE-2018-5150)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Christoph Diehl, Randell Jesup, Tyson Smith, Alex Gaynor, Ronald Crane, Julian Hector, Kannan Vijayan, and Jason Kratzer reported memory safety bugs present in Firefox 59 and Firefox ESR 52.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 60 and Firefox ESR 52.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1388020%2C1433609%2C1409440%2C1448705%2C1451376%2C1452202%2C1444668%2C1393367%2C1411415%2C1426129)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from usn.ubuntu.com_914abf6f_20250125_155646.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3645-1: Firefox vulnerabilities

11 May 2018

Firefox could be made to crash or run programs as your login if it
opened a malicious website.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 17.10](/security/notices?release=artful)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)
* [Ubuntu 14.04 ESM](/security/notices?release=trusty)

## Packages

* [firefox](/security/cves?package=firefox) - Mozilla Open Source web browser

## Details

Multiple security issues were discovered in Firefox. If a user were

tricked in to opening a specially crafted website, an attacker could

potentially exploit these to cause a denial of service via application

crash, bypass same-origin restrictions, conduct cross-site scripting (XSS)

attacks, install lightweight themes without user interaction, spoof the

filename in the downloads panel, or execute arbitrary code.

([CVE-2018-5150](/security/CVE-2018-5150), [CVE-2018-5151](/security/CVE-2018-5151), [CVE-2018-5153](/security/CVE-2018-5153), [CVE-2018-5154](/security/CVE-2018-5154),

[CVE-2018-5155](/security/CVE-2018-5155), [CVE-2018-5157](/security/CVE-2018-5157), [CVE-2018-5158](/security/CVE-2018-5158), [CVE-2018-5159](/security/CVE-2018-5159), [CVE-2018-5160](/security/CVE-2018-5160),

[CVE-2018-5163](/security/CVE-2018-5163), [CVE-2018-5164](/security/CVE-2018-5164), [CVE-2018-5168](/security/CVE-2018-5168), [CVE-2018-5173](/security/CVE-2018-5173), [CVE-2018-5175](/security/CVE-2018-5175),

[CVE-2018-5177](/security/CVE-2018-5177), [CVE-2018-5180](/security/CVE-2018-5180))

Multiple security issues were discovered with WebExtensions. If a user

were tricked in to installing a specially crafted extension, an attacker

could potentially exploit these to obtain sensitive information, or bypass

security restrictions. ([CVE-2018-5152](/security/CVE-2018-5152), [CVE-2018-5166](/security/CVE-2018-5166))

It was discovered that the web console and JavaScript debugger incorrectly

linkified chrome: and javascript URLs. If a user were tricked in to

clicking a specially crafted link, an attacker could potentially exploit

this to conduct cross-site scripting (XSS) attacks. ([CVE-2018-5167](/security/CVE-2018-5167))

It was discovered that dragging and dropping link text on to the home

button could set the home page to include chrome pages. If a user were

tricked in to dragging and dropping a specially crafted link on to the

home button, an attacker could potentially exploit this bypass security

restrictions. ([CVE-2018-5169](/security/CVE-2018-5169))

It was discovered that the Live Bookmarks page and PDF viewer would run

script pasted from the clipboard. If a user were tricked in to copying and

pasting specially crafted text, an attacker could potentially exploit this

to conduct cross-site scripting (XSS) attacks. ([CVE-2018-5172](/security/CVE-2018-5172))

It was discovered that the JSON viewer incorrectly linkified javascript:

URLs. If a user were tricked in to clicking on a specially crafted link,

an attacker could potentially exploit this to obtain sensitive

information. ([CVE-2018-5176](/security/CVE-2018-5176))

It was discovered that dragging a file: URL on to a tab that is running in

a different process would cause the file to open in that process. If a

user were tricked in to dragging a file: URL, an attacker could

potentially exploit this to bypass intended security policies.

([CVE-2018-5181](/security/CVE-2018-5181))

It was discovered that dragging text that is a file: URL on to the

addressbar would open the specified file. If a user were tricked in to

dragging specially crafted text on to the addressbar, an attacker could

potentially exploit this to bypass intended security policies.

([CVE-2018-5182](/security/CVE-2018-5182))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [60.0+build2-0ubuntu1](https://launchpad.net/ubuntu/%2Bsource/firefox/60.0%2Bbuild2-0ubuntu1)

##### Ubuntu 17.10

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [60.0+build2-0ubuntu0.17.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox/60.0%2Bbuild2-0ubuntu0.17.10.1)

##### Ubuntu 16.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [60.0+build2-0ubuntu0.16.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/60.0%2Bbuild2-0ubuntu0.16.04.1)

##### Ubuntu 14.04

* [firefox](https://launchpad.net/ubuntu/%2Bsource/firefox)
  -
  [60.0+build2-0ubuntu0.14.04.1](https://launchpad.net/ubuntu/%2Bsource/firefox/60.0%2Bbuild2-0ubuntu0.14.04.1)

After a standard system update you need to restart Firefox to make

all the necessary changes.

## References

* [CVE-2018-5150](/security/CVE-2018-5150)
* [CVE-2018-5151](/security/CVE-2018-5151)
* [CVE-2018-5152](/security/CVE-2018-5152)
* [CVE-2018-5153](/security/CVE-2018-5153)
* [CVE-2018-5154](/security/CVE-2018-5154)
* [CVE-2018-5155](/security/CVE-2018-5155)
* [CVE-2018-5157](/security/CVE-2018-5157)
* [CVE-2018-5158](/security/CVE-2018-5158)
* [CVE-2018-5159](/security/CVE-2018-5159)
* [CVE-2018-5160](/security/CVE-2018-5160)
* [CVE-2018-5163](/security/CVE-2018-5163)
* [CVE-2018-5164](/security/CVE-2018-5164)
* [CVE-2018-5166](/security/CVE-2018-5166)
* [CVE-2018-5167](/security/CVE-2018-5167)
* [CVE-2018-5168](/security/CVE-2018-5168)
* [CVE-2018-5169](/security/CVE-2018-5169)
* [CVE-2018-5172](/security/CVE-2018-5172)
* [CVE-2018-5173](/security/CVE-2018-5173)
* [CVE-2018-5175](/security/CVE-2018-5175)
* [CVE-2018-5176](/security/CVE-2018-5176)
* [CVE-2018-5177](/security/CVE-2018-5177)
* [CVE-2018-5180](/security/CVE-2018-5180)
* [CVE-2018-5181](/security/CVE-2018-5181)
* [CVE-2018-5182](/security/CVE-2018-5182)

## Related notices

* [USN-3660-1](/security/notices/USN-3660-1)
* [USN-3688-1](/security/notices/USN-3688-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from wiki.mozilla.org_73f8d6fa_20250126_100510.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from wiki.mozilla.org_3659d679_20250126_100510.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)


