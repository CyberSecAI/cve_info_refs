=== Content from github.com_8523fb1e_20250125_093224.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp-session%2Fissues%2F272)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp-session%2Fissues%2F272)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=aio-libs%2Faiohttp-session)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[aio-libs](/aio-libs)
/
**[aiohttp-session](/aio-libs/aiohttp-session)**
Public

* [Notifications](/login?return_to=%2Faio-libs%2Faiohttp-session) You must be signed in to change notification settings
* [Fork
  86](/login?return_to=%2Faio-libs%2Faiohttp-session)
* [Star
   238](/login?return_to=%2Faio-libs%2Faiohttp-session)

* [Code](/aio-libs/aiohttp-session)
* [Issues
  5](/aio-libs/aiohttp-session/issues)
* [Pull requests
  1](/aio-libs/aiohttp-session/pulls)
* [Actions](/aio-libs/aiohttp-session/actions)
* [Projects
  0](/aio-libs/aiohttp-session/projects)
* [Wiki](/aio-libs/aiohttp-session/wiki)
* [Security](/aio-libs/aiohttp-session/security)
* [Insights](/aio-libs/aiohttp-session/pulse)

Additional navigation options

* [Code](/aio-libs/aiohttp-session)
* [Issues](/aio-libs/aiohttp-session/issues)
* [Pull requests](/aio-libs/aiohttp-session/pulls)
* [Actions](/aio-libs/aiohttp-session/actions)
* [Projects](/aio-libs/aiohttp-session/projects)
* [Wiki](/aio-libs/aiohttp-session/wiki)
* [Security](/aio-libs/aiohttp-session/security)
* [Insights](/aio-libs/aiohttp-session/pulse)

# Session Fixation vulnerability in RedisStorage #272

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Session Fixation vulnerability in RedisStorage](#top)#272Copy link[![@panagiks](https://avatars.githubusercontent.com/u/9973156?v=4&size=80)](/panagiks)
## Description

[![@panagiks](https://avatars.githubusercontent.com/u/9973156?v=4&size=48)](/panagiks)[panagiks](https://github.com/panagiks)opened [on Apr 30, 2018](https://github.com/aio-libs/aiohttp-session/issues/272#issue-318815814)

There is a window of opportunity for [Session Fixation](https://www.owasp.org/index.php/Session_fixation) exploitation in the logic of RedisStorage.

As seen here: <https://github.com/aio-libs/aiohttp-session/blob/master/aiohttp_session/__init__.py#L190>

Get session data returns an empty dictionary for an empty (this includes invalidated) session.

Referring here: <https://github.com/aio-libs/aiohttp-session/blob/master/aiohttp_session/redis_storage.py#L60>

save\_session takes this data and saves it in Redis.

As a result, an invalidated session will result to the session ID being present in Redis with an empty mapping as its value.

Now looking over at: <https://github.com/aio-libs/aiohttp-session/blob/master/aiohttp_session/redis_storage.py#L50>

RedisStorage's load\_session only looks at the case where data (returned by reading from Redis) is None. This will happen only if the key (session ID) is not present in Redis (has either expired or was never inserted) but as we established above the key is never actually removed, just the value mapping emptied. As a result the load\_session function will return a session with the presented session ID and not a new one, although there was no valid session in storage for this ID.

If this is not caught and mitigated by the web app the following scenario can unfold:

* Attacker acquires a valid cookie
* Invalidates it (logs out)
* Attacker injects said cookie in victim's browser (see OWASP's link above for examples on how)
* Victim visits web app presenting the cookie present in his browser
* Web app uses the get\_session to get a session object for the user, expecting a 'clean' session
* get\_session returns a session with the session ID that was present in the cookie presented by the user
* session is populated by the web app and subsequently stored by aiohttp-session during the response
* User is now logged in with the session ID of the cookie that was injected by the attacker
* The attacker now controls (knows) a session cookie for a given user
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4a949cf8_20250125_093223.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp-session%2Fblob%2Fmaster%2Faiohttp_session%2Fredis_storage.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faio-libs%2Faiohttp-session%2Fblob%2Fmaster%2Faiohttp_session%2Fredis_storage.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=aio-libs%2Faiohttp-session)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[aio-libs](/aio-libs)
/
**[aiohttp-session](/aio-libs/aiohttp-session)**
Public

* [Notifications](/login?return_to=%2Faio-libs%2Faiohttp-session) You must be signed in to change notification settings
* [Fork
  86](/login?return_to=%2Faio-libs%2Faiohttp-session)
* [Star
   238](/login?return_to=%2Faio-libs%2Faiohttp-session)

* [Code](/aio-libs/aiohttp-session)
* [Issues
  5](/aio-libs/aiohttp-session/issues)
* [Pull requests
  1](/aio-libs/aiohttp-session/pulls)
* [Actions](/aio-libs/aiohttp-session/actions)
* [Projects
  0](/aio-libs/aiohttp-session/projects)
* [Wiki](/aio-libs/aiohttp-session/wiki)
* [Security](/aio-libs/aiohttp-session/security)
* [Insights](/aio-libs/aiohttp-session/pulse)

Additional navigation options

* [Code](/aio-libs/aiohttp-session)
* [Issues](/aio-libs/aiohttp-session/issues)
* [Pull requests](/aio-libs/aiohttp-session/pulls)
* [Actions](/aio-libs/aiohttp-session/actions)
* [Projects](/aio-libs/aiohttp-session/projects)
* [Wiki](/aio-libs/aiohttp-session/wiki)
* [Security](/aio-libs/aiohttp-session/security)
* [Insights](/aio-libs/aiohttp-session/pulse)

## Files

 master
## Breadcrumbs

1. [aiohttp-session](/aio-libs/aiohttp-session/tree/master)
2. /[aiohttp\_session](/aio-libs/aiohttp-session/tree/master/aiohttp_session)
/
# redis\_storage.py

Copy path Blame  Blame
## Latest commit

## History

[History](/aio-libs/aiohttp-session/commits/master/aiohttp_session/redis_storage.py)101 lines (91 loc) · 3.35 KB master
## Breadcrumbs

1. [aiohttp-session](/aio-libs/aiohttp-session/tree/master)
2. /[aiohttp\_session](/aio-libs/aiohttp-session/tree/master/aiohttp_session)
/
# redis\_storage.py

Top
## File metadata and controls

* Code
* Blame

101 lines (91 loc) · 3.35 KB[Raw](https://github.com/aio-libs/aiohttp-session/raw/refs/heads/master/aiohttp_session/redis_storage.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101import jsonimport uuidfrom typing import Any, Callable, Optional
from aiohttp import web
from . import AbstractStorage, Session
try: from redis import VERSION as REDIS\_VERSION, asyncio as aioredisexcept ImportError: # pragma: no cover try: import aioredis # type: ignore[import-not-found, no-redef] except ImportError: aioredis = None # type: ignore[assignment] else: import warnings
 warnings.warn( "aioredis library is deprecated, please replace with redis.", DeprecationWarning, stacklevel=1, ) REDIS\_VERSION = (4, 3)
class RedisStorage(AbstractStorage): """Redis storage"""
 def \_\_init\_\_( self, redis\_pool: "aioredis.Redis", \*, cookie\_name: str = "AIOHTTP\_SESSION", domain: Optional[str] = None, max\_age: Optional[int] = None, path: str = "/", secure: Optional[bool] = None, httponly: bool = True, samesite: Optional[str] = None, key\_factory: Callable[[], str] = lambda: uuid.uuid4().hex, encoder: Callable[[object], str] = json.dumps, decoder: Callable[[str], Any] = json.loads, ) -> None: super().\_\_init\_\_( cookie\_name=cookie\_name, domain=domain, max\_age=max\_age, path=path, secure=secure, httponly=httponly, samesite=samesite, encoder=encoder, decoder=decoder, ) if aioredis is None: raise RuntimeError("Please install redis") # May have installed aioredis separately (without aiohttp-session[aioredis]). if REDIS\_VERSION < (4, 3): raise RuntimeError("redis<4.3 is not supported") self.\_key\_factory = key\_factory if not isinstance(redis\_pool, aioredis.Redis): raise TypeError(f"Expected redis.asyncio.Redis got {type(redis\_pool)}") self.\_redis = redis\_pool
 async def load\_session(self, request: web.Request) -> Session: cookie = self.load\_cookie(request) if cookie is None: return Session(None, data=None, new=True, max\_age=self.max\_age) else: key = str(cookie) data\_bytes = await self.\_redis.get(self.cookie\_name + "\_" + key) if data\_bytes is None: return Session(None, data=None, new=True, max\_age=self.max\_age) data\_str = data\_bytes.decode("utf-8") try: data = self.\_decoder(data\_str) except ValueError: data = None return Session(key, data=data, new=False, max\_age=self.max\_age)
 async def save\_session( self, request: web.Request, response: web.StreamResponse, session: Session ) -> None: key = session.identity if key is None: key = self.\_key\_factory() self.save\_cookie(response, key, max\_age=session.max\_age) else: if session.empty: self.save\_cookie(response, "", max\_age=session.max\_age) else: key = str(key) self.save\_cookie(response, key, max\_age=session.max\_age)
 data\_str = self.\_encoder(self.\_get\_session\_data(session)) await self.\_redis.set( self.cookie\_name + "\_" + key, data\_str, ex=session.max\_age, )

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


