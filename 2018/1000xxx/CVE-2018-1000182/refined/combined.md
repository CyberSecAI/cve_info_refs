=== Content from plugins.jenkins.io_46ae1443_20250126_113412.html ===

# Git

How to install

* [Documentation](/git/)
* [Releases](/git/releases/)
* [Issues](/git/issues/)
* [Dependencies](/git/dependencies/)
* [Health Score](/git/healthscore/)

## Introduction

[![Jenkins and Git](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/jenkins-and-git.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/jenkins-and-git.png)

The git plugin provides fundamental git operations for Jenkins projects. It can poll, fetch, checkout, branch, list, merge, tag, and push repositories.

* [Introduction](#plugin-content-introduction)
* [Changelog in GitHub Releases](#plugin-content-changelog)
* [Pipelines](#plugin-content-pipelines)
  + [Multibranch Pipelines](#plugin-content-multibranch-pipelines)
  + [Pipeline examples](#plugin-content-pipeline-examples)
  + [Git Credentials Binding](#plugin-content-credential-binding)
* [Configuration](#plugin-content-configuration)
  + [Repositories](#plugin-content-using-repositories)
  + [Using Credentials](#plugin-content-using-credentials)
  + [Push Notification From Repository](#plugin-content-push-notification-from-repository)
  + [Enabling JGit](#plugin-content-enabling-jgit)
  + [Global Configuration](#plugin-content-global-configuration)
  + [Configuration as code](#plugin-content-configuration-as-code)
  + [Security Configuration](#plugin-content-security-configuration)
  + [Repository Browser](#plugin-content-repository-browser)
* [Git Credential Binding](#plugin-content-git-bindings)
* [Extensions](#plugin-content-extensions)
  + [Clone Extensions](#plugin-content-clone-extensions)
  + [Checkout Extensions](#plugin-content-checkout-extensions)
  + [Changelog Extensions](#plugin-content-changelog-extensions)
  + [Tagging Extensions](#plugin-content-tagging-extensions)
  + [Build Initiation Extensions](#plugin-content-build-initiation-extensions)
  + [Merge Extensions](#plugin-content-merge-extensions)
  + [Deprecated Extensions](#plugin-content-deprecated-extensions)
* [Environment Variables](#plugin-content-environment-variables)
  + [Branch Variables](#plugin-content-branch-variables)
  + [Commit Variables](#plugin-content-commit-variables)
  + [System Configuration Variables](#plugin-content-system-configuration-variables)
  + [Token Macro Variables](#plugin-content-token-macro-variables)
* [Properties](#plugin-content-properties)
  + [Default Timeout](#plugin-content-default-timeout)
  + [Disable command line git](#plugin-content-GitPlugin-WhyNotJGit)
  + [Allow local checkout](#plugin-content-allow-local-checkout)
  + [Cache root directory](#plugin-content-cacheRootDir)
* [Git Publisher](#plugin-content-git-publisher)
  + [Git Publisher Options](#plugin-content-git-publisher-options)
* [Combining repositories](#plugin-content-combining-repositories)
* [Bug Reports](#plugin-content-bug-reports)
* [Contributing to the Plugin](#plugin-content-contributing-to-the-plugin)
* [Remove Git Plugin BuildsByBranch BuildData Script](#plugin-content-remove-git-plugin-buildsbybranch-builddata-script)

## Changelog in [GitHub Releases](https://github.com/jenkinsci/git-plugin/releases)

Release notes are recorded in [GitHub Releases](https://github.com/jenkinsci/git-plugin/releases) since July 1, 2019 (git plugin 3.10.1 and later). Prior release notes are recorded in the git plugin repository [change log](https://github.com/jenkinsci/git-plugin/blob/git-4.7.2/CHANGELOG.adoc).

## Pipelines

The git plugin provides an SCM implementation to be used with the Pipeline SCM [`checkout` step](https://www.jenkins.io/doc/pipeline/steps/workflow-scm-step/). The [Pipeline Syntax Snippet Generator](https://www.jenkins.io/redirect/pipeline-snippet-generator) guides the user to select checkout options.

The [90 second video clip](https://youtu.be/ai1kf4ihZUo) below introduces the Pipeline Syntax Snippet Generator and shows how it is used to generate steps for the Jenkins Pipeline.

[![pipeline syntax](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/pipeline-syntax.png)](https://youtu.be/ai1kf4ihZUo)

### Multibranch Pipelines

The git plugin includes a multibranch provider for Jenkins [Multibranch Pipelines](https://www.jenkins.io/doc/book/pipeline/multibranch/) and for Jenkins [Organization Folders](https://www.jenkins.io/doc/book/pipeline/multibranch/#organization-folders). The git plugin multibranch provider is a "base implementation" that uses command line git. Users should prefer the multibranch implementation for their git provider when one is available. Multibranch implementations for specific git providers can use REST API calls to improve the Jenkins experience and add additional capabilities. Multibranch implementations are available for [GitHub](https://docs.cloudbees.com/docs/cloudbees-ci/latest/cloud-admin-guide/github-branch-source-plugin), [Bitbucket](https://github.com/jenkinsci/bitbucket-branch-source-plugin/blob/master/docs/USER_GUIDE.adoc), [GitLab](https://plugins.jenkins.io/gitlab-branch-source/), [Gitea](https://plugins.jenkins.io/gitea/), and [Tuleap](https://plugins.jenkins.io/tuleap-git-branch-source/).

The [30 minute video clip](https://youtu.be/B_2FXWI6CWg) below introduces Multibranch Pipelines.

[![multibranch pipeline](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/multibranch-pipeline.png)](https://youtu.be/B_2FXWI6CWg)

### Pipeline examples

The examples below were created with the [Pipeline Syntax Snippet Generator](https://www.jenkins.io/redirect/pipeline-snippet-generator). Create your own checkout commands with the [Pipeline Syntax Snippet Generator](https://www.jenkins.io/redirect/pipeline-snippet-generator) configured for your needs.

#### Checkout with defaults

Checkout from the git plugin source repository using https protocol, no credentials, and the master branch.

```
checkout scmGit(
    branches: [[name: 'master']],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout with a specific branch

Checkout from the git plugin source repository using https protocol, no credentials, and the `stable-3.x` branch.

```
checkout scmGit(
    branches: [[name: 'stable-3.x']],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout with ssh and a private key credential

Checkout from the git plugin source repository using ssh protocol, ssh private credentials, and the `v4.11.x` branch. The git plugin supports private key credentials provided by the [Jenkins credentials plugin](https://plugins.jenkins.io/credentials).

```
checkout scmGit(
    branches: [[name: 'v4.11.x']],
    userRemoteConfigs: [[credentialsId:  'my-ssh-private-key-id',
        url: 'ssh://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout with https and a username/password credential

Checkout from the git plugin source repository using https protocol, username/password credentials, and the `v4.9.x` branch. The git plugin supports username/password credentials provided by the [Jenkins credentials plugin](https://plugins.jenkins.io/credentials).

```
checkout scmGit(
    branches: [[name: 'v4.9.x']],
    userRemoteConfigs: [[credentialsId: 'my-username-password-id',
        url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout with git large file support enabled

Checkout from the git plugin source repository using https protocol with large file support enabled for the `stable-3.x` branch.

```
checkout scmGit(
    branches: [[name: 'stable-3.x']],
    extensions: [ lfs() ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout without fetching tags (advanced clone behavior)

Checkout from the git plugin source repository using https with no credentials and without tags. This can save time and disk space when you want to access the repository without considering tags.

```
checkout scmGit(
    branches: [[name: 'master']],
    extensions: [ cloneOption(noTags: true) ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Checkout with a shallow clone to reduce data traffic

Checkout from the workspace cleanup plugin source repository using https without credentials, a default branch, and a shallow clone. Shallow clone requests a limited number of commits from the tip of the requested branch and may save time, data transfer, and disk space.

```
checkout scmGit(
    branches: [[name: '*/master']],
    extensions: [ cloneOption(shallow: true) ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/ws-cleanup-plugin']])
```

#### Checkout with a narrow refspec

Checkout from the workspace cleanup plugin source repository using https without credentials, the `master` branch, and with a refspec specific to the master branch. This can save time, data transfer, and disk space when you only need to access the references specified by the refspec.

```
checkout scmGit(
    branches: [[name: '*/master']],
    extensions: [ cloneOption(honorRefspec: true) ],
    userRemoteConfigs: [[refspec: '+refs/heads/master:refs/remotes/origin/master',
        url: 'https://github.com/jenkinsci/ws-cleanup-plugin']])
```

#### Checkout and prune stale remote branches

Checkout from the workspace cleanup plugin source repository using https without credentials and with prune tags and prune branches extension enabled. This removes remote tracking branches and tags from the local workspace if they no longer exist on the remote.

```
checkout scmGit(
    branches: [[name: 'master']],
    extensions: [ pruneStaleBranch(), pruneTags(true) ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/ws-cleanup-plugin']])
```

#### Wipe out repository before checkout

Remove all files in the workspace before a checkout from the workspace cleanup plugin source repository using https without credentials, a default branch. Ensures a fully fresh workspace.

```
deleteDir()
checkout scmGit(
    branches: [[name: '*/master']],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/ws-cleanup-plugin']])
```

### Git Credentials Binding

The git plugin provides `Git Username and Password` binding that allows authenticated git operations over **HTTP** and **HTTPS** protocols using command line git in a Pipeline job.

The git credential bindings are accessible through the [`withCredentials`](https://www.jenkins.io/doc/pipeline/steps/credentials-binding/#withcredentials-bind-credentials-to-variables) step of the [Credentials Binding](https://plugins.jenkins.io/credentials-binding/) plugin. The binding retrieves credentials from the [Credentials](https://plugins.jenkins.io/credentials/) plugin.

#### Git Username and Password Binding

This binding provides authentication support over **HTTP** protocol using command line git in a Pipeline job.

Procedure

1. Click the Pipeline Syntax *Snippet Generator* and choose the `withCredentials` step, add Git Username and Password binding.
2. Choose the required credentials and Git tool name, specific to the generated Pipeline snippet.

[![Git-Username-and Password-Binding-Pipeline-Job](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-credentials-usernamepassword-binding-pipline-job.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-credentials-usernamepassword-binding-pipline-job.png)

Two variable bindings are used, `GIT_USERNAME` and `GIT_PASSWORD`, to pass the username and password to `sh`, `bat`, and `powershell` steps inside the `withCredentials` block of a Pipeline job. The variable bindings are available even if the `JGit` or `JGit with Apache HTTP Client` git implementation is being used.

Shell example

```
withCredentials([gitUsernamePassword(credentialsId: 'my-credentials-id',
                 gitToolName: 'git-tool')]) {
  sh 'git fetch --all'
}
```

Batch example

```
withCredentials([gitUsernamePassword(credentialsId: 'my-credentials-id',
                 gitToolName: 'git-tool')]) {
  bat 'git submodule update --init --recursive'
}
```

Powershell example

```
withCredentials([gitUsernamePassword(credentialsId: 'my-credentials-id',
                 gitToolName: 'git-tool')]) {
  powershell 'git push'
}
```

## Configuration

### Repositories

[![Repository Configuration](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-configuration.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-configuration.png)

The git plugin fetches commits from one or more remote repositories and performs a checkout in the agent workspace. Repositories and their related information include:

Repository URL

The URL of the remote repository. The git plugin passes the remote repository URL to the git implementation (command line or JGit). Valid repository URL’s include `https`, `ssh`, `scp`, `git`, `local file`, and other forms. Valid repository URL forms are described in the [git documentation](https://git-scm.com/book/en/v2/Git-on-the-Server-The-Protocols#_the_protocols).

Credentials

Credentials are defined using the [Jenkins credentials plugin](https://plugins.jenkins.io/credentials). They are selected from a drop-down list and their identifier is stored in the job definition. Refer to [using credentials](#plugin-content-using-credentials) for more details on supported credential types.

Name

Git uses a short name to simplify user references to the URL of the remote repository. The default short name is `origin`. Other values may be assigned and then used throughout the job definition to refer to the remote repository.

Refspec

A refspec maps remote branches to local references. It defines the branches and tags which will be fetched from the remote repository into the agent workspace.

A refspec defines the remote references that will be retrieved and how they map to local references. If left blank, it will default to the normal `git fetch` behavior and will retrieve all branches. This default behavior is sufficient for most cases.

The default refspec is `+refs/heads/*:refs/remotes/REPOSITORYNAME/` where REPOSITORYNAME is the value you specify in the above repository "Name" field. The default refspec retrieves all branches. If a checkout only needs one branch, then a more restrictive refspec can reduce the data transfer from the remote repository to the agent workspace. For example, `+refs/heads/master:refs/remotes/origin/master` will retrieve only the master branch and nothing else.

The refspec can be used with the [honor refspec on initial clone](#plugin-content-honor-refspec-on-initial-clone) option in the [advanced clone behaviors](#plugin-content-advanced-clone-behaviours) to limit the number of remote branches mapped to local references. If "honor refspec on initial clone" is not enabled, then a default refspec for its initial fetch. This maintains compatibility with previous behavior and allows the job definition to decide if the refspec should be honored on initial clone.

Multiple refspecs can be entered by separating them with a space character. The refspec value `+refs/heads/master:refs/remotes/origin/master +refs/heads/develop:refs/remotes/origin/develop` retrieves the master branch and the develop branch and nothing else.

Refer to the [git refspec documentation](https://git-scm.com/book/en/v2/Git-Internals-The-Refspec) for more refspec details.

### Using Credentials

The git plugin supports username / password credentials and private key credentials provided by the [Jenkins credentials plugin](https://plugins.jenkins.io/credentials). It does not support other credential types like secret text, secret file, or certificates. Select credentials from the job definition drop down menu or enter their identifiers in Pipeline job definitions.

When the remote repository is accessed with the **HTTP or HTTPS protocols**, the plugin requires a **username / password credential**. Other credential types will not work with HTTP or HTTPS protocols.

When the remote repository is accessed with the **ssh protocol**, the plugin requires an **ssh private key credential**. Other credential types will not work with the ssh protocol.

### Push Notification From Repository

To minimize the delay between a push and a build, configure the remote repository to use a Webhook to notify Jenkins of changes to the repository. Refer to webhook documentation for your repository:

* [GitHub](https://plugins.jenkins.io/github/#plugin-content-github-hook-trigger-for-gitscm-polling)
* [Bitbucket](https://plugins.jenkins.io/bitbucket)
* [GitLab](https://plugins.jenkins.io/gitlab-branch-source)
* [Gitea](https://github.com/jenkinsci/gitea-plugin/blob/master/docs/README.md)
* [Tuleap](https://docs.tuleap.org/user-guide/code-versioning/git.html#jenkins-webhooks)

Other git repositories can use a [post-receive hook](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks) in the remote repository to notify Jenkins of changes. The `notifyCommit` endpoint can take four parameters.

* `url` (required) should match the URL in which a Jenkins job is configured to clone.
* `branches` (optional) is a comma separated list of one or more branches meant for multi-branch pipelines.
* `sha1` (optional) the SHA1 Git commit hash which triggered the notification.
* `token` (optional) a secret token which must match the Jenkins configuration. Jenkins ignores non-matching token requests.

Add the following line in your `hooks/post-receive` file on the git server, replacing <URL of the Git repository> with the fully qualified URL you use when cloning the repository, and replacing <Access token> with a token generated by a Jenkins administrator using the "Git plugin notifyCommit access tokens" section of the "Configure Global Security" page.

```
curl "http://yourserver/git/notifyCommit?url=<URL of the Git repository>&token=<Access token>"
```

This will scan all the jobs that:

* Have Build Triggers > Poll SCM enabled. No polling schedule is required.
* Are configured to build the repository at the specified URL

For jobs that meet these conditions, polling will be triggered. If polling finds a change worthy of a build, a build will be triggered.

This allows a notify script to remain the same for all Jenkins jobs. Or if you have multiple repositories under a single repository host application (such as Gitosis), you can share a single post-receive hook script with all the repositories.

When notifyCommit is successful, the list of triggered projects is returned.

The `token` parameter is required by default as a security measure, but can be disabled by the following [system property](https://www.jenkins.io/doc/book/managing/system-properties/):

```
hudson.plugins.git.GitStatus.NOTIFY_COMMIT_ACCESS_CONTROL
```

It has two modes:

* `disabled-for-polling` - Allows unauthenticated requests as long as they only request polling of the repository supplied in the `url` query parameter. Prohibits unauthenticated requests that attempt to schedule a build immediately by providing a `sha1` query parameter.
* `disabled` - Fully disables the access token mechanism and allows all requests to `notifyCommit` to be unauthenticated. **This option is insecure and is not recommended.**

You can set the `NOTIFY_COMMIT_ACCESS_CONTROL` value with either a [system property](https://www.jenkins.io/doc/book/managing/system-properties/) or a [Groovy hook script](https://www.jenkins.io/doc/book/managing/groovy-hook-scripts/).

Using a system property

The `NOTIFY_COMMIT_ACCESS_CONTROL` value can be set from the command line that starts Jenkins. This method is useful for environments where initial Jenkins settings are managed with command line arguments.

```
java -Dhudson.plugins.git.GitStatus.NOTIFY_COMMIT_ACCESS_CONTROL=disabled-for-polling -jar jenkins.war
```

Using a Groovy script

The `NOTIFY_COMMIT_ACCESS_CONTROL` value can be set using a Groovy script placed in the `init.groovy.d` subdirectory of the Jenkins home directory. This method is useful for environments where Jenkins settings are managed with [Groovy post-initialization scripts](https://www.jenkins.io/doc/book/managing/groovy-hook-scripts/#post-initialization-script-init-hook).

```
hudson.plugins.git.GitStatus.NOTIFY_COMMIT_ACCESS_CONTROL='disabled-for-polling'
```

### Enabling JGit

See the [git client plugin documentation](https://plugins.jenkins.io/git-client/#plugin-content-enabling-jgit) for instructions to enable JGit. JGit becomes available throughout Jenkins once it has been enabled.

### Global Configuration

[![Global Configuration](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-global-configuration.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-global-configuration.png)

In the `Configure System` page, the Git Plugin provides the following options:

Global Config user.name Value

Defines the default git user name that will be assigned when git commits a change from Jenkins. For example, `Janice Examplesperson`. This can be overridden by individual projects with the [Custom user name/e-mail address](#plugin-content-custom-user-name-e-mail-address) extension.

Global Config user.email Value

Defines the default git user e-mail that will be assigned when git commits a change from Jenkins. For example, `janice.examplesperson@example.com`. This can be overridden by individual projects with the [Custom user name/e-mail address](#plugin-content-custom-user-name-e-mail-address) extension.

Create new accounts based on author/committer’s email

New user accounts are created in Jenkins for committers and authors identified in changelogs. The new user accounts are added to the internal Jenkins database. The e-mail address is used as the id of the account.

Show the entire commit summary in changes

The `changes` page for each job would truncate the change summary prior to git plugin 4.0. With the release of git plugin 4.0, the default was changed to show the complete change summary. Administrators that want to restore the old behavior may disable this setting.

Hide credential usage in job output

If checked, the console log will not show the credential identifier used to clone a repository.

Disable performance enhancements

If JGit and command line git are both enabled on an agent, the git plugin uses a "git tool chooser" to choose a preferred git implementation. The preferred git implementation depends on the size of the repository and the git plugin features requested by the job. If the repository size is **less than** the JGit repository size threshold and the git features of the job are all implemented in JGit, then JGit is used. If the repository size is **greater than** the JGit repository size threshold or the job requires git features that are not implemented in JGit, then command line git is used.

If checked, the plugin will disable the feature that recommends a git implementation on the basis of the size of a repository. This switch may be used in case of a bug in the performance improvement feature. If you enable this setting, please report a git plugin issue that describes why you needed to enable it.

Preserve second fetch during initial checkout

If checked, the initial checkout step will not avoid the second fetch. Git plugin versions prior to git plugin 4.4 would perform two fetch operations during the initial repository checkout. Git plugin 4.4 removes the second fetch operation in most cases. Enabling this option will restore the second fetch operation. This setting is only needed if there is a bug in the redundant fetch removal logic. If you enable this setting, please report a git plugin issue that describes why you needed to enable it.

Add git tag action to jobs

If checked, the git tag action will be added to any builds that happen **after** the box is checked. Prior to git plugin 4.5.0, the git tag action was always added. Git plugin 4.5.0 and later will not add the git tag action to new builds unless the administrator enables it.

The git tag action allows a user to apply a tag to the git repository in the workspace based on the git commit used in the build applying the tag. The git plugin does **not** push the applied tag to any other location. If the workspace is removed, the tag that was applied is lost. Tagging a workspace made sense when using centralized repositories that automatically applied the tag to the centralized repository. Applying a git tag in an agent workspace doesn’t have many practical uses.

### Configuration as code

The global settings of the git plugin can be defined with the Jenkins [configuration as code plugin](https://plugins.jenkins.io/configuration-as-code/). Detailed descriptions of the individual settings are available in the [global configuration settings](#plugin-content-global-configuration) section of this document.

An example configuration might look like this:

```
unclassified:
  scmGit:
    addGitTagAction: false
    allowSecondFetch: false
    createAccountBasedOnEmail: false
    disableGitToolChooser: false
    globalConfigEmail: "jenkins-user@example.com"
    globalConfigName: "jenkins-user"
    hideCredentials: false
    showEntireCommitSummaryInChanges: true
    useExistingAccountWithSameEmail: false
```

### Security Configuration

[![Security Configuration](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-security-configuration.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-security-configuration.png)

In the `Configure Global Security` page, the Git Plugin provides the following option:

Git Hooks

[Git hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks) allow scripts to be invoked when certain important git repository actions occur. This configuration controls the execution of client-side hooks on the controller and on agents. It is recommended that git hooks be **disabled** on the controller and on agents.

Most git repositories do not use hooks in the repository and do not need repository hooks. In those rare cases where repository hooks are needed, it is highly recommended that they are **disabled** on the Jenkins controller and on Jenkins agents.

Client-side hooks are **not** copied when the repository is cloned by Jenkins using the inbuilt SCM methods. However, client-side hooks might be installed in a repository by build steps or by misconfiguration.

If hook scripts are allowed, a client-side hook script installed in a repository will execute when the matching git operation is performed. For example, if hooks are allowed and a git repository includes a `post-checkout` hook, the hook script will run after any checkout in that repository. If hooks are allowed and a git repository includes a `pre-auto-gc` hook, the hook script will run before any automatic git garbage collection task.

See ["Customizing Git - Git Hooks"](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks) for more details about git repository hooks.

### Repository Browser

[![Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser.png)

A Repository Browser adds links in "changes" views within Jenkins to an external system for browsing the details of those changes. The "Auto" selection attempts to infer the repository browser from the "Repository URL" and can detect cloud versions of GitHub, Bitbucket and GitLab.

Repository browsers include:

#### AssemblaWeb

[![Assembla Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-assemblaweb.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-assemblaweb.png)

Repository browser for git repositories hosted by [Assembla](https://www.assembla.com/home). Options include:

Assembla Git URL

Root URL serving this Assembla repository. For example, `https://app.assembla.com/spaces/git-plugin/git/source`

#### FishEye

[![FishEye Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-fisheye.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-fisheye.png)

Repository browser for git repositories hosted by [Atlassian Fisheye](https://www.atlassian.com/software/fisheye). Options include:

URL

Root URL serving this FishEye repository. For example, `https://fisheye.example.com/browse/my-project`

#### Kiln

[![Kiln Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-kiln.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-kiln.png)

Repository browser for git repositories hosted by [Kiln](http://www.fogbugz.com/version-control). Options include:

URL

Root URL serving this Kiln repository. For example, `https://kiln.example.com/username/my-project`

#### Microsoft Team Foundation Server/Visual Studio Team Services

[![Microsoft Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-microsoft.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-microsoft.png)

Repository browser for git repositories hosted by [Azure DevOps](https://azure.microsoft.com/en-us/solutions/devops/). Options include:

URL or name

Root URL serving this Azure DevOps repository. For example, `https://example.visualstudio.com/_git/my-project.`

#### bitbucketweb

[![Bitbucket Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-bitbucket.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-bitbucket.png)

Repository browser for git repositories hosted by [Bitbucket](https://bitbucket.org/). Options include:

URL

Root URL serving this Bitbucket repository. For example, `https://bitbucket.org/username/my-project`

#### bitbucketserver

[![Bitbucket Server Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-bitbucketserver.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-bitbucketserver.png)

Repository browser for git repositories hosted by an on-premises Bitbucket Server installation. Options include:

URL

Root URL serving this Bitbucket repository. For example, `https://bitbucket.example.com/username/my-project`

#### cgit

[![CGit Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-cgit.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-cgit.png)

Repository browser for git repositories hosted by [cgit](https://git.zx2c4.com/cgit/). Options include:

URL

Root URL serving this cgit repository. For example, `https://git.zx2c4.com/cgit/`

#### gitblit

[![GitBlit Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gitblit.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gitblit.png)

GitBlit root url

Root URL serving this GitBlit repository. For example, `https://gitblit.example.com/`

Project name in GitBlit

Name of the GitBlit project. For example, `my-project`

#### githubweb

[![GitHub Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-github.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-github.png)

Repository browser for git repositories hosted by [GitHub](https://github.com//). Options include:

URL

Root URL serving this GitHub repository. For example, `https://github.example.com/username/my-project`

#### gitiles

[![Gitiles Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gitiles.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gitiles.png)

Repository browser for git repositories hosted by [Gitiles](https://gerrit.googlesource.com/gitiles/). Options include:

gitiles root url

Root URL serving this Gitiles repository. For example, `https://gerrit.googlesource.com/gitiles/`

#### gitlab

[![GitLab Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gitlab.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gitlab.png)

Repository browser for git repositories hosted by [GitLab](https://gitlab.com/). Options include:

URL

Root URL serving this GitLab repository. For example, `https://gitlab.example.com/username/my-project`

Version

Major and minor version of GitLab you use, such as 15.6. If you don’t specify a version, a modern version of GitLab (>= 8.0) is assumed. For example, `15.6`

#### gitlist

[![Gitlist Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gitlist.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gitlist.png)

Repository browser for git repositories hosted by [GitList](https://gitlist.org/). Options include:

URL

Root URL serving this GitList repository. For example, `https://gitlist.example.com/username/my-project`

#### gitoriousweb

Gitorious was acquired in 2015. This browser is **deprecated**.

URL

Root URL serving this Gitorious repository. For example, `https://gitorious.org/username/my-project`

#### gitweb

[![Gitweb Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gitweb.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gitweb.png)

Repository browser for git repositories hosted by [GitWeb](https://git-scm.com/docs/gitweb). Options include:

URL

Root URL serving this GitWeb repository. For example, `https://gitweb.example.com/username/my-project`

#### gogs

[![Gogs Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-gogs.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-gogs.png)

Repository browser for git repositories hosted by [Gogs](https://gogs.io/). Options include:

URL

Root URL serving this Gogs repository. For example, `https://gogs.example.com/username/my-project`

#### phabricator

Effective June 1, 2021, Phabricator is [no longer actively maintained](https://admin.phacility.com/phame/post/view/11/phacility_is_winding_down_operations/). This browser is **deprecated**.

URL

Root URL serving this Phabricator repository. For example, `https://phabricator.example.com/`

Repository name in Phab

Name of the Phabricator repository. For example, `my-project`

#### redmineweb

[![Redmine Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-redmine.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-redmine.png)

Repository browser for git repositories hosted by [Redmine](https://www.redmine.org/). Options include:

URL

Root URL serving this Redmine repository. For example, `https://redmine.example.com/username/projects/my-project/repository`

#### rhodecode

[![RhodeCode Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-rhodecode.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-rhodecode.png)

Repository browser for git repositories hosted by [RhodeCode](https://thodecode.com/). Options include:

URL

Root URL serving this RhodeCode repository. For example, `https://rhodecode.example.com/username/my-project`

#### stash

[![Stash Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-stash.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-stash.png)

Stash is now called **BitBucket Server**. Repository browser for git repositories hosted by [BitBucket Server](https://www.atlassian.com/software/bitbucket). Options include:

URL

Root URL serving this Stash repository. For example, `https://stash.example.com/username/my-project`

#### viewgit

[![Viewgit Repository Browser](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-repository-browser-viewgit.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-repository-browser-viewgit.png)

Repository browser for git repositories hosted by [viewgit](https://www.openhub.net/p/viewgit). Options include:

ViewGit root url

Root URL serving this ViewGit repository. For example, `https://viewgit.example.com/`

Project Name in ViewGit

ViewGit project name. For example, `my-project`

## Git Credential Binding

The git plugin provides one binding to support authenticated git operations over **HTTP** or **HTTPS** protocol, namely `Git Username and Password`. The git plugin depends on the Credential Binding Plugin to support these bindings.

To access the `Git Username and Password` binding in a Pipeline job, visit [Git Credentials Binding](#plugin-content-credential-binding)

Freestyle projects can use git credential binding with the following steps:

1. Check the box *Use secret text(s) or file(s)*, add Git Username and Password binding.
2. Choose the required credentials and Git tool name.

[![Git-Username-and Password-Binding-Freestyle-project](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-credentials-usernamepassword-binding-freestyle-project.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-credentials-usernamepassword-binding-freestyle-project.png)

Two variable bindings are used, `GIT_USERNAME` and `GIT_PASSWORD`, to pass the username and password to shell, batch, and powershell steps in a Freestyle job. The variable bindings are available even if the `JGit` or `JGit with Apache HTTP Client` git implementation is being used.

## Extensions

Extensions add new behavior or modify existing plugin behavior for different uses. Extensions help users more precisely tune the plugin to meet their needs.

Extensions include:

* [Clone Extensions](#plugin-content-clone-extensions)
* [Checkout Extensions](#plugin-content-checkout-extensions)
* [Changelog Extensions](#plugin-content-changelog-extensions)
* [Tagging Extensions](#plugin-content-tagging-extensions)
* [Build Initiation Extensions](#plugin-content-build-initiation-extensions)
* [Merge Extensions](#plugin-content-merge-extensions)
* [Deprecated Extensions](#plugin-content-deprecated-extensions)

### Clone Extensions

Clone extensions modify the git operations that retrieve remote changes into the agent workspace. The extensions can adjust the amount of history retrieved, how long the retrieval is allowed to run, and other retrieval details.

#### Advanced clone behaviours

[![Advanced clone behaviours](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-advanced-clone-behaviours.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-advanced-clone-behaviours.png)

Advanced clone behaviors modify the `[git clone](https://git-scm.com/docs/git-clone)` and `[git fetch](https://git-scm.com/docs/git-fetch)` commands. They control:

* breadth of history retrieval (refspecs)
* depth of history retrieval (shallow clone)
* disc space use (reference repositories)
* duration of the command (timeout)
* tag retrieval

Advanced clone behaviors include:

Honor refspec on initial clone

Perform initial clone using the refspec defined for the repository. This can save time, data transfer and disk space when you only need to access the references specified by the refspec. If this is not enabled, then the plugin default refspec includes **all** remote branches.

Shallow clone

Perform a shallow clone by requesting a limited number of commits from the tip of the requested branch(es). Git will not download the complete history of the project. This can save time and disk space when you just want to access the latest version of a repository.

Shallow clone depth

Set shallow clone depth to the specified number of commits. Git will only download `depth` commits from the remote repository, saving time and disk space.

Path of the reference repo to use during clone

Specify a folder containing a repository that will be used by git as a reference during clone operations. This option will be ignored if the folder is not available on the agent.

Timeout (in minutes) for clone and fetch operations

Specify a timeout (in minutes) for clone and fetch operations.

Fetch tags

Deselect this to perform a clone without tags, saving time and disk space when you want to access only what is specified by the refspec, without considering any repository tags.

#### Prune stale remote tracking branches

[![Prune stale remote tracking branches](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-prune-stale-remote-tracking-branches.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-prune-stale-remote-tracking-branches.png)

Removes remote tracking branches from the local workspace if they no longer exist on the remote. See `[git remote prune](https://git-scm.com/docs/git-remote#Documentation/git-remote.txt-empruneem)` and `[git fetch --prune](https://git-scm.com/docs/git-fetch#_pruning)` for more details.

#### Prune stale tags

[![Prune stale tags](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-prune-stale-tags.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-prune-stale-tags.png)

Removes tags from the local workspace before fetch if they no longer exist on the remote. If stale tags are not pruned, deletion of a remote tag will not remove the local tag in the workspace. If the local tag already exists in the workspace, git correctly refuses to create the tag again. Pruning stale tags allows the local workspace to create a tag with the same name as a tag which was removed from the remote.

### Checkout Extensions

Checkout extensions modify the git operations that place files in the workspace from the git repository on the agent. The extensions can adjust the maximum duration of the checkout operation, the use and behavior of git submodules, the location of the workspace on the disc, and more.

#### Advanced checkout behaviors

[![Advanced checkout behaviors](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-advanced-checkout-behaviors.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-advanced-checkout-behaviors.png)

Advanced checkout behaviors modify the `[git checkout](https://git-scm.com/docs/git-checkout)` command. Advanced checkout behaviors include

Timeout (in minutes) for checkout operation

Specify a timeout (in minutes) for checkout. The checkout is stopped if the timeout is exceeded. Checkout timeout is usually only required with slow file systems or large repositories.

#### Advanced sub-modules behaviours

[![Advanced sub-modules behaviours](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-advanced-sub-modules-behaviours.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-advanced-sub-modules-behaviours.png)

Advanced sub-modules behaviors modify the `[git submodule](https://git-scm.com/docs/git-submodule)` commands. They control:

* depth of history retrieval (shallow clone)
* disc space use (reference repositories)
* credential use
* duration of the command (timeout)
* concurrent threads used to fetch submodules

Advanced sub-modules include:

Disable submodules processing

Ignore submodules in the repository.

Recursively update submodules

Retrieve all submodules recursively. Without this option, submodules which contain other submodules will ignore the contained submodules.

Update tracking submodules to tip of branch

Retrieve the tip of the configured branch in .gitmodules.

Use credentials from default remote of parent repository

Use credentials from the default remote of the parent project. Submodule updates do not use credentials by default. Enabling this extension will provide the parent repository credentials to each of the submodule repositories. Submodule credentials require that the submodule repository must accept the same credentials as the parent project. If the parent project is cloned with https, then the authenticated submodule references must use https as well. If the parent project is cloned with ssh, then the authenticated submodule references must use ssh as well.

Path of the reference repo to use during submodule update

Folder containing a repository that will be used by git as a reference during submodule clone operations. This option will be ignored if the folder is not available on the agent running the build. A reference repository may contain multiple subprojects. See the combining repositories section for more details.

Timeout (in minutes) for submodule operations

Specify a timeout (in minutes) for submodules operations. This option overrides the default timeout.

Number of threads to use when updating submodules

Number of parallel processes to be used when updating submodules. Default is to use a single thread for submodule updates

Shallow clone

Perform shallow clone of submodules. Git will not download the complete history of the project, saving time and disk space.

Shallow clone depth

Set shallow clone depth for submodules. Git will only download recent history of the project, saving time and disk space.

#### Checkout to a sub-directory

[![Checkout to a sub-directory](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-checkout-to-a-sub-directory.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-checkout-to-a-sub-directory.png)

Checkout to a subdirectory of the workspace instead of using the workspace root.

This extension should **not** be used in Jenkins Pipeline (either declarative or scripted). Jenkins Pipeline already provides standard techniques for checkout to a subdirectory. Use `ws` and `dir` in Jenkins Pipeline rather than this extension.

Local subdirectory for repo

Name of the local directory (relative to the workspace root) for the git repository checkout. If left empty, the workspace root itself will be used.

#### Checkout to specific local branch

[![Checkout to specific local branch](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-checkout-to-specific-local-branch.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-checkout-to-specific-local-branch.png)

Branch name

If given, checkout the revision to build as HEAD on the named branch. If value is an empty string or "\*\*", then the branch name is computed from the remote branch without the origin. In that case, a remote branch 'origin/master' will be checked out to a local branch named 'master', and a remote branch 'origin/develop/new-feature' will be checked out to a local branch named 'develop/new-feature'. If a specific revision and not branch HEAD is checked out, then 'detached' will be used as the local branch name.

#### Wipe out repository and force clone

[![Wipe out repository and force clone](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-wipe-out-repository-and-force-clone.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-wipe-out-repository-and-force-clone.png)

Delete the contents of the workspace before build and before checkout. Deletes the git repository inside the workspace and will force a full clone.

#### Clean after checkout

[![Clean after checkout](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-clean-after-checkout.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-clean-after-checkout.png)

Clean the workspace **after** every checkout by deleting all untracked files and directories, including those which are specified in `.gitignore`. Resets all tracked files to their versioned state. Ensures that the workspace is in the same state as if clone and checkout were performed in a new workspace. Reduces the risk that current build will be affected by files generated by prior builds. Does not remove files outside the workspace (like temporary files or cache files). Does not remove files in the `.git` repository of the workspace.

Delete untracked nested repositories

Remove subdirectories which contain `.git` subdirectories if this option is enabled. This is implemented in command line git as `git clean -xffd`. Refer to the [git clean manual page](https://git-scm.com/docs/git-clean) for more information.

#### Clean before checkout

[![Clean before checkout](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-clean-before-checkout.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-clean-before-checkout.png)

Clean the workspace **before** every checkout by deleting all untracked files and directories, including those which are specified in .gitignore. Resets all tracked files to their versioned state. Ensures that the workspace is in the same state as if cloned and checkout were performed in a new workspace. Reduces the risk that current build will be affected by files generated by prior builds. Does not remove files outside the workspace (like temporary files or cache files). Does not remove files in the `.git` repository of the workspace.

Delete untracked nested repositories

Remove subdirectories which contain `.git` subdirectories if this option is enabled. This is implemented in command line git as `git clean -xffd`. Refer to the [git clean manual page](https://git-scm.com/docs/git-clean) for more information.

#### Sparse checkout paths

[![Sparse checkout paths](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-sparse-checkout-paths.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-sparse-checkout-paths.png)

Specify the paths that you’d like to sparse checkout. This may be used for saving space (Think about a reference repository). Be sure to use a recent version of Git, at least above 1.7.10.

Multiple sparse checkout path values can be added to a single job.

Path

File or directory to be included in the checkout

```
checkout scmGit(
    branches: [[name: 'master']],
    extensions: [
        sparseCheckout(sparseCheckoutPaths: [[path: 'src'], [path: 'Makefile']])
    ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

#### Git LFS pull after checkout

[![Git LFS pull after checkout](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-lfs-pull-after-checkout.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-lfs-pull-after-checkout.png)

Enable [git large file support](https://git-lfs.github.com/) for the workspace by pulling large files after the checkout completes. Requires that the controller and each agent performing an LFS checkout have installed `git lfs`.

### Changelog Extensions

The plugin can calculate the source code differences between two builds. Changelog extensions adapt the changelog calculations for different cases.

#### Calculate changelog against a specific branch

[![Calculate changelog against a specific branch](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-calculate-changelog-against-a-specific-branch.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-calculate-changelog-against-a-specific-branch.png)

'Calculate changelog against a specific branch' uses the specified branch to compute the changelog instead of computing it based on the previous build. This extension can be useful for computing changes related to a known base branch, especially in environments which do not have the concept of a "pull request".

Name of repository

Name of the repository, such as 'origin', that contains the branch.

Name of branch

Name of the branch used for the changelog calculation within the named repository.

#### Use commit author in changelog

[![Use commit author in changelog](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-use-commit-author-in-changelog.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-use-commit-author-in-changelog.png)

The default behavior is to use the Git commit’s "Committer" value in build changesets. If this option is selected, the git commit’s "Author" value is used instead.

### Tagging Extensions

Tagging extensions allow the plugin to apply tags in the current workspace.

#### Create a tag for every build

[![Create a tag for every build](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-create-a-tag-for-every-build.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-create-a-tag-for-every-build.png)

Create a tag in the workspace for every build to unambiguously mark the commit that was built. You can combine this with Git publisher to push the tags to the remote repository.

### Build Initiation Extensions

The git plugin can start builds based on many different conditions. The build initiation extensions control the conditions that start a build. They can ignore notifications of a change or force a deeper evaluation of the commits when polling

#### Don’t trigger a build on commit notifications

[![Do not trigger a build on commit notifications](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-do-not-trigger-a-build-on-commit-notifications.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-do-not-trigger-a-build-on-commit-notifications.png)

If checked, this repository will be ignored when the notifyCommit URL is accessed whether the repository matches or not.

#### Force polling using workspace

[![Force polling using workspace](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-force-polling-using-workspace.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-force-polling-using-workspace.png)

The git plugin polls remotely using `ls-remote` when configured with a single branch (no wildcards!). When this extension is enabled, the polling is performed from a cloned copy of the workspace instead of using `ls-remote`.

If this option is selected, polling will use a workspace instead of using `ls-remote`.

By default, the plugin polls by executing a polling process or thread on the Jenkins controller. If the Jenkins controller does not have a git installation, the administrator may [enable JGit](#plugin-content-enabling-jgit) to use a pure Java git implementation for polling. In addition, the administrator may need to [disable command line git](#plugin-content-GitPlugin-WhyNotJGit) to prevent use of command line git on the Jenkins controller.

#### Polling ignores commits from certain users

[![Polling ignores commits from certain users](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-polling-ignores-commits-from-certain-users.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-polling-ignores-commits-from-certain-users.png)

These options allow you to perform a merge to a particular branch before building. For example, you could specify an integration branch to be built, and to merge to master. In this scenario, on every change of integration, Jenkins will perform a merge with the master branch, and try to perform a build if the merge is successful. It then may push the merge back to the remote repository if the Git Push post-build action is selected.

Excluded Users

If set and Jenkins is configured to poll for changes, Jenkins will ignore any revisions committed by users in this list when determining if a build should be triggered. This can be used to exclude commits done by the build itself from triggering another build, assuming the build server commits the change with a distinct SCM user. Using this behavior prevents the faster `git ls-remote` polling mechanism. It forces polling to require a workspace, as if you had selected the [Force polling using workspace](#plugin-content-force-polling-using-workspace) extension.

```
Each exclusion uses exact string comparison and must be separated by a new line.
User names are only excluded if they exactly match one of the names in this list.
```

#### Polling ignores commits in certain paths

[![Polling ignores commits in certain paths](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-polling-ignores-commits-in-certain-paths.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-polling-ignores-commits-in-certain-paths.png)

If set and Jenkins is configured to poll for changes, Jenkins will pay attention to included and/or excluded files and/or folders when determining if a build needs to be triggered.

Using this behavior will preclude the faster remote polling mechanism, forcing polling to require a workspace thus sometimes triggering unwanted builds, as if you had selected the [Force polling using workspace](#plugin-content-force-polling-using-workspace) extension as well. This can be used to exclude commits done by the build itself from triggering another build, assuming the build server commits the change with a distinct SCM user. Using this behavior will preclude the faster git ls-remote polling mechanism, forcing polling to require a workspace, as if you had selected the [Force polling using workspace](#plugin-content-force-polling-using-workspace) extension as well.

Included Regions

Each inclusion uses java regular expression pattern matching, and must be separated by a new line. An empty list implies that everything is included.

Excluded Regions

Each exclusion uses java regular expression pattern matching, and must be separated by a new line. An empty list excludes nothing.

#### Polling ignores commits with certain messages

[![Polling ignores commits with certain messages](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-polling-ignores-commits-with-certain-messages.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-polling-ignores-commits-with-certain-messages.png)

Excluded Messages

If set and Jenkins is set to poll for changes, Jenkins will ignore any revisions committed with message matched to the regular expression pattern when determining if a build needs to be triggered. This can be used to exclude commits done by the build itself from triggering another build, assuming the build server commits the change with a distinct message. You can create more complex patterns using embedded flag expressions.

#### Strategy for choosing what to build

[![Strategy for choosing what to build](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-strategy-for-choosing-what-to-build.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-strategy-for-choosing-what-to-build.png)

When you are interested in using a job to build multiple branches, you can choose how Jenkins chooses the branches to build and the order they should be built.

This extension point in Jenkins is used by many other plugins to control the job as it builds specific commits. When you activate those plugins, you may see them installing a custom build strategy.

Ancestry

Maximum Age of Commit

The maximum age of a commit (in days) for it to be built. This uses the GIT\_COMMITTER\_DATE, not GIT\_AUTHOR\_DATE

Commit in Ancestry

If an ancestor commit (SHA-1) is provided, only branches with this commit in their history will be built.

Default

Build all the branches that match the branch name pattern.

Inverse

Build all branches except for those which match the branch specifiers configure above. This is useful, for example, when you have jobs building your master and various release branches and you want a second job which builds all new feature branches. For example, branches which do not match these patterns without redundantly building master and the release branches again each time they change.

#### First build changelog

[![First build changelog](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-extension-for-first-build.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-extension-for-first-build.png)

The Jenkins git plugin provides an option to trigger a Pipeline build on the first commit on a branch. By default, no changelog is generated for the first build because the first build has no predecessor build for comparison. When the first build changelog option is enabled, the most recent commit will be used as the changelog of the first build.

```
checkout scmGit(
    branches: [[name: 'master']],
    extensions: [ firstBuildChangelog() ],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin.git']])
```

### Merge Extensions

The git plugin can optionally merge changes from other branches into the current branch of the agent workspace. Merge extensions control the source branch for the merge and the options applied to the merge.

#### Merge before build

[![Merge before build](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-merge-before-build.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-merge-before-build.png)

These options allow you to perform a merge to a particular branch before building. For example, you could specify an integration branch to be built, and to merge to master. In this scenario, on every change of integration, Jenkins will perform a merge with the master branch, and try to perform a build if the merge is successful. It then may push the merge back to the remote repository if the [Git Publisher post-build action](#plugin-content-publisher-push-merge-results) is selected.

Name of repository

Name of the repository, such as origin, that contains the branch. If left blank, it’ll default to the name of the first repository configured.

Branch to merge to

The name of the branch within the named repository to merge to, such as master.

Merge strategy

Merge strategy selection. Choices include:

* default
* resolve
* recursive
* octopus
* ours
* subtree
* recursive\_theirs

Fast-forward mode

* `--ff`: fast-forward which gracefully falls back to a merge commit when required
* `-ff-only`: fast-forward without any fallback
* `--no-ff`: merge commit always, even if a fast-forward would have been allowed

#### Custom user name/e-mail address

[![Custom user name/e-mail address](https://cdn.jsdelivr.net/gh/jenkinsci/git-plugin@master/images/git-custom-user-name-e-mail-address.png)](https://github.com/jenkinsci/git-plugin/blob/master/images/git-custom-user-name-e-mail-address.png)

user.name

Defines the user name value which git will assign to new commits made in the workspace. If given, the environment variables `GIT_COMMITTER_NAME` and `GIT_AUTHOR_NAME` are set for builds and override values from the global settings.

user.email

Defines the user email value which git will assign to new commits made in the workspace. If given, the environment variables `GIT_COMMITTER_EMAIL` and `GIT_AUTHOR_EMAIL` are set for builds and override values from the global settings.

### Deprecated Extensions

#### Custom SCM name - **Deprecated**

Unique name for this SCM. Was needed when using Git within the Multi SCM plugin. Pipeline is the robust and feature-rich way to checkout from multiple repositories in a single job.

#### Submodule Combinator - **Removed**

An experiment was created many years ago that attempted to create combinations of submodules within the Jenkins job. The experiment was never available to Freestyle projects or other legacy projects like multi-configuration projects. It was visible in Pipeline, configuration as code, and JobDSL.

The implementation of the experiment has been removed. Dependabot and other configuration tools are better suited to evaluate submodule combinations.

There are no known uses of the submodule combinator and no open Jira issues reported against the submodule combinator. Those who were using submodule combinator should remain with git plugin versions prior to 4.6.0.

The submodule combinator ignores any user provided value of the following arguments to git’s `checkout scm`:

doGenerateSubmoduleConfigurations

A boolean that is now always set to `false`. Submodule configurations are no longer evaluated by the git plugin.

submoduleCfg

A list of submodule names and branches that is now always empty. Submodule configurations are no longer evaluated by the git plugin.

Previous Pipeline syntax looked like this:

```
checkout([$class: 'GitSCM',
    branches: [[name: 'master']],
    doGenerateSubmoduleConfigurations: false,
    extensions: [],
    submoduleCfg: [],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin']]])
```

Current Pipeline Syntax looks like this:

```
checkout scmGit(
    branches: [[name: 'master']],
    userRemoteConfigs: [[url: 'https://github.com/jenkinsci/git-plugin']])
```

## Environment Variables

The git plugin assigns values to environment variables in several contexts. Environment variables are assigned in Freestyle, Pipeline, Multibranch Pipeline, and Organization Folder projects.

### Branch Variables

GIT\_BRANCH

Name of branch being built including remote name, as in `origin/master`

GIT\_LOCAL\_BRANCH

Name of branch being built without remote name, as in `master`

### Commit Variables

GIT\_COMMIT

SHA-1 of the commit used in this build

GIT\_PREVIOUS\_COMMIT

SHA-1 of the commit used in the preceding build of this project. If this is the first time a particular branch is being built, this variable is not set.

GIT\_PREVIOUS\_SUCCESSFUL\_COMMIT

SHA-1 of the commit used in the most recent successful build of this project. If this is the first time a particular branch is being built, this variable is not set.

### System Configuration Variables

GIT\_URL

Remote URL of the first git repository in this workspace

GIT\_URL\_n

Remote URL of the additional git repositories in this workspace (if any)

GIT\_AUTHOR\_EMAIL

Author e-mail address that will be used for **new commits in this workspace**

GIT\_AUTHOR\_NAME

Author name that will be used for **new commits in this workspace**

GIT\_COMMITTER\_EMAIL

Committer e-mail address that will be used for **new commits in this workspace**

GIT\_COMMITTER\_NAME

Committer name that will be used for **new commits in this workspace**

### Token Macro Variables

Some Jenkins plugins (like [email extension](https://plugins.jenkins.io/email-ext/), [build name setter](https://plugins.jenkins.io/build-name-setter/), and [description setter](https://plugins.jenkins.io/description-setter/)) allow parameterized references to reformat the text of supported variables. Variables that support parameterized references to reformat their text are called "token macros". The git plugin provides token macros for:

GIT\_REVISION

Expands to the Git SHA1 commit ID that points to the commit that was built.

length

integer length of the commit ID that should be displayed. `${GIT_REVISION}` might expand to `a806ba7701bcfc9f784ccb7854c26f03e045c1d2`, while `${GIT_REVISION,length=8}` would expand to `a806ba77`.

GIT\_BRANCH

Expands to the name of the branch that was built.

all

boolean that expands to all branch names that point to the current commit when enabled. By default, the token expands to just one of the branch names

fullName

boolean that expands to the full branch name, such as `remotes/origin/master` or `origin/master`. Otherwise, it expands to the short name, such as `master`.

The most common use of token macros is in Freestyle projects. Jenkins Pipeline supports a rich set of string operations so that token macros are not generally used in Pipelines.

When used with Pipeline, the token macro base values are generally assigned by the first checkout performed in a Pipeline. Subsequent checkout operations do not modify the values of the token macros in the Pipeline.

## Properties

Some git plugin settings can only be controlled from command line properties set at Jenkins startup.

### Default Timeout

The default git timeout value (in minutes) can be overridden by the `org.jenkinsci.plugins.gitclient.Git.timeOut` property (see [JENKINS-11286](https://issues.jenkins.io/browse/JENKINS-11286)). The property should be set on the controller and on all agents to have effect (see [JENKINS-22547](https://issues.jenkins.io/browse/JENKINS-22547)).

### Disable command line git

Command line git is the reference git implementation in the git plugin and the git client plugin. Command line git provides the most functionality and is the most stable implementation. Some installations may not want to install command line git and may want to disable the command line git implementation. Administrators may disable command line git with the property `org.jenkinsci.plugins.gitclient.Git.useCLI=false`.

### Allow local checkout

Command line git and JGit can fetch a repository using a local URL (like `file:/my/repo.git`) or a path (like `/my/repo.git`). [SECURITY-2478](https://www.jenkins.io/security/advisory/2022-05-17/#SECURITY-2478) notes that fetching from a local URL or a path creates a security vulnerability on the Jenkins controller. Current releases of the git plugin disallow fetch from a local URL and from a path. If a local URL or a path is required and administrators accept the risk of disabling this security safeguard, the Java property `hudson.plugins.git.GitSCM.ALLOW_LOCAL_CHECKOUT=true` can be set from the command line that starts the Jenkins controller.

### Cache root directory

Multibranch Pipelines that use the Git branch source will create cached git repositories on the Jenkins controller. By default, the cached git repositories are stored in the `caches` subdirectory of the Jenkins home directory (`JENKINS_HOME`).

Administrators may want to store those git repositories in another location for better performance or to exclude them from backups. For example, they might choose to place the cache directories in `/var/cache/jenkins`.

The default git cache directory location can be overridden by setting the property `jenkins.plugins.git.AbstractGitSCMSource.cacheRootDir=/var/cache/jenkins`.

## Git Publisher

The Jenkins git plugin provides a "git publisher" as a post-build action. The git publisher can push commits or tags from the workspace of a Freestyle project to the remote repository.

The git publisher is **only available** for Freestyle projects. It is **not available** for Pipeline, Multibranch Pipeline, Organization Folder, or any other job type other than Freestyle.

### Git Publisher Options

The git publisher behaviors are controlled by options that can be configured as part of the Jenkins job. Options include;

Push Only If Build Succeeds

Only push changes from the workspace to the remote repository if the build succeeds. If the build status is unstable, failed, or canceled, the changes from the workspace will not be pushed.

Merge Results

If pre-build merging is configured through one of the [merge extensions](#plugin-content-merge-extensions), then enabling this checkbox will push the merge to the remote repository.

Force Push

Git refuses to replace a remote commit with a different commit. This prevents accidental overwrite of new commits on the remote repository. However, there may be times when overwriting commits on the remote repository is acceptable and even desired. If the commits from the local workspace should overwrite commits on the remote repository, enable this option. It will request that the remote repository destroy history and replace it with history from the workspace.

#### Git publisher tags options

The git publisher can push tags from the workspace to the remote repository. Options in this section will allow the plugin to create a new tag. Options will also allow the plugin to update an existing tag, though the [git documentation](https://git-scm.com/docs/git-tag#_on_re_tagging) **strongly advises** against updating tags.

Tag to push

Name of the tag to be pushed from the local workspace to the remote repository. The name may include [Jenkins environment variables](https://jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables) or may be a fixed string. For example, the tag to push might be `$BUILD_TAG`, `my-tag-$BUILD_NUMBER`, `build-$BUILD_NUMBER-from-$NODE_NAME`, or `a-very-specific-string-that-will-be-used-once`.

Tag message

If the option is selected to create a tag or update a tag, then this message will be associated with the tag that is created. The message will expand references to [Jenkins environment variables](https://jenkins.io/doc/book/pipeline/jenkinsfile/#using-environment-variables). For example, the message `Build $BUILD_NUMBER tagged on $NODE_NAME` will use the message `Build 1 tagged on special-agent` if build 1 of the job runs on an agent named 'special-agent'.

Create new tag

Create a new tag in the workspace. The git publisher will fail the job if the tag already exists.

Update new tag

Modify existing tag in the workspace so that it points to the most recent commit. Many git repository hosting services will reject attempts to push a tag which has been modified to point to a different commit than its original commit. Refer to [force push](#plugin-content-publisher-tag-force-push) for an option which may force the remote repository to accept a modified tag. The [git documentation](https://git-scm.com/docs/git-tag#_on_re_tagging) **strongly advises against updating tags**.

Tag remote name

Git uses the 'remote name' as a short string replacement for the full URL of the remote repository. This option defines which remote should receive the push. This is typically `origin`, though it could be any one of the remote names defined when the plugin performs the checkout.

#### Git publisher branches options

The git publisher can push branches from the workspace to the remote repository. Options in this section will allow the plugin to push the contents of a local branch to the remote repository.

Branch to push

The name of the remote branch that will receive the latest commits from the agent workspace. This is usually the same branch that was used for the checkout

Target remote name

The short name of the remote that will receive the latest commits from the agent workspace. Usually this is `origin`. It needs to be a short name that is defined in the agent workspace, either through the initial checkout or through later configuration.

Rebase before push

Some Jenkins jobs may be blocked from pushing changes to the remote repository because the remote repository has received new commits since the start of the job. This may happen with projects that receive many commits or with projects that have long running jobs. The `Rebase before push` option fetches the most recent commits from the remote repository, applies local changes over the most recent commits, then pushes the result. The plugin uses `git rebase` to apply the local changes over the most recent remote changes.

Because `Rebase before push` is modifying the commits in the agent workspace **after the job has completed**, it is creating a configuration of commits that has **not been evaluated by any Jenkins job**. The commits in the local workspace have been evaluated by the job. The most recent commits from the remote repository have not been evaluated by the job. Users may find that the risk of pushing an untested configuration is less than the risk of delaying the visibility of the changes which have been evaluated by the job.

## Combining repositories

A single reference repository may contain commits from multiple repositories. For example, if a repository named `parent` includes references to submodules `child-1` and `child-2`, a reference repository could be created to cache commits from all three repositories using the commands:

```
$ mkdir multirepository-cache.git
$ cd  multirepository-cache.git
$ git init --bare
$ git remote add parent https://github.com/jenkinsci/git-plugin
$ git remote add child-1 https://github.com/jenkinsci/git-client-plugin
$ git remote add child-2 https://github.com/jenkinsci/platformlabeler-plugin
$ git fetch --all
```

Those commands create a single bare repository with the current commits from all three repositories. If that reference repository is used in the advanced clone options [clone reference repository](#plugin-content-clone-reference-repository-path), it will reduce data transfer and disc use for the parent repository. If that reference repository is used in the submodule options [clone reference repository](#plugin-content-submodule-reference-repository-path), it will reduce data transfer and disc use for the submodule repositories.

## Bug Reports

Report issues and enhancements in the [Jenkins issue tracker](https://www.jenkins.io/participate/report-issue/redirect/#15543).

## Contributing to the Plugin

Refer to [contributing to the plugin](https://github.com/jenkinsci/git-plugin/blob/master/CONTRIBUTING.adoc#contributing-to-the-git-plugin) for contribution guidelines.

## Remove Git Plugin BuildsByBranch BuildData Script

The git plugin has an issue ([JENKINS-19022](https://issues.jenkins.io/browse/JENKINS-19022)) that sometimes causes excessive memory use and disc use in the build history of a job. The problem occurs because in some cases the git plugin copies the git build data from previous builds to the most recent build, even though the git build data from the previous build is not used in the most recent build. The issue can be especially challenging when a job retains a very large number of historical builds or when a job builds a wide range of commits during its history.

Multiple attempts to resolve the core issue without breaking compatibility have been unsuccessful. A workaround is provided below that will remove the git build data from the build records. The workaround is a system groovy script that needs to be run from the Jenkins Administrator’s Script Console (as in <https://jenkins.example.com/script> ). Administrator permission is required to run system groovy scripts.

This script removes the static list of BuildsByBranch that is stored for each build by the Git Plugin.

```
import hudson.matrix.*
import hudson.model.*

hudsonInstance = hudson.model.Hudson.instance
jobNames = hudsonInstance.getJobNames()
allItems = []
for (name in jobNames) {
  allItems += hudsonInstance.getItemByFullName(name)
}

// Iterate over all jobs and find the ones that have a hudson.plugins.git.util.BuildData
// as an action.
//
// We then clean it by removing the useless array action.buildsByBranchName
//

for (job in allItems) {
  println("job: " + job.name);
  def counter = 0;
  for (build in job.getBuilds()) {
    // It is possible for a build to have multiple BuildData actions
    // since we can use the Multiple SCM plugin.
    def gitActions = build.getActions(hudson.plugins.git.util.BuildData.class)
    if (gitActions != null) {
      for (action in gitActions) {
        action.buildsByBranchName = new HashMap<String, Build>();
        hudson.plugins.git.Revision r = action.getLastBuiltRevision();
        if (r != null) {
          for (branch in r.getBranches()) {
            action.buildsByBranchName.put(branch.getName(), action.lastBuild)
          }
        }
        build.actions.remove(action)
        build.actions.add(action)
        build.save();
        counter++;
      }
    }
    if (job instanceof MatrixProject) {
      def runcounter = 0;
      for (run in build.getRuns()) {
        gitActions = run.getActions(hudson.plugins.git.util.BuildData.class)
        if (gitActions != null) {
          for (action in gitActions) {
            action.buildsByBranchName = new HashMap<String, Build>();
            hudson.plugins.git.Revision r = action.getLastBuiltRevision();
            if (r != null) {
              for (branch in r.getBranches()) {
                action.buildsByBranchName.put(branch.getName(), action.lastBuild)
              }
            }
            run.actions.remove(action)
            run.actions.add(action)
            run.save();
            runcounter++;
          }
        }
      }
      if (runcounter > 0) {
        println(" -->> cleaned: " + runcounter + " runs");
      }
    }
  }
  if (counter > 0) {
    println("-- cleaned: " + counter + " builds");
  }
}
```

##### Version: 5.7.0

Released: 3 weeks agoRequires Jenkins 2.479.1ID: git
##### Installed on 95.4% of controllers

[View detailed version information](https://old.stats.jenkins.io/pluginversions/git.html)
##### Links

[GitHub](https://github.com/jenkinsci/git-plugin)[Open issues (Jira)](https://issues.jenkins.io/issues/?jql=resolution%20is%20EMPTY%20and%20component%3D15543)[Report an issue (Jira)](https://www.jenkins.io/participate/report-issue/redirect/#15543/git)[Pipeline Step Reference](https://www.jenkins.io/doc/pipeline/steps/git)[Extension Points](https://www.jenkins.io/doc/developer/extensions/git)[Javadoc](https://javadoc.jenkins.io/plugin/git)
##### Labels

[git](/ui/search/?labels=git)[Source Code Management](/ui/search/?labels=scm)
##### Maintainers

[Mark Waite](/ui/search/?query=markewaite)[Olivier Lamy](/ui/search/?query=olamy)[rsandell](/ui/search/?query=rsandell)
##### Help us improve this page!

To propose a change submit a pull request to [the plugin page](https://github.com/jenkinsci/git-plugin) on GitHub.
##### Previous Security Warnings

* ###### [CSRF vulnerability in Git plugin allows capturing credentials](https://jenkins.io/security/advisory/2017-07-10/)

  + Affects version 3.3.1 and earlier
  + Affects version 3.4.0-beta-1 and earlier
* ###### [Users without Overall/Read are able to access lists of user names and node names](https://jenkins.io/security/advisory/2018-02-26/#SECURITY-723)

  + Affects version 3.7.0 and earlier
* ###### [Server-side request forgery](https://jenkins.io/security/advisory/2018-06-04/#SECURITY-810)

  + Affects version 3.9.0 and earlier
  + Affects version 4.0.0-beta1 and earlier
* ###### [CSRF vulnerability](https://jenkins.io/security/advisory/2019-01-28/#SECURITY-1095)

  + Affects version 3.9.1 and earlier
* ###### [Stored XSS vulnerability](https://jenkins.io/security/advisory/2020-03-09/#SECURITY-1723)

  + Affects version 4.2.0 and earlier
* ###### [Stored XSS vulnerability](https://www.jenkins.io/security/advisory/2021-10-06/#SECURITY-2499)

  + Affects version 4.8.2 and earlier
* ###### [Multiple SCM plugins can check out from the controller file system](https://www.jenkins.io/security/advisory/2022-05-17/#SECURITY-2478)

  + Affects version 4.11.1 and earlier
* ###### [Lack of authentication mechanism in webhook](https://www.jenkins.io/security/advisory/2022-07-27/#SECURITY-284)

  + Affects version 4.11.3 and earlier
* ###### [Improper masking of credentials](https://www.jenkins.io/security/advisory/2022-08-23/#SECURITY-2796)

  + Affects version 4.11.4 and earlier
![tracker](https://jenkins-matomo.do.g4v.dev/piwik.php?idsite=1&rec=1&url=https://plugins.jenkins.io//git/)



=== Content from jenkins.io_f5a2f478_20250125_195638.html ===


[Jenkins Security Home](/security/)

**For Administrators**

* [Overview](/security/for-administrators/)
* [Security Advisories](/security/advisories/)
* [Security Issues](/security/issues/)
* [Advisory Schedule](/security/scheduling/)
* [Vulnerabilities in Plugins](/security/plugins/)
* [How We Fix Security Issues](/security/fixing/)

**For Reporters**

* [Reporting Vulnerabilities](/security/reporting/)
* [Jenkins CNA](/security/cna/)

**For Maintainers**

* [Overview](/security/for-maintainers/)
* [Vulnerabilities in Plugins](/security/plugins/)

**Jenkins Security Team**

* [About](/security/team/)
* [Contributions](/security/improvements/)

# Jenkins Security Advisory 2018-06-04

This advisory announces vulnerabilities in the following Jenkins deliverables:

* [AbsInt AstrÃ©e
  Plugin](https://plugins.jenkins.io/absint-astree)
* [Black Duck Detect
  Plugin](https://plugins.jenkins.io/blackduck-detect)
* Black Duck Hub
  Plugin
* [CAS
  Plugin](https://plugins.jenkins.io/cas-plugin)
* [Git
  Plugin](https://plugins.jenkins.io/git)
* [GitHub
  Plugin](https://plugins.jenkins.io/github)
* [GitHub Branch Source
  Plugin](https://plugins.jenkins.io/github-branch-source)
* [GitHub Pull Request Builder
  Plugin](https://plugins.jenkins.io/ghprb)
* [Kubernetes
  Plugin](https://plugins.jenkins.io/kubernetes)

## Descriptions

### Server-side request forgery vulnerability in Git Plugin

**SECURITY-810
/
CVE-2018-1000182**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

**Affected plugin:
[`git`](https://plugins.jenkins.io/git)**

**Description:**

Various form validation methods in Git Plugin did not check the permission of the user accessing them, allowing anyone with Overall/Read access to Jenkins to cause Jenkins to send a GET request to a specified URL.

Additionally, these form validation methods did not require POST requests, resulting in a CSRF vulnerability.

These form validation methods now require POST requests and the Overall/Administer permission.

### Server-side request forgery vulnerability in GitHub Plugin

**SECURITY-799
/
CVE-2018-1000184**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

**Affected plugin:
[`github`](https://plugins.jenkins.io/github)**

**Description:**

A form validation method in GitHub Plugin did not check the permission of the user accessing it, allowing anyone with Overall/Read access to Jenkins to cause Jenkins to send a POST request to a specified URL.

If that request’s HTTP response code indicates success, the form validation is returning a generic success message, otherwise the HTTP status code is returned.

Additionally, this form validation method did not require POST requests, resulting in a CSRF vulnerability.

The form validation method now requires POST requests and the Overall/Administer permission.

### CSRF vulnerability and missing permission checks in GitHub Plugin allowed capturing credentials

**SECURITY-804
/
CVE-2018-1000183**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:N)

**Affected plugin:
[`github`](https://plugins.jenkins.io/github)**

**Description:**

GitHub Plugin did not perform permission checks on a method implementing form validation.
This allowed users with Overall/Read access to Jenkins to connect to an attacker-specified URL using attacker-specified credentials IDs obtained through another method, capturing credentials stored in Jenkins.

Additionally, this form validation method did not require POST requests, resulting in a CSRF vulnerability.

This form validation method now requires POST requests and appropriate user permissions.

### Server-side request forgery vulnerability in GitHub Branch Source Plugin

**SECURITY-806
/
CVE-2018-1000185**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:L/A:N)

**Affected plugin:
[`github-branch-source`](https://plugins.jenkins.io/github-branch-source)**

**Description:**

A form validation method in GitHub Branch Source Plugin did not check the permission of the user accessing them, allowing anyone with Overall/Read access to Jenkins to cause Jenkins to send a GET request to a specified URL.

Additionally, this form validation method did not require POST requests, resulting in a CSRF vulnerability.

This form validation method now requires POST requests and the Overall/Administer permission.

### CSRF vulnerability and missing permission checks in GitHub Pull Request Builder Plugin allowed server-side request forgery, capturing credentials

**SECURITY-805
/
CVE-2018-1000186**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:N)

**Affected plugin:
[`ghprb`](https://plugins.jenkins.io/ghprb)**

**Description:**

GitHub Pull Request Builder Plugin did not perform permission checks on methods implementing form validation.
This allowed users with Overall/Read access to Jenkins to connect to an attacker-specified URL using attacker-specified credentials IDs obtained through another method, capturing credentials stored in Jenkins, and to cause Jenkins to submit HTTP requests to attacker-specified URLs.

Additionally, these form validation methods did not require POST requests, resulting in a CSRF vulnerability.

These form validation methods now require POST requests and Overall/Administer permissions.

### Kubernetes Plugin printed sensitive build variables to logs

**SECURITY-883
/
CVE-2018-1000187**

**Severity (CVSS):**
[low](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N)

**Affected plugin:
[`kubernetes`](https://plugins.jenkins.io/kubernetes)**

**Description:**

Kubernetes Plugin printed sensitive build variables, like passwords, to the build log and controller log, when using pipeline steps like `withDockerRegistry`.

The plugin now applies masking of sensitive build variables to these pipeline steps.

### Server-side request forgery vulnerability in CAS Plugin

**SECURITY-809
/
CVE-2018-1000188**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)

**Affected plugin:
[`cas-plugin`](https://plugins.jenkins.io/cas-plugin)**

**Description:**

A form validation method in GitHub Branch Source Plugin did not check the permission of the user accessing them, allowing anyone with Overall/Read access to Jenkins to cause Jenkins to send a GET request to a specified URL.

Additionally, this form validation method did not require POST requests, resulting in a CSRF vulnerability.

This form validation method now requires POST requests and the Overall/Administer permission.

### CSRF vulnerability and missing permission checks in AbsInt AstrÃ©e Plugin allowed launching programs on the Jenkins controller

**SECURITY-807
/
CVE-2018-1000189**

**Severity (CVSS):**
[high](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**Affected plugin:
[`absint-astree`](https://plugins.jenkins.io/absint-astree)**

**Description:**

AbsInt AstrÃ©e Plugin did not perform permission checks on a method implementing form validation.
This allowed users with Overall/Read access to Jenkins to run a user-specified program on the Jenkins controller.

Additionally, this form validation method did not require POST requests, resulting in a CSRF vulnerability.

This form validation method no longer implements the validation that required a program to be invoked.

### CSRF vulnerability and missing permission checks in Black Duck Hub Plugin allowed server-side request forgery, capturing credentials

**SECURITY-865
/
CVE-2018-1000190**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)

**Affected plugin:
[`blackduck-hub`](https://plugins.jenkins.io/blackduck-hub)**

**Description:**

Black Duck Hub Plugin did not perform permission checks on methods implementing form validation.
This allowed users with Overall/Read access to Jenkins to connect to an attacker-specified URL using attacker-specified credentials IDs obtained through another method, capturing credentials stored in Jenkins, and to cause Jenkins to submit HTTP requests to attacker-specified URLs.

Additionally, these form validation methods did not require POST requests, resulting in a CSRF vulnerability.

These form validation methods now require POST requests and Overall/Administer permissions.

### CSRF vulnerability and missing permission checks in Black Duck Detect Plugin allowed server-side request forgery, capturing credentials

**SECURITY-866
/
CVE-2018-1000191**

**Severity (CVSS):**
[medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)

**Affected plugin:
[`blackduck-detect`](https://plugins.jenkins.io/blackduck-detect)**

**Description:**

Black Duck Detect Plugin did not perform permission checks on methods implementing form validation.
This allowed users with Overall/Read access to Jenkins to connect to an attacker-specified URL using attacker-specified credentials IDs obtained through another method, capturing credentials stored in Jenkins, and to cause Jenkins to submit HTTP requests to attacker-specified URLs.

Additionally, these form validation methods did not require POST requests, resulting in a CSRF vulnerability.

These form validation methods now require POST requests and Overall/Administer permissions.

## Severity

* SECURITY-799:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)
* SECURITY-804:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:N)
* SECURITY-805:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:N)
* SECURITY-806:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:L/A:N)
* SECURITY-807:
  [high](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)
* SECURITY-809:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)
* SECURITY-810:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)
* SECURITY-865:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)
* SECURITY-866:
  [medium](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N)
* SECURITY-883:
  [low](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:N/A:N)

## Affected Versions

* **AbsInt AstrÃ©e
  Plugin**
  up to and including
  1.0.5
* **Black Duck Detect
  Plugin**
  up to and including
  1.4.0
* **Black Duck Hub
  Plugin**
  up to and including
  4.0.0
* **CAS
  Plugin**
  up to and including
  1.4.1
* **Git
  Plugin**
  up to and including
  3.9.0
* **GitHub
  Plugin**
  up to and including
  1.29.0
* **GitHub Branch Source
  Plugin**
  up to and including
  2.3.4
* **GitHub Pull Request Builder
  Plugin**
  up to and including
  1.41.0
* **Kubernetes
  Plugin**
  up to and including
  1.7.0

## Fix

* **AbsInt AstrÃ©e
  Plugin**
  should be updated to version
  1.0.7
* **Black Duck Detect
  Plugin**
  should be updated to version
  1.4.1
* **Black Duck Hub
  Plugin**
  should be updated to version
  4.0.1
* **CAS
  Plugin**
  should be updated to version
  1.4.2
* **Git
  Plugin**
  should be updated to version
  3.9.1
* **GitHub
  Plugin**
  should be updated to version
  1.29.1
* **GitHub Branch Source
  Plugin**
  should be updated to version
  2.3.5
* **GitHub Pull Request Builder
  Plugin**
  should be updated to version
  1.42.0
* **Kubernetes
  Plugin**
  should be updated to version
  1.7.1

These versions include fixes to the vulnerabilities described above. All prior versions are considered to be affected by these vulnerabilities unless otherwise indicated.

## Credit

The Jenkins project would like to thank the reporters for discovering and
[reporting](/security/#reporting-vulnerabilities)
these vulnerabilities:

* **Jesse Glick, CloudBees, Inc.**
  for
  SECURITY-883
* **Thomas de Grenier de Latour**
  for
  SECURITY-799, SECURITY-804, SECURITY-805, SECURITY-806, SECURITY-807, SECURITY-809, SECURITY-810, SECURITY-865, SECURITY-866



=== Content from plugins.jenkins.io_2a565a14_20250126_113410.html ===

# Kubernetes

How to install

* [Documentation](/kubernetes/)
* [Releases](/kubernetes/releases/)
* [Issues](/kubernetes/issues/)
* [Dependencies](/kubernetes/dependencies/)
* [Health Score](/kubernetes/healthscore/)

# Kubernetes plugin for Jenkins

[![kubernetes version](https://camo.githubusercontent.com/85afa1b2842e394198054fa2e6048ba5a807ac67adbffd41eabaeef661706e97/68747470733a2f2f696d672e736869656c64732e696f2f6a656e6b696e732f706c7567696e2f762f6b756265726e657465732e7376673f6c6162656c3d6b756265726e65746573)](https://plugins.jenkins.io/kubernetes) [![kubernetes installs](https://camo.githubusercontent.com/09cea8bd749d1a13e8474fb385cf209eb852a9d98cd30460a6af4a4c75a6d8dd/68747470733a2f2f696d672e736869656c64732e696f2f6a656e6b696e732f706c7567696e2f692f6b756265726e657465732e737667)](https://plugins.jenkins.io/kubernetes) [![kubernetes license](https://camo.githubusercontent.com/096973f2dcd020a8be4ef00701e1b05974ce5a4fa9617b10ff94c3fbfb03c091/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f6a656e6b696e7363692f6b756265726e657465732d706c7567696e)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/LICENSE) [![Language grade: Java](https://camo.githubusercontent.com/11df75f1e3d7f5fa1ea57bb82c1020a003587646504d068c3f05231b16ec2dc9/68747470733a2f2f696d672e736869656c64732e696f2f6c67746d2f67726164652f6a6176612f672f6a656e6b696e7363692f6b756265726e657465732d706c7567696e2e7376673f6c6f676f3d6c67746d266c6f676f57696474683d3138)](https://lgtm.com/projects/g/jenkinsci/kubernetes-plugin/context%3Ajava)

Jenkins plugin to run dynamic agents in a Kubernetes cluster.

Based on the [Scaling Docker with Kubernetes](http://www.infoq.com/articles/scaling-docker-with-kubernetes) article, automates the scaling of Jenkins agents running in Kubernetes.

The plugin creates a Kubernetes Pod for each agent started, and stops it after each build.

Agents are launched as inbound agents, so it is expected that the container connects automatically to the Jenkins controller. For that some environment variables are automatically injected:

* `JENKINS_URL` : Jenkins web interface url
* `JENKINS_SECRET` : the secret key for authentication
* `JENKINS_AGENT_NAME` : the name of the Jenkins agent
* `JENKINS_NAME` : the name of the Jenkins agent (Deprecated. Only here for backwards compatibility)

Tested with [`jenkins/inbound-agent`](https://hub.docker.com/r/jenkins/inbound-agent), see the [Docker image source code](https://github.com/jenkinsci/docker-agent).

It is not required to run the Jenkins controller inside Kubernetes.

# 📜 Table of Contents

* [Generic setup](#plugin-content-generic-setup)
* [Usage](#plugin-content-usage)
* [Configuration reference](#plugin-content-configuration-reference)
* [Inheritance](#plugin-content-inheritance)
* [Declarative Pipeline](#plugin-content-declarative-pipeline)
* [Misc.](#plugin-content-misc.)
* [Running on OpenShift](#plugin-content-running-on-openshift)
* [Features controlled using system properties](#plugin-content-features-controlled-using-system-properties)
* [Windows support](#plugin-content-windows-support)
* [Constraints](#plugin-content-constraints)
* [Configuration on minikube](#plugin-content-configuration-on-minikube)
* [Configuration on Google Container Engine](#plugin-content-configuration-on-google-container-engine)
* [Troubleshooting 🔨](#plugin-content-troubleshooting)
* [Building and Testing](#plugin-content-building-and-testing)
* [Docker image](#plugin-content-docker-image)
* [Running in Kubernetes](#plugin-content-running-in-kubernetes)
* [Related Projects](#plugin-content-related-projects)

# Generic Setup

## Prerequisites

* A running Kubernetes cluster 1.14 or later. For OpenShift users, this means OpenShift Container Platform 4.x.
* A Jenkins instance installed
* The Jenkins Kubernetes plugin installed
* A ServiceAccount with sufficient privileges ([example](https://github.com/jenkinsci/kubernetes-plugin/blob/master/src/main/kubernetes/service-account.yml))

## Configuration

Fill in the Kubernetes plugin configuration. In order to do that, you will open the Jenkins UI and navigate to **Manage Jenkins -> Manage Nodes and Clouds -> Configure Clouds -> Add a new cloud -> Kubernetes** and enter the *Kubernetes URL* and *Jenkins URL* appropriately, unless Jenkins is running in Kubernetes in which case the defaults work.

Supported credentials include:

* Username/password
* Secret File (kubeconfig file)
* Secret text (Token-based authentication) (OpenShift)
* Google Service Account from private key (GKE authentication)
* X.509 Client Certificate

If you check **WebSocket** then agents will connect over HTTP(S) rather than the Jenkins service TCP port. This is unnecessary when the Jenkins controller runs in the same Kubernetes cluster, but can greatly simplify setup when agents are in an external cluster and the Jenkins controller is not directly accessible (for example, it is behind a reverse proxy or a ingress resource). See [JEP-222](https://jenkins.io/jep/222) for more.

To test this connection is successful you can use the **Test Connection** button to ensure there is adequate communication from Jenkins to the Kubernetes cluster, as seen below

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/cloud-configuration.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/cloud-configuration.png)

### Garbage collection (beta)

In some exceptional cases, agent pods can be left behind, with no declared Jenkins agent in the controller. They will try to reconnect over and over, until something deletes them.

The plugin provides a garbage collection mechanism to clean up these pods. As it has been introduced recently, and generates extra load on the Kubernetes API server, it is disabled by default.

Feel free to enable it and provide feedback about this functionality.

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/garbage-collection.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/garbage-collection.png)

## Static pod templates

In addition to that, in the **Kubernetes Pod Template** section, we need to configure the image that will be used to spin up the agent pod. The Jenkins agent runs by default in a container named `jnlp` (historical name, kept for backward compatibility).

You may use it, use a different agent container name and/or provide your own container image.

To avoid drift between the Jenkins controller and your agent, we recommend *not* to include the agent JAR in your image, but instead use the *Inject Jenkins agent in agent container* checkbox.

The provided container image must have a JRE installed that is compatible with the Java version required by the Jenkins controller.

In the ‘Kubernetes Pod Template’ section you need to specify the following (the rest of the configuration is up to you): Kubernetes Pod Template Name - can be any and will be shown as a prefix for unique generated agent’ names, which will be run automatically during builds Docker image - the docker image name that will be used as a reference to spin up a new Jenkins agent, as seen below

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/pod-template-configuration.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/pod-template-configuration.png)

> **Note:** If your Jenkins controller is outside the cluster and uses a self-signed HTTPS certificate, you will need some [additional configuration](#plugin-content-using-websockets-with-a-jenkins-master-with-self-signed-https-certificate).

### Restricting what jobs can use your configured cloud

Clouds can be configured to only allow certain jobs to use them.

To enable this, in your cloud's advanced configuration check the `Restrict pipeline support to authorized folders` box. For a job to then use this cloud configuration you will need to add it in the jobs folder's configuration.

# Usage

## Overview

The Kubernetes plugin allocates Jenkins agents in Kubernetes pods.

Within these pods, there is always one special container that is running the Jenkins agent.

Its name defaults to `jnlp`, but you can override the name with one of your choosing in pod template configuration.

Other containers can run arbitrary processes of your choosing, and it is possible to run commands dynamically in any container in the agent pod using the `container` step (pipeline only).

## Using a label

Pod templates defined using the user interface declare a label. When a freestyle job or a pipeline job using `node('some-label')` uses a label declared by a pod template, the Kubernetes Cloud allocates a new pod to run the Jenkins agent.

It should be noted that the main reason to use the global pod template definition is to migrate a huge corpus of existing projects (including freestyle) to run on Kubernetes without changing job definitions. New users setting up new Kubernetes builds should use the `podTemplate` step as shown in the example snippets [here](https://github.com/jenkinsci/kubernetes-plugin/blob/master/examples).

## Using the pipeline step

The `podTemplate` step defines an ephemeral pod template. It is created while the pipeline execution is within the `podTemplate` block. It is immediately deleted afterwards. Such pod templates are not intended to be shared with other builds or projects in the Jenkins instance.

The following idiom creates a pod template with a generated unique label (available as `POD_LABEL`) and runs commands inside it.

```
podTemplate {
    node(POD_LABEL) {
        // pipeline steps...
    }
}
```

Commands will be executed by default in the designated agent container, where the Jenkins agent is running.

This will run in the agent container:

```
podTemplate {
    node(POD_LABEL) {
        stage('Run shell') {
            sh 'echo hello world'
        }
    }
}
```

Find more examples in the [examples dir](https://github.com/jenkinsci/kubernetes-plugin/blob/master/examples).

The default agent image used can be customized by adding it to the template

```
containerTemplate(name: 'jnlp', image: 'jenkins/inbound-agent', args: '${computer.jnlpmac} ${computer.name}'),
```

or with the yaml syntax. Pretty much any field from the [pod model](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/) can be specified through the yaml syntax.

```
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: jnlp
    image: 'jenkins/inbound-agent'
    args: ['\$(JENKINS_SECRET)', '\$(JENKINS_NAME)']
```

### Multiple containers support

Multiple containers can be defined for the agent pod, with shared resources, like mounts. Ports in each container can be accessed as in any Kubernetes pod, by using `localhost`.

One container must run the Jenkins agent. If unspecified, a container named `jnlp` will be created with the inbound-agent image. The Jenkins agent requires a JRE to run, so you can avoid the extra container by providing a name using the `agentContainer`. To get the Jenkins agent injected, you will also need to set `agentInjection` to `true`, and leave the command and argument fields empty for this container. The container specified by `agentContainer` will be the one where shell steps (or any other step running remote commands on the agent) will run on.

To execute commands in another container part of the pod (different from the one running the Jenkins agent), you can use the `container` step.

## **Note**

## Due to implementation constraints, there can be issues when executing commands in different containers if they run using different uids. It is recommended to use the same uid across the different containers part of the same pod to avoid any issue.

```
podTemplate(
  agentContainer: 'maven',
  agentInjection: true,
  containers: [
    containerTemplate(name: 'maven', image: 'maven:3.9.9-eclipse-temurin-17'),
    containerTemplate(name: 'golang', image: 'golang:1.16.5', command: 'sleep', args: '99d')
  ]) {

    node(POD_LABEL) {
        stage('Get a Maven project') {
            git 'https://github.com/jenkinsci/kubernetes-plugin.git'
            container('maven') {
                stage('Build a Maven project') {
                    sh 'mvn -B -ntp clean install'
                }
            }
        }

        stage('Get a Golang project') {
            git url: 'https://github.com/hashicorp/terraform.git', branch: 'main'
            container('golang') {
                stage('Build a Go project') {
                    sh '''
                    mkdir -p /go/src/github.com/hashicorp
                    ln -s `pwd` /go/src/github.com/hashicorp/terraform
                    cd /go/src/github.com/hashicorp/terraform && make
                    '''
                }
            }
        }

    }
}
```

or

```
podTemplate(
  agentContainer: 'maven',
  agentInjection: true,
  yaml: '''
    apiVersion: v1
    kind: Pod
    spec:
      containers:
      - name: maven
        image: maven:3.9.9-eclipse-temurin-17
      - name: golang
        image: golang:1.16.5
        command:
        - sleep
        args:
        - 99d
''') {
  node(POD_LABEL) {
    stage('Get a Maven project') {
      git 'https://github.com/jenkinsci/kubernetes-plugin.git'
      container('maven') {
        stage('Build a Maven project') {
          sh 'mvn -B -ntp clean install'
        }
      }
    }

    stage('Get a Golang project') {
      git url: 'https://github.com/hashicorp/terraform-provider-google.git', branch: 'main'
      container('golang') {
        stage('Build a Go project') {
          sh '''
            mkdir -p /go/src/github.com/hashicorp
            ln -s `pwd` /go/src/github.com/hashicorp/terraform
            cd /go/src/github.com/hashicorp/terraform && make
          '''
        }
      }
    }
  }
}
```

#### `POD_CONTAINER` variable

The variable `POD_CONTAINER` contains the name of the container in the current context. It is defined only within a `container` block.

```
podTemplate(containers: […]) {
  node(POD_LABEL) {
    stage('Run shell') {
      container('mycontainer') {
        sh "echo hello from $POD_CONTAINER" // displays 'hello from mycontainer'
      }
    }
  }
}
```

### Retrying after infrastructure outages

You can use the `retry` step to automatically try the whole build stage again with a fresh pod in case of fatal infrastructure problems. (For example: cluster backup & restore; node pool used for agents drained and upgraded.)

```
podTemplate(…) {
  retry(count: 2, conditions: [kubernetesAgent(), nonresumable()]) {
    node(POD_LABEL) {
      sh 'your-build-process'
    }
  }
}
```

will rerun the whole `node` block (using the same pod definition) in case the first attempt fails for a qualifying reason traceable to loss of the pod (*not* routine problems such as compilation errors or `OutOfMemoryError`).

For Declarative Pipeline, just add the `retries` option, as shown below.

# Configuration reference

## Pod template

Pod templates are used to create agents. They can be either configured via the user interface, or in a pipeline, using the `podTemplate` step. Either way it provides access to the following fields:

* **cloud** The name of the cloud as defined in Jenkins settings. Defaults to `kubernetes`
* **name** The name of the pod. This is only used for inheritance.
* **namespace** The namespace of the pod.
* **label** The node label. This is how the pod template can be referred to when asking for an agent through the `node` step. In a pipeline, it is recommended to omit this field and rely on the generated label that can be referred to using the `POD_LABEL` variable defined within the `podTemplate` block.
* **yaml** [yaml representation of the Pod](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/), to allow setting any values not supported as fields
* **yamlMergeStrategy** `merge()` or `override()`. Controls whether the yaml definition overrides or is merged with the yaml definition inherited from pod templates declared with `inheritFrom`. Defaults to `override()` (for backward compatibility reasons).
* **containers** The container templates part of the pod *(see below for details)*.
* **serviceAccount** The service account of the pod.
* **nodeSelector** The node selector of the pod.
* **nodeUsageMode** Either `NORMAL` or `EXCLUSIVE`, this controls whether Jenkins only schedules jobs with label expressions matching or use the node as much as possible.
* **volumes** Volumes that are defined for the pod and are mounted by **ALL** containers.
  + `configMapVolume` : a read only volume that is mounted from a ConfigMap.
  + `dynamicPVC()` : a persistent volume claim managed dynamically. It is deleted at the same time as the pod.
  + `emptyDirVolume` (default): an empty dir allocated on the host machine
  + `hostPathVolume()` : a host path volume
  + `nfsVolume()` : a nfs volume
  + `persistentVolumeClaim()` : an existing persistent volume claim by name.
  + `secretVolume` : a read only volume that is mounted from a Kubernetes secret.
* **envVars** Environment variables that are applied to **ALL** containers.
  + **envVar** An environment variable whose value is defined inline.
  + **secretEnvVar** An environment variable whose value is derived from a Kubernetes secret.
* **imagePullSecrets** List of pull secret names, to [pull images from a private Docker registry](https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/).
* **annotations** Annotations to apply to the pod.
* **inheritFrom** List of one or more pod templates to inherit from *(more details below)*.
* **slaveConnectTimeout** Timeout in seconds for an agent to be online *(more details below)*.
* **podRetention** Controls the behavior of keeping agent pods. Can be 'never()', 'onFailure()', 'always()', or 'default()' - if empty will default to deleting the pod after `activeDeadlineSeconds` has passed.
* **activeDeadlineSeconds** If `podRetention` is set to `never()` or `onFailure()`, the pod is deleted after this deadline is passed.
* **idleMinutes** Allows the pod to remain active for reuse until the configured number of minutes has passed since the last step was executed on it.
* **showRawYaml** Enable or disable the output of the raw pod manifest. Defaults to `true`
* **runAsUser** The user ID to run all containers in the pod as.
* **runAsGroup** The group ID to run all containers in the pod as.
* **hostNetwork** Use the hosts network.
* **workspaceVolume** The type of volume to use for the workspace.
  + `dynamicPVC()` : a persistent volume claim managed dynamically. It is deleted at the same time as the pod.
  + `emptyDirWorkspaceVolume` (default): an empty dir allocated on the host machine
  + `hostPathWorkspaceVolume()` : a host path volume
  + `nfsWorkspaceVolume()` : a nfs volume
  + `persistentVolumeClaimWorkspaceVolume()` : an existing persistent volume claim by name.

## Container template

Container templates are part of pod. They can be configured via the user interface or in a pipeline and allow you to set the following fields:

* **name** The name of the container.
* **image** The image of the container.
* **envVars** Environment variables that are applied to the container **(supplementing and overriding env vars that are set on pod level)**.
  + **envVar** An environment variable whose value is defined inline.
  + **secretEnvVar** An environment variable whose value is derived from a Kubernetes secret.
* **command** The command the container will execute. Will overwrite the Docker entrypoint. A typical value is `sleep`.
* **args** The arguments passed to the command. A typical value is `99999999`.
* **ttyEnabled** Flag to mark that tty should be enabled.
* **livenessProbe** Parameters to be added to a exec liveness probe in the container (does not support httpGet liveness probes)
* **ports** Expose ports on the container.
* **alwaysPullImage** The container will pull the image upon starting.
* **runAsUser** The user ID to run the container as.
* **runAsGroup** The group ID to run the container as.

#### Specifying a different default agent connection timeout

By default, the agent connection timeout is set to 1000 seconds. It can be customized using a system property. Please refer to the section below.

#### Using yaml to define Pod Templates

In order to support any possible value in Kubernetes `Pod` object, we can pass a yaml snippet that will be used as a base for the template. If any other properties are set outside the YAML, they will take precedence.

```
podTemplate(yaml: '''
    apiVersion: v1
    kind: Pod
    metadata:
      labels:
        some-label: some-label-value
    spec:
      containers:
      - name: busybox
        image: busybox
        command:
        - sleep
        args:
        - 99d
    ''') {
    node(POD_LABEL) {
      container('busybox') {
        echo POD_CONTAINER // displays 'busybox'
        sh 'hostname'
      }
    }
}
```

You can use [`readFile`](https://www.jenkins.io/doc/pipeline/steps/workflow-basic-steps/#readfile-read-file-from-workspace) or [`readTrusted`](https://jenkins.io/doc/pipeline/steps/coding-webhook/#readtrusted-read-trusted-file-from-scm) steps to load the yaml from a file. Also note that in declarative pipelines the `yamlFile` can be used (see this [example](https://github.com/jenkinsci/kubernetes-plugin/blob/master/examples/declarative_from_yaml_file)).

##### Example

`pod.yaml`

```
apiVersion: v1
kind: Pod
spec:
  containers:
  - name: maven
    image: maven:3.9.9-eclipse-temurin-17
    command:
    - sleep
    args:
    - 99d
  - name: golang
    image: golang:1.16.5
    command:
    - sleep
    args:
    - 99d
```

`Jenkinsfile`

```
podTemplate(yaml: readTrusted('pod.yaml')) {
  node(POD_LABEL) {
    // ...
  }
}
```

### Liveness Probe Usage

```
containerTemplate(name: 'busybox', image: 'busybox', command: 'sleep', args: '99d',
                  livenessProbe: containerLivenessProbe(execArgs: 'some --command', initialDelaySeconds: 30, timeoutSeconds: 1, failureThreshold: 3, periodSeconds: 10, successThreshold: 1)
)
```

See [Defining a liveness command](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/#defining-a-liveness-command) for more details.

# Inheritance

## Overview

A pod template may or may not inherit from an existing template.

Depending on fields, the inheritance behaviour can vary. For simple values (strings), the child template will override the parent template. However for complex values (lists, maps), the child template will merge with the parent template.

* **yaml** is merged according to the value of `yamlMergeStrategy` specified in the child pod template.
* **Service account** and **Node selector** when are overridden completely substitute any possible value found on the 'parent'.
* **Container templates** that are added to the podTemplate, that has a matching containerTemplate (a container template with the same name) in the 'parent' template, will inherit the configuration of the parent containerTemplate. If no matching container template is found, the template is added as is.
* **Volume** inheritance works exactly as **Container templates**.
* **Image Pull Secrets** are combined (all secrets defined both on 'parent' and 'current' template are used).

In the example below, we will inherit from a pod template we created previously, and will just override the version of `maven` so that it uses Java 21 instead:

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/mypod-1-general.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/mypod-1-general.png) [![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/mypod-2-golang.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/mypod-2-golang.png) [![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/images/mypod-3-maven.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/images/mypod-3-maven.png)

```
podTemplate(inheritFrom: 'mypod', containers: [
    containerTemplate(name: 'maven', image: 'maven:3.9.9-eclipse-temurin-21')
  ]) {
  node(POD_LABEL) {
    …
  }
}
```

Or in declarative pipeline

```
pipeline {
  agent {
    kubernetes {
      inheritFrom 'mypod'
      yaml '''
      spec:
        containers:
        - name: maven
          image: maven:3.9.9-eclipse-temurin-21
'''
      …
    }
  }
  stages {
    …
  }
}
```

Note that we only need to specify the things that are different. So, `command` and `arguments` are not specified, as they are inherited. Also, the `golang` container will be added as defined in the 'parent' template.

## Multiple Pod template inheritance

Field `inheritFrom` may refer a single pod template or multiple separated by space. In the later case each template will be processed in the order they appear in the list *(later items overriding earlier ones)*. In any case if the referenced template is not found it will be ignored.

## Nesting Pod templates

Field `inheritFrom` provides an easy way to compose pod templates that have been pre-configured. In many cases it would be useful to define and compose pod templates directly in the pipeline using groovy. This is made possible via nesting. You can nest multiple pod templates together in order to compose a single one.

The example below composes two different pod templates in order to create one with maven and docker capabilities.

```
podTemplate(containers: [containerTemplate(image: 'docker', name: 'docker', command: 'sleep', args: '99d')]) {
    podTemplate(containers: [containerTemplate(image: 'maven', name: 'maven', command: 'sleep', args: '99d')]) {
      node(POD_LABEL) { // gets a pod with both docker and maven
        …
      }
    }
}
```

This feature is extra useful, pipeline library developers as it allows you to wrap pod templates into functions and let users nest those functions according to their needs.

For example one could create functions for their podTemplates and import them for use. Say here's our file `src/com/foo/utils/PodTemplates.groovy`:

```
package com.foo.utils

public void dockerTemplate(body) {
  podTemplate(
        containers: [containerTemplate(name: 'docker', image: 'docker', command: 'sleep', args: '99d')],
        volumes: [hostPathVolume(hostPath: '/var/run/docker.sock', mountPath: '/var/run/docker.sock')]) {
    body.call()
}
}

public void mavenTemplate(body) {
  podTemplate(
        containers: [containerTemplate(name: 'maven', image: 'maven', command: 'sleep', args: '99d')],
        volumes: [secretVolume(secretName: 'maven-settings', mountPath: '/root/.m2'),
                  persistentVolumeClaim(claimName: 'maven-local-repo', mountPath: '/root/.m2repo')]) {
    body.call()
}
}

return this
```

Then consumers of the library could just express the need for a maven pod with docker capabilities by combining the two, however once again, you will need to express the specific container you wish to execute commands in. You can **NOT** omit the `node` statement.

Note that `POD_LABEL` will be the innermost generated label to get a node which has all the outer pods available on the node, as shown in this example:

```
import com.foo.utils.PodTemplates

podTemplates = new PodTemplates()

podTemplates.dockerTemplate {
  podTemplates.mavenTemplate {
    node(POD_LABEL) {
      container('docker') {
        sh "echo hello from $POD_CONTAINER" // displays 'hello from docker'
      }
      container('maven') {
        sh "echo hello from $POD_CONTAINER" // displays 'hello from maven'
      }
     }
  }
}
```

In scripted pipelines, there are cases where this implicit inheritance via nested declaration is not wanted or another explicit inheritance is preferred. In this case, use `inheritFrom ''` to remove any inheritance, or `inheritFrom 'otherParent'` to override it.

# Declarative Pipeline

Declarative agents can be defined from yaml

```
pipeline {
  agent {
    kubernetes {
      yaml '''
        apiVersion: v1
        kind: Pod
        metadata:
          labels:
            some-label: some-label-value
        spec:
          containers:
          - name: maven
            image: maven:3.9.9-eclipse-temurin-17
            command:
            - cat
            tty: true
          - name: busybox
            image: busybox
            command:
            - cat
            tty: true
        '''
      retries 2
    }
  }
  stages {
    stage('Run maven') {
      steps {
        container('maven') {
          sh 'mvn -version'
        }
        container('busybox') {
          sh '/bin/busybox'
        }
      }
    }
  }
}
```

or using `yamlFile` to keep the pod template in a separate `KubernetesPod.yaml` file

```
pipeline {
  agent {
    kubernetes {
      yamlFile 'KubernetesPod.yaml'
      retries 2
    }
  }
  stages {
    …
  }
}
```

Note that it was previously possible to define `containerTemplate` but that has been deprecated in favor of the yaml format.

```
pipeline {
  agent {
    kubernetes {
      //cloud 'kubernetes'
      containerTemplate {
        name 'maven'
        image 'maven:3.9.9-eclipse-temurin-17'
        command 'sleep'
        args '99d'
      }
    }
  }
  stages {
    …
  }
}
```

Run steps within a container by default. Steps will be nested within an implicit `container(name) {...}` block instead of being executed in the agent container.

```
pipeline {
  agent {
    kubernetes {
      defaultContainer 'maven'
      yamlFile 'KubernetesPod.yaml'
    }
  }

  stages {
    stage('Run maven') {
      steps {
        sh 'mvn -version'
      }
    }
  }
}
```

Run the Pipeline or individual stage within a custom workspace - not required unless explicitly stated.

```
pipeline {
  agent {
    kubernetes {
      customWorkspace 'some/other/path'
      defaultContainer 'maven'
      yamlFile 'KubernetesPod.yaml'
    }
  }

  stages {
    stage('Run maven') {
      steps {
        sh 'mvn -version'
        sh "echo Workspace dir is ${pwd()}"
      }
    }
  }
}
```

## Default inheritance

Unlike scripted k8s template, declarative templates do not inherit from parent template. Since the agents declared at stage level can override a global agent, implicit inheritance was leading to confusion.

You need to explicitly declare the inheritance if necessary using the field `inheritFrom`.

In the following example, `nested-pod` will only contain the `maven` container.

```
pipeline {
  agent {
    kubernetes {
      yaml '''
        spec:
        containers:
        - name: golang
            image: golang:1.16.5
            command:
            - sleep
            args:
            - 99d
        '''
    }
  }
  stages {
    stage('Run maven') {
        agent {
            kubernetes {
                yaml '''
                    spec:
                    containers:
                    - name: maven
                      image: maven:3.9.9-eclipse-temurin-17
                      command:
                      - sleep
                      args:
                      - 99d
                    '''
            }
        }
      steps {
        …
      }
    }
  }
}

```

# Misc.

## Accessing container logs from the pipeline

If you use the `containerTemplate` to run some service in the background (e.g. a database for your integration tests), you might want to access its log from the pipeline. This can be done with the `containerLog` step, which prints the log of the requested container to the build log.

#### Required Parameters

* **name** the name of the container to get logs from, as defined in `podTemplate`. Parameter name can be omitted in simple usage:

```
containerLog 'mongodb'
```

#### Optional Parameters

* **returnLog** return the log instead of printing it to the build log (default: `false`)
* **tailingLines** only return the last n lines of the log (optional)
* **sinceSeconds** only return the last n seconds of the log (optional)
* **limitBytes** limit output to n bytes (from the beginning of the log, not exact).

Also see the online help and [examples/containerLog.groovy](https://github.com/jenkinsci/kubernetes-plugin/blob/master/examples/containerLog.groovy).

# Features controlled using system properties

Please read [Features controlled by system properties](https://www.jenkins.io/doc/book/managing/system-properties/) page to know how to set up system properties within Jenkins.

* `KUBERNETES_JENKINS_URL` : Jenkins URL to be used by agents. This is meant to be used for OEM integration.
* `io.jenkins.plugins.kubernetes.disableNoDelayProvisioning` (since 1.19.1) Whether to disable the no-delay provisioning strategy the plugin uses (defaults to `false`).
* `io.jenkins.plugins.kubernetes.NoDelayProvisionerStrategy.disableCloudShuffle` Whether to disable the shuffling of clouds. When true clouds will be searched in order they are defined (defaults to `false`).
* `jenkins.host.address` : (for unit tests) controls the host agents should use to contact Jenkins
* `org.csanchez.jenkins.plugins.kubernetes.PodTemplate.connectionTimeout` : The time in seconds to wait before considering the pod scheduling has failed (defaults to `1000`)
* `org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator.stdinBufferSize` : stdin buffer size in bytes for commands sent to Kubernetes exec api. A low value will cause slowness in commands executed. A higher value will consume more memory (defaults to `16*1024`)
* `org.csanchez.jenkins.plugins.kubernetes.pipeline.ContainerExecDecorator.websocketConnectionTimeout` : Time to wait for the websocket used by `container` step to connect (defaults to `30`)

# Running on OpenShift

## Random UID problem

OpenShift runs containers using a *random* UID that is overriding what is specified in Docker images. For this reason, you may end up with the following warning in your build

```
[WARNING] HOME is set to / in the agent container. You may encounter troubles when using tools or ssh client. This usually happens if the uid doesnt have any entry in /etc/passwd. Please add a user to your Dockerfile or set the HOME environment variable to a valid directory in the pod template definition.

```

At the moment the jenkinsci agent image is not built for OpenShift and will issue this warning.

This issue can be circumvented in various ways:

* build a docker image for OpenShift in order to behave when running using an arbitrary uid.
* override HOME environment variable in the pod spec to use `/home/jenkins` and mount a volume to `/home/jenkins` to ensure the user running the container can write to it

See this [example](https://github.com/jenkinsci/kubernetes-plugin/blob/master/examples/openshift-home-yaml.groovy) configuration.

## Running with OpenShift 3

OpenShift 3 is based on an older version of Kubernetes, which is not anymore directly supported since Kubernetes plugin version 1.26.0.

To get agents working for Openshift 3, add this `Node Selector` to your Pod Templates:

```
beta.kubernetes.io/os=linux

```

# Windows support

You can run pods on Windows if your cluster has Windows nodes. See the [example](https://github.com/jenkinsci/kubernetes-plugin/blob/master/src/main/resources/org/csanchez/jenkins/plugins/kubernetes/pipeline/samples/windows.groovy).

# Configuration on minikube

Create and start [minikube](https://github.com/kubernetes/minikube)

The client certificate needs to be converted to PKCS, will need a password

```
openssl pkcs12 -export -out ~/.minikube/minikube.pfx -inkey ~/.minikube/apiserver.key -in ~/.minikube/apiserver.crt -certfile ~/.minikube/ca.crt -passout pass:secret

```

Validate that the certificates work

```
curl --cacert ~/.minikube/ca.crt --cert ~/.minikube/minikube.pfx:secret --cert-type P12 https://$(minikube ip):8443

```

Add a Jenkins credential of type certificate, upload it from `~/.minikube/minikube.pfx`, password `secret`

Fill *Kubernetes server certificate key* with the contents of `~/.minikube/ca.crt`

# Configuration on Google Container Engine

Create a cluster

```
gcloud container clusters create jenkins --num-nodes 1 --machine-type g1-small

```

and note the admin password and server certificate.

Or use Google Developer Console to create a Container Engine cluster, then run

```
gcloud container clusters get-credentials jenkins
kubectl config view --raw

```

the last command will output kubernetes cluster configuration including API server URL, admin password and root certificate

# Troubleshooting

First watch if the Jenkins agent pods are started. Make sure you are in the correct cluster and namespace.

```
kubectl get -a pods --watch

```

If they are in a different state than `Running`, use `describe` to get the events

```
kubectl describe pods/my-jenkins-agent

```

If they are `Running`, use `logs` to get the log output

```
kubectl logs -f pods/my-jenkins-agent jnlp

```

If pods are not started or for any other error, check the logs on the controller side.

For more detail, configure a new [Jenkins log recorder](https://wiki.jenkins-ci.org/display/JENKINS/Logging) for `org.csanchez.jenkins.plugins.kubernetes` at `ALL` level.

To inspect the json messages sent back and forth to the Kubernetes API server you can configure a new [Jenkins log recorder](https://wiki.jenkins-ci.org/display/JENKINS/Logging) for `okhttp3` at `DEBUG` level.

## Deleting pods in bad state

```
kubectl get pods -o name --selector=jenkins=slave --all-namespaces  | xargs -I {} kubectl delete {}

```

## Pipeline `sh` step hangs when multiple containers are used

To debug this you need to set `-Dorg.jenkinsci.plugins.durabletask.BourneShellScript.LAUNCH_DIAGNOSTICS=true` system property and then restart the pipeline. Most likely in the console log you will see the following:

```
sh: can't create /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied
sh: can't create /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-result.txt.tmp: Permission denied
mv: can't rename '/home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-result.txt.tmp': No such file or directory
touch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied
touch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied
touch: /home/jenkins/agent/workspace/thejob@tmp/durable-e0b7cd27/jenkins-log.txt: Permission denied
```

Usually this happens when UID of the user in agent container differs from the one in another container(s). All containers you use should have the same UID of the user, also this can be achieved by setting `securityContext`:

```
apiVersion: v1
kind: Pod
spec:
  securityContext:
    runAsUser: 1000 # default UID of jenkins user in agent image
  containers:
  - name: maven
    image: maven:3.9.9-eclipse-temurin-17
    command:
    - cat
    tty: true
```

## Using WebSockets with a Jenkins controller with self-signed HTTPS certificate

Using WebSockets is the easiest and recommended way to establish the connection between agents and a Jenkins controller running outside the cluster. However, if your Jenkins controller has HTTPS configured with self-signed certificate, you'll need to make sure the agent container trusts the CA. To do that, you can extend the `jenkins/inbound-agent` image and add your certificate as follows:

```
FROM jenkins/inbound-agent

USER root

ADD cert.pem /tmp/cert.pem

RUN keytool -noprompt -storepass changeit -cacerts \
  -import -file /tmp/cert.pem -alias jenkinsMaster && \
  rm -f /tmp/cert.pem

USER jenkins
```

Then, use it as the agent container for the pod template as usual. No command or args need to be specified.

> **Notes:**
>
> * Support for using WebSockets with JDK 11 was added in the Remoting v4.11, so make sure your base image is new enough. See [here](https://issues.jenkins.io/browse/JENKINS-61212) for more information.
> * When using the WebSocket mode, the `-disableHttpsCertValidation` on the `jenkins/inbound-agent` becomes unavailable, as well as `-cert`, and that's why you have to extend the docker image.

## [WARNING] label option is deprecated

```
[WARNING] label option is deprecated. To use a static pod template, use the 'inheritFrom' option.

```

You need to change from something like:

```
agent {
	kubernetes {
		label 'somelabel'
	}
}

```

To something like:

```
agent {
	kubernetes {
		inheritFrom 'somelabel'
	}
}

```

# Building and Testing

Integration tests will use the currently configured context auto-detected from kube config file or service account.

## Manual Testing

Run `mvn clean install` and copy `target/kubernetes.hpi` to Jenkins plugins folder.

## Running Kubernetes Integration Tests

Set up your `$KUBECONFIG` however you like, for example

```
kind create cluster
```

then

```
kubectl krew install tunnel # as needed; install Krew first
kubectl tunnel expose jenkins 8000:8000 8001:8001 &
mvn test -Djenkins.host.address=jenkins.default -Dport=8000 -DslaveAgentPort=8001 -Dtest=KubernetesPipelineTest#runInPod
```

Alternately, you can run everything like in CI:

```
export KIND_PRELOAD=true # optionally
./kind.sh -Dtest=KubernetesPipelineTest#runInPod
```

You can also run interactively after setting up the tunnel:

```
mvn hpi:run -Djenkins.host.address=jenkins.default -Dport=8000 -Djenkins.model.Jenkins.slaveAgentPort=8001
```

# Docker image

Docker image for Jenkins, with plugin installed. Based on the [official image](https://hub.docker.com/r/jenkins/jenkins/).

## Running the Docker image

```
docker run --rm --name jenkins -p 8080:8080 -p 50000:50000 -v /var/jenkins_home csanchez/jenkins-kubernetes
```

# Running in Kubernetes

The example configuration will create a stateful set running Jenkins with persistent volume and using a service account to authenticate to Kubernetes API.

## Running locally with minikube

A local testing cluster with one node can be created with [minikube](https://github.com/kubernetes/minikube)

```
minikube start
```

You may need to set the correct permissions for host mounted volumes

```
minikube ssh
sudo chown 1000:1000 /tmp/hostpath-provisioner/pvc-*
```

Then create the Jenkins namespace, controller and Service with

```
kubectl create namespace kubernetes-plugin
kubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin
kubectl create -f src/main/kubernetes/service-account.yml
kubectl create -f src/main/kubernetes/jenkins.yml
```

Get the url to connect to with

```
minikube service jenkins --namespace kubernetes-plugin --url
```

## Running in Google Container Engine GKE

Assuming you created a Kubernetes cluster named `jenkins` this is how to run both Jenkins and agents there.

Creating all the elements and setting the default namespace

```
kubectl create namespace kubernetes-plugin
kubectl config set-context $(kubectl config current-context) --namespace=kubernetes-plugin
kubectl create -f src/main/kubernetes/service-account.yml
kubectl create -f src/main/kubernetes/jenkins.yml
```

Connect to the ip of the network load balancer created by Kubernetes, port 80. Get the ip (in this case `104.197.19.100`) with `kubectl describe services/jenkins` (it may take a bit to populate)

```
$ kubectl describe services/jenkins
Name:           jenkins
Namespace:      default
Labels:         <none>
Selector:       name=jenkins
Type:           LoadBalancer
IP:         10.175.244.232
LoadBalancer Ingress:   104.197.19.100
Port:           http    80/TCP
NodePort:       http    30080/TCP
Endpoints:      10.172.1.5:8080
Port:           agent   50000/TCP
NodePort:       agent   32081/TCP
Endpoints:      10.172.1.5:50000
Session Affinity:   None
No events.

```

Until Kubernetes 1.4 removes the SNATing of source ips, seems that CSRF (enabled by default in Jenkins 2) needs to be configured to avoid `WARNING: No valid crumb was included in request` errors. This can be done checking *Enable proxy compatibility* under Manage Jenkins -> Configure Global Security

Configure Jenkins, adding the `Kubernetes` cloud under configuration, setting Kubernetes URL to the container engine cluster endpoint or simply `https://kubernetes.default.svc.cluster.local`. Under credentials, click `Add` and select `Kubernetes Service Account`, or alternatively use the Kubernetes API username and password. Select 'Certificate' as credentials type if the kubernetes cluster is configured to use client certificates for authentication.

Using `Kubernetes Service Account` will cause the plugin to use the default token mounted inside the Jenkins pod. See [Configure Service Accounts for Pods](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) for more information.

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/credentials.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/credentials.png)

You may want to set `Jenkins URL` to the internal service IP, `http://10.175.244.232` in this case, to connect through the internal network.

Set `Container Cap` to a reasonable number for tests, i.e. 3.

Add an image with

* Docker image: `jenkins/inbound-agent`
* Jenkins agent root directory: `/home/jenkins/agent`

[![image](https://cdn.jsdelivr.net/gh/jenkinsci/kubernetes-plugin@master/configuration.png)](https://github.com/jenkinsci/kubernetes-plugin/blob/master/configuration.png)

Now it is ready to be used.

Tearing it down

```
kubectl delete namespace/kubernetes-plugin
```

## Customizing the deployment

### Modify CPUs and memory request/limits (Kubernetes Resource API)

Modify file `./src/main/kubernetes/jenkins.yml` with desired limits

```
resources:
  limits:
    cpu: 1
    memory: 1Gi
  requests:
    cpu: 0.5
    memory: 500Mi
```

Note: the JVM will use the memory `requests` as the heap limit (-Xmx)

## Building

```
docker build -t csanchez/jenkins-kubernetes .
```

# Related Projects

* [Kubernetes Pipeline plugin](https://github.com/jenkinsci/kubernetes-pipeline-plugin): pipeline extension to provide native support for using Kubernetes pods, secrets and volumes to perform builds
* [kubernetes-credentials](https://github.com/jenkinsci/kubernetes-credentials-plugin): Credentials provider that reads Kubernetes secrets

##### Version: 4306.vc91e951ea\_eb\_d

Released: about a month agoRequires Jenkins 2.426.3ID: kubernetes
##### Installed on 13.2% of controllers

[View detailed version information](https://old.stats.jenkins.io/pluginversions/kubernetes.html)
##### Links

[GitHub](https://github.com/jenkinsci/kubernetes-plugin)[Open issues (Jira)](https://issues.jenkins.io/issues/?jql=resolution%20is%20EMPTY%20and%20component%3D20639)[Report an issue (Jira)](https://www.jenkins.io/participate/report-issue/redirect/#20639/kubernetes)[Pipeline Step Reference](https://www.jenkins.io/doc/pipeline/steps/kubernetes)[Extension Points](https://www.jenkins.io/doc/developer/extensions/kubernetes)[Javadoc](https://javadoc.jenkins.io/plugin/kubernetes)
##### Labels

[Agent Management](/ui/search/?labels=agent)[Cloud Providers](/ui/search/?labels=cloud)[Cluster Management](/ui/search/?labels=cluster)[kubernetes](/ui/search/?labels=kubernetes)
##### Maintainers

[Carlos Sanchez](/ui/search/?query=csanchez)[Vincent Latombe](/ui/search/?query=vlatombe)[Jesse Glick](/ui/search/?query=jglick)[Marky Jackson](/ui/search/?query=jequals5)[Adrien Lecharpentier](/ui/search/?query=alecharp)[Antonio Muñiz](/ui/search/?query=amuniz)[Antoine Neveux](/ui/search/?query=aneveux)[Baptiste Mathus](/ui/search/?query=batmat)[Carroll Chiou](/ui/search/?query=carroll)[Jérôme Pochat](/ui/search/?query=jpochat)[mike cirioli](/ui/search/?query=mikecirioli)[Olivier Lamy](/ui/search/?query=olamy)[Raul Arabaolaza](/ui/search/?query=rarabaolaza)[rsandell](/ui/search/?query=rsandell)[James Nord](/ui/search/?query=teilo)[Thierry Wasylczenko](/ui/search/?query=twasyl)[Francisco Fernández](/ui/search/?query=fcojfernandez)[Pedro Bueno](/ui/search/?query=pbuenoyerbes)[Kenneth Rogers](/ui/search/?query=kerogers)[A. Jard](/ui/search/?query=ajard)
##### Help us improve this page!

To propose a change submit a pull request to [the plugin page](https://github.com/jenkinsci/kubernetes-plugin) on GitHub.
##### Previous Security Warnings

* ###### [Lack of masking of secrets in build log](https://jenkins.io/security/advisory/2018-06-04/#SECURITY-883)

  + Affects version 1.7.0 and earlier
* ###### [CSRF vulnerability and missing permission checks allowed capturing credentials](https://jenkins.io/security/advisory/2018-07-30/#SECURITY-1016)

  + Affects version 1.10.1 and earlier
* ###### [Jenkins controller environment variables accessible](https://www.jenkins.io/security/advisory/2020-11-04/#SECURITY-1646)

  + Affects version 1.27.3 and earlier
* ###### [Missing permission check allows listing pod templates](https://www.jenkins.io/security/advisory/2020-11-04/#SECURITY-2102)

  + Affects version 1.27.3 and earlier
* ###### [Missing permission check allows enumerating credentials IDs](https://www.jenkins.io/security/advisory/2020-11-04/#SECURITY-2103)

  + Affects version 1.27.3 and earlier
* ###### [Improper masking of credentials](https://www.jenkins.io/security/advisory/2023-04-12/#SECURITY-3075)

  + Affects version 3909.v1f2c633e8590 and earlier
![tracker](https://jenkins-matomo.do.g4v.dev/piwik.php?idsite=1&rec=1&url=https://plugins.jenkins.io//kubernetes/)



=== Content from plugins.jenkins.io_31edabc3_20250126_113410.html ===

# GitHub Pull Request Builder

How to installThe Jenkins project announced unresolved security vulnerabilities affecting the current version of this plugin ([why?](https://www.jenkins.io/security/plugins/#unresolved)):

* **[Missing permission check allows enumerating credentials IDs](https://www.jenkins.io/security/advisory/2023-01-24/#SECURITY-2789%20(1))**
* **[CSRF vulnerability and missing permission checks](https://www.jenkins.io/security/advisory/2023-01-24/#SECURITY-2789%20(2))**

* [Documentation](/ghprb/)
* [Releases](/ghprb/releases/)
* [Issues](/ghprb/issues/)
* [Dependencies](/ghprb/dependencies/)
* [Health Score](/ghprb/healthscore/)

You should probably migrate to [GitHub Branch Source
Plugin](https://wiki.jenkins.io/display/JENKINS/GitHub%2BBranch%2BSource%2BPlugin)

This plugin builds pull requests in github and report results.

More **up to date** information is available on the:

[Github
README.md](https://github.com/jenkinsci/ghprb-plugin/blob/master/README.md)

**Commands:**

When a new pull request is opened in the project and the author of the
pull request isn't white-listed, builder will ask "Can one of the admins
verify this patch?".

* "ok to test" to accept this pull request for testing
* "test this please" for a one time test run
* "add to whitelist" to add the author to the whitelist

If the build fails for other various reasons you can rebuild.

* "retest this please" to start a new build

**Installation:**

* I recommend to create GitHub 'bot' user that will be used for
  communication with GitHub (however you can use your own account if
  you want).
* The user needs to have push rights for your repository (must be
  collaborator (user repo) or must have Push & Pull rights
  (organization repo)).
* If you want to use GitHub hooks have them set automatically the user
  needs to have administrator rights for your repository (must be
  owner (user repo) or must have Push, Pull & Administrative rights
  (organization repo))

* Install the plugin.
* Go to ``Manage Jenkins`` -> ``Configure System`` ->
  ``GitHub pull requests builder`` section.

* Add GitHub usernames of admins (these usernames will be used as
  defaults in new jobs).
* Under Advanced, you can modify:
  + The phrase for adding users to the whitelist via comment. (Java
    regexp)
  + The phrase for accepting a pull request for testing. (Java
    regexp)
  + The phrase for starting a new build. (Java regexp)
  + The crontab line. This specify default setting for new jobs.
* Under Application Setup
  + There are global and job default extensions that can be
    configured for things like:
    - Commit status updates
    - Build status messages
    - Adding lines from the build log to the build result message
    - etc.

#### Credentials

* If you are using Enterprise GitHub set the server api URL in
  ``GitHub server api URL``. Otherwise leave there
  ``[https://api.github.com](https://api.github.com/)``.
* A GitHub API token or username password can be used for access to
  the GitHub API
* To setup credentials for a given GitHub Server API URL:
  + Click Add next to the ``Credentials`` drop down
    - For a token select ``Kind`` -> ``Secret text``
      * If you haven't generated an access token you can
        generate one in ``Test Credentials...``.
        + Set your 'bot' user's GitHub username and password.
        + Press the ``Create Access Token`` button
        + Jenkins will create a token credential, and give you
          the id of the newly created credentials. The default
          description is: ``serverAPIUrl + " GitHub auto
          generated token credentials"``.
    - For username/password us ``Kind`` -> ``Username with
      password``
      * The scope determines what has access to the credentials
        you are about to create
    - The first part of the description is used to show different
      credentials in the drop down, so use something
      semi-descriptive
    - Click ``Add``
  + Credentials will automatically be created in the domain given by
    the ``GitHub Server API URL`` field.
  + Select the credentials you just created in the drop down.
  + The first fifty characters in the Description are used to
    differentiate credentials per job, so again use something
    semi-descriptive
* Add as many GitHub auth sections as you need, even duplicate server
  URLs

* Save to preserve your changes.

#### Creating job:

* Create a new job.
* Add the project's GitHub URL to the "GitHub project" field (the one
  you can enter into browser. eg: "<https://github.com/janinko/ghprb>")
* Select Git SCM.
* Add your GitHub "Repository URL".
* Under Advanced, set "refspec" to

  ```
  +refs/pull/*:refs/remotes/origin/pr/*

  ```
* In "Branch Specifier", enter

  ```
  ${sha1}

  ```

  or if you want to use the actual commit in the pull request, use

  ```
  ${ghprbActualCommit}

  ```
* Under "Build Triggers", check "Github pull requests builder".

  + Add admins for this specific job.
  + If you want to use GitHub hooks for automatic testing, read the
    help for "Use github hooks for build triggering" in job
    configuration. Then you can check the checkbox.
  + In Advanced, you can modify:
    - The crontab line for this specific job. This schedules
      polling to GitHub for new changes in Pull Requests.
    - The whitelisted users for this specific job.
    - The organisation names whose members are considered
      whitelisted for this specific job.
* Save to preserve your changes.

  Make sure you **DON'T** have "Prune remote branches before build"
  advanced option selected, since it will prune the branch created to
  test this build. As noted in issue
  [#507](https://github.com/jenkinsci/ghprb-plugin/issues/507) this
  may be achieved by unchecking 'Lightweight checkout'.

If you want to manually build the job, in the job setting check "This
build is parameterized" and add string parameter named "sha1". When
starting build give the "sha1" parameter commit id you want to build or
refname (eg: "origin/pr/9/head").

#### Environment Variables

The plugin makes some very useful environment variables available.

* ghprbActualCommit
* ghprbActualCommitAuthor
* ghprbActualCommitAuthorEmail
* ghprbPullDescription
* ghprbPullId
* ghprbPullLink
* ghprbPullTitle
* ghprbSourceBranch
* ghprbTargetBranch
* ghprbCommentBody
* sha1

#### Job DSL Support

The plugin contains an extension for the Job DSL plugin to add DSL
syntax for configuring the build trigger and the pull request merger
post-build action.

Here is an example showing all DSL syntax elements:

```
job('example') {
    scm {
        git {
            remote {
                github('test-owner/test-project')
                refspec('+refs/pull/*:refs/remotes/origin/pr/*')
            }
            branch('${sha1}')
        }
    }
    triggers {
        githubPullRequest {
            admin('user_1')
            admins(['user_2', 'user_3'])
            userWhitelist('you@you.com')
            userWhitelist(['me@me.com', 'they@they.com'])
            orgWhitelist('my_github_org')
            orgWhitelist(['your_github_org', 'another_org'])
            cron('H/5 * * * *')
            triggerPhrase('OK to test')
            onlyTriggerPhrase()
            useGitHubHooks()
            permitAll()
            autoCloseFailedPullRequests()
            allowMembersOfWhitelistedOrgsAsAdmin()
            extensions {
                commitStatus {
                    context('deploy to staging site')
                    triggeredStatus('starting deployment to staging site...')
                    startedStatus('deploying to staging site...')
                    statusUrl('http://mystatussite.com/prs')
                    completedStatus('SUCCESS', 'All is well')
                    completedStatus('FAILURE', 'Something went wrong. Investigate!')
                    completedStatus('PENDING', 'still in progress...')
                    completedStatus('ERROR', 'Something went really wrong. Investigate!')
                }
            }
        }
    }
}

```

See the
[README](https://github.com/jenkinsci/ghprb-plugin#job-dsl-support) on
GitHub for the latest information.

#### Changelog

##### >= 1.25

*Changelog for* `1.25` *and upward is maintained on* *[the plugins
github page](https://github.com/jenkinsci/ghprb-plugin#updates)*

##### 1.24

Use signature checking for webhooks if desired.

Add custom messages to status updates and a custom url field.

##### 1.23

Use credentials plugin for username/password combinations and tokens.

Support multiple GitHub endpoints.

##### 1.22.x

Fix issue where if a project was disabled the Jenkins Trigger process
would crash

Fix commit status context

Add one line test results for downstream builds

Miscellaneous bug fixes

##### 1.22

Move commit status over to extension form. It is now configurable,
satisfying #81, #73, and #19 at least.

##### 1.21

Move all commenting logic out into extensions.

##### 1.20.1

Null Pointer fix for trigger.

Added clarity to error message when access is forbidden.

##### 1.20

PullRequestMerger now notifies the taskListener of failures.

AutoCloseFailedPullRequest has been extracted from the published URL
check.

##### 1.19

More work for disabled builds.

Unified tabs to spaces.

Updates to the tests, and added some tests.

##### 1.18

Add support for folder projects.

Correcting issue with default credentials.

Correcting issue with ghRepository being null when it shouldn't be.

Ignoring case when matching repo to url.

Changing the wording for pull requests that are mergeable.

Change requestForTesting phrase to a textArea.

Check if project is disabled, if it is then don't do anything.

##### 1.14

A comment file can be created during the build and added to any comment
made to the pull request. podarok#33

Added a [skip ci] setting, that can be changed. Adding the skip
statement to the pull request body will cause the job not to run.
sathiya-mit#29

Escaping single quotes in log statements tIGO#38

Fixed owner name deduction from url on github hook handling
nikicat#40

Removed unused Test field from the config

##### 1.13-1

Replacing deprecated Github.connect method. tIGO#39

Added a merge plugin for post build. If the build is successful, the job
can specify conditions under which the pull request "button" will be
pressed.

##### 1.12

Fixes issue with checking rate limits for GitHub Enterprise

Internal refactorings

Fixes checking of TriggerTimer
([JENKINS-22550](https://issues.jenkins-ci.org/browse/JENKINS-22550))

##### 1.11.2

Major reduction in the number of requests made to GitHub to avoid rate
limit issues

Fixed changelog for a build so it reports differences between Pull
Request build

Fixes bug on getting author email address from GitHub APIs

Updates warning message is URL isn't set on the GitHub project plugin

Adds some additional parameters to the build, such as the source branch,
pull request link, etc.

Success/failure message now put into the comment on Pull Requests

**1.10 - 1.11.1**

Not publicly released.

##### 1.9

Added job specific triggers.

Added more informations as job parameters.

Fix support for gh-ent token generation.
[JENKINS-17334](https://wiki.jenkins.io/display/JENKINS/GitHub%2Bpull%2Brequest%2Bbuilder%2Bplugin#GitHubpullrequestbuilderplugin-JENKINS-17334)

Lookup PR detailed information for each PR.
[JENKINS-17852](https://wiki.jenkins.io/display/JENKINS/GitHub%2Bpull%2Brequest%2Bbuilder%2Bplugin#GitHubpullrequestbuilderplugin-JENKINS-17852)

Fix closing PR.

various bugfixes

##### 1.8

Support auto-close at build level

add pull id and target branch to environment variables

fix GitHub Hooks when authentication is required on Jenkins

various bug fixes and improvements

##### 1.7

implemented support for GitHub hooks

added button for generating API token

##### 1.6

option for specifying how to mark unstable builds in GitHub

Close failed pull requests automatically if plugin admin configured it

customizeable pass/fail comments

Refactoring of code

help description in Jenkins configuration

##### 1.5

checkbox enabling sending comments when update of comment status fails

option to enter organisations which members are whitelisted

support for Enterprise GitHub

link to pull request into build description

fixes

##### 1.4

Changed comment commands - phrases for testing once, pull request or add
user to whitelist

"test this please" starts new build

"ok to test" allow pull request for building

"add to whitelist" add user to whitelist

##### 1.3

Add published URL feature.

Enable connection to GitHub Enterprise instances.

Enable authentication via a token.

When automatic merge is possible, build the merge.

##### 1.2

Use commit status API instead of comments for reporting results.

##### Version: 1.42.2

Released: 4 years agoRequires Jenkins 2.7ID: ghprb
##### Installed on 3.13% of controllers

[View detailed version information](https://old.stats.jenkins.io/pluginversions/ghprb.html)
##### Links

[GitHub](https://github.com/jenkinsci/ghprb-plugin)[Open issues (Github)](https://github.com/jenkinsci/ghprb-plugin/issues)[Report an issue (Github)](https://github.com/jenkinsci/ghprb-plugin/issues/new/choose)[Open issues (Jira)](https://issues.jenkins.io/issues/?jql=resolution%20is%20EMPTY%20and%20component%3D17227)[Report an issue (Jira)](https://www.jenkins.io/participate/report-issue/redirect/#17227/ghprb)[Pipeline Step Reference](https://www.jenkins.io/doc/pipeline/steps/ghprb)[Javadoc](https://javadoc.jenkins.io/plugin/ghprb)
##### Labels

[github](/ui/search/?labels=github)[Build Triggers](/ui/search/?labels=trigger)
##### Maintainers

[Björn Häuser](/ui/search/?query=bjoernhaeuser)[ben patterson](/ui/search/?query=bpatterson)[Jeremy Phelps](/ui/search/?query=jpwku)[Julio Garcia](/ui/search/?query=papajulio)[Sam Gleske](/ui/search/?query=sag47)[Oliver Gondža](/ui/search/?query=olivergondza)
##### Help us improve this page!

This content is served from the [Jenkins Wiki Export](https://raw.githubusercontent.com/jenkins-infra/plugins-wiki-docs/master/ghprb/README.md) which is now [permanently offline](https://www.jenkins.io/blog/2021/09/04/wiki-attacked/) and before that a [read-only state](https://groups.google.com/forum/#!msg/jenkinsci-dev/lNmas8aBRrI/eL3u7A6qBwAJ). We would love your help in moving plugin documentation to GitHub, see [the guidelines](https://jenkins.io/blog/2019/10/21/plugin-docs-on-github/).
##### Previous Security Warnings

* ###### [GitHub access tokens stored in build.xml](https://jenkins.io/security/advisory/2018-03-26/#SECURITY-261)

  + Affects version 1.40.0 and earlier
* ###### [Webhook secret stored in plain text](https://jenkins.io/security/advisory/2018-03-26/#SECURITY-262)

  + Affects version 1.32.0 and earlier
* ###### [CSRF vulnerability and lack of permission checks allows capturing credentials](https://jenkins.io/security/advisory/2018-06-04/#SECURITY-805)

  + Affects version 1.41.0 and earlier
![tracker](https://jenkins-matomo.do.g4v.dev/piwik.php?idsite=1&rec=1&url=https://plugins.jenkins.io//ghprb/)


