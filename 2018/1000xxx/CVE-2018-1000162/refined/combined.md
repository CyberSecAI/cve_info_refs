=== Content from github.com_1b55478d_20250126_055237.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferusev%2Fparsedown%2Fissues%2F530)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferusev%2Fparsedown%2Fissues%2F530)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=erusev%2Fparsedown)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[erusev](/erusev)
/
**[parsedown](/erusev/parsedown)**
Public

* [Notifications](/login?return_to=%2Ferusev%2Fparsedown) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Ferusev%2Fparsedown)
* [Star
   14.8k](/login?return_to=%2Ferusev%2Fparsedown)

* [Code](/erusev/parsedown)
* [Issues
  117](/erusev/parsedown/issues)
* [Pull requests
  51](/erusev/parsedown/pulls)
* [Actions](/erusev/parsedown/actions)
* [Projects
  0](/erusev/parsedown/projects)
* [Wiki](/erusev/parsedown/wiki)
* [Security](/erusev/parsedown/security)
* [Insights](/erusev/parsedown/pulse)

Additional navigation options

* [Code](/erusev/parsedown)
* [Issues](/erusev/parsedown/issues)
* [Pull requests](/erusev/parsedown/pulls)
* [Actions](/erusev/parsedown/actions)
* [Projects](/erusev/parsedown/projects)
* [Wiki](/erusev/parsedown/wiki)
* [Security](/erusev/parsedown/security)
* [Insights](/erusev/parsedown/pulse)

# Cross-site scripting vulnerability in ParseDown #530

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#495](https://github.com/erusev/parsedown/pull/495)Closed[Cross-site scripting vulnerability in ParseDown](#top)#530[#495](https://github.com/erusev/parsedown/pull/495)Copy link[![@prodigysml](https://avatars.githubusercontent.com/u/16996819?u=8ac045207384ce660425a4fdded4a836e20988a2&v=4&size=80)](/prodigysml)
## Description

[![@prodigysml](https://avatars.githubusercontent.com/u/16996819?u=8ac045207384ce660425a4fdded4a836e20988a2&v=4&size=48)](/prodigysml)[prodigysml](https://github.com/prodigysml)opened [on Sep 22, 2017](https://github.com/erusev/parsedown/issues/530#issue-259703446)
```
<?php

include("parsedown/Parsedown.php");

echo Parsedown::instance()->text('Hello ![google" onerror="alert(1)](http://google.com)');
```

The code above simply creates an instance of your Parsedown parser and then creates an image in markdown. This creation of the image is vulnerable to XSS. I would advice something like HTML encoding some of the input in certain places (especially for things like quotes).

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4537e7fa_20250126_055235.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-qgpv-86r3-87fh)

**CVE-2018-1000162**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-qgpv-86r3-87fh)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2018-1000162](/advisories/GHSA-qgpv-86r3-87fh)

## Cross-site Scripting in Parsedown

Moderate severity

GitHub Reviewed

Published
Mar 30, 2022
to the GitHub Advisory Database
•
Updated Jul 15, 2023

[Vulnerability details](/advisories/GHSA-qgpv-86r3-87fh)
[Dependabot alerts
0](/advisories/GHSA-qgpv-86r3-87fh/dependabot)

## Package

composer

erusev/parsedown
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

< 1.7.0

## Patched versions

1.7.0

## Description

Parsedown version prior to 1.7.0 contains a Cross Site Scripting (XSS) vulnerability in `setMarkupEscaped` for escaping HTML that can result in JavaScript code execution. This attack appears to be exploitable via specially crafted markdown that allows it to side step HTML escaping by breaking AST boundaries. This vulnerability appears to have been fixed in 1.7.0 and later.

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2018-1000162>
* [Roave/SecurityAdvisories#44 (comment)](https://github.com/Roave/SecurityAdvisories/issues/44#issuecomment-368594409)
* [erusev/parsedown#495](https://github.com/erusev/parsedown/pull/495)
* <https://github.com/FriendsOfPHP/security-advisories/blob/master/erusev/parsedown/CVE-2018-1000162.yaml>

Published to the GitHub Advisory Database
Mar 30, 2022

Reviewed
Mar 30, 2022

Last updated
Jul 15, 2023

### Severity

Moderate

6.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N

### EPSS score

0.084%

# Exploit Prediction Scoring System (EPSS)

This score estimates the probability of this vulnerability being exploited within the next 30 days.
Data provided by [FIRST](https://www.first.org/epss/user-guide).

 (38th percentile)

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### CVE ID

CVE-2018-1000162

### GHSA ID

GHSA-qgpv-86r3-87fh

### Source code

[erusev/parsedown](https://github.com/erusev/parsedown)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-qgpv-86r3-87fh/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4bcd3f2c_20250125_041518.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRoave%2FSecurityAdvisories%2Fissues%2F44)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FRoave%2FSecurityAdvisories%2Fissues%2F44)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=Roave%2FSecurityAdvisories)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Roave](/Roave)
/
**[SecurityAdvisories](/Roave/SecurityAdvisories)**
Public

* [Notifications](/login?return_to=%2FRoave%2FSecurityAdvisories) You must be signed in to change notification settings
* [Fork
  106](/login?return_to=%2FRoave%2FSecurityAdvisories)
* [Star
   2.7k](/login?return_to=%2FRoave%2FSecurityAdvisories)

* [Code](/Roave/SecurityAdvisories)
* [Issues
  0](/Roave/SecurityAdvisories/issues)
* [Pull requests
  1](/Roave/SecurityAdvisories/pulls)
* [Actions](/Roave/SecurityAdvisories/actions)
* [Projects
  0](/Roave/SecurityAdvisories/projects)
* [Wiki](/Roave/SecurityAdvisories/wiki)
* [Security](/Roave/SecurityAdvisories/security)
* [Insights](/Roave/SecurityAdvisories/pulse)

Additional navigation options

* [Code](/Roave/SecurityAdvisories)
* [Issues](/Roave/SecurityAdvisories/issues)
* [Pull requests](/Roave/SecurityAdvisories/pulls)
* [Actions](/Roave/SecurityAdvisories/actions)
* [Projects](/Roave/SecurityAdvisories/projects)
* [Wiki](/Roave/SecurityAdvisories/wiki)
* [Security](/Roave/SecurityAdvisories/security)
* [Insights](/Roave/SecurityAdvisories/pulse)

# Parsedown should not have an advisory? #44

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Parsedown should not have an advisory?](#top)#44Copy link[![@taylorotwell](https://avatars.githubusercontent.com/u/463230?u=8b44c0b2f4938e91d8dff0d9667c95f571358c86&v=4&size=80)](/taylorotwell)
## Description

[![@taylorotwell](https://avatars.githubusercontent.com/u/463230?u=8b44c0b2f4938e91d8dff0d9667c95f571358c86&v=4&size=48)](/taylorotwell)[taylorotwell](https://github.com/taylorotwell)opened [on Feb 26, 2018](https://github.com/Roave/SecurityAdvisories/issues/44#issue-300335093)

Parsedown is listed here as having a security advisory, but I'm not 100% sure it is warranted. It is a Markdown parsing library that takes the Markdown input it is given and turns it into HTML. Period. That is all it does. It is not output sanitizer and the author has stated that that is not a goal of the library. It already is possible to combine Parsedown *with* a sanitizer in order to sanitize output, for example:

```
use Parsedown;
use Stauros\Stauros;
use Stauros\HTML\Config;

$parsedown = (new Parsedown)->setMarkupEscaped(true);

$stauros = new Stauros(
    new Config([
        'a' => ['href' => true, 'title' => true],
        'b' => [],
        'br' => [],
        'blockquote' => ['cite' => true],
        'cite' => [],
        'code' => [],
        'em' => [],
        'i' => [],
        'p' => [],
        'q' => ['cite' => true],
        's' => [],
        'strike' => [],
        'strong' => [],
    ])
);

$html = $stauros->scanHTML(
    $parsedown->text($markdown)
);
```

IMO, these two things are separate concerns and forcing Parsedown to implement a full HTML sanitization feature or integrate with other libraries to do so when it can easily be done flexibly and easily in user-land doesn't make a ton of sense.

I would prefer someone other than [@Ocramius](https://github.com/Ocramius) review this issue as I'm not sure he can keep personal bias out of the discussion, since he fairly routinely tweets inflammatory things regarding libraries I have created. Thanks.

Thoughts?

👍3😕1
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a0a780c2_20250125_041523.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferusev%2Fparsedown%2Fpull%2F495)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ferusev%2Fparsedown%2Fpull%2F495)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=erusev%2Fparsedown)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[erusev](/erusev)
/
**[parsedown](/erusev/parsedown)**
Public

* [Notifications](/login?return_to=%2Ferusev%2Fparsedown) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Ferusev%2Fparsedown)
* [Star
   14.8k](/login?return_to=%2Ferusev%2Fparsedown)

* [Code](/erusev/parsedown)
* [Issues
  117](/erusev/parsedown/issues)
* [Pull requests
  51](/erusev/parsedown/pulls)
* [Actions](/erusev/parsedown/actions)
* [Projects
  0](/erusev/parsedown/projects)
* [Wiki](/erusev/parsedown/wiki)
* [Security](/erusev/parsedown/security)
* [Insights](/erusev/parsedown/pulse)

Additional navigation options

* [Code](/erusev/parsedown)
* [Issues](/erusev/parsedown/issues)
* [Pull requests](/erusev/parsedown/pulls)
* [Actions](/erusev/parsedown/actions)
* [Projects](/erusev/parsedown/projects)
* [Wiki](/erusev/parsedown/wiki)
* [Security](/erusev/parsedown/security)
* [Insights](/erusev/parsedown/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ferusev%2Fparsedown%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ferusev%2Fparsedown%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Prevent various XSS attacks [rebase and update of #276] #495

 Merged

[erusev](/erusev)
merged 20 commits into
[erusev:master](/erusev/parsedown/tree/master "erusev/parsedown:master")
from
[aidantwoods:anti-xss](/aidantwoods/parsedown/tree/anti-xss "aidantwoods/parsedown:anti-xss")

Feb 28, 2018

 Merged

# [Prevent various XSS attacks [rebase and update of #276]](#top) #495

[erusev](/erusev)
merged 20 commits into
[erusev:master](/erusev/parsedown/tree/master "erusev/parsedown:master")
from
[aidantwoods:anti-xss](/aidantwoods/parsedown/tree/anti-xss "aidantwoods/parsedown:anti-xss")

Feb 28, 2018

[Conversation
140](/erusev/parsedown/pull/495)
[Commits
20](/erusev/parsedown/pull/495/commits)
[Checks
0](/erusev/parsedown/pull/495/checks)
[Files changed](/erusev/parsedown/pull/495/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=60&v=4)](/aidantwoods)

Copy link

Collaborator

### @aidantwoods **[aidantwoods](/aidantwoods)** commented [May 1, 2017](#issue-225375951) • edited Loading

I've picked up on the work started over at [#276](https://github.com/erusev/parsedown/pull/276) and rebased on `erusev/master`.

Since this is rebased on master, I can't point at PR at `naNuke/master` without running into the merge conflicts that I've already resolved manually.

I've implemented what I suggested [earlier](https://github.com/erusev/parsedown/pull/276#issuecomment-298244798) so that all attributes are properly encoded (and not just the specific ones we remember).

I've also added some tests, so [@erusev](https://github.com/erusev)'s concern here should hopefully now be resolved, albeit a year later 😉

[#276 (comment)](https://github.com/erusev/parsedown/pull/276#issuecomment-178577968)

> [@malas](https://github.com/malas) one reason is the lack of tests

~~One thing to note is that all this can be circumvented if you forget to turn on `$Parsedown->setMarkupEscaped(true);`

(which is off by default) as you could just write a script tag manually for xss (even though the attributes and link destinations will be safe). So let's all remember to enable this setting 😉~~

Attributes are now always escaped properly (this speaks to just outputting things correctly), but link based XSS or XSS from writing plain old script tags will only be prevented only if the new `setSafeMode` is enabled.

```
$Parsedown->setSafeMode(true);
```

---

Closes [#161](https://github.com/erusev/parsedown/issues/161)

Closes [#497](https://github.com/erusev/parsedown/issues/497)

Closes [#276](https://github.com/erusev/parsedown/pull/276)

Closes [#403](https://github.com/erusev/parsedown/pull/403)

Closes [#530](https://github.com/erusev/parsedown/issues/530)

---

The following CVE has been assigned to the vulnerability specific to bypassing `->setMarkupEscaped(true)`: **[CVE-2018-1000162](https://github.com/advisories/GHSA-qgpv-86r3-87fh "CVE-2018-1000162")**.

Sorry, something went wrong.

 👍
9
 BytewaveMLP, antoninkriz, azimidev, paragonie-scott, jaylinski, pushchris, okaufmann, embluk, and JCarlosR reacted with thumbs up emoji
 ❤️
6
 hkdobrev, tillkruss, m1guelpf, antoninkriz, jaylinski, and embluk reacted with heart emoji

All reactions

* 👍
  9 reactions
* ❤️
  6 reactions

 [naNuke](/naNuke)
and others
added 7 commits
[May 1, 2017 01:58](#commits-pushed-1140613)

[![@naNuke](https://avatars.githubusercontent.com/u/4591126?s=40&v=4)](/naNuke) [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[Prevent various XSS attacks](/erusev/parsedown/pull/495/commits/1140613fc7aa1393a6274812deab253b90027ae7 "Prevent various XSS attacks")`

`[1140613](/erusev/parsedown/pull/495/commits/1140613fc7aa1393a6274812deab253b90027ae7)`

[![@naNuke](https://avatars.githubusercontent.com/u/4591126?s=40&v=4)](/naNuke) [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[Improve safeLinks with whitelist.](/erusev/parsedown/pull/495/commits/bf5105cb1a7a2656d134ab35456a727959574e7d "Improve safeLinks with whitelist.")`

`[bf5105c](/erusev/parsedown/pull/495/commits/bf5105cb1a7a2656d134ab35456a727959574e7d)`

[![@naNuke](https://avatars.githubusercontent.com/u/4591126?s=40&v=4)](/naNuke) [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[Customizable whitelist of schemas for safeLinks](/erusev/parsedown/pull/495/commits/1d4296f34d938758ff88755e4ac44ae1d3fc6857 "Customizable whitelist of schemas for safeLinks")`

`[1d4296f](/erusev/parsedown/pull/495/commits/1d4296f34d938758ff88755e4ac44ae1d3fc6857)`

[![@naNuke](https://avatars.githubusercontent.com/u/4591126?s=40&v=4)](/naNuke) [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[Add html escaping to all attributes capable of holding user input.](/erusev/parsedown/pull/495/commits/b3d45c4bb9bc798e4b297da38c4b015ac8bb44c6 "Add html escaping to all attributes capable of holding user input.")`

`[b3d45c4](/erusev/parsedown/pull/495/commits/b3d45c4bb9bc798e4b297da38c4b015ac8bb44c6)`

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[anti-xss](/erusev/parsedown/pull/495/commits/6bb66db00f7faf29932f96b47fc4ac60a4333e8e "anti-xss

protect all attributes and content from xss via element method
filter special attributes (a href, img src)
expand url whitelist slightly to permit data images and mailto links")`
 …

`[6bb66db](/erusev/parsedown/pull/495/commits/6bb66db00f7faf29932f96b47fc4ac60a4333e8e)`

```
protect all attributes and content from xss via element method
filter special attributes (a href, img src)
expand url whitelist slightly to permit data images and mailto links
```

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[add xss tests](/erusev/parsedown/pull/495/commits/af04ac92e2ff852309891ebc767fa5a6bf179f39 "add xss tests")`

`[af04ac9](/erusev/parsedown/pull/495/commits/af04ac92e2ff852309891ebc767fa5a6bf179f39)`

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[filter onevent attributes](/erusev/parsedown/pull/495/commits/131ba758514c5e905663bd82fc7c1c8271c7edc5 "filter onevent attributes")`

`[131ba75](/erusev/parsedown/pull/495/commits/131ba758514c5e905663bd82fc7c1c8271c7edc5)`

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [May 1, 2017](#issuecomment-298347721) • edited Loading

| [131ba75](https://github.com/erusev/parsedown/commit/131ba758514c5e905663bd82fc7c1c8271c7edc5) addresses a small case study.  I noticed that someone had written an extension for Parsedown extra here <https://github.com/tovic/parsedown-extra-plugin>  One of the things it does it expand parsedown extra's attribute block feature (i.e. `# Header {.sth}` => `<h1 class="sth">Header</h1>`).  The extension allows arbitrary attributes to be set, as well as being vulnerable itself to xss via attribute encoding.  So running this extension on current master, we see that it's vulnerable because it does it's own element parsing. [screen shot 2017-05-01 at 15 23 50](https://cloud.githubusercontent.com/assets/3288888/25582525/b4a0e1e0-2e85-11e7-8b09-34a5a270740b.png)  Applying everything upto [af04ac9](https://github.com/erusev/parsedown/commit/af04ac92e2ff852309891ebc767fa5a6bf179f39) gets us this far: [screen shot 2017-05-01 at 15 26 02](https://cloud.githubusercontent.com/assets/3288888/25582546/cf1168c4-2e85-11e7-9b66-e37d1b3b81b6.png)  Which is great IMO! This feature is doing what it's meant to – sanitising *all* attributes (even ones Parsedown base didn't create).  But because this extension allows arbitrary attributes to be set, we can still achieve something like this: [screen shot 2017-05-01 at 15 31 28](https://cloud.githubusercontent.com/assets/3288888/25582598/01542c2c-2e86-11e7-93f4-ff01fa2fb957.png)  Which is XSS without needing to break out of the quote.  So [131ba75](https://github.com/erusev/parsedown/commit/131ba758514c5e905663bd82fc7c1c8271c7edc5) does a little better and drops onevent style attributes before outputting the element.  We can't solve every problem an extension will encounter in base, but I think this extra check is definitely a worthwhile since we *can* do it 😃 ! |
| --- |

All reactions

Sorry, something went wrong.

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [May 1, 2017](#issuecomment-298349599)

| Btw, incase anyone is a little dubious about just checking for the `on` prefix in an attribute name solving this. Per w3 HTML5 spec, that should cover all event handlers.  <https://www.w3.org/TR/html5/webappapis.html#event-handler-attributes>  An event handler has a name, which always starts with "`on`" and is followed by the name of the event for which it is intended. |
| --- |

All reactions

Sorry, something went wrong.

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[May 1, 2017](#ref-pullrequest-54971979)

[Prevent various XSS attacks
#276](/erusev/parsedown/pull/276)
 Closed

 [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
[force-pushed](/erusev/parsedown/compare/394624ff3c9388161f7fb9a8a59148d42c9b22ad..0ae11f792fcfe48ef68ea07b74bc17da5f32f234)
the
anti-xss

branch
from
[`394624f`](/erusev/parsedown/commit/394624ff3c9388161f7fb9a8a59148d42c9b22ad) to
[`0ae11f7`](/erusev/parsedown/commit/0ae11f792fcfe48ef68ea07b74bc17da5f32f234)  [Compare](/erusev/parsedown/compare/394624ff3c9388161f7fb9a8a59148d42c9b22ad..0ae11f792fcfe48ef68ea07b74bc17da5f32f234)
[May 1, 2017 23:42](#event-1064697348)

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[dump attributes that contain characters that are impossible for valid…](/erusev/parsedown/pull/495/commits/6d0156d70714fcd89c1b9c9eb573adade13bfb27 "dump attributes that contain characters that are impossible for validity, or very unlikely")`
 …

`[6d0156d](/erusev/parsedown/pull/495/commits/6d0156d70714fcd89c1b9c9eb573adade13bfb27)`

```
…ity, or very unlikely
```

 [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
[force-pushed](/erusev/parsedown/compare/27a548119ec1d1a5027eea41494d249120f60121..ba22e5b28d70f3df568245132bd2993c8b332abd)
the
anti-xss

branch
2 times, most recently
from
[`27a5481`](/erusev/parsedown/commit/27a548119ec1d1a5027eea41494d249120f60121) to
[`ba22e5b`](/erusev/parsedown/commit/ba22e5b28d70f3df568245132bd2993c8b332abd)  [Compare](/erusev/parsedown/compare/27a548119ec1d1a5027eea41494d249120f60121..ba22e5b28d70f3df568245132bd2993c8b332abd)
[May 2, 2017 00:32](#event-1064733991)

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[array_keys is probably faster](/erusev/parsedown/pull/495/commits/e4bb12329e8b895bfef4564296624cd47057d2be "array_keys is probably faster")`

`[e4bb123](/erusev/parsedown/pull/495/commits/e4bb12329e8b895bfef4564296624cd47057d2be)`

 [![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
[force-pushed](/erusev/parsedown/compare/ba22e5b28d70f3df568245132bd2993c8b332abd..e4bb12329e8b895bfef4564296624cd47057d2be)
the
anti-xss

branch
from
[`ba22e5b`](/erusev/parsedown/commit/ba22e5b28d70f3df568245132bd2993c8b332abd) to
[`e4bb123`](/erusev/parsedown/commit/e4bb12329e8b895bfef4564296624cd47057d2be)  [Compare](/erusev/parsedown/compare/ba22e5b28d70f3df568245132bd2993c8b332abd..e4bb12329e8b895bfef4564296624cd47057d2be)
[May 2, 2017 00:32](#event-1064734085)

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[May 2, 2017](#ref-issue-225589930)

[Link allows javascript which could lead to XSS issues
#497](/erusev/parsedown/issues/497)

Closed

[![@tillkruss](https://avatars.githubusercontent.com/u/665029?s=80&u=d532197bbfe5348e7dc120fa65cd91ddcd211e2d&v=4)](/tillkruss)

Copy link

Contributor

### **[tillkruss](/tillkruss)** commented [May 2, 2017](#issuecomment-298678322)

| Code-blocks like will remain untouched, right? |
| --- |

All reactions

Sorry, something went wrong.

[![erusev](https://avatars.githubusercontent.com/u/184170?s=60&v=4)](/erusev)

**[erusev](/erusev)**
reviewed
[May 2, 2017](#pullrequestreview-35823254)

 [View reviewed changes](/erusev/parsedown/pull/495/files/e4bb12329e8b895bfef4564296624cd47057d2be)

[Parsedown.php](/erusev/parsedown/pull/495/files/e4bb12329e8b895bfef4564296624cd47057d2be#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | protected $safeLinksEnabled = true; |
|  |  |  |
|  |  | protected $safeLinksWhitelist = array( |

Copy link

Owner

### @erusev **[erusev](/erusev)** [May 2, 2017](#discussion_r114363549)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Does this have to be an instance member? Seems like it can be moved to `filterUnsafeUrlInAttribute`

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114384220)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

In theory it would let an extension define additional protocols without having to worry about implementation of how to whitelist them

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114384594)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I.e. you could fix a bug in the filter implementation that wouldn't have to be reflected in the extension if they're just adding data.

Sorry, something went wrong.

All reactions

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [May 2, 2017](#issuecomment-298717654) • edited Loading

| [@tillkruss](https://github.com/tillkruss)  Code-blocks like will remain untouched, right?  On a high level yes, they would go untouched. As-in the same markdown will be converted to the same HTML. Though, all encoding is now done by the element method (and no longer by the particular block/inline methods).  For this reason it would *technically* be non backwards compatible on the `protected` API level (e.g. an extension has implemented their own code block methods which encode the output, and as a result of the base class changing, output would now be double encoded).  Something [@erusev](https://github.com/erusev) might want to consider when deciding the version level to increment.   ---   The above assuming that the question was about [code blocks](http://spec.commonmark.org/0.27/#fenced-code-blocks) and not [HTML blocks](http://spec.commonmark.org/0.27/#html-blocks).  HTML blocks will be unaffected by this change, unless `->setMarkupEscaped(true);` is enabled. In which case they will be encoded.  This just to emphasise again that `->setMarkupEscaped(true);` **must** be enabled to prevent XSS – since HTML is intentionally allowed in markdown as a language. |
| --- |

All reactions

Sorry, something went wrong.

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[whitelist changes:](/erusev/parsedown/pull/495/commits/4dc98b635d18527000e74a0eb4cd400db2bf5af3 "whitelist changes:
* add gif and jpg as allowed data images
* ensure that user controlled content fall only in the \"data section\" of the data URI (and does not intersect content-type definition in any way (best to be safe than sorry ;-)))
  \"data section\" as defined in: https://tools.ietf.org/html/rfc2397#section-3")`
 …

`[4dc98b6](/erusev/parsedown/pull/495/commits/4dc98b635d18527000e74a0eb4cd400db2bf5af3)`

```
* add gif and jpg as allowed data images
* ensure that user controlled content fall only in the "data section" of the data URI (and does not intersect content-type definition in any way (best to be safe than sorry ;-)))
  "data section" as defined in: <https://tools.ietf.org/html/rfc2397#section-3>
```

[![tillkruss](https://avatars.githubusercontent.com/u/665029?s=60&v=4)](/tillkruss)

**[tillkruss](/tillkruss)**
reviewed
[May 2, 2017](#pullrequestreview-35858254)

 [View reviewed changes](/erusev/parsedown/pull/495/files/4dc98b635d18527000e74a0eb4cd400db2bf5af3)

[Parsedown.php](/erusev/parsedown/pull/495/files/e4bb12329e8b895bfef4564296624cd47057d2be..4dc98b635d18527000e74a0eb4cd400db2bf5af3#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  | 'data:image/png;', |
| --- | --- | --- |
|  |  | 'data:image/png;base64,', |
|  |  | 'data:image/gif;base64,', |
|  |  | 'data:image/jpg;base64,', |

Copy link

Contributor

### @tillkruss **[tillkruss](/tillkruss)** [May 2, 2017](#discussion_r114395787) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It's actually `image/jpeg` 😉

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114396010)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Cheers ;-)

Is jpg allowed as a variant? (i.e. should I add both?)

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @tillkruss **[tillkruss](/tillkruss)** [May 2, 2017](#discussion_r114396556)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

No, it's invalid.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114396820)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Cool, ty! 😃

Sorry, something went wrong.

All reactions

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[jpeg, not jpg](/erusev/parsedown/pull/495/commits/aee3963e6b97186b1e5526c118bf5d2d872cd8ee "jpeg, not jpg")`

`[aee3963](/erusev/parsedown/pull/495/commits/aee3963e6b97186b1e5526c118bf5d2d872cd8ee)`

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [May 2, 2017](#issuecomment-298761884)

| [@erusev](https://github.com/erusev) I've included the closes keyword at the bottom of the initial PR description on a few issues and PRs that should be made obsolete on merge. Might want to double check they close automatically though, since they were added by editing the message (not sure of the mechanics of doing that). |
| --- |

All reactions

Sorry, something went wrong.

[![PhrozenByte](https://avatars.githubusercontent.com/u/920356?s=60&v=4)](/PhrozenByte)

**[PhrozenByte](/PhrozenByte)**
suggested changes
[May 2, 2017](#pullrequestreview-35904984)

 [View reviewed changes](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee)

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

All in all: Looks great [@aidantwoods](https://github.com/aidantwoods) 👍

Sorry, something went wrong.

All reactions

[Parsedown.php](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  | return $this; |
| --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | protected $safeLinksEnabled = true; |

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114438464)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

IMO this shouldn't be enabled by default, it breaks BC. Enabling this without `setMarkupEscaped(true)` makes no sense anyway - it prevents absolutely nothing without escaped markup. Never confuse people by letting them do pointless things.

How about something like this (disallow enabling `safeLinksEnabled` without `markupEscaped` and always enable/disable `safeLinksEnabled` and `markupEscaped` at the same time; however, disabling `safeLinksEnabled` when `markupEscaped` is enabled is still possible - escaping markup doesn't necessarily imply a "safe mode", but in contrast, a "safe mode" isn't possible without escaping markup)?

```
    function setMarkupEscaped($markupEscaped)
    {
        $this->markupEscaped = (bool) $markupEscaped;
        $this->safeLinksEnabled = (bool) $markupEscaped;
        return $this;
   }

    function setSafeLinksEnabled($safeLinksEnabled)
    {
        // or throw a exception instead
        $this->safeLinksEnabled = $this->markupEscaped && $safeLinksEnabled;
        return $this;
    }
```

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114442235)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, so some of this is spoken to by decisions made in the original PR.

I think the default was [@erusev](https://github.com/erusev)'s suggestion as far as I can tell though, see [#276 (comment)](https://github.com/erusev/parsedown/pull/276#issuecomment-71331724)

If it was up to me I'd make `markupEscaped` default to on too 😉

I'm happy to go with the flow here though, so I'll await some more feedback

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 3, 2017](#discussion_r114663810)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> If it was up to me I'd make markupEscaped default to on too 😉

My 👎 for this, BC is IMO very important 😝

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114664399)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hehe, I mean as an initial decision (of course too late now! ;p)

Sorry, something went wrong.

All reactions

[Parsedown.php](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | foreach ($this->safeLinksWhitelist as $scheme) |
|  |  | { |
|  |  | if (stripos($Element['attributes'][$attribute], $scheme) === 0) |

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114439148)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I didn't test this, but I think it treats relative links like `[some link](relative/path/to/page)` as unsafe.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114440073)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Furthermore: Don't use `stripos()` here, it forces PHP to walk through the whole string even when the first character already didn't match. Use `substr()` instead.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114444976)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yup, it'll treat that as unsafe. Problem with allowing `relative/path/to/page` will be that you'll additionally have to check that no colons are present (also note that `&colon;` is equivalent to a colon in a HTML attribute, and contains no colons).

Also see <https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet#Embedded_newline_to_break_up_XSS> for some examples of getting XSS in a HTML attribute via some obscenely permissive browser parsing :(

e.g. `javas\0cript:` and `jav\tascript:` are valid :(

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114459256) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

As an alternate method for what's done here, one idea I've had is selectively partially url encoding attributes that can't be guaranteed safe by the whitelist.

I've written an implementation [here](https://github.com/Parsemd/Parsemd/blob/master/src/DisplayAsHtml.php#L111-L140). One thing I wasn't sure about was how permissive to be with which characters to allow though. I think holding back on encoding`/#?&=%` (so URLs will still function) (but definitely encoding `;`, `:` and all other non-alphanumerics) should work. I'll have to have a think about it a bit more though as to whether you could bypass that and specify a protocol.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 3, 2017](#discussion_r114496247) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nevertheless are relative paths an important use case. It might be a good idea to look into the specs to find out how URI schemes must look like to be valid. Just guessing here, but I think the `:` as scheme "indicator" works only until a `/` is encountered. As an alternative: If safe url parsing isn't enabled by default, it might be sufficient to document this behavior and to tell people that they should use `./` for relative paths (what afaik isn't whitelisted yet).

Sorry, something went wrong.

All reactions

Load more…

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 7, 2017](#discussion_r115142015)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm still not entirely convinced that this is best solution in every detail, but you've convinced me that the approach is right. There might still be some open detail questions, I unfortunately don't have time to look through everything in detail at the moment.

Sorry, something went wrong.

 👍
1
 aidantwoods reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 7, 2017](#discussion_r115143037)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

What if we used your approach <https://github.com/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#r114438464> to make `safeLinks` be off by default, and strongly coupled `safeLinks` and `setMarkupEscaped` to be either both on, or both off?

That way custom protocols are supported for authors (who trust their own content), but will be off for user generated content (that they do not trust).

Perhaps we could ease the complication of having to enable two options in sync by introducing a new option that does both behind the scenes: `preventXss` or `setContentUntrusted` – that way we'd be giving a more explicit representation to the user about what this option actually does, and would afford us the assumption that while in this mode we should treat content as untrusted.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 7, 2017](#discussion_r115143747)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The one has nothing to do with the other, never ever introduce BC breaking changes without incrementing the first digit of the version (i.e. when this feature is enabled by default, it **must** be released as Parsedown 2.0). You'll break **all** dependent applications otherwise - and Parsedown is no end user project, it's a library, thus you'll break hundreds of applications with thousands of users. See <http://semver.org>. The only exception is behavior that never was expected (like some weird edge cases when parsing markup), neither officially, nor how it was practically used by others.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 7, 2017](#discussion_r115144576) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> never ever introduce BC breaking changes without incrementing the first digit of the version (i.e. when this feature is enabled by default, it must be released as Parsedown 2.0)

I'd tend to agree with that. In-fact even if we change no public default behaviour, IMO it would be valuable to consider how much of a version jump changes to the protected API would warrant (see: [#495 (comment)](https://github.com/erusev/parsedown/pull/495#issuecomment-298717654))

What do you think about introducing a new option though – in theory if we introduced something like `preventXss` or `setContentUntrusted` then there would be no BC breaking changes to the public API (we then wouldn't need to strongly couple `safeLinks` and `setMarkupEscaped` into a both or none scenario – perhaps we wouldn't even need to expose `safeLinks` publically, but just the new option).

Having this off by default would probably ease concerns about custom protocols (and as you said, having `safeLinks` enabled without `setMarkupEscaped` or vice versa doesn't make much sense anyway). So IMO either both should be off by default, or both should be on – both off seems most friendly to expected behaviour (even though my preference is that things are secure by default 😉)

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 7, 2017](#discussion_r115146357)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

If it is disabled by default - sure, why not.

However, as I've said before ([#495 (comment)](https://github.com/erusev/parsedown/pull/495#discussion_r114438464)), please keep in mind that people might want to escape markup without having security/user-generated content in mind. Thus there might still be users who do want to escape markup, but don't want to have `safeLinks` enabled (i.e. what Parsedown currently does when `markupEscaped` is enabled). Just the other way round (`safeLinks` enabled without `markupEscaped`) makes no sense.

Nevertheless, this is no crucial question for me. Important is that this isn't enabled by default, as this would break BC in an absolute catastrophic way.

Sorry, something went wrong.

All reactions

[Parsedown.php](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  | unset($Element['attributes'][$att]); |
| --- | --- | --- |
|  |  | } |
|  |  | # filter out badly parsed attribute |
|  |  | elseif (strpbrk($att, $badAttributeChars) !== false) |

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114439558) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

What's the reason for this? Letting badly parsed attributes produce gibberish is IMO better than silently ignoring it, it's more explicit and gibberish actually helps people to understand that something went wrong. 😉

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114443914) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So I'd rather throw an exception here TBH, but there isn't really precedent so for in Parsedown for throwing them (so I'll defer that decision to [@erusev](https://github.com/erusev))

In my experience coming across this stuff in the wild, there's a pretty high chance that people will not test their applications with bad data (especially if they don't know it could even be valid).

Just for reference, the only chars in that list that would be "valid"-(ish) in the attribute name are `"'\0`, the rest are whitespace (so impossible).

All the whitespace characters are invalid in an HTML tag's attribute name, and would certainly create two attributes (so very likely there is an attack).

By filtering out attributes containing these characters we only need check for a prefix at the start of the string since we guarantee that there can not be multiple attributes (as interpreted by the browser) contained in the single attribute we are considering.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114445334) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Btw this isn't technically exhaustive if it happens to be the first attribute, see <https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet#Non-alpha-non-digit_XSS>

`<SCRIPT/XSS SRC="http://xss.rocks/xss.js"></SCRIPT>` is interpreted as `<script xss="" src="http://xss.rocks/xss.js"></script>`

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114446343) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

*sigh* I guess we'll also have to ensure that the attribute name starts with an alphanumeric.

Perhaps it's best to switch over to a whitelist.

I'd think `[a-zA-Z0-9]` for starting char and `[a-zA-Z0-9-]` for the rest is probably reasonable for normal use.

E.g. Chrome parses `<a /onmouseover="alert(1)">xss</a>` as `<a onmouseover="alert(1)">xss</a>`

`-` appears to correctly attributed to the beginning of the attribute name though.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114450311) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So [4bae1c9](https://github.com/erusev/parsedown/commit/4bae1c9834382d3c7aa900a7cbf77771b3864c56) implements this via a whitelist (which is safer), though [@erusev](https://github.com/erusev) should decide whether this is worth the performance hit given Parsedown base doesn't allow user generated attributes vs. allowing extensions todo basically no checking on what attributes they allow, but Parsedown handling them safely.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 3, 2017](#discussion_r114663950)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

👍

Sorry, something went wrong.

All reactions

[Parsedown.php](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  | # clear out nulls |
| --- | --- | --- |
|  |  | if ($val === null) |
|  |  | { |
|  |  | unset($Element['attributes'][$att]); |

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114439627)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

What's the reason for this?

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114442390)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Was needed when I used `array_flip` in place of where `array_keys` is now, can remove that now though :)

Sorry, something went wrong.

 👍
1
 PhrozenByte reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

[Parsedown.php](/erusev/parsedown/pull/495/files/aee3963e6b97186b1e5526c118bf5d2d872cd8ee#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  | } |
| --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | $onEventAttributeKeys = preg\_grep('/^on/i', array\_keys($Element['attributes'])); |

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 2, 2017](#discussion_r114440370)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Expensive and unnecessary approach. You're iterating through all attributes anyway, why don't you simply test for attributes starting with "on" using `substr()`?

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 2, 2017](#discussion_r114444284) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yup you're right about that, needs to be case insensitive though. Is `strlen` + `substr` + `strtolower` going to be faster than `stripos`?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 3, 2017](#discussion_r114664182)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Definitly! `preg_match` (as in [4bae1c9](https://github.com/erusev/parsedown/commit/4bae1c9834382d3c7aa900a7cbf77771b3864c56)) is very slow either. Starting the PCRE engine is expensive!

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114665597)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

So are we proposing?

```
# dump onevent attribute
elseif (strlen($att) > 1 and strtolower(substr($att, 0, 2)) === 'on')
{
    unset($Element['attributes'][$att]);
}
```

instead of

```
# dump onevent attribute
elseif (stripos($att, 'on') === 0)
{
    unset($Element['attributes'][$att]);
}
```

?

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 5, 2017](#discussion_r115086154) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

How's this [2e4afde](https://github.com/erusev/parsedown/commit/2e4afde68dae7f410af8c9e3a0664fcf97ce8a3d) ?

Sorry, something went wrong.

All reactions

 [aidantwoods](/aidantwoods)
added 2 commits
[May 3, 2017 00:39](#commits-pushed-4bae1c9)

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[whitelist regex for good attribute (no](/erusev/parsedown/pull/495/commits/4bae1c9834382d3c7aa900a7cbf77771b3864c56 "whitelist regex for good attribute (no
no chars that could form a delimiter allowed")`
 …

`[4bae1c9](/erusev/parsedown/pull/495/commits/4bae1c9834382d3c7aa900a7cbf77771b3864c56)`

```
no chars that could form a delimiter allowed
```

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&v=4)](/aidantwoods)

`[urlencode urls that are potentially unsafe:](/erusev/parsedown/pull/495/commits/054ba3c48729036fd8ab1166fb0b1d0b4dd1e465 "urlencode urls that are potentially unsafe:

this should break urls that attempt to include a protocol, or port (these are absolute URLs and should have a whitelisted protocol for use)
but URLs that are relative, or relative from the site root should be preserved (though characters non essential for the URL structure may be urlencoded)

this approach has significant advantages over attempting to locate something like `javascript:alert(1)` or `javascript&colon;alert(1)` (which are both valid) because browsers have been known to ignore ridiculous characters when encountered (meaning something like `jav\ta\0\0script&colon;alert(1)` would be xss :( ). Instead of trying to chase down a way to interpret a URL to decide whether there is a protocol, this approach ensures that two essential characters needed to achieve a colon are encoded `:` (obviously) and `;` (from `&colon;`). If these characters appear in a relative URL then they are equivalent to their URL encoded form and so this change will be non breaking for that case.")`
 …

`[054ba3c](/erusev/parsedown/pull/495/commits/054ba3c48729036fd8ab1166fb0b1d0b4dd1e465)`

```
this should break urls that attempt to include a protocol, or port (these are absolute URLs and should have a whitelisted protocol for use)
but URLs that are relative, or relative from the site root should be preserved (though characters non essential for the URL structure may be urlencoded)

this approach has significant advantages over attempting to locate something like `javascript:alert(1)` or `javascript&colon;alert(1)` (which are both valid) because browsers have been known to ignore ridiculous characters when encountered (meaning something like `jav\ta\0\0script&colon;alert(1)` would be xss :( ). Instead of trying to chase down a way to interpret a URL to decide whether there is a protocol, this approach ensures that two essential characters needed to achieve a colon are encoded `:` (obviously) and `;` (from `&colon;`). If these characters appear in a relative URL then they are equivalent to their URL encoded form and so this change will be non breaking for that case.
```

[![@tillkruss](https://avatars.githubusercontent.com/u/665029?s=80&u=d532197bbfe5348e7dc120fa65cd91ddcd211e2d&v=4)](/tillkruss)

Copy link

Contributor

### **[tillkruss](/tillkruss)** commented [May 3, 2017](#issuecomment-298960780)

| Great work man! |
| --- |

 ❤️
2
 aidantwoods and m1guelpf reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

[![erusev](https://avatars.githubusercontent.com/u/184170?s=60&v=4)](/erusev)

**[erusev](/erusev)**
reviewed
[May 3, 2017](#pullrequestreview-36071661)

 [View reviewed changes](/erusev/parsedown/pull/495/files/054ba3c48729036fd8ab1166fb0b1d0b4dd1e465)

[Parsedown.php](/erusev/parsedown/pull/495/files/054ba3c48729036fd8ab1166fb0b1d0b4dd1e465#diff-d05e59fb20b425d57518ff235926af1b16a85d923bc7c6555d1a71a2838e9ef3)
Outdated

|  |  |  |
| --- | --- | --- |
|  |  | if ( ! $safe) |
|  |  | { |
|  |  | $Element['attributes'][$attribute] = preg\_replace\_callback( |

Copy link

Owner

### @erusev **[erusev](/erusev)** [May 3, 2017](#discussion_r114591855) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Can we find a simpler alternative to `preg_replace_callback`? Something that doesn't require passing a function definition as a parameter - perhaps `preg_match`.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114593032) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

The current way it's set out is to have a whitelist of characters we don't want to encode (and encode everything else).

I could achieve the same result with `strpbrk` and encoding done on ranges of the string, not sure that would be faster though. Unless you have another idea?

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114593729)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Ah sorry, didn't see your edit.

Could do it with preg\_match\_all with match positions returned and applying encoding to those ranges, again, not sure it'll be faster?

P.S. the regex will match as many chars as it can in one go before making the function call at present

Sorry, something went wrong.

All reactions

Copy link

Collaborator

Author

### @aidantwoods **[aidantwoods](/aidantwoods)** [May 3, 2017](#discussion_r114617894) • edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

[@erusev](https://github.com/erusev) this would be an alternative using `preg_match_all`

```
if (
    preg_match_all(
        '/[^\/#?&=%]++/',
        $Element['attributes'][$attribute],
        $matches,
        PREG_OFFSET_CAPTURE
    )
) {
    $offset = 0;

    foreach ($matches[0] as $match)
    {
        $len = strlen($match[0]);
        $encoded = urlencode($match[0]);

        $Element['attributes'][$attribute] = substr_replace(
            $Element['attributes'][$attribute],
            $encoded,
            $offset + $match[1],
            $len
        );

        $offset += strlen($encoded) - $len;
    }
}
```

More likely to introduce bugs with this though IMO, and I'm not sure it'll save that much on performance just looking at it.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @PhrozenByte **[PhrozenByte](/PhrozenByte)** [May 3, 2017](#discussion_r114666510)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I'm pretty sure `preg_replace_callback()` is the easiest and fastest solution here 😉

Sorry, something went wrong.

All reactions

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [May 3, 2017](#issuecomment-298965452)

| [054ba3c](https://github.com/erusev/parsedown/commit/054ba3c48729036fd8ab1166fb0b1d0b4dd1e465) is borrowed from one of [my projects](https://github.com/Parsemd/Parsemd/blob/060eda3cf7308bba02ed8a45c4873b412a6b8e96/src/DisplayAsHtml.php#L111-L140), which isn't something that's got a release version yet – so we should add some tests to verify that this code does indeed have non breaking behaviour. |
| --- |

All reactions

Sorry, something went wrong.

82 hidden items

Load more…

[![@malas](https://avatars.githubusercontent.com/u/191164?s=80&v=4)](/malas)

Copy link

### **[malas](/malas)** commented [Feb 26, 2018](#issuecomment-368642957)

| [@h4ckninja](https://github.com/h4ckninja) my bad. i think i owe a beer for [@aidantwoods](https://github.com/aidantwoods) :) |
| --- |

 👍
1
 h4ckninja reacted with thumbs up emoji
 ❤️
1
 aidantwoods reacted with heart emoji

All reactions

* 👍
  1 reaction
* ❤️
  1 reaction

Sorry, something went wrong.

[![@garygreen](https://avatars.githubusercontent.com/u/1702638?s=80&u=c52e2d8a21e6da0ba2c881b4afe26cc625c416f7&v=4)](/garygreen)

Copy link

### **[garygreen](/garygreen)** commented [Feb 26, 2018](#issuecomment-368643451)

| I'd prefer not to have to argue about this being a bug here though.  Not sure why you thought I was raising an argument? I was simply asking how complex is this implemention and does it pass known XSS problems... I certainly don't want to stamp on your hard work here as you've put a lot of effort into the commit. I just wanted to highlight that XSS is a complex problem and people should be aware of all the exploits and that this PR might not solve every possible one (your more qualified to answer that question though) 😄 |
| --- |

All reactions

Sorry, something went wrong.

[![@h4ckninja](https://avatars.githubusercontent.com/u/41105?s=80&u=d4399f5450c93be67469b630b30a9d2251ac829a&v=4)](/h4ckninja)

Copy link

### **[h4ckninja](/h4ckninja)** commented [Feb 26, 2018](#issuecomment-368643713)

| my bad. i think i owe a beer for [@aidantwoods](https://github.com/aidantwoods) :)  All good. :) This is why I think this discussion was useful - to make sure we all understand each other and what's going on. |
| --- |

 👍
1
 aidantwoods reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [Feb 26, 2018](#issuecomment-368645874) • edited Loading

| [@garygreen](https://github.com/garygreen)  Not sure why you thought I was raising an argument?  I apologise for the rushed messaged, I meant to tack the bit about arguing on at the end as as a more general point (but not directed at you) and realised it looked otherwise after posting. I sort of rephrased my comment in an edit afterward, which I hope it is a little friendlier. Again, sorry for the apparent hostility – my bad :)   ---   [@h4ckninja](https://github.com/h4ckninja) is probably right though, as long as we're making progress then there's value in having the discussion :) |
| --- |

All reactions

Sorry, something went wrong.

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=80&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)

Copy link

Collaborator

Author

### **[aidantwoods](/aidantwoods)** commented [Feb 26, 2018](#issuecomment-368652288)

| [@garygreen](https://github.com/garygreen)  I just wanted to highlight that XSS is a complex problem and people should be aware of all the exploits and that this PR might not solve every possible one  As far as I am aware this patch should solve all XSS issues in Parsedown (when safe mode is enabled), but I invite you (and others) to prove me wrong, and in that case I'll try my best fix whatever issues you find.  The idea behind safe mode is so that it is clear to the user when output is safe from untrusted user input (as opposed to introducing lots of confusing options like: remember to enable markup escaping, and link destination validation, plus all the new features we didn't realise we need to make the output safe that we're going to add in bug fixes etc..., or by just leaving the user to figure it out themselves and go wrong).  I prefer it be simple: If you can achieve XSS with safe mode enabled, it is a bug in safe mode. It should be fixed (and is also thus fixable without breaking backwards compatibility).  As a defence in depth measure, as a user you can also run something like HTMLPurifier on Parsedown's output, and deploy a CSP. But these should be backup measures, safe mode should do the heavy lifting. |
| --- |

 👍
3
 embluk, MiguelMike, and paveljanda reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

Sorry, something went wrong.

[![@dennishenry](https://avatars.githubusercontent.com/u/4305001?s=80&u=3d26bcdb986defd913cec08158de6099e142f0c6&v=4)](/dennishenry)

Copy link

### **[dennishenry](/dennishenry)** commented [Feb 27, 2018](#issuecomment-368829728)

| This issue is now causing a SensioLabs Composer Vuinerability Check to fail at our organization.  ``` [ERROR] 1 packages have known vulnerabilities.                                   erusev/parsedown (1.6.4) ------------------------   * (no CVE ID): Cross-Site Scripting    https://github.com/erusev/parsedown/pull/495  ```  Is there any potential ETA on merging this and tagging a new release so this can be cleared? Thank you! |
| --- |

 👍
7
 paveljanda, henikolett, pilec, mirsch, gpkoltermann, bmitch, and tcitworld reacted with thumbs up emoji

All reactions

* 👍
  7 reactions

Sorry, something went wrong.

[![@taylorotwell](https://avatars.githubusercontent.com/u/463230?s=80&u=8b44c0b2f4938e91d8dff0d9667c95f571358c86&v=4)](/taylorotwell)

Copy link

### **[taylorotwell](/taylorotwell)** commented [Feb 27, 2018](#issuecomment-369011610)

| [@erusev](https://github.com/erusev) click merge. tag release. 👏 |
| --- |

 😄
3
 Numline1, m1guelpf, and paveljanda reacted with laugh emoji

All reactions

* 😄
  3 reactions

Sorry, something went wrong.

[![@taylorotwell](https://avatars.githubusercontent.com/u/463230?s=80&u=8b44c0b2f4938e91d8dff0d9667c95f571358c86&v=4)](/taylorotwell)

Copy link

### **[taylorotwell](/taylorotwell)** commented [Feb 27, 2018](#issuecomment-369012124)

| [@aidantwoods](https://github.com/aidantwoods) are these fixes merged on your fork? is your fork available on Packagist? Do you plan to maintain it? |
| --- |

 👍
1
 paveljanda reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@erusev](https://avatars.githubusercontent.com/u/184170?s=40&u=371a2d254c265973cdd81820ce8ece52d94e9b2f&v=4)](/erusev)
[erusev](/erusev)
merged commit [`6678d59`](/erusev/parsedown/commit/6678d59be48c4be64eaca6ce70bea48a09488cc2)
into
erusev:master

[Feb 28, 2018](https://github.com/erusev/parsedown/pull/495#event-1496522450)

[![@dennishenry](https://avatars.githubusercontent.com/u/4305001?s=80&u=3d26bcdb986defd913cec08158de6099e142f0c6&v=4)](/dennishenry)

Copy link

### **[dennishenry](/dennishenry)** commented [Feb 28, 2018](#issuecomment-369214575)

| Thank you [@erusev](https://github.com/erusev) for merging this and your hard work on the utility as a whole! |
| --- |

 👍
1
 parseword reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@erusev](https://avatars.githubusercontent.com/u/184170?s=80&u=371a2d254c265973cdd81820ce8ece52d94e9b2f&v=4)](/erusev)

Copy link

Owner

### **[erusev](/erusev)** commented [Feb 28, 2018](#issuecomment-369215949) • edited Loading

| [@taylorotwell](https://github.com/taylorotwell)  [@erusev](https://github.com/erusev) click merge. tag release. 👏  Done.  I apologize for being so slow to react to this. I'll do my best to react more quickly in future and I'll also consider adding more maintainers, [@aidantwoods](https://github.com/aidantwoods), you've been so helpful, are you interested? |
| --- |

 👍
13
 henikolett, m1guelpf, levacic, ocramleznem, KarimGeiger, paragonie-scott, JeppeKnockaert, embluk, bobdenotter, aidantwoods, and 3 more reacted with thumbs up emoji
 🎉
9
 dregad, m1guelpf, levacic, ocramleznem, embluk, bobdenotter, PhrozenByte, aidantwoods, and famoser reacted with hooray emoji
 ❤️
5
 ocramleznem, embluk, bobdenotter, PhrozenByte, and aidantwoods reacted with heart emoji

All reactions

* 👍
  13 reactions
* 🎉
  9 reactions
* ❤️
  5 reactions

Sorry, something went wrong.

[![@stefandoorn](https://avatars.githubusercontent.com/u/4903082?s=80&u=6970dc1757539a7393270f8ea4510bc86377cf01&v=4)](/stefandoorn)

Copy link

### **[stefandoorn](/stefandoorn)** commented [Feb 28, 2018](#issuecomment-369216132)

| Thanks [@erusev](https://github.com/erusev)! |
| --- |

All reactions

Sorry, something went wrong.

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=80&v=4)](/dregad)

Copy link

### **[dregad](/dregad)** commented [Feb 28, 2018](#issuecomment-369219166) • edited Loading

| [@erusev](https://github.com/erusev) Thank you, and as a next step if you could have a look at [#553](https://github.com/erusev/parsedown/issues/553) and do the same for the other PRs listed there as well it would be awesome ! |
| --- |

 👍
3
 erusev, embluk, and bobdenotter reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

Sorry, something went wrong.

[![@dariuszp](https://avatars.githubusercontent.com/u/249863?s=80&u=2438598cf4a88bd9a679aed05af34ca0830fbec6&v=4)](/dariuszp)

Copy link

### **[dariuszp](/dariuszp)** commented [Feb 28, 2018](#issuecomment-369221945)

| I just got notification and I was asking myself - why? Then I notice that I was asking about the progress around 2015 :-) Good job! Still I moved away from this project long ago. Parsedown is not safe and should not be used on production. |
| --- |

All reactions

Sorry, something went wrong.

[![@taylorotwell](https://avatars.githubusercontent.com/u/463230?s=80&u=8b44c0b2f4938e91d8dff0d9667c95f571358c86&v=4)](/taylorotwell)

Copy link

### **[taylorotwell](/taylorotwell)** commented [Feb 28, 2018](#issuecomment-369261996)

| [@erusev](https://github.com/erusev) you are a hero 👍 |
| --- |

 ❤️
3
 erusev, embluk, and m1guelpf reacted with heart emoji

All reactions

* ❤️
  3 reactions

Sorry, something went wrong.

[![@embluk](https://avatars.githubusercontent.com/u/23347020?s=80&u=15a0028df07a9872a569c6dbf397f7a0108a4fc3&v=4)](/embluk)

Copy link

### **[embluk](/embluk)** commented [Feb 28, 2018](#issuecomment-369270873) • edited Loading

| Thank you for merging this update 👍  Also should we not add to the readme about using safe mode? |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Feb 28, 2018

[How secure is this?
#418](/erusev/parsedown/issues/418)

Closed

[Fix tests and update for compatibility with upcoming 1.8.0 release
erusev/parsedown-extra#117](/erusev/parsedown-extra/pull/117)
 Merged

[![@AlfredoRamos](https://avatars.githubusercontent.com/u/4165935?s=40&v=4)](/AlfredoRamos)
[AlfredoRamos](/AlfredoRamos)
mentioned this pull request
[Mar 3, 2018](#ref-issue-302029196)

[Escaped HTML in footnotes
erusev/parsedown-extra#118](/erusev/parsedown-extra/issues/118)

Closed

[tusbar](/tusbar)
added a commit
to tusbar/BuildSize
that referenced
this pull request
[Mar 6, 2018](#ref-commit-3b6d477)
[![@tusbar](https://avatars.githubusercontent.com/u/166147?s=40&u=59b5c69cec373542d175b43bf98c559c182522d6&v=4)](/tusbar)

`[Update phpro/grumphp to ^0.14](/tusbar/BuildSize/commit/3b6d47709739bdd3353361ea044246b4e61ef3af "Update phpro/grumphp to ^0.14

Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see https://github.com/erusev/parsedown/pull/495).

This allows dependencies to be installed successfully on CircleCI.")`
…

`[3b6d477](/tusbar/BuildSize/commit/3b6d47709739bdd3353361ea044246b4e61ef3af)`

```
Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see [erusev/parsedown#495](https://github.com/erusev/parsedown/pull/495)).

This allows dependencies to be installed successfully on CircleCI.
```

[tusbar](/tusbar)
added a commit
to tusbar/BuildSize
that referenced
this pull request
[Mar 6, 2018](#ref-commit-e755735)
[![@tusbar](https://avatars.githubusercontent.com/u/166147?s=40&u=59b5c69cec373542d175b43bf98c559c182522d6&v=4)](/tusbar)

`[Update phpro/grumphp to ^0.14](/tusbar/BuildSize/commit/e755735c8dc78297393983c9e4147811fb179238 "Update phpro/grumphp to ^0.14

Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see https://github.com/erusev/parsedown/pull/495).

This allows dependencies to be installed successfully on CircleCI.")`
…

`[e755735](/tusbar/BuildSize/commit/e755735c8dc78297393983c9e4147811fb179238)`

```
Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see [erusev/parsedown#495](https://github.com/erusev/parsedown/pull/495)).

This allows dependencies to be installed successfully on CircleCI.
```

[![@tusbar](https://avatars.githubusercontent.com/u/166147?s=40&u=59b5c69cec373542d175b43bf98c559c182522d6&v=4)](/tusbar)
[tusbar](/tusbar)
mentioned this pull request
[Mar 6, 2018](#ref-pullrequest-302515977)

[Add CircleCI build
Daniel15/BuildSize#39](/Daniel15/BuildSize/pull/39)
 Merged

[Daniel15](/Daniel15)
pushed a commit
to Daniel15/BuildSize
that referenced
this pull request
[Mar 6, 2018](#ref-commit-5dea22e)
[![@tusbar](https://avatars.githubusercontent.com/u/166147?s=40&u=59b5c69cec373542d175b43bf98c559c182522d6&v=4)](/tusbar) [![@Daniel15](https://avatars.githubusercontent.com/u/91933?s=40&v=4)](/Daniel15)

`[Add CircleCI build (](/Daniel15/BuildSize/commit/5dea22e116e82a6472c95eb0db0454169f971eff "Add CircleCI build (#39)

* Run phpunit on circleci

* Update phpro/grumphp to ^0.14

Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see https://github.com/erusev/parsedown/pull/495).

This allows dependencies to be installed successfully on CircleCI.

* Disable all library hooks besides curl for tests")[#39](https://github.com/Daniel15/BuildSize/pull/39)[)](/Daniel15/BuildSize/commit/5dea22e116e82a6472c95eb0db0454169f971eff "Add CircleCI build (#39)

* Run phpunit on circleci

* Update phpro/grumphp to ^0.14

Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see https://github.com/erusev/parsedown/pull/495).

This allows dependencies to be installed successfully on CircleCI.

* Disable all library hooks besides curl for tests")`
…

`[5dea22e](/Daniel15/BuildSize/commit/5dea22e116e82a6472c95eb0db0454169f971eff)`

```
* Run phpunit on circleci

* Update phpro/grumphp to ^0.14

Also update erusev/parsedown to ^1.7 as ^1.6 had a XSS vulnerability
(see [erusev/parsedown#495](https://github.com/erusev/parsedown/pull/495)).

This allows dependencies to be installed successfully on CircleCI.

* Disable all library hooks besides curl for tests
```

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[Mar 18, 2018](#ref-pullrequest-306293337)

[Remove legacy escaping
#574](/erusev/parsedown/pull/574)
 Merged

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[Mar 28, 2018](#ref-pullrequest-34504765)

[Added safe mode
#177](/erusev/parsedown/pull/177)
 Closed

[![@dregad](https://avatars.githubusercontent.com/u/449891?s=40&v=4)](/dregad)
[dregad](/dregad)
mentioned this pull request
[Mar 29, 2018](#ref-issue-309744861)

[CVE-ID for recent XSS issues ?
#590](/erusev/parsedown/issues/590)

Closed

[![@Ekultek](https://avatars.githubusercontent.com/u/14183473?s=40&v=4)](/Ekultek)
[Ekultek](/Ekultek)
mentioned this pull request
[Dec 5, 2018](#ref-issue-387805126)

[Inconsistent behavior of multiple backticks
cebe/markdown#166](/cebe/markdown/issues/166)

Open

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[Feb 22, 2019](#ref-issue-395896244)

[Changelog for 1.7.0?
#689](/erusev/parsedown/issues/689)

Closed

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
mentioned this pull request
[Apr 2, 2019](#ref-issue-370904432)

[URL parameter separator encoded incorrectly
#672](/erusev/parsedown/issues/672)

Closed

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=40&u=1cf84b2c9528af7fbbec25393894b7cf0c7e8c4d&v=4)](/aidantwoods)
[aidantwoods](/aidantwoods)
added
the
[security](/erusev/parsedown/labels/security)
label
[Apr 8, 2019](#event-2261082502)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ferusev%2Fparsedown%2Fpull%2F495)

Reviewers

[![@tillkruss](https://avatars.githubusercontent.com/u/665029?s=40&v=4)](/tillkruss) [tillkruss](/tillkruss)

tillkruss left review comments

[![@erusev](https://avatars.githubusercontent.com/u/184170?s=40&v=4)](/erusev) [erusev](/erusev)

erusev left review comments

[![@PhrozenByte](https://avatars.githubusercontent.com/u/920356?s=40&v=4)](/PhrozenByte) [PhrozenByte](/PhrozenByte)

PhrozenByte approved these changes

[![@hkdobrev](https://avatars.githubusercontent.com/u/506129?s=40&v=4)](/hkdobrev) [hkdobrev](/hkdobrev)

hkdobrev approved these changes

Assignees

No one assigned

Labels

[security](/erusev/parsedown/labels/security)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Cross-site scripting vulnerability in ParseDown](https://github.com/erusev/parsedown/issues/530)

 [Link allows javascript which could lead to XSS issues](https://github.com/erusev/parsedown/issues/497)

 [Safe Mode](https://github.com/erusev/parsedown/issues/161)

23 participants

[![@aidantwoods](https://avatars.githubusercontent.com/u/3288888?s=52&v=4)](/aidantwoods) [![@tillkruss](https://avatars.githubusercontent.com/u/665029?s=52&v=4)](/tillkruss) [![@m1guelpf](https://avatars.githubusercontent.com/u/23558090?s=52&v=4)](/m1guelpf) [![@hkdobrev](https://avatars.githubusercontent.com/u/506129?s=52&v=4)](/hkdobrev) [![@erusev](https://avatars.githubusercontent.com/u/184170?s=52&v=4)](/erusev) [![@Daniel-KM](https://avatars.githubusercontent.com/u/2138485?s=52&v=4)](/Daniel-KM) [![@dregad](https://avatars.githubusercontent.com/u/449891?s=52&v=4)](/dregad) [![@h4ckninja](https://avatars.githubusercontent.com/u/41105?s=52&v=4)](/h4ckninja) [![@embluk](https://avatars.githubusercontent.com/u/23347020?s=52&v=4)](/embluk) [![@sergeysviridenko](https://avatars.githubusercontent.com/u/26042973?s=52&v=4)](/sergeysviridenko) [![@levacic](https://avatars.githubusercontent.com/u/1636354?s=52&v=4)](/levacic) [![@Bonscho](https://avatars.githubusercontent.com/u/5921241?s=52&v=4)](/Bonscho) [![@Numline1](https://avatars.githubusercontent.com/u/12192684?s=52&v=4)](/Numline1) [![@donatj](https://avatars.githubusercontent.com/u/133747?s=52&v=4)](/donatj) [![@malas](https://avatars.githubusercontent.com/u/191164?s=52&v=4)](/malas) [![@garygreen](https://avatars.githubusercontent.com/u/1702638?s=52&v=4)](/garygreen) [![@eagostini](https://avatars.githubusercontent.com/u/3128457?s=52&v=4)](/eagostini) [![@dennishenry](https://avatars.githubusercontent.com/u/4305001?s=52&v=4)](/dennishenry) [![@taylorotwell](https://avatars.githubusercontent.com/u/463230?s=52&v=4)](/taylorotwell) [![@stefandoorn](https://avatars.githubusercontent.com/u/4903082?s=52&v=4)](/stefandoorn) [![@dariuszp](https://avatars.githubusercontent.com/u/249863?s=52&v=4)](/dariuszp) [![@PhrozenByte](https://avatars.githubusercontent.com/u/920356?s=52&v=4)](/PhrozenByte) [![@naNuke](https://avatars.githubusercontent.com/u/4591126?s=52&v=4)](/naNuke)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


