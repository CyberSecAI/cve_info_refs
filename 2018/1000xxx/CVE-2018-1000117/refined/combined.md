=== Content from bugs.python.org_410dcfc2_20250124_161821.html ===

# [homepage](.)

open

all

* [Python Home](https://www.python.org/ "Go to the Python homepage")
* [About](https://www.python.org/about/ "About The Python Language")
* [News](https://www.python.org/blogs/)
* [Documentation](https://www.python.org/doc/)
* [Downloads](https://www.python.org/downloads/)
* [Community](https://www.python.org/community/)
* [Foundation](https://www.python.org/psf/ "Python Software Foundation")
* [Developer's Guide](https://devguide.python.org/ "Python Developer's Guide")
* [Issue Tracker](. "Python Issue Tracker")
  + **Issues**
    - [Search](issue?@template=search&status=1)
    - [Random Issue](issue?@action=random)
  + **Summaries**
    - [Issues with patch](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Issues%20with%20patch&@startwith=0&@group=priority&keywords=2&@action=search&@filter=&@pagesize=50)
    - [Easy issues](issue?status=1&@sort=-activity&@columns=id%2Cgithub%2Cactivity%2Ctitle%2Ccreator%2Cstatus&@dispname=Easy%20issues&@startwith=0&@group=priority&keywords=6&@action=search&@filter=&@pagesize=50)
    - [Stats](issue?@template=stats)
  + **User**
    - Login

      Remember me?
    - [Lost your login?](user?@template=forgotten)
  + **Administration**
    - [User List](user?@sort=username)
    - [Committer List](user?iscommitter=1&@action=search&@sort=username&@pagesize=300)
  + **Help**
    - [Tracker Documentation](http://docs.python.org/devguide/triaging.html)
    - [Tracker Development](http://wiki.python.org/moin/TrackerDevelopment)
    - [Report Tracker Problem](https://github.com/python/psf-infra-meta/issues)

Issue33001

![](@@file/python-logo-small.png)
➜
[![](@@file/gh-icon.png)](https://github.com/python/cpython/issues)

This issue tracker **has been migrated to [GitHub](https://github.com/python/cpython/issues)**,
and is currently **read-only**.

For more information, [see the GitHub FAQs in the Python's Developer Guide.](https://devguide.python.org/gh-faq/ "GitHub FAQs")

[![](@@file/gh-icon.png)

This issue has been migrated to GitHub:
https://github.com/python/cpython/issues/77182](https://github.com/python/cpython/issues/77182)

classification

| [Title](http://docs.python.org/devguide/triaging.html#title): | Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117) | | |
| --- | --- | --- | --- |
| [Type](http://docs.python.org/devguide/triaging.html#type): | security | [Stage](http://docs.python.org/devguide/triaging.html#stage): | resolved |
| [Components](http://docs.python.org/devguide/triaging.html#components): | Windows | [Versions](http://docs.python.org/devguide/triaging.html#versions): | Python 3.8, Python 3.7, Python 3.6, Python 3.4, Python 3.5 |

process

| [Status](http://docs.python.org/devguide/triaging.html#status): | closed | [Resolution](http://docs.python.org/devguide/triaging.html#resolution): | fixed |
| --- | --- | --- | --- |
| [Dependencies](http://docs.python.org/devguide/triaging.html#dependencies): |  | [Superseder](http://docs.python.org/devguide/triaging.html#superseder): |  |
| [Assigned To](http://docs.python.org/devguide/triaging.html#assigned-to): | steve.dower | [Nosy List](http://docs.python.org/devguide/triaging.html#nosy-list): | eryksun, izbyshev, larry, miss-islington, ned.deily, paul.moore, steve.dower, tim.golden, vstinner, zach.ware |
| [Priority](http://docs.python.org/devguide/triaging.html#priority): | critical | [Keywords](http://docs.python.org/devguide/triaging.html#keywords): | patch, security\_issue |

Created on **2018-03-05 18:04** by **steve.dower**, last changed **2022-04-11 14:58** by **admin**. This issue is now **closed**.

| Pull Requests | | | |
| --- | --- | --- | --- |
| URL | Status | Linked | Edit |
| [PR 5989](https://github.com/python/cpython/pull/5989 "bpo-33001: Minimal fix to prevent buffer overrun in os.symlink") | merged | steve.dower, 2018-03-05 18:10 |  |
| [PR 5990](https://github.com/python/cpython/pull/5990 "[3.6] bpo-33001: Minimal fix to prevent buffer overrun in os.symlink (GH-5989)") | merged | steve.dower, 2018-03-05 18:16 |  |
| [PR 5991](https://github.com/python/cpython/pull/5991 "[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)") | merged | steve.dower, 2018-03-05 18:17 |  |
| [PR 5992](https://github.com/python/cpython/pull/5992 "[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)") | merged | steve.dower, 2018-03-05 18:24 |  |
| [PR 5996](https://github.com/python/cpython/pull/5996 "[3.7] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)") | merged | miss-islington, 2018-03-05 22:27 |  |

| Messages (14) | | | |
| --- | --- | --- | --- |
| [msg313275](#msg313275) - [(view)](msg313275) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-05 18:04 |
| ``` On February 27th, 2018, the Python Security Response team was notified of a buffer overflow issue in the os.symlink() method on Windows. The issue affects all versions of Python between 3.2 and 3.6.4, including the 3.7 beta releases. It will be patched for the next releases of 3.4, 3.5, 3.6 and 3.7.  Scripts may be vulnerable if they use os.symlink() on Windows and an attacker is able to influence the location where links are created. As os.symlink requires administrative privileges on most versions of Windows, exploits using this vulnerability are likely to achieve escalation of privilege.  Besides applying the fix to CPython, scripts can also ensure that the length of each path argument is less than 260, and if the source is a relative path, that its combination with the destination is also shorter than 260 characters. That is:      assert (len(src) < 260 and             len(dest) < 260 and             len(os.path.join(os.path.dirname(dest), src)) < 260)     os.symlink(src, dest)  Scripts that explicitly pass the target_is_directory argument as True are not vulnerable. Also, scripts on Python 3.5 that use bytes for paths are not vulnerable, because of a combination of stack layout and added parameter validation.  I will be requesting a CVE for this once the patches are applied to maintenance branches, and then notifying the security-announce list. The patch has been reviewed by the PSRT and reporter, and while it prevents the buffer overflow, it does not raise any new errors or enable the use of long paths when creating symlinks.  Many thanks to Alexey Izbyshev for the report, and helping us work through developing the patch. ``` | | | |
| [msg313279](#msg313279) - [(view)](msg313279) | Author: Alexey Izbyshev (izbyshev) \* (Python triager) | Date: 2018-03-05 19:06 |
| ``` While judging by the source code it seems that bytes in 3.5 should be fine, I've got a crash with the latest binary from python.org:  Python 3.5.4 (v3.5.4:3f56838, Aug  8 2017, 02:17:05) [MSC v.1900 64 bit (AMD64)]  on win32 Type "help", "copyright", "credits" or "license" for more information. >>> import os >>> os.symlink(b'x\\' * 129, b'y\\' * 129) (Windows pop-up here) ``` | | | |
| [msg313281](#msg313281) - [(view)](msg313281) | Author: Alexey Izbyshev (izbyshev) \* (Python triager) | Date: 2018-03-05 19:24 |
| ``` > As os.symlink requires administrative privileges on most versions of Windows  The current implementation requires SeCreateSymbolicLinkPrivilege on ALL versions of Windows because users must pass an additional flag to CreateSymbolicLink to enable non-privileged symlinks on recent Windows 10, which os.symlink() doesn't do (see [#31512](issue31512 "[closed] Add non-elevated symlink support for dev mode Windows 10")). ``` | | | |
| [msg313282](#msg313282) - [(view)](msg313282) | Author: Eryk Sun (eryksun) \* (Python triager) | Date: 2018-03-05 19:46 |
| ``` >> As os.symlink requires administrative privileges on most versions  >> of Windows > > The current implementation requires SeCreateSymbolicLinkPrivilege on  > ALL versions of Windows because users must pass an additional flag to  > CreateSymbolicLink to enable non-privileged symlinks on recent Windows > 10, which os.symlink() doesn't do (see [#31512](issue31512 "[closed] Add non-elevated symlink support for dev mode Windows 10")).  The change in Windows 10 to allow unprivileged creation of links will be supported implicitly in 3.7, but this change is more for convenience than necessity. SeCreateSymbolicLinkPrivilege can be granted to standard users and groups. On my own systems, I grant this privilege to the "Authenticated Users" (S-1-5-11) well-known group. This even allows administrators to create symbolic links without having to elevate. ``` | | | |
| [msg313291](#msg313291) - [(view)](msg313291) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-05 22:26 |
| ```  New changeset [6921e73e33edc3c61bc2d78ed558eaa22a89a564](https://hg.python.org/lookup/6921e73e33edc3c61bc2d78ed558eaa22a89a564) by Steve Dower in branch 'master': [bpo-33001](issue33001 "[closed] Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)"): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989 "GitHub PR 5989: [open] bpo-24147: Document csv Dialect class defaults. Patch by Brandon Milam")) <https://github.com/python/cpython/commit/6921e73e33edc3c61bc2d78ed558eaa22a89a564>  ``` | | | |
| [msg313292](#msg313292) - [(view)](msg313292) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-05 22:26 |
| ```  New changeset [baa45079466eda1f5636a6d13f3a60c2c00fdcd3](https://hg.python.org/lookup/baa45079466eda1f5636a6d13f3a60c2c00fdcd3) by Steve Dower in branch '3.6': [3.6] [bpo-33001](issue33001 "[closed] Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)"): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989 "GitHub PR 5989: [open] bpo-24147: Document csv Dialect class defaults. Patch by Brandon Milam")) ([GH-5990](https://github.com/python/cpython/pull/5990 "GitHub PR 5990: [open] bpo-44075: Add asyncio.stalled audit hook")) <https://github.com/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3>  ``` | | | |
| [msg313293](#msg313293) - [(view)](msg313293) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-05 22:30 |
| ``` Patches are merged, except for the ones that belong to @Larry.  Thanks again Alexey for the final round of feedback! ``` | | | |
| [msg313298](#msg313298) - [(view)](msg313298) | Author: miss-islington (miss-islington) | Date: 2018-03-05 23:13 |
| ```  New changeset [96fdbacb7797a564249fd59ccf86ec153c4bb095](https://hg.python.org/lookup/96fdbacb7797a564249fd59ccf86ec153c4bb095) by Miss Islington (bot) in branch '3.7': [bpo-33001](issue33001 "[closed] Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)"): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989 "GitHub PR 5989: [open] bpo-24147: Document csv Dialect class defaults. Patch by Brandon Milam")) <https://github.com/python/cpython/commit/96fdbacb7797a564249fd59ccf86ec153c4bb095>  ``` | | | |
| [msg313368](#msg313368) - [(view)](msg313368) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-07 00:23 |
| ``` FYI, the CVE number for this issue is CVE-2018-1000117. ``` | | | |
| [msg313398](#msg313398) - [(view)](msg313398) | Author: STINNER Victor (vstinner) \* (Python committer) | Date: 2018-03-07 20:44 |
| ``` FYI I added this vulnerability to: <http://python-security.readthedocs.io/vuln/cve-2018-1000117_buffer_overflow_vulnerability_in_os.symlink_on_windows.html> <https://github.com/vstinner/python-security/commit/349588e8265099341801b20aa18f87a42176f7df> ``` | | | |
| [msg313415](#msg313415) - [(view)](msg313415) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-03-08 02:06 |
| ``` Thanks, Victor! ``` | | | |
| [msg316539](#msg316539) - [(view)](msg316539) | Author: Larry Hastings (larry) \* (Python committer) | Date: 2018-05-14 17:26 |
| ```  New changeset [77c02cdce2d7b8360771be35b7676a4977e070c1](https://hg.python.org/lookup/77c02cdce2d7b8360771be35b7676a4977e070c1) by larryhastings (Steve Dower) in branch '3.4': [3.4] [bpo-33001](issue33001 "[closed] Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)"): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989 "GitHub PR 5989: [open] bpo-24147: Document csv Dialect class defaults. Patch by Brandon Milam")) ([#5992](issue5992 "[closed] spurious space after opening parenthesis when auto-completing")) <https://github.com/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1>  ``` | | | |
| [msg316543](#msg316543) - [(view)](msg316543) | Author: Larry Hastings (larry) \* (Python committer) | Date: 2018-05-14 18:03 |
| ```  New changeset [f381cfe07d15d52f27de771a62a8167668f0dd51](https://hg.python.org/lookup/f381cfe07d15d52f27de771a62a8167668f0dd51) by larryhastings (Steve Dower) in branch '3.5': [3.5] [bpo-33001](issue33001 "[closed] Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)"): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989 "GitHub PR 5989: [open] bpo-24147: Document csv Dialect class defaults. Patch by Brandon Milam")) ([#5991](issue5991 "[closed] Add non-command help topics to help completion of cmd.Cmd")) <https://github.com/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51>  ``` | | | |
| [msg317958](#msg317958) - [(view)](msg317958) | Author: Steve Dower (steve.dower) \* (Python committer) | Date: 2018-05-28 23:25 |
| ``` Thanks Larry for merging the backports! ``` | | | |

| History | | | |
| --- | --- | --- | --- |
| Date | User | Action | Args |
| 2022-04-11 14:58:58 | admin | set | github: 77182 |
| 2019-05-10 18:06:59 | ned.deily | set | messages: - <msg342103> |
| 2019-05-10 17:36:39 | ned.deily | set | nosy: + [ned.deily](user5248)messages: + <msg342103> |
| 2018-05-28 23:25:42 | steve.dower | set | status: open -> closedresolution: fixedmessages: + <msg317958>stage: patch review -> resolved |
| 2018-05-14 18:03:20 | larry | set | messages: + <msg316543> |
| 2018-05-14 17:26:46 | larry | set | messages: + <msg316539> |
| 2018-03-08 02:06:53 | steve.dower | set | messages: + <msg313415> |
| 2018-03-07 20:44:23 | vstinner | set | nosy: + [vstinner](user2377)messages: + <msg313398> |
| 2018-03-07 00:23:41 | steve.dower | set | messages: + <msg313368>title: Buffer overflow vulnerability in os.symlink on Windows -> Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117) |
| 2018-03-05 23:13:02 | miss-islington | set | nosy: + [miss-islington](user27838)messages: + <msg313298> |
| 2018-03-05 22:30:23 | steve.dower | set | nosy: + [larry](user2731)messages: + <msg313293> |
| 2018-03-05 22:27:19 | miss-islington | set | pull\_requests: + <pull_request5762> |
| 2018-03-05 22:26:30 | steve.dower | set | messages: + <msg313292> |
| 2018-03-05 22:26:17 | steve.dower | set | messages: + <msg313291> |
| 2018-03-05 19:46:11 | eryksun | set | nosy: + [eryksun](user16413)messages: + <msg313282> |
| 2018-03-05 19:24:41 | izbyshev | set | messages: + <msg313281> |
| 2018-03-05 19:06:10 | izbyshev | set | messages: + <msg313279> |
| 2018-03-05 18:24:32 | steve.dower | set | pull\_requests: + <pull_request5759> |
| 2018-03-05 18:17:10 | steve.dower | set | pull\_requests: + <pull_request5758> |
| 2018-03-05 18:16:17 | steve.dower | set | pull\_requests: + <pull_request5757> |
| 2018-03-05 18:10:03 | steve.dower | set | keywords: + [patch](keyword2)stage: patch reviewpull\_requests: + <pull_request5756> |
| 2018-03-05 18:04:42 | steve.dower | create |  |

Supported by [The Python Software Foundation](https://python.org/psf-landing/ "The Python Software Foundation"),

Powered by [Roundup](http://roundup.sourceforge.net "Powered by the Roundup Issue Tracker")

Copyright © 1990-2022, [Python Software Foundation](http://python.org/psf)



=== Content from github.com_86ca131b_20250126_020902.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F5989)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F5989)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.9k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# bpo-33001: Minimal fix to prevent buffer overrun in os.symlink #5989

 Merged

[zooba](/zooba)
merged 3 commits into
[python:master](/python/cpython/tree/master "python/cpython:master")
from
[zooba:symlink-bug](/zooba/cpython/tree/symlink-bug "zooba/cpython:symlink-bug")

Mar 5, 2018

 Merged

# [bpo-33001: Minimal fix to prevent buffer overrun in os.symlink](#top) #5989

[zooba](/zooba)
merged 3 commits into
[python:master](/python/cpython/tree/master "python/cpython:master")
from
[zooba:symlink-bug](/zooba/cpython/tree/symlink-bug "zooba/cpython:symlink-bug")

Mar 5, 2018

[Conversation
4](/python/cpython/pull/5989)
[Commits
3](/python/cpython/pull/5989/commits)
[Checks
0](/python/cpython/pull/5989/checks)
[Files changed](/python/cpython/pull/5989/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![zooba](https://avatars.githubusercontent.com/u/1693688?s=60&v=4)](/zooba)

Copy link

Member

### @zooba **[zooba](/zooba)** commented [Mar 5, 2018](#issue-302404422) • edited by bedevere-bot Loading

<https://bugs.python.org/issue33001>

Sorry, something went wrong.

All reactions

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[Minimal fix to prevent buffer overrun in os.symlink](/python/cpython/pull/5989/commits/f31f9b43954e06738af0f90fd75c45f869cd678a "Minimal fix to prevent buffer overrun in os.symlink")`

`[f31f9b4](/python/cpython/pull/5989/commits/f31f9b43954e06738af0f90fd75c45f869cd678a)`

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
added
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[needs backport to 3.6](/python/cpython/labels/needs%20backport%20to%203.6)
[type-security](/python/cpython/labels/type-security)
A security issue
[OS-windows](/python/cpython/labels/OS-windows)
labels
[Mar 5, 2018](#event-1504745590)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
added
the
[awaiting merge](/python/cpython/labels/awaiting%20merge)
label
[Mar 5, 2018](#event-1504745660)

[![@the-knights-who-say-ni](https://avatars.githubusercontent.com/u/18121554?s=40&u=7f27f578976be995d20742716898b8de1a340824&v=4)](/the-knights-who-say-ni)
[the-knights-who-say-ni](/the-knights-who-say-ni)
added
the
[CLA signed](/python/cpython/labels/CLA%20signed)
label
[Mar 5, 2018](#event-1504745675)

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
changed the title
~~Minimal fix to prevent buffer overrun in os.symlink~~
bpo-33001: Minimal fix to prevent buffer overrun in os.symlink
[Mar 5, 2018](#event-1504746959)

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[Add NEWS entry](/python/cpython/pull/5989/commits/645312c8c87460d033545ae85d39e0697c910257 "Add NEWS entry")`

`[645312c](/python/cpython/pull/5989/commits/645312c8c87460d033545ae85d39e0697c910257)`

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=80&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)

Copy link

### **[bedevere-bot](/bedevere-bot)** commented [Mar 5, 2018](#issuecomment-370512112)

| [GH-5990](https://github.com/python/cpython/pull/5990) is a backport of this pull request to the [3.6 branch](https://github.com/python/cpython/tree/3.6). |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[needs backport to 3.6](/python/cpython/labels/needs%20backport%20to%203.6)
label
[Mar 5, 2018](#event-1504759761)

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
self-assigned this
[Mar 5, 2018](#event-1504761671)

[![izbyshev](https://avatars.githubusercontent.com/u/11427362?s=60&v=4)](/izbyshev)

**[izbyshev](/izbyshev)**
reviewed
[Mar 5, 2018](#pullrequestreview-101277186)

 [View reviewed changes](/python/cpython/pull/5989/files/f31f9b43954e06738af0f90fd75c45f869cd678a)

[Lib/test/test\_os.py](/python/cpython/pull/5989/files/f31f9b43954e06738af0f90fd75c45f869cd678a#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
Outdated

|  |  | # overflow dest with relative src |
| --- | --- | --- |
|  |  | (segment, path), |
|  |  | # overflow dest when appending '\\' for join |
|  |  | (segment, path[:261]), |

Copy link

Contributor

### @izbyshev **[izbyshev](/izbyshev)** [Mar 5, 2018](#discussion_r172285804)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

FWIW, this won't overflow when appending `\\` because:

* `len(path[:261])` > `MAX_PATH - 1`, so it'll overflow in the very beginning of `_check_dirW`
* even if len was equal to `MAX_PATH - 1`, `_dirnameW` would be applied first, making it shorter.

Sorry, something went wrong.

All reactions

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[Remove invalid test](/python/cpython/pull/5989/commits/e47b78733e629448fe8aeb09a8d73120ea53325b "Remove invalid test")`

`[e47b787](/python/cpython/pull/5989/commits/e47b78733e629448fe8aeb09a8d73120ea53325b)`

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
merged commit [`6921e73`](/python/cpython/commit/6921e73e33edc3c61bc2d78ed558eaa22a89a564)
into
python:master

[Mar 5, 2018](https://github.com/python/cpython/pull/5989#event-1505255956)

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=80&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington)

Copy link

Contributor

### **[miss-islington](/miss-islington)** commented [Mar 5, 2018](#issuecomment-370589645)

| Thanks [@zooba](https://github.com/zooba) for the PR 🌮🎉.. I'm working now to backport this PR to: 3.7. 🐍🍒⛏🤖 |
| --- |

All reactions

Sorry, something went wrong.

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[awaiting merge](/python/cpython/labels/awaiting%20merge)
label
[Mar 5, 2018](#event-1505256040)

[zooba](/zooba)
added a commit
that referenced
this pull request
[Mar 5, 2018](#ref-commit-baa4507)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[[3.6]](/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3 "[3.6] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (GH-5990)") [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001)[: Prevent buffer overrun in os.symlink (](/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3 "[3.6] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (GH-5990)")[GH-5989](https://github.com/python/cpython/pull/5989)[) (](/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3 "[3.6] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (GH-5990)")[GH-5990](https://github.com/python/cpython/pull/5990)`
…

`[baa4507](/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3)`

```
)
```

 [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
deleted the
symlink-bug

branch
[March 5, 2018 22:27](#event-1505257501)

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=80&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)

Copy link

### **[bedevere-bot](/bedevere-bot)** commented [Mar 5, 2018](#issuecomment-370589942)

| [GH-5996](https://github.com/python/cpython/pull/5996) is a backport of this pull request to the [3.7 branch](https://github.com/python/cpython/tree/3.7). |
| --- |

All reactions

Sorry, something went wrong.

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this pull request
[Mar 5, 2018](#ref-commit-e17cd84)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[bpo-33001: Prevent buffer overrun in os.symlink (](/miss-islington/cpython/commit/e17cd844a0e84140441a3a8a80b1a1de5545430c "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)
(cherry picked from commit 6921e73e33edc3c61bc2d78ed558eaa22a89a564)

Co-authored-by: Steve Dower <steve.dower@microsoft.com>")[pythonGH-5989](https://github.com/python/cpython/pull/5989)[)](/miss-islington/cpython/commit/e17cd844a0e84140441a3a8a80b1a1de5545430c "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)
(cherry picked from commit 6921e73e33edc3c61bc2d78ed558eaa22a89a564)

Co-authored-by: Steve Dower <steve.dower@microsoft.com>")`
…

`[e17cd84](/miss-islington/cpython/commit/e17cd844a0e84140441a3a8a80b1a1de5545430c)`

```
(cherry picked from commit [6921e73](https://github.com/miss-islington/cpython/commit/6921e73e33edc3c61bc2d78ed558eaa22a89a564))

Co-authored-by: Steve Dower <steve.dower@microsoft.com>
```

[![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=40&u=63eee11d3b5474c37a942e04a41607f58b3b0c3d&v=4)](/bedevere-bot)
[bedevere-bot](/bedevere-bot)
removed
the
[needs backport to 3.7](/python/cpython/labels/needs%20backport%20to%203.7)
label
[Mar 5, 2018](#event-1505257824)

[miss-islington](/miss-islington)
added a commit
that referenced
this pull request
[Mar 5, 2018](#ref-commit-96fdbac)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington) [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001)[: Prevent buffer overrun in os.symlink (](/python/cpython/commit/96fdbacb7797a564249fd59ccf86ec153c4bb095 "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)

(cherry picked from commit 6921e73e33edc3c61bc2d78ed558eaa22a89a564)

Co-authored-by: Steve Dower <steve.dower@microsoft.com>")[GH-5989](https://github.com/python/cpython/pull/5989)[)](/python/cpython/commit/96fdbacb7797a564249fd59ccf86ec153c4bb095 "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)

(cherry picked from commit 6921e73e33edc3c61bc2d78ed558eaa22a89a564)

Co-authored-by: Steve Dower <steve.dower@microsoft.com>")`
…

`[96fdbac](/python/cpython/commit/96fdbacb7797a564249fd59ccf86ec153c4bb095)`

```
(cherry picked from commit [6921e73](https://github.com/python/cpython/commit/6921e73e33edc3c61bc2d78ed558eaa22a89a564))

Co-authored-by: Steve Dower <steve.dower@microsoft.com>
```

[jo2y](/jo2y)
pushed a commit
to jo2y/cpython
that referenced
this pull request
[Mar 23, 2018](#ref-commit-d4f5cf8)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@jo2y](https://avatars.githubusercontent.com/u/8071360?s=40&v=4)](/jo2y)

`[bpo-33001: Prevent buffer overrun in os.symlink (](/jo2y/cpython/commit/d4f5cf8293bf1ba65d5a237b08671d82457f0e09 "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)")[pythonGH-5989](https://github.com/python/cpython/pull/5989)[)](/jo2y/cpython/commit/d4f5cf8293bf1ba65d5a237b08671d82457f0e09 "bpo-33001: Prevent buffer overrun in os.symlink (GH-5989)")`

`[d4f5cf8](/jo2y/cpython/commit/d4f5cf8293bf1ba65d5a237b08671d82457f0e09)`

[larryhastings](/larryhastings)
pushed a commit
that referenced
this pull request
[May 14, 2018](#ref-commit-77c02cd)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@larryhastings](https://avatars.githubusercontent.com/u/14175923?s=40&v=4)](/larryhastings)

`[[3.4]](/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1 "[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5992)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Skips test to avoid crashing during the test suite

* Remove invalid test") [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001)[: Prevent buffer overrun in os.symlink (](/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1 "[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5992)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Skips test to avoid crashing during the test suite

* Remove invalid test")[GH-5989](https://github.com/python/cpython/pull/5989)[) (](/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1 "[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5992)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Skips test to avoid crashing during the test suite

* Remove invalid test")[#5992](https://github.com/python/cpython/pull/5992)[)](/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1 "[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5992)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Skips test to avoid crashing during the test suite

* Remove invalid test")`
…

`[77c02cd](/python/cpython/commit/77c02cdce2d7b8360771be35b7676a4977e070c1)`

```
* [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001): Minimal fix to prevent buffer overrun in os.symlink

* Skips test to avoid crashing during the test suite

* Remove invalid test
```

[larryhastings](/larryhastings)
pushed a commit
that referenced
this pull request
[May 14, 2018](#ref-commit-f381cfe)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@larryhastings](https://avatars.githubusercontent.com/u/14175923?s=40&v=4)](/larryhastings)

`[[3.5]](/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51 "[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5991)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Remove invalid test") [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001)[: Prevent buffer overrun in os.symlink (](/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51 "[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5991)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Remove invalid test")[GH-5989](https://github.com/python/cpython/pull/5989)[) (](/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51 "[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5991)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Remove invalid test")[#5991](https://github.com/python/cpython/pull/5991)[)](/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51 "[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) (#5991)

* bpo-33001: Minimal fix to prevent buffer overrun in os.symlink

* Remove invalid test")`
…

`[f381cfe](/python/cpython/commit/f381cfe07d15d52f27de771a62a8167668f0dd51)`

```
* [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001): Minimal fix to prevent buffer overrun in os.symlink

* Remove invalid test
```

[![@vidartf](https://avatars.githubusercontent.com/u/510760?s=40&v=4)](/vidartf)
[vidartf](/vidartf)
mentioned this pull request
[Apr 9, 2019](#ref-pullrequest-258780424)

[bpo-31512: Add non-elevated symlink support for dev mode Windows 10
#3652](/python/cpython/pull/3652)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fpull%2F5989)

Reviewers

[![@izbyshev](https://avatars.githubusercontent.com/u/11427362?s=40&v=4)](/izbyshev) [izbyshev](/izbyshev)

izbyshev left review comments

Assignees

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [zooba](/zooba)

Labels

[OS-windows](/python/cpython/labels/OS-windows)
[type-bug](/python/cpython/labels/type-bug)
An unexpected behavior, bug, or error
[type-security](/python/cpython/labels/type-security)
A security issue

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=52&v=4)](/zooba) [![@bedevere-bot](https://avatars.githubusercontent.com/u/28579281?s=52&v=4)](/bedevere-bot) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=52&v=4)](/miss-islington) [![@izbyshev](https://avatars.githubusercontent.com/u/11427362?s=52&v=4)](/izbyshev) [![@the-knights-who-say-ni](https://avatars.githubusercontent.com/u/18121554?s=52&v=4)](/the-knights-who-say-ni)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from hg.python.org_e7dc263f_20250126_020900.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6921e73e33edc3c61bc2d78ed558eaa22a89a564)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6921e73e33edc3c61bc2d78ed558eaa22a89a564)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.9k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/6921e73e33edc3c61bc2d78ed558eaa22a89a564)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989))

[Browse files](/python/cpython/tree/6921e73e33edc3c61bc2d78ed558eaa22a89a564)
Browse the repository at this point in the history

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
Mar 5, 2018

1 parent
[4c19b95](/python/cpython/commit/4c19b95734faee4c390c1d0569dc876980c33d2c)

commit 6921e73

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**73 additions**
and
**28 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst
    [2018-03-05-10-09-51.bpo-33001.elj4Aa.rst](#diff-283e99d329990edc7b6e101895d413f9e0283b2c19a17e514231a718f0f69c5a)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

34 changes: 34 additions & 0 deletions

34
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/6921e73e33edc3c61bc2d78ed558eaa22a89a564/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2164,6 +2164,40 @@ def test\_29248(self): |
|  |  | target = os.readlink(r'C:\Users\All Users') |
|  |  | self.assertTrue(os.path.samefile(target, r'C:\ProgramData')) |
|  |  |  |
|  |  | def test\_buffer\_overflow(self): |
|  |  | # Older versions would have a buffer overflow when detecting |
|  |  | # whether a link source was a directory. This test ensures we |
|  |  | # no longer crash, but does not otherwise validate the behavior |
|  |  | segment = 'X' \* 27 |
|  |  | path = os.path.join(\*[segment] \* 10) |
|  |  | test\_cases = [ |
|  |  | # overflow with absolute src |
|  |  | ('\\' + path, segment), |
|  |  | # overflow dest with relative src |
|  |  | (segment, path), |
|  |  | # overflow when joining src |
|  |  | (path[:180], path[:180]), |
|  |  | ] |
|  |  | for src, dest in test\_cases: |
|  |  | try: |
|  |  | os.symlink(src, dest) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | else: |
|  |  | try: |
|  |  | os.remove(dest) |
|  |  | except OSError: |
|  |  | pass |
|  |  | # Also test with bytes, since that is a separate code path. |
|  |  | try: |
|  |  | os.symlink(os.fsencode(src), os.fsencode(dest)) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | else: |
|  |  | try: |
|  |  | os.remove(dest) |
|  |  | except OSError: |
|  |  | pass |
|  |  |  |
|  |  | @unittest.skipUnless(sys.platform == "win32", "Win32 specific tests") |
|  |  | class Win32JunctionTests(unittest.TestCase): |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst](#diff-283e99d329990edc7b6e101895d413f9e0283b2c19a17e514231a718f0f69c5a "Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst")

Show comments

[View file](/python/cpython/blob/6921e73e33edc3c61bc2d78ed558eaa22a89a564/Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Minimal fix to prevent buffer overrun in os.symlink on Windows |

66 changes: 38 additions & 28 deletions

66
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/6921e73e33edc3c61bc2d78ed558eaa22a89a564/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7471,7 +7471,7 @@ win\_readlink(PyObject \*self, PyObject \*args, PyObject \*kwargs) |
|  |  | #if defined(MS\_WINDOWS) |
|  |  |  |
|  |  | /\* Grab CreateSymbolicLinkW dynamically from kernel32 \*/ |
|  |  | static DWORD (CALLBACK \*Py\_CreateSymbolicLinkW)(LPCWSTR, LPCWSTR, DWORD) = NULL; |
|  |  | static BOOLEAN (CALLBACK \*Py\_CreateSymbolicLinkW)(LPCWSTR, LPCWSTR, DWORD) = NULL; |
|  |  |  |
|  |  | static int |
|  |  | check\_CreateSymbolicLink(void) |
| Expand All | | @@ -7486,47 +7486,51 @@ check\_CreateSymbolicLink(void) |
|  |  | return Py\_CreateSymbolicLinkW != NULL; |
|  |  | } |
|  |  |  |
|  |  | /\* Remove the last portion of the path \*/ |
|  |  | static void |
|  |  | /\* Remove the last portion of the path - return 0 on success \*/ |
|  |  | static int |
|  |  | \_dirnameW(WCHAR \*path) |
|  |  | { |
|  |  | WCHAR \*ptr; |
|  |  | size\_t length = wcsnlen\_s(path, MAX\_PATH); |
|  |  | if (length == MAX\_PATH) { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | /\* walk the path from the end until a backslash is encountered \*/ |
|  |  | for(ptr = path + wcslen(path); ptr != path; ptr--) { |
|  |  | if (\*ptr == L'\\' || \*ptr == L'/') |
|  |  | for(ptr = path + length; ptr != path; ptr--) { |
|  |  | if (\*ptr == L'\\' || \*ptr == L'/') { |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | \*ptr = 0; |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | /\* Is this path absolute? \*/ |
|  |  | static int |
|  |  | \_is\_absW(const WCHAR \*path) |
|  |  | { |
|  |  | return path[0] == L'\\' || path[0] == L'/' || path[1] == L':'; |
|  |  |  |
|  |  | return path[0] == L'\\' || path[0] == L'/' || |
|  |  | (path[0] && path[1] == L':'); |
|  |  | } |
|  |  |  |
|  |  | /\* join root and rest with a backslash \*/ |
|  |  | static void |
|  |  | /\* join root and rest with a backslash - return 0 on success \*/ |
|  |  | static int |
|  |  | \_joinW(WCHAR \*dest\_path, const WCHAR \*root, const WCHAR \*rest) |
|  |  | { |
|  |  | size\_t root\_len; |
|  |  |  |
|  |  | if (\_is\_absW(rest)) { |
|  |  | wcscpy(dest\_path, rest); |
|  |  | return; |
|  |  | return wcscpy\_s(dest\_path, MAX\_PATH, rest); |
|  |  | } |
|  |  |  |
|  |  | root\_len = wcslen(root); |
|  |  | if (wcscpy\_s(dest\_path, MAX\_PATH, root)) { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | wcscpy(dest\_path, root); |
|  |  | if(root\_len) { |
|  |  | dest\_path[root\_len] = L'\\'; |
|  |  | root\_len++; |
|  |  | if (dest\_path[0] && wcscat\_s(dest\_path, MAX\_PATH, L"\\")) { |
|  |  | return -1; |
|  |  | } |
|  |  | wcscpy(dest\_path+root\_len, rest); |
|  |  |  |
|  |  | return wcscat\_s(dest\_path, MAX\_PATH, rest); |
|  |  | } |
|  |  |  |
|  |  | /\* Return True if the path at src relative to dest is a directory \*/ |
| Expand All | | @@ -7538,10 +7542,14 @@ \_check\_dirW(LPCWSTR src, LPCWSTR dest) |
|  |  | WCHAR src\_resolved[MAX\_PATH] = L""; |
|  |  |  |
|  |  | /\* dest\_parent = os.path.dirname(dest) \*/ |
|  |  | wcscpy(dest\_parent, dest); |
|  |  | \_dirnameW(dest\_parent); |
|  |  | if (wcscpy\_s(dest\_parent, MAX\_PATH, dest) || |
|  |  | \_dirnameW(dest\_parent)) { |
|  |  | return 0; |
|  |  | } |
|  |  | /\* src\_resolved = os.path.join(dest\_parent, src) \*/ |
|  |  | \_joinW(src\_resolved, dest\_parent, src); |
|  |  | if (\_joinW(src\_resolved, dest\_parent, src)) { |
|  |  | return 0; |
|  |  | } |
|  |  | return ( |
|  |  | GetFileAttributesExW(src\_resolved, GetFileExInfoStandard, &src\_info) |
|  |  | && src\_info.dwFileAttributes & FILE\_ATTRIBUTE\_DIRECTORY |
| Expand Down  Expand Up | | @@ -7597,26 +7605,28 @@ os\_symlink\_impl(PyObject \*module, path\_t \*src, path\_t \*dst, |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | if ((src->narrow && dst->wide) || (src->wide && dst->narrow)) { |
|  |  | PyErr\_SetString(PyExc\_ValueError, |
|  |  | "symlink: src and dst must be the same type"); |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  |  |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | \_Py\_BEGIN\_SUPPRESS\_IPH |
|  |  | /\* if src is a directory, ensure target\_is\_directory==1 \*/ |
|  |  | target\_is\_directory |= \_check\_dirW(src->wide, dst->wide); |
|  |  | result = Py\_CreateSymbolicLinkW(dst->wide, src->wide, |
|  |  | target\_is\_directory); |
|  |  | \_Py\_END\_SUPPRESS\_IPH |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | return path\_error2(src, dst); |
|  |  |  |
|  |  | #else |
|  |  |  |
|  |  | if ((src->narrow && dst->wide) || (src->wide && dst->narrow)) { |
|  |  | PyErr\_SetString(PyExc\_ValueError, |
|  |  | "symlink: src and dst must be the same type"); |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_SYMLINKAT |
|  |  | if (dir\_fd != DEFAULT\_DIR\_FD) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6921e73`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6921e73e33edc3c61bc2d78ed558eaa22a89a564) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_05e96c4f_20250126_020906.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F77182)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F77182)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.9k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

# Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117) #77182

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)](#top)#77182Copy linkAssignees [![zooba](https://avatars.githubusercontent.com/u/1693688?s=64&v=4)](/zooba)Labels[3.7 (EOL)end of life](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%223.7%20(EOL)%22)end of life[3.8 (EOL)end of life](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%223.8%20(EOL)%22)end of life[OS-windows](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%22OS-windows%22)[type-securityA security issue](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%22type-security%22)A security issue[![@zooba](https://avatars.githubusercontent.com/u/1693688?v=4&size=80)](/zooba)
## Description

[![@zooba](https://avatars.githubusercontent.com/u/1693688?v=4&size=48)](/zooba)[zooba](https://github.com/zooba)opened [on Mar 5, 2018](https://github.com/python/cpython/issues/77182#issue-1198988546)

| BPO | [33001](https://bugs.python.org/issue33001) |
| --- | --- |
| Nosy | [@pfmoore](https://github.com/pfmoore), [@vstinner](https://github.com/vstinner), [@larryhastings](https://github.com/larryhastings), [@tjguk](https://github.com/tjguk), [@ned-deily](https://github.com/ned-deily), [@zware](https://github.com/zware), [@eryksun](https://github.com/eryksun), [@zooba](https://github.com/zooba), [@izbyshev](https://github.com/izbyshev), [@miss-islington](https://github.com/miss-islington) |
| PRs | - [bpo-33001: Minimal fix to prevent buffer overrun in os.symlink #5989](https://github.com/python/cpython/pull/5989) - [[3.6] bpo-33001: Minimal fix to prevent buffer overrun in os.symlink (GH-5989) #5990](https://github.com/python/cpython/pull/5990) - [[3.5] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) #5991](https://github.com/python/cpython/pull/5991) - [[3.4] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) #5992](https://github.com/python/cpython/pull/5992) - [[3.7] bpo-33001: Prevent buffer overrun in os.symlink (GH-5989) #5996](https://github.com/python/cpython/pull/5996) |

*Note: these values reflect the state of the issue at the time it was migrated and might not reflect the current state.*

Show more details

GitHub fields:

```
assignee = 'https://github.com/zooba'
closed_at = <Date 2018-05-28.23:25:42.844>
created_at = <Date 2018-03-05.18:04:42.615>
labels = ['type-security', '3.7', '3.8', 'OS-windows']
title = 'Buffer overflow vulnerability in os.symlink on Windows (CVE-2018-1000117)'
updated_at = <Date 2019-05-10.18:06:59.274>
user = 'https://github.com/zooba'
```

bugs.python.org fields:

```
activity = <Date 2019-05-10.18:06:59.274>
actor = 'ned.deily'
assignee = 'steve.dower'
closed = True
closed_date = <Date 2018-05-28.23:25:42.844>
closer = 'steve.dower'
components = ['Windows']
creation = <Date 2018-03-05.18:04:42.615>
creator = 'steve.dower'
dependencies = []
files = []
hgrepos = []
issue_num = 33001
keywords = ['patch', 'security_issue']
message_count = 14.0
messages = ['313275', '313279', '313281', '313282', '313291', '313292', '313293', '313298', '313368', '313398', '313415', '316539', '316543', '317958']
nosy_count = 10.0
nosy_names = ['paul.moore', 'vstinner', 'larry', 'tim.golden', 'ned.deily', 'zach.ware', 'eryksun', 'steve.dower', 'izbyshev', 'miss-islington']
pr_nums = ['5989', '5990', '5991', '5992', '5996']
priority = 'critical'
resolution = 'fixed'
stage = 'resolved'
status = 'closed'
superseder = None
type = 'security'
url = 'https://bugs.python.org/issue33001'
versions = ['Python 3.4', 'Python 3.5', 'Python 3.6', 'Python 3.7', 'Python 3.8']
```
## Metadata

### Assignees

* [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=64&v=4)zooba](/zooba)
### Labels

[3.7 (EOL)end of life](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%223.7%20(EOL)%22)end of life[3.8 (EOL)end of life](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%223.8%20(EOL)%22)end of life[OS-windows](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%22OS-windows%22)[type-securityA security issue](https://github.com/python/cpython/issues?q=state%3Aopen%20label%3A%22type-security%22)A security issue
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from hg.python.org_bfaf8859_20250126_020905.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fbaa45079466eda1f5636a6d13f3a60c2c00fdcd3)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fbaa45079466eda1f5636a6d13f3a60c2c00fdcd3)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.9k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.9k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/baa45079466eda1f5636a6d13f3a60c2c00fdcd3)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.6] [bpo-33001](https://bugs.python.org/issue?@action=redirect&bpo=33001): Prevent buffer overrun in os.symlink ([GH-5989](https://github.com/python/cpython/pull/5989)) ([GH-5990](https://github.com/python/cpython/pull/5990)

[Browse files](/python/cpython/tree/baa45079466eda1f5636a6d13f3a60c2c00fdcd3)
Browse the repository at this point in the history

```
)
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
Mar 5, 2018

1 parent
[6935a51](/python/cpython/commit/6935a511670797a3aaebdf96aad3dcff66baa76e)

commit baa4507

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**74 additions**
and
**28 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst
    [2018-03-05-10-09-51.bpo-33001.elj4Aa.rst](#diff-283e99d329990edc7b6e101895d413f9e0283b2c19a17e514231a718f0f69c5a)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

35 changes: 35 additions & 0 deletions

35
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/baa45079466eda1f5636a6d13f3a60c2c00fdcd3/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2170,6 +2170,41 @@ def test\_29248(self): |
|  |  | target = os.readlink(r'C:\Users\All Users') |
|  |  | self.assertTrue(os.path.samefile(target, r'C:\ProgramData')) |
|  |  |  |
|  |  | def test\_buffer\_overflow(self): |
|  |  | # Older versions would have a buffer overflow when detecting |
|  |  | # whether a link source was a directory. This test ensures we |
|  |  | # no longer crash, but does not otherwise validate the behavior |
|  |  | segment = 'X' \* 27 |
|  |  | path = os.path.join(\*[segment] \* 10) |
|  |  | test\_cases = [ |
|  |  | # overflow with absolute src |
|  |  | ('\\' + path, segment), |
|  |  | # overflow dest with relative src |
|  |  | (segment, path), |
|  |  | # overflow when joining src |
|  |  | (path[:180], path[:180]), |
|  |  | ] |
|  |  | for src, dest in test\_cases: |
|  |  | try: |
|  |  | os.symlink(src, dest) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | else: |
|  |  | try: |
|  |  | os.remove(dest) |
|  |  | except OSError: |
|  |  | pass |
|  |  | # Also test with bytes, since that is a separate code path. |
|  |  | try: |
|  |  | os.symlink(os.fsencode(src), os.fsencode(dest)) |
|  |  | except FileNotFoundError: |
|  |  | pass |
|  |  | else: |
|  |  | try: |
|  |  | os.remove(dest) |
|  |  | except OSError: |
|  |  | pass |
|  |  |  |
|  |  |  |
|  |  | @unittest.skipUnless(sys.platform == "win32", "Win32 specific tests") |
|  |  | class Win32JunctionTests(unittest.TestCase): |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst](#diff-283e99d329990edc7b6e101895d413f9e0283b2c19a17e514231a718f0f69c5a "Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst")

Show comments

[View file](/python/cpython/blob/baa45079466eda1f5636a6d13f3a60c2c00fdcd3/Misc/NEWS.d/next/Security/2018-03-05-10-09-51.bpo-33001.elj4Aa.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1 @@ |
|  |  | Minimal fix to prevent buffer overrun in os.symlink on Windows |

66 changes: 38 additions & 28 deletions

66
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/baa45079466eda1f5636a6d13f3a60c2c00fdcd3/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7144,7 +7144,7 @@ win\_readlink(PyObject \*self, PyObject \*args, PyObject \*kwargs) |
|  |  | #if defined(MS\_WINDOWS) |
|  |  |  |
|  |  | /\* Grab CreateSymbolicLinkW dynamically from kernel32 \*/ |
|  |  | static DWORD (CALLBACK \*Py\_CreateSymbolicLinkW)(LPCWSTR, LPCWSTR, DWORD) = NULL; |
|  |  | static BOOLEAN (CALLBACK \*Py\_CreateSymbolicLinkW)(LPCWSTR, LPCWSTR, DWORD) = NULL; |
|  |  |  |
|  |  | static int |
|  |  | check\_CreateSymbolicLink(void) |
| Expand All | | @@ -7159,47 +7159,51 @@ check\_CreateSymbolicLink(void) |
|  |  | return Py\_CreateSymbolicLinkW != NULL; |
|  |  | } |
|  |  |  |
|  |  | /\* Remove the last portion of the path \*/ |
|  |  | static void |
|  |  | /\* Remove the last portion of the path - return 0 on success \*/ |
|  |  | static int |
|  |  | \_dirnameW(WCHAR \*path) |
|  |  | { |
|  |  | WCHAR \*ptr; |
|  |  | size\_t length = wcsnlen\_s(path, MAX\_PATH); |
|  |  | if (length == MAX\_PATH) { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | /\* walk the path from the end until a backslash is encountered \*/ |
|  |  | for(ptr = path + wcslen(path); ptr != path; ptr--) { |
|  |  | if (\*ptr == L'\\' || \*ptr == L'/') |
|  |  | for(ptr = path + length; ptr != path; ptr--) { |
|  |  | if (\*ptr == L'\\' || \*ptr == L'/') { |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | \*ptr = 0; |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | /\* Is this path absolute? \*/ |
|  |  | static int |
|  |  | \_is\_absW(const WCHAR \*path) |
|  |  | { |
|  |  | return path[0] == L'\\' || path[0] == L'/' || path[1] == L':'; |
|  |  |  |
|  |  | return path[0] == L'\\' || path[0] == L'/' || |
|  |  | (path[0] && path[1] == L':'); |
|  |  | } |
|  |  |  |
|  |  | /\* join root and rest with a backslash \*/ |
|  |  | static void |
|  |  | /\* join root and rest with a backslash - return 0 on success \*/ |
|  |  | static int |
|  |  | \_joinW(WCHAR \*dest\_path, const WCHAR \*root, const WCHAR \*rest) |
|  |  | { |
|  |  | size\_t root\_len; |
|  |  |  |
|  |  | if (\_is\_absW(rest)) { |
|  |  | wcscpy(dest\_path, rest); |
|  |  | return; |
|  |  | return wcscpy\_s(dest\_path, MAX\_PATH, rest); |
|  |  | } |
|  |  |  |
|  |  | root\_len = wcslen(root); |
|  |  | if (wcscpy\_s(dest\_path, MAX\_PATH, root)) { |
|  |  | return -1; |
|  |  | } |
|  |  |  |
|  |  | wcscpy(dest\_path, root); |
|  |  | if(root\_len) { |
|  |  | dest\_path[root\_len] = L'\\'; |
|  |  | root\_len++; |
|  |  | if (dest\_path[0] && wcscat\_s(dest\_path, MAX\_PATH, L"\\")) { |
|  |  | return -1; |
|  |  | } |
|  |  | wcscpy(dest\_path+root\_len, rest); |
|  |  |  |
|  |  | return wcscat\_s(dest\_path, MAX\_PATH, rest); |
|  |  | } |
|  |  |  |
|  |  | /\* Return True if the path at src relative to dest is a directory \*/ |
| Expand All | | @@ -7211,10 +7215,14 @@ \_check\_dirW(LPCWSTR src, LPCWSTR dest) |
|  |  | WCHAR src\_resolved[MAX\_PATH] = L""; |
|  |  |  |
|  |  | /\* dest\_parent = os.path.dirname(dest) \*/ |
|  |  | wcscpy(dest\_parent, dest); |
|  |  | \_dirnameW(dest\_parent); |
|  |  | if (wcscpy\_s(dest\_parent, MAX\_PATH, dest) || |
|  |  | \_dirnameW(dest\_parent)) { |
|  |  | return 0; |
|  |  | } |
|  |  | /\* src\_resolved = os.path.join(dest\_parent, src) \*/ |
|  |  | \_joinW(src\_resolved, dest\_parent, src); |
|  |  | if (\_joinW(src\_resolved, dest\_parent, src)) { |
|  |  | return 0; |
|  |  | } |
|  |  | return ( |
|  |  | GetFileAttributesExW(src\_resolved, GetFileExInfoStandard, &src\_info) |
|  |  | && src\_info.dwFileAttributes & FILE\_ATTRIBUTE\_DIRECTORY |
| Expand Down  Expand Up | | @@ -7270,26 +7278,28 @@ os\_symlink\_impl(PyObject \*module, path\_t \*src, path\_t \*dst, |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | if ((src->narrow && dst->wide) || (src->wide && dst->narrow)) { |
|  |  | PyErr\_SetString(PyExc\_ValueError, |
|  |  | "symlink: src and dst must be the same type"); |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  |  |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | \_Py\_BEGIN\_SUPPRESS\_IPH |
|  |  | /\* if src is a directory, ensure target\_is\_directory==1 \*/ |
|  |  | target\_is\_directory |= \_check\_dirW(src->wide, dst->wide); |
|  |  | result = Py\_CreateSymbolicLinkW(dst->wide, src->wide, |
|  |  | target\_is\_directory); |
|  |  | \_Py\_END\_SUPPRESS\_IPH |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | return path\_error2(src, dst); |
|  |  |  |
|  |  | #else |
|  |  |  |
|  |  | if ((src->narrow && dst->wide) || (src->wide && dst->narrow)) { |
|  |  | PyErr\_SetString(PyExc\_ValueError, |
|  |  | "symlink: src and dst must be the same type"); |
|  |  | return NULL; |
|  |  | } |
|  |  |  |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_SYMLINKAT |
|  |  | if (dir\_fd != DEFAULT\_DIR\_FD) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `baa4507`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fbaa45079466eda1f5636a6d13f3a60c2c00fdcd3) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


