=== Content from git.kernel.org_87d30af6_20250125_073022.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=1995266727fa8143897e89b55f5d3c79aa828420)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=1995266727fa8143897e89b55f5d3c79aa828420)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1995266727fa8143897e89b55f5d3c79aa828420)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1995266727fa8143897e89b55f5d3c79aa828420)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ben Hutchings <ben.hutchings@codethink.co.uk> | 2018-01-22 20:11:06 +0000 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2018-01-22 20:13:07 -0800 |
| commit | [1995266727fa8143897e89b55f5d3c79aa828420](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1995266727fa8143897e89b55f5d3c79aa828420) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=1995266727fa8143897e89b55f5d3c79aa828420)) | |
| tree | [2955860ce332561b8021ac8f07141e8a6849ad62](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=1995266727fa8143897e89b55f5d3c79aa828420) | |
| parent | [a0ec1ded22e6a6bc41981fae22406835b006a66e](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a0ec1ded22e6a6bc41981fae22406835b006a66e) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1995266727fa8143897e89b55f5d3c79aa828420&id2=a0ec1ded22e6a6bc41981fae22406835b006a66e)) | |
| download | [linux-1995266727fa8143897e89b55f5d3c79aa828420.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-1995266727fa8143897e89b55f5d3c79aa828420.tar.gz) | |

nfsd: auth: Fix gid sorting when rootsquash enabledCommit bdcf0a423ea1 ("kernel: make groups\_sort calling a responsibility
group\_info allocators") appears to break nfsd rootsquash in a pretty
major way.
It adds a call to groups\_sort() inside the loop that copies/squashes
gids, which means the valid gids are sorted along with the following
garbage. The net result is that the highest numbered valid gids are
replaced with any lower-valued garbage gids, possibly including 0.
We should sort only once, after filling in all the gids.
Fixes: bdcf0a423ea1 ("kernel: make groups\_sort calling a responsibility ...")
Signed-off-by: Ben Hutchings <ben.hutchings@codethink.co.uk>
Acked-by: J. Bruce Fields <bfields@redhat.com>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=1995266727fa8143897e89b55f5d3c79aa828420)

| -rw-r--r-- | [fs/nfsd/auth.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/nfsd/auth.c?id=1995266727fa8143897e89b55f5d3c79aa828420) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 3 deletions

| diff --git a/fs/nfsd/auth.c b/fs/nfsd/auth.cindex f650e475d8f0d8..fdf2aad7347090 100644--- a/[fs/nfsd/auth.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/nfsd/auth.c?id=a0ec1ded22e6a6bc41981fae22406835b006a66e)+++ b/[fs/nfsd/auth.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/nfsd/auth.c?id=1995266727fa8143897e89b55f5d3c79aa828420)@@ -60,10 +60,10 @@ int nfsd\_setuser(struct svc\_rqst \*rqstp, struct svc\_export \*exp) gi->gid[i] = exp->ex\_anon\_gid; else gi->gid[i] = rqgi->gid[i];-- /\* Each thread allocates its own gi, no race \*/- groups\_sort(gi); }++ /\* Each thread allocates its own gi, no race \*/+ groups\_sort(gi); } else { gi = get\_group\_info(rqgi); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 07:28:59 +0000


