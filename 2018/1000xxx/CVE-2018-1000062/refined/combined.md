=== Content from github.com_991400ab_20250124_142119.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWonderCMS%2Fwondercms%2Fissues%2F56)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWonderCMS%2Fwondercms%2Fissues%2F56)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=WonderCMS%2Fwondercms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WonderCMS](/WonderCMS)
/
**[wondercms](/WonderCMS/wondercms)**
Public

* [Notifications](/login?return_to=%2FWonderCMS%2Fwondercms) You must be signed in to change notification settings
* [Fork
  166](/login?return_to=%2FWonderCMS%2Fwondercms)
* [Star
   667](/login?return_to=%2FWonderCMS%2Fwondercms)

* [Code](/WonderCMS/wondercms)
* [Issues
  21](/WonderCMS/wondercms/issues)
* [Pull requests
  1](/WonderCMS/wondercms/pulls)
* [Actions](/WonderCMS/wondercms/actions)
* [Wiki](/WonderCMS/wondercms/wiki)
* [Security](/WonderCMS/wondercms/security)
* [Insights](/WonderCMS/wondercms/pulse)

Additional navigation options

* [Code](/WonderCMS/wondercms)
* [Issues](/WonderCMS/wondercms/issues)
* [Pull requests](/WonderCMS/wondercms/pulls)
* [Actions](/WonderCMS/wondercms/actions)
* [Wiki](/WonderCMS/wondercms/wiki)
* [Security](/WonderCMS/wondercms/security)
* [Insights](/WonderCMS/wondercms/pulse)

# [SVG feature - public discussion] SVG XSS on file upload #56

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[[SVG feature - public discussion] SVG XSS on file upload](#top)#56Copy linkLabels[SHARE OPINION](https://github.com/WonderCMS/wondercms/issues?q=state%3Aopen%20label%3A%22SHARE%20OPINION%22)[discussion](https://github.com/WonderCMS/wondercms/issues?q=state%3Aopen%20label%3A%22discussion%22)[![@Tanmay-N](https://avatars.githubusercontent.com/u/36262050?v=4&size=80)](/Tanmay-N)
## Description

[![@Tanmay-N](https://avatars.githubusercontent.com/u/36262050?v=4&size=48)](/Tanmay-N)[Tanmay-N](https://github.com/Tanmay-N)opened [on Feb 8, 2018](https://github.com/WonderCMS/wondercms/issues/56#issue-295458302)

Hi Team,

I have found stored Cross-Site scripting on WonderCMS 2.4.0

In Index.php there is a function "uploadFileAction()"

It does not sanitize svg file and it is possible to execute a Cross-Site Scripting XSS attacks.

Already sent email to info@wondercms.com, and work with all modern browser. hope you can fix it asap.

[![xss](https://user-images.githubusercontent.com/36262050/35967991-9854a958-0ce8-11e8-9255-2fb592e61b93.jpg)](https://user-images.githubusercontent.com/36262050/35967991-9854a958-0ce8-11e8-9255-2fb592e61b93.jpg)

When you fix the bug, please, can you include my name in the release notes when the bug will be corrected? Tanmay gtanmaynashte@gmail.com

## Metadata

### Assignees

No one assigned

### Labels

[SHARE OPINION](https://github.com/WonderCMS/wondercms/issues?q=state%3Aopen%20label%3A%22SHARE%20OPINION%22)[discussion](https://github.com/WonderCMS/wondercms/issues?q=state%3Aopen%20label%3A%22discussion%22)
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_34d00199_20250124_142118.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWonderCMS%2Fwondercms%2Fblob%2Fea640a02b4b8d88835d2e01600d24b23176fb665%2Findex.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FWonderCMS%2Fwondercms%2Fblob%2Fea640a02b4b8d88835d2e01600d24b23176fb665%2Findex.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=WonderCMS%2Fwondercms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[WonderCMS](/WonderCMS)
/
**[wondercms](/WonderCMS/wondercms)**
Public

* [Notifications](/login?return_to=%2FWonderCMS%2Fwondercms) You must be signed in to change notification settings
* [Fork
  166](/login?return_to=%2FWonderCMS%2Fwondercms)
* [Star
   667](/login?return_to=%2FWonderCMS%2Fwondercms)

* [Code](/WonderCMS/wondercms)
* [Issues
  21](/WonderCMS/wondercms/issues)
* [Pull requests
  1](/WonderCMS/wondercms/pulls)
* [Actions](/WonderCMS/wondercms/actions)
* [Wiki](/WonderCMS/wondercms/wiki)
* [Security](/WonderCMS/wondercms/security)
* [Insights](/WonderCMS/wondercms/pulse)

Additional navigation options

* [Code](/WonderCMS/wondercms)
* [Issues](/WonderCMS/wondercms/issues)
* [Pull requests](/WonderCMS/wondercms/pulls)
* [Actions](/WonderCMS/wondercms/actions)
* [Wiki](/WonderCMS/wondercms/wiki)
* [Security](/WonderCMS/wondercms/security)
* [Insights](/WonderCMS/wondercms/pulse)

## Files

 ea640a0
## Breadcrumbs

1. [wondercms](/WonderCMS/wondercms/tree/ea640a02b4b8d88835d2e01600d24b23176fb665)
/
# index.php

Copy path Blame  Blame
## Latest commit

## History

[History](/WonderCMS/wondercms/commits/ea640a02b4b8d88835d2e01600d24b23176fb665/index.php)827 lines (774 loc) · 42.3 KB ea640a0
## Breadcrumbs

1. [wondercms](/WonderCMS/wondercms/tree/ea640a02b4b8d88835d2e01600d24b23176fb665)
/
# index.php

Top
## File metadata and controls

* Code
* Blame

827 lines (774 loc) · 42.3 KB[Raw](https://github.com/WonderCMS/wondercms/raw/ea640a02b4b8d88835d2e01600d24b23176fb665/index.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827<?php // WonderCMS - MIT license: wondercms.com/license
session\_start();define('version', '2.4.0');mb\_internal\_encoding('UTF-8');
class wCMS{ public static $loggedIn = false; public static $currentPage; public static $currentPageExists = false; private static $listeners = []; private static $db = false;
 public static function init() { wCMS::createDatabase();  wCMS::installThemePluginAction(); wCMS::loadPlugins(); if (isset($\_SESSION['l'], $\_SESSION['i']) && $\_SESSION['i'] == \_\_DIR\_\_) { wCMS::$loggedIn = true; } wCMS::$currentPage = empty(wCMS::parseUrl()) ? wCMS::get('config', 'defaultPage') : wCMS::parseUrl(); if (isset(wCMS::get('pages')->{wCMS::$currentPage})) { wCMS::$currentPageExists = true; } if (isset($\_GET['page']) && ! wCMS::$loggedIn) { if (wCMS::$currentPage !== wCMS::slugify($\_GET['page'])) { wCMS::$currentPageExists = false; } } if (wCMS::get('config','dbVersion') < '2.4.0') { if (! isset(wCMS::get('pages','404')->content)) { wCMS::set('pages', '404', 'title', '404'); wCMS::set('pages', '404', 'content', '<h1>Sorry, page not found. :(</h1>'); } wCMS::set('config', 'dbVersion', '2.4.0'); } wCMS::backupAction(); wCMS::changePasswordAction(); wCMS::deleteFileThemePluginAction(); wCMS::deletePageAction(); wCMS::loginAction(); wCMS::logoutAction(); wCMS::notifyAction(); wCMS::saveAction(); wCMS::upgradeAction(); wCMS::uploadFileAction(); if (! wCMS::$loggedIn && ! wCMS::$currentPageExists) { header("HTTP/1.1 404 Not Found"); } if (file\_exists(\_\_DIR\_\_ . '/themes/' . wCMS::get('config', 'theme') . '/functions.php')) { require\_once \_\_DIR\_\_ . '/themes/' . wCMS::get('config', 'theme') . '/functions.php'; } require\_once \_\_DIR\_\_ . '/themes/' . wCMS::get('config', 'theme') . '/theme.php'; }
 private static function addListener($hook, $functionName) { wCMS::$listeners[$hook][] = $functionName; }
 private static function alert($class, $message, $sticky = false) { if (isset($\_SESSION['alert'][$class])) { foreach ($\_SESSION['alert'][$class] as $k => $v) { if ($v['message'] == $message) { return; } } } $\_SESSION['alert'][$class][] = ['class' => $class, 'message' => $message, 'sticky' => $sticky]; }
 private static function alerts() { if (! isset($\_SESSION['alert'])) { return; } $session = $\_SESSION['alert']; $output = ''; unset($\_SESSION['alert']); foreach ($session as $key => $value) { foreach ($value as $key => $val) { $output .= '<div class="alert alert-'.$val['class'].(! $val['sticky'] ? ' alert-dismissible' : '').'">'.(! $val['sticky'] ? '<button type="button" class="close" data-dismiss="alert">&times;</button>' : '').$val['message'].'</div>'; } } return $output; }
 public static function asset($location) { return wCMS::url('themes/' . wCMS::get('config', 'theme') . '/' . $location); }
 private static function backupAction() { if (! wCMS::$loggedIn) { return; } $backupList = glob(\_\_DIR\_\_ . '/files/backup-\*.zip'); if (! empty($backupList)) { wCMS::alert('danger', 'Delete backup files. (<i>Settings -> Files</i>)'); } $backup = 'backup-' . date('Y-m-d-') . substr(md5(microtime()), rand(0, 26), 5) . '.zip'; if (! isset($\_POST['backup'])) { return; } if (hash\_equals($\_POST['token'], wCMS::generateToken())) { if (wCMS::zipBackup(\_\_DIR\_\_, \_\_DIR\_\_ . '/files/' . $backup) !== false) { wCMS::redirect('files/'.$backup); } } }
 public static function block($key) { $blocks = wCMS::get('blocks'); return isset($blocks->{$key}) ? (wCMS::$loggedIn ? wCMS::editable($key, $blocks->{$key}->content, 'blocks') : $blocks->{$key}->content) : ''; }
 private static function changePasswordAction() { if (! wCMS::$loggedIn || ! isset($\_POST['old\_password']) || ! isset($\_POST['new\_password'])) { return; } if ($\_SESSION['token'] === $\_REQUEST['token'] && hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { if (! password\_verify($\_POST['old\_password'], wCMS::get('config', 'password'))) { wCMS::alert('danger', 'Wrong password.'); wCMS::redirect(); } if (strlen($\_POST['new\_password']) < 4) { wCMS::alert('danger', 'Password must be longer than 4 characters.'); wCMS::redirect(); } wCMS::set('config', 'password', password\_hash($\_POST['new\_password'], PASSWORD\_DEFAULT)); wCMS::alert('success', 'Password changed.'); wCMS::redirect(); } }
 private static function createDatabase() { if (wCMS::db() !== false) { return; } wCMS::save([ 'config' => [ 'dbVersion' => '2.4.0', 'siteTitle' => 'Website title', 'theme' => 'default', 'defaultPage' => 'home', 'login' => 'loginURL', 'password' => password\_hash('admin', PASSWORD\_DEFAULT), 'menuItems' => [ '0' => [ 'name' => 'Home', 'slug' => 'home', 'visibility' => 'show' ], '1' => [ 'name' => 'Example', 'slug' => 'example', 'visibility' => 'show' ] ] ], 'pages' => [ '404' => [ 'title' => '404', 'keywords' => '', 'description' => '', 'content' => '<h1>Sorry, page not found. :(</h1>' ], 'home' => [ 'title' => 'Home', 'keywords' => 'Keywords, are, good, for, search, engines', 'description' => 'A short description is also good.', 'content' => '<h1>Website alive!</h1>
<h4><a href="' . wCMS::url('loginURL') . '">Click to login, the password is <b>admin</b>.</a></h4>' ], 'example' => [ 'title' => 'Example', 'keywords' => 'Keywords, are, good, for, search, engines', 'description' => 'A short description is also good.', 'content' => '<h1>How to create new pages</h1><p><i>Settings -> General -> Add page</i></p>
<h1>How to edit anything</h1><p>Click anywhere inside the gray dashed area to edit. Click outside the area to save.</p>
<h1>How to install/update themes and plugins</h1><p>1. Copy link/URL to ZIP file.</p><p>2. Paste link in <i>Settings -> Themes and plugins</i> and click <i>Install/update</i>.</p><p><a href="https://wondercms.com/themes" target="\_blank">WonderCMS themes</a> | <a href="https://wondercms.com/plugins" target="\_blank">WonderCMS plugins</a></p>' ] ], 'blocks' => [ 'subside' => [ 'content' => '<h3>About your website</h3>
<p>Website description, photo, contact information, mini map or anything else.</p><p>This block is visible on all pages.</p>' ], 'footer' => [ 'content' => '&copy;' . date('Y') . ' Your website' ] ] ]); }
 private static function createMenuItem($content, $menu, $visibility) { $conf = 'config'; $field = 'menuItems'; $exist = is\_numeric($menu); $visibility = (isset($visibility) && $visibility == "show") ? "show" : "hide"; $content = empty($content) ? "empty" : str\_replace(array(PHP\_EOL, '<br>'), '', $content); $slug = wCMS::slugify($content); $menuCount = count(get\_object\_vars(wCMS::get($conf, $field))); if (! $exist) { $db = wCMS::db(); $slug.= ($menu) ? "-" . $menuCount : ""; foreach ($db->config->{$field} as $key=>$value) { if ($value->slug == $slug) { $slug.= "-extra"; } } $db->config->{$field}->{$menuCount} = new stdClass; wCMS::save($db); wCMS::set($conf, $field, $menuCount, 'name', str\_replace("-", " ", $content)); wCMS::set($conf, $field, $menuCount, 'slug', $slug); wCMS::set($conf, $field, $menuCount, 'visibility', $visibility); if ($menu) { wCMS::createPage($slug); } } else { $oldSlug = wCMS::get($conf, $field, $menu, 'slug'); wCMS::set($conf, $field, $menu, 'name', $content); wCMS::set($conf, $field, $menu, 'slug', $slug); wCMS::set($conf, $field, $menu, 'visibility', $visibility); if ($slug !== $oldSlug) { wCMS::createPage($slug); wCMS::deletePageAction($oldSlug, false); } } }
 private static function createPage($slug = false) { $db = wCMS::db(); $db->pages->{(! $slug) ? wCMS::$currentPage : $slug} = new stdClass; wCMS::save($db); wCMS::set('pages', (! $slug) ? wCMS::slugify(wCMS::$currentPage) : $slug, 'title', (! $slug) ? mb\_convert\_case(str\_replace("-", " ", wCMS::$currentPage), MB\_CASE\_TITLE) : mb\_convert\_case(str\_replace("-", " ", $slug), MB\_CASE\_TITLE)); wCMS::set('pages', (! $slug) ? wCMS::slugify(wCMS::$currentPage) : $slug, 'keywords', 'Keywords, are, good, for, search, engines'); wCMS::set('pages', (! $slug) ? wCMS::slugify(wCMS::$currentPage) : $slug, 'description', 'A short description is also good.'); if (! $slug) { wCMS::createMenuItem(wCMS::slugify(wCMS::$currentPage), null, "show"); } }
 private static function css() { if (wCMS::$loggedIn) { $styles = <<<'EOT'<style>#adminPanel{background:#e5e5e5;color:#aaa;font-family:"Lucida Sans Unicode",Verdana;font-size:14px;text-align:left;font-variant:small-caps}#adminPanel .fontSize21{font-size:21px}.alert{margin-bottom:0}#adminPanel a{color:#aaa;outline:0;border:0;text-decoration:none;}#adminpanel .alert a{color:#fff}#adminPanel a.btn{color:#fff}#adminPanel div.editText{color:#555;font-variant:normal}#adminPanel .normalFont{font-variant:normal}div.editText{word-wrap:break-word;cursor:pointer;border:2px dashed #ccc;display:block}.cursorPointer{cursor:pointer}div.editText textarea{outline:0;border:none;width:100%;resize:none;color:inherit;font-size:inherit;font-family:inherit;background-color:transparent;overflow:hidden;box-sizing:content-box}div.editText:empty{min-height:20px}#save{color:#ccc;left:0;width:100%;height:100%;display:none;position:fixed;text-align:center;padding-top:100px;background:rgba(51,51,51,.8);z-index:2448}.change{padding-left:15px}.marginTop5{margin-top:5px}.marginTop20{margin-top:20px}.marginLeft5{margin-left:5px}.padding20{padding:20px}.subTitle{color:#aaa;font-size:24px;margin:10px 0 5px;font-variant:all-small-caps}.menu-item-hide{color:#5bc0de}.menu-item-delete,.menu-item-hide,.menu-item-show{padding:0 10%}#adminPanel .nav-tabs{border-bottom:2px solid #ddd}#adminPanel .nav-tabs>li>a::after{content:"";background:#1ab;height:2px;position:absolute;width:100%;left:0;bottom:-1px;transition:all 250ms ease 0s;transform:scale(0)}#adminPanel .nav-tabs>li>a::hover{border-bottom:1px solid #1ab!important:}#adminPanel .nav-tabs>li.active>a::after,#adminPanel .nav-tabs>li:hover>a::after{transform:scale(1)}.tab-content{padding:20px}#adminPanel .modal-content{background-color:#eee}#adminPanel .modal-header{border:0}#adminPanel .nav li{font-size:30px;float:none;display:inline-block}#adminPanel .tab-pane.active a.btn{color:#fff}#adminPanel .nav-tabs>li.active a,#adminPanel .tab-pane.active{background:0!important;border:0!important;color:#aaa!important}#adminPanel .clear{clear:both}@media(min-width:768px){#adminPanel .modal-xl{width:90%;max-width:1200px}}</style>EOT; return wCMS::hook('css', $styles)[0]; } return wCMS::hook('css', '')[0]; }
 public static function db() { return file\_exists(\_\_DIR\_\_ . '/database.js') ? json\_decode(file\_get\_contents(\_\_DIR\_\_ . '/database.js')) : false; }
 private static function deleteFileThemePluginAction() { if (! wCMS::$loggedIn) { return; } if (isset($\_REQUEST['deleteFile']) || isset($\_REQUEST['deleteTheme']) || isset($\_REQUEST['deletePlugin']) && isset($\_REQUEST['token'])) { if (hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { $deleteList = [ [\_\_DIR\_\_.'/files', 'deleteFile'], [\_\_DIR\_\_.'/themes', 'deleteTheme'], [\_\_DIR\_\_.'/plugins', 'deletePlugin'], ]; foreach($deleteList as $entry) { list($folder, $request) = $entry; $filename = isset($\_REQUEST[$request]) ? trim($\_REQUEST[$request]) : false; if (!$filename || empty($filename)) { continue; } if ($filename == wCMS::get('config', 'theme')) { wCMS::alert('danger', 'Cannot delete currently active theme.'); wCMS::redirect(); continue; } if (file\_exists("{$folder}/{$filename}")) { wCMS::recursiveDelete("{$folder}/{$filename}"); wCMS::alert('success', "Deleted {$filename}."); wCMS::redirect(); } } } } }
 private static function deletePageAction($needle = false, $menu = true) { if (! $needle) { if (wCMS::$loggedIn && isset($\_GET['delete']) && hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { $needle = $\_GET['delete']; } } $db = wCMS::db(); if (isset(wCMS::get('pages')->{$needle})) { unset($db->pages->{$needle}); } if ($menu) { $menuItems = json\_decode(json\_encode(wCMS::get('config', 'menuItems')), true); if (false === ($index = array\_search($needle, array\_column($menuItems, "slug")))) { return; } unset($menuItems[$index]); $newMenu=array\_values($menuItems); $db->config->menuItems = json\_decode(json\_encode($newMenu)); } wCMS::save($db); wCMS::alert('success', 'Page deleted.'); wCMS::redirect(); }
 public static function editable($id, $content, $dataTarget = '') { return '<div' . ($dataTarget != '' ? ' data-target="' . $dataTarget . '"' : '') . ' id="' . $id . '" class="editText editable">' . $content . '</div>'; }
 public static function footer() { $output = wCMS::get('blocks', 'footer')->content . (! wCMS::$loggedIn ? ((wCMS::get('config', 'login') == 'loginURL') ? ' &bull; <a href="' . wCMS::url('loginURL') . '">Login</a>' : '') : ''); return wCMS::hook('footer', $output)[0]; }
 public static function generateToken() { return (isset($\_SESSION["token"])) ? $\_SESSION["token"] : $\_SESSION["token"] = bin2hex(openssl\_random\_pseudo\_bytes(32)); }
 public static function get() { $numArgs = func\_num\_args(); $args = func\_get\_args(); if (! wCMS::$db) { wCMS::$db = wCMS::db(); } switch ($numArgs) { case 1: return wCMS::$db->{$args[0]}; break; case 2: return wCMS::$db->{$args[0]}->{$args[1]}; break; case 3: return wCMS::$db->{$args[0]}->{$args[1]}->{$args[2]}; break; case 4: return wCMS::$db->{$args[0]}->{$args[1]}->{$args[2]}->{$args[3]}; break; default: return false; break; } }
 public static function getExternalFile($url) { $ch = curl\_init(); curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); curl\_setopt($ch, CURLOPT\_URL, $url); $data = curl\_exec($ch); curl\_close($ch); return $data; }
 private static function getMenuSettings() { return wCMS::hook('getMenuSettings', $output)[0]; }
 private static function getOfficialVersion() { $data = trim(wCMS::getExternalFile('https://raw.githubusercontent.com/robiso/wondercms/master/version')); return $data; }
 private static function hook() { $numArgs = func\_num\_args(); $args = func\_get\_args(); if ($numArgs < 2) { trigger\_error('Insufficient arguments', E\_USER\_ERROR); } $hookName = array\_shift($args); if (! isset(wCMS::$listeners[$hookName])) { return $args; } foreach (wCMS::$listeners[$hookName] as $func) { $args = $func($args); } return $args; }
 private static function installThemePluginAction() { if (! wCMS::$loggedIn && ! isset($\_POST['installAddon'])) { return; } if (hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { $installLocation = trim(strtolower($\_POST['installLocation'])); $addonURL = $\_POST['addonURL']; $validPaths = array("themes", "plugins"); if (in\_array($installLocation, $validPaths) && ! empty($addonURL)) { $zipFile = \_\_DIR\_\_ . '/files/ZIPFromURL.zip'; $zipResource = fopen($zipFile, "w"); $ch = curl\_init(); curl\_setopt($ch, CURLOPT\_URL, $addonURL); curl\_setopt($ch, CURLOPT\_FOLLOWLOCATION, true); curl\_setopt($ch, CURLOPT\_FILE, $zipResource); curl\_exec($ch); curl\_close($ch); $zip = new ZipArchive; $extractPath = \_\_DIR\_\_ . '/' . $installLocation . '/'; if ($zip->open($zipFile) != 'true' || (stripos($addonURL, '.zip') != true)) { wCMS::recursiveDelete(\_\_DIR\_\_ . '/files/ZIPFromURL.zip'); wCMS::alert('danger', 'Error opening ZIP file.'); wCMS::redirect(); } $zip->extractTo($extractPath); $zip->close(); wCMS::recursiveDelete(\_\_DIR\_\_ . '/files/ZIPFromURL.zip'); wCMS::alert('success', 'Installed successfully.'); wCMS::redirect(); } elseif (empty($installLocation)) { wCMS::alert('danger', 'Choose between theme or plugin.'); wCMS::redirect(); } else { wCMS::alert('danger', 'Enter URL to ZIP file.'); wCMS::redirect(); } } }
 private static function js() { if (wCMS::$loggedIn) { $scripts = <<<'EOT'<script src="https://cdn.jsdelivr.net/npm/autosize@4.0.0/dist/autosize.min.js"></script><script src="https://cdn.jsdelivr.net/npm/taboverride@4.0.3/build/output/taboverride.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery.taboverride@4.0.0/build/jquery.taboverride.min.js"></script><script>$(document).tabOverride(!0,"textarea");function nl2br(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")}function fieldSave(a,b,c,d,e){$("#save").show(),$.post("",{fieldname:a,token:token,content:b,target:c,menu:d,visibility:e},function(a){}).always(function(){window.location.reload()})}var changing=!1;$(document).ready(function(){$('body').on('click','div.editText',function(){changing||(a=$(this),title=a.attr("title")?title='"'+a.attr("title")+'" ':"",a.hasClass("editable")?a.html("<textarea "+title+' id="'+a.attr("id")+'\_field" onblur="fieldSave(a.attr(\'id\'),this.value,a.data(\'target\'),a.data(\'menu\'),a.data(\'visibility\'));">'+a.html()+"</textarea>"):a.html("<textarea "+title+' id="'+a.attr("id")+'\_field" onblur="fieldSave(a.attr(\'id\'),nl2br(this.value),a.data(\'target\'),a.data(\'menu\'),a.data(\'visibility\'));">'+a.html().replace(/<br>/gi,"\n")+"</textarea>"),a.children(":first").focus(),autosize($("textarea")),changing=!0)});$('body').on('click','i.menu-toggle',function(){var a=$(this),c=(setTimeout(function(){window.location.reload()},500),a.attr("data-menu"));a.hasClass("menu-item-hide")?(a.removeClass("glyphicon-eye-open menu-item-hide").addClass("glyphicon-eye-close menu-item-show"),a.attr("title","Hide page from menu").attr("data-visibility","hide"),$.post("",{fieldname:"menuItems", token:token, content:" ",target:"menuItemVsbl",menu:c,visibility:"hide"},function(a){})):a.hasClass("menu-item-show")&&(a.removeClass("glyphicon-eye-close menu-item-show").addClass("glyphicon-eye-open menu-item-hide"),a.attr("title","Show page in menu").attr("data-visibility","show"),$.post("",{fieldname:"menuItems",token:token,content:" ",target:"menuItemVsbl",menu:c,visibility:"show"},function(a){}))}),$('body').on('click','.menu-item-add',function(){$.post("",{fieldname:"menuItems",token:token,content:"New page",target:"menuItem",menu:"none",visibility:"show"},function(a){}).done(setTimeout(function(){window.location.reload()},500))});$('body').on('click','.menu-item-up,.menu-item-down',function(){var a=$(this),b=(a.hasClass('menu-item-up'))?'-1':'1',c=a.attr("data-menu");$.post("",{fieldname:"menuItems",token:token,content:b,target:"menuItemOrder",menu:c,visibility:""},function(a){}).done(function(){$('#menuSettings').parent().load("index.php #menuSettings",{func:"getMenuSettings"})})})});</script>EOT; $scripts .= '<script>var token = "'.wCMS::generateToken().'";</script>'; return wCMS::hook('js', $scripts)[0]; } return wCMS::hook('js', '')[0]; }
 private static function loadPlugins() { if (! is\_dir(\_\_DIR\_\_ . '/plugins')) { mkdir(\_\_DIR\_\_ . '/plugins'); } if (! is\_dir(\_\_DIR\_\_ . '/files')) { mkdir(\_\_DIR\_\_ . '/files'); } foreach (glob(\_\_DIR\_\_ . '/plugins/\*', GLOB\_ONLYDIR) as $dir) { if (file\_exists($dir . '/' . basename($dir) . '.php')) { include $dir . '/' . basename($dir) . '.php'; } } }
 private static function loginAction() { if (wCMS::$currentPage !== wCMS::get('config', 'login')) { return; } if (wCMS::$loggedIn) { wCMS::redirect(); } if ($\_SERVER['REQUEST\_METHOD'] !== 'POST') { return; } $password = isset($\_POST['password']) ? $\_POST['password'] : ''; if (password\_verify($password, wCMS::get('config', 'password'))) { $\_SESSION['l'] = true; $\_SESSION['i'] = \_\_DIR\_\_; wCMS::redirect(); } wCMS::alert('danger', 'Wrong password.'); wCMS::redirect(wCMS::get('config', 'login')); }
 public static function loginView() { return ['title' => 'Login', 'description' => '', 'keywords' => '', 'content' => '<form action="' . wCMS::url(wCMS::get('config', 'login')) . '" method="post"><div class="input-group"><input type="password" class="form-control" id="password" name="password"><span class="input-group-btn"><button type="submit" class="btn btn-info">Login</button></span></div></form>']; }
 private static function logoutAction() { if (wCMS::$currentPage === 'logout' && hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { unset($\_SESSION['l'], $\_SESSION['i'], $\_SESSION['u'], $\_SESSION['token']); wCMS::redirect(); } }
 public static function menu() { $output = ''; foreach (wCMS::get('config', 'menuItems') as $key => $value) { if ($value->visibility == "hide") { continue; } $output .= '<li' . (wCMS::$currentPage === $value->slug ? ' class="active"' : '') . '><a href="' . wCMS::url($value->slug) . '">' . $value->name . '</a></li>'; } return wCMS::hook('menu', $output)[0]; }
 public static function notFoundView() { if (wCMS::$loggedIn) { return ['title' => str\_replace("-", " ", wCMS::$currentPage), 'description' => '', 'keywords' => '', 'content' => '<h2>Click here to create some content</h2><p>Once you do that, this page will be eventually visited by search engines.</p>']; } return wCMS::get('pages','404'); }
 private static function notifyAction() { if (! wCMS::$loggedIn) { return; } if (! wCMS::$currentPageExists) { wCMS::alert('info', '<b>This page (' . wCMS::$currentPage . ') doesn\'t exist.</b> Click inside the content below to create it.'); } if (wCMS::get('config', 'login') === 'loginURL') { wCMS::alert('warning', 'Change the default admin login URL. (<i>Settings -> Security</i>)', true); } if (password\_verify('admin', wCMS::get('config', 'password'))) { wCMS::alert('danger', 'Change the default password. (<i>Settings -> Security</i>)', true); } $repoVersion = wCMS::getOfficialVersion(); if ($repoVersion != version) { wCMS::alert('info', '<b>New WonderCMS update available.</b><p>- Backup your website and check <a href="https://wondercms.com/whatsnew" target="\_blank">what\'s new</a> before updating.</p><form action="' . wCMS::url(wCMS::$currentPage) . '" method="post" class="marginTop5"><button type="submit" class="btn btn-info" name="backup">Create backup</button><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></form><form action="" method="post" class="marginTop5"><button class="btn btn-info" name="upgrade">Update WonderCMS</button><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></form>', true); } }
 private static function orderMenuItem($content, $menu) { $conf = 'config'; $field = 'menuItems'; $content = (int) trim(htmlentities($content, ENT\_QUOTES, 'UTF-8')); $move = wCMS::get($conf, $field, $menu); $menu += $content; $tmp = wCMS::get($conf, $field, $menu); wCMS::set($conf, $field, $menu, 'name', $move->name); wCMS::set($conf, $field, $menu, 'slug', $move->slug); wCMS::set($conf, $field, $menu, 'visibility', $move->visibility); $menu -= $content; wCMS::set($conf, $field, $menu, 'name', $tmp->name); wCMS::set($conf, $field, $menu, 'slug', $tmp->slug); wCMS::set($conf, $field, $menu, 'visibility', $tmp->visibility); }
 public static function page($key) { $segments = wCMS::$currentPageExists ? wCMS::get('pages', wCMS::$currentPage) : (wCMS::get('config','login') == wCMS::$currentPage ? (object) wCMS::loginView() : (object) wCMS::notFoundView()); $segments->content = isset($segments->content) ? $segments->content: '<h2>Click here to create some content</h2><p>Once you do that, this page will be eventually visited by search engines.</p>'; $keys = ['title' => $segments->title, 'description' => $segments->description, 'keywords' => $segments->keywords, 'content' => (wCMS::$loggedIn ? wCMS::editable('content', $segments->content, 'pages') : $segments->content)]; $content = isset($keys[$key]) ? $keys[$key] : ''; return wCMS::hook('page', $content, $key)[0]; }  public static function parseUrl() { if (isset($\_GET['page']) && $\_GET['page'] == wCMS::get('config', 'login')) { return htmlspecialchars($\_GET['page'], ENT\_QUOTES); } return isset($\_GET['page']) ? wCMS::slugify($\_GET['page']) : ''; }
 private static function recursiveDelete($file) { if (is\_dir($file)) { $list = glob($file . '\*', GLOB\_MARK); foreach ($list as $dir) { wCMS::recursiveDelete($dir); } rmdir($file); } elseif (is\_file($file)) { unlink($file); } }
 public static function redirect($location = '') { header('Location: '.wCMS::url($location)); die(); }
 public static function save($db) { file\_put\_contents(\_\_DIR\_\_ . '/database.js', json\_encode($db, JSON\_FORCE\_OBJECT | JSON\_UNESCAPED\_UNICODE | JSON\_PRETTY\_PRINT)); }
 private static function saveAction() { if (! wCMS::$loggedIn) { return; } if (isset($\_POST['fieldname']) && isset($\_POST['content']) && isset($\_POST['target']) && isset($\_REQUEST['token']) && hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { list($fieldname, $content, $target, $menu, $visibility) = wCMS::hook('save', $\_POST['fieldname'], $\_POST['content'], $\_POST['target'], $\_POST['menu'], $\_POST['visibility']); if ($target === 'menuItem') { wCMS::createMenuItem($content, $menu, $visibility); } if ($target === 'menuItemVsbl') { wCMS::set('config', $fieldname, $menu, 'visibility', $visibility); } if ($target === 'menuItemOrder') { wCMS::orderMenuItem($content, $menu); } if ($fieldname === 'defaultPage') { if (! isset(wCMS::get('pages')->$content)) { return; } } if ($fieldname === 'login') { if (empty($content) || isset(wCMS::get('pages')->$content)) { return; } } if ($fieldname === 'theme') { if (! is\_dir(\_\_DIR\_\_ . '/themes/' . $content)) { return; } } if ($target === 'config') { wCMS::set('config', $fieldname, $content); } elseif ($target === 'blocks') { wCMS::set('blocks', $fieldname, 'content', $content); } elseif ($target === 'pages') { if (! isset(wCMS::get('pages')->{wCMS::$currentPage})) { wCMS::createPage(); } wCMS::set('pages', wCMS::$currentPage, $fieldname, $content); } } }
 public static function set() { $numArgs = func\_num\_args(); $args = func\_get\_args(); $db = wCMS::db(); switch ($numArgs) { case 2: $db->{$args[0]} = $args[1]; break; case 3: $db->{$args[0]}->{$args[1]} = $args[2]; break; case 4: $db->{$args[0]}->{$args[1]}->{$args[2]} = $args[3]; break; case 5: $db->{$args[0]}->{$args[1]}->{$args[2]}->{$args[3]} = $args[4]; break; } wCMS::save($db); }
 public static function settings() { if (! wCMS::$loggedIn) { return; } $fileList = array\_slice(scandir(\_\_DIR\_\_ . '/files/'), 2); $themeList = array\_slice(scandir(\_\_DIR\_\_ . '/themes/'), 2); $pluginList = array\_slice(scandir(\_\_DIR\_\_ . '/plugins/'), 2); $output = '<div id="save"><h2>Saving...</h2></div><div id="adminPanel" class="container-fluid"><div class="text-right padding20"><a data-toggle="modal" class="padding20" href="#settingsModal"><b>Settings</b></a><a href="' . wCMS::url('logout&token='.wCMS::generateToken()).'">Logout</a></div><div class="modal" id="settingsModal"><div class="modal-dialog modal-xl"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body col-xs-12"><ul class="nav nav-tabs text-center" role="tablist"><li role="presentation" class="active"><a href="#currentPage" aria-controls="currentPage" role="tab" data-toggle="tab">Current page</a></li><li role="presentation"><a href="#general" aria-controls="general" role="tab" data-toggle="tab">General</a></li><li role="presentation"><a href="#files" aria-controls="files" role="tab" data-toggle="tab">Files</a></li><li role="presentation"><a href="#themesAndPlugins" aria-controls="themesAndPlugins" role="tab" data-toggle="tab">Themes & plugins</a></li><li role="presentation"><a href="#security" aria-controls="security" role="tab" data-toggle="tab">Security</a></li></ul><div class="tab-content col-md-8 col-md-offset-2"><div role="tabpanel" class="tab-pane active" id="currentPage">'; if (wCMS::$currentPageExists) { $output .= '<p class="subTitle">Page title</p><div class="change"><div data-target="pages" id="title" class="editText">' . (wCMS::get('pages', wCMS::$currentPage)->title != '' ? wCMS::get('pages', wCMS::$currentPage)->title : '') . '</div></div><p class="subTitle">Page keywords</p><div class="change"><div data-target="pages" id="keywords" class="editText">' . (wCMS::get('pages', wCMS::$currentPage)->keywords != '' ? wCMS::get('pages', wCMS::$currentPage)->keywords : '') . '</div></div><p class="subTitle">Page description</p><div class="change"><div data-target="pages" id="description" class="editText">' . (wCMS::get('pages', wCMS::$currentPage)->description != '' ? wCMS::get('pages', wCMS::$currentPage)->description : '') . '</div></div><a href="' . wCMS::url('?delete=' . wCMS::$currentPage . '&token=' . wCMS::generateToken()) . '" class="btn btn-danger marginTop20" title="Delete page" onclick="return confirm(\'Delete ' . wCMS::$currentPage . '?\')">Delete page (' . wCMS::$currentPage . ')</a>'; } else { $output .= 'This page doesn\'t exist. More settings will be displayed here after this page is created.'; } $output .= '</div><div role="tabpanel" class="tab-pane" id="general">'; $items = wCMS::get('config', 'menuItems'); reset($items); $first = key($items); end($items); $end = key($items); $output .= '<p class="subTitle">Menu</p><div><div id="menuSettings" class="container-fluid">'; foreach ($items as $key => $value) { $output .= '<div class="row marginTop5"><div class="col-xs-1 col-sm-1 text-right"><i class="btn menu-toggle glyphicon' . ($value->visibility == "show" ? ' glyphicon-eye-open menu-item-hide' : ' glyphicon-eye-close menu-item-show') . '" data-toggle="tooltip" title="' . ($value->visibility == "show" ? 'Hide page from menu' : 'Show page in menu') . '" data-menu="' . $key . '"></i></div><div class="col-xs-4 col-sm-8"><div data-target="menuItem" data-menu="' . $key . '" data-visibility="' . ($value->visibility) . '" id="menuItems" class="editText">' . $value->name . '</div></div><div class="col-xs-2 col-sm-1 text-left">'; $output .= ($key === $first) ? '' : '<a class="glyphicon glyphicon-arrow-up toolbar menu-item-up cursorPointer" data-toggle="tooltip" data-menu="' . $key . '" title="Move up"></a>'; $output .= ($key === $end) ?'' : '<a class="glyphicon glyphicon-arrow-down toolbar menu-item-down cursorPointer" data-toggle="tooltip" data-menu="' . $key . '" title="Move down"></a>'; $output .= '</div><div class="col-xs-2 col-sm-1 text-left"><a class="glyphicon glyphicon-link" href="' . wCMS::url($value->slug) . '" title="Visit page">visit</a></div><div class="col-xs-2 col-sm-1 text-right"><a href="' . wCMS::url('?delete=' . $value->slug.'&token='.wCMS::generateToken()) . '" title="Delete page" class="btn btn-xs btn-danger" data-menu="' . $key . '" onclick="return confirm(\'Delete ' . $value->slug . '?\')">&times;</a></div></div>'; } $output .= '<a class="menu-item-add btn btn-info marginTop20" data-toggle="tooltip" title="Add new page">Add page</a></div></div><p class="subTitle">Theme</p><div class="form-group"><div class="change"><select class="form-control" name="themeSelect" onchange="fieldSave(\'theme\',this.value,\'config\');">'; foreach (glob(\_\_DIR\_\_ . '/themes/\*', GLOB\_ONLYDIR) as $dir) { $output .= '<option value="' . basename($dir) . '"' . (basename($dir) == wCMS::get('config', 'theme') ? ' selected' : '') . '>' . basename($dir) . ' theme'.'</option>'; } $output .= '</select></div></div><p class="subTitle">Main website title</p><div class="change"><div data-target="config" id="siteTitle" class="editText">' . (wCMS::get('config', 'siteTitle') != '' ? wCMS::get('config', 'siteTitle') : '') . '</div></div><p class="subTitle">Page to display on homepage</p><div class="change"><div data-target="config" id="defaultPage" class="editText">' . wCMS::get('config', 'defaultPage') . '</div></div><p class="subTitle">Footer</p><div class="change"><div data-target="blocks" id="footer" class="editText">' . (wCMS::get('blocks', 'footer')->content != '' ? wCMS::get('blocks', 'footer')->content : '') . '</div></div></div><div role="tabpanel" class="tab-pane" id="files"><p class="subTitle">Upload</p><div class="change"><form action="' . wCMS::url(wCMS::$currentPage) . '" method="post" enctype="multipart/form-data"><div class="input-group"><input type="file" name="uploadFile" class="form-control"><span class="input-group-btn"><button type="submit" class="btn btn-info">Upload</button></span><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></div></form></div><p class="subTitle marginTop20">Delete files</p><div class="change">'; foreach ($fileList as $file) { $output .= '<a href="' . wCMS::url('?deleteFile='.$file.'&token='.wCMS::generateToken()).'" class="btn btn-xs btn-danger" onclick="return confirm(\'Delete ' . $file . '?\')" title="Delete file">&times;</a><span class="marginLeft5"><a href="'. wCMS::url('files/'). $file.'" class="normalFont" target="\_blank">'.wCMS::url('files/').'<b class="fontSize21">'.$file.'</b></a></span><p></p>'; } $output .= '</div></div><div role="tabpanel" class="tab-pane" id="security"><p class="subTitle">Admin login URL</p><div class="change"><div data-target="config" id="login" class="editText">' . wCMS::get('config', 'login') . '</div><p class="text-right marginTop5">Important: bookmark your login URL after changing<br /><span class="normalFont text-right"><b>' . wCMS::url(wCMS::get('config', 'login')) . '</b></span></div><p class="subTitle">Password</p><div class="change"><form action="' . wCMS::url(wCMS::$currentPage) . '" method="post"><div class="input-group"><input type="password" name="old\_password" class="form-control" placeholder="Old password"><span class="input-group-btn"></span><input type="password" name="new\_password" class="form-control" placeholder="New password"><span class="input-group-btn"><button type="submit" class="btn btn-info">Change password</button></span></div><input type="hidden" name="fieldname" value="password"><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></form></div><p class="subTitle">Backup</p><div class="change"><form action="' . wCMS::url(wCMS::$currentPage) . '" method="post"><button type="submit" class="btn btn-block btn-info" name="backup">Backup website</button><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></form></div><p class="text-right marginTop5"><a href="https://github.com/robiso/wondercms/wiki/Restore-backup#how-to-restore-a-backup-in-3-steps" target="\_blank">How to restore backup</a></p></div><div role="tabpanel" class="tab-pane" id="themesAndPlugins"><p class="subTitle">Install or update</p><div class="change"><form action="' . wCMS::url(wCMS::$currentPage) . '" method="post"><div class="form-group"><label class="radio-inline"><input type="radio" name="installLocation" value="themes">Theme</label><label class="radio-inline"><input type="radio" name="installLocation" value="plugins">Plugin</label><p></p><div class="input-group"><input type="text" name="addonURL" class="form-control normalFont" placeholder="Paste link/URL to ZIP file"><span class="input-group-btn"><button type="submit" class="btn btn-info">Install/Update</button></span></div></div><input type="hidden" value="true" name="installAddon"><input type="hidden" name="token" value="' . wCMS::generateToken() . '"></form></div><p class="subTitle">Delete themes</p><div class="change">'; foreach ($themeList as $theme) { $output .= '<a href="' . wCMS::url('?deleteTheme='.$theme.'&token='.wCMS::generateToken()).'" class="btn btn-xs btn-danger" onclick="return confirm(\'Delete ' . $theme . '?\')" title="Delete theme">&times;</a> '.$theme.'<p></p>'; } $output .= '</div><p class="subTitle">Delete plugins</p><div class="change">'; foreach ($pluginList as $plugin) { $output .= '<a href="' . wCMS::url('?deletePlugin='.$plugin.'&token='.wCMS::generateToken()).'" class="btn btn-xs btn-danger" onclick="return confirm(\'Delete ' . $plugin . '?\')" title="Delete plugin">&times;</a> '.$plugin.'<p></p>'; } $output .= '</div></div></div></div><div class="modal-footer clear"><p class="small"><a href="https://wondercms.com" target="\_blank">WonderCMS</a> '. version . ' &nbsp; <b><a href="https://wondercms.com/themes" target="\_blank">Themes</a> &nbsp; <a href="https://wondercms.com/plugins" target="\_blank">Plugins</a> &nbsp; <a href="https://wondercms.com/community" target="\_blank">Community</a> &nbsp; <a href="https://github.com/robiso/wondercms/wiki#wondercms-documentation" target="\_blank">Documentation</a> &nbsp; <a href="https://wondercms.com/donate" target="\_blank">Donate</a></b></p></div></div></div></div></div>'; return wCMS::hook('settings', $output)[0]; }
 public static function slugify($text) { $text = preg\_replace('~[^\\pL\d]+~u', '-', $text); $text = trim(htmlspecialchars(mb\_strtolower($text), ENT\_QUOTES), '/'); $text = trim($text, '-'); return empty($text) ? "-" : $text; }
 private static function upgradeAction() { if (! wCMS::$loggedIn || ! isset($\_POST['upgrade'])) { return; } if (hash\_equals($\_REQUEST['token'], wCMS::generateToken())) { $contents = wCMS::getExternalFile('https://raw.githubusercontent.com/robiso/wondercms/master/index.php'); if ($contents) { file\_put\_contents(\_\_FILE\_\_, $contents); } wCMS::alert('success', 'WonderCMS successfully updated. Wohoo!'); wCMS::redirect(); } }
 private static function uploadFileAction() { if (! wCMS::$loggedIn && ! isset($\_FILES['uploadFile']) && ! isset($\_REQUEST['token'])) { return; } $allowed = ['gif' => 'image/gif', 'jpg' => 'image/jpeg', 'ico' => 'image/x-icon', 'png' => 'image/png', 'svg' => 'image/svg+xml', 'txt' => 'text/plain', 'doc' => 'application/vnd.ms-word', 'docx' => 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'kdbx' => 'application/octet-stream', 'ods' => 'application/vnd.oasis.opendocument.spreadsheet', 'odt' => 'application/vnd.oasis.opendocument.text', 'ogg' => 'application/ogg', 'pdf' => 'application/pdf', 'ppt' => 'application/vnd.ms-powerpoint', 'pptx' => 'application/vnd.openxmlformats-officedocument.presentationml.presentation', 'psd' => 'application/photoshop', 'rar' => 'application/rar', 'xls' => 'application/vnd.ms-excel', 'xlsx' => 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'zip' => 'application/zip', 'm4a' => 'audio/mp4', 'mp3' => 'audio/mpeg', 'avi' => 'video/avi', 'flv' => 'video/x-flv', 'mkv' => 'video/x-matroska', 'mov' => 'video/quicktime', 'mp4' => 'video/mp4', 'mpg' => 'video/mpeg', 'ogv' => 'video/ogg', 'webm' => 'video/webm', 'wmv' => 'video/x-ms-wmv']; if (isset($\_REQUEST['token']) && hash\_equals($\_REQUEST['token'], wCMS::generateToken()) && isset($\_FILES['uploadFile'])) { try { if (! isset($\_FILES['uploadFile']['error']) || is\_array($\_FILES['uploadFile']['error'])) { wCMS::alert('danger', 'Invalid parameters.'); wCMS::redirect(); } switch ($\_FILES['uploadFile']['error']) { case UPLOAD\_ERR\_OK: break; case UPLOAD\_ERR\_NO\_FILE: wCMS::alert('danger', 'No file selected.'); wCMS::redirect(); case UPLOAD\_ERR\_INI\_SIZE: case UPLOAD\_ERR\_FORM\_SIZE: wCMS::alert('danger', 'File too large. Change maximum upload size limit or contact your host.'); wCMS::redirect(); default: wCMS::alert('danger', 'Unknown error.'); wCMS::redirect(); } $mimeType = ''; if (class\_exists('finfo')) { $finfo = new finfo(FILEINFO\_MIME\_TYPE); $mimeType = $finfo->file($\_FILES['uploadFile']['tmp\_name']); } elseif (function\_exists('mime\_content\_type')) { $mimeType = mime\_content\_type($\_FILES['uploadFile']['tmp\_name']); } else { $ext = strtolower(array\_pop(explode('.', $\_FILES['uploadFile']['name']))); if (array\_key\_exists($ext, $allowed)) { $mimeType = $allowed[$ext]; } } if (false === $ext = array\_search($mimeType, $allowed, true)) { wCMS::alert('danger', 'File format is not allowed.'); wCMS::redirect(); } if (! move\_uploaded\_file($\_FILES['uploadFile']['tmp\_name'], sprintf(\_\_DIR\_\_ . '/files/%s', $\_FILES['uploadFile']['name']))) { wCMS::alert('danger', 'Failed to move uploaded file.'); wCMS::redirect(); } wCMS::alert('success', 'File uploaded.'); wCMS::redirect(); } catch (RuntimeException $e) { wCMS::alert('danger', 'Error: ' . $e->getMessage()); wCMS::redirect(); } } }
 public static function url($location = '') { return 'http' . (isset($\_SERVER['HTTPS']) && $\_SERVER['HTTPS'] == 'on' ? 's' : '') . '://' . $\_SERVER['SERVER\_NAME'] . ((($\_SERVER['SERVER\_PORT'] == '80') || ($\_SERVER['SERVER\_PORT'] == '443')) ? '' : ':' . $\_SERVER['SERVER\_PORT']) . ((dirname($\_SERVER['SCRIPT\_NAME']) == '/') ? '' : dirname($\_SERVER['SCRIPT\_NAME'])) . '/' . $location; }
 private static function zipBackup($source, $destination) { if (extension\_loaded('zip')) { if (file\_exists($source)) { $zip = new ZipArchive(); if ($zip->open($destination, ZIPARCHIVE::CREATE)) { $source = realpath($source); if (is\_dir($source)) { $iterator = new RecursiveDirectoryIterator($source); $iterator->setFlags(RecursiveDirectoryIterator::SKIP\_DOTS); $files = new RecursiveIteratorIterator($iterator, RecursiveIteratorIterator::SELF\_FIRST); foreach ($files as $file) { $file = realpath($file); if (is\_dir($file)) { $zip->addEmptyDir(str\_replace($source . '/', '', $file . '/')); } elseif (is\_file($file)) { $zip->addFromString(str\_replace($source . '/', '', $file), file\_get\_contents($file)); } } } elseif (is\_file($source)) { $zip->addFromString(basename($source), file\_get\_contents($source)); } } return $zip->close(); } } return false; }}
wCMS::init();

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


