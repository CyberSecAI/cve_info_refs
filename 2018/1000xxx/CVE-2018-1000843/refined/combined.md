=== Content from github.com_c33ccf66_20250125_212022.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fspotify%2Fluigi%2Fpull%2F1870)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fspotify%2Fluigi%2Fpull%2F1870)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=spotify%2Fluigi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[spotify](/spotify)
/
**[luigi](/spotify/luigi)**
Public

* [Notifications](/login?return_to=%2Fspotify%2Fluigi) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fspotify%2Fluigi)
* [Star
   18k](/login?return_to=%2Fspotify%2Fluigi)

* [Code](/spotify/luigi)
* [Issues
  108](/spotify/luigi/issues)
* [Pull requests
  30](/spotify/luigi/pulls)
* [Actions](/spotify/luigi/actions)
* [Projects
  0](/spotify/luigi/projects)
* [Security](/spotify/luigi/security)
* [Insights](/spotify/luigi/pulse)

Additional navigation options

* [Code](/spotify/luigi)
* [Issues](/spotify/luigi/issues)
* [Pull requests](/spotify/luigi/pulls)
* [Actions](/spotify/luigi/actions)
* [Projects](/spotify/luigi/projects)
* [Security](/spotify/luigi/security)
* [Insights](/spotify/luigi/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fspotify%2Fluigi%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fspotify%2Fluigi%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Add CORS headers to api requests #1870

 Merged

[Tarrasch](/Tarrasch)
merged 2 commits into
[spotify:master](/spotify/luigi/tree/master "spotify/luigi:master")
from
[jessicaaustin:master](/jessicaaustin/luigi/tree/master "jessicaaustin/luigi:master")

Oct 4, 2016

 Merged

# [Add CORS headers to api requests](#top) #1870

[Tarrasch](/Tarrasch)
merged 2 commits into
[spotify:master](/spotify/luigi/tree/master "spotify/luigi:master")
from
[jessicaaustin:master](/jessicaaustin/luigi/tree/master "jessicaaustin/luigi:master")

Oct 4, 2016

[Conversation
6](/spotify/luigi/pull/1870)
[Commits
2](/spotify/luigi/pull/1870/commits)
[Checks
0](/spotify/luigi/pull/1870/checks)
[Files changed](/spotify/luigi/pull/1870/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![jessicaaustin](https://avatars.githubusercontent.com/u/1159930?s=60&v=4)](/jessicaaustin)

Copy link

Contributor

### @jessicaaustin **[jessicaaustin](/jessicaaustin)** commented [Sep 30, 2016](#issue-180420786)

## Description

Add the following headers to API server requests:

* `Access-Control-Allow-Headers:Accept, Authorization, Content-Type, Origin`
* `Access-Control-Allow-Methods:GET, OPTIONS`
* `Access-Control-Allow-Origin:*`

## Motivation and Context

This allows an external application to request data from the api via Javascript. In our specific case, we request JSON data from `/api/graph` and display it in an internal ops dashboard.

## Have you tested this? If so, how?

Ran the server locally and verified that the desired headers show up. Tested out with an AngularJS application that pulls in luigi task data.

Simple test that you can run in a dev console (requires jQuery): `$.get("http://localhost:8082/api/graph", function(data) { console.dir(data.response); })`

Sorry, something went wrong.

All reactions

`[Add CORS headers to /api requests](/spotify/luigi/pull/1870/commits/53b52e12745075a8acc016d33945d9d6a7a6aaeb "Add CORS headers to /api requests")`

`[53b52e1](/spotify/luigi/pull/1870/commits/53b52e12745075a8acc016d33945d9d6a7a6aaeb)`

[![@mention-bot](https://avatars.githubusercontent.com/u/15710697?s=80&u=3565aa4e37d1ed4c6573d825444e61d49f6f2452&v=4)](/mention-bot)

Copy link

### **[mention-bot](/mention-bot)** commented [Sep 30, 2016](#issuecomment-250873307)

| [@jessicaaustin](https://github.com/jessicaaustin), thanks for your PR! By analyzing the annotation information on this pull request, we identified [@ystopia](https://github.com/ystopia), [@erikbern](https://github.com/erikbern) and [@freider](https://github.com/freider) to be potential reviewers |
| --- |

All reactions

Sorry, something went wrong.

[![@jessicaaustin](https://avatars.githubusercontent.com/u/1159930?s=40&u=05f074a9774fed790f678ca35f8a2099a6571f52&v=4)](/jessicaaustin)
[jessicaaustin](/jessicaaustin)
changed the title
~~Add CORS headers to /api requests~~
Add CORS headers to api requests
[Sep 30, 2016](#event-809141247)

[![@erikbern](https://avatars.githubusercontent.com/u/1027979?s=80&u=488cfc6300303d548cbee59842dadedb39ef1d39&v=4)](/erikbern)

Copy link

Contributor

### **[erikbern](/erikbern)** commented [Oct 1, 2016](#issuecomment-250913124)

| lgtm! |
| --- |

All reactions

Sorry, something went wrong.

[![@Tarrasch](https://avatars.githubusercontent.com/u/294349?s=80&v=4)](/Tarrasch)

Copy link

Contributor

### **[Tarrasch](/Tarrasch)** commented [Oct 3, 2016](#issuecomment-251014885)

| LGTM. Can you also accompany this patch with test cases? |
| --- |

All reactions

Sorry, something went wrong.

`[Add test to verify CORS headers are on requests](/spotify/luigi/pull/1870/commits/7915d90ee6fcf9ac4d9763e30e2887e0f396b27d "Add test to verify CORS headers are on requests")`

`[7915d90](/spotify/luigi/pull/1870/commits/7915d90ee6fcf9ac4d9763e30e2887e0f396b27d)`

[![@jessicaaustin](https://avatars.githubusercontent.com/u/1159930?s=80&u=05f074a9774fed790f678ca35f8a2099a6571f52&v=4)](/jessicaaustin)

Copy link

Contributor

Author

### **[jessicaaustin](/jessicaaustin)** commented [Oct 3, 2016](#issuecomment-251247672)

| [@Tarrasch](https://github.com/Tarrasch) test added  successful run: <https://travis-ci.org/spotify/luigi/jobs/164703448#L2821> |
| --- |

All reactions

Sorry, something went wrong.

[![@Tarrasch](https://avatars.githubusercontent.com/u/294349?s=40&v=4)](/Tarrasch)
[Tarrasch](/Tarrasch)
merged commit [`1a5b641`](/spotify/luigi/commit/1a5b64106e9182aca70b52b0c55d70c64d76f413)
into
spotify:master

[Oct 4, 2016](https://github.com/spotify/luigi/pull/1870#event-811176178)

[![@Tarrasch](https://avatars.githubusercontent.com/u/294349?s=80&v=4)](/Tarrasch)

Copy link

Contributor

### **[Tarrasch](/Tarrasch)** commented [Oct 4, 2016](#issuecomment-251281641)

| Awesome!  Is there any chance of open sourcing any of your dashboards? Or at least show screen-shots? |
| --- |

All reactions

Sorry, something went wrong.

[![@jessicaaustin](https://avatars.githubusercontent.com/u/1159930?s=80&u=05f074a9774fed790f678ca35f8a2099a6571f52&v=4)](/jessicaaustin)

Copy link

Contributor

Author

### **[jessicaaustin](/jessicaaustin)** commented [Oct 4, 2016](#issuecomment-251459625)

| Yep, definitely. I'll post some screenshots at least, but there's a chance at least part of the dashboard will be publicly available. Thanks for merging this PR! |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Jun 29, 2022

[no mo enum 34
#3180](/spotify/luigi/pull/3180)
 Closed

[enum34 be gone
#3181](/spotify/luigi/pull/3181)
 Closed

[![@mdragilev](https://avatars.githubusercontent.com/u/79759903?s=40&v=4)](/mdragilev)
[mdragilev](/mdragilev)
mentioned this pull request
[Jun 28, 2024](#ref-pullrequest-2380693179)

[for S3 contrib package move to boto3
Affirm/luigi#26](/Affirm/luigi/pull/26)
 Merged

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fspotify%2Fluigi%2Fpull%2F1870)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@jessicaaustin](https://avatars.githubusercontent.com/u/1159930?s=52&v=4)](/jessicaaustin) [![@mention-bot](https://avatars.githubusercontent.com/u/15710697?s=52&v=4)](/mention-bot) [![@erikbern](https://avatars.githubusercontent.com/u/1027979?s=52&v=4)](/erikbern) [![@Tarrasch](https://avatars.githubusercontent.com/u/294349?s=52&v=4)](/Tarrasch)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_81ded991_20250125_212020.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fspotify%2Fluigi%2Fblob%2F2.7.9%2Fluigi%2Fserver.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fspotify%2Fluigi%2Fblob%2F2.7.9%2Fluigi%2Fserver.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=spotify%2Fluigi)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[spotify](/spotify)
/
**[luigi](/spotify/luigi)**
Public

* [Notifications](/login?return_to=%2Fspotify%2Fluigi) You must be signed in to change notification settings
* [Fork
  2.4k](/login?return_to=%2Fspotify%2Fluigi)
* [Star
   18k](/login?return_to=%2Fspotify%2Fluigi)

* [Code](/spotify/luigi/tree/2.7.9)
* [Issues
  108](/spotify/luigi/issues)
* [Pull requests
  30](/spotify/luigi/pulls)
* [Actions](/spotify/luigi/actions)
* [Projects
  0](/spotify/luigi/projects)
* [Security](/spotify/luigi/security)
* [Insights](/spotify/luigi/pulse)

Additional navigation options

* [Code](/spotify/luigi/tree/2.7.9)
* [Issues](/spotify/luigi/issues)
* [Pull requests](/spotify/luigi/pulls)
* [Actions](/spotify/luigi/actions)
* [Projects](/spotify/luigi/projects)
* [Security](/spotify/luigi/security)
* [Insights](/spotify/luigi/pulse)

## Files

 2.7.9
## Breadcrumbs

1. [luigi](/spotify/luigi/tree/2.7.9)
2. /[luigi](/spotify/luigi/tree/2.7.9/luigi)
/
# server.py

Copy path Blame  Blame
## Latest commit

## History

[History](/spotify/luigi/commits/2.7.9/luigi/server.py)269 lines (218 loc) · 9.26 KB 2.7.9
## Breadcrumbs

1. [luigi](/spotify/luigi/tree/2.7.9)
2. /[luigi](/spotify/luigi/tree/2.7.9/luigi)
/
# server.py

Top
## File metadata and controls

* Code
* Blame

269 lines (218 loc) · 9.26 KB[Raw](https://github.com/spotify/luigi/raw/refs/tags/2.7.9/luigi/server.py)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269# -\*- coding: utf-8 -\*-## Copyright 2012-2015 Spotify AB## Licensed under the Apache License, Version 2.0 (the "License");# you may not use this file except in compliance with the License.# You may obtain a copy of the License at## http://www.apache.org/licenses/LICENSE-2.0## Unless required by applicable law or agreed to in writing, software# distributed under the License is distributed on an "AS IS" BASIS,# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.# See the License for the specific language governing permissions and# limitations under the License.#"""Simple REST server that takes commands in a JSON payloadInterface to the :py:class:`~luigi.scheduler.Scheduler` class.See :doc:`/central\_scheduler` for more info."""## Description: Added codes for visualization of how long each task takes# running-time until it reaches the next status (failed or done)# At "{base\_url}/tasklist", all completed(failed or done) tasks are shown.# At "{base\_url}/tasklist", a user can select one specific task to see# how its running-time has changed over time.# At "{base\_url}/tasklist/{task\_name}", it visualizes a multi-bar graph# that represents the changes of the running-time for a selected task# up to the next status (failed or done).# This visualization let us know how the running-time of the specific task# has changed over time.## Copyright 2015 Naver Corp.# Author Yeseul Park (yeseul.park@navercorp.com)#
import atexitimport jsonimport loggingimport osimport signalimport sysimport datetimeimport time
import pkg\_resourcesimport tornado.httpserverimport tornado.ioloopimport tornado.netutilimport tornado.web
from luigi.scheduler import Scheduler, RPC\_METHODS
logger = logging.getLogger("luigi.server")
class RPCHandler(tornado.web.RequestHandler): """ Handle remote scheduling calls using rpc.RemoteSchedulerResponder. """
 def initialize(self, scheduler): self.\_scheduler = scheduler self.set\_header("Access-Control-Allow-Headers", "Accept, Authorization, Content-Type, Origin") self.set\_header("Access-Control-Allow-Methods", "GET, OPTIONS") self.set\_header("Access-Control-Allow-Origin", "\*")
 def get(self, method): if method not in RPC\_METHODS: self.send\_error(404) return payload = self.get\_argument('data', default="{}") arguments = json.loads(payload)
 if hasattr(self.\_scheduler, method): result = getattr(self.\_scheduler, method)(\*\*arguments) self.write({"response": result}) # wrap all json response in a dictionary else: self.send\_error(404)
 post = get
class BaseTaskHistoryHandler(tornado.web.RequestHandler): def initialize(self, scheduler): self.\_scheduler = scheduler
 def get\_template\_path(self): return pkg\_resources.resource\_filename(\_\_name\_\_, 'templates')
class AllRunHandler(BaseTaskHistoryHandler): def get(self): all\_tasks = self.\_scheduler.task\_history.find\_all\_runs() tasknames = [task.name for task in all\_tasks] # show all tasks with their name list to be selected # why all tasks? the duration of the event history of a selected task # can be more than 24 hours. self.render("menu.html", tasknames=tasknames)
class SelectedRunHandler(BaseTaskHistoryHandler): def get(self, name): statusResults = {} taskResults = [] # get all tasks that has been updated all\_tasks = self.\_scheduler.task\_history.find\_all\_runs() # get events history for all tasks all\_tasks\_event\_history = self.\_scheduler.task\_history.find\_all\_events()
 # build the dictionary tasks with index: id, value: task\_name tasks = {task.id: str(task.name) for task in all\_tasks}
 for task in all\_tasks\_event\_history: # if the name of user-selected task is in tasks, get its task\_id if tasks.get(task.task\_id) == str(name): status = str(task.event\_name) if status not in statusResults: statusResults[status] = [] # append the id, task\_id, ts, y with 0, next\_process with null # for the status(running/failed/done) of the selected task statusResults[status].append(({ 'id': str(task.id), 'task\_id': str(task.task\_id), 'x': from\_utc(str(task.ts)), 'y': 0, 'next\_process': ''})) # append the id, task\_name, task\_id, status, datetime, timestamp # for the selected task taskResults.append({ 'id': str(task.id), 'taskName': str(name), 'task\_id': str(task.task\_id), 'status': str(task.event\_name), 'datetime': str(task.ts), 'timestamp': from\_utc(str(task.ts))}) statusResults = json.dumps(statusResults) taskResults = json.dumps(taskResults) statusResults = tornado.escape.xhtml\_unescape(str(statusResults)) taskResults = tornado.escape.xhtml\_unescape(str(taskResults)) self.render('history.html', name=name, statusResults=statusResults, taskResults=taskResults)
def from\_utc(utcTime, fmt=None): """convert UTC time string to time.struct\_time: change datetime.datetime to time, return time.struct\_time type""" if fmt is None: try\_formats = ["%Y-%m-%d %H:%M:%S.%f", "%Y-%m-%d %H:%M:%S"] else: try\_formats = [fmt]
 for fmt in try\_formats: try: time\_struct = datetime.datetime.strptime(utcTime, fmt) except ValueError: pass else: date = int(time.mktime(time\_struct.timetuple())) return date else: raise ValueError("No UTC format matches {}".format(utcTime))
class RecentRunHandler(BaseTaskHistoryHandler): def get(self): tasks = self.\_scheduler.task\_history.find\_latest\_runs() self.render("recent.html", tasks=tasks)
class ByNameHandler(BaseTaskHistoryHandler): def get(self, name): tasks = self.\_scheduler.task\_history.find\_all\_by\_name(name) self.render("recent.html", tasks=tasks)
class ByIdHandler(BaseTaskHistoryHandler): def get(self, id): task = self.\_scheduler.task\_history.find\_task\_by\_id(id) self.render("show.html", task=task)
class ByParamsHandler(BaseTaskHistoryHandler): def get(self, name): payload = self.get\_argument('data', default="{}") arguments = json.loads(payload) tasks = self.\_scheduler.task\_history.find\_all\_by\_parameters(name, session=None, \*\*arguments) self.render("recent.html", tasks=tasks)
class RootPathHandler(BaseTaskHistoryHandler): def get(self): self.redirect("/static/visualiser/index.html")
def app(scheduler): settings = {"static\_path": os.path.join(os.path.dirname(\_\_file\_\_), "static"), "unescape": tornado.escape.xhtml\_unescape, "compress\_response": True, } handlers = [ (r'/api/(.\*)', RPCHandler, {"scheduler": scheduler}), (r'/', RootPathHandler, {'scheduler': scheduler}), (r'/tasklist', AllRunHandler, {'scheduler': scheduler}), (r'/tasklist/(.\*?)', SelectedRunHandler, {'scheduler': scheduler}), (r'/history', RecentRunHandler, {'scheduler': scheduler}), (r'/history/by\_name/(.\*?)', ByNameHandler, {'scheduler': scheduler}), (r'/history/by\_id/(.\*?)', ByIdHandler, {'scheduler': scheduler}), (r'/history/by\_params/(.\*?)', ByParamsHandler, {'scheduler': scheduler}) ] api\_app = tornado.web.Application(handlers, \*\*settings) return api\_app
def \_init\_api(scheduler, api\_port=None, address=None, unix\_socket=None): api\_app = app(scheduler) if unix\_socket is not None: api\_sockets = [tornado.netutil.bind\_unix\_socket(unix\_socket)] else: api\_sockets = tornado.netutil.bind\_sockets(api\_port, address=address) server = tornado.httpserver.HTTPServer(api\_app) server.add\_sockets(api\_sockets)
 # Return the bound socket names. Useful for connecting client in test scenarios. return [s.getsockname() for s in api\_sockets]
def run(api\_port=8082, address=None, unix\_socket=None, scheduler=None): """ Runs one instance of the API server. """ if scheduler is None: scheduler = Scheduler()
 # load scheduler state scheduler.load()
 \_init\_api( scheduler=scheduler, api\_port=api\_port, address=address, unix\_socket=unix\_socket, )
 # prune work DAG every 60 seconds pruner = tornado.ioloop.PeriodicCallback(scheduler.prune, 60000) pruner.start()
 def shutdown\_handler(signum, frame): exit\_handler() sys.exit(0)
 @atexit.register def exit\_handler(): logger.info("Scheduler instance shutting down") scheduler.dump() stop()
 signal.signal(signal.SIGINT, shutdown\_handler) signal.signal(signal.SIGTERM, shutdown\_handler) if os.name == 'nt': signal.signal(signal.SIGBREAK, shutdown\_handler) else: signal.signal(signal.SIGQUIT, shutdown\_handler)
 logger.info("Scheduler starting up")
 tornado.ioloop.IOLoop.instance().start()
def stop(): tornado.ioloop.IOLoop.instance().stop()
if \_\_name\_\_ == "\_\_main\_\_": run()

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


