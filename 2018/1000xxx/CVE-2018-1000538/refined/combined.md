=== Content from github.com_74e9a77b_20250124_181833.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fpull%2F5957)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fpull%2F5957)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=minio%2Fminio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[minio](/minio)
/
**[minio](/minio/minio)**
Public

* [Notifications](/login?return_to=%2Fminio%2Fminio) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fminio%2Fminio)
* [Star
   49.7k](/login?return_to=%2Fminio%2Fminio)

* [Code](/minio/minio)
* [Issues
  24](/minio/minio/issues)
* [Pull requests
  12](/minio/minio/pulls)
* [Discussions](/minio/minio/discussions)
* [Actions](/minio/minio/actions)
* [Security](/minio/minio/security)
* [Insights](/minio/minio/pulse)

Additional navigation options

* [Code](/minio/minio)
* [Issues](/minio/minio/issues)
* [Pull requests](/minio/minio/pulls)
* [Discussions](/minio/minio/discussions)
* [Actions](/minio/minio/actions)
* [Security](/minio/minio/security)
* [Insights](/minio/minio/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fminio%2Fminio%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fminio%2Fminio%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# security: fix write-to-RAM DoS vulnerability #5957

 Merged

[deekoder](/deekoder)
merged 1 commit into
[minio:master](/minio/minio/tree/master "minio/minio:master")
from
[aead:DoS-v4](/aead/minio/tree/DoS-v4 "aead/minio:DoS-v4")

May 18, 2018

 Merged

# [security: fix write-to-RAM DoS vulnerability](#top) #5957

[deekoder](/deekoder)
merged 1 commit into
[minio:master](/minio/minio/tree/master "minio/minio:master")
from
[aead:DoS-v4](/aead/minio/tree/DoS-v4 "aead/minio:DoS-v4")

May 18, 2018

[Conversation
5](/minio/minio/pull/5957)
[Commits
1](/minio/minio/pull/5957/commits)
[Checks
0](/minio/minio/pull/5957/checks)
[Files changed](/minio/minio/pull/5957/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![aead](https://avatars.githubusercontent.com/u/20368805?s=60&v=4)](/aead)

Copy link

Member

### @aead **[aead](/aead)** commented [May 18, 2018](#issue-324417557)

## Description

This commit fixes a DoS vulnerability for certain APIs using

signature V4 by verifying the content-md5 and/or content-sha56 of

the request body in a streaming mode.

The issue was caused by reading the entire body of the request into

memory to verify the content-md5 or content-sha56 checksum if present.

The vulnerability could be exploited by either replaying a V4 request

(in the 15 min time frame) or sending a V4 presigned request with a

large body.

## Motivation and Context

Security, DoS

## How Has This Been Tested?

manually

## Types of changes

* Bug fix (non-breaking change which fixes an issue)
* New feature (non-breaking change which adds functionality)
* Breaking change (fix or feature that would cause existing functionality to change)

## Checklist:

* My code follows the code style of this project.
* My change requires a change to the documentation.
* I have updated the documentation accordingly.
* I have added unit tests to cover my changes.
* I have added/updated functional tests in [mint](https://github.com/minio/mint). (If yes, add `mint` PR # here: )
* All new and existing tests passed.

Sorry, something went wrong.

All reactions

 [![@aead](https://avatars.githubusercontent.com/u/20368805?s=40&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)
[aead](/aead)
requested review from
[donatello](/donatello) and
[harshavardhana](/harshavardhana)
[May 18, 2018 13:46](#event-1634312201)

[![donatello](https://avatars.githubusercontent.com/u/200059?s=60&v=4)](/donatello)

**[donatello](/donatello)**
approved these changes
[May 18, 2018](#pullrequestreview-121429104)

 [View reviewed changes](/minio/minio/pull/5957/files)

[![@donatello](https://avatars.githubusercontent.com/u/200059?s=80&u=847a2f8b150d3b1fcbc4adb308784ae1cd4a0cd5&v=4)](/donatello)

Copy link

Member

### **[donatello](/donatello)** commented [May 18, 2018](#issuecomment-390216314)

| Fix looks good, though not sure why the build choked. |
| --- |

All reactions

Sorry, something went wrong.

 [![@aead](https://avatars.githubusercontent.com/u/20368805?s=40&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)
[aead](/aead)
[force-pushed](/minio/minio/compare/0041bfc8855a0512dc3f7bba0dd6baffa3092ef6..07f18f1925fc27d05efb74d649561c35f9506330)
the
DoS-v4

branch
from
[`0041bfc`](/minio/minio/commit/0041bfc8855a0512dc3f7bba0dd6baffa3092ef6) to
[`07f18f1`](/minio/minio/commit/07f18f1925fc27d05efb74d649561c35f9506330)  [Compare](/minio/minio/compare/0041bfc8855a0512dc3f7bba0dd6baffa3092ef6..07f18f1925fc27d05efb74d649561c35f9506330)
[May 18, 2018 14:10](#event-1634369834)

[![@aead](https://avatars.githubusercontent.com/u/20368805?s=80&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)

Copy link

Member

Author

### **[aead](/aead)** commented [May 18, 2018](#issuecomment-390219971) • edited Loading

| [@donatello](https://github.com/donatello) "Bug" in `hash.Reader`: Missing  ``` if size >= 0 { 	src = io.LimitReader(src, size) }  ```  We limited the size of the request to 0... Fixed it. |
| --- |

All reactions

Sorry, something went wrong.

 [![@aead](https://avatars.githubusercontent.com/u/20368805?s=40&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)
[aead](/aead)
[force-pushed](/minio/minio/compare/07f18f1925fc27d05efb74d649561c35f9506330..25706a58362741e072a765a6de2228a0fffbf0af)
the
DoS-v4

branch
from
[`07f18f1`](/minio/minio/commit/07f18f1925fc27d05efb74d649561c35f9506330) to
[`25706a5`](/minio/minio/commit/25706a58362741e072a765a6de2228a0fffbf0af)  [Compare](/minio/minio/compare/07f18f1925fc27d05efb74d649561c35f9506330..25706a58362741e072a765a6de2228a0fffbf0af)
[May 18, 2018 14:22](#event-1634398425)

`[security: fix write-to-RAM DoS vulnerability](/minio/minio/pull/5957/commits/b683f00f792362cfa7076cda68c79308445ebb25 "security: fix write-to-RAM DoS vulnerability

This commit fixes a DoS vulnerability for certain APIs using
signature V4 by verifying the content-md5 and/or content-sha56 of
the request body in a streaming mode.

The issue was caused by reading the entire body of the request into
memory to verify the content-md5 or content-sha56 checksum if present.

The vulnerability could be exploited by either replaying a V4 request
(in the 15 min time frame) or sending a V4 presigned request with a
large body.")`
 …

`[b683f00](/minio/minio/pull/5957/commits/b683f00f792362cfa7076cda68c79308445ebb25)`

```
This commit fixes a DoS vulnerability for certain APIs using
signature V4 by verifying the content-md5 and/or content-sha56 of
the request body in a streaming mode.

The issue was caused by reading the entire body of the request into
memory to verify the content-md5 or content-sha56 checksum if present.

The vulnerability could be exploited by either replaying a V4 request
(in the 15 min time frame) or sending a V4 presigned request with a
large body.
```

 [![@aead](https://avatars.githubusercontent.com/u/20368805?s=40&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)
[aead](/aead)
[force-pushed](/minio/minio/compare/25706a58362741e072a765a6de2228a0fffbf0af..b683f00f792362cfa7076cda68c79308445ebb25)
the
DoS-v4

branch
from
[`25706a5`](/minio/minio/commit/25706a58362741e072a765a6de2228a0fffbf0af) to
[`b683f00`](/minio/minio/commit/b683f00f792362cfa7076cda68c79308445ebb25)  [Compare](/minio/minio/compare/25706a58362741e072a765a6de2228a0fffbf0af..b683f00f792362cfa7076cda68c79308445ebb25)
[May 18, 2018 15:38](#event-1634569043)

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [May 18, 2018](#issuecomment-390251027) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=h1) Report Merging [#5957](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=desc) into [master](https://codecov.io/gh/minio/minio/commit/1cf381f1b099376c6e1db9435e1ceee4988814b9?src=pr&el=desc) will **decrease** coverage by `0.01%`. The diff coverage is `60%`.  [Impacted file tree graph](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=tree)  ``` @@            Coverage Diff             @@ ##           master    #5957      +/-   ## ========================================== - Coverage   59.62%   59.61%   -0.02%      ==========================================   Files         214      214                 Lines       30770    30758      -12      ========================================== - Hits        18347    18335      -12      - Misses      10877    10878       +1      + Partials     1546     1545       -1 ```  | [Impacted Files](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=tree) | Coverage Δ |  | | --- | --- | --- | | [pkg/hash/reader.go](https://codecov.io/gh/minio/minio/pull/5957/diff?src=pr&el=tree#diff-cGtnL2hhc2gvcmVhZGVyLmdv) | `100% <100%> (ø)` | ⬆️ | | [cmd/auth-handler.go](https://codecov.io/gh/minio/minio/pull/5957/diff?src=pr&el=tree#diff-Y21kL2F1dGgtaGFuZGxlci5nbw==) | `82.82% <54.54%> (+0.9%)` | ⬆️ | | [cmd/xl-v1-common.go](https://codecov.io/gh/minio/minio/pull/5957/diff?src=pr&el=tree#diff-Y21kL3hsLXYxLWNvbW1vbi5nbw==) | `81.66% <0%> (-3.34%)` | ⬇️ | | [cmd/xl-sets.go](https://codecov.io/gh/minio/minio/pull/5957/diff?src=pr&el=tree#diff-Y21kL3hsLXNldHMuZ28=) | `58.6% <0%> (-0.22%)` | ⬇️ |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=continue).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=footer). Last update [1cf381f...b683f00](https://codecov.io/gh/minio/minio/pull/5957?src=pr&el=lastupdated). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments). |

All reactions

Sorry, something went wrong.

[![harshavardhana](https://avatars.githubusercontent.com/u/622699?s=60&v=4)](/harshavardhana)

**[harshavardhana](/harshavardhana)**
approved these changes
[May 18, 2018](#pullrequestreview-121501503)

 [View reviewed changes](/minio/minio/pull/5957/files/b683f00f792362cfa7076cda68c79308445ebb25)

[![@deekoder](https://avatars.githubusercontent.com/u/1700901?s=40&u=c36a17d28422d58eff56e134555dd6dd17100a1a&v=4)](/deekoder)
[deekoder](/deekoder)
merged commit [`9c8b730`](/minio/minio/commit/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7)
into
minio:master

[May 18, 2018](https://github.com/minio/minio/pull/5957#event-1634887446)

 [![@aead](https://avatars.githubusercontent.com/u/20368805?s=40&u=298b102a2997c1e5b52f7252933aeb89977f0a20&v=4)](/aead)
[aead](/aead)
deleted the
DoS-v4

branch
[June 5, 2018 11:31](#event-1663453662)

[![@Rajik](https://avatars.githubusercontent.com/u/2338077?s=80&u=05014c7f956e456f3d21081f719fdd7360b5e27c&v=4)](/Rajik)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fpull%2F5957)

[![@nitisht](https://avatars.githubusercontent.com/u/5156139?s=80&u=3104e57bb5d9958650747c160a6a515a4a3dcbba&v=4)](/nitisht)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fpull%2F5957)

[![@minio](https://avatars.githubusercontent.com/u/695951?s=40&v=4)](/minio)
[minio](/minio)
locked as **resolved** and limited conversation to collaborators
[Nov 6, 2019](#event-2776238705)

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fpull%2F5957).

Reviewers

[![@harshavardhana](https://avatars.githubusercontent.com/u/622699?s=40&v=4)](/harshavardhana) [harshavardhana](/harshavardhana)

harshavardhana approved these changes

[![@donatello](https://avatars.githubusercontent.com/u/200059?s=40&v=4)](/donatello) [donatello](/donatello)

donatello approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

6 participants

[![@aead](https://avatars.githubusercontent.com/u/20368805?s=52&v=4)](/aead) [![@donatello](https://avatars.githubusercontent.com/u/200059?s=52&v=4)](/donatello) [![@Rajik](https://avatars.githubusercontent.com/u/2338077?s=52&v=4)](/Rajik) [![@nitisht](https://avatars.githubusercontent.com/u/5156139?s=52&v=4)](/nitisht) [![@harshavardhana](https://avatars.githubusercontent.com/u/622699?s=52&v=4)](/harshavardhana) [![@deekoder](https://avatars.githubusercontent.com/u/1700901?s=52&v=4)](/deekoder)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_730e8c12_20250124_181832.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fcommit%2F9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fcommit%2F9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=minio%2Fminio)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[minio](/minio)
/
**[minio](/minio/minio)**
Public

* [Notifications](/login?return_to=%2Fminio%2Fminio) You must be signed in to change notification settings
* [Fork
  5.6k](/login?return_to=%2Fminio%2Fminio)
* [Star
   49.7k](/login?return_to=%2Fminio%2Fminio)

* [Code](/minio/minio)
* [Issues
  24](/minio/minio/issues)
* [Pull requests
  12](/minio/minio/pulls)
* [Discussions](/minio/minio/discussions)
* [Actions](/minio/minio/actions)
* [Security](/minio/minio/security)
* [Insights](/minio/minio/pulse)

Additional navigation options

* [Code](/minio/minio)
* [Issues](/minio/minio/issues)
* [Pull requests](/minio/minio/pulls)
* [Discussions](/minio/minio/discussions)
* [Actions](/minio/minio/actions)
* [Security](/minio/minio/security)
* [Insights](/minio/minio/pulse)

## Commit

[Permalink](/minio/minio/commit/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

security: fix write-to-RAM DoS vulnerability ([#5957](https://github.com/minio/minio/pull/5957))

[Browse files](/minio/minio/tree/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7)
Browse the repository at this point in the history

```
This commit fixes a DoS vulnerability for certain APIs using
signature V4 by verifying the content-md5 and/or content-sha56 of
the request body in a streaming mode.

The issue was caused by reading the entire body of the request into
memory to verify the content-md5 or content-sha56 checksum if present.

The vulnerability could be exploited by either replaying a V4 request
(in the 15 min time frame) or sending a V4 presigned request with a
large body.
```

* Loading branch information

[![@deekoder](https://avatars.githubusercontent.com/u/1700901?s=40&v=4)](/deekoder)

Andreas Auernhammer
authored and
[deekoder](/minio/minio/commits?author=deekoder "View all commits by deekoder")
committed
May 18, 2018

1 parent
[1cf381f](/minio/minio/commit/1cf381f1b099376c6e1db9435e1ceee4988814b9)

commit 9c8b730

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**37 additions**
and
**47 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cmd

  + cmd/auth-handler.go
    [auth-handler.go](#diff-da28a0c0b4e726eabd4cc316dedb9d6e86e2dfff586047857aa43864cdebb0d5)
  + cmd/auth-handler\_test.go
    [auth-handler\_test.go](#diff-3a897701290863001c975e29b66a48c125a696ba299aa9fb4043ae27492dd97c)
* pkg/hash

  + pkg/hash/reader.go
    [reader.go](#diff-98ebed2efd6a8e2220c5ee8440e8841b4a214a2e2f24dd2d6ecbc57adaea32df)

## There are no files selected for viewing

69 changes: 28 additions & 41 deletions

69
[cmd/auth-handler.go](#diff-da28a0c0b4e726eabd4cc316dedb9d6e86e2dfff586047857aa43864cdebb0d5 "cmd/auth-handler.go")

Show comments

[View file](/minio/minio/blob/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7/cmd/auth-handler.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -28,6 +28,7 @@ import ( |
|  |  | "strings" |
|  |  |  |
|  |  | "github.com/minio/minio/cmd/logger" |
|  |  | "github.com/minio/minio/pkg/hash" |
|  |  | "github.com/minio/minio/pkg/policy" |
|  |  | ) |
|  |  |  |
| Expand Down  Expand Up | | @@ -209,59 +210,45 @@ func reqSignatureV4Verify(r \*http.Request, region string) (s3Error APIErrorCode) |
|  |  |  |
|  |  | // Verify if request has valid AWS Signature Version '4'. |
|  |  | func isReqAuthenticated(r \*http.Request, region string) (s3Error APIErrorCode) { |
|  |  | if r == nil { |
|  |  | return ErrInternalError |
|  |  | } |
|  |  |  |
|  |  | if errCode := reqSignatureV4Verify(r, region); errCode != ErrNone { |
|  |  | return errCode |
|  |  | } |
|  |  |  |
|  |  | payload, err := ioutil.ReadAll(r.Body) |
|  |  | if err != nil { |
|  |  | logger.LogIf(context.Background(), err) |
|  |  | return ErrInternalError |
|  |  | } |
|  |  |  |
|  |  | // Populate back the payload. |
|  |  | r.Body = ioutil.NopCloser(bytes.NewReader(payload)) |
|  |  |  |
|  |  | // Verify Content-Md5, if payload is set. |
|  |  | if clntMD5B64, ok := r.Header["Content-Md5"]; ok { |
|  |  | if clntMD5B64[0] == "" { |
|  |  | var ( |
|  |  | err error |
|  |  | contentMD5, contentSHA256 []byte |
|  |  | ) |
|  |  | // Extract 'Content-Md5' if present. |
|  |  | if \_, ok := r.Header["Content-Md5"]; ok { |
|  |  | contentMD5, err = base64.StdEncoding.Strict().DecodeString(r.Header.Get("Content-Md5")) |
|  |  | if err != nil || len(contentMD5) == 0 { |
|  |  | return ErrInvalidDigest |
|  |  | } |
|  |  | md5Sum, err := base64.StdEncoding.Strict().DecodeString(clntMD5B64[0]) |
|  |  | if err != nil { |
|  |  | return ErrInvalidDigest |
|  |  | } |
|  |  | if !bytes.Equal(md5Sum, getMD5Sum(payload)) { |
|  |  | return ErrBadDigest |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if skipContentSha256Cksum(r) { |
|  |  | return ErrNone |
|  |  | } |
|  |  |  |
|  |  | // Verify that X-Amz-Content-Sha256 Header == sha256(payload) |
|  |  | // If X-Amz-Content-Sha256 header is not sent then we don't calculate/verify sha256(payload) |
|  |  | sumHex, ok := r.Header["X-Amz-Content-Sha256"] |
|  |  | if isRequestPresignedSignatureV4(r) { |
|  |  | sumHex, ok = r.URL.Query()["X-Amz-Content-Sha256"] |
|  |  | } |
|  |  | if ok { |
|  |  | if sumHex[0] == "" { |
|  |  | return ErrContentSHA256Mismatch |
|  |  | } |
|  |  | sum, err := hex.DecodeString(sumHex[0]) |
|  |  | if err != nil { |
|  |  | return ErrContentSHA256Mismatch |
|  |  | // Extract either 'X-Amz-Content-Sha256' header or 'X-Amz-Content-Sha256' query parameter (if V4 presigned) |
|  |  | // Do not verify 'X-Amz-Content-Sha256' if skipSHA256. |
|  |  | if skipSHA256 := skipContentSha256Cksum(r); !skipSHA256 && isRequestPresignedSignatureV4(r) { |
|  |  | if sha256Sum, ok := r.URL.Query()["X-Amz-Content-Sha256"]; ok && len(sha256Sum) > 0 { |
|  |  | contentSHA256, err = hex.DecodeString(sha256Sum[0]) |
|  |  | if err != nil { |
|  |  | return ErrContentSHA256Mismatch |
|  |  | } |
|  |  | } |
|  |  | if !bytes.Equal(sum, getSHA256Sum(payload)) { |
|  |  | } else if \_, ok := r.Header["X-Amz-Content-Sha256"]; !skipSHA256 && ok { |
|  |  | contentSHA256, err = hex.DecodeString(r.Header.Get("X-Amz-Content-Sha256")) |
|  |  | if err != nil || len(contentSHA256) == 0 { |
|  |  | return ErrContentSHA256Mismatch |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | // Verify 'Content-Md5' and/or 'X-Amz-Content-Sha256' if present. |
|  |  | // The verification happens implicit during reading. |
|  |  | reader, err := hash.NewReader(r.Body, -1, hex.EncodeToString(contentMD5), hex.EncodeToString(contentSHA256)) |
|  |  | if err != nil { |
|  |  | return toAPIErrorCode(err) |
|  |  | } |
|  |  | r.Body = ioutil.NopCloser(reader) |
|  |  | return ErrNone |
|  |  | } |
|  |  |  |
| Expand Down | |  |

9 changes: 5 additions & 4 deletions

9
[cmd/auth-handler\_test.go](#diff-3a897701290863001c975e29b66a48c125a696ba299aa9fb4043ae27492dd97c "cmd/auth-handler_test.go")

Show comments

[View file](/minio/minio/blob/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7/cmd/auth-handler_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,6 +19,7 @@ package cmd |
|  |  | import ( |
|  |  | "bytes" |
|  |  | "io" |
|  |  | "io/ioutil" |
|  |  | "net/http" |
|  |  | "net/url" |
|  |  | "os" |
| Expand Down  Expand Up | | @@ -361,8 +362,6 @@ func TestIsReqAuthenticated(t \*testing.T) { |
|  |  | req \*http.Request |
|  |  | s3Error APIErrorCode |
|  |  | }{ |
|  |  | // When request is nil, internal error is returned. |
|  |  | {nil, ErrInternalError}, |
|  |  | // When request is unsigned, access denied is returned. |
|  |  | {mustNewRequest("GET", "http://127.0.0.1:9000", 0, nil, t), ErrAccessDenied}, |
|  |  | // Empty Content-Md5 header. |
| Expand All | | @@ -376,9 +375,11 @@ func TestIsReqAuthenticated(t \*testing.T) { |
|  |  | } |
|  |  |  |
|  |  | // Validates all testcases. |
|  |  | for \_, testCase := range testCases { |
|  |  | for i, testCase := range testCases { |
|  |  | if s3Error := isReqAuthenticated(testCase.req, globalServerConfig.GetRegion()); s3Error != testCase.s3Error { |
|  |  | t.Fatalf("Unexpected s3error returned wanted %d, got %d", testCase.s3Error, s3Error) |
|  |  | if \_, err := ioutil.ReadAll(testCase.req.Body); toAPIErrorCode(err) != testCase.s3Error { |
|  |  | t.Fatalf("Test %d: Unexpected S3 error: want %d - got %d (got after reading request %d)", i, testCase.s3Error, s3Error, toAPIErrorCode(err)) |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[pkg/hash/reader.go](#diff-98ebed2efd6a8e2220c5ee8440e8841b4a214a2e2f24dd2d6ecbc57adaea32df "pkg/hash/reader.go")

Show comments

[View file](/minio/minio/blob/9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7/pkg/hash/reader.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -61,11 +61,13 @@ func NewReader(src io.Reader, size int64, md5Hex, sha256Hex string) (\*Reader, er |
|  |  | if len(sha256sum) != 0 { |
|  |  | sha256Hash = sha256.New() |
|  |  | } |
|  |  |  |
|  |  | if size >= 0 { |
|  |  | src = io.LimitReader(src, size) |
|  |  | } |
|  |  | return &Reader{ |
|  |  | md5sum: md5sum, |
|  |  | sha256sum: sha256sum, |
|  |  | src: io.LimitReader(src, size), |
|  |  | src: src, |
|  |  | size: size, |
|  |  | md5Hash: md5.New(), |
|  |  | sha256Hash: sha256Hash, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9c8b730`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fminio%2Fminio%2Fcommit%2F9c8b7306f55f2c8c0a5c7cea9a8db9d34be8faa7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


