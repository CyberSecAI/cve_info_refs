- **Root cause of vulnerability:** The `TableOfContentsFilter` in `banzai/filter/table_of_contents_filter.rb` does not properly escape the text content of header nodes when generating the table of contents. Specifically, the `.text` method on a header node was not escaping HTML entities before inserting them into the generated HTML for the TOC, leading to the execution of injected HTML and JavaScript.
- **Weaknesses/vulnerabilities present:** Stored Cross-Site Scripting (XSS) vulnerability. The lack of proper output encoding on user-supplied content within the table of contents generation process allowed injection of arbitrary HTML and JavaScript.
- **Impact of exploitation:** An attacker could inject malicious JavaScript that would execute when a user views a page where the table of contents is generated. This could lead to account compromise, data theft, or other malicious actions.
- **Attack vectors:** An attacker can create a wiki page containing a specially crafted header with HTML entities (e.g., `&lt;img src=x onerror=alert(document.domain)&gt;`) and activate the TOC feature `[[_TOC_]]` on the page. When the page with the TOC is viewed, the unescaped HTML in the header is rendered, and the injected javascript is executed.
- **Required attacker capabilities/position:** The attacker needs to be able to create or edit wiki pages in GitLab.