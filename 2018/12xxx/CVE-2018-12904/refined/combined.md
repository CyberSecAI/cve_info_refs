=== Content from usn.ubuntu.com_6b3de2d2_20250124_144912.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3752-1: Linux kernel vulnerabilities

24 August 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2

## Details

It was discovered that, when attempting to handle an out-of-memory

situation, a null pointer dereference could be triggered in the Linux

kernel in some circumstances. A local attacker could use this to cause a

denial of service (system crash). ([CVE-2018-1000200](/security/CVE-2018-1000200))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate meta-data information. An attacker could

use this to construct a malicious xfs image that, when mounted, could cause

a denial of service (system crash). ([CVE-2018-10323](/security/CVE-2018-10323))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate xattr information. An attacker could use

this to construct a malicious xfs image that, when mounted, could cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-10840](/security/CVE-2018-10840))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep meta-data information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash).

([CVE-2018-10881](/security/CVE-2018-10881))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly handle corrupted meta data in some situations. An

attacker could use this to specially craft an ext4 filesystem that caused a

denial of service (system crash) when mounted. ([CVE-2018-1093](/security/CVE-2018-1093))

Jann Horn discovered that the Linux kernel's implementation of random seed

data reported that it was in a ready state before it had gathered

sufficient entropy. An attacker could use this to expose sensitive

information. ([CVE-2018-1108](/security/CVE-2018-1108))

It was discovered that the procfs filesystem did not properly handle

processes mapping some memory elements onto files. A local attacker could

use this to block utilities that examine the procfs filesystem to report

operating system state, such as ps(1). ([CVE-2018-1120](/security/CVE-2018-1120))

Jann Horn discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep xattr information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11412](/security/CVE-2018-11412))

Piotr Gabriel Kosinski and Daniel Shapira discovered a stack-based buffer

overflow in the CDROM driver implementation of the Linux kernel. A local

attacker could use this to cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11506](/security/CVE-2018-11506))

Shankara Pailoor discovered that a race condition existed in the socket

handling code in the Linux kernel. A local attacker could use this to cause

a denial of service (system crash). ([CVE-2018-12232](/security/CVE-2018-12232))

Shankara Pailoor discovered that the JFS filesystem implementation in the

Linux kernel contained a buffer overflow when handling extended attributes.

A local attacker could use this to cause a denial of service (system crash)

or possibly execute arbitrary code. ([CVE-2018-12233](/security/CVE-2018-12233))

Felix Wilhelm discovered that the KVM implementation in the Linux kernel

did not properly perform permission checks in some situations when nested

virtualization is used. An attacker in a guest VM could possibly use this

to escape into an outer VM or the host OS. ([CVE-2018-12904](/security/CVE-2018-12904))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly handle an error condition with a corrupted xfs

image. An attacker could use this to construct a malicious xfs image that,

when mounted, could cause a denial of service (system crash).

([CVE-2018-13094](/security/CVE-2018-13094))

It was discovered that the Linux kernel did not properly handle setgid file

creation when performed by a non-member of the group. A local attacker

could use this to gain elevated privileges. ([CVE-2018-13405](/security/CVE-2018-13405))

Silvio Cesare discovered that the generic VESA frame buffer driver in the

Linux kernel contained an integer overflow. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-13406](/security/CVE-2018-13406))

Jakub Jirasek discovered that multiple use-after-free errors existed in the

USB/IP implementation in the Linux kernel. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-5814](/security/CVE-2018-5814))

It was discovered that a race condition existed in the ARM Advanced

Microcontroller Bus Architecture (AMBA) driver in the Linux kernel that

could result in a double free. A local attacker could use this to cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-9415](/security/CVE-2018-9415))

It was discovered that an information leak existed in the generic SCSI

driver in the Linux kernel. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-1000204](/security/CVE-2018-1000204))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-4.15.0-1020-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.15.0-1020.20](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.15.0-1020.20)
* [linux-image-4.15.0-1020-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.15.0-1020.20](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.15.0-1020.20)
* [linux-image-4.15.0-1021-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.15.0-1021.23](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.15.0-1021.23)
* [linux-image-4.15.0-33-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-33.36](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-33.36)
* [linux-image-4.15.0-33-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-33.36](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-33.36)
* [linux-image-4.15.0-33-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-33.36](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-33.36)
* [linux-image-4.15.0-33-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-33.36](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-33.36)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1000200](/security/CVE-2018-1000200)
* [CVE-2018-1000204](/security/CVE-2018-1000204)
* [CVE-2018-10323](/security/CVE-2018-10323)
* [CVE-2018-10840](/security/CVE-2018-10840)
* [CVE-2018-10881](/security/CVE-2018-10881)
* [CVE-2018-1093](/security/CVE-2018-1093)
* [CVE-2018-1108](/security/CVE-2018-1108)
* [CVE-2018-1120](/security/CVE-2018-1120)
* [CVE-2018-11412](/security/CVE-2018-11412)
* [CVE-2018-11506](/security/CVE-2018-11506)
* [CVE-2018-12232](/security/CVE-2018-12232)
* [CVE-2018-12233](/security/CVE-2018-12233)
* [CVE-2018-12904](/security/CVE-2018-12904)
* [CVE-2018-13094](/security/CVE-2018-13094)
* [CVE-2018-13405](/security/CVE-2018-13405)
* [CVE-2018-13406](/security/CVE-2018-13406)
* [CVE-2018-5814](/security/CVE-2018-5814)
* [CVE-2018-9415](/security/CVE-2018-9415)

## Related notices

* [USN-3752-2](/security/notices/USN-3752-2)
* [USN-3752-3](/security/notices/USN-3752-3)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)
* [USN-3754-1](/security/notices/USN-3754-1)
* [USN-4486-1](/security/notices/USN-4486-1)
* [USN-3753-1](/security/notices/USN-3753-1)
* [USN-3753-2](/security/notices/USN-3753-2)
* [USN-3676-1](/security/notices/USN-3676-1)
* [USN-3676-2](/security/notices/USN-3676-2)
* [USN-3910-2](/security/notices/USN-3910-2)
* [USN-3910-1](/security/notices/USN-3910-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from cdn.kernel.org_306e2022_20250124_144910.html ===
commit 3816828a8cd06c5e0a0a9e0456013d61d979d975
Author: Greg Kroah-Hartman
Date: Sat Jun 16 09:18:24 2018 +0200
Linux 4.17.2
commit e1b1c10701331265c684ba52ea25e382b66e0d2f
Author: Bin Liu
Date: Tue Apr 17 14:53:13 2018 -0500
crypto: omap-sham - fix memleak
commit 9dbc8a0328efa485a6f5b68b867f9f523a3fbeff upstream.
Fixes: 8043bb1ae03cb ("crypto: omap-sham - convert driver logic to use sgs for data xmit")
The memory pages freed in omap\_sham\_finish\_req() were less than those
allocated in omap\_sham\_copy\_sgs().
Cc: stable@vger.kernel.org
Signed-off-by: Bin Liu
Acked-by: Tero Kristo
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 0603cc8258fe6baea7af253281ef736f019dc6ea
Author: Michael Ellerman
Date: Thu May 3 22:29:30 2018 +1000
crypto: vmx - Remove overly verbose printk from AES XTS init
commit 730f23b66095a700e2f0786abda6bca011b31558 upstream.
In p8\_aes\_xts\_init() we do a printk(KERN\_INFO ...) to report the
fallback implementation we're using. However with a slow console this
can significantly affect the speed of crypto operations. So remove it.
Fixes: c07f5d3da643 ("crypto: vmx - Adding support for XTS")
Cc: stable@vger.kernel.org # v4.8+
Signed-off-by: Michael Ellerman
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit e120cbbb53d590dfa5fd4020849dcfeea8b6bc82
Author: Michael Ellerman
Date: Thu May 3 22:29:29 2018 +1000
crypto: vmx - Remove overly verbose printk from AES init routines
commit 1411b5218adbcf1d45ddb260db5553c52e8d917c upstream.
In the vmx AES init routines we do a printk(KERN\_INFO ...) to report
the fallback implementation we're using.
However with a slow console this can significantly affect the speed of
crypto operations. Using 'cryptsetup benchmark' the removal of the
printk() leads to a ~5x speedup for aes-cbc decryption.
So remove them.
Fixes: 8676590a1593 ("crypto: vmx - Adding AES routines for VMX module")
Fixes: 8c755ace357c ("crypto: vmx - Adding CBC routines for VMX module")
Fixes: 4f7f60d312b3 ("crypto: vmx - Adding CTR routines for VMX module")
Fixes: cc333cd68dfa ("crypto: vmx - Adding GHASH routines for VMX module")
Cc: stable@vger.kernel.org # v4.1+
Signed-off-by: Michael Ellerman
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 11a145ea468da35b82112aff5351fca7bf6d4ca7
Author: Jan Glauber
Date: Mon Apr 9 17:45:51 2018 +0200
crypto: cavium - Limit result reading attempts
commit c782a8c43e94ba6c09e9de2d69b5e3a5840ce61c upstream.
After issuing a request an endless loop was used to read the
completion state from memory which is asynchronously updated
by the ZIP coprocessor.
Add an upper bound to the retry attempts to prevent a CPU getting stuck
forever in case of an error. Additionally, add a read memory barrier
and a small delay between the reading attempts.
Signed-off-by: Jan Glauber
Reviewed-by: Robert Richter
Cc: stable  # 4.14
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 3d3a603f096bfed660f395352733950ba92c4b5f
Author: Jan Glauber
Date: Mon Apr 9 17:45:50 2018 +0200
crypto: cavium - Fix fallout from CONFIG\_VMAP\_STACK
commit 37ff02acaa3d7be87ecb89f198a549ffd3ae2403 upstream.
Enabling virtual mapped kernel stacks breaks the thunderx\_zip
driver. On compression or decompression the executing CPU hangs
in an endless loop. The reason for this is the usage of \_\_pa
by the driver which does no longer work for an address that is
not part of the 1:1 mapping.
The zip driver allocates a result struct on the stack and needs
to tell the hardware the physical address within this struct
that is used to signal the completion of the request.
As the hardware gets the wrong address after the broken \_\_pa
conversion it writes to an arbitrary address. The zip driver then
waits forever for the completion byte to contain a non-zero value.
Allocating the result struct from 1:1 mapped memory resolves this
bug.
Signed-off-by: Jan Glauber
Reviewed-by: Robert Richter
Cc: stable  # 4.14
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit df54a248ba581d8950b26099ec2b153f232d2cee
Author: Horia Geantă
Date: Fri Apr 27 11:40:11 2018 +0300
crypto: caam - fix size of RSA prime factor q
commit 4bffaab373d9afaf862f3924442c33340bd26736 upstream.
Fix a typo where size of RSA prime factor q is using the size of
prime factor p.
Cc:  # 4.13+
Fixes: 52e26d77b8b3 ("crypto: caam - add support for RSA key form 2")
Fixes: 4a651b122adb ("crypto: caam - add support for RSA key form 3")
Reported-by: David Binderman
Signed-off-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 8f643590afb7fd3d36d049af6aa38d71bd14bb93
Author: Horia Geantă
Date: Wed Mar 28 15:39:19 2018 +0300
crypto: caam/qi - fix IV DMA mapping and updating
commit 3a488aaec6f343b5dc6d94529847a840bbeaf009 upstream.
There are two IV-related issues:
(1) crypto API does not guarantee to provide an IV buffer that is DMAable,
thus it's incorrect to DMA map it
(2) for in-place decryption, since ciphertext is overwritten with
plaintext, updated IV (req->info) will contain the last block of plaintext
(instead of the last block of ciphertext)
While these two issues could be fixed separately, it's straightforward
to fix both in the same time - by using the {ablkcipher,aead}\_edesc
extended descriptor to store the IV that will be fed to the crypto engine;
this allows for fixing (2) by saving req->src[last\_block] in req->info
directly, i.e. without allocating yet another temporary buffer.
A side effect of the fix is that it's no longer possible to have the IV
contiguous with req->src or req->dst.
Code checking for this case is removed.
Cc:  # 4.14+
Fixes: a68a19380522 ("crypto: caam/qi - properly set IV after {en,de}crypt")
Link: http://lkml.kernel.org/r/20170113084620.GF22022@gondor.apana.org.au
Reported-by: Gilad Ben-Yossef
Signed-off-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 9136b00c6f5d37c7878b05035a89f3d0dec0d9d0
Author: Horia Geantă
Date: Wed Mar 28 15:39:18 2018 +0300
crypto: caam - fix IV DMA mapping and updating
commit 115957bb3e59fcb226ce76b97af14533f239e0ac upstream.
There are two IV-related issues:
(1) crypto API does not guarantee to provide an IV buffer that is DMAable,
thus it's incorrect to DMA map it
(2) for in-place decryption, since ciphertext is overwritten with
plaintext, updated req->info will contain the last block of plaintext
(instead of the last block of ciphertext)
While these two issues could be fixed separately, it's straightforward
to fix both in the same time - by allocating extra space in the
ablkcipher\_edesc for the IV that will be fed to the crypto engine;
this allows for fixing (2) by saving req->src[last\_block] in req->info
directly, i.e. without allocating another temporary buffer.
A side effect of the fix is that it's no longer possible to have the IV
and req->src contiguous. Code checking for this case is removed.
Cc:  # 4.13+
Fixes: 854b06f76879 ("crypto: caam - properly set IV after {en,de}crypt")
Link: http://lkml.kernel.org/r/20170113084620.GF22022@gondor.apana.org.au
Reported-by: Gilad Ben-Yossef
Signed-off-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 4f2fa31f93c7c58a7598644d402773503b31ec3b
Author: Horia Geantă
Date: Wed Mar 28 15:39:17 2018 +0300
crypto: caam - fix DMA mapping dir for generated IV
commit a38acd236cac914aafffd80af79b9556fc2c3934 upstream.
In case of GIVCIPHER, IV is generated by the device.
Fix the DMA mapping direction.
Cc:  # 3.19+
Fixes: 7222d1a34103 ("crypto: caam - add support for givencrypt cbc(aes) and rfc3686(ctr(aes))")
Signed-off-by: Horia Geantă
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 2f8b123b08e05f534b29441ca785b1989687f97b
Author: Horia Geantă
Date: Mon Apr 16 08:07:05 2018 -0500
crypto: caam - strip input zeros from RSA input buffer
commit 8a2a0dd35f2e54c023d9041a5428b6c5639af86c upstream.
Sometimes the provided RSA input buffer provided is not stripped
of leading zeros. This could cause its size to be bigger than that
of the modulus, making the HW complain:
caam\_jr 2142000.jr1: 40000789: DECO: desc idx 7:
Protocol Size Error - A protocol has seen an error in size. When
running RSA, pdb size N < (size of F) when no formatting is used; or
pdb size N < (F + 11) when formatting is used.
Fix the problem by stripping off the leading zero from input data
before feeding it to the CAAM accelerator.
Fixes: 8c419778ab57e ("crypto: caam - add support for RSA algorithm")
Cc:  # 4.8+
Reported-by: Martin Townsend
Link: https://lkml.kernel.org/r/CABatt\_ytYORYKtApcB4izhNanEKkGFi9XAQMjHi\_n-8YWoCRiw@mail.gmail.com
Signed-off-by: Horia Geantă
Tested-by: Fabio Estevam
Reviewed-by: Tudor Ambarus
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit 696fd0791060be5c67b6688329ea731860e7c876
Author: Johannes Wienke
Date: Mon Jun 4 13:37:26 2018 -0700
Input: elan\_i2c - add ELAN0612 (Lenovo v330 14IKB) ACPI ID
commit e6e7e9cd8eed0e18217c899843bffbe8c7dae564 upstream.
Add ELAN0612 to the list of supported touchpads; this ID is used in Lenovo
v330 14IKB devices.
Bugzilla: https://bugzilla.kernel.org/show\_bug.cgi?id=199253
Signed-off-by: Johannes Wienke
Cc: stable@vger.kernel.org
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit d36966739b8f7802e830f22483e186aff677d34c
Author: Ethan Lee
Date: Thu May 31 16:13:17 2018 -0700
Input: goodix - add new ACPI id for GPD Win 2 touch screen
commit 5ca4d1ae9bad0f59bd6f851c39b19f5366953666 upstream.
GPD Win 2 Website: http://www.gpd.hk/gpdwin2.asp
Tested on a unit from the first production run sent to Indiegogo backers
Signed-off-by: Ethan Lee
Cc: stable@vger.kernel.org
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit 3f0a1a04339bdd3ede1c5b787d7da7ea1e853f4a
Author: Gilad Ben-Yossef
Date: Thu May 24 15:19:06 2018 +0100
crypto: ccree - correct host regs offset
commit 281a58c8326ca62ca6341f9d2cc2eb08044670e8 upstream.
The product signature and HW revision register have different offset on the
older HW revisions.
This fixes the problem of the driver failing sanity check on silicon
despite working on the FPGA emulation systems.
Fixes: 27b3b22dd98c ("crypto: ccree - add support for older HW revs")
Cc: stable@vger.kernel.org
Signed-off-by: Gilad Ben-Yossef
Reviewed-by: Simon Horman
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman
commit f4764b7b1e989090a1ff54b6eecad72205d1570f
Author: Dave Martin
Date: Thu May 10 18:08:23 2018 +0100
tty: pl011: Avoid spuriously stuck-off interrupts
commit 4a7e625ce50412a7711efa0f2ef0b96ce3826759 upstream.
Commit 9b96fbacda34 ("serial: PL011: clear pending interrupts")
clears the RX and receive timeout interrupts on pl011 startup, to
avoid a screaming-interrupt scenario that can occur when the
firmware or bootloader leaves these interrupts asserted.
This has been noted as an issue when running Linux on qemu [1].
Unfortunately, the above fix seems to lead to potential
misbehaviour if the RX FIFO interrupt is asserted \_non\_ spuriously
on driver startup, if the RX FIFO is also already full to the
trigger level.
Clearing the RX FIFO interrupt does not change the FIFO fill level.
In this scenario, because the interrupt is now clear and because
the FIFO is already full to the trigger level, no new assertion of
the RX FIFO interrupt can occur unless the FIFO is drained back
below the trigger level. This never occurs because the pl011
driver is waiting for an RX FIFO interrupt to tell it that there is
something to read, and does not read the FIFO at all until that
interrupt occurs.
Thus, simply clearing "spurious" interrupts on startup may be
misguided, since there is no way to be sure that the interrupts are
truly spurious, and things can go wrong if they are not.
This patch instead clears the interrupt condition by draining the
RX FIFO during UART startup, after clearing any potentially
spurious interrupt. This should ensure that an interrupt will
definitely be asserted if the RX FIFO subsequently becomes
sufficiently full.
The drain is done at the point of enabling interrupts only. This
means that it will occur any time the UART is newly opened through
the tty layer. It will not apply to polled-mode use of the UART by
kgdboc: since that scenario cannot use interrupts by design, this
should not matter. kgdboc will interact badly with "normal" use of
the UART in any case: this patch makes no attempt to paper over
such issues.
This patch does not attempt to address the case where the RX FIFO
fills faster than it can be drained: that is a pathological
hardware design problem that is beyond the scope of the driver to
work around. As a failsafe, the number of poll iterations for
draining the FIFO is limited to twice the FIFO size. This will
ensure that the kernel at least boots even if it is impossible to
drain the FIFO for some reason.
[1] [Qemu-devel] [Qemu-arm] [PATCH] pl011: do not put into fifo
before enabled the interruption
https://lists.gnu.org/archive/html/qemu-devel/2018-01/msg06446.html
Reported-by: Wei Xu
Cc: Russell King
Cc: Linus Walleij
Cc: Peter Maydell
Fixes: 9b96fbacda34 ("serial: PL011: clear pending interrupts")
Signed-off-by: Dave Martin
Cc: stable
Tested-by: Wei Xu
Signed-off-by: Greg Kroah-Hartman
commit 6597f6f504f517a621107d9ebc268b4fabeb477f
Author: Sean Wang
Date: Fri Apr 20 16:58:05 2018 +0800
arm64: defconfig: Enable CONFIG\_PINCTRL\_MT7622 by default
commit 1e31927aa64545ee97a2a41db9984c9931afc50a upstream.
Recently kernelCI reported the board mt7622-rfb1 has a fail test with
kernel: ERROR: did not start booting whose details could be seen at [1].
The cause is that UART0 can't output anything when it's missing a proper
pin setup with current DTS, so the essential driver is always getting
enabled to fix up the issue.
[1] https://kernelci.org/boot/id/5ad7d62759b51461bfb1f829/
Cc: Kevin Hilman
Cc: stable@vger.kernel.org
Fixes: ae457b7679c4 ("arm64: dts: mt7622: add SoC and peripheral related device nodes")
Signed-off-by: Sean Wang
Signed-off-by: Matthias Brugger
Signed-off-by: Greg Kroah-Hartman
commit 4cd9a5cf2377544a0ef15399dec6bb522358f19e
Author: Stephen Hemminger
Date: Sat May 12 01:45:29 2018 -0700
doc: fix sysfs ABI documentation
commit f59acbc5e0f7f90452efd4c3318d5e5ec042c3e0 upstream.
In 4.9 kernel, the sysfs files for Hyper-V VMBus changed name but
the documentation files were not updated. The current sysfs file
names are /sys/bus/vmbus/devices//...
See commit 9a56e5d6a0ba ("Drivers: hv: make VMBus bus ids persistent")
and commit f6b2db084b65 ("vmbus: make sysfs names consistent with PCI")
Reported-by: Michael Kelley
Signed-off-by: Stephen Hemminger
Cc: stable@vger.kernel.org
Signed-off-by: K. Y. Srinivasan
Signed-off-by: Greg Kroah-Hartman
Signed-off-by: Greg Kroah-Hartman
commit 6858372bcc035462e2658a0092cce396ae83ae90
Author: Gil Kupfer
Date: Fri Jun 1 00:47:47 2018 -0700
vmw\_balloon: fixing double free when batching mode is off
commit b23220fe054e92f616b82450fae8cd3ab176cc60 upstream.
The balloon.page field is used for two different purposes if batching is
on or off. If batching is on, the field point to the page which is used
to communicate with with the hypervisor. If it is off, balloon.page
points to the page that is about to be (un)locked.
Unfortunately, this dual-purpose of the field introduced a bug: when the
balloon is popped (e.g., when the machine is reset or the balloon driver
is explicitly removed), the balloon driver frees, unconditionally, the
page that is held in balloon.page. As a result, if batching is
disabled, this leads to double freeing the last page that is sent to the
hypervisor.
The following error occurs during rmmod when kernel checkers are on, and
the balloon is not empty:
[ 42.307653] ------------[ cut here ]------------
[ 42.307657] Kernel BUG at ffffffffba1e4b28 [verbose debug info unavailable]
[ 42.307720] invalid opcode: 0000 [#1] SMP DEBUG\_PAGEALLOC
[ 42.312512] Modules linked in: vmw\_vsock\_vmci\_transport vsock ppdev joydev vmw\_balloon(-) input\_leds serio\_raw vmw\_vmci parport\_pc shpchp parport i2c\_piix4 nfit mac\_hid autofs4 vmwgfx drm\_kms\_helper hid\_generic syscopyarea sysfillrect usbhid sysimgblt fb\_sys\_fops hid ttm mptspi scsi\_transport\_spi ahci mptscsih drm psmouse vmxnet3 libahci mptbase pata\_acpi
[ 42.312766] CPU: 10 PID: 1527 Comm: rmmod Not tainted 4.12.0+ #5
[ 42.312803] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 09/30/2016
[ 42.313042] task: ffff9bf9680f8000 task.stack: ffffbfefc1638000
[ 42.313290] RIP: 0010:\_\_free\_pages+0x38/0x40
[ 42.313510] RSP: 0018:ffffbfefc163be98 EFLAGS: 00010246
[ 42.313731] RAX: 000000000000003e RBX: ffffffffc02b9720 RCX: 0000000000000006
[ 42.313972] RDX: 0000000000000000 RSI: 0000000000000000 RDI: ffff9bf97e08e0a0
[ 42.314201] RBP: ffffbfefc163be98 R08: 0000000000000000 R09: 0000000000000000
[ 42.314435] R10: 0000000000000000 R11: 0000000000000000 R12: ffffffffc02b97e4
[ 42.314505] R13: ffffffffc02b9748 R14: ffffffffc02b9728 R15: 0000000000000200
[ 42.314550] FS: 00007f3af5fec700(0000) GS:ffff9bf97e080000(0000) knlGS:0000000000000000
[ 42.314599] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 42.314635] CR2: 00007f44f6f4ab24 CR3: 00000003a7d12000 CR4: 00000000000006e0
[ 42.314864] Call Trace:
[ 42.315774] vmballoon\_pop+0x102/0x130 [vmw\_balloon]
[ 42.315816] vmballoon\_exit+0x42/0xd64 [vmw\_balloon]
[ 42.315853] SyS\_delete\_module+0x1e2/0x250
[ 42.315891] entry\_SYSCALL\_64\_fastpath+0x23/0xc2
[ 42.315924] RIP: 0033:0x7f3af5b0e8e7
[ 42.315949] RSP: 002b:00007fffe6ce0148 EFLAGS: 00000206 ORIG\_RAX: 00000000000000b0
[ 42.315996] RAX: ffffffffffffffda RBX: 000055be676401e0 RCX: 00007f3af5b0e8e7
[ 42.316951] RDX: 000000000000000a RSI: 0000000000000800 RDI: 000055be67640248
[ 42.317887] RBP: 0000000000000003 R08: 0000000000000000 R09: 1999999999999999
[ 42.318845] R10: 0000000000000883 R11: 0000000000000206 R12: 00007fffe6cdf130
[ 42.319755] R13: 0000000000000000 R14: 0000000000000000 R15: 000055be676401e0
[ 42.320606] Code: c0 74 1c f0 ff 4f 1c 74 02 5d c3 85 f6 74 07 e8 0f d8 ff ff 5d c3 31 f6 e8 c6 fb ff ff 5d c3 48 c7 c6 c8 0f c5 ba e8 58 be 02 00 <0f> 0b 66 0f 1f 44 00 00 66 66 66 66 90 48 85 ff 75 01 c3 55 48
[ 42.323462] RIP: \_\_free\_pages+0x38/0x40 RSP: ffffbfefc163be98
[ 42.325735] ---[ end trace 872e008e33f81508 ]---
To solve the bug, we eliminate the dual purpose of balloon.page.
Fixes: f220a80f0c2e ("VMware balloon: add batching to the vmw\_balloon.")
Cc: stable@vger.kernel.org
Reported-by: Oleksandr Natalenko
Signed-off-by: Gil Kupfer
Signed-off-by: Nadav Amit
Reviewed-by: Xavier Deguillard
Tested-by: Oleksandr Natalenko
Signed-off-by: Greg Kroah-Hartman
commit 592141182e63a1bc901024404581d3d00d1f09bb
Author: Tony Lindgren
Date: Fri May 4 10:44:09 2018 -0700
serial: 8250: omap: Fix idling of clocks for unused uarts
commit 13dc04d0e5fdc25c8f713ad23fdce51cf2bf96ba upstream.
I noticed that unused UARTs won't necessarily idle properly always
unless at least one byte tx transfer is done first.
After some debugging I narrowed down the problem to the scr register
dma configuration bits that need to be set before softreset for the
clocks to idle. Unless we do this, the module clkctrl idlest bits
may be set to 1 instead of 3 meaning the clock will never idle and
is blocking deeper idle states for the whole domain.
This might be related to the configuration done by the bootloader
or kexec booting where certain configurations cause the 8250 or
the clkctrl clock to jam in a way where setting of the scr bits
and reset is needed to clear it. I've tried diffing the 8250
registers for the various modes, but did not see anything specific.
So far I've only seen this on omap4 but I'm suspecting this might
also happen on the other clkctrl using SoCs considering they
already have a quirk enabled for UART\_ERRATA\_CLOCK\_DISABLE.
Let's fix the issue by configuring scr before reset for basic dma
even if we don't use it. The scr register will be reset when we do
softreset few lines after, and we restore scr on resume. We should
do this for all the SoCs with UART\_ERRATA\_CLOCK\_DISABLE quirk flag
set since the ones with UART\_ERRATA\_CLOCK\_DISABLE are all based
using clkctrl similar to omap4.
Looks like both OMAP\_UART\_SCR\_DMAMODE\_1 | OMAP\_UART\_SCR\_DMAMODE\_CTL
bits are needed for the clkctrl to idle after a softreset.
And we need to add omap4 to also use the UART\_ERRATA\_CLOCK\_DISABLE
for the related workaround to be enabled. This same compatible
value will also be used for omap5.
Fixes: cdb929e4452a ("serial: 8250\_omap: workaround errata around idling UART after using DMA")
Cc: Keerthy
Cc: Matthijs van Duin
Cc: Sekhar Nori
Cc: Tero Kristo
Signed-off-by: Tony Lindgren
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit c8f1940e3a7aae8499cff94eab1b50f69038d66f
Author: Marek Szyprowski
Date: Thu May 10 08:41:13 2018 +0200
serial: samsung: fix maxburst parameter for DMA transactions
commit aa2f80e752c75e593b3820f42c416ed9458fa73e upstream.
The best granularity of residue that DMA engine can report is in the BURST
units, so the serial driver must use MAXBURST = 1 and DMA\_SLAVE\_BUSWIDTH\_1\_BYTE
if it relies on exact number of bytes transferred by DMA engine.
Fixes: 62c37eedb74c ("serial: samsung: add dma reqest/release functions")
Signed-off-by: Marek Szyprowski
Acked-by: Krzysztof Kozlowski
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit ab7a1943955a82b01982fe182f3f8df1372022fa
Author: Sebastian Andrzej Siewior
Date: Mon May 7 19:11:30 2018 +0200
tty/serial: atmel: use port->name as name in request\_irq()
commit 9594b5be7ec110ed11acec58fa94f3f293668c85 upstream.
I was puzzled while looking at /proc/interrupts and random things showed
up between reboots. This occurred more often but I realised it later. The
"correct" output should be:
|38: 11861 atmel-aic5 2 Level ttyS0
but I saw sometimes
|38: 6426 atmel-aic5 2 Level tty1
and accounted it wrongly as correct. This is use after free and the
former example randomly got the "old" pointer which pointed to the same
content. With SLAB\_FREELIST\_RANDOM and HARDENED I even got
|38: 7067 atmel-aic5 2 Level E=Started User Manager for UID 0
or other nonsense.
As it turns out the tty, pointer that is accessed in atmel\_startup(), is
freed() before atmel\_shutdown(). It seems to happen quite often that the
tty for ttyS0 is allocated and freed while ->shutdown is not invoked. I
don't do anything special - just a systemd boot :)
Use dev\_name(&pdev->dev) as the IRQ name for request\_irq(). This exists
as long as the driver is loaded so no use-after-free here.
Cc: stable@vger.kernel.org
Fixes: 761ed4a94582 ("tty: serial\_core: convert uart\_close to use tty\_port\_close")
Acked-by: Richard Genoud
Acked-by: Rob Herring
Signed-off-by: Sebastian Andrzej Siewior
Signed-off-by: Greg Kroah-Hartman
commit 6f7e40b8797e44923552663369dd749fc7bea6ac
Author: Geert Uytterhoeven
Date: Fri Jun 1 11:28:21 2018 +0200
serial: sh-sci: Stop using printk format %pCr
commit d63c16f8e1ab761775275adcf54f4bef7c330295 upstream.
Printk format "%pCr" will be removed soon, as clk\_get\_rate() must not be
called in atomic context.
Replace it by open-coding the operation. This is safe here, as the code
runs in task context.
Link: http://lkml.kernel.org/r/1527845302-12159-4-git-send-email-geert+renesas@glider.be
To: Jia-Ju Bai
To: Jonathan Corbet
To: Michael Turquette
To: Stephen Boyd
To: Zhang Rui
To: Eduardo Valentin
To: Eric Anholt
To: Stefan Wahren
To: Greg Kroah-Hartman
Cc: Sergey Senozhatsky
Cc: Petr Mladek
Cc: Linus Torvalds
Cc: Steven Rostedt
Cc: linux-doc@vger.kernel.org
Cc: linux-clk@vger.kernel.org
Cc: linux-pm@vger.kernel.org
Cc: linux-serial@vger.kernel.org
Cc: linux-arm-kernel@lists.infradead.org
Cc: linux-renesas-soc@vger.kernel.org
Cc: linux-kernel@vger.kernel.org
Cc: Geert Uytterhoeven
Cc: stable@vger.kernel.org # 4.5+
Signed-off-by: Geert Uytterhoeven
Signed-off-by: Petr Mladek
Signed-off-by: Greg Kroah-Hartman
commit cde4abc367aeac4ce269be206d616ef56d583ced
Author: Yoshihiro Shimoda
Date: Tue Apr 10 14:38:54 2018 +0900
usb: gadget: udc: renesas\_usb3: disable the controller's irqs for reconnecting
commit bd6bce004d78b867ba0c6d3712f1c5b50398af9a upstream.
This patch fixes an issue that reconnection is possible to fail
because unexpected state handling happens by the irqs. To fix the issue,
the driver disables the controller's irqs when disconnected.
Fixes: 746bfe63bba3 ("usb: gadget: renesas\_usb3: add support for Renesas USB3.0 peripheral controller")
Cc:  # v4.5+
Reviewed-by: Simon Horman
Signed-off-by: Yoshihiro Shimoda
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit a1b6b51fabee4d905829b9cd76ab104e46d808b7
Author: Yoshihiro Shimoda
Date: Tue Apr 10 14:38:53 2018 +0900
usb: gadget: udc: renesas\_usb3: should fail if devm\_phy\_get() returns error
commit 0259068f63f23a665ded28647f2f9cdb6b20dc72 upstream.
This patch fixes an issue that this driver ignores errors other than
the non-existence of the device, f.e. a memory allocation failure
in devm\_phy\_get(). So, this patch replaces devm\_phy\_get() with
devm\_phy\_optional\_get().
Reported-by: Simon Horman
Fixes: 279d4bc64060 ("usb: gadget: udc: renesas\_usb3: add support for generic phy")
Cc:  # v4.15+
Reviewed-by: Simon Horman
Signed-off-by: Yoshihiro Shimoda
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 6ce652a4a14159d645be34cf67e398b72d94d8e2
Author: Yoshihiro Shimoda
Date: Tue Apr 10 14:38:52 2018 +0900
usb: gadget: udc: renesas\_usb3: should call devm\_phy\_get() before add udc
commit 003bc1dee216b1fb8e02040a95672bea0f1fe797 upstream.
This patch fixes an issue that this driver cannot call phy\_init()
if a gadget driver is alreadly loaded because usb\_add\_gadget\_udc()
might call renesas\_usb3\_start() via .udc\_start.
This patch also revises the typo (s/an optional/optional/).
Fixes: 279d4bc64060 ("usb: gadget: udc: renesas\_usb3: add support for generic phy")
Cc:  # v4.15+
Signed-off-by: Yoshihiro Shimoda
Reviewed-by: Simon Horman
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit b27a53d962b535a65ce3687a57e22fb2cffb54b5
Author: Yoshihiro Shimoda
Date: Tue Apr 10 14:38:51 2018 +0900
usb: gadget: udc: renesas\_usb3: should call pm\_runtime\_enable() before add udc
commit d998844016b24a8d71b9aa5eae7e51d70f2de438 upstream.
This patch fixes an issue that this driver causes panic if a gadget
driver is already loaded because usb\_add\_gadget\_udc() might call
renesas\_usb3\_start() via .udc\_start, and then pm\_runtime\_get\_sync()
in renesas\_usb3\_start() doesn't work correctly.
Note that the usb3\_to\_dev() macro should not be called at this timing
because the macro uses the gadget structure.
Fixes: cf06df3fae28 ("usb: gadget: udc: renesas\_usb3: move pm\_runtime\_{en,dis}able()")
Cc:  # v4.15+
Signed-off-by: Yoshihiro Shimoda
Reviewed-by: Simon Horman
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 4ba996b9623987378e57d4739aabaf82df9add9b
Author: Yoshihiro Shimoda
Date: Tue Apr 10 14:38:50 2018 +0900
usb: gadget: udc: renesas\_usb3: should remove debugfs
commit 1990cf7c21ea185cec98c6d45a82c04481261e35 upstream.
This patch fixes an issue that this driver doesn't remove its debugfs.
Fixes: 43ba968b00ea ("usb: gadget: udc: renesas\_usb3: add debugfs to set the b-device mode")
Cc:  # v4.14+
Signed-off-by: Yoshihiro Shimoda
Reviewed-by: Simon Horman
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 7ccec0f6856c18e90ffbb6027db32178abceadf3
Author: Yoshihiro Shimoda
Date: Mon Apr 2 21:21:31 2018 +0900
usb: gadget: udc: renesas\_usb3: fix double phy\_put()
commit 8223b2f89ca63e203dcb54148e30d94979f17b0b upstream.
This patch fixes an issue that this driver cause double phy\_put()
calling. This driver must not call phy\_put() in the remove because
the driver calls devm\_phy\_get() in the probe.
Fixes: 279d4bc64060 ("usb: gadget: udc: renesas\_usb3: add support for generic phy")
Cc:  # v4.15+
Reviewed-by: Simon Horman
Signed-off-by: Yoshihiro Shimoda
Signed-off-by: Felipe Balbi
Signed-off-by: Greg Kroah-Hartman
commit 1dce9fcf93a0702fcc7476755483d5b1760cf966
Author: Yoshihiro Shimoda
Date: Mon May 21 20:18:07 2018 +0900
usb: gadget: function: printer: avoid wrong list handling in printer\_write()
commit 4a014a7339f441b0851ce012f469c0fadac61c81 upstream.
When printer\_write() calls usb\_ep\_queue(), a udc driver (e.g.
renesas\_usbhs driver) may call usb\_gadget\_giveback\_request() in
the udc .queue ops immediately. Then, printer\_write() calls
list\_add(&req->list, &dev->tx\_reqs\_active) wrongly. After that,
if we do unbind the printer driver, WARN\_ON() happens in
printer\_func\_unbind() because the list entry is not removed.
So, this patch moves list\_add(&req->list, &dev->tx\_reqs\_active)
calling before usb\_ep\_queue().
Signed-off-by: Yoshihiro Shimoda
Acked-by: Felipe Balbi
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit b20a6fb3fd3291389d51cf3647fdba8ff2814076
Author: Heikki Krogerus
Date: Thu May 24 13:49:52 2018 +0300
usb: typec: wcove: Remove dependency on HW FSM
commit 05826ff135ee083d28c006fbde6e810f17437166 upstream.
The USB Type-C PHY in Intel WhiskeyCove PMIC has build-in
USB Type-C state machine which we were relying on to
configure the CC lines correctly. This patch removes that
dependency and configures the CC line according to commands
from the port manager (tcpm.c) in wcove\_set\_cc().
This fixes an issue where USB devices attached to the USB
Type-C port do not get enumerated. When acting as
source/host, the HW FSM sometimes fails to configure the PHY
correctly.
Fixes: 3c4fb9f16921 ("usb: typec: wcove: start using tcpm for USB PD support")
Cc: stable@vger.kernel.org
Signed-off-by: Heikki Krogerus
Signed-off-by: Greg Kroah-Hartman
commit 2212281caf97d2f7072bdcae8a88626f10a4e1a1
Author: Ruslan Bilovol
Date: Fri May 25 19:11:40 2018 +0300
usb: core: message: remove extra endianness conversion in usb\_set\_isoch\_delay
commit 48b73d0fa11aa8613d51f7be61d2fa7f0ab05fd3 upstream.
No need to do extra endianness conversion in
usb\_set\_isoch\_delay because it is already done
in usb\_control\_msg()
Fixes: 886ee36e7205 ("usb: core: add support for USB\_REQ\_SET\_ISOCH\_DELAY")
Cc: Dmytro Panchenko
Cc: Felipe Balbi
Cc: stable  # v4.16+
Signed-off-by: Ruslan Bilovol
Signed-off-by: Greg Kroah-Hartman
commit 024e9a071bd647e25b8c4d374bd392c0b4a1fd93
Author: Manu Gautam
Date: Thu May 3 02:36:10 2018 +0530
phy: qcom-qusb2: Fix crash if nvmem cell not specified
commit 0b4555e776ba0712c6fafb98b226b21fd05d2427 upstream.
Driver currently crashes due to NULL pointer deference
while updating PHY tune register if nvmem cell is NULL.
Since, fused value for Tune1/2 register is optional,
we'd rather bail out.
Fixes: ca04d9d3e1b1 ("phy: qcom-qusb2: New driver for QUSB2 PHY on Qcom chips")
Reviewed-by: Vivek Gautam
Reviewed-by: Evan Green
Cc: stable  # 4.14+
Signed-off-by: Manu Gautam
Signed-off-by: Kishon Vijay Abraham I
Signed-off-by: Greg Kroah-Hartman
commit b7d3c9548268214b125e6386350a3b2284e1251e
Author: Ethan Lee
Date: Fri Jun 1 11:46:08 2018 -0700
Input: xpad - add GPD Win 2 Controller USB IDs
commit c1ba08390a8bb13c927e699330896adc15b78205 upstream.
GPD Win 2 Website: http://www.gpd.hk/gpdwin2.asp
Tested on a unit from the first production run sent to Indiegogo backers
Signed-off-by: Ethan Lee
Cc: stable@vger.kernel.org
Signed-off-by: Dmitry Torokhov
Signed-off-by: Greg Kroah-Hartman
commit f3726ba76bd9b21343f89a8389342799a2af65b7
Author: Alexander Kappner
Date: Fri May 18 21:50:16 2018 -0700
usb-storage: Add compatibility quirk flags for G-Technologies G-Drive
commit ca7d9515d0e6825351ce106066cea1f60e40b1c8 upstream.
The "G-Drive" (sold by G-Technology) external USB 3.0 drive
hangs on write access under UAS and usb-storage:
[ 136.079121] sd 15:0:0:0: [sdi] tag#0 FAILED Result: hostbyte=DID\_OK driverbyte=DRIVER\_SENSE
[ 136.079144] sd 15:0:0:0: [sdi] tag#0 Sense Key : Illegal Request [current]
[ 136.079152] sd 15:0:0:0: [sdi] tag#0 Add. Sense: Invalid field in cdb
[ 136.079176] sd 15:0:0:0: [sdi] tag#0 CDB: Write(16) 8a 08 00 00 00 00 00 00 00 00 00 00 00 08 00 00
[ 136.079180] print\_req\_error: critical target error, dev sdi, sector 0
[ 136.079183] Buffer I/O error on dev sdi, logical block 0, lost sync page write
[ 136.173148] EXT4-fs (sdi): mounted filesystem with ordered data mode. Opts: (null)
[ 140.583998] sd 15:0:0:0: [sdi] tag#0 FAILED Result: hostbyte=DID\_OK driverbyte=DRIVER\_SENSE
[ 140.584010] sd 15:0:0:0: [sdi] tag#0 Sense Key : Illegal Request [current]
[ 140.584016] sd 15:0:0:0: [sdi] tag#0 Add. Sense: Invalid field in cdb
[ 140.584022] sd 15:0:0:0: [sdi] tag#0 CDB: Write(16) 8a 08 00 00 00 00 e8 c4 00 18 00 00 00 08 00 00
[ 140.584025] print\_req\_error: critical target error, dev sdi, sector 3905159192
[ 140.584044] print\_req\_error: critical target error, dev sdi, sector 3905159192
[ 140.584052] Aborting journal on device sdi-8.
The proposed patch adds compatibility quirks. Because the drive requires two
quirks (one to work with UAS, and another to work with usb-storage), adding this
under unusual\_devs.h and not just unusual\_uas.h so kernels compiled without UAS
receive the quirk. With the patch, the drive works reliably on UAS and usb-
storage.
(tested on NEC Corporation uPD720200 USB 3.0 host controller).
Signed-off-by: Alexander Kappner
Acked-by: Alan Stern
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 6dc83647c1d3c7e59c53e7d934ad4a86e9bbd2ee
Author: Alexander Kappner
Date: Fri May 18 21:50:15 2018 -0700
usb-storage: Add support for FL\_ALWAYS\_SYNC flag in the UAS driver
commit 8c4e97ddfe73a0958bb0abf7e6a3bc4cc3e04936 upstream.
The ALWAYS\_SYNC flag is currently honored by the usb-storage driver but not UAS
and is required to work around devices that become unstable upon being
queried for cache. This code is taken straight from:
drivers/usb/storage/scsiglue.c:284
Signed-off-by: Alexander Kappner
Acked-by: Alan Stern
Cc: stable
Acked-by: Oliver Neukum
Signed-off-by: Greg Kroah-Hartman
commit 089cf89b156574f35e9f84f674a513be0c40c22a
Author: Gustavo A. R. Silva
Date: Fri May 18 20:13:42 2018 -0500
usbip: vhci\_sysfs: fix potential Spectre v1
commit a0d6ec88090d7b1b008429c44532a388e29bb1bd upstream.
pdev\_nr and rhport can be controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability.
This issue was detected with the help of Smatch:
drivers/usb/usbip/vhci\_sysfs.c:238 detach\_store() warn: potential spectre issue 'vhcis'
drivers/usb/usbip/vhci\_sysfs.c:328 attach\_store() warn: potential spectre issue 'vhcis'
drivers/usb/usbip/vhci\_sysfs.c:338 attach\_store() warn: potential spectre issue 'vhci->vhci\_hcd\_ss->vdev'
drivers/usb/usbip/vhci\_sysfs.c:340 attach\_store() warn: potential spectre issue 'vhci->vhci\_hcd\_hs->vdev'
Fix this by sanitizing pdev\_nr and rhport before using them to index
vhcis and vhci->vhci\_hcd\_ss->vdev respectively.
Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].
[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva
Acked-by: Shuah Khan (Samsung OSG)
Signed-off-by: Greg Kroah-Hartman
commit d40e8d428acaf2a637a6e1ea4143ff02f1cc8634
Author: Greg Kroah-Hartman
Date: Sun May 20 15:19:46 2018 +0200
NFC: pn533: don't send USB data off of the stack
commit dbafc28955fa6779dc23d1607a0fee5e509a278b upstream.
It's amazing that this driver ever worked, but now that x86 doesn't
allow USB data to be sent off of the stack, it really does not work at
all. Fix this up by properly allocating the data for the small
"commands" that get sent to the device off of the stack.
We do this for one command by having a whole urb just for ack messages,
as they can be submitted in interrupt context, so we can not use
usb\_bulk\_msg(). But the poweron command can sleep (and does), so use
usb\_bulk\_msg() for that transfer.
Reported-by: Carlos Manuel Santos
Cc: Samuel Ortiz
Cc: Stephen Hemminger
Cc: stable
Reviewed-by: Johan Hovold
Signed-off-by: Greg Kroah-Hartman
commit 183c01f61851a38fab228003cbcee51cb122e6d4
Author: Laura Abbott
Date: Mon May 14 14:35:09 2018 -0700
staging: android: ion: Switch to pr\_warn\_once in ion\_buffer\_destroy
commit 45ad559a29629cb1c64ee636563c69b71524f077 upstream.
Syzbot reported yet another warning with Ion:
WARNING: CPU: 0 PID: 1467 at drivers/staging/android/ion/ion.c:122
ion\_buffer\_destroy+0xd4/0x190 drivers/staging/android/ion/ion.c:122
Kernel panic - not syncing: panic\_on\_warn set ...
This is catching that a buffer was freed with an existing kernel mapping
still present. This can be easily be triggered from userspace by calling
DMA\_BUF\_SYNC\_START without calling DMA\_BUF\_SYNC\_END. Switch to a single
pr\_warn\_once to indicate the error without being disruptive.
Reported-by: syzbot+cd8bcd40cb049efa2770@syzkaller.appspotmail.com
Reported-by: syzbot
Signed-off-by: Laura Abbott
Cc: stable
Signed-off-by: Greg Kroah-Hartman
commit 0c950f7417267db597e73170d7694ba7f09f77a0
Author: Paolo Bonzini
Date: Wed Jun 6 17:38:09 2018 +0200
kvm: x86: use correct privilege level for sgdt/sidt/fxsave/fxrstor access
commit 3c9fa24ca7c9c47605672916491f79e8ccacb9e6 upstream.
The functions that were used in the emulation of fxrstor, fxsave, sgdt and
sidt were originally meant for task switching, and as such they did not
check privilege levels. This is very bad when the same functions are used
in the emulation of unprivileged instructions. This is CVE-2018-10853.
The obvious fix is to add a new argument to ops->read\_std and ops->write\_std,
which decides whether the access is a "system" access or should use the
processor's CPL.
Fixes: 129a72a0d3c8 ("KVM: x86: Introduce segmented\_write\_std", 2017-01-12)
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 3842b793ee401393f2befdd39d22d1fea6b5c5a2
Author: Paolo Bonzini
Date: Wed Jun 6 17:37:49 2018 +0200
KVM: x86: pass kvm\_vcpu to kvm\_read\_guest\_virt and kvm\_write\_guest\_virt\_system
commit ce14e868a54edeb2e30cb7a7b104a2fc4b9d76ca upstream.
Int the next patch the emulator's .read\_std and .write\_std callbacks will
grow another argument, which is not needed in kvm\_read\_guest\_virt and
kvm\_write\_guest\_virt\_system's callers. Since we have to make separate
functions, let's give the currently existing names a nicer interface, too.
Fixes: 129a72a0d3c8 ("KVM: x86: Introduce segmented\_write\_std", 2017-01-12)
Cc: stable@vger.kernel.org
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 9c3c30575618ba14d4fa67c887a32c05dc55e6fd
Author: Felix Wilhelm
Date: Mon Jun 11 09:43:44 2018 +0200
kvm: nVMX: Enforce cpl=0 for VMX instructions
commit 727ba748e110b4de50d142edca9d6a9b7e6111d8 upstream.
VMX instructions executed inside a L1 VM will always trigger a VM exit
even when executed with cpl 3. This means we must perform the
privilege check in software.
Fixes: 70f3aac964ae("kvm: nVMX: Remove superfluous VMX instruction fault checks")
Cc: stable@vger.kernel.org
Signed-off-by: Felix Wilhelm
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 482e73ef325e8fcbcba11865616a990913cdff25
Author: Michael S. Tsirkin
Date: Fri Jun 8 02:19:53 2018 +0300
kvm: fix typo in flag name
commit 766d3571d8e50d3a73b77043dc632226f9e6b389 upstream.
KVM\_X86\_DISABLE\_EXITS\_HTL really refers to exit on halt.
Obviously a typo: should be named KVM\_X86\_DISABLE\_EXITS\_HLT.
Fixes: caa057a2cad ("KVM: X86: Provide a capability to disable HLT intercepts")
Cc: stable@vger.kernel.org
Signed-off-by: Michael S. Tsirkin
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit a0f33fde1107c672a50287c8fc7e8409bb7d05b3
Author: Paolo Bonzini
Date: Wed Jun 6 16:43:02 2018 +0200
KVM: x86: introduce linear\_{read,write}\_system
commit 79367a65743975e5cac8d24d08eccc7fdae832b0 upstream.
Wrap the common invocation of ctxt->ops->read\_std and ctxt->ops->write\_std, so
as to have a smaller patch when the functions grow another argument.
Fixes: 129a72a0d3c8 ("KVM: x86: Introduce segmented\_write\_std", 2017-01-12)
Cc: stable@vger.kernel.org
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit 681bfc6800d2da287d84bede49ab0d7d8a0609b9
Author: Wanpeng Li
Date: Sun May 13 02:24:47 2018 -0700
KVM: X86: Fix reserved bits check for MOV to CR3
commit a780a3ea628268b2ad0ed43d7f28d90db0ff18be upstream.
MSB of CR3 is a reserved bit if the PCIDE bit is not set in CR4.
It should be checked when PCIDE bit is not set, however commit
'd1cd3ce900441 ("KVM: MMU: check guest CR3 reserved bits based on
its physical address width")' removes the bit 63 checking
unconditionally. This patch fixes it by checking bit 63 of CR3
when PCIDE bit is not set in CR4.
Fixes: d1cd3ce900441 (KVM: MMU: check guest CR3 reserved bits based on its physical address width)
Cc: Paolo Bonzini
Cc: Radim Krčmář
Cc: Liran Alon
Cc: stable@vger.kernel.org
Reviewed-by: Junaid Shahid
Signed-off-by: Wanpeng Li
Signed-off-by: Paolo Bonzini
Signed-off-by: Greg Kroah-Hartman
commit a4932a9ccdec58a973eb3b6aaeb8f775a868c81c
Author: Bart Van Assche
Date: Tue May 22 08:27:22 2018 -0700
blkdev\_report\_zones\_ioctl(): Use vmalloc() to allocate large buffers
commit 327ea4adcfa37194739f1ec7c70568944d292281 upstream.
Avoid that complaints similar to the following appear in the kernel log
if the number of zones is sufficiently large:
fio: page allocation failure: order:9, mode:0x140c0c0(GFP\_KERNEL|\_\_GFP\_COMP|\_\_GFP\_ZERO), nodemask=(null)
Call Trace:
dump\_stack+0x63/0x88
warn\_alloc+0xf5/0x190
\_\_alloc\_pages\_slowpath+0x8f0/0xb0d
\_\_alloc\_pages\_nodemask+0x242/0x260
alloc\_pages\_current+0x6a/0xb0
kmalloc\_order+0x18/0x50
kmalloc\_order\_trace+0x26/0xb0
\_\_kmalloc+0x20e/0x220
blkdev\_report\_zones\_ioctl+0xa5/0x1a0
blkdev\_ioctl+0x1ba/0x930
block\_ioctl+0x41/0x50
do\_vfs\_ioctl+0xaa/0x610
SyS\_ioctl+0x79/0x90
do\_syscall\_64+0x79/0x1b0
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Fixes: 3ed05a987e0f ("blk-zoned: implement ioctls")
Signed-off-by: Bart Van Assche
Cc: Shaun Tancheff
Cc: Damien Le Moal
Cc: Christoph Hellwig
Cc: Martin K. Petersen
Cc: Hannes Reinecke
Cc:
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 1adad7cbc1e6d44c110c2cbb02f0967e9117a273
Author: Atul Gupta
Date: Thu May 10 10:14:42 2018 +0530
crypto: chelsio - request to HW should wrap
commit 4c826fed675dfffd8485c5477b616d61d1ec9e9a upstream.
-Tx request and data is copied to HW Q in 64B desc, check for
end of queue and adjust the current position to start from
beginning before passing the additional request info.
-key context copy should check key length only
-Few reverse christmas tree correction
Signed-off-by: Atul Gupta
Signed-off-by: Herbert Xu
Signed-off-by: Greg Kroah-Hartman


=== Content from github.com_c5c6e539_20250124_144912.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F727ba748e110b4de50d142edca9d6a9b7e6111d8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F727ba748e110b4de50d142edca9d6a9b7e6111d8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/727ba748e110b4de50d142edca9d6a9b7e6111d8)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

kvm: nVMX: Enforce cpl=0 for VMX instructions

[Browse files](/torvalds/linux/tree/727ba748e110b4de50d142edca9d6a9b7e6111d8)
Browse the repository at this point in the history

```
VMX instructions executed inside a L1 VM will always trigger a VM exit
even when executed with cpl 3. This means we must perform the
privilege check in software.

Fixes: [70f3aac](https://github.com/torvalds/linux/commit/70f3aac964ae2bc9a0a1d5d65a62e258591ade18)("kvm: nVMX: Remove superfluous VMX instruction fault checks")
Cc: stable@vger.kernel.org
Signed-off-by: Felix Wilhelm <fwilhelm@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
```

* Loading branch information

[![@felixwilhelm](https://avatars.githubusercontent.com/u/2214289?s=40&v=4)](/felixwilhelm) [![@bonzini](https://avatars.githubusercontent.com/u/42082?s=40&v=4)](/bonzini)

[felixwilhelm](/torvalds/linux/commits?author=felixwilhelm "View all commits by felixwilhelm")
authored and
[bonzini](/torvalds/linux/commits?author=bonzini "View all commits by bonzini")
committed
Jun 12, 2018

1 parent
[f4160e4](/torvalds/linux/commit/f4160e459c57646122beaea3f163b798179ea446)

commit 727ba74

Showing
**1 changed file**
with
**13 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

15 changes: 13 additions & 2 deletions

15
[arch/x86/kvm/vmx.c](#diff-bde1d18aaf44756d9e4e7b449c5f7ffdd483e4866a9d5500fd505a102c8f0208 "arch/x86/kvm/vmx.c")

Show comments

[View file](/torvalds/linux/blob/727ba748e110b4de50d142edca9d6a9b7e6111d8/arch/x86/kvm/vmx.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -7905,6 +7905,12 @@ static int handle\_vmon(struct kvm\_vcpu \*vcpu) |
|  |  | return 1; |
|  |  | } |
|  |  |  |
|  |  | /\* CPL=0 must be checked manually. \*/ |
|  |  | if (vmx\_get\_cpl(vcpu)) { |
|  |  | kvm\_queue\_exception(vcpu, UD\_VECTOR); |
|  |  | return 1; |
|  |  | } |
|  |  |  |
|  |  | if (vmx->nested.vmxon) { |
|  |  | nested\_vmx\_failValid(vcpu, VMXERR\_VMXON\_IN\_VMX\_ROOT\_OPERATION); |
|  |  | return kvm\_skip\_emulated\_instruction(vcpu); |
| Expand Down  Expand Up | | @@ -7964,6 +7970,11 @@ static int handle\_vmon(struct kvm\_vcpu \*vcpu) |
|  |  | \*/ |
|  |  | static int nested\_vmx\_check\_permission(struct kvm\_vcpu \*vcpu) |
|  |  | { |
|  |  | if (vmx\_get\_cpl(vcpu)) { |
|  |  | kvm\_queue\_exception(vcpu, UD\_VECTOR); |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | if (!to\_vmx(vcpu)->nested.vmxon) { |
|  |  | kvm\_queue\_exception(vcpu, UD\_VECTOR); |
|  |  | return 0; |
| Expand Down  Expand Up | | @@ -8283,7 +8294,7 @@ static int handle\_vmread(struct kvm\_vcpu \*vcpu) |
|  |  | if (get\_vmx\_mem\_address(vcpu, exit\_qualification, |
|  |  | vmx\_instruction\_info, true, &gva)) |
|  |  | return 1; |
|  |  | /\* \_system ok, as hardware has verified cpl=0 \*/ |
|  |  | /\* \_system ok, nested\_vmx\_check\_permission has verified cpl=0 \*/ |
|  |  | kvm\_write\_guest\_virt\_system(&vcpu->arch.emulate\_ctxt, gva, |
|  |  | &field\_value, (is\_long\_mode(vcpu) ? 8 : 4), NULL); |
|  |  | } |
| Expand Down  Expand Up | | @@ -8448,7 +8459,7 @@ static int handle\_vmptrst(struct kvm\_vcpu \*vcpu) |
|  |  | if (get\_vmx\_mem\_address(vcpu, exit\_qualification, |
|  |  | vmx\_instruction\_info, true, &vmcs\_gva)) |
|  |  | return 1; |
|  |  | /\* ok to use \*\_system, as hardware has verified cpl=0 \*/ |
|  |  | /\* \*\_system ok, nested\_vmx\_check\_permission has verified cpl=0 \*/ |
|  |  | if (kvm\_write\_guest\_virt\_system(&vcpu->arch.emulate\_ctxt, vmcs\_gva, |
|  |  | (void \*)&to\_vmx(vcpu)->nested.current\_vmptr, |
|  |  | sizeof(u64), &e)) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `727ba74`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F727ba748e110b4de50d142edca9d6a9b7e6111d8) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.exploit-db.com_e7db037e_20250124_144915.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# KVM (Nested Virtualization) - L1 Guest Privilege Escalation

#### EDB-ID:

###### 44944

#### CVE:

###### [2018-12904](https://nvd.nist.gov/vuln/detail/CVE-2018-12904)

---

**EDB Verified:**

#### Author:

###### [Google Security Research](/?author=7725)

#### Type:

###### [dos](/?type=dos)

---

#### Platform:

###### [Linux](/?platform=linux)

#### Date:

###### 2018-06-25

---

**Vulnerable App:**

```
When KVM (on Intel) virtualizes another hypervisor as L1 VM it does not verify that VMX instructions from the L1 VM (which trigger a VM exit and are emulated by L0 KVM) are coming from ring 0.

For code running on bare metal or VMX root mode this is enforced by hardware. However, for code running in L1, the instruction always triggers a VM exit even when executed with cpl 3. This behavior is documented by Intel (example is for the VMPTRST instruction):

(Intel Manual 30-18 Vol. 3C)
IF (register operand) or (not in VMX operation) or (CR0.PE = 0) or (RFLAGS.VM = 1) or (IA32_EFER.LMA = 1 and CS.L = 0)
 THEN #UD;
ELSIF in VMX non-root operation
 THEN VMexit;
ELSIF CPL > 0
 THEN #GP(0);
ELSE
 64-bit in-memory destination operand ← current-VMCS pointer;

This means that a normal user space program running in the L1 VM can trigger KVMs VMX emulation which gives a large number of privilege escalation vectors (fake VMCS or vmptrld / vmptrst to a kernel address are the first that come to mind). As VMX emulation code checks for the guests CR4.VMXE value this only works if a L2 guest is running.

A somewhat realistic exploit scenario would involve someone breaking out of a L2 guest (for example by exploiting a bug in the L1 qemu process) and then using this bug for privilege escalation on the L1 system.

Simple POC (tested on L0 and L1 running Ubuntu 18.04 4.15.0-22-generic).
This requires that a L2 guest exists:

echo 'main(){asm volatile ("vmptrst 0xffffffffc0031337");}'| gcc -xc - ; ./a.out

[ 2537.280319] BUG: unable to handle kernel paging request at ffffffffc0031337

```

**Tags:**
[Denial of Service (DoS)](/?tag=13)

**Advisory/Source:**
[Link](https://bugs.chromium.org/p/project-zero/issues/detail?id=1589)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from bugs.chromium.org_e072f1f9_20250124_144910.html ===



=== Content from usn.ubuntu.com_a069f187_20250124_144914.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3752-3: Linux kernel (Azure, GCP, OEM) vulnerabilities

28 August 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)
* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-oem](/security/cves?package=linux-oem) - Linux kernel for OEM processors

## Details

It was discovered that, when attempting to handle an out-of-memory

situation, a null pointer dereference could be triggered in the Linux

kernel in some circumstances. A local attacker could use this to cause a

denial of service (system crash). ([CVE-2018-1000200](/security/CVE-2018-1000200))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate meta-data information. An attacker could

use this to construct a malicious xfs image that, when mounted, could cause

a denial of service (system crash). ([CVE-2018-10323](/security/CVE-2018-10323))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate xattr information. An attacker could use

this to construct a malicious xfs image that, when mounted, could cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-10840](/security/CVE-2018-10840))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep meta-data information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash).

([CVE-2018-10881](/security/CVE-2018-10881))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly handle corrupted meta data in some situations. An

attacker could use this to specially craft an ext4 filesystem that caused a

denial of service (system crash) when mounted. ([CVE-2018-1093](/security/CVE-2018-1093))

Jann Horn discovered that the Linux kernel's implementation of random seed

data reported that it was in a ready state before it had gathered

sufficient entropy. An attacker could use this to expose sensitive

information. ([CVE-2018-1108](/security/CVE-2018-1108))

It was discovered that the procfs filesystem did not properly handle

processes mapping some memory elements onto files. A local attacker could

use this to block utilities that examine the procfs filesystem to report

operating system state, such as ps(1). ([CVE-2018-1120](/security/CVE-2018-1120))

Jann Horn discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep xattr information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11412](/security/CVE-2018-11412))

Piotr Gabriel Kosinski and Daniel Shapira discovered a stack-based buffer

overflow in the CDROM driver implementation of the Linux kernel. A local

attacker could use this to cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11506](/security/CVE-2018-11506))

Shankara Pailoor discovered that a race condition existed in the socket

handling code in the Linux kernel. A local attacker could use this to cause

a denial of service (system crash). ([CVE-2018-12232](/security/CVE-2018-12232))

Shankara Pailoor discovered that the JFS filesystem implementation in the

Linux kernel contained a buffer overflow when handling extended attributes.

A local attacker could use this to cause a denial of service (system crash)

or possibly execute arbitrary code. ([CVE-2018-12233](/security/CVE-2018-12233))

Felix Wilhelm discovered that the KVM implementation in the Linux kernel

did not properly perform permission checks in some situations when nested

virtualization is used. An attacker in a guest VM could possibly use this

to escape into an outer VM or the host OS. ([CVE-2018-12904](/security/CVE-2018-12904))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly handle an error condition with a corrupted xfs

image. An attacker could use this to construct a malicious xfs image that,

when mounted, could cause a denial of service (system crash).

([CVE-2018-13094](/security/CVE-2018-13094))

It was discovered that the Linux kernel did not properly handle setgid file

creation when performed by a non-member of the group. A local attacker

could use this to gain elevated privileges. ([CVE-2018-13405](/security/CVE-2018-13405))

Silvio Cesare discovered that the generic VESA frame buffer driver in the

Linux kernel contained an integer overflow. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-13406](/security/CVE-2018-13406))

Jakub Jirasek discovered that multiple use-after-free errors existed in the

USB/IP implementation in the Linux kernel. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-5814](/security/CVE-2018-5814))

It was discovered that a race condition existed in the ARM Advanced

Microcontroller Bus Architecture (AMBA) driver in the Linux kernel that

could result in a double free. A local attacker could use this to cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-9415](/security/CVE-2018-9415))

It was discovered that an information leak existed in the generic SCSI

driver in the Linux kernel. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-1000204](/security/CVE-2018-1000204))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

##### Ubuntu 16.04

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1000200](/security/CVE-2018-1000200)
* [CVE-2018-1000204](/security/CVE-2018-1000204)
* [CVE-2018-10323](/security/CVE-2018-10323)
* [CVE-2018-10840](/security/CVE-2018-10840)
* [CVE-2018-10881](/security/CVE-2018-10881)
* [CVE-2018-1093](/security/CVE-2018-1093)
* [CVE-2018-1108](/security/CVE-2018-1108)
* [CVE-2018-1120](/security/CVE-2018-1120)
* [CVE-2018-11412](/security/CVE-2018-11412)
* [CVE-2018-11506](/security/CVE-2018-11506)
* [CVE-2018-12232](/security/CVE-2018-12232)
* [CVE-2018-12233](/security/CVE-2018-12233)
* [CVE-2018-12904](/security/CVE-2018-12904)
* [CVE-2018-13094](/security/CVE-2018-13094)
* [CVE-2018-13405](/security/CVE-2018-13405)
* [CVE-2018-13406](/security/CVE-2018-13406)
* [CVE-2018-5814](/security/CVE-2018-5814)
* [CVE-2018-9415](/security/CVE-2018-9415)

## Related notices

* [USN-3752-2](/security/notices/USN-3752-2)
* [USN-3752-1](/security/notices/USN-3752-1)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)
* [USN-3754-1](/security/notices/USN-3754-1)
* [USN-4486-1](/security/notices/USN-4486-1)
* [USN-3753-1](/security/notices/USN-3753-1)
* [USN-3753-2](/security/notices/USN-3753-2)
* [USN-3676-1](/security/notices/USN-3676-1)
* [USN-3676-2](/security/notices/USN-3676-2)
* [USN-3910-2](/security/notices/USN-3910-2)
* [USN-3910-1](/security/notices/USN-3910-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from usn.ubuntu.com_ad850d84_20250124_144913.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3752-2: Linux kernel (HWE) vulnerabilities

24 August 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel

## Details

USN-3752-1 fixed vulnerabilities in the Linux kernel for Ubuntu 18.04

LTS. This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 18.04 LTS for Ubuntu

16.04 LTS.

It was discovered that, when attempting to handle an out-of-memory

situation, a null pointer dereference could be triggered in the Linux

kernel in some circumstances. A local attacker could use this to cause a

denial of service (system crash). ([CVE-2018-1000200](/security/CVE-2018-1000200))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate meta-data information. An attacker could

use this to construct a malicious xfs image that, when mounted, could cause

a denial of service (system crash). ([CVE-2018-10323](/security/CVE-2018-10323))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly validate xattr information. An attacker could use

this to construct a malicious xfs image that, when mounted, could cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-10840](/security/CVE-2018-10840))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep meta-data information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash).

([CVE-2018-10881](/security/CVE-2018-10881))

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly handle corrupted meta data in some situations. An

attacker could use this to specially craft an ext4 filesystem that caused a

denial of service (system crash) when mounted. ([CVE-2018-1093](/security/CVE-2018-1093))

Jann Horn discovered that the Linux kernel's implementation of random seed

data reported that it was in a ready state before it had gathered

sufficient entropy. An attacker could use this to expose sensitive

information. ([CVE-2018-1108](/security/CVE-2018-1108))

It was discovered that the procfs filesystem did not properly handle

processes mapping some memory elements onto files. A local attacker could

use this to block utilities that examine the procfs filesystem to report

operating system state, such as ps(1). ([CVE-2018-1120](/security/CVE-2018-1120))

Jann Horn discovered that the ext4 filesystem implementation in the Linux

kernel did not properly keep xattr information consistent in some

situations. An attacker could use this to construct a malicious ext4 image

that, when mounted, could cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11412](/security/CVE-2018-11412))

Piotr Gabriel Kosinski and Daniel Shapira discovered a stack-based buffer

overflow in the CDROM driver implementation of the Linux kernel. A local

attacker could use this to cause a denial of service (system crash) or

possibly execute arbitrary code. ([CVE-2018-11506](/security/CVE-2018-11506))

Shankara Pailoor discovered that a race condition existed in the socket

handling code in the Linux kernel. A local attacker could use this to cause

a denial of service (system crash). ([CVE-2018-12232](/security/CVE-2018-12232))

Shankara Pailoor discovered that the JFS filesystem implementation in the

Linux kernel contained a buffer overflow when handling extended attributes.

A local attacker could use this to cause a denial of service (system crash)

or possibly execute arbitrary code. ([CVE-2018-12233](/security/CVE-2018-12233))

Felix Wilhelm discovered that the KVM implementation in the Linux kernel

did not properly perform permission checks in some situations when nested

virtualization is used. An attacker in a guest VM could possibly use this

to escape into an outer VM or the host OS. ([CVE-2018-12904](/security/CVE-2018-12904))

Wen Xu discovered that the XFS filesystem implementation in the Linux

kernel did not properly handle an error condition with a corrupted xfs

image. An attacker could use this to construct a malicious xfs image that,

when mounted, could cause a denial of service (system crash).

([CVE-2018-13094](/security/CVE-2018-13094))

It was discovered that the Linux kernel did not properly handle setgid file

creation when performed by a non-member of the group. A local attacker

could use this to gain elevated privileges. ([CVE-2018-13405](/security/CVE-2018-13405))

Silvio Cesare discovered that the generic VESA frame buffer driver in the

Linux kernel contained an integer overflow. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-13406](/security/CVE-2018-13406))

Jakub Jirasek discovered that multiple use-after-free errors existed in the

USB/IP implementation in the Linux kernel. A local attacker could use this

to cause a denial of service (system crash) or possibly execute arbitrary

code. ([CVE-2018-5814](/security/CVE-2018-5814))

It was discovered that a race condition existed in the ARM Advanced

Microcontroller Bus Architecture (AMBA) driver in the Linux kernel that

could result in a double free. A local attacker could use this to cause a

denial of service (system crash) or possibly execute arbitrary code.

([CVE-2018-9415](/security/CVE-2018-9415))

It was discovered that an information leak existed in the generic SCSI

driver in the Linux kernel. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-1000204](/security/CVE-2018-1000204))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.15.0-33-generic](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-33.36~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-33.36~16.04.1)
* [linux-image-4.15.0-33-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-33.36~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-33.36~16.04.1)
* [linux-image-4.15.0-33-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-33.36~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-33.36~16.04.1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1000200](/security/CVE-2018-1000200)
* [CVE-2018-1000204](/security/CVE-2018-1000204)
* [CVE-2018-10323](/security/CVE-2018-10323)
* [CVE-2018-10840](/security/CVE-2018-10840)
* [CVE-2018-10881](/security/CVE-2018-10881)
* [CVE-2018-1093](/security/CVE-2018-1093)
* [CVE-2018-1108](/security/CVE-2018-1108)
* [CVE-2018-1120](/security/CVE-2018-1120)
* [CVE-2018-11412](/security/CVE-2018-11412)
* [CVE-2018-11506](/security/CVE-2018-11506)
* [CVE-2018-12232](/security/CVE-2018-12232)
* [CVE-2018-12233](/security/CVE-2018-12233)
* [CVE-2018-12904](/security/CVE-2018-12904)
* [CVE-2018-13094](/security/CVE-2018-13094)
* [CVE-2018-13405](/security/CVE-2018-13405)
* [CVE-2018-13406](/security/CVE-2018-13406)
* [CVE-2018-5814](/security/CVE-2018-5814)
* [CVE-2018-9415](/security/CVE-2018-9415)

## Related notices

* [USN-3752-1](/security/notices/USN-3752-1)
* [USN-3752-3](/security/notices/USN-3752-3)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)
* [USN-3754-1](/security/notices/USN-3754-1)
* [USN-4486-1](/security/notices/USN-4486-1)
* [USN-3753-1](/security/notices/USN-3753-1)
* [USN-3753-2](/security/notices/USN-3753-2)
* [USN-3676-1](/security/notices/USN-3676-1)
* [USN-3676-2](/security/notices/USN-3676-2)
* [USN-3910-2](/security/notices/USN-3910-2)
* [USN-3910-1](/security/notices/USN-3910-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from git.kernel.org_c1dcfb64_20250124_144909.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Felix Wilhelm <fwilhelm@google.com> | 2018-06-11 09:43:44 +0200 |
| --- | --- | --- |
| committer | Paolo Bonzini <pbonzini@redhat.com> | 2018-06-12 15:06:06 +0200 |
| commit | [727ba748e110b4de50d142edca9d6a9b7e6111d8](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)) | |
| tree | [b7573effd1110a11aac720cc38407bfdb45f651f](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8) | |
| parent | [f4160e459c57646122beaea3f163b798179ea446](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f4160e459c57646122beaea3f163b798179ea446) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8&id2=f4160e459c57646122beaea3f163b798179ea446)) | |
| download | [linux-727ba748e110b4de50d142edca9d6a9b7e6111d8.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-727ba748e110b4de50d142edca9d6a9b7e6111d8.tar.gz) | |

kvm: nVMX: Enforce cpl=0 for VMX instructionsVMX instructions executed inside a L1 VM will always trigger a VM exit
even when executed with cpl 3. This means we must perform the
privilege check in software.
Fixes: 70f3aac964ae("kvm: nVMX: Remove superfluous VMX instruction fault checks")
Cc: stable@vger.kernel.org
Signed-off-by: Felix Wilhelm <fwilhelm@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)

| -rw-r--r-- | [arch/x86/kvm/vmx.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/kvm/vmx.c?id=727ba748e110b4de50d142edca9d6a9b7e6111d8) | 15 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 13 insertions, 2 deletions

| diff --git a/arch/x86/kvm/vmx.c b/arch/x86/kvm/vmx.cindex 709de996f06388..4bf1f9de9332ee 100644--- a/[arch/x86/kvm/vmx.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kvm/vmx.c?id=f4160e459c57646122beaea3f163b798179ea446)+++ b/[arch/x86/kvm/vmx.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/kvm/vmx.c?id=727ba748e110b4de50d142edca9d6a9b7e6111d8)@@ -7905,6 +7905,12 @@ static int handle\_vmon(struct kvm\_vcpu \*vcpu) return 1; } + /\* CPL=0 must be checked manually. \*/+ if (vmx\_get\_cpl(vcpu)) {+ kvm\_queue\_exception(vcpu, UD\_VECTOR);+ return 1;+ }+ if (vmx->nested.vmxon) { nested\_vmx\_failValid(vcpu, VMXERR\_VMXON\_IN\_VMX\_ROOT\_OPERATION); return kvm\_skip\_emulated\_instruction(vcpu);@@ -7964,6 +7970,11 @@ static int handle\_vmon(struct kvm\_vcpu \*vcpu) \*/ static int nested\_vmx\_check\_permission(struct kvm\_vcpu \*vcpu) {+ if (vmx\_get\_cpl(vcpu)) {+ kvm\_queue\_exception(vcpu, UD\_VECTOR);+ return 0;+ }+ if (!to\_vmx(vcpu)->nested.vmxon) { kvm\_queue\_exception(vcpu, UD\_VECTOR); return 0;@@ -8283,7 +8294,7 @@ static int handle\_vmread(struct kvm\_vcpu \*vcpu) if (get\_vmx\_mem\_address(vcpu, exit\_qualification, vmx\_instruction\_info, true, &gva)) return 1;- /\* \_system ok, as hardware has verified cpl=0 \*/+ /\* \_system ok, nested\_vmx\_check\_permission has verified cpl=0 \*/ kvm\_write\_guest\_virt\_system(&vcpu->arch.emulate\_ctxt, gva, &field\_value, (is\_long\_mode(vcpu) ? 8 : 4), NULL); }@@ -8448,7 +8459,7 @@ static int handle\_vmptrst(struct kvm\_vcpu \*vcpu) if (get\_vmx\_mem\_address(vcpu, exit\_qualification, vmx\_instruction\_info, true, &vmcs\_gva)) return 1;- /\* ok to use \*\_system, as hardware has verified cpl=0 \*/+ /\* \*\_system ok, nested\_vmx\_check\_permission has verified cpl=0 \*/ if (kvm\_write\_guest\_virt\_system(&vcpu->arch.emulate\_ctxt, vmcs\_gva, (void \*)&to\_vmx(vcpu)->nested.current\_vmptr, sizeof(u64), &e)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-24 14:47:47 +0000


