=== Content from wiki.mozilla.org_73f8d6fa_20250126_064953.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_d7623d97_20250125_064911.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2018-20

## Security vulnerabilities fixed in Firefox 62

Announced
September 5, 2018
Impact
critical
Products
Firefox
Fixed in

* Firefox 62

#### [#CVE-2018-12377: Use-after-free in refresh driver timers](#CVE-2018-12377)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur when refresh driver timers are refreshed in some circumstances during shutdown when the timer is deleted while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1470260](https://bugzilla.mozilla.org/show_bug.cgi?id=1470260)

#### [#CVE-2018-12378: Use-after-free in IndexedDB](#CVE-2018-12378)

Reporter
Zhanjia Song
Impact
high
##### Description

A use-after-free vulnerability can occur when an IndexedDB index is deleted while still in use by JavaScript code that is providing payload values to be stored. This results in a potentially exploitable crash.

##### References

* [Bug 1459383](https://bugzilla.mozilla.org/show_bug.cgi?id=1459383)

#### [#CVE-2018-18499: Same-origin policy violation using meta refresh and performance.getEntries to steal cross-origin URLs](#CVE-2018-18499)

Reporter
James Lee (@Windowsrcer) of Kryptos Logic
Impact
high
##### Description

A same-origin policy violation allowing the theft of cross-origin URL entries when using a `<meta> meta http-equiv="refresh"` on a page to cause a redirection to another site using `performance.getEntries()`. This is a same-origin policy violation and could allow for data theft.

##### References

* [Bug 1468523](https://bugzilla.mozilla.org/show_bug.cgi?id=1468523)

#### [#CVE-2018-12379: Out-of-bounds write with malicious MAR file](#CVE-2018-12379)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

When the Mozilla Updater opens a MAR format file which contains a very long item filename, an out-of-bounds write can be triggered, leading to a potentially exploitable crash. This requires running the Mozilla Updater manually on the local system with the malicious MAR file in order to occur.

##### References

* [Bug 1473113](https://bugzilla.mozilla.org/show_bug.cgi?id=1473113)

#### [#CVE-2017-16541: Proxy bypass using automount and autofs](#CVE-2017-16541)

Reporter
Filippo Cavallarin
Impact
moderate
##### Description

Browser proxy settings can be bypassed by using the automount feature with autofs to create a mount point on the local file system. Content can be loaded from this mounted file system directly using a `file:` URI, bypassing configured proxy settings.
*Note: this issue only affects OS X in default configurations. On Linux systems, autofs must be installed for the vulnerability to occur and Windows is not affected.*

##### References

* [Bug 1412081](https://bugzilla.mozilla.org/show_bug.cgi?id=1412081)

#### [#CVE-2018-12381: Dragging and dropping Outlook email message results in page navigation](#CVE-2018-12381)

Reporter
Jana Squires
Impact
low
##### Description

Manually dragging and dropping an Outlook email message into the browser will trigger a page navigation when the message's mail columns are incorrectly interpreted as a URL.
*Note: this issue only affects Windows operating systems with Outlook installed. Other operating systems are not affected.*

##### References

* [Bug 1435319](https://bugzilla.mozilla.org/show_bug.cgi?id=1435319)

#### [#CVE-2018-12382: Addressbar spoofing with javascript URI on Firefox for Android](#CVE-2018-12382)

Reporter
Jordi Chancel
Impact
low
##### Description

The displayed addressbar URL can be spoofed on Firefox for Android using a `javascript:` URI in concert with JavaScript to insert text before the loaded domain name, scrolling the loaded domain out of view to the right. This can lead to user confusion.
*This vulnerability only affects Firefox for Android.*

##### References

* [Bug 1479311](https://bugzilla.mozilla.org/show_bug.cgi?id=1479311)

#### [#CVE-2018-12383: Setting a master password post-Firefox 58 does not delete unencrypted previously stored passwords](#CVE-2018-12383)

Reporter
Jurgen Gaeremyn
Impact
low
##### Description

If a user saved passwords before Firefox 58 and then later set a master password, an unencrypted copy of these passwords is still accessible. This is because the older stored password file was not deleted when the data was copied to a new format starting in Firefox 58. The new master password is added only on the new file. This could allow the exposure of stored password data outside of user expectations.

##### References

* [Bug 1475775](https://bugzilla.mozilla.org/show_bug.cgi?id=1475775)

#### [#CVE-2018-12375: Memory safety bugs fixed in Firefox 62](#CVE-2018-12375)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Christian Holler, Looben Yang, Jesse Ruderman, Sebastian Hengst, Nicolas Grunbaum, and Gary Kwong reported memory safety bugs present in Firefox 61. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 62](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1478849%2C1433502%2C1480965%2C894215%2C1462693%2C1475431%2C1461027)

#### [#CVE-2018-12376: Memory safety bugs fixed in Firefox 62 and Firefox ESR 60.2](#CVE-2018-12376)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Boris Zbarsky, Christoph Diehl, Christian Holler, Jason Kratzer, Jed Davis, Tyson Smith, Bogdan Tara, Karl Tomlinson, Mats Palmgren, Nika Layzell, Ted Campbell, and Andrei Cristian Petcu reported memory safety bugs present in Firefox 61 and Firefox ESR 60.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 62 and Firefox ESR 60.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1469309%2C1469914%2C1450989%2C1480092%2C1480517%2C1481093%2C1478575%2C1471953%2C1473161%2C1466991%2C1468738%2C1483120%2C1467363%2C1472925%2C1466577%2C1467889%2C1480521%2C1478849)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from security.gentoo.org_2570aab7_20250125_064910.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple vulnerabilities — GLSA **201810-01**

Multiple vulnerabilities have been found in Mozilla Firefox, the
worst of which may allow execution of arbitrary code.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **60.2.2** |
| Unaffected versions | >= **60.2.2** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **60.2.2** |
| Unaffected versions | >= **60.2.2** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla
Project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please
review the referenced CVE identifiers for details.

### Impact

A remote attacker could entice a user to view a specially crafted web
page, possibly resulting in the execution of arbitrary code with the
privileges of the process or a Denial of Service condition. Furthermore,
a remote attacker may be able to perform Man-in-the-Middle attacks,
obtain sensitive information, spoof the address bar, conduct clickjacking
attacks, bypass security restrictions and protection mechanisms, or have
other unspecified impact.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-60.2.2"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-60.2.2"

```
### References

* [CVE-2017-16541](https://nvd.nist.gov/vuln/detail/CVE-2017-16541)
* [CVE-2018-12358](https://nvd.nist.gov/vuln/detail/CVE-2018-12358)
* [CVE-2018-12359](https://nvd.nist.gov/vuln/detail/CVE-2018-12359)
* [CVE-2018-12360](https://nvd.nist.gov/vuln/detail/CVE-2018-12360)
* [CVE-2018-12361](https://nvd.nist.gov/vuln/detail/CVE-2018-12361)
* [CVE-2018-12362](https://nvd.nist.gov/vuln/detail/CVE-2018-12362)
* [CVE-2018-12363](https://nvd.nist.gov/vuln/detail/CVE-2018-12363)
* [CVE-2018-12364](https://nvd.nist.gov/vuln/detail/CVE-2018-12364)
* [CVE-2018-12365](https://nvd.nist.gov/vuln/detail/CVE-2018-12365)
* [CVE-2018-12366](https://nvd.nist.gov/vuln/detail/CVE-2018-12366)
* [CVE-2018-12367](https://nvd.nist.gov/vuln/detail/CVE-2018-12367)
* [CVE-2018-12368](https://nvd.nist.gov/vuln/detail/CVE-2018-12368)
* [CVE-2018-12369](https://nvd.nist.gov/vuln/detail/CVE-2018-12369)
* [CVE-2018-12370](https://nvd.nist.gov/vuln/detail/CVE-2018-12370)
* [CVE-2018-12371](https://nvd.nist.gov/vuln/detail/CVE-2018-12371)
* [CVE-2018-12376](https://nvd.nist.gov/vuln/detail/CVE-2018-12376)
* [CVE-2018-12377](https://nvd.nist.gov/vuln/detail/CVE-2018-12377)
* [CVE-2018-12378](https://nvd.nist.gov/vuln/detail/CVE-2018-12378)
* [CVE-2018-12379](https://nvd.nist.gov/vuln/detail/CVE-2018-12379)
* [CVE-2018-12381](https://nvd.nist.gov/vuln/detail/CVE-2018-12381)
* [CVE-2018-12383](https://nvd.nist.gov/vuln/detail/CVE-2018-12383)
* [CVE-2018-12385](https://nvd.nist.gov/vuln/detail/CVE-2018-12385)
* [CVE-2018-12386](https://nvd.nist.gov/vuln/detail/CVE-2018-12386)
* [CVE-2018-12387](https://nvd.nist.gov/vuln/detail/CVE-2018-12387)
* [CVE-2018-5125](https://nvd.nist.gov/vuln/detail/CVE-2018-5125)
* [CVE-2018-5127](https://nvd.nist.gov/vuln/detail/CVE-2018-5127)
* [CVE-2018-5129](https://nvd.nist.gov/vuln/detail/CVE-2018-5129)
* [CVE-2018-5130](https://nvd.nist.gov/vuln/detail/CVE-2018-5130)
* [CVE-2018-5131](https://nvd.nist.gov/vuln/detail/CVE-2018-5131)
* [CVE-2018-5144](https://nvd.nist.gov/vuln/detail/CVE-2018-5144)
* [CVE-2018-5150](https://nvd.nist.gov/vuln/detail/CVE-2018-5150)
* [CVE-2018-5154](https://nvd.nist.gov/vuln/detail/CVE-2018-5154)
* [CVE-2018-5155](https://nvd.nist.gov/vuln/detail/CVE-2018-5155)
* [CVE-2018-5156](https://nvd.nist.gov/vuln/detail/CVE-2018-5156)
* [CVE-2018-5157](https://nvd.nist.gov/vuln/detail/CVE-2018-5157)
* [CVE-2018-5158](https://nvd.nist.gov/vuln/detail/CVE-2018-5158)
* [CVE-2018-5159](https://nvd.nist.gov/vuln/detail/CVE-2018-5159)
* [CVE-2018-5168](https://nvd.nist.gov/vuln/detail/CVE-2018-5168)
* [CVE-2018-5178](https://nvd.nist.gov/vuln/detail/CVE-2018-5178)
* [CVE-2018-5183](https://nvd.nist.gov/vuln/detail/CVE-2018-5183)
* [CVE-2018-5186](https://nvd.nist.gov/vuln/detail/CVE-2018-5186)
* [CVE-2018-5187](https://nvd.nist.gov/vuln/detail/CVE-2018-5187)
* [CVE-2018-5188](https://nvd.nist.gov/vuln/detail/CVE-2018-5188)
* [CVE-2018-6126](https://nvd.nist.gov/vuln/detail/CVE-2018-6126)

**Release date**

October 02, 2018

**Latest revision**

October 02, 2018: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [650422](https://bugs.gentoo.org/show_bug.cgi?id=650422)
* [657976](https://bugs.gentoo.org/show_bug.cgi?id=657976)
* [659432](https://bugs.gentoo.org/show_bug.cgi?id=659432)
* [665496](https://bugs.gentoo.org/show_bug.cgi?id=665496)
* [666760](https://bugs.gentoo.org/show_bug.cgi?id=666760)
* [667612](https://bugs.gentoo.org/show_bug.cgi?id=667612)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from wiki.mozilla.org_3659d679_20250126_064952.html ===


# BMO/UserGuide/BugFields

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)
## Bugzilla Field Descriptions

Alias
A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.Assignee
This is the person in charge of resolving the bug. Every time this field changes, the status changes to NEW to make it easy to see which new bugs have appeared on a person's list.Blocks
This bug must be resolved before the bugs listed in this field can be resolved.Bug ID
The numeric id of a bug, unique within this entire installation of Bugzilla.CC
Users who may not have a direct role to play on this bug, but who are interested in its progress.Changed
When this bug was last updated.Classification
Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorization.Comment
Bugs have comments added to them by Bugzilla users. You can search for some text in those comments.Comment Tag
Comments can have arbitrary tags added to them to help with filtering as well as mark comments as spam or abusive.Component
Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.Creation date
When the bug was filed.Depends on
The bugs listed here must be resolved before this bug can be resolved.Duplicates
List of bugs that have been marked a duplicate of the bug currently being viewed.Keywords
Keywords are a controlled vocabulary for characterizing bugs across Products and Components. Examples of this field are `regression`, `sec-high`, and `topcrash`. Bugzilla administrators manage [the list of keywords](https://bugzilla.mozilla.org/describekeywords.cgi). If you believe you need a new keyword, [please contact the administrators to discuss](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).Mentors
Mentors are users who have offered to help the bug owner with such tasks as setting up a development environment, finding relevant information to fixing the bug, how to submit a patch for review, and finally how to get the fix committed.Needinfo
More information has been requested from specific individuals, or anyone, to move the bug forward to completion.OS
This is the operating system against which the bug was reported.Platform
This is the hardware platform against which the bug was reported (ARM, ARM64, x86, x86\_64, etc).Priority

| Priority | Description |
| --- | --- |
| **--** | No decision |
| **P1** | Fix in the current release cycle |
| **P2** | Fix in the next release cycle or the following (nightly + 1 or nightly + 2) |
| **P3** | Backlog |
| **P4** | Do not use. This priority is for the Web Platform Test bot. |
| **P5** | Will not fix, but will accept a patch |

This field describes the importance and order in which a bug should be fixed compared to other bugs. This field is utilized by the programmers/engineers/release managers/managers to prioritize the work to be done. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [priority definitions](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/priority.html), or for the main Bugzilla project, [Bugzilla:Priority\_System](/Bugzilla%3APriority_System "Bugzilla:Priority System").Product
Bugs are categorised into Products and Components. Select a Classification to narrow down this list.QA Contact
The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.Rank
Used by some groups to provide finer-grained ordering for working on bugs than afforded by the Priority field. Use of this field is restricted to the `rank-setters` group.Regressed by
This bug has been introduced by the bugs listed here.Regressions
This bug has introduced the bugs listed here.Reporter
The person who filed this bug.See Also
This allows you to refer to bugs in other bug tracker installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other bug tracker installations, or bugs which are related to, but not known to be duplicates of the bug. Bugs which are regressions should be listed in the Regressed by field (above)Severity
This field describes the impact of a bug. This field is utilized by the programmers/engineers/release managers/managers to determine the severity of issues and used as input for the priority of the bug. It should not be set by people filing bugs. See the Firefox [triage documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html) and [severity documentation](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/severity.html).

| Severity | Description |
| --- | --- |
| **--** | Default value for new bugs; bug triagers for components (ie engineers and other core project folks) are expected to update the bug's severity from this value. To avoid them missing new bugs for triage, do not alter this default when filing bugs. |
| **S1** | (Catastrophic) Blocks development/testing, may impact more than 25% of users, causes data loss, likely dot release driver, and no workaround available |
| **S2** | (Serious) Major functionality/product severely impaired or a high impact issue and a satisfactory workaround does not exist |
| **S3** | (Normal) Blocks non-critical functionality or a work around exists |
| **S4** | (Small/Trivial) minor significance, cosmetic issues, low or no impact to users |
| **N/A** | (Not Applicable) The above definitions do not apply to this bug; this value is reserved for bugs of type Task or Enhancement |

Summary
The bug summary is a short sentence which succinctly describes what the bug is about.Target Milestone
For Firefox-related bugs, when a change set (patch) lands in Mozilla-Central, the [sheriffs](/Sheriffing "Sheriffing") will set this field to the corresponding release value for the current Nightly.
Release status and tracking flags are used to mark intentions for when a fix or other patch should land.
If you need to track a bug against a set of milestones other than upcoming versions of Firefox, please tell the Bugzilla team, you may want a custom status flag.Triage Owner
User that is responsible [for triaging bugs in a specific component](https://firefox-source-docs.mozilla.org/bug-mgmt/policies/triage-bugzilla.html).Type
This field describes the [type of a bug](https://firefox-source-docs.mozilla.org/bug-mgmt/guides/bug-types.html).

| Type | Description |
| --- | --- |
| **defect** | regression, crash, hang, security vulnerability and any other general issue. |
| **enhancement** | new feature, improvement in UI, performance, etc. and any other request for user-facing changes and enhancements in the product; not engineering changes |
| **task** | refactoring, removal, replacement, enabling or disabling of functionality and any other engineering task |

URL
Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.Version
The version field defines the version of the software the bug was found in.Votes
Some bugs can be voted for, and you can limit your search to bugs with more than a certain number of votes. Votes are not used by Mozilla developers to set priorities.Whiteboard
Each bug has a free-form single line text entry box for adding tags and status information

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&oldid=1250790>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FBugFields "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/BugFields "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/BugFields&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/BugFields)
* [View source](/index.php?title=BMO/UserGuide/BugFields&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/BugFields&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/BugFields "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/BugFields "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/BugFields&oldid=1250790 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/BugFields&action=info "More information about this page")

* This page was last edited on 14 May 2024, at 14:22.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/BugFields&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from www.mozilla.org_b4a5cce7_20250125_064912.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2018-21

## Security vulnerabilities fixed in Firefox ESR 60.2

Announced
September 5, 2018
Impact
critical
Products
Firefox ESR
Fixed in

* Firefox ESR 60.2

#### [#CVE-2018-12377: Use-after-free in refresh driver timers](#CVE-2018-12377)

Reporter
Nils
Impact
high
##### Description

A use-after-free vulnerability can occur when refresh driver timers are refreshed in some circumstances during shutdown when the timer is deleted while still in use. This results in a potentially exploitable crash.

##### References

* [Bug 1470260](https://bugzilla.mozilla.org/show_bug.cgi?id=1470260)

#### [#CVE-2018-12378: Use-after-free in IndexedDB](#CVE-2018-12378)

Reporter
Zhanjia Song
Impact
high
##### Description

A use-after-free vulnerability can occur when an IndexedDB index is deleted while still in use by JavaScript code that is providing payload values to be stored. This results in a potentially exploitable crash.

##### References

* [Bug 1459383](https://bugzilla.mozilla.org/show_bug.cgi?id=1459383)

#### [#CVE-2018-18499: Same-origin policy violation using meta refresh and performance.getEntries to steal cross-origin URLs](#CVE-2018-18499)

Reporter
James Lee (@Windowsrcer) of Kryptos Logic
Impact
high
##### Description

A same-origin policy violation allowing the theft of cross-origin URL entries when using a `<meta> meta http-equiv="refresh"` on a page to cause a redirection to another site using `performance.getEntries()`. This is a same-origin policy violation and could allow for data theft.

##### References

* [Bug 1468523](https://bugzilla.mozilla.org/show_bug.cgi?id=1468523)

#### [#CVE-2018-12379: Out-of-bounds write with malicious MAR file](#CVE-2018-12379)

Reporter
Holger Fuhrmannek
Impact
moderate
##### Description

When the Mozilla Updater opens a MAR format file which contains a very long item filename, an out-of-bounds write can be triggered, leading to a potentially exploitable crash. This requires running the Mozilla Updater manually on the local system with the malicious MAR file in order to occur.

##### References

* [Bug 1473113](https://bugzilla.mozilla.org/show_bug.cgi?id=1473113)

#### [#CVE-2017-16541: Proxy bypass using automount and autofs](#CVE-2017-16541)

Reporter
Filippo Cavallarin
Impact
moderate
##### Description

Browser proxy settings can be bypassed by using the automount feature with autofs to create a mount point on the local file system. Content can be loaded from this mounted file system directly using a `file:` URI, bypassing configured proxy settings.
*Note: this issue only affects OS X in default configurations. On Linux systems, autofs must be installed for the vulnerability to occur and Windows is not affected.*

##### References

* [Bug 1412081](https://bugzilla.mozilla.org/show_bug.cgi?id=1412081)

#### [#CVE-2018-12381: Dragging and dropping Outlook email message results in page navigation](#CVE-2018-12381)

Reporter
Jana Squires
Impact
low
##### Description

Manually dragging and dropping an Outlook email message into the browser will trigger a page navigation when the message's mail columns are incorrectly interpreted as a URL.
*Note: this issue only affects Windows operating systems with Outlook installed. Other operating systems are not affected.*

##### References

* [Bug 1435319](https://bugzilla.mozilla.org/show_bug.cgi?id=1435319)

#### [#CVE-2018-12376: Memory safety bugs fixed in Firefox 62 and Firefox ESR 60.2](#CVE-2018-12376)

Reporter
Mozilla developers and community
Impact
critical
##### Description

Mozilla developers and community members Alex Gaynor, Boris Zbarsky, Christoph Diehl, Christian Holler, Jason Kratzer, Jed Davis, Tyson Smith, Bogdan Tara, Karl Tomlinson, Mats Palmgren, Nika Layzell, Ted Campbell, and Andrei Cristian Petcu reported memory safety bugs present in Firefox 61 and Firefox ESR 60.1. Some of these bugs showed evidence of memory corruption and we presume that with enough effort that some of these could be exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 62 and Firefox ESR 60.2](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1469309%2C1469914%2C1450989%2C1480092%2C1480517%2C1481093%2C1478575%2C1471953%2C1473161%2C1466991%2C1468738%2C1483120%2C1467363%2C1472925%2C1466577%2C1467889%2C1480521%2C1478849)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from wiki.mozilla.org_ef8238f3_20250126_064953.html ===


# BMO/UserGuide/Whiteboard

From MozillaWiki
< [BMO](/BMO "BMO")‎ | [UserGuide](/BMO/UserGuide "BMO/UserGuide")

[Jump to navigation](#mw-head)
[Jump to search](#searchInput)

Each bug has a free-form single line text entry box for adding tags and status information. This wiki page is dedicated to collect a comprehensive list of whiteboard tags used in the Mozilla project.

## Contents

* [1 Whiteboard considered harmful](#Whiteboard_considered_harmful)
* [2 Contributor mentoring](#Contributor_mentoring)
* [3 Automated Testing](#Automated_Testing)
* [4 Autonag](#Autonag)
* [5 Release Engineering](#Release_Engineering)
* [6 Sheriffing](#Sheriffing)
* [7 Firefox](#Firefox)
* [8 Community reported bugs](#Community_reported_bugs)
* [9 Firefox OS](#Firefox_OS)
* [10 Tor](#Tor)
* [11 Web Compatibility](#Web_Compatibility)
* [12 Scrum Development](#Scrum_Development)
* [13 What does this whiteboard keyword mean?](#What_does_this_whiteboard_keyword_mean?)
## Whiteboard considered harmful

It is recommended that you request alternative metadata instead of using whiteboard tagging.

* Updating whiteboards tags through the API is non-trivial
* There is no global auto-suggest for whiteboard tags
* There is no verification of whiteboard tags; typos will not be caught and prevented
* Renaming a whiteboard tag requires writing a script to update every bug with that tag, changing its last modified timestamp and generating bugmail; other solutions involve a simple change by administrators
* Whiteboard tags cannot be disabled; people might continue to provide them after they are no longer relevant thinking they still apply
* If desired it's possible to restrict who can set flags to particular values; it will never be possible to prevent accidental or other changes to the whiteboard from any user with editbugs or the bug's reporter

Consider using a keyword, a flag, or a status flag. You can request this on [Bugzilla](https://bugzilla.mozilla.org/enter_bug.cgi?product=bugzilla.mozilla.org&component=Administration).

## Contributor mentoring

For more information, see [Mentors](/Mentors "Mentors").

* `[lang=]`: The programming language involved for this bug.
* `[mentor-lang=]`: (human/natural) language other than English the mentor will be able to communicate to the contributor with.

## Automated Testing

* `[test disabled]`: Indicates an automated test has been disabled. Typically used in bugs filed for intermittent test failures, to indicate that the absence of new failures in the bug is due to the test being disabled - as well as remind module owners that the test needs fixing and re-enabling.

## Autonag

`[no-nag]`: Indicates that a bug should not be modified or commented in by our [Autonag](/Release_Management/autonag "Release Management/autonag") scripts.

## Release Engineering

* `[capacity]`: This bug will help increase (or free up) capacity for our automated build & test machines.

## Sheriffing

* `[leave open]`: This has [been deprecated](https://groups.google.com/forum/#!topic/mozilla.dev.platform/Ie9OXcWbTSs) in favour of the 'leave-open' keyword. Used to ensure that the bug updating tool mcMerge does not close the bug when commits referencing it are merged into mozilla-central.
* `[retriggered]`: Used by sheriffs when investigating Fresh Oranges [[1]](https://charts.mozilla.org/FreshOranges/index.html) to find where a failure started from, using backfills and retriggers

## Firefox

* `dupeme`, `dupme`, or `DUPEME`: we're pretty sure this bug report is a duplicate of another bug, but cannot recall which one or cannot find it.
* `[qa-]`: QE (Quality Engineering) verification not required - superseded by the qe-verify flag.
* `[adv-mainNN+]` (where `NN` is some number): a security advisory about this bug for the release `NN` will be (has been) written.
* `[MemShrink]`: [a project](/Performance/MemShrink "Performance/MemShrink") to reduce memory consumption.

## Community reported bugs

* `[nightly-community]`: This bug was reported by a member of the Firefox Nightly community. Used to triage community-reported bugs and measure the impact of our core community on product quality.
* `[mozfr-community]`: This bug was reported by a member of the MozFR French-speaking community. Used to evaluate the impact of the mozfr.org community on product quality.

## Firefox OS

[Template:Note: This project is no longer active, but we leave these definitions for bug tracker historian purposes](/index.php?title=Template:Note:_This_project_is_no_longer_active,_but_we_leave_these_definitions_for_bug_tracker_historian_purposes&action=edit&redlink=1 "Template:Note: This project is no longer active, but we leave these definitions for bug tracker historian purposes (page does not exist)")

* `[POVB]`: Part of vendor build; the fix of this bug is not in the Mozilla codebase, but it's in our interest to track it.
* `[priority]`: Indicates we are asked by a partner to address this issue with priority.
* `[tarako_only]`: Special pref or feature that only lands on branch for Tarako (low memory phone), i.e. 1.3T branch of Gaia and Gecko. To be picked up on future releases.
* `[p=]/[u=]/[c=]/[s=]`: See [Scrum Development](/BMO/Whiteboard#Scrum_Development "BMO/Whiteboard"). Firefox OS uses the u= tag as the milestone instead, see [Firefox OS Performance Triage](/FirefoxOS/Performance/Triage#Scrumbugs_Tags "FirefoxOS/Performance/Triage")
* `[ft:<name of the team>]`, `[systemsfe]`, etc: Bugs identified to be owned by a "functional team" within B2G engineering. Each team owns a specific set of Bugzilla components, and tags are used to denote owned bugs outside of these components.

## Tor

* `[tor ###]` Part of the [Tor uplift project](/Security/Tor_Uplift/Tracking "Security/Tor Uplift/Tracking"). For example, `[tor 16620]` indicates a corresponding ticket at <https://trac.torproject.org/16620>. See also <https://torpat.ch/uplift>

## Web Compatibility

[Our whiteboard keywords](/Compatibility/BugsGuide "Compatibility/BugsGuide") are already described.

## Scrum Development

The following flags are used by tools like [scrumbu.gs](https://scrumbu.gs/help/) for managing sprints using the scrum development framework:

* `[p=]`: A rough estimate from engineer on how long the bug is going to take.
* `[u=]`: The user (in the scrum sense) that this story affects
* `[c=]`: The component (in the scrum sense) that this story affects
* `[s=]`: An explicit sprint slug this bug should belong to.

If you are not managing a product, you probably don't have to set these.

## What does this whiteboard keyword mean?

If you know what one of the following whiteboard keywords means, please describe it and put it into one of the above categories above (or create a new one):

* `[2.0-FL-bug-bash]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=1021384>)
* `[games]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=1017892>)
* `[reserve-photon-structure]` ([examples](https://bugzilla.mozilla.org/buglist.cgi?list_id=14108939&status_whiteboard_type=substring&status_whiteboard=%5Breserve-photon-structure%5D&order=Bug%20Number&query_format=advanced))
* `[TCP]` (example: <https://bugzilla.mozilla.org/show_bug.cgi?id=920036>)
  + my guess: Tablet Contribution Program?

Retrieved from "<https://wiki.mozilla.org/index.php?title=BMO/UserGuide/Whiteboard&oldid=1245932>"

## Navigation menu

### Personal tools

* [Log in](/index.php?title=Special:UserLogin&returnto=BMO%2FUserGuide%2FWhiteboard "You are encouraged to log in; however, it is not mandatory [o]")
* [Request account](/Special%3ARequestAccount "You are encouraged to create an account and log in; however, it is not mandatory")

### Namespaces

* [Page](/BMO/UserGuide/Whiteboard "View the content page [c]")
* [Discussion](/index.php?title=Talk:BMO/UserGuide/Whiteboard&action=edit&redlink=1 "Discussion about the content page (page does not exist) [t]")

English

### Views

* [Read](/BMO/UserGuide/Whiteboard)
* [View source](/index.php?title=BMO/UserGuide/Whiteboard&action=edit "This page is protected.
  You can view its source [e]")
* [View history](/index.php?title=BMO/UserGuide/Whiteboard&action=history "Past revisions of this page [h]")

More

### Search

### Navigation

* [Main page](/Main_Page "Visit the main page [z]")
* [Product releases](/Releases)
* [New pages](/Special%3ANewPages)
* [Recent changes](/Special%3ARecentChanges "A list of recent changes in the wiki [r]")
* [Recent uploads](/Special%3ANewFiles)
* [Random page](/Special%3ARandom "Load a random page [x]")
* [Help](/MozillaWiki%3AHelp "The place to find out")

### How to Contribute

* [All-hands meeting](/WeeklyUpdates)
* [Other meetings](/Community_Calendar)
* [Contribute to Mozilla](/Contribute)
* [Community Portal](//community.mozilla.org)
* [Community Participation Guidelines](//www.mozilla.org/en-US/about/governance/policies/participation/)

### MozillaWiki

* [About](/MozillaWiki%3AAbout)
* [Team](/MozillaWiki%3ATeam)
* [Policies](/MozillaWiki%3APolicies)
* [Report a wiki bug](//bugzilla.mozilla.org/enter_bug.cgi?product=Websites&component=wiki.mozilla.org)

### Around Mozilla

* [Mozilla Support](//support.mozilla.org/)
* [Mozilla Developer Network](//developer.mozilla.org/)
* [Planet Mozilla](//planet.mozilla.org/)
* [Mozilla Blog](//blog.mozilla.org/)
* [Research](//www.mozilla.org/research/)

### Tools

* [What links here](/Special%3AWhatLinksHere/BMO/UserGuide/Whiteboard "A list of all wiki pages that link here [j]")
* [Related changes](/Special%3ARecentChangesLinked/BMO/UserGuide/Whiteboard "Recent changes in pages linked from this page [k]")
* [Special pages](/Special%3ASpecialPages "A list of all special pages [q]")
* Printable version
* [Permanent link](/index.php?title=BMO/UserGuide/Whiteboard&oldid=1245932 "Permanent link to this revision of this page")
* [Page information](/index.php?title=BMO/UserGuide/Whiteboard&action=info "More information about this page")

* This page was last edited on 27 March 2023, at 15:08.

* [Privacy policy](/MozillaWiki%3APrivacy_policy)
* [About MozillaWiki](/MozillaWiki%3AAbout)
* [Mobile view](https://wiki.mozilla.org/index.php?title=BMO/UserGuide/Whiteboard&mobileaction=toggle_view_mobile)

* [![Powered by MediaWiki](/resources/assets/poweredby_mediawiki_88x31.png)](https://www.mediawiki.org/)



=== Content from bugzilla.mozilla.org_a5e437b3_20250125_064909.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1435319)
* [XML](/show_bug.cgi?ctype=xml&id=1435319)

Closed
[Bug 1435319](/show_bug.cgi?id=1435319)
(CVE-2018-12381)

Opened 7 years ago
Closed 7 years ago

# Dragging an email from Outlook into a Firefox tab redirects to malicious site

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Dragging an email from Outlook into a Firefox tab redirects to malicious site

## Categories

### (Core :: DOM: Navigation, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Navigation#DOM%3A%20Navigation)

DOM: Navigation
▾

Core :: DOM: Navigation
For bugs with HTML’s [navigate](https://html.spec.whatwg.org/multipage/browsing-the-web.html#navigate) algorithm and browsing contexts.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Navigation&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Navigation)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

57 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Windows

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla62

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix) |
| firefox-esr60 | [62+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=62%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox60 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix) |
| firefox61 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix) |
| firefox62 | [+](/buglist.cgi?f1=cf_tracking_firefox62&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 |  | wontfix |
| firefox-esr60 | 62+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox60 |  | wontfix |
| firefox61 |  | wontfix |
| firefox62 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jana.squires, Assigned: Gijs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/507ec89c0ac55e2729065638cf3caf17?d=mm&size=40)  [jana.squires](/user_profile?user_id=611252)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

18 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1467804](/show_bug.cgi?id=1467804 "RESOLVED DUPLICATE - Outlook drag and drop initiates redirect to malicious websites"), [1480734](/show_bug.cgi?id=1480734 "RESOLVED DUPLICATE - Dragging an email from Outlook and dropping it to Firefox results in an automated opening of a (malicious) web page")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-low, Whiteboard: [post-critsmash-triage][adv-main62+][adv-esr60.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2018-12381

[Keywords:](/describekeywords.cgi)

[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[post-critsmash-triage][adv-main62+][adv-esr60.2+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#c39 "7 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a13616895_488993 "7 years ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

```
There are two problems here:

1) dropping an email from the Outlook application on Windows gets interpreted as a URL of the outlook mail columns

2) fromsubjectreceivedsizecategories.com is a malicious site taking advantage of this and needs to get blocked.

Getting SafeBrowsing to block the site would mitigate this particular instance, but we're not having much success there. Besides there might be other apps (or a localized Outlook?) that result in different text that gets Firefox to open a different domain that bad people will then domain-squat on in a similar way.
```

## Attachments

### (6 files, 1 obsolete file)

| [Malicious site with Freifox.jpg](/attachment.cgi?id=8947914)  [7 years ago](#c0)  [Jana](/user_profile?user_id=611252)   1.72 MB, image/jpeg |  | [Details](/attachment.cgi?id=8947914&action=edit) |
| --- | --- | --- |
| [malicious site.png](/attachment.cgi?id=8953211)  [7 years ago](#c3)  [Jana](/user_profile?user_id=611252)   97.53 KB, image/png |  | [Details](/attachment.cgi?id=8953211&action=edit) |
| [HTML file to show dropped items](/attachment.cgi?id=8984726)  [7 years ago](#c13)  [Tooru Fujisawa [:arai]](/user_profile?user_id=310076)   2.11 KB, text/html |  | [Details](/attachment.cgi?id=8984726&action=edit) |
| [drag-drop-test results.png](/attachment.cgi?id=8985148)  [7 years ago](#c20)  [Richard Stewart](/user_profile?user_id=619054)   46.23 KB, image/png |  | [Details](/attachment.cgi?id=8985148&action=edit) |
| [Don't fix up protocols for tab-separated content](/attachment.cgi?id=8985175)  [7 years ago](#c24)  [:Gijs (he/him)](/user_profile?user_id=159069)   1.41 KB, patch | bzbarsky : [feedback+](#c31 "7 years ago")  arai : [feedback+](#c26 "7 years ago") | [Details](/attachment.cgi?id=8985175&action=edit) | [Diff](/attachment.cgi?id=8985175&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8985175) |
| [Patch](/attachment.cgi?id=8986141)  [7 years ago](#c33)  [:Gijs (he/him)](/user_profile?user_id=159069)   2.24 KB, patch | valentin : [review+](#a11816198_415378 "7 years ago")  RyanVM : [approval-mozilla-esr60+](#c44 "7 years ago") | [Details](/attachment.cgi?id=8986141&action=edit) | [Diff](/attachment.cgi?id=8986141&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141) |
| [Add tests](/attachment.cgi?id=8986142)  [7 years ago](#c34)  [:Gijs (he/him)](/user_profile?user_id=159069)   4.02 KB, patch | valentin : [review+](#c36 "7 years ago") | [Details](/attachment.cgi?id=8986142&action=edit) | [Diff](/attachment.cgi?id=8986142&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986142) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1435319#c0)• 7 years ago |
|  | |

Attached image
[Malicious site with Freifox.jpg](attachment.cgi?id=8947914)
— [Details](attachment.cgi?id=8947914&action=edit)

User Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10\_12\_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36
Steps to reproduce:
1. Open Outlook 2016 on a Windows device
2. Drag an email from Outlook, and drop it in a Firefox tab
Actual results:
1. Firefox then redirects to <http://www.fromsubjectreceivedsizecategories.com/>
2. That site in turns redirects to various malicious sites - an example is attached
3. The behaviour continues despite disabling the inline auto-complete option. See <http://kb.mozillazine.org/Inline_autocomplete>
Note that the first site is a combination of the column headers in Outlook.
Also note that I'm unable to reproduce this behaviour with Chrome or IE on Windows, or with Chrome, Firefox and Safari on Mac OSX.
Tested with only Firefox version 57.0.4
Expected results:
Firefox should not auto-complete the drag and drop from Outlook.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1435319#c1)• 7 years ago |
|  | |

Can't open your image, there are errors in it (at least on my system -- maybe it's a variant .jpg format?)
The autocomplete option (if it still works -- that's an old article) would only apply to typing in a URL. Drag and drop is a different mechanism. There's no autocomplete, you're dropping the actual content. If the content you drop is a link to a web page we'll open that page. That page can then do whatever a web page can do that you've browsed to on the web or opened by clicking on a link elsewhere. Redirecting is one of those things.
We can report malicious sites to the SafeBrowsing service, so they get blocked. Otherwise I'm not sure what else here is a Firefox security bug.Flags: needinfo?(jana.squires)

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1435319#c2)• 7 years ago |
|  | |

Hi Daniel,
Thanks for your feedback.
To clarify: This behaviour is reproduced with any email that's dragged from Outlook, and into a tab in Firefox.
The site that Firefox tries to navigate to is fromsubjectreceivedsizecategories[.]com/. This is based on the default column headings within Outlook.
I've been able to reproduce the behaviour today using Outlook 2016 (Windows) and Firefox 58.01 (Windows).
I drag any email onto a page of a Firefox tab, an invalid page loads using then drag and drop mechanism, then navigation to the malicious site begins in a second tab. Note it doesn't matter which email I use, the navigation to the aforementioned site is the same.
Are you able to test the behaviour as well?
Regards,
- JanaFlags: needinfo?(jana.squires)

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1435319#c3)• 7 years ago |
|  | |

Attached image
[malicious site.png](attachment.cgi?id=8953211)
— [Details](attachment.cgi?id=8953211&action=edit)

Example of what loaded when I was initially testing the behaviour.

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1435319#c4)• 7 years ago |
|  | |

Comment on [attachment 8953211](/attachment.cgi?id=8953211 "malicious site.png") [[details]](/attachment.cgi?id=8953211&action=edit "malicious site.png")
malicious site.png
Note that that the browser first attempts to connect to fromsubjectreceivedsizecategories[.]com and then may be redirected to another random site with a malicious payload - as per the attachment here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1435319#c5)• 7 years ago |
|  | |

Francois: do we have any mechanism to block sites when tracking protection is OFF (the default)? I believe Firefox is correctly interpreting the outlook content, but some scammer has obtained this domain that must be a default embedded in the format.
I've reported it to safebrowsing as well.Status: UNCONFIRMED → NEWComponent: Untriaged → SecurityEver confirmed: trueFlags: needinfo?(francois)

|  | [François Marier [:francois]](/user_profile?user_id=303427) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1435319#c6)• 7 years ago |
|  | |

Yes, we have the plugin blocklist: <https://github.com/mozilla-services/shavar-plugin-blocklist/blob/master/mozplugin-block.txt>
This list actually applies to any network loads, not just Flash loads.
It's controlled by browser.safebrowsing.blockedURIs.enabled and is default ON.Flags: needinfo?(francois)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1435319#c7)• 7 years ago |
|  | |

I reported this site to the safebrowsing people and it's still not blocked. Can we add it to our own list? This site does nothing good. At best you end up on Amazon with a referral link so these jerks make money. Using a Mac I quite often get stuck on a "tech support" scam site that locks up the browser using various eviltraps and I have to kill the child process to escape.Flags: needinfo?(francois)

|  | [François Marier [:francois]](/user_profile?user_id=303427) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1435319#c8)• 7 years ago |
|  | |

You're talking about <http://www.fromsubjectreceivedsizecategories.com/>?
As you point out, it's not flagged by Google: <https://transparencyreport.google.com/safe-browsing/search?url=http:%2F%2Fwww.fromsubjectreceivedsizecategories.com%2F>
In terms of adding it to our own blacklist, I'll need to check with Marshall. We have never had our own malware/phishing blacklist, so I need to make sure we can actually do this from a policy/legal point of view.Flags: needinfo?(francois) → needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1435319#c9)• 7 years ago |
|  | |

Someone has gamed Google's system: "No unsafe content found". There's nothing there except a navigation to various \_other\_ sites that are unsafe or deceptive, but the bad stuff isn't on that site so it gets a pass? The sites it navigated to kept changing so it'd be hard to report all those and get them all.Flags: needinfo?(dveditz)

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1435319#c10)• 7 years ago |
|  | |

Thanks all for investigating this.
Just want a reminder that during my tests I wasn't able to replicate this on Chrome or IE - only on Firefox.
Admittedly I didn't test it with any other browsers. However it does relate to the way Firefox handles drag and drops into tabs. Is there a way to disable that process in the configuration?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1435319#c11)• 7 years ago |
|  | |

There are two problems here:
1) dropping an email from the Outlook application on Windows gets interpreted as a URL of the outlook mail columns. Why are we trying to interpret mail as anything? It's possible Outlook is tagging their drag content incorrectly, but other browsers seem to have made allowances for that if that's the case.
2) fromsubjectreceivedsizecategories.com is a malicious site taking advantage of this and needs to get blocked.
Getting SafeBrowsing to block the site would mitigate this particular instance, but we're not having much success there so we should look into #1. Besides there might be other apps (or a localized Outlook?) that result in different text that gets Firefox to open a different domain that bad people will then domain-squat on in a similar way.Group: firefox-core-security → dom-core-securityUser Story: (updated)Component: Security → Drag and DropFlags: needinfo?(haftandilian)OS: Unspecified → WindowsProduct: Firefox → Core

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1435319#c13)• 7 years ago |
|  | |

Attached file
[HTML file to show dropped items](attachment.cgi?id=8984726)
— [Details](attachment.cgi?id=8984726&action=edit)

unfortunately I don't have outlook 2016 right now.
can anyone perform the following operation to tell me what kind of data is dropped?
1. open the attached file in Firefox 60.0.2, or newer, (or maybe on 58.0.1 if there's any different behavior)
(the file listens to the drop event and shows dropped item's data)
2. drag and drop an email from outlook 2016 to "Drag and drop items here." text in the page
3. copy and paste the whole displayed text into a new text file
4. upload the text file here

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1435319#c14)• 7 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

> 1) dropping an email from the Outlook application on Windows gets
> interpreted as a URL of the outlook mail columns. Why are we trying to
> interpret mail as anything?
If the dropped item doesn't contain "text/uri-list" or "text/moz-list" flavor, but "text/plain" flavor, Firefox tries to interpret every line in the text as URI.
while intepreting, it performs fixup (just like when some word is entered in the location bar),
and it can make some possibly-non-URI to URI (which might explain the long domain).
[bug 1435910](/show_bug.cgi?id=1435910 "RESOLVED FIXED - Dragging multiple lines of text to the tab bar creates multiple tabs") changed this behavior a bit in Firefox 60, and now if there's any absolutely-non-URI line, entire text is treated as a single search term, so it won't open any URI interpreted from the text.
So, the behavior could be different between Firefox 58.0.1 and 60.0.2, and might already be \*fixed\* now.
but anyway I'd like to confirm how this happened, in term of the dropped text content, so the result for the [comment #13](/show_bug.cgi?id=1435319#c13 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site") is welcome.

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1435319#c15)• 7 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

(In reply to Tooru Fujisawa [:arai] from [comment #14](/show_bug.cgi?id=1435319#c14 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> If the dropped item doesn't contain "text/uri-list" or "text/moz-list"
"text/uri-list" or "text/x-moz-url"

|  | [Richard Stewart](/user_profile?user_id=619054) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1435319#c17)• 7 years ago |
|  | |

(In reply to François Marier [:francois] from [comment #8](/show_bug.cgi?id=1435319#c8 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> You're talking about <http://www.fromsubjectreceivedsizecategories.com/>?
>
> As you point out, it's not flagged by Google:
> <https://transparencyreport.google.com/safe-browsing/search?url=http>:
> %2F%2Fwww.fromsubjectreceivedsizecategories.com%2F
>
> In terms of adding it to our own blacklist, I'll need to check with
> Marshall. We have never had our own malware/phishing blacklist, so I need to
> make sure we can actually do this from a policy/legal point of view.
Did you ever check with Marshall on policy/legal aspects of adding this to the plugin blocklist? I nearly got caught out by this but luckily for me the corporate web content filtering saved me. Others aren't won't have such protections and I'm surprised issue has been hanging around for 4 months despite this being actively exploited. While it might not be the most elegant solution, adding the URL to the plugin blocklist may well mitigate the vulnerability for the vast majority of people.

|  | [Haik Aftandilian [:haik]](/user_profile?user_id=558190) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1435319#c18)• 7 years ago |
| obsolete | |

| Comment hidden (obsolete) |  |
| --- | --- |

(In reply to Daniel Veditz [:dveditz] from [comment #11](/show_bug.cgi?id=1435319#c11 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> There are two problems here:
>
> 1) dropping an email from the Outlook application on Windows gets
> interpreted as a URL of the outlook mail columns. Why are we trying to
> interpret mail as anything? It's possible Outlook is tagging their drag
> content incorrectly, but other browsers seem to have made allowances for
> that if that's the case.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1435319#c19)• 7 years ago |
|  | |

(In reply to Tooru Fujisawa [:arai] from [comment #13](/show_bug.cgi?id=1435319#c13 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> Created [attachment 8984726](/attachment.cgi?id=8984726 "HTML file to show dropped items") [[details]](/attachment.cgi?id=8984726&action=edit "HTML file to show dropped items")
> HTML file to show dropped items
>
> unfortunately I don't have outlook 2016 right now.
>
> can anyone perform the following operation to tell me what kind of data is
> dropped?
> 1. open the attached file in Firefox 60.0.2, or newer, (or maybe on 58.0.1
> if there's any different behavior)
> (the file listens to the drop event and shows dropped item's data)
> 2. drag and drop an email from outlook 2016 to "Drag and drop items here."
> text in the page
> 3. copy and paste the whole displayed text into a new text file
> 4. upload the text file here
Richard or Jana, given your comments - are you able to perform these steps?Flags: needinfo?(richard.j.stewart)Flags: needinfo?(jana.squires)

|  | [Richard Stewart](/user_profile?user_id=619054) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1435319#c20)• 7 years ago |
|  | |

Attached image
[drag-drop-test results.png](attachment.cgi?id=8985148)
— [Details](attachment.cgi?id=8985148&action=edit)

Here's a screenshot of the result of the drag and drop test as requestedFlags: needinfo?(richard.j.stewart)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1435319#c21)• 7 years ago |
|  | |

Thank you for checking!
So, apparently those words are separated with TAB character, which is somehow removed while fixing up.
(so, it's considered to be an URI inside ContentAreaDropListener.prototype.\_addLinksFromItem, and actually fixed up while opening it)
let flags = Ci.nsIURIFixup.FIXUP\_FLAG\_FIX\_SCHEME\_TYPOS |
Ci.nsIURIFixup.FIXUP\_FLAG\_ALLOW\_KEYWORD\_LOOKUP;
let info = Services.uriFixup.getFixupURIInfo("From\tSubject", flags);
console.log(info.fixedURI.spec);
I'll look into the Services.uriFixup implementation.
(IMO, TAB should be treated in the same way as SPACE, which isn't get removed)
then, I misremembered about the current behavior:
<https://searchfox.org/mozilla-central/rev/d544b118e26422877108c42723b26e9bb4539721/dom/base/contentAreaDropListener.js#70-76>
so, the issue is still happening on nightly.Flags: needinfo?(jana.squires)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1435319#c22)• 7 years ago |
|  | |

(In reply to Tooru Fujisawa [:arai] from [comment #21](/show_bug.cgi?id=1435319#c21 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> Thank you for checking!
>
> So, apparently those words are separated with TAB character, which is
> somehow removed while fixing up.
> (so, it's considered to be an URI inside
> ContentAreaDropListener.prototype.\_addLinksFromItem, and actually fixed up
> while opening it)
>
> let flags = Ci.nsIURIFixup.FIXUP\_FLAG\_FIX\_SCHEME\_TYPOS |
> Ci.nsIURIFixup.FIXUP\_FLAG\_ALLOW\_KEYWORD\_LOOKUP;
> let info = Services.uriFixup.getFixupURIInfo("From\tSubject", flags);
> console.log(info.fixedURI.spec);
>
> I'll look into the Services.uriFixup implementation.
> (IMO, TAB should be treated in the same way as SPACE, which isn't get
> removed)
This is essentially a result of the URL specification, not fixup - `new URL("<http://foo\tbar>")` produces a URL object instead of null.
I guess when we prefix `http` ( inside <https://dxr.mozilla.org/mozilla-central/rev/75a32b57132f8cba42779555662a057a0416a313/docshell/base/nsDefaultURIFixup.cpp#366> ) then we could in principle check if there are tab characters in the input and bail out if so. That seems hacky though, also because they could be in the query string or similar (rather than the hostname) where the current behavior is probably correct.
(FWIW, this probably wants moving back to a frontend component, or maybe Core :: Document Navigation if we think we should indeed fix this inside the URI fixup code, which in any case should probably be moved to toolkit at some point...)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11304353_310076)• 7 years ago |

Flags: needinfo?(arai.unmht)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1435319#c23)• 7 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #22](/show_bug.cgi?id=1435319#c22 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> I guess when we prefix `http` ( inside
> <https://dxr.mozilla.org/mozilla-central/rev/>
> 75a32b57132f8cba42779555662a057a0416a313/docshell/base/nsDefaultURIFixup.
> cpp#366 ) then we could in principle check if there are tab characters in
> the input and bail out if so. That seems hacky though, also because they
> could be in the query string or similar (rather than the hostname) where the
> current behavior is probably correct.
>
> (FWIW, this probably wants moving back to a frontend component, or maybe
> Core :: Document Navigation if we think we should indeed fix this inside the
> URI fixup code, which in any case should probably be moved to toolkit at
> some point...)
I think that we should probably address this in nsDefaultURIFixup, although it's not easy.
Some strings like domain.tld resemble a URL a bit, so it's OK to fix them up, but From\tSubject really doesn't, so we should be a bit more strict in this regard. "Does it look like a URL" is more difficult for computers than humans, but I think we can do better.
Indeed, the URL code strips some whitespace characters, but that flexibility is mostly to improve webcompat and to make things easier for developers. When we get weird stuff from other sources, we should try to avoid surprises.

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1435319#c24)• 7 years ago |
|  | |

Attached patch

[Don't fix up protocols for tab-separated content](attachment.cgi?id=8985175&action=diff) (obsolete)
— [Details](attachment.cgi?id=8985175&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8985175)

I'm not really convinced by this approach, but I assume it fixes the issue here.
I actually think that fixing up by ignoring tabs is probably the user-friendly thing to do in general. The combination with dnd to the result that we get here is unfortunate, but fixing only the dnd consumer would feel wrong because it would leave other issues with e.g. copy/paste (or "Paste and Go").
Arai, Boris, what do you think?Assignee: nobody → gijskruitbosch+bugs
[Attachment #8985175](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") -
Flags: feedback?(bzbarsky)
[Attachment #8985175](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") -
Flags: feedback?(arai.unmht)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11309696_159069)• 7 years ago |

Assignee: gijskruitbosch+bugs → nobody

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1435319#c25)• 7 years ago |
|  | |

(In reply to Valentin Gosu [:valentin] from [comment #23](/show_bug.cgi?id=1435319#c23 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> Indeed, the URL code strips some whitespace characters, but that flexibility
> is mostly to improve webcompat and to make things easier for developers.
I... continue to find this very strange. Anyway, this is not the best place to have that particular discussion.
> When we get weird stuff from other sources, we should try to avoid surprises.
I mean, we do the inverse (but also wrong) thing in e.g. [https://bugzilla.mozilla.org/show\_bug.cgi?id=1460097](/show_bug.cgi?id=1460097 "VERIFIED FIXED - Hidden character in pasted url gets wrongly interpreted") in that we don't remove enough whitespace when humans try to load content. Fixup is \*meant\* to take things that are barely URLs and make them into URLs. That's part of why I'm conflicted (see [comment #24](/show_bug.cgi?id=1435319#c24 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site") - fwiw, I hadn't seen your comment when I wrote/posted the patch...)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1435319#c26)• 7 years ago |
|  | |

Comment on [attachment 8985175](/attachment.cgi?id=8985175 "Don't fix up protocols for tab-separated content") [[details]](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") [[diff]](/attachment.cgi?id=8985175&action=diff "Don't fix up protocols for tab-separated content") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8985175)
Don't fix up protocols for tab-separated content
Review of [attachment 8985175](/attachment.cgi?id=8985175 "Don't fix up protocols for tab-separated content") [[details]](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") [[diff]](/attachment.cgi?id=8985175&action=diff "Don't fix up protocols for tab-separated content") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8985175):
-----------------------------------------------------------------
Thanks!
So, this solves the case that there are at least 3 columns (so there are 2 TABs between them) in the mail listing,
which would match default case and most usecases, I think?
if there's no existing testcase that fails with this change (so, no known case that we should handle otherwise), I think this is reasonable fix for this bug.
the another solution would be, do not add prefix/suffix if there's at least one whitespaces in between non-whitespace characters of given text.
the possible case I can think of which there's whitespaces inside the input URL is, when the URL is copied from somewhere else that wrapped the URL with extra whitespaces. so at least suffix should already be there (let me know if there's another case).
this bug's case is troublesome because we add ".com" to non-hostname thing.
we could be more careful/strict when to treat the given text as possible partial hostname.
<https://searchfox.org/mozilla-central/rev/d544b118e26422877108c42723b26e9bb4539721/docshell/base/nsDefaultURIFixup.cpp#569-585>
::: docshell/base/nsDefaultURIFixup.cpp
@@ +365,5 @@
> + // or the flags passed might not let us).
> + rv = NS\_OK;
> + // Avoid fixing up content that looks like tab-separated values (more than 1 \t).
> + auto firstTab = uriString.FindChar('\t');
> + if (firstTab == kNotFound || uriString.RFindChar('\t') == firstTab) {
I guess it's better adding a static function with descriptive name (like, MaybeTabSeparatedValues, or something like that?),
also, it should be better handling leading/trailing TABs as well.
currently leading/trailing SPACEs are removed here, but TABs are kept:
<https://searchfox.org/mozilla-central/rev/d544b118e26422877108c42723b26e9bb4539721/docshell/base/nsDefaultURIFixup.cpp#150-151>
if there are only multiple leading/trailing TABs in the given text (like, "\t\tmozilla.com\t\t\t", it's now treated as non-URL.
So, this should test that there are at least 1 TAB sequence in the middle of non-TAB text.
[Attachment #8985175](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") -
Flags: feedback?(arai.unmht) → feedback+

|  | [Haik Aftandilian [:haik]](/user_profile?user_id=558190) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11356683_558190)• 7 years ago |

Flags: needinfo?(haftandilian)

|  | [Tooru Fujisawa [:arai]](/user_profile?user_id=310076) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11356911_310076)• 7 years ago |

Flags: needinfo?(arai.unmht)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1435319#c27)• 7 years ago |
|  | |

Jana/Richard, out of interest, what do you \*expect\* / \*want\* from dragging an email to the Firefox tab?Flags: needinfo?(richard.j.stewart)Flags: needinfo?(jana.squires)

|  | [Jana](/user_profile?user_id=611252)  Reporter |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1435319#c28)• 7 years ago |
|  | |

I don't want anything to happen per se. Instead, it was merely an observation stumbled upon when attempting to add attach an email to a Jira ticket. Instead of dropping it in the ticket, it was dropped in the tab area; which then created a connection to the malicious url.Flags: needinfo?(jana.squires)

|  | [Richard Stewart](/user_profile?user_id=619054) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1435319#c29)• 7 years ago |
|  | |

Same here. I intended to drop an email as a msg file but that's not what outlook gives Firefox. As long as people don't get redirected to a random malicious site I think that's acceptable.Flags: needinfo?(richard.j.stewart)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1435319#c30)• 7 years ago |
|  | |

For links in web pages, the reason we have to deal with tabs is stuff like this:
<a href="<http://foo.bar.com/foo/>
baz.html">Stuff</a>
Where the indent after the linebreak includes tabs.
It's not clear what should happen if we get a string like that sent to us from an external app...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1435319#c31)• 7 years ago |
|  | |

Comment on [attachment 8985175](/attachment.cgi?id=8985175 "Don't fix up protocols for tab-separated content") [[details]](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") [[diff]](/attachment.cgi?id=8985175&action=diff "Don't fix up protocols for tab-separated content") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8985175)
Don't fix up protocols for tab-separated content
Seems reasonable to me....
[Attachment #8985175](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") -
Flags: feedback?(bzbarsky) → feedback+

|  | [François Marier [:francois]](/user_profile?user_id=303427) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1435319#c32)• 7 years ago |
|  | |

Dan, did you use one of the forms on <https://wiki.mozilla.org/Security/Safe_Browsing#Links> to report the malicious domain to Google? If so, which one?Flags: needinfo?(dveditz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11813274_159069)• 7 years ago |

Assignee: nobody → gijskruitbosch+bugsStatus: NEW → ASSIGNED

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1435319#c33)• 7 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=8986141&action=diff)
— [Details](attachment.cgi?id=8986141&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141)

Valentin, bz is out, could you review this?
Dan, can you add a rating? For me the redirects point to a page that heavily suggests downloading some malware - but doesn't do anything to keep you there / stop you closing the tab. So I don't think this is severe enough to warrant sec-high/sec-crit and therefore sec-approval, but if you disagree I can fill out the form... :-)
[Attachment #8985175](/attachment.cgi?id=8985175&action=edit "Don't fix up protocols for tab-separated content") -
Attachment is obsolete: true
[Attachment #8986141](/attachment.cgi?id=8986141&action=edit "Patch") -
Flags: review?(valentin.gosu)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1435319#c34)• 7 years ago |
|  | |

Attached patch

[Add tests](attachment.cgi?id=8986142&action=diff)
— [Details](attachment.cgi?id=8986142&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986142)

Not sure if we want to land this separately, but just in case, separate patch for the tests.
I got a bit frustrated with the xpcshell lack of messaging about deciphering what:
0:01.62 FAIL do\_single\_test\_run - [do\_single\_test\_run : 619] false == true
actually meant, so I added some more messages to the tests to make them easier to read. Even without that though, this is enough of a not-a-bullseye that I think we could probably land them at the same time. It's pretty hard to go from this patch (change how we handle \t in URI fixup) to "you should drag emails or other tab-separated content to places to land on malicious pages".
[Attachment #8986142](/attachment.cgi?id=8986142&action=edit "Add tests") -
Flags: review?(valentin.gosu)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11814045_159069)• 7 years ago |

Component: Drag and Drop → Document Navigation

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1435319#c35)• 7 years ago |
|  | |

Comment on [attachment 8986141](/attachment.cgi?id=8986141 "Patch") [[details]](/attachment.cgi?id=8986141&action=edit "Patch") [[diff]](/attachment.cgi?id=8986141&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141)
Patch
Review of [attachment 8986141](/attachment.cgi?id=8986141 "Patch") [[details]](/attachment.cgi?id=8986141&action=edit "Patch") [[diff]](/attachment.cgi?id=8986141&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141):
-----------------------------------------------------------------
::: docshell/base/nsDefaultURIFixup.cpp
@@ +133,4 @@
> return false;
> }
>
> +// Assume that 1 tab is accidental, but more than 2 implies this is
Self-nit: more than 1
@@ +135,5 @@
>
> +// Assume that 1 tab is accidental, but more than 2 implies this is
> +// supposed to be tab-separated content.
> +static bool
> +MaybeTabSeparatedContent(const nsCString& aStringURI)
I would have used nsACString, but RFindChar doesn't exist there... :-(

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a11816198_415378)• 7 years ago |

[Attachment #8986141](/attachment.cgi?id=8986141&action=edit "Patch") -
Flags: review?(valentin.gosu) → review+

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1435319#c36)• 7 years ago |
|  | |

Comment on [attachment 8986142](/attachment.cgi?id=8986142 "Add tests") [[details]](/attachment.cgi?id=8986142&action=edit "Add tests") [[diff]](/attachment.cgi?id=8986142&action=diff "Add tests") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986142)
Add tests
Review of [attachment 8986142](/attachment.cgi?id=8986142 "Add tests") [[details]](/attachment.cgi?id=8986142&action=edit "Add tests") [[diff]](/attachment.cgi?id=8986142&action=diff "Add tests") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986142):
-----------------------------------------------------------------
::: docshell/test/unit/test\_nsDefaultURIFixup\_info.js
@@ +600,4 @@
> // Both APIs should then also be using the same spec.
> Assert.equal(!!fixupURIOnly, !!URIInfo.preferredURI);
> if (fixupURIOnly)
> + Assert.equal(fixupURIOnly.spec, URIInfo.preferredURI.spec, "Fixed and preferred URI should match");
Nit: also add braces since we're here :)
[Attachment #8986142](/attachment.cgi?id=8986142&action=edit "Add tests") -
Flags: review?(valentin.gosu) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1435319#c37)• 7 years ago |
|  | |

(In reply to François Marier [:francois] from [comment #32](/show_bug.cgi?id=1435319#c32 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> Dan, did you use one of the forms on <https://wiki.mozilla.org/Security/Safe_Browsing#Links>
I used the malware one, and I might have also used the phishing one just in case I guessed wrong about how Google would categorize it.
I'm guessing sec-low for the rating because Firefox ought to be robust in the face of a malicious site since there's any number of ways users can stumble into one. But depending on what site comes up and what users /thought/ they were doing by dragging the mail our behavior might contribute to social engineering attacks.Flags: needinfo?(dveditz)Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1435319#c38)• 7 years ago |
|  | |

remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/b58c103b639f29520c952137cd607148e2b01675>
remote: <https://hg.mozilla.org/integration/mozilla-inbound/rev/34fc2ff698c3796600e79073daa6011f24aecc06>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1435319#c39)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/b58c103b639f>
<https://hg.mozilla.org/mozilla-central/rev/34fc2ff698c3>Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 7 years ago
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix)
[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fixed)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)Flags: in-testsuite+Resolution: --- → FIXEDTarget Milestone: --- → mozilla62

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a13616895_488993)• 7 years ago |

Flags: qe-verify-Whiteboard: [post-critsmash-triage]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1435319#c40)• 7 years ago |
|  | |

I'm kinda-sorta wondering if we want to take this on ESR60 or not given the attack vector involved. It grafts cleanly. Thoughts?Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1435319#c41)• 7 years ago |
|  | |

Comment on [attachment 8986141](/attachment.cgi?id=8986141 "Patch") [[details]](/attachment.cgi?id=8986141&action=edit "Patch") [[diff]](/attachment.cgi?id=8986141&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141)
Patch
(In reply to Ryan VanderMeulen [:RyanVM] from [comment #40](/show_bug.cgi?id=1435319#c40 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> I'm kinda-sorta wondering if we want to take this on ESR60 or not given the
> attack vector involved. It grafts cleanly. Thoughts?
Sounds reasonable to me. We have decent automated test coverage here, and this has been sitting on beta for a while now without (AFAIK) complaints.
[Approval Request Comment] (for both bugs)
If this is not a sec:{high,crit} bug, please state case for ESR consideration: workaround-ish fix for issue with workflows that may be particularly prevalent on ESR
User impact if declined: potential scam site access
Fix Landed on Version: 61
Risk to taking this patch (and alternatives if risky): low. Small patch on code that has decent unit tests.
String or UUID changes made by this patch: none.
See <https://wiki.mozilla.org/Release_Management/ESR_Landing_Process> for more info.Flags: needinfo?(gijskruitbosch+bugs)
[Attachment #8986141](/attachment.cgi?id=8986141&action=edit "Patch") -
Flags: approval-mozilla-esr60?

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1435319#c42)• 7 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #41](/show_bug.cgi?id=1435319#c41 "RESOLVED FIXED - Dragging an email from Outlook into a Firefox tab redirects to malicious site"))
> [Approval Request Comment] (for both bugs)
both \*attachments\*. Sigh. Need my tea in the morning before commenting on bugs, clearly...

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1435319#c44)• 6 years ago |
|  | |

Comment on [attachment 8986141](/attachment.cgi?id=8986141 "Patch") [[details]](/attachment.cgi?id=8986141&action=edit "Patch") [[diff]](/attachment.cgi?id=8986141&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1435319&attachment=8986141)
Patch
Fixes a sec issue with links dragged from Outlook (which seems more likely in managed environments that are also more likely to be running an ESR), well baked on 62, and includes new tests. Approved for ESR 60.2.
[Attachment #8986141](/attachment.cgi?id=8986141&action=edit "Patch") -
Flags: approval-mozilla-esr60? → approval-mozilla-esr60+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1435319#c45)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/a77d0de5ad22>
<https://hg.mozilla.org/releases/mozilla-esr60/rev/e7a80ca1acc6>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)
[tracking-firefox62](/buglist.cgi?f1=cf_tracking_firefox62&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox62&o1=equals&v1=%2B)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [62+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=62%2B)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a17195046_280903)• 6 years ago |

Whiteboard: [post-critsmash-triage] → [post-critsmash-triage][adv-main62+][adv-esr60.2+]

|  | [:Gijs (he/him)](/user_profile?user_id=159069)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1435319#c46)• 6 years ago |
|  | |

(In reply to Robert Neumann from [bug 1480734 comment #1](/show_bug.cgi?id=1480734#c1 "RESOLVED DUPLICATE - Dragging an email from Outlook and dropping it to Firefox results in an automated opening of a (malicious) web page"))
> The exact same issue was discussed in this very old article:
>
> <https://www.silverspider.com/2007/from-subject-received-size-categories/>
Seems like this is already public, should we unhide the bug here? Dan?Flags: needinfo?(dveditz)

|  | [Robert Neumann](/user_profile?user_id=621993) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1435319#c47)• 6 years ago |
|  | |

We had a quick blog on it a few weeks back as well.
<https://www.forcepoint.com/blog/security-labs/subject-received%E2%80%A6what>
Better transparency at this point might be reasonable.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a17261117_1689)• 6 years ago |

Group: core-security-releaseFlags: needinfo?(dveditz)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1435319#a17300359_280903)• 6 years ago |

Alias: CVE-2018-12381
You need to [log in](/show_bug.cgi?id=1435319&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jana](/user_profile?user_id=611252)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_70f0f8aa_20250126_064951.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1412081)
* [XML](/show_bug.cgi?ctype=xml&id=1412081)

Closed
[Bug 1412081](/show_bug.cgi?id=1412081)

Opened 7 years ago
Closed 7 years ago

# ([CVE-2017-16541](https://www.cve.org/CVERecord?id=CVE-2017-16541)) Proxy bypass caused by autofs on Mac, Linux

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

(CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux

## Categories

### (Core :: Networking: File, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20File#Networking%3A%20File)

Networking: File
▾

Core :: Networking: File
For bugs in Mozilla's File IO code. This component deals with File specific issues like writing to disk, reading local files, etc Related problems with file:// protocol may also be addressed here.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20File&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20File&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20File)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla63

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr52 | [-](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix) |
| firefox-esr60 | [62+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=62%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) |
| firefox56 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix) |
| firefox57 | [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix) |
| firefox58 | [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix) |
| firefox59 | [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix) |
| firefox60 | [-](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=-) | [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix) |
| firefox61 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix) |
| firefox62 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fixed) |
| firefox63 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr52 | - | wontfix |
| firefox-esr60 | 62+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox56 |  | wontfix |
| firefox57 | + | wontfix |
| firefox58 | + | wontfix |
| firefox59 | + | wontfix |
| firefox60 | - | wontfix |
| firefox61 |  | wontfix |
| firefox62 |  | fixed |
| firefox63 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: arthur, Assigned: valentin, NeedInfo)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=40)  [valentin](/user_profile?user_id=415378)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=40)  [arthur](/user_profile?user_id=474980)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

NeedInfo From:

 [arthur](/user_profile?user_id=474980)

[7 years ago](#c114)

[NeedInfo:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#needinfo)

Update

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

38 people

## References

### ( [URL](https://pearlcrescent.com/tor/am.html "https://pearlcrescent.com/tor/am.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb"), [1483377](/show_bug.cgi?id=1483377 "RESOLVED FIXED - Use static array for sWhitelist instead of StaticAutoPtr")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1412081&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1412081)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[pearlcrescent.com/tor/am.html](https://pearlcrescent.com/tor/am.html "https://pearlcrescent.com/tor/am.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb")

## Details

### (Keywords: csectype-disclosure, privacy, sec-moderate, Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+]

QA Whiteboard:

---

Has STR:

yes

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 6 obsolete files)

| [0001-Test-for-bug-1412081.patch](/attachment.cgi?id=8922957)  [7 years ago](#c27)  [Georg Koppen](/user_profile?user_id=349211)   1.90 KB, patch |  | [Details](/attachment.cgi?id=8922957&action=edit) | [Diff](/attachment.cgi?id=8922957&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8922957) |
| --- | --- | --- |
| [WIP-patch-and-gtest](/attachment.cgi?id=8979286)  [7 years ago](#c65)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   18.04 KB, patch |  | [Details](/attachment.cgi?id=8979286&action=edit) | [Diff](/attachment.cgi?id=8979286&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286) |
| [patch](/attachment.cgi?id=8985964)  [7 years ago](#c68)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   17.75 KB, patch | mayhemer : [review+](#c70 "7 years ago") | [Details](/attachment.cgi?id=8985964&action=edit) | [Diff](/attachment.cgi?id=8985964&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964) |
| [patch](/attachment.cgi?id=8986314)  [7 years ago](#c72)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   27.29 KB, patch |  | [Details](/attachment.cgi?id=8986314&action=edit) | [Diff](/attachment.cgi?id=8986314&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986314) |
| [patch](/attachment.cgi?id=8986337)  [7 years ago](#c76)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   27.55 KB, patch |  | [Details](/attachment.cgi?id=8986337&action=edit) | [Diff](/attachment.cgi?id=8986337&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337) |
| [[ESR60] patch](/attachment.cgi?id=8986493)  [7 years ago](#c82)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   28.91 KB, patch |  | [Details](/attachment.cgi?id=8986493&action=edit) | [Diff](/attachment.cgi?id=8986493&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986493) |
| [[ESR60] patch](/attachment.cgi?id=8986596)  [7 years ago](#c87)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   29.70 KB, patch | bkelly : [review+](#c88 "7 years ago") | [Details](/attachment.cgi?id=8986596&action=edit) | [Diff](/attachment.cgi?id=8986596&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596) |
| [Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms](/attachment.cgi?id=8990057)  [7 years ago](#c92)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   1.27 KB, patch | jimm : [review+](#a22377217_279663 "7 years ago")  lizzard : [approval-mozilla-beta+](#a23057290_451704 "7 years ago")  RyanVM : [approval-mozilla-esr60+](#a24623039_75935 "6 years ago") | [Details](/attachment.cgi?id=8990057&action=edit) | [Diff](/attachment.cgi?id=8990057&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057) |
| [Add ability to blacklist file paths on Unix platforms](/attachment.cgi?id=8990058)  [7 years ago](#c93)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   27.61 KB, patch | mayhemer : [review+](#c94 "7 years ago") | [Details](/attachment.cgi?id=8990058&action=edit) | [Diff](/attachment.cgi?id=8990058&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058) |
| [Add ability to blacklist file paths on Unix platforms](/attachment.cgi?id=8993177)  [7 years ago](#c100)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   27.56 KB, patch | lizzard : [approval-mozilla-beta+](#c106 "7 years ago") | [Details](/attachment.cgi?id=8993177&action=edit) | [Diff](/attachment.cgi?id=8993177&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177) |
| [[ESR60] patch](/attachment.cgi?id=8993178)  [7 years ago](#c102)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   29.73 KB, patch | RyanVM : [approval-mozilla-esr60+](#c116 "7 years ago") | [Details](/attachment.cgi?id=8993178&action=edit) | [Diff](/attachment.cgi?id=8993178&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178) |
| [esr\_fix.patch](/attachment.cgi?id=8998347)  [6 years ago](#c120)  [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)   963 bytes, patch |  | [Details](/attachment.cgi?id=8998347&action=edit) | [Diff](/attachment.cgi?id=8998347&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8998347) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1412081#c0)• 7 years ago |
|  | |

Tor Project received a third-party report of a method for content pages to bypass the proxy. STR:
Create a web page with the following:
<head>
<link href='file:///net/12.12.12.12/a.css' rel='stylesheet'>
</head>
Run a "tcpdump port 111" on 12.12.12.12. UDP events are observed that did not pass through the browser proxy.
(A demo is at <https://pearlcrescent.com/tor/am.html>)
I also observed the same thing for <img> tags. This behavior apparently is caused by automount/autofs, which is enabled by default on macOS and installable on Linux.
More information from a colleague:
My quick test on OSX 10.12.x shows that Chrome and Safari (latest versions) are not affected.
It is also interesting that I see the following message in the browser console after the page load completes (i.e., after it gives up on the automounted file):
Security Error: Content at <https://pearlcrescent.com/tor/am.html> may not load or link to file:///net/192.168.1.43/a.css.
Access is blocked (i.e., the CSS does not load, the image does not load), but only after an attempt has been made to open the file (or maybe just traverse its path.

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1412081#c1)• 7 years ago |
|  | |

Ouch, I was able to reproduce. There seems to me to be three things going on here:
a) Why are we loading pages that will generate security errors?
b) Is an HTTP page triggering opening a file content process? If so, I think that's a bug, as those will requests will always generate security errors. (I originally thought it was, but now that I see (c) it's possible this is all happening in the sandboxed process)
c) A kernel bug on macOS that sandboxed processes are able to trigger automount, minimal reproducer:
sandbox-exec -p '(version 1) (deny default) (allow process-exec\* (path "/usr/bin/stat")) (allow file-read\* (subpath "/usr") (subpath "/System") (subpath "/private/var/db/dyld"))' /usr/bin/stat /net/12.12.12.12/a.css
I can see that triggering things in the TCP dump.

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1412081#c2)• 7 years ago |
|  | |

Arthur, do you or the original reporter want to report (c) to Apple, or shall I?

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1412081#c3)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #2](/show_bug.cgi?id=1412081#c2 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Arthur, do you or the original reporter want to report (c) to Apple, or
> shall I?
Feel free to do so.

|  | [Mark Smith [:mcs]](/user_profile?user_id=4418) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1412081#c4)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #1](/show_bug.cgi?id=1412081#c1 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Ouch, I was able to reproduce. There seems to me to be three things going on
> here:
>
> a) Why are we loading pages that will generate security errors?
For the stylesheet case at least, it seems like the security check is done after the stylesheet loader channel is created. That is probably okay for http: URLs (since creating the channel does not cause any network activity to occur in that case). But tracing through the code path underneath Loader::LoadSheet(), network activity occurs in the file:///net/... case inside the nsFileChannel constructor. Specifically, the call to IsSymlink() hits the network, which is not too surprising since it must call stat() or lstat().
I am not familiar with all of this code, but somehow the security check needs to be done earlier.

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1412081#c5)• 7 years ago |
|  | |

That analysis sounds correct to me -- a stat is enough to trigger this. ni?Cristoph who I expect knows this code well.Flags: needinfo?(ckerschb)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1412081#c6)• 7 years ago |
|  | |

The "can web pages load file urls?" is done as part of the usual security checks (CheckMayLoad, CheckLoadURI, content policies like mixed-content blocker and CSP), and given the eventual error message these are still happening. We've found a number of things recently that send extra loads that bypass those. In particular I wonder if this is some kind of preload/prefetch/preconnect speculative load from the parser that bypasses content checks on the incorrect theory "it's OK as long as we check before they end up in the document".
There are multiple prefs that turn off various preloads. Might not take too much time to diagnose whether those are involved or not.
Some of those are
network.http.speculative-parallel-limit (set to 0, though it should only be for http)
network.dns.disablePrefetch (again, file: isn't expected to need dns)
and others that appear to be turned off already, but maybe I missed one that's relevant for file: loads.URL: <https://pearlcrescent.com/tor/am.html>Group: core-security → network-core-securityHas STR: --- → yesKeywords: [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)Whiteboard: [tor] → [tor][sec-high for Tor?]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a30551_578488)• 7 years ago |

Whiteboard: [tor][sec-high for Tor?] → [tor][sec-critical for Tor]

|  | [Kate McKinley [:kmckinley, :Kate]](/user_profile?user_id=545036) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1412081#c7)• 7 years ago |
|  | |

Adding a check to CheckMayLoad, CheckLoadURI, and/or possibly CheckLoadURIWithPrincial prior to constructing the nsIChannel by calling NS\_NewChannelWithTriggeringPrincipal in Loader::LoadSheet would likely solve this issue for attempting to load file: URIs as stylesheets, but would not solve it universally, if it exists elsewhere.
Another option is to bypass the stat checking when file uris are autofs uris on MacOS and Linux, so file:///net/\*. This would fix the problem for all instances with a file uri at a possible risk of symlink confusion breaking SOP (see [bug 782581](/show_bug.cgi?id=782581 "RESOLVED FIXED - Subverting Same-Origin Policy for Local Contents by Symbolic Link")). Since that case dealt with other Android processes gaining access to sensitive content such as password and cookie databases, this may be safe to break in this one case.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1412081#c8)• 7 years ago |
|  | |

(In reply to Kate McKinley [:kmckinley, :Kate] from [comment #7](/show_bug.cgi?id=1412081#c7 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Adding a check to CheckMayLoad, CheckLoadURI, and/or possibly
> CheckLoadURIWithPrincial prior to constructing the nsIChannel by calling
> NS\_NewChannelWithTriggeringPrincipal in Loader::LoadSheet would likely solve
> this issue for attempting to load file: URIs as stylesheets, but would not
> solve it universally, if it exists elsewhere.
I think that seems a bit brittle to me. Arthur reproduced the issue with <img> tags as well.
> Another option is to bypass the stat checking when file uris are autofs uris
> on MacOS and Linux, so file:///net/\*. This would fix the problem for all
> instances with a file uri at a possible risk of symlink confusion breaking
> SOP (see [bug 782581](/show_bug.cgi?id=782581 "RESOLVED FIXED - Subverting Same-Origin Policy for Local Contents by Symbolic Link")). Since that case dealt with other Android processes
> gaining access to sensitive content such as password and cookie databases,
> this may be safe to break in this one case.
This sounds like the more promising approach to me right now.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1412081#c9)• 7 years ago |
|  | |

Okay, I tried to verify whether Linux is actually affected by this and, surprisingly, I failed so far. Here is what I did on a Debian testing machine and an Ubuntu 14.04:
1) Installed the autofs package
2) Uncommented the /net -hosts line in /etc/auto.master
3) Restarted the machine
4) Captured traffic with tcpdump/wireshark going to a website with the PoC.
5) No non-Tor traffic showed up.
I did this both in Tor Browser and vanilla Firefox (pointed to a local Tor) with different settings.
Does anybody have different steps that show Linux is affected, too?

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1412081#c10)• 7 years ago |
|  | |

(In reply to Mark Smith (:mcs) from [comment #4](/show_bug.cgi?id=1412081#c4 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> For the stylesheet case at least, it seems like the security check is done
> after the stylesheet loader channel is created.
That is the case for all of our security checks in fact. We create a channel and once we call open2() or also asyncOpen2() on the channel we perform the required security checks, because nothing should have hit the network until this point. Apparently you found a case where that's different. So your evaluation of the situation is accurate.
Since we already have the loadInfo available on the nsFileChannel we could use that information to figure out who triggered the load. I would imagine that the web never needs access to a local file and that any kind of upload scenarios (one would have to verify) are triggered by the SystemPrincipal. I hope that is the case, which would make sense. If all that is true then we could have a very hacky way of blocking. A very raw strawman patch could look like this:
--- a/netwerk/protocol/file/nsFileChannel.cpp
+++ b/netwerk/protocol/file/nsFileChannel.cpp
@@ -278,16 +278,24 @@ nsFileChannel::Init()
#ifdef XP\_WIN
nsAutoString fileTarget;
#else
nsAutoCString fileTarget;
#endif
nsCOMPtr<nsIFile> resolvedFile;
bool symLink;
nsCOMPtr<nsIFileURL> fileURL = do\_QueryInterface(mFileURI);
+
+ if (mLoadInfo->TriggeringPrincipal()->GetIsCodebasePrincipal()) {
+ // potentially we could even check for http/https if necessary
+ // I am not entirely sure if we create codebasePrincipal for something
+ // other than web these days.
+ return error;
+ }
Obviously we could also do some kind of string matching to figure out the file:///net case, but I am not sure if there are other ways to bypass that string matching.Flags: needinfo?(ckerschb)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1412081#c11)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #10](/show_bug.cgi?id=1412081#c10 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Mark Smith (:mcs) from [comment #4](/show_bug.cgi?id=1412081#c4 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > For the stylesheet case at least, it seems like the security check is done
> > after the stylesheet loader channel is created.
>
> That is the case for all of our security checks in fact. We create a channel
> and once we call open2() or also asyncOpen2() on the channel we perform the
> required security checks, because nothing should have hit the network until
> this point. Apparently you found a case where that's different. So your
> evaluation of the situation is accurate.
>
> Since we already have the loadInfo available on the nsFileChannel we could
> use that information to figure out who triggered the load. I would imagine
> that the web never needs access to a local file and that any kind of upload
> scenarios (one would have to verify) are triggered by the SystemPrincipal. I
> hope that is the case, which would make sense. If all that is true then we
> could have a very hacky way of blocking. A very raw strawman patch could
> look like this:
>
> --- a/netwerk/protocol/file/nsFileChannel.cpp
> +++ b/netwerk/protocol/file/nsFileChannel.cpp
> @@ -278,16 +278,24 @@ nsFileChannel::Init()
> #ifdef XP\_WIN
> nsAutoString fileTarget;
> #else
> nsAutoCString fileTarget;
> #endif
> nsCOMPtr<nsIFile> resolvedFile;
> bool symLink;
> nsCOMPtr<nsIFileURL> fileURL = do\_QueryInterface(mFileURI);
> +
> + if (mLoadInfo->TriggeringPrincipal()->GetIsCodebasePrincipal()) {
> + // potentially we could even check for http/https if necessary
> + // I am not entirely sure if we create codebasePrincipal for something
> + // other than web these days.
> + return error;
> + }
This looks promising. However, I am not exactly sure that we have all the necessary things ready at this point looking at ESR 52 code. It seems to me [bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") added all the changes you build upon. And backporting that one + all the dependent bugs seems unrealistic. Am I missing something (and if not what options do we have instead)?
> Obviously we could also do some kind of string matching to figure out the
> file:///net case, but I am not sure if there are other ways to bypass that
> string matching.
True. I'd rather avoid that if possible.Flags: needinfo?(ckerschb)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1412081#c12)• 7 years ago |
|  | |

Adding Filippo Cavallarin, the original bug reporter, to this bug.

|  | [Nicolas Vigier](/user_profile?user_id=435321) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1412081#c13)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #9](/show_bug.cgi?id=1412081#c9 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Okay, I tried to verify whether Linux is actually affected by this and,
> surprisingly, I failed so far. Here is what I did on a Debian testing
> machine and an Ubuntu 14.04:
I was able to reproduce the problem on Debian Jessie.
>
> 1) Installed the autofs package
> 2) Uncommented the /net -hosts line in /etc/auto.master
> 3) Restarted the machine
> 4) Captured traffic with tcpdump/wireshark going to a website with the PoC.
> 5) No non-Tor traffic showed up.
I did the same steps and I saw UDP traffic to the IP from the file:// path, on port 28416 (but not on port 111). However it only happens once, probably because the error is cached, so if I want to try it again I need to change the IP in the path.

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1412081#c14)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #11](/show_bug.cgi?id=1412081#c11 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> This looks promising. However, I am not exactly sure that we have all the
> necessary things ready at this point looking at ESR 52 code. It seems to me
> [bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") added all the changes you build upon. And backporting that one +
> all the dependent bugs seems unrealistic. Am I missing something (and if not
> what options do we have instead)?
I am adding Honza since he fixed [Bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE"). Anyway, we added the triggeringPrincipal to the loadInfo within [Bug 1083422](/show_bug.cgi?id=1083422 "RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo") [1], which landed for FF35. In other words triggeringPrincipal information on the loadinfo for subrequest loads should definitely be accurate for ESR52. I don't fully understand why the final channel URL is important to fix the problem in this bug. As I understand it, if mFileURI [2] would point to e.g. file:///net then we would hit the network at the time we call ::init on nsFileChannel, right? So I don't think [Bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") is relevant in any way for fixing this bug. But maybe I am missing something here.
[1] [https://bugzilla.mozilla.org/show\_bug.cgi?id=1083422](/show_bug.cgi?id=1083422 "RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo")
[2] <https://dxr.mozilla.org/mozilla-central/source/netwerk/protocol/file/nsFileChannel.cpp#285>Flags: needinfo?(ckerschb)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1412081#c15)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #14](/show_bug.cgi?id=1412081#c14 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Georg Koppen from [comment #11](/show_bug.cgi?id=1412081#c11 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > This looks promising. However, I am not exactly sure that we have all the
> > necessary things ready at this point looking at ESR 52 code. It seems to me
> > [bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") added all the changes you build upon. And backporting that one +
> > all the dependent bugs seems unrealistic. Am I missing something (and if not
> > what options do we have instead)?
>
> I am adding Honza since he fixed [Bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE"). Anyway, we added the
> triggeringPrincipal to the loadInfo within [Bug 1083422](/show_bug.cgi?id=1083422 "RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo") [1], which landed for
> FF35. In other words triggeringPrincipal information on the loadinfo for
> subrequest loads should definitely be accurate for ESR52. I don't fully
> understand why the final channel URL is important to fix the problem in this
> bug. As I understand it, if mFileURI [2] would point to e.g. file:///net
> then we would hit the network at the time we call ::init on nsFileChannel,
> right? So I don't think [Bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") is relevant in any way for fixing this
> bug. But maybe I am missing something here.
Thanks. You probably don't. I was just wondering how to get the proper loadInfo in the constructor and how to abort properly before we hit the UDP leak.

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1412081#c16)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #15](/show_bug.cgi?id=1412081#c15 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Thanks. You probably don't. I was just wondering how to get the proper
> loadInfo in the constructor and how to abort properly before we hit the UDP
> leak.
You can simply access the member mLoadInfo (which is the current loadinfo of the file channel). To abort the load I assume you can just return any NS\_ERROR\_\*. (Maybe NS\_ERROR\_FILE\_TARGET\_DOES\_NOT\_EXIST). I looked at other code within the ::init() function and it seems simply returning an error is all there is to do (once we exactly know what condition for aborting is).

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1412081#c17)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #16](/show_bug.cgi?id=1412081#c16 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Georg Koppen from [comment #15](/show_bug.cgi?id=1412081#c15 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > Thanks. You probably don't. I was just wondering how to get the proper
> > loadInfo in the constructor and how to abort properly before we hit the UDP
> > leak.
>
> You can simply access the member mLoadInfo (which is the current loadinfo of
> the file channel). To abort the load I assume you can just return any
> NS\_ERROR\_\*. (Maybe NS\_ERROR\_FILE\_TARGET\_DOES\_NOT\_EXIST). I looked at other
> code within the ::init() function and it seems simply returning an error is
> all there is to do (once we exactly know what condition for aborting is).
Returning an error does not work as the compiler is complaining about doing so in a constructor. And just accessing `mLoadInfo` and doing things like you did in comment:10 (i.e. `mLoadInfo->TriggeringPrincipal()->GetIsCodebasePrincipal()`) does not work as `mLoadInfo` is `null` it seems (if I am doing a `if (mLoadInfo)` the code in the if-clause is never executed). So, what did you have in mind (sorry if I am not following)?Flags: needinfo?(ckerschb)

|  | [Mark Smith [:mcs]](/user_profile?user_id=4418) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1412081#c18)• 7 years ago |
|  | |

I am not sure, but it might work to add the check suggested by Christoph to nsFileProtocolHandler::NewChannel2().

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1412081#c19)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #17](/show_bug.cgi?id=1412081#c17 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Returning an error does not work as the compiler is complaining about doing
> so in a constructor. And just accessing `mLoadInfo` and doing things like
> you did in comment:10 (i.e.
> `mLoadInfo->TriggeringPrincipal()->GetIsCodebasePrincipal()`) does not work
> as `mLoadInfo` is `null` it seems (if I am doing a `if (mLoadInfo)` the code
> in the if-clause is never executed). So, what did you have in mind (sorry if
> I am not following)?
Well, this is what I had in mind actually. The loadInfo should not be null at this point. Can we figure out why it is null? As Mark suggested, first we could check that we get the required arguments within newChannel2(). But Maybe newChannel2 is not even called and the channel is created somehow different. Further down within the ::init() method, mLoadinfo is even accessed at the moment, so I am surprised it's null.
Regarding returning the error within the ::init() method, that should work, because there is already code that does the same. Or are you really trying to do it in the constructor and not the ::init() method?Flags: needinfo?(ckerschb)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1412081#c20)• 7 years ago |
|  | |

::Init starts with NS\_ENSURE\_STATE(mLoadInfo);, which looks like it verifies that mLoadInfo is not nullptr.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1412081#c21)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #20](/show_bug.cgi?id=1412081#c20 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> ::Init starts with NS\_ENSURE\_STATE(mLoadInfo);, which looks like it verifies
> that mLoadInfo is not nullptr.
I agree but we need ESR 52 code for Tor Browser and there is no such thing in nsFileChannel.cpp.[1] I tried to work with Christoph's code there which gave me the results I mentioned in comment:17 and made me wonder in comment:15.
[1] <https://dxr.mozilla.org/mozilla-esr52/source/netwerk/protocol/file/nsFileChannel.cpp#253>

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1412081#c22)• 7 years ago |
|  | |

Ah, sorry, I missed the fact that we were talking about different versions.

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1412081#c23)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #20](/show_bug.cgi?id=1412081#c20 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> ::Init starts with NS\_ENSURE\_STATE(mLoadInfo);, which looks like it verifies
> that mLoadInfo is not nullptr.
[Bug 1319111](/show_bug.cgi?id=1319111 "RESOLVED FIXED - Expose result principal URL (\"final channel URL\") on LoadInfo, convert current consumers of LOAD_REPLACE") rearranged things like this:
instead of...
channel = new nsFileChannen(url) {
// the code we want to patch
}
channel->SetLoadInfo()
...it does...
channel = new nsFileChannel(url) : mURL(url) {}
channel->SetLoadInfo(loadinfo)
channel->Init() {
// the code we want to patch
}
you don't need to bother with the new resultPrincipalURI (not on esr52).
Regarding the codebase principal check, you should ask Boris, but I think we only use codebase principal for thing we are about to load from unknown (and potentially unsafe) uris, but we may also use codebase principal for moz-extenstion (privileged, I think).
as I understand, we later block the load in CSP. what exactly is the check doing? could we move whole check or the part of it that detects the load blocking here? to be on the safe side...

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1412081#c24)• 7 years ago |
|  | |

FWIW: I tested Christoph's patch in comment:10 in a Firefox 56 build and it solves the bug for me on Linux. I guess having a similar option for ESR 52 would be neat...

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1412081#c25)• 7 years ago |
|  | |

(In reply to Mark Smith (:mcs) from [comment #18](/show_bug.cgi?id=1412081#c18 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I am not sure, but it might work to add the check suggested by Christoph to
> nsFileProtocolHandler::NewChannel2().
Partly, yes. The problems is that we hit the newChannel() call in `nsIOService::NewChannelFromURIWithProxyFlagsInternal()` without loadFlags. I guess what we can do is do just return an error in our case if we hit that part. I've implemented that in a patch and I don't see the proxy bypass on my Linux box anymore. mcs/arthur: could you verify that on OS X as well (see the attached patch; I could not give its final version a test yet as I blew my build away accidentally and need to make a full new one but am about to be afk)? Is there anything we'd blow up by deploying this workaround?Flags: needinfo?(arthuredelstein)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1412081#c26)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #25](/show_bug.cgi?id=1412081#c25 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> see the attached patch
I don't think you attached anythingFlags: needinfo?(gk)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1412081#c27)• 7 years ago |
|  | |

Attached patch

[0001-Test-for-bug-1412081.patch](attachment.cgi?id=8922957&action=diff)
— [Details](attachment.cgi?id=8922957&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8922957)

Here comes the mentioned patch.Flags: needinfo?(gk)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1412081#c28)• 7 years ago |
|  | |

(In reply to Tom Ritter [:tjr] from [comment #26](/show_bug.cgi?id=1412081#c26 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Georg Koppen from [comment #25](/show_bug.cgi?id=1412081#c25 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > see the attached patch
>
> I don't think you attached anything
Yeah, my browser crash while uploading, sorry.Flags: needinfo?(mcs)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1412081#c29)• 7 years ago |
|  | |

Dan, would it be okay if we released a new Tor Browser with a functional workaround before this bugs gets fixed properly by being as unspecific as possible in our announcement and just including the code without any comments etc.? This is a critical issue for us.Flags: needinfo?(dveditz)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a93004_75935)• 7 years ago |

[status-firefox56](/buglist.cgi?f1=cf_status_firefox56&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox56&o1=equals&v1=wontfix)
[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected)
[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected)
[tracking-firefox57](/buglist.cgi?f1=cf_tracking_firefox57&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%3F)
[tracking-firefox58](/buglist.cgi?f1=cf_tracking_firefox58&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%3F)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F)

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1412081#c30)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #25](/show_bug.cgi?id=1412081#c25 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Mark Smith (:mcs) from [comment #18](/show_bug.cgi?id=1412081#c18 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > I am not sure, but it might work to add the check suggested by Christoph to
> > nsFileProtocolHandler::NewChannel2().
>
> Partly, yes. The problems is that we hit the newChannel() call in
> `nsIOService::NewChannelFromURIWithProxyFlagsInternal()` without loadFlags.
> I guess what we can do is do just return an error in our case if we hit that
> part. I've implemented that in a patch and I don't see the proxy bypass on
> my Linux box anymore. mcs/arthur: could you verify that on OS X as well (see
> the attached patch; I could not give its final version a test yet as I blew
> my build away accidentally and need to make a full new one but am about to
> be afk)? Is there anything we'd blow up by deploying this workaround?
I built Tor Browser alpha (based on ESR52) without and with the patch (23447a7a1b0), for OS X, and tested it as before. I can confirm that the patch stops the proxy bypass for both the CSS and <image> cases. I have also browsed to several sites with the patched version and didn't run into any problems.
Here are my branches:
<https://github.com/arthuredelstein/tor-browser-build/commit/1412081>
<https://github.com/arthuredelstein/tor-browser/commit/1412081>
Here are my builds in case anyone wants to try it:
<https://arthuredelstein.net/stuff/1412081>
And I applied the patch to the latest Firefox ESR52 and pushed to try. We'll see how it goes:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=6c475d223e9433df14c2728e7e1641b659b698be>Flags: needinfo?(arthuredelstein)

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1412081#c31)• 7 years ago |
|  | |

(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from [comment #30](/show_bug.cgi?id=1412081#c30 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> And I applied the patch to the latest Firefox ESR52 and pushed to try. We'll
> see how it goes:
> <https://treeherder.mozilla.org/#/>
> jobs?repo=try&revision=6c475d223e9433df14c2728e7e1641b659b698be
A lot of test failures turned up, so I am running the negative control (same branch minus the patch) to see which failures we can attribute to the patch:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=feaa5cdb3ccb>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1412081#c32)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #29](/show_bug.cgi?id=1412081#c29 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Dan, would it be okay if we released a new Tor Browser with a functional
> workaround before this bugs gets fixed properly
Please do!Flags: needinfo?(dveditz)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1412081#c33)• 7 years ago |
|  | |

Okay, we were about to release Tor Browser 7.0.9 with the attached workaround today but Filippo and Nicolas found ways to bypass it. So we stopped.
I don't have a URL handy to test for those new attack vectors but they seem to involve redirect mechanisms. Just pointing a victim to a php file containing:
<?php
header("Location: file:///net/evil-attacker.com/a.css");
?>
is supposed to be enough or creating an .htaccess file with the line
Redirect / file:///net/11.11.11.14/a.cssFlags: needinfo?(mcs)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1412081#c34)• 7 years ago |
|  | |

The problem seems to be that the codebase principal check is failing in the redirect case. Christoph: Do we have a different check we could use for both redirect/non-redirect cases? Just using the triggering principal one and preventing channel creation in that case already seems to be the nuclear option as it makes file:// unusable.Flags: needinfo?(ckerschb)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1412081#c35)• 7 years ago |
|  | |

Honza: Or maybe we could/should do something else for the redirect case?Flags: needinfo?(honzab.moz)

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1412081#c36)• 7 years ago |
|  | |

I made a patch that blocks redirects from http(s) to file:// URIs. I'm not sure if it's the ideal approach, but I think it might be a reasonable stopgap for Tor Browser:
<https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect>
Here's the build:
<https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg>
<https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg.asc>
(Note this doesn't include Georg's other patch. Both patches will be needed to block everything.)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a491926_269762)• 7 years ago |

Flags: needinfo?(honzab.moz)

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1412081#c37)• 7 years ago |
|  | |

Dan, under what circumstances do we want to allow an http redirect to a file? I can't think of any off the top of my head (and didn't think we ever allowed it.. but apparently that's not true.). We can certainly block it right in the http channel code if there isn't some use case to support..

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1412081#c38)• 7 years ago |
|  | |

A simple test showed that we as expected block http->file redirects. For a quick fix we could add the simple schema check as suggested in [comment 36](/show_bug.cgi?id=1412081#c36 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") to prevent creation of the file channel.
I can't think of a general check from the top of my head to do checkmayload checks prior we do stat() on the file.

|  | [Nicolas Vigier](/user_profile?user_id=435321) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1412081#c39)• 7 years ago |
|  | |

(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from [comment #36](/show_bug.cgi?id=1412081#c36 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I made a patch that blocks redirects from http(s) to file:// URIs. I'm not
> sure if it's the ideal approach, but I think it might be a reasonable
> stopgap for Tor Browser:
> <https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect>
I confirm this patch is fixing the redirect to file:// issue in a Linux build for me:
<https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz>
<https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz.asc>

|  | [Mark Smith [:mcs]](/user_profile?user_id=4418) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1412081#c40)• 7 years ago |
|  | |

At first I had trouble reproducing the HTTP redirect problem. For some reason the problem does occur reliably in the first/default tab in Tor Browser 7.0.x but I can always reproduce it in a new tab. Now I can confirm that the patch from [comment #36](/show_bug.cgi?id=1412081#c36 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") closes the HTTP redirect hole on macOS.
I wonder if there are other similar holes that need to be closed. Script-based techniques such as setting document.location seem to be caught early by existing code that calls ssm->CheckLoadURIFromScript(). I tried using a file:///net/... URL as the src for an <iframe> but that is also blocked early by existing code. I don't think FTP supports redirect to an arbitrary URL. Can anyone think of other protocols or techniques within HTTP or HTML that we should examine? I don't know what netwerk/protocol/gio does but at least that is not included in ESR52 (so it is not an immediate concern for Tor Browser).

|  | [Mark Smith [:mcs]](/user_profile?user_id=4418) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1412081#c41)• 7 years ago |
|  | |

(In reply to Mark Smith (:mcs) from [comment #40](/show_bug.cgi?id=1412081#c40 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> At first I had trouble reproducing the HTTP redirect problem. For some
> reason the problem does occur reliably in the first/default tab in Tor
> Browser 7.0.x ....
I meant to say "For some reason the problem does NOT occur reliably..." Sorry!

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1412081#c42)• 7 years ago |
|  | |

A couple of much weaker attacks I noticed:
1. The user could be induced to past file:///net/11.11.11.14/a.css into the URL bar
2. Open an html page with <img src="file:///net/11.11.11.14/a.jpg">. Now choose Page Info, click on the item for the fake image, click "Save As" and choose a location to save the file.
#1 is perhaps a concern. For #1 the most promising fix I can think of is to blacklist URLs of the form "file:///net/\*".
#2 seems unlikely to be a very useful attack vector, but perhaps it would be good to fix as well.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1412081#c43)• 7 years ago |
|  | |

(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from [comment #42](/show_bug.cgi?id=1412081#c42 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> A couple of much weaker attacks I noticed:
> 1. The user could be induced to past file:///net/11.11.11.14/a.css into the
> URL bar
> 2. Open an html page with <img src="file:///net/11.11.11.14/a.jpg">. Now
> choose Page Info, click on the item for the fake image, click "Save As" and
> choose a location to save the file.
>
> #1 is perhaps a concern. For #1 the most promising fix I can think of is to
> blacklist URLs of the form "file:///net/\*".
>
> #2 seems unlikely to be a very useful attack vector, but perhaps it would be
> good to fix as well.
Thanks for those points. Yes, those are scenarios the final patch has to address, I agree. Especially #1. I think, though, we could release an update without addressing them (I am building right now a new Tor Browser including your redirect patch as well \*fingers crossed\*).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1412081#c44)• 7 years ago |
|  | |

> I would imagine that the web never needs access to a local file
You would imagine wrong. See <http://searchfox.org/mozilla-central/rev/aa1343961fca52e8c7dab16788530da31aab7c8d/caps/nsIScriptSecurityManager.idl#129-134> for example.
> Dan, under what circumstances do we want to allow an http redirect to a file?
Again, see our explicit support for allowing some sites, controlled by prefs, to link to file:// URIs.
For the real underlying issue here, the basic problem is that file:// is so messed up, between symlinks, virtual filesystems, etc. Some specific issues with them:
1) Some of our security checks (e.g. CheckMayLoad) \_require\_ that symlinks be resolved
before a check is done, due to the fact that we treat files in the same dir as same-origin
but symlinks can cross directory boundaries. This obviously requires a stat().
2) CheckMayLoad also needs to stat() files because it needs to treat file:///foo and file:///FOO
as same-origin on case-insensitive filesystems.
3) For this bug, it sounds like CheckLoadURI needs to happen \_before\_ we ever stat() the file.
This list is clearly not exhaustive.
To fix issues around symlinks, we resolve symlinks (and hence stat() the file) immediately in nsFileChannel::Init. I urge everyone to read through [bug 670514](/show_bug.cgi?id=670514 "VERIFIED FIXED - Arbitrary File + Directory read via .lnk files on Windows Share") to see why doing it fully lazily (and not caching the stat() results) does not work. That said, we could consider doing it as part of the AsyncOpen security-check process, instead of Init(), and make sure that it happens after the CheckLoadURI call. I \_think\_ that should avoid regressing the issues from [bug 670514](/show_bug.cgi?id=670514 "VERIFIED FIXED - Arbitrary File + Directory read via .lnk files on Windows Share") while allowing us to fix this bug.
I should note that until we moved CheckLoadURI into the channel code, this was slightly less of an issue, because we did not create the channel until \_after\_ CheckLoadURI passed. I don't know whether CheckLoadURI still involved a stat() at that point or not. We would need to check whether it does one.
We definitely need to ensure that we do not ever \_read\_ the file (including for "symlink resolution" or Windows equivalent) until after CheckLoadURI passes in the cases in which reading the file is already a failure (various /dev/tty bits on Linux, Windows special files that hang or crash the process when read, etc).
> 1. The user could be induced to past file:///net/11.11.11.14/a.css into the URL bar
True. The user could also be induced to paste "touch /net/11.11.11.14/a.css" into their terminal... I think fundamentally having autofs enabled is pretty prejudicial to fully controlling your network access. :(
> Now choose Page Info, click on the item for the fake image, click "Save As" and choose a location to save the file.
Right, there's a fundamental tension here between "the page is not allowed to link there" and "the user wants to get the data"... It's worth looking at the history of whether page info ever enforced CheckLoadURI checks on the "Save As" functionality in its media tab and thinking about whether it should.

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1412081#c45)• 7 years ago |
|  | |

(In reply to Patrick McManus [:mcmanus] from [comment #37](/show_bug.cgi?id=1412081#c37 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Dan, under what circumstances do we want to allow an http redirect to a
> file? I can't think of any off the top of my head (and didn't think we ever
> allowed it.. but apparently that's not true.). We can certainly block it
> right in the http channel code if there isn't some use case to support..
Something interesting I observed is, without the patch in [comment 36](/show_bug.cgi?id=1412081#c36 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"), some UDP events are detected at the target server, but that is followed by a Security Error appearing in the web console claiming the redirect is not permitted. So it appears that the intention was already to cancel (most) redirects from http to file:///, but the cancellation happens too late to prevent some network leakage. So, in the final patch, the existing code that prevents redirects to file:/// and takes into account certain prefs as mentioned by Boris, perhaps needs to be refactored to a new location such that cancellation happens earlier.

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1412081#c46)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #34](/show_bug.cgi?id=1412081#c34 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> The problem seems to be that the codebase principal check is failing in the
> redirect case. Christoph: Do we have a different check we could use for both
> redirect/non-redirect cases? Just using the triggering principal one and
> preventing channel creation in that case already seems to be the nuclear
> option as it makes file:// unusable.
I think Boris added a bunch of very valuable information within [comment 44](/show_bug.cgi?id=1412081#c44 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"). Probably it's best we don't do stat() within ::init() but instead rather move it to asyncOpen2. Or more precisely to the contentSecurityManager right after we preform the CheckLoadURI check.Flags: needinfo?(ckerschb)

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1412081#c47)• 7 years ago |
|  | |

Tracking this for 57. It's late in the release cycle but we could still uplift for the RC build(s).
[tracking-firefox57](/buglist.cgi?f1=cf_tracking_firefox57&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox57&o1=equals&v1=%2B)
[tracking-firefox58](/buglist.cgi?f1=cf_tracking_firefox58&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%3F) → [+](/buglist.cgi?f1=cf_tracking_firefox58&o1=equals&v1=%2B)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1412081#c48)• 7 years ago |
|  | |

Apple requests that we not mention the sandbox-bypass with /net when this is resolved.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1412081#c49)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #48](/show_bug.cgi?id=1412081#c48 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Apple requests that we not mention the sandbox-bypass with /net when this is
> resolved.
Which reminds me: shouldn't such a thing get caught by the Linux sandbox as well (ideally)?

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1412081#c50)• 7 years ago |
|  | |

I would have expected it to, add :gcp to see what the deal is there.

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a871613_151147)• 7 years ago |

Flags: needinfo?(gpascutto)

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a871758_151147)• 7 years ago |

Flags: needinfo?(gpascutto)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a941200_580382)• 7 years ago |

[status-firefox57](/buglist.cgi?f1=cf_status_firefox57&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox57&o1=equals&v1=wontfix)

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1412081#c51)• 7 years ago |
|  | |

From conversation, the Linux sandbox "catches" and blocks that stat() from content, but resolving what is actually being stat() to see if it's allowed leads to the information leak happening on the chrome side. Content will be told the path is not allowed but of course by then the damage is done.
It's reasonable suspect the macOS kernel bug works along similar lines.

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a2204674_349211)• 7 years ago |

Summary: Proxy bypass caused by autofs on Mac, Linux → (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a2242534_269762)• 7 years ago |

Priority: -- → P2Whiteboard: [tor][sec-critical for Tor] → [tor][sec-critical for Tor][necko-triaged]

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a2243361_269762)• 7 years ago |

See Also: → [1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1412081#c52)• 7 years ago |
|  | |

Are there strong voices against disabling file: URI loading \*completely\* via a preference that the Tor browser could set? It would be a solution for similar [bug 1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb") too.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1412081#c53)• 7 years ago |
|  | |

Do we have UI resources that load from file:// URIs?
If we only want to disable it from web pages, seems like an extension could easily do that...

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1412081#c54)• 7 years ago |
|  | |

(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from [comment #53](/show_bug.cgi?id=1412081#c53 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Do we have UI resources that load from file:// URIs?
>
> If we only want to disable it from web pages, seems like an extension could
> easily do that...
We can substitute internally to file:// (moz-ext:, resource:, jar:?), so general disabling is not possible, right.
We want to disable only: top level loads (typing in address bar, command line, link clicks), iframes, subresources, general redirects-to, something else?
The distinction could be system principal, but I'm not sure if there can be a case of a system-principal load that is user/content-controlled and not application-controlled.

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1412081#c55)• 7 years ago |
|  | |

Apple have notified me that they believe this is fixed in the macOS 10.13.3 beta -- once that's released (they didn't provide a date) we can disclose the bypass mechanism if we like.

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a7279423_474980)• 7 years ago |

Whiteboard: [tor][sec-critical for Tor][necko-triaged] → [tor 24052][sec-critical for Tor][necko-triaged]

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1412081#c56)• 7 years ago |
|  | |

This is fixed in today's macOS 10.13.3 release.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a7690940_578488)• 7 years ago |

Assignee: nobody → arthuredelsteinPriority: P2 → P1

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1412081#c57)• 7 years ago |
|  | |

Now that this is resolved in macOS, I'd like to go about upstreaming to Firefox the improvements tor landed to refuse to access file:// resources earlier.
Arthur, is that something on your roadmap, or would it be helpful if I took that on? And if the latter, do you have a link to the patches that tor is currently applying for this?Flags: needinfo?(arthuredelstein)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1412081#c58)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #57](/show_bug.cgi?id=1412081#c57 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Now that this is resolved in macOS, I'd like to go about upstreaming to
> Firefox the improvements tor landed to refuse to access file:// resources
> earlier.
>
> Arthur, is that something on your roadmap, or would it be helpful if I took
> that on? And if the latter, do you have a link to the patches that tor is
> currently applying for this?
If you could work on this, please do. The patches are here:
<https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&id=4fbe4216456298af5c68198b3ff0f552f9bb8464>
<https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&id=a7ddff8279b931f42cccc538fc1cdd6a51c23795>
<https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&id=ab28cdb28b2e974129d141e4150f1486404cb254>
Now, those were just hacks (and a follow-up bugfix) we deployed to close the critical hole as fast as possible and they are breaking some file:// usage scenarios. I am not sure Mozilla would want those. If so, fine with us. But if you or anyone else could use this opportunity to have a real fix ready for ESR 60 that would be great!Flags: needinfo?(arthuredelstein)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a9011005_75935)• 7 years ago |

[status-firefox58](/buglist.cgi?f1=cf_status_firefox58&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox58&o1=equals&v1=wontfix)
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected)
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected)
[tracking-firefox59](/buglist.cgi?f1=cf_tracking_firefox59&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox59&o1=equals&v1=%2B)
[tracking-firefox60](/buglist.cgi?f1=cf_tracking_firefox60&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1412081#c59)• 7 years ago |
|  | |

Too late in the 59 cycle at this point.
[status-firefox59](/buglist.cgi?f1=cf_status_firefox59&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox59&o1=equals&v1=wontfix)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1412081#c60)• 7 years ago |
|  | |

This seems stalled. Alex, do you still want to look at this?
[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fix-optional)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=affected)
[tracking-firefox60](/buglist.cgi?f1=cf_tracking_firefox60&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=%2B) → [-](/buglist.cgi?f1=cf_tracking_firefox60&o1=equals&v1=-)Flags: needinfo?(agaynor)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1412081#c61)• 7 years ago |
|  | |

I was planning on it, but haven't had the cycles to. With Apple's kernel fix the priority is slightly lower since it's non-exploitable on patched macOS.Flags: needinfo?(agaynor)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1412081#c62)• 7 years ago |
|  | |

(In reply to Alex Gaynor [:Alex\_Gaynor] from [comment #61](/show_bug.cgi?id=1412081#c61 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I was planning on it, but haven't had the cycles to. With Apple's kernel fix
> the priority is slightly lower since it's non-exploitable on patched macOS.
Only for our use case. It's still a proxy bypass, so Tor is carrying an incomplete fix for this that (I think) breaks some functionality like Save t file or something similar. They're going to wind up backporting whatever we come up with to 60; so it would be good to avoid a confusing rebase for them...

|  | [Arthur Edelstein [:arthur]](/user_profile?user_id=474980)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a13128757_474980)• 7 years ago |

Assignee: arthuredelstein → nobody

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a13645933_279663)• 7 years ago |

Priority: P1 → P2

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a15112605_415378)• 7 years ago |

Assignee: nobody → valentin.gosu

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=1412081#c63)• 7 years ago |
|  | |

We are currently preparing Tor Browser based on ESR 60 and it turns out that a (critical) part of our workaround is broken now. Valentin: what's your planned timeframe for looking into this bug?Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=1412081#c64)• 7 years ago |
|  | |

I have a WIP patch based on [bug 1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb") that seems to work in blocking file access to paths based on a pref blacklist.
I will post it for review shortly, hopefully with some tests :)Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=1412081#c65)• 7 years ago |
|  | |

Attached patch

[WIP-patch-and-gtest](attachment.cgi?id=8979286&action=diff) (obsolete)
— [Details](attachment.cgi?id=8979286&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286)

This WIP patch goes on top of [attachment 8972049](/attachment.cgi?id=8972049 "v1.1") [[details]](/attachment.cgi?id=8972049&action=edit "v1.1") [[diff]](/attachment.cgi?id=8972049&action=diff "v1.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1413868&attachment=8972049). In the gtest I wrote a few ways I found to bypass the filter (which I then fixed), but there are a few others I didn't get to yet.
A few examples of paths that could be used to bypass the filter:
/./net/IP
/../../net/IP
/other/../net/IP
///net/IP

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=1412081#c66)• 7 years ago |
|  | |

Comment on [attachment 8979286](/attachment.cgi?id=8979286 "WIP-patch-and-gtest") [[details]](/attachment.cgi?id=8979286&action=edit "WIP-patch-and-gtest") [[diff]](/attachment.cgi?id=8979286&action=diff "WIP-patch-and-gtest") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286)
WIP-patch-and-gtest
Review of [attachment 8979286](/attachment.cgi?id=8979286 "WIP-patch-and-gtest") [[details]](/attachment.cgi?id=8979286&action=edit "WIP-patch-and-gtest") [[diff]](/attachment.cgi?id=8979286&action=diff "WIP-patch-and-gtest") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286):
-----------------------------------------------------------------
::: netwerk/test/gtest/TestFilePreferences.cpp
@@ +1,1 @@
> +#include "gtest/gtest.h"
should this live in xpcom?
::: xpcom/io/FilePreferences.cpp
@@ +70,5 @@
> + Unused << p.ReadUntil(Tokenizer::Token::Char(','), path);
> + if (!path.IsEmpty()) {
> + PathBlacklist().AppendElement(path);
> + }
> + } while (!p.CheckEOF());
you don't need Record()
you have to read (check) the ',' character
the loop should be `while (!p.CheckEOF()) { do stuff; }
you may want to do path.Trim() as you don't skip whitespaces

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a18038314_580382)• 7 years ago |

[status-firefox60](/buglist.cgi?f1=cf_status_firefox60&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox60&o1=equals&v1=wontfix)
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fix-optional)
[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=affected)
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=1412081#c67)• 7 years ago |
|  | |

Valentin: Do you have an updated WIP patch we could test/include in our upcoming alpha? Right now, this is the only blocker for us for switching Tor Browser to ESR 60 next week in our alpha series: We can't ship the alpha with no workaround for this (for us) critical issue given that we "fixed" it a couple of months ago with an emergency release during the ESR 52 cycle.Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=1412081#c68)• 7 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8985964&action=diff) (obsolete)
— [Details](attachment.cgi?id=8985964&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964)

[Attachment #8985964](/attachment.cgi?id=8985964&action=edit "patch") -
Flags: review?(honzab.moz)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a20293401_415378)• 7 years ago |

[Attachment #8979286](/attachment.cgi?id=8979286&action=edit "WIP-patch-and-gtest") -
Attachment is obsolete: true

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=1412081#c69)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #67](/show_bug.cgi?id=1412081#c67 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Valentin: Do you have an updated WIP patch we could test/include in our
> upcoming alpha? Right now, this is the only blocker for us for switching Tor
> Browser to ESR 60 next week in our alpha series: We can't ship the alpha
> with no workaround for this (for us) critical issue given that we "fixed" it
> a couple of months ago with an emergency release during the ESR 52 cycle.
Check out [attachment 8985964](/attachment.cgi?id=8985964 "patch") [[details]](/attachment.cgi?id=8985964&action=edit "patch") [[diff]](/attachment.cgi?id=8985964&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964). I think it's fairly final. I'm just waiting for Honza's review and writing a few more tests for it.Flags: needinfo?(valentin.gosu)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=1412081#c70)• 7 years ago |
|  | |

Comment on [attachment 8985964](/attachment.cgi?id=8985964 "patch") [[details]](/attachment.cgi?id=8985964&action=edit "patch") [[diff]](/attachment.cgi?id=8985964&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964)
patch
Review of [attachment 8985964](/attachment.cgi?id=8985964 "patch") [[details]](/attachment.cgi?id=8985964&action=edit "patch") [[diff]](/attachment.cgi?id=8985964&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964):
-----------------------------------------------------------------
giving r+ with comments only because this is high priority and I may be offline few following days. but there are things that MUST be addressed before landing. please read all the comments.
::: xpcom/io/FilePreferences.cpp
@@ +64,5 @@
> + nsAutoCString blacklist;
> + Preferences::GetCString("network.file.path\_blacklist", blacklist);
> + Tokenizer p(blacklist);
> + while (!p.CheckEOF()) {
> + nsCString path;
please use nsDependentCSubstring to save memory copying
@@ +69,5 @@
> + Unused << p.ReadUntil(Tokenizer::Token::Char(','), path);
> + path.Trim(" ");
> + if (!path.IsEmpty()) {
> + PathBlacklist().AppendElement(path);
> + }
nit: you must consume the ',' token
@@ +236,5 @@
> +bool IsAllowedPath(const nsACString& aFilePath)
> +{
> + for (const auto& prefix : PathBlacklist()) {
> + if (StringBeginsWith(aFilePath, prefix)) {
> + if (aFilePath.Length() != prefix.Length() &&
maybe a nit for better readability: aFilePath.Length() > prefix.Length()
::: xpcom/io/nsLocalFileUnix.cpp
@@ +141,5 @@
> dirPath.IsEmpty()) {
> return NS\_ERROR\_FILE\_INVALID\_PATH;
> }
>
> + // When enumerating the directory, the paths have a slash at the end.
have or don't have?
OTOH, can we even get here? few lines above you do aParent->GetNativePath(). has not the aParent object already been subjected to the check for path allowance?
@@ +329,5 @@
> + FindInReadable(NS\_LITERAL\_CSTRING("/./"), mPath) ||
> + FindInReadable(NS\_LITERAL\_CSTRING(".."), mPath) ||
> + FindInReadable(NS\_LITERAL\_CSTRING("//"), mPath)) {
> + mPath.Truncate();
> + return NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH;
OK, this can't be here. This was my main concern with the previous patch. This can potentially break things. It definitely changes behavior, is not behind the pref and definitely cannot be uplifted like this to ESR.
Move these lines INSIDE FilePreferences::IsAllowedPath and do it ONLY when there are names (prefixes) to be blacklisted or do the normalization as I do in my base patch (you will need the normalizer be a template and derive from TTokenizer<chat\_path\_t>, like #ifdef XPWIN typedef char16\_t char\_path\_t; #else typedef char char\_path\_t; #endif)
But I think this "has special dir -> throw" approach if fine when off by default.
OTOH, note that paths get here likely already normalized, at least on windows I could see that navigating to file:///c:/./././././././././././ is file://c:/ when coming to InitWithPath, no idea where that happens, but I made sure no smb request/lookup was triggered before InitWithPath was entered for file://///share uris.
hmm... we should make sure there is no code in upper layers that may look for /. or /.. in the path and call some system API normalization function that could trigger the smb/net lookup.
then, just for case, remember that ':' is a directory delimiter on osx!
@@ +576,5 @@
> + }
> +
> + if (FindInReadable(NS\_LITERAL\_CSTRING(".."), aFragment)) {
> + return NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH;
> + }
same case as above.
[Attachment #8985964](/attachment.cgi?id=8985964&action=edit "patch") -
Flags: review?(honzab.moz) → review+

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=1412081#c71)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=baa5cfd682dcd30471a5c81bb00c1fa6efdeaced>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=1412081#c72)• 7 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8986314&action=diff) (obsolete)
— [Details](attachment.cgi?id=8986314&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986314)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a20402598_415378)• 7 years ago |

[Attachment #8985964](/attachment.cgi?id=8985964&action=edit "patch") -
Attachment is obsolete: true

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=1412081#c73)• 7 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #70](/show_bug.cgi?id=1412081#c70 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Comment on [attachment 8985964](/attachment.cgi?id=8985964 "patch") [[details]](/attachment.cgi?id=8985964&action=edit "patch") [[diff]](/attachment.cgi?id=8985964&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964)
> > + while (!p.CheckEOF()) {
> > + nsCString path;
>
> please use nsDependentCSubstring to save memory copying
I kept it nsCString to be able to still do path.Trim(" ")
Since this only happens once, at startup, the extra number of copies should be minimal.
> > + // When enumerating the directory, the paths have a slash at the end.
> have or don't have?
Changed it to must have.
> OTOH, can we even get here? few lines above you do
> aParent->GetNativePath(). has not the aParent object already been subjected
> to the check for path allowance?
Yes, but that depends on the blacklisted path. If the parent name is /folder and we blacklisted /folder/ it will not match, but all of its children will.
>
> @@ +329,5 @@
> > + FindInReadable(NS\_LITERAL\_CSTRING("/./"), mPath) ||
> > + FindInReadable(NS\_LITERAL\_CSTRING(".."), mPath) ||
> > + FindInReadable(NS\_LITERAL\_CSTRING("//"), mPath)) {
> > + mPath.Truncate();
> > + return NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH;
>
> OK, this can't be here. This was my main concern with the previous patch.
> This can potentially break things. It definitely changes behavior, is not
> behind the pref and definitely cannot be uplifted like this to ESR.
Fair enough. Note that I kept some of the changes in AppendRelativeNativePath:
Append('.') does nothing.
Append('..') throws NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH just like the windows implementation, and as specified in nsIFile.idl
I think the fact that it was accepted was a bug.
> Move these lines INSIDE FilePreferences::IsAllowedPath and do it ONLY when
> there are names (prefixes) to be blacklisted or do the normalization as I do
> in my base patch (you will need the normalizer be a template and derive from
> TTokenizer<chat\_path\_t>, like #ifdef XPWIN typedef char16\_t char\_path\_t;
> #else typedef char char\_path\_t; #endif)
I made the Normalizer a template instead.
We now build the fileBlacklist code on windows too, even though it does nothing.
> But I think this "has special dir -> throw" approach if fine when off by
> default.
>
> OTOH, note that paths get here likely already normalized, at least on
> windows I could see that navigating to file:///c:/./././././././././././ is
> file://c:/ when coming to InitWithPath, no idea where that happens, but I
> made sure no smb request/lookup was triggered before InitWithPath was
> entered for file://///share uris.
I think this is done in nsLocalFile::Normalize().
However, on Linux it performs a call to the system realpath, which resolves relative paths and also links.
> then, just for case, remember that ':' is a directory delimiter on osx!
I think this was in older OSX versions (from what I can find on Google).
> @@ +576,5 @@
> > + }
> > +
> > + if (FindInReadable(NS\_LITERAL\_CSTRING(".."), aFragment)) {
> > + return NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH;
> > + }
>
> same case as above.
I'll keep this one around (to fix nsIFile.idl inconsistency) unless it breaks some tests.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=1412081#c74)• 7 years ago |
|  | |

Try run:
<https://treeherder.mozilla.org/#/jobs?repo=try&revision=96829d5130514aa993137ca87611f1c93309db82>
Georg, let me know if the attached patch is OK.
Note that it depends on Honza's patch from [bug 1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb").
A few notes about the patch:
In order to block file access to "/net" you should add a pref (name:"network.file.path\_blacklist", value:"/net")
It does have one weakness: symlinks. For a given symlink A that is not blacklisted it is impossible to know if its target B is blacklisted or not.Flags: needinfo?(gk)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=1412081#c75)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=0e7ccac3062adac2b2959a8daa2f59af71443adc>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=1412081#c76)• 7 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=8986337&action=diff)
— [Details](attachment.cgi?id=8986337&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a20410016_415378)• 7 years ago |

[Attachment #8986314](/attachment.cgi?id=8986314&action=edit "patch") -
Attachment is obsolete: true

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=1412081#c77)• 7 years ago |
|  | |

(In reply to Valentin Gosu [:valentin] from [comment #73](/show_bug.cgi?id=1412081#c73 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > > + if (FindInReadable(NS\_LITERAL\_CSTRING(".."), aFragment)) {
> > > + return NS\_ERROR\_FILE\_UNRECOGNIZED\_PATH;
> > > + }
> >
> > same case as above.
>
> I'll keep this one around (to fix nsIFile.idl inconsistency) unless it
> breaks some tests.
Turns out it broke some tests. :)
test\_bug1056939.js tested files that contained .. in them.
test\_file\_equality.js checks that appending . gives you a different file.
I filed [bug 1469737](/show_bug.cgi?id=1469737 "NEW") for this.
I also fixed the nsTArray\_base leak at shutdown.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=1412081#c78)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=5c8aa5f4c6462af988a474d2df1878764d896dfe>

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=1412081#c79)• 7 years ago |
|  | |

(In reply to Valentin Gosu [:valentin] from [comment #74](/show_bug.cgi?id=1412081#c74 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Try run:
> <https://treeherder.mozilla.org/#/>
> jobs?repo=try&revision=96829d5130514aa993137ca87611f1c93309db82
>
> Georg, let me know if the attached patch is OK.
Do you have one rebased against ESR60 handy by chance? I get a bunch of conflicts in FilePreferences.cpp when trying to apply your patch. I'll try to resolve them but I am a bit nervous about the correctness of the result.
> Note that it depends on Honza's patch from [bug 1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb").
>
> A few notes about the patch:
> In order to block file access to "/net" you should add a pref
> (name:"network.file.path\_blacklist", value:"/net")
> It does have one weakness: symlinks. For a given symlink A that is not
> blacklisted it is impossible to know if its target B is blacklisted or not.
What does that mean in practise? If an attacker is pointing to symlink A the proxy bypass we try to avoid is getting triggered?Flags: needinfo?(gk) → needinfo?(valentin.gosu)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=1412081#c80)• 7 years ago |
|  | |

This is too late for ESR52 at this point (we've already built the 52.9.0 RC and that's the last scheduled release for that branch). We still want this for Fx62 & ESR 60.2, though.
[status-firefox61](/buglist.cgi?f1=cf_status_firefox61&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=fix-optional) → [wontfix](/buglist.cgi?f1=cf_status_firefox61&o1=equals&v1=wontfix)
[status-firefox-esr52](/buglist.cgi?f1=cf_status_firefox_esr52&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr52&o1=equals&v1=wontfix)
[tracking-firefox-esr52](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=%3F) → [-](/buglist.cgi?f1=cf_tracking_firefox_esr52&o1=equals&v1=-)
[tracking-firefox-esr60](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=%3F) → [62+](/buglist.cgi?f1=cf_tracking_firefox_esr60&o1=equals&v1=62%2B)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=1412081#c81)• 7 years ago |
|  | |

(In reply to Georg Koppen from [comment #79](/show_bug.cgi?id=1412081#c79 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> (In reply to Valentin Gosu [:valentin] from [comment #74](/show_bug.cgi?id=1412081#c74 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> > Try run:
> > <https://treeherder.mozilla.org/#/>
> > jobs?repo=try&revision=96829d5130514aa993137ca87611f1c93309db82
> >
> > Georg, let me know if the attached patch is OK.
>
> Do you have one rebased against ESR60 handy by chance? I get a bunch of
> conflicts in FilePreferences.cpp when trying to apply your patch. I'll try
> to resolve them but I am a bit nervous about the correctness of the result.
I'll try to rebase it.
> > Note that it depends on Honza's patch from [bug 1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb").
> >
> > A few notes about the patch:
> > In order to block file access to "/net" you should add a pref
> > (name:"network.file.path\_blacklist", value:"/net")
> > It does have one weakness: symlinks. For a given symlink A that is not
> > blacklisted it is impossible to know if its target B is blacklisted or not.
>
> What does that mean in practise? If an attacker is pointing to symlink A the
> proxy bypass we try to avoid is getting triggered?
It means that if the attacker can create a symlink that points to B, or if the attacker is aware of A that points to B, they could potentially bypass the filter. That seems unlikely to me, but it's important to keep in mind.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=1412081#c82)• 7 years ago |
|  | |

Attached patch

[[ESR60] patch](attachment.cgi?id=8986493&action=diff) (obsolete)
— [Details](attachment.cgi?id=8986493&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986493)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=1412081#c83)• 7 years ago |
|  | |

Georg, here is ESR patch. I have yet to build it on Windows, but it passes all the test on Linux.
Also it seems I didn't properly fix the shutdown leak.Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=1412081#c84)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=9e2cb28aacca889ca1bab1d4db917322fcd831c7>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=1412081#c85)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=3d99658ef575ab815ff16d5683d4d564367b0b11>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=1412081#c86)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=ac637b5788987c614efb97cbc6e08c065172b831>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=1412081#c87)• 7 years ago |
|  | |

Attached patch

[[ESR60] patch](attachment.cgi?id=8986596&action=diff) (obsolete)
— [Details](attachment.cgi?id=8986596&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596)

The build selftest failed because the pref needed to be added to the early list
[Attachment #8986596](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") -
Flags: review?(bkelly)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a20486747_415378)• 7 years ago |

[Attachment #8986493](/attachment.cgi?id=8986493&action=edit "[ESR60]  patch") -
Attachment is obsolete: true

|  | [Ben Kelly [:bkelly, not reviewing]](/user_profile?user_id=465500) |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=1412081#c88)• 7 years ago |
|  | |

Comment on [attachment 8986596](/attachment.cgi?id=8986596 "[ESR60]  patch") [[details]](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8986596&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596)
[ESR60] patch
Review of [attachment 8986596](/attachment.cgi?id=8986596 "[ESR60]  patch") [[details]](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8986596&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596):
-----------------------------------------------------------------
I only reviewed the ContentPrefs.cpp file. It looked like the rest of the patch had already been reviewed elsewhere in this bug.
[Attachment #8986596](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") -
Flags: review?(bkelly) → review+

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=1412081#c89)• 7 years ago |
|  | |

(In reply to Valentin Gosu [:valentin] from [comment #87](/show_bug.cgi?id=1412081#c87 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Created [attachment 8986596](/attachment.cgi?id=8986596 "[ESR60]  patch") [[details]](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8986596&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596)
> [ESR60] patch
>
> The build selftest failed because the pref needed to be added to the early
> list
That one works for us, thanks so much! (The one you pointed me to in comment:83 still shows the problem. It took me a while to figure out what was going on :) )
I am not sure about the symlink issue yet. While I am not worried about the attacker being able to create a symlink I feel it should not be possible for arbitrary (third-party) web content to trigger any proxy bypass in case the user has told the browser "hey, for any web-related traffic, please use proxy $foo", irrespective of how the machine of the user outside of the browser is configured. This does not block our alpha release, but we should think about it while we progress towards getting Tor Browser 8 into stable shape.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=1412081#c90)• 7 years ago |
|  | |

Nathan, can you take a look at [attachment 8986337](/attachment.cgi?id=8986337 "patch") [[details]](/attachment.cgi?id=8986337&action=edit "patch") [[diff]](/attachment.cgi?id=8986337&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337) ?
I'm leaking an nsTArray\_base, sBlacklist, and I'm not exactly sure I'm using StaticAutoPtr correctly.
I've confirmed it's not sWhitelist by commenting it out: <https://treeherder.mozilla.org/#/jobs?repo=try&revision=064c72d8511a3fa831cef3282fb75930ad6acf93&selectedJob=184200087>
Any idea why this leak is happening? Thanks!

|  | [Nathan Froyd [:froydnj]](/user_profile?user_id=417288) |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=1412081#c91)• 7 years ago |
|  | |

Talking to Valentin over IRC turned up two potential scenarios for sBlacklist to leak:
a) InitPrefs possibly getting called after sBlacklist has been released:
<https://hg.mozilla.org/try/rev/7fb190786695#l1.49>
So we're re-initializing prefs after shutdown...which seems quite unlikely.
b) Some sort of race in IsAllowedPath:
<https://hg.mozilla.org/try/rev/145bf576adf9#l1.358>
T1: In IsAllowedPath, check for the presence of sBlacklist
T1: sBlacklist is there, proceed
T2: clear sBlacklist as we're going through shutdown
T1: Call PathBlacklist, which re-allocates sBlacklist and leaks
This race is plausible in [attachment 8986337](/attachment.cgi?id=8986337 "patch") [[details]](/attachment.cgi?id=8986337&action=edit "patch") [[diff]](/attachment.cgi?id=8986337&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337) (though we really should have some checking in the ClearOnShutdown machinery to catch this sort of thing), but the try push actually changes things in IsAllowedPath:
<https://hg.mozilla.org/try/file/5c706ce50459/xpcom/io/FilePreferences.cpp#l267>
so that we don't try reallocating...but in that case, we should hit some sort of null pointer dereference if the race was really happening.
I tried getting a handle on where the allocated nsTArray\_base was coming from, but the debugging infrastructure we had for that blew up in my face.
So now I'm not sure where the leak is coming from. =/

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=1412081#c92)• 7 years ago |
|  | |

Attached patch

[Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms](attachment.cgi?id=8990057&action=diff)
— [Details](attachment.cgi?id=8990057&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057)

This call gated by ifdef OS\_WIN - so on Linux it would leak objects that were supposed to be ClearOnShutdown in the plugin process
[Attachment #8990057](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") -
Flags: review?(jmathies)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=1412081#c93)• 7 years ago |
|  | |

Attached patch

[Add ability to blacklist file paths on Unix platforms](attachment.cgi?id=8990058&action=diff) (obsolete)
— [Details](attachment.cgi?id=8990058&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058)

[Attachment #8990058](/attachment.cgi?id=8990058&action=edit "Add ability to blacklist file paths on Unix platforms") -
Flags: review?(honzab.moz)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=1412081#c94)• 7 years ago |
|  | |

Comment on [attachment 8990058](/attachment.cgi?id=8990058 "Add ability to blacklist file paths on Unix platforms") [[details]](/attachment.cgi?id=8990058&action=edit "Add ability to blacklist file paths on Unix platforms") [[diff]](/attachment.cgi?id=8990058&action=diff "Add ability to blacklist file paths on Unix platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058)
Add ability to blacklist file paths on Unix platforms
Review of [attachment 8990058](/attachment.cgi?id=8990058 "Add ability to blacklist file paths on Unix platforms") [[details]](/attachment.cgi?id=8990058&action=edit "Add ability to blacklist file paths on Unix platforms") [[diff]](/attachment.cgi?id=8990058&action=diff "Add ability to blacklist file paths on Unix platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058):
-----------------------------------------------------------------
::: xpcom/io/FilePreferences.cpp
@@ +10,2 @@
> #include "mozilla/Preferences.h"
> +#include "mozilla/StaticPtr.h"
when you are here, can you please incorporate [1] here? just the #include. thanks. or, maybe it belongs to the header?
[1] <https://bugzilla.mozilla.org/attachment.cgi?id=8986398&action=diff#a/xpcom/io/FilePreferences.cpp_sec2>
@@ +120,5 @@
> }
>
> + bool Get(nsTSubstring<TChar>& aNormalizedFilePath)
> + {
> + aNormalizedFilePath.Truncate();
there probably wasn't a need to inline this, but as this is static, it doesn't matter
@@ +269,5 @@
> + return true;
> + }
> +
> + nsTAutoString<char\_path\_t> normalized;
> + if (!Normalizer<char\_path\_t>(aFilePath, Normalizer<char\_path\_t>::Token::Char(kPathSeparator)).Get(normalized)) {
don't you want TNormalizer<T> and then then `typedef TNormalizer<char\_path\_t> Normalizer;` ?
::: xpcom/io/nsLocalFileUnix.cpp
@@ +1048,4 @@
>
> // check to make sure that we have a new parent
> nsAutoCString newPathName;
> rv = GetNativeTargetPathName(aNewParent, aNewName, newPathName);
we may want to check before this call
@@ +2199,4 @@
>
> // check to make sure that we have a new parent
> nsAutoCString newPathName;
> rv = GetNativeTargetPathName(aNewParentDir, aNewName, newPathName);
as well here?
[Attachment #8990058](/attachment.cgi?id=8990058&action=edit "Add ability to blacklist file paths on Unix platforms") -
Flags: review?(honzab.moz) → review+

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=1412081#c95)• 7 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #94](/show_bug.cgi?id=1412081#c94 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> don't you want TNormalizer<T> and then then `typedef
> TNormalizer<char\_path\_t> Normalizer;` ?
Great suggestion, Thanks!
> ::: xpcom/io/nsLocalFileUnix.cpp
> > rv = GetNativeTargetPathName(aNewParent, aNewName, newPathName);
>
> we may want to check before this call
> > rv = GetNativeTargetPathName(aNewParentDir, aNewName, newPathName);
>
> as well here?
Before these calls we have CHECK\_mPath which checks FilePreferences::IsAllowedPath()

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a22377217_279663)• 7 years ago |

[Attachment #8990057](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") -
Flags: review?(jmathies) → review+

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 96](/show_bug.cgi?id=1412081#c96)• 7 years ago |
|  | |

<https://hg.mozilla.org/integration/mozilla-inbound/rev/9ec0f327c5efc38970c090015eaf11a7e5c450b7>
[Bug 1412081](/show_bug.cgi?id=1412081 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") - Add ability to blacklist file paths on Unix platforms r=mayhemer
<https://hg.mozilla.org/integration/mozilla-inbound/rev/26163df1083ea2847022e60518ab973360b9d7c1>
[Bug 1412081](/show_bug.cgi?id=1412081 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") - Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms r=jimm

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 97](/show_bug.cgi?id=1412081#c97)• 7 years ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/9ec0f327c5ef>
<https://hg.mozilla.org/mozilla-central/rev/26163df1083e>Group: network-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 7 years ago
[status-firefox63](/buglist.cgi?f1=cf_status_firefox63&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox63&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → mozilla63

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 98](/show_bug.cgi?id=1412081#c98)• 7 years ago |
|  | |

(In reply to Christoph Kerschbaumer [:ckerschb] from [comment #46](/show_bug.cgi?id=1412081#c46 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I think Boris added a bunch of very valuable information within [comment 44](/show_bug.cgi?id=1412081#c44 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux").
> Probably it's best we don't do stat() within ::init() but instead rather
> move it to asyncOpen2. Or more precisely to the contentSecurityManager right
> after we preform the CheckLoadURI check.
I'm late to this particular party, but should we perhaps still pursue this in a follow-up bug as a belt-and-suspenders type mitigation in case attackers find another type of path that somehow leaks information in this way? Christoph?Flags: needinfo?(ckerschb)

|  | [Julien Cristau [:jcristau]](/user_profile?user_id=580382) |  |
| --- | --- | --- |
| [Comment 99](/show_bug.cgi?id=1412081#c99)• 7 years ago |
|  | |

Mind requesting uplift to beta/esr60?Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 100](/show_bug.cgi?id=1412081#c100)• 7 years ago |
|  | |

Attached patch

[Add ability to blacklist file paths on Unix platforms](attachment.cgi?id=8993177&action=diff)
— [Details](attachment.cgi?id=8993177&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a22910887_415378)• 7 years ago |

[Attachment #8990058](/attachment.cgi?id=8990058&action=edit "Add ability to blacklist file paths on Unix platforms") -
Attachment is obsolete: true

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 101](/show_bug.cgi?id=1412081#c101)• 7 years ago |
|  | |

<https://treeherder.mozilla.org/#/jobs?repo=try&revision=f0e7099c44c4dff51e98f623f2eb696bfd914797>

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 102](/show_bug.cgi?id=1412081#c102)• 7 years ago |
|  | |

Attached patch

[[ESR60] patch](attachment.cgi?id=8993178&action=diff)
— [Details](attachment.cgi?id=8993178&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 103](/show_bug.cgi?id=1412081#c103)• 7 years ago |
|  | |

Comment on [attachment 8993177](/attachment.cgi?id=8993177 "Add ability to blacklist file paths on Unix platforms") [[details]](/attachment.cgi?id=8993177&action=edit "Add ability to blacklist file paths on Unix platforms") [[diff]](/attachment.cgi?id=8993177&action=diff "Add ability to blacklist file paths on Unix platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177)
Add ability to blacklist file paths on Unix platforms
Approval Request Comment
[Feature/Bug causing the regression]:
TOR requirement to block access to certain paths on the filesystem
[User impact if declined]:
A website could potentially anonymize a user who has autofs installed by triggering the access of certain paths in /net/ on Unix-like machines.
[Is this code covered by automated tests?]:
The patch includes a gtest
[Has the fix been verified in Nightly?]:
Yes
[Needs manual test from QE? If yes, steps to reproduce]:
Reproduce [comment 0](/show_bug.cgi?id=1412081#c0 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"). Set network.file.path\_blacklist to /net. Restart the browser. Check that the bug is fixed.
[List of other uplifts needed for the feature/fix]:
[attachment 8990057](/attachment.cgi?id=8990057 "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[details]](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[diff]](/attachment.cgi?id=8990057&action=diff "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057) to avoid leaks in the plugin process.
[Is the change risky?]:
Low risk
[Why is the change risky/not risky?]:
The patch only produces effects when the pref is set, which will probably only affect TOR.
[String changes made/needed]:
None.Flags: needinfo?(valentin.gosu)
[Attachment #8993177](/attachment.cgi?id=8993177&action=edit "Add ability to blacklist file paths on Unix platforms") -
Flags: approval-mozilla-beta?

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a22986236_415378)• 7 years ago |

[Attachment #8986596](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") -
Attachment is obsolete: true

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 104](/show_bug.cgi?id=1412081#c104)• 7 years ago |
|  | |

Comment on [attachment 8993178](/attachment.cgi?id=8993178 "[ESR60]  patch") [[details]](/attachment.cgi?id=8993178&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8993178&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178)
[ESR60] patch
[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
Required in TOR.
User impact if declined:
[TOR] A website could potentially anonymize a user who has autofs installed by triggering the access of certain paths in /net/ on Unix-like machines.
Fix Landed on Version:
Firefox 63 with an uplift requested for beta 62.
Risk to taking this patch (and alternatives if risky):
Low risk. Functionality is only enabled with the hidden pref set, which would be only in TOR.
String or UUID changes made by this patch:
None.
[Attachment #8993178](/attachment.cgi?id=8993178&action=edit "[ESR60]  patch") -
Flags: approval-mozilla-esr60?

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 105](/show_bug.cgi?id=1412081#c105)• 7 years ago |
|  | |

Hi Valentin, just a note, generally by "verified" we mean that the issue was reproducible and the fix was checked by someone who isn't the assignee or reviewer.

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a23057213_451704)• 7 years ago |

Flags: qe-verify+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Comment 106](/show_bug.cgi?id=1412081#c106)• 7 years ago |
|  | |

Comment on [attachment 8993177](/attachment.cgi?id=8993177 "Add ability to blacklist file paths on Unix platforms") [[details]](/attachment.cgi?id=8993177&action=edit "Add ability to blacklist file paths on Unix platforms") [[diff]](/attachment.cgi?id=8993177&action=diff "Add ability to blacklist file paths on Unix platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177)
Add ability to blacklist file paths on Unix platforms
Fix for potential de-anonymization, let's uplift for beta 11.
[Attachment #8993177](/attachment.cgi?id=8993177&action=edit "Add ability to blacklist file paths on Unix platforms") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Liz Henry (:lizzard) (relman/hg->git project)](/user_profile?user_id=451704) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a23057290_451704)• 7 years ago |

[Attachment #8990057](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") -
Flags: approval-mozilla-beta+

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 107](/show_bug.cgi?id=1412081#c107)• 7 years ago |
|  | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/5b05309eb9be>
<https://hg.mozilla.org/releases/mozilla-beta/rev/dd493fc5f6a7>
[status-firefox62](/buglist.cgi?f1=cf_status_firefox62&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox62&o1=equals&v1=fixed)

|  | [Oana Botisan, Desktop QA](/user_profile?user_id=599255) |  |
| --- | --- | --- |
| [Comment 108](/show_bug.cgi?id=1412081#c108)• 7 years ago |
|  | |

I didn't manage to reproduce the issue. I used an older version of Firefox (2017-10-26) on Ubuntu 16.04 x64 and macOS 10.13.
Can you please give me some more detailed steps to reproduce or a screencast with the steps?
Thank you.Flags: needinfo?(arthuredelstein)

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 109](/show_bug.cgi?id=1412081#c109)• 7 years ago |
|  | |

(In reply to Oana Botisan from [comment #108](/show_bug.cgi?id=1412081#c108 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I didn't manage to reproduce the issue. I used an older version of Firefox
> (2017-10-26) on Ubuntu 16.04 x64 and macOS 10.13.
>
> Can you please give me some more detailed steps to reproduce or a screencast
> with the steps?
> Thank you.
How did you try to reproduce this bug?Flags: needinfo?(oana.botisan)

|  | [Oana Botisan, Desktop QA](/user_profile?user_id=599255) |  |
| --- | --- | --- |
| [Comment 110](/show_bug.cgi?id=1412081#c110)• 7 years ago |
|  | |

With the steps from [comment 0](/show_bug.cgi?id=1412081#c0 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") mostly.
I used 2 different stations. One was on mac and the other on Ubuntu.
On mac I created the pref from [comment 103](/show_bug.cgi?id=1412081#c103 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") (network.file.path\_blacklist set to /net). I changed the proxy and port and I opened the link from [comment 0](/show_bug.cgi?id=1412081#c0 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") (<https://pearlcrescent.com/tor/am.html>).
On Ubuntu, I opened Firefox, changed the pref and port and then in the terminal I wrote the command "sudo tcpdump port 111".
Did I do everything wrong? Maybe I didn't understand fully what I have to do, because I got the same behaviour on the old builds as on the latest Nightly.Flags: needinfo?(oana.botisan)

|  | [Alex Gaynor [:Alex\_Gaynor]](/user_profile?user_id=537703) |  |
| --- | --- | --- |
| [Comment 111](/show_bug.cgi?id=1412081#c111)• 7 years ago |
|  | |

What version of macOS are you on?
This issue will no longer occur on 10.13.3 or newer.

|  | [Oana Botisan, Desktop QA](/user_profile?user_id=599255) |  |
| --- | --- | --- |
| [Comment 112](/show_bug.cgi?id=1412081#c112)• 7 years ago |
|  | |

I was on macOS 10.13.
But the steps were correct?

|  | [Georg Koppen](/user_profile?user_id=349211) |  |
| --- | --- | --- |
| [Comment 113](/show_bug.cgi?id=1412081#c113)• 7 years ago |
|  | |

(In reply to Oana Botisan from [comment #110](/show_bug.cgi?id=1412081#c110 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> With the steps from [comment 0](/show_bug.cgi?id=1412081#c0 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") mostly.
> I used 2 different stations. One was on mac and the other on Ubuntu.
> On mac I created the pref from [comment 103](/show_bug.cgi?id=1412081#c103 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") (network.file.path\_blacklist set
> to /net). I changed the proxy and port and I opened the link from [comment 0](/show_bug.cgi?id=1412081#c0 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux")
> (<https://pearlcrescent.com/tor/am.html>).
>
> On Ubuntu, I opened Firefox, changed the pref and port and then in the
> terminal I wrote the command "sudo tcpdump port 111".
>
> Did I do everything wrong? Maybe I didn't understand fully what I have to
> do, because I got the same behaviour on the old builds as on the latest
> Nightly.
I am not sure regarding macOS but on Linux you need to install the autofs package and uncomment the line "/net -hosts" in /etc/auto.master first as a preparation step. When testing our backport for this patch I configured Tor as a proxy (just installing Tor via your package manager should suffice and then entering 127.0.0.1:9050 as the SOCKS proxy host/port) and then looked at my local wireshark output. Hope this helps. Let me know if not.Flags: needinfo?(arthuredelstein)

|  | [Oana Botisan, Desktop QA](/user_profile?user_id=599255) |  |
| --- | --- | --- |
| [Comment 114](/show_bug.cgi?id=1412081#c114)• 7 years ago |
|  | |

I can't seem to be able to reproduce the issue, therefore I can't verify the fix. I will take out the qe+ flag.
Can you please verify to see if the bug is reproducing on the latest beta and Nightly?Flags: qe-verify+ → needinfo?(arthuredelstein)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a23634845_488993)• 7 years ago |

Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged] → [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage]

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 115](/show_bug.cgi?id=1412081#c115)• 6 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #98](/show_bug.cgi?id=1412081#c98 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> I'm late to this particular party, but should we perhaps still pursue this
> in a follow-up bug as a belt-and-suspenders type mitigation in case
> attackers find another type of path that somehow leaks information in this
> way? Christoph?
Yes, at least we should try. FWIW, I filed [Bug 1479410](/show_bug.cgi?id=1479410 "NEW - Evaluate if we can perform CheckLoadURI() checks before we ever call stat()") for that reason.Flags: needinfo?(ckerschb)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 116](/show_bug.cgi?id=1412081#c116)• 6 years ago |
|  | |

Comment on [attachment 8993178](/attachment.cgi?id=8993178 "[ESR60]  patch") [[details]](/attachment.cgi?id=8993178&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8993178&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178)
[ESR60] patch
Fixes a critical issue for Tor browser users and behavior is behind a pref not exposed to regular Firefox users. Approved for ESR 60.2.
[Attachment #8993178](/attachment.cgi?id=8993178&action=edit "[ESR60]  patch") -
Flags: approval-mozilla-esr60? → approval-mozilla-esr60+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 117](/show_bug.cgi?id=1412081#c117)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/92ff98e2731e>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 118](/show_bug.cgi?id=1412081#c118)• 6 years ago |
|  | |

Backed out from ESR60 for Linux/OSX leaks and Windows GTest failures.
<https://treeherder.mozilla.org/logviewer.html#?job_id=192445004&repo=mozilla-esr60>
<https://treeherder.mozilla.org/logviewer.html#?job_id=192444271&repo=mozilla-esr60>
<https://hg.mozilla.org/releases/mozilla-esr60/rev/1ab79799a5e9>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected)Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 119](/show_bug.cgi?id=1412081#c119)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #118](/show_bug.cgi?id=1412081#c118 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Backed out from ESR60 for Linux/OSX leaks and Windows GTest failures.
The leaks are caused by the fact that [attachment 8990057](/attachment.cgi?id=8990057 "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[details]](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[diff]](/attachment.cgi?id=8990057&action=diff "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057) should also land with the ESR patch.
Looking at the gtest failure now.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a24623039_75935)• 6 years ago |

[Attachment #8990057](/attachment.cgi?id=8990057&action=edit "Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms") -
Flags: approval-mozilla-esr60+

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 120](/show_bug.cgi?id=1412081#c120)• 6 years ago |
|  | |

Attached patch

[esr\_fix.patch](attachment.cgi?id=8998347&action=diff)
— [Details](attachment.cgi?id=8998347&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8998347)

As the comment in the patch says, the changes I made required the whitelist to be properly instantiated - which the gtest did not previously do.Flags: needinfo?(valentin.gosu)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 121](/show_bug.cgi?id=1412081#c121)• 6 years ago |
|  | |

In the future, it would be really nice if the follow-up patches were folded into the main patch for landing.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 122](/show_bug.cgi?id=1412081#c122)• 6 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #121](/show_bug.cgi?id=1412081#c121 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> In the future, it would be really nice if the follow-up patches were folded
> into the main patch for landing.
Will do. Thanks!

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 123](/show_bug.cgi?id=1412081#c123)• 6 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr60/rev/8a1e8be23bad>
<https://hg.mozilla.org/releases/mozilla-esr60/rev/6a1df03e37c9>
[status-firefox-esr60](/buglist.cgi?f1=cf_status_firefox_esr60&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr60&o1=equals&v1=fixed)

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a25217315_269762)• 6 years ago |

Depends on: [1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb")

|  | [Honza Bambas (:mayhemer)](/user_profile?user_id=269762) |  |
| --- | --- | --- |
| [Comment 124](/show_bug.cgi?id=1412081#c124)• 6 years ago |
|  | |

Valentin, there seems to be some kind of discrepancy between our code base and the tore code base on ESR60 (IIUC).
Our code (the current, latest changeset):
<https://hg.mozilla.org/releases/mozilla-esr60/annotate/8a1e8be23bad/xpcom/io/FilePreferences.cpp#l263>
Tor code:
(patch) <https://gitweb.torproject.org/user/richard/tor-browser.git/commit/xpcom/io/FilePreferences.cpp?h=bug_26874&id=50f4653b90316394e7d6d3cd4a3e92e12f377666>
(file) <https://gitweb.torproject.org/user/richard/tor-browser.git/tree/xpcom/io/FilePreferences.cpp?h=bug_26874&id=50f4653b90316394e7d6d3cd4a3e92e12f377666#n263>
Please see [https://bugzilla.mozilla.org/show\_bug.cgi?id=1413868#c70](/show_bug.cgi?id=1413868#c70 "RESOLVED FIXED - proxy bypass on windows via smb") for further details. They claim that the patches don't work and removing the |if (!sWhitelist) { return false; }| part fixes it.
It may be that AllowUNCDirectory() which ensures sWhitelist is not called from some reason.
Maybe we should change the code to block all unc paths when sWhitelist is null and sBlockUNCPaths == true?
It's hard to track what's actually correct with all the backouts and merges.
Note: <https://dxr.mozilla.org/mozilla-esr60/> is out of sync ://Flags: needinfo?(valentin.gosu)

|  | [morgan (Tor Project)](/user_profile?user_id=417117) |  |
| --- | --- | --- |
| [Comment 125](/show_bug.cgi?id=1412081#c125)• 6 years ago |
|  | |

Ok I have access now!
Yeah so the issue here is that sWhitelist is only populated after a call to PathWhitelist(). The various directories are whitelisted during firefox init (and sWhitelist is populated) in AllowUNCDirectory(char const\*) by way of InitDirectoriesWhitelist(). However, the call to PathWhitelist() does not occur until the end of AllowUNCDirectory(), and only if the directory resolves to an SMB path (ie, begins with \\). So, unless one of the special dirs live on an SMB share, sWhitelist will never be populated, and the call to IsBlockedUNCPath() will always early out due to the !sWhiteList check.
The !sWhitelist check should be removed, since the underlying pointer is never accessed directly, and always through the PathWhitelist() getter/initializer.
I've a screenshot ( here: [https://bugzilla.mozilla.org/show\_bug.cgi?id=1413868](/show_bug.cgi?id=1413868 "RESOLVED FIXED - proxy bypass on windows via smb") ) demoing the proxy bypass still exists in ESR60 on Windows 7.

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Comment 126](/show_bug.cgi?id=1412081#c126)• 6 years ago |
|  | |

(In reply to Honza Bambas (:mayhemer) from [comment #124](/show_bug.cgi?id=1412081#c124 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> Valentin, there seems to be some kind of discrepancy between our code base
> and the tore code base on ESR60 (IIUC).
I think that's because TOR landed the patch in before [comment 89](/show_bug.cgi?id=1412081#c89 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux") ([attachment 8986596](/attachment.cgi?id=8986596 "[ESR60]  patch") [[details]](/attachment.cgi?id=8986596&action=edit "[ESR60]  patch") [[diff]](/attachment.cgi?id=8986596&action=diff "[ESR60]  patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596)) and the ESR patch landed a bit later, with a few nits.
The version in m-c actually does not contain the sWhitelist thing, since the leak didn't happen on Windows, so I assume we should probably update TOR and ESR.
(In reply to Richard Pospesel (Tor Browser Dev) from [comment #125](/show_bug.cgi?id=1412081#c125 "RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"))
> The !sWhitelist check should be removed, since the underlying pointer is
> never accessed directly, and always through the PathWhitelist()
> getter/initializer.
I agree. I'll file a separate bug for it.Flags: needinfo?(valentin.gosu)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a25235399_415378)• 6 years ago |

Depends on: [1483377](/show_bug.cgi?id=1483377 "RESOLVED FIXED - Use static array for sWhitelist instead of StaticAutoPtr")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a25742059_280903)• 6 years ago |

Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage] → [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1412081#a56176711_1689)• 5 years ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1412081&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Georg Koppen](/user_profile?user_id=349211)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


