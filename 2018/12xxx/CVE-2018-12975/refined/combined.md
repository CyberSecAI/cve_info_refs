=== Content from medium.com_2e0884c2_20250125_035955.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F8de733ff8255&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40jonghyk.song%2Fcreate-legendary-champs-by-breaking-prng-of-cryptosaga-an-ethereum-rpg-game-cve-2018-12975-8de733ff8255&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40jonghyk.song%2Fcreate-legendary-champs-by-breaking-prng-of-cryptosaga-an-ethereum-rpg-game-cve-2018-12975-8de733ff8255&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Create legendary champs by breaking PRNG of Cryptosaga, an Ethereum RPG game (CVE-2018–12975)

[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:88:88/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---byline--8de733ff8255--------------------------------)

[Jonghyuk Song](/%40jonghyk.song?source=post_page---byline--8de733ff8255--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8218b7b42412&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40jonghyk.song%2Fcreate-legendary-champs-by-breaking-prng-of-cryptosaga-an-ethereum-rpg-game-cve-2018-12975-8de733ff8255&user=Jonghyuk+Song&userId=8218b7b42412&source=post_page-8218b7b42412--byline--8de733ff8255---------------------post_header-----------)

4 min read·Aug 1, 2018

--

Listen

Share

# Abstract

[Cryptosaga](https://cryptosaga.io/) is a RPG game on Ethereum blockchain. Users buy their heroes by Ethereum and fight with monsters in dungeons to level up. There are 4 classes in heroes. When a user buys a hero, the class of the hero is determined by random number. The random numbers are generated with a private variable, `block.blockhash(block.number)`, and `now`. These are all accessible by anyone, so attacker can predict the random numbers and create legendary heroes. For a better understanding, I recommend to read my previous posts[1,2,3]. There is a more detail descriptions (especially in [[1]](/%40jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-1000-guess-an-ethereum-lottery-game-7b76655f953d)).

# Details

![]()

Figure 1. a part of payWithEth() function generating heroes

![]()

Figure 2. summonHero() function

Figure 1 shows a part of `payWithEth()` function that generates heroes and Figure 2 shows `summonHero()` function. As you can see, `_heroRankToMin` is a class of hero. If `_heroRankToMin` is ‘4', a legendary hero will be generated. `_heroRankToMin` is depends on `_randomValue` which is generated by `random()` function.

![]()

Figure 3. random() function

Figure 3 shows the `random()` function. It generates random numbers by `keccak256()` function with `block.blockhash(block.number)`, `seed`, and `now`.

`block.blockhash(block.number)` is a hash of the current block. It is always ‘0’. In Solidity, `blockhash()` function is only works for 256 most recent blocks, except the current block[[4]](https://solidity.readthedocs.io/en/latest/units-and-global-variables.html).

![]()

Therefore, `keccak256(keccak256(block.blockhash(block.number), seed), now))` is same with `keccak256(keccak256(0, seed), now)`.

`seed` is a private variable that is declared at 11th among the contract storage variables. Therefore, we can access private variables like this:

```
web3.eth.StorageAt(0x6a5309dc905e85ce88f33bcd4d4d9a03ac68f847, 11)
```

Now, all we have to do is predict `now`. `now` is same with `block.timestamp`. We should know the exact timestamp to make new `seed` more than 9950.

![]()

Figure 4. a sample code to get proper ‘now’

I implemented the above code (Figure 4) to get proper `now`. The example results of the code are as follows:

![]()

Figure 5. `now` that makes `seed` more than 9950

Figure 5 shows the several `now` that makes `seed` more than 9950. It means that if our transaction is executed at the time among one of the above `now`, we can make a legendary hero. However, we cannot predict when our transaction is mined by the miner. So, we cannot decide the time when our transaction is executed by the miner. Therefore, I used internal transactions again, just like I did in [1000 Guess[1]](/%40jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-1000-guess-an-ethereum-lottery-game-7b76655f953d) and [MyCryptoChamp[3]](/%40jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-1000-guess-an-ethereum-lottery-game-7b76655f953d). I deployed a smart contract as follows:

![]()

Figure 4. The smart contract to exploit Cryptosaga

Figure 4 shows the smart contract to exploit Cryptosaga. We just call `attack()` function with `time` that we want. If `attack()` is executed at the time that we don’t want, it calls `revert()`. `attack()` only calls `payWithEth()` function when the transaction is executed at the time we want.

# Exploit

Through the exploit contract, we can create heroes at the time we want. However, it is very difficult to avoid `revert()` in the `attack()` function because the transactions should be executed at exactly the same time as the `time` I gave it as an argument. So, it requires many trials to succeed. However, luckily I succeeded in three attempts.

![]()

Figure 5. I succeeded the exploit on the third trial

Then, I got a legendary hero.

![]()

Figure 5. Legendary hero created by the exploit contract

Honestly, after the success, I tried more than 50 attempts to get more legendary heroes but I failed. It is possible attack but not easy.

# Conclusion

When you use `blockhash()`, you should always remind that it only works for 256 most recent blocks, except the current block. It will return ‘0’ when you try to use it with the current block.

# References

[1] [https://medium.com/@jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-1000-guess-an-ethereum-lottery-game-7b76655f953d](/%40jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-1000-guess-an-ethereum-lottery-game-7b76655f953d)

[2] [https://medium.com/@jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-cryptogs-an-ethereum-cve-2018-14715-f63a51ac2eb9](/%40jonghyk.song/attack-on-pseudo-random-number-generator-prng-used-in-cryptogs-an-ethereum-cve-2018-14715-f63a51ac2eb9)

[3] [https://medium.com/@jonghyk.song/get-legendary-items-by-breaking-pnrg-of-mycyptochamp-an-ethereum-online-game-cve-2018-12855-6e6beb41b8df](/%40jonghyk.song/get-legendary-items-by-breaking-pnrg-of-mycyptochamp-an-ethereum-online-game-cve-2018-12855-6e6beb41b8df)

[4] <https://solidity.readthedocs.io/en/latest/units-and-global-variables.html>

[Ethereum](/tag/ethereum?source=post_page-----8de733ff8255--------------------------------)[Blockchain](/tag/blockchain?source=post_page-----8de733ff8255--------------------------------)[Smart Contracts](/tag/smart-contracts?source=post_page-----8de733ff8255--------------------------------)[Hacking](/tag/hacking?source=post_page-----8de733ff8255--------------------------------)[Vulnerability](/tag/vulnerability?source=post_page-----8de733ff8255--------------------------------) Unlisted

--

--

[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:96:96/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---post_author_info--8de733ff8255--------------------------------)[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:128:128/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---post_author_info--8de733ff8255--------------------------------)Follow[## Written by Jonghyuk Song](/%40jonghyk.song?source=post_page---post_author_info--8de733ff8255--------------------------------)[86 Followers](/%40jonghyk.song/followers?source=post_page---post_author_info--8de733ff8255--------------------------------)·[10 Following](/%40jonghyk.song/following?source=post_page---post_author_info--8de733ff8255--------------------------------)

Vehicle Threat Research Lab. at Autocrypt . (<https://freest4r.github.io/>)

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----8de733ff8255--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----8de733ff8255--------------------------------)[About](/about?autoplay=1&source=post_page-----8de733ff8255--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----8de733ff8255--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----8de733ff8255--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----8de733ff8255--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----8de733ff8255--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----8de733ff8255--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----8de733ff8255--------------------------------)[Teams](/business?source=post_page-----8de733ff8255--------------------------------)


