=== Content from github.com_85be76e6_20250125_201217.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FopenSUSE%2Fopen-build-service%2Fcommit%2Ff57b660f49f830006766a8d4abc3b4af6e178063)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FopenSUSE%2Fopen-build-service%2Fcommit%2Ff57b660f49f830006766a8d4abc3b4af6e178063)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openSUSE%2Fopen-build-service)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openSUSE](/openSUSE)
/
**[open-build-service](/openSUSE/open-build-service)**
Public

* [Notifications](/login?return_to=%2FopenSUSE%2Fopen-build-service) You must be signed in to change notification settings
* [Fork
  442](/login?return_to=%2FopenSUSE%2Fopen-build-service)
* [Star
   946](/login?return_to=%2FopenSUSE%2Fopen-build-service)

* [Code](/openSUSE/open-build-service)
* [Issues
  985](/openSUSE/open-build-service/issues)
* [Pull requests
  139](/openSUSE/open-build-service/pulls)
* [Actions](/openSUSE/open-build-service/actions)
* [Wiki](/openSUSE/open-build-service/wiki)
* [Security](/openSUSE/open-build-service/security)
* [Insights](/openSUSE/open-build-service/pulse)

Additional navigation options

* [Code](/openSUSE/open-build-service)
* [Issues](/openSUSE/open-build-service/issues)
* [Pull requests](/openSUSE/open-build-service/pulls)
* [Actions](/openSUSE/open-build-service/actions)
* [Wiki](/openSUSE/open-build-service/wiki)
* [Security](/openSUSE/open-build-service/security)
* [Insights](/openSUSE/open-build-service/pulse)

## Commit

[Permalink](/openSUSE/open-build-service/commit/f57b660f49f830006766a8d4abc3b4af6e178063)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Ignore a project link in BsRequestAction.check\_action\_permission!

[Browse files](/openSUSE/open-build-service/tree/f57b660f49f830006766a8d4abc3b4af6e178063)
Browse the repository at this point in the history

```
This makes sure that we check the permissions of the correct package. For
instance, assume that the project "Staging" is a link project where the
link points to the "Base" project. Also, assume that there exists a
"Base/foo" package, but there exists no explicit "Staging/foo" package.
Moreover, assume we check the permissions for the following "submit"
action:

<action type="submit">
  <source project="Staging" package="foo"/>
  <target project="an_arbitrary_project" package="foo"/>
</action>

In this case, the old code checks if request acceptor can modify the
"Base/foo" package (since it follows the project link). This is wrong
because the "Staging/foo" package would be turned into a branch during
accept.
The new code checks the correct package because it does not follow the
project link and requires that the source package exists in the source
project. Requiring the existence of the source package potentially
breaks artificial requests (for instance, a request where the "submit"
action from above is preceded by a "submit" action that creates a
"Staging/foo" package).

Note: so far I was unable to exploit the old code - so this is just
to avoid a potential future headache.

Fixes: commit [990ef7c](https://github.com/openSUSE/open-build-service/commit/990ef7cccef6f38fc1d1a1bb22a08e174dcba43b) ("[api][webui] Check access to source package")
```

* Loading branch information

[![@marcus-h](https://avatars.githubusercontent.com/u/1067596?s=40&v=4)](/marcus-h) [![@bgeuken](https://avatars.githubusercontent.com/u/968949?s=40&v=4)](/bgeuken)

[marcus-h](/openSUSE/open-build-service/commits?author=marcus-h "View all commits by marcus-h")
authored and
[bgeuken](/openSUSE/open-build-service/commits?author=bgeuken "View all commits by bgeuken")
committed
Jul 24, 2018

1 parent
[de2ca28](/openSUSE/open-build-service/commit/de2ca2880a3daf9dc6ac21329194c3ef2515a817)

commit f57b660

Showing
**1 changed file**
with
**5 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

7 changes: 5 additions & 2 deletions

7
[src/api/app/models/bs\_request\_action\_submit.rb](#diff-43c65c8468b773fca92bb9d2c080eab7990e7a8e86a6d45b55497b27944c8696 "src/api/app/models/bs_request_action_submit.rb")

Show comments

[View file](/openSUSE/open-build-service/blob/f57b660f49f830006766a8d4abc3b4af6e178063/src/api/app/models/bs_request_action_submit.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -115,8 +115,11 @@ def check\_action\_permission!(skip\_source = nil) |
|  |  | target\_package = target\_project.packages.find\_by\_name(self.target\_package) |
|  |  | initialize\_devel\_package = target\_project.find\_attribute('OBS', 'InitializeDevelPackage') |
|  |  | return if target\_package || !initialize\_devel\_package |
|  |  | source\_package = Package.get\_by\_project\_and\_name(source\_project, self.source\_package) |
|  |  | return if !source\_package || User.current.can\_modify?(source\_package) |
|  |  | opts = { follow\_project\_links: false } |
|  |  | source\_package = Package.get\_by\_project\_and\_name!(source\_project, |
|  |  | self.source\_package, |
|  |  | opts) |
|  |  | return if User.current.can\_modify?(source\_package) |
|  |  | msg = 'No permission to initialize the source package as a devel package' |
|  |  | raise PostRequestNoPermission, msg |
|  |  | end |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f57b660`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FopenSUSE%2Fopen-build-service%2Fcommit%2Ff57b660f49f830006766a8d4abc3b4af6e178063) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from idp-portal.suse.com_6b95d262_20250126_113828.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from bugzilla.suse.com_7571011a_20250125_201215.html ===


| Bugzilla – Bug 1098934 | VUL-0: CVE-2018-12466: obs: Delete a package in a project link exploit | Last modified: 2018-07-26 07:00:29 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3DCVE-2018-12466)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1098934**](show_bug.cgi?id=1098934)
(CVE-2018-12466)
- VUL-0: CVE-2018-12466: obs: Delete a package in a project link exploit

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2018-12466: obs: Delete a package in a project link exploit

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2018-12466 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Björn Geuken | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-06-25 05:08 UTC by Marcus Meissner | | --- | --- | | Modified: | 2018-07-26 07:00 UTC ([History](show_activity.cgi?id=1098934)) | | CC List: | 9 users (show)  adrian.schroeter bgeuken cbruckmayer dkang hvogel jsegitz meissner mls suse-tux | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1098934)  | Flags: | bgeuken: needinfo? (mls) | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**delete\_package\_in\_prjlink\_exploit.txt**](attachment.cgi?id=775130 "View the content of the attachment") (5.63 KB, text/plain)  [2018-06-25 05:10 UTC](#attach_775130 "Go to the comment associated with the attachment"), Marcus Meissner | [Details](attachment.cgi?id=775130&action=edit) | | [**0001-Add-testcase-for-the-delete-package-exploit.patch**](attachment.cgi?id=775131 "View the content of the attachment") (2.91 KB, patch)  [2018-06-25 05:10 UTC](#attach_775131 "Go to the comment associated with the attachment"), Marcus Meissner | [Details](attachment.cgi?id=775131&action=edit) | [Diff](attachment.cgi?id=775131&action=diff) | | [**0002-Fix-the-delete-package-exploit.patch**](attachment.cgi?id=775132 "View the content of the attachment") (2.21 KB, patch)  [2018-06-25 05:11 UTC](#attach_775132 "Go to the comment associated with the attachment"), Marcus Meissner | [Details](attachment.cgi?id=775132&action=edit) | [Diff](attachment.cgi?id=775132&action=diff) | | [**0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch**](attachment.cgi?id=775133 "View the content of the attachment") (1.89 KB, patch)  [2018-06-25 05:12 UTC](#attach_775133 "Go to the comment associated with the attachment"), Marcus Meissner | [Details](attachment.cgi?id=775133&action=edit) | [Diff](attachment.cgi?id=775133&action=diff) | | [**0004-Perform-permission-checks-for-a-maintenance\_incident.patch**](attachment.cgi?id=775134 "View the content of the attachment") (1.07 KB, patch)  [2018-06-25 05:12 UTC](#attach_775134 "Go to the comment associated with the attachment"), Marcus Meissner | [Details](attachment.cgi?id=775134&action=edit) | [Diff](attachment.cgi?id=775134&action=diff) | | [**patch for bsc#1098934**](attachment.cgi?id=775562 "View the content of the attachment") (65.89 KB, patch)  [2018-06-28 13:33 UTC](#attach_775562 "Go to the comment associated with the attachment"), Björn Geuken | [Details](attachment.cgi?id=775562&action=edit) | [Diff](attachment.cgi?id=775562&action=diff) | | [**updated patch for bsc#1098934**](attachment.cgi?id=775574 "View the content of the attachment") (62.11 KB, patch)  [2018-06-28 14:16 UTC](#attach_775574 "Go to the comment associated with the attachment"), Björn Geuken | [Details](attachment.cgi?id=775574&action=edit) | [Diff](attachment.cgi?id=775574&action=diff) | | [**updated patch for bsc#1098934**](attachment.cgi?id=775576 "View the content of the attachment") (65.46 KB, patch)  [2018-06-28 14:20 UTC](#attach_775576 "Go to the comment associated with the attachment"), Björn Geuken | [Details](attachment.cgi?id=775576&action=edit) | [Diff](attachment.cgi?id=775576&action=diff) | | [**updated patch for bsc#1098934**](attachment.cgi?id=775587 "View the content of the attachment") (65.48 KB, patch)  [2018-06-28 15:21 UTC](#attach_775587 "Go to the comment associated with the attachment"), Björn Geuken | [Details](attachment.cgi?id=775587&action=edit) | [Diff](attachment.cgi?id=775587&action=diff) | | [**updated patch for bsc#1098934**](attachment.cgi?id=775746 "View the content of the attachment") (100.32 KB, patch)  [2018-06-29 15:31 UTC](#attach_775746 "Go to the comment associated with the attachment"), Björn Geuken | [Details](attachment.cgi?id=775746&action=edit) | [Diff](attachment.cgi?id=775746&action=diff) | | [Show Obsolete](#a0) (8) [View All](attachment.cgi?bugid=1098934&action=viewall&hide_obsolete=1)  [Add an attachment](attachment.cgi?bugid=1098934&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1098934&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1098934#c0)  Marcus Meissner   2018-06-25 05:08:06 UTC  ``` Hi,                                                                                                                                                                                                                                                                                                                                                                                         under some circumstances it is possible to delete a package if the package's                                                                                                                  project is a link. The details can be found in the attached                                                                                                                                   delete_package_in_prjlink_exploit.txt file. The attached patches fix the                                                                                                                      problem in a quite conservative way (and break the testsuite). Hence, they                                                                                                                    serve merely as a basis for discussion (I did not want to spend too much                                                                                                                      on them until we agreed how to fix it).                                                                                                                                                                                                                                                                                                                                                     As requested by Adrian, I also CCed security@suse.de                                                                                                                                                                                                                                                                                                                                        Filename                          md5sum                                                                                                                                                      e99568f881f50d488ccee1d4cb88fcce  0001-Add-testcase-for-the-delete-package-exploit.patch                                                                                                      6b25e2d491b49b5d2fd7377fdfc6c752  0002-Fix-the-delete-package-exploit.patch                                                                                                                   d5d552008492463e2bce038a035ed749  0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch                                                                                             3e9a3fb3db7f1e379a9114f14f856748  0004-Perform-permission-checks-for-a-maintenance_incident.patch                                                                                             d19d36d77e3928cf21b344d6ce23b058  delete_package_in_prjlink_exploit.txt                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   Marcus ``` [Comment 1](show_bug.cgi?id=1098934#c1)  Marcus Meissner   2018-06-25 05:10:14 UTC  ``` Created [attachment 775130](attachment.cgi?id=775130 "delete_package_in_prjlink_exploit.txt") [[details]](attachment.cgi?id=775130&action=edit "delete_package_in_prjlink_exploit.txt") delete_package_in_prjlink_exploit.txt  delete_package_in_prjlink_exploit.txt  from Marcus Huewe ``` [Comment 2](show_bug.cgi?id=1098934#c2)  Marcus Meissner   2018-06-25 05:10:31 UTC  ``` Created [attachment 775131](attachment.cgi?id=775131&action=diff "0001-Add-testcase-for-the-delete-package-exploit.patch") [[details]](attachment.cgi?id=775131&action=edit "0001-Add-testcase-for-the-delete-package-exploit.patch") 0001-Add-testcase-for-the-delete-package-exploit.patch  0001-Add-testcase-for-the-delete-package-exploit.patch ``` [Comment 3](show_bug.cgi?id=1098934#c3)  Marcus Meissner   2018-06-25 05:11:40 UTC  ``` Created [attachment 775132](attachment.cgi?id=775132&action=diff "0002-Fix-the-delete-package-exploit.patch") [[details]](attachment.cgi?id=775132&action=edit "0002-Fix-the-delete-package-exploit.patch") 0002-Fix-the-delete-package-exploit.patch  0002-Fix-the-delete-package-exploit.patch ``` [Comment 4](show_bug.cgi?id=1098934#c4)  Marcus Meissner   2018-06-25 05:12:02 UTC  ``` Created [attachment 775133](attachment.cgi?id=775133&action=diff "0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch") [[details]](attachment.cgi?id=775133&action=edit "0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch") 0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch  0003-Add-testcase-for-checking-permissions-in-case-of-a-m.patch ``` [Comment 5](show_bug.cgi?id=1098934#c5)  Marcus Meissner   2018-06-25 05:12:33 UTC  ``` Created [attachment 775134](attachment.cgi?id=775134&action=diff "0004-Perform-permission-checks-for-a-maintenance_incident.patch") [[details]](attachment.cgi?id=775134&action=edit "0004-Perform-permission-checks-for-a-maintenance_incident.patch") 0004-Perform-permission-checks-for-a-maintenance_incident.patch  0004-Perform-permission-checks-for-a-maintenance_incident.patch ``` [Comment 6](show_bug.cgi?id=1098934#c6)  Marcus Meissner   2018-06-25 05:17:57 UTC  ``` Please use CVE-2018-12466 ``` [Comment 7](show_bug.cgi?id=1098934#c7)  Michael Schröder   2018-06-25 11:41:01 UTC  ``` (without looking into the patch)  So they seem to be two things that need to be fixed:  1) the code should *never* delete a package coming over a project link  2) there seems to be a permission check missing at accept time (not sure about this) ``` [Comment 8](show_bug.cgi?id=1098934#c8)  Marcus Hüwe   2018-06-25 12:07:10 UTC  ``` (In reply to Michael Schröder from [comment #7](show_bug.cgi?id=1098934#c7)) > So they seem to be two things that need to be fixed: >  > 1) the code should *never* delete a package coming over a project link >  Probably a stupid question, but why should this be forbidden? The package was explicitly created in the Base:Staging project. I don't see a (obvious?) reason why it shouldn't be treated as an "ordinary" package.  (Note: the cleanup of the Base:Staging/foo package (regardless if it exists or not) will _never_ result in a cleanup of the Base/foo package (at least wrt. the current codebase))  > 2) there seems to be a permission check missing at accept time (not sure > about this)  Maybe... this would be basically approach B) (or even a combination of A and B). ``` [Comment 9](show_bug.cgi?id=1098934#c9)  Björn Geuken   2018-06-28 13:33:01 UTC  ``` Created [attachment 775562](attachment.cgi?id=775562&action=diff "patch for bsc#1098934") [[details]](attachment.cgi?id=775562&action=edit "patch for bsc#1098934") patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934) ``` [Comment 10](show_bug.cgi?id=1098934#c10)  Michael Schröder   2018-06-28 13:49:49 UTC  ``` In reply to [comment #8](show_bug.cgi?id=1098934#c8):  I must admit that I just talked to Adrian and didn't read your report. So that's why I thought the attack is to create a project link to some project you want to attack, create a local package that "shadows" some other package, create a submission to some other project with cleanup, delete the local package. If the request is accepted the package must not be deleted in the wrong project.  Hmm. Ok. You've got a different attack. But could someone please check that the scenario above also is caught? I.e. nothing gets deleted if I submit a package coming from a project link? ``` [Comment 11](show_bug.cgi?id=1098934#c11)  Björn Geuken   2018-06-28 14:16:22 UTC  ``` Created [attachment 775574](attachment.cgi?id=775574&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775574&action=edit "updated patch for bsc#1098934") updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934) ``` [Comment 12](show_bug.cgi?id=1098934#c12)  Björn Geuken   2018-06-28 14:16:47 UTC  ``` btw, Thanks a lot for the detailed description ``` [Comment 13](show_bug.cgi?id=1098934#c13)  Björn Geuken   2018-06-28 14:17:26 UTC  ``` * in the delete_package_in_prjlink_exploit.txt file ``` [Comment 14](show_bug.cgi?id=1098934#c14)  Björn Geuken   2018-06-28 14:20:23 UTC  ``` Created [attachment 775576](attachment.cgi?id=775576&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775576&action=edit "updated patch for bsc#1098934") updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934) ``` [Comment 15](show_bug.cgi?id=1098934#c15)  Marcus Hüwe   2018-06-28 14:41:21 UTC  ``` (In reply to Björn Geuken from [comment #14](show_bug.cgi?id=1098934#c14)) > Created [attachment 775576](attachment.cgi?id=775576&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775576&action=edit "updated patch for bsc#1098934") > updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934)  > +  before_save :check_permissions_for_sources > +  Hmm why don't we hook this in the "standard" permission checking codepath?  > +  def check_permissions_for_sources > +    return unless action_type == :submit && (sourceupdate || updatelink)  We should also check this for a "maintenance_incident" type. Do we really need to do this in the updatelink case? (See the comment in the delete_package_in_prjlink_exploit.txt)  Also, this does not "resolve" the "<sourceupdate>update</sourceupdate>" vs. no "sourceupdate" element "inconsistency" (I'm fine with keeping the current behavior, but maybe we should state at least in the code or in the commit message that this behavior is intended). ``` [Comment 16](show_bug.cgi?id=1098934#c16)  Björn Geuken   2018-06-28 15:00:03 UTC  ``` > Hmm why don't we hook this in the "standard" permission checking codepath?  This way it applies no matter how the request get's created. Ideally we would have a policy for that. But that would require some bigger changes which I want to avoid since this will be backported to 2.9.  > We should also check this for a "maintenance_incident" type.  I will add it.  > Do we really need to do this in the updatelink case?  Honestly, I don't know. That's why I don't want to revert this right now.  My guess would be that this is because the requester would set the updatelink, as far as I understand.  > Also, this does not "resolve" the "<sourceupdate>update</sourceupdate>" vs. no "sourceupdate" element "inconsistency"  Let's take care of this separately as this is not related with the security issue. ``` [Comment 17](show_bug.cgi?id=1098934#c17)  Björn Geuken   2018-06-28 15:21:10 UTC  ``` Created [attachment 775587](attachment.cgi?id=775587&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775587&action=edit "updated patch for bsc#1098934") updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934) ``` [Comment 18](show_bug.cgi?id=1098934#c18)  Björn Geuken   2018-06-28 15:40:26 UTC  ``` (In reply to Michael Schröder from [comment #10](show_bug.cgi?id=1098934#c10)) > In reply to [comment #8](show_bug.cgi?id=1098934#c8): >  > I must admit that I just talked to Adrian and didn't read your report. So > that's why I thought the attack is to create a project link to some project > you want to attack, create a local package that "shadows" some other > package, create a submission to some other project with cleanup, delete the > local package. If the request is accepted the package must not be deleted in > the wrong project. >  Doesn't work. Though there is a bug caused by not closing the request when the source packages gets deleted:  "     # just remove one package     source_package = source_project.packages.find_by_name!(self.source_package)     source_package.commit_opts = { comment: bs_request.description, request: bs_request }     source_package.destroy     Package.source_path(self.source_project, self.source_package) "  source project in this case was not the linked project. ``` [Comment 19](show_bug.cgi?id=1098934#c19)  Marcus Hüwe   2018-06-28 19:58:56 UTC  ``` (In reply to Björn Geuken from [comment #16](show_bug.cgi?id=1098934#c16)) > > Do we really need to do this in the updatelink case? >  > Honestly, I don't know. That's why I don't want to revert this right now. >  > My guess would be that this is because the requester would set the > updatelink, as far as I understand. >  Yes, but it just affects the target package. I'm fine if we keep this code for now, but we should reconsider it:)  > > Also, this does not "resolve" the "<sourceupdate>update</sourceupdate>" > vs. no "sourceupdate" element "inconsistency" >  > Let's take care of this separately as this is not related with the security > issue.  Hmm depends a bit on the POV: if (sourceupdate.nil? || sourceupdate == 'update') and all conditions for the "sourceupdate" codepath are fulfilled (see sub sourcecopy in bs_srcserver), then accepting the request modifies the _link file in the source package. ``` [Comment 20](show_bug.cgi?id=1098934#c20)  Björn Geuken   2018-06-29 15:31:57 UTC  ``` Created [attachment 775746](attachment.cgi?id=775746&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775746&action=edit "updated patch for bsc#1098934") updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934)  Updated the patch. Now only sourceupdate == noupdate will skip the check. I also dropped the updatelink case while I was on it.  Please have another look.  @mls Please also have a look. Since I am not familiar with the backend internals ``` [Comment 21](show_bug.cgi?id=1098934#c21)  Marcus Hüwe   2018-07-01 13:57:34 UTC  ``` (In reply to Björn Geuken from [comment #20](show_bug.cgi?id=1098934#c20)) > Created [attachment 775746](attachment.cgi?id=775746&action=diff "updated patch for bsc#1098934") [[details]](attachment.cgi?id=775746&action=edit "updated patch for bsc#1098934") > updated patch for [bsc#1098934](http://bugzilla.suse.com/show_bug.cgi?id=1098934) >  > Updated the patch. Now only sourceupdate == noupdate will skip the check. I > also dropped the updatelink case while I was on it. >   > +  def check_permissions_for_sources > +    return unless action_type.in?([:submit, :maintenance_incident]) && > +      (sourceupdate.nil? || sourceupdate != 'noupdate') > +  Could be simplified to  return unless action_type.in?([:submit, :maintenance_incident]) && sourceupdate != 'noupdate'  +    source_object = Package.find_by_project_and_name(source_project, source_package) || +      Project.get_by_name(source_project) + +    raise LackingMaintainership if source_object && !User.current.can_modify?(source_object)  (source_object is always defined)  Unfortunately, this breaks (a) the testsuite (since we are now performing the check even if     sourceupdate == nil) (b) submissions from remote packages (Project.get_by_name returns a String     in case of a remote project, which yields to an exception in     User.current.can_modify?)  The problem with (a) is that we are now a bit too restrictive. If the following holds an update of the source_package _might_ happen:  - (sourceupdate.nil? || sourceupdate == 'update') AND - source_package@source_rev is a link to target_package AND - source_package@<rev at acceptance time> is a link to target_package  Hence, this suggests that we should perform the permission check at the request acceptance time if the conditions from above hold. However, I'm also fine with doing it a request creation time (in the worst case, we are still too restrictive), if we add the additional link check (the first two conditions from above).  About (b): a remote package is no problem because we can only submit a plain or an expanded revision => the "update source package" code is never executed.  So we probably end up with something like this:  if type is not SR/MI && sourceupdate != 'noupdate':   NO_CHECKS if (sourceupdate.nil? || sourceupdate == 'update') && LINK_CHECK && !remote:   PERMISSION_CHECK  # skip this for a MI type? (see below) if sourceupdate == 'cleanup':   PERMISSION_CHECK  Btw., I just realized that in case of a maintenance_incident only sourceupdate == 'cleanup' can occur... I'm not sure if the new checks break it if sourceupdate.nil? holds (in doubt, we only perform these checks in case of a SR).  Sorry for all this back and forth... :/ ``` [Comment 22](show_bug.cgi?id=1098934#c22)  Johannes Segitz   2018-07-24 09:09:21 UTC  ``` this is now in OBS:Server:2.9:Staging/obs-server, can we make the bug public so our checkers don't freak out? ``` [Comment 23](show_bug.cgi?id=1098934#c23)  Björn Geuken   2018-07-25 12:16:47 UTC  ``` Sorry, I answered in [https://bugzilla.suse.com/show_bug.cgi?id=1100217#c6](show_bug.cgi?id=1100217#c6 "RESOLVED FIXED - VUL-0: CVE-2018-12467: obs: InitializeDevelPackage attribute exploit (V2)") and forgot to reply here as well.  Meanwhile we released the new packages and appliances ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1098934)
* - [XML](show_bug.cgi?ctype=xml&id=1098934)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1098934)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3DCVE-2018-12466)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)


