=== Content from git.zuul-ci.org_ba8c5420_20250124_160606.html ===

This website requires JavaScript.
[![Logo](/assets/img/logo.svg)](/)

[Explore](/explore/repos)
[Get Started](https://docs.opendev.org/opendev/infra-manual/latest/gettingstarted.html)

[zuul](/zuul)/[zuul](/zuul/zuul)

[Code](/zuul/zuul/src/branch/master)
[Issues](https://storyboard.openstack.org/#!/project/zuul/zuul)
[Proposed changes](https://review.opendev.org/#/q/status:open+project:zuul/zuul)

### Fix information disclosure caused by unreachable nodes

[Browse Source](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e)

```
Currently we can leak secrets if we encounter unreachable nodes
combined with a task using with_items and no_log. In this case the
item variables are written to both the job-output.json and
job-output.txt. Upstream Ansible has the same issue [1].

The text log can be fixed by defining the v2_runner_on_unreachable
callback the same as v2_runner_on_failed.

The json log can be fixed the same way as the upstream Ansible issue.

[1] <https://bugzilla.redhat.com/show_bug.cgi?id=1588855>

Change-Id: Ie5dd2a6b11e8e276da65fe470f364107f3dd07ef
```
...

This commit is contained in:

![](/assets/img/avatar_default.png "tobias.henkel@bmw-carit.de")
parent
[896df11638](/zuul/zuul/commit/896df11638c704a428041c2a0d5c17b6094a337b)

commit
ffe7278c08

 **6 changed files** with **90 additions** and **1 deletions**

[Show all changes](?style=unified&whitespace=show-all&show-outdated=)
[Ignore whitespace when comparing lines](?style=unified&whitespace=ignore-all&show-outdated=)
[Ignore changes in amount of whitespace](?style=unified&whitespace=ignore-change&show-outdated=)
[Ignore changes in whitespace at EOL](?style=unified&whitespace=ignore-eol&show-outdated=)

Show Stats
[Download Patch File](/zuul/zuul/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e.patch)
[Download Diff File](/zuul/zuul/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e.diff)
Expand all files
Collapse all files

#### 28 [tests/fixtures/config/ansible-no-log/git/org\_project/playbooks/no-log-unreachable.yaml](#diff-5c91d1c9b6bed34cfd3f03f9dd79a3836b04c23e "tests/fixtures/config/ansible-no-log/git/org_project/playbooks/no-log-unreachable.yaml") vendored Normal file Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/tests/fixtures/config/ansible-no-log/git/org_project/playbooks/no-log-unreachable.yaml)

|  | |  |  | `@ -0,0 +1,28 @@` |
|  |  |  |  | `- hosts: localhost` |
|  |  |  |  | `gather_facts: no` |
|  |  |  |  | `tasks:` |
|  |  |  |  | `- name: Add a fake host` |
|  |  |  |  | `add_host:` |
|  |  |  |  | `hostname: fake` |
|  |  |  |  | `ansible_host: notexisting.example.notexisting` |
|  |  |  |  |  |
|  |  |  |  | `- hosts: fake` |
|  |  |  |  | `gather_facts: no` |
|  |  |  |  | `tasks:` |
|  |  |  |  | `- name: Run a lineinfile task` |
|  |  |  |  | `vars:` |
|  |  |  |  | `logins:` |
|  |  |  |  | `- machine: foo` |
|  |  |  |  | `login: bar` |
|  |  |  |  | `password: my-very-secret-password-1` |
|  |  |  |  | `- machine: two` |
|  |  |  |  | `login: three` |
|  |  |  |  | `password: my-very-secret-password-2` |
|  |  |  |  | `lineinfile:` |
|  |  |  |  | `path: /tmp/.netrc` |
|  |  |  |  | `mode: 0600` |
|  |  |  |  | `create: true` |
|  |  |  |  | `insertafter: EOF` |
|  |  |  |  | `line: "machine {{ item.machine }} login {{ item.login }} password {{ item.password }}"` |
|  |  |  |  | `with_items: "{{ logins }}"` |
|  |  |  |  | `no_log: true` |

#### 26 [tests/fixtures/config/ansible-no-log/git/org\_project/zuul.yaml](#diff-1c9342b528c0b60e1be727734c6bb8516ebebc76 "tests/fixtures/config/ansible-no-log/git/org_project/zuul.yaml") vendored Normal file Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/tests/fixtures/config/ansible-no-log/git/org_project/zuul.yaml)

|  | |  |  | `@ -0,0 +1,26 @@` |
|  |  |  |  | `- pipeline:` |
|  |  |  |  | `name: check` |
|  |  |  |  | `manager: independent` |
|  |  |  |  | `post-review: true` |
|  |  |  |  | `trigger:` |
|  |  |  |  | `gerrit:` |
|  |  |  |  | `- event: patchset-created` |
|  |  |  |  | `success:` |
|  |  |  |  | `gerrit:` |
|  |  |  |  | `Verified: 1` |
|  |  |  |  | `failure:` |
|  |  |  |  | `gerrit:` |
|  |  |  |  | `Verified: -1` |
|  |  |  |  |  |
|  |  |  |  | `- job:` |
|  |  |  |  | `name: base` |
|  |  |  |  | `parent: null` |
|  |  |  |  |  |
|  |  |  |  | `- job:` |
|  |  |  |  | `name: no-log-unreachable` |
|  |  |  |  | `run: playbooks/no-log-unreachable.yaml` |
|  |  |  |  |  |
|  |  |  |  | `- project:` |
|  |  |  |  | `check:` |
|  |  |  |  | `jobs:` |
|  |  |  |  | `- no-log-unreachable` |

#### 6 [tests/fixtures/config/ansible-no-log/main.yaml](#diff-1edf6cdf3083a5c298add8fb5ffdaa5d901e277e "tests/fixtures/config/ansible-no-log/main.yaml") vendored Normal file Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/tests/fixtures/config/ansible-no-log/main.yaml)

|  | |  |  | `@ -0,0 +1,6 @@` |
|  |  |  |  | `- tenant:` |
|  |  |  |  | `name: tenant-one` |
|  |  |  |  | `source:` |
|  |  |  |  | `gerrit:` |
|  |  |  |  | `config-projects:` |
|  |  |  |  | `- org/project` |

#### 27 [tests/unit/test\_v3.py](#diff-0d7c92d7f1e7fb6d1eea103b1aa0c95fd140cf89 "tests/unit/test_v3.py") Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/tests/unit/test_v3.py)

|  | |  |  | `@ -3844,3 +3844,30 @@ class TestPlugins(AnsibleZuulTestCase):` |
|  |  |  |  | `roles="roles: [{zuul: 'org/project2'}]")` |
|  |  |  |  | `self._run_job('filter-plugin-shared-bare-role',` |
|  |  |  |  | `roles="roles: [{zuul: 'org/project3', name: 'shared'}]")` |
|  |  |  |  |  |
|  |  |  |  |  |
|  |  |  |  | `class TestNoLog(AnsibleZuulTestCase):` |
|  |  |  |  | `tenant_config_file = 'config/ansible-no-log/main.yaml'` |
|  |  |  |  |  |
|  |  |  |  | `def _get_file(self, build, path):` |
|  |  |  |  | `p = os.path.join(build.jobdir.root, path)` |
|  |  |  |  | `with open(p) as f:` |
|  |  |  |  | `return f.read()` |
|  |  |  |  |  |
|  |  |  |  | `def test_no_log_unreachable(self):` |
|  |  |  |  | `# Output extra ansible info so we might see errors.` |
|  |  |  |  | `self.executor_server.verbose = True` |
|  |  |  |  | `self.executor_server.keep_jobdir = True` |
|  |  |  |  |  |
|  |  |  |  | `A = self.fake_gerrit.addFakeChange('org/project', 'master', 'A')` |
|  |  |  |  |  |
|  |  |  |  | `self.fake_gerrit.addEvent(A.getPatchsetCreatedEvent(1))` |
|  |  |  |  | `self.waitUntilSettled()` |
|  |  |  |  |  |
|  |  |  |  | `json_log = self._get_file(self.history[0], 'work/logs/job-output.json')` |
|  |  |  |  | `text_log = self._get_file(self.history[0], 'work/logs/job-output.txt')` |
|  |  |  |  |  |
|  |  |  |  | `self.assertNotIn('my-very-secret-password-1', json_log)` |
|  |  |  |  | `self.assertNotIn('my-very-secret-password-2', json_log)` |
|  |  |  |  | `self.assertNotIn('my-very-secret-password-1', text_log)` |
|  |  |  |  | `self.assertNotIn('my-very-secret-password-2', text_log)` |
|  | |  |  |  |

#### 2 [zuul/ansible/callback/zuul\_json.py](#diff-32f29794ae6c8b53ff72a6687316d10eca48a843 "zuul/ansible/callback/zuul_json.py") Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/zuul/ansible/callback/zuul_json.py)

|  | |  |  | `@ -137,7 +137,7 @@ class CallbackModule(CallbackBase):` |
|  |  |  |  |  |
|  |  |  |  | `def v2_runner_on_ok(self, result, **kwargs):` |
|  |  |  |  | `host = result._host` |
|  |  |  |  | `if result._result.get('_ansible_no_log', False):` |
|  |  |  |  | `if result._result.get('_ansible_no_log', False) or result._task.no_log:` |
|  |  |  |  | `self.results[-1]['tasks'][-1]['hosts'][host.name] = dict(` |
|  |  |  |  | `censored="the output has been hidden due to the fact that"` |
|  |  |  |  | `" 'no_log: true' was specified for this result")` |
|  | |  |  |  |

#### 2 [zuul/ansible/callback/zuul\_stream.py](#diff-21a5e3c3a7b4bc580065eb514d83500dd363bf39 "zuul/ansible/callback/zuul_stream.py") Unescape Escape [View File](/zuul/zuul/src/commit/ffe7278c08e6e36bf8b18f732c764e00ff51551e/zuul/ansible/callback/zuul_stream.py)

|  | |  |  | `@ -606,3 +606,5 @@ class CallbackModule(default.CallbackModule):` |
|  |  |  |  | `delegated_host=delegated_vars['ansible_host'])` |
|  |  |  |  | `else:` |
|  |  |  |  | `return result._host.get_name()` |
|  |  |  |  |  |
|  |  |  |  | `v2_runner_on_unreachable = v2_runner_on_failed` |
|  | |  |  |  |

Write
Preview

Loading…

x

Add

Cancel
Save

Reference in New Issue

**Repository**
zuul/zuul

**Title**

**Body**

Create Issue

Block a user
Blocking a user prevents them from interacting with repositories, such as opening or commenting on pull requests or issues. Learn more about blocking a user.

User to block:

Optional note:

The note is not visible to the blocked user.

Cancel
Block

[Powered by Gitea](https://about.gitea.com)
Version:
v1.23.1
Page: **2874ms**
Template: **105ms**

 English
Bahasa Indonesia
Deutsch
English
Español
Français
Gaeilge
Italiano
Latviešu
Magyar nyelv
Nederlands
Polski
Português de Portugal
Português do Brasil
Suomi
Svenska
Türkçe
Čeština
Ελληνικά
Български
Русский
Українська
فارسی
മലയാളം
日本語
简体中文
繁體中文（台灣）
繁體中文（香港）
한국어

[Licenses](/assets/licenses.txt)
[API](/api/swagger)



=== Content from lists.zuul-ci.org_44385011_20250124_160558.html ===

# Unintended variable disclosure on Ansible unreachable tasks despite no\_log

**Tobias.Henkel at bmw.de**
Tobias.Henkel at bmw.de

*Mon Jun 18 13:47:24 UTC 2018*

* Previous message: [Zuul 3.1.0 released](000014.html)
* Next message: [Unintended variable disclosure on Ansible unreachable tasks despite no\_log](000016.html)
* **Messages sorted by:**
  [[ date ]](date.html#15)
  [[ thread ]](thread.html#15)
  [[ subject ]](subject.html#15)
  [[ author ]](author.html#15)

---

```
Dear Zuul operators,

We discovered that if nodes become offline during the build the no_log attribute of a task got ignored.
If the unreachable error occurred in a task used with a loop variable (ex: with_items), the contents of the loop items would be printed in the console.
This could lead to accidentally leaking credentials or secrets.

We have reported this issue to the Ansible project and the CVE-2018-10855 [1] was assigned to the bug.

Further information can be found in StoryBoard: <https://storyboard.openstack.org/#!/story/2002177>

In Zuul, This is fixed by <https://review.openstack.org/574788> which is included in version 3.1.0. It is strongly adviced to update to latest master and restart any running zuul-executor processes.
We have audited zuul-jobs and have not found an instance where a sensitive variable like a secret would have been used in a loop.

In Ansible, users are encouraged to update to the latest supported dot releases as soon as possible.
The fix for Ansible [2] is available in 2.5.5 (released June 14th) and 2.4.5rc1.

Sorry for any inconveniences.

Kind regards
Tobias

[1]: <https://bugzilla.redhat.com/show_bug.cgi?id=CVE-2018-10855>
[2]: <https://github.com/ansible/ansible/pull/41414/files>

--
BMW Car IT GmbH
Tobias Henkel
Software engineer
Moosacher StraÃe 86
80809 MÃ¼nchen

Tel.:  Â­+49 89 189311-48
Fax:  +49 89 189311-20
Mail: [tobias.henkel at bmw.de](http://lists.zuul-ci.org/cgi-bin/mailman/listinfo/zuul-announce)<mailto:[tobias.henkel at bmw.de](http://lists.zuul-ci.org/cgi-bin/mailman/listinfo/zuul-announce)>
Web: <http://www.bmw-carit.de<http://www.bmw-carit.de/>>
-----------------------------------------------------------------------------
BMW Car IT GmbH
GeschÃ¤ftsfÃ¼hrer: Kai-Uwe Balszuweit
und Christian Salzmann
Sitz und Registergericht: MÃ¼nchen HRB 134810
-----------------------------------------------------------------------------

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <<http://lists.zuul-ci.org/pipermail/zuul-announce/attachments/20180618/9083ede7/attachment-0001.html>>

```

---

* Previous message: [Zuul 3.1.0 released](000014.html)
* Next message: [Unintended variable disclosure on Ansible unreachable tasks despite no\_log](000016.html)
* **Messages sorted by:**
  [[ date ]](date.html#15)
  [[ thread ]](thread.html#15)
  [[ subject ]](subject.html#15)
  [[ author ]](author.html#15)

---

[More information about the Zuul-announce
mailing list](http://lists.zuul-ci.org/cgi-bin/mailman/listinfo/zuul-announce)



=== Content from storyboard.openstack.org_a16960aa_20250124_160607.html ===



