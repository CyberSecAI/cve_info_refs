- **Root cause of vulnerability**: The vulnerability lies in the `PPPP_thread_recv_Proto_device` function, specifically when handling the `MSG_DEV_LGN_ACK_CRC` opcode within the `p2p_tnp` binary of the Yi Home Camera. The `CRCDec` function allocates memory based on the input buffer size. However, when the CRC check fails and returns an error, the memory allocated within the `PPPP_thread_recv_Proto_device` is freed, but the memory allocated inside `CRCDec` remains unreleased. If the CRC check succeeds, then the allocated buffer in the `PPPP_thread_recv_Proto_device` function is never freed, leading to a memory leak with each processed packet.
- **Weaknesses/vulnerabilities present**: Uncontrolled resource consumption (CWE-400) due to improper memory management in the `CRCDec` function and the `PPPP_thread_recv_Proto_device` function. Specifically, a memory leak occurs when handling `MSG_DEV_LGN_ACK_CRC` messages where the outer allocated buffer is not freed, or when the CRC check does not fail and thus no memory is freed.
- **Impact of exploitation**: An attacker can trigger a denial-of-service (DoS) by sending specially crafted UDP packets to the Yi Home Camera. This DoS manifests in two forms: a crash of the `p2p_tnp` service rendering the UDP comms inoperable, or a complete crash of all network related services, leading to a device reboot. The camera becomes unreachable via the 'Yi Home' app, requiring a manual reboot to restore functionality.
- **Attack vectors**: The attack vector is via sending crafted UDP packets to the camera, specifically targeting the `MSG_DEV_LGN_ACK_CRC` opcode. The packets are sent over the network to UDP port 31208.
- **Required attacker capabilities/position**: The attacker needs network connectivity to the Yi Home Camera and the ability to send UDP packets. No authentication or special privileges are required, making the attack possible for any attacker on the same network or able to reach the device remotely.