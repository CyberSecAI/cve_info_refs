```
{
  "guidelines": [
    "1. First verify if the content relates to the CVE specified based on the official description",
    "2. If the content does not relate to this CVE, respond with \"UNRELATED\"",
    "3. If no useful vulnerability information is found, respond with \"NOINFO\"",
    "4. For relevant content, extract:",
    "   - Root cause of vulnerability",
    "   - Weaknesses/vulnerabilities present",
    "   - Impact of exploitation",
    "   - Attack vectors",
    "   - Required attacker capabilities/position",
    "",
    "Additional instructions:",
    "- Preserve original technical details and descriptions",
    "- Remove unrelated content",
    "- Translate non-English content to English",
    "- Note if the content provides more detail than the official CVE description"
  ],
  "response": {
    "related": true,
    "summary": "The vulnerability is a guest kernel crash during core dump on POWER9 host caused by a missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path leading to a denial of service.",
    "details": [
      {
        "type": "mailing list",
        "source": "openwall.com_3018a204_20250125_220938.html",
        "content": "A guest kernel crash can be triggered from unprivileged userspace during core dump on POWER host due to a missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path leading to a denial of service.\n\nReferences:\n\n<https://marc.info/?l=linuxppc-embedded&m=150535531910494&w=2>\n\n<https://bugzilla.redhat.com/show_bug.cgi?id=1558149>\n\nAn upstream fix:\n\n<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c1fa0768a8713b135848f78fd43ffc208d8ded70>",
        "root_cause": "Missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path.",
         "vulnerabilities": [
          "Improper use of transactional memory (TM) instructions when the feature is not available on the CPU."
        ],
        "impact": "Guest kernel crash leading to a denial of service.",
        "attack_vectors": [
          "Triggering a core dump from unprivileged userspace on a POWER host."
        ],
        "attacker_capabilities": "An unprivileged user within the guest operating system"
      },
      {
        "type": "mailing list",
        "source": "marc.info_38a23251_20250125_220943.html",
        "content": "Commit cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nadded code to access TM SPRs in flush_tmregs_to_thread(). However\nflush_tmregs_to_thread() does not check if TM feature is available on\nCPU before trying to access TM SPRs in order to copy live state to\nthread structures. flush_tmregs_to_thread() is indeed guarded by\nCONFIG_PPC_TRANSACTIONAL_MEM but it might be the case that kernel\nwas compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled and ran on\na CPU without TM feature available, thus rendering the execution\nof TM instructions that are treated by the CPU as illegal instructions.\n\nThe fix is just to add proper checking in flush_tmregs_to_thread()\nif CPU has the TM feature before accessing any TM-specific resource,\nreturning immediately if TM is no available on the CPU. Adding\nthat checking in flush_tmregs_to_thread() instead of in places\nwhere it is called, like in vsr_get() and vsr_set(), is better because\navoids the same problem cropping up elsewhere.",
         "root_cause": "The `flush_tmregs_to_thread()` function attempts to access Transactional Memory (TM) Special Purpose Registers (SPRs) without checking if the CPU supports the TM feature.",
         "vulnerabilities": [
          "The kernel does not check if the CPU has Transactional Memory feature before accessing TM-specific resources."
        ],
        "impact": "The execution of TM instructions is treated by the CPU as illegal instructions, leading to a crash.",
         "attack_vectors": [
          "The issue occurs when the kernel is compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled but runs on a CPU without TM support. This can happen on POWER hosts with KVM guests."
        ],
         "attacker_capabilities": "An attacker able to trigger the core dump process within the KVM guest."
      },
      {
        "type": "redhat bugzilla",
        "source": "bugzilla.redhat.com_631c5d7f_20250126_121949.html",
        "content": "(CVE-2018-1091) kernel: guest kernel crash during core dump on POWER9 host\n\n[Description](show_bug.cgi?id=1558149#c0)  Adam Mari≈°    2018-03-19 17:44:47 UTC  ``` A kernel crash can be triggered from unprivileged userspace during core dump on a POWER system with a certain configuration due to a missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path leading to a denial of service.\n\nReferences:\n\n<https://marc.info/?l=linuxppc-embedded&m=150535531910494&w=2>\n\n<http://seclists.org/oss-sec/2018/q1/282>\n\nAn upstream fix:\n\n<https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c1fa0768a8713b135848f78fd43ffc208d8ded70>\n\n```",
          "root_cause": "A missing processor feature check and an erroneous use of transactional memory (TM) instructions in the core dump path.",
           "vulnerabilities": [
            "The kernel does not check if TM is available, causing a crash when using TM instructions on unsupported CPUs."
          ],
          "impact": "A kernel crash can be triggered from unprivileged userspace during core dump on a POWER system, leading to a denial of service.",
           "attack_vectors": [
            "Triggering a core dump within an affected POWER system configuration.",
            "POWER host and KVM guest scenarios where the guest kernel tries to use TM instructions."
          ],
          "attacker_capabilities": "Unprivileged user access within the affected environment."
      },
      {
        "type": "redhat bugzilla comment",
         "source": "bugzilla.redhat.com_631c5d7f_20250126_121949.html",
         "content": "[Comment 6](show_bug.cgi?id=1558149#c6)  Vladis Dronov    2018-03-27 17:15:03 UTC  ``` Notes:\n\nA certain configuration of POWER system needed to hit the flaw can be:\n\n- The case that kernel was compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled and ran on a CPU without transactional memory (TM) feature available, thus rendering the execution of TM instructions that are treated by the CPU as illegal instructions. (see this quote in the upstream commit)\n\n- In case of POWER host and KVM guest the core dump code unconditionally tries to use transactional memory (TM) instructions to flush TM state back to the thread structure. As qemu currently disables TM by default in guests, this causes an illegal instruction in the guest kernel and hence the crash.\n```",
         "root_cause": "The system attempts to use Transactional Memory (TM) instructions without verifying the CPU's support for it.",
         "vulnerabilities": [
           "The kernel was compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled but run on a CPU lacking TM support leading to illegal instructions.",
           "Core dump code unconditionally tries to use TM instructions in POWER KVM guests even when TM is disabled, causing a crash."
         ],
          "impact": "Kernel crash due to execution of illegal TM instructions when TM support is not available or disabled.",
           "attack_vectors": [
            "POWER systems where the kernel was compiled with TM enabled but run on a CPU without TM support.",
            "POWER hosts running KVM guests, as the core dump code uses TM instructions, and QEMU disables TM in guests by default."
          ],
          "attacker_capabilities": "An attacker needs to trigger a core dump on a system with one of the above configurations."
      },
       {
        "type": "kernel commit",
        "source": "www.kernel.org_36137dbd_20250125_220947.html",
        "content": "commit 5075520e4b0b2ec8d21ae7a992e6a073e46c8507\nAuthor: Gustavo Romero\nDate: Wed Sep 13 22:13:48 2017 -0400\n\npowerpc/tm: Flush TM only if CPU has TM feature\n\ncommit c1fa0768a8713b135848f78fd43ffc208d8ded70 upstream.\nCommit cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nadded code to access TM SPRs in flush\_tmregs\_to\_thread(). However\nflush\_tmregs\_to\_thread() does not check if TM feature is available on\nCPU before trying to access TM SPRs in order to copy live state to\nthread structures. flush\_tmregs\_to\_thread() is indeed guarded by\nCONFIG\_PPC\_TRANSACTIONAL_MEM but it might be the case that kernel\nwas compiled with CONFIG_PPC\_TRANSACTIONAL_MEM enabled and ran on\na CPU without TM feature available, thus rendering the execution\nof TM instructions that are treated by the CPU as illegal instructions.\n\nThe fix is just to add proper checking in flush\_tmregs\_to\_thread()\nif CPU has the TM feature before accessing any TM-specific resource,\nreturning immediately if TM is no available on the CPU. Adding\nthat checking in flush\_tmregs\_to\_thread() instead of in places\nwhere it is called, like in vsr\_get() and vsr\_set(), is better because\navoids the same problem cropping up elsewhere.\n\nFixes: cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nSigned-off-by: Gustavo Romero\nReviewed-by: Cyril Bur\nSigned-off-by: Michael Ellerman",
        "root_cause": "The code added in commit cd63f3c to access TM SPRs in flush_tmregs_to_thread() didn't check if the CPU supports TM before accessing TM-specific resources.",
         "vulnerabilities": [
            "The kernel does not verify TM feature availability before accessing TM SPRs, potentially leading to illegal instruction execution."
          ],
          "impact": "The execution of TM instructions on CPUs without TM support leads to a crash.",
           "attack_vectors": [
             "Systems running kernels compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled on CPUs without TM support."
           ],
          "attacker_capabilities": "The attacker needs to be able to trigger core dumps or use transactional memory while running on a system with the vulnerable configuration. "
      },
      {
        "type": "github commit",
        "source": "github.com_8c7dc515_20250125_220943.html",
        "content": "powerpc/tm: Flush TM only if CPU has TM feature\n\nCommit cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nadded code to access TM SPRs in flush_tmregs_to_thread(). However\nflush_tmregs_to_thread() does not check if TM feature is available on\nCPU before trying to access TM SPRs in order to copy live state to\nthread structures. flush_tmregs_to_thread() is indeed guarded by\nCONFIG_PPC_TRANSACTIONAL_MEM but it might be the case that kernel\nwas compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled and ran on\na CPU without TM feature available, thus rendering the execution\nof TM instructions that are treated by the CPU as illegal instructions.\n\nThe fix is just to add proper checking in flush_tmregs_to_thread()\nif CPU has the TM feature before accessing any TM-specific resource,\nreturning immediately if TM is no available on the CPU. Adding\nthat checking in flush_tmregs_to_thread() instead of in places\nwhere it is called, like in vsr_get() and vsr_set(), is better because\navoids the same problem cropping up elsewhere.",
          "root_cause": "The `flush_tmregs_to_thread()` function does not verify if the CPU supports the transactional memory (TM) feature before accessing TM-specific special-purpose registers (SPRs).",
         "vulnerabilities": [
            "Unconditional access of TM SPRs even when the CPU lacks TM support."
          ],
           "impact": "Illegal instruction execution and a subsequent crash on CPUs without TM support.",
          "attack_vectors": [
            "Core dumps or operations involving transactional memory on systems without hardware support for TM, despite being compiled with CONFIG_PPC_TRANSACTIONAL_MEM."
           ],
           "attacker_capabilities": "An attacker needs the ability to trigger the vulnerable core dump path within the guest kernel."
      },
          {
        "type": "cgit commit",
        "source": "git.kernel.org_52070543_20250125_220938.html",
        "content": "powerpc/tm: Flush TM only if CPU has TM feature\n\nCommit cd63f3c (\"powerpc/tm: Fix saving of TM SPRs in core dump\")\nadded code to access TM SPRs in flush\_tmregs\_to\_thread(). However\nflush\_tmregs\_to\_thread() does not check if TM feature is available on\nCPU before trying to access TM SPRs in order to copy live state to\nthread structures. flush\_tmregs\_to\_thread() is indeed guarded by\nCONFIG\_PPC\_TRANSACTIONAL\_MEM but it might be the case that kernel\nwas compiled with CONFIG_PPC_TRANSACTIONAL_MEM enabled and ran on\na CPU without TM feature available, thus rendering the execution\nof TM instructions that are treated by the CPU as illegal instructions.\n\nThe fix is just to add proper checking in flush\_tmregs\_to\_thread()\nif CPU has the TM feature before accessing any TM-specific resource,\nreturning immediately if TM is no available on the CPU. Adding\nthat checking in flush\_tmregs\_to\_thread() instead of in places\nwhere it is called, like in vsr\_get() and vsr\_set(), is better because\navoids the same problem cropping up elsewhere.",
          "root_cause": "The kernel attempts to use transactional memory (TM) instructions in `flush_tmregs_to_thread()` without checking if the CPU supports TM.",
         "vulnerabilities": [
          "Accessing TM SPRs in `flush_tmregs_to_thread()` without verifying TM availability.",
          "Incorrect assumption that CONFIG_PPC_TRANSACTIONAL_MEM guarantees CPU TM support."
        ],
        "impact": "Illegal instruction and kernel crash if running on a CPU without TM support.",
        "attack_vectors": [
            "Systems with a kernel built with CONFIG_PPC_TRANSACTIONAL_MEM but running on CPUs without TM.",
             "POWER host and KVM guest configurations where TM is disabled within the guest."
          ],
        "attacker_capabilities": "Triggering core dumps or operations involving transactional memory on systems without hardware support for TM while having TM enabled in the kernel config. "
      },
      {
        "type": "redhat security advisory",
        "source": "access.redhat.com_b0d0c4ab_20250125_220939.html",
        "content": "Security Fix(es):\n\n* Kernel: KVM: error in exception handling leads to wrong debug stack value (CVE-2018-1087)\n* Kernel: error in exception handling leads to DoS (CVE-2018-8897)\n* Kernel: ipsec: xfrm: use-after-free leading to potential privilege escalation (CVE-2017-16939)\n* kernel: Out-of-bounds write via userland offsets in ebt\_entry struct in netfilter/ebtables.c (CVE-2018-1068)\n* kernel: ptrace() incorrect error handling leads to corruption and DoS (CVE-2018-1000199)\n* kernel: guest kernel crash during core dump on POWER9 host (CVE-2018-1091)\n\nFor more details about the security issue(s), including the impact, a CVSS score, and other related information, refer to the CVE page(s) listed in the References section.",
           "root_cause": "Missing check for processor feature and erroneous use of TM instructions during core dump.",
            "vulnerabilities": [
            "The vulnerability exists because of the usage of TM instructions without first checking for CPU support."
            ],
          "impact": "The missing check leads to illegal instructions and subsequently crashes the guest kernel resulting in a denial of service.",
            "attack_vectors": [
            "Triggering core dump from unprivileged userspace in a POWER system."
            ],
            "attacker_capabilities": "An attacker needs to be able to trigger a core dump in a vulnerable system."
      }
    ]
  }
}
```