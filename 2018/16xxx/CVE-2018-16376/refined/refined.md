The provided content is related to CVE-2018-16376.

**Root cause of vulnerability:**
The vulnerability is caused by missing length checks in the `t2_encode_packet` function within `src/lib/openmj2/t2.c`. Specifically, the function writes header markers (SOP and EPH) without ensuring sufficient space in the output buffer.

**Weaknesses/vulnerabilities present:**
- Heap-based buffer overflow. The lack of length checks before writing to the output buffer (`c`) can lead to writing beyond the allocated buffer if the output buffer `length` is smaller than the required size for SOP (6 bytes) or EPH (2 bytes).

**Impact of exploitation:**
- A heap-based buffer overflow can lead to memory corruption, potentially causing a crash or enabling an attacker to execute arbitrary code.

**Attack vectors:**
- The vulnerability can be triggered when encoding a JPEG 2000 image, where the `t2_encode_packet` function is used to write header markers based on encoding options. By crafting an input that results in a small output buffer and enables SOP or EPH markers, an attacker can trigger the overflow.

**Required attacker capabilities/position:**
- An attacker would need to provide a crafted input that leads to the vulnerable code path being executed with insufficient output buffer size. This would likely involve creating a specially crafted JPEG 2000 file and forcing the openjpeg library to process it using the vulnerable code.