=== Content from laworigin.github.io_e12b0c51_20250125_234402.html ===


![](http://115.159.184.127/blog/timg.jpg)
# WisdomTree

* [主页](/)
* [学习成果](/vulnerability)

所有文章
友链
关于我

![](http://115.159.184.127/blog/timg.jpg)

# WisdomTree

* [主页](/)
* [学习成果](/vulnerability)

# CVE-2018-7700 dedecms后台任意代码执行

[2018-03-07](/2018/03/07/CVE-2018-7700-dedecms%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/)

[转载自先知社区](https://xz.aliyun.com/t/222)
该漏洞的触发点为/dede/tag\_test\_action.php。起因是csrf\_check()的绕过，导致可执行任意代码。

查看/dede/tag\_test\_action.php文件的源码：
![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/1.png)

如果直接访问这个文件，会进入csrf\_check()函数。提示token错误，且退出执行。
跟进csrf\_check()，该函数所在文件为dede/config.php:
![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/2.png)

这里的判断只是判断token值是否和session中的token相等，还有就是判断token是否存在。就这么来看，貌似比较矛盾。Session[‘token’]的值我们不知道，我们没法伪造token。有趣的是，当我们登录之后，并不会生成session[‘token’]，也就是说，这时的session[‘token’]为null。
这样的话，我们只需要构造<http://localhost/a.php?token=>
这样就可绕过csrf\_check()

绕过之后，便可为$partcode构造payload。

首先是对数据进行初始化。跟进$pv->SetTemplet()，跟踪变量的流向：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/3.png)

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/4.png)

继续跟进DedeTagParse类的LoadSource方法：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/5.png)

在这个方法中，我们传入的payload被写入inc文件中，继续跟踪LoadTemplate：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/6.png)

这里先是判断文件是否存在，很显然是存在的。随后将文件读入$this->SourceString字符串中。

继续跟踪LoadCache方法：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/7.png)

在这里，将数据读入缓存中。至此，数据初始化完成。

触发代码执行的点在PartView类的Display方法，源码如下：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/8.png)

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/9.png)

在display()方法中再次调用DedeTagParse类中的display()方法：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/10.png)

跟进GetResult():

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/11.png)

跟进AssignSysTag()方法：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/12.png)

最后跟进Runphp方法：

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/13.png)

在这里，只是简单的将数据从对象中提取出来，做一些简单的字符串替换，便可成功执行代码。

综上，我们传入的$partcode变量应该符合dedecms模板格式，且带有runphp=’yes’标签。
基于此，我们可构造以下payload：
`partcode={dede:field name=’source’ runphp=’yes’}phpinfo();{/dede:field}`

加上绕过csrf\_check()的payload，得到最后的poc:
`http://localhost/后台地址/tag_test_action.php?url=a&token=&partcode={dede:field name=’source’ runphp=’yes’}phpinfo();{/dede:field}`

![](/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/14.png)

利用条件：登录后台
解决方案：重新实现csrf\_check()函数

赏

谢谢你请我吃糖果

扫一扫，分享到微信

![微信分享二维码](//pan.baidu.com/share/qrcode?url=http://yoursite.com/2018/03/07/CVE-2018-7700-dedecms后台任意代码执行/)

[CVE-2018-9134-Dedecms-background-file-rename](/2018/03/30/CVE-2018-9134-Dedecms-background-file-rename/)
[2017 END](/2017/12/31/2017-END/)

© 2019 WisdomTree

[Hexo](http://hexo.io/) Theme [Yilia](https://github.com/litten/hexo-theme-yilia) by Litten

* 所有文章
* 友链
* 关于我

tag:

缺失模块。

* [梅子酒](https://otakekumi.github.io/)
* [八一](http://blog.flywinky.top/archives/)
* [MagicBlue](https://magicbluech.github.io/)
* [ihciah](https://www.ihcblog.com/)
* [Fortune\_c00kie](https://hacksec.xyz/)

web菜鸡，圈子里的大透明。混了这么久也没混出啥。默默的做一个路人，希望能在安全圈里混口饭吃。混不好就回家养猪。



=== Content from xz.aliyun.com_84680021_20250126_125140.html ===


[![]( https://xz.aliyun.com/api/v2/files/7e6f6165-ee99-3f16-8091-d257a52b0dd9  )](/)

* [技术社区](/news)
* [安全培训](/pictrue)
* [实习实训](/training)
* [技术社群](/group)
* [能力认证](/cert_auth)
* [积分商城](https://xz.aliyun.com/points-mall/index)

![](https://xz.aliyun.com/assets/pc/images/icon-search.png)

历史记录

清空历史记录

* 相关的动态
* 相关的文章
* 相关的用户
* 相关的圈子
* 相关的话题

[注册](https://xz.aliyun.com/register?type=phone)
[登录](https://xz.aliyun.com/auth/login)

* [![](https://xzfile.aliyuncs.com/2025/01/23/0732/lO3ZBfuP9zxZPAE8Z500h0qyiJYfZDJ6t9FzzClNPbe8c8BfMPBx6ogDeiz72lhH.jpg)](https://xianzhi-next.aliyun.com/)
  [全新先知平台盛大启航](https://xianzhi-next.aliyun.com/)
* [![](https://xzfile.aliyuncs.com/2025/01/19/0833/SA5d0mRKyoAKToeLMVgazUuGIfG2jvk6iE0ZG95T7YodnRFDGg0A9hGM2b6Unp5Q.png)](https://security.alibaba.com/online/detail?id=178)
  [第七届入侵检测挑战赛报名开启！](https://security.alibaba.com/online/detail?id=178)

[![](https://xzfile.aliyuncs.com/2025/01/19/0802/yoxOIV6aoscXyHzoCvI0ORuMX5SRlKnnD0L7y73O9AlJoRBVMD3tApLHAxfNxwId.png)

新年礼盒来啦！先知众测白帽和先知社区白帽可领取！](https://xz.aliyun.com/)
[![](https://xzfile.aliyuncs.com/2025/01/19/0829/1w0fy5ZB0CIPjGLBv0NF6veItXhqHCmV2pl32amMnu5gmoWOhhqctiGTkDGtHrCr.jpg)

先知安全沙龙系列](https://xz.aliyun.com/users/90660/news)

* [推荐](https://xz.aliyun.com/news)
* [技术文章](https://xz.aliyun.com/news?cate_id=9)
* [渗透测试](https://xz.aliyun.com/news?cate_id=24)
* [漏洞分析](https://xz.aliyun.com/news?cate_id=2)
* [WEB安全](https://xz.aliyun.com/news?cate_id=14)
* [二进制安全](https://xz.aliyun.com/news?cate_id=20)
* [移动安全](https://xz.aliyun.com/news?cate_id=15)
* [IoT安全](https://xz.aliyun.com/news?cate_id=16)
* [企业安全](https://xz.aliyun.com/news?cate_id=10)
* [区块链安全](https://xz.aliyun.com/news?cate_id=21)
* [CTF](https://xz.aliyun.com/news?cate_id=11)
* [安全工具](https://xz.aliyun.com/news?cate_id=3)
* [社区公告](https://xz.aliyun.com/news?cate_id=8)

[![先知安全沙龙(上海站) - 后渗透阶段主机关键信息自动化狩猎的实现与应用](data:image/png;base64...)](https://xz.aliyun.com/news/16260)

[先知安全沙龙(上海站) - 后渗透阶段主机关键信息自动化狩猎的实现与应用](https://xz.aliyun.com/news/16260)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
原创 · 2825浏览 · 2024-12-18 08:39

[![先知安全沙龙(上海站) - 红队武器开发之基于合法服务的隐蔽C2](data:image/png;base64...)](https://xz.aliyun.com/news/16258)

[先知安全沙龙(上海站) - 红队武器开发之基于合法服务的隐蔽C2](https://xz.aliyun.com/news/16258)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 2002浏览 · 2024-12-18 08:38

[![先知安全沙龙(上海站) - Linux沙箱技术(权限机制、资源隔离与安全防御)](data:image/png;base64...)](https://xz.aliyun.com/news/16257)

[先知安全沙龙(上海站) - Linux沙箱技术(权限机制、资源隔离与安全防御)](https://xz.aliyun.com/news/16257)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 939浏览 · 2024-12-18 08:37

[![先知安全沙龙(上海站) - 终端安全对抗及防护](data:image/png;base64...)](https://xz.aliyun.com/news/16256)

[先知安全沙龙(上海站) - 终端安全对抗及防护](https://xz.aliyun.com/news/16256)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 1469浏览 · 2024-12-18 08:36

[![先知安全沙龙(上海站) - 大模型基础设施安全攻防](data:image/png;base64...)](https://xz.aliyun.com/news/16255)

[先知安全沙龙(上海站) - 大模型基础设施安全攻防](https://xz.aliyun.com/news/16255)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 1119浏览 · 2024-12-18 08:35

[![先知安全沙龙(北京站) - 安全研究员在红蓝对抗中的自我修养](data:image/png;base64...)](https://xz.aliyun.com/news/15818)

[先知安全沙龙(北京站) - 安全研究员在红蓝对抗中的自我修养](https://xz.aliyun.com/news/15818)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 1748浏览 · 2024-11-19 23:21

[![先知安全沙龙(北京站) - 浅谈Web快速打点](data:image/png;base64...)](https://xz.aliyun.com/news/15816)

[先知安全沙龙(北京站) - 浅谈Web快速打点](https://xz.aliyun.com/news/15816)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 2760浏览 · 2024-11-19 23:23

[![先知安全沙龙(北京站) - 滥用 ADWS 协议枚举 Active Directory](data:image/png;base64...)](https://xz.aliyun.com/news/15815)

[先知安全沙龙(北京站) - 滥用 ADWS 协议枚举 Active Directory](https://xz.aliyun.com/news/15815)

声明：此PPT为演讲嘉宾个人的观点和研究成果，仅用于技术交流，不代表先知社区的立场或观点，如有您在浏览过程中发现任何错误信息或者侵权的问题，可联系我们进行处理，我们将依据相关法律法规和平台规定，尽快进行核实处理。

[技术文章](https://xz.aliyun.com/news?cate_id=9)
[![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
阿里云先知
发表于 浙江](https://xz.aliyun.com/users/90660)
 · 1558浏览 · 2024-11-19 23:24

[![](/assets/pc/images/icon-publish.png)](https://xz.aliyun.com/news/release)

热门文章

* [![](https://xz.aliyun.com/api/v2/files/1da66f87-0913-348f-9ea2-767b08a0ff56)](https://xz.aliyun.com/news/16567)
  [先知社区新版上线公告](https://xz.aliyun.com/news/16567)
* [![](https://xz.aliyun.com/api/v2/files/32a23f58-1f92-3cc9-ab17-9e17feb99373)](https://xz.aliyun.com/news/16426)
  [伪装成Chrome安装程序传播银狐最新变种](https://xz.aliyun.com/news/16426)
* [![](https://xz.aliyun.com/api/v2/files/53fc30b6-94e4-392b-a300-cea9fedc2bf7)](https://xz.aliyun.com/news/16425)
  [绕过App某加密企业版加固Frida检测](https://xz.aliyun.com/news/16425)
* [![](https://xz.aliyun.com/api/v2/files/36d87886-c440-3bb5-9f55-f177eb533c51)](https://xz.aliyun.com/news/16466)
  [使用分支对抗进行webshell bypass](https://xz.aliyun.com/news/16466)
* [![](https://xz.aliyun.com/api/v2/files/5ab3405b-9fcf-32b3-8013-19d0d6bfa770)](https://xz.aliyun.com/news/16467)
  [codeql 之 SSRF 漏洞自动化 寻找](https://xz.aliyun.com/news/16467)

近期热点

* 一周
* 月份
* 季度

* 1
  [先知社区新版上线公告](https://xz.aliyun.com/news/16567)
* 2
  [伪装成Chrome安装程序传播银狐最新变种](https://xz.aliyun.com/news/16426)
* 3
  [绕过App某加密企业版加固Frida检测](https://xz.aliyun.com/news/16425)
* 4
  [使用分支对抗进行webshell bypass](https://xz.aliyun.com/news/16466)
* 5
  [codeql 之 SSRF 漏洞自动化 寻找](https://xz.aliyun.com/news/16467)

暂无相关信息

暂无相关信息

优秀作者

* [1

  ![](https://xz.aliyun.com/assets/pc/images/pic_default_secret.png)
  阿里云先知

  贡献值：100](https://xz.aliyun.com/users/90660)

* [用户协议](https://xz.aliyun.com/api/v2/site-agreement-view?type=user)
* [联系我们](https://xz.aliyun.com/api/v2/site-agreement-view?type=privacy)
* [举报中心](https://report.aliyun.com)
* [我要投诉](https://www.aliyun.com/complaint)

先知社区
本站/app由
Djingoii
提供技术和产品支持


