The provided content is related to CVE-2018-6336.

**Root cause of vulnerability:**
The vulnerability stems from the improper use of code signing APIs when verifying Mach-O binaries within a Fat/Universal file on macOS. Specifically, third-party developers were not correctly validating all architectures within the Fat/Universal file, leading to a bypass. The vulnerability lies in the difference between how the Mach-O loader loads signed code vs how improperly used Code Signing APIs check signed code.

**Weaknesses/vulnerabilities present:**
- **Inadequate verification of nested formats:** The code signing APIs, when not used correctly, do not properly check all architectures within a Fat/Universal file. They primarily validate the first binary and may skip validation of subsequent binaries if certain conditions are met.
- **Lack of CA root of trust verification:** The APIs, when checking the subsequent binaries, verify the Team Identifiers match and verify no tampering via containing cryptographic signature, but without checking the CA root of trust.
- **Preference for native CPU architecture:** The code signing API prefers checking the native CPU architecture (x86_64) and can default to checking unsigned code if it is x86_64.
- **Incorrect usage of API flags:** Developers were not using the `kSecCSCheckAllArchitectures` and `kSecCSStrictValidate` flags correctly, which resulted in incomplete checks and the ability to bypass code signing checks.
- **Reliance on ad-hoc signing:** The vulnerability allows ad-hoc signed code to be executed if the CPU_TYPE in the Fat header of the Apple binary is set to an invalid type or a CPU Type that is not native to the host chipset, effectively bypassing code signing checks.

**Impact of exploitation:**
- **Bypass of code signing checks:** Malicious, unsigned code can be executed while appearing to be signed by Apple, undermining the core security construct of code signing.
- **Compromised security tools:** Security, forensics, and incident response tools that rely on code signing can be tricked into considering unsigned code as trusted, leading to missed detections and potential security breaches.
- **Evasion of security controls:** Attackers can potentially bypass security mechanisms like whitelisting, antivirus, incident response, and threat hunting products.

**Attack vectors:**
- **Malformed Fat/Universal binaries:** The attack vector involves creating a malformed Fat/Universal file containing a valid Apple-signed binary and a malicious ad-hoc signed binary.
- **Invalid CPU type:** Setting the CPU\_TYPE in the Fat header of the Apple binary to an invalid or non-native type forces the Mach-O loader to skip the validly signed Mach-O binary and execute the malicious one.

**Required attacker capabilities/position:**
- **Ability to create Fat/Universal files:** The attacker needs to be able to create or modify Fat/Universal files.
- **Ability to ad-hoc sign code:** The attacker needs to be able to sign the malicious code with an ad-hoc signature.
- **Knowledge of Mach-O format:** The attacker needs to understand the Mach-O and Fat/Universal binary formats to manipulate the CPU\_TYPE field.