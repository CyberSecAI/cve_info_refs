```
{
  "cve": "CVE-2018-6593",
  "description": "The vulnerability lies in the improper access control of the filter communication port in MalwareFox AntiMalware 2.74.0.150. The default DACL for the communication port is superseded, allowing everyone to connect. The driver then automatically registers the connecting process as trusted. This enables the process to issue IOCTL codes that should normally be restricted, such as disabling real-time protection, writing to raw disks, and opening full access handles to processes.",
  "vulnerability_details": {
    "root_cause": "The driver's filter communication port's DACL (Discretionary Access Control List) is improperly configured. Instead of using the default DACL which would restrict access to SYSTEM and Administrators, the code sets the DACL pointer to NULL, granting access to everyone.",
    "weaknesses": [
      "Improper access control: The communication port does not properly restrict which processes can connect to it, leading to unauthorized access.",
      "Privilege escalation: Once a process connects to the port, the driver automatically registers it as trusted, granting the process elevated privileges."
    ],
     "impact": "An attacker can connect to the driver's communication port and register their process as trusted. This allows the attacker to bypass security restrictions, disable real-time protection, write to raw disk, and open full access handles to other processes, ultimately achieving local privilege escalation and potentially gaining SYSTEM level access.",
    "attack_vector": "Local. A local attacker can exploit this vulnerability by connecting to the driver's communication port.",
     "required_capabilities": "The attacker needs to be able to execute code on the target machine and connect to the named pipe communication port of the vulnerable driver."
  },
  "exploit_details": {
      "exploit_code_description": "The provided exploit code demonstrates how to:\n1.  Connect to the vulnerable driver's communication port using `FilterConnectCommunicationPort`. This registers the attacker's process with the driver.\n2.  Open a full access handle to winlogon.exe using the vulnerable driver's IOCTL code 0x8000204C. This IOCTL is only accessible to registered processes.\n3. Allocate executable memory in the winlogon.exe process using `VirtualAllocEx`.\n4.  Write shellcode into the allocated memory using `WriteProcessMemory`.\n5.  Execute the shellcode in winlogon.exe by creating a remote thread using `CreateRemoteThread`. The shellcode in the exploit spawns a command prompt as SYSTEM.\n6.  (Bonus) Disable real-time protection using the IOCTL code 0x80002090. This is only possible because the process was registered as trusted."
  }
}
```