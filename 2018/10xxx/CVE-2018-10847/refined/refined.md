Based on the provided documents, here's a breakdown of the vulnerability associated with CVE-2018-10847:

**Root Cause:**

*   The vulnerability stems from insufficient validation of client-provided parameters during XMPP stream restarts within the Prosody XMPP server. Specifically, the server does not verify that the virtual host associated with a user's session remains consistent across stream restarts.

**Weaknesses/Vulnerabilities:**

*   **Cross-Host Authentication Bypass:** An authenticated user can manipulate the "to" attribute of a stream restart to switch their session to a different virtual host on the same Prosody instance, effectively bypassing the security policies of the initial host.
*   **Session Hijacking:** A successful attacker can migrate their authenticated session from one host to another, potentially gaining access to resources or features intended for users of the target host.

**Impact of Exploitation:**

*   **Impersonation:** An attacker can impersonate a user on the target host (host B) if they have access to a user on host A with the same name (e.g., user1@hosta.example can impersonate user1@hostb.example).
*   **Privilege Escalation**: If an anonymous user authenticated on a more restrictive host (with policies that forbid sending stanzas to remote addresses) migrates their session to a host with less restrictive policies, they gain the privileges of the more permissive host. This is achieved by changing the "to" address of the XMPP stream restart.
*   **Bypassing Security Policies:** The attacker gains access to the target virtual host and its security policies without proper authorization.

**Attack Vectors:**

*   **XMPP Stream Manipulation:** The attack involves manipulating the 'to' attribute during a stream restart.
*   **Multiple Virtual Hosts:** This vulnerability impacts Prosody instances configured with multiple virtual hosts.
*   **Stream restarts:** The vulnerability occurs during a stream restart.

**Required Attacker Capabilities/Position:**

*   **Authenticated User:** The attacker needs to be an authenticated user on one of the Prosody virtual hosts in order to start a session that can be migrated. This includes SASL ANONYMOUS accounts.
*   **Access to Multiple Hosts:** The attacker needs to be able to connect to a Prosody instance with multiple virtual hosts.
*   **Ability to Initiate Stream Restarts:** The attacker must be able to initiate an XMPP stream restart and manipulate the 'to' attribute.
* **Network Access:** The attack can be performed via standard TCP and WebSocket connections, but BOSH connections are not vulnerable.

**Additional details from the provided content:**

*   The issue was introduced in commit 3e3171b59028.
*   The vulnerability was reported by Princess Pepperoni from nonfree.pizza.
*   Patches were released for both the stable (0.10.1) and old-stable (0.9.x) branches.
*   The vulnerability was fixed in Prosody versions 0.9.14 and 0.10.2.
*   Debian issued DSA-4216-1 to address this vulnerability, and corresponding updates were provided for the oldstable (jessie) and stable (stretch) distributions of Debian.
*   Red Hat also tracked this vulnerability.