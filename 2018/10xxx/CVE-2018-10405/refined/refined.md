The provided content is related to CVE-2018-10405.

**Root cause of vulnerability:**

The vulnerability lies in the improper use of the code signing APIs when verifying Fat/Universal binaries on macOS/OSX. Specifically, the code signing APIs, by default, prioritize the native CPU architecture when checking code signatures. When a Fat/Universal binary contains multiple Mach-O files for different CPU architectures, the API checks the first validly signed Mach-O and then performs subsequent checks on other included binaries without verifying the CA root of trust. An attacker can leverage this by creating a malformed Fat/Universal binary that contains an Apple-signed Mach-O as the first binary and a malicious, adhoc-signed Mach-O for a non-native CPU architecture. By setting the CPU_TYPE of the Apple-signed binary to an invalid or non-native type, the system's loader skips it and executes the malicious code.

**Weaknesses/vulnerabilities present:**

-   **Insufficient verification of nested formats:** The code signing API does not properly verify all code signatures within a Fat/Universal binary.
-   **Preference for native CPU architecture:**  The API prioritizes the native CPU architecture for code signing checks.
-   **Lack of CA root of trust verification:**  The API does not verify the CA root of trust for all binaries in a Fat/Universal file after the initial check.
-   **Adhoc signing bypass:** The vulnerability allows adhoc signed binaries to bypass code signing checks when included in malformed Fat/Universal binaries
-   **TeamIdentifier weakness:** The "TeamIdentifier=not set" for both legitimate Apple-signed binaries and ad-hoc signed binaries contributes to the bypass.

**Impact of exploitation:**

-   **Bypassing code signing checks:** Allows execution of unsigned or malicious code by making it appear as if it is signed by Apple, leading to a complete bypass of code signing security mechanisms.
-   **Undermining security tools:** Weakens the effectiveness of security, forensics, and incident response tools that rely on code signing for whitelisting, antivirus, incident response, and threat hunting.
-   **Potential for malware execution:** Allows attackers to execute malicious code on macOS systems by disguising it as validly signed Apple software.

**Attack vectors:**

-   **Malformed Fat/Universal Binary:** The primary attack vector is the use of a specially crafted Fat/Universal binary.
-   **CPU_TYPE manipulation:** Setting the CPU\_TYPE of the initial Apple-signed binary to an invalid or non-native type.

**Required attacker capabilities/position:**

-   Ability to create a Fat/Universal file.
-   Ability to obtain or create a malicious adhoc signed Mach-O binary, and obtain an Apple-signed binary.
-   Knowledge of the Fat/Universal file format and CPU type specifications.
-   No need for admin access, JIT'ing code, or memory corruption