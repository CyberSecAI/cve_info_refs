=== Content from bugzilla.maptools.org_8a0c89a7_20250125_140209.html ===


|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Search](query.cgi)
* |
* | [Reports](report.cgi)
* | [New Account](createaccount.cgi)
* |
  [Help](docs/en/html/bug_page.html)
* | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2790&GoAheadAndLogIn=1)

*First*
*Last*
*Prev*
*Next*

*No search results available*

[**Bug 2790**](show_bug.cgi?id=2790) -
detected memory leaks in \_TIFFmalloc libtiff/tif\_unix.c:241 (CVE-2018-10801)

| Summary: | detected memory leaks in \_TIFFmalloc libtiff/tif\_unix.c:241 (CVE-2018-10801) |
| --- | --- |

| | **[Status](page.cgi?id=fields.html#status)**: | RESOLVED INVALID | | --- | --- | |  | | | **Product**: | libtiff | | **[Component](describecomponents.cgi?product=libtiff):** | default | | **Version**: | 3.8.2 | | **Platform**: | PC Linux | |  | | | **[Importance](page.cgi?id=fields.html#importance)**: | P2 enhancement | | **Target Milestone**: | --- | | **[Assigned To](page.cgi?id=fields.html#assigned_to)**: | Frank Warmerdam | |  | | | **URL**: |  | | **Whiteboard**: |  | | | **[Keywords](describekeywords.cgi)**: |  | | |  | | | Depends on: |  | | Blocks: |  ||  | Show dependency [tree](showdependencytree.cgi?id=2790&hide_resolved=1) / [graph](showdependencygraph.cgi?id=2790) | | |  | | **Reported**: | 2018-05-07 03:45 by albertzjf@163.com | | --- | --- | | **Modified**: | 2019-02-13 07:00 ([History](show_activity.cgi?id=2790)) | |  | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| Attachments | |
| --- | --- |
| [**poc file**](attachment.cgi?id=854 "View the content of the attachment") (29 bytes, application/octet-stream)  [2018-05-07 03:45](#attach_854 "Go to the comment associated with the attachment"), albertzjf@163.com | [Details](attachment.cgi?id=854&action=edit) |
| [Add an attachment](attachment.cgi?bugid=2790&action=enter) (proposed patch, testcase, etc.) | |

| Note You need to [log in](show_bug.cgi?id=2790&GoAheadAndLogIn=1) before you can comment on or make changes to this bug.   ---   *[Description](show_bug.cgi?id=2790#c0) From albertzjf@163.com  2018-05-07 03:45:03* ``` [Created an attachment (id=854)](attachment.cgi?id=854 "poc file") [[details]](attachment.cgi?id=854&action=edit "poc file") poc file  Description of problem:  detected memory leaks in _TIFFmalloc libtiff/tif_unix.c:241  How reproducible:  ./bmp2tiff  POC  /dev/null    ================================================================= ==4921==ERROR: LeakSanitizer: detected memory leaks  Direct leak of 730 byte(s) in 1 object(s) allocated from:     #0 0x7fef5ce42602 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x98602)     #1 0x4362df in _TIFFmalloc /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:241     #2 0x44087d in TIFFClientOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_open.c:161     #3 0x4361c9 in TIFFFdOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:139     #4 0x4362ac in TIFFOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:178     #5 0x4026b8 in main /home/puppet/test_object_pic/tiff-3.8.2/tools/bmp2tiff.c:272     #6 0x7fef5c28482f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)  Indirect leak of 1328 byte(s) in 1 object(s) allocated from:     #0 0x7fef5ce42602 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x98602)     #1 0x4362df in _TIFFmalloc /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:241     #2 0x415afd in TIFFMergeFieldInfo /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_dirinfo.c:583     #3 0x41579b in _TIFFSetupFieldInfo /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_dirinfo.c:545     #4 0x4134ed in TIFFDefaultDirectory /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_dir.c:1036     #5 0x4415b3 in TIFFClientOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_open.c:349     #6 0x4361c9 in TIFFFdOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:139     #7 0x4362ac in TIFFOpen /home/puppet/test_object_pic/tiff-3.8.2/libtiff/tif_unix.c:178     #8 0x4026b8 in main /home/puppet/test_object_pic/tiff-3.8.2/tools/bmp2tiff.c:272     #9 0x7fef5c28482f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)  SUMMARY: AddressSanitizer: 2058 byte(s) leaked in 2 allocation(s).   This vulnerability was triggered in  _TIFFmalloc at libtiff/tif_unix.c:241  void* _TIFFmalloc(tsize_t s) {         return (malloc((size_t) s)); }   Actual results:  crash  Expected results:  crash  Additional info:  This vulnerability is detected by NESA Lab(nesa.zju.edu.cn), with our custom seed generate system, SmartSeed. Please contact  puppet@zju.edu.cn  and albertzjf@163.com if you need more info about the team, the tool or the vulnerability. ------- Comment ```  ------- *Comment [#1](show_bug.cgi?id=2790#c1) From Petr Gajdos  2018-08-14 10:57:51* ------- ``` Had POC actually existed while you run the command above?  $ valgrind -q --leak-check=full bmp2tiff POC1 out.tiff POC1: Cannot open input file. ==15183==  ==15183== 2,057 (729 direct, 1,328 indirect) bytes in 1 blocks are definitely lost in loss record 1 of 2 ==15183==    at 0x4C256AE: malloc (in /usr/lib64/valgrind/amd64-linux/vgpreload_memcheck.so) ==15183==    by 0x4E6FBF9: _TIFFmalloc (tif_unix.c:244) ==15183==    by 0x4E61987: TIFFClientOpen (tif_open.c:161) ==15183==    by 0x4E6FB0A: TIFFFdOpen (tif_unix.c:139) ==15183==    by 0x4E6FBB2: TIFFOpen (tif_unix.c:178) ==15183==    by 0x40102C: main (bmp2tiff.c:272) $  I tried to pair tif and tif->tif_fieldinfo allocs with corresponding frees, but all was matching for POC testcase.  Anyway, I think this memory leak is harmless as it happens at the end of bmp2tiff, as far as I can see. ```  ------- *Comment [#2](show_bug.cgi?id=2790#c2) From Thomas Bernard  2019-02-13 07:00:34* ------- ``` bmp2tiff is not supported anymore, it was removed from libtiff distribution ``` |
| --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=2790)
* - [XML](show_bug.cgi?ctype=xml&id=2790)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=2790)
* - Top of page

*First*
*Last*
*Prev*
*Next*

*No search results available*

* Actions:
  + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Search](query.cgi)
  + |
  + | [Reports](report.cgi)
  + | [New Account](createaccount.cgi)
  + |
    [Help](docs/en/html/bug_page.html)
  + | [Log In](http://bugzilla.maptools.org/show_bug.cgi?id=2790&GoAheadAndLogIn=1)


