=== Content from twitter.com_4f89936e_20250126_064340.html ===



=== Content from www.atredis.com_a11d425a_20250125_063308.html ===

[0](/cart)

[Skip to Content](#page)

[![Atredis Partners](//images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1566943528908-J56DPCZRQ9SVG4TFPP27/WhiskeyBirdTextOverlayWhite.png?format=1500w)](/)

[About](/)

[Ownership](/ownership)

[Team](/team)

[Pentesting](/pentesting)

[Embedded](/embedded)

[Risk](/risk)

[Contact](/contact)

[Careers](/careers)

[Blog](/blog)

Open Menu
Close Menu

[![Atredis Partners](//images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1566943528908-J56DPCZRQ9SVG4TFPP27/WhiskeyBirdTextOverlayWhite.png?format=1500w)](/)

[About](/)

[Ownership](/ownership)

[Team](/team)

[Pentesting](/pentesting)

[Embedded](/embedded)

[Risk](/risk)

[Contact](/contact)

[Careers](/careers)

[Blog](/blog)

Open Menu
Close Menu

[About](/)

[Ownership](/ownership)

[Team](/team)

[Pentesting](/pentesting)

[Embedded](/embedded)

[Risk](/risk)

[Contact](/contact)

[Careers](/careers)

[Blog](/blog)

# Escalating Privileges with CylancePROTECT

May 1

Written By [Ryan Hanson](/blog?author=5ae89ee9a4f002409e2343a9)

If you regularly perform penetration tests, red team exercises, or endpoint assessments, chances are you've probably encountered CylancePROTECT at some point. Depending on the CylancePROTECT policy configuration, your standard tools and techniques may not have worked as expected. I've ran into situations where the administrators of CylancePROTECT set the policy to be too relaxed and establishing a presence on the target system was trivial. With that said, I've also encountered targets where the policy was very strict and gaining a stable, reliable shell was not an easy task.

After a few frustrating CylancePROTECT encounters, I decided to install it locally and learn more about how it works to try and make my next encounter less frustrating. The majority of CylancePROTECT is written in .NET, so I started by firing up [dnSpy](https://github.com/0xd4d/dnSpy), loaded the assemblies, and started looking around. I spent several nights and weekends casually looking through the codebase (which is quite massive) and found myself spending most of my time analyzing how the CylanceUI process communicated with the CylanceSvc process. My hope was that I would find a secret command I could use to stop the service as a user, but no such command exists (for users). However, I did find a privilege escalation vulnerability that could be triggered as a user via the inter-process communication ("IPC") channels.

Several commands can be sent to the CylanceSvc from the CylanceUI process via the tray menu, some of which are enabled by starting the UI with the advanced flag: `CylanceUI.exe /advanced`

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196199636-LBDR2OHOYFREZOEDZ69M/image-asset.png)

CylanceUI Advanced Menu

Prior to starting a deeper investigation of the different menu options, I used Process Monitor to get high level view of how CylancePROTECT interacted with Windows when I clicked these menu options. My favorite option ended up being the logging verbosity, not only because it gave me an even deeper insight into what CylancePROTECT was doing, but also because it plays a major role in this privilege escalation vulnerability. The 'Check for Updates' option also caught my eye in procmon because it caused the CyUpdate process to spawn as SYSTEM.

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196673850-QEY8NBG2I07JXTDDR6RD/image-asset.png)

CyUpdate Spawning as SYSTEM

The procmon output I witnessed at this point told me quite a bit and was what made me begin my hunt for a possible privilege escalation vulnerability. The three main indicators were:

1. As a user, I could communicate with the CylanceSvc service and influences its behavior
2. As a user, I could trigger the CyUpdate process to spawn with SYSTEM privileges
3. As a user, I could cause the CylanceUI process to write to the same file/folder as the SYSTEM process

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196682301-ENJM6RFCVAQZMVPWZ6FL/image-asset.png)

CylanceUI and CylanceSvc writing to log

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196692599-FSJRX5MA6GMCTECS0B1A/image-asset.png)

CyUpdate writing to log

The third indicator is the most important. It’s not uncommon for a user process and system process to share the same resource, but it is uncommon for the user process to have full read/write permissions to that resource. I confirmed the permissions on the log folder and files with icacls:

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525197381358-EK10K4CPY1JDG9A23KP5/image-asset.png)

Log folder and File Modify Permissions

Having modify permissions on a folder will allow for it to be setup as a mount point to redirect read/write operations to another location. I confirmed this by using James Forshaw's [symboliclink-testing-tool](https://github.com/google/symboliclink-testing-tools)[s](https://github.com/google/symboliclink-testing-tools) to create a mount point, as well as try other symbolic link vectors. Before creating the mount point, I made sure to set CylancePROTECT’s log level to 'Error' to prevent additional logs from being created after I emptied the log folder.

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525197328791-2899Y4MB47CUPYTXTNGQ/image-asset.png)

Log folder mount point created

After creating the mount point, I increased the log verbosity and confirmed the log file was created in the mount point target folder, C:\Windows.

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196725281-Q6IAO2J3V80QTFEBRR8X/image-asset.png)

CylanceSvc writing log to C:\Windows\

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196737537-VUPSDHQEE262K17E85U5/image-asset.png)

CyUpdate change log file permissions

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525197229369-FMKMKCK4F9Q1BT8WC42Y/image-asset.png)

Log file modify permissions

Writing a log file to an arbitrary location is neat but doesn't demonstrate much impact or add value to an attack vector. To gain SYSTEM privileges with this vector, I needed to be able to control the filename that was written, as well as the contents of the file. Neither of these tasks can be accomplished by interacting with CylancePROTECT via the IPC channels. However, I was able to use one of Forshaw's clever symbolic link tricks to control the name of the file. This is done by using two symbolic links that are setup like this:

1. **C:\Program Files\Cylance\Desktop\log** mount point folder points to the **\RPC Control\** object directory.
2. **\RPC Control\2018-03-20.log** symlink points to **\??\C:\Windows\evil.dll**

One of James' symbolic link testing tools will automatically create this symlink chain by simply specifying the original file and target destination, in this case the command looked like this, **CreateSymlink.exe "C:\Program Files\Cylance\Desktop\log\2018-03-20.log" C:\Windows\evil.dll**, and the result was:

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196746199-EWX5ONQMKBJJX7TJ2DS4/image-asset.png)

Creating symlink chain to control filename

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196750494-N6MSJ4KBLTRVHDWCBR85/image-asset.png)

File with arbitrary name created in C:\Windows

At this point I've written a file to an arbitrary location with an arbitrary name and since the CyUpdate.exe process grants Users modify permissions on the "log file", I could overwrite the log contents with the contents of a DLL.

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196768224-TAH01PNADSJXOV0MZQO2/image-asset.png)

Contents of C:\Windows\evil.dll

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525197116164-ZMJWHRPWDBNX51ZS75TY/image-asset.png)

Verifying overwrite permissions

From here all I needed to get a SYSTEM shell was a DLL hijack in a SYSTEM service. I decided to target CylancePROTECT for this because I knew I could reliably spawn the CyUpdate process as a user. Leveraging Procmon again, I set my filters to:

1. Path contains .dll
2. Result contains NOT
3. Process is CyUpdate.exe

The resulting output in procmon looked like this:

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196950524-XN34J2SV9L945F9YBQU5/image-asset.png)

libc.dll hijack identified in procmon

Now all I had to do was setup the chain again, but this time point the symlink to **C:\Program Files\Cylance\Desktop\libc.dll** (any of the highlighted locations would have worked). This symlink gave me a modifiable DLL that I could force CylancePROTECT to load and execute, resulting in a SYSTEM shell:

![](https://images.squarespace-cdn.com/content/v1/576323cfd482e984e113fe9c/1525196965045-VNSK97Q352C8MY7JX84K/image-asset.png)

Gaining SYSTEM shell and stopping CylanceSvc

Elevating our privileges from a user to SYSTEM is great, but more importantly, we meet the conditions required to communicate with the CylancePROTECT kernel driver **CYDETECT**. This elevated privilege allows us to send the **ENABLE\_STOP** IOCTL code to the kernel driver and gracefully stop the service. In the screenshot above, you’ll notice the CylanceSvc is stopped as a result of loading the DLL.

Privilege escalation vulnerabilities via symbolic links are quite common. James Forshaw has [found many](https://bugs.chromium.org/p/project-zero/issues/list?can=1&q=symbolic&colspec=ID+Type+Status+Priority+Milestone+Owner+Summary&cells=ids) of them in Windows and other Microsoft products. The initial identification of these types of bugs can be performed without ever opening IDA or doing any sort of static analysis, as I’ve demonstrated above. With that said, it is still a good idea to find the offending code and determine if it’s within a library that affects multiple services or an isolated issue.

Preventing symbolic link attacks may not be as easy as you would think. From a developer’s perspective, these types of vulnerabilities don’t stand out like a SQLi, XSS, or RCE bug since they’re typically a hard to spot permissions issue. When privileged services need to share file system resources with low-privileged users, it is very important that the user permissions are minimal.

Upon finding this vulnerability, Cylance was contacted, and a collaborative effort was made through [Bugcrowd](https://bugcrowd.com/) to remediate the finding. Cylance responded to the submission quickly and validated the finding within a few days. The fix was deployed 40 days after the submission and was included in the 1470 release of CylancePROTECT.

If you have any questions or comments, feel free to reach out to me on Twitter: [@ryHanson](https://twitter.com/ryhanson)

Atredis Partners has assigned this vulnerability the advisory ID: [ATREDIS-2018-0003](https://github.com/atredispartners/advisories/blob/master/ATREDIS-2018-0003.md).

The CVE assigned to this vulnerability is: [CVE-2018-10722](https://nvd.nist.gov/vuln/detail/CVE-2018-10722)

[![]()
Ryan Hanson](/blog?author=5ae89ee9a4f002409e2343a9)
<https://twitter.com/ryHanson>

[Previous
Previous
## GE Healthcare MAC 5500 Vulnerabilities](/blog/2018/5/14/ge-healthcare-mac-5500-vulnerabilities)

## [**Contact Us**](/contact)

---

**Follow us on:**[**Twitter**](https://twitter.com/atredis)**|**[**LinkedIn**](https://www.linkedin.com/company/atredis-partners)**|**[**Facebook**](https://www.facebook.com/atredispartners)**|**[**Instagram**](https://www.instagram.com/atredispartners)

**Copyright 2025, Atredis Partners | Bene Diagnoscitur, Bene Curatur |** [**Disclosure Policy**](/disclosure)



=== Content from github.com_39d158b4_20250126_064341.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fatredispartners%2Fadvisories%2Fblob%2Fmaster%2FATREDIS-2018-0003.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fatredispartners%2Fadvisories%2Fblob%2Fmaster%2FATREDIS-2018-0003.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=atredispartners%2Fadvisories)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[atredispartners](/atredispartners)
/
**[advisories](/atredispartners/advisories)**
Public

* [Notifications](/login?return_to=%2Fatredispartners%2Fadvisories) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fatredispartners%2Fadvisories)
* [Star
   55](/login?return_to=%2Fatredispartners%2Fadvisories)

* [Code](/atredispartners/advisories)
* [Issues
  0](/atredispartners/advisories/issues)
* [Pull requests
  0](/atredispartners/advisories/pulls)
* [Actions](/atredispartners/advisories/actions)
* [Projects
  0](/atredispartners/advisories/projects)
* [Security](/atredispartners/advisories/security)
* [Insights](/atredispartners/advisories/pulse)

Additional navigation options

* [Code](/atredispartners/advisories)
* [Issues](/atredispartners/advisories/issues)
* [Pull requests](/atredispartners/advisories/pulls)
* [Actions](/atredispartners/advisories/actions)
* [Projects](/atredispartners/advisories/projects)
* [Security](/atredispartners/advisories/security)
* [Insights](/atredispartners/advisories/pulse)

## Files

 master
## Breadcrumbs

1. [advisories](/atredispartners/advisories/tree/master)
/
# ATREDIS-2018-0003.md

Copy path Blame  Blame
## Latest commit

## History

[History](/atredispartners/advisories/commits/master/ATREDIS-2018-0003.md)50 lines (38 loc) · 3.59 KB master
## Breadcrumbs

1. [advisories](/atredispartners/advisories/tree/master)
/
# ATREDIS-2018-0003.md

Top
## File metadata and controls

* Preview
* Code
* Blame

50 lines (38 loc) · 3.59 KB[Raw](https://github.com/atredispartners/advisories/raw/refs/heads/master/ATREDIS-2018-0003.md)
# ATREDIS-2018-0003: CylancePROTECT Privilege Escalation Vulnerability

## Vulnerability Type

Privilege Escalation

## Vendors

* Cylance Inc.

## Affected Products

CylancePROTECT versions prior to 1470

## Summary

The CylancePROTECT update service gives Users Modify permissions on the log folder, as well as any log file it writes. This allows any user to empty the folder and use it as a Mount Point, which can be combined with a Symbolic Link to create an arbitrary file with Modify permissions when a new log file is created.

## Mitigation

Cylance has released an update (1470) that addresses the privilege escalation
vulnerability. Customers receiving automatic updates are already protected.
Otherwise, updating to the latest version of CylancePROTECT will mitigate this issue.

## Credit

This vulnerability was found by Ryan Hanson of Atredis Partners

## References

* <https://www.atredis.com/blog/cylance-privilege-escalation-vulnerability>
* <https://nvd.nist.gov/vuln/detail/CVE-2018-10722>
* <https://github.com/atredispartners/advisories/blob/master/ATREDIS-2018-0003.md>

## Report Timeline

* 2017-12-13: Atredis Partners sent an initial notification to Cylance
* 2017-12-14: Atredis Partners submits advisory and PoC to Cylance through Bugcrowd
* 2017-12-14: Cylance confirms receipt of advisory
* 2017-12-18: Cylance confirms the issue has been validated
* 2018-01-23: Atredis Partners asks Cylance for a status update
* 2018-01-23: Cylance indicates release was delayed and will provide release date when available
* 2018-01-26: Cylance notifies Atredis the 1470 release started its rollout
* 2018-01-28: Cylance awarded Ryan Hanson with $1,500 bounty on Bugcrowd
* 2018-02-02: Atredis Partners confirms the vulnerability has been fixed
* 2018-02-20: Atredis Partners requests coordinated disclosure
* 2018-04-04: Cylance and Atredis Partners arranged disclosure through blog post
* 2018-05-01: Atredis Partners plans to publish advisory ATREDIS-2018-0003

## Technical Details

To reproduce the vulnerability the user would first empty the log folder and then create the following mount point and symbolic link structure to create a DLL in the Cylance installation folder:

1. The `C:\Program Files\Cylance\Desktop\log` folder points to the `\RPC Control\` object directory.
2. The `\RPC Control\2017-12-14.log` symlink points to `\??\C:\Program Files\Cylance\Desktop\libc.dll`

To trigger the vulnerability, the CylanceUI.exe IPC channel is used to communicate with the CylanceSvc to set the logging level and check for update. Upon triggering an update, CyUpdate.exe is started and attempts to write to the log file `C:\Program Files\Cylance\Desktop\log\2017-12-14.log`. With the log folder mount point in place, the path resolves to `\RPC Control\2017-12-14.log`, which points to `\??\C:\Program Files\Cylance\Desktop\libc.dll`. The end result is a DLL created with modify permissions granted to all Users, allowing for it to be overwritten with a malicious DLL. It should be noted that any file can be created in any folder, this is not limited to the Cylance folder.

By combining the arbitrary file write with a DLL side-load in the CyUpdate.exe process, privileges can be escalated to SYSTEM. Upon startup, the CyUpdate process attempts to find a missing libc.dll in the Cylance folder. If libc.dll is found, the CyUpdate process loads it and triggers code execution. Since CyUpdate.exe is signed by Cylance and running as SYSTEM, it is permitted to communicate directly with the CYDETECT driver. By sending the ENABLE\_STOP IOCTL code, the malicious DLL can gain the ability to stop the CylanceSvc.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


