=== Content from github.com_9b501264_20250124_190817.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibreDWG%2Flibredwg%2Fissues%2F32)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FLibreDWG%2Flibredwg%2Fissues%2F32)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=LibreDWG%2Flibredwg)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[LibreDWG](/LibreDWG)
/
**[libredwg](/LibreDWG/libredwg)**
Public

* [Notifications](/login?return_to=%2FLibreDWG%2Flibredwg) You must be signed in to change notification settings
* [Fork
  246](/login?return_to=%2FLibreDWG%2Flibredwg)
* [Star
   1k](/login?return_to=%2FLibreDWG%2Flibredwg)

* [Code](/LibreDWG/libredwg)
* [Issues
  105](/LibreDWG/libredwg/issues)
* [Pull requests
  6](/LibreDWG/libredwg/pulls)
* [Discussions](/LibreDWG/libredwg/discussions)
* [Actions](/LibreDWG/libredwg/actions)
* [Projects
  1](/LibreDWG/libredwg/projects)
* [Security](/LibreDWG/libredwg/security)
* [Insights](/LibreDWG/libredwg/pulse)

Additional navigation options

* [Code](/LibreDWG/libredwg)
* [Issues](/LibreDWG/libredwg/issues)
* [Pull requests](/LibreDWG/libredwg/pulls)
* [Discussions](/LibreDWG/libredwg/discussions)
* [Actions](/LibreDWG/libredwg/actions)
* [Projects](/LibreDWG/libredwg/projects)
* [Security](/LibreDWG/libredwg/security)
* [Insights](/LibreDWG/libredwg/pulse)

# null pointer dereference in dwg\_obj\_block\_control\_get\_block\_headers #32

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[null pointer dereference in dwg\_obj\_block\_control\_get\_block\_headers](#top)#32Copy link[![@jinyu00](https://avatars.githubusercontent.com/u/18465642?v=4&size=80)](/jinyu00)
## Description

[![@jinyu00](https://avatars.githubusercontent.com/u/18465642?v=4&size=48)](/jinyu00)[jinyu00](https://github.com/jinyu00)opened [on Jul 20, 2018](https://github.com/LibreDWG/libredwg/issues/32#issue-343126665)

When open the crafted `dwg` file , it could tigger `null point dereference` in `dwg2svg2`

Let's see the gdb output

```

Program received signal SIGSEGV, Segmentation fault.
0x00000000005fc91c in dwg_obj_block_control_get_block_headers (ctrl=0xa51e30 <g_dwg+3088>, error=<optimized out>) at dwg_api.c:17897
17897	          ptx[i] = ctrl->block_headers[i];
LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA
─────────────────────────────────────────────────────────────────────────────────────────[ REGISTERS ]─────────────────────────────────────────────────────────────────────────────────────────
*RAX  0x7ffff7f6c800 ◂— 0xbebebebebebebebe
*RBX  0xa51e30 (g_dwg+3088) —▸ 0x60800000bfa0 ◂— 0x0
*RCX  0x7ffff7f6c800 ◂— 0xbebebebebebebebe
 RDX  0x0
 RDI  0x0
 RSI  0x0
 R8   0x0
*R9   0xa51e50 (g_dwg+3120) ◂— 0x0
*R10  0x14a3ca
*R11  0x7ffff7f8c818 ◂— 0x0
*R12  0x7ffff7f6c800 ◂— 0xbebebebebebebebe
*R13  0x4002
*R14  0x7fffffffe280 ◂— 0x41b58ab3
 R15  0x0
*RBP  0x7fffffffe210 —▸ 0x7fffffffe300 —▸ 0x7fffffffe330 —▸ 0x7fffffffe3e0 —▸ 0x71ed30 (__libc_csu_init) ◂— ...
*RSP  0x7fffffffe1f0 ◂— 0x0
*RIP  0x5fc91c (dwg_obj_block_control_get_block_headers+217) ◂— mov    rdx, qword ptr [rdx]
──────────────────────────────────────────────────────────────────────────────────────────[ DISASM ]───────────────────────────────────────────────────────────────────────────────────────────
 ► 0x5fc91c <dwg_obj_block_control_get_block_headers+217>    mov    rdx, qword ptr [rdx]
   0x5fc91f <dwg_obj_block_control_get_block_headers+220>    mov    rdi, rcx
   0x5fc922 <dwg_obj_block_control_get_block_headers+223>    mov    r8, rcx
   0x5fc925 <dwg_obj_block_control_get_block_headers+226>    shr    r8, 3
   0x5fc929 <dwg_obj_block_control_get_block_headers+230>    cmp    byte ptr [r8 + 0x7fff8000], 0
   0x5fc931 <dwg_obj_block_control_get_block_headers+238>    je     dwg_obj_block_control_get_block_headers+245 <0x5fc938>
    ↓
   0x5fc938 <dwg_obj_block_control_get_block_headers+245>    mov    qword ptr [rcx], rdx
   0x5fc93b <dwg_obj_block_control_get_block_headers+248>    add    rcx, 8
   0x5fc93f <dwg_obj_block_control_get_block_headers+252>    cmp    rcx, r11
   0x5fc942 <dwg_obj_block_control_get_block_headers+255>    jne    dwg_obj_block_control_get_block_headers+164 <0x5fc8e7>
    ↓
   0x5fc8e7 <dwg_obj_block_control_get_block_headers+164>    mov    rdx, rcx
───────────────────────────────────────────────────────────────────────────────────────[ SOURCE (CODE) ]───────────────────────────────────────────────────────────────────────────────────────
   17892     {
   17893       BITCODE_BS i;
   17894       *error = 0;
   17895       for (i=0; i < ctrl->num_entries; i++)
   17896         {
 ► 17897           ptx[i] = ctrl->block_headers[i];
   17898         }
   17899       return ptx;
   17900     }
   17901   else
   17902     {
───────────────────────────────────────────────────────────────────────────────────────────[
pwndbg> p ptx
$1 = (dwg_object_ref **) 0x7ffff7f6c800
pwndbg> p ctrl->block_headers
$2 = (Dwg_Object_Ref **) 0x0
pwndbg> bt
#0  0x00000000005fc91c in dwg_obj_block_control_get_block_headers (ctrl=0xa51e30 <g_dwg+3088>, error=<optimized out>) at dwg_api.c:17897
#1  0x0000000000403d88 in output_SVG (dwg=0xa51220 <g_dwg>) at dwg2svg2.c:358
#2  0x0000000000401af9 in test_SVG (filename=0x7fffffffe73a "segment_poc") at dwg2svg2.c:90
#3  0x0000000000404656 in main (argc=2, argv=0x7fffffffe4c8) at dwg2svg2.c:479
#4  0x00007ffff67b7830 in __libc_start_main (main=0x403fa3 <main>, argc=2, argv=0x7fffffffe4c8, init=<optimized out>, fini=<optimized out>, rtld_fini=<optimized out>, stack_end=0x7fffffffe4b8) at ../csu/libc-start.c:291
#5  0x0000000000401919 in _start ()
pwndbg>

```

As you can see , crash in

```
ptx[i] = ctrl->block_headers[i];

```

and `null point dereference` is **0** , so `null point dereference` 。

The Vulnerability is that `dwg_obj_block_control_get_block_headers` in `dwg_api.c` don't check the `ctrl->block_headers` .

```
dwg_object_ref **
dwg_obj_block_control_get_block_headers(const dwg_obj_block_control *restrict ctrl,
                                        int *restrict error)
{
  dwg_object_ref **ptx = (dwg_object_ref**)
    malloc(ctrl->num_entries * sizeof(Dwg_Object_Ref *));
  if (ptx)
    {
      BITCODE_BS i;
      *error = 0;
      for (i=0; i < ctrl->num_entries; i++)
        {
          ptx[i] = ctrl->block_headers[i];
        }
      return ptx;
    }
  else
    {
      *error = 1;
      LOG_ERROR("%s: null malloc", __FUNCTION__)
      return NULL;
    }
}

```

To fix it, please **verify the ctrl->block\_headers** before use it.

The poc file

```
https://gitee.com/hac425/fuzz_data/blob/master/poc.dwg

```
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


