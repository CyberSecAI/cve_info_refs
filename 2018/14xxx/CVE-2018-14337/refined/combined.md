=== Content from lists.debian.org_1a2d9dd8_20250124_215257.html ===


---

[[Date Prev](msg00005.html)][[Date Next](msg00007.html)]
[[Thread Prev](msg00005.html)][[Thread Next](msg00007.html)]
[[Date Index](maillist.html#00006)]
[[Thread Index](threads.html#00006)]

# [SECURITY] [DLA 2996-1] mruby security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2996-1] mruby security update
* *From*: Abhijith PA <abhijith@debian.org>
* *Date*: Fri, 6 May 2022 13:53:30 +0530
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YnTbAhG%2BNinH29bs%40disroot.org)Â [YnTbAhG+NinH29bs@disroot.org](msg00006.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-2996-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Abhijith PA
May 06, 2022                                  <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : mruby
Version        : 1.2.0+20161228+git30d5424a-1+deb9u1
CVE ID         : CVE-2017-9527 CVE-2018-10191 CVE-2018-11743 CVE-2018-12249
                 CVE-2018-14337 CVE-2020-15866

Multiple security issues were discovered in mruby, a lightweight
implementation of the Ruby language

CVE-2017-9527

    heap-based use-after-free vulnerability allows attackers to cause
    a denial of service or possibly have unspecified other impact via
    a crafted .rb file

CVE-2018-10191

    an integer overflow exists when handling OP_GETUPVAR in the
    presence of deep scope nesting, resulting in a use-after-free. An
    attacker that can cause Ruby code to be run can use this to
    possibly execute arbitrary code

CVE-2018-11743

    uninitialized pointer which allows attackers to cause a denial of
    service or possibly have unspecified other impact.

CVE-2018-12249

    There is a NULL pointer dereference in mrb_class_real because
    "class BasicObject" is not properly supported in class.c.

CVE-2018-14337

    a signed integer overflow, possibly leading to out-of-bounds
    memory access because the mrb_str_resize function in string.c does
    not check for a negative length

CVE-2020-15866

    a heap-based buffer overflow in the mrb_yield_with_class function
    in vm.c because of incorrect VM stack handling

For Debian 9 stretch, these problems have been fixed in version
1.2.0+20161228+git30d5424a-1+deb9u1.

We recommend that you upgrade your mruby packages.

For the detailed security status of mruby please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/mruby>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEE7xPqJqaY/zX9fJAuhj1N8u2cKO8FAmJ02wIACgkQhj1N8u2c
KO9D5Q/9HNnc1LRSZ7lJm8+yE+sN9Pd+58VprfzlSC5VQoxkRM0UBMUPrDzfLyTj
fs6rUn6tt78+XTorGj2nkB4REzEXVAcsdq09BZTs5kdQmYHxK1wSOcQKj6Dc5r34
jQcExVJvjWehqjKc7Y75OXIBCzzh7qBZnyDdM80Buaz1i4nSCpUCnFpcNLrlIhP5
AvYSuRyMBXTgPHY4XDvgBCMSuwq+Y5hf+6PWJXH/S/9g51lfvgz0dvhzR+zM2oQH
70CKeGVYhWugqpXFXlSFijeaDZAY2rBZCYvLvWistPSvNUVabrARaYNZPiAjGjYh
Z/k8tYKyV7pIv3sJft/8cMmK3hqQ9ZDrvPH0r9qBE0WfD/syexcpM2VHKSOQU+4n
nAWIo1TIp9vx5ob23vr+i/sg3CxRR5XeMLBrCGKsBqJBDnubRnJm/Zgm+euLgmDd
tCLOZG+KzNcf4Qtv5DlmpmKMFvbFRrEuYjPoQvKjykc/XqKnXel7VsW2yU4Qnr4l
5vOSBe1G2fXcJmYoPo1AB5LUBgYKygmEfX6WGXA9fdK5P3/JXBYUCo6c+AGTxEFZ
wcBKrc9f0LgwC65/mioAT02BRGQ4BjWeYbV38uX9f3KW8g+DnAaS7ao90ySMDu+d
lZEMt63HrehZxJheZMuqNdkHjeDiaLcZSjR15d460064SC2CbqM=
=b/x/
-----END PGP SIGNATURE-----

```

---



=== Content from github.com_9beb2338_20250124_215257.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F4062)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmruby%2Fmruby%2Fissues%2F4062)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=mruby%2Fmruby)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mruby](/mruby)
/
**[mruby](/mruby/mruby)**
Public

* [Notifications](/login?return_to=%2Fmruby%2Fmruby) You must be signed in to change notification settings
* [Fork
  793](/login?return_to=%2Fmruby%2Fmruby)
* [Star
   5.3k](/login?return_to=%2Fmruby%2Fmruby)

* [Code](/mruby/mruby)
* [Issues
  127](/mruby/mruby/issues)
* [Pull requests
  36](/mruby/mruby/pulls)
* [Discussions](/mruby/mruby/discussions)
* [Actions](/mruby/mruby/actions)
* [Projects
  0](/mruby/mruby/projects)
* [Wiki](/mruby/mruby/wiki)
* [Security](/mruby/mruby/security)
* [Insights](/mruby/mruby/pulse)

Additional navigation options

* [Code](/mruby/mruby)
* [Issues](/mruby/mruby/issues)
* [Pull requests](/mruby/mruby/pulls)
* [Discussions](/mruby/mruby/discussions)
* [Actions](/mruby/mruby/actions)
* [Projects](/mruby/mruby/projects)
* [Wiki](/mruby/mruby/wiki)
* [Security](/mruby/mruby/security)
* [Insights](/mruby/mruby/pulse)

# Signed integer overflow in mrb\_str\_formatÂ #4062

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosedClosed[Signed integer overflow in mrb\_str\_format](#top)#4062Copy link[![@clayton-shopify](https://avatars.githubusercontent.com/u/11052374?v=4&size=80)](/clayton-shopify)
## Description

[![@clayton-shopify](https://avatars.githubusercontent.com/u/11052374?v=4&size=48)](/clayton-shopify)[clayton-shopify](https://github.com/clayton-shopify)opened [on Jun 25, 2018](https://github.com/mruby/mruby/issues/4062#issue-335456965)

The check macro (in `/mrbgems/mruby-sprintf/src/sprintf.c`) contains an signed integer overflow in `bsize`:

```
#define CHECK(l) do {\
/*  int cr = ENC_CODERANGE(result);*/\
  while ((l) >= bsiz - blen) {\
    bsiz*=2;\
    if (bsiz < 0) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier"); \
  }\
  mrb_str_resize(mrb, result, bsiz);\
/*  ENC_CODERANGE_SET(result, cr);*/\
  buf = RSTRING_PTR(result);\
} while (0)
```

`bsiz*=2` can become negative. However with `-O2` the `mrb_raise` is never triggered, since `bsiz` is a signed integer. Signed integer overflows are undefined behaviour and thus `gcc` removes the check.

This results in negative integers being passed to `mrb_str_resize`, which will set the string length without further checks. This can potentially result in a oversized string that allows to access arbitrary memory.

In our experiments building with `gcc` in version `5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.9)` produces the vulnerable binary while `clang` generated a safe executable.

```
MRB_API mrb_value
mrb_str_resize(mrb_state *mrb, mrb_value str, mrb_int len)
{
  mrb_int slen;
  struct RString *s = mrb_str_ptr(str);

  mrb_str_modify(mrb, s);
  slen = RSTR_LEN(s);
  if (len != slen) {
    if (slen < len || slen - len > 256) { //check passes if len < 0
      resize_capa(mrb, s, len);
    }
    RSTR_SET_LEN(s, len); //string len is set to a large value
    RSTR_PTR(s)[len] = '\0';   /* sentinel */ //oob access
  }
  return str;
}
```
## Reproduce:

```
git clone https://github.com/mruby/mruby.git
cd mruby
git checkout 351614bbddb5f612ecf9572e975e78e058d2bf11
make
echo "' %8646911284551352320d'%1" | ./bin/mruby
Segmentation fault (core dumped)

```

Backtrace in `gdb`:

```
Starting program: /home/sergej/mruby/bin/mruby < crash1

Program received signal SIGSEGV, Segmentation fault.
0x000000000041d7d7 in mrb_str_resize (mrb=mrb@entry=0x6b8010,
    str=..., len=len@entry=-9223372036854775808)
    at /home/sergej/mruby/src/string.c:718
718	    RSTR_PTR(s)[len] = '\0';   /* sentinel */
(gdb) bt
#0  0x000000000041d7d7 in mrb_str_resize (
    mrb=mrb@entry=0x6b8010, str=...,
    len=len@entry=-9223372036854775808)
    at /home/sergej/mruby/src/string.c:718
#1  0x000000000046615c in mrb_str_format (
    mrb=mrb@entry=0x6b8010, argc=<optimized out>,
    argv=<optimized out>, fmt=...)
    at /home/sergej/mruby/mrbgems/mruby-sprintf/src/sprintf.c:966
#2  0x0000000000468492 in mrb_f_sprintf (mrb=0x6b8010, obj=...)
    at /home/sergej/mruby/mrbgems/mruby-sprintf/src/sprintf.c:520
#3  0x0000000000447231 in mrb_vm_exec (mrb=mrb@entry=0x6b8010,
    proc=<optimized out>, proc@entry=0x6b8f00,
    pc=<optimized out>) at /home/sergej/mruby/src/vm.c:1477
#4  0x0000000000449ecc in mrb_vm_run (mrb=0x6b8010,
    proc=0x6b8f00, self=..., stack_keep=<optimized out>)
    at /home/sergej/mruby/src/vm.c:948
#5  0x000000000044bf99 in mrb_top_run (mrb=mrb@entry=0x6b8010,
    proc=proc@entry=0x6b8f00, self=...,
    stack_keep=stack_keep@entry=0)
    at /home/sergej/mruby/src/vm.c:3010
#6  0x0000000000441021 in mrb_load_exec (mrb=mrb@entry=0x6b8010,
    p=<optimized out>, c=c@entry=0x711850)
    at /home/sergej/mruby/mrbgems/mruby-compiler/core/parse.y:5835
#7  0x0000000000442e85 in mrb_load_file_cxt (
    mrb=mrb@entry=0x6b8010, f=0x7ffff7ac88e0 <_IO_2_1_stdin_>,
    c=c@entry=0x711850)
    at /home/sergej/mruby/mrbgems/mruby-compiler/core/parse.y:5844
#8  0x0000000000402dc7 in main (argc=<optimized out>,
    argv=<optimized out>)
    at /home/sergej/mruby/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c:279

```
## Credits:

This issue was reported by Sergej Schumilo, Daniel Teuchert and Cornelius Aschermann (<https://hackerone.com/schumilo>).

## Impact

This results in negative integers being passed to `mrb_str_resize`, which will set the string length without further checks. This can potentially result in a oversized string that allows to access arbitrary memory.

## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


