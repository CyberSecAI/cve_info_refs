=== Content from medium.com_8c48e91d_20250124_145941.html ===
[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2Ff63a51ac2eb9&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderCollection&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fcoinmonks%2Fattack-on-pseudo-random-number-generator-prng-used-in-cryptogs-an-ethereum-cve-2018-14715-f63a51ac2eb9&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2Fcoinmonks%2Fattack-on-pseudo-random-number-generator-prng-used-in-cryptogs-an-ethereum-cve-2018-14715-f63a51ac2eb9&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Attack on Pseudo-random number generator(PRNG) used in Cryptogs, an Ethereum (CVE-2018–14715)

[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:88:88/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---byline--f63a51ac2eb9--------------------------------)[![Coinmonks](https://miro.medium.com/v2/resize:fill:48:48/1*-_aiJHzJPz655N7iSSrLrQ.png)](https://medium.com/coinmonks?source=post_page---byline--f63a51ac2eb9--------------------------------)

[Jonghyuk Song](/%40jonghyk.song?source=post_page---byline--f63a51ac2eb9--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F8218b7b42412&operation=register&redirect=https%3A%2F%2Fmedium.com%2Fcoinmonks%2Fattack-on-pseudo-random-number-generator-prng-used-in-cryptogs-an-ethereum-cve-2018-14715-f63a51ac2eb9&user=Jonghyuk+Song&userId=8218b7b42412&source=post_page-8218b7b42412--byline--f63a51ac2eb9---------------------post_header-----------)

Published in[Coinmonks](https://medium.com/coinmonks?source=post_page---byline--f63a51ac2eb9--------------------------------)·4 min read·Jul 30, 2018

--

Listen

Share

# Abstract

[Cryptogs](https://cryptogs.io/) is the game of pogs on the Ethereum blockchain[1]. It is a kind of game of slap-match. This game generates random numbers using `blockhash(uint blockNumber)` to decide the winner. In Solidity, `blockhash(uint blockNumber)` function returns ‘0’ when `blockNumber` is older than 256 blocks from the current block(`block.number`)[[2]](https://solidity.readthedocs.io/en/latest/units-and-global-variables.html). Cryptogs doesn’t check the `blockNumber` whether it is too old or not, so attackers can predict the random numbers and always win.

# Details

There are two functions generating random numbers: `endCoinFlip()` and `throwSlammer()`. Both functions required preliminary functions: `startCoinFlip()` and `raiseSlammer()`.

First, let’s check `startCoinFlip()` and `endCoinFlip()`. The two functions decide who goes first.

![]()

Figure 1. startCoinFlip()

In `startCoinFlip()`, it stores the current block number `block.number` into `commitBlock[_stack]`.

![]()

Figure 2. endCoinFlip()

After calling `startCoinFlip()`, players should call `endCoinFlip()`. In `endCoinFlip()`, it generates random numbers using `keccak256()` with `_reveal` and blockhash of `commitBlock[_stack]`. As you can see in Figure 2, at line 464, `uint32(block.number) > commitBlock[_stack]` is the only condition for `commitBlock[_stack]`. Therefore, players can call `endCoinFlip()` after long periods of time. In Solidity, however, `blockhash(uint blockNumber)` is only works for 256 most recent blocks[[2]](https://solidity.readthedocs.io/en/latest/units-and-global-variables.html).

![]()

`blockhash(uint blockNumber)` returns ‘0’ if `blockNumber` is older than 256 blocks from the current block. Therefore, if a player calls `endCoinFlip()` after 256 blocks from calling `startCoinFlip()`, the `pseudoRandomHash` is same with `keccak256(_reveal, 0)` because `block.blockhash(commitBlock[_stack])` is ‘0’. `_reveal` is an argument of `endCoinFlip()`, so players can put anything they want. Therefore, attackers can generate random numbers and get the first order.

Next, `raiseSlammer()` and `throwSlammer()` have the same vulnerability. In `raiseSlammer()`, the current block number `block.number` is stored into `commitBlock[_stack]`.

![]()

Figure 3. raiseSlammer()

Then, `pseudoRandomHash` is computed the same way as `endCoinFlip()` at line 554.

![]()

Figure 4. a part of throwSlammer()

At line 573, one byte of `pseudoRandomHash` is selected as `thisFlipper`. At line 575, `thisFlipper` is checked whether it is under 80 or not. If it is under 80, one pog is flipped and the player in that turn gets the pog.

Just like `endCoinFlip()`, if an attacker call `throwSlammer()` after 256 blocks from calling `raiseSlammer()`, `keccak256(_reveal, block.blockhash(commitBlock[_stack])` is same with `keccak256(_reveal, 0)`. So, attacker can generate `pseudoRandomNumber` as they want and get the all pogs.

# Exploit

So, the attack scenario is as follows:

1. Create a new game and wait until a victim join the game.
2. Call `startCoinFlip()` and wait until 256 blocks are generated
3. After 256 blocks, call `endCoinFlip()` and get the first order
4. Call `raiseSlammer()` and wait until 256 blocks are generated
5. After 256 blocks, call `throwSlammer()` and get all pogs at the first turn

If we want to proceed as the above scenario, we should compute the proper `pseudoRandomNumber` that satisfying the following conditions:

1. even → get the first order
2. all 10 bytes of most significant bytes are under 80 → get all 10 pogs at the first turn

Because of the vulnerability, `pseudoRandomNumber` is computed as `keccak256(_reveal, 0)`.So, I found when `_reveal` is ‘**0x20182**’, `pseudoRandomNumber` is ‘**0x262f33140b273901193bc3cc78c5c7f6abf498af8cc1faafc5d5454dd63e3dec**’ which is satisfying the above two conditions.

I exploited Cryptogs in Ropsten test network[[3]](https://ropsten.etherscan.io/tx/0xed84edc7644eb4da5f91182b8bb638e9e7ad8cb2f17ebfec9d14ecca542a3a9c).

![]()

Figure 5. exploit result

Figure 5 shows the exploit result that I recorded. As you can see, I can get all 10 pogs at the first turn.

# Report

I reported it to the developer and he replied to me very quickly. He said that he probably will not fix the vulnerability because there are no players in Cryptogs. So, I do not recommend playing Cryptogs. But, he said he will check his new game, [Galleass](https://austingriffith.com/portfolio/galleass/), whether there is the same vulnerability.

Surprisingly, he gave me some bug bounty. At first I refused the bounty but he kept trying to give the bounty to me, so I finally received the bounty. I found several vulnerable smart contracts so far, but he is the first developer who give the bounty. As a security researcher, I think there should be more people like the developer of Cryptogs. So, I hope that bug hunters get the proper compensation.

# Conclusion

When you generates random numbers using blockhash, you should remind that `blockhash(uint blockNumber)` is only works for 256 most recent blocks. If you try to use `blockhash` with too old block, it will return ‘0’.

# References

[1] [https://cryptogs.io](https://cryptogs.io/)

[2] <https://solidity.readthedocs.io/en/latest/units-and-global-variables.html>

[3] <https://ropsten.etherscan.io/tx/0xed84edc7644eb4da5f91182b8bb638e9e7ad8cb2f17ebfec9d14ecca542a3a9c>

> [Get Best Software Deals Directly In Your Inbox](https://coincodecap.com/?utm_source=coinmonks)

[![]()](https://coincodecap.com/?utm_source=coinmonks)[Ethereum](/tag/ethereum?source=post_page-----f63a51ac2eb9--------------------------------)[Smart Contracts](/tag/smart-contracts?source=post_page-----f63a51ac2eb9--------------------------------)[Vulner](/tag/vulner?source=post_page-----f63a51ac2eb9--------------------------------)[Hacking](/tag/hacking?source=post_page-----f63a51ac2eb9--------------------------------)[Blockchain](/tag/blockchain?source=post_page-----f63a51ac2eb9--------------------------------)

--

--

[![Coinmonks](https://miro.medium.com/v2/resize:fill:96:96/1*-_aiJHzJPz655N7iSSrLrQ.png)](https://medium.com/coinmonks?source=post_page---post_publication_info--f63a51ac2eb9--------------------------------)[![Coinmonks](https://miro.medium.com/v2/resize:fill:128:128/1*-_aiJHzJPz655N7iSSrLrQ.png)](https://medium.com/coinmonks?source=post_page---post_publication_info--f63a51ac2eb9--------------------------------)[## Published in Coinmonks](https://medium.com/coinmonks?source=post_page---post_publication_info--f63a51ac2eb9--------------------------------)[96K Followers](/coinmonks/followers?source=post_page---post_publication_info--f63a51ac2eb9--------------------------------)·[Last published just now](/coinmonks/trading-tip-of-the-day-9273aa9201af?source=post_page---post_publication_info--f63a51ac2eb9--------------------------------)

Coinmonks is a non-profit Crypto Educational Publication. Other Project — <https://coincodecap.com/> & Email — gaurav@coincodecap.com

[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:96:96/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---post_author_info--f63a51ac2eb9--------------------------------)[![Jonghyuk Song](https://miro.medium.com/v2/resize:fill:128:128/0*82g6owIHKpt2yAmc.)](/%40jonghyk.song?source=post_page---post_author_info--f63a51ac2eb9--------------------------------)Follow[## Written by Jonghyuk Song](/%40jonghyk.song?source=post_page---post_author_info--f63a51ac2eb9--------------------------------)[86 Followers](/%40jonghyk.song/followers?source=post_page---post_author_info--f63a51ac2eb9--------------------------------)·[10 Following](/%40jonghyk.song/following?source=post_page---post_author_info--f63a51ac2eb9--------------------------------)

Vehicle Threat Research Lab. at Autocrypt . (<https://freest4r.github.io/>)

Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----f63a51ac2eb9--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----f63a51ac2eb9--------------------------------)[About](/about?autoplay=1&source=post_page-----f63a51ac2eb9--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----f63a51ac2eb9--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----f63a51ac2eb9--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----f63a51ac2eb9--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----f63a51ac2eb9--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----f63a51ac2eb9--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----f63a51ac2eb9--------------------------------)[Teams](/business?source=post_page-----f63a51ac2eb9--------------------------------)


