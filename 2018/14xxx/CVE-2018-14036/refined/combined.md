=== Content from bugzilla.suse.com_8b6afab4_20250125_231122.html ===


| Bugzilla – Bug 1099699 | VUL-1: CVE-2018-14036: accountsservice: insufficient path check in user\_change\_icon\_file\_authorized\_cb() | Last modified: 2020-11-04 09:04:27 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1099699)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**Bug 1099699**](show_bug.cgi?id=1099699)
(CVE-2018-14036)
- VUL-1: CVE-2018-14036: accountsservice: insufficient path check in user\_change\_icon\_file\_authorized\_cb()

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-1: CVE-2018-14036: accountsservice: insufficient path check in user\_chang...

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | | Duplicates (1): | [1101332](show_bug.cgi?id=1101332 "RESOLVED DUPLICATE - VUL-0: CVE-2018-14036: accountsservice: insufficient path check in user_change_icon_file_authorized_cb() in user.c")  ([view as bug list](buglist.cgi?bug_id=1101332)) | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2018-14036 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Security Team bot | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/209179/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | CVSSv3:NVD:CVE-2018-14036:6.5:(AV:N/A... | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-06-29 13:53 UTC by Matthias Gerstner | | --- | --- | | Modified: | 2020-11-04 09:04 UTC ([History](show_activity.cgi?id=1099699)) | | CC List: | 8 users (show)  atoptsoglou gejlit karol matthias.gerstner meissner security-team wolfgang.frisch yfjiang | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1099699) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1099699&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1099699&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1099699#c0)  Matthias Gerstner   2018-06-29 13:53:30 UTC  ``` I found an issue in accountsservice in the context of security audits for other desktop components like Cinnamon. I have reported this privately to the two Red-Hat developers mentioned as AUTHORS stating the following:  I have found a weakness regarding the handling of the users' icon files. Regular users are by default allowed to change their own data as per polkit rule for action org.freedesktop.accounts.change-own-user-data.  In function user_change_icon_file_authorized_cb() in src/user.c there is quite some effort for safely setting the icon file property. The logic wants to achieve the following:  a) take over the provided path as is, if it points to a world-readable   file in /usr/share b) otherwise safely copy the file with user privileges into   /var/lib/AccountsService/icons, and use that path as the property   value  The following if clause tries to determine whether a) is the case:          if ((mode & S_IROTH) == 0 ||             (!g_str_has_prefix (filename, DATADIR) &&              !g_str_has_prefix (filename, ICONDIR))) {  However, the prefix check is insufficient. Passing ../ components in the user supplied path can circumvent the check like this:  $ touch /tmp/test $ dbus-send --system --print-reply --dest=org.freedesktop.Accounts /org/freedesktop/Accounts/User1000 org.freedesktop.Accounts.User.SetIconFile string:/usr/share/../../tmp/test $ rm /tmp/test $ ln -s /root/.bash_history /tmp/test  Now the accountsservice stores /usr/share/../../tmp/test as icon file path, which actually points to /root/.bash_history. A third party application that trusts this property can potentially read from this location as root and tries to interpret it as an image file. This is for example the case for Cinnamon desktop in the cinnamon-settings-users GUI application. Luckily it does not simply copy the file, but tries to read it into an image object first. There may be other clients of accountsservice where this leads to more severe consequences.  I think the easiest way to fix this is to normalize the user supplied filename e.g. using realpath(), before making the test above. ``` [Comment 1](show_bug.cgi?id=1099699#c1)  Matthias Gerstner   2018-06-29 13:54:23 UTC  ``` This issue is still confidential. No reply yet from the devs. ``` [Comment 2](show_bug.cgi?id=1099699#c2)  Matthias Gerstner   2018-07-02 10:50:09 UTC  ``` An upstream dev replied by now. They confirm the issue, don't deem it very severe though. I generally agree, but since third-party uses of the accountsservice could be naively implemented it should still be handled with care IMO.  This is published now via an upstream bug here:  <https://bugs.freedesktop.org/show_bug.cgi?id=107085>  In the bug you can also find a patch suggested by me for addressing the issue. ``` [Comment 3](show_bug.cgi?id=1099699#c3)  Johannes Segitz   2018-07-02 12:11:33 UTC  ``` (In reply to Matthias Gerstner from [comment #2](show_bug.cgi?id=1099699#c2)) agreed, so lets take this as a VUL-1 ``` [Comment 4](show_bug.cgi?id=1099699#c4)  Karol Babioch   2018-07-16 12:16:52 UTC  ``` *** [Bug 1101332](show_bug.cgi?id=1101332 "RESOLVED DUPLICATE - VUL-0: CVE-2018-14036: accountsservice: insufficient path check in user_change_icon_file_authorized_cb() in user.c") has been marked as a duplicate of this bug. *** ``` [Comment 9](show_bug.cgi?id=1099699#c9)  Swamp Workflow Management   2018-11-05 20:15:13 UTC  ``` SUSE-SU-2018:3625-1: An update that solves one vulnerability and has two fixes is now available.  Category: security (moderate) Bug References: 1090003,1095918,1099699 CVE References: CVE-2018-14036 Sources used: SUSE Linux Enterprise Module for Desktop Applications 15 (src):    accountsservice-0.6.45-6.7.6 ``` [Comment 13](show_bug.cgi?id=1099699#c13)  Swamp Workflow Management   2019-10-24 19:17:07 UTC  ``` SUSE-SU-2019:2778-1: An update that solves one vulnerability and has one errata is now available.  Category: security (moderate) Bug References: 1099699,1139487 CVE References: CVE-2018-14036 Sources used: SUSE Linux Enterprise Software Development Kit 12-SP5 (src):    accountsservice-0.6.42-16.8.3 SUSE Linux Enterprise Software Development Kit 12-SP4 (src):    accountsservice-0.6.42-16.8.3 SUSE Linux Enterprise Server 12-SP5 (src):    accountsservice-0.6.42-16.8.3 SUSE Linux Enterprise Server 12-SP4 (src):    accountsservice-0.6.42-16.8.3 SUSE Linux Enterprise Desktop 12-SP5 (src):    accountsservice-0.6.42-16.8.3 SUSE Linux Enterprise Desktop 12-SP4 (src):    accountsservice-0.6.42-16.8.3  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 14](show_bug.cgi?id=1099699#c14)  Alexandros Toptsoglou   2020-07-10 13:27:08 UTC  ``` Done ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1099699)
* - [XML](show_bug.cgi?ctype=xml&id=1099699)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=1099699)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1099699)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from bugs.freedesktop.org_a3991c79_20250125_231121.html ===


Bugzilla – Bug 107085
accountsservice: insufficient path check in user\_change\_icon\_file\_authorized\_cb()
Last modified: 2018-07-10 14:04:58 UTC

* [Home](./)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

[**Bug 107085**](show_bug.cgi?id=107085)
- accountsservice: insufficient path check in user\_change\_icon\_file\_authorized\_cb()

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
accountsservice: insufficient path check in user\_change\_icon\_file\_authorized\_...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | accountsservice | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=accountsservice "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | general ([show other bugs](buglist.cgi?component=general&product=accountsservice&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other All | |  | | | [Importance](page.cgi?id=fields.html#importance): | medium normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Matthias Clasen | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2018-07-02 10:45 UTC by Matthias Gerstner | | --- | --- | | Modified: | 2018-07-10 14:04 UTC ([History](show_activity.cgi?id=107085)) | | CC List: | 4 users (show)  heirecka marius.vollmer rstrode stefw | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [i915 platform:](page.cgi?id=fields.html#cf_i915_platform "Intel platforms affected by the bug") |  | | [i915 features:](page.cgi?id=fields.html#cf_i915_features "Features of the i915 driver affected by the bug.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**Suggested Patch**](attachment.cgi?id=140419 "View the content of the attachment") (2.36 KB, patch)  [2018-07-02 10:46 UTC](#attach_140419 "Go to the comment associated with the attachment"), Matthias Gerstner | [Details](attachment.cgi?id=140419&action=edit) | [Splinter Review](https://bugs.freedesktop.org/page.cgi?id=splinter.html&bug=107085&attachment=140419) | | [View All](attachment.cgi?bugid=107085&action=viewall) | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=107085#c0)  Matthias Gerstner    2018-07-02 10:45:05 UTC  ``` This is a public report of an issue previously reported privately to the accountsservice developers via email.  I have found a weakness regarding the handling of the users' icon files. Regular users are by default allowed to change their own data as per polkit rule for action org.freedesktop.accounts.change-own-user-data.  In function user_change_icon_file_authorized_cb() in src/user.c there is quite some effort for safely setting the icon file property. The logic wants to achieve the following:  a) take over the provided path as is, if it points to a world-readable   file in /usr/share b) otherwise safely copy the file with user privileges into   /var/lib/AccountsService/icons, and use that path as the property   value  The following if clause tries to determine whether a) is the case:          if ((mode & S_IROTH) == 0 ||             (!g_str_has_prefix (filename, DATADIR) &&              !g_str_has_prefix (filename, ICONDIR))) {  However, the prefix check is insufficient. Passing ../ components in the user supplied path can circumvent the check like this:  $ touch /tmp/test $ dbus-send --system --print-reply --dest=org.freedesktop.Accounts /org/freedesktop/Accounts/User1000 org.freedesktop.Accounts.User.SetIconFile string:/usr/  share/../../tmp/test $ rm /tmp/test $ ln -s /root/.bash_history /tmp/test  Now the accountsservice stores /usr/share/../../tmp/test as icon file path, which actually points to /root/.bash_history. A third party application that trusts this property can potentially read from this location as root and tries to interpret it as an image file. This is for example the case for Cinnamon desktop in the cinnamon-settings-users GUI application. Luckily it does not simply copy the file, but tries to read it into an image object first. There may be other clients of accountsservice where this leads to more severe consequences.  I think the easiest way to fix this is to normalize the user supplied filename e.g. using realpath(), before making the test above. ```  [Comment 1](show_bug.cgi?id=107085#c1)  Matthias Gerstner    2018-07-02 10:46:57 UTC  ``` Created [attachment 140419](attachment.cgi?id=140419 "Suggested Patch") [[details]](attachment.cgi?id=140419&action=edit "Suggested Patch") [[review]](page.cgi?id=splinter.html&bug=107085&attachment=140419) Suggested Patch  Adding a patch that tries to address this issue by canonicalizing the input filename. ```  [Comment 2](show_bug.cgi?id=107085#c2)  Ray Strode [halfline]    2018-07-10 14:04:58 UTC  ``` Pushed with some small changes:  To ssh://git.freedesktop.org/git/accountsservice    34bedec..f9abd35  master -> master ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=107085)
* - Top of page

* + [Home](./)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

Use of freedesktop.org services, including Bugzilla, is subject to our [Code of Conduct](https://www.freedesktop.org/wiki/CodeOfConduct/). How we collect and use information is described in our [Privacy Policy](https://www.freedesktop.org/wiki/PrivacyPolicy).



=== Content from www.openwall.com_b66a2c2b_20250125_231117.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20180702122122.GD8324@f195.suse.de>
Date: Mon, 2 Jul 2018 14:21:22 +0200
From: Matthias Gerstner <mgerstner@...e.de>
To: oss-security@...ts.openwall.com
Subject: accountsservice: insufficient path check in
 user_change_icon_file_authorized_cb()

Hello,

during a code review the following issue was uncovered in
accountsservice <<https://www.freedesktop.org/wiki/Software/AccountsService/>>:

I have found a weakness regarding the handling of the users' icon files.
Regular users are by default allowed to change their own data as per
polkit rule for action org.freedesktop.accounts.change-own-user-data.

In function user_change_icon_file_authorized_cb() in src/user.c there is
quite some effort for safely setting the icon file property. The logic
wants to achieve the following:

a) take over the provided path as is, if it points to a world-readable
  file in /usr/share
b) otherwise safely copy the file with user privileges into
  /var/lib/AccountsService/icons, and use that path as the property
  value

The following if clause tries to determine whether a) is the case:

        if ((mode & S_IROTH) == 0 ||
            (!g_str_has_prefix (filename, DATADIR) &&
             !g_str_has_prefix (filename, ICONDIR))) {

However, the prefix check is insufficient. Passing ../ components in the
user supplied path can circumvent the check like this:

$ touch /tmp/test
$ dbus-send --system --print-reply --dest=org.freedesktop.Accounts \
	/org/freedesktop/Accounts/User1000 \
	org.freedesktop.Accounts.User.SetIconFile \
	string:/usr/share/../../tmp/test
$ rm /tmp/test
$ ln -s /root/.bash_history /tmp/test

Now the accountsservice stores /usr/share/../../tmp/test as icon file
path, which actually points to /root/.bash_history. A third party
application that trusts this property can potentially read from this
location as root and try to interpret it as an image file. This is for
example the case for Cinnamon desktop in the cinnamon-settings-users GUI
application. Luckily in this example it does not simply copy the file,
but tries to read it into an image object first. There may be other
clients of accountsservice where this leads to more severe consequences.

Suggested Fix:

I think the easiest way to fix this is to normalize the user supplied
filename e.g. using realpath(), before making the test above. A
preliminary patch that takes this approach is found in the upstream bug
referenced below and also attached to this mail.

References:

OpenSUSE bug: <https://bugzilla.suse.com/show_bug.cgi?id=1099699>
Upstream bug: <https://bugs.freedesktop.org/show_bug.cgi?id=107085>

Timeline:

- 2018-06-28: I found the issue during a code review
- 2018-06-28: I privately disclosed the issue to the upstream developers
- 2018-07-02: The upstream developers agreed to publish the details

--
Matthias Gerstner <matthias.gerstner@...e.de>
Dipl.-Wirtsch.-Inf. (FH), Security Engineer
<https://www.suse.com/security>
Telefon: +49 911 740 53 290
GPG Key ID: 0x14C405C971923553

SUSE Linux GmbH
GF: Felix Imendörffer, Jane Smithard, Graham Norton
HRB 21284 (AG Nuernberg)

View attachment "[0001-user_change_icon_file_authorized_cb-fix-insufficient.patch](2/1)" of type "text/x-diff" (2413 bytes)

Download attachment "[signature.asc](2/2)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from cgit.freedesktop.org_6a35e07e_20250125_231124.html ===


| [cgit logo](/) | [index](/) : [accountsservice](/accountsservice/) | 50112 async-api cache-fix distcheck groups groups-squash main master object-manager usenie wip/fix-properties-changed-signal wip/fix-useradd wip/scalability-fixes wip/systemd |
| --- | --- | --- |
| D-Bus interface for user account query and manipulation (mirrored from https://gitlab.freedesktop.org/accountsservice/accountsservice) | root |

| [summary](/accountsservice/)[refs](/accountsservice/refs/?id=f9abd359f71a5bce421b9ae23432f539a067847a)[log](/accountsservice/log/)[tree](/accountsservice/tree/?id=f9abd359f71a5bce421b9ae23432f539a067847a)[commit](/accountsservice/commit/?id=f9abd359f71a5bce421b9ae23432f539a067847a)[diff](/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Matthias Gerstner <matthias.gerstner@suse.de> | 2018-07-10 09:51:47 -0400 |
| --- | --- | --- |
| committer | Ray Strode <rstrode@redhat.com> | 2018-07-10 09:55:59 -0400 |
| commit | [f9abd359f71a5bce421b9ae23432f539a067847a](/accountsservice/commit/?id=f9abd359f71a5bce421b9ae23432f539a067847a) ([patch](/accountsservice/patch/?id=f9abd359f71a5bce421b9ae23432f539a067847a)) | |
| tree | [d4bbace87219f370ad280095f28685fe3bdfd3f9](/accountsservice/tree/?id=f9abd359f71a5bce421b9ae23432f539a067847a) | |
| parent | [34bedecf7da81a8b42382254e3f9a32398c1ca5d](/accountsservice/commit/?id=34bedecf7da81a8b42382254e3f9a32398c1ca5d) ([diff](/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a&id2=34bedecf7da81a8b42382254e3f9a32398c1ca5d)) | |

user: fix insufficient path prefix checkThe path prefix check can be circumvented by regular users by passing
relative path component like so:
$ dbus-send --system --print-reply --dest=org.freedesktop.Accounts \
/org/freedesktop/Accounts/User1000 \
org.freedesktop.Accounts.User.SetIconFile \
string:/usr/share/../../tmp/test
This results in a user controlled path being stored in the
accountsservice. Clients of accountsservice may unwittingly trust this
path.
To fix that situation this commit canonicalizes the input path before
the prefix comparison.
Some small changes to patch by Ray Strode.
https://bugs.freedesktop.org/show\_bug.cgi?id=107085
NotesCVE-2018-14036
[Diffstat](/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a)

| -rw-r--r-- | [src/user.c](/accountsservice/diff/src/user.c?id=f9abd359f71a5bce421b9ae23432f539a067847a) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/src/user.c b/src/user.cindex c8a2942..174530f 100644--- a/[src/user.c](/accountsservice/tree/src/user.c?id=34bedecf7da81a8b42382254e3f9a32398c1ca5d)+++ b/[src/user.c](/accountsservice/tree/src/user.c?id=f9abd359f71a5bce421b9ae23432f539a067847a)@@ -1334,6 +1334,14 @@ user\_change\_icon\_file\_authorized\_cb (Daemon \*daemon, }  file = g\_file\_new\_for\_path (filename);+ g\_clear\_pointer (&filename, g\_free);++ /\* Canonicalize path so we can call g\_str\_has\_prefix on it+ \* below without concern for ../ path components moving outside+ \* the prefix+ \*/+ filename = g\_file\_get\_path (file);+ info = g\_file\_query\_info (file, G\_FILE\_ATTRIBUTE\_UNIX\_MODE "," G\_FILE\_ATTRIBUTE\_STANDARD\_TYPE "," G\_FILE\_ATTRIBUTE\_STANDARD\_SIZE, |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.39.1](https://git-scm.com/)) at 2025-01-25 23:11:24 +0000



=== Content from idp-portal.suse.com_6b95d262_20250126_124133.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.


