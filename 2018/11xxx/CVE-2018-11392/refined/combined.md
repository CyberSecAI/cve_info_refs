=== Content from packetstormsecurity.com_d129ac48_20250125_091627.html ===

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

[![](/logos/smalllogobeta.png)](/)

* files
* news
* users
* cve

![](/logos/linegray.png)

 [About](/help/view/4) |
[Terms](/tos/) |
[Copyright](/help/view/7) |
[Privacy](/help/view/6) |
[BlueSky](https://bsky.app/profile/packetstorm.bsky.social) |
[X](https://x.com/packet_storm) |
[Mastodon](https://infosec.exchange/%40packet_storm/)



=== Content from doddsecurity.com_ad7ebb55_20250125_091629.html ===

[Skip to the content](#site-content)

Search

[Dodd Security](https://doddsecurity.com)

Offensive Security and Application Security Perspectives

* [About](https://doddsecurity.com/about/)
* [Vulnerabilities](https://doddsecurity.com/published-vulnerabilities/)

* [About](https://doddsecurity.com/about/)
* [Vulnerabilities](https://doddsecurity.com/published-vulnerabilities/)

[Vulnerability Research](https://doddsecurity.com/category/vulnerability-research/)

# Remote Code Execution in the Avatars

Posted by [Reginald Dodd](https://doddsecurity.com/author/regg/) on [December 8, 2018](https://doddsecurity.com/94/remote-code-execution-in-the-avatars/)

![](https://doddsecurity.com/wp-content/uploads/2018/12/doddsecurity-post2-816x427.png)

Read Next →

[![](https://doddsecurity.com/wp-content/uploads/2023/05/geoserver2-400x200.png)

Vulnerability Research

### XXE in GeoServer](https://doddsecurity.com/412/xxe-in-geoserver/)
[![](https://doddsecurity.com/wp-content/uploads/2023/04/supportcandy-400x200.png)

Vulnerability Research

### Unauthorized Account Creation in SupportCandy](https://doddsecurity.com/396/unauthorized-account-creation-in-supportcandy/)
[![](https://doddsecurity.com/wp-content/uploads/2019/07/opencats-400x200.png)

Vulnerability Research

### XML External Entity Injection (XXE) in OpenCats Applicant Tracking System](https://doddsecurity.com/312/xml-external-entity-injection-xxe-in-opencats-applicant-tracking-system/)

Name: [PHP Login & User Management](https://codecanyon.net/item/php-login-user-management/49008)

Vendor: Jigowatt via the Envato Market Place

Vulnerability: Arbitrary File Upload

Affected Versions: All versions before 4.1.1

CVE ID: [CVE-2018-11392](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11392)

It goes without saying, but all user-input should not be trusted. This includes images, text, and any other binaries that are supplied by users. This post will cover an arbitrary file upload vulnerability that I discovered that could lead to remote code execution by uploading a malicious avatar to a user’s profile.

This is a PHP script that developers can use to give their apps the ability to accept user registrations (authentication) and restrict access based on a user’s level (authorization). Registered users can edit their profile, including uploading an avatar to make their accounts more personal.

For this example, I have this script running in VirtualBox at http://192.168.1.84/dev/.

**Fig I:** Shows a portion of a user’s profile, specifically the feature that allows you to upload an avatar.

![](http://doddsecurity.com/wp-content/uploads/2018/12/image7.png)

**Fig II:** Shows the vulnerable code that processes the file upload.

![](https://doddsecurity.com/wp-content/uploads/2018/12/image6.png)

The developers aren’t white-listing file extensions, and they are solely relying on the getimagesize() function on line 62 to determine whether or not the file is a valid image before allowing the file to be uploaded to the web server. PHP warns developers against relying on this function.

> **CAUTION**
> Do not use **getimagesize()** to check that a given file is a valid image.
>
> [PHP](http://php.net/manual/en/function.getimagesize.php)

If we can bypass the getimagesize() function, then we win and can gain remote code execution!

We can use a tool called “gifsicle” to embed PHP code into a legitimate image that can bypass getimagesize().

**Fig III:** Shows gifsicle embedding PHP code that runs the “id” Linux command into a malicious image named output.php.gif.

![](https://doddsecurity.com/wp-content/uploads/2018/12/image9.png)

The only thing left to do now is to upload the image. However, I’m going to intercept the upload and change the file extension so this image executes as PHP code since the developers aren’t white-listing file extensions.

**Fig IV:** Shows the interception with Burp Suite. I am changing the “filename” from output.php.gif to output.php. Also, at the very bottom of the image, the PHP code is visible (partially cropped out by accident).

![](https://doddsecurity.com/wp-content/uploads/2018/12/image8.png)

After allowing the HTTP POST request to be sent, the malicious image was successfully uploaded. Notice the broken image in place of our new avatar.

![](https://doddsecurity.com/wp-content/uploads/2018/12/image2.png)

A closer look at the broken image reveals that the image is actually a PHP file that now has a URL on the web server.

![](https://doddsecurity.com/wp-content/uploads/2018/12/image1.png)

If we navigate to that URL, notice that the “id” command executed. At this point, we can run any arbitrary command on this web server and get a shell.

![](https://doddsecurity.com/wp-content/uploads/2018/12/jigowatt-rce.png)

---

#### Timeline

* April 28, 2018 – A detailed vulnerability report was sent to the vendor.
* May 1, 2018 – The vendor acknowledged the report.
* May 15, 2018 – The developer made the fix available through the vendor’s marketplace.
* May 22, 2018 – I requested an update, and the vendor stated that this issue has been “resolved”.
* May 22, 2018 – Mitre assigned a CVE.
* May 23, 2018 – Published
* December 8, 2018 – Detailed write-up (this post)

[arbitrary file upload](https://doddsecurity.com/tag/arbitrary-file-upload/)[cve](https://doddsecurity.com/tag/cve/)[remote code execution](https://doddsecurity.com/tag/remote-code-execution/)[responsible disclosure](https://doddsecurity.com/tag/responsible-disclosure/)
[![](https://secure.gravatar.com/avatar/3437b25bca2894ee732acfa46c82096e?s=100&d=mm&r=g)](https://doddsecurity.com/author/regg/)
#### [Reginald Dodd](https://doddsecurity.com/author/regg/)

Reginald is an information security professional with experience that spans numerous industries. He has discovered unknown vulnerabilities in numerous products. He has earned a Master’s degree in Information Security and Assurance, GIAC certifications, and Offensive Security certifications.

Read Next →

[![](https://doddsecurity.com/wp-content/uploads/2023/05/geoserver2-400x200.png)

Vulnerability Research

### XXE in GeoServer](https://doddsecurity.com/412/xxe-in-geoserver/)
[![](https://doddsecurity.com/wp-content/uploads/2023/04/supportcandy-400x200.png)

Vulnerability Research

### Unauthorized Account Creation in SupportCandy](https://doddsecurity.com/396/unauthorized-account-creation-in-supportcandy/)
[![](https://doddsecurity.com/wp-content/uploads/2019/07/opencats-400x200.png)

Vulnerability Research

### XML External Entity Injection (XXE) in OpenCats Applicant Tracking System](https://doddsecurity.com/312/xml-external-entity-injection-xxe-in-opencats-applicant-tracking-system/)

### The Author

![](https://doddsecurity.com/wp-content/uploads/2018/12/Reginald-Dodd-Cropped.png)

Hi, I’m Reginald Dodd, an offensive security engineer and the author of this blog. This is where I document my perspectives on offensive security and application security in my personal time.

Read my [About Me](http://doddsecurity.com/about/) page for more on me.

### Follow

* [GitHub](https://github.com/doddr)
* [LinkedIn](https://www.linkedin.com/in/reginalddodd/)
* [RSS](https://doddsecurity.com/feed/)
### Categories

* [General](https://doddsecurity.com/category/general/)
* [Vulnerability Research](https://doddsecurity.com/category/vulnerability-research/)

To the top

© 2025 [Dodd Security](https://doddsecurity.com/)


