=== Content from archives.postgresql.org_1f809189_20250124_161958.html ===


[![PostgreSQL Elephant Logo](/media-archives/img/about/press/elephant.png)](/)

* [Home](/ "Home")
* [About](/about/ "About")
* [Download](/download/ "Download")
* [Documentation](/docs/ "Documentation")
* [Community](/community/ "Community")
* [Developers](/developer/ "Developers")
* [Support](/support/ "Support")
* [Donate](/about/donate/ "Donate")
* [Your account](/account/ "Your account")

## Quick Links

* [Community](/community/)
* [Contributors](/community/contributors/)
* [Mailing Lists](/list/)
* [IRC](/community/irc/)
* [Local User Groups](/community/user-groups/)
* [Events](/about/events/)
* [International Sites](/community/international/)

# Re: cash\_out bug

| From: | Tom Lane <tgl(at)sss(dot)pgh(dot)pa(dot)us> |
| --- | --- |
| To: | "Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au> |
| Cc: | "Alvaro Herrera" <alvherre(at)atentus(dot)com>, pgsql-hackers(at)postgresql(dot)org |
| Subject: | Re: cash\_out bug |
| Date: | 2002-08-12 05:30:38 |
| Message-ID: | [27732.1029130238@sss.pgh.pa.us](/message-id/27732.1029130238%40sss.pgh.pa.us) |
| Views: | [Raw Message](/message-id/raw/27732.1029130238%40sss.pgh.pa.us) | [Whole Thread](/message-id/flat/27732.1029130238%40sss.pgh.pa.us) | [Download mbox](/message-id/mbox/27732.1029130238%40sss.pgh.pa.us) | [Resend email](/message-id/resend/27732.1029130238%40sss.pgh.pa.us) |
| Thread: | 2002-08-12 04:33:27 from Alvaro Herrera <alvherre(at)atentus(dot)com>  2002-08-12 04:38:16 from Alvaro Herrera <alvherre(at)atentus(dot)com>  2002-08-12 04:47:38 from "Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au>   2002-08-12 05:30:38 from Tom Lane <tgl(at)sss(dot)pgh(dot)pa(dot)us>    2002-08-12 05:43:41 from "Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au>     2002-08-12 05:52:49 from Tom Lane <tgl(at)sss(dot)pgh(dot)pa(dot)us> |
| Lists: | [pgsql-hackers](/list/pgsql-hackers/since/200208120530) |

"Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au> writes:
> Is this a problem in that the functions are definined to return opaque (eg.
> PG\_RETURN\_VOID) but are then still usable in SELECT statements?

The issue here is (once again) that we're overloading type oid 0
("opaque") to mean too many different, incompatible things. I've
ranted about this before and will not repeat my previous remarks.
The bottom line is that we need to eliminate "opaque" in favor of
a set of pseudo-datatypes with different, crisply-defined semantics.
We've had some discussions about it but no complete proposal has been
made. Since eliminating "opaque" is going to break just about every
extant user-defined datatype, I'm not in a hurry to do it until we
can get it right the first time...

regards, tom lane

### In response to

* [Re: cash\_out bug](/message-id/GNELIHDDFBOCMGBFGEFOCEKECDAA.chriskl%40familyhealth.com.au) at 2002-08-12 04:47:38 from Christopher Kings-Lynne

### Responses

* [Re: cash\_out bug](/message-id/GNELIHDDFBOCMGBFGEFOCEKFCDAA.chriskl%40familyhealth.com.au)  at 2002-08-12 05:43:41 from Christopher Kings-Lynne

### Browse pgsql-hackers by date

|  | From | Date | Subject |
| --- | --- | --- | --- |
| [Next Message](/message-id/3D57483C.1030208%40pacifier.com) | Don Baccus | 2002-08-12 05:31:40 | [Re: OOP real life example (was Re: Why is MySQL more chosen](/message-id/3D57483C.1030208%40pacifier.com) |
| [Previous Message](/message-id/1029130161.1955.48.camel%40rh72.home.ee) | Hannu Krosing | 2002-08-12 05:29:21 | [Re: OOP real life example (was Re: Why is MySQL more](/message-id/1029130161.1955.48.camel%40rh72.home.ee) |

* [![@postgresql](/media-archives/img/atpostgresql.png)](https://twitter.com/postgresql)
* [![Git](/media-archives/img/git.png)](https://git.postgresql.org/gitweb/?p=postgresql.git)

[Privacy Policy](/about/privacypolicy) |
[Code of Conduct](/about/policies/coc/) |
[About PostgreSQL](/about/) |
[Contact](/about/contact/)



=== Content from marc.info_450b316b_20250124_161959.html ===

```
[[prev in list](?l=bugtraq&m=102978680918359&w=2)] [[next in list](?l=bugtraq&m=102979005221919&w=2)] [[prev in thread](?l=bugtraq&m=102977465204357&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: @(#) Mordred Labs advisory 0x0001: Buffer overflow in](?t=102977480600002&r=1&w=2)
From:       [Florian Weimer <Weimer () CERT ! Uni-Stuttgart ! DE>](?a=100923426600002&r=1&w=2)
Date:       [2002-08-19 17:30:52](?l=bugtraq&r=1&w=2&b=200208)
[Download RAW [message](?l=bugtraq&m=102978152712430&q=mbox) or [body](?l=bugtraq&m=102978152712430&q=raw)]

Sir Mordred The Traitor <mordred@s-mail.com> writes:

> --[ How to reproduce:
> psql> select cash_words('-700000000000000000000000000000');
> pgReadData() -- backend closed the channel unexpectedly.
> 	.... ....
> The connection to the server was lost...
>
> --[ Solution:
> Upgrade to version 7.2.1.

PostgreSQL 7.2.1 has a buffer overflow bug in the date parser (which
is invoked each time a string is converted to a datetime object).  If
a frontend does not perform proper date checking and rejects overlong
date strings, a buffer is overwritten by parser.  The string has to
pass some checks of the parser, so it is not immediately obvious that
this can be exploited.  Denial of service is possible, though,
especially if the frontend does not automatically reestablish the
database connection. (All connections are affected, not just the one
that is issueing the query.)

To my knowledge, the PostgreSQL developers do not think this warrants
an additional 7.2.x release.  They expect that users do not trust the
PostgreSQL parsers and write input validation checks.  That gives me
the creeps---how can I trust a database which manipulates complex
in-memory and on-disk data structures to keep my data, if its
developers say I shouldn't rely on a simple thing they wrote, such as
a date parser?

A different problem: "select cash_out(2);".  Known for ages, no fix in
sight (seems to be a design problem which is not easy to resolve).

*sigh*

--
Florian Weimer 	                  Weimer@CERT.Uni-Stuttgart.DE
University of Stuttgart           <http://CERT.Uni-Stuttgart.DE/people/fw/>
RUS-CERT                          fax +49-711-685-5898
[[prev in list](?l=bugtraq&m=102978680918359&w=2)] [[next in list](?l=bugtraq&m=102979005221919&w=2)] [[prev in thread](?l=bugtraq&m=102977465204357&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from archives.postgresql.org_51496c36_20250124_161957.html ===


[![PostgreSQL Elephant Logo](/media-archives/img/about/press/elephant.png)](/)

* [Home](/ "Home")
* [About](/about/ "About")
* [Download](/download/ "Download")
* [Documentation](/docs/ "Documentation")
* [Community](/community/ "Community")
* [Developers](/developer/ "Developers")
* [Support](/support/ "Support")
* [Donate](/about/donate/ "Donate")
* [Your account](/account/ "Your account")

## Quick Links

* [Community](/community/)
* [Contributors](/community/contributors/)
* [Mailing Lists](/list/)
* [IRC](/community/irc/)
* [Local User Groups](/community/user-groups/)
* [Events](/about/events/)
* [International Sites](/community/international/)

# cash\_out bug

| From: | Alvaro Herrera <alvherre(at)atentus(dot)com> |
| --- | --- |
| To: | pgsql-hackers(at)postgresql(dot)org |
| Subject: | cash\_out bug |
| Date: | 2002-08-12 04:33:27 |
| Message-ID: | [Pine.LNX.4.44.0208112356210.29879-100000@cm-lcon1-46-187.cm.vtr.net](/message-id/Pine.LNX.4.44.0208112356210.29879-100000%40cm-lcon1-46-187.cm.vtr.net) |
| Views: | [Raw Message](/message-id/raw/Pine.LNX.4.44.0208112356210.29879-100000%40cm-lcon1-46-187.cm.vtr.net) | [Whole Thread](/message-id/flat/Pine.LNX.4.44.0208112356210.29879-100000%40cm-lcon1-46-187.cm.vtr.net) | [Download mbox](/message-id/mbox/Pine.LNX.4.44.0208112356210.29879-100000%40cm-lcon1-46-187.cm.vtr.net) | [Resend email](/message-id/resend/Pine.LNX.4.44.0208112356210.29879-100000%40cm-lcon1-46-187.cm.vtr.net) |
| Thread: | 2002-08-12 04:33:27 from Alvaro Herrera <alvherre(at)atentus(dot)com>  2002-08-12 04:38:16 from Alvaro Herrera <alvherre(at)atentus(dot)com>  2002-08-12 04:47:38 from "Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au>   2002-08-12 05:30:38 from Tom Lane <tgl(at)sss(dot)pgh(dot)pa(dot)us>    2002-08-12 05:43:41 from "Christopher Kings-Lynne" <chriskl(at)familyhealth(dot)com(dot)au>     2002-08-12 05:52:49 from Tom Lane <tgl(at)sss(dot)pgh(dot)pa(dot)us> |
| Lists: | [pgsql-hackers](/list/pgsql-hackers/since/200208120433) |

Hello:

I was investigating the bug about "select cash\_out(2)" crashing the
backend. I thought fixing was a simple matter of checking whether some
argument to the function was NULL or not.

I added a NULL checking, but it obviously is not triggered, because the
data received is not NULL, but a non-pointer integer that cannot be
dereferenced (doing so cause a segmentation fault).

It turns out to be a far more serious bug than that, and is not limited
to cash\_out. All these functions have the same problem:

select proname from pg\_proc where proargtypes=(select proargtypes from
pg\_proc where proname='cash\_in') and pronargs=1 and proisstrict='t'
order by proname;

With a few exceptions (the test(\*) is long, as it requires one to wait for
the database to start after testing each function, but there are 16 out
of 107 functions(\*\*) that cause backend crash).

The problem is related to PG\_GETARG\_POINTER in some way or another; the
dereferencing of a non-pointer integer makes the backend crash.

I, however, do not know how to fix this. I'm just pointing out this
problem so someone more knowledgeable than me with this pointer mess can
figure a way out.

(\*) The test is
SELECT="select proname from pg\_proc where proargtypes=''
and pronargs=1 and proisstrict='t' order by proname;"

for i in `psql regression -c "$SELECT"`; do
 echo $i >> func\_test
 psql regression -c "select $i(1);" >> func\_test 2>&1
 sleep 9
done

(\*\*) Those are:
boolout
charout
cidout
date\_out
int2out
int4out
nabstimeout
oidout
regclassout
regoperatorout
regoperout
regprocedureout
regprocout
regtypeout
reltimeout
smgrout
xidout

--
Alvaro Herrera (<alvherre[a]atentus.com>)
"The Gord often wonders why people threaten never to come back after they've
been told never to return" ([www.actsofgord.com](http://www.actsofgord.com))

### Responses

* [Re: cash\_out bug](/message-id/Pine.LNX.4.44.0208120037240.29879-100000%40cm-lcon1-46-187.cm.vtr.net) at 2002-08-12 04:38:16 from Alvaro Herrera
* [Re: cash\_out bug](/message-id/GNELIHDDFBOCMGBFGEFOCEKECDAA.chriskl%40familyhealth.com.au) at 2002-08-12 04:47:38 from Christopher Kings-Lynne

### Browse pgsql-hackers by date

|  | From | Date | Subject |
| --- | --- | --- | --- |
| [Next Message](/message-id/Pine.LNX.4.44.0208120037240.29879-100000%40cm-lcon1-46-187.cm.vtr.net) | Alvaro Herrera | 2002-08-12 04:38:16 | [Re: cash\_out bug](/message-id/Pine.LNX.4.44.0208120037240.29879-100000%40cm-lcon1-46-187.cm.vtr.net) |
| [Previous Message](/message-id/GNELIHDDFBOCMGBFGEFOOEKDCDAA.chriskl%40familyhealth.com.au) | Christopher Kings-Lynne | 2002-08-12 04:16:55 | [Re: Interesting message about printf()'s in PostgreSQL](/message-id/GNELIHDDFBOCMGBFGEFOOEKDCDAA.chriskl%40familyhealth.com.au) |

* [![@postgresql](/media-archives/img/atpostgresql.png)](https://twitter.com/postgresql)
* [![Git](/media-archives/img/git.png)](https://git.postgresql.org/gitweb/?p=postgresql.git)

[Privacy Policy](/about/privacypolicy) |
[Code of Conduct](/about/policies/coc/) |
[About PostgreSQL](/about/) |
[Contact](/about/contact/)


