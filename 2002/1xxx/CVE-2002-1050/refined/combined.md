=== Content from bugs.hylafax.org_8e3f867c_20250124_173928.html ===

[![Home](skins/custom/Hylafax-clever-frog.gif "Back to the HylaFAX Bugzilla home page")](http://bugs.hylafax.org/)
Bugzilla
[New bug](enter_bug.cgi) ·
[Reports](report.cgi) ·
[Requests](request.cgi) ·
[Search](query.cgi) ·bug #

[Log In](index.cgi?GoAheadAndLogIn=1) | [New Account](createaccount.cgi)

# Bugzilla Bug 312

## faxgetty segfaults when receiving extremely long scan lines

### Last modified: 2002-07-06 13:52:44

*First*
*Last*
*Prev*
*Next*

*No search results available*
     [Search page](query.cgi)
     [Enter new bug](enter_bug.cgi)

---

| | **Bug#:** | [312](http://bugs.hylafax.org/show_bug.cgi?id=312) | | --- | --- | | **Product:** | bugzilla  Client Software  HylaFAX  HylaFAX Binary Packages  HylaFAX website |  | | **[Component](describecomponents.cgi?product=HylaFAX):** | documentation  fax protocol  faxaddmodem  faxadduser  faxcover  faxgetty  faxmail  faxq  faxrcvd  faxsend  faxstat  hfaxd  integration  internationalization  misc  modem/device support  notify  sendfax  sendpage  source-build  textfmt |  | | **[Status](page.cgi?id=fields.html#status):** | RESOLVED | | **[Resolution](page.cgi?id=fields.html#resolution):** | FIXED | | **[Assigned To](page.cgi?id=fields.html#assigned_to):** | HylaFAX Developer Mail List <hylafax-devel@hylafax.org> | | | **Hardware:** | All  DEC  HP  Macintosh  PC  SGI  Sun  Other |  | | --- | --- | --- | | **OS:** | All  MacOS X  Linux  BSDI  FreeBSD  NetBSD  OpenBSD  AIX  BeOS  HP-UX  IRIX  Neutrino  OpenVMS  OS/2  OSF/1  Solaris  SunOS  other |  | | **Version:** | 4.1.2  4.1.3  4.1.5  4.1.6  4.1.7  4.1.8  4.1.9  4.2.0  4.2.1  4.2.2  4.2.3  4.2.4  4.2.5  4.3.0  4.3.1  4.3.2  4.3.3  4.4.0  4.4.1  4.4.2  4.4.3  4.4.4  6.0.0  6.0.1  6.0.2  6.0.3  6.0.4  6.0.5  6.0.6  latest |  | | **[Priority](page.cgi?id=fields.html#priority):** | P1  P2  P3  P4  P5 |  | | **[Severity](page.cgi?id=fields.html#bug_severity):** | blocker  critical  major  normal  minor  trivial  enhancement |  | | | **Reporter:** | Lee Howard <faxguy@howardsilvan.com> | | --- | --- | | **Add CC:** |  | | **CC:** | pfournier@loups.net   Remove selected CCs | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| | **URL:** |  | | | | | | --- | --- | --- | --- | --- | --- | | **Summary:** |  | | | | | | **[Keywords](describekeywords.cgi):**  | | | | | | | | |  | | | --- | --- | |

| Attachment | Type | Created | Size | Actions |
| --- | --- | --- | --- | --- |
| [the fix](attachment.cgi?id=318) | *patch* | 2002-07-06 09:28 | 1.95 KB | [Edit](attachment.cgi?id=318&action=edit) | [Diff](attachment.cgi?id=318&action=diff) |
| [Create a New Attachment](attachment.cgi?bugid=312&action=enter) (proposed patch, testcase, etc.) | | | | [View All](attachment.cgi?bugid=312&action=viewall) |

| Bug 312 depends on: |  |  | [Show dependency tree](showdependencytree.cgi?id=312)  [Show dependency graph](showdependencygraph.cgi?id=312) |
| --- | --- | --- | --- |
| Bug 312 blocks: |  |  |

| [Votes](page.cgi?id=voting.html): | 0    [Show votes for this bug](votes.cgi?action=show_bug&bug_id=312)    [Vote for this bug](votes.cgi?action=show_user&bug_id=312#vote_312) |
| --- | --- |

**Additional Comments:**

Add to CC list

Leave as **RESOLVED FIXED**

Reopen bug

Mark bug as **VERIFIED**

Mark bug as **CLOSED**

**[View Bug Activity](show_activity.cgi?id=312)
  |
[Format For Printing](show_bug.cgi?format=multiple&id=312)
  |
[Clone This Bug](enter_bug.cgi?cloned_bug_id=312)**

---

| **[Description](show_bug.cgi?id=312#c0):** | **Opened:** 2002-07-06 09:26 |
| --- | --- |

```
I'm happy to announce that we have a patch for this now.  Kudos to Patrice for
his marvelous help on this.  Here's the original message I posted on this subject:

------------------------------------
With 100% consistency I can reproduce a segmentation fault in faxgetty...  I
believe that this could be remotely exploitable with a fair amount of ease,
too, provided the attacker understood basic Class 2 protocol and basic
buffer-overflow exploitation techniques.  Without revealing too much
(hopefully), I will admit that the circumstances of the segmentation fault
requires incorrect fax session negotiation (due to hardware or software
misconfiguration or malicious intent); in other words, it's not likely to
occur under normal circumstances with a properly-configured modem without an
attacker.

The problem lies at a line of code approximately on line 248 of
faxd/CopyQuality.c++ which reads:

memcpy(recvRow, (const char*) raw, n);

Under normal circumstances in my testing, the value of recvRow begins at
3221167392 (which I'm guessing is a memory address) for each page, the length
of raw is usually << 200, and n is usually << 200.  recvRow is incremented by
n each time this memcpy() call is made on a received page.

However, I can reproduce an environment where recvRow is 3221167392, the
length of raw is 163127, and n is 163129.  In other words, I get a situation
where

memcpy(3221167392, "xxxx -163127 times- xxxx", 163129);

is called, and faxgetty segfaults.  Why?  and, what is the appropriate way to
handle this situation?
------------------------------------

The limit on the length of raw is 32768; n will vary accordingly.  Any scanline
received longer than 32768 characters will cause faxgetty to segfault.  The
problem with this, of course, is that faxgetty is usually run as root from init,
and thus an attacker could use standard buffer overflow exploitation techniques
against this problem to execute arbitrary commands on the host system.

To fix the problem, we follow the same buffer-checking approach in
faxd/CopyQuality.c++ that was used a few lines before our problematic memcpy()
line; that is, we simply flush the data to disk.

You'll know when this happens by looking at your session log:

Jul 05 14:46:25.98: [ 2238]: RECV: send trigger 022
Jul 05 14:46:25.98: [ 2238]: <-- data [1]
Jul 05 14:48:09.62: [ 2238]: RECV/CQ: Bad 1D pixel count, row 0, got 0, expected
1728
Jul 05 14:48:09.62: [ 2238]: RECV: 0 bytes of data, 0 total lines
Jul 05 14:48:09.62: [ 2238]: RECV: 163129 bytes of data, 0 total lines
Jul 05 14:48:09.62: [ 2238]: RECV/CQ: Bad 1D pixel count, row 1, got 0, expected
1728
Jul 05 14:48:09.62: [ 2238]: RECV/CQ: Bad 1D pixel count, row 2, got 0, expected
1728
Jul 05 14:48:09.62: [ 2238]: RECV/CQ: Bad 1D pixel count, row 3, got 0, expected
1728
Jul 05 14:48:09.62: [ 2238]: RECV/CQ: Bad 1D pixel count, row 4, got 0, expected
1728
Jul 05 14:48:09.62: [ 2238]: RECV: 6 bytes of data, 5 total lines
Jul 05 14:48:09.63: [ 2238]: MODEM set XON/XOFF/DRAIN: input interpreted, output
disabled
Jul 05 14:48:10.79: [ 2238]: --> [17:+FPS:1,2206,0,0,0]

Notice the "RECV: 163129 bytes of data, 0 total lines".

This particular fax is being received by a MultiTech MT5634ZBA-V92 in 2D-MMR
from the Analog Devices faxback service, (800) 446-6212.  It is also the one
that caused me to discover the fault.  The error does not surface when receiving
from this faxback service in 2D-MR or 1D-MH.  However, I believe that this
vulnerability could be exploited in any fax Class mode with any modem with any
capabilities.

Note that HylaFAX cannot fully receive faxes in 2D-MMR format at the moment.
faxgetty, probably elsewhere in faxd/CopyQuality.c++, somehow corrupts the
received image data before writing it to disk.  The resulting fax image is only
one scanline long.  I believe that this shortcoming is unrelated to the
vulnerability the attached patch fixes.

Lastly, note that the patch uncomments four lines in the codebase which were
previously commented-out by Robert a few years ago for gcc-2.95 compatibility.
In our testing, we have been able to compile normally with gcc-2.95 the codebase
with this patch applied.  If there are compilation problems later due to this
patch's uncommenting of these four lines, then we'll need to fix that
compilation problem directly rather than removing these definitions.  My guess
is, however, that the compilation problem has been fixed in some other fashion
already - which is why our compilation testing on gcc-2.95 works.
```

------- *Comment
[#1](show_bug.cgi?id=312#c1) From
Lee Howard
2002-07-06 09:28*

-------
```
[Created an attachment (id=318)](attachment.cgi?id=318&action=view "the fix") [[edit]](attachment.cgi?id=318&action=edit "the fix")
the fix

thanks again to Patrice for this fix
```

------- *Comment
[#2](show_bug.cgi?id=312#c2) From
Darren Nickerson
2002-07-06 10:49*

-------
```

Excellent work gentlemen, this needs to get into 4.1.3, so I'm committing it now.

-d

```

------- *Comment
[#3](show_bug.cgi?id=312#c3) From
Darren Nickerson
2002-07-06 10:52*

-------
```
Committed.
```

---

*First*
*Last*
*Prev*
*Next*

*No search results available*
     [Search page](query.cgi)
     [Enter new bug](enter_bug.cgi)



=== Content from www.debian.org_f2a9a709_20250124_173928.html ===

[![Debian](./Pics/openlogo-50.png)](./ "Debian Home")

[Skip Quicknav](#content)

* [Blog](https://bits.debian.org/ "Bits from Debian")
* [Micronews](https://micronews.debian.org "Micronews from Debian")
* [Planet](https://planet.debian.org/ "The Planet of Debian")

# Debian

# The Community

## Debian is a Community of People!

### DC24 Group Photo

![DebConf23 Group Photo](Pics/debconf24_group_photo.jpg)

### MiniDebConf Berlin 2024

![Group photo of the MiniDebConf Berlin 2024](Pics/mini-dc24-berlin.jpg)

### MiniDebConf BrasÃ­lia 2023

![Group photo of the MiniDebConf BrasÃ­lia 2023](Pics/mini-dc23-brasilia.jpg)

### Screenshot Calamares Installer

![Screenshot from the Calamares installer](Pics/calamares-bookworm.png)

### Debian is like a Swiss Army Knife

![Debian is like a Swiss Army Knife](Pics/debian-swiss-knife-hands-1024x576.jpg)

### People have fun with Debian

![Debian people at Debconf18 in Hsinchu really having fun](Pics/debian-funny-people-1024x576.jpg)

[![](Pics/users.svg)](intro/people)

## [People](intro/people)

Who we are and what we do

[![](Pics/heartbeat.svg)](intro/philosophy)

## [Our Philosophy](intro/philosophy)

Why we do it, and how we do it

[![](Pics/user-plus.svg)](devel/join/)

## [Get Involved, Contribute](devel/join/)

How you can join us!

[![](Pics/list.svg)](intro/index#community)

## [More...](intro/index#community)

Additional information about the Debian community

# The Operating System

## Debian is a complete Free Operating System!

![Debian](Pics/debian-logo-1024x576.png)
[Download](https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.9.0-amd64-netinst.iso)
[Other downloads](distrib)

[![](Pics/trophy.svg)](intro/why_debian)

## [Why Debian](intro/why_debian)

What makes Debian special

[![](Pics/life-ring.svg)](support)

## [User Support](support)

Getting help and documentation

[![](Pics/security.svg)](security/)

## [Security Updates](security/)

Debian Security Advisories (DSA)

[![](Pics/list.svg)](intro/index#software)

## [More...](intro/index#software)

Further links to downloads and software

---

# Project News

## News and Announcements about Debian

17January2025[The Debian Project mourns the loss of Steve Langasek (vorlon)](News/2025/20250117)
11January2025[Updated Debian 12: 12.9 released](News/2025/20250111)
19November2024[The Debian Project mourns the loss of JÃ©rÃ©my Bobbio (Lunar)](News/2024/20241119)
31August2024[Updated Debian 11: 11.11 released](News/2024/2024083102)
14August2024[Security support for Bullseye handed over to the LTS team](News/2024/20240814)

[All the news](News)
[RSS](News/news)

---

This page is also available in the following languages:
Select your language
català
dansk
Deutsch
español
français
Galego
Indonesia
Italiano
magyar
Nederlands
norsk (bokmål)
polski
Português
suomi
svenska
Tiếng Việt
Български (Bəlgarski)
Русский (Russkij)
українська (ukrajins'ka)
عربية (Arabiya)
中文(简)
中文(HK)
中文(繁)
한국어 (Korean)
Ελληνικά (Ellinika)
فارسی (Farsi)

How to set [the default document language](./intro/cn)

---

See our [contact page](./contact) to get in touch. Web site source code is [available](https://salsa.debian.org/webmaster-team/webwml).

Last Modified: Sat, Sep 16 13:09:56 UTC 2023

Last Built: Sun, Jan 19 23:26:10 UTC 2025

Copyright © 1997-2025 [SPI](https://www.spi-inc.org/) and others; See [license terms](./license)

Debian is a registered [trademark](./trademark) of Software in the Public Interest, Inc.


