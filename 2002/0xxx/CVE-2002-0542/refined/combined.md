=== Content from marc.info_ecd6307d_20250125_011924.html ===

```
[[prev in list](?l=bugtraq&m=101854413832392&w=2)] [[next in list](?l=bugtraq&m=101856541322245&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=101858917904851&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [OpenBSD Local Root Compromise](?t=101855477600006&r=1&w=2)
From:       [Milos Urbanek <urbanek () zoom-int ! cz>](?a=101661316600001&r=1&w=2)
Date:       [2002-04-11 17:01:17](?l=bugtraq&r=1&w=2&b=200204)
[Download RAW [message](?l=bugtraq&m=101855467811695&q=mbox) or [body](?l=bugtraq&m=101855467811695&q=raw)]

    ZOOM International Security Advisory

    OpenBSD local root compromise

    Systems affected:
        OpenBSD all version, OpenBSD Current prior April 8, 2002

    Risk: High
    Date: April 11, 2002

    Legal Notice:
        This advisory is copyright (c) ZOOM International.

    Disclaimer:
        Information contained in this advisory are provided only ``AS IS''.
    ZOOM International is not liable for any damages whatsoever
    arising out of or in connection with the use or spread of this information.
    Any use of this information is at our own risk.

    Background:
        Program /usr/bin/mail is a simple mail user agent which can be used also    \
in the batch mode, for example to send mail to the administrator when  running cron \
tasks.

    Problem description:
        There is a local root compromise in all versions of OpenBSD including
    OpenBSD Current prior to April 9, 2002 due to a bug in program
    /usr/bin/mail.

    Details:
        Program /usr/bin/mail accepts escape sequences while running in
    the non-interactive mode. When the attacker inserts the escape sequence
    into the stream which is used as an input to the mail command this escape
    sequence is interpreted by the mail command and it is possible for example
    execute arbitrary commands or read/write any file in the system with the
    privileges of the user running /usr/bin/mail.

    Impact:
        Users can gain superuser privileges because the output of
    the /etc/daily script is piped to the /usr/bin/mail command while
    running regular cron tasks.
        There exists a method developed by Przemyslav Frasunek which allows
    to perform a local attack by creating a file with a specialy designed
    filename and permissions. Method of performing remote exploitation of this
    bug is currently unknown.

    Exploit:
        An exploit for this bug exists and is publicly available.

    Workaround:
        Remove /usr/bin/mail binary until a patch for your release is available.

    Contact Status:
        Vendor was contacted on 2002-04-08. Problem report related to the
    security advisory was sent on 2002-04-10.

    Available Fixes:
        This bug was patched in OpenBSD Current on April 8, 2002.
    Official patch for other OpenBSD releases is not available at the moment
    but the bug can be solved by applying the attached source code patch
    to the 1.23 revision of the appropriate file and installing new mail
    binary.

    Credits:
        The bug was found by Milos Urbanek, Security Conslutant at ZOOM
    International. Exploit was written by Przemyslav Frasunek.

    About ZOOM International:
        ZOOM International is a Czech company providing services and
    solutions in the area of IT security. For more information visit
    our website at <http://www.zoom-int.cz/>.

Mail Patch

Index: collect.c
===================================================================
RCS file: /cvs/src/usr.bin/mail/collect.c,v
retrieving revision 1.23
retrieving revision 1.24
diff -u -r1.23 -r1.24
--- collect.c   2001/11/21 15:26:39     1.23
+++ collect.c   2002/04/08 20:27:17     1.24
@@ -1,4 +1,4 @@
-/*     $OpenBSD: collect.c,v 1.23 2001/11/21 15:26:39 millert Exp $    */
+/*     $OpenBSD: collect.c,v 1.24 2002/04/08 20:27:17 millert Exp $    */
 /*     $NetBSD: collect.c,v 1.9 1997/07/09 05:25:45 mikel Exp $        */

 /*
@@ -38,7 +38,7 @@
 #if 0
 static const char sccsid[] = "@(#)collect.c    8.2 (Berkeley) 4/19/94";
 #else
-static const char rcsid[] = "$OpenBSD: collect.c,v 1.23 2001/11/21 15:26:39 millert \
Exp $"; +static const char rcsid[] = "$OpenBSD: collect.c,v 1.24 2002/04/08 20:27:17 \
millert Exp $";  #endif
 #endif /* not lint */

@@ -161,7 +161,8 @@
                    value("interactive") != NULL && !lastlong &&
                    (value("dot") != NULL || value("ignoreeof") != NULL))
                        break;
-               if (linebuf[[0]](#0) != escape || lastlong) {
+               if (linebuf[[0]](#0) != escape || value("interactive") == NULL ||
+                   lastlong) {
                        if (putline(collf, linebuf, !longline) < 0)
                                goto err;
                        continue;

[[prev in list](?l=bugtraq&m=101854413832392&w=2)] [[next in list](?l=bugtraq&m=101856541322245&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=101858917904851&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.openbsd.org_994ce355_20250125_011955.html ===


OpenBSD 3.0 Errata

## [*Open***BSD**](index.html) 3.0 Errata

---

For errata on a certain release, click below:

[2.0](errata20.html),
[2.1](errata21.html),
[2.2](errata22.html),
[2.3](errata23.html),
[2.4](errata24.html),
[2.5](errata25.html),
[2.6](errata26.html),
[2.7](errata27.html),
[2.8](errata28.html),
[2.9](errata29.html),
[3.1](errata31.html),
[3.2](errata32.html),
[3.3](errata33.html),
[3.4](errata34.html),
[3.5](errata35.html),
[3.6](errata36.html),

[3.7](errata37.html),
[3.8](errata38.html),
[3.9](errata39.html),
[4.0](errata40.html),
[4.1](errata41.html),
[4.2](errata42.html),
[4.3](errata43.html),
[4.4](errata44.html),
[4.5](errata45.html),
[4.6](errata46.html),
[4.7](errata47.html),
[4.8](errata48.html),
[4.9](errata49.html),
[5.0](errata50.html),
[5.1](errata51.html),
[5.2](errata52.html),

[5.3](errata53.html),
[5.4](errata54.html),
[5.5](errata55.html),
[5.6](errata56.html),
[5.7](errata57.html),
[5.8](errata58.html),
[5.9](errata59.html),
[6.0](errata60.html),
[6.1](errata61.html),
[6.2](errata62.html),
[6.3](errata63.html),
[6.4](errata64.html),
[6.5](errata65.html),
[6.6](errata66.html),
[6.7](errata67.html),
[6.8](errata68.html),

[6.9](errata69.html),
[7.0](errata70.html),
[7.1](errata71.html),
[7.2](errata72.html),
[7.3](errata73.html),
[7.4](errata74.html),
[7.5](errata75.html),
[7.6](errata76.html).

---

Patches for the OpenBSD base system are distributed as unified diffs.
Each patch contains usage instructions.
All the following patches are also available in one
[tar.gz file](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0.tar.gz)
for convenience.

Patches for supported releases are also incorporated into the
[-stable branch](stable.html).

---

* **001: INSTALL ISSUE: November 12, 2001**
    *All architectures*

  A small bug in the installation script causes the `/etc/hosts` file to
  be incorrectly formed.

  The resulting file contains a line which reads like:

  `#.#.#.# hostname. hostname`

  This line should actually read something like:

  `#.#.#.# hostname.domainname.com hostname`

  To correct this problem, simply edit the file and insert the domainname in
  the required place.

  * **002: SECURITY FIX: November 12, 2001**
      *All architectures*

    [sshd(8)](https://man.openbsd.org/OpenBSD-3.0/sshd.8)
    is being upgraded from OpenSSH 3.0 to OpenSSH 3.0.2 to fix a few problems:

    + A security hole that may allow an attacker to partially authenticate
      if -- and only if -- the administrator has enabled KerberosV.

      By default, OpenSSH KerberosV support only becomes active after KerberosV
      has been properly configured.

      + An excessive memory clearing bug (which we believe to be unexploitable)
        also exists, but since this may cause daemon crashes, we are providing a
        patch as well.

        + A vulnerability in environment passing in the `UseLogin`
          *sshd* option

          + Various other non-critical fixes.

    Effectively an upgrade of OpenSSH 3.0 to OpenSSH 3.0.2.
    [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/002_ssh2.patch)
    This is the second version of this patch.

    * **003: RELIABILITY FIX: November 12, 2001**

      Access to a CD drive on the PCI ultrasparc machines results in a continuous stream
      of bogus interrupt messages, causing great user anguish.

      [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/sparc64/003_sparc64cd.patch)

      * **004: RELIABILITY FIX: November 12, 2001**

        Hifn7751 based cards may stop working on certain motherboards due to
        DMA errors.

        [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/i386/004_hifn.patch)

        * **005: RELIABILITY FIX: November 12, 2001**

          Execution of Altivec instructions will crash the kernel.

          [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/macppc/005_altivec.patch)

          * **006: SECURITY FIX: November 13, 2001**
              *All architectures*

            [pf(4)](https://man.openbsd.org/OpenBSD-3.0/pf.4)
            was incapable of dealing with certain ipv6 icmp packets, resulting in a crash.

            [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/006_pf.patch)

            * **007: SECURITY FIX: November 13, 2001**
                *All architectures*

              A security issue exists in the vi.recover script that may allow an attacker
              to remove arbitrary zero-length files, regardless of ownership.

              [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/007_recover.patch)

              * **008: SECURITY FIX: November 28, 2001**
                  *All architectures*

                A security issue exists in the lpd daemon that may allow an attacker
                to create arbitrary new files in the root directory. Only machines
                with line printer access (ie: listed in either /etc/hosts.lpd or
                /etc/hosts.equiv) may be used to mount an attack and the attacker
                must have root access on the machine. OpenBSD does not start lpd
                in the default installation.

                [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/008_lpd.patch)

                * **009: INSTALLATION FIX: December 11, 2001**

                  The 3.0 CD2 was created with an error which means that the instructions
                  for booting this architecture will not work. Instead, to boot the
                  CD, press Option-Command-O-F during power up to get into OpenFirmware
                  and then type:

                  `boot cd:,OFWBOOT /3.0/macppc/bsd.rd`

                  * **010: RELIABILITY FIX: December 13, 2001**
                      *All architectures*

                    Systems running with IP-in-IP encapsulation can be made to crash by
                    malformed packets.

                    [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/010_ipip.patch)

                    * **011: SECURITY FIX: January 17, 2002**
                        *All architectures*

                      If the Postfix sendmail replacement is installed on a system an
                      attacker may be able to gain root privileges on the local host via
                      sudo(8) which runs the mailer as root with an environment inherited
                      from the invoking user. While this is a bug in sudo it is not
                      believed to be possible to exploit when sendmail (the mailer that
                      ships with OpenBSD) is the mailer. As of version 1.6.5, sudo passes
                      the mailer an environment that is not subject to influence from the
                      invoking user.

                      [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/011_sudo.patch)

                      * **012: SECURITY FIX: January 21, 2002**
                          *All architectures*

                        A race condition between the ptrace(2) and execve(2) system calls allows
                        an attacker to modify the memory contents of suid/sgid processes which
                        could lead to compromise of the super-user account.

                        [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/012_ptrace.patch)

                        * **013: RELIABILITY FIX: February 4, 2002**
                            *All architectures*

                          The wrong filedescriptors are released when pipe(2) failed.

                          [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/013_syspipe.patch)

                          * **014: SECURITY FIX: March 8, 2002**
                              *All architectures*

                            A local user can gain super-user privileges due to an off-by-one check
                            in the channel forwarding code of OpenSSH.

                            [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/014_openssh.patch)

                            * **015: RELIABILITY FIX: March 13, 2002**
                                *All architectures*

                              Under some circumstances the zlib compression library can free dynamically
                              allocated memory twice. This is not a security issue on OpenBSD since the BSD
                              [free(3)](https://man.openbsd.org/OpenBSD-3.0/free.3)
                              function detects this.
                              There is also a kernel zlib component that may be used by pppd and IPsec.
                              The feasibility of attacking the kernel this way is currently unknown.

                              [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/015_zlib.patch)

                              * **016: SECURITY FIX: March 19, 2002**
                                  *All architectures*

                                Under certain conditions, on systems using YP with netgroups in the password
                                database, it is possible for the
                                [rexecd(8)](https://man.openbsd.org/OpenBSD-3.0/rexecd.8)
                                and
                                [rshd(8)](https://man.openbsd.org/OpenBSD-3.0/rshd.8)
                                daemons to execute the shell from a different user's password entry.
                                Due to a similar problem,
                                [atrun(8)](https://man.openbsd.org/OpenBSD-3.0/atrun.8)
                                may change to the wrong home directory when running
                                [at(1)](https://man.openbsd.org/OpenBSD-3.0/at.1)
                                jobs.

                                [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/016_approval.patch)

                                * **017: RELIABILITY FIX: March 26, 2002**
                                    *All architectures*

                                  [isakmpd(8)](https://man.openbsd.org/OpenBSD-3.0/isakmpd.8)
                                  will crash when receiving a zero length IKE packet due to a too-late length check.

                                  [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/017_isakmpd.patch)

                                  * **018: SECURITY FIX: April 11, 2002**
                                      *All architectures*

                                    [mail(1)](https://man.openbsd.org/OpenBSD-3.0/mail.1)
                                    will process tilde escapes even in non-interactive mode.
                                    This can lead to a local root compromise.

                                    [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/018_mail.patch)

                                    * **019: SECURITY FIX: April 22, 2002**
                                        *All architectures*

                                      A local user can gain super-user privileges due to a buffer overflow
                                      in [sshd(8)](https://man.openbsd.org/OpenBSD-3.0/sshd.8)
                                      if AFS has been configured on the system or if
                                      KerberosTgtPassing or AFSTokenPassing has been enabled
                                      in the sshd\_config file. Ticket and token passing is not enabled
                                      by default.

                                      [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/019_sshafs.patch)

                                      * **020: SECURITY FIX: April 25, 2002**
                                          *All architectures*

                                        A bug in [sudo(8)](https://man.openbsd.org/OpenBSD-3.0/sudo.8) may allow an attacker to corrupt the heap by specifying a custom prompt.

                                        [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/020_sudo.patch)

                                        * **021: SECURITY FIX: May 8, 2002**
                                            *All architectures*

                                          A race condition exists where an attacker could fill the file descriptor
                                          table and defeat the kernel's protection of fd slots 0, 1, and 2 for a
                                          setuid or setgid process.

                                          [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/021_fdalloc2.patch)

                                          * **022: SECURITY FIX: June 19, 2002**
                                              *All architectures*

                                            A buffer overflow can occur during the interpretation of chunked
                                            encoding in the http daemon, leading to possible remote crash or exploit.

                                            [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/022_httpd.patch)

                                            * **023: SECURITY FIX: June 24, 2002**
                                                *All architectures*

                                              A buffer overflow can occur in the .htaccess parsing code in mod\_ssl httpd
                                              module, leading to possible remote crash or exploit.

                                              [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/023_mod_ssl.patch)

                                              * **024: SECURITY FIX: June 24, 2002**
                                                  *All architectures*

                                                All versions of OpenSSH's sshd between 2.3.1 and 3.3 contain an input validation
                                                error that can result in an integer overflow and privilege escalation.
                                                This problem is fixed in [OpenSSH
                                                3.4](https://www.openssh.com/openbsd.html), and a patch for the vulnerable releases is available as part of the
                                                [security advisory](https://www.openssh.com/txt/preauth.adv).

                                                * **025: SECURITY FIX: June 25, 2002**
                                                    *All architectures*

                                                  A potential buffer overflow in the DNS resolver has been found.

                                                  [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/025_resolver.patch)

                                                  * **026: SECURITY FIX: June 27, 2002**
                                                      *All architectures*

                                                    The kernel would let any user [ktrace(2)](https://man.openbsd.org/OpenBSD-3.0/ktrace.2) set[ug]id processes.

                                                    [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/026_ktrace.patch)

                                                    * **027: RELIABILITY FIX: July 5, 2002**
                                                        *All architectures*

                                                      Receiving IKE payloads out of sequence can cause
                                                      [isakmpd(8)](https://man.openbsd.org/OpenBSD-3.0/isakmpd.8) to crash.

                                                      [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/027_isakmpd.patch)

                                                      This is the second version of the patch.

                                                      * **028: SECURITY FIX: July 29, 2002**
                                                          *All architectures*

                                                        A race condition exists in the
                                                        [pppd(8)](https://man.openbsd.org/OpenBSD-3.0/pppd.8)
                                                        daemon which may cause it to alter the file permissions of an arbitrary file.

                                                        [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/028_pppd.patch)

                                                        * **029: SECURITY FIX: July 29, 2002**
                                                            *All architectures*

                                                          A buffer overflow can occur in the
                                                          [xdr\_array(3)](https://man.openbsd.org/OpenBSD-3.0/xdr_array.3)
                                                          RPC code, leading to possible remote crash.

                                                          [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/029_xdr.patch)

                                                          This is the second version of the patch.

                                                          * **030: SECURITY FIX: July 30, 2002**
                                                              *All architectures*

                                                            Several remote buffer overflows can occur in the SSL2 server and SSL3 client of the
                                                            [ssl(8)](https://man.openbsd.org/OpenBSD-3.0/ssl.8)
                                                            library, as in the ASN.1 parser code in the
                                                            [crypto(3)](https://man.openbsd.org/OpenBSD-3.0/crypto.3)
                                                            library, all of them being potentially remotely exploitable.

                                                            [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/030_ssl.patch)

                                                            This is the second version of the patch.

                                                            * **031: SECURITY FIX: August 11, 2002**
                                                                *All architectures*

                                                              An insufficient boundary check in the
                                                              [select(2)](https://man.openbsd.org/OpenBSD-3.0/select.2)
                                                              system call allows an attacker to overwrite kernel memory and execute arbitrary
                                                              code in kernel context.

                                                              [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/031_scarg.patch)

                                                              * **032: SECURITY FIX: October 7, 2002**
                                                                  *All architectures*

                                                                Incorrect argument checking in the
                                                                [setitimer(2)](https://man.openbsd.org/OpenBSD-3.0/setitimer.2) system call may allow an attacker to write to kernel memory.

                                                                [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/032_kerntime.patch)

                                                                * **033: SECURITY FIX: October 21, 2002**
                                                                    *All architectures*

                                                                  A buffer overflow can occur in the
                                                                  [kadmind(8)](https://man.openbsd.org/OpenBSD-3.0/kadmind.8)
                                                                  daemon, leading to possible remote crash or exploit.

                                                                  [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/033_kadmin.patch)

                                                                  * **034: SECURITY FIX: November 6, 2002**
                                                                      *All architectures*

                                                                    An attacker can bypass the restrictions imposed by sendmail's restricted shell,
                                                                    [smrsh(8)](https://man.openbsd.org/OpenBSD-3.0/smrsh.8),
                                                                    and execute arbitrary commands with the privileges of his own account.

                                                                    [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/034_smrsh.patch)

                                                                    * **035: SECURITY FIX: November 6, 2002**
                                                                        *All architectures*

                                                                      Incorrect argument checking in the
                                                                      [getrlimit(2)](https://man.openbsd.org/OpenBSD-3.0/getrlimit.2)
                                                                      system call may allow an attacker to crash the kernel.

                                                                      [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/035_kernresource.patch)

                                                                      * **036: SECURITY FIX: November 14, 2002**
                                                                          *All architectures*

                                                                        A buffer overflow in
                                                                        [named(8)](https://man.openbsd.org/OpenBSD-3.0/named.8)
                                                                        could allow an attacker to execute code with the privileges of named.
                                                                        On OpenBSD, named runs as a non-root user in a chrooted environment
                                                                        which mitigates the effects of this bug.

                                                                        [A source code patch exists which remedies this problem.](https://ftp.openbsd.org/pub/OpenBSD/patches/3.0/common/036_named.patch)

---


