=== Content from docs.microsoft.com_15169748_20250125_012736.html ===

[Skip to main content](#main)

This browser is no longer supported.

Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.

[Download Microsoft Edge](https://go.microsoft.com/fwlink/p/?LinkID=2092881 )
[More info about Internet Explorer and Microsoft Edge](https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge)

Table of contents

Exit focus mode

Read in English

Save

Table of contentsRead in English

Save

Add to plan
[Edit](https://github.com/MicrosoftDocs/security-updates/blob/live/security-updates/SecurityBulletins/2002/ms02-045.md "Edit This Document")

---

#### Share via

Facebook
x.com
LinkedIn
Email

---

Print

Table of contents

* Article
* 03/01/2023
* 6 contributors

Feedback

## In this article

Security Bulletin

# Microsoft Security Bulletin MS02-045 - Moderate

## Unchecked Buffer in Network Share Provider Can Lead to Denial of Service (Q326830)

Published: August 22, 2002

**Version:** 1.0

**Originally posted:** August 22, 2002

#### Summary

**Who should read this bulletin:**
Customers using MicrosoftÂ® Windows NTÂ®, WindowsÂ® 2000 and Windows XP.

**Impact of vulnerability:**
Denial of service.

**Maximum Severity Rating:**
Moderate

**Recommendation:**
Administrators should consider installing the patch.

**Affected Software:**

* Microsoft Windows NT 4.0 Workstation
* Microsoft Windows NT 4.0 Server
* Microsoft Windows NT 4.0 Server, Terminal Server Edition
* Microsoft Windows 2000 Professional
* Microsoft Windows 2000 Server
* Microsoft Windows 2000 Advanced Server
* Windows XP Professional

### General Information

## Technical details

**Technical description:**

SMB (Server Message Block) is the protocol Microsoft uses to share files, printers, serial ports, and also to communicate between computers using named pipes and mail slots. In a networked environment, servers make file systems and resources available to clients. Clients make SMB requests for resources and servers make SMB responses in what described as a client server, request-response protocol.

By sending a specially crafted packet request, an attacker can mount a denial of service attack on the target server machine and crash the system. The attacker could use both a user account and anonymous access to accomplish this. Though not confirmed, it may be possible to execute arbitrary code.

**Mitigating factors:**

* An administrator can block access to SMB ports from untrusted networks. By blocking TCP ports 445 and 139 at the network perimeter, administrators can prevent this attack from untrusted parties. In a file and printing environment, this may not be a practical solution for legitimate users.
* An administrator can stop the Lanman server service which prevents the attack, but again may not be suitable on a file and print sharing server.

**Severity Rating:**

|  | Internet Servers | Intranet Servers | Client Systems |
| --- | --- | --- | --- |
| **Windows NT 4.0 Server** | Low | Moderate | Moderate |
| **Windows NT 4.0 Workstation** | Low | Moderate | Moderate |
| **Windows NT 4.0 Server, Terminal Server Edition** | Low | Moderate | Moderate |
| **Windows 2000 Server** | Low | Moderate | Moderate |
| **Windows 2000 Professional** | Low | Moderate | Moderate |
| **Windows 2000 Advanced Server** | Low | Moderate | Moderate |
| **Windows XP** | Low | Moderate | Moderate |

The above [assessment](https://technet.microsoft.com/security/bulletin/rating) is based on the types of systems affected by the vulnerability, their typical deployment patterns, and the effect that exploiting the vulnerability would have on them.

**Vulnerability identifier:** [CAN-2002-0724](https://cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0724)

**Tested Versions:**

Microsoft tested Windows NT 4.0, Windows 2000 and Windows XP to assess whether they are affected by these vulnerabilities. Previous versions are no longer [supported](https://support.microsoft.com/directory/discontinue.asp), and may or may not be affected by these vulnerabilities.

## Frequently asked questions

**What's the scope of the vulnerability?**

This is a [denial of service attack](https://technet.microsoft.com/security/bulletin/glossary). By sending a specially crafted packet request to a computer, an attacker can crash the system of the target machine. The attacker could use both a user account and anonymous access to accomplish this. Though not confirmed, it may be possible to execute arbitrary code.
If system administrators have turned off anonymous access, it would not be possible for a non-authenticated user to exploit this vulnerability. However, turning off anonymous access does not prevent authenticated users from this attack.
In addition, an administrator can block access to SMB on TCP ports 445 and 139 at the network perimeter. This would block access from untrusted networks. However, legitimate users could be blocked in a file and print networking environment.
Administrators could also shut down the lanman server service. However, in a file and print networking environment this may not be a viable solution because it would block legitimate users from using file and print services on a particular server where the lanman service had been stopped.

**What causes the vulnerability?**

The vulnerability results because of a flaw in the way Microsoft's implementation of SMB receives a packet requesting the SMB service.

**What is SMB?**

SMB (Server Message Block) is the protocol Microsoft uses to share files, printers, serial ports, and also to communicate between computers using named pipes and mail slots. In a networked environment, servers make file systems and resources available to clients. Clients make SMB requests for resources and servers make SMB responses in what described as a client server, request-response protocol.

**What's wrong with the SMB implementation?**

There is an unchecked buffer in a section of code that requests the SMB service.

**What could this vulnerability enable an attacker to do?**

This vulnerability could enable an attacker launch a denial of service attack against vulnerable systems either locally or remotely using either a user account or anonymous access.

**But this is a buffer overrun vulnerability. Don't they usually allow the attacker to run code on the system?**

Normally this is true. However, in the testing process, neither the development team nor the reporter were able to find a way for an attacker to run code on the system. This does not mean that it's not possible, just that testing so far has not yielded this result. Again, administrators are encouraged to apply the patch.

**How could an attacker exploit this vulnerability?**

An attacker could seek to exploit this vulnerability on machines that have anonymous access enabled by sending a malformed SMB request to a target computer and crashing it.

**Could this vulnerability be exploited by a user on the Internet?**

Only if TCP ports 445 and 139 were open at the firewall. This would block access from untrusted networks. Best practices say these ports should be blocked.

**Would the user need to be authenticated in order to exploit the vulnerability?**

If anonymous access has been disabled, only an authenticated user could exploit this vulnerability. Requiring authenticated users instead of anonymous access would make it easier for an administrator to determine who the attacker was.

**What does the patch do?**

The patch eliminates the vulnerability by checking for correct inputs before responding to SMB requests, thereby eliminating the vulnerability.

## Patch availability

**Download locations for this patch**

* Microsoft Windows NT 4.0 - [Download the update](https://www.microsoft.com/download/details.aspx?familyid=f7e5f781-1e4e-446e-a1cd-b53d7f46952b)
* Microsoft Windows NT 4.0 Terminal Server Edition - [Download the update](https://www.microsoft.com/download/details.aspx?familyid=0b289a89-af28-4686-b8a3-ccd311fc3dc4)
* Microsoft Windows 2000 - [Download the update](https://www.microsoft.com/download/details.aspx?familyid=6fd9240c-4d7b-461c-ad26-01061d098454)
* Microsoft Windows XP - [Download the update](https://www.microsoft.com/download/details.aspx?familyid=7449252d-cefa-4e84-a6da-4b68c3b1320b)
* Microsoft Windows XP 64 bit Edition - [Download the update](https://www.microsoft.com/download/details.aspx?familyid=b2cc5607-a6be-410d-822c-6893d754c7df)

#### Additional information about this patch

**Installation platforms:**

* Windows NT 4.0:

  The Windows NT 4.0 patch can be installed on systems running [Service Pack 6a](https://support.microsoft.com/kb/241211)
* The Windows NT 4.0 Terminal Server Edition patch can be installed on systems running Windows NT 4.0 TSE [Service Pack 6](https://www.microsoft.com/technet/archive/winntas/downloads/ts4sp6.mspx).
* Windows 2000:

  This patch can be installed on systems running Windows 2000 [Service Pack 2](https://www.microsoft.com/windows2000/downloads/servicepacks/sp2/default.mspx) or Windows 2000 [Service Pack 3](https://www.microsoft.com/windows2000/downloads/servicepacks/sp3/default.mspx)
* The patch for Windows XP can be installed on systems running Windows XP Gold.

**Inclusion in future service packs:**

* The fix for this issue will be included in Windows 2000 Service Pack 4.
* The fix for this issue will be included in Windows XP Service Pack 1.

**Reboot needed:** Yes

**Patch can be uninstalled:** Yes

**Superseded patches:** None.

**Verifying patch installation:**

* To verify that the patch has been installed on the machine, confirm that the following registry key has been created on the machine:

  HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Updates\...\Q326830.
* To verify the individual files, use the date/time and version information provided in the following registry key:

  HKEY\_LOCAL\_MACHINE\SOFTWARE\Microsoft\Updates\...\Q326830\Filelist

**Caveats:**

None

**Localization:**

Localized versions of this patch are available at the locations discussed in "Patch Availability".

**Obtaining other security patches:**

Patches for other security issues are available from the following locations:

* Security patches are available from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?linkid=21129), and can be most easily found by doing a keyword search for "security\_patch".
* Patches for consumer platforms are available from the [WindowsUpdate](https://windowsupdate.microsoft.com/) web site

#### Other information:

**Acknowledgments**

Microsoft [thanks](https://technet.microsoft.com/security/bulletin/policy) Alberto Solino and Hernan Ochoa of the Security Consulting Services team of [Core Security Technologies](https://www.corest.com/) for reporting this issue to us and working with us to protect customers.

**Support:**

* Microsoft Knowledge Base article Q326830 discusses this issue and will be available approximately 24 hours after the release of this bulletin. Knowledge Base articles can be found on the [Microsoft Online Support](https://support.microsoft.com/?scid=fh;en-us;kbhowto) web site.
* Technical support is available from [Microsoft Product Support Services](https://support.microsoft.com/directory/question.asp?sd=gn&fr;=0). There is no charge for support calls associated with security patches.

**Security Resources:** The [Microsoft TechNet Security](https://www.microsoft.com/technet/security/default.mspx) Web Site provides additional information about security in Microsoft products.

**Disclaimer:**

The information provided in the Microsoft Knowledge Base is provided "as is" without warranty of any kind. Microsoft disclaims all warranties, either express or implied, including the warranties of merchantability and fitness for a particular purpose. In no event shall Microsoft Corporation or its suppliers be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if Microsoft Corporation or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation of liability for consequential or incidental damages so the foregoing limitation may not apply.

**Revisions:**

* V1.0 (August 22, 2002): Bulletin Created.

*Built at 2014-04-18T13:49:36Z-07:00*

---

## Additional resources

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025
## Additional resources

### In this article

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025



=== Content from marc.info_059f5ae2_20250125_012733.html ===

```
[[prev in list](?l=bugtraq&m=103011960028681&w=2)] [[next in list](?l=bugtraq&m=103012006129274&w=2)] [[prev in thread](?l=ntbugtraq&m=103006173412298&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [CORE-20020618: Vulnerabilities in Windows SMB (DoS)](?t=103006189700001&r=1&w=2)
From:       [Iván_Arce <core.lists.bugtraq () core-sdi ! com>](?a=97235908800003&r=1&w=2)
Date:       [2002-08-22 23:41:39](?l=bugtraq&r=1&w=2&b=200208)
[Download RAW [message](?l=bugtraq&m=103011556323184&q=mbox) or [body](?l=bugtraq&m=103011556323184&q=raw)]

                            CORE SECURITY TECHNOLOGIES
                                  <http://www.corest.com>

                       Vulnerability report for Windows SMB DoS

Date Published: 2002-08-22

Last Update: 2002-08-22

Advisory ID: CORE-20020618

Bugtraq ID: N/A

CVE: CAN-2002-0724

CERT: VU#311619, VU#342243,VU#250635

Title: Denial of Service Vulnerabilities in Windows SMB implementation

Class: Implementation flaws

Remotely Exploitable: Yes

Locally Exploitable: Yes

Advisory URL: <http://www.corest.com/common/showdoc.php?idx=262&idxseccion=10>

Vendors contacted:

 Microsoft Corporation
 .CORE notification: 2002-07-11
 .Notification acknowledged by MS: 2002-07-12
 .MS initial fix provided: 2002-07-26
 .CORE tested fix: 2002-07-29
 .MS final testing and statements: 2002-08-22

Release Mode: COORDINATED RELEASE

*Vulnerability Description:*

 SMB stands for "Server Message Block" and is also known as CIFS
 (Common Internet File System).
 This protocol is intended to provide an open cross-platform
 mechanism for client systems to request file services from server
 system over a network.
 Current CIFS implementation under Windows runs over port tcp/139
 and/or port tcp/445 (Direct Host), depending whether NetBIOS over
 TCP/IP is enabled or not.

 The SMB_COM_TRANSACTION command allows the client and the server
 to define functions specific to a particular resource on a
 particular server. The functions supported are not defined by the
 protocol itself but by client and server implementations.

 By sending a specially crafted packet requesting the NetServerEnum2,
 NetServerEnum3 or NetShareEnum transaction, an attacker can mount a
 denial ofservice attack on the target machine.
 It might be possible to abuse this vulnerability to execute arbitrary
 code, although the research performed so far can not confirm this
 possibility (see 'Technical Description' below for more precise
 information).

 In order to exploit this vulnerability a user account is needed for
 the NetShareEnum transaction and only anonymous access is necessary
 for NetServerEnum2 and NetServerEnum3.

 Windows operating system ship with anonymous access enabled by default
 and are therefore vulnerable to a denial of service attack.

 The effect of an attack will trigger a operating system halt (Blue Screen)
 as shown below (memory addresses may vary):

 *** STOP: 0x0000001E (0xC0000005, 0x804B818B, 0x00000001, 0x00760065)
 KMODE_EXCEPTION_NOT_HANDLED
 *** Address 804B818B base at 80400000, DateStamp 384d9b17 0 ntoskrnl.exe

 The physical memory is dumped and the system restarted (unless configured
 otherwise).

*Vulnerable Systems:*

The problem was identified and tested on:

 - Windows NT 4.0 Workstation/Server
 - Windows 2000 Professional/Advanced Server
 - Windows XP Professional

 With all service packs and security hotfixes applied

*Solution/Vendor Information/Workaround*

 Microsoft has released a fix to the problem.
 Refer to Microsoft Security Bulletin MS02-045 for patches
 and fixes to vulnerable systems.

<http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS>
02-045.asp

 Workarounds

  - Disable anonymous access (NULL connections)
    This will not prevent legitimate users from abusing the vulnerability.

  - Block access to the SMB ports from untrusted networks.
    Blocking access to ports tcp/445 and tcp/139 at the network perimeter
    will prevent attacks from untrusted parties. However, this is not
    a viable solution for environment were file and printing services
    are needed for legitimate users.

  - Shutdown the Lanman server (net stop lanmanserver)
    This prevents exploitation from any attacker but removes all file
    and print sharing functionality from the vulnerable server. It might
    not be a viable solution in many environments.

*Credits:*

These vulnerabilities were discovered and researched by Alberto Solino
and Hernan Ochoa of the Security Consulting Services team at CORE SECURITY
TECHNOLOGIES.

*Technical Description - Exploit/Concept Code*

The following analysis was performed on a Windows 2000 Advanced Server
(Service Pack 2).

The attack consists of sending (after establishing a SMB session) a
specially
crafted SMB_COM_TRANSACTION packet requesting the NetServerEnum2,
NetServerEnum3
or NetShareEnum functions of the Microsoft Windows Lanman Remote API
Protocol.

The format of this packet consist of a SMB Header plus the Transaction
request.
The transaction request has the following format:

Transaction Request Format
===============================================
+0  Word Count  (BYTE)
+1  Total Parameter Count (WORD)
+3  Total Data Count (WORD)
+5  Max Param Count  (WORD)
+7  Max Data Count  (WORD)
+9  Max Setup Count  (BYTE)
+10 (0Ah) Reserved  (BYTE)
+11 (0Bh) Flags   (WORD)
+13 (0Dh) Timeout   (DWORD)
+17 (11h) Reserved  (WORD)
+19 (13h) Parameter Count  (WORD)
+21 (15h) Parameter Offset (WORD)
+23 (17h) Data Count  (WORD)
+25 (19h) Data Offset  (WORD)
+27 (1Bh) Setup Count  (BYTE)
+28 (1Ch) Reserved  (BYTE)
+29 (1Dh) Byte Count  (WORD)
+31 (1Fh) Transaction Name '\PIPE\LANMAN\x00' (13 BYTES)
+44 (2Ch) Parameters

Parameters
===============================================
+0  Function Code  (WORD)
+2  Parameter Descriptor  (6 BYTES)
+8  Return Descriptor     (7 BYTES)
+15 (0Fh) Detail Level  (WORD)
+17 (11h) Receive Buffer Length   (WORD)

The 'Function Code' found in 'Parameters' specifies the function requested.
In this case it must be 68h (NetServerEnum2), D7h (NetServerEnum3) or
00h (NetShareEnum).

The problem arises when the fields 'Max Param Count' and/or 'Max Data Count'
are set to zero (0).

Once the request packet is received by the Windows server, it is handled by
the SRV.SYS driver in kernel mode.
At SRV.SYS+08F4h it is determined that the packet is a SMB_COM_TRANSACTION
and a function we arbitrary named 'doSMB_COM_TRANSACTION' (SRV.SYS+D42A) is
called where the Transaction Request portion of the packet is parsed.

Here the 'Max Data Count' and 'Max Param Count' (and all other fields) are
extracted from the packet received, some calculations and sanity checks are
performed to determine the location of the 'Parameters' in the transaction
request packet and the amount of memory needed to store them.
A function is then called at SRV.SYS+DAB0 to allocate a structure in the
heap
(BUFFER1 from now on) that will contain data obtained from the transaction
packet and the 'Parameters':

[..]
0000DADB                 movzx   eax, si
0000DADE                 mov     [ebp+var_4], eax
0000DAE1                 add     eax, 3
0000DAE4                 mov     ecx, eax
0000DAE6                 mov     [ebp+var], eax
0000DAE9                 mov     eax, [ebp+argC_MaxDataCountAdded]
0000DAEC                 and     ecx, 0FFFFFFFCh ; align
0000DAEF                 cmp     eax, 10400h     ; the max of the data with
                                                 ; everything added is 66560
0000DAF4                 lea     edi, [ecx+eax+98h] ; Calculate the space
                                                    ; needed for the
structure
                                                    ;  + the 'Parameters'
0000DAFB                 mov     [ebp+argC_MaxDataCountAdded], edi
0000DAFE                 ja      short loc_1DB22
0000DB00                 cmp     [ebp+arg_1C], 0
0000DB04                 jnz     locAllocateHeap
[..]

[..]
0001B806 locAllocateHeap:
0001B806                 lea     eax, [ebp+1Ch]
0001B809                 push    eax             ; ptr to buffer that will
contain
                                                 ; error code
0001B80A                 push    edi             ; Bytes to allocate
(calculated
                                                 ; above at SRV.SYS+DAF4)
0001B80B                 call    myAllocateHeap
0001B810                 jmp     loc_1DB20
[..]

Later in the processing of the request, at SRV.SYS+33209h another buffer
will be
allocated in the heap.  This buffer (BUFFER2) will be next to the one
allocated
at SRV.SYS+1B806h (BUFFER1).

The problem is that due to the lack of proper checks and miscalculation,
when the
'Max Data Count' and/or 'Max Param Count' are zero, the length of the first
buffer
allocated on the heap (BUFFER1) will be insufficient and the first 8 bytes
of the
next chunk on the heap (used by the ntoskrnl!RtlFreeHeap() algorithm) will
be
overwritten.

When the first buffer allocated is freed by calling ntoskrnl!RtlFreeHeap()
the heap
will be in an inconsistent state (due to the corruption of the chunk's
'control'
data, used by the ntoskrnl!RtlFreeHeap() algorithm) and RtlFreeHeap() will
try to
access an invalid memory address resulting in the system crash (Blue
Screen).

The actual corruption of the heap occurs as result of a LPC message sent by
SRV.SYS
to the Lanman Server Service (implemented in srvsvc.dll, running in user
mode).

At SRV.SYS+33358, an LPC message to the Port '\\XactSrvLpcPort' is sent
(This port is created by srvsvc.dll):

[..]
00033336                 push    [ebp+arg_0]
00033339                 call    myImpersonateSecurityContext
0003333E                 xor     esi, esi
00033340                 mov     [ebp+errorCode], eax
00033343                 cmp     eax, esi
00033345                 jl      short loc_43366
00033347                 lea     eax, [ebp+varReplyMessage]
0003334D                 push    eax             ; OUT PPORT_MESSAGE
ReplyMessage
0003334E                 lea     eax, [ebp+varRequestMessage]
00033351                 push    eax             ; IN PPORT_MESSAGE
RequestMessage
00033352                 push    myPortHandle    ; IN HANDLE PortHandle
00033358                 call    ds:NtRequestWaitReplyPort
0003335E                 mov     [ebp+errorCode], eax
[..]

This message is handled by srvsvc.dll where function to be called is
obtained
from a message table, described below as 'PortFuncMsgTable':

[..]
767E88A3
767E88A3                 mov     [ebp+var_CC], 10h
767E88AC                 mov     [ebp+var_CA], 28h
767E88B5                 mov     [ebp+var_C8], esi
767E88BB                 mov     eax, [ebp+var_88]
767E88C1                 mov     [ebp+var_C4], eax
767E88C7                 mov     eax, [ebp+var_84]
767E88CD                 mov     [ebp+var_C0], eax
767E88D3                 mov     eax, [ebp+var_80]
767E88D6                 mov     [ebp+var_BC], eax
767E88DC                 mov     eax, [ebp+var_78]
767E88DF                 cmp     eax, 0Ah
767E88E2                 ja      Func3
767E88E8                 jmp     ds:PortFuncMsgTable[eax*4]
[..]

This ends up calling the function at SRVSVC.DLL:767EE136, that receives the
buffer
allocated (BUFFER1) in kernel mode by the SRV.SYS driver.

The function then checks again the Parameters of the transaction request, by
calling different functions in xactsrv.dll:

[..]
767EE1B1                 push    eax
767EE1B2                 push    ebx
767EE1B3                 call    pfXsCheckSmbDescriptor ;
XsCheckSMBDescriptor is located in
       ; xactsrv.dll (7568d46f)
767EE1B9                 test    eax, eax
767EE1BB                 jnz     loc_767EE2A1
[..]

XsCheckSMBDescriptor performs some checks and processing of the Parameters
and
Return Descriptor of the SMB Transaction request. Then the function
'XsCaptureParemters' is called to perform further processing:

[..]
767EE2A1                 lea     eax, [ebp-0D0h]
767EE2A7                 push    eax
767EE2A8                 push    dword ptr [ebp-20h] ; ptr to 'BUFFER1'
structure
767EE2AB                 call    pfXsCaptureParameters
767EE2B1                 mov     [ebp-1Ch], eax
[..]

At xactsrv!7568D2D5 the 5th byte after the end of BUFFER1 is overwritten
with a 0:

[..]
7568D2D5                 movzx   ecx, ax
7568D2D8                 mov     [esi], ax
7568D2DB                 mov     edi, [edx+48h]
7568D2DE                 mov     edx, ecx
7568D2E0                 xor     eax, eax
7568D2E2                 shr     ecx, 2
7568D2E5                 repe stosd
7568D2E7                 mov     ecx, edx
7568D2E9                 and     ecx, 3
7568D2EC                 repe stosb   ; here the 5th byte is overwritten
7568D2EE                 jmp     short loc_7568D33D
[..]

After returning from this call, based on the Function Code of the
transaction,
the requested function is called in xactsrv.dll (XsNetServerEnum2,
XsNetServerEnum3,
or XsNetShareEnum in this case)

[..]
767EE22F                 mov     dword ptr [ebp-4], 2
767EE236                 push    dword ptr [ebp-0D0h]
767EE23C                 push    dword ptr [ebp-0DCh]
767EE242                 push    ebx
767EE243                 push    dword ptr [ebp-1Ch]
767EE246                 call    dword ptr table_767F2E38[edi] ; 'function'
table
[..]

Inside the called function (XsNetServerEnum2 or XsNetServerEnum3) another
function,
browser.dll!I_BrowserServerEnumForXactSrv, will be called. The value
returned
from this function will later be used to overwrite the heap.
The observed return values that are used to overwrite the heap were 17E6h
and 7Ch.
It is not evident that this values can be controlled by the attacker in a
reliable
way.

[..]
75688823                 add     eax, 64h
75688826                 push    eax
75688827                 push    [ebp+var_38]
7568882A                 push    ebx
7568882B                 call    I_BrowserServerEnumForXactsrv
75688830                 mov     [edi], ax   ; ax contains returned value
        ; this value will be the one
        ; used to overwrite the heap
75688833                 test    ax, ax
75688836                 jz      short loc_75688844
[..]

Finally after some more processing the function will return to
srvsvc.dll!767ee24c after
executing the function requested (XsNetServerEnum2, XsNetServerEnum3 or
XsNetShareEnum)

Some other processing with the returned number will be done and the
XsSetParameter
function will be called. This call will effectively overwrite the first two
bytes after
the BUFFER1 structure with the value returned from the call to
browser.dll!I_BrowserServerEnumForXactSrv, and then the 3rd and 4th byte
will be
overwritten with 0.

[..]
767EE28C                 push    dword ptr [ebp-0A0h]
767EE292                 push    edi
767EE293                 push    dword ptr [ebp-20h]
767EE296                 call    pfXsSetParameters  ; Call to
XsSetParameters
[..]

[..]
XsSetParameters:
7568DB0D
7568DB0D                 push    ebp
7568DB0E                 mov     ebp, esp
7568DB10                 push    ecx
7568DB11                 mov     ecx, [ebp+0Ch]
7568DB14                 mov     eax, [ebp+10h]
7568DB17                 push    ebx
7568DB18                 push    esi
7568DB19                 mov     esi, [ebp+08h]
7568DB1C                 mov     dx, [ecx]
7568DB1F                 push    edi
7568DB20                 push    2
7568DB22                 mov     ebx, [esi+40h]   ; ptr to past the end of
BUFFER1
7568DB25                 mov     [ebp+10h], eax
7568DB28                 mov     eax, [esi+3Ch]
7568DB2B                 pop     edi
7568DB2C                 mov     [ebx], dx ; overwrite the first two bytes
7568DB2F                 mov     dx, [ecx+2]
7568DB33                 add     ebx, edi
7568DB35                 add     eax, edi
7568DB37                 mov     [ebx], dx ; overwrite the 3th and 4th byte
[..]

Exploitation of this vulnerability in order to run arbitrary code on the
vulnerable
system is not straight forward and our research so far could not identify a
reliable attack scenario other than to perform a denial of service.

The complexity of exploiting this vulnerability to gain unauthorized access
to
a system or plainly run arbitrary code on it resides on the fact that the
attacker can not completly control the bytes used to overwrite the chunk's
'control'
data nor the bytes contained in BUFFER2 (of  which the 'control' data is
overwritten).

We do not discard that further research will demonstrate that arbitrary code
execution is possible.

When the attack is performed using the NetShareEnum function, the corruption
of the
heap also occurs in the call to XsSetParameters, but
I_I_BrowserServerEnumForXactsrv
is not called, and possible values to overwrite the chunk 'control' data are
more
promising in terms of exploiting the problem, but the lack of complete
control of
the data of BUFFER2 again makes it difficult.

 Conclusion

 The vulnerabilities described in this advisory can be
 abused by an attacker in order to conduct a denial of service attack
 against the vulnerable system both remotelly and locally using
 either an active user's account or logging in using a NULL connection.

 Arbitrary execution of code has not been proved but is not discarded
 as a possibility.

*DISCLAIMER:*

The contents of this advisory are copyright (c) 2002 CORE Security
Technologies and may be distributed freely provided that no fee is charged
for this distribution and proper credit is given.

$Id: smbdos.txt,v 1.12 2002/08/22 23:31:32 iarce Exp $

---
Perscriptio in manibus tabellariorum est
Noli me vocare, ego te vocabo

Ivan Arce
CTO
CORE SECURITY TECHNOLOGIES

44 Wall Street - New York, NY 10005
Ph: (212) 461-2345
Fax: (212) 461-2346
<http://www.corest.com>

PGP Fingerprint: C7A8 ED85 8D7B 9ADC 6836  B25D 207B E78E 2AD1 F65A

--- for a personal reply use: =?iso-8859-1?Q?Iv=E1n_Arce?= <ivan.arce@corest.com>
[[prev in list](?l=bugtraq&m=103011960028681&w=2)] [[next in list](?l=bugtraq&m=103012006129274&w=2)] [[prev in thread](?l=ntbugtraq&m=103006173412298&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from www.kb.cert.org_a1953d0a_20250125_012734.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#311619

## Microsoft Windows Server Message Block (SMB) fails to properly handle SMB\_COM\_TRANSACTION packets requesting NetServerEnum3 transaction

#### Vulnerability Note VU#311619

Original Release Date: 2002-08-23 | Last Revised: 2002-08-26

---

### Overview

Microsoft Server Message Block (SMB) may crash upon receipt of a crafted SMB\_COM\_TRANSACTION packet requesting a NetServerEnum3 transaction. Attackers can use this vulnerability to cause a denial of service.

### Description

| SMB is a protocol for sharing data and resources between computers, included in many versions of Microsoft Windows.  SMB may crash if it receives a crafted SMB\_COM\_TRANSACTION packet requesting a NetServerEnum2 transaction. If either the 'Max Param Count' field or 'Max Data Count' field of the packet is set to zero (0), the destination SMB host will crash with a blue screen. This vulnerability can be exploited by both local and remote attackers. |
| --- |

### Impact

| Remote attackers can cause a denial of service. Attackers may also be able to execute arbitrary code, though this has not been demonstrated or proven. |
| --- |

### Solution

| **Apply a patch**For more information, see:<http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp> |
| --- |

### Vendor Information

311619
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23311619/) to view vendors.**
### [Microsoft Corporation](#SVIM-5C3LZ3) Affected

Notified:  July 15, 2002  Updated: August 23, 2002

### Status

Affected

### Vendor Statement

See: <http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

<http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>

### Acknowledgements

Thanks to Ivan Arce of CORE Security Technologies for reporting this vulnerability.

This document was written by Shawn Van Ittersum.

### Other Information

| **CVE IDs:** | [None](http://web.nvd.nist.gov/vuln/detail/None) |
| --- | --- |
| **Severity Metric:** | 0.87 |
| **Date Public:** | 2002-08-22 |
| **Date First Published:** | 2002-08-23 |
| **Date Last Updated:** | 2002-08-26 18:22 UTC |
| **Document Revision:** | 10 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from www.kb.cert.org_dbe94bce_20250125_012734.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#250635

## Microsoft Windows Server Message Block (SMB) fails to properly handle SMB\_COM\_TRANSACTION packets requesting NetServerEnum2 transaction

#### Vulnerability Note VU#250635

Original Release Date: 2002-08-23 | Last Revised: 2003-08-19

---

### Overview

Microsoft Server Message Block (SMB) may crash when it receives a crafted SMB\_COM\_TRANSACTION packet requesting a NetServerEnum2 transaction. Attackers can use this vulnerability to cause a denial of service.

### Description

| SMB is a protocol for sharing data and resources between computers. It is included in many versions of Microsoft Windows.  SMB will crash if it receives a crafted SMB\_COM\_TRANSACTION packet requesting a NetServerEnum2 transaction. If either the 'Max Param Count' field or the 'Max Data Count' field of the packet is set to zero (0), the destination SMB host will crash with a blue screen. This vulnerability can be exploited by both local and remote attackers. |
| --- |

### Impact

| Remote attackers can cause a denial of service. Attackers may also be able to execute arbitrary code, though this has not been demonstrated or proven. |
| --- |

### Solution

| **Apply a patch**For more information, see:<http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp> |
| --- |

| **Disable anonymous access**Disable anonymous SMB access. See Microsoft Knowledge Base Article [246261](http://support.microsoft.com/support/kb/articles/Q246/2/61.asp) for information about configuring anonymous access in Windows 2000. Note that disabling this access will not prevent authenticated users from exploiting this vulnerability and may actually have adverse affects in mixed-mode domains.**Block or Restrict Access**Block access to SMB services (139/tcp, 445/tcp) from untrusted networks such as the Internet. |
| --- |

### Vendor Information

250635
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23250635/) to view vendors.**
### [Microsoft Corporation](#SVIM-5C3KYC) Affected

Notified:  July 15, 2002  Updated: August 23, 2002

### Status

Affected

### Vendor Statement

See: <http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>
* <http://www.securityfocus.com/bid/5556>
### Acknowledgements

Thanks to Ivan Arce for reporting this vulnerability.

This document was written by Shawn Van Ittersum.

### Other Information

| **CVE IDs:** | [CVE-2002-0724](http://web.nvd.nist.gov/vuln/detail/CVE-2002-0724) |
| --- | --- |
| **Severity Metric:** | 5.02 |
| **Date Public:** | 2002-08-22 |
| **Date First Published:** | 2002-08-23 |
| **Date Last Updated:** | 2003-08-19 21:12 UTC |
| **Document Revision:** | 16 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from www.kb.cert.org_42a318b8_20250125_012735.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#342243

## Microsoft Windows Server Message Block (SMB) fails to properly handle SMB\_COM\_TRANSACTION packets requesting NetShareEnum transaction

#### Vulnerability Note VU#342243

Original Release Date: 2002-08-23 | Last Revised: 2003-07-02

---

### Overview

Microsoft Server Message Block (SMB) is a protocol for sharing data and resources between computers. SMB may crash upon receipt of a crafted SMB\_COM\_TRANSACTION packet requesting a NetShareEnum transaction. Attackers can use this vulnerability to cause a denial of service. SMB is included in many versions of Microsoft Windows.

### Description

| SMB will crash if it receives a crafted SMB\_COM\_TRANSACTION packet requesting a NetShareEnum transaction, with field "Max Param Count" or "Max Data Count" set to zero (0). On exploitation, the crashed host condition exhibits a blue screen. This vulnerability can be exploited by an attacker with access to a user account on the target system. By default, anonymous users have the required access to exploit this vulnerability; therefore on most Windows systems an attacker does not need to be authenticated. |
| --- |

### Impact

| Attackers can cause a denial of service. Attackers might also be able to execute arbitrary code, though this has not been demonstrated or proven. |
| --- |

### Solution

| **Apply a patch**  For more information about patches, see<http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp> |
| --- |

| **Disable anonymous access**Disable anonymous SMB access. See Microsoft Knowledge Base Article [246261](http://support.microsoft.com/support/kb/articles/Q246/2/61.asp) for information about configuring anonymous access in Windows 2000. This will not prevent authenticated users from exploiting this vulnerability, and may have adverse affects in mixed-mode domains.**Block or Restrict Access**Block access to SMB services (139/tcp, 445/tcp) from untrusted networks such as the Internet. |
| --- |

### Vendor Information

342243
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23342243/) to view vendors.**
### [Microsoft Corporation](#SVIM-5C3LME) Affected

Notified:  July 15, 2002  Updated: August 23, 2002

### Status

Affected

### Vendor Statement

See: <http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://www.microsoft.com/technet/treeview/?url=/technet/security/bulletin/MS02-045.asp>
* <http://www.securityfocus.com/bid/5556>
* <http://support.microsoft.com/support/kb/articles/Q246/2/61.asp>
### Acknowledgements

Thanks to Ivan Arce of CORE Security Technologies for reporting this vulnerability.

This document was written by Shawn Van Ittersum.

### Other Information

| **CVE IDs:** | [CVE-2002-0724](http://web.nvd.nist.gov/vuln/detail/CVE-2002-0724) |
| --- | --- |
| **Severity Metric:** | 5.02 |
| **Date Public:** | 2002-08-22 |
| **Date First Published:** | 2002-08-23 |
| **Date Last Updated:** | 2003-07-02 22:59 UTC |
| **Document Revision:** | 16 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800


