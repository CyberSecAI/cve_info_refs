=== Content from marc.info_e0c4b19e_20250125_232454.html ===

```
[[prev in list](?l=bugtraq&m=102763127102739&w=2)] [[next in list](?l=bugtraq&m=102761586116953&w=2)] [prev in thread] [[next in thread](?l=ntbugtraq&m=102760479902411&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Microsoft SQL Server 2000 Unauthenticated System Compromise (#NISR25072002)](?t=102760203700002&r=1&w=2)
From:       ["NGSSoftware Insight Security Research" <nisr () nextgenss ! com>](?a=100449261000003&r=1&w=2)
Date:       [2002-07-25 9:07:53](?l=bugtraq&r=1&w=2&b=200207)
[Download RAW [message](?l=bugtraq&m=102760196931518&q=mbox) or [body](?l=bugtraq&m=102760196931518&q=raw)]

NGSSoftware Insight Security Research Advisory
Name: Unauthenticated Remote Compromise in MS SQL Server 2000
Systems: Microsoft SQL Server 2000, all Service Packs
Severity: Critical/Very High Risk.
Category: Remote Buffer Overrun Vulnerability
Vendor URL: <http://www.microsoft.com/>
Author: David Litchfield (david@ngssoftware.com)
Advisory URL: <http://www.ngssoftware.com/advisories/mssql-udp.txt>
Date: 25th July 2002

Advisory number: #NISR25072002

VNA reference : <http://www.ngssoftware.com/vna/ms-sql.txt>

This advisory covers the solution to one of the problems mentioned in the
above VNA URL.

Description
***********

Microsoft's database server SQL Server 2000 exhibits two buffer overrun
vulnerabilities that can be exploited by a remote attacker without ever
having to authenticate to the server. What further exacerbates these issues
is that the attack is channeled over UDP. Whether the SQL Server process
runs in the security context of a domain user or the local SYSTEM account,
successful exploitation of these security holes will mean a total compromise
of the target server and its data.

Details
*******

SQL Server can be configured to listen for incoming client connections in
several different ways. It can be configured such that clients can use named
pipes over a NetBIOS session (TCP port 139/445) or sockets with clients
connecting to TCP port 1433 or both. Which ever method is used the SQL
Server will always listen on UDP port 1434. This port is designated as the
Microsoft SQL Monitor port and clients will send a message to this port to
dynamically discover how the client should connect to the Server. This
message is a single byte packet, the byte being 0x02.

There are other messages that can be sent to this port and these can be
worked out with simple experimentation.

Stack Based Buffer Overflow
*********************************

When SQL Server receives a packet on UDP port 1434 with the first byte set
to 0x04, the SQL Monitor thread takes the remaining data in the packet and
attempts to open a registry key using this user supplied information. For
example, by sending \x04\x41\x41\x41\x41 (0x04 followed by 4 upper case
'A's) SQL Server attempts to open

HKLM\Software\Microsoft\Microsoft SQL Server\AAAA\MSSQLServer\CurrentVersion

By appending a large number of bytes to the end of this packet, whilst
preparing the string for the registry key to open, a stack based buffer is
overflowed and the saved return address is overwritten. This allows an
attacker to gain complete control of the SQL Server process and its path of
execution. By overwriting the saved return address on the stack with an
address that contains a "jmp esp" or "call esp" instruction, when the
vulnerable procedure returns the processor will start executing code of the
attacker's choice. At no stage does the attacker need to authenticate.

Heap Based Buffer Overflow
********************************

When SQL Server receives a packet on UDP port 1434 with the first byte set
to 0x08 followed by an overly long string, followed by a colon character (:)
and number a heap based buffer is overflowed. As this corrupts the
structures used to keep track of the heap an attacker can overwrite any
location in memory with 4 bytes of their own choosing. This can be used to
gain remote control of the processes execution. If the colon and number are
missing the SQL Server process access violates before the heap is corrupted
as the code in the SQL Monitor thread fails to handle exceptions.

For example the code calls the C function strtok(). The strtok() functions
looks for a given token in a string, in this case a colon, and if found
returns a pointer to it. If the colon is missing in the string being
searched then no pointer is returned. This is one of the reasons why the SQL
Server process access violates if the colon is missing. The code does not
check to see if a valid pointer has been returned before passing it to
another function call, atoi():

char *ptr=NULL;
int num=0;
..
ptr = strtok(string,":");
num = atoi(ptr); // ptr is used without being validated

Failure to check return values and handle exceptions leads to the process
dying, leading to a simple Denial of Service attack. That said, in the light
of the overflows, the DoS is the least of the problems.

Network Based Denial of Service
*************************************

When an SQL Server receives a single byte packet, 0x0A, on UDP port 1434 it
will reply to the sender with 0x0A. A problem arises as SQL Server will
respond, sending a 'ping' response to the source IP address and source port.
This 'ping' is a single byte UDP packet - 0x0A. By spoofing a packet from
one SQL Server, setting the UDP port to 1434, and sending it the a second
SQL Server, the second will respond to the first's UDP port 1434. The first
will then reply to the second's UDP port 1434 and so on. This causes a storm
of single byte pings between the two servers. Only when one of the servers
is disconnected from the network or its SQL service is stopped will the
storm stop. This is a simple newtork based DoS, reminiscent of the echo and
chargen DoSes discussed back in 1996
(<http://www.cert.org/advisories/CA-1996-01.html>). When in this state, the
load on each SQL Server is raised to c. 40 - 60 % CPU time.

Considerations for protection against these vulnerabilities
********************************

Exploitation of these security holes goes over UDP, a connection-less
communications protocol. As such it makes the task of bypassing the
protection offered by a firewall considerably easier. The spoofing of an IP
address in a UDP packet is also considerably easier.

It is trivial for an attacker to send an attack through the firewall,
setting the source IP address to that of the target's DNS Server and the
source port to 53. Most firewalls will allow this packet through as it will
look like a response to a query to resolve a domain name.

It is strongly recommended that a rule be added to each organization's
firewall such that any packet destined for UDP port 1434 on the 'clean' side
of the firewall be dropped and logged. No host, even DNS Servers, should be
allowed to send traffic to this port.

It is also recommend that firewall administrators ensure that any packet
received on the 'dirty' interface with a source IP address set to an address
on the clean side is also dropped and logged.

Fix Information
***************

NGSSoftware alerted Microsoft to this problem on the 17th of May 2002 and
they have produced a patch that resolves these issues. NGSSoftware urge all
customers of SQL Server 2000 to test then apply these fixes as soon as
possible.

<http://www.microsoft.com/technet/treeview/default.asp?url=/technet/security/>
bulletin/MS02-039.asp

Where possible, NGSSoftware also recommend running the SQL Server as low
privileged local account and not SYSTEM or a domain account.

A check for these vulnerabilities has been added to Typhon II,
NGSSoftware'svulnerability assessment scanner, of which, more information is
available from the NGSSite, <http://www.ngssoftware.com/>

Further Information
********************
The author will be discussing these vulnerabilities in detail, with several
exploitation demonstrations, at the up and coming Blackhat Security
Briefings conference is Las Vegas. For those interested in attending this
conference, please see <http://www.blackhat.com> for more details.

For more information about buffer overflows please read

<http://www.ngssoftware.com/papers/ntbufferoverflow.html>
<http://www.ngssoftware.com/papers/bufferoverflowpaper.rtf>
<http://www.ngssoftware.com/papers/unicodebo.pdf>
<http://www.ngssoftware.com/papers/non-stack-bo-windows.pdf>

[[prev in list](?l=bugtraq&m=102763127102739&w=2)] [[next in list](?l=bugtraq&m=102761586116953&w=2)] [prev in thread] [[next in thread](?l=ntbugtraq&m=102760479902411&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_1a4d8a8f_20250125_232454.html ===

```
[[prev in list](?l=ntbugtraq&m=102756324102724&w=2)] [[next in list](?l=ntbugtraq&m=102760903507877&w=2)] [[prev in thread](?l=bugtraq&m=102760196931518&w=2)] [next in thread]
List:       [ntbugtraq](?l=ntbugtraq&r=1&w=2)
Subject:    [Microsoft SQL Server 2000 Unauthenticated System Compromise](?t=102760203700002&r=1&w=2)
From:       [NGSSoftware Insight Security Research <nisr () NEXTGENSS ! COM>](?a=101614336100005&r=1&w=2)
Date:       [2002-07-25 9:07:53](?l=ntbugtraq&r=1&w=2&b=200207)
[Download RAW [message](?l=ntbugtraq&m=102760479902411&q=mbox) or [body](?l=ntbugtraq&m=102760479902411&q=raw)]

NGSSoftware Insight Security Research Advisory
Name: Unauthenticated Remote Compromise in MS SQL Server 2000
Systems: Microsoft SQL Server 2000, all Service Packs
Severity: Critical/Very High Risk.
Category: Remote Buffer Overrun Vulnerability
Vendor URL: <http://www.microsoft.com/>
Author: David Litchfield (david@ngssoftware.com)
Advisory URL: <http://www.ngssoftware.com/advisories/mssql-udp.txt>
Date: 25th July 2002

Advisory number: #NISR25072002

VNA reference : <http://www.ngssoftware.com/vna/ms-sql.txt>

This advisory covers the solution to one of the problems mentioned in the
above VNA URL.

Description
***********

Microsoft's database server SQL Server 2000 exhibits two buffer overrun
vulnerabilities that can be exploited by a remote attacker without ever
having to authenticate to the server. What further exacerbates these issues
is that the attack is channeled over UDP. Whether the SQL Server process
runs in the security context of a domain user or the local SYSTEM account,
successful exploitation of these security holes will mean a total compromise
of the target server and its data.

Details
*******

SQL Server can be configured to listen for incoming client connections in
several different ways. It can be configured such that clients can use named
pipes over a NetBIOS session (TCP port 139/445) or sockets with clients
connecting to TCP port 1433 or both. Which ever method is used the SQL
Server will always listen on UDP port 1434. This port is designated as the
Microsoft SQL Monitor port and clients will send a message to this port to
dynamically discover how the client should connect to the Server. This
message is a single byte packet, the byte being 0x02.

There are other messages that can be sent to this port and these can be
worked out with simple experimentation.

Stack Based Buffer Overflow
*********************************

When SQL Server receives a packet on UDP port 1434 with the first byte set
to 0x04, the SQL Monitor thread takes the remaining data in the packet and
attempts to open a registry key using this user supplied information. For
example, by sending \x04\x41\x41\x41\x41 (0x04 followed by 4 upper case
'A's) SQL Server attempts to open

HKLM\Software\Microsoft\Microsoft SQL Server\AAAA\MSSQLServer\CurrentVersion

By appending a large number of bytes to the end of this packet, whilst
preparing the string for the registry key to open, a stack based buffer is
overflowed and the saved return address is overwritten. This allows an
attacker to gain complete control of the SQL Server process and its path of
execution. By overwriting the saved return address on the stack with an
address that contains a "jmp esp" or "call esp" instruction, when the
vulnerable procedure returns the processor will start executing code of the
attacker's choice. At no stage does the attacker need to authenticate.

Heap Based Buffer Overflow
********************************

When SQL Server receives a packet on UDP port 1434 with the first byte set
to 0x08 followed by an overly long string, followed by a colon character (:)
and number a heap based buffer is overflowed. As this corrupts the
structures used to keep track of the heap an attacker can overwrite any
location in memory with 4 bytes of their own choosing. This can be used to
gain remote control of the processes execution. If the colon and number are
missing the SQL Server process access violates before the heap is corrupted
as the code in the SQL Monitor thread fails to handle exceptions.

For example the code calls the C function strtok(). The strtok() functions
looks for a given token in a string, in this case a colon, and if found
returns a pointer to it. If the colon is missing in the string being
searched then no pointer is returned. This is one of the reasons why the SQL
Server process access violates if the colon is missing. The code does not
check to see if a valid pointer has been returned before passing it to
another function call, atoi():

char *ptr=NULL;
int num=0;
..
ptr = strtok(string,":");
num = atoi(ptr); // ptr is used without being validated

Failure to check return values and handle exceptions leads to the process
dying, leading to a simple Denial of Service attack. That said, in the light
of the overflows, the DoS is the least of the problems.

Network Based Denial of Service
*************************************

When an SQL Server receives a single byte packet, 0x0A, on UDP port 1434 it
will reply to the sender with 0x0A. A problem arises as SQL Server will
respond, sending a 'ping' response to the source IP address and source port.
This 'ping' is a single byte UDP packet - 0x0A. By spoofing a packet from
one SQL Server, setting the UDP port to 1434, and sending it the a second
SQL Server, the second will respond to the first's UDP port 1434. The first
will then reply to the second's UDP port 1434 and so on. This causes a storm
of single byte pings between the two servers. Only when one of the servers
is disconnected from the network or its SQL service is stopped will the
storm stop. This is a simple newtork based DoS, reminiscent of the echo and
chargen DoSes discussed back in 1996
(<http://www.cert.org/advisories/CA-1996-01.html>). When in this state, the
load on each SQL Server is raised to c. 40 - 60 % CPU time.

Considerations for protection against these vulnerabilities
********************************

Exploitation of these security holes goes over UDP, a connection-less
communications protocol. As such it makes the task of bypassing the
protection offered by a firewall considerably easier. The spoofing of an IP
address in a UDP packet is also considerably easier.

It is trivial for an attacker to send an attack through the firewall,
setting the source IP address to that of the target's DNS Server and the
source port to 53. Most firewalls will allow this packet through as it will
look like a response to a query to resolve a domain name.

It is strongly recommended that a rule be added to each organization's
firewall such that any packet destined for UDP port 1434 on the 'clean' side
of the firewall be dropped and logged. No host, even DNS Servers, should be
allowed to send traffic to this port.

It is also recommend that firewall administrators ensure that any packet
received on the 'dirty' interface with a source IP address set to an address
on the clean side is also dropped and logged.

Fix Information
***************

NGSSoftware alerted Microsoft to this problem on the 17th of May 2002 and
they have produced a patch that resolves these issues. NGSSoftware urge all
customers of SQL Server 2000 to test then apply these fixes as soon as
possible.

<http://www.microsoft.com/technet/treeview/default.asp?url=/technet/security/>
bulletin/MS02-039.asp

Where possible, NGSSoftware also recommend running the SQL Server as low
privileged local account and not SYSTEM or a domain account.

A check for these vulnerabilities has been added to Typhon II,
NGSSoftware'svulnerability assessment scanner, of which, more information is
available from the NGSSite, <http://www.ngssoftware.com/>

Further Information
********************
The author will be discussing these vulnerabilities in detail, with several
exploitation demonstrations, at the up and coming Blackhat Security
Briefings conference is Las Vegas. For those interested in attending this
conference, please see <http://www.blackhat.com> for more details.

For more information about buffer overflows please read

<http://www.ngssoftware.com/papers/ntbufferoverflow.html>
<http://www.ngssoftware.com/papers/bufferoverflowpaper.rtf>
<http://www.ngssoftware.com/papers/unicodebo.pdf>
<http://www.ngssoftware.com/papers/non-stack-bo-windows.pdf>
[[prev in list](?l=ntbugtraq&m=102756324102724&w=2)] [[next in list](?l=ntbugtraq&m=102760903507877&w=2)] [[prev in thread](?l=bugtraq&m=102760196931518&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from docs.microsoft.com_b016ed90_20250125_232525.html ===

[Skip to main content](#main)

This browser is no longer supported.

Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.

[Download Microsoft Edge](https://go.microsoft.com/fwlink/p/?LinkID=2092881 )
[More info about Internet Explorer and Microsoft Edge](https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge)

Table of contents

Exit focus mode

Read in English

Save

Table of contentsRead in English

Save

Add to plan
[Edit](https://github.com/MicrosoftDocs/security-updates/blob/live/security-updates/SecurityBulletins/2002/ms02-039.md "Edit This Document")

---

#### Share via

Facebook
x.com
LinkedIn
Email

---

Print

Table of contents

* Article
* 03/01/2023
* 6 contributors

Feedback

## In this article

Security Bulletin

# Microsoft Security Bulletin MS02-039 - Critical

## Buffer Overruns in SQL Server 2000 Resolution Service Could Enable Code Execution (Q323875)

Published: July 24, 2002 | Updated: January 31, 2003

**Version:** 1.2

**Originally posted:** July 24, 2002

**Updated:** January 31, 2003

#### Summary

**Who should read this bulletin:**
System administrators using MicrosoftÂ® SQL Serverâ¢ 2000 and Microsoft Desktop Engine 2000.

**Impact of vulnerability:**
Three vulnerabilities, the most serious of which could enable an attacker to gain control over an affected server.

**Maximum Severity Rating:**
Critical

**Recommendation:**
System administrators should install the patch immediately.

**Note:** The patch released with this bulletin is effective in protecting SQL Server 2000 and MSDE 2000 against the "SQL Slammer" worm virus. However, this patch has been superseded by the patch released with [MS02-061](https://technet.microsoft.com/security/bulletin/ms02-061) which contains fixes for additional security vulnerabilities in these products. Microsoft recommends that SQL 2000 and MSDE 2000 customers apply the patch from [MS02-061](https://technet.microsoft.com/security/bulletin/ms02-061).

**Affected Software:**

* Microsoft SQL Server 2000
* Microsoft Desktop Engine (MSDE) 2000

### General Information

## Technical details

**Technical description:**

This security patch does not contain a patch from Microsoft Knowledge Base Article [317748](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748) that is required to ensure normal operation of SQL Server 2000 and MSDE 2000. If you have applied this security patch to a SQL Server 2000 or MSDE 2000 installation prior to applying the hotfix from Microsoft Knowledge Patch article [317748](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748), you must answer "no" if and when prompted to overwrite files to ensure that you do not overwrite files from the security patch.

SQL Server 2000 and MSDE 2000 introduce the ability to host multiple instances of SQL Server on a single physical machine. Each instance operates for all intents and purposes as though it was a separate server. However, the multiple instances cannot all use the standard SQL Server session port (TCP 1433). While the default instance listens on TCP port 1433, named instances listen on any port assigned to them. The SQL Server Resolution Service, which operates on UDP port 1434, provides a way for clients to query for the appropriate network endpoints to use for a particular SQL Server instance.

There are three security vulnerabilities here. The first two are buffer overruns. By sending a carefully crafted packet to the Resolution Service, an attacker could cause portions of system memory (the heap in one case, the stack in the other) to be overwritten. Overwriting it with random data would likely result in the failure of the SQL Server service; overwriting it with carefully selected data could allow the attacker to run code in the security context of the SQL Server service.

The third vulnerability is a denial of service vulnerability. SQL uses a keep-alive mechanism to distinguish between active and passive instances. It is possible to create a keep-alive packet that, when sent to the Resolution Service, will cause SQL Server 2000 to respond with the same information. An attacker who created such a packet, spoofed the source address so that it appeared to come from a one SQL Server 2000 system, and sent it to a neighboring SQL Server 2000 system could cause the two systems to enter a never-ending cycle of keep-alive packet exchanges. This would consume resources on both systems, slowing performance considerably.

**Mitigating factors:**

Buffer Overruns in SQL Server Resolution Service:

* SQL Server 2000 runs in a security context chosen by the administrator at installation time. By default, it runs as a Domain User. Thus, although the attacker's code could take any desired action on the database, it would not necessarily have significant privileges at the operating system level if best practices have been followed.
* The risk posed by the vulnerability could be mitigated by, if feasible, blocking port 1434 at the firewall.

Denial of Service via SQL Server Resolution Service:

* An attack could be broken off by restarting the SQL Server 2000 service on either of the affected systems. Normal processing on both systems would resume once the attack ceased.
* The vulnerability provides no way to gain any privileges on the system. It is a denial of service vulnerability only.

**Severity Rating:**

|  |  |  |  |
| --- | --- | --- | --- |
| Buffer Overruns in SQL Server Resolution Service: | **Internet Servers** | **Intranet Servers** | **Client Systems** |
| **SQL Server 2000** | Critical | Critical | None |

|  |  |  |  |
| --- | --- | --- | --- |
| Denial of Service via SQL Server Resolution Service: | **Internet Servers** | **Intranet Servers** | **Client Systems** |
| **SQL Server 2000** | Critical | Critical | None |

The above [assessment](https://technet.microsoft.com/security/bulletin/rating) is based on the types of systems affected by the vulnerability, their typical deployment patterns, and the effect that exploiting the vulnerability would have on them.

**Vulnerability identifier:**

* Buffer Overruns in SQL Server Resolution Service: [CVE-CAN-2002-0649](https://cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0649)
* Denial of Service via SQL Server Resolution Service: [CVE-CAN-2002-0650](https://cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0650)

**Tested Versions:**

Microsoft tested SQL Server 2000 and 7.0 (and their associated versions of MSDE) to assess whether they are affected by these vulnerabilities. Previous versions are no longer [supported](https://support.microsoft.com/directory/discontinue.asp), and may or may not be affected by these vulnerabilities.

## Frequently asked questions

**What is the correct order for installing this patch in conjunction with the hotfix discussed in** [**317748**](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748)**?**

This security patch does not contain a patch from Knowledge Base Article [317748](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748) that is required to ensure normal operation of SQL Server 2000 and MSDE 2000. The correct order of installation is to install the [317748](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748) patch and then this security patch. If you have applied this security patch to a SQL Server 2000 or MSDE 2000 installation prior to applying the hotfix from Knowledge Patch article [317748](https://support.microsoft.com/default.aspx?scid=kb;en-us;317748), you must answer "no" if and when prompted to overwrite files to ensure that you do not overwrite files from the security patch.

**How do I check I've got this security patch installed?**

You should verify that the version of ssnetlib.dll in the \MSSQL\BINN folder for the instance you applied the patch for is: 2000.80.636.0
If the version of the ssnetlib.dll in the \MSSSQL\BINN folder is less than 2000.80.636.0, then you will need to re-apply the security patch. However Microsoft recommends that you apply the latest security patch as described in [MS02-061](https://technet.microsoft.com/security/bulletin/ms02-061) since this contains fixes for additional security vulnerabilities in these products.

**What vulnerabilities does this patch eliminate?**

This patch eliminates three vulnerabilities, both involving the SQL Server 2000 Resolution Service:

* The first two vulnerabilities could enable an attacker to gain significant, and perhaps complete, control over an affected SQL Server.
* The third vulnerability could enable an attacker to cause two affected SQL Servers to engage a never-ending information exchange, for the purpose of slowing the performance of the servers.

**What is the SQL Server 2000 Resolution Service?**

SQL Server 2000 introduces the ability to install multiple copies of SQL Server on a single machine and have it appear that the copies are completely separate database servers. These copies, known as [instances](https://msdn2.microsoft.com/library/aa176582), run independently of each other. The default instance listens on TCP port 1433. Other instances cannot share this same port and require a port of their own.
The challenge is how to enable SQL Server clients to find the port that a particular instance is operating on; the solution is the SQL Server Resolution Service. The first instance on a SQL Server always operates over port 1433. Additional instances are allocated their own port numbers dynamically. When a SQL client needs to connect to an additional instance on the SQL Server, it queries the SQL Server Resolution Service (which operates on UDP port 1434), which tells it which port the requested instance is using.

**Is the UDP 1434 port typically blocked at the firewall?**

It depends on the particular deployment scenario.

* If a network doesn't host any Internet-connected SQL Servers, the port associated with the SQL Server Resolution Service (and all other ports associated with SQL Server) should be blocked.
* If a network offers SQL Server services to the Internet but there's only a single instance on the server, the SQL Resolution Service can and should be blocked.
* If a network offers SQL Server services to the Internet and has more than one instance, the SQL Resolution Service must be accessible through the firewall.

**Does the SQL Server Resolution Service exist on previous versions of SQL Server?**

No. Previous versions of SQL Server didn't support multiple instances, and the SQL Server Resolution Service didn't exist. As a result, no other versions of SQL Server are affected by the vulnerabilities.

**The Affected Versions section says that Microsoft Desktop Engine (MSDE) is also affected by these vulnerabilities. What is MSDE?**

MSDE is a database engine that's built and based on SQL Server 2000 technology, and which ships as part of several Microsoft products, including Microsoft Visual Studio and Microsoft Office Developer Edition. There is a direct connection between versions of MSDE and versions of SQL Server. MSDE 2000 is based on SQL Server 2000.

**Buffer Overruns in SQL Server Resolution Service (CVE-CAN-2002-0649):**

**What's the scope of this vulnerability?**

There are actually two vulnerabilities here, both of which are [buffer overrun](https://technet.microsoft.com/security/bulletin/glossary) vulnerabilities. An attacker who successfully exploited either vulnerability could gain the ability to cause the server to fail, or to run code using the privileges of the SQL Server.
Although exploiting the vulnerabilities would grant the attacker full control over the database, it would not necessarily convey full control over the system itself. SQL Server 2000 can be configured to run with varying levels of privilege; by default, it runs with the privileges of a domain user, rather than an administrator.

**What causes the vulnerabilities?**

The vulnerabilities result because a pair of function offered by the SQL Server Resolution Service contain unchecked buffers. By sending a specially formatted request to UDP 1434 port, it could be possible to overrun the buffers associated with either of the functions.

**What would this vulnerability enable an attacker to do?**

The vulnerability could enable an attacker to take either of two actions:

* Cause SQL Server to fail. This would be the easiest type of attack to mount, and would require only that the attacker overrun the buffer with random data.
* Modify the functioning of SQL Server, in order to perform functions of the attacker's choosing. This would require that the attacker overrun the buffer with precisely chosen data.

**Who could exploit the vulnerability?**

Any user who could deliver a request to the SQL Server (over UDP port 1434) on an affected server could exploit the vulnerability.

**If the attacker exploited the vulnerability to cause SQL Server to fail, what would the administrator need to do in order to restore normal operation?**

The administrator could resume normal operation by restarting the SQL Server service.

**If the attacker exploited the vulnerability to cause SQL Server to perform functions of his choice, what privileges would the attacker's code run in?**

Clearly, the attacker's code would have full control over the database functions, since it would run in the security context of SQL Server itself. But it might have few privileges outside of SQL Server. During SQL Server 2000 setup, the administrator must choose what Windows account SQL Server should run within. By default, the SQL Server service runs as a Domain User. If best practices were followed and a normal user context was chosen, the attacker would not gain administrative control over the operating system, nor administrative privileges over the domain.

**How does the patch eliminate the vulnerabilities?**

The patch ensures that the SQL Server Resolution Service correctly limits the size of input data and prevents it from overrunning any of its buffers.

**Denial of Service via SQL Server Resolution Service (CVE-CAN-2002-0650):**

**What's the scope of this vulnerability?**

This is a [denial of service](https://technet.microsoft.com/security/bulletin/glossary) vulnerability. An attacker could use the vulnerability to slow the performance of an affected SQL Server. The precise amount by which the system's performance would be slowed would depend on a number of factors, such as the processor speed and memory on the SQL Server, the number of systems attacking the server, and so forth.
The vulnerability could not be used to cause the server to fail altogether, nor would it provide the attacker with any privileges on the system. The server would resume normal operation as soon as the attack was broken off.

**What causes the vulnerability?**

The vulnerability results because of a flaw in the SQL Server 2000 keep-alive mechanism,which operates via the Resolution Service. If a particular data packet is sent to the SQL Server 2000 keep-alive function, it will reply to the sender with an identical packet. By spoofing the source address of such a packet, it would be possible to cause two SQL Server 2000 systems to start an endless cycle of packet exchanges.

**What's the keep-alive function in SQL Server 2000?**

SQL Server 2000 includes a mechanism by which it can determine whether a server is active or not. It does this by sending a so-called keep-alive packet to the SQL Server Resolution Service on UDP port 1434 and listening for a reply.

**What's wrong with the implementation of the keep-alive function in SQL Server 2000?**

It's possible to create a keep-alive packet whose response will be identical to the request. If one SQL Server were to send such a packet to another SQL Server, they would enter an unending cycle of sending the same packet back and forth to each other. This activity could consume most or all of the available bandwidth on the two machines.

**Could this situation occur naturally?**

No. The situation involved in the vulnerability could not occur under normal conditions. SQL Server does not normally generate a keep-alive packet with the needed characteristics. However, it could be possible for an attacker to introduce such a packet in order to initiate an exchange, which would thereafter be self-sustaining.

**How might an attacker do this?**

Suppose there were two SQL Servers with the vulnerability, Server 1 and Server 2. Now suppose the attacker created the needed keep-alive packet and modified the source address so that it contained Server 1's address, then sent the packet to Server 2. This would initiate the exchange, because Server 2 would reply to Server 1, which would reply to Server 2, ad infinitum.

**What could this vulnerability enable an attacker to do?**

An attacker could use this vulnerability to consume resources on two SQL Server 2000 systems at the same time.

**Who could exploit the vulnerability?**

Any user who could send data to an affected SQL Server's Resolution Service port could exploit the vulnerability.

**How long would an attack last?**

Once started, an attack would continue until one of the machines stopped sending packets. This could happen because the system had been rebooted, the SQL Server service had been restarted, or connectivity between the two servers had been lost.

**Once the attack was over, would the server resume normal operation by itself?**

Yes.

**How much of a system's resources could be monopolized through such an attack?**

It would depend on the specifics of the attack. For instance, it would be possible to engage multiple servers in an attack against a single one. Likewise, it would depend on the network bandwidth between the systems, the processor speed on the respective machines, and so forth.

**How does the patch eliminate the vulnerability?**

The patch eliminates the current keep-alive mechanism, and determines which servers are active and which are passive via a different mechanism. After applying the patch, a SQL Server 2000 system will no longer respond to keep-alive packets.

## Patch availability

**Download locations for this patch**

* Microsoft SQL Server 2000 and MSDE 2000:

  [https://www.microsoft.com/Downloads/details.aspx?FamilyID=dcfdcbe9-b4eb-4446-9be7-2de45cfa6a89&DisplayLang;=en](https://www.microsoft.com/download/details.aspx?familyid=dcfdcbe9-b4eb-4446-9be7-2de45cfa6a89&displaylang;=en)

#### Additional information about this patch

**Installation platforms:**

This patch can be installed on systems running SQL Server 2000 [Service Pack 2](https://www.microsoft.com/download/details.aspx?familyid=502c0d89-1308-4662-8f58-cec55ef1235b&displaylang;=en).

**Inclusion in future service packs:**

The fix for this issue will be included in SQL Server 2000 Service Pack 3.

**Reboot needed:** No. The SQL Server service only needs to be restarted after applying the patch.

**Patch can be uninstalled:** Yes.

**Superseded patches:** None.

**Verifying patch installation:**

* To ensure you have the fix installed properly, verify the individual files by consulting the date/time stamp of the files listed in the file manifest in Microsoft Knowledge Base article [Q323875](https://support.microsoft.com/default.aspx?scid=kb;en-us;323875&sd;=tech).

**Caveats:**

None

**Localization:**

Localized versions of this patch are available at the locations discussed in "Patch Availability".

**Obtaining other security patches:**

Patches for other security issues are available from the following locations:

* Security patches are available from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?linkid=21129), and can be most easily found by doing a keyword search for "security\_patch".
* Patches for consumer platforms are available from the [WindowsUpdate](https://windowsupdate.microsoft.com/) web site

#### Other information:

**Acknowledgments**

Microsoft [thanks](https://technet.microsoft.com/security/bulletin/policy) David Litchfield of [Next Generation Security Software Ltd.](https://www.nextgenss.com/) for reporting these issues to us and working with us to protect customers.

**Support:**

* Microsoft Knowledge Base article Q323875 discusses this issue and will be available approximately 24 hours after the release of this bulletin. Knowledge Base articles can be found on the [Microsoft Online Support](https://support.microsoft.com/?scid=fh;en-us;kbhowto) web site.
* Technical support is available from [Microsoft Product Support Services](https://support.microsoft.com/directory/question.asp?sd=gn&fr;=0). There is no charge for support calls associated with security patches.

**Security Resources:** The [Microsoft TechNet Security](https://www.microsoft.com/technet/security/default.mspx) Web Site provides additional information about security in Microsoft products.

**Disclaimer:**

The information provided in the Microsoft Knowledge Base is provided "as is" without warranty of any kind. Microsoft disclaims all warranties, either express or implied, including the warranties of merchantability and fitness for a particular purpose. In no event shall Microsoft Corporation or its suppliers be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if Microsoft Corporation or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation of liability for consequential or incidental damages so the foregoing limitation may not apply.

**Revisions:**

* V1.0 (July 24, 2002): Bulletin Created.
* V1.1 (July 25, 2002): Updated to note that MSDE 2000 is affected by the vulnerabilities.
* V1.2 (January 31, 2003): Updated to advise of supercedence by MS02-061 and clarify installation order when Hotfix 317748 is applied in conjunction with this security patch.

*Built at 2014-04-18T13:49:36Z-07:00*

---

## Additional resources

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025
## Additional resources

### In this article

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025


