=== Content from marc.info_25e2006c_20250125_175155.html ===

```
[[prev in list](?l=bugtraq&m=101422320620000&w=2)] [[next in list](?l=bugtraq&m=101424392919490&w=2)] [[prev in thread](?l=vuln-dev&m=101413924631329&w=2)] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [MSDE, Sql Server 7 & 2000 Adhoc Heterogenous Queries Buffer Overflow and DOS](?t=101413934700002&r=1&w=2)
From:       [c c <cesarc56 () yahoo ! com>](?a=101068404100002&r=1&w=2)
Date:       [2002-02-19 22:10:01](?l=bugtraq&r=1&w=2&b=200202)
[Download RAW [message](?l=bugtraq&m=101422555428036&q=mbox) or [body](?l=bugtraq&m=101422555428036&q=raw)]

Security Advisory

Name :            MSDE, Sql Server 7 & 2000 Adhoc
Heterogenous Queries Buffer Overflow and DOS.
System Affected:   MSDE, Sql Server 7, Sql Server 2000
with all service packs and fixes applied.
Severity:            High
Author:            Cesar Cerrudo.
Date:            19th February 2002
Advisory Number:  CC020201

Description:

Distributed queries access data from multiple
heterogeneous data sources, which can be stored in
either
the same or different computers. Microsoft  SQL Server
supports distributed queries by using OLE DB,
the Microsoft specification of an application
programming interface (API) for universal data access.
Distributed queries provide SQL Server users with
access to:
-Distributed data stored in multiple computers that
are running SQL Server.
-Heterogeneous data stored in various relational and
non-relational data sources that can be accessed using

an OLE DB provider.

You can reference heterogeneous OLE DB data sources in
Transact-SQL statements by:
-Linked servers , OpenQuery funtion.
-OpenDataSource and OpenRowset functions.

OpenDataSource and OpenRowset functions are accessible
to all users and contain an unchecked buffer in
one of its parameters. The buffer overflow and DOS
problem ocurr when an overly long string is supplied
in
the "provider name" parameter.

Details:

In Sql server 7 overflow starts at character number
6819 and if the amount
of characteres is >= 6918 the server will crash :

SELECT *
FROM OpenDataSource(
'XXXXXXXXXXX...' ---> 6819 characteres or more
,'')...nothing

SELECT * FROM OPENROWSET(
'XXXXXXXXXXX...' ---> 6819 characteres or more
,'',
'')

In Sql server 2000 overflow starts at character number
6887 and if the amount
of characteres is >= 6998 the server will crash :

SELECT *
FROM OpenDataSource(
'XXXXXXXXXXX...' ---> 6887 characteres or more
,'')...nothing

SELECT * FROM OPENROWSET(
'XXXXXXXXXXX...' ---> 6887 characteres or more
,'',
'')

Depend on de amount of characters some registry values
are overwriten.
Try with this examples and then take a look at the
dump file.

Patch Available:
NONE

Workaround:
Shutdown the servers.

Vendor Status :
Microsoft was contacted. When i contacted them i
explicitly told them that i would apply RFPolicy v2.
They asked me for the details and i gave it to them
and then they told me that they would contact me
again.
The first time they walk in the edge of the policy and
in the 5th day they contacted me again. Now i havent
been
contacted by them in the last 8 days, so i disclose
the information. Maybe this is a new Microsoft's
policy, to not
contact the researcher in the proper time and not
expend time in writing a three words mail.
One more thing Microsoft doesn't digitally sign the
mails from the Security Response Center when they
contact you,
i think this is a vulnerability.

I discover another 3 or 4 security holes in sql server
with diverse severity, i will release them soon.

Dont blame me for this please, blame
MICROSOFT!!!!!!!!!.

__________________________________________________
Do You Yahoo!?
Yahoo! Sports - Coverage of the 2002 Olympic Games
<http://sports.yahoo.com>
[[prev in list](?l=bugtraq&m=101422320620000&w=2)] [[next in list](?l=bugtraq&m=101424392919490&w=2)] [[prev in thread](?l=vuln-dev&m=101413924631329&w=2)] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from docs.microsoft.com_40dcab88_20250125_175157.html ===

[Skip to main content](#main)

This browser is no longer supported.

Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.

[Download Microsoft Edge](https://go.microsoft.com/fwlink/p/?LinkID=2092881 )
[More info about Internet Explorer and Microsoft Edge](https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge)

Table of contents

Exit focus mode

Read in English

Save

Table of contentsRead in English

Save

Add to plan
[Edit](https://github.com/MicrosoftDocs/security-updates/blob/live/security-updates/SecurityBulletins/2002/ms02-007.md "Edit This Document")

---

#### Share via

Facebook
x.com
LinkedIn
Email

---

Print

Table of contents

# Microsoft Security Bulletin MS02-007 - Moderate

* Article
* 03/01/2023
* 6 contributors

Feedback

## In this article

## SQL Server Remote Data Source Function Contain Unchecked Buffers

Published: February 20, 2002 | Updated: May 09, 2003

**Version:** 1.2

**Originally posted:** February 20, 2002

**Updated:** May 09, 2003

#### Summary

**Who should read this bulletin:**
Database administrators using MicrosoftÂ® SQL Serverâ¢.

**Impact of vulnerability:**
Run code of attacker's choice on server

**Maximum Severity Rating:**
Moderate

**Recommendation:**
Apply the SQL Server patch immediately to affected systems

**Affected Software:**

* Microsoft SQL Server 7.0
* Microsoft SQL Server 2000

### General Information

## Technical details

**Technical description:**

One of the features of Structured Query Language (SQL) in SQL Server 7.0 and 2000 is the ability to connect to remote data sources. One capability of this feature is the ability to use "ad hoc" connections to connect to remote data sources without setting up a linked server for less-often used data-sources. This is made possible through the use of OLE DB providers, which are low-level data source providers. This capability is made possible by invoking the OLE DB provider directly by name in a query to connect to the remote data source.

An unchecked buffer exists in the handling of OLE DB provider names in ad hoc connections. A buffer overrun could occur as a result and could be used to either cause the SQL Server service to fail, or to cause code to run in the security context of the SQL Server. SQL Server can be configured to run in various security contexts, and by default runs as a domain user. The precise privileges the attacker could gain would depend on the specific security context that the service runs in.

An attacker could exploit this vulnerability in one of two ways. They could attempt to load and execute a database query that calls one of the affected functions. Conversely, if a web-site or other database front-end were configured to access and process arbitrary queries, it could be possible for an attacker to provide inputs that would cause the query to call one of the functions in question with the appropriate malformed parameters.

**Mitigating factors:**

* The effect of exploiting the vulnerability would depend on the specific configuration of the SQL Server service. SQL Server can be configured to run in a security context chosen by the administrator. By default, this context is as a domain user. If the rule of least privilege has been followed, it would minimize the amount of damage an attacker could achieve.
* Both vectors for exploiting the vulnerability could be blocked by following best practices. Specifically, untrusted users should not be able to load and execute queries of their choice on a database server. In addition, publicly accessible database queries should filter all inputs prior to processing.

**Severity Rating:**

|  | Internet Servers | Intranet Servers | Client Systems |
| --- | --- | --- | --- |
| **SQL Server 7.0** | Moderate | Moderate | Moderate |
| **SQL Server 2000** | Moderate | Moderate | Moderate |

The above [assessment](https://technet.microsoft.com/security/bulletin/rating) is based on the types of systems affected by the vulnerability, their typical deployment patterns, and the effect that exploiting the vulnerability would have on them. While the vulnerability could potentially allow an attacker to run code on the server, best practices should limit the ability to exploit the vulnerability and the damage that could be achieved by a successful attack.

**Vulnerability identifier:** [CAN-2002-0056](https://cve.mitre.org/cgi-bin/cvename.cgi?name=can-2002-0056)

**Tested Versions:**

Microsoft tested SQL Server 7.0 and 2000 to assess whether they are affected by these vulnerabilities. Previous versions are no longer [supported](https://support.microsoft.com/directory/discontinue.asp), and may or may not be affected by these vulnerabilities.

## Frequently asked questions

**What's the scope of the vulnerability?**

This is a [buffer overrun](https://technet.microsoft.com/security/bulletin/glossary) vulnerability. An attacker who successfully exploited this vulnerability would gain significant control over the database and possibly the server itself. In a worst case, the attacker could add, change or delete data in the database, as well as potentially being able to reconfigure the operating system, install new software, or reformat the hard drive.
The scope of this vulnerability, however, would be significantly reduced if best practices were followed. Specifically:

* SQL Server can be configured to run in a security context accordance with the rule of least privilege. By default, SQL Server runs in the security context of a domain user, a context with very limited privileges on the server. If this were done, it would have the effect of limiting the potential actions an attacker could take in the event of a successful attack.
* In addition to successfully exploit this vulnerability, the attacker would need to be able to load and run a query of his construction on the server, or be able to pass information of their choosing into an existing query on the system. Best practices recommends against both of these practices.

**What causes the vulnerability?**

The vulnerability results because several functions provided by SQL Server contain unchecked buffers. Specifically in functions that are associated with connecting to remote data sources through "[ad hoc names](https://msdn2.microsoft.com/library/aa213283)". By calling any of these functions with specially chosen parameters, an attacker could cause a buffer overrun condition to occur.

**What are "ad hoc names"?**

SQL Server provides the ability to connect to pull information from remote data sources on a variety of platforms to allow for data warehousing, analysis, and aggregation. Connections to remote data sources can be accomplished in one of two ways. By establishing a "linked server" connection for regular, ongoing connections, or through the use of "ad hoc names" for connections that may be established less often.

**What's wrong with the functions?**

The functions impacted by this vulnerability have the same defect: they fail to properly validate that information which is passed will fit into the buffer that has been provided. Because of this, an attacker could provide text that overruns the buffer and overwrites the memory within the SQL Server process itself.

**What would this enable an attacker to do?**

Depending on the specific data that the attacker chose, one of two effects could result:

* If the data were random data, the SQL Server process would fail.
* If the were carefully selected, it could be possible for the attacker to alter the SQL Server software while it was running.

**If the attacker provided random data as the text, what would be required in order to restore normal operation?**

The administrator would need to restart the SQL Server service.

**If the attacker provided carefully selected data and altered the SQL Server software, what could the new software do?**

It would depend on how SQL Server had been configured. By default, SQL Server runs in a non-privileged security context (specifically, as a domain user). An attacker who successfully exploited this vulnerability against a server configured in this manner would gain control over the database, but little else. If, however, the administrator had configured SQL Server to run with higher privileges, a successful attack could possibly gain those additional privileges. Thus, the potential damage of a successful attack is proportionate to the degree to which the principle of least privilege has been followed in the configuration of SQL Server.

**How might an attacker exploit this vulnerability?**

There are several ways an attacker would try to exploit this vulnerability. The most direct attack vector would be for the attacker to construct a query that calls one of the affected functions and performs a buffer overrun attack. However, to succeed at this, the server would have to be configured to allow an untrusted user to load and execute queries of their choice. Best practices strongly recommends against allowing untrusted users to load and run queries of their construction.

**Is there any other way an attacker would try to exploit this vulnerability?**

If an attacker were unable to load and run a query of their choosing, they could attempt to exploit this vulnerability by using a query that was already present on the system.
For example, if the database were part of a web-based search tool and one of the functions in question were called by the web site, an attacker could attempt to construct a query that would exploit this vulnerability. However, constructing a query like this would require intimate knowledge about the internals of a web site's search function.
If a site had implemented web-based queries without proper checking of inputs, however, it could be possible for an attacker to embed database commands, including calls to the affected functions - within the database query parameters. This shows the importance of validating input parameters before passing them to the database server for processing.

**What does the patch do?**

The patch eliminates the vulnerability by implanting proper checking into the affected functions.

## Patch availability

**Download locations for this patch** SQL Server 7.0:

* The patch for this issue is available in the SQL Server 7.0 Cumulative Security patch

SQL Server 2000:

* The patch for this issue is available in the SQL Server 2000 Cumulative Security patch

#### Additional information about this patch

**Reboot needed:**

No. The SQL Server service only needs to be restarted after applying the patch.

**Superseded patches:**

[MS01-060](https://technet.microsoft.com/security/bulletin/ms01-060)

**Verifying patch installation:** SQL Server 7.0:

* To ensure that you have properly installed the fix, run the following command from the command prompt:

  + "SELECT @@VERSION" (without the quotation marks)

  If the patch has been correctly installed, the resulting output will indicate the version number as "SQL Server 7.00 - 7.00.1021" or greater.
* To verify the individual files, consult the date/time stamp of the files listed in the file manifest in Microsoft Knowledge Base article Q317979.

SQL Server 2000:

* To ensure that you have properly installed the fix, run the following command from the command prompt:

  + "SELECT @@VERSION" (without the quotation marks)

  If the patch has been correctly installed, the resulting output will indicate the version number as "SQL Server 8.00 - 8.00.0578" or greater.
* To verify the individual files, consult the date/time stamp of the files listed in the file manifest in Microsoft Knowledge Base article Q317979.

**Caveats:**

A potential side effect of this patch on systems that use non-logged bulk insert operations against an empty table is possible data corruption. Knowledge Base article [Q320434](https://support.microsoft.com/default.aspx?scid=kb;en-us;320434&sd;=tech) provides additional details on this issue.

**Localization:**

The patches can be applied to all supported SQL Server languages. Localized Readme.txt files are included in the packages for installation instructions in all supported languages.

**Obtaining other security patches:**

Patches for other security issues are available from the following locations:

* Security patches are available from the [Microsoft Download Center](https://go.microsoft.com/fwlink/?linkid=21129), and can be most easily found by doing a keyword search for "security\_patch".
* Patches for consumer platforms are available from the [WindowsUpdate](https://windowsupdate.microsoft.com/) web site.

#### Other information:

**Support:**

* Microsoft Knowledge Base article Q317979 discusses this issue and will be available approximately 24 hours after the release of this bulletin. Knowledge Base articles can be found on the [Microsoft Online Support](https://support.microsoft.com/?scid=fh;en-us;kbhowto) web site.
* Technical support is available from [Microsoft Product Support Services](https://support.microsoft.com/directory/question.asp?sd=gn&fr;=0). There is no charge for support calls associated with security patches.

**Security Resources:** The [Microsoft TechNet Security](https://www.microsoft.com/technet/security/default.mspx) Web Site provides additional information about security in Microsoft products.

**Disclaimer:**

The information provided in the Microsoft Knowledge Base is provided "as is" without warranty of any kind. Microsoft disclaims all warranties, either express or implied, including the warranties of merchantability and fitness for a particular purpose. In no event shall Microsoft Corporation or its suppliers be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if Microsoft Corporation or its suppliers have been advised of the possibility of such damages. Some states do not allow the exclusion or limitation of liability for consequential or incidental damages so the foregoing limitation may not apply.

**Revisions:**

* V1.0 (February 20, 2002): Bulletin Created.
* V1.1 (March 29, 2002): Caveats section updated to include information regarding possible issue with patch and bulk data transfers.
* V1.2 (May 09, 2003): Updated download links to Windows Update.

*Built at 2014-04-18T13:49:36Z-07:00*
</https:>

---

## Additional resources

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025
## Additional resources

### In this article

[California Consumer Privacy Act (CCPA) Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

Theme

* Light
* Dark
* High contrast

* [Previous Versions](/en-us/previous-versions/)
* [Blog](https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog)
* [Contribute](/en-us/contribute/)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* [Terms of Use](/en-us/legal/termsofuse)
* [Trademarks](https://www.microsoft.com/legal/intellectualproperty/Trademarks/)
* © Microsoft 2025



=== Content from www.kb.cert.org_b84d0d34_20250125_175156.html ===


search

menu

icon-carat-right

cmu-wordmark

* ×
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#619707

## Microsoft SQL Server contains buffer overflows in openrowset and opendatasource macros

#### Vulnerability Note VU#619707

Original Release Date: 2002-03-28 | Last Revised: 2002-07-29

---

### Overview

Microsoft SQL Server contains several buffer overflows in "functions that are associated with connecting to remote data sources through '[ad hoc names](http://msdn.microsoft.com/library/default.asp?url=/library/en-us/acdata/ac_8_qd_12_23xd.asp).'"

### Description

| Microsoft SQL Server versions 7.0 and 2000 contain buffer overflows in the *openrowset* and *opendatasource* macros. By calling these macros with an overly long *provider name* parameter, an intruder can interrupt the ordinary operation of the server or potentially execute arbitrary code with the privileges of the SQL server. For more information, see  <http://www.microsoft.com/technet/security/bulletin/MS02-007.asp>In order to exploit this vulnerability, an intruder would need to be able to call one of the vulnerable macros directly, or be able to supply an inappropriate argument to a script that uses one of the vulnerable macros. |
| --- |

### Impact

| An intruder can execute arbitrary code with the privileges of the SQL service account. If the privileges of the service account are elevated via [VU#796313](http://www.kb.cert.org/vuls/id/796313), this vulnerability may result in compromise of the server host. |
| --- |

### Solution

| Apply a patch as described in <http://support.microsoft.com/support/misc/kblookup.asp?id=Q318268> or <http://support.microsoft.com/support/misc/kblookup.asp?id=Q316333>. |
| --- |

### Vendor Information

619707
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

 Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23619707/) to view vendors.**
### [Microsoft Corporation](#SVHN-58NUX2) Affected

Notified:  July 27, 2002  Updated: July 29, 2002

### Status

Affected

### Vendor Statement

See <http://www.microsoft.com/technet/security/bulletin/MS02-007.asp>

### Vendor Information

The vendor has not provided us with any further information regarding this vulnerability.

### Addendum

The CERT/CC has no additional comments at this time.

If you have feedback, comments, or additional information about this vulnerability, please send us email.

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://www.microsoft.com/technet/security/bulletin/MS02-007.asp>
* <http://support.microsoft.com/support/misc/kblookup.asp?id=Q318268>
* <http://support.microsoft.com/support/misc/kblookup.asp?id=Q316333>
* <http://www.microsoft.com/technet/prodtechnol/sql/maintain/security/sql2ksec.asp>
* <http://www.ntbugtraq.com/default.asp?pid=36&sid=1&A2=ind0202&L=NTBUGTRAQ&P=R4681>
* <http://online.securityfocus.com/bid/4135>
* <http://msdn.microsoft.com/library/en-us/acdata/ac_8_qd_12_23xd.asp>
### Acknowledgements

Our thanks to Microsoft Corporation for the information provided in their bulletin, and to Cesar Cerrudo, who reported this information on Bugtraq and NTBugTraq.

This document was written by Shawn V. Hernan.

### Other Information

| **CVE IDs:** | [CVE-2002-0056](http://web.nvd.nist.gov/vuln/detail/CVE-2002-0056) |
| --- | --- |
| **Severity Metric:** | 9.57 |
| **Date Public:** | 2002-02-19 |
| **Date First Published:** | 2002-03-28 |
| **Date Last Updated:** | 2002-07-29 23:20 UTC |
| **Document Revision:** | 26 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800


