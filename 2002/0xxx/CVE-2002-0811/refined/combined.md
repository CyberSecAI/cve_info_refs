=== Content from bugzilla.mozilla.org_b81bca37_20250125_013644.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/130821)
* [XML](/show_bug.cgi?ctype=xml&id=130821)

Closed
[Bug 130821](/show_bug.cgi?id=130821)

Opened 23 years ago
Closed 23 years ago

# buglist: "order" parameter sends unchecked SQL

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

buglist: "order" parameter sends unchecked SQL

## Categories

### (Bugzilla :: Query/Bug List, defect, P1)

[Product:](/describecomponents.cgi?product=Bugzilla)

Bugzilla
▾

Bugzilla
The [Bugzilla](http://www.bugzilla.org) bug-tracking system.

**Note:** This is **not** the place to request configuration, permission, or account changes to this installation of Bugzilla (bugzilla.mozilla.org). File such changes under the appropriate component in the [**bugzilla.mozilla.org**](enter_bug.cgi?product=bugzilla.mozilla.org) product.
[See Open Bugs in This Product](/buglist.cgi?product=Bugzilla&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Bugzilla)
Watch This Product

[Component:](/describecomponents.cgi?product=Bugzilla&component=Query%2FBug%20List#Query%2FBug%20List)

Query/Bug List
▾

Bugzilla :: Query/Bug List
Anything to do with searching for bugs and viewing the buglists. `query.cgi` and `buglist.cgi`
[See Open Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Query%2FBug%20List&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Query%2FBug%20List&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Bugzilla&component=Query%2FBug%20List)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

2.15

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 98

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Bugzilla 2.16

## People

### (Reporter: jruderman, Assigned: endico)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/f28841fc7184f71e364a61ab6b9e9798?d=mm&size=40)  [endico](/user_profile?user_id=4415)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/9df24a05a7e63cf07e49d30ddfeee31a?d=mm&size=40)  [default-qa](/user_profile?user_id=5086)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

### ( [URL](http://bugzilla.mozilla.org/buglist.cgi?field0-0-0=reporter&type0-0-0=substring&value0-0-0=jrud&order=bugs.bug_id%20AND%20ALLYOURBASEAREBELONGTOUS "http://bugzilla.mozilla.org/buglist.cgi?field0-0-0=reporter&type0-0-0=substring&value0-0-0=jrud&order=bugs.bug_id%20AND%20ALLYOURBASEAREBELONGTOUS") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[bugzilla.mozilla.org/buglist.cgi?fiel...](http://bugzilla.mozilla.org/buglist.cgi?field0-0-0=reporter&type0-0-0=substring&value0-0-0=jrud&order=bugs.bug_id%20AND%20ALLYOURBASEAREBELONGTOUS "http://bugzilla.mozilla.org/buglist.cgi?field0-0-0=reporter&type0-0-0=substring&value0-0-0=jrud&order=bugs.bug_id%20AND%20ALLYOURBASEAREBELONGTOUS")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: checked in for 2.14.2. security)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

checked in for 2.14.2. security

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | approval | ? |
| --- | --- | --- |
|  | approval5.0 | ? |
|  | approval5.2 | ? |
|  | approval6.0 | ? |
|  | blocking5.0.4.1 | ? |
|  | blocking5.2 | ? |
|  | blocking6.0 | ? |
|  | approval4.4 | ? |
|  | blocking4.4.14 | ? |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | documentation | ? + - |
|  | testcase |  | | |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file, 1 obsolete file)

| [Backported patch for 2.14.2.](/attachment.cgi?id=86553)  [23 years ago](#c15)  [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412)   1.91 KB, patch | justdave : [review+](#c16 "23 years ago")  bbaetz : [review-](#c17 "23 years ago") | [Details](/attachment.cgi?id=86553&action=edit) | [Diff](/attachment.cgi?id=86553&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86553) |
| --- | --- | --- |
| [Try again.](/attachment.cgi?id=86578)  [23 years ago](#c18)  [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412)   1.63 KB, patch | bbaetz : [review+](#c19 "23 years ago")  myk : [review+](#c23 "23 years ago") | [Details](/attachment.cgi?id=86578&action=edit) | [Diff](/attachment.cgi?id=86578&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86578) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=130821#c0)• 23 years ago |
|  | |

<http://bugzilla.mozilla.org/buglist.cgi?field0-0-0=reporter&type0-0-0=substring&value0-0-0=jrud&order=bugs.bug_id%20AND%20ALLYOURBASEAREBELONGTOUS>
SQL Error:
...
GROUP BY bugs.bug\_id ORDER BY bugs.bug\_id AND ALLYOURBASEAREBELONGTOUS: Unknown
column 'ALLYOURBASEAREBELONGTOUS' in 'order clause' at globals.pl line 222.
I noticed this at b.m.o and didn't test bugzilla-tip because landfill is down.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=130821#c1)• 23 years ago |
|  | |

Doh. a . in the name doens't make it ok.
Anyway, I think myk has fixed this with his patch which went in yesterday to
templatise this file.
myk: is that right?
Not that you can do anything with this except affect sorting, but still....Priority: -- → P1Target Milestone: --- → Bugzilla 2.16

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=130821#c2)• 23 years ago |
|  | |

Why is this is in the security group and targetted at 2.16? We've known about
this for ages and there are no known exploits.

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=130821#c3)• 23 years ago |
|  | |

This can't be fixed easily. For example it would break stored queries.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=130821#c4)• 23 years ago |
|  | |

Jesse filed it in that group - sending untrusted html is a security hole. Its
probably exploitable in mysql4, which supports union queries - just select the
union of a valid query and all queries with groupset != 0. I'd have to confirm
the syntax though- the mysql docs aren't really explicit. The postgresql syntax
doesn't seem to allow it, btw - order has to be after the last subquery.
As for fixing it breaking stuff - myk has fixed this in the buglist rewrite, so
if it breaks stuff, then its broken in current CVS.
What can it break? Is there stuff we used to allow sorting on which we
currently don't? And if so, we can just manually strip those before testing.

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=130821#c5)• 23 years ago |
|  | |

I probably misunderstood. It still accepts raw column names, but not arbitrary
SQL?

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=130821#c6)• 23 years ago |
|  | |

Well, it used to accept arbitary column names. Which could just happen to
include spaces, or commas, or any character from a-z. So yues, it allows
arbitary html. But its fixed now, I think

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=130821#c7)• 23 years ago |
|  | |

OK, as far as I can tell this does appear to be fixed already on the tip... it
this worthy of yet another security announcement?

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=130821#c8)• 23 years ago |
|  | |

Well, FWIW, we knew about this for 2.14.1 and deigned it not even important
enough to fix.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=130821#c9)• 23 years ago |
|  | |

Well, its fixed now. So this can be closed or marked a dupe unelss there are
problems.

|  | [Myk Melez [:myk] [@mykmelez]](/user_profile?user_id=27300) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=130821#c10)• 23 years ago |
|  | |

This is fixed on the tip by the check-in for [bug 103778](/show_bug.cgi?id=103778 "RESOLVED FIXED - templatize buglist.cgi"), so resolving fixed.
Note that the code does not allow the use of "AND" to separate sort columns (it
requires the use of commas). Is "AND" supported at all in MySQL?Status: NEW → RESOLVEDClosed: 23 years agoResolution: --- → FIXED

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=130821#c11)• 23 years ago |
|  | |

So I repeat my question... how serious was this? Is it worthy of a security
announcement?

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=130821#c12)• 23 years ago |
|  | |

munging ccs

|  | [Myk Melez [:myk] [@mykmelez]](/user_profile?user_id=27300) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=130821#c13)• 23 years ago |
|  | |

>So I repeat my question... how serious was this? Is it worthy of a security
>announcement?
I don't think it was that serious. I can't think of an exploit that would cause
data to be compromised. It may be possible to use this vulnerability to
construct a DOS attack, however. I suggest that 2.16 be released with a message
that the release fixes a number of security bugs of varying severity and that
all users are advised to upgrade. Alternately, we could work up a patch for
just this problem (and others that exist in 2.14) and apply it to the 2.14
branch for a new security release, but I think that's more work than it's worth.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=130821#c14)• 23 years ago |
|  | |

moving secure bugzilla/webtools bugs from mozilla security group to the new
bugzilla security group.Group: security? → webtools-security?

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=130821#c15)• 23 years ago |
|  | |

Attached patch

[Backported patch for 2.14.2.](attachment.cgi?id=86553&action=diff) (obsolete)
— [Details](attachment.cgi?id=86553&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86553)

I backported Myk's code to deal with this. This is mostly the same - the major
difference is that it checks field names have valid syntax eg
identifier.identifier, rather than checking the field actually exists as Myk
did.
I think this is OK to solve what I am worried about anyway, UNIONs in MySQL 4.

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=130821#c16)• 23 years ago |
|  | |

Comment on [attachment 86553](/attachment.cgi?id=86553 "Backported patch for 2.14.2.") [[details]](/attachment.cgi?id=86553&action=edit "Backported patch for 2.14.2.") [[diff]](/attachment.cgi?id=86553&action=diff "Backported patch for 2.14.2.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86553)
Backported patch for 2.14.2.
this patch is applied on <http://landfill.bugzilla.org/bugzilla-2.14/>
Works for me.
[Attachment #86553](/attachment.cgi?id=86553&action=edit "Backported patch for 2.14.2.") -
Flags: review+

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=130821#a7240965_10297)• 23 years ago |

Whiteboard: wanted for 2.14.2

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=130821#c17)• 23 years ago |
|  | |

Comment on [attachment 86553](/attachment.cgi?id=86553 "Backported patch for 2.14.2.") [[details]](/attachment.cgi?id=86553&action=edit "Backported patch for 2.14.2.") [[diff]](/attachment.cgi?id=86553&action=diff "Backported patch for 2.14.2.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86553)
Backported patch for 2.14.2.
>Index: buglist.cgi
>===================================================================
>RCS file: /cvsroot/mozilla/webtools/bugzilla/buglist.cgi,v
>retrieving revision 1.139.2.2
>diff -u -u -r1.139.2.2 buglist.cgi
>--- buglist.cgi 30 Dec 2001 05:41:44 -0000 1.139.2.2
>+++ buglist.cgi 6 Jun 2002 03:28:05 -0000
>@@ -1051,10 +1051,11 @@
> my $query = GenerateSQL(\@fields, undef, undef, $::buffer);
>
>
>-
>+my $order\_from\_cookie = 0;
> if ($::COOKIE{'LASTORDER'}) {
> if ((!$::FORM{'order'}) || $::FORM{'order'} =~ /^reuse/i) {
> $::FORM{'order'} = url\_decode($::COOKIE{'LASTORDER'});
>+ $order\_from\_cookie = 1;
> }
> }
>
>@@ -1068,7 +1069,26 @@
>
> ORDER: for ($::FORM{'order'}) {
> /\./ && do {
>- # This (hopefully) already has fieldnames in it, so we're done.
>+ # A custom list of columns. Make sure each column is valid.
>+ foreach my $fragment (split(/[,\s]+/, $::FORM{'order'})) {
>+ next if $fragment =~ /^asc|desc$/i;
this needs to be /^(?:asc|desc)$/. The current regexp actually means
/(^asc)|(desc$)/. Yes, this means
trunk is broken too - try an order of 'ASCASDASA'
Also, I'm not conviced that the split is correct, either. We should split on
comma, then trim the result.
I think we should do this on trunk/2.16, unless someone thinks that its not
important. We can construct
invalid sorts, but thas a db issue, possibly. It still would be nice to give a
sensible error in such cases.
>+
>+ my $ident\_regexp = "[A-Za-z\_][0-9A-Za-z\_]\*";
>+ if ($fragment !~ /${ident\_regexp}\.${ident\_regexp}/) {
Given the above, this should then be
/^${ident\_regexp}\.${ident\_regexp}(\s+(asc|desc))?$/i. Since we have to
use /i then, you can simplify ident\_regexp.
Note the added ^ and $ - even if you dno't want to slpit that way to handle
asc|desc, you need that.
>+ my $qfragment = html\_quote($fragment);
>+ my $error = "The custom sort order you specified in your "
>+ . "form submission contains an invalid column "
>+ . "name <em>$qfragment</em>.";
>+ if ($order\_from\_cookie) {
>+ my $cookiepath = Param("cookiepath");
>+ print "Set-Cookie: LASTORDER= ; path=$cookiepath; expires=Sun, 30-Jun-80 00:00:00 GMT\n";
>+ $error =~ s/form submission/cookie/;
>+ $error .= " The cookie has been cleared.";
>+ }
>+ DisplayError($error);
>+ exit;
>+ }
>+ }
> last ORDER;
> };
> /Number/ && do {
[Attachment #86553](/attachment.cgi?id=86553&action=edit "Backported patch for 2.14.2.") -
Flags: review-

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=130821#c18)• 23 years ago |
|  | |

Attached patch

[Try again.](attachment.cgi?id=86578&action=diff)
— [Details](attachment.cgi?id=86578&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86578)

This patch takes the above comments into account.
It also fixes problems I discovered - the old patch referred to the cookiepath
parameter which isn't in 2.14. Also the cookie removal code didn't work, so I
removed it.
[Attachment #86553](/attachment.cgi?id=86553&action=edit "Backported patch for 2.14.2.") -
Attachment is obsolete: true

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=130821#c19)• 23 years ago |
|  | |

Comment on [attachment 86578](/attachment.cgi?id=86578 "Try again.") [[details]](/attachment.cgi?id=86578&action=edit "Try again.") [[diff]](/attachment.cgi?id=86578&action=diff "Try again.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86578)
Try again.
If we have multipart on, then I get the error under the "please wait" thing. I
think that this is ok, since no 'normal' user should ever see this error, and
we shouldn't have to rearrange the code for 2.14. It works correctly for 2.16,
with the templatisation, anyway.
[Attachment #86578](/attachment.cgi?id=86578&action=edit "Try again.") -
Flags: review+

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=130821#c20)• 23 years ago |
|  | |

Yes, that's intentional, there are already loads of those in the 2.14 codebase.

|  | [Myk Melez [:myk] [@mykmelez]](/user_profile?user_id=27300) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=130821#c21)• 23 years ago |
|  | |

If it's arbitrary HTML we're worried about, wouldn't it be better to HTML-escape
the SQL error message?

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=130821#c22)• 23 years ago |
|  | |

What SQL error message? The fragment is html quoted as per your original code,
I don't see what else there is.

|  | [Myk Melez [:myk] [@mykmelez]](/user_profile?user_id=27300) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=130821#c23)• 23 years ago |
|  | |

Comment on [attachment 86578](/attachment.cgi?id=86578 "Try again.") [[details]](/attachment.cgi?id=86578&action=edit "Try again.") [[diff]](/attachment.cgi?id=86578&action=diff "Try again.") [[review]](/page.cgi?id=splinter.html&ignore=&bug=130821&attachment=86578)
Try again.
Also, shouldn't I see a Bugzilla error message when I enter a nonsensical
value? Oh, I suppose that can't happen unless we trap SQL errors, which is
beyond the scope of this bug.
I guess this fix solves the problem; I'm not sure it's the best solution, but
TMTOWTDI. r=myk
[Attachment #86578](/attachment.cgi?id=86578&action=edit "Try again.") -
Flags: review+

|  | [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=130821#c24)• 23 years ago |
|  | |

There are already checks in place to check for invalid characters in the SQL
order.
Checked into 2.14 branch:
Checking in buglist.cgi;
/cvsroot/mozilla/webtools/bugzilla/buglist.cgi,v <-- buglist.cgi
new revision: 1.139.2.3; previous revision: 1.139.2.2
done
Whiteboard: wanted for 2.14.2 → checked in for 2.14.2

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=130821#c25)• 23 years ago |
|  | |

Yeah, we don't capture invalid names for 2.14, but we do in 2.16/trunk.

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=130821#c26)• 23 years ago |
|  | |

2.14.2 is out, removing security group.Group: webtools-security?

|  | [Brandon Perkins](/user_profile?user_id=57045) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=130821#c27)• 23 years ago |
|  | |

I know this is a resolved and fixed bug, but since this is the fix that caused
my problem, I feel inclined to report it here. I just patched our 2.14.1
installation up to 2.14.2. We immediately noticed that we could no longer sort
our buglists after the change. Sure enough, if I back-out the patch sorting
works again. Somewhere along the line the ORDER gets corrupted. As I'm not
intimately familiar with Bugzilla code, I only made a cursory attempt to fix the
problem, but came up empty. What we have found is that if you are only sorting
on one index (for example order=bugs.priority), you're fine, but if you have two
or more (for example order=bugs.bug\_severity%2C%20bugs.priority), then the sort
does not occur for either index. As soon as I backed out this particular change
(not the whole 2.14.2 patch) sorting was returned to us. Since this bug report
is the verbatim patch that I found, I decided to report it here.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=130821#c28)• 23 years ago |
|  | |

As wierd as that is, I'm going to have to confirm that. Removing the trim from
the $fragment just before the regexp fixes this (although the regexp will need
changing so that queries still work)
debug printing shows that $fragment is ok each time, but $::FORM{'ORDER'} chnages.
I have no clue what could be causing this - split returns copies, not
references, so $fragment shouldn't have any related ot $::FORM{'ORDER'}
Any ideas, anyone? Maybe we should file a new bug for this.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=130821#c29)• 23 years ago |
|  | |

To be more precise, the last 'thing' listed to be sorted is used, but thats it,
according to sqllog.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=130821#c30)• 23 years ago |
|  | |

As pointed out on npm.webtools by "Randall M! Gee", the problem here is that
2.14's trim modifies $\_ directly, whilst CVS HEAD uses a 'real' variable.
I'm not sure what to do about this; the (untested) fix is to replace that line
with:
if ($fragment !~ /^\s\*${ident\_iregexp}\.${ident\_iregexp}(\s+(asc|desc))?\s\*$/i)
{
In any event, I'll open a new bug.

|  | [Bradley Baetz (:bbaetz)](/user_profile?user_id=29274) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=130821#c31)• 23 years ago |
|  | |

The new bug is [bug 152138](/show_bug.cgi?id=152138 "RESOLVED FIXED - 2.14.2 breaks sorting on more than one field").

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=130821#a49851779_11608)• 21 years ago |

Whiteboard: checked in for 2.14.2 → checked in for 2.14.2. security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=130821#a339796472_1)• 12 years ago |

QA Contact: matty\_is\_a\_geek → default-qa
You need to [log in](/show_bug.cgi?id=130821&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Matthew Tuck [:CodeMachine]](/user_profile?user_id=4412)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


