=== Content from marc.info_ed9897f4_20250125_065348.html ===

```
[[prev in list](?l=full-disclosure&m=112721710111478&w=2)] [[next in list](?l=full-disclosure&m=112722415805890&w=2)] [prev in thread] [next in thread]
List:       [full-disclosure](?l=full-disclosure&r=1&w=2)
Subject:    [Full-disclosure] bacula insecure temporary file creation
From:       ["Eric Romang / ZATAZ.com" <eromang () zataz ! com>](?a=112558049700002&r=1&w=2)
Date:       [2005-09-20 10:59:11](?l=full-disclosure&r=1&w=2&b=200509)
Message-ID: [432FEB7F.6030307 () zataz ! com](?i=432FEB7F.6030307%20()%20zataz%20!%20com)
[Download RAW [message](?l=full-disclosure&m=112721654126735&q=mbox) or [body](?l=full-disclosure&m=112721654126735&q=raw)]

#########################################################

bacula insecure temporary file creation

Vendor: <http://www.bacula.org/>
Advisory: <http://www.zataz.net/adviso/bacula-09192005.txt>
Vendor informed: yes
Exploit available: yes
Impact : low
Exploitation : low

#########################################################

The vulnerabilities ared due to insecure temporary files creations.
They are symlink attacks to create arbitrary files with the privileges
of the
user running the affected script, sensitive informations disclosure,
possible
arbitrary commands execution.

##########
Versions:
##########

bacula <= 1.36.3

##########
Solution:
##########

Update to version 1.37.39 (sep 19 2005)

#########
Timeline:
#########

Discovered : 2005-09-06
Vendor notified : 2005-09-19
Vendor response : 2005-09-19
Vendor fix : 2005-09-20
Vendor Sec report (vendor-sec@lst.de) : no need
Disclosure : 2005-09-20

#####################
Technical details :
#####################

Vulnerable code :
-----------------

* Take a look on : autoconf/randpass

This file is used by configure and autoconf/configure.in to generate
random password.

11 tmp=/tmp/p.tmp.$$
12 cp autoconf/randpass.bc $tmp
13 ps | sum | tr -d ':[:alpha:] ' | sed 's/^/k=/' >>$tmp
14 date | tr -d ':[:alpha:] ' | sed 's/^/k=k*/' >>$tmp
15 ls -l /tmp | sum | tr -d ':[:alpha:] ' | sed 's/^/k=k*/' >>$tmp
16 echo "j=s(k); for (i = 0; i < $PWL; i++) r()" >>$tmp
17 echo "quit" >>$tmp
18 bc $tmp | awk -f autoconf/randpass.awk
19 rm $tmp

They are 2 troubles, symlink attack (race condition) and password revelation
to unstruted user (race condition). This vulnerability is exploitable on
system that dont have openssl command.

* Take a look at : rescue/linux/getdiskinfo

Create bootstrap information files -- prelude to creating a Bacula
Rescue Disk

192 cat >mount_drives <<END_OF_DATA
193 #!/bin/sh
194 #
195 #  Mount disk drives  -- created by getdiskinfo
196 #
197 END_OF_DATA
198 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mkdir -p \/mnt\/disk\2/p'
$di/mount.ext2.bsi >>mount_drives
199 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mkdir -p \/mnt\/disk\2/p'
$di/mount.ext3.bsi >>mount_drives
200 echo "#" >>mount_drives
201 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mount \1 \/mnt\/disk\2/p'
$di/mount.ext2.bsi >/tmp/1$$
202 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mount \1 \/mnt\/disk\2/p'
$di/mount.ext3.bsi >>/tmp/1$$
203 # sort so that root is mounted first
204 sort -k 3 </tmp/1$$ >>mount_drives
205 rm -f /tmp/1$$
206
207 chmod 755 mount_drives
208
209 # copy sfdisk so we will have it
210 cp -f /sbin/sfdisk .
211 echo "Done building scripts."
212 echo " "
213 echo "You might want to do a:"
214 echo " "
215 echo "chown -R uuuu:gggg *"
216 echo " "
217 echo "where uuuu is your userid and gggg is your group"
218 echo "so that you can access all the files as non-root"
219 echo " "

They are two troubles, symlink attack (race condition) and possible
arbitrary
commands execution with users privileges (race condition)

This file don't seem to be installed, we can consider this bug as invalid

* Take a look at : scripts/mtx-changer.in

Bacula interface to mtx autoloader

117    loaded)
118       ${MTX} -f $ctl status >/tmp/mtx.$$
119       rtn=$?
120       cat /tmp/mtx.$$ | grep "^Data Transfer Element $drive:Full" | awk
"{print \$7}"
121       cat /tmp/mtx.$$ | grep "^Data Transfer Element $drive:Empty" | awk
"{print 0}"
122       rm -f /tmp/mtx.$$
123       exit $rtn
124       ;;

symlink attack (race condition) possible

* Also we got this variable in a lot off script :

working_directory  = "/tmp";

Upstream should check the usage off this variable.

#########
Related :
#########

Bug report : <http://bugs.gentoo.org/show_bug.cgi?id=104986>
Bug report <http://bugs.bacula.org/bug_view_advanced_page.php?bug_id=0000422>
CVE :

#####################
Credits :
#####################

Eric Romang (eromang@zataz.net - ZATAZ Audit) - Gentoo Security Scout
Thxs to Gentoo Security Team.
_______________________________________________
Full-Disclosure - We believe in it.
Charter: <http://lists.grok.org.uk/full-disclosure-charter.html>
Hosted and sponsored by Secunia - <http://secunia.com/>
[[prev in list](?l=full-disclosure&m=112721710111478&w=2)] [[next in list](?l=full-disclosure&m=112722415805890&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from bugs.gentoo.org_1678589d_20250125_065346.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 104986
app-backup/bacula <= 1.34.4 multiple vulnerabilities
Last modified: 2005-10-19 10:44:37 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=104986&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=104986&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 104986**](show_bug.cgi?id=104986)
- app-backup/bacula <= 1.34.4 multiple vulnerabilities

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
app-backup/bacula <= 1.34.4 multiple vulnerabilities

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High minor | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | C3 [noglsa] jaervosz | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2005-09-06 02:38 UTC by Romang | | --- | --- | | Modified: | 2005-10-19 10:44 UTC ([History](show_activity.cgi?id=104986)) | | CC List: | 3 users (show)  app-backup fserb hadfield | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=104986&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=104986&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Romang    2005-09-06 02:38:28 UTC  ``` Hello,  * Take a look on : autoconf/randpass  This file is used by configure and autoconf/configure.in to generate random password.  11 tmp=/tmp/p.tmp.$$ 12 cp autoconf/randpass.bc $tmp 13 ps | sum | tr -d ':[:alpha:] ' | sed 's/^/k=/' >>$tmp 14 date | tr -d ':[:alpha:] ' | sed 's/^/k=k*/' >>$tmp 15 ls -l /tmp | sum | tr -d ':[:alpha:] ' | sed 's/^/k=k*/' >>$tmp 16 echo "j=s(k); for (i = 0; i < $PWL; i++) r()" >>$tmp 17 echo "quit" >>$tmp 18 bc $tmp | awk -f autoconf/randpass.awk 19 rm $tmp  They are 2 troubles, symlink attack (race condition) and password revelation to unstruted user (race condition).   * Take a look at : rescue/linux/getdiskinfo  Create bootstrap information files -- prelude to creating a Bacula Rescue Disk  192 cat >mount_drives <<END_OF_DATA 193 #!/bin/sh 194 # 195 #  Mount disk drives  -- created by getdiskinfo 196 # 197 END_OF_DATA 198 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mkdir -p \/mnt\/disk\2/p' $di/mount.ext2.bsi >>mount_drives 199 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mkdir -p \/mnt\/disk\2/p' $di/mount.ext3.bsi >>mount_drives 200 echo "#" >>mount_drives 201 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mount \1 \/mnt\/disk\2/p' $di/mount.ext2.bsi >/tmp/1$$ 202 sed -n 's/\(^.*\)\ on\ \(.*\)\ type.*$/mount \1 \/mnt\/disk\2/p' $di/mount.ext3.bsi >>/tmp/1$$ 203 # sort so that root is mounted first 204 sort -k 3 </tmp/1$$ >>mount_drives 205 rm -f /tmp/1$$ 206  207 chmod 755 mount_drives 208  209 # copy sfdisk so we will have it 210 cp -f /sbin/sfdisk . 211 echo "Done building scripts." 212 echo " " 213 echo "You might want to do a:" 214 echo " " 215 echo "chown -R uuuu:gggg *" 216 echo " " 217 echo "where uuuu is your userid and gggg is your group" 218 echo "so that you can access all the files as non-root" 219 echo " "  They are two troubles, symlink attack (race condition) and possible execution off executing arbitrary commands with users privileges (race condition)   * Take a look at : scripts/mtx-changer.in  Bacula interface to mtx autoloader  117    loaded) 118       ${MTX} -f $ctl status >/tmp/mtx.$$ 119       rtn=$? 120       cat /tmp/mtx.$$ | grep "^Data Transfer Element $drive:Full" | awk "{print \$7}" 121       cat /tmp/mtx.$$ | grep "^Data Transfer Element $drive:Empty" | awk "{print 0}" 122       rm -f /tmp/mtx.$$ 123       exit $rtn 124       ;;  symlink attack (race condition) possible   * Also we got this variable in a lot off script :  working_directory  = "/tmp";  Upstream should check the usage off this variable.  Regards. ```  [Comment 1](#c1)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-09-13 04:06:01 UTC  ``` (In reply to [comment #0](show_bug.cgi?id=104986#c0)) > Hello, >  > * Take a look on : autoconf/randpass >  ...  This would only be exploitable on systems that dont have an openssl command, so  not many systems would be effected, nevertheless, it could potentially be an  issue. Suggest adding a dependency on openssl.  > * Take a look at : rescue/linux/getdiskinfo  This file does not appear to be installed, and therefore is invalid.   >  > * Take a look at : scripts/mtx-changer.in  Yes, I dont see why a temporary file is needed here, this could be done in a  single pipeline.  >  > * Also we got this variable in a lot off script : >  > working_directory  = "/tmp"; >  > Upstream should check the usage off this variable. >   Perhaps, I'll leave that to security team/maintainers to decide.   ```  [Comment 2](#c2)  Romang    2005-09-13 04:23:15 UTC  ``` >> Hello, >>  >> * Take a look on : autoconf/randpass >>  ...  > This would only be exploitable on systems that dont have an openssl command, so  > not many systems would be effected, nevertheless, it could potentially be an  > issue. Suggest adding a dependency on openssl.  ...  Why openssl ?  ...  Regards ```  [Comment 3](#c3)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-09-13 04:45:55 UTC  ``` because it's only used if openssl isnt available. ```  [Comment 4](#c4)  Thierry Carrez (RETIRED)   gentoo-dev  2005-09-17 05:42:59 UTC  ``` eric: where do we stand here ? upstream warned ?  ```  [Comment 5](#c5)  Romang    2005-09-19 01:46:28 UTC  ``` Hello,  Reported into bacula bug system.  <http://bugs.bacula.org/bug_view_advanced_page.php?bug_id=0000422>  Regards. ```  [Comment 6](#c6)  Thierry Carrez (RETIRED)   gentoo-dev  2005-09-20 07:00:31 UTC  ``` Now public.  Version 1.37.39 is out and fixes the issue. Maintainers: please bump. ```  [Comment 7](#c7)  Thierry Carrez (RETIRED)   gentoo-dev  2005-09-23 13:29:22 UTC  ``` CCing herd as maintainers don't answer... ```  [Comment 8](#c8)  Hunter Cook    2005-10-03 17:51:33 UTC  ``` Is this a major issue? I just installed bacula and was about to configure it to backup a pretty important server over the public Internet....is that a bad idea with this version? I just installed 1.34.4 because that's what's marked stable right now, and I hadn't seen this yet.  Also, how is bacula-1.36.3-r1 in comparison? Is it stable? I see the reference to 1.37.39 above...seems like we're a bit behind. Are there other vulnerabilities that 1.36.3 still has problems with? ```  [Comment 9](#c9)  Thierry Carrez (RETIRED)   gentoo-dev  2005-10-04 00:50:05 UTC  ``` These are both local attacks, meaning the attacker needs to get access to the system (and be free to execute code on it). So if you don't have local users on the platform you use Bacula on, that's not such a bug deal. ```  [Comment 10](#c10)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-06 08:12:44 UTC  ``` app-backup please bump.  ```  [Comment 11](#c11)  Daniel Black (RETIRED)   gentoo-dev  2005-10-06 14:05:19 UTC  ``` bacula-1.36.3-r2 added that fixes the vulnerability.     Romang thankyou add please check.    FYI: 1.37* is the unstable beta version   ```  [Comment 12](#c12)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-06 14:09:54 UTC  ``` Nothing in CVS yet.  ```  [Comment 13](#c13)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-06 14:15:30 UTC  ``` Ok, it is in now. Arches please test and mark stable.  ```  [Comment 14](#c14)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-10-07 11:06:49 UTC  ``` Stable on ppc and hppa. ```  [Comment 15](#c15)  Mark Loeser (RETIRED)   gentoo-dev  2005-10-08 22:23:00 UTC  ``` x86 done ```  [Comment 16](#c16)  Thierry Carrez (RETIRED)   gentoo-dev  2005-10-11 08:30:04 UTC  ``` Still misses sparc keyword... ```  [Comment 17](#c17)  Gustavo Zacarias (RETIRED)   gentoo-dev  2005-10-11 10:58:24 UTC  ``` sparc stable.  ```  [Comment 18](#c18)  Thierry Carrez (RETIRED)   gentoo-dev  2005-10-12 00:42:04 UTC  ``` Ready for GLSA vote, I vote NO since I can't think of a supported arch where openssl is not in system. ```  [Comment 19](#c19)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-12 01:00:52 UTC  ``` Voting NO and closing without GLSA.    Romang thanks for reporting.  ```  [Comment 20](#c20)  Daniel Black (RETIRED)   gentoo-dev  2005-10-13 14:17:36 UTC  ``` The password attack on tmp files is one of the situtations.    The second one based on scripts/mtx-changer.in does exist on all platforms.  The exploit to use the vulnerability occurs on configurations where there the  tape backup unit requires manual tape switching.    The exploitable times are between tape changes. I'm not sure if this is a  sufficiently common configuration for a glsa or not. I'm not sure if users are  often given access on machines where a tape-backup may be connected that may  be an effective countermeasure.    A few seconds for your consideration people.  ```  [Comment 21](#c21)  Thierry Carrez (RETIRED)   gentoo-dev  2005-10-14 00:26:46 UTC  ``` Thx for the details. I agree the second scenario is more likely and tends to be run as root, so now I tend to vote yes :) ```  [Comment 22](#c22)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-14 00:32:32 UTC  ``` Small YES vote from me too.  ```  [Comment 23](#c23)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-10-15 01:56:12 UTC  ``` i would vote NO, seems a rare configuration. Also, cannot control output, so  mainly useful for sabotage.  ```  [Comment 24](#c24)  Thierry Carrez (RETIRED)   gentoo-dev  2005-10-19 01:13:10 UTC  ``` Let's get this done, please cast your vote. ```  [Comment 25](#c25)  Daniel Black (RETIRED)   gentoo-dev  2005-10-19 01:45:06 UTC  ``` If I'm allowed to vote I'll say no based on Tavis's comments.  ```  [Comment 26](#c26)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-10-19 10:44:37 UTC  ``` Reverting to NO vote and closing with NO GLSA. Feel free to reopen if you  disagree.  ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=104986)
* - [XML](show_bug.cgi?ctype=xml&id=104986)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=104986)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=104986&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=104986&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=104986&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


