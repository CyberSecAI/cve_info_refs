=== Content from bugs.gentoo.org_e88c0974_20250126_094606.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 78256
net-mail/cmd5checkpw is installed setuid, but does not drop euid
Last modified: 2005-08-15 21:29:46 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=78256&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=78256&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 78256**](show_bug.cgi?id=78256)
- net-mail/cmd5checkpw is installed setuid, but does not drop euid

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
net-mail/cmd5checkpw is installed setuid, but does not drop euid

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | High minor | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B4 [glsa] | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2005-01-16 11:34 UTC by Florian Westphal | | --- | --- | | Modified: | 2005-08-15 21:29 UTC ([History](show_activity.cgi?id=78256)) | | CC List: | 2 users (show)  net-mail+disabled robbat2 | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**cmd5checkpw: set euid to uid of calling user**](attachment.cgi?id=48674 "View the content of the attachment") (cmd5checkpw-0.22-seteuid.patch,931 bytes, patch)  [2005-01-16 11:37 UTC](#attach_48674 "Go to the comment associated with the attachment"), Florian Westphal | *no flags* | [Details](attachment.cgi?id=48674&action=edit) | [Diff](attachment.cgi?id=48674&action=diff) | | [View All](attachment.cgi?bugid=78256&action=viewall)  [Add an attachment](attachment.cgi?bugid=78256&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=78256&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Florian Westphal    2005-01-16 11:34:26 UTC  ``` net-mail/cmd5checkpw is installed setuid cmd5checkpw, but it does not drop privileges before calling execvp(), i.e. the invoked program retains the cmd5checkpw euid. Local users that know at least one valid /etc/poppasswd user/password combination can read the /etc/poppasswd file.  Reproducible: Always Steps to Reproduce: 1. emerge net-mail/cmd5checkwp 2. create /etc/poppasswd to contain: user:pass secret:secret 3: $ id uid=1001(fw) gid=100(users) groups=5(tty),10(wheel),16(cron),100(users) $ perl -e 'print("user\0pass\0\pass\0");' > test $ 3<test $ /bin/cmd5checkpw id uid=1001(fw) gid=100(users) euid=1000(cmd5checkpw)  [..]  Actual Results:   user obtains euid=1000(cmd5checkpw).  Expected Results:   Drop euid before execvp().  If cmd5checkpw really needs to be setuid, it should set its effective uid to that the real uid of the calling process. I'll add a patch to do this, but i'd prefer cmd5checkpw to not be setuid (this might break things though) ```  [Comment 1](#c1)  Florian Westphal    2005-01-16 11:37:10 UTC  ``` Created [attachment 48674](attachment.cgi?id=48674 "cmd5checkpw: set euid to uid of calling user") [[details](attachment.cgi?id=48674&action=edit "cmd5checkpw: set euid to uid of calling user"), [diff](attachment.cgi?id=48674&action=diff "cmd5checkpw: set euid to uid of calling user")] cmd5checkpw: set euid to uid of calling user ```  [Comment 2](#c2)  Thierry Carrez (RETIRED)   gentoo-dev  2005-01-16 11:48:16 UTC  ``` net-mail herd, please comment (on the need to be SUID and on the patch) Florian: did you try to contact upstream yet ? ```  [Comment 3](#c3)  Florian Westphal    2005-01-16 11:58:40 UTC  ``` I emailed brush@elysium.pl about this a few minutes ago. (same Bugreport + patch) (I thought this was a Gentoo specific bug at first before seeing that upstream docs suggest making cmd5checkpw setuid) ```  [Comment 4](#c4)  Thierry Carrez (RETIRED)   gentoo-dev  2005-01-27 07:12:34 UTC  ``` Reassigning this as a vulnerability, since it's a clear local information leak. Florian: any answer from upstream ? ```  [Comment 5](#c5)  Florian Westphal    2005-01-27 08:55:35 UTC  ``` No reply from upstream until now. The last 'news' item on the project homepage is dated 09.10.2000... ```  [Comment 6](#c6)  Thierry Carrez (RETIRED)   gentoo-dev  2005-01-27 08:59:48 UTC  ``` net-mail: please comment. Can cmd5checkwp not be setuid ? If not, what do you think of the patch ? ```  [Comment 7](#c7)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-01-27 10:55:24 UTC  ``` langthang asked me to comment on this bug. There we go.  Quoting the manpage of cmd5checkpw: FILES     /etc/poppasswd - this file contains pairs  of  logins  and  clear  text     passwords separated by ":". It looks like this:      login1:password1     login2:password2      Best  way  to  protect  it is to make it readable only for one specific     user different than you normal system users and make  cmd5checkpw  suid     that user.  Therefore, I would say that cmd5checkpw has to be setuid if /etc/poppasswd is only readable by a specific user. But I also think that dropping the effective uid wouldn't hurt. If nobody else (robbat2?) sees a problem in here, we should apply the patch. ```  [Comment 8](#c8)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-01-27 11:12:57 UTC  ``` Robin, what do you think about this patch? Can we apply it? ```  [Comment 9](#c9)  Thierry Carrez (RETIRED)   gentoo-dev  2005-02-04 06:02:00 UTC  ``` Upstream looks dead... net-mail: please apply the patch or drop the package. ```  [Comment 10](#c10)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-02-13 04:24:50 UTC  ``` The patch is now applied to cmd5checkpw-0.22-r2. The ebuild is currently in ~ARCH for testing. Please test it and comment on this bug again. Then we'll make a stabilization request to all affected architectures. ```  [Comment 11](#c11)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-13 04:46:05 UTC  ``` Thx Micheal, reopening for stable marking.  Arches please test and mark cmd5checkpw-0.22-r2 stable. ```  [Comment 12](#c12)  Olivier Crete (RETIRED)   gentoo-dev  2005-02-13 12:49:52 UTC  ``` x86 stable ```  [Comment 13](#c13)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-02-13 14:26:11 UTC  ``` Stable on ppc and hppa. ```  [Comment 14](#c14)  Bryan Østergaard (RETIRED)   gentoo-dev  2005-02-13 14:57:50 UTC  ``` Stable on alpha. ```  [Comment 15](#c15)  Gustavo Zacarias (RETIRED)   gentoo-dev  2005-02-14 05:47:36 UTC  ``` sparc stable.  ```  [Comment 16](#c16)  Mike Doty (RETIRED)   gentoo-dev  2005-02-14 06:53:44 UTC  ``` how is this being tested?(noone on amd64 apparently uses it) ```  [Comment 17](#c17)  Thierry Carrez (RETIRED)   gentoo-dev  2005-02-15 01:30:14 UTC  ``` Mike: I am not a cmd5checkpw user but it looks like a password changing system that will access a /etc/poppasswd (owned by the cmd5checkpw user and -rw-------).   Try creating a /etc/poppasswd file with pairs of logins and clear text passwords like this :      login1:password1  And validate you can change the password as a regular user. You can also vamidate that the exploit in bug description is no longer working. ```  [Comment 18](#c18)  Hardave Riar (RETIRED)   gentoo-dev  2005-02-18 10:59:51 UTC  ``` Stable on mips. ```  [Comment 19](#c19)  Mike Doty (RETIRED)   gentoo-dev  2005-02-19 08:01:35 UTC  ``` stable on amd64 ```  [Comment 20](#c20)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-21 02:09:38 UTC  ``` security, pls vote on GLSA need ```  [Comment 21](#c21)  Luke Macken (RETIRED)   gentoo-dev  2005-02-23 18:39:15 UTC  ``` I vote no glsa, please feel free to disagree ;) ```  [Comment 22](#c22)  Thierry Carrez (RETIRED)   gentoo-dev  2005-02-24 02:05:04 UTC  ``` Local users can get plaintext POP passwords for their coworkers... I vote yes. ```  [Comment 23](#c23)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-24 03:25:48 UTC  ``` not absolutely necessary, but a GLSA on this might be a good idea  voting for one ```  [Comment 24](#c24)  Thierry Carrez (RETIRED)   gentoo-dev  2005-02-25 13:32:50 UTC  ``` GLSA 200502-30 arm should park stable to benefit from GLSA  ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=78256)
* - [XML](show_bug.cgi?ctype=xml&id=78256)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=78256)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=78256&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=78256&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=78256&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from security.gentoo.org_c9da7e18_20250125_150908.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# cmd5checkpw: Local password leak vulnerability — GLSA **200502-30**

cmd5checkpw contains a flaw allowing local users to access other users
cmd5checkpw passwords.

### Affected packages

| Package | **net-mail/cmd5checkpw** on all architectures |
| --- | --- |
| Affected versions | <= **0.22-r1** |
| Unaffected versions | >= **0.22-r2** |

### Background

cmd5checkpw is a checkpassword compatible authentication program that
uses CRAM-MD5 authentication mode.

### Description

Florian Westphal discovered that cmd5checkpw is installed setuid
cmd5checkpw but does not drop privileges before calling execvp(), so
the invoked program retains the cmd5checkpw euid.

### Impact

Local users that know at least one valid /etc/poppasswd user/password
combination can read the /etc/poppasswd file.

### Workaround

There is no known workaround at this time.

### Resolution

All cmd5checkpw users should upgrade to the latest available version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=net-mail/cmd5checkpw-0.22-r2"
```
### References

* [CVE-2005-0580](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-0580)

**Release date**

February 25, 2005

**Latest revision**

May 22, 2006: 02

**Severity**

low

**Exploitable**

local

**Bugzilla entries**

* [78256](https://bugs.gentoo.org/show_bug.cgi?id=78256)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**


