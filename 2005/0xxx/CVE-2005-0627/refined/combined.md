=== Content from www.gentoo.org_88e7cd03_20250125_200907.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Qt: Untrusted library search path — GLSA **200503-01**

Qt may load shared libraries from an untrusted, world-writable directory,
resulting in the execution of arbitrary code.

### Affected packages

| Package | **x11-libs/qt** on all architectures |
| --- | --- |
| Affected versions | < **3.3.4-r2** |
| Unaffected versions | >= **3.3.4-r2** |

### Background

Qt is a cross-platform GUI toolkit used by KDE.

### Description

Tavis Ormandy of the Gentoo Linux Security Audit Team has discovered
that Qt searches for shared libraries in an untrusted, world-writable
directory.

### Impact

A local attacker could create a malicious shared object that would be
loaded by Qt, resulting in the execution of arbitrary code with the
privileges of the Qt application.

### Workaround

There is no known workaround at this time.

### Resolution

All Qt users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=x11-libs/qt-3.3.4-r2"
```
### References

* [CVE-2005-0627](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2005-0627)

**Release date**

March 01, 2005

**Latest revision**

May 22, 2006: 02

**Severity**

normal

**Exploitable**

local

**Bugzilla entries**

* [75181](https://bugs.gentoo.org/show_bug.cgi?id=75181)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_a02d984c_20250126_113813.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 75181
x11-libs/qt: libqt rpath may allow local users to hijack qt applications
Last modified: 2008-01-13 14:12:22 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=75181&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=75181&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 75181**](show_bug.cgi?id=75181)
- x11-libs/qt: libqt rpath may allow local users to hijack qt applications

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
x11-libs/qt: libqt rpath may allow local users to hijack qt applications

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [http://marc.theaimsgroup.com/?l=gento...](http://marc.theaimsgroup.com/?l=gentoo-dev&m=108275886414974&w=4) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | A3? [glsa] jaervosz | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [81745](show_bug.cgi?id=81745 "RESOLVED FIXED - [TRACKER - DO NOT POST HERE] Insecure DT_RPATH/DT_RUNPATH tracker") | |  | Show dependency [tree](showdependencytree.cgi?id=75181&hide_resolved=1) | |  | | Reported: | 2004-12-21 07:24 UTC by Tavis Ormandy (RETIRED) | | --- | --- | | Modified: | 2008-01-13 14:12 UTC ([History](show_activity.cgi?id=75181)) | | CC List: | 1 user (show)  kde | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**proposed fix**](attachment.cgi?id=46559 "View the content of the attachment") (rpath.patch,352 bytes, patch)  [2004-12-21 12:00 UTC](#attach_46559 "Go to the comment associated with the attachment"), Caleb Tennis (RETIRED) | *no flags* | [Details](attachment.cgi?id=46559&action=edit) | [Diff](attachment.cgi?id=46559&action=diff) | | [View All](attachment.cgi?bugid=75181&action=viewall)  [Add an attachment](attachment.cgi?bugid=75181&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=75181&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Tavis Ormandy (RETIRED)   gentoo-dev  2004-12-21 07:24:51 UTC  ``` it looks like qt remembers it's build directory under $BUILD_PREFIX (eg, /var/tmp/portage) and searches there for shared libraries to dlopen as required, regardless of LD_LIBRARY_PATH.  This could be a security issue, if tmp directories are cleared out by an administrator doing some spring cleaning (eg, rm -rf /var/tmp/portage) or if there is a mailicious user in group portage (group portage has write permission under /var/tmp/portage, eg: drwxrwxr-x  47 portage portage 1544 Dec 21 14:47 /var/tmp/portage/), a malicious user could create common libraries such as libpng or libmng and inject code into other users qt applications.  Ideally, qt should not try searching this for shared libraries to open.  example, with opera:  $ strace -e open opera 2>&1 | grep "/var/tmp/portage" open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) ...  etc, and here's one with qtorrent:  $ strace -e open qtorrent 2>&1 | grep "/var/tmp/portage" open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) ...  etc. ```  [Comment 1](#c1)  Tavis Ormandy (RETIRED)   gentoo-dev  2004-12-21 08:15:01 UTC  ``` $ readelf -d /usr/qt/3/lib/libqt-mt.so.3 | grep RPATH  0x0000000f (RPATH)                      Library rpath: [/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib] ```  [Comment 2](#c2)  Simone Gotti (RETIRED)   gentoo-dev  2004-12-21 08:52:43 UTC  ``` probably qmake adds an -rpath ${current build} dir in the Makefile. Can this be the problem?  # cd /var/tmp/portage/qt-3.3.3-r1/work/qt-x11-free-3.3.3  # grep "rpath" src/Makefile LFLAGS   = -fno-exceptions -shared -Wl,-soname,libqt-mt.so.3 -Wl,-rpath,/var/tmp/portage/qt-3.3.3-r1/work/qt-x11-free-3.3.3/lib  ```  [Comment 3](#c3)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 09:43:17 UTC  ``` I have a patch in that filters it out of the uic Makefile, but apparently I'm not getting all instances of it. ```  [Comment 4](#c4)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 12:00:37 UTC  ``` Created [attachment 46559](attachment.cgi?id=46559 "proposed fix") [[details](attachment.cgi?id=46559&action=edit "proposed fix"), [diff](attachment.cgi?id=46559&action=diff "proposed fix")] proposed fix ```  [Comment 5](#c5)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 12:15:59 UTC  ``` Note that I think I've tried deleting this instance of rpath before, and it made the compilation of Qt fail, but that could have been in an older version. ```  [Comment 6](#c6)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 09:32:02 UTC  ``` I think this is a fairly serious problem, not just a theoretical one...I might be missing something though, perhaps I should explain why I think this is an issue...  portage encourages the adding of users to group portage if they are going to use emerge, it's not a big deal...  *** You are not in the portage group. You may experience cache problems *** due to permissions preventing the creation of the on-disk cache. *** Please add this user to the portage group if you wish to use portage.  Once you're in group portage, you have write permissions in PORTAGE_TMPDIR, and if you can get a file into /var/tmp/portage/qt-x.y.z/work/qt-x11-free-x.y.z/lib/, you can control anyone's qt applications.  The gentoo faq says it's safe to clean out /var/tmp/portage   <http://www.gentoo.org/doc/en/faq.xml#tmpportage> <http://forums.gentoo.org/viewtopic.php?t=30547>  If an admin does this (and if you google for rm -rf /var/tmp/portage, you can see lots do), anyone in group portage can run code as any user who uses qt apps.  exploitation is simple:  $ mkdir -p /var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib $ gcc -shared rpath.c -o /var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/libpng.so.3 now when someone runs opera (or some other app)... $ opera exploit code now in control! opera: Activated running instance of Opera  Here's the code from rpath.c:  #include <stdio.h>  void __attribute__ ((constructor)) rpath_exploit (void);  void rpath_exploit (void) {         fprintf (stderr, "exploit code now in control!\n");         /* insert evil code here */ }  Okay, this isn't a huge threat to gentoo security, but i really think it needs to be fixed :) ```  [Comment 7](#c7)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 09:40:50 UTC  ``` Also, I havnt tried it, but if someone were to install qt from a tbz2, would the directory be present? if not, anyone in group portage can just create it.  Even worse, if someone uses a different PORTAGE_TMPDIR from whoever built qt, or if they change the directory after building it, you don't even need to be in group portage...if you can write to /var/tmp (everyone), you're in business! :) ```  [Comment 8](#c8)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 14:54:10 UTC  ``` I've just checked the qt.spec used in fedora, they have this:  # don't use rpath perl -pi -e "s|-Wl,-rpath,| |" mkspecs/*/qmake.conf  ```  [Comment 9](#c9)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-08 09:54:44 UTC  ``` Caleb: your patch does fix the issue here, and seems to be inline with what other distros are doing..could you apply this patch? ```  [Comment 10](#c10)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-09 17:53:27 UTC  ``` Committed as 3.3.4-r2 ```  [Comment 11](#c11)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-09 21:58:13 UTC  ``` Thx Caleb, are there any outstanding major problems with 3.3.4? If not Security will call arches to mark 3.3.4-r2 stable. ```  [Comment 12](#c12)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-10 04:10:34 UTC  ``` I think a bump to stable is in order, but I'd like to hold off on promoting it for a little bit yet to make sure there are no negative implications of Qt not having rpath built into the library. ```  [Comment 13](#c13)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-10 04:27:25 UTC  ``` Thx Caleb.  Arches please test 3.3.4-r2 and report back results here. Do not mark stable yet. ```  [Comment 14](#c14)  Markus Rothe (RETIRED)   gentoo-dev  2005-02-10 12:22:37 UTC  ``` looks good on ppc64. (but I only have launched a few apps of kde..)  Markus ```  [Comment 15](#c15)  Jason Wever (RETIRED)   gentoo-dev  2005-02-11 06:08:23 UTC  ``` Looking good on sparc ```  [Comment 16](#c16)  Marcus D. Hanwell (RETIRED)   gentoo-dev  2005-02-11 06:10:56 UTC  ``` Looking good on amd64. ```  [Comment 17](#c17)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-02-11 09:39:29 UTC  ``` Looks good on ppc. ```  [Comment 18](#c18)  Bryan Østergaard (RETIRED)   gentoo-dev  2005-02-11 17:09:48 UTC  ``` Looks good on alpha. ```  [Comment 19](#c19)  Olivier Crete (RETIRED)   gentoo-dev  2005-02-13 12:49:56 UTC  ``` I'm not using any qt apps.. can other x86 devs can test it ? ```  [Comment 20](#c20)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-14 11:32:21 UTC  ``` x86 looks fine here.  Caleb, I think we're ready to go on all supported arches. ```  [Comment 21](#c21)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-19 04:12:35 UTC  ``` FYI:  After further testing there might be a problem. Since upgrading to xorg 6.8.2 and qt 3.3.4-r2 I've had the main Konqueror window pane consistingly refusing to load twice and the message pane in Kmail once. Restarting solved the problem. I have not encountered the problem with xorg 6.8.2 and the current stable qt. Unfortunately I don't have the time to test any further and pin the problem for the coming week. ```  [Comment 22](#c22)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-19 07:10:28 UTC  ``` I haven't had any problems here with 6.8.2 and qt 3.3.4-r2. ```  [Comment 23](#c23)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-23 05:24:48 UTC  ``` I've just marked 3.3.4-r2 x86 stable. ```  [Comment 24](#c24)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-23 05:42:37 UTC  ``` caleb, are we ready to mark the arches stable that tested this already? ```  [Comment 25](#c25)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-23 06:11:33 UTC  ``` As far as I'm concerned, yes.  I have noted no problems with it other than the typical "you may have to re-emerge kdelibs after upgrading qt" bug report. ```  [Comment 26](#c26)  Markus Rothe (RETIRED)   gentoo-dev  2005-02-23 10:38:46 UTC  ``` stable on ppc64 ```  [Comment 27](#c27)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-23 12:16:55 UTC  ``` arches, feel free to mark the ebuild stable then since caleb agrees  (removing x86 from CC, cause it's already marked stable there) ```  [Comment 28](#c28)  Gustavo Zacarias (RETIRED)   gentoo-dev  2005-02-23 17:48:37 UTC  ``` sparc stable. ```  [Comment 29](#c29)  Jochen Maes (RETIRED)   gentoo-dev  2005-02-24 06:20:16 UTC  ``` ppc stable ```  [Comment 30](#c30)  Bryan Østergaard (RETIRED)   gentoo-dev  2005-02-24 10:01:29 UTC  ``` Alpha stable. ```  [Comment 31](#c31)  Aron Griffis (RETIRED)   gentoo-dev  2005-02-25 08:58:16 UTC  ``` done on ia64 ```  [Comment 32](#c32)  Aron Griffis (RETIRED)   gentoo-dev  2005-02-25 08:58:23 UTC  ``` done on ia64 ```  [Comment 33](#c33)  Marcus D. Hanwell (RETIRED)   gentoo-dev  2005-03-01 03:47:19 UTC  ``` Sorry for the delay - there was another pending bug for this library I had to investigate. Now stable on amd64. ```  [Comment 34](#c34)  Hardave Riar (RETIRED)   gentoo-dev  2005-03-01 08:27:14 UTC  ``` Stable on mips. ```  [Comment 35](#c35)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-03-01 10:18:18 UTC  ``` Thx everyone.  GLSA 200503-01  hppa please remember to mark stable. ```  [Comment 36](#c36)  René Nussbaumer (RETIRED)   gentoo-dev  2005-06-26 05:09:42 UTC  ``` -r3 already stable on hppa. ```  [Comment 37](#c37)  Roland Harnau    2008-01-09 21:58:28 UTC  ``` Are there any reasons why  RPATH/RUNPATH header entries are still suppressed in recent Qt4 ebuilds/eclasses? E.g. qt-4.3.3.ebuild contains the somewhat redundant lines  # Do not link with -rpath. See [bug #75181](show_bug.cgi?id=75181 "RESOLVED FIXED - x11-libs/qt: libqt rpath may allow local users to hijack qt applications"). sed -i -e "s:QMAKE_RPATH.*=.*:QMAKE_RPATH=:" qmake.conf [..] # Do not link with -rpath. See [bug #75181](show_bug.cgi?id=75181 "RESOLVED FIXED - x11-libs/qt: libqt rpath may allow local users to hijack qt applications"). sed -i -e "s:QMAKE_RPATH.*=.*:QMAKE_RPATH=:" g++.conf [..] myconf="-stl -verbose -largefile -confirm-license \ -platform ${PLATFORM} -xplatform ${PLATFORM} -no-rpath \ "  When I build Qt 4.3.3 myself outside Gentoo (configured with -prefix /usr/qt4) I get the correct behavior, i.e. RPATH/RUNPATH is set to the library install path. E.g.    readelf -d /usr/qt4/lib/libQtCore.so | grep "PATH"   0x000000000000000f (RPATH)              Library rpath: [/usr/qt4/lib]   0x000000000000001d (RUNPATH)            Library runpath: [/usr/qt4/lib]        ```  [Comment 38](#c38)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2008-01-13 14:12:22 UTC  ``` @Roland, this issue is closed. Please open a new bug and assign it to the KDE team. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=75181)
* - [XML](show_bug.cgi?ctype=xml&id=75181)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=75181)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=75181&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=75181&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=75181&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugs.gentoo.org_b8aed41b_20250125_200905.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 75181
x11-libs/qt: libqt rpath may allow local users to hijack qt applications
Last modified: 2008-01-13 14:12:22 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=75181&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=75181&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 75181**](show_bug.cgi?id=75181)
- x11-libs/qt: libqt rpath may allow local users to hijack qt applications

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
x11-libs/qt: libqt rpath may allow local users to hijack qt applications

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [http://marc.theaimsgroup.com/?l=gento...](http://marc.theaimsgroup.com/?l=gentoo-dev&m=108275886414974&w=4) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | A3? [glsa] jaervosz | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [81745](show_bug.cgi?id=81745 "RESOLVED FIXED - [TRACKER - DO NOT POST HERE] Insecure DT_RPATH/DT_RUNPATH tracker") | |  | Show dependency [tree](showdependencytree.cgi?id=75181&hide_resolved=1) | |  | | Reported: | 2004-12-21 07:24 UTC by Tavis Ormandy (RETIRED) | | --- | --- | | Modified: | 2008-01-13 14:12 UTC ([History](show_activity.cgi?id=75181)) | | CC List: | 1 user (show)  kde | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**proposed fix**](attachment.cgi?id=46559 "View the content of the attachment") (rpath.patch,352 bytes, patch)  [2004-12-21 12:00 UTC](#attach_46559 "Go to the comment associated with the attachment"), Caleb Tennis (RETIRED) | *no flags* | [Details](attachment.cgi?id=46559&action=edit) | [Diff](attachment.cgi?id=46559&action=diff) | | [View All](attachment.cgi?bugid=75181&action=viewall)  [Add an attachment](attachment.cgi?bugid=75181&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=75181&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  Tavis Ormandy (RETIRED)   gentoo-dev  2004-12-21 07:24:51 UTC  ``` it looks like qt remembers it's build directory under $BUILD_PREFIX (eg, /var/tmp/portage) and searches there for shared libraries to dlopen as required, regardless of LD_LIBRARY_PATH.  This could be a security issue, if tmp directories are cleared out by an administrator doing some spring cleaning (eg, rm -rf /var/tmp/portage) or if there is a mailicious user in group portage (group portage has write permission under /var/tmp/portage, eg: drwxrwxr-x  47 portage portage 1544 Dec 21 14:47 /var/tmp/portage/), a malicious user could create common libraries such as libpng or libmng and inject code into other users qt applications.  Ideally, qt should not try searching this for shared libraries to open.  example, with opera:  $ strace -e open opera 2>&1 | grep "/var/tmp/portage" open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) ...  etc, and here's one with qtorrent:  $ strace -e open qtorrent 2>&1 | grep "/var/tmp/portage" open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/i686/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/tls/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) open("/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/i686/sse2/libmng.so.1", O_RDONLY) = -1 ENOENT (No such file or directory) ...  etc. ```  [Comment 1](#c1)  Tavis Ormandy (RETIRED)   gentoo-dev  2004-12-21 08:15:01 UTC  ``` $ readelf -d /usr/qt/3/lib/libqt-mt.so.3 | grep RPATH  0x0000000f (RPATH)                      Library rpath: [/var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib] ```  [Comment 2](#c2)  Simone Gotti (RETIRED)   gentoo-dev  2004-12-21 08:52:43 UTC  ``` probably qmake adds an -rpath ${current build} dir in the Makefile. Can this be the problem?  # cd /var/tmp/portage/qt-3.3.3-r1/work/qt-x11-free-3.3.3  # grep "rpath" src/Makefile LFLAGS   = -fno-exceptions -shared -Wl,-soname,libqt-mt.so.3 -Wl,-rpath,/var/tmp/portage/qt-3.3.3-r1/work/qt-x11-free-3.3.3/lib  ```  [Comment 3](#c3)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 09:43:17 UTC  ``` I have a patch in that filters it out of the uic Makefile, but apparently I'm not getting all instances of it. ```  [Comment 4](#c4)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 12:00:37 UTC  ``` Created [attachment 46559](attachment.cgi?id=46559 "proposed fix") [[details](attachment.cgi?id=46559&action=edit "proposed fix"), [diff](attachment.cgi?id=46559&action=diff "proposed fix")] proposed fix ```  [Comment 5](#c5)  Caleb Tennis (RETIRED)   gentoo-dev  2004-12-21 12:15:59 UTC  ``` Note that I think I've tried deleting this instance of rpath before, and it made the compilation of Qt fail, but that could have been in an older version. ```  [Comment 6](#c6)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 09:32:02 UTC  ``` I think this is a fairly serious problem, not just a theoretical one...I might be missing something though, perhaps I should explain why I think this is an issue...  portage encourages the adding of users to group portage if they are going to use emerge, it's not a big deal...  *** You are not in the portage group. You may experience cache problems *** due to permissions preventing the creation of the on-disk cache. *** Please add this user to the portage group if you wish to use portage.  Once you're in group portage, you have write permissions in PORTAGE_TMPDIR, and if you can get a file into /var/tmp/portage/qt-x.y.z/work/qt-x11-free-x.y.z/lib/, you can control anyone's qt applications.  The gentoo faq says it's safe to clean out /var/tmp/portage   <http://www.gentoo.org/doc/en/faq.xml#tmpportage> <http://forums.gentoo.org/viewtopic.php?t=30547>  If an admin does this (and if you google for rm -rf /var/tmp/portage, you can see lots do), anyone in group portage can run code as any user who uses qt apps.  exploitation is simple:  $ mkdir -p /var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib $ gcc -shared rpath.c -o /var/tmp/portage/qt-3.3.3/work/qt-x11-free-3.3.3/lib/libpng.so.3 now when someone runs opera (or some other app)... $ opera exploit code now in control! opera: Activated running instance of Opera  Here's the code from rpath.c:  #include <stdio.h>  void __attribute__ ((constructor)) rpath_exploit (void);  void rpath_exploit (void) {         fprintf (stderr, "exploit code now in control!\n");         /* insert evil code here */ }  Okay, this isn't a huge threat to gentoo security, but i really think it needs to be fixed :) ```  [Comment 7](#c7)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 09:40:50 UTC  ``` Also, I havnt tried it, but if someone were to install qt from a tbz2, would the directory be present? if not, anyone in group portage can just create it.  Even worse, if someone uses a different PORTAGE_TMPDIR from whoever built qt, or if they change the directory after building it, you don't even need to be in group portage...if you can write to /var/tmp (everyone), you're in business! :) ```  [Comment 8](#c8)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-05 14:54:10 UTC  ``` I've just checked the qt.spec used in fedora, they have this:  # don't use rpath perl -pi -e "s|-Wl,-rpath,| |" mkspecs/*/qmake.conf  ```  [Comment 9](#c9)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-02-08 09:54:44 UTC  ``` Caleb: your patch does fix the issue here, and seems to be inline with what other distros are doing..could you apply this patch? ```  [Comment 10](#c10)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-09 17:53:27 UTC  ``` Committed as 3.3.4-r2 ```  [Comment 11](#c11)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-09 21:58:13 UTC  ``` Thx Caleb, are there any outstanding major problems with 3.3.4? If not Security will call arches to mark 3.3.4-r2 stable. ```  [Comment 12](#c12)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-10 04:10:34 UTC  ``` I think a bump to stable is in order, but I'd like to hold off on promoting it for a little bit yet to make sure there are no negative implications of Qt not having rpath built into the library. ```  [Comment 13](#c13)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-10 04:27:25 UTC  ``` Thx Caleb.  Arches please test 3.3.4-r2 and report back results here. Do not mark stable yet. ```  [Comment 14](#c14)  Markus Rothe (RETIRED)   gentoo-dev  2005-02-10 12:22:37 UTC  ``` looks good on ppc64. (but I only have launched a few apps of kde..)  Markus ```  [Comment 15](#c15)  Jason Wever (RETIRED)   gentoo-dev  2005-02-11 06:08:23 UTC  ``` Looking good on sparc ```  [Comment 16](#c16)  Marcus D. Hanwell (RETIRED)   gentoo-dev  2005-02-11 06:10:56 UTC  ``` Looking good on amd64. ```  [Comment 17](#c17)  Michael Hanselmann (hansmi) (RETIRED)   gentoo-dev  2005-02-11 09:39:29 UTC  ``` Looks good on ppc. ```  [Comment 18](#c18)  Bryan Østergaard (RETIRED)   gentoo-dev  2005-02-11 17:09:48 UTC  ``` Looks good on alpha. ```  [Comment 19](#c19)  Olivier Crete (RETIRED)   gentoo-dev  2005-02-13 12:49:56 UTC  ``` I'm not using any qt apps.. can other x86 devs can test it ? ```  [Comment 20](#c20)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-14 11:32:21 UTC  ``` x86 looks fine here.  Caleb, I think we're ready to go on all supported arches. ```  [Comment 21](#c21)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-02-19 04:12:35 UTC  ``` FYI:  After further testing there might be a problem. Since upgrading to xorg 6.8.2 and qt 3.3.4-r2 I've had the main Konqueror window pane consistingly refusing to load twice and the message pane in Kmail once. Restarting solved the problem. I have not encountered the problem with xorg 6.8.2 and the current stable qt. Unfortunately I don't have the time to test any further and pin the problem for the coming week. ```  [Comment 22](#c22)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-19 07:10:28 UTC  ``` I haven't had any problems here with 6.8.2 and qt 3.3.4-r2. ```  [Comment 23](#c23)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-23 05:24:48 UTC  ``` I've just marked 3.3.4-r2 x86 stable. ```  [Comment 24](#c24)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-23 05:42:37 UTC  ``` caleb, are we ready to mark the arches stable that tested this already? ```  [Comment 25](#c25)  Caleb Tennis (RETIRED)   gentoo-dev  2005-02-23 06:11:33 UTC  ``` As far as I'm concerned, yes.  I have noted no problems with it other than the typical "you may have to re-emerge kdelibs after upgrading qt" bug report. ```  [Comment 26](#c26)  Markus Rothe (RETIRED)   gentoo-dev  2005-02-23 10:38:46 UTC  ``` stable on ppc64 ```  [Comment 27](#c27)  Matthias Geerdsen (RETIRED)   gentoo-dev  2005-02-23 12:16:55 UTC  ``` arches, feel free to mark the ebuild stable then since caleb agrees  (removing x86 from CC, cause it's already marked stable there) ```  [Comment 28](#c28)  Gustavo Zacarias (RETIRED)   gentoo-dev  2005-02-23 17:48:37 UTC  ``` sparc stable. ```  [Comment 29](#c29)  Jochen Maes (RETIRED)   gentoo-dev  2005-02-24 06:20:16 UTC  ``` ppc stable ```  [Comment 30](#c30)  Bryan Østergaard (RETIRED)   gentoo-dev  2005-02-24 10:01:29 UTC  ``` Alpha stable. ```  [Comment 31](#c31)  Aron Griffis (RETIRED)   gentoo-dev  2005-02-25 08:58:16 UTC  ``` done on ia64 ```  [Comment 32](#c32)  Aron Griffis (RETIRED)   gentoo-dev  2005-02-25 08:58:23 UTC  ``` done on ia64 ```  [Comment 33](#c33)  Marcus D. Hanwell (RETIRED)   gentoo-dev  2005-03-01 03:47:19 UTC  ``` Sorry for the delay - there was another pending bug for this library I had to investigate. Now stable on amd64. ```  [Comment 34](#c34)  Hardave Riar (RETIRED)   gentoo-dev  2005-03-01 08:27:14 UTC  ``` Stable on mips. ```  [Comment 35](#c35)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-03-01 10:18:18 UTC  ``` Thx everyone.  GLSA 200503-01  hppa please remember to mark stable. ```  [Comment 36](#c36)  René Nussbaumer (RETIRED)   gentoo-dev  2005-06-26 05:09:42 UTC  ``` -r3 already stable on hppa. ```  [Comment 37](#c37)  Roland Harnau    2008-01-09 21:58:28 UTC  ``` Are there any reasons why  RPATH/RUNPATH header entries are still suppressed in recent Qt4 ebuilds/eclasses? E.g. qt-4.3.3.ebuild contains the somewhat redundant lines  # Do not link with -rpath. See [bug #75181](show_bug.cgi?id=75181 "RESOLVED FIXED - x11-libs/qt: libqt rpath may allow local users to hijack qt applications"). sed -i -e "s:QMAKE_RPATH.*=.*:QMAKE_RPATH=:" qmake.conf [..] # Do not link with -rpath. See [bug #75181](show_bug.cgi?id=75181 "RESOLVED FIXED - x11-libs/qt: libqt rpath may allow local users to hijack qt applications"). sed -i -e "s:QMAKE_RPATH.*=.*:QMAKE_RPATH=:" g++.conf [..] myconf="-stl -verbose -largefile -confirm-license \ -platform ${PLATFORM} -xplatform ${PLATFORM} -no-rpath \ "  When I build Qt 4.3.3 myself outside Gentoo (configured with -prefix /usr/qt4) I get the correct behavior, i.e. RPATH/RUNPATH is set to the library install path. E.g.    readelf -d /usr/qt4/lib/libQtCore.so | grep "PATH"   0x000000000000000f (RPATH)              Library rpath: [/usr/qt4/lib]   0x000000000000001d (RUNPATH)            Library runpath: [/usr/qt4/lib]        ```  [Comment 38](#c38)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2008-01-13 14:12:22 UTC  ``` @Roland, this issue is closed. Please open a new bug and assign it to the KDE team. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=75181)
* - [XML](show_bug.cgi?ctype=xml&id=75181)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=75181)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=75181&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=75181&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=75181&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


