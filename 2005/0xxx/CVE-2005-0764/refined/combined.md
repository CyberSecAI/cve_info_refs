=== Content from www.gentoo.org_f107921a_20250125_072503.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# rxvt-unicode: Buffer overflow — GLSA **200503-23**

rxvt-unicode is vulnerable to a buffer overflow that could lead to the
execution of arbitrary code.

### Affected packages

| Package | **x11-terms/rxvt-unicode** on all architectures |
| --- | --- |
| Affected versions | < **5.3** |
| Unaffected versions | >= **5.3**< **4.8** |

### Background

rxvt-unicode is a clone of the well known terminal emulator rxvt.

### Description

Rob Holland of the Gentoo Linux Security Audit Team discovered
that rxvt-unicode fails to properly check input length.

### Impact

Successful exploitation would allow an attacker to execute
arbitrary code with the permissions of the user running rxvt-unicode.

### Workaround

There is no known workaround at this time.

### Resolution

All rxvt-unicode users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=x11-terms/rxvt-unicode-5.3"
```
### References

* [CAN-2005-0764](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CAN-2005-0764)

**Release date**

March 20, 2005

**Latest revision**

March 20, 2005: 01

**Severity**

normal

**Exploitable**

remote

**Bugzilla entries**

* [84680](https://bugs.gentoo.org/show_bug.cgi?id=84680)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from bugs.gentoo.org_50ad0e9d_20250125_072502.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla – Bug 84680
x11-terms/rxvt-unicode buffer overflow (CAN-2005-0764)
Last modified: 2005-03-20 12:14:35 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=84680&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=84680&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 84680**](show_bug.cgi?id=84680)
- x11-terms/rxvt-unicode buffer overflow (CAN-2005-0764)

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
x11-terms/rxvt-unicode buffer overflow (CAN-2005-0764)

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Security | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Security "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Vulnerabilities ([show other bugs](buglist.cgi?component=Vulnerabilities&product=Gentoo%20Security&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | High normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Gentoo Security | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") | B2 [glsa] jaervosz | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [82737](show_bug.cgi?id=82737 "VERIFIED WONTFIX - rxvt-unicode 5.2 dropped ~mips") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | Show dependency [tree](showdependencytree.cgi?id=84680&hide_resolved=1) | |  | | Reported: | 2005-03-09 16:30 UTC by rob holland (RETIRED) | | --- | --- | | Modified: | 2005-03-20 12:14 UTC ([History](show_activity.cgi?id=84680)) | | CC List: | 3 users (show)  ciaran.mccreesh latexer usata | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=84680&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=84680&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  rob holland (RETIRED)   gentoo-dev  2005-03-09 16:30:24 UTC  ``` a char * overflowable in rxvt with an escape code + text sequence.  doing: $ cat evil_file  Overflows the string buffer in command.C:3539  Should be exploitable fairly easily. You can write whatever you like to 6144 bytes on the stack after the end of the allocated space for the string variable.  Fix is below:  --- command.C.orig	2005-03-10 01:18:28.180103872 +0000 +++ command.C	2005-03-10 01:18:43.840723096 +0000 @@ -3559,7 +3559,7 @@          seen_esc = false;   -      if (n >= sizeof (string) - 1) +      if ((n * sizeof(*string)) >= sizeof (string) - 1)          // stop at some sane length          return NULL;  Every version we carry is vulnerable.  $ perl -e 'print "^[P" . ("x" x 5000)' > /tmp/evil_file $ cat /tmp/evil_file  gotta sleep now so haven't looked into this/thought about consequences as much as I might. will look at it again tomorrow. ```  [Comment 1](#c1)  rob holland (RETIRED)   gentoo-dev  2005-03-10 02:07:55 UTC  ``` taviso pointed out that I was on drugs (well, very tired) and that not very version we carry is vulnerable. The problem exists in the ebuilded versions for 4.8 and higher, no stable versions are affected. The patch is against 4.7 but should apply happily to other versions (probably with an offset).  This is a shiney new version of the fix which should perform better (every time a esc+P is received...woo-hoo...) and also avoids the chance of integer promotion problems by fixing up the type of n.  Fix was discussed/developed with help from Yoann Vandoorselaere. Any bugs are mine.  rob@leet /tmp/rxvt-unicode-4.7/src $ diff -u command.C command.C.new  --- command.C	2004-12-29 19:09:31.000000000 +0000 +++ command.C.new	2005-03-10 10:53:09.696945440 +0000 @@ -3535,7 +3535,7 @@  {    unicode_t ch;    bool seen_esc = false; -  unsigned int n = 0; +  size_t n = 0;    wchar_t string[STRING_MAX];      while ((ch = cmd_getc ()) != NOCHAR) @@ -3559,7 +3559,7 @@          seen_esc = false;   -      if (n >= sizeof (string) - 1) +      if (n >= (sizeof (string) / sizeof(*string)))          // stop at some sane length          return NULL;  ```  [Comment 2](#c2)  Tavis Ormandy (RETIRED)   gentoo-dev  2005-03-10 02:15:53 UTC  ``` confirmed in >=4.8, that patch fixes the issue here.  Current stable version is unaffected.   Good catch Rob :) ```  [Comment 3](#c3)  rob holland (RETIRED)   gentoo-dev  2005-03-10 04:37:55 UTC  ``` emailed upstream and cc'd security@g.o ```  [Comment 4](#c4)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-03-10 11:07:23 UTC  ``` Thx Rob.  Mamoru please fix unstable versions if upstream does not release a fixed version soon. ```  [Comment 5](#c5)  Mamoru KOMACHI (RETIRED)   gentoo-dev  2005-03-13 03:43:59 UTC  ``` (Sorry I'm now in Taiwan and replying late) I'm not maintaining x11-terms/rxvt-unicode but x11-terms/rxvt. latexer: could you have a look at it? thanks. ```  [Comment 6](#c6)  rob holland (RETIRED)   gentoo-dev  2005-03-13 05:15:59 UTC  ``` upstream are releasing a fixed version after cebit :) ```  [Comment 7](#c7)  rob holland (RETIRED)   gentoo-dev  2005-03-13 05:29:02 UTC  ``` My patch mistakenly drops something it shouldn't. Corrected path below:  rob@leet /tmp/rxvt-unicode-4.7/src $ diff -u command.C command.C.new  --- command.C	2004-12-29 19:09:31.000000000 +0000 +++ command.C.new	2005-03-10 10:53:09.696945440 +0000 @@ -3535,7 +3535,7 @@  {    unicode_t ch;    bool seen_esc = false; -  unsigned int n = 0; +  size_t n = 0;    wchar_t string[STRING_MAX];      while ((ch = cmd_getc ()) != NOCHAR) @@ -3559,7 +3559,7 @@          seen_esc = false;   -      if (n >= sizeof (string) - 1) +      if (n >= ((sizeof (string) / sizeof(*string)) - 1))          // stop at some sane length          return NULL;  Upstream pointed this out, so they are aware ;) ```  [Comment 8](#c8)  Ciaran McCreesh    2005-03-14 07:41:48 UTC  ``` I added 5.3 to the tree, which should contain the fixes. KEYWORDS are ~x86 ~sparc ~amd64 ~ppc. Note that ~mips is stuck at 5.1 pending [bug #82737](show_bug.cgi?id=82737 "VERIFIED WONTFIX - rxvt-unicode 5.2 dropped ~mips") (just a use.mask). ```  [Comment 9](#c9)  Thierry Carrez (RETIRED)   gentoo-dev  2005-03-15 06:51:39 UTC  ``` Release public @ <http://dist.schmorp.de/rxvt-unicode/Changes> 4.8 is affected and stable on ppc so it's not ~, we need a GLSA.  ppc: please test and mark x11-terms/rxvt-unicode-5.3 stable ```  [Comment 10](#c10)  Jochen Maes (RETIRED)   gentoo-dev  2005-03-15 08:12:45 UTC  ``` stable on ppc  ```  [Comment 11](#c11)  Luke Macken (RETIRED)   gentoo-dev  2005-03-15 15:51:06 UTC  ``` Ready for GLSA. ```  [Comment 12](#c12)  Thierry Carrez (RETIRED)   gentoo-dev  2005-03-18 00:40:07 UTC  ``` This is CAN-2005-0764 ```  [Comment 13](#c13)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-03-20 08:53:47 UTC  ``` GLSA drafted. The CVE id apparently is not reserved yet. ```  [Comment 14](#c14)  Sune Kloppenborg Jeppesen (RETIRED)   gentoo-dev  2005-03-20 12:14:35 UTC  ``` GLSA 200503-23 ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=84680)
* - [XML](show_bug.cgi?ctype=xml&id=84680)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=84680)
* - [Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=84680&product=Gentoo%20Security)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)–[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=84680&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=84680&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


