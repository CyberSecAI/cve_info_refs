=== Content from bugzilla.mozilla.org_1a842e3f_20250124_233441.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/311657)
* [XML](/show_bug.cgi?ctype=xml&id=311657)

Closed
[Bug 311657](/show_bug.cgi?id=311657)

Opened 19 years ago
Closed 18 years ago

# Don't fall back to insecure authentication after SMTP auth failure

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Don't fall back to insecure authentication after SMTP auth failure

## Categories

### (MailNews Core :: Networking: SMTP, enhancement)

[Product:](/describecomponents.cgi?product=MailNews%20Core)

MailNews Core
▾

MailNews Core
Mail and news components common to Thunderbird and SeaMonkey
[See Open Bugs in This Product](/buglist.cgi?product=MailNews%20Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=MailNews%20Core)
Watch This Product

[Component:](/describecomponents.cgi?product=MailNews%20Core&component=Networking%3A%20SMTP#Networking%3A%20SMTP)

Networking: SMTP
▾

MailNews Core :: Networking: SMTP
Problems with sending mail. If you have specific problems with
the compose window, you should choose the "Composition" component from the list.
[See Open Bugs in This Component](/buglist.cgi?product=MailNews%20Core&component=Networking%3A%20SMTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=MailNews%20Core&component=Networking%3A%20SMTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=MailNews%20Core&component=Networking%3A%20SMTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

enhancement

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

## Tracking

### (Not tracked)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9alpha7

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| relnote-thunderbird |  | --- |
| seamonkey2.53 | --- | --- |
| seamonkey2.57esr | --- | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| thunderbird133 | --- | --- |
| thunderbird134 | --- | --- |
| thunderbird135 | --- | --- |
| thunderbird136 | --- | --- |

## People

### (Reporter: thenlich+bugmoz, Assigned: ch.ey)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/bf1bcc6bb5ae141ffc17e081ae099287?d=mm&size=40)  [ch.ey](/user_profile?user_id=31357)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0b40ec03f7ea9e7d69f1cc10dc18af29?d=mm&size=40)  [thenlich+bugmoz](/user_profile?user_id=191487)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### (Depends on 1 open bug)

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[418945](/show_bug.cgi?id=418945 "UNCONFIRMED - SMTP AUTH not supported: behavior changed unacceptably"), [440712](/show_bug.cgi?id=440712 "VERIFIED FIXED - In <smtpEditOverlay.js>, \"Warning: assignment to undeclared variable gSmtpUseSecAuth\"")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=311657&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=311657)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[387411](/show_bug.cgi?id=387411 "RESOLVED DUPLICATE - can't send e-mail - fails \"unable to authenticate to SMTP server. The server does not support any compatible insecure authentication mechanism but you have chosen insecure authentication.\"")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[launchpad.net/bugs/24220](https://launchpad.net/bugs/24220 "https://launchpad.net/bugs/24220")

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

1

Bug Flags:

|  | wanted-thunderbird |  |
| --- | --- | --- |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 5 obsolete files)

| [proposed patch](/attachment.cgi?id=250451)  [18 years ago](#c9)  [Christian Eyrich](/user_profile?user_id=31357)   28.41 KB, patch |  | [Details](/attachment.cgi?id=250451&action=edit) | [Diff](/attachment.cgi?id=250451&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=250451) |
| --- | --- | --- |
| [patch v2](/attachment.cgi?id=250459)  [18 years ago](#c11)  [Christian Eyrich](/user_profile?user_id=31357)   29.34 KB, patch |  | [Details](/attachment.cgi?id=250459&action=edit) | [Diff](/attachment.cgi?id=250459&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=250459) |
| [non-bit-rotted patch](/attachment.cgi?id=269387)  [18 years ago](#c15)  [David :Bienvenu](/user_profile?user_id=4410)   44.30 KB, patch |  | [Details](/attachment.cgi?id=269387&action=edit) | [Diff](/attachment.cgi?id=269387&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269387) |
| [patch v3 with autoprobe](/attachment.cgi?id=269413)  [18 years ago](#c18)  [Christian Eyrich](/user_profile?user_id=31357)   31.68 KB, patch | Bienvenu : [review+](#c21 "18 years ago")  mscott : [superreview+](#a54615296_93208 "18 years ago") | [Details](/attachment.cgi?id=269413&action=edit) | [Diff](/attachment.cgi?id=269413&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269413) |
| [smtp log](/attachment.cgi?id=271344)  [18 years ago](#c27)  [Joe Sabash [:JoeS1]](/user_profile?user_id=98534)   1.33 KB, text/plain |  | [Details](/attachment.cgi?id=271344&action=edit) |
| [patch to address STARTTLS flaw and migrate "STARTTLS if available"](/attachment.cgi?id=271575)  [18 years ago](#c36)  [Christian Eyrich](/user_profile?user_id=31357)   18.26 KB, patch |  | [Details](/attachment.cgi?id=271575&action=edit) | [Diff](/attachment.cgi?id=271575&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271575) |
| [smtp log](/attachment.cgi?id=271709)  [18 years ago](#c44)  [Magnus Melin [:mkmelin]](/user_profile?user_id=101158)   1.34 KB, text/plain |  | [Details](/attachment.cgi?id=271709&action=edit) |
| [patch to address STARTTLS flaw](/attachment.cgi?id=271816)  [18 years ago](#c49)  [Christian Eyrich](/user_profile?user_id=31357)   18.69 KB, patch | Bienvenu : [review+](#c50 "18 years ago") | [Details](/attachment.cgi?id=271816&action=edit) | [Diff](/attachment.cgi?id=271816&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271816) |
| [[checked in]another try](/attachment.cgi?id=271867)  [18 years ago](#c55)  [Christian Eyrich](/user_profile?user_id=31357)   18.02 KB, patch | Bienvenu : [review+](#c56 "18 years ago")  mscott : [superreview+](#c57 "18 years ago") | [Details](/attachment.cgi?id=271867&action=edit) | [Diff](/attachment.cgi?id=271867&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271867) |
| [SMTP log for failing STARTTLS](/attachment.cgi?id=278592)  [17 years ago](#c63)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   2.99 KB, text/plain |  | [Details](/attachment.cgi?id=278592&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Thomas Henlich](/user_profile?user_id=191487)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=311657#c0)• 19 years ago |
|  | |

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; de-DE; rv:1.7.12) Gecko/20050919 Firefox/1.0.7
Build Identifier: Thunderbird 1.0.6
In short: Basically the same as [Bug 225809](/show_bug.cgi?id=225809 "RESOLVED FIXED - Don't fall back to insecure authentication if \"use secure authentication\" is checked"), only for SMTP.
If secure (e.g. CRAM-MD5) authentication is advertised by the server, mozilla
tries to authenticate using CRAM-MD5, and if it fails it falls back to the
insecure LOGIN or PLAIN methods, sending the plaintext password.
This can happen, for example, if the server is having problems, or if the user
mistypes the password or due to a man-in-the-middle-attack. In all these cases
retrying with plaintext authentication will not help and using it defeats the
purpose of secure authentication, which is to avoid sending the password over
the wire.
Solution 1: Add a user preference "Never send unencrypted passwords", which
completely disables LOGIN and PLAIN authentication for non-SSL connections.
Solution 2: Add a user preference of authentication to be used, which defaults
to Auto (try all auth methods supported by the server). [Probably too technical
for most users]
Reproducible: Always
Steps to Reproduce:
Provoke CRAM-MD5 authentication failure by mistyping password.
Actual Results:
Password is transmitted unencrypted using PLAIN or LOGIN.
Expected Results:
Password should not be transmitted unencrypted (subject to user preference).

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=311657#c1)• 19 years ago |
|  | |

That's right and it is by design. It's not the best solution but I did it (in
[bug 203785](/show_bug.cgi?id=203785 "RESOLVED FIXED - Can't send mails: already authenticated")) because servers where CRAM-MD5 authentication fails are widespread
and users would have to often switch the options.
For SMTP there is no switch "Use secure authentication" in the UI and in the
backend it's honestly named "trySecAuth". So TB/SM don't pretend to only use
secure mechanisms for SMTP in any situation.

|  | [Thomas Henlich](/user_profile?user_id=191487)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=311657#c2)• 19 years ago |
|  | |

Sorry, if I was not clear enough: The fallback behaviour is not a bug and should
be left as is. My request for enhancement was to add an option to override this
(security critical) fallback behavior.

|  | [Jo Hermans](/user_profile?user_id=29552) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=311657#c3)• 19 years ago |
|  | |

mentioned on Bugtraq : <<http://www.securityfocus.com/archive/1/414556/30/0/threaded>>

|  | [Thomas Henlich](/user_profile?user_id=191487)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=311657#c4)• 19 years ago |
|  | |

It seems to me that the solution could be as simple as adding an option "m\_prefTryInsecAuth" which does a similar thing like "m\_prefTrySecAuth" for the secure mechanisms: disable PLAIN and LOGIN if it is set to false.
Anyone test this?

|  | [John Navas](/user_profile?user_id=113279) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=311657#c5)• 19 years ago |
|  | |

To me this seems to be Much Ado About Nothing (with apologies to WS). In my tests, with either "TLS" and "SSL" for "Use secure connection", Thunderbird establishes a secure connection \*before\* attempting authentication, thus obviating all of the four scenarios. There's only a risk if the user chooses "No" or "TLS, if available" for "Use secure connection", which are valid user choices (whether we approve or disapprove).

|  | [Thomas Henlich](/user_profile?user_id=191487)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=311657#c6)• 19 years ago |
|  | |

Reply to [comment #5](/show_bug.cgi?id=311657#c5 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"):
The bug with CRAM-MD5 mostly concerns connections to servers that do not speak SSL/TLS. Of course you are right, if the connection itself is encrypted, it does not matter much if the authentication itself is CRAM-MD5, PLAIN or LOGIN.

|  | [Mike Cowperthwaite](/user_profile?user_id=57902) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=311657#c7)• 18 years ago |
|  | |

Confirming as RFE per reporter's [comment 2](/show_bug.cgi?id=311657#c2 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"). Severity: normal → enhancementStatus: UNCONFIRMED → NEWEver confirmed: trueOS: Windows XP → AllHardware: PC → All

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=311657#c8)• 18 years ago |
|  | |

I've a patch that changes behaviour to that of POP and IMAP, that is either secure or insecure (using a new pref useSecAuth [but also introducing an UI] replacing the current trySecAuth).
That would give us a consistent behaviour for all protocols. Would that be ok for you?

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=311657#c9)• 18 years ago |
|  | |

Attached patch

[proposed patch](attachment.cgi?id=250451&action=diff) (obsolete)
— [Details](attachment.cgi?id=250451&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=250451)

Patch to replace trySecAuth by useSecAuth like for POP3 and IMAP including UI.Assignee: nobody → ch.eyStatus: NEW → ASSIGNED
[Attachment #250451](/attachment.cgi?id=250451&action=edit "proposed patch") -
Flags: review?(bienvenu)

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=311657#c10)• 18 years ago |
|  | |

Comment on [attachment 250451](/attachment.cgi?id=250451 "proposed patch") [[details]](/attachment.cgi?id=250451&action=edit "proposed patch") [[diff]](/attachment.cgi?id=250451&action=diff "proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=250451)
proposed patch
No, sorry that's not good.
[Attachment #250451](/attachment.cgi?id=250451&action=edit "proposed patch") -
Attachment is obsolete: true
[Attachment #250451](/attachment.cgi?id=250451&action=edit "proposed patch") -
Flags: review?(bienvenu)

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=311657#c11)• 18 years ago |
|  | |

Attached patch

[patch v2](attachment.cgi?id=250459&action=diff) (obsolete)
— [Details](attachment.cgi?id=250459&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=250459)

Another try.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=311657#c12)• 18 years ago |
|  | |

this patch looks good, thx, Christian, but it's going to take me a while before I can try this out on the trunk (it's not intended for the 2.0 branch, which is my highest priority right now)

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=311657#c13)• 18 years ago |
|  | |

David, TB 2.0 is out, maybe you want it try out now?

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=311657#c14)• 18 years ago |
|  | |

thx for the reminder, Christian. I had forgotten. I think first I need to deal with the other patch about adding the recipient to the smtp error messages, and land that, before I apply your patch, since they both change the same files.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=311657#c15)• 18 years ago |
|  | |

Attached patch

[non-bit-rotted patch](attachment.cgi?id=269387&action=diff) (obsolete)
— [Details](attachment.cgi?id=269387&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269387)

Christian, I've applied your patch, un-bit-rotted it, and tweaked the error strings a bit. One question - Is my understanding of this patch correct? It makes SMTP compatible with IMAP/POP3 - we'll only try secure auth if the user has chosen it explicitly, and the pref defaults to false. But before this patch, we would try secure auth always (unless the user explicitly set a hidden pref not to) and then fall back to insecure auth. So for some existing users, on upgrade, we will silently switch to insecure auth? That seems bad.
If all that's correct, what do you think about something like this: try using secure auth once, if available. If that works, automatically set the pref to use secure auth; if it doesn't work, don't put up an error message on the failure, and set a pref not to try this again for this server. Possibly, you could use the existing try secure auth pref for this purpose.
We really want to go to a place where, on new server/account setup, we automatically try to figure out the most secure settings (TLS/SSL, etc) and secure auth automatically, and allow the user to change them later. This would b e a step in that direction.
[Attachment #250459](/attachment.cgi?id=250459&action=edit "patch v2") -
Attachment is obsolete: true

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=311657#c16)• 18 years ago |
|  | |

You're right in your understanding of the code. And yes, it will mean that some users will now authenticate insecure instead of secure. But I don't think that matters because of the reason this bug exists: it's insecure anyway.
So I don't see a security problem. And honestly I don't like having code lying around to be used only once if it's not really necessary.
BTW, I've done a up-to-date patch yesterday and can provide that for the further work.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=311657#c17)• 18 years ago |
|  | |

> But I don't think that matters because of the reason this bug exists: it's
> insecure anyway.
Not sure I understand that. For a user who's had secure auth working just fine, because they've got a correctly functioning server, using insecure auth is \*less\* secure. Yes, secure auth is not completely secure, but it's more secure.
Some of the code would not be one time only - if we make new server setup be smart enough to try secure auth and set the secure auth pref if it succeeds, and silently fail if it fails, and clear the secure auth pref, then that would share code with this.
With your up to date patch, could you make sure you change the strings that say "you choose" to "you have chosen" like I did in my patch?

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=311657#c18)• 18 years ago |
|  | |

Attached patch

[patch v3 with autoprobe](attachment.cgi?id=269413&action=diff)
— [Details](attachment.cgi?id=269413&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269413)

What I meant is that it's possible to suppress/filter the usage of secure ones (on a malicous server, a man in the middle or some program on your client). This won't be detected and the password revealed by using insecure ones.
Hm yes, you're right in that it is secure enough if one has only the ability to sniff but not actively communicate.
So here's my proposal how I understand it.
Additionally we could switch trySecAuth off for one server when the use Secure Authentication is switched in the UI.
Regarding probing the servers abilities you mentioned in [comment 15](/show_bug.cgi?id=311657#c15 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"). Are there written plans on this?
In general, having the option would be nice, but only if the user either is noticed to review the settings taken or if it's triggered by himself.
I adjusted the strings.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=311657#c19)• 18 years ago |
|  | |

very cool, thx. Yes, I meant the simple sniffing case.
Re probing the server's abilities, I don't know if there's anything explicitly written about it, but easier account setup is a big priority - [http://wiki.mozilla.org/Thunderbird:Easy\_Account\_Setup](http://wiki.mozilla.org/Thunderbird%3AEasy_Account_Setup)
If you look at mail.app, it tries to figure out if it should connect on the SSL port, or use TLS, or not, when you go through new account setup. We want to do something like that at least. And the automatic detection of secure auth capabilities and success using secure auth that you've added goes hand in hand with that.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=311657#c20)• 18 years ago |
|  | |

Comment on [attachment 269413](/attachment.cgi?id=269413 "patch v3 with autoprobe") [[details]](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") [[diff]](/attachment.cgi?id=269413&action=diff "patch v3 with autoprobe") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269413)
patch v3 with autoprobe
Let's see if this is really good.
[Attachment #269413](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") -
Flags: review?(bienvenu)

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=311657#c21)• 18 years ago |
|  | |

Comment on [attachment 269413](/attachment.cgi?id=269413 "patch v3 with autoprobe") [[details]](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") [[diff]](/attachment.cgi?id=269413&action=diff "patch v3 with autoprobe") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269413)
patch v3 with autoprobe
Looks good, thx, Christian. I don't have an smtp server that supports secure auth (and my ISP prevents me from using an other smtp server), but my insecure auth server kept working fine
[Attachment #269413](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") -
Flags: superreview?(mscott)
[Attachment #269413](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") -
Flags: review?(bienvenu)
[Attachment #269413](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") -
Flags: review+

|  | [Scott MacGregor](/user_profile?user_id=93208) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a54615296_93208)• 18 years ago |

[Attachment #269413](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") -
Flags: superreview?(mscott) → superreview+

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=311657#c22)• 18 years ago |
|  | |

fixed on trunk, thx, Christian.
It would be interesting to do similar auto-probing for imap and pop3, especially in conjunction with auto-discovery of SSL vs. normal port, and TLS, during account creation. I think I'd want to do it at account creation time, and probably set a flag on the url that says we're doing discovery, so we'd skip putting up error messages, and we'd remember if we connected via ssl or normal port, whether the server advertised secure auth, and/or TLS.Status: ASSIGNED → RESOLVEDClosed: 18 years agoResolution: --- → FIXED

|  | [Steffen Wilberg](/user_profile?user_id=94421) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=311657#c23)• 18 years ago |
|  | |

(In reply to [comment #21](/show_bug.cgi?id=311657#c21 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"))
> (From update of [attachment 269413](/attachment.cgi?id=269413 "patch v3 with autoprobe") [[details]](/attachment.cgi?id=269413&action=edit "patch v3 with autoprobe") [[diff]](/attachment.cgi?id=269413&action=diff "patch v3 with autoprobe") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=269413))
> I don't have an smtp server that supports secure auth
ugh.
> (and my ISP prevents me from using an other smtp server)
Whoah. And it probably doesn't support IMAP idle, or IMAP subfolders, or searching. I bet they only introduced IMAP recently. How much do they pay you to stay with them? You should probably switch to a webmailer.
No, just kidding, couldn't resist.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=311657#c24)• 18 years ago |
|  | |

I don't use my ISP for mail, just a connection to the internet - but they block the smtp port for any server but their own, for the obvious reason...

|  | [Joe Sabash [:JoeS1]](/user_profile?user_id=98534) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=311657#c25)• 18 years ago |
|  | |

I use an insecure pop3 server for email, and it's no longer working for me.
After d/l tinderbox zip build Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9a7pre) Gecko/2007070512 Thunderbird/3.0a1pre ID:2007070512
I get ..Sending message failed..Unable to authenticate to server ..blah blah
The time stamp on the Thunderbird exe is:
Today, July 05, 2007, 12:59:46 PM
Not really sure if this checkin made it in there.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=311657#c26)• 18 years ago |
|  | |

Since you mention "sending message failed" I guess you mean SMTP server, not POP3 server, yes?
Please have a look if "use secure Authentication" is set for your smtp server or a pref useSecAuth is set for any account (or default) to true in your configuration (Config Editor or prefs.js). If yes, switch it off and try again.
I can think of a potential problem with servers that advertise secure auth but fail with it when actually using it. Before this patch we then simply fall back to unsecure but now stop.
But maybe it's something else.
In any case I'd be interested in a smtp log following the instructions in <http://www.mozilla.org/quality/mailnews/mail-troubleshoot.html#smtp> and add an attachment for this bug.

|  | [Joe Sabash [:JoeS1]](/user_profile?user_id=98534) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=311657#c27)• 18 years ago |
|  | |

Attached file
[smtp log](attachment.cgi?id=271344)
— [Details](attachment.cgi?id=271344&action=edit)

failure to authenticate

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=311657#c28)• 18 years ago |
|  | |

Thanks for the log. Doesn't look your server supports any authentication mechanism, therefore our behaviour is the right one.
But before the latest patch it was wrong since we did send the message without authentication though user told us to use authentication (checkbox "Use name and password").
That means checking is now more strictly and you've to disable above option to continue.

|  | [Joe Sabash [:JoeS1]](/user_profile?user_id=98534) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=311657#c29)• 18 years ago |
|  | |

You are absolutely correct. I changed isp's about 4 years ago.
I'm sure the new "correct" behavior will catch others.
Thanks for the attention to my "problem"

|  | [J. Lance Cotton](/user_profile?user_id=109248) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=311657#c30)• 18 years ago |
|  | |

This patch appears to cause problems for me.
My server supports the SMTP submission port (587) for MUA-sourced mail. Authentication is required to send messages, and the AUTH methods supported is only displayed \*after\* STARTTLS succeeds in establishing a secure connection. My SMTP server advertises PLAIN/LOGIN after STARTTLS succeeds.
What appears to be happening is that TB is seeing no AUTH methods initially (before STARTTLS) and telling me that "The server does not support any compatible insecure authentication mechanism but you haven chosen insecure authentication."
Does this patch check available methods \*before\* or \*after\* a (user-enabled) STARTTLS secure connection is established?

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=311657#c31)• 18 years ago |
|  | |

Thanks Joseph for that clear report and your suspicion is also correct.
The check is performed upon receiving the first EHLO response. But it should be done based on the EHLO right before login which might be the second one.
I'll see what it takes to solve this.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=311657#c32)• 18 years ago |
|  | |

Looking for a solution I found an inconsistency to the new authentication behaviour. A server implementing only HELO would make Mozilla not forcing authentication even if the user checked it.
BTW, the reason for wanting to do so can be seen as "getting what you set", but that's not the main reason.
It would not be a problem for most cases if the user choses to authenticate but the server doesn't demand it. That's because the reason authenticating is that the server can be sure on our identity, nothing else. But some mechanisms also provide ability for the client to check the identity of the server. In these cases bypassing authentication would be a potential security risk.
Talking about security, I see how to repair the new problem of no AUTH before STARTTLS. But it would be easier and in my opinion cleaner to solve if STARTTLS would have only the alternatives fail or succeed.
That means if we would drop the "STARTTLS, if available" option. In my opinion this is more a pretender than a provider of security anyway.
Any other opinions?Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=311657#c33)• 18 years ago |
|  | |

I don't remember exactly why we have "STARTTLS if available". It started in Netscape 4.5, iirc. One possibility is that the user may not know if they have STARTTLS, and "if available" is a reasonable default. But I don't think we made it the default, perhaps because back then some servers didn't implement it correctly.
So I have no problem getting rid of it, except that we'd have to upgrade users who have it selected to the appropriate setting, based on whether the server supports it.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=311657#c34)• 18 years ago |
|  | |

You're right, that's something I always forget about.
If I'd remove that option in the UI, none of the remaining options would be selected until sending the first message. At least if not a server probing function will run right after application start.
No, I think we've stick with it. Or do I again ignore something?

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=311657#c35)• 18 years ago |
|  | |

I'm curious if Nelson has any insight into the "STARTTLS if available" option, in particular if it has any value over auto-probing. Do servers ever go back and forth between supporting STARTTLS and not? My guess is that users don't know, and that's a safe option to pick.
If you remove the option from the UI, most people would never notice, until after they'd tried to send mail. Perhaps we could only show that option if it was the currently selected option, but once the user sends mail, we set the choice to STARTTLS if it was available, and not, if it wasn't.
I notice Eudora has "STARTTLS if available" as an option as well.
Re your other questions, for offline, for Windows and Linux, we'll know if we're offline, because of auto-detect, and we just have to handle it gracefully, probably by letting the user figure it out, which partly answers your other question, yes, I think we should let the user change the settings. Having the UI be simpler would be nice, but I think the user does have to have control over these settings - whether that happens in the account wizard, as opposed to the account settings dialog, I'm not sure. In general, we can get away with the account wizard having less choices, but we always get complaints.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=311657#c36)• 18 years ago |
|  | |

Attached patch

[patch to address STARTTLS flaw and migrate "STARTTLS if available"](attachment.cgi?id=271575&action=diff) (obsolete)
— [Details](attachment.cgi?id=271575&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271575)

This patch addresses the problem reported in [comment 30](/show_bug.cgi?id=311657#c30 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure") by moving the test into ProcessAuth(). That's not that great but shouldn't (and doesn't as far as I tested) cause problems.
It also implements a smooth migration away from "STARTTLS if available". The UI problme I wrote about in [comment 34](/show_bug.cgi?id=311657#c34 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure") is mitigated by only displaying the option if selected.
Does this look like a way to go?
[Attachment #269387](/attachment.cgi?id=269387&action=edit "non-bit-rotted patch") -
Attachment is obsolete: true

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=311657#c37)• 18 years ago |
|  | |

wow, that was fast! But what happens when the user adds an smtp server? We're not auto-probing for STARTTLS yet, are we?

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=311657#c38)• 18 years ago |
|  | |

Not fast, I was working on that for longer. We just had the same idea. But you're right again on the new server thing - I hope it's only because it's late in the night ...
Let's hear if Nelson finds a new aspect before I'll post a new patch.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=311657#c39)• 18 years ago |
|  | |

AFAIK, "StartTLS if available" is there for the user who simply doesn't
know if his server supports it or not, but wants to use it if so.
It simply is more convenient that forcing the user to set startTLS,
try it, and then set something else if that doesn't work.
That pref setting isn't very secure, because it's not difficult for an
attacker to fool the client into believing that the server does not
support StartTLS, even when it does. So, a better name might be
"StartTLS unless I'm being MITMed" :)
I think a reasonable way to implement StartTLS-if-available is to have
the network code change it after the first successful authentication.
If StartTLS worked, then change the pref from "StartTLS-if-available"
to "StartTLS always". If StartTLS didn't work, then change the pref to
"No TLS" (or whatever it is called). It then becomes a one-shot setting,
and means "probe to see if StartTLS works, and permanently select it if so."
I'd suggest you do that, and leave it in the UI. Let users set that pref,
if they don't know, but change the pref once the answer is known.
If you take that choice away (from the UI), users will complain. I hate it
when a product that I've been using for years is changed in a way that
removes functionality that (I think) I depend on, and I'll bet other users
feel that way too. But it doesn't have to remain the insecure implementation
that it has now. That's my $0.02

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=311657#c40)• 18 years ago |
|  | |

Thanks for your opinion. You're right in that removing UI elements is a ticklish issue. We can't only add stuff though but must also be able to remove something if it seems wrong or no good. Opinions will vary if that option is such one.
I expect that using that radio button as probe setting will make people cry about "Thunderbird can't hold my setting".
So ok, because we have varying opinions I'll leave it as it currently is. Since I still think it's time for changing it and you mentioned probing, wouldn't be [bug 387421](/show_bug.cgi?id=387421 "RESOLVED DUPLICATE - probe mail server abilities on account creation (auto-detect SSL/TLS)") or [bug 185631](/show_bug.cgi?id=185631 "RESOLVED FIXED - Auto-detection of SSL Support") respectively be the right place do discuss this?

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=311657#c41)• 18 years ago |
|  | |

I agree in general that removing UI settings can be frustrating, but I think in this case we'd be figuring it out automatically for the user, which is better...I'd prefer to automatically probe instead of having a temporary probe setting. But it sounds like since the backend probably has to support the "STARTTLS if available" setting anyway, not removing the UI is an option.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=311657#c43)• 18 years ago |
|  | |

Roman, Wayne your problems can be caused by the same combination of events like J. Lance's though I'm a bit surprised that much servers work that way. I'd like to be sure.
So would you please have a look if what's happening is the same as described in [comment 30](/show_bug.cgi?id=311657#c30 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure")? Creating a log (see [comment 26](/show_bug.cgi?id=311657#c26 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure")) for you can help there. Does switching off Secure Connection help?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=311657#c44)• 18 years ago |
|  | |

Attached file
[smtp log](attachment.cgi?id=271709)
— [Details](attachment.cgi?id=271709&action=edit)

I can't send mail with todays and yesterdays trunk build. It doesn't support TLS, and I didn't change the setting I had (no TLS).
FWIW, I think dropping the "TLS, if available"-UI wouldn't hurt. I base that on the guess that few users are using it since I doubt users put in much other info than what they get from their ISP, who I feel is not likely to give that option but say what they actually support.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=311657#c45)• 18 years ago |
|  | |

Magnus, your case is the same as Joe's, i.e. your server doesn't offer any mechanism to authenticate. So just disable authentication (uncheck "Use Name and Password").
What do you think should TB say in the alert to give users an idea how to solve the problem themselves?
And thanks for your opinion on "TLS, if available".

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=311657#c46)• 18 years ago |
|  | |

Perhaps we can change that error message into an error message and an offer to switch the user to non-authenticated logon, i.e., uncheck that setting for them, if the user says "Yes" instead of No. This might be relatively common when users upgrade to 3.0...

|  | [Caio Tiago Oliveira (asrail)](/user_profile?user_id=134051) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=311657#c47)• 18 years ago |
|  | |

With gmail I can't send emails with STARTTLS, without STARTTLS, with secure authentication, whtout secure authentication, without authentication...
it started on the July 5th build.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=311657#c48)• 18 years ago |
|  | |

Asrail, gmail behaves like J. Lance's (and Wayne's as I now know) server. It demands on STARTTLS but doesn't give AUTH without.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=311657#c49)• 18 years ago |
|  | |

Attached patch

[patch to address STARTTLS flaw](attachment.cgi?id=271816&action=diff)  (obsolete)
— [Details](attachment.cgi?id=271816&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271816)

I just thought removing that STARTTLS-UI-option could be done casually. But priority should be to get auth with STARTTLS working for the users again.
This patch does this for the cases were the server doesn't give any (compatible) mechanisms before STARTTLS is active.
It also adds new text if the server doesn't advertise AUTH at all and gives hints in the other two cases. I think they're descriptive and bring users on the right way.
[Attachment #271575](/attachment.cgi?id=271575&action=edit "patch to address STARTTLS flaw and migrate \"STARTTLS if available\"") -
Attachment is obsolete: true
[Attachment #271816](/attachment.cgi?id=271816&action=edit "patch to address STARTTLS flaw ") -
Flags: review?(bienvenu)

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=311657#c50)• 18 years ago |
|  | |

Comment on [attachment 271816](/attachment.cgi?id=271816 "patch to address STARTTLS flaw") [[details]](/attachment.cgi?id=271816&action=edit "patch to address STARTTLS flaw") [[diff]](/attachment.cgi?id=271816&action=diff "patch to address STARTTLS flaw") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271816)
patch to address STARTTLS flaw
thx, Christian. I'll give this a try - I think the error messages are a bit technical, however. I'd probably remove the text about EHLO, since that doesn't help the user. Also, I'd want to change the text "Switch off authentication for that server" to say something explicit like "uncheck 'use username and password' in the server settings. But if you're OK with those changes, I can make them myself.
[Attachment #271816](/attachment.cgi?id=271816&action=edit "patch to address STARTTLS flaw ") -
Flags: review?(bienvenu) → review+

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=311657#c51)• 18 years ago |
|  | |

My reasons for naming these technical details is to not only tell the user what's up but also make it easier for supporters (in the community as well as service providers) to get an idea of what goes wrong. In this case it might a little to much though.
What about "An error occurred sending mail: Unable to establish a secure link with SMTP server %S using STARTTLS since it doesn't advertise that feature. Switch off STARTTLS for that server or contact your service provider."? In this case we can merge the two different texts.
I'm ok with the "uncheck" text, but be aware that it's not "username" but "name" in the UI.
And oh, there's a wrong second definition for 12581 in composeMsgs.properties for the suite.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=311657#c52)• 18 years ago |
|  | |

Yes, "doesn't advertise that feature" sounds good, and you're right, it's "Use name and password". Do you want to whip up a quick patch, because the changes are more than just changing the strings?

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=311657#c53)• 18 years ago |
|  | |

The "use name and password" sounds like a bug to me...

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=311657#c54)• 18 years ago |
|  | |

Might be, actually I'd prefer "Authenticate using username and password".

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=311657#c55)• 18 years ago |
|  | |

Attached patch

[[checked in]another try](attachment.cgi?id=271867&action=diff)
— [Details](attachment.cgi?id=271867&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271867)

I additionally noticed that NS\_ERROR\_STARTTLS\_FAILED\_NO\_EHLO wasn't even used in the smtp code. This patch addresses these flaws.
Sorry for that problems, I think I've written better patches before.
[Attachment #271816](/attachment.cgi?id=271816&action=edit "patch to address STARTTLS flaw ") -
Attachment is obsolete: true

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=311657#c56)• 18 years ago |
|  | |

Comment on [attachment 271867](/attachment.cgi?id=271867 "[checked in]another try") [[details]](/attachment.cgi?id=271867&action=edit "[checked in]another try") [[diff]](/attachment.cgi?id=271867&action=diff "[checked in]another try") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271867)
[checked in]another try
no worries, we appreciate you working on this!
I tried the patch, and ran through the various misconfigurations that I could, and it seems to work fine. Assuming this patch is ok with you, I'm going to r= and request sr from Scott.
[Attachment #271867](/attachment.cgi?id=271867&action=edit "[checked in]another try") -
Flags: superreview?(mscott)
[Attachment #271867](/attachment.cgi?id=271867&action=edit "[checked in]another try") -
Flags: review+

|  | [Scott MacGregor](/user_profile?user_id=93208) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=311657#c57)• 18 years ago |
|  | |

Comment on [attachment 271867](/attachment.cgi?id=271867 "[checked in]another try") [[details]](/attachment.cgi?id=271867&action=edit "[checked in]another try") [[diff]](/attachment.cgi?id=271867&action=diff "[checked in]another try") [[review]](/page.cgi?id=splinter.html&ignore=&bug=311657&attachment=271867)
[checked in]another try
how do the alert dialogs look with some of these long error strings we are adding? Does everything get wrapped and look ok?
[Attachment #271867](/attachment.cgi?id=271867&action=edit "[checked in]another try") -
Flags: superreview?(mscott) → superreview+

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=311657#c58)• 18 years ago |
|  | |

Thanks for sr. Yes, they look ok here, I get about 3 lines of text. Less would be better to read but also less informational.

|  | [Jason Bassford](/user_profile?user_id=29263) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a55734852_29263)• 18 years ago |

Blocks: [388153](/show_bug.cgi?id=388153 "RESOLVED INVALID - Outgoing SMTP always fails in latest SeaMonkey builds.")

|  | [Jason Bassford](/user_profile?user_id=29263) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a55735397_29263)• 18 years ago |

No longer blocks: [388153](/show_bug.cgi?id=388153 "RESOLVED INVALID - Outgoing SMTP always fails in latest SeaMonkey builds.")

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a55737028_4410)• 18 years ago |

[Attachment #271867](/attachment.cgi?id=271867&action=edit "[checked in]another try") -
Attachment description: another try → [checked in]another try

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=311657#c59)• 18 years ago |
|  | |

marking fixed, thx, Christian.Status: REOPENED → RESOLVEDClosed: 18 years ago → 18 years agoResolution: --- → FIXED

|  | [Alexander L. Slovesnik](/user_profile?user_id=141745) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=311657#c60)• 18 years ago |
|  | |

>+12581=An error occurred sending mail: Unable to authenticate to SMTP server %S. It does not support authentication (SMPT-AUTH) but you have chosen to use authentication. Uncheck 'Use name and password' for that server or contact your service provider.
That should be SMTP-AUTH, not SMPT-AUTH, right?

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=311657#c61)• 18 years ago |
|  | |

yes, I'm always doing that - I'll clean them up.

|  | [Karsten Düsterloh](/user_profile?user_id=34346) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=311657#c62)• 18 years ago |
|  | |

[Bug 388300](/show_bug.cgi?id=388300 "RESOLVED FIXED - correct \"SMPT\" typos")?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=311657#c63)• 17 years ago |
|  | |

Attached file
[SMTP log for failing STARTTLS](attachment.cgi?id=278592)
— [Details](attachment.cgi?id=278592&action=edit)

So on trunk I get the "no authentication mechanism" error when using STARTTLS. Log is attached. This works in a 2007-01-01 build.
When I try to use SMPT-over-SSL instead of STARTTLS (on port 587, as in the STARTTLS case), the connection just times out and the entire SMTP log is:
-1208243424[896a548]: SMTP Connecting to: outgoing.mit.edu
The server does support secure auth; see <http://web.mit.edu/ist/topics/email/smtpauth/>
Do you want a separate bug on this issue? It's pretty much blocking me sending any e-mail right now, so I'd dearly like to get it fixed.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=311657#c64)• 17 years ago |
|  | |

Interesting data point. If I leave the connection as "STARTTLS" and uncheck "use secure authentication" then things work. So is the problem just that the server doesn't support CRAM-MD5? In that case, why is this happening at all? PLAIN or LOGIN auth over STARTTLS is "secure", right? So checking this box in the UI should not cause failure here.
Put another way, as a user I feel unsafe because I have to uncheck "use secure authentication" to connect to this server. Is this feeling justified? If not, then we have a bug.

|  | [David :Bienvenu](/user_profile?user_id=4410) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=311657#c65)• 17 years ago |
|  | |

Christian can chime in, but PLAIN and LOGIN aren't considered secure authentication mechanisms (I believe secure refers to the authentication mechanism, not the underlying channel).
It's not just CRAM-MD5 - there's also NTLM, MSN, and GSSAPI, and probably a couple more that we don't support.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=311657#c66)• 17 years ago |
|  | |

But the user doesn't care whether the "authentication mechanism" is secure. He cares about whether the authentication process is secure. Is PLAIN/LOGIN over TLS secure in the sense that the password is protected? If so, we should treat that situation as secure. And I personally would like to know the answer to this question, still. ;)
If we want to insist that this checkbox just refers to the authentication mechanism, I think the UI needs significant rewording to make it clear exactly what that toggle toggles. Right now it sounds like if you uncheck this checkbox your password is sent in the clear on the wire.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=311657#c67)• 17 years ago |
|  | |

I think the problem is with the phrase "use secure authentication".
The pref that bears that label enables a class of algorithms that use
keyed hashes as a challenge-response protocol. It enables specific
algorithms, but the dumbed-down description is overly broad, so that
users tend to imagine that it includes SSL. It specifies that they are
to be used to the exclusion of "plain text" passwords.
Boris, you seem to be arguing that the pref should be changed to match
the label, rather than the label changed to match the pref.
I think your proposal is equivalent to saying that the pref should mean
"disable the use of plain text password over unencrypted channels".

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=311657#c68)• 17 years ago |
|  | |

You can even argue if CRAM-MD5 is \*really\* secure. Besides of that, the label for the current behaviour really should be "use secure authentication mechanisms".
Besides of that I like what Nelson writes on disabling the use of plain text passwords. That would additionally need some code changes (which shouldn't be hard) and should get filed as a new bug.
On your initial problem, Boris, I currently don't see why it doesn't work for you with "use secure authentication". The server advertises GSSAPI which falls into the secure category. What's the specific error description you get?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=311657#c69)• 17 years ago |
|  | |

> Boris, you seem to be arguing that the pref should be changed to match
> the label, rather than the label changed to match the pref.
Nelson, I'm arguing that what users really care about when doing password auth is that the password is secure from packet-sniffing attacks. So we need to communicate to the user whether this is the case and make it easy to create a setup where this is the case.
One way of doing that is by changing the meaning of the pref as you describe. Another way of doing that is by changing the label to correctly describe what the pref really does and changing other UI to communicate the information the user cares about. I don't really have a preference either way.
Note that I \_still\_ don't know whether using "STARTTLS" with the "secure authentication" checkbox unchecked is secure in the "disable the use of plain text password over unencrypted channels" sense. No one's actually answered that question.
> Besides of that I like what Nelson writes on disabling the use of plain text
> passwords.
You mean effectively ignore that checkbox for connections that are sending the password over an encrypted channel?
> What's the specific error description you get?
An error occurred sending mail: Unable to authenticate to SMTP server
outgoing.mit.edu. The server does not support any compatible secure
authentication mechanism but you have chosen secure authentication. Try
switching off secure authentication or contact your service provider.

|  | [Nelson Bolyard (seldom reads bugmail)](/user_profile?user_id=4484) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=311657#c70)• 17 years ago |
|  | |

BTW, my [comment 67](/show_bug.cgi?id=311657#c67 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure") wasn't meant to imply any disapproval. Just clarification.
I think we have to decide which to fix: the pref's definition or the label
or both. It's clear (to me :) that changing the pref's label and its
definition to be something like "Don't send plain text passwords over
unencrypted channels" would be most easy for users to understand, and
would probably most closely match what they desire to accomplish.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=311657#c71)• 17 years ago |
|  | |

> BTW, my [comment 67](/show_bug.cgi?id=311657#c67 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure") wasn't meant to imply any disapproval.
I didn't think it had. :)

|  | [Wolfgang Rosenauer [:wolfiR]](/user_profile?user_id=40471) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=311657#c72)• 17 years ago |
|  | |

(In reply to [comment #69](/show_bug.cgi?id=311657#c69 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"))
> Note that I \_still\_ don't know whether using "STARTTLS" with the "secure
> authentication" checkbox unchecked is secure in the "disable the use of plain
> text password over unencrypted channels" sense. No one's actually answered
> that question.
Whatever you use with TLS(STARTTLS) is secure since the TLS session is started before authentication is done. In theory it might be possible that the client performs authentication before it does initiate the TLS session but that would be really silly. Some servers enforce STARTTLS by not accepting something else before.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=311657#c73)• 17 years ago |
|  | |

@ Nelson
Yes, that label would be easy to understand and what most people want. On the other hand it would make TB's/SM's behaviour even more unconfigurable. I really think we'll need [bug 202148](/show_bug.cgi?id=202148 "NEW - Make the mechanism used for smtp authentication adjustable") fixed.
@Boris
There's a bug in our code. I filed [bug 394043](/show_bug.cgi?id=394043 "RESOLVED INCOMPLETE - Wrong message if GSSAPI fails and is the only mechanism available") with a description.
But why does GSSAPI fail for you in this early stage? I think because do\_CreateInstance(NS\_AUTH\_MODULE\_CONTRACTID\_PREFIX "sasl-gssapi", &rv) in nsMsgProtocol.cpp#820 fails.
I don't know about the GSSAPI implementation, but might it be that psm isn't compiled in your build?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=311657#c74)• 17 years ago |
|  | |

Christian, I'm using a mozilla.org nightly build. PSM is compiled in it, trust me. ;)
In a local debug build that shows the problem, I do get back an m\_authModule on that line.
The negotiateauth:5 log says:
-1208394976[9b8f548]: entering nsAuthGSSAPI::GetNextToken()
-1208394976[9b8f548]: gss\_init\_sec\_context() failed: Miscellaneous failure
No credentials cache found
Then GetNextToken returns NS\_ERROR\_FAILURE, and the rest is history.
This is not entirely surprising if this code just fails out if I don't have Kerberos credentials: I in fact do not have any.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=311657#c75)• 17 years ago |
|  | |

I filed [bug 394053](/show_bug.cgi?id=394053 "RESOLVED INCOMPLETE - \"Use secure authentication\" preference label misleading") on the password auth over TLS issue.

|  | [Christian Eyrich](/user_profile?user_id=31357)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=311657#c76)• 17 years ago |
|  | |

Uh, yes, PSM isn't related here, sorry.
So what's really needed is to catch the cases where our internals fail, independently off server messages and especially if GSSAPI as only mechanism fails. That will both go into [bug 394043](/show_bug.cgi?id=394043 "RESOLVED INCOMPLETE - Wrong message if GSSAPI fails and is the only mechanism available").

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=311657#c77)• 17 years ago |
|  | |

(In reply to [comment #73](/show_bug.cgi?id=311657#c73 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure"))
> Yes, that label would be easy to understand and what most people want. On the
> other hand it would make TB's/SM's behaviour even more unconfigurable. I really
> think we'll need [bug 202148](/show_bug.cgi?id=202148 "NEW - Make the mechanism used for smtp authentication adjustable") fixed.
Given that that bug rfe isn't even fixed, I think the label text from [comment 70](/show_bug.cgi?id=311657#c70 "RESOLVED FIXED - Don't fall back to insecure authentication after SMTP auth failure") would be fine. Even if [bug 202148](/show_bug.cgi?id=202148 "NEW - Make the mechanism used for smtp authentication adjustable") would get fixed I really doubt that would get any UI, so the few advanced users changing it would just have to know that if they change the pref, the label might become a bit misleading. (Or then handle switching label in that bug.)

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a75460715_101158)• 17 years ago |

Depends on: [418945](/show_bug.cgi?id=418945 "UNCONFIRMED - SMTP AUTH not supported: behavior changed unacceptably")

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a84609700_101158)• 17 years ago |

Target Milestone: --- → mozilla1.9alpha7

|  | [Serge Gautherie (:sgautherie)](/user_profile?user_id=49577) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a85189297_49577)• 17 years ago |

Depends on: [440712](/show_bug.cgi?id=440712 "VERIFIED FIXED - In <smtpEditOverlay.js>, \"Warning: assignment to undeclared variable gSmtpUseSecAuth\"")

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a103872157_1)• 16 years ago |

Product: Core → MailNews Core

|  | [Launchpad](/user_profile?user_id=363145) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=311657#a155996465_363145)• 14 years ago |

See Also: → <https://launchpad.net/bugs/24220>
You need to [log in](/show_bug.cgi?id=311657&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Christian Eyrich](/user_profile?user_id=31357)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from marc.info_be647cc6_20250124_233437.html ===

```
[[prev in list](?l=bugtraq&m=113026292224082&w=2)] [[next in list](?l=bugtraq&m=113027043432294&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=113034421329653&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Mozilla Thunderbird SMTP down-negotiation weakness](?t=113028019300006&r=1&w=2)
From:       [Thomas Henlich <thomas () henlich ! de>](?a=112929266700001&r=1&w=2)
Date:       [2005-10-25 11:06:50](?l=bugtraq&r=1&w=2&b=200510)
Message-ID: [435E11CA.6080406 () henlich ! de](?i=435E11CA.6080406%20()%20henlich%20!%20de)
[Download RAW [message](?l=bugtraq&m=113028017608146&q=mbox) or [body](?l=bugtraq&m=113028017608146&q=raw)]

MOZILLA THUNDERBIRD SMTP DOWN-NEGOTIATION WEAKNESS

Thomas Henlich <thomas@henlich.de>

SUMMARY

Mozilla Thunderbird SMTP down-negotiation behaviour allows a man-
in-the-middle (MITM) attack to bypass TLS initialization and/or
downgrade CRAM-MD5 to PLAIN authentication, leading to exposure
of authentication information. Failure in CRAM-MD5 authentication
also leads to exposure of authentication information to a passive
eavesdropper.

BACKGROUND

Mozilla Thunderbird is a mail user agent with support for SMTP
PLAIN and CRAM-MD5 authentication and for secure SMTP over TLS.

CRAM-MD5 is a method for secure user authentication which avoids
plaintext transmission of sensitive information (account/
password). TLS is a security protocol to protect transmitted data
against eavesdropping.

AFFECTED VERSIONS

- Mozilla Thunderbird 1.0.7 (20050923)
- Mozilla Thunderbird 1.5 Beta 2 (20051006)
- possibly other programs using the Mozilla mail component

DESCRIPTION

The SMTP negotiation in Mozilla Thunderbird is implemented in a
way that if a secure data exchange (CRAM-MD5 or STARTTLS) between
client and server can not be established, an insecure method is
used instead. The user is not notified of this and can not cancel
this insecure data exchange. An intermediate attacker can utilize
this behaviour to gain sensitive account/password information. As
CRAM-MD5 and TLS were designed to avoid eavesdropping attacks,
currently the implementation of Mozilla's SMTP client fails to
meet these design goals. Several methods of attack are possible:

A1. Passive eavesdropping attack on CRAM-MD5 authentication
failure

Scenario

- Client (C) Mozilla Thunderbird
- SMTP server (S) which supports and advertises PLAIN and CRAM-
  MD5 authentication
- Attacker A1 who can read network traffic from C to S

Sequence of attack

- User accidentally mistypes password (e.g. "secrez" instead
  "secret").
- C tries CRAM-MD5 authentication which fails.
- C retries with PLAIN authentication.
- A1 can guess the correct password from sniffed connection.

A2. One-way active MITM attack on CRAM-MD5 capability
advertisement

Scenario

- Client (C) Mozilla Thunderbird
- SMTP server (S) which supports and advertises PLAIN and CRAM-
  MD5 authentication.
- Attacker A2 who can read network traffic from C to S and modify
  network traffic from S to C

Sequence of attack

- S sends EHLO response.
- A2 discards S's SMTP authentication advertisement and sends
  "AUTH PLAIN" advertisement to C.
- C connects with PLAIN authentication.
- A2 can read cleartext password.

A3. One-way active MITM attack on CRAM-MD5 authentication attempt

Scenario

- Client (C) Mozilla Thunderbird
- SMTP server (S) which supports and advertises PLAIN and CRAM-
  MD5 authentication.
- Attacker A3 who can read and modify network traffic from C to S

Sequence of attack

- S sends CRAM-MD5 challenge to C.
- C sends authentication, but A3 transmits a different (random)
  response causing authentication to fail.
- C reauthenticates with PLAIN authentication.
- A3 can read cleartext password.

A4. One-way active MITM attack on STARTTLS capability
advertisement

Scenario

- Client (C) Mozilla Thunderbird
- SMTP server which supports and advertises STARTTLS
- Attacker A4 who can read network traffic from C to S and modify
  network traffic from S to C

Sequence of attack

- S sends EHLO response with STARTTLS advertisement.
- A4 discards S's STARTTLS advertisement.
- PLAIN authentication takes place.
- A4 can read cleartext password.

RESOLUTION

For A1-A3 no resolution is known. For A4, set user preference to
enforce TLS.

PROOF OF CONCEPT

A TCP proxy application demonstrating these weaknesses is
available from <http://www.henlich.de/moz-smtp/stcppipe-x.zip>

TIMELINE

- 2005-10-08: Opened Bugzilla Bug 311657
- 2005-10-11: Reported to security@mozilla.org

[[prev in list](?l=bugtraq&m=113026292224082&w=2)] [[next in list](?l=bugtraq&m=113027043432294&w=2)] [prev in thread] [[next in thread](?l=bugtraq&m=113034421329653&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from marc.info_ae342472_20250124_233438.html ===

```
[[prev in list](?l=bugtraq&m=113034945115713&w=2)] [[next in list](?l=bugtraq&m=113038056901902&w=2)] [[prev in thread](?l=bugtraq&m=113028017608146&w=2)] [[next in thread](?l=bugtraq&m=113035976802328&w=2)]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [Re: Mozilla Thunderbird SMTP down-negotiation weakness](?t=113028019300006&r=1&w=2)
From:       [Jason Haar <Jason.Haar () trimble ! co ! nz>](?a=90366684900007&r=1&w=2)
Date:       [2005-10-26 9:35:27](?l=bugtraq&r=1&w=2&b=200510)
Message-ID: [435F4DDF.2060905 () trimble ! co ! nz](?i=435F4DDF.2060905%20()%20trimble%20!%20co%20!%20nz)
[Download RAW [message](?l=bugtraq&m=113034421329653&q=mbox) or [body](?l=bugtraq&m=113034421329653&q=raw)]

Thomas Henlich wrote:

>Sequence of attack
>
>- S sends EHLO response with STARTTLS advertisement.
>- A4 discards S's STARTTLS advertisement.
>- PLAIN authentication takes place.
>- A4 can read cleartext password.
>
>RESOLUTION
>
>For A1-A3 no resolution is known. For A4, set user preference to
>enforce TLS.
>
>
>
Comment about A4.

Thunderbird explicitly allows you "TLS, if available" - which appears to
be what you refer to. However, there is a "TLS" - which means only do
TLS - and alert if the TLS certificate presented doesn't match a known
one (which would happen in a MITM).

Are you referring to a bug in their "TLS" mode - or implying that "TLS,
if available" is somehow not... what it says it is...???

Doesn't sound like a hole to me.

--
Cheers

Jason Haar
Information Security Manager, Trimble Navigation Ltd.
Phone: +64 3 9635 377 Fax: +64 3 9635 417
PGP Fingerprint: 7A2E 0407 C9A6 CAF6 2B9F 8422 C063 5EBB FE1D 66D1

[[prev in list](?l=bugtraq&m=113034945115713&w=2)] [[next in list](?l=bugtraq&m=113038056901902&w=2)] [[prev in thread](?l=bugtraq&m=113028017608146&w=2)] [[next in thread](?l=bugtraq&m=113035976802328&w=2)]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)


