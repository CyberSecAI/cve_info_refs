=== Content from bugzilla.mozilla.org_f590ed9e_20250125_161719.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/508927)
* [XML](/show_bug.cgi?ctype=xml&id=508927)

Closed
[Bug 508927](/show_bug.cgi?id=508927)

Opened 15 years ago
Closed 15 years ago

# "ASSERTION: returning frame that is not in childlist" with xul:listboxbody, XBL

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: returning frame that is not in childlist" with xul:listboxbody, XBL

## Categories

### (Core :: XUL, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XUL#XUL)

XUL
▾

Core :: XUL

For bugs in the [XUL
language](http://www.mozilla.org/xpfe/xptoolkit/xulintro.html). (XUL is an XML-based language which specifies Mozilla's user interface.)

If you're not actually writing XUL code, this is probably not the right place for your bug.

Examples of appropriate bugs: Duplicate window ID causes infinite loop; or Scrollbars disappear after loading XUL document

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XUL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XUL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XUL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: tnikkel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/c9e62c36c6c16218485bdb90fe88d63e?d=mm&size=40)  [enndeakin](/user_profile?user_id=6102)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[348483](/show_bug.cgi?id=348483 "RESOLVED FIXED - [meta] Fuzzer that makes random XBL bindings"), [488210](/show_bug.cgi?id=488210 "RESOLVED FIXED - \"ASSERTION: Going to destroy a frame we didn't remove. Prepare to crash\" with XUL listbox")

Dependency [tree](/showdependencytree.cgi?id=508927&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=508927)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.2](#a3024761_5038 "15 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.2 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.9.0.15](#c18 "15 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#c35 "15 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 3 obsolete files)

| [testcase](/attachment.cgi?id=393075)  [15 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   514 bytes, application/vnd.mozilla.xul+xml |  | [Details](/attachment.cgi?id=393075&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=393619)  [15 years ago](#c6)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   10.03 KB, patch | bzbarsky : [review-](#c8 "15 years ago") | [Details](/attachment.cgi?id=393619&action=edit) | [Diff](/attachment.cgi?id=393619&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=393619) |
| [minor content debug listing nit](/attachment.cgi?id=393620)  [15 years ago](#c7)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   723 bytes, patch | bzbarsky : [review+](#a501298_20209 "15 years ago") | [Details](/attachment.cgi?id=393620&action=edit) | [Diff](/attachment.cgi?id=393620&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=393620) |
| [patch v2](/attachment.cgi?id=394205)  [15 years ago](#c11)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   12.97 KB, patch | bzbarsky : [review+](#c12 "15 years ago") | [Details](/attachment.cgi?id=394205&action=edit) | [Diff](/attachment.cgi?id=394205&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394205) |
| [testcase that crashes as well as asserts](/attachment.cgi?id=394458)  [15 years ago](#c17)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   756 bytes, application/vnd.mozilla.xul+xml |  | [Details](/attachment.cgi?id=394458&action=edit) |
| [followup patch](/attachment.cgi?id=394997)  [15 years ago](#c19)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   2.40 KB, patch | bzbarsky : [review+](#a1526136_20209 "15 years ago") | [Details](/attachment.cgi?id=394997&action=edit) | [Diff](/attachment.cgi?id=394997&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394997) |
| [followup patch v2](/attachment.cgi?id=396259)  [15 years ago](#c23)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   3.57 KB, patch |  | [Details](/attachment.cgi?id=396259&action=edit) | [Diff](/attachment.cgi?id=396259&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396259) |
| [followup patch v3](/attachment.cgi?id=396318)  [15 years ago](#c25)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   2.46 KB, patch | roc : [approval1.9.2+](#a2833641_5038 "15 years ago")  dveditz : [approval1.9.1.4+](#a1637544_1689 "15 years ago")  dveditz : [approval1.9.0.15+](#a1637544_1689 "15 years ago") | [Details](/attachment.cgi?id=396318&action=edit) | [Diff](/attachment.cgi?id=396318&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396318) |
| [Merged to 1.9.1 and 1.9.0](/attachment.cgi?id=396635)  [15 years ago](#c30)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   2.37 KB, patch |  | [Details](/attachment.cgi?id=396635&action=edit) | [Diff](/attachment.cgi?id=396635&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396635) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=508927#c0)• 15 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=393075)
— [Details](attachment.cgi?id=393075&action=edit)

###!!! ASSERTION: returning frame that is not in childlist: '!result->IsBoxFrame() || result->GetParent() == this', file /Users/jruderman/central/layout/xul/base/src/nsListBoxBodyFrame.cpp, line 1263
This assertion was added as part of rev 4eb507b977b5 ([Bug 488210](/show_bug.cgi?id=488210 "RESOLVED FIXED - \"ASSERTION: Going to destroy a frame we didn't remove. Prepare to crash\" with XUL listbox"). Stop returning non-listitems' frames from GetNextItemBox.)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=508927#c1)• 15 years ago |
|  | |

nsGridRowGroup(listrows)(-1)@0x1eb0a4f8 {0,0,900,1920} [state=80841000] [content=0x1e2aa350] [sc=0x1eb0a49c]<
XULScroll(listboxbody)(0)@0x1eb142c8 [view=0x1e2abca0] next=0x1eb148b4 {0,0,900,1560} [state=80843000] [content=0x1e2aa380] [sc=0x1eb0a564]<
ScrollbarFrame(scrollbar)(-1)@0x1eb14390 next=0x1eb14210 {0,0,900,1560} [state=808c0000] [content=0x1e2abc30] [sc=0x1eb0a608]<
SliderFrame(slider)(-1)@0x1eb145d8 [view=0x1e2ac270] next=0x1eb14730 {0,0,900,900} [state=80802000] [content=0x1e2abeb0] [sc=0x1eb144c4]<
ButtonBoxFrame(thumb)(0)@0x1eb146c4 {0,360,900,49} [state=80000000] [content=0x1e2abee0] [sc=0x1eb14668]<>
>
ButtonBoxFrame(scrollbarbutton)(-1)@0x1eb14730 next=0x1eb147a0 {0,900,900,960} [state=80c00000] [content=0x1e2abf30] [sc=0x1eb14520]<>
ButtonBoxFrame(scrollbarbutton)(-1)@0x1eb147a0 {0,1860,900,960} [state=80c00000] [content=0x1e2abf60] [sc=0x1eb1457c]<>
>
Box(listboxbody)(0)@0x1eb14210 [view=0x1e2ac0c0] {0,0,0,1680} [state=80803000] [content=0x1e2aa380] [sc=0x1eb14810] pst=:-moz-scrolled-content<
nsGridRowLeaf(listitem)(0)@0x1eb15184 {0,0,0,0} [state=80c00412] [content=0x1e29b030] [sc=0x1eb15128]<
Box(listcell)(-1)@0x12bf86c {0,0,0,0} [state=80400402] [content=0x1e2aaa90] [sc=0x12bf810]<
XULLabel(label)(-1)@0x12bf934 {0,0,0,0} [state=00d00402] sc=0x12bf8d8(i=0,b=0)<
>
>
>
>
>
nsGridRowLeaf(listitem)(0)@0x1eb148b4 next=0x1eb14ed8 {0,1560,900,180} [state=80c00000] [content=0x1e29b030] [sc=0x1eb0a71c]<
Box(listcell)(-1)@0x1eb14b28 {60,60,240,60} [state=80400000] [content=0x1e2aaa90] [sc=0x1eb14a38]<
XULLabel(label)(-1)@0x1eb14e58 {0,0,240,60} [state=00d00000] sc=0x1eb14d68(i=0,b=0)<
>
>
>
nsGridRowLeaf(listitem)(1)@0x1eb14ed8 {0,1740,900,180} [state=80c00000] [content=0x1e29b080] [sc=0x1eb0a71c]<
Box(listcell)(-1)@0x1eb14f44 {60,60,240,60} [state=80400000] [content=0x1e2abad0] [sc=0x1eb14a38]<
XULLabel(label)(-1)@0x1eb14fb0 {0,0,240,60} [state=00d00000] sc=0x1eb14d68(i=0,b=0)<
>
>
>
>
(gdb) p this
$4 = (nsListBoxBodyFrame \*) 0x1eb14210
(gdb) p result->GetParent()
$5 = (nsGridRowGroupFrame \*) 0x1eb0a4f8
(gdb) p result
$6 = (nsListItemFrame \*) 0x1eb14ed8
So yeah... we're returning a sibling frame, effectively!

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=508927#c2)• 15 years ago |
|  | |

Er.. how do we have two different nsGridRowLeaf frames for the same content node?Group: core-security

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=508927#c3)• 15 years ago |
|  | |

So the key is that nsListBoxBodyFrame::GetListItemContentAt grabs the bindingParent of the listboxbody, then starts grabbing its listitem kids. I have no idea why it's doing that, but it's clearly NOT the right thing to do in this case.
Neils, any idea why it's doing that bindingParent thing?

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=508927#c4)• 15 years ago |
|  | |

Seems to me that it could use BindingManager()->GetXBLChildNodesFor instead.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=508927#c5)• 15 years ago |
|  | |

Yeah, that's what Timothy and I were talking about last night. Even better, it could just use nsChildIterator, right? He's going to look into that, if I understood correctly.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=508927#c6)• 15 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=393619&action=diff) (obsolete)
— [Details](attachment.cgi?id=393619&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=393619)

Instead of looking at the binding parent, use ChildIterator to access the XBL nodes of the listboxbody content.Assignee: nobody → tnikkel
[Attachment #393619](/attachment.cgi?id=393619&action=edit "patch") -
Flags: review?(bzbarsky)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=508927#c7)• 15 years ago |
|  | |

Attached patch

[minor content debug listing nit](attachment.cgi?id=393620&action=diff)
— [Details](attachment.cgi?id=393620&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=393620)

In debug listing of XUL content get rid of the leading '<' so that angle brackets balance.
This is useful if you are looking at a big content tree dump and use a text editor that can match brackets.
[Attachment #393620](/attachment.cgi?id=393620&action=edit "minor content debug listing nit") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a501298_20209)• 15 years ago |

[Attachment #393620](/attachment.cgi?id=393620&action=edit "minor content debug listing nit") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=508927#c8)• 15 years ago |
|  | |

Comment on [attachment 393619](/attachment.cgi?id=393619 "patch") [[details]](/attachment.cgi?id=393619&action=edit "patch") [[diff]](/attachment.cgi?id=393619&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=393619)
patch
If we're in OnContentRemoved, that means that ContentRemoved was called with the listbox as the aContainer. So in that case the aIndex is in fact for the child list of the listbox, not for the flattened tree child list of the listboxbody... So that part of the change doesn't look right to me, where we use aIndex to seek the child iterator. The part where we're seeking to end, on the other hand, does need to use an ChildIterator.
Other than that, looks good.
[Attachment #393619](/attachment.cgi?id=393619&action=edit "patch") -
Flags: review?(bzbarsky) → review-

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=508927#c9)• 15 years ago |
|  | |

Hmm, so just pass aContainer from the frame constructor to OnContentRemoved and use that to ensure we get the right container?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=508927#c10)• 15 years ago |
|  | |

That's not a bad idea at all. Let's do that.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=508927#c11)• 15 years ago |
|  | |

Attached patch

[patch v2](attachment.cgi?id=394205&action=diff)
— [Details](attachment.cgi?id=394205&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394205)

Pass aContainer from the frame constructor to OnContentRemoved and use that instead.
[Attachment #393619](/attachment.cgi?id=393619&action=edit "patch") -
Attachment is obsolete: true
[Attachment #394205](/attachment.cgi?id=394205&action=edit "patch v2") -
Flags: review?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=508927#c12)• 15 years ago |
|  | |

Comment on [attachment 394205](/attachment.cgi?id=394205 "patch v2") [[details]](/attachment.cgi?id=394205&action=edit "patch v2") [[diff]](/attachment.cgi?id=394205&action=diff "patch v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394205)
patch v2
r=bzbarsky
[Attachment #394205](/attachment.cgi?id=394205&action=edit "patch v2") -
Flags: review?(bzbarsky) → review+

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a529542_255010)• 15 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Whiteboard: [needs landing]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=508927#c13)• 15 years ago |
|  | |

Hmm. Do we need this on 1.9.1 or earlier branches, do you think?Flags: blocking1.9.2?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=508927#c14)• 15 years ago |
|  | |

Comment on [attachment 394205](/attachment.cgi?id=394205 "patch v2") [[details]](/attachment.cgi?id=394205&action=edit "patch v2") [[diff]](/attachment.cgi?id=394205&action=diff "patch v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394205)
patch v2
a=beltzner for mozilla-central and mozilla-1.9.2

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=508927#c15)• 15 years ago |
|  | |

Pushed the debug fixup:
<http://hg.mozilla.org/mozilla-central/rev/8c402112ba9c>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/c7d1cd3d77a7>
And the main patch:
<http://hg.mozilla.org/mozilla-central/rev/a8f39e150cc1>
<http://hg.mozilla.org/mozilla-central/rev/a8f39e150cc1>Status: NEW → RESOLVEDClosed: 15 years agoFlags: in-testsuite+Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Resolution: --- → FIXEDWhiteboard: [needs landing]

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a577312_20209)• 15 years ago |

Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=508927#c16)• 15 years ago |
|  | |

Let me fix the links for the push so that the record is correct. They should be as follows.
Pushed the debug fixup:
<http://hg.mozilla.org/mozilla-central/rev/8c402112ba9c>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/c7d1cd3d77a7>
And the main patch:
<http://hg.mozilla.org/mozilla-central/rev/a8f39e150cc1>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/ee13d35cf80e>

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=508927#c17)• 15 years ago |
|  | |

Attached file
[testcase that crashes as well as asserts](attachment.cgi?id=394458)
— [Details](attachment.cgi?id=394458&action=edit)

I think we do need this on the same branches we took [bug 488210](/show_bug.cgi?id=488210 "RESOLVED FIXED - \"ASSERTION: Going to destroy a frame we didn't remove. Prepare to crash\" with XUL listbox") (ie 1.9.1 and 1.9.0). Anytime the "returning frame that is not in childlist" assertion is triggered there is no reason why nsListBoxBodyFrame::RemoveChildFrame can not be called on whatever frame triggered the assertion, and hence we'll crash exactly the same way as [bug 488210](/show_bug.cgi?id=488210 "RESOLVED FIXED - \"ASSERTION: Going to destroy a frame we didn't remove. Prepare to crash\" with XUL listbox"), with dangling pointers to a frame that has been destroyed. This testcase shows this is true, ie it crashes (I just added a bunch more listitems to Jesse's testcase so that RemoveChildFrame actually got called).

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a622837_255010)• 15 years ago |

blocking1.9.1: --- → ?
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F)Flags: blocking1.9.0.15?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=508927#c18)• 15 years ago |
|  | |

This is a decent-sized patch. Any comments on its safety for both branches? Does it apply as-is or will it need to be ported to 1.9.1 / 1.9.0?blocking1.9.1: ? → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F) → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.0.15? → blocking1.9.0.15+

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=508927#c19)• 15 years ago |
|  | |

Attached patch

[followup patch](attachment.cgi?id=394997&action=diff) (obsolete)
— [Details](attachment.cgi?id=394997&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394997)

Here is a much smaller patch which fixes the crash and I think should also be applied to trunk.
Returning a frame that is not in the childlist from GetNextItemBox can easily lead to a crash, so instead of checking for that in an assertion and proceeding, check for that in the code and don't return such a frame.
Also, like the assertion in RemoveChildFrame says, destroying a child frame we didn't remove will crash, so don't, just assert and return.
[Attachment #394997](/attachment.cgi?id=394997&action=edit "followup patch") -
Flags: review?(bzbarsky)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=508927#c20)• 15 years ago |
|  | |

So the idea being we could apply this smaller patch to the branches. And as I said above, I also think it would be good on trunk.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=508927#c21)• 15 years ago |
|  | |

David, would you be willing to give this patch some sort of review so it can get some bake time on trunk and then get a full review from bz when he gets back?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a1526136_20209)• 15 years ago |

[Attachment #394997](/attachment.cgi?id=394997&action=edit "followup patch") -
Flags: review?(bzbarsky) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=508927#c22)• 15 years ago |
|  | |

Comment on [attachment 394997](/attachment.cgi?id=394997 "followup patch") [[details]](/attachment.cgi?id=394997&action=edit "followup patch") [[diff]](/attachment.cgi?id=394997&action=diff "followup patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=394997)
followup patch
Looks good, if you use NS\_ERROR instead of NS\_ASSERTION(PR\_FALSE

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=508927#c23)• 15 years ago |
|  | |

Attached patch

[followup patch v2](attachment.cgi?id=396259&action=diff) (obsolete)
— [Details](attachment.cgi?id=396259&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396259)

Used NS\_ERROR.
Also included the crashing testcase as a crashtest.
[Attachment #394997](/attachment.cgi?id=394997&action=edit "followup patch") -
Attachment is obsolete: true

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=508927#c24)• 15 years ago |
|  | |

That last diff doesn't seem to apply to m-c.
And do we want to land the crashtest before we fix on all branches?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=508927#c25)• 15 years ago |
|  | |

Attached patch

[followup patch v3](attachment.cgi?id=396318&action=diff)
— [Details](attachment.cgi?id=396318&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396318)

Whoops, sorry, more changed on m-c then I thought. Rebased to tip. And removed the crashtest so that we can add it once this is fixed everywhere.
[Attachment #396259](/attachment.cgi?id=396259&action=edit "followup patch v2") -
Attachment is obsolete: true

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=508927#c26)• 15 years ago |
|  | |

Setting testsuite back to ? so the crashtest gets in later.Flags: in-testsuite+ → in-testsuite?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=508927#c27)• 15 years ago |
|  | |

Pushed followup patch as <http://hg.mozilla.org/mozilla-central/rev/2457c3db5ba6>
Timothy, please request branch approval flags as needed on the patches you think should go on branches?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=508927#c28)• 15 years ago |
|  | |

Removing the fixed1.9.2 flag too, in case we want to land the followup there.Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a1627523_255010)• 15 years ago |

[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.2?
[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.1.4?
[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a1637544_1689)• 15 years ago |

[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.1.4?
[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.1.4+
[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.0.15?
[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=508927#c29)• 15 years ago |
|  | |

Comment on [attachment 396318](/attachment.cgi?id=396318 "followup patch v3") [[details]](/attachment.cgi?id=396318&action=edit "followup patch v3") [[diff]](/attachment.cgi?id=396318&action=diff "followup patch v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396318)
followup patch v3
Approved for 1.9.1.4 and 1.9.0.15, a=dveditz for release-drivers

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=508927#c30)• 15 years ago |
|  | |

Attached patch

[Merged to 1.9.1 and 1.9.0](attachment.cgi?id=396635&action=diff)
— [Details](attachment.cgi?id=396635&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508927&attachment=396635)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a1646203_20209)• 15 years ago |

[Attachment #396635](/attachment.cgi?id=396635&action=edit "Merged to 1.9.1 and 1.9.0") -
Attachment description: Merged to 1.9.0 → Merged to 1.9.1 and 1.9.0

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=508927#c31)• 15 years ago |
|  | |

Checking in layout/xul/base/src/nsListBoxBodyFrame.cpp;
/cvsroot/mozilla/layout/xul/base/src/nsListBoxBodyFrame.cpp,v <-- nsListBoxBodyFrame.cpp
new revision: 1.103; previous revision: 1.102
done
Pushed <http://hg.mozilla.org/releases/mozilla-1.9.1/rev/5d9e08875338>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a2833641_5038)• 15 years ago |

[Attachment #396318](/attachment.cgi?id=396318&action=edit "followup patch v3") -
Flags: approval1.9.2? → approval1.9.2+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a3024761_5038)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a3109999_255010)• 15 years ago |

Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Whiteboard: [needs 192 landing]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=508927#c32)• 15 years ago |
|  | |

Verified for 1.9.0.15 using testcase and Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.15pre) Gecko/2009091321 GranParadiso/3.0.15pre (.NET CLR 3.5.30729).
Verified for 1.9.1.4 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090914 Shiretoko/3.5.4pre.Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---) → [verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=508927#c33)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/5c81af01b507>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)Keywords: [checkin-needed](/buglist.cgi?keywords=checkin-needed&resolution=---)Whiteboard: [needs 192 landing]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=508927#c34)• 15 years ago |
|  | |

Assuming this bug was potentially "bad".Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a8217019_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=508927#c35)• 15 years ago |
|  | |

The first testcase is already checked in as a crashtest. I just checked in the second:
<http://hg.mozilla.org/mozilla-central/rev/a86c5f1d3fef>Flags: in-testsuite? → in-testsuite+

|  | [IU](/user_profile?user_id=30129) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a16080139_30129)• 15 years ago |

Depends on: [545061](/show_bug.cgi?id=545061 "RESOLVED WORKSFORME - Apache mailing list archives messages do not display")

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508927#a16082635_255010)• 15 years ago |

No longer depends on: [545061](/show_bug.cgi?id=545061 "RESOLVED WORKSFORME - Apache mailing list archives messages do not display")
You need to [log in](/show_bug.cgi?id=508927&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_5005840e_20250125_161717.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/497013)
* [XML](/show_bug.cgi?ctype=xml&id=497013)

Closed
[Bug 497013](/show_bug.cgi?id=497013)

Opened 16 years ago
Closed 15 years ago

# Crash [@ SinkContext::~SinkContext] with document.write in -moz-binding

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ SinkContext::~SinkContext] with document.write in -moz-binding

## Categories

### (Core :: DOM: HTML Parser, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20HTML%20Parser#DOM%3A%20HTML%20Parser)

DOM: HTML Parser
▾

Core :: DOM: HTML Parser
This system consumes content from the web, parses, validates and builds a content model (document)
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20HTML%20Parser&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20HTML%20Parser)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: martijn.martijn, Assigned: mrbkap)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/89d2149736265010bfe669ce8c3075c0?d=mm&size=40)  [mrbkap](/user_profile?user_id=69426)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1ecb17d06c0dc059332f0f5fb330984e?d=mm&size=40)  [martijn.martijn](/user_profile?user_id=55600)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5111b810214a00377104f5ad3efefa26?d=mm&size=40)  [sefeng](/user_profile?user_id=625922)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a8631618_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#c1 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ SinkContext::~SinkContext ]](https://crash-stats.mozilla.org/signature/?signature=SinkContext%3A%3A~SinkContext)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [zipped up testcase](/attachment.cgi?id=382212)  [16 years ago](#c0)  [Martijn Wargers (dead)](/user_profile?user_id=55600)   780 bytes, application/java-archive |  | [Details](/attachment.cgi?id=382212&action=edit) |
| --- | --- | --- |
| [Fix](/attachment.cgi?id=390981)  [15 years ago](#c3)  [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)   1.82 KB, patch | sicking : [review+](#a4252753_9186 "15 years ago")  sicking : [superreview+](#a4252753_9186 "15 years ago")  dveditz : [approval1.9.1.4+](#c10 "15 years ago")  dveditz : [approval1.9.0.15+](#a9095696_1689 "15 years ago") | [Details](/attachment.cgi?id=390981&action=edit) | [Diff](/attachment.cgi?id=390981&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=497013&attachment=390981) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=497013#c0)• 16 years ago |
|  | |

Attached file
[zipped up testcase](attachment.cgi?id=382212)
— [Details](attachment.cgi?id=382212&action=edit)

See zipped up testcase, which crashes Firefox 3 and current trunk build, when visiting the file named 'testcase.htm', wait a little while and then press the back button.
Breakpad report for trunk:
<http://crash-stats.mozilla.com/report/index/ded73808-0a0f-412e-ac81-deadc2090608>
0 mozcrt19.dll arena\_dalloc\_small obj-firefox/memory/jemalloc/crtsrc/jemalloc.c:4425
1 mozcrt19.dll arena\_dalloc obj-firefox/memory/jemalloc/crtsrc/jemalloc.c:4548
2 mozcrt19.dll free obj-firefox/memory/jemalloc/crtsrc/jemalloc.c:6387
3 xul.dll SinkContext::~SinkContext content/html/document/src/nsHTMLContentSink.cpp:649
4 xul.dll HTMLContentSink::~HTMLContentSink content/html/document/src/nsHTMLContentSink.cpp:1569
5 xul.dll HTMLContentSink::`scalar deleting destructor'
6 xul.dll HTMLContentSink::Release content/html/document/src/nsHTMLContentSink.cpp:1596
7 nspr4.dll nspr4.dll@0x858f
Breakpad report for Firefox3.0.x:
<http://crash-stats.mozilla.com/report/index/946e6a17-c797-4ec9-953d-b95de2090608?p=1>
0 xul.dll SinkContext::FlushTags mozilla/content/html/document/src/nsHTMLContentSink.cpp:1341
1 xul.dll HTMLContentSink::DidBuildModel mozilla/content/html/document/src/nsHTMLContentSink.cpp:1811
2 xul.dll CNavDTD::DidBuildModel mozilla/parser/htmlparser/src/CNavDTD.cpp:466
3 xul.dll nsParser::DidBuildModel mozilla/parser/htmlparser/src/nsParser.cpp:1006

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a547337_1689)• 16 years ago |

[Attachment #382212](/attachment.cgi?id=382212&action=edit "zipped up testcase") -
Attachment mime type: application/zip → application/java-archive

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=497013#c1)• 16 years ago |
|  | |

In a debug build mSink looks like a deleted or corrupt object.Flags: wanted1.9.1.x+Flags: wanted1.9.0.x+Whiteboard: [sg:critical?]

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=497013#c2)• 16 years ago |
|  | |

Who can own this?
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.1.x+Whiteboard: [sg:critical?] → [sg:critical?][needs owner]

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a4234588_69426)• 15 years ago |

Assignee: nobody → mrbkap

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=497013#c3)• 15 years ago |
|  | |

Attached patch

[Fix](attachment.cgi?id=390981&action=diff)
— [Details](attachment.cgi?id=390981&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=497013&attachment=390981)

[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: superreview?(jonas)
[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: review?(jonas)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=497013#c4)• 15 years ago |
|  | |

The reason this fixes this bug is because the call to mSink->OpenHead can flush tags, which runs XBL constructors. The XBL constructor in this case does a document.write, re-entering the parser. However, by that point, the parser thinks the head has already been pushed, so it tells the sink to close the head. But the sink hasn't yet opened the head anyway, so things get out of sync and badness ensues.

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a4252753_9186)• 15 years ago |

[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: superreview?(jonas)
[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: superreview+
[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: review?(jonas)
[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: review+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=497013#c5)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/aa0ee4e7b713>Whiteboard: [sg:critical?][needs owner] → [sg:critical?]

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=497013#c6)• 15 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=497013#c5 "RESOLVED FIXED - Crash [@ SinkContext::~SinkContext] with document.write in -moz-binding"))
> <http://hg.mozilla.org/mozilla-central/rev/aa0ee4e7b713>
By that line, you mean this bug is fixed?

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=497013#c7)• 15 years ago |
|  | |

Oops, yes.Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a8459455_1689)• 15 years ago |

blocking1.9.1: --- → .4+Flags: blocking1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a8631618_1689)• 15 years ago |

Flags: blocking1.9.0.15? → blocking1.9.0.15+

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a9069393_69426)• 15 years ago |

[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: approval1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a9095500_1689)• 15 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a9095696_1689)• 15 years ago |

[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=497013#c8)• 15 years ago |
|  | |

Comment on [attachment 390981](/attachment.cgi?id=390981 "Fix") [[details]](/attachment.cgi?id=390981&action=edit "Fix") [[diff]](/attachment.cgi?id=390981&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=497013&attachment=390981)
Fix
Approved for 1.9.0.15, a=dveditz
Shouldn't this work for the 1.9.1 branch, too? If it does and you want to land it tonight then go ahead and do so. Add the approval request and I'll formally dot the i's after the fact tomorrow morning.

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a9152284_69426)• 15 years ago |

[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: approval1.9.1.4?

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=497013#c9)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/cbe1f21a26c0>
Checking in parser/htmlparser/src/CNavDTD.cpp;
/cvsroot/mozilla/parser/htmlparser/src/CNavDTD.cpp,v <-- CNavDTD.cpp
new revision: 3.508; previous revision: 3.507
done
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=497013#c10)• 15 years ago |
|  | |

Comment on [attachment 390981](/attachment.cgi?id=390981 "Fix") [[details]](/attachment.cgi?id=390981&action=edit "Fix") [[diff]](/attachment.cgi?id=390981&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=497013&attachment=390981)
Fix
Approved for 1.9.1.4, a=dveditz
[Attachment #390981](/attachment.cgi?id=390981&action=edit "Fix") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=497013#c11)• 15 years ago |
|  | |

Verified fixed in 1.9.0 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.0.15pre) Gecko/2009092404 GranParadiso/3.0.15pre.
Verified fixed in 1.9.1 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090924 Shiretoko/3.5.4pre.Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---) → [verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a13313812_1689)• 15 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=497013#a63476549_1)• 14 years ago |

Crash Signature: [@ SinkContext::~SinkContext]
You need to [log in](/show_bug.cgi?id=497013&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martijn Wargers (dead)](/user_profile?user_id=55600)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.vupen.com_e535ac56_20250125_161711.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.mozilla.org_827ec382_20250125_161725.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/509602)
* [XML](/show_bug.cgi?ctype=xml&id=509602)

Closed
[Bug 509602](/show_bug.cgi?id=509602)

Opened 15 years ago
Closed 15 years ago

# Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified

## Categories

### (Core :: Layout, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: martijn.martijn, Assigned: tnikkel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1ecb17d06c0dc059332f0f5fb330984e?d=mm&size=40)  [martijn.martijn](/user_profile?user_id=55600)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

### ( URL )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[382444](/show_bug.cgi?id=382444 "VERIFIED FIXED - Crash [@ nsINodeInfo::Equals] with underflow event, tree stuff and removing window"), [478416](/show_bug.cgi?id=478416 "RESOLVED FIXED - Replace chromedir with something more sane")

Dependency [tree](/showdependencytree.cgi?id=509602&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=509602)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

jar:https://bugzilla.mozilla.org/atta...

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (6 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.2](#a2682753_5038 "15 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a929086_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a929086_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#c25 "15 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsTreeBodyFrame::InvalidateScrollbars ]](https://crash-stats.mozilla.org/signature/?signature=nsTreeBodyFrame%3A%3AInvalidateScrollbars)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 2 obsolete files)

| [zipped up testcase](/attachment.cgi?id=393655)  [15 years ago](#c0)  [Martijn Wargers (dead)](/user_profile?user_id=55600)   572 bytes, application/java-archive |  | [Details](/attachment.cgi?id=393655&action=edit) |
| --- | --- | --- |
| [hold a reference to the scrollbar content](/attachment.cgi?id=394787)  [15 years ago](#c4)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   2.54 KB, patch |  | [Details](/attachment.cgi?id=394787&action=edit) | [Diff](/attachment.cgi?id=394787&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=394787) |
| [hold a reference to the scrollbar content and do a weak frame check on the columns frame](/attachment.cgi?id=394884)  [15 years ago](#c6)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   8.76 KB, patch | smaug : [review+](#a654403_39966 "15 years ago") | [Details](/attachment.cgi?id=394884&action=edit) | [Diff](/attachment.cgi?id=394884&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=394884) |
| [above patch with nit fixed, and without test](/attachment.cgi?id=395146)  [15 years ago](#c8)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   7.26 KB, patch | neil : [superreview+](#a733533_14006 "15 years ago")  roc : [approval1.9.2+](#a2491637_5038 "15 years ago") | [Details](/attachment.cgi?id=395146&action=edit) | [Diff](/attachment.cgi?id=395146&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395146) |
| [crashtest](/attachment.cgi?id=395148)  [15 years ago](#c10)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   1.57 KB, patch |  | [Details](/attachment.cgi?id=395148&action=edit) | [Diff](/attachment.cgi?id=395148&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395148) |
| [1.9.1 patch](/attachment.cgi?id=396045)  [15 years ago](#c14)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   7.02 KB, patch | dveditz : [approval1.9.1.4+](#c17 "15 years ago") | [Details](/attachment.cgi?id=396045&action=edit) | [Diff](/attachment.cgi?id=396045&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396045) |
| [1.9.0 patch](/attachment.cgi?id=396046)  [15 years ago](#c15)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   8.57 KB, patch | smaug : [review+](#a989973_39966 "15 years ago")  dveditz : [approval1.9.0.15+](#c16 "15 years ago") | [Details](/attachment.cgi?id=396046&action=edit) | [Diff](/attachment.cgi?id=396046&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396046) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=509602#c0)• 15 years ago |
|  | |

Attached file
[zipped up testcase](attachment.cgi?id=393655)
— [Details](attachment.cgi?id=393655&action=edit)

See zipped up testcase, which crashes in current trunk build. This regressed between 2009-07-29 and 2009-07-30:
<http://hg.mozilla.org/mozilla-central/pushloghtml?startdate=2009-07-29+04%3A00%3A00&enddate=2009-07-30+07%3A00%3A00>
My guess a regression from [bug 486065](/show_bug.cgi?id=486065 "RESOLVED FIXED - hidden scrollbars get drawn anyway when Gtk theme gives scrollbars borders").
<http://crash-stats.mozilla.com/report/index/48bbded9-d50e-4793-a9d4-fb0472090810?p=1>
0 ntdll.dll ntdll.dll@0xe514
1 kernel32.dll kernel32.dll@0x2541
2 xul.dll google\_breakpad::ExceptionHandler::WriteMinidumpOnHandlerThread toolkit/crashreporter/google-breakpad/src/client/windows/handler/exception\_handler.cc:562
3 xul.dll google\_breakpad::ExceptionHandler::HandlePureVirtualCall toolkit/crashreporter/google-breakpad/src/client/windows/handler/exception\_handler.cc:506
4 mozcrt19.dll \_purecall obj-firefox/memory/jemalloc/crtsrc/purevirt.c:47
5 xul.dll nsCOMPtr<nsIProtocolProxyCallback>::nsCOMPtr<nsIProtocolProxyCallback> obj-firefox/dist/include/nsCOMPtr.h:554
6 xul.dll nsTreeBodyFrame::InvalidateScrollbars layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:987
7 xul.dll nsTreeBodyFrame::FullScrollbarsUpdate layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:4717
8 xul.dll nsTreeBodyFrame::SetView layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:546
9 xul.dll nsTreeBoxObject::GetView layout/xul/base/src/tree/src/nsTreeBoxObject.cpp:169
10 xul.dll nsTreeBodyFrame::EnsureView layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:393
11 xul.dll nsTreeBodyFrame::ReflowFinished layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:439
12 xul.dll PresShell::HandlePostedReflowCallbacks layout/base/nsPresShell.cpp:4769

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a93_55600)• 15 years ago |

[Attachment #393655](/attachment.cgi?id=393655&action=edit "zipped up testcase") -
Attachment mime type: application/octet-stream → application/java-archive

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=509602#c1)• 15 years ago |
|  | |

The crashing link is:
jar:<https://bugzilla.mozilla.org/attachment.cgi?id=393655!/crash1.xul>URL: jar:https://bugzilla.mozilla.org/atta...

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=509602#c2)• 15 years ago |
|  | |

It wasn't caused by [bug 486065](/show_bug.cgi?id=486065 "RESOLVED FIXED - hidden scrollbars get drawn anyway when Gtk theme gives scrollbars borders"), as with that backed out it still crashes. I don't know what in that regression range causes it though.
BTW Martijn, you can specify slightly better links to regression ranges using the format <http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=55fd6820c596&tochange=3222b99f441c> (about:buildconfig for the changeset id's). I don't know if there is a form where you can input the changeset id's to get the link though.
I get this stack.
#0 0xb499fd34 in nsCOMPtr (this=0xbfde14b8, aRawPtr=0xafb2adc0)
at ../../../dist/include/nsCOMPtr.h:554
#1 0xb4f680cc in nsTreeBodyFrame::InvalidateScrollbars (this=0xaf8519d0,
aParts=@0xbfde14ec)
at /src/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:987
#2 0xb4f6945a in nsTreeBodyFrame::FullScrollbarsUpdate (this=0xaf8519d0,
aNeedsFullInvalidation=0)
at /src/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:4717
#3 0xb4f6a899 in nsTreeBodyFrame::SetView (this=0xaf8519d0, aView=0xaf7e1c40)
at /src/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:546
#4 0xb4f6dce7 in nsTreeBoxObject::GetView (this=0xaf8117a0, aView=0xbfde1700)
at /src/layout/xul/base/src/tree/src/nsTreeBoxObject.cpp:169
#5 0xb4f6ab1d in nsTreeBodyFrame::EnsureView (this=0xaf8519d0)
at /src/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:393
#6 0xb4f6af84 in nsTreeBodyFrame::ReflowFinished (this=0xaf8519d0)
at /src/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp:439
#7 0xb49ffc76 in PresShell::HandlePostedReflowCallbacks (this=0xadd37c00,
aInterruptible=0) at /src/layout/base/nsPresShell.cpp:4769
#8 0xb4a039d9 in PresShell::DidDoReflow (this=0xadd37c00, aInterruptible=0)
at /src/layout/base/nsPresShell.cpp:7065
#9 0xb4a0ff8f in PresShell::ProcessReflowCommands (this=0xadd37c00,
aInterruptible=0) at /src/layout/base/nsPresShell.cpp:7319
#10 0xb4a100c0 in PresShell::FlushPendingNotifications (this=0xadd37c00,
aType=Flush\_Layout)
at /src/layout/base/nsPresShell.cpp:4880
#11 0xb4beb84e in nsDocument::FlushPendingNotifications (this=0xadd36400,
aType=Flush\_Layout)
at /src/content/base/src/nsDocument.cpp:6272
#12 0xb56bc313 in nsDocLoader::DocLoaderIsEmpty (this=0xb01159a0,
aFlushLayout=1) at /src/uriloader/base/nsDocLoader.cpp:756
#13 0xb56bc714 in nsDocLoader::OnStopRequest (this=0xb01159a0,
aRequest=0xaf7e0130, aCtxt=0x0, aStatus=0)
at /src/uriloader/base/nsDocLoader.cpp:697
#14 0xb5bbd653 in nsLoadGroup::RemoveRequest (this=0xaff57510,
request=0xaf7e0130, ctxt=0x0, aStatus=0)
at /src/netwerk/base/src/nsLoadGroup.cpp:680
#15 0xb4beb514 in nsDocument::DoUnblockOnload (this=0xadd36400)
at /src/content/base/src/nsDocument.cpp:7025
#16 0xb4da2edc in nsBindingManager::DoProcessAttachedQueue (this=0xafbbe900)
at /src/content/xbl/src/nsBindingManager.cpp:1000
#17 0xb4da57a0 in nsRunnableMethod<nsBindingManager, void>::Run (
this=0xaf7f24c0) at ../../../dist/include/nsThreadUtils.h:264
#18 0xb7d54149 in nsThread::ProcessNextEvent (this=0xb6a7ace0, mayWait=1,
result=0xbfde1bc0) at /src/xpcom/threads/nsThread.cpp:527
#19 0xb7cfc14e in NS\_ProcessNextEvent\_P (thread=0xaf8519d0, mayWait=1)
at nsThreadUtils.cpp:230
#20 0xb594dc30 in nsBaseAppShell::Run (this=0xb25ddec0)
at /src/widget/src/xpwidgets/nsBaseAppShell.cpp:170
#21 0xb5acb1c4 in nsAppStartup::Run (this=0xb2307550)
at /src/toolkit/components/startup/src/nsAppStartup.cpp:193
#22 0xb7f6a418 in XRE\_main (argc=1, argv=0xbfde2184, aAppData=0xb6a06540)
at /src/toolkit/xre/nsAppRunner.cpp:3392
#23 0x0804996c in main (argc=1, argv=0xbfde2184)
at /src/browser/app/nsBrowserApp.cpp:156
We crash trying to access parts.mVScrollbarContent.
So it looks like in nsTreeBodyFrame::FullScrollbarsUpdate that parts.mVScrollbarContent is fine after GetScrollParts(). But when we call UpdateScrollbars() we call SetAttr on parts.mVScrollbarContent with notify=true. This triggers the onDOMAttrModified in overlay3.xul and we kill the parts.mVScrollbarContent and next time we access it we crash.No longer blocks: [486065](/show_bug.cgi?id=486065 "RESOLVED FIXED - hidden scrollbars get drawn anyway when Gtk theme gives scrollbars borders")

|  | [Elmar Ludwig](/user_profile?user_id=20302) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=509602#c3)• 15 years ago |
|  | |

This crashes on Linux as well, stack is almost identical:
[bp-9e1048a2-0d19-4744-a0a2-704a02090810](https://crash-stats.mozilla.org/report/index/9e1048a2-0d19-4744-a0a2-704a02090810)OS: Windows XP → AllHardware: x86 → All

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a34546_39966)• 15 years ago |

Group: core-security

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a307276_39966)• 15 years ago |

Flags: blocking1.9.2?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=509602#c4)• 15 years ago |
|  | |

Attached patch

[hold a reference to the scrollbar content](attachment.cgi?id=394787&action=diff) (obsolete)
— [Details](attachment.cgi?id=394787&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=394787)

The regression range is due to [bug 478416](/show_bug.cgi?id=478416 "RESOLVED FIXED - Replace chromedir with something more sane"). Here <http://hg.mozilla.org/mozilla-central/diff/d78664d9530c/toolkit/content/widgets/tree.xml> it removed a setAttribute call in the tree constructor. I haven't verified this in a debugger, but adding a dummy setAttribute to the tree constructor causes it to not crash. So I think that in this testcase the setAttribute call kills the tree due to the onDOMAttrModified="event.target.parentNode.removeChild(event.target)" and we don't get any further.
In FullScrollbarsUpdate (which was added in [bug 382444](/show_bug.cgi?id=382444 "VERIFIED FIXED - Crash [@ nsINodeInfo::Equals] with underflow event, tree stuff and removing window")) we need to hold a reference to the scrollbar content in case the SetAttr calls in UpdateScrollbars or InvalidateScrollbars kill the scrollbar content.
I think we might have problems with the frames in the ScrollParts struct as well. For example in InvalidateScrollbars, the first SetAttr calls may kill the aParts.mColumnsFrame which we call GetRect on.
[Attachment #394787](/attachment.cgi?id=394787&action=edit "hold a reference to the scrollbar content") -
Flags: review?(Olli.Pettay)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a552611_255010)• 15 years ago |

Blocks: [478416](/show_bug.cgi?id=478416 "RESOLVED FIXED - Replace chromedir with something more sane"), [382444](/show_bug.cgi?id=382444 "VERIFIED FIXED - Crash [@ nsINodeInfo::Equals] with underflow event, tree stuff and removing window")

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=509602#c5)• 15 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=509602#c4 "VERIFIED FIXED - Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified"))
> I think we might have problems with the frames in the ScrollParts struct as
> well.
Could you add some weakframe checks for those frames?
Could ScrollParts have nsCOMPtr for mVScrollbarContent and mHScrollbarContent?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=509602#c6)• 15 years ago |
|  | |

Attached patch

[hold a reference to the scrollbar content and do a weak frame check on the columns frame](attachment.cgi?id=394884&action=diff) (obsolete)
— [Details](attachment.cgi?id=394884&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=394884)

Used nsCOMPtr in ScrollParts for scrollbar content to hold the reference and get rid of other unneeded nsCOMPtr's for the same.
Do a weak frame check on mColumnsFrame where a SetAttr call might kill it.Assignee: nobody → tnikkel
[Attachment #394787](/attachment.cgi?id=394787&action=edit "hold a reference to the scrollbar content") -
Attachment is obsolete: true
[Attachment #394884](/attachment.cgi?id=394884&action=edit "hold a reference to the scrollbar content and do a weak frame check on the columns frame") -
Flags: review?(Olli.Pettay)
[Attachment #394787](/attachment.cgi?id=394787&action=edit "hold a reference to the scrollbar content") -
Flags: review?(Olli.Pettay)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a654403_39966)• 15 years ago |

[Attachment #394884](/attachment.cgi?id=394884&action=edit "hold a reference to the scrollbar content and do a weak frame check on the columns frame") -
Flags: review?(Olli.Pettay) → review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=509602#c7)• 15 years ago |
|  | |

Comment on [attachment 394884](/attachment.cgi?id=394884 "hold a reference to the scrollbar content and do a weak frame check on the columns frame") [[details]](/attachment.cgi?id=394884&action=edit "hold a reference to the scrollbar content and do a weak frame check on the columns frame") [[diff]](/attachment.cgi?id=394884&action=diff "hold a reference to the scrollbar content and do a weak frame check on the columns frame") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=394884)
hold a reference to the scrollbar content and do a weak frame check on the columns frame
> // Update the maxpos of the scrollbar.
>- void InvalidateScrollbars(const ScrollParts& aParts);
>+ void InvalidateScrollbars(const ScrollParts& aParts, nsWeakFrame\* aWeakColumnsFrame);
Nit, I'd have
void InvalidateScrollbars(const ScrollParts& aParts, nsWeakFrame& aWeakColumnsFrame);
I think the patch should be checked in first (without tests), and only after
making sure that this doesn't need to be fixed in other branches or after fixing
this everywhere, commit the tests.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=509602#c8)• 15 years ago |
|  | |

Attached patch

[above patch with nit fixed, and without test](attachment.cgi?id=395146&action=diff)
— [Details](attachment.cgi?id=395146&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395146)

Hmm, testcase crashes 1.9.0, but not 1.9.1.
Olli, can I ask you to push this? I don't have hg access and I don't think checkin-needed is very effective for security bugs.
[Attachment #394884](/attachment.cgi?id=394884&action=edit "hold a reference to the scrollbar content and do a weak frame check on the columns frame") -
Attachment is obsolete: true

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a683489_255010)• 15 years ago |

Flags: in-testsuite?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=509602#c9)• 15 years ago |
|  | |

Ok, I'll push it tomorrow.
Could you still upload a separate patch which contains just the test.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=509602#c10)• 15 years ago |
|  | |

Attached patch

[crashtest](attachment.cgi?id=395148&action=diff)
— [Details](attachment.cgi?id=395148&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395148)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a731972_39966)• 15 years ago |

[Attachment #395146](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") -
Flags: superreview?(roc)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=509602#c11)• 15 years ago |
|  | |

Comment on [attachment 395146](/attachment.cgi?id=395146 "above patch with nit fixed, and without test") [[details]](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") [[diff]](/attachment.cgi?id=395146&action=diff "above patch with nit fixed, and without test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395146)
above patch with nit fixed, and without test
Oops, almost forgot, nowadays security bugs need separate r and sr.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a732018_39966)• 15 years ago |

[Attachment #395146](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") -
Flags: superreview?(roc) → superreview?(neil)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=509602#c12)• 15 years ago |
|  | |

Comment on [attachment 395146](/attachment.cgi?id=395146 "above patch with nit fixed, and without test") [[details]](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") [[diff]](/attachment.cgi?id=395146&action=diff "above patch with nit fixed, and without test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=395146)
above patch with nit fixed, and without test
Roc is on vacation, so perhaps Neil could sr.

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a733533_14006)• 15 years ago |

[Attachment #395146](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") -
Flags: superreview?(neil) → superreview+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=509602#c13)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/945cc6a18e71>

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a763087_255010)• 15 years ago |

blocking1.9.1: --- → ?
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F)Flags: blocking1.9.0.15?

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a776532_11608)• 15 years ago |

Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXEDSummary: Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlyay, tree and DOMAttrModified → Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a879527_255010)• 15 years ago |

[Attachment #395146](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") -
Flags: approval1.9.2?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a929086_1689)• 15 years ago |

blocking1.9.1: ? → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F) → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x+Flags: blocking1.9.0.15?Flags: blocking1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a929137_1689)• 15 years ago |

Whiteboard: [sg:critical?]

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=509602#c14)• 15 years ago |
|  | |

Attached patch

[1.9.1 patch](attachment.cgi?id=396045&action=diff)
— [Details](attachment.cgi?id=396045&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396045)

Just fixed up for context.
[Attachment #396045](/attachment.cgi?id=396045&action=edit "1.9.1 patch") -
Flags: approval1.9.1.4?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=509602#c15)• 15 years ago |
|  | |

Attached patch

[1.9.0 patch](attachment.cgi?id=396046&action=diff)
— [Details](attachment.cgi?id=396046&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396046)

CheckOverflow is called directly instead of off a script runner, and uses the same ScrollParts, so the weakframe check needs to be extended to it. Otherwise the same.
[Attachment #396046](/attachment.cgi?id=396046&action=edit "1.9.0 patch") -
Flags: review?(Olli.Pettay)
[Attachment #396046](/attachment.cgi?id=396046&action=edit "1.9.0 patch") -
Flags: approval1.9.0.15?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a989973_39966)• 15 years ago |

[Attachment #396046](/attachment.cgi?id=396046&action=edit "1.9.0 patch") -
Flags: review?(Olli.Pettay) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=509602#c16)• 15 years ago |
|  | |

Comment on [attachment 396046](/attachment.cgi?id=396046 "1.9.0 patch") [[details]](/attachment.cgi?id=396046&action=edit "1.9.0 patch") [[diff]](/attachment.cgi?id=396046&action=diff "1.9.0 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396046)
1.9.0 patch
Approved for 1.9.0.15, a=dveditz for release-drivers
[Attachment #396046](/attachment.cgi?id=396046&action=edit "1.9.0 patch") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=509602#c17)• 15 years ago |
|  | |

Comment on [attachment 396045](/attachment.cgi?id=396045 "1.9.1 patch") [[details]](/attachment.cgi?id=396045&action=edit "1.9.1 patch") [[diff]](/attachment.cgi?id=396045&action=diff "1.9.1 patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509602&attachment=396045)
1.9.1 patch
Approved for 1.9.1.4, a=dveditz for release-drivers
[Attachment #396045](/attachment.cgi?id=396045&action=edit "1.9.1 patch") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=509602#c18)• 15 years ago |
|  | |

Olli, would you be so kind as to land these on 1.9.0 and 1.9.1 for me?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=509602#c19)• 15 years ago |
|  | |

Checking in layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp;
/cvsroot/mozilla/layout/xul/base/src/tree/src/nsTreeBodyFrame.cpp,v <-- nsTreeBodyFrame.cpp
new revision: 1.357; previous revision: 1.356
done
Checking in layout/xul/base/src/tree/src/nsTreeBodyFrame.h;
/cvsroot/mozilla/layout/xul/base/src/tree/src/nsTreeBodyFrame.h,v <-- nsTreeBodyFrame.h
new revision: 1.126; previous revision: 1.125
doneKeywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=509602#c20)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/713661cc83b2>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a2491637_5038)• 15 years ago |

[Attachment #395146](/attachment.cgi?id=395146&action=edit "above patch with nit fixed, and without test") -
Flags: approval1.9.2? → approval1.9.2+

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=509602#c21)• 15 years ago |
|  | |

Olli, and finally can I ask you to land this on 1.9.2 when it's convenient for you?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=509602#c22)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/7e9fa691511a>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a2682753_5038)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=509602#c23)• 15 years ago |
|  | |

Verified fixed in 1.9.0.15 with Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.15pre) Gecko/2009091606 GranParadiso/3.0.15pre (.NET CLR 3.5.30729) using crashing testcase (and verified crash in 1.9.0.14).Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---) → [verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=509602#c24)• 15 years ago |
|  | |

Verified fixed trunk, 1.9.2, and 1.9.1 by using the crash test too:
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a1pre) Gecko/20091006 Minefield/3.7a1pre (.NET CLR 3.5.30729) ID:20091006044117
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2b1pre) Gecko/20091007 Namoroka/3.6b1pre (.NET CLR 3.5.30729) ID:20091007045631
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.4) Gecko/20091007 Firefox/3.5.4 (.NET CLR 3.5.30729) ID:20091007001339Status: RESOLVED → VERIFIEDKeywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)Target Milestone: --- → mozilla1.9.3a1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a7875165_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=509602#c25)• 15 years ago |
|  | |

Crashtest checked in: <http://hg.mozilla.org/mozilla-central/rev/3256d08b6705>Flags: in-testsuite? → in-testsuite+

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509602#a58037769_1)• 14 years ago |

Crash Signature: [@ nsTreeBodyFrame::InvalidateScrollbars]
You need to [log in](/show_bug.cgi?id=509602&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martijn Wargers (dead)](/user_profile?user_id=55600)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.redhat.com_40c22db7_20250125_161708.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)

# Red Hat Support

## Go beyond support by engaging with our experts

Our teams collaborate with you to ensure you accomplish your goals with Red Hat solutions. The relationship we build with you is designed to provide you with the tools and resources you need to find success on your IT journey.

![](/rhdc/managed-files/support-header.svg)

## Configured for your success

We develop a holistic understanding of your experience as a customer by ensuring our support and engineering teams work together.

Our support team works hand in hand with the best engineers in the industry to quickly turn customer feedback into product improvements. This direct line of communication allows us to hone in on proactive fixes that can impact your bottom line.

### Quick links

* Search our [Knowledgebase](https://access.redhat.com/search/#/?q=&p=1&sort=relevant&scoped&documentKind=Knowledgebase)
* Find [product documentation](https://access.redhat.com/documentation/en-us/)
* Access the [product security center](https://access.redhat.com/security/)
* Connect with [our support team](https://access.redhat.com/support)
* Team up with a [technical account manager](/en/services/support/technical-account-management "Technical account management")
* Take advantage of [partner support](https://connect.redhat.com/en/support)

## Find the right level of support

We have different tiers of support designed to meet your unique needs.

|  | Self-support | Standard | Premium |
| --- | --- | --- | --- |
| Access to Red Hat products | checkmark | checkmark | checkmark |
| Access to our knowledgebase and tools in our award-winning Customer Portal | checkmark | checkmark | checkmark |
| Access to support engineers during standard business hours |  | checkmark | checkmark |
| Access to support engineers 24x7 for high-severity issues |  |  | checkmark |

We also feature specialized support options that can be tailored to the unique needs of companies of all sizes and industries. The Red Hat® [Enhanced Solution Support](/en/resources/enhanced-solution-support-datasheet "Red Hat Enhanced Solution Support: 24x7 engineering support") offering reduces downtime and boosts confidence through access to senior level engineers, as well as resolution and restoration SLAs—helping you stay up and running as you innovate, scale, and deploy. Our engineers help restore your operations quickly and accelerate the path to final resolution, identifying the root cause which helps protect against recurrences in the future. Enhanced Solution Support engineers, who are already familiar with your environment, will be there to assist with critical issues in production environments so that you can consistently deliver the cloud services your customers demand. This offering is available for Red Hat OpenShift® and Red Hat OpenStack® Platform customers.

### Personalized support

Connect with a technical adviser for collaborative planning and specialized guidance. Our Technical Account Managers help you streamline deployments, resolve issues, and shape your technology strategy to meet your toughest business challenges.

[Explore Technical Account Management](/en/services/support/technical-account-management)

## Award winners since 2011

We’ve evolved the traditional software subscription model, combining the best elements of our services to exceed customer expectations. The Association of Support Professionals has honored Red Hat’s Customer Portal as one of “The Top Ten Best Support Websites” for 13 years running.

[See why the Customer Portal keeps earning industry recognition](https://access.redhat.com/)

![Gold and green star with text ASP best support websites of 2023](/rhdc/managed-files/ASP-Award-Design.jpg)

## What they're saying

![BSE logo](/rhdc/managed-files/bse-logo-2.png)

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> We have found the support from Red Hat to be exemplary. Whenever we need anything from them, they have given it … Red Hat is now our backbone. Our business cannot run if Red Hat is not there.
>
> Ashishkumar Chauhan
>
> CEO, BSE

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> I like the fact that they really dig into things and then provide answers. As the single Linux guy, I kind of need that second admin next to me sometimes to say, "Hey, what about this?" and I am able to do that through the portal. I get my questions answered and trouble tickets resolved.
>
> Erik Widholm
>
> Sr. Enterprise Engineer

[Read more user reviews](/en/technologies/linux-platforms/enterprise-linux/user-reviews)

## Have questions?

[Contact Support team](https://access.redhat.com/support)

[Visit the Customer Portal](https://access.redhat.com/)

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from bugzilla.mozilla.org_eb762ff6_20250125_161715.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/489925)
* [XML](/show_bug.cgi?ctype=xml&id=489925)

Closed
[Bug 489925](/show_bug.cgi?id=489925)

Opened 16 years ago
Closed 15 years ago

# Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID

## Categories

### (Core :: XBL, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XBL#XBL)

XBL
▾

Core :: XBL
The Extensible Binding Language, used to bind new behavior and new content to XUL and HTML elements.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XBL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XBL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XBL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/5e699d95460c943a64c4ce3e96ff24fe?d=mm&size=40)  [bgrins](/user_profile?user_id=476442)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[508819](/show_bug.cgi?id=508819 "RESOLVED FIXED - linkedPanel consumers rely on buggy getElementById behavior"), [521639](/show_bug.cgi?id=521639 "RESOLVED INVALID - Since landing of bug 489925 new tab button and tabs close buttons are wrongly positioned with Tabmixplus installed"), [521969](/show_bug.cgi?id=521969 "RESOLVED FIXED - Cannot reference tooltip by a changed ID inside XBL"), [522030](/show_bug.cgi?id=522030 "RESOLVED FIXED - Can still crash due to weak refs in the id table")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[343943](/show_bug.cgi?id=343943 "RESOLVED INACTIVE - [meta] HTML Element and Attribute fuzzer"), [348483](/show_bug.cgi?id=348483 "RESOLVED FIXED - [meta] Fuzzer that makes random XBL bindings")

Dependency [tree](/showdependencytree.cgi?id=489925&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=489925)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sg:critical])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [jst](/user_profile?user_id=12352) | [blocking1.9.2](#a11287401_12352 "15 years ago") | + |
| --- | --- | --- |
| [jst](/user_profile?user_id=12352) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a9132979_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c20 "15 years ago") | + |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsContentUtils::PositionIsBefore ]](https://crash-stats.mozilla.org/signature/?signature=nsContentUtils%3A%3APositionIsBefore)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=374395)  [16 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   786 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=374395&action=edit) |
| --- | --- | --- |
| [Proposed fix](/attachment.cgi?id=392883)  [15 years ago](#c8)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   6.32 KB, patch | jst : [review+](#a11287366_12352 "15 years ago")  jst : [superreview+](#a11287366_12352 "15 years ago")  dveditz : [approval1.9.1.4+](#c18 "15 years ago")  dveditz : [approval1.9.0.15+](#c18 "15 years ago") | [Details](/attachment.cgi?id=392883&action=edit) | [Diff](/attachment.cgi?id=392883&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883) |
| [Patch merged to 1.9.0](/attachment.cgi?id=399309)  [15 years ago](#c21)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   3.27 KB, patch |  | [Details](/attachment.cgi?id=399309&action=edit) | [Diff](/attachment.cgi?id=399309&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=399309) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=489925#c0)• 16 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=374395)
— [Details](attachment.cgi?id=374395&action=edit)

Makes nsContentUtils::PositionIsBefore call random addresses, like 0x72655372.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a299_11608)• 16 years ago |

Whiteboard: [sg:critical]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=489925#c1)• 16 years ago |
|  | |

Doesn't work when loaded from Bugzilla, probably because this is a security-sensitive bug and Bugzilla doesn't allow token reuse.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=489925#c2)• 16 years ago |
|  | |

So fundamentally, I think the issue is that we let document.getElementById (and various other methods that use that table) see XBL anonymous content. The problem is, we might get no notifications when such content is unbound from the document, so we end up with a stale pointer in the id list.
I think the right thing to do is to change the notification handling to ignore anon content, just like content lists do.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=489925#c3)• 16 years ago |
|  | |

This regressed between 2008-03-18 and 2008-03-24:
<http://hg.mozilla.org/mozilla-central/pushloghtml?startdate=2008-03-18+08%3A00%3A00&enddate=2008-03-24+08%3A00%3A00>Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Jonas Sicking (:sicking) No longer reading bugmail consistently](/user_profile?user_id=9186) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a4134158_9186)• 16 years ago |

Assignee: nobody → jonas

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=489925#c4)• 16 years ago |
|  | |

Sorry, I meant a regression between 2009-03-18 and 2009-03-24:
<http://hg.mozilla.org/mozilla-central/pushloghtml?startdate=2009-03-18+08%3A00%3A00&enddate=2009-03-24+08%3A00%3A00>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=489925#c5)• 15 years ago |
|  | |

Yes, that would correspond to the point when the id table started keeping track of notifications in all cases. This could be triggered before that change by simply forcing a live table (do 65 getElementById lookups for nonexistent IDs) before setting up the XBL.
That said, this is not crashing anymore for me... Any idea when that happened?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=489925#c6)• 15 years ago |
|  | |

Hmm. Except for extra fun my nightlies \_are\_ crashing while my self-builds are not...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=489925#c7)• 15 years ago |
|  | |

Ah, I see. This stopped crashing between 2009-08-02-03 (rev: 8366e5cc9f57) and 2009-08-03-03 (rev: 8795a7a9817c). Pushlog range: <http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=8366e5cc9f57&tochange=8795a7a9817c>
Backing out [bug 494546](/show_bug.cgi?id=494546 "RESOLVED FIXED - Make all containing block reconstruction async") locally makes this crash reappear.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=489925#c8)• 15 years ago |
|  | |

Attached patch

[Proposed fix](attachment.cgi?id=392883&action=diff)
— [Details](attachment.cgi?id=392883&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883)

Pretty straightforward patch; the test makes it clear why we want to make this change.
Note that I could have called the nsContentUtils method that nsContentList calls, but since we know we're a document, we can avoid the extra IsNodeOfType check that call would entail....Assignee: jonas → bzbarskyStatus: NEW → ASSIGNED
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: review?(jst)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=489925#c9)• 15 years ago |
|  | |

For extra fun, that patch causes some chrome mochitests to fail. Investigating now.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=489925#c10)• 15 years ago |
|  | |

We probably need to fix this on branches, though the compat issue sort of scares me....blocking1.9.1: --- → ?Flags: blocking1.9.2?Flags: blocking1.9.0.14?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=489925#c11)• 15 years ago |
|  | |

I suppose for branches we could try not changing the hashtable behavior but somehow notifying on binding teardown... That sounds pretty risky in terms of getting the code right, though, even if it might have better extension compat.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a9037717_20209)• 15 years ago |

Depends on: [508819](/show_bug.cgi?id=508819 "RESOLVED FIXED - linkedPanel consumers rely on buggy getElementById behavior")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=489925#c12)• 15 years ago |
|  | |

I filed [bug 508819](/show_bug.cgi?id=508819 "RESOLVED FIXED - linkedPanel consumers rely on buggy getElementById behavior") on the sessionstore issue. It's actually assuming it can get anon nodes via getElementById....

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=489925#c13)• 15 years ago |
|  | |

This hasn't landed on trunk yet. I think we should fix it, but it should probably wait 'til the next release since we're supposed to freeze this coming Tuesday.blocking1.9.1: ? → neededFlags: blocking1.9.0.14? → blocking1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a9132979_1689)• 15 years ago |

blocking1.9.1: needed → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.0.15? → blocking1.9.0.15+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a11287366_12352)• 15 years ago |

[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: superreview+
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: review?(jst)
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=489925#c14)• 15 years ago |
|  | |

Comment on [attachment 392883](/attachment.cgi?id=392883 "Proposed fix") [[details]](/attachment.cgi?id=392883&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=392883&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883)
Proposed fix
bz, any updates on this breaking chrome mochitests? If it isn't, r+sr=jst...

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a11287401_12352)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2Target Milestone: --- → mozilla1.9.2

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=489925#c15)• 15 years ago |
|  | |

> bz, any updates on this breaking chrome mochitests?
I fixed that in [bug 508819](/show_bug.cgi?id=508819 "RESOLVED FIXED - linkedPanel consumers rely on buggy getElementById behavior").

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=489925#c16)• 15 years ago |
|  | |

Pushed <http://hg.mozilla.org/mozilla-central/rev/c5fe17b1caa9>Status: ASSIGNED → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=489925#c17)• 15 years ago |
|  | |

Comment on [attachment 392883](/attachment.cgi?id=392883 "Proposed fix") [[details]](/attachment.cgi?id=392883&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=392883&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883)
Proposed fix
Need this on all the branches too.
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.2?
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.1.4?
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=489925#c18)• 15 years ago |
|  | |

Comment on [attachment 392883](/attachment.cgi?id=392883 "Proposed fix") [[details]](/attachment.cgi?id=392883&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=392883&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883)
Proposed fix
Approved for 1.9.1.4 and 1.9.0.15, a=dveditz for release-drivers
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.1.4?
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.1.4+
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.0.15?
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.0.15+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=489925#c19)• 15 years ago |
|  | |

Comment on [attachment 392883](/attachment.cgi?id=392883 "Proposed fix") [[details]](/attachment.cgi?id=392883&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=392883&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=392883)
Proposed fix
This doesn't need approval1.9.2 since it's already blocking.
[Attachment #392883](/attachment.cgi?id=392883&action=edit "Proposed fix") -
Flags: approval1.9.2?

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a11538518_76551)• 15 years ago |

Target Milestone: mozilla1.9.2 → mozilla1.9.3a1

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=489925#c20)• 15 years ago |
|  | |

Pushed:
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/936e1b6732a0>
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/dd9b10ed7eeb>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)Flags: in-testsuite+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=489925#c21)• 15 years ago |
|  | |

Attached patch

[Patch merged to 1.9.0](attachment.cgi?id=399309&action=diff)
— [Details](attachment.cgi?id=399309&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=489925&attachment=399309)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=489925#c22)• 15 years ago |
|  | |

Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.793; previous revision: 3.792Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=489925#c23)• 15 years ago |
|  | |

Running the attached test case on OS X on Firefox 3.5.3 does not cause a crash on load. This was loading the case over http from my own webserver (not bugzilla) as well.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=489925#c24)• 15 years ago |
|  | |

This is also the case when using the testcase on my own webserver with Firefox 3.0.14. I cannot reproduce the crash.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=489925#c25)• 15 years ago |
|  | |

Jesse, any suggestions on getting the testcase to crash with pre-fix builds?

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=489925#c26)• 15 years ago |
|  | |

I was testing loading from file:, using a Mac build from mozilla-central at the time. Try that?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=489925#c27)• 15 years ago |
|  | |

Tried doing that with retail and debug 1.9.1.3 and no crash. Looks like it might be trunk only.

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=489925#c28)• 15 years ago |
|  | |

verified with: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US;
rv:1.9.3a1pre) Gecko/20090930 Minefield/3.7a1pre and Mozilla/5.0 (Macintosh; U;
Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20091001 Shiretoko/3.5.4preStatus: RESOLVED → VERIFIEDKeywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a14819152_76551)• 15 years ago |

Depends on: [521639](/show_bug.cgi?id=521639 "RESOLVED INVALID - Since landing of bug 489925 new tab button and tabs close buttons are wrongly positioned with Tabmixplus installed")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a14905791_20209)• 15 years ago |

Depends on: [521969](/show_bug.cgi?id=521969 "RESOLVED FIXED - Cannot reference tooltip by a changed ID inside XBL")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a14930387_20209)• 15 years ago |

Depends on: [522030](/show_bug.cgi?id=522030 "RESOLVED FIXED - Can still crash due to weak refs in the id table")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a17286155_1689)• 15 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=489925#a67448723_1)• 14 years ago |

Crash Signature: [@ nsContentUtils::PositionIsBefore]
You need to [log in](/show_bug.cgi?id=489925&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.vupen.com_cddaa5c4_20250125_161710.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.mozilla.org_1cce5357_20250126_101252.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 02:12:51 PST

* **Bug ID:**
  514776,
  497013,
  508927,
  509602,
  509244,
  489925,
  522030,
  454872

---

| [ID](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [522030](/show_bug.cgi?id=522030 "RESOLVED FIXED - Can still crash due to weak refs in the id table") |  | [Can still crash due to weak refs in the id table](/show_bug.cgi?id=522030) | Core | XUL | bzbarsky | RESO | FIXE | 2009-11-09 |
| [508927](/show_bug.cgi?id=508927 "RESOLVED FIXED - \"ASSERTION: returning frame that is not in childlist\" with xul:listboxbody, XBL") |  | ["ASSERTION: returning frame that is not in childlist" with xul:listboxbody, XBL](/show_bug.cgi?id=508927) | Core | XUL | tnikkel | RESO | FIXE | 2010-02-08 |
| [514776](/show_bug.cgi?id=514776 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow") |  | [GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow](/show_bug.cgi?id=514776) | Core | Graphics: ImageLib | alfredkayser | RESO | FIXE | 2009-11-09 |
| [497013](/show_bug.cgi?id=497013 "RESOLVED FIXED - Crash [@ SinkContext::~SinkContext] with document.write in -moz-binding") |  | [Crash [@ SinkContext::~SinkContext] with document.write in -moz-binding](/show_bug.cgi?id=497013) | Core | DOM: HTML Parser | mrbkap | RESO | FIXE | 2011-06-13 |
| [509244](/show_bug.cgi?id=509244 "RESOLVED FIXED - gfx crash on memory-pressure notification") |  | [gfx crash on memory-pressure notification](/show_bug.cgi?id=509244) | Core | Graphics | vladimir | RESO | FIXE | 2009-11-01 |
| [489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID") |  | [Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID](/show_bug.cgi?id=489925) | Core | XBL | bzbarsky | VERI | FIXE | 2011-06-13 |
| [454872](/show_bug.cgi?id=454872 "VERIFIED FIXED - Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]") |  | [Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]](/show_bug.cgi?id=454872) | Core | Web Painting | MatsPalmgren\_bugz | VERI | FIXE | 2022-03-24 |
| [509602](/show_bug.cgi?id=509602 "VERIFIED FIXED - Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified") |  | [Crash [@ nsTreeBodyFrame::InvalidateScrollbars] with overlay, tree and DOMAttrModified](/show_bug.cgi?id=509602) | Core | Layout | tnikkel | VERI | FIXE | 2011-06-13 |

8 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=514776%2C497013%2C508927%2C509602%2C509244%2C489925%2C522030%2C454872&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from www.mandriva.com_99336644_20250125_161704.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from bugzilla.mozilla.org_b8e96b42_20250125_161713.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/454872)
* [XML](/show_bug.cgi?ctype=xml&id=454872)

Closed
[Bug 454872](/show_bug.cgi?id=454872)

Opened 16 years ago
Closed 15 years ago

# Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]

## Categories

### (Core :: Web Painting, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Web%20Painting#Web%20Painting)

Web Painting
▾

Core :: Web Painting
Construction of display lists, hit-testing, building of Layers and painting.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Web%20Painting&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Web%20Painting&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Web%20Painting)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: db94127, Assigned: MatsPalmgren\_bugz, NeedInfo)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/777c5fc8cbf4fc800036ffee7fd27e89?d=mm&size=40)  [db94127](/user_profile?user_id=324529)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

NeedInfo From:

 [tbg137](/user_profile?user_id=600787)

[7 years ago](#c39)

[NeedInfo:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#needinfo)

Update

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[465360](/show_bug.cgi?id=465360 "RESOLVED DUPLICATE - Add full-text index to frames.signature")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=454872&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=454872)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, fixed1.9.0.15, verified1.9.1, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.2](#a31464877_5038 "15 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a29988511_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a29988511_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsScrollPortView::IncrementalScroll() ]](https://crash-stats.mozilla.org/signature/?signature=nsScrollPortView%3A%3AIncrementalScroll%28%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Patch rev. 1](/attachment.cgi?id=395330)  [15 years ago](#c17)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   975 bytes, patch | roc : [review+](#a29909752_5038 "15 years ago")  dveditz : [superreview+](#c32 "15 years ago")  roc : [approval1.9.2+](#a31273637_5038 "15 years ago")  samuel.sidler+old : [approval1.9.1.4+](#c33 "15 years ago") | [Details](/attachment.cgi?id=395330&action=edit) | [Diff](/attachment.cgi?id=395330&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=395330) |
| --- | --- | --- |
| [for 1.9.0](/attachment.cgi?id=396338)  [15 years ago](#c26)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   1.05 KB, patch | samuel.sidler+old : [approval1.9.0.15+](#a31526079_190622 "15 years ago") | [Details](/attachment.cgi?id=396338&action=edit) | [Diff](/attachment.cgi?id=396338&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=396338) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=454872#c0)• 16 years ago |
|  | |

User-Agent: Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10.4; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1
Build Identifier: Mozilla/5.0 (Macintosh; U; PPC Mac OS X 10.4; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1
Yesterday set preferences to "Use smooth scrolling" (unchecked "Use Autoscrolling). Today multiple crashes while attempting to scroll. Seems much worse when attempting to scroll while page is loading/reloading, but sometimes happens even when page is loaded.
Reset to "Use Autoscrolling"; now seems stable again.
Reproducible: Sometimes
Steps to Reproduce:
1.See above.
2.
3.
Actual Results:
See above.
If I can help with any testing or provide additional info, please advise.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=454872#c1)• 16 years ago |
|  | |

Daniel: I am not able to reproduce this using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.1) Gecko/2008070206 Firefox/3.0.1 or with the 3.0.2 candidate.
Which particular site were you scrolling? Can you type about:crashes and provide a crash URL?

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=454872#c2)• 16 years ago |
|  | |

I was not able to reproduce on a PPC machine either using 3.0.1.

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=454872#c3)• 16 years ago |
|  | |

Hi Marcia-
Yes, I was able to reproduce the problem by (as before) changing the Firefox scrolling preferences to "Use smooth scrolling" and unchecking "Use
Autoscrolling". Again, the problem seems to be associated with attempting to scroll while a page is loading or reloading.
The URL that I tested this time was: <http://www.newsweek.com/id/158429?from=rss>
The URL info after "www.newsweek.com/" is specific to a particular Newsweek article... The previous crashes occurred at the same Newsweek URL but with different specific articles.
To obtain more of a sampling, I also just tried a Washington Post newsarticle:
<http://www.washingtonpost.com/wp-dyn/content/article/2008/09/07/AR2008090702262.html?nav=rss_world>
and I was able to crash at that site also.
Finally, I tried the same thing while reloading [https://bugzilla.mozilla.org/show\_bug.cgi?id=454872](/show_bug.cgi?id=454872 "VERIFIED FIXED - Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]"), but was not able to crash the browser.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=454872#c4)• 16 years ago |
|  | |

Daniel, please submit the crash data and then give us its ID. You can see
the IDs if you enter about:crashes in the url bar. See:
[http://support.mozilla.com/en-US/kb/Mozilla+Crash+Reporter#Viewing\_crash\_reports](http://support.mozilla.com/en-US/kb/Mozilla%2BCrash%2BReporter#Viewing_crash_reports)

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=454872#c5)• 16 years ago |
|  | |

OK, here are the last three, they all seem to be essentially identical:
75504d80-805f-11dd-88a4-0013211cbf8a
Signature nsScrollPortView::IncrementalScroll()
UUID 75504d80-805f-11dd-88a4-0013211cbf8a
Time 2008-09-11 17:12:01-07
Uptime 765
Product Firefox
Version 3.0.1
Build ID 2008070206
OS Mac OS X
OS Version 10.4.10 8R218
CPU ppc
CPU Info
Crash Reason EXC\_BAD\_ACCESS / KERN\_PROTECTION\_FAILURE
Crash Address 0x2d477df8
Comments
9e6ff26b-805d-11dd-8d41-001a4bd43ef6
Signature nsScrollPortView::IncrementalScroll()
UUID 9e6ff26b-805d-11dd-8d41-001a4bd43ef6
Time 2008-09-11 16:58:52-07
Uptime 53
Product Firefox
Version 3.0.1
Build ID 2008070206
OS Mac OS X
OS Version 10.4.10 8R218
CPU ppc
CPU Info
Crash Reason EXC\_BAD\_ACCESS / KERN\_PROTECTION\_FAILURE
Crash Address 0x2d477df8
Comments
e28da64c-8033-11dd-802e-001321b13766
Signature nsScrollPortView::IncrementalScroll()
UUID e28da64c-8033-11dd-802e-001321b13766
Time 2008-09-11 12:00:10-07
Uptime 1048
Product Firefox
Version 3.0.1
Build ID 2008070206
OS Mac OS X
OS Version 10.4.10 8R218
CPU ppc
CPU Info
Crash Reason EXC\_BAD\_ACCESS / KERN\_PROTECTION\_FAILURE
Crash Address 0x2d477df8
Comments

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=454872#c6)• 16 years ago |
|  | |

Thanks for trying to figure this out!
db

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=454872#c7)• 16 years ago |
|  | |

For what it may be worth, here are all of the similar reports that I was able to find:
263609 (Windows)
385100 (Windows)
433365 (Mac)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=454872#c8)• 16 years ago |
|  | |

Possibly fixed in Firefox 3.0.2 by [bug 435422](/show_bug.cgi?id=435422 "VERIFIED FIXED - crash [@ nsScrollPortView::IncrementalScroll()]"). You can try with the
release candidates here (which includes the fix):
<http://ftp.mozilla.org/pub/mozilla.org/firefox/nightly/3.0.2-candidates/>
or you can wait until it's officially released (currently planned for
Tuesday 16th but it might be later).Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Summary: Crashes while scrolling → Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=454872#c9)• 16 years ago |
|  | |

Thanks for the info. Since it doesn't crash unless I change the scrolling preferences it's not a big deal. I think that I'll wait for the official rollout.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=454872#c10)• 16 years ago |
|  | |

FYI, Firefox 3.0.2 is available now.

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=454872#c11)• 16 years ago |
|  | |

Mats- thanks a lot for keeping on top of this. I'll let you know how things work out after I download 3.0.2

|  | [Daniel Banchero](/user_profile?user_id=324529)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=454872#c12)• 16 years ago |
|  | |

Looks like you folks have nailed it. 3.0.2 seems to work just fine as far as the scrolling preferences are concerned.
Thanks to all.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=454872#c13)• 16 years ago |
|  | |

Ok, good to hear it's working for you. I'll leave the bug open for now
since I can't query crash statistics at the moment ([bug 444749](/show_bug.cgi?id=444749 "RESOLVED FIXED - Complex or long searches are timing out")) and
I want to verify it's really gone in 3.0.2.Assignee: nobody → mats.palmgrenDepends on: [444749](/show_bug.cgi?id=444749 "RESOLVED FIXED - Complex or long searches are timing out")

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=454872#c14)• 16 years ago |
|  | |

There are still some crash reports for 3.0.2 and 3.0.3 I'm afraid.

|  | [Michael Morgan [:morgamic]](/user_profile?user_id=83665) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a5779499_83665)• 16 years ago |

No longer depends on: [444749](/show_bug.cgi?id=444749 "RESOLVED FIXED - Complex or long searches are timing out")

|  | [Michael Morgan [:morgamic]](/user_profile?user_id=83665) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a5779507_83665)• 16 years ago |

Depends on: [465360](/show_bug.cgi?id=465360 "RESOLVED DUPLICATE - Add full-text index to frames.signature")

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=454872#c15)• 15 years ago |
|  | |

There were 72 crashes in the last week at nsScrollPortView::IncrementalScroll. All OSes are represented, but Mac is especially heavy. Both active releases of Firefox, 3.0.x and 3.5.x, are represented.
<http://crash-stats.mozilla.com/report/list?product=Firefox&query_search=signature&query_type=startswith&query=nsScrollPortView%3A%3AIncrementalScroll%28%29&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsScrollPortView%3A%3AIncrementalScroll%28%29>

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=454872#c16)• 15 years ago |
|  | |

Looking at the code I'm guessing the nsScrollPortView is dead by the time
we execute line 726:
<http://hg.mozilla.org/releases/mozilla-1.9.1/annotate/345e7a83db64/view/src/nsScrollPortView.cpp#l726>
Assuming nsScrollPortView::ScrollToImpl() can execute arbitrary stuff like
deleting the 'this' nsScrollPortView we're currently using.OS: Mac OS X → AllHardware: PowerPC → AllWhiteboard: [sg:critical?]

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29537167_11608)• 15 years ago |

Group: core-security

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=454872#c17)• 15 years ago |
|  | |

Attached patch

[Patch rev. 1](attachment.cgi?id=395330&action=diff)
— [Details](attachment.cgi?id=395330&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=395330)

Should fix it if my assumption is right.
[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: review?(mstange)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=454872#c18)• 15 years ago |
|  | |

nsScrollPortView::ScrollToImpl calls
nsScrollPortView::Scroll calls
nearestWidget->Scroll
There's an analysis of widget methods that reach nsChildView::DispatchEvent
(which executes arbitrary stuff) in [bug 402505](/show_bug.cgi?id=402505 "VERIFIED FIXED - Crash [@ libobjc.A.dylib@objc_msgSend AppKit@[NSTSMInputContext interpretKeyEvents:] AppKit@[NSView interpretKeyEvents:] [ChildView keyDown:]]").
nsChildView::Scroll is in that list. Seems like a good idea to audit
nsScrollPortView for calls reaching anything on that list.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=454872#c19)• 15 years ago |
|  | |

... although the list could be out-dated by now of course ...

|  | [Markus Stange [:mstange]](/user_profile?user_id=293943) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=454872#c20)• 15 years ago |
|  | |

The patch looks good to me, but I'm not a peer of this code.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=454872#c21)• 15 years ago |
|  | |

Sorry, I assumed you were...

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29546555_5168)• 15 years ago |

[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: review?(mstange) → review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29909752_5038)• 15 years ago |

[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=454872#c22)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/15c3a72d8aac>Status: NEW → RESOLVEDClosed: 15 years agoFlags: wanted-firefox3.5?Flags: blocking1.9.0.14?Flags: blocking-firefox3.6?Resolution: --- → FIXED

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29920158_5168)• 15 years ago |

[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: approval1.9.2?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=454872#c23)• 15 years ago |
|  | |

Pushing out Mats' request to 1.9.0.15 since we're basically code frozen for 1.9.0.14.blocking1.9.1: --- → ?Flags: blocking1.9.0.14? → blocking1.9.0.15?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29944485_159758)• 15 years ago |

Component: General → Layout: View RenderingFlags: wanted-firefox3.5?Flags: blocking-firefox3.6?Product: Firefox → CoreQA Contact: general → layout.view-rendering

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29944538_159758)• 15 years ago |

Flags: blocking1.9.2?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a29988511_1689)• 15 years ago |

blocking1.9.1: ? → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x+Flags: blocking1.9.0.15?Flags: blocking1.9.0.15+Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=454872#c24)• 15 years ago |
|  | |

Mats: When this lands on 1.9.2, please request approval1.9.0.15 and approval1.9.1.4 on it (or if it doesn't apply, please attach a patch that does).

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=454872#c25)• 15 years ago |
|  | |

ok

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=454872#c26)• 15 years ago |
|  | |

Attached patch

[for 1.9.0](attachment.cgi?id=396338&action=diff)
— [Details](attachment.cgi?id=396338&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=396338)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31273637_5038)• 15 years ago |

[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: approval1.9.2? → approval1.9.2+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=454872#c27)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/635177741480>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31291019_5168)• 15 years ago |

[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: approval1.9.1.4?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31291033_5168)• 15 years ago |

[Attachment #396338](/attachment.cgi?id=396338&action=edit "for 1.9.0") -
Flags: approval1.9.0.15?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=454872#c28)• 15 years ago |
|  | |

Comment on [attachment 395330](/attachment.cgi?id=395330 "Patch rev. 1") [[details]](/attachment.cgi?id=395330&action=edit "Patch rev. 1") [[diff]](/attachment.cgi?id=395330&action=diff "Patch rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=395330)
Patch rev. 1
As a security bug, per our new policy, this patch needs explicit superview from a second person. It should \*not\* have landed on trunk or 1.9.2 without that superview. Please be mindful of that in the future.
<http://www.mozilla.org/hacking/reviewers.html>
Tagging dbaron for superview.
[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: superreview?(dbaron)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31441061_190622)• 15 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs sr=dbaron]

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=454872#c29)• 15 years ago |
|  | |

That's a bad policy, as I've said before.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=454872#c30)• 15 years ago |
|  | |

There are many bad policies, but it \*is\* a policy and we'll keep enforcing it until it's no longer a policy.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=454872#c31)• 15 years ago |
|  | |

(In reply to [comment #28](/show_bug.cgi?id=454872#c28 "VERIFIED FIXED - Crashes while scrolling [@ nsScrollPortView::IncrementalScroll()]"))
Sorry I missed that!

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31464877_5038)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=454872#c32)• 15 years ago |
|  | |

Comment on [attachment 395330](/attachment.cgi?id=395330 "Patch rev. 1") [[details]](/attachment.cgi?id=395330&action=edit "Patch rev. 1") [[diff]](/attachment.cgi?id=395330&action=diff "Patch rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=395330)
Patch rev. 1
sr=dveditz
[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: superreview?(dbaron) → superreview+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31526004_1689)• 15 years ago |

Whiteboard: [sg:critical?][needs sr=dbaron] → [sg:critical?]

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=454872#c33)• 15 years ago |
|  | |

Comment on [attachment 395330](/attachment.cgi?id=395330 "Patch rev. 1") [[details]](/attachment.cgi?id=395330&action=edit "Patch rev. 1") [[diff]](/attachment.cgi?id=395330&action=diff "Patch rev. 1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=395330)
Patch rev. 1
Approved for 1.9.1.4. a=ss for release-drivers
[Attachment #395330](/attachment.cgi?id=395330&action=edit "Patch rev. 1") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a31526079_190622)• 15 years ago |

[Attachment #396338](/attachment.cgi?id=396338&action=edit "for 1.9.0") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=454872#c34)• 15 years ago |
|  | |

Comment on [attachment 396338](/attachment.cgi?id=396338 "for 1.9.0") [[details]](/attachment.cgi?id=396338&action=edit "for 1.9.0") [[diff]](/attachment.cgi?id=396338&action=diff "for 1.9.0") [[review]](/page.cgi?id=splinter.html&ignore=&bug=454872&attachment=396338)
for 1.9.0
Approved for 1.9.0.15. a=ss for release-drivers

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=454872#c35)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/b3536c557f1e>
On CVS HEAD:
mozilla/view/src/nsScrollPortView.cpp 3.91
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=454872#c36)• 15 years ago |
|  | |

I can't reproduce this issue with Firefox 3.5.3 on OS X 10.6.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=454872#c37)• 15 years ago |
|  | |

I can't reproduce this issues with Firefox 3.0.14 on OS X 10.6 either.

|  | [Tracy Walker [:tracy]](/user_profile?user_id=18566) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=454872#c38)• 15 years ago |
|  | |

verified with: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.3a1pre) Gecko/20090930 Minefield/3.7a1pre and Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20091001 Shiretoko/3.5.4preStatus: RESOLVED → VERIFIEDKeywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a36657350_1689)• 15 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a86819985_1)• 14 years ago |

Crash Signature: [@ nsScrollPortView::IncrementalScroll()]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a223856721_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Amber Reed](/user_profile?user_id=600787) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=454872#c39)• 7 years ago |
|  | |

Thanks for sharing this information.
<http://tattoosboygirl.com/viking-tattoos/>Flags: needinfo?(tbg137)

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=454872#a314416925_1)• 6 years ago |

Component: Layout: View Rendering → Layout: Web Painting

|  | [Yoshika Levan](/user_profile?user_id=703640) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=454872#c41)• 3 years ago |
|  | |

Such a Good Useful Post Thanks for Share with us . birthday cupcake

birthday cupcakes

<https://ibirthdaycake.com/>

birthday cupcake ideas

You need to [log in](/show_bug.cgi?id=454872&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Mats Palmgren (inactive)](/user_profile?user_id=5168)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_7c9a3857_20250125_161721.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/509244)
* [XML](/show_bug.cgi?ctype=xml&id=509244)

Closed
[Bug 509244](/show_bug.cgi?id=509244)

Opened 15 years ago
Closed 15 years ago

# gfx crash on memory-pressure notification

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

gfx crash on memory-pressure notification

## Categories

### (Core :: Graphics, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: vlad, Assigned: vlad)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/108731b114a7c04438631b4c2dc3c7d5?d=mm&size=40)  [vlad](/user_profile?user_id=24534)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/108731b114a7c04438631b4c2dc3c7d5?d=mm&size=40)  [vlad](/user_profile?user_id=24534)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

11 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[419125](/show_bug.cgi?id=419125 "RESOLVED FIXED - Remove DeviceContextImpl and nsRenderingContextImpl")

Dependency [tree](/showdependencytree.cgi?id=509244&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=509244)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.9.0.15, Whiteboard: [nv])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[nv]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [vlad](/user_profile?user_id=24534) | [blocking1.9.2](#a520075_24534 "15 years ago") | + |
| --- | --- | --- |
| [vlad](/user_profile?user_id=24534) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a2320856_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a2320856_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.8.1.x](#a2320856_1689 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.8.1.x | - |
| --- | --- | --- |
| [karlt](/user_profile?user_id=274246) | [in-testsuite](#c22 "15 years ago") | + |
| --- | --- | --- |
| [karlt](/user_profile?user_id=274246) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [fix](/attachment.cgi?id=393386)  [15 years ago](#c0)  [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)   549 bytes, patch | karlt : [review+](#a116316_274246 "15 years ago")  pavlov : [superreview+](#a2256270_5756 "15 years ago")  dveditz : [approval1.9.1.4+](#c16 "15 years ago")  dveditz : [approval1.9.0.15+](#c16 "15 years ago") | [Details](/attachment.cgi?id=393386&action=edit) | [Diff](/attachment.cgi?id=393386&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=393386) |
| --- | --- | --- |
| [mochitest crash test](/attachment.cgi?id=401127)  [15 years ago](#c18)  [Karl Tomlinson (:karlt)](/user_profile?user_id=274246)   2.19 KB, patch |  | [Details](/attachment.cgi?id=401127&action=edit) | [Diff](/attachment.cgi?id=401127&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=401127) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=509244#c0)• 15 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=393386&action=diff)
— [Details](attachment.cgi?id=393386&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=393386)

Went over this with karlt and stuart in irc..
13:22 < vlad> so there's this function and code: <http://mxr.mozilla.org/mozilla>-
central/source/gfx/src/thebes/nsThebesDeviceContext.cpp#258
13:23 < vlad> it calls NS\_RELEASE and then maybe addrefs again
13:23 < vlad> but
13:23 < vlad> <http://mxr.mozilla.org/mozilla-central/source/gfx/src/thebes/nsThebesFontMetrics.cpp#59>
13:23 < vlad> Destroy() in nsThebesFontMetrics doesn't do anything
13:24 < vlad> and the destructor just deletes a member
13:24 < vlad> so it'll never get removed from that font cache array.. and we'll addref bogus memory, no?
13:25 < vlad> as best I can tell from mxr, nothing ever calls FontMetricsDeleted in our code
13:25 < vlad> (I'm hitting a crash in Compact, when I issue a memory pressure notification)
13:32 < karl> yeah, doesn't look right to me either
13:32 < vlad> I don't even know what that font cache does
13:32 < vlad> I trhink I have it fixed, at least not to crash
13:32 < vlad> I just call the FontMetricsDeleted from the destructor on mDeviceContext
13:33 < karl> i thought it did look right at one time in the past, but maybe i just believed the comments
13:36 < karl> this pattern appears quite a bit:
13:36 < karl> fm->Destroy();
13:36 < karl> NS\_RELEASE(fm);
13:37 < vlad> fm->Destroy() should set its device context to null from I can tell
13:37 < vlad> and actually releasing it shouldn' call FontMetricsDeleted if the dc is null
13:37 < vlad> in the places where that pattern appears, fm is destroyed/released only if initialization fails
13:40 < karl> are you seeing the crash in AddRef()?
13:43 < vlad> in the release, actually
13:43 < vlad> the addrefs happen too quickly, the memory still looks semi-valid
13:43 < karl> looks like FontMetricsDeleted is meant to be called from FontMetricsDeleted
13:43 < vlad> but the second time around through a memory pressure notifier after that memory got reused
13:43 < karl> i mean
13:44 < karl> looks like FontMetricsDeleted is meant to be called from ~nsThebesFontMetrics
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: review?(mozbugz)

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=509244#c1)• 15 years ago |
|  | |

this sounds like a bug romaxa filed

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a116316_274246)• 15 years ago |

[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: review?(mozbugz) → review+

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=509244#c2)• 15 years ago |
|  | |

the bug i had in mind is [bug 503784](/show_bug.cgi?id=503784 "RESOLVED FIXED - nsFontCache::Compact crashes on heap-minimize notification [@ nsFontCache::Compact]").
note that not filing bugs with crash signatures as you did here means that it's hard for people to find duplicates. please cooperate with the other users of bugzilla by including crash signatures in your bug summaries.

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=509244#c3)• 15 years ago |
|  | |

i'd like to further point out that i specifically asked you, vlad, for a review in that bug, and you bounced the review. i consider this inappropriate.

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=509244#c5)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/11bd05bebf85>
I am, as part of my job, doing fewer gfx reviews, which is why that review was bounced (as were most gfx-related reviews that would have good reviewers amongst the gfx team).Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a520075_24534)• 15 years ago |

Flags: blocking1.9.2+Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)Whiteboard: [nv]

|  | [Brian Crowder](/user_profile?user_id=253737) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=509244#c6)• 15 years ago |
|  | |

I'm still seeing a bug that looks a lot like this when I use the faststart component's memory-pressure feature:
> xul.dll!nsFontCache::Compact() Line 272 + 0x9 bytes C++
xul.dll!nsThebesDeviceContext::Observe(nsISupports \* aSubject=0x00000000, const char \* aTopic=0x0521e298, const wchar\_t \* aSomeData=0x0364cec8) Line 358 C++
xul.dll!nsObserverList::NotifyObservers(nsISupports \* aSubject=0x00000000, const char \* aTopic=0x0521e298, const wchar\_t \* someData=0x0364cec8) Line 129 C++
xul.dll!nsObserverService::NotifyObservers(nsISupports \* aSubject=0x00000000, const char \* aTopic=0x0521e298, const wchar\_t \* someData=0x0364cec8) Line 185 C++
xul.dll!NS\_InvokeByIndex\_P(nsISupports \* that=0x00000005, unsigned int methodIndex=0x00000003, unsigned int paramCount=0x0012d8f0, nsXPTCVariant \* params=0x00000001) Line 102 C++
xul.dll!XPCWrappedNative::CallMethod(XPCCallContext & ccx={...}, XPCWrappedNative::CallMode mode=CALL\_METHOD) Line 2710 + 0x20 bytes C++

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=509244#c7)• 15 years ago |
|  | |

we're still seeing this crashStatus: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Benjamin Stover (:stechz)](/user_profile?user_id=355191) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a1658873_355191)• 15 years ago |

Blocks: [451670](/show_bug.cgi?id=451670 "RESOLVED FIXED - Discard tab data on when low on memory")

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=509244#c8)• 15 years ago |
|  | |

Hmm, my comment was lost earlier. Need more information from the crash, like looking at data and all that. karlt should look at/fix this, because we can probably just get rid of most of this code.

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=509244#c9)• 15 years ago |
|  | |

just take a look at <http://mxr.mozilla.org/mozilla-central/source/gfx/src/thebes/nsThebesDeviceContext.cpp#258> -- its use of oldfm is clearly horrible.

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=509244#c10)• 15 years ago |
|  | |

or maybe the code is just gross, and not wrong. can get a stack -- it crashes all the time on maemo.

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=509244#c11)• 15 years ago |
|  | |

A bug was fixed here. Let's fix the next bug in [bug 503784](/show_bug.cgi?id=503784 "RESOLVED FIXED - nsFontCache::Compact crashes on heap-minimize notification [@ nsFontCache::Compact]").Status: REOPENED → RESOLVEDClosed: 15 years ago → 15 years agoResolution: --- → FIXED

|  | [Benjamin Stover (:stechz)](/user_profile?user_id=355191) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a1729566_355191)• 15 years ago |

No longer blocks: [451670](/show_bug.cgi?id=451670 "RESOLVED FIXED - Discard tab data on when low on memory")

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2150201_190622)• 15 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2193462_274246)• 15 years ago |

Group: core-securityblocking1.9.1: --- → ?Flags: blocking1.9.0.14?

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2193519_274246)• 15 years ago |

[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.1.3?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.0.14?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2194855_190622)• 15 years ago |

Flags: blocking1.9.0.14? → blocking1.9.0.15?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=509244#c13)• 15 years ago |
|  | |

Comment on [attachment 393386](/attachment.cgi?id=393386 "fix") [[details]](/attachment.cgi?id=393386&action=edit "fix") [[diff]](/attachment.cgi?id=393386&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=393386)
fix
Pushing out approval requests...
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.1.4?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.1.3?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.0.15?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.0.14?

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2197671_274246)• 15 years ago |

[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: superreview?(pavlov)

|  | [Stuart Parmenter](/user_profile?user_id=5756) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2256270_5756)• 15 years ago |

[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: superreview?(pavlov) → superreview+

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=509244#c14)• 15 years ago |
|  | |

Tony, due to the lack of a device I'm not able to verify this fix. Could you or Marcia check if the crash went away? Thanks.Target Milestone: --- → mozilla1.9.3a1

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=509244#c15)• 15 years ago |
|  | |

The bugs that depend on [bug 503784](/show_bug.cgi?id=503784 "RESOLVED FIXED - nsFontCache::Compact crashes on heap-minimize notification [@ nsFontCache::Compact]") seem to confirm that this is now fixed but we should be able to write a test using nsIMemory::heapMinimize().

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2298942_76551)• 15 years ago |

Flags: in-testsuite?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a2320856_1689)• 15 years ago |

blocking1.9.1: ? → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x+Flags: wanted1.8.1.x-Flags: blocking1.9.0.15?Flags: blocking1.9.0.15+Whiteboard: [nv] → [nv][sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=509244#c16)• 15 years ago |
|  | |

Comment on [attachment 393386](/attachment.cgi?id=393386 "fix") [[details]](/attachment.cgi?id=393386&action=edit "fix") [[diff]](/attachment.cgi?id=393386&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=393386)
fix
Approved for 1.9.1.4 and 1.9.0.15, a=dveditz for release-drivers
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.1.4?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.1.4+
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.0.15?
[Attachment #393386](/attachment.cgi?id=393386&action=edit "fix") -
Flags: approval1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a3275287_1689)• 15 years ago |

Assignee: nobody → vladimir

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=509244#c17)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/b7dd9891657f>
<http://bonsai.mozilla.org/cvsquery.cgi?module=PhoenixTinderbox&branch=HEAD&cvsroot=%2Fcvsroot&date=explicit&mindate=1253089320&maxdate=1253089332&who=karlt%2B%25karlt.net>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=509244#c18)• 15 years ago |
|  | |

Attached patch

[mochitest crash test](attachment.cgi?id=401127&action=diff)
— [Details](attachment.cgi?id=401127&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=401127)

This uses the observer service to send a memory pressure notification.
It actually doesn't crash 1.9.0 and 1.9.1 because of another bug that meant the observer was not registered ([bug 419125 comment 6](/show_bug.cgi?id=419125#c6 "RESOLVED FIXED - Remove DeviceContextImpl and nsRenderingContextImpl")).
<http://hg.mozilla.org/mozilla-central/rev/c9b6282f0db7>
The observer was registered before 1.9.2a1, so we should wait till those users are offered 1.9.2b1 before landing this test.
The fix for this bug may still be worthwhile on 1.9.0 and 1.9.1 because nsFontCache::Compact() can still be called in some unusual situations if fm->Init() should fail:
<http://hg.mozilla.org/releases/mozilla-1.9.1/annotate/b7dd9891657f/gfx/src/nsDeviceContext.cpp#l519>

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=509244#a3380129_274246)• 15 years ago |

Blocks: [419125](/show_bug.cgi?id=419125 "RESOLVED FIXED - Remove DeviceContextImpl and nsRenderingContextImpl")

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=509244#c19)• 15 years ago |
|  | |

So, reading [comment 18](/show_bug.cgi?id=509244#c18 "RESOLVED FIXED - gfx crash on memory-pressure notification"), there is no crash on 1.9.0 because of a blocking bug (which may or may not be addressed at some point) and the only way to crash it is via the mochitest anyway? Is this mochitest going to be checked into 1.9.0?

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=509244#c20)• 15 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=509244#c19 "RESOLVED FIXED - gfx crash on memory-pressure notification"))
> So, reading [comment 18](/show_bug.cgi?id=509244#c18 "RESOLVED FIXED - gfx crash on memory-pressure notification"), there is no crash on 1.9.0 because of a blocking bug
> (which may or may not be addressed at some point)
The mochitest doesn't crash 1.9.0 because of [bug 419125 comment 6](/show_bug.cgi?id=419125#c6 "RESOLVED FIXED - Remove DeviceContextImpl and nsRenderingContextImpl"), but there could still be a crash on 1.9.0.
> and the only way to crash it is via the mochitest anyway?
Mochitest enables UniversalXPConnect, which makes it easy to produce the crash on 1.9.2. This is definitely not the only way to crash on 1.9.2. I expect there are ways to crash on 1.9.0 also, but I don't know what they are.
The file in this patch does not need to be run under mochitest. To produce the crash, it is enough just to open the file and manually accept the privilege request.
> Is this mochitest going to be checked into 1.9.0?
It could be. It wouldn't test this bug (unless other things change) but it would test other things.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=509244#c21)• 15 years ago |
|  | |

I'm not concerned with 1.9.2. I work on the 1.9.0 and 1.9.1 security releases. This is fixed in both of those and I'm trying to verify the fix. Since this bug lacks repro steps and the mochitest only works on 1.9.2, it is difficult to reproduce the issue on the branches with which I am concerned.

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=509244#c22)• 15 years ago |
|  | |

Pushed test [attachment 401127](/attachment.cgi?id=401127 "mochitest crash test") [[details]](/attachment.cgi?id=401127&action=edit "mochitest crash test") [[diff]](/attachment.cgi?id=401127&action=diff "mochitest crash test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=509244&attachment=401127)
<http://hg.mozilla.org/mozilla-central/rev/5af76e7485d4>
<http://hg.mozilla.org/mozilla-central/rev/bef4ad958736>Group: core-securityFlags: in-testsuite? → in-testsuite+Whiteboard: [nv][sg:critical?] → [nv]
You need to [log in](/show_bug.cgi?id=509244&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_e0b2d43f_20250125_161706.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2009-64

## Crashes with evidence of memory corruption (rv:1.9.1.4/ 1.9.0.15)

Announced
October 27, 2009
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox
Fixed in

* Firefox 3.0.15
* Firefox 3.5.4

### Description

Mozilla developers and community members identified and fixed
several stability bugs in the browser engine used in Firefox and other
Mozilla-based products. Some of these crashes showed evidence of
memory corruption under certain circumstances and we presume that with
enough effort at least some of these could be exploited to run
arbitrary code.

### Workaround

Disable JavaScript until a version containing these fixes can be
installed.

Vladimir Vukicevic, Jesse Ruderman, Martijn Wargers, Daniel
Banchero, David Keeler, and Boris Zbarsky reported crashes in the
browser engine which affected both Firefox 3 and Firefox 3.5.

* [Browser engine crashes - Firefox 3, Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=514776,497013,508927,509602,509244,489925,522030,454872)
* [CVE-2009-3380](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3380)

Thomas Frederiksen, Marcia Knous, Jesse Ruderman, Carsten Book, and
Kevin Brosnan reported crashes in the browser engine which affected
only Firefox 3.5.

* [Browser engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=502168,513394,503196,516709,508057)
* [CVE-2009-3381](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3381)

Carsten Book reported a crash in the browser engine which affected
only Firefox 3.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=514960>
* [CVE-2009-3382](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3382)

David Anderson and Jeff Walden reported crashes in the JavaScript
engine which affected only Firefox 3.5.

* [JavaScript engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=510987,518675)
* [CVE-2009-3383](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3383)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_be70511e_20250125_161729.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/522030)
* [XML](/show_bug.cgi?ctype=xml&id=522030)

Closed
[Bug 522030](/show_bug.cgi?id=522030)

Opened 15 years ago
Closed 15 years ago

# Can still crash due to weak refs in the id table

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Can still crash due to weak refs in the id table

## Categories

### (Core :: XUL, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=XUL#XUL)

XUL
▾

Core :: XUL

For bugs in the [XUL
language](http://www.mozilla.org/xpfe/xptoolkit/xulintro.html). (XUL is an XML-based language which specifies Mozilla's user interface.)

If you're not actually writing XUL code, this is probably not the right place for your bug.

Examples of appropriate bugs: Duplicate window ID causes infinite loop; or Scrollbars disappear after loading XUL document

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=XUL&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=XUL&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=XUL)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: bzbarsky, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/c9e62c36c6c16218485bdb90fe88d63e?d=mm&size=40)  [enndeakin](/user_profile?user_id=6102)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID"), [521969](/show_bug.cgi?id=521969 "RESOLVED FIXED - Cannot reference tooltip by a changed ID inside XBL")

Dependency [tree](/showdependencytree.cgi?id=522030&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=522030)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, fixed1.9.0.15, fixed1.9.0.16, Whiteboard: [sg:investigate])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---),
[fixed1.9.0.16](/buglist.cgi?keywords=fixed1.9.0.16&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:investigate]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [beltzner](/user_profile?user_id=137548) | [blocking1.9.2](#c3 "15 years ago") | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.2 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.9.0.15](#a12201_190622 "15 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.9.0.16](#a115502_190622 "15 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.9.0.16 | + |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c7 "15 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files)

| [Proposed fix](/attachment.cgi?id=406072)  [15 years ago](#c4)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   4.91 KB, patch | jst : [review+](#c5 "15 years ago") | [Details](/attachment.cgi?id=406072&action=edit) | [Diff](/attachment.cgi?id=406072&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406072) |
| --- | --- | --- |
| [Said crashtest](/attachment.cgi?id=406133)  [15 years ago](#c8)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   826 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=406133&action=edit) |
| [1.9.1 fix](/attachment.cgi?id=406177)  [15 years ago](#c10)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   5.62 KB, patch | jst : [review+](#c18 "15 years ago")  samuel.sidler+old : [approval1.9.1.4+](#c20 "15 years ago")  samuel.sidler+old : [approval1.9.1.6+](#c0 "15 years ago") | [Details](/attachment.cgi?id=406177&action=edit) | [Diff](/attachment.cgi?id=406177&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406177) |
| [1.9.0 fix](/attachment.cgi?id=406179)  [15 years ago](#c11)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   6.49 KB, patch | jst : [review+](#a110881_12352 "15 years ago")  samuel.sidler+old : [approval1.9.0.15+](#c19 "15 years ago")  samuel.sidler+old : [approval1.9.0.16+](#a120905_190622 "15 years ago") | [Details](/attachment.cgi?id=406179&action=edit) | [Diff](/attachment.cgi?id=406179&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406179) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=522030#c0)• 15 years ago |
|  | |

I hate XUL. Fix + test coming up, though I still need to try-server this.Flags: blocking1.9.2?Flags: blocking1.9.0.15?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a22_20209)• 15 years ago |

Group: core-security

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a33_20209)• 15 years ago |

blocking1.9.1: --- → ?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=522030#c1)• 15 years ago |
|  | |

Er, found one issue I'm not sure how to deal with. There's an AddElementForID caller in the template code that seems to add an element to the id table. Can this ever be an anonymous element? Does that element ever actually get added to the DOM? If so, where? As far as I can tell, it's added to the id table before it's added to the DOM, which means we can't tell whether it's anonymous...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a443_20209)• 15 years ago |

Assignee: benjamin → bzbarsky

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a724_20209)• 15 years ago |

Blocks: [521969](/show_bug.cgi?id=521969 "RESOLVED FIXED - Cannot reference tooltip by a changed ID inside XBL")

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a12201_190622)• 15 years ago |

blocking1.9.1: ? → .4+Flags: blocking1.9.0.15? → blocking1.9.0.15+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=522030#c2)• 15 years ago |
|  | |

We're going to re-spin both Firefox 3.0.15 and 3.5.4 for this issue.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a18500_76551)• 15 years ago |

OS: Mac OS X → AllHardware: x86 → All

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=522030#c3)• 15 years ago |
|  | |

Ugh.
Here's the deal: according to bz there are two fixes for this: a branch-safe one and a more-correct one.
The branch-safe fix will come with some small perf costs (~1% on various metrics, though not Ts) and potential for memory leaks (this worries bz the most, and consequently, me) but has the benefit of not absolutely shattering add-on compatibility.
The more-correct fix comes without perf or memory leak costs, but absolutely shatters add-on compatibility and parts of the Firefox UI (which bz said he can fix).
We've decided to start with the more pressing branch-safe fix, which will be checked into mozilla-central and mozilla-1.9.2 to get test coverage and measure the performance impact. This means holding the beta a little longer, so marking this as a P1 blocker. Based on the performance impact, we'll make a decision about what to do for mozilla-1.9.2; in order to preserve add-on compatibility, we might have to suck it up.Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P1

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a21971_20209)• 15 years ago |

Blocks: [489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID")Summary: Can still get at XBL-bound anonymous content via getElementById in XUL documents → Can still crash due to weak refs in the id table

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=522030#c4)• 15 years ago |
|  | |

Attached patch

[Proposed fix](attachment.cgi?id=406072&action=diff)
— [Details](attachment.cgi?id=406072&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406072)

This applies on top of a backout of the patch for [bug 489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID").
[Attachment #406072](/attachment.cgi?id=406072&action=edit "Proposed fix") -
Flags: review?(jst)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=522030#c5)• 15 years ago |
|  | |

Comment on [attachment 406072](/attachment.cgi?id=406072 "Proposed fix") [[details]](/attachment.cgi?id=406072&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=406072&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406072)
Proposed fix
Looks good! r=jst
[Attachment #406072](/attachment.cgi?id=406072&action=edit "Proposed fix") -
Flags: review?(jst) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=522030#c6)• 15 years ago |
|  | |

Pushed:
<http://hg.mozilla.org/mozilla-central/rev/b40bf2ef14a7>
<http://hg.mozilla.org/mozilla-central/rev/b5f738553e38>
(backout of the original fix for [bug 489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID") plus this fix) and
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/9ef0bceaf6b2>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/96207da1b7c1>
Will wait for those to cycle and give us perf and leak data, then request branch approvals. Will also file followup bug for the real trunk (and maybe 1.9.2) fix.Status: NEW → RESOLVEDClosed: 15 years ago
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)Resolution: --- → FIXED

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a23314_76551)• 15 years ago |

Severity: normal → criticalFlags: in-testsuite+Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Target Milestone: --- → mozilla1.9.3a1

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=522030#c7)• 15 years ago |
|  | |

This is most emphatically NOT in-testsuite+. It can't be until we open up the bug (at which point a modified version of the testcase in [bug 489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID") should be checked in as a crashtest.Flags: in-testsuite+ → in-testsuite?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=522030#c8)• 15 years ago |
|  | |

Attached file
[Said crashtest](attachment.cgi?id=406133)
— [Details](attachment.cgi?id=406133&action=edit)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=522030#c9)• 15 years ago |
|  | |

Pushed
<http://hg.mozilla.org/mozilla-central/rev/36e79c905e64>
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/970631f8f91a>
to fix orange.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=522030#c10)• 15 years ago |
|  | |

Attached patch

[1.9.1 fix](attachment.cgi?id=406177&action=diff)
— [Details](attachment.cgi?id=406177&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406177)

Please pay particular attention to the ID\_NOT\_IN\_DOCUMENT stuff. I made changes to Traverse(), ~nsIdentifierMapEntry, and AddIdContent to handle it; any other obvious changes that need to happen?
Again, this applies on top of a backout of [bug 489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID") on 1.9.1 branch.
[Attachment #406177](/attachment.cgi?id=406177&action=edit "1.9.1 fix") -
Flags: review?(jst)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=522030#c11)• 15 years ago |
|  | |

Attached patch

[1.9.0 fix](attachment.cgi?id=406179&action=diff)
— [Details](attachment.cgi?id=406179&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406179)

Lots of merging here... Please look over carefully?
[Attachment #406179](/attachment.cgi?id=406179&action=edit "1.9.0 fix") -
Flags: review?(jst)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=522030#c12)• 15 years ago |
|  | |

No discerned perf impact or leaking on mozilla-central or mozilla-1.9.2. Boris, how should we be looking for leaks? I'm copying in Leakcat who might be able to help there ...
In the meantime, I think we should consider this as fixed for mozilla-1.9.2 until we get evidence that it's caused bigger problems.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=522030#c13)• 15 years ago |
|  | |

As far as leaks, I had two specific worries:
1) Document leaks through shutdown. Just browsing around a bunch with leak logging enabled will catch these. I suspect there won't be many, if any, given the cycle collection hookups this patch ended up taking advantage of.
2) Element leaks for document lifetime. I don't know that we have a sane way to measure this; it would only bite situations where the elements are anonymous, so not likely to hit web pages. Extensions that leak due to this category of leaks would have crashed before, so probably a net win...

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=522030#c14)• 15 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=522030#c13 "RESOLVED FIXED - Can still crash due to weak refs in the id table"))
> As far as leaks, I had two specific worries:
>
So for 1) i will run a test over the Top 10000 Topsites to check for leaks and for 2) a run with the Top Extensions installed

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=522030#c15)• 15 years ago |
|  | |

That sounds great. Thanks!
We probably want to do that with all of 1.9.2, 1.9.1, and 1.9.0, since the code is significantly different and the cycle collector behavior is significantly different between them. :(

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=522030#c16)• 15 years ago |
|  | |

(In reply to [comment #15](/show_bug.cgi?id=522030#c15 "RESOLVED FIXED - Can still crash due to weak refs in the id table"))
> That sounds great. Thanks!
>
> We probably want to do that with all of 1.9.2, 1.9.1, and 1.9.0, since the code
> is significantly different and the cycle collector behavior is significantly
> different between them. :(
yeah that's no problem, can cover all this branches with the vm's

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=522030#c17)• 15 years ago |
|  | |

Johnny's not actually CCed to this bug...

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=522030#c18)• 15 years ago |
|  | |

Comment on [attachment 406177](/attachment.cgi?id=406177 "1.9.1 fix") [[details]](/attachment.cgi?id=406177&action=edit "1.9.1 fix") [[diff]](/attachment.cgi?id=406177&action=diff "1.9.1 fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406177)
1.9.1 fix
Looks good.
[Attachment #406177](/attachment.cgi?id=406177&action=edit "1.9.1 fix") -
Flags: review?(jst) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a110881_12352)• 15 years ago |

[Attachment #406179](/attachment.cgi?id=406179&action=edit "1.9.0 fix") -
Flags: review?(jst) → review+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a111303_20209)• 15 years ago |

[Attachment #406177](/attachment.cgi?id=406177&action=edit "1.9.1 fix") -
Flags: approval1.9.1.4?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a111308_20209)• 15 years ago |

[Attachment #406179](/attachment.cgi?id=406179&action=edit "1.9.0 fix") -
Flags: approval1.9.0.15?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=522030#c19)• 15 years ago |
|  | |

Comment on [attachment 406179](/attachment.cgi?id=406179 "1.9.0 fix") [[details]](/attachment.cgi?id=406179&action=edit "1.9.0 fix") [[diff]](/attachment.cgi?id=406179&action=diff "1.9.0 fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406179)
1.9.0 fix
Approved for 1.9.0.15. a=ss for release-drivers
[Attachment #406179](/attachment.cgi?id=406179&action=edit "1.9.0 fix") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=522030#c20)• 15 years ago |
|  | |

Comment on [attachment 406177](/attachment.cgi?id=406177 "1.9.1 fix") [[details]](/attachment.cgi?id=406177&action=edit "1.9.1 fix") [[diff]](/attachment.cgi?id=406177&action=diff "1.9.1 fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=522030&attachment=406177)
1.9.1 fix
Approved for 1.9.1.4. a=ss for release-drivers
[Attachment #406177](/attachment.cgi?id=406177&action=edit "1.9.1 fix") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=522030#c21)• 15 years ago |
|  | |

Pushed on 1.9.1:
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/b475463d243a>
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/e90895696bde>
for 1.9.1.5 and:
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/873b4ef2a3e4>
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/e178dbd2a389>
for 1.9.1.4 (on GECKO1914\_20091006\_RELBRANCH).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=522030#c22)• 15 years ago |
|  | |

Checked into CVS:
Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.794; previous revision: 3.793
done
Checking in content/html/document/src/nsHTMLDocument.h;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.h,v <-- nsHTMLDocument.h
new revision: 3.232; previous revision: 3.231
done
Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.795; previous revision: 3.794
for 1.9.0.16 and:
Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.793.2.1; previous revision: 3.793
done
Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.793.2.1; previous revision: 3.793
done
for 1.9.0.15
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)Whiteboard: fixed1.9.0.15, fixed1.9.0.16

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=522030#c23)• 15 years ago |
|  | |

Er, the last part of the 1.9.0.15 cvs thing should have been:
Checking in content/html/document/src/nsHTMLDocument.h;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.h,v <-- nsHTMLDocument.h
new revision: 3.231.12.1; previous revision: 3.231
done
Checking in content/html/document/src/nsHTMLDocument.cpp;
/cvsroot/mozilla/content/html/document/src/nsHTMLDocument.cpp,v <-- nsHTMLDocument.cpp
new revision: 3.793.2.2; previous revision: 3.793.2.1
done

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a115502_190622)• 15 years ago |

Flags: blocking1.9.0.16+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a120900_190622)• 15 years ago |

[Attachment #406177](/attachment.cgi?id=406177&action=edit "1.9.1 fix") -
Flags: approval1.9.1.5+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a120905_190622)• 15 years ago |

[Attachment #406179](/attachment.cgi?id=406179&action=edit "1.9.0 fix") -
Flags: approval1.9.0.16+

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=522030#c24)• 15 years ago |
|  | |

Boris, I wonder how I can verify this fix. I tried your attached crash test with builds from 10/13 but I cannot get those to crash.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=522030#c25)• 15 years ago |
|  | |

The attached test doesn't crash in those builds due to the fix for [bug 489925](/show_bug.cgi?id=489925 "VERIFIED FIXED - Crash [@ nsContentUtils::PositionIsBefore] with XBL, two elements that have the same ID") being present in them. Let me see if I can write a testcase which will crash them.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=522030#c26)• 15 years ago |
|  | |

OK, I haven't succeeded at it yet, because XUL does weird things on subtree removals... I \_think\_ it's still possible to trigger such crashes, but I'm not sure its worth spending a few days to figure out the exact right codepath to hit.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a268813_190622)• 15 years ago |

Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---),
[fixed1.9.0.16](/buglist.cgi?keywords=fixed1.9.0.16&resolution=---)Whiteboard: fixed1.9.0.15, fixed1.9.0.16

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a289990_1689)• 15 years ago |

Whiteboard: [sg:investigate]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=522030#c27)• 15 years ago |
|  | |

This doesn't crash with build 3 of 1.9.0.15 (Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.15) Gecko/2009101601 Firefox/3.0.15 (.NET CLR 3.5.30729)) or build 1 of it or 1.9.0.14.
Is there a means to verify this bug for 1.9.0 and 1.9.1?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=522030#c28)• 15 years ago |
|  | |

Al, I don't have a crash testcase for you, sorry.
One could try to verify buy fuzzing the testcase posted in this bug and especially a XUL (not XHTML) version of that testcase?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=522030#a2377786_1689)• 15 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=522030&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.redhat.com_f9241f3b_20250125_161710.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)

# Red Hat Support

## Go beyond support by engaging with our experts

Our teams collaborate with you to ensure you accomplish your goals with Red Hat solutions. The relationship we build with you is designed to provide you with the tools and resources you need to find success on your IT journey.

![](/rhdc/managed-files/support-header.svg)

## Configured for your success

We develop a holistic understanding of your experience as a customer by ensuring our support and engineering teams work together.

Our support team works hand in hand with the best engineers in the industry to quickly turn customer feedback into product improvements. This direct line of communication allows us to hone in on proactive fixes that can impact your bottom line.

### Quick links

* Search our [Knowledgebase](https://access.redhat.com/search/#/?q=&p=1&sort=relevant&scoped&documentKind=Knowledgebase)
* Find [product documentation](https://access.redhat.com/documentation/en-us/)
* Access the [product security center](https://access.redhat.com/security/)
* Connect with [our support team](https://access.redhat.com/support)
* Team up with a [technical account manager](/en/services/support/technical-account-management "Technical account management")
* Take advantage of [partner support](https://connect.redhat.com/en/support)

## Find the right level of support

We have different tiers of support designed to meet your unique needs.

|  | Self-support | Standard | Premium |
| --- | --- | --- | --- |
| Access to Red Hat products | checkmark | checkmark | checkmark |
| Access to our knowledgebase and tools in our award-winning Customer Portal | checkmark | checkmark | checkmark |
| Access to support engineers during standard business hours |  | checkmark | checkmark |
| Access to support engineers 24x7 for high-severity issues |  |  | checkmark |

We also feature specialized support options that can be tailored to the unique needs of companies of all sizes and industries. The Red Hat® [Enhanced Solution Support](/en/resources/enhanced-solution-support-datasheet "Red Hat Enhanced Solution Support: 24x7 engineering support") offering reduces downtime and boosts confidence through access to senior level engineers, as well as resolution and restoration SLAs—helping you stay up and running as you innovate, scale, and deploy. Our engineers help restore your operations quickly and accelerate the path to final resolution, identifying the root cause which helps protect against recurrences in the future. Enhanced Solution Support engineers, who are already familiar with your environment, will be there to assist with critical issues in production environments so that you can consistently deliver the cloud services your customers demand. This offering is available for Red Hat OpenShift® and Red Hat OpenStack® Platform customers.

### Personalized support

Connect with a technical adviser for collaborative planning and specialized guidance. Our Technical Account Managers help you streamline deployments, resolve issues, and shape your technology strategy to meet your toughest business challenges.

[Explore Technical Account Management](/en/services/support/technical-account-management)

## Award winners since 2011

We’ve evolved the traditional software subscription model, combining the best elements of our services to exceed customer expectations. The Association of Support Professionals has honored Red Hat’s Customer Portal as one of “The Top Ten Best Support Websites” for 13 years running.

[See why the Customer Portal keeps earning industry recognition](https://access.redhat.com/)

![Gold and green star with text ASP best support websites of 2023](/rhdc/managed-files/ASP-Award-Design.jpg)

## What they're saying

![BSE logo](/rhdc/managed-files/bse-logo-2.png)

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> We have found the support from Red Hat to be exemplary. Whenever we need anything from them, they have given it … Red Hat is now our backbone. Our business cannot run if Red Hat is not there.
>
> Ashishkumar Chauhan
>
> CEO, BSE

> Icon-Red\_Hat-Media\_and\_documents-Quotemark\_Open-B-Red-RGB
>
> I like the fact that they really dig into things and then provide answers. As the single Linux guy, I kind of need that second admin next to me sometimes to say, "Hey, what about this?" and I am able to do that through the portal. I get my questions answered and trouble tickets resolved.
>
> Erik Widholm
>
> Sr. Enterprise Engineer

[Read more user reviews](/en/technologies/linux-platforms/enterprise-linux/user-reviews)

## Have questions?

[Contact Support team](https://access.redhat.com/support)

[Visit the Customer Portal](https://access.redhat.com/)

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/services/support)
* [English](/en/services/support)
* [Français](/fr/services/support)
* [Deutsch](/de/services/support)
* [Italiano](/it/services/support)
* [日本語](/ja/services/support)
* [한국어](/ko/services/support)
* [Português](/pt-br/services/support)
* [Español](/es/services/support)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from bugzilla.mozilla.org_f68a9773_20250125_161727.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/514776)
* [XML](/show_bug.cgi?ctype=xml&id=514776)

Closed
[Bug 514776](/show_bug.cgi?id=514776)

Opened 15 years ago
Closed 15 years ago

# GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow

## Categories

### (Core :: Graphics: ImageLib, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20ImageLib#Graphics%3A%20ImageLib)

Graphics: ImageLib
▾

Core :: Graphics: ImageLib
ImageLib decodes GIF, JPEG and PNG images, and provides the decoded data to the Compositor for display. If Firefox or Seamonkey can display an image when loaded separately from the page, ImageLib is working, and the actual imaging bug exists elsewhere within Firefox or Seamonkey.

Examples of appropriate bugs: PNG gAMA chunk ignored; Crashes on GIF w/corrupted frame(merr-01.gif); or PNGs and JPEGs aren't displayed on FreeBSD.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20ImageLib)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: keeler, Assigned: alfredkayser)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/1a6ea47e31e5f021406cd6d3cb071acc?d=mm&size=40)  [alfredkayser](/user_profile?user_id=35547)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [keeler](/user_profile?user_id=349244)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[519589](/show_bug.cgi?id=519589 "VERIFIED FIXED - twitter reply transparent image is not so transparent on trunk")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=514776&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=514776)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: verified1.9.0.15, verified1.9.1, Whiteboard: [sg:low] OOB memory read)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:low] OOB memory read

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [vlad](/user_profile?user_id=24534) | [blocking1.9.2](#a1209983_24534 "15 years ago") | + |
| --- | --- | --- |
| [vlad](/user_profile?user_id=24534) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a861784_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a861784_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.8.1.next](#c28 "15 years ago") | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.8.1.next | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.8.1.x](#c28 "15 years ago") | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.8.1.x | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [file that exposes bug](/attachment.cgi?id=398772)  [15 years ago](#c0)  [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)   311.62 KB, image/gif |  | [Details](/attachment.cgi?id=398772&action=edit) |
| --- | --- | --- |
| [V1: When depth < 8, mask pixel values within valid range](/attachment.cgi?id=398852)  [15 years ago](#c3)  [Alfred Kayser](/user_profile?user_id=35547)   4.83 KB, patch | joe : [review+](#a627039_94 "15 years ago")  vlad : [superreview+](#a627991_24534 "15 years ago") | [Details](/attachment.cgi?id=398852&action=edit) | [Diff](/attachment.cgi?id=398852&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=398852) |
| [file that exposes bug](/attachment.cgi?id=400066)  [15 years ago](#c4)  [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)   294.43 KB, image/gif |  | [Details](/attachment.cgi?id=400066&action=edit) |
| [valgrind output (mac)](/attachment.cgi?id=400093)  [15 years ago](#c5)  [Jesse Ruderman](/user_profile?user_id=11608)   2.05 KB, text/plain |  | [Details](/attachment.cgi?id=400093&action=edit) |
| [Patch for the 191 branch](/attachment.cgi?id=400713)  [15 years ago](#c13)  [Alfred Kayser](/user_profile?user_id=35547)   4.02 KB, patch | joe : [review+](#c16 "15 years ago")  vlad : [superreview+](#a906662_24534 "15 years ago")  dveditz : [approval1.9.1.4+](#a1109442_1689 "15 years ago")  dveditz : [approval1.9.0.15+](#a1223727_1689 "15 years ago") | [Details](/attachment.cgi?id=400713&action=edit) | [Diff](/attachment.cgi?id=400713&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=514776#c0)• 15 years ago |
|  | |

Attached image
[file that exposes bug](attachment.cgi?id=398772) (obsolete)
— [Details](attachment.cgi?id=398772&action=edit)

Build Identifier: mozilla-central revision 91096486c92c
If a GIF image block header specifies a small local color map, the decoder can be made to read off the end of the allocated color map if the image has pixels with color indices greater than the size of the map.
The code in question is:
(line 493 is the important one)
nsGIFDecoder2.cpp:
nsGIFDecoder2::OutputRow():
484: // Row to process
485: const PRUint32 bpr = sizeof(PRUint32) \* mGIFStruct.width;
486: PRUint8 \*rowp = mImageData + (mGIFStruct.irow \* bpr);
487:
488: // Convert color indices to Cairo pixels
489: PRUint8 \*from = rowp + mGIFStruct.width;
490: PRUint32 \*to = ((PRUint32\*)rowp) + mGIFStruct.width;
491: PRUint32 \*cmap = mColormap;
492: for (PRUint32 c = mGIFStruct.width; c > 0; c--) {
493: \*--to = cmap[\*--from];
494: }
(where mColormap will be allocated in nsGIFDecoder2::GifWrite:
1097: if (q[8] & 0x80) /\* has a local colormap? \*/
1098: {
1099: mGIFStruct.local\_colormap\_size = 1 << depth;
1100: if (!mGIFStruct.images\_decoded) {
1101: // First frame has local colormap, allocate space for it
1102: // as the image frame doesn't have its own palette
1103: mColormapSize = sizeof(PRUint32) << realDepth;
1104: if (!mGIFStruct.local\_colormap) {
1105: mGIFStruct.local\_colormap =
(PRUint32\*)PR\_MALLOC(mColormapSize);
1106: if (!mGIFStruct.local\_colormap) {
1107: mGIFStruct.state = gif\_oom;
1108: break;
1109: }
1110: }
1111: mColormap = mGIFStruct.local\_colormap;
1112: }
...
As evidence that this actually happens:
(gdb) print mGIFStruct.local\_colormap\_size
$26 = 64
(gdb) print /d \*from
$27 = 206
(the code is trying to look at element 206 of an array only 64 elements long)
I believe that this is a limited size read-only bug that has minimal security implications, and therefore I am not marking this as security-sensitive.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a907_11608)• 15 years ago |

Group: core-securityWhiteboard: [sg:low] OOB memory read

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=514776#c1)• 15 years ago |
|  | |

Actually, I retract that last statement. I believe up to 4 \* 254 bytes of memory following the color map can be read, which could expose sensitive information.

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=514776#c2)• 15 years ago |
|  | |

Actually there are three places for a colormap
1. Global colormap (but this one is always 256 colors big)
2. Local colormap within the frame data
3. Local colormap allocated at line 1105
(Only happens when the first frame has its own local colorpalette).
Two solutions here, both with performance impact:
1. Make the local colormaps always 256 colors large.
2. In the mapping function (line 493), clamp colorvaluess to the colormap size.

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=514776#c3)• 15 years ago |
|  | |

Attached patch

[V1: When depth < 8, mask pixel values within valid range](attachment.cgi?id=398852&action=diff)
— [Details](attachment.cgi?id=398852&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=398852)

This patch ensure that pixels values will never be larger than colormap, by masking them to 'mColorMask' so that any (illegal) values larger than specified depth are masked into a valid value.
This prevents 'reading' memory that one should be allowed to.
Increasing depth to accommodate invalid tpixel is just wrong, and also allows out of bound reads.
So, I also removed 'realDepth' which was needed for transparent pixels outside the colormap range, but resetting the transparent flag when this happens (as the image won't be transparent anyway, as the tpixel index is outside the valid colormap range).Assignee: nobody → alfredkayserStatus: NEW → ASSIGNED

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a63100_35547)• 15 years ago |

[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: review?(joe)

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=514776#c4)• 15 years ago |
|  | |

Attached image
[file that exposes bug](attachment.cgi?id=400066)
— [Details](attachment.cgi?id=400066&action=edit)

[Attachment #398772](/attachment.cgi?id=398772&action=edit "file that exposes bug") -
Attachment is obsolete: true

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=514776#c5)• 15 years ago |
|  | |

Attached file
[valgrind output (mac)](attachment.cgi?id=400093)
— [Details](attachment.cgi?id=400093&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a589568_11608)• 15 years ago |

Summary: crafted GIF image data can cause an out of bounds read at nsGIFDecoder2.cpp:493 (nsGIFDecoder2::OutputRow) → GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=514776#c6)• 15 years ago |
|  | |

valgrind-3.4.1-Debian on linux doesn't catch the oob read.
nnethercote: any ideas on why this might be?

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=514776#c7)• 15 years ago |
|  | |

Can someone test if valgrind doesn't complain anymore when the patch is applied?

|  | [Nicholas Nethercote [inactive]](/user_profile?user_id=334849) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=514776#c8)• 15 years ago |
|  | |

(In reply to [comment #6](/show_bug.cgi?id=514776#c6 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow"))
> valgrind-3.4.1-Debian on linux doesn't catch the oob read.
> nnethercote: any ideas on why this might be?
Does PR\_MALLOC end up going through jemalloc on Linux? I think jemalloc isn't used on Mac, right?
It's relevant because Valgrind is less accurate on jemalloc-enabled builds, partly because the annotations in jemalloc are a bit dodgy (see [bug 503249](/show_bug.cgi?id=503249 "RESOLVED WONTFIX - fix the Valgrind annotations for jemalloc")), and partly because jemalloc doesn't pad both ends of malloc'd blocks with a redzone.

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a627039_94)• 15 years ago |

[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: superreview?(vladimir)
[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: review?(joe)
[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: review+

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=514776#c9)• 15 years ago |
|  | |

Comment on [attachment 398852](/attachment.cgi?id=398852 "V1: When depth < 8, mask pixel values within valid range") [[details]](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") [[diff]](/attachment.cgi?id=398852&action=diff "V1: When depth < 8, mask pixel values within valid range") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=398852)
V1: When depth < 8, mask pixel values within valid range
Asking for sr because it's security-related.

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a627991_24534)• 15 years ago |

[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: superreview?(vladimir) → superreview+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=514776#c10)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/ff3496b1f6c7>Status: ASSIGNED → RESOLVEDblocking1.9.1: --- → ?Closed: 15 years agoFlags: blocking1.9.2?Flags: blocking1.9.0.15?Resolution: --- → FIXEDTarget Milestone: --- → mozilla1.9.3a1

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=514776#c11)• 15 years ago |
|  | |

Comment on [attachment 398852](/attachment.cgi?id=398852 "V1: When depth < 8, mask pixel values within valid range") [[details]](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") [[diff]](/attachment.cgi?id=398852&action=diff "V1: When depth < 8, mask pixel values within valid range") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=398852)
V1: When depth < 8, mask pixel values within valid range
Patch applies successfully on 1.9.2. Does not apply on 1.9.1/1.9.0, so need different patch for those branches.
[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: approval1.9.2?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a631227_159758)• 15 years ago |

Whiteboard: [sg:low] OOB memory read → [sg:low] OOB memory read [need new patch for 1.9.1/1.9.0]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a861784_1689)• 15 years ago |

blocking1.9.1: ? → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x+Flags: wanted1.8.1.x+Flags: blocking1.9.0.15?Flags: blocking1.9.0.15+Flags: blocking1.8.1.next?

|  | [Julian Seward [:jseward]](/user_profile?user_id=346453) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=514776#c12)• 15 years ago |
|  | |

(In reply to [comment #8](/show_bug.cgi?id=514776#c8 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow"))
> It's relevant because Valgrind is less accurate on jemalloc-enabled
> builds,
Seconding that; I'd say "much less accurate". I'd strongly
advise using a "ac\_add\_options --disable-jemalloc" build if you want
to reliably use Memcheck to debug and verify such problems.

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=514776#c13)• 15 years ago |
|  | |

Attached patch

[Patch for the 191 branch](attachment.cgi?id=400713&action=diff)
— [Details](attachment.cgi?id=400713&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713)

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a903167_35547)• 15 years ago |

[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: superreview?(vladimir)
[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: review?(joe)
[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: approval1.9.1.4?

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a906662_24534)• 15 years ago |

[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: superreview?(vladimir) → superreview+

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=514776#c14)• 15 years ago |
|  | |

Comment on [attachment 400713](/attachment.cgi?id=400713 "Patch for the 191 branch") [[details]](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") [[diff]](/attachment.cgi?id=400713&action=diff "Patch for the 191 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713)
Patch for the 191 branch
looks ok to me, but joe should still take a look

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1039442_1689)• 15 years ago |

Whiteboard: [sg:low] OOB memory read [need new patch for 1.9.1/1.9.0] → [sg:low][needs r=joe for 1.9.1 patch][needs 1.9.0 patch?] OOB memory read

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=514776#c15)• 15 years ago |
|  | |

This patch is not needed for 1.8 nor 1.8.0, as there is an explicit check on colormap size before accessing it:
<http://mxr.mozilla.org/mozilla1.8/source/modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp#520>
520 if (\*rowBufIndex < cmapsize) {
and for 1.8.0:
<http://mxr.mozilla.org/mozilla1.8.0/source/modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp#520>

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=514776#c16)• 15 years ago |
|  | |

Comment on [attachment 400713](/attachment.cgi?id=400713 "Patch for the 191 branch") [[details]](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") [[diff]](/attachment.cgi?id=400713&action=diff "Patch for the 191 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713)
Patch for the 191 branch
Same patch as before. r+
[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: review?(joe) → review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1109442_1689)• 15 years ago |

[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=514776#c17)• 15 years ago |
|  | |

Comment on [attachment 400713](/attachment.cgi?id=400713 "Patch for the 191 branch") [[details]](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") [[diff]](/attachment.cgi?id=400713&action=diff "Patch for the 191 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713)
Patch for the 191 branch
Approved for 1.9.1.4, a=dveditz
This probably applies fine to 1.9.0.x -- if it does please request 1.9.0.15 approval as well. Thanks!

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1109964_1689)• 15 years ago |

Flags: blocking1.8.1.next? → blocking1.8.1.next+Whiteboard: [sg:low][needs r=joe for 1.9.1 patch][needs 1.9.0 patch?] OOB memory read → [sg:low][needs 1.9.0 patch?] OOB memory read

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1109974_1689)• 15 years ago |

Flags: blocking1.8.1.next+ → blocking1.8.1.next?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1113228_159758)• 15 years ago |

[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: approval1.9.0.15?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=514776#c18)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/e4477e90c539>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=514776#c19)• 15 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=514776#c17 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow"))
> This probably applies fine to 1.9.0.x -- if it does please request 1.9.0.15
> approval as well. Thanks!
It applies fine. approval requested.Whiteboard: [sg:low][needs 1.9.0 patch?] OOB memory read → [sg:low] OOB memory read

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1209983_24534)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1210069_159758)• 15 years ago |

[Attachment #398852](/attachment.cgi?id=398852&action=edit "V1: When depth < 8, mask pixel values within valid range") -
Flags: approval1.9.2?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a1223727_1689)• 15 years ago |

[Attachment #400713](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=514776#c20)• 15 years ago |
|  | |

Comment on [attachment 400713](/attachment.cgi?id=400713 "Patch for the 191 branch") [[details]](/attachment.cgi?id=400713&action=edit "Patch for the 191 branch") [[diff]](/attachment.cgi?id=400713&action=diff "Patch for the 191 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514776&attachment=400713)
Patch for the 191 branch
Approved for 1.9.0.15, a=dveditz

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=514776#c21)• 15 years ago |
|  | |

Checking in modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp;
/cvsroot/mozilla/modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp,v <-- nsGIFDecoder2.cpp
new revision: 1.104; previous revision: 1.103
done
Checking in modules/libpr0n/decoders/gif/nsGIFDecoder2.h;
/cvsroot/mozilla/modules/libpr0n/decoders/gif/nsGIFDecoder2.h,v <-- nsGIFDecoder2.h
new revision: 1.39; previous revision: 1.38
doneKeywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=514776#c22)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/c946223c5bd3>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)OS: Linux → AllHardware: x86 → All

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=514776#c23)• 15 years ago |
|  | |

No automated test for this change in mozilla-central or the branches? QA is looking to verify that this issue is fixed.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=514776#c24)• 15 years ago |
|  | |

Do we want this GIF to become part of a reftest, checking for the exact behavior we chose, or just crashtest that can be run under Valgrind? (I say "chose" because Safari shows it mostly white, Opera shows it mostly black, and Firefox shows it mostly striped!)
For now your best bet is to eyeball the image (it will look randomish and/or crash in bugs without the fix), or run Firefox under Valgrind/Purify.

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=514776#c25)• 15 years ago |
|  | |

(In reply to [comment #23](/show_bug.cgi?id=514776#c23 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow"))
> No automated test for this change in mozilla-central or the branches? QA is
> looking to verify that this issue is fixed.
Note that even if we had a test, don't we usually hold off on landing such tests for security bugs until the release has shipped?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=514776#c26)• 15 years ago |
|  | |

We do but that doesn't mean it wouldn't be attached here for me to see or run (depending on the kind of test) since I have access privs.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=514776#c27)• 15 years ago |
|  | |

Verified for 1.9.1.4 using the attached gif and Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.4pre) Gecko/20090922 Shiretoko/3.5.4pre (.NET CLR 3.5.30729).
Verified for 1.9.0.15 using Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.15pre) Gecko/2009092205 GranParadiso/3.0.15pre (.NET CLR 3.5.30729).Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---) → [verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=514776#c28)• 15 years ago |
|  | |

(In reply to [comment #15](/show_bug.cgi?id=514776#c15 "RESOLVED FIXED - GIF with out-of-bounds colormap reference causes OOB read in nsGIFDecoder2::OutputRow"))
> This patch is not needed for 1.8 nor 1.8.0, as there is an explicit check on
> colormap size before accessing it:
> <http://mxr.mozilla.org/mozilla1.8/source/modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp#520>
> 520 if (\*rowBufIndex < cmapsize) {
> and for 1.8.0:
> <http://mxr.mozilla.org/mozilla1.8.0/source/modules/libpr0n/decoders/gif/nsGIFDecoder2.cpp#520>
Good to know. Changing those flags then...Flags: wanted1.8.1.x-Flags: wanted1.8.1.x+Flags: blocking1.8.1.next?Flags: blocking1.8.1.next-

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=514776#c29)• 15 years ago |
|  | |

It looks like this bug causes [bug 519589](/show_bug.cgi?id=519589 "VERIFIED FIXED - twitter reply transparent image is not so transparent on trunk")

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a3519654_76551)• 15 years ago |

Depends on: [519589](/show_bug.cgi?id=519589 "VERIFIED FIXED - twitter reply transparent image is not so transparent on trunk")

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=514776#c30)• 15 years ago |
|  | |

This bug changed a check for mImageFrame into a check for mImageData causing [bug 525326](/show_bug.cgi?id=525326 "RESOLVED FIXED - Crashes in gif decoder [@ xul.dll@0x348945][@ xul.dll@0x348864][@nsGIFDecoder2::GifWrite(unsigned char const*, unsigned int)]"). What was the reason for that change?

|  | [Alfred Kayser](/user_profile?user_id=35547)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=514776#c31)• 15 years ago |
|  | |

The problem that caused this change from mImageFrame to mImageData, was that with the decode-on-demand, the BeginImageFrame could fail to set mImageData.
The check should indeed to check both of them.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514776#a5719729_1689)• 15 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=514776&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


