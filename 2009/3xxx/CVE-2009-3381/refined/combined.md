=== Content from bugzilla.mozilla.org_d1418c06_20250126_085757.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sun Jan 26 2025 00:57:57 PST

* **Bug ID:**
  502168,
  513394,
  503196,
  516709,
  508057

---

| [ID](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [516709](/show_bug.cgi?id=516709 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059") |  | [Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059](/show_bug.cgi?id=516709) | Core | Graphics | jd.bugzilla | RESO | FIXE | 2011-01-27 |
| [513394](/show_bug.cgi?id=513394 "RESOLVED FIXED - \"ASSERTION: Some PresArena objects were not freed\" with -moz-column, list-item, float, :after") |  | ["ASSERTION: Some PresArena objects were not freed" with -moz-column, list-item, float, :after](/show_bug.cgi?id=513394) | Core | Layout | tnikkel | RESO | FIXE | 2009-12-06 |
| [502168](/show_bug.cgi?id=502168 "RESOLVED FIXED - Duplicated content with <embed> inside table markup") |  | [Duplicated content with <embed> inside table markup](/show_bug.cgi?id=502168) | Core | Layout | smaug | RESO | FIXE | 2010-05-06 |
| [508057](/show_bug.cgi?id=508057 "VERIFIED FIXED - crash [@ imgRequestProxy::OnStopRequest(nsIRequest*, nsISupports*, unsigned int, int) ] Classic Compact theme") |  | [crash [@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ] Classic Compact theme](/show_bug.cgi?id=508057) | Core | Graphics: ImageLib | joe | VERI | FIXE | 2015-10-16 |
| [503196](/show_bug.cgi?id=503196 "VERIFIED FIXED - [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing") |  | [[Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing](/show_bug.cgi?id=503196) | Core | Widget: Cocoa | smichaud | VERI | FIXE | 2011-06-13 |

5 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=502168%2C513394%2C503196%2C516709%2C508057 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=502168%2C513394%2C503196%2C516709%2C508057&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from www.vupen.com_cddaa5c4_20250125_132956.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.mozilla.org_6d2cd684_20250125_133001.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/508057)
* [XML](/show_bug.cgi?ctype=xml&id=508057)

Closed
[Bug 508057](/show_bug.cgi?id=508057)

Opened 15 years ago
Closed 15 years ago

# crash [@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ] Classic Compact theme

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash [@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ] Classic Compact theme

## Categories

### (Core :: Graphics: ImageLib, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20ImageLib#Graphics%3A%20ImageLib)

Graphics: ImageLib
▾

Core :: Graphics: ImageLib
ImageLib decodes GIF, JPEG and PNG images, and provides the decoded data to the Compositor for display. If Firefox or Seamonkey can display an image when loaded separately from the page, ImageLib is working, and the actual imaging bug exists elsewhere within Firefox or Seamonkey.

Examples of appropriate bugs: PNG gAMA chunk ignored; Crashes on GIF w/corrupted frame(merr-01.gif); or PNGs and JPEGs aren't displayed on FreeBSD.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20ImageLib)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: kbrosnan, Assigned: joe)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/7a41e6ee07ffb6fa8873f73b962603fd?d=mm&size=40)  [joe](/user_profile?user_id=94)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1c646a9a47fbb1d8e096afd3add71a66?d=mm&size=40)  [kbrosnan](/user_profile?user_id=106918)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### ( [URL](http://crash-stats.mozilla.com/query/query?product=ALL&version=ALL%3AALL&date=&range_value=2&range_unit=weeks&query_search=signature&query_type=exact&query=imgRequestProxy%3A%3AOnStopRequest%28nsIRequest*%2C+nsISupports*%2C+unsigned+int%2C+int%29&do_query=1 "http://crash-stats.mozilla.com/query/query?product=ALL&version=ALL%3AALL&date=&range_value=2&range_unit=weeks&query_search=signature&query_type=exact&query=imgRequestProxy%3A%3AOnStopRequest%28nsIRequest*%2C+nsISupports*%2C+unsigned+int%2C+int%29&do_que...") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[393936](/show_bug.cgi?id=393936 "VERIFIED FIXED - [PATCH] Crash [@ nsCellMapColumnIterator::GetNextFrame] with display: table-footer-group, binding, contenteditable and image")

Dependency [tree](/showdependencytree.cgi?id=508057&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=508057)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[crash-stats.mozilla.com/query/query?p...](http://crash-stats.mozilla.com/query/query?product=ALL&version=ALL%3AALL&date=&range_value=2&range_unit=weeks&query_search=signature&query_type=exact&query=imgRequestProxy%3A%3AOnStopRequest%28nsIRequest*%2C+nsISupports*%2C+unsigned+int%2C+int%29&do_query=1 "http://crash-stats.mozilla.com/query/query?product=ALL&version=ALL%3AALL&date=&range_value=2&range_unit=weeks&query_search=signature&query_type=exact&query=imgRequestProxy%3A%3AOnStopRequest%28nsIRequest*%2C+nsISupports*%2C+unsigned+int%2C+int%29&do_que...")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

1

Bug Flags:

| [mossop](/user_profile?user_id=91159) | [blocking1.9.2](#a4326813_91159 "15 years ago") | + |
| --- | --- | --- |
| [mossop](/user_profile?user_id=91159) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#c23 "15 years ago") | ? |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c8 "15 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ]](https://crash-stats.mozilla.org/signature/?signature=imgRequestProxy%3A%3AOnStopRequest%28nsIRequest%2A%2C%20nsISupports%2A%2C%20unsigned%20int%2C%20int%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Proposed patch](/attachment.cgi?id=392273)  [15 years ago](#c1)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   851 bytes, patch | joe : [review+](#c6 "15 years ago")  samuel.sidler+old : [approval1.9.1.3+](#a554440_190622 "15 years ago") | [Details](/attachment.cgi?id=392273&action=edit) | [Diff](/attachment.cgi?id=392273&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=392273) |
| --- | --- | --- |
| [Cancel -> CancelAndForgetObserver](/attachment.cgi?id=397387)  [15 years ago](#c15)  [Joe Drew (not getting mail)](/user_profile?user_id=94)   647 bytes, patch | bzbarsky : [review+](#c16 "15 years ago")  dveditz : [approval1.9.1.4+](#c19 "15 years ago") | [Details](/attachment.cgi?id=397387&action=edit) | [Diff](/attachment.cgi?id=397387&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=397387) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Kevin Brosnan](/user_profile?user_id=106918)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=508057#c0)• 15 years ago |
|  | |

The extension developer reported that his theme is causing crashes in Firefox. BZ asked me to file a bug so this would not get lost. <http://forums.mozillazine.org/viewtopic.php?f=18&t=1395115>
Install the classic compact theme and Classic Compact Options
<https://addons.mozilla.org/en-US/firefox/addons/versions/6969>
<https://addons.mozilla.org/en-US/firefox/addons/versions/3699>
Use the Classic Compact Options to set the "background style" to "flat"
bookmarks > organize bookmarks will often crash Firefox
Crash stats link in the url ~75 crashes a week.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a152_20209)• 15 years ago |

Group: core-security

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a396_20209)• 15 years ago |

Blocks: [393936](/show_bug.cgi?id=393936 "VERIFIED FIXED - [PATCH] Crash [@ nsCellMapColumnIterator::GetNextFrame] with display: table-footer-group, binding, contenteditable and image")blocking1.9.1: --- → ?Flags: blocking1.9.2?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=508057#c1)• 15 years ago |
|  | |

Attached patch

[Proposed patch](attachment.cgi?id=392273&action=diff)
— [Details](attachment.cgi?id=392273&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=392273)

Assignee: nobody → bzbarskyStatus: NEW → ASSIGNED
[Attachment #392273](/attachment.cgi?id=392273&action=edit "Proposed patch") -
Flags: review?(joe)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a687_190622)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=508057#c2)• 15 years ago |
|  | |

Just to be clear, this is much like [bug 493240](/show_bug.cgi?id=493240 "RESOLVED FIXED - crash in imglib [@imgRequestProxy::OnStopRequest]") in terms of branch/security stuff.

|  | [KLB](/user_profile?user_id=231632) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=508057#c3)• 15 years ago |
|  | |

Most crashes in past week caused by me trying to figure out what is going on. I am getting scattered reports from other users of the crash issue. Only crashes when Classic Compact Options "background style" option is set to either "flat" or "flat except tabs". I have not been able to cause crashes with other option combinations or with default Classic Compact theme.
I have gone through all related CSS and can not find obvious CSS errors.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=508057#c4)• 15 years ago |
|  | |

(In reply to [comment #2](/show_bug.cgi?id=508057#c2 "VERIFIED FIXED - crash [@ imgRequestProxy::OnStopRequest(nsIRequest*, nsISupports*, unsigned int, int) ] Classic Compact theme"))
> Just to be clear, this is much like [bug 493240](/show_bug.cgi?id=493240 "RESOLVED FIXED - crash in imglib [@imgRequestProxy::OnStopRequest]") in terms of branch/security
> stuff.
Security-wise? Or interface-using-wise?blocking1.9.1: ? → .3+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=508057#c5)• 15 years ago |
|  | |

The former; I have no idea what you mean by the latter.... ;)

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=508057#c6)• 15 years ago |
|  | |

Comment on [attachment 392273](/attachment.cgi?id=392273 "Proposed patch") [[details]](/attachment.cgi?id=392273&action=edit "Proposed patch") [[diff]](/attachment.cgi?id=392273&action=diff "Proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=392273)
Proposed patch
I still don't know of any way to ask DXR for things that call Cancel on an imgIRequest :(
[Attachment #392273](/attachment.cgi?id=392273&action=edit "Proposed patch") -
Flags: review?(joe) → review+

|  | [KLB](/user_profile?user_id=231632) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=508057#c7)• 15 years ago |
|  | |

If it is any help, I think I got my theme/extension combo to stop crashing Firefox 3.5.1. What I did was better synchronize my editBookmarkOverlay.css with the default Firefox editBookmarkOverlay.css by adding the following CSS to my version:
===begin added CSS====
/\* Hide the value column of the tag autocomplete popup
\* leaving only the comment column visible. This is
\* so that only the tag being edited is shown in the
\* popup.
\*/
#editBMPanel\_tagsField #treecolAutoCompleteValue {
visibility: collapse;
}
/\* ::::: bookmark panel dropdown icons ::::: \*/
#editBMPanel\_folderMenuList[selectedIndex="0"],
#editBMPanel\_toolbarFolderItem {
list-style-image: url("chrome://browser/skin/places/bookmarksToolbar.png") !important;
-moz-image-region: auto !important;
}
#editBMPanel\_folderMenuList[selectedIndex="1"],
#editBMPanel\_bmRootItem {
list-style-image: url("chrome://browser/skin/places/bookmarksMenu.png") !important;
-moz-image-region: auto !important;
}
#editBMPanel\_folderMenuList[selectedIndex="2"],
#editBMPanel\_unfiledRootItem {
list-style-image: url("chrome://browser/skin/places/unsortedBookmarks.png") !important;
-moz-image-region: auto !important;
}
===End Added CSS===
I have no idea why this mattered and I don't notice visual changes to the bookmarks library. What I do know is that since I added this code I have been unable to get Firefox to crash regardless of how the "background style" option is set in Classic Compact Options. A test build of Classic Compact with the above CSS added can be downloaded and tried from <http://environmentalchemistry.com/classiccompact.jar>. Once I have confirmation from others that this indeed stops the crashes I will push this update to AMO.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a25375_1689)• 15 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Whiteboard: [sg:critical?]

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a27589_15223)• 15 years ago |

Summary: crash @imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ] Classic Compact theme → crash [@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ] Classic Compact theme

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=508057#c8)• 15 years ago |
|  | |

Pushed <http://hg.mozilla.org/mozilla-central/rev/a7e5345ecbea>Status: ASSIGNED → RESOLVEDClosed: 15 years agoFlags: in-testsuite?Resolution: --- → FIXED

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=508057#c9)• 15 years ago |
|  | |

Boris: Is this patch ready for 1.9.1? Can you request approval if so?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a554201_20209)• 15 years ago |

[Attachment #392273](/attachment.cgi?id=392273&action=edit "Proposed patch") -
Flags: approval1.9.1.3?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a554440_190622)• 15 years ago |

[Attachment #392273](/attachment.cgi?id=392273&action=edit "Proposed patch") -
Flags: approval1.9.1.3? → approval1.9.1.3+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=508057#c10)• 15 years ago |
|  | |

Comment on [attachment 392273](/attachment.cgi?id=392273 "Proposed patch") [[details]](/attachment.cgi?id=392273&action=edit "Proposed patch") [[diff]](/attachment.cgi?id=392273&action=diff "Proposed patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=392273)
Proposed patch
Approved for 1.9.1.3. a=ss

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=508057#c11)• 15 years ago |
|  | |

Pushed <http://hg.mozilla.org/releases/mozilla-1.9.1/rev/604b99ffe2c9>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.3-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.3-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=508057#c12)• 15 years ago |
|  | |

This does not appear to be fixed in 1.9.1. Using the extension and theme linked above (before they were fixed on August 4) with both 1.9.1.2 and a post-fix 1.9.1.3 build, I easily get the crash while doing organize bookmarks.
Tested with Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.3pre) Gecko/20090817 Shiretoko/3.5.3pre (.NET CLR 3.5.30729).

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=508057#c13)• 15 years ago |
|  | |

So this is now crashing because of an nsImageBoxFrame that calls Cancel() in UpdateImage(), but then apparently goes away shortly thereafter. Calling CancelAndForgetObserver() instead should work, but I'm not sure if it's 100% safe (see: [bug 393936](/show_bug.cgi?id=393936 "VERIFIED FIXED - [PATCH] Crash [@ nsCellMapColumnIterator::GetNextFrame] with display: table-footer-group, binding, contenteditable and image")).

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=508057#c14)• 15 years ago |
|  | |

Given the comments above, this isn't actually fixed for 1.9.1.3. We'll push it to 1.9.1.4.blocking1.9.1: .3+ → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[.3-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.3-fixed) → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=508057#c15)• 15 years ago |
|  | |

Attached patch

[Cancel -> CancelAndForgetObserver](attachment.cgi?id=397387&action=diff)
— [Details](attachment.cgi?id=397387&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=397387)

Sigh. At some point we'll have solved this ownership model, honest!Assignee: bzbarsky → joeStatus: RESOLVED → REOPENED
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: superreview?(bzbarsky)
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: review?Resolution: FIXED → ---

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a2184264_94)• 15 years ago |

[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: superreview?(bzbarsky)
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: review?(bzbarsky)
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: review?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=508057#c16)• 15 years ago |
|  | |

Comment on [attachment 397387](/attachment.cgi?id=397387 "Cancel -> CancelAndForgetObserver") [[details]](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") [[diff]](/attachment.cgi?id=397387&action=diff "Cancel -> CancelAndForgetObserver") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=397387)
Cancel -> CancelAndForgetObserver
r=bzbarsky
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: review?(bzbarsky) → review+

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=508057#c17)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/08c42708aad8>Status: REOPENED → RESOLVEDClosed: 15 years ago → 15 years agoResolution: --- → FIXED

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=508057#c18)• 15 years ago |
|  | |

Comment on [attachment 397387](/attachment.cgi?id=397387 "Cancel -> CancelAndForgetObserver") [[details]](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") [[diff]](/attachment.cgi?id=397387&action=diff "Cancel -> CancelAndForgetObserver") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=397387)
Cancel -> CancelAndForgetObserver
Applies cleanly to 1.9.1. Requesting approval.
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: approval1.9.1.4?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=508057#c19)• 15 years ago |
|  | |

Comment on [attachment 397387](/attachment.cgi?id=397387 "Cancel -> CancelAndForgetObserver") [[details]](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") [[diff]](/attachment.cgi?id=397387&action=diff "Cancel -> CancelAndForgetObserver") [[review]](/page.cgi?id=splinter.html&ignore=&bug=508057&attachment=397387)
Cancel -> CancelAndForgetObserver
Approved for 1.9.1.4, a=dveditz
[Attachment #397387](/attachment.cgi?id=397387&action=edit "Cancel -> CancelAndForgetObserver") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=508057#c20)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/0e2cdc91a769>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a4326813_91159)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+

|  | [Joe Drew (not getting mail)](/user_profile?user_id=94)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=508057#c21)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/41b236f244fd>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=508057#c22)• 15 years ago |
|  | |

Verified fixed on trunk, 1.9.2, and 1.9.1 with the builds below and Classic Compact theme 3.2.0 installed.
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a1pre) Gecko/20091006 Minefield/3.7a1pre (.NET CLR 3.5.30729) ID:20091006044117
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2b1pre) Gecko/20091007 Namoroka/3.6b1pre (.NET CLR 3.5.30729) ID:20091007045631
Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.4) Gecko/20091007 Firefox/3.5.4 (.NET CLR 3.5.30729) ID:20091007001339Status: RESOLVED → VERIFIEDKeywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)Target Milestone: --- → mozilla1.9.3a1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=508057#c23)• 15 years ago |
|  | |

nominating for 1.9.0 consideration:
This is a regression from [bug 393936](/show_bug.cgi?id=393936 "VERIFIED FIXED - [PATCH] Crash [@ nsCellMapColumnIterator::GetNextFrame] with display: table-footer-group, binding, contenteditable and image"). That patch didn't land in the main Mozilla repo for 1.9.0, but that bug has a 1.9.0 back-port by asac which presumably landed in Ubuntu and maybe other linux distros. If so they need this fix (and for [bug 493240](/show_bug.cgi?id=493240 "RESOLVED FIXED - crash in imglib [@imgRequestProxy::OnStopRequest]")) on that branch also.Flags: wanted1.9.0.x?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a6417261_1689)• 15 years ago |

Whiteboard: [sg:critical?] → [sg:critical?] keep bug closed while investigating comment 23

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=508057#c24)• 15 years ago |
|  | |

Ubuntu didn't pick up the older bug, we can unhide this one.Group: core-securityWhiteboard: [sg:critical?] keep bug closed while investigating comment 23 → [sg:critical?]

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a58663568_1)• 14 years ago |

Crash Signature: [@ imgRequestProxy::OnStopRequest(nsIRequest\*, nsISupports\*, unsigned int, int) ]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=508057#a195700306_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=508057&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_221bcf15_20250126_085756.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/514960)
* [XML](/show_bug.cgi?ctype=xml&id=514960)

Closed
[Bug 514960](/show_bug.cgi?id=514960)

Opened 15 years ago
Closed 15 years ago

# [1.9.0]Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[1.9.0]Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

1.9.0 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected) |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | unaffected |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: cbook, Assigned: MatsPalmgren\_bugz)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e7ca93d447a86b3e78cdf42d361b4d3a?d=mm&size=40)  [MatsPalmgren\_bugz](/user_profile?user_id=5168)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=40)  [cbook](/user_profile?user_id=277293)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### ( [URL](https://bugzilla.mozilla.org/attachment.cgi?id=316799 "https://bugzilla.mozilla.org/attachment.cgi?id=316799") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=514960&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=514960)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[bugzilla.mozilla.org/attachment.cgi?i...](https://bugzilla.mozilla.org/attachment.cgi?id=316799 "https://bugzilla.mozilla.org/attachment.cgi?id=316799")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[hang](/buglist.cgi?keywords=hang&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.15](#a338151_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.15 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a338151_1689 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.8.1.x](#c15 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.8.1.x | - |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | [in-testsuite](#c16 "15 years ago") | + |
| --- | --- | --- |
| [MatsPalmgren\_bugz](/user_profile?user_id=5168) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [stack etc](/attachment.cgi?id=398970)  [15 years ago](#c0)  [Carsten Book [:Tomcat]](/user_profile?user_id=277293)   19.50 KB, text/plain |  | [Details](/attachment.cgi?id=398970&action=edit) |
| --- | --- | --- |
| [191 patch in bug 425981 backported to 190](/attachment.cgi?id=399102)  [15 years ago](#c6)  [Mats Palmgren (inactive)](/user_profile?user_id=5168)   21.16 KB, patch | roc : [review+](#c8 "15 years ago")  bzbarsky : [superreview+](#a376051_20209 "15 years ago")  dveditz : [approval1.9.0.15+](#c9 "15 years ago") | [Details](/attachment.cgi?id=399102&action=edit) | [Diff](/attachment.cgi?id=399102&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514960&attachment=399102) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=514960#c0)• 15 years ago |
|  | |

Attached file
[stack etc](attachment.cgi?id=398970)
— [Details](attachment.cgi?id=398970&action=edit)

see testcase <https://bugzilla.mozilla.org/attachment.cgi?id=316799>
Loading this site hang Firefox 1.9.0 Debug Builds (seem not affecting 1.9.1).
!exploitable report:
(838.b20): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=ddddddf9 ebx=7ffd9000 ecx=ddddddf9 edx=046771a0 esi=00011490 edi=7c911460
eip=024ab51c esp=0012ca00 ebp=0012ca08 iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206
gklayout!nsCachedStyleData::GetStyleDisplay+0xc:
024ab51c 83780400 cmp dword ptr [eax+4],0 ds:0023:ddddddfd=????????
0:000> !exploitable -v
HostMachine\HostUser
Executing Processor Architecture is x86
Debuggee is in User Mode
Debuggee is a live user mode debugging session on the local machine
Event Type: Exception
\*\*\* WARNING: Unable to verify checksum for C:\work\mozilla\builds\1.9.0\mozilla\firefox-debug\dist\bin\components\gkwidget.dll
\*\*\* WARNING: Unable to verify checksum for C:\work\mozilla\builds\1.9.0\mozilla\firefox-debug\dist\bin\components\tkitcmps.dll
Exception Faulting Address: 0xffffffffddddddfd
First Chance Exception Type: STATUS\_ACCESS\_VIOLATION (0xC0000005)
Exception Sub-Type: Read Access Violation
Faulting Instruction:024ab51c cmp dword ptr [eax+4],0
Basic Block:
024ab51c cmp dword ptr [eax+4],0
Tainted Input Operands: eax
024ab520 je gklayout!nscachedstyledata::getstyledisplay+0x20 (024ab530)
Tainted Input Operands: ZeroFlag
Exception Hash (Major/Minor): 0x3f274d05.0x73176a3a
Stack Trace:
gklayout!nsCachedStyleData::GetStyleDisplay+0xc
gklayout!nsStyleContext::GetStyleDisplay+0x14
gklayout!nsIFrame::GetStyleDisplay+0x3b
gklayout!nsLayoutUtils::GetFloatFromPlaceholder+0x37
gklayout!nsLineLayout::ReflowFrame+0x47f
gklayout!nsBlockFrame::ReflowInlineFrame+0x69
gklayout!nsBlockFrame::DoReflowInlineFrames+0x1fc
gklayout!nsBlockFrame::ReflowInlineFrames+0xeb
gklayout!nsBlockFrame::ReflowLine+0x2cc
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x28b
gklayout!nsContainerFrame::ReflowChild+0xe6
gklayout!nsColumnSetFrame::ReflowChildren+0x417
gklayout!nsColumnSetFrame::Reflow+0x32e
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x28b
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x28b
gklayout!nsContainerFrame::ReflowChild+0xe6
gklayout!CanvasFrame::Reflow+0x13c
gklayout!nsContainerFrame::ReflowChild+0xe6
gklayout!nsHTMLScrollFrame::ReflowScrolledFrame+0x32e
gklayout!nsHTMLScrollFrame::ReflowContents+0x53
gklayout!nsHTMLScrollFrame::Reflow+0x249
gklayout!nsContainerFrame::ReflowChild+0xe6
gklayout!ViewportFrame::Reflow+0x15d
gklayout!PresShell::DoReflow+0x2eb
gklayout!PresShell::ProcessReflowCommands+0xf3
gklayout!PresShell::DoFlushPendingNotifications+0x189
gklayout!PresShell::ReflowEvent::Run+0x81
xpcom\_core!nsThread::ProcessNextEvent+0x1fa
xpcom\_core!NS\_ProcessNextEvent\_P+0x53
gkwidget!nsBaseAppShell::Run+0x5d
tkitcmps!nsAppStartup::Run+0x6b
xul!XRE\_main+0x2edf
firefox!NS\_internal\_main+0x2b2
firefox!wmain+0x119
firefox!\_\_tmainCRTStartup+0x1a6
firefox!wmainCRTStartup+0xd
kernel32!BaseProcessStart+0x23
Instruction Address: 0x00000000024ab51c
Description: Data from Faulting Address controls Branch Selection
Short Description: TaintedDataControlsBranchSelection
Exploitability Classification: UNKNOWN
Recommended Bug Title: Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay+0x000000000000000c (Hash=0x3f274d05.0x73176a3a)
The data from the faulting address is later used to determine whether or not a branch is taken.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=514960#c1)• 15 years ago |
|  | |

According to [bug 401734](/show_bug.cgi?id=401734 "RESOLVED WORKSFORME - Crash [@ nsBidiPresUtils::InitLogicalArray] [@ nsLayoutUtils::GetFloatFromPlaceholder] with float, columns and bidi characters") that bug was WFM on trunk/191pre by 2008-08-15. This testcase still crashed (in a new place) and was spun off into 451532, which was marked WFM March 2009. Somewhere in there is a fix for this bug.
Also, we should not be unhiding "wfm" security bugs until we've validated that they indeed "wfm" on all supported branches. For a security bug "wfm" should be the start of a search for the fix, not a reason to ignore the bug thereafter.Summary: Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay → [1.9.0]Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplayWhiteboard: [sg:critical?] fix-range-wanted

|  | [Gary Kwong [:gkw] [:nth10sd] (NOT official MoCo now)](/user_profile?user_id=132034) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=514960#c2)• 15 years ago |
|  | |

(In reply to [comment #1](/show_bug.cgi?id=514960#c1 "VERIFIED FIXED - [1.9.0]Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay"))
> According to [bug 401734](/show_bug.cgi?id=401734 "RESOLVED WORKSFORME - Crash [@ nsBidiPresUtils::InitLogicalArray] [@ nsLayoutUtils::GetFloatFromPlaceholder] with float, columns and bidi characters") that bug was WFM on trunk/191pre by 2008-08-15. This
> testcase still crashed (in a new place) and was spun off into 451532, which was
> marked WFM March 2009. Somewhere in there is a fix for this bug.
You mean [Bug 451532 comment 4](/show_bug.cgi?id=451532#c4 "RESOLVED WORKSFORME - Crash [@ nsLineList::begin][@ nsBlockInFlowLineIterator::Prev] with testcase3 of bug 401734")?
> This seems to have regressed between 2008-06-23 and 2008-07-01. A more precise
> regression range might be useful.

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=514960#c3)• 15 years ago |
|  | |

Crashes reliably on Linux, [bp-8ae40432-c3e0-465f-a0e9-9f4032090907](https://crash-stats.mozilla.org/report/index/8ae40432-c3e0-465f-a0e9-9f4032090907)
It was fixed in the range 2009-01-07-02 -- 2009-01-08-02.
<http://hg.mozilla.org/mozilla-central/pushloghtml?startdate=2009-01-07+00%3A00&enddate=2009-01-08+04%3A00>
The fix for [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") is in that range.
A local 1.9.1 Linux debug build does NOT crash. Backing out the 191 fix
for [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") makes it crash, with the same stack as above.
We're accessing a dead frame, so marking it [sg:critical].Flags: blocking1.9.0.15?Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)OS: Windows XP → AllHardware: x86 → AllWhiteboard: [sg:critical?] fix-range-wanted → [sg:critical]

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=514960#c4)• 15 years ago |
|  | |

Mats: Can you work up a backport of the patch in [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") and make sure that's all that's needed to fix this bug on the 1.9.0 branch?

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=514960#c5)• 15 years ago |
|  | |

Yes, I've backported the 191 patch to 190 which was straight forward.
I'm reviewing the code and see if it's enough now. If all looks ok
I'll attach the patch in a couple of hours...

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=514960#c6)• 15 years ago |
|  | |

Attached patch

[191 patch in bug 425981 backported to 190](attachment.cgi?id=399102&action=diff)
— [Details](attachment.cgi?id=399102&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=514960&attachment=399102)

With this patch the first-letter frame construction code in 1.9.0
is pretty much identical to 1.9.1. FWIW, the handling of pseudo
frames in ProcessChildren() is slightly different, due to [bug 238072](/show_bug.cgi?id=238072 "RESOLVED FIXED - [GC] support positioned and floated generated content for non-replaced elements"),
but I don't think it should affect this patch.
The patch passes reftest and crashtest with a local debug build.
It's cooking on TryServer now.
ProcessChildren() difference, for reference:
ProcessChildren in 191:
// save the incoming pseudo frame state
CreateGeneratedContentFrame
ConstructFrame
CreateGeneratedContentFrame
ProcessPseudoFrames
// restore the incoming pseudo frame state
WrapFramesInFirstLetter/Line
ProcessChildren in 190:
CreateGeneratedContentFrame
// save the incoming pseudo frame state
ConstructFrame
ProcessPseudoFrames
// restore the incoming pseudo frame state
CreateGeneratedContentFrame
WrapFramesInFirstLetter/Line
<https://bugzilla.mozilla.org/attachment.cgi?id=333217&action=diff#a/layout/base/nsCSSFrameConstructor.cpp_sec17>Assignee: nobody → matspal
[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: review?(roc)

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=514960#c7)• 15 years ago |
|  | |

TryServer builds with the attached patch:
[https://build.mozilla.org/tryserver-builds/mpalmgren@mozilla.com-1252353513/](https://build.mozilla.org/tryserver-builds/mpalmgren%40mozilla.com-1252353513/)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=514960#c8)• 15 years ago |
|  | |

Comment on [attachment 399102](/attachment.cgi?id=399102 "191 patch in bug 425981 backported to 190") [[details]](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") [[diff]](/attachment.cgi?id=399102&action=diff "191 patch in bug 425981 backported to 190") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514960&attachment=399102)
191 patch in [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") backported to 190
Thanks
[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: review?(roc) → review+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a96295_5168)• 15 years ago |

[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: approval1.9.0.15?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a337882_1689)• 15 years ago |

Depends on: [425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a338151_1689)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)Flags: wanted1.9.0.x+Flags: blocking1.9.0.15?Flags: blocking1.9.0.15+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=514960#c9)• 15 years ago |
|  | |

Comment on [attachment 399102](/attachment.cgi?id=399102 "191 patch in bug 425981 backported to 190") [[details]](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") [[diff]](/attachment.cgi?id=399102&action=diff "191 patch in bug 425981 backported to 190") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514960&attachment=399102)
191 patch in [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") backported to 190
Approved for 1.9.0.15, a=dveditz for release-drivers
[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: approval1.9.0.15? → approval1.9.0.15+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=514960#c10)• 15 years ago |
|  | |

Comment on [attachment 399102](/attachment.cgi?id=399102 "191 patch in bug 425981 backported to 190") [[details]](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") [[diff]](/attachment.cgi?id=399102&action=diff "191 patch in bug 425981 backported to 190") [[review]](/page.cgi?id=splinter.html&ignore=&bug=514960&attachment=399102)
191 patch in [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") backported to 190
As a security bug, per our new policy, this patch needs explicit super-review
from a second person. <http://www.mozilla.org/hacking/reviewers.html>
[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: superreview?(bzbarsky)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a376051_20209)• 15 years ago |

[Attachment #399102](/attachment.cgi?id=399102&action=edit "191 patch in bug 425981 backported to 190") -
Flags: superreview?(bzbarsky) → superreview+

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=514960#c11)• 15 years ago |
|  | |

The fix landed on CVS HEAD:
mozilla/layout/base/nsCSSFrameConstructor.cpp 1.1487
mozilla/layout/base/nsCSSFrameConstructor.h 1.264
Holding the crashtest until after 1.9.0.15 release. I know, it's
already in the tree as part of [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter"), but I wanted to reveal as
little as possible in this checkin.Status: NEW → RESOLVEDClosed: 15 years ago
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_192&o1=equals&v1=unaffected)Flags: in-testsuite?Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---)Resolution: --- → FIXED

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=514960#c12)• 15 years ago |
|  | |

So, Mats, the crashtest from [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") will be checked into 1.9.0 after release?

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=514960#c13)• 15 years ago |
|  | |

Verified fixed using testcase in 1.9.0 with Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.0.15pre) Gecko/2009091321 GranParadiso/3.0.15pre (.NET CLR 3.5.30729) (my own debug build).Status: RESOLVED → VERIFIED

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=514960#c14)• 15 years ago |
|  | |

(In reply to [comment #12](/show_bug.cgi?id=514960#c12 "VERIFIED FIXED - [1.9.0]Data from Faulting Address controls Branch Selection starting at gklayout!nsCachedStyleData::GetStyleDisplay"))
> So, Mats, the crashtest from [bug 425981](/show_bug.cgi?id=425981 "RESOLVED FIXED - \"ASSERTION: What happened here?\" with -moz-column, floating first-letter") will be checked into 1.9.0 after
> release?
Yes, that's the plan.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a1546098_280903)• 15 years ago |

Keywords: [fixed1.9.0.15](/buglist.cgi?keywords=fixed1.9.0.15&resolution=---) → [verified1.9.0.15](/buglist.cgi?keywords=verified1.9.0.15&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=514960#c15)• 15 years ago |
|  | |

Doesn't appear to affect the 1.8 branchFlags: wanted1.8.1.x-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=514960#a4429971_1689)• 15 years ago |

Group: core-security

|  | [Mats Palmgren (inactive)](/user_profile?user_id=5168)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=514960#c16)• 15 years ago |
|  | |

Checked in the crash test on CVS trunk:
mozilla/layout/base/crashtests/425981-1.html 1.1
mozilla/layout/base/crashtests/crashtests.list 1.102Flags: in-testsuite? → in-testsuite+
You need to [log in](/show_bug.cgi?id=514960&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Carsten Book [:Tomcat]](/user_profile?user_id=277293)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d1e3e132_20250125_133005.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/516709)
* [XML](/show_bug.cgi?ctype=xml&id=516709)

Closed
[Bug 516709](/show_bug.cgi?id=516709)

Opened 15 years ago
Closed 15 years ago

# Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059

## Categories

### (Core :: Graphics, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

1.9.1 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: cbook, Assigned: jtd)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/574c3df3e7f7c790e412292ab6a070fd?d=mm&size=40)  [jtd](/user_profile?user_id=280585)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=40)  [cbook](/user_profile?user_id=277293)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### ( [URL](http://www.laserwords.com/commercial.php "http://www.laserwords.com/commercial.php") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[526869](/show_bug.cgi?id=526869 "RESOLVED WONTFIX - [@font-face] font with invalid cmap stopped working in 3.5.4")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=516709&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=516709)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[laserwords.com/commercial.php](http://www.laserwords.com/commercial.php "http://www.laserwords.com/commercial.php")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, verified1.9.1, Whiteboard: [sg:vector-critical][MS ref: 9458mh --keep private until their patch, ETA ~May 2010])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:vector-critical][MS ref: 9458mh --keep private until their patch, ETA ~May 2010]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [beltzner](/user_profile?user_id=137548) | [blocking1.9.2](#a710797_137548 "15 years ago") | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a2710753_1689 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 1 obsolete file)

| [more detailed information (stack) from windbg/!exploitable](/attachment.cgi?id=400764)  [15 years ago](#c0)  [Carsten Book [:Tomcat]](/user_profile?user_id=277293)   21.45 KB, text/plain |  | [Details](/attachment.cgi?id=400764&action=edit) |
| --- | --- | --- |
| [local copy of the page](/attachment.cgi?id=400797)  [15 years ago](#c7)  [Carsten Book [:Tomcat]](/user_profile?user_id=277293)   112.33 KB, application/zip |  | [Details](/attachment.cgi?id=400797&action=edit) |
| [The font (crashes mac, too)](/attachment.cgi?id=400829)  [15 years ago](#c10)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   57.84 KB, application/octet-stream |  | [Details](/attachment.cgi?id=400829&action=edit) |
| [testcase, self-contained using font data url](/attachment.cgi?id=400960)  [15 years ago](#c11)  [John Daggett (:jtd)](/user_profile?user_id=280585)   141.88 KB, text/html |  | [Details](/attachment.cgi?id=400960&action=edit) |
| [patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)](/attachment.cgi?id=400971)  [15 years ago](#c12)  [John Daggett (:jtd)](/user_profile?user_id=280585)   8.83 KB, patch |  | [Details](/attachment.cgi?id=400971&action=edit) | [Diff](/attachment.cgi?id=400971&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=400971) |
| [ftdump -v (cmaps from FreeType)](/attachment.cgi?id=400990)  [15 years ago](#c15)  [Karl Tomlinson (:karlt)](/user_profile?user_id=274246)   14.61 KB, text/plain |  | [Details](/attachment.cgi?id=400990&action=edit) |
| [patch, v.0.3d, update based on review comments](/attachment.cgi?id=401178)  [15 years ago](#c18)  [John Daggett (:jtd)](/user_profile?user_id=280585)   14.39 KB, patch | jfkthame : [review+](#a174193_329583 "15 years ago")  dbaron : [approval1.9.2+](#c26 "15 years ago")  dveditz : [approval1.9.1.4+](#a544650_1689 "15 years ago") | [Details](/attachment.cgi?id=401178&action=edit) | [Diff](/attachment.cgi?id=401178&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=516709#c0)• 15 years ago |
|  | |

Attached file
[more detailed information (stack) from windbg/!exploitable](attachment.cgi?id=400764)
— [Details](attachment.cgi?id=400764&action=edit)

1.9.1 Nightly Debug Build
steps to reproduce:
-> Load <http://www.laserwords.com/commercial.php> in a debugger
--> !exploitable report a problem
93c.c18): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=ffff0104 ebx=0519e7c8 ecx=00000000 edx=00baad04 esi=05196578 edi=ffff0105
eip=74da6e19 esp=00126448 ebp=00126458 iopl=0 nv up ei ng nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010286
USP10!LoadCmapFontGlyphs+0x59:
74da6e19 66893c53 mov word ptr [ebx+edx\*2],di ds:0023:068f41d0=????
0:000> !exploitable -v
HostMachine\HostUser
Executing Processor Architecture is x86
Debuggee is in User Mode
Debuggee is a live user mode debugging session on the local machine
Event Type: Exception
Exception Faulting Address: 0x68f41d0
First Chance Exception Type: STATUS\_ACCESS\_VIOLATION (0xC0000005)
Exception Sub-Type: Write Access Violation
Exception Hash (Major/Minor): 0x287e0601.0x7074110b
Stack Trace:
USP10!LoadCmapFontGlyphs+0x59
USP10!FillCMAP+0x36
USP10!LoadFont+0x1de
USP10!FindOrCreateFaceCache+0x9c
USP10!FindOrCreateSizeCacheWithoutRealizationID+0xc7
USP10!FindOrCreateSizeCacheUsingRealizationID+0x5d
USP10!UpdateCache+0x2c
USP10!ScriptCheckCache+0x67
USP10!ScriptShape+0x88
thebes!UniscribeItem::ShapeUniscribe+0x11a
thebes!UniscribeItem::Shape+0x3a
thebes!gfxWindowsFontGroup::InitTextRunUniscribe+0x19b
thebes!gfxWindowsFontGroup::MakeTextRun+0x169
thebes!TextRunWordCache::MakeTextRun+0x7bb
thebes!gfxTextRunWordCache::MakeTextRun+0x2f
gklayout!MakeTextRun+0x77
gklayout!BuildTextRunsScanner::BuildTextRunForFrames+0xcef
gklayout!BuildTextRunsScanner::FlushFrames+0x1f6
gklayout!BuildTextRuns+0x656
gklayout!nsTextFrame::EnsureTextRun+0xb2
gklayout!nsTextFrame::Reflow+0x420
gklayout!nsLineLayout::ReflowFrame+0x3ab
gklayout!nsBlockFrame::ReflowInlineFrame+0x5e
gklayout!nsBlockFrame::DoReflowInlineFrames+0x210
gklayout!nsBlockFrame::ReflowInlineFrames+0xf2
gklayout!nsBlockFrame::ReflowLine+0x2c2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsBlockReflowContext::ReflowBlock+0x1a3
gklayout!nsBlockFrame::ReflowBlockFrame+0x6b3
gklayout!nsBlockFrame::ReflowLine+0xd2
gklayout!nsBlockFrame::ReflowDirtyLines+0x561
gklayout!nsBlockFrame::Reflow+0x251
gklayout!nsContainerFrame::ReflowChild+0xe9
Instruction Address: 0x0000000074da6e19
Description: User Mode Write AV
Short Description: WriteAV
Exploitability Classification: EXPLOITABLE
Recommended Bug Title: Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059 (Hash=0x287e0601.0x7074110b)
User mode write access violations that are not near NULL are exploitable.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=516709#c1)• 15 years ago |
|  | |

oh and also crash the debug build when loading the url
(9e0.6c4): Access violation - code c0000005 (!!! second chance !!!)
eax=ffff0104 ebx=051bef50 ecx=00000000 edx=00ae0004 esi=051be1f0 edi=ffff0105
eip=74da6e19 esp=00126448 ebp=00126458 iopl=0 nv up ei ng nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00000286
USP10!ScriptApplyDigitSubstitution+0x21a7:
74da6e19 66893c53 mov word ptr [ebx+edx\*2],di ds:0023:0677ef58=????
0:000> cdb: Reading initial command '!load winext\msec.dll;.logappend;!exploitab
le;k;q'
Opened log file 'dbgeng.log'
Exploitability Classification: EXPLOITABLE
Recommended Bug Title: Exploitable - User Mode Write AV starting at USP10!Script
ApplyDigitSubstitution+0x00000000000021a7 (Hash=0x5819333f.0x704a675e)
User mode write access violations that are not near NULL are exploitable.
ChildEBP RetAddr
WARNING: Stack unwind information not available. Following frames may be wrong.
00126458 74da7de3 USP10!ScriptApplyDigitSubstitution+0x21a7
00126480 74da833e USP10!ScriptApplyDigitSubstitution+0x3171
001266f0 74da506a USP10!ScriptApplyDigitSubstitution+0x36cc
00126710 74da581a USP10!ScriptApplyDigitSubstitution+0x3f8
00126810 74da5a8e USP10!ScriptApplyDigitSubstitution+0xba8
00126834 74da5ea3 USP10!ScriptApplyDigitSubstitution+0xe1c
0012684c 74da5f8b USP10!ScriptApplyDigitSubstitution+0x1231
0012686c 74da2ea2 USP10!ScriptApplyDigitSubstitution+0x1319
0012688c 01ef309a USP10!ScriptShape+0x88
001268d4 01ef2f6a thebes!UniscribeItem::ShapeUniscribe+0x11a
001268e0 01ef2d3b thebes!UniscribeItem::Shape+0x3a
00126944 01ef10c9 thebes!gfxWindowsFontGroup::InitTextRunUniscribe+0x19b
00126a10 01edfadb thebes!gfxWindowsFontGroup::MakeTextRun+0x169
00126ff8 01ee06ff thebes!TextRunWordCache::MakeTextRun+0x7bb
00127014 02b9ccd7 thebes!gfxTextRunWordCache::MakeTextRun+0x2f
00127044 02b9c79f gklayout!MakeTextRun+0x77
00128494 02b9b106 gklayout!BuildTextRunsScanner::BuildTextRunForFrames+0xcef
001294bc 02b9e006 gklayout!BuildTextRunsScanner::FlushFrames+0x1f6
00129858 02b9d6e2 gklayout!BuildTextRuns+0x656
001298c8 02ba80a0 gklayout!nsTextFrame::EnsureTextRun+0xb2
quit:
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F)Whiteboard: crash

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=516709#c2)• 15 years ago |
|  | |

and also crashes opt builds on windows -> <http://crash-stats.mozilla.com/report/index/1e098a17-86b0-4f0a-ade3-6fab02090915?p=1>

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=516709#c3)• 15 years ago |
|  | |

usp10.dll is ms' uniscribe unicode service. dveditz, can you ping them?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=516709#c4)• 15 years ago |
|  | |

Tomcat:
- Does this crash 1.9.2 or trunk?
This might be crashing on a bad font -- your font or one downloaded? We need to capture the problem page/font before we can send info to MS.
(Does this crash IE? they support some downloaded fonts too, though if it's not that they may not be calling Uniscribe the way we do.)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a2865_1689)• 15 years ago |

blocking1.9.1: --- → ?
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[?](/buglist.cgi?f1=cf_status_191&o1=equals&v1=%3F) → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Whiteboard: crash → [sg:critical]

|  | [chris hofmann](/user_profile?user_id=2687) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=516709#c5)• 15 years ago |
|  | |

we see this signature show up in both fx3.x and 3.5x, but looks like it might
be only on Windows NT 5.1.2600 Service Pack 2, and 3.
here are crash reports for this signature for sept.
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/3778fb4f-7255-4e74-90d6-e27942090906>
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/3a6a3941-52f9-4ea5-8794-4a2242090911>
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/aa929652-4243-4d54-b9a4-6a19d2090911>
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/03fa0452-7e2d-4edf-8db5-2f6472090831>
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/7b959cf7-a376-4857-8b06-c29532090831>
1 Firefox 3.0.13 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/9fdb46f5-2472-48e8-ba6f-ca3962090902>
1 Firefox 3.0.7 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/e5cf1e54-10c5-499d-9e3e-850872090909>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/106d3ffa-110a-498b-bccd-19b362090909>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/2587fa38-3e09-403d-a875-390842090901>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/c10b00e3-345b-485e-a7cf-9e3f82090909>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 2
<http://crash-stats.mozilla.com/report/index/cb44d5bc-93ae-4208-abed-eb9c52090901>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/1c838e56-45b7-46e0-94fa-1c8122090905>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/39440237-edbf-47d5-be6d-9a2e92090901>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/80af3bbb-2f35-4185-a3d1-847a72090831>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/a878ac6f-8ba7-4865-a705-9ad6d2090903>
1 Firefox 3.5.2 Windows NT 5.1.2600 Service Pack 3
<http://crash-stats.mozilla.com/report/index/c4bff7aa-af7c-4dfc-9f7d-cda9e2090903>
I think bsterne is working on getting us a regular contact for windows crashes.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=516709#c6)• 15 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=516709#c4 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059"))
> Tomcat:
> - Does this crash 1.9.2 or trunk?
it crashes 1.9.2 -> <http://crash-stats.mozilla.com/report/index/b03cd9fb-15b8-4dc7-8820-4dec12090915?p=1>
was not able to crash on trunk so far on opt builds, but will build a new trunk debug build to check this.
> This might be crashing on a bad font -- your font or one downloaded? We need to > capture the problem page/font before we can send info to MS.
>
The VM where this Problem is reproducible is a "standard" en-US Win-XP with latest updates etc, no additional fonts - just the standard installation.
> (Does this crash IE? they support some downloaded fonts too, though if it's not
> that they may not be calling Uniscribe the way we do.)
No, does not crash with IE 8 (and latest updates).

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a7946_277293)• 15 years ago |

Flags: blocking1.9.2?

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=516709#c7)• 15 years ago |
|  | |

Attached file
[local copy of the page](attachment.cgi?id=400797)
— [Details](attachment.cgi?id=400797&action=edit)

zipped copy of this page, but was not able to reproduce this crash so far locally on this copy

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=516709#c8)• 15 years ago |
|  | |

I haven't looked yet, but that might point at downloadable fonts -- we have a same-origin restriction on those, and as a new feature probably aren't captured by the "save as webpage complete" feature.

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=516709#c9)• 15 years ago |
|  | |

Yeah, we needs to look through the source/stylesheets to see if there are DL fonts in use.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=516709#c10)• 15 years ago |
|  | |

Attached file
[The font (crashes mac, too)](attachment.cgi?id=400829)
— [Details](attachment.cgi?id=400829&action=edit)

There's the sncb.ttf font from lw.css -- it crashes my Mac "quick look viewer" too just accessing it in the finder.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=516709#c11)• 15 years ago |
|  | |

Attached file
[testcase, self-contained using font data url](attachment.cgi?id=400960)
— [Details](attachment.cgi?id=400960&action=edit)

Attached is a testcase that causes the bug on trunk debug/opt. Basically it loads and unloads the funky font via a data url to render random text to stress Uniscribe's handling of the font.
Looks like this is caused by a funky format-12 cmap, dumping the ttf out using ttx shows some funky codepoints:
<map code="0x2265" name="greaterequal"/><!-- GREATER-THAN OR EQUAL TO -->
<map code="0x25ca" name="lozenge"/><!-- LOZENGE -->
<map code="0xf8ff" name="uniF8FF"/><!-- Private Use -->
<map code="0xfb01" name="fi"/><!-- LATIN SMALL LIGATURE FI -->
<map code="0xfb02" name="fl"/><!-- LATIN SMALL LIGATURE FL -->
<map code="0xffff0104L" name=".notdef#2"/><!-- ???? -->
<map code="0xffff0105L" name=".notdef#3"/><!-- ???? -->
My guess is Uniscribe is not sanity checking these code points. I don't crash on the Mac but there are lots of funky error messages in the console:
Sep 16 15:56:45 john-daggetts-mac-pro [0x0-0x988988].org.mozilla.firefox[0]: firefox-bin(78139,0xa04a3720) malloc: \*\*\* mmap(size=67108864) failed (error code=12)
Sep 16 15:56:45 john-daggetts-mac-pro [0x0-0x988988].org.mozilla.firefox[0]: \*\*\* error: can't allocate region
Sep 16 15:56:45 john-daggetts-mac-pro [0x0-0x988988].org.mozilla.firefox[0]: \*\*\* set a breakpoint in malloc\_error\_break to debug
Need to make sure this is not us stomping on memory (for example, in our cmap handling code). We read in cmaps on Mac/Windows so we should be able to exclude fonts with funky cmaps like this.
Note that the site in question uses a funky DL font but many of the Sept crash reports are from 3.0 which did not support DL fonts so it's a general font system problem. Obviously DL fonts makes it more exploitable.
I'll see if I can set up an EOT testcase for testing with IE.Assignee: nobody → jdaggettStatus: NEW → ASSIGNED

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=516709#c12)• 15 years ago |
|  | |

Attached patch

[patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)](attachment.cgi?id=400971&action=diff) (obsolete)
— [Details](attachment.cgi?id=400971&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=400971)

When reading in the cmap, check that codepoints in the cmap are within the valid range of Unicode codepoints (i.e. <= 0x10FFFF). Also, distinguish from fonts that lack format 4 or format 12 cmaps from fonts that appear to have malformed cmaps. On Windows, only do glyph-by-glyph fallback for non-malformed cmaps.
One other note, running the test on Windows 7 I don't see any crashes so I'm guessing this has been fixed in the latest versions of Uniscribe.
Win XP SP3 w/ updates: usp10 version 1.420.2600.5512
Windows 7 RC: usp10 version 1.626.7100.0
[Attachment #400971](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") -
Flags: review?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=516709#c13)• 15 years ago |
|  | |

Not sure about the Linux case, that will depend on Pango since we don't use our own cmap-handling code under Linux. Karl, could you confirm?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a67406_280585)• 15 years ago |

[Attachment #400971](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") -
Flags: review? → review?(jfkthame)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=516709#c14)• 15 years ago |
|  | |

Comment on [attachment 400971](/attachment.cgi?id=400971 "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[details]](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[diff]](/attachment.cgi?id=400971&action=diff "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=400971)
patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)
> /\*\*
>+ \* gfx errors
>+ \*/
>+
>+/\* nsIDeviceContext.h defines a set of printer errors \*/
>+#define NS\_ERROR\_GFX\_GENERAL\_BASE (50)
>+
>+/\* Font cmap is strangely structured - avoid this font! \*/
>+#define NS\_ERROR\_GFX\_CMAP\_MALFORMED \
>+ NS\_ERROR\_GENERATE\_FAILURE(NS\_ERROR\_MODULE\_GFX,NS\_ERROR\_GFX\_GENERAL\_BASE+1)
I wish there was a more central place to do this, like maybe an nsGfxErrors.h header in gfx/public. I guess it's not crucial for now, and this is really only used internally, but in principle I think the error codes should be collected somewhere easier to find.
> const PRUint8 \*groups = aBuf + OffsetGroups;
> for (PRUint32 i = 0; i < numGroups; i++, groups += SizeOfGroup) {
> const PRUint32 startCharCode = ReadLongAt(groups, GroupOffsetStartCode);
> const PRUint32 endCharCode = ReadLongAt(groups, GroupOffsetEndCode);
>+ NS\_ENSURE\_TRUE(startCharCode <= CMAP\_MAX\_CODEPOINT && endCharCode <= CMAP\_MAX\_CODEPOINT, NS\_ERROR\_GFX\_CMAP\_MALFORMED);
> aCharacterMap.SetRange(startCharCode, endCharCode);
> }
Suggest making this check a little more thorough: check that startCharCode <= endCharCode, and check that startCharCode > the previous endCharCode. If either of these things fail, the cmap table is invalid.
Also please break the really long line.
>@@ -308,17 +309,17 @@ gfxFontUtils::ReadCMAPTableFormat4(PRUin
> for (PRUint32 c = startCount; c <= endCount; ++c) {
> if (c == 0xFFFF)
> break;
Sanity-check these start/end values before the loop (actually, before the preceding "if (idRangeOffset == 0)" test). If startCount > endCount, or if startCount <= previous value of endCount, we should reject the cmap as invalid (not just skip the loop and proceed to the next segment).
>+ NS\_ENSURE\_TRUE((PRUint8\*)gdata > aBuf && (PRUint8\*)gdata < aBuf + aLength, NS\_ERROR\_GFX\_CMAP\_MALFORMED);
Overlong line.
>- // ReadCMAP may change the values of mUnicodeFont and mSymbolFont
>- if (NS\_FAILED(::ReadCMAP(hdc, fe))) {
>+ rv = ::ReadCMAP(hdc, fe);
>+
>+ // ReadCMAP can fail but only handle failure cases when the font
>+ // did \*not\* have a cmap that appears to be malformed. Uniscribe
>+ // can crash with corrupt cmaps.
>+ if (NS\_FAILED(rv) && rv != NS\_ERROR\_GFX\_CMAP\_MALFORMED) {
What is the intended behavior here when ReadCMAP returns NS\_ERROR\_GFX\_CMAP\_MALFORMED?
AFAICS, we'd still end up using the font, just without a complete bitmap of "supported" characters. I think the proper response would be to delete the new FontEntry and return NULL from FontEntry::CreateFontEntry() instead -- if the font has a malformed cmap, we should reject it altogether rather than risk using it.

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=516709#c15)• 15 years ago |
|  | |

Attached file
[ftdump -v (cmaps from FreeType)](attachment.cgi?id=400990)
— [Details](attachment.cgi?id=400990&action=edit)

I haven't been able to produce a crash on Linux with a 64-bit trunk debug build or a 32-bit firefox-3.5.3pre nightly from 2009-08-12, either on [attachment 400960](/attachment.cgi?id=400960 "testcase, self-contained using font data url") [[details]](/attachment.cgi?id=400960&action=edit "testcase, self-contained using font data url") or on <http://www.laserwords.com/commercial.php>.
Yes, gfxPangoFonts.cpp (used in Linux builds) doesn't use the code modified by [attachment 400971](/attachment.cgi?id=400971 "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[details]](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[diff]](/attachment.cgi?id=400971&action=diff "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=400971). cmaps are read by FreeType (through fontconfig).
Here I've attached the FreeType's interpretation of the cmaps from ftdump -v.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a74973_277293)• 15 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=516709#c16)• 15 years ago |
|  | |

Looks like FreeType is ignoring the format 12 cmap table (platform 3, encoding 10) completely; it's not mentioned in that dump at all. Presumably it determines that it is invalid and (silently?) discards it.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=516709#c17)• 15 years ago |
|  | |

(In reply to [comment #12](/show_bug.cgi?id=516709#c12 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059"))
> One other note, running the test on Windows 7 I don't see any crashes so I'm
> guessing this has been fixed in the latest versions of Uniscribe.
>
> Win XP SP3 w/ updates: usp10 version 1.420.2600.5512
> Windows 7 RC: usp10 version 1.626.7100.0
for reference i did also tests on vista business sp2 (and latest updates) and vista is also affected (<http://crash-stats.mozilla.com/report/index/229eb045-cecd-4d03-85ca-077ab2090916?p=1>)
usp10 version : 1.626.6002.18005

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a114776_1689)• 15 years ago |

blocking1.9.1: ? → .4+

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=516709#c18)• 15 years ago |
|  | |

Attached patch

[patch, v.0.3d, update based on review comments](attachment.cgi?id=401178&action=diff)
— [Details](attachment.cgi?id=401178&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178)

On Windows, fonts with bad cmaps will cause FontEntry creation to fail. On the Mac, font entry creation will fail for downloadable fonts. For platform fonts, the cmap read happens lazily so it's more work to clean it out so for now I just reset the character map so that the font will never be used. Since this is a patch we need to push back into 1.9.1, I wanted to limit the scope somewhat.
Note: I also moved around the bitset include to where it should be, we should replace that eventually but not for this bug.
[Attachment #400971](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") -
Attachment is obsolete: true
[Attachment #401178](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") -
Flags: review?(jfkthame)
[Attachment #400971](/attachment.cgi?id=400971&action=edit "patch, v.0.2, validate codepoint ranges in cmaps (mac/windows)") -
Flags: review?(jfkthame)

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=516709#c19)• 15 years ago |
|  | |

Try server builds here:
[https://build.mozilla.org/tryserver-builds/jdaggett@mozilla.com-cmapcheck3/](https://build.mozilla.org/tryserver-builds/jdaggett%40mozilla.com-cmapcheck3/)

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=516709#c20)• 15 years ago |
|  | |

(In reply to [comment #19](/show_bug.cgi?id=516709#c19 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059"))
> Try server builds here:
>
> [https://build.mozilla.org/tryserver-builds/jdaggett@mozilla.com-cmapcheck3/](https://build.mozilla.org/tryserver-builds/jdaggett%40mozilla.com-cmapcheck3/)
Hi John, this tryserver builds worked fine on windows - was not able to crash on xp or vista

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a174193_329583)• 15 years ago |

[Attachment #401178](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") -
Flags: review?(jfkthame) → review+

|  | [Jonathan Kew [:jfkthame]](/user_profile?user_id=329583) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=516709#c21)• 15 years ago |
|  | |

Comment on [attachment 401178](/attachment.cgi?id=401178 "patch, v.0.3d, update based on review comments") [[details]](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") [[diff]](/attachment.cgi?id=401178&action=diff "patch, v.0.3d, update based on review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178)
patch, v.0.3d, update based on review comments
>+ PRUint32 prevEndCharCode = 0;
> for (PRUint32 i = 0; i < numGroups; i++, groups += SizeOfGroup) {
> const PRUint32 startCharCode = ReadLongAt(groups, GroupOffsetStartCode);
> const PRUint32 endCharCode = ReadLongAt(groups, GroupOffsetEndCode);
>+ NS\_ENSURE\_TRUE((prevEndCharCode < startCharCode || startCharCode == 0) &&
>+ startCharCode <= endCharCode &&
>+ endCharCode <= CMAP\_MAX\_CODEPOINT,
>+ NS\_ERROR\_GFX\_CMAP\_MALFORMED);
One small point: this isn't quite the right test, as it would allow a non-initial segment to reset startCharCode to zero, which implies an out-of-order segment, without detecting this as an error. Making the first part of the test
(prevEndCharCode < startCharCode || i == 0)
would fix this, I think.
>+ PRUint16 prevEndCount = 0;
> for (PRUint16 i = 0; i < segCount; i++) {
> const PRUint16 endCount = ReadShortAt16(endCounts, i);
> const PRUint16 startCount = ReadShortAt16(startCounts, i);
> const PRUint16 idRangeOffset = ReadShortAt16(idRangeOffsets, i);
>+
>+ // sanity-check range
>+ NS\_ENSURE\_TRUE((startCount > prevEndCount || startCount == 0) &&
>+ startCount <= endCount,
>+ NS\_ERROR\_GFX\_CMAP\_MALFORMED);
Same applies here.
Marking this as r+, but still recommend tightening up those validity checks before landing.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=516709#c22)• 15 years ago |
|  | |

Pushed to trunk (with suggested modification)
<http://hg.mozilla.org/mozilla-central/rev/1ee2863e89e2>
Sounds like corrupt format-12 cmaps don't affect FreeType, so I'm assuming this problem doesn't affect Linux.

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=516709#c23)• 15 years ago |
|  | |

Comment on [attachment 401178](/attachment.cgi?id=401178 "patch, v.0.3d, update based on review comments") [[details]](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") [[diff]](/attachment.cgi?id=401178&action=diff "patch, v.0.3d, update based on review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178)
patch, v.0.3d, update based on review comments
Need to push this to 1.9.2/1.9.1
[Attachment #401178](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") -
Flags: approval1.9.2?

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a208961_280585)• 15 years ago |

Status: ASSIGNED → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a544650_1689)• 15 years ago |

[Attachment #401178](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") -
Flags: approval1.9.1.4+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=516709#c24)• 15 years ago |
|  | |

Comment on [attachment 401178](/attachment.cgi?id=401178 "patch, v.0.3d, update based on review comments") [[details]](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") [[diff]](/attachment.cgi?id=401178&action=diff "patch, v.0.3d, update based on review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178)
patch, v.0.3d, update based on review comments
Approved for 1.9.1.4, a=dveditz for release-drivers

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=516709#c25)• 15 years ago |
|  | |

Pushed to 1.9.1 branch
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/b3a6533db3da>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a710797_137548)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P1

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=516709#c26)• 15 years ago |
|  | |

Comment on [attachment 401178](/attachment.cgi?id=401178 "patch, v.0.3d, update based on review comments") [[details]](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") [[diff]](/attachment.cgi?id=401178&action=diff "patch, v.0.3d, update based on review comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=516709&attachment=401178)
patch, v.0.3d, update based on review comments
Marking approval, though it doesn't need it now that it's a blocker.
[Attachment #401178](/attachment.cgi?id=401178&action=edit "patch, v.0.3d, update based on review comments") -
Flags: approval1.9.2? → approval1.9.2+

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=516709#c27)• 15 years ago |
|  | |

Pushed to 1.9.2 branch
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/ad95be4fe45d>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=516709#c28)• 15 years ago |
|  | |

Verified fixed for 1.9.1 using standalone testcase from [comment 11](/show_bug.cgi?id=516709#c11 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059") and my own debug build (Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.4pre) Gecko/20090929 Shiretoko/3.5.4pre (.NET CLR 3.5.30729)).Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a2710753_1689)• 15 years ago |

Flags: wanted1.9.0.x-

|  | [John Daggett (:jtd)](/user_profile?user_id=280585)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a4458560_280585)• 15 years ago |

Blocks: [526869](/show_bug.cgi?id=526869 "RESOLVED WONTFIX - [@font-face] font with invalid cmap stopped working in 3.5.4")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a7877088_1689)• 15 years ago |

No longer blocks: [526869](/show_bug.cgi?id=526869 "RESOLVED WONTFIX - [@font-face] font with invalid cmap stopped working in 3.5.4")Depends on: [526869](/show_bug.cgi?id=526869 "RESOLVED WONTFIX - [@font-face] font with invalid cmap stopped working in 3.5.4")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a13064225_1689)• 15 years ago |

Group: core-security

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=516709#c29)• 15 years ago |
|  | |

Re-hiding bug, apparently MS is fixing the underlying problem on their end and considers it critical.Group: core-securityWhiteboard: [sg:critical] → [sg:vector-critical] wait for MS

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a13315741_1689)• 15 years ago |

Whiteboard: [sg:vector-critical] wait for MS → [sg:vector-critical][MS ref: 9458mh --keep private until their patch, ETA ~May 2010]

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=516709#c30)• 14 years ago |
|  | |

(In reply to [comment #29](/show_bug.cgi?id=516709#c29 "RESOLVED FIXED - Exploitable - User Mode Write AV starting at USP10!LoadCmapFontGlyphs+0x0000000000000059"))
> Re-hiding bug, apparently MS is fixing the underlying problem on their end and
> considers it critical.
its now <http://www.microsoft.com/technet/security/bulletin/MS10-063.mspx>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=516709#a43129793_1689)• 14 years ago |

Group: core-security
You need to [log in](/show_bug.cgi?id=516709&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Carsten Book [:Tomcat]](/user_profile?user_id=277293)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_aa58bc6f_20250125_132959.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/503196)
* [XML](/show_bug.cgi?ctype=xml&id=503196)

Closed
[Bug 503196](/show_bug.cgi?id=503196)

Opened 16 years ago
Closed 16 years ago

# [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing

## Categories

### (Core :: Widget: Cocoa, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Cocoa#Widget%3A%20Cocoa)

Widget: Cocoa
▾

Core :: Widget: Cocoa
Mapping of cross platform widget interfaces to Mac Cocoa APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Cocoa&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Cocoa&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Cocoa)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.2a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: marcia, Assigned: smichaud)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/f4932c37bcceaf71fd2472886282a3cb?d=mm&size=40)  [smichaud](/user_profile?user_id=67806)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/cf7a6485ad75c35d66da0af6c88515d5?d=mm&size=40)  [marcia](/user_profile?user_id=8519)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/24794cf906e308aee53a5173f6f1ed09?d=mm&size=40)  [spohl](/user_profile?user_id=456485)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

17 people

## References

### ( [URL](http://www.dierenartspeeters.be/nl/coordinaten-15.htm "http://www.dierenartspeeters.be/nl/coordinaten-15.htm") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]")

Dependency [tree](/showdependencytree.cgi?id=503196&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=503196)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[dierenartspeeters.be/nl/coordinaten-1...](http://www.dierenartspeeters.be/nl/coordinaten-15.htm "http://www.dierenartspeeters.be/nl/coordinaten-15.htm")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (6 keywords, Whiteboard: [sg:moderate] critical if web site can cause crash w/out printing[crashkill][crashkill-fix])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:moderate] critical if web site can cause crash w/out printing[crashkill][crashkill-fix]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [benjamin](/user_profile?user_id=7044) | [blocking1.9.2](#a1187657_7044 "16 years ago") | + |
| --- | --- | --- |
| [benjamin](/user_profile?user_id=7044) | blocking1.9.2 | + |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | [blocking1.9.1.1](#a495170_137548 "16 years ago") | - |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.1.1 | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#c10 "16 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | - |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | [in-testsuite](#c27 "15 years ago") | ? |
| --- | --- | --- |
| [whimboo](/user_profile?user_id=76551) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsBaseWidget::Destroy() ]](https://crash-stats.mozilla.org/signature/?signature=nsBaseWidget%3A%3ADestroy%28%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 2 obsolete files)

| [testcase](/attachment.cgi?id=387608)  [16 years ago](#c2)  [Martijn Wargers (dead)](/user_profile?user_id=55600)   331 bytes, text/html |  | [Details](/attachment.cgi?id=387608&action=edit) |
| --- | --- | --- |
| [Debugging patch (partially disable patch for bug 487393), \*not\* a fix](/attachment.cgi?id=388799)  [16 years ago](#c6)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   1.88 KB, patch |  | [Details](/attachment.cgi?id=388799&action=edit) | [Diff](/attachment.cgi?id=388799&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=388799) |
| [Debugging patch rev1 (minimize further), still \*not\* a fix](/attachment.cgi?id=388803)  [16 years ago](#c7)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   780 bytes, patch |  | [Details](/attachment.cgi?id=388803&action=edit) | [Diff](/attachment.cgi?id=388803&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=388803) |
| [Fix](/attachment.cgi?id=389127)  [16 years ago](#c8)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   2.96 KB, patch | jaas : [review+](#c11 "16 years ago") | [Details](/attachment.cgi?id=389127&action=edit) | [Diff](/attachment.cgi?id=389127&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389127) |
| [Fix for 1.9.1 branch](/attachment.cgi?id=389487)  [16 years ago](#c13)  [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)   3.57 KB, patch | dveditz : [approval1.9.1.4+](#c28 "15 years ago") | [Details](/attachment.cgi?id=389487&action=edit) | [Diff](/attachment.cgi?id=389487&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=503196#c0)• 16 years ago |
|  | |

Seen while running Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5
STR:
1. Visit the site in the URL.
2. Print to a local printer - in my case an Epson Stylus C88+
3. Crash immediately, 100% reproducible.
Breakpad: <http://crash-stats.mozilla.com/report/index/2deeca2f-b2fe-4055-8468-2ad792090708>. There are currently 576 crashes in this stack for people using Mac and Firefox 3.5, and several of the comments reference printing. I obtained the URL from the crash comments.

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a24_8519)• 16 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=503196#c1)• 16 years ago |
|  | |

mw22 asked me to try printing this site from a Windows machine to see if I got the crash as well, but I do not get the crash printing from a Win Vista machine.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=503196#c2)• 16 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=387608)
— [Details](attachment.cgi?id=387608&action=edit)

Thanks, Marcia. That means this seems to be a Mac widget issue.
The testcase crashes with this stacktrace:
<http://crash-stats.mozilla.com/report/index/262f155e-9b16-4ea0-ac28-431c72090709?p=1>
0 XUL nsBaseWidget::Destroy widget/src/xpwidgets/nsBaseWidget.cpp:252
1 XUL nsChildView::Destroy widget/src/cocoa/nsChildView.mm:718
2 XUL XUL@0x569f4f
3 XUL XUL@0x569f3f
4 XUL nsFrame::Destroy layout/generic/nsFrame.cpp:483
5 XUL nsLineBox::DeleteLineList layout/generic/nsLineBox.cpp:338
6 XUL nsBlockFrame::Destroy layout/generic/nsBlockFrame.cpp:298
7 XUL nsLineBox::DeleteLineList layout/generic/nsLineBox.cpp:338
8 XUL nsBlockFrame::Destroy layout/generic/nsBlockFrame.cpp:298
9 XUL XUL@0x26d61c
10 XUL nsContainerFrame::Destroy layout/generic/nsContainerFrame.cpp:266
11 XUL CanvasFrame::Destroy layout/generic/nsHTMLFrame.cpp:227
12 XUL XUL@0x26d61c
13 XUL nsContainerFrame::Destroy layout/generic/nsContainerFrame.cpp:266
14 XUL XUL@0x26d61c
15 XUL nsContainerFrame::Destroy layout/generic/nsContainerFrame.cpp:266
16 XUL nsFrameManager::Destroy layout/base/nsFrameManager.cpp:290
17 XUL PresShell::Destroy layout/base/nsPresShell.cpp:2035
18 XUL nsPrintObject::DestroyPresentation layout/printing/nsPrintObject.cpp:98
19 XUL nsPrintEngine::SetupToPrintContent layout/printing/nsPrintEngine.cpp:1678
20 XUL nsPrintEngine::DoCommonPrint
etc..

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=503196#c3)• 16 years ago |
|  | |

The testcase doesn't crash Firefox 3, so this is a regression. It also crashes trunk. A regression range might be useful (I'm afraid I don't have the builds to do that for the Mac).
This is nr. 7 in the topcrash list for Firefox 3.5 on the Mac:
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.5&platform=mac&date=&range_value=1&range_unit=weeks&query_search=signature&query_type=exact&query>=
Basically all the comments mentioned that they were trying to print something:
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.5&platform=mac&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsBaseWidget%3A%3ADestroy%28%29>Flags: wanted1.9.2?Flags: wanted1.9.1.x?Flags: blocking1.9.2?Flags: blocking1.9.1.1?Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)Version: 1.9.1 Branch → Trunk

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=503196#c4)• 16 years ago |
|  | |

I can't reproduce the crash with this bug's URL
(<http://www.dierenartspeeters.be/nl/coordinaten-15.htm>, which may have
changed). But I can easily reproduce it with Martijn's testcase
([attachment 387608](/attachment.cgi?id=387608 "testcase") [[details]](/attachment.cgi?id=387608&action=edit "testcase")), using File : Print : Preview.
The crash is almost certainly caused by accessing a deleted object (at
the call to parent->RemoveChild(this) in nsBaseWidget::Destroy(),
'parent' has already been deleted).
The two Breakpad reports linked here both pick up [bug 470487](/show_bug.cgi?id=470487 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?") as
related. This seems to be true (even though these two bugs aren't
dups, and don't have the same trigger).
I'll be working on this.Assignee: nobody → smichaud

|  | [Smokey Ardisson (offline for a while; not following bugs - do not email)](/user_profile?user_id=155027) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=503196#c5)• 16 years ago |
|  | |

Not Widget:Mac if it's Firefox 3.5 ;)
(In reply to [comment #4](/show_bug.cgi?id=503196#c4 "VERIFIED FIXED - [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing"))
> The two Breakpad reports linked here both pick up [bug 470487](/show_bug.cgi?id=470487 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?") as
> related. This seems to be true (even though these two bugs aren't
> dups, and don't have the same trigger).
The logic there is that "related" bugs mention the report's signature somewhere in them; it's not very sophisticated, but it may find you bugs that actually \*are\* related.Component: Widget: Mac → Widget: CocoaQA Contact: mac → cocoa

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a423780_190622)• 16 years ago |

Flags: wanted1.9.1.x? → wanted1.9.1.x+

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a495170_137548)• 16 years ago |

blocking1.9.1: --- → needed
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.1.1? → blocking1.9.1.1-

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=503196#c6)• 16 years ago |
|  | |

Attached patch

[Debugging patch (partially disable patch for bug 487393), \*not\* a fix](attachment.cgi?id=388799&action=diff) (obsolete)
— [Details](attachment.cgi?id=388799&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=388799)

Here are the regression ranges for this bug (on the trunk and the
1.9.1 branch):
firefox-2009-04-23-04-mozilla-central
firefox-2009-04-24-03-mozilla-central
firefox-2009-05-15-03-mozilla-1.9.1
firefox-2009-05-16-03-mozilla-1.9.1
This implicates my patch for [bug 487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]").
But there's nothing wrong with my patch. Instead it seems to uncover
an existing bug. This can be seen by the fact that my "debugging
patch", which reverses part of the patch for [bug 487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]"), makes this
bug's crash stop happening.
I probably won't be able to work on this bug for at least the next
three weeks -- Josh wants me to work on other stuff, and I have a
week's vacation coming up.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=503196#c7)• 16 years ago |
|  | |

Attached patch

[Debugging patch rev1 (minimize further), still \*not\* a fix](attachment.cgi?id=388803&action=diff) (obsolete)
— [Details](attachment.cgi?id=388803&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=388803)

[Attachment #388799](/attachment.cgi?id=388799&action=edit "Debugging patch (partially disable patch for bug 487393), *not* a fix") -
Attachment is obsolete: true

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=503196#c8)• 16 years ago |
|  | |

Attached patch

[Fix](attachment.cgi?id=389127&action=diff)
— [Details](attachment.cgi?id=389127&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389127)

Turns out this bug \*was\* caused by my patch for [bug 487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]").
With that patch, it now became possible for the list of a parent's
children to be changed while it was being iterated. This meant that
if the parent had two children, only the first in the list would be
found. Which in turn meant that the second child's reference to its
parent (mParentWidget) didn't get removed when the parent was deleted.
Which caused a crash when Destroy() was called on the second child,
and it tried to deference the second child's mParentWidget pointer.
This patch fixes the problem.
A tryserver build will follow in a few hours.
[Attachment #388803](/attachment.cgi?id=388803&action=edit "Debugging patch rev1 (minimize further), still *not* a fix") -
Attachment is obsolete: true
[Attachment #389127](/attachment.cgi?id=389127&action=edit "Fix") -
Flags: review?(joshmoz)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=503196#c9)• 16 years ago |
|  | |

Here's a tryserver build made with my patch from [comment #8](/show_bug.cgi?id=503196#c8 "VERIFIED FIXED - [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing"):
[https://build.mozilla.org/tryserver-builds/smichaud@pobox.com-bugzilla503196/bugzilla503196-macosx.dmg](https://build.mozilla.org/tryserver-builds/smichaud%40pobox.com-bugzilla503196/bugzilla503196-macosx.dmg)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=503196#c10)• 16 years ago |
|  | |

This became a potential security vulnerability at [comment 4](/show_bug.cgi?id=503196#c4 "VERIFIED FIXED - [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing") -- please don't hesitate to hide these bugs if you can or mail security@mozilla.org if you can't. We don't need more instances of the 3.5.1 firedrill where some joker uses our own testcases against us.Blocks: [487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]")Flags: wanted1.9.0.x-Whiteboard: [sg:moderate] critical if web site can cause crash w/out printing

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a936715_1689)• 16 years ago |

Group: core-security

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=503196#c11)• 16 years ago |
|  | |

Comment on [attachment 389127](/attachment.cgi?id=389127 "Fix") [[details]](/attachment.cgi?id=389127&action=edit "Fix") [[diff]](/attachment.cgi?id=389127&action=diff "Fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389127)
Fix
// notify the children that we're gone
Please modify this comment to explain why you're iterating iterating this way. Modify the other similar comment in the patch too.
[Attachment #389127](/attachment.cgi?id=389127&action=edit "Fix") -
Flags: review?(joshmoz) → review+

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=503196#c12)• 16 years ago |
|  | |

Landed on trunk (mozilla-central) with Josh's change:
<http://hg.mozilla.org/mozilla-central/rev/c88543bb3635>Status: NEW → RESOLVEDClosed: 16 years agoResolution: --- → FIXED

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=503196#c13)• 16 years ago |
|  | |

Attached patch

[Fix for 1.9.1 branch](attachment.cgi?id=389487&action=diff)
— [Details](attachment.cgi?id=389487&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a1009249_67806)• 16 years ago |

[Attachment #389487](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") -
Flags: approval1.9.1.2?

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=503196#c14)• 16 years ago |
|  | |

This is the #7 topcrasher on OS X (on the 1.9.1 branch and the trunk)
-- 486 instances in the last week.Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a1187657_7044)• 16 years ago |

Flags: wanted1.9.2?Flags: blocking1.9.2?Flags: blocking1.9.2+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=503196#c15)• 16 years ago |
|  | |

Comment on [attachment 389487](/attachment.cgi?id=389487 "Fix for 1.9.1 branch") [[details]](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") [[diff]](/attachment.cgi?id=389487&action=diff "Fix for 1.9.1 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487)
Fix for 1.9.1 branch
Steven: Given that we have no tests here, is there anything you can do to put our minds at ease for taking this patch? Are there other code paths that touch this code? How can we ensure this doesn't cause other crashes?
Let's revisit this after baking a bit.

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=503196#c16)• 16 years ago |
|  | |

Frankly, I think this patch is trivial: In my patch for [bug 487393](/show_bug.cgi?id=487393 "VERIFIED FIXED - Changing system appearance to blue/graphite crashes browser [@ systemMetricsChanged][@ Foundation@0x9f1b]"), I
forgot to ensure that I iterated the parents' children safely (so as
to allow the list to change while being iterated). This was (blush) a
dumb mistake, which my current patch fixes. I'm surprised Josh even
asked me to make a comment.

|  | [Josh Aas](/user_profile?user_id=18821) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=503196#c17)• 16 years ago |
|  | |

This is not a high risk patch and in my opinion we should definitely take this by 1.9.1.3. As for 1.9.1.2 or 1.9.1.3 I don't have a strong opinion.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=503196#c18)• 16 years ago |
|  | |

Comment on [attachment 389487](/attachment.cgi?id=389487 "Fix for 1.9.1 branch") [[details]](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") [[diff]](/attachment.cgi?id=389487&action=diff "Fix for 1.9.1 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487)
Fix for 1.9.1 branch
Let's take it in 1.9.1.3.
[Attachment #389487](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") -
Flags: approval1.9.1.2? → approval1.9.1.3?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a1279960_190622)• 16 years ago |

Flags: wanted1.9.1.x+

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=503196#c19)• 15 years ago |
|  | |

Mass change: adding fixed1.9.2 keyword
(This bug was identified as a mozilla1.9.2 blocker which was fixed before the mozilla-1.9.2 repository was branched (August 13th, 2009) as per this query: <http://is.gd/2ydcb> - if this bug is not actually fixed on mozilla1.9.2, please remove the keyword. Apologies for the bugspam)Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=503196#c20)• 15 years ago |
|  | |

This is definitely fixed in today's Namoroka nightly.

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=503196#c21)• 15 years ago |
|  | |

Any chance to get this into 1.9.1.4? I was just informed that this seems to be one of the topcrashers on SeaMonkey.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=503196#c22)• 15 years ago |
|  | |

Won't this get into the 1.9.1.3 release then? I think we've been waiting long enough now.
See [comment 17](/show_bug.cgi?id=503196#c17 "VERIFIED FIXED - [Mac] Crash in [@ nsBaseWidget::Destroy() ] while printing"), where it says we should be take it by 1.9.1.3.

|  | [Robert Kaiser](/user_profile?user_id=5189) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=503196#c23)• 15 years ago |
|  | |

1.9.1.3 has already been cut, from what I see.

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=503196#c24)• 15 years ago |
|  | |

Ugh :(
How is that possible? I guess the blocking1.9.1 needed flag is not blocking anything at all? Doesn't it make that flag useless?

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=503196#c25)• 15 years ago |
|  | |

Comment on [attachment 389487](/attachment.cgi?id=389487 "Fix for 1.9.1 branch") [[details]](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") [[diff]](/attachment.cgi?id=389487&action=diff "Fix for 1.9.1 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487)
Fix for 1.9.1 branch
Yes, too late for 1.9.1.3. Let's ask for approval to get it into 1.9.1.4.
[Attachment #389487](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") -
Flags: approval1.9.1.3? → approval1.9.1.4?

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=503196#c26)• 15 years ago |
|  | |

This is also a topcrasher in FF:
<http://crash-stats.mozilla.com/report/list?platform=mac&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsBaseWidget%3A%3ADestroy%28%29>
(3145 crashes in the last week, #4 on OS X)
<http://crash-stats.mozilla.com/report/list?platform=mac&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsChildView%3A%3ADestroy%28%29>
(698 crashes in the last week, #27 on OS X)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=503196#c27)• 15 years ago |
|  | |

No crash reports on 1.9.2 for three weeks now. Looks like we can safely mark this bug as verified.
Also printing the testcase doesn't crash my Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.2a2pre) Gecko/20090825 Namoroka/3.6a2pre ID:20090825033555Status: RESOLVED → VERIFIEDFlags: in-testsuite?Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---) → [verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)Target Milestone: --- → mozilla1.9.2a1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a4664118_1689)• 15 years ago |

blocking1.9.1: needed → .4+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=503196#c28)• 15 years ago |
|  | |

Comment on [attachment 389487](/attachment.cgi?id=389487 "Fix for 1.9.1 branch") [[details]](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") [[diff]](/attachment.cgi?id=389487&action=diff "Fix for 1.9.1 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=503196&attachment=389487)
Fix for 1.9.1 branch
Approved for 1.9.1.4, a=dveditz for release-drivers
[Attachment #389487](/attachment.cgi?id=389487&action=edit "Fix for 1.9.1 branch") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Steven Michaud [:smichaud] (Retired)](/user_profile?user_id=67806)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=503196#c29)• 15 years ago |
|  | |

Landed on the 1.9.1 branch:
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/02b97cf4609f>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a4820143_190622)• 15 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=503196#c30)• 15 years ago |
|  | |

Verified that Martijn's testcase still crashes 1.9.1.3 and does not crash 1.9.1.4 (Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090914 Shiretoko/3.5.4pre).Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a9063358_269330)• 15 years ago |

Whiteboard: [sg:moderate] critical if web site can cause crash w/out printing → [sg:moderate] critical if web site can cause crash w/out printing[crashkill]

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a10101219_269330)• 15 years ago |

Whiteboard: [sg:moderate] critical if web site can cause crash w/out printing[crashkill] → [sg:moderate] critical if web site can cause crash w/out printing[crashkill][crashkill-fix]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a10727849_1689)• 15 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=503196#a60890785_1)• 14 years ago |

Crash Signature: [@ nsBaseWidget::Destroy() ]
You need to [log in](/show_bug.cgi?id=503196&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martijn Wargers (dead)](/user_profile?user_id=55600)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_47a617c8_20250126_085756.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/5149)
* [XML](/show_bug.cgi?ctype=xml&id=5149)

Closed
[Bug 5149](/show_bug.cgi?id=5149)

Opened 26 years ago
Closed 26 years ago

# Apprunner from the M4 won't start

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Apprunner from the M4 won't start

## Categories

### (Core Graveyard :: Tracking, defect, P3)

[Product:](/describecomponents.cgi?product=Core%20Graveyard)

Core Graveyard
▾

Core Graveyard
Old, retired Core components
[See Open Bugs in This Product](/buglist.cgi?product=Core%20Graveyard&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core%20Graveyard)
Watch This Product

[Component:](/describecomponents.cgi?product=Core%20Graveyard&component=Tracking#Tracking)

Tracking
▾

Core Graveyard :: Tracking
This component is used primarily for "tracking" bugs; bugs used to track a group of bugs.
[See Open Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Tracking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core%20Graveyard&component=Tracking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core%20Graveyard&component=Tracking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows 95

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

## Tracking

### (Not tracked)

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
INVALID

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

INVALID

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

## People

### (Reporter: dill, Assigned: dp)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/b4d4ca643b7b73a4eab8a9d0a86db4ea?d=mm&size=40)  [dp](/user_profile?user_id=1186)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/715f1344e52ba783e2f3d133a958bef4?d=mm&size=40)  [leger](/user_profile?user_id=3853)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/a2cbd0554eee81e783f5d49b40f28b3f?d=mm&size=40)  [dill](/user_profile?user_id=4924)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

*Nobody*

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [dill](/user_profile?user_id=4924)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=5149#c0)• 26 years ago |
|  | |

When apprunner.exe is opened a dos window appears. Then another window where the
browser is going to go appears but doesn't load anything in the window. The
computer just grinds away. After about 5 minutes parts of the tool bar will
appear. It's terribly slow. Viewer.exe will however load fairly quick.

|  | [rickg](/user_profile?user_id=3828) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a67872_3828)• 26 years ago |

Status: NEW → RESOLVEDClosed: 26 years agoResolution: --- → FIXED

|  | [rickg](/user_profile?user_id=3828) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=5149#c1)• 26 years ago |
|  | |

I believe that this has been fixed for the released m4.

|  | [dill](/user_profile?user_id=4924)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=5149#c2)• 26 years ago |
|  | |

I got the file from:
ftp://ftp.mozilla.org/pub/mozilla/releases/m4/

|  | [dill](/user_profile?user_id=4924)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a68980_4924)• 26 years ago |

Status: RESOLVED → REOPENED

|  | [rickg](/user_profile?user_id=3828) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a882557_3828)• 26 years ago |

Assignee: rickg → trudelleStatus: REOPENED → NEW

|  | [rickg](/user_profile?user_id=3828) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=5149#c3)• 26 years ago |
|  | |

Peter: This came to me, but you should track it.

|  | [Peter Trudelle](/user_profile?user_id=4150) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a887995_4150)• 26 years ago |

Assignee: trudelle → dp

|  | [Peter Trudelle](/user_profile?user_id=4150) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=5149#c4)• 26 years ago |
|  | |

I think most of this startup time is spent in the registry code. reassigning to
dp

|  | [leger](/user_profile?user_id=3853) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a921020_3853)• 26 years ago |

Status: NEW → RESOLVEDClosed: 26 years ago → 26 years agoComponent: Viewer App → ApprunnerResolution: FIXED → INVALID

|  | [leger](/user_profile?user_id=3853) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a921027_3853)• 26 years ago |

Status: RESOLVED → VERIFIED

|  | [leger](/user_profile?user_id=3853) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=5149#c5)• 26 years ago |
|  | |

This is an old bug. The final M4 release for Win32 start just fine.

|  | [leger](/user_profile?user_id=3853) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=5149#c6)• 26 years ago |
|  | |

Moving all Apprunner bugs past and present to Other component temporarily whilst
don and I set correct component. Apprunner component will be deleted/retired
shortly.

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=5149#a544388579_1)• 9 years ago |

Product: Core → Core Graveyard
You need to [log in](/show_bug.cgi?id=5149&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑



=== Content from bugzilla.mozilla.org_cf3ba5a2_20250125_133003.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/513394)
* [XML](/show_bug.cgi?ctype=xml&id=513394)

Closed
[Bug 513394](/show_bug.cgi?id=513394)

Opened 15 years ago
Closed 15 years ago

# "ASSERTION: Some PresArena objects were not freed" with -moz-column, list-item, float, :after

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: Some PresArena objects were not freed" with -moz-column, list-item, float, :after

## Categories

### (Core :: Layout, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

macOS

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.3a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: tnikkel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [476357](/show_bug.cgi?id=476357 "RESOLVED FIXED - The zooming function on the page makes the text overlap")

[framedest](/show_bug.cgi?id=334514 "RESOLVED FIXED - FrameArena::~FrameArena should assert that it's empty")

Dependency [tree](/showdependencytree.cgi?id=513394&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=513394)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (6 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[memory-leak](/buglist.cgi?keywords=memory-leak&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.2](#a1120850_5038 "15 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.2 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.9.0.x](#a629781_190622 "15 years ago") | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.9.0.x | - |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#c21 "15 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 1 obsolete file)

| [testcase (triggers the assertion but not the crash)](/attachment.cgi?id=397408)  [15 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   576 bytes, text/html |  | [Details](/attachment.cgi?id=397408&action=edit) |
| --- | --- | --- |
| [patch](/attachment.cgi?id=398095)  [15 years ago](#c2)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   1.43 KB, patch | dbaron : [review+](#a388946_3881 "15 years ago")  roc : [approval1.9.2+](#a929882_5038 "15 years ago")  dveditz : [approval1.9.1.4+](#c17 "15 years ago") | [Details](/attachment.cgi?id=398095&action=edit) | [Diff](/attachment.cgi?id=398095&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398095) |
| [followup](/attachment.cgi?id=398221)  [15 years ago](#c7)  [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)   3.78 KB, patch | dbaron : [review-](#c12 "15 years ago") | [Details](/attachment.cgi?id=398221&action=edit) | [Diff](/attachment.cgi?id=398221&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398221) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=513394#c0)• 15 years ago |
|  | |

Attached file
[testcase (triggers the assertion but not the crash)](attachment.cgi?id=397408)
— [Details](attachment.cgi?id=397408&action=edit)

###!!! ASSERTION: Some PresArena objects were not freed: 'mAllocCount == 0', file /Users/jruderman/central/layout/base/nsPresArena.cpp, line 169
Appears to be exploitable.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a28_11608)• 15 years ago |

Whiteboard: [sg:critical?]

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=513394#c1)• 15 years ago |
|  | |

The <div style="height: 20px; display: inline-block;"> doesn't get deleted because at the time of destruction the mLines of its block parent has it as the second child, but the mNextSibling link of the first child is null. At some point we do an invalid mutation of the frame tree.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=513394#c2)• 15 years ago |
|  | |

Attached patch

[patch](attachment.cgi?id=398095&action=diff)
— [Details](attachment.cgi?id=398095&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398095)

When we pull lines after calling ReflowLine in ReflowDirtyLines we use mPrevChild of the nsBlockReflowState in order to properly set the next sibling of our last child to the start of the pulled line. That is, as long as it is not null. [Bug 476357](/show_bug.cgi?id=476357 "RESOLVED FIXED - The zooming function on the page makes the text overlap") added an early return to ReflowBlockFrame just before we set mPrevChild.Assignee: nobody → tnikkel
[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: review?(dbaron)

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a373181_255010)• 15 years ago |

Blocks: [476357](/show_bug.cgi?id=476357 "RESOLVED FIXED - The zooming function on the page makes the text overlap")

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a388946_3881)• 15 years ago |

[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: review?(dbaron) → review+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=513394#c3)• 15 years ago |
|  | |

Comment on [attachment 398095](/attachment.cgi?id=398095 "patch") [[details]](/attachment.cgi?id=398095&action=edit "patch") [[diff]](/attachment.cgi?id=398095&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398095)
patch
r=dbaron

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=513394#c4)• 15 years ago |
|  | |

Pushed that patch as <http://hg.mozilla.org/mozilla-central/rev/075a261bb1a5>Status: NEW → RESOLVEDClosed: 15 years agoFlags: in-testsuite?Resolution: --- → FIXED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=513394#c5)• 15 years ago |
|  | |

Comment on [attachment 398095](/attachment.cgi?id=398095 "patch") [[details]](/attachment.cgi?id=398095&action=edit "patch") [[diff]](/attachment.cgi?id=398095&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398095)
patch
Need this on 1.9.1 and 1.9.2.
[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: approval1.9.2?
[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: approval1.9.1.4?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=513394#c6)• 15 years ago |
|  | |

Jesse, it sounded like you have a crashing testcase for this? Would be good to include in the crashtests once we have this fixed on the branches.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=513394#c7)• 15 years ago |
|  | |

Attached patch

[followup](attachment.cgi?id=398221&action=diff) (obsolete)
— [Details](attachment.cgi?id=398221&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398221)

Add an assertion to catch the problem of this bug.
nsBlockFrame::PullFrameFrom calls SetNextSibling twice, doing what should be the same thing twice.
Fix the comment above nsBlockFrame::PullFrameFrom.
[Attachment #398221](/attachment.cgi?id=398221&action=edit "followup") -
Flags: review?(dbaron)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=513394#c8)• 15 years ago |
|  | |

Probably need a roll-up branch patch that includes the followup once it's reviewed.blocking1.9.1: --- → .4+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.2?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=513394#c9)• 15 years ago |
|  | |

The followup is mostly just cleanup, I was thinking it would be trunk-only.blocking1.9.1: .4+ → ---

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=513394#c10)• 15 years ago |
|  | |

Not sure you wanted to nuke the blocking+ flag...blocking1.9.1: --- → ?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=513394#c11)• 15 years ago |
|  | |

Whoops, no I didn't. For some reason it was showing as --- for me.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a446829_190622)• 15 years ago |

blocking1.9.1: ? → .4+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=513394#c12)• 15 years ago |
|  | |

Comment on [attachment 398221](/attachment.cgi?id=398221 "followup") [[details]](/attachment.cgi?id=398221&action=edit "followup") [[diff]](/attachment.cgi?id=398221&action=diff "followup") [[review]](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398221)
followup
Between here:
>- aLine->LastChild()->SetNextSibling(frame);
>+ NS\_ASSERTION(aState.mPrevChild == aLine->LastChild(),
>+ "mPrevChild should be the LastChild of the line we are adding to");
>+ // The frame is being pulled from a next-in-flow; therefore we
>+ // need to add it to our sibling list.
>+ frame->SetNextSibling(nsnull);
>+ if (nsnull != aState.mPrevChild) {
>+ aState.mPrevChild->SetNextSibling(frame);
>+ }
And here:
>- // The frame is being pulled from a next-in-flow; therefore we
>- // need to add it to our sibling list.
>- frame->SetNextSibling(nsnull);
>- if (nsnull != aState.mPrevChild) {
>- aState.mPrevChild->SetNextSibling(frame);
>- }
>-
There's the following code:
if (0 != --fromLineChildCount) {
// Mark line dirty now that we pulled a child
fromLine->SetChildCount(fromLineChildCount);
fromLine->MarkDirty();
fromLine->mFirstChild = frame->GetNextSibling();
}
which you're going to break since it will now set fromLine->mFirstChild to null instead of to the correct frame.
(I'm also not sure I'm the best reviewer for this; I think roc and fantasai know this code better than I do.)
[Attachment #398221](/attachment.cgi?id=398221&action=edit "followup") -
Flags: review?(dbaron) → review-

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=513394#c13)• 15 years ago |
|  | |

Does the followup need to happen in a security-sensitive bug?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=513394#c14)• 15 years ago |
|  | |

I guess we can move the followup to a new bug. I don't think anyone can glean anything more from the followup+discussion then from the patch that is already committed. Any objections?

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=513394#c15)• 15 years ago |
|  | |

Filed [bug 514634](/show_bug.cgi?id=514634 "RESOLVED FIXED - some misc block frame code cleanup") for the followup.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a547170_255010)• 15 years ago |

[Attachment #398221](/attachment.cgi?id=398221&action=edit "followup") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=513394#c16)• 15 years ago |
|  | |

Does this bug affect 1.9.0? I'd hate to fix it in 3.5.4 and not in the accompanying 3.0.x if so.Flags: wanted1.9.0.x?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=513394#c17)• 15 years ago |
|  | |

Comment on [attachment 398095](/attachment.cgi?id=398095 "patch") [[details]](/attachment.cgi?id=398095&action=edit "patch") [[diff]](/attachment.cgi?id=398095&action=diff "patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=513394&attachment=398095)
patch
Approved for 1.9.1.4, a=dveditz for release-drivers
[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=513394#c18)• 15 years ago |
|  | |

(In reply to [comment #16](/show_bug.cgi?id=513394#c16 "RESOLVED FIXED - \"ASSERTION: Some PresArena objects were not freed\" with -moz-column, list-item, float, :after"))
> Does this bug affect 1.9.0? I'd hate to fix it in 3.5.4 and not in the
> accompanying 3.0.x if so.
No; it's a regression from [bug 476357](/show_bug.cgi?id=476357 "RESOLVED FIXED - The zooming function on the page makes the text overlap").

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a615962_255010)• 15 years ago |

Flags: wanted1.9.0.x?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a629781_190622)• 15 years ago |

Flags: wanted1.9.0.x-

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a929882_5038)• 15 years ago |

[Attachment #398095](/attachment.cgi?id=398095&action=edit "patch") -
Flags: approval1.9.2? → approval1.9.2+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=513394#c19)• 15 years ago |
|  | |

Pushed:
<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/5c27d5405847>
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/df891eff2eff>

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a930589_20209)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a1120850_5038)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=513394#c20)• 15 years ago |
|  | |

No assertion visible when loading the given testcase with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1.5pre) Gecko/20091008 Shiretoko/3.5.5pre ID:20091008213747. Marking as verified fixed on 1.9.1.Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)Target Milestone: --- → mozilla1.9.3a1

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a3754816_76551)• 15 years ago |

Depends on: [521639](/show_bug.cgi?id=521639 "RESOLVED INVALID - Since landing of bug 489925 new tab button and tabs close buttons are wrongly positioned with Tabmixplus installed")

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a3828945_255010)• 15 years ago |

No longer depends on: [521639](/show_bug.cgi?id=521639 "RESOLVED INVALID - Since landing of bug 489925 new tab button and tabs close buttons are wrongly positioned with Tabmixplus installed")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=513394#a6312416_1689)• 15 years ago |

Group: core-securityKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=513394#c21)• 15 years ago |
|  | |

Crashtest checked in: <http://hg.mozilla.org/mozilla-central/rev/a86c5f1d3fef>Flags: in-testsuite? → in-testsuite+
You need to [log in](/show_bug.cgi?id=513394&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_e0b2d43f_20250125_132956.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2009-64

## Crashes with evidence of memory corruption (rv:1.9.1.4/ 1.9.0.15)

Announced
October 27, 2009
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox
Fixed in

* Firefox 3.0.15
* Firefox 3.5.4

### Description

Mozilla developers and community members identified and fixed
several stability bugs in the browser engine used in Firefox and other
Mozilla-based products. Some of these crashes showed evidence of
memory corruption under certain circumstances and we presume that with
enough effort at least some of these could be exploited to run
arbitrary code.

### Workaround

Disable JavaScript until a version containing these fixes can be
installed.

Vladimir Vukicevic, Jesse Ruderman, Martijn Wargers, Daniel
Banchero, David Keeler, and Boris Zbarsky reported crashes in the
browser engine which affected both Firefox 3 and Firefox 3.5.

* [Browser engine crashes - Firefox 3, Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=514776,497013,508927,509602,509244,489925,522030,454872)
* [CVE-2009-3380](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3380)

Thomas Frederiksen, Marcia Knous, Jesse Ruderman, Carsten Book, and
Kevin Brosnan reported crashes in the browser engine which affected
only Firefox 3.5.

* [Browser engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=502168,513394,503196,516709,508057)
* [CVE-2009-3381](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3381)

Carsten Book reported a crash in the browser engine which affected
only Firefox 3.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=514960>
* [CVE-2009-3382](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3382)

David Anderson and Jeff Walden reported crashes in the JavaScript
engine which affected only Firefox 3.5.

* [JavaScript engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=510987,518675)
* [CVE-2009-3383](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3383)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_23315cb9_20250125_132958.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/502168)
* [XML](/show_bug.cgi?ctype=xml&id=502168)

Closed
[Bug 502168](/show_bug.cgi?id=502168)

Opened 16 years ago
Closed 15 years ago

# Duplicated content with <embed> inside table markup

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Duplicated content with <embed> inside table markup

## Categories

### (Core :: Layout, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: thomas, Assigned: smaug)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/15c8d58a732b934c5090b250095baf39?d=mm&size=40)  [thomas](/user_profile?user_id=350545)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

13 people

## References

### ( [URL](https://fronter.com/DK-test/index.phtml?username=egh110787MELN&password=egh110787MELN&newlang=de&saveid=-1&mainurl=main.phtml&chp=&USER_SCREEN_SIZE= "https://fronter.com/DK-test/index.phtml?username=egh110787MELN&password=egh110787MELN&newlang=de&saveid=-1&mainurl=main.phtml&chp=&USER_SCREEN_SIZE=") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[525276](/show_bug.cgi?id=525276 "VERIFIED FIXED - crashes [@ nsDocument::RegisterNamedItems(nsIContent*)]")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered")

Dependency [tree](/showdependencytree.cgi?id=502168&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=502168)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[fronter.com/DK-test/index.phtml?usern...](https://fronter.com/DK-test/index.phtml?username=egh110787MELN&password=egh110787MELN&newlang=de&saveid=-1&mainurl=main.phtml&chp=&USER_SCREEN_SIZE= "https://fronter.com/DK-test/index.phtml?username=egh110787MELN&password=egh110787MELN&newlang=de&saveid=-1&mainurl=main.phtml&chp=&USER_SCREEN_SIZE=")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: regression, testcase, verified1.9.1, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [beltzner](/user_profile?user_id=137548) | [blocking1.9.1.1](#a979449_137548 "16 years ago") | - |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.1.1 | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a6961471_1689 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | - |
| --- | --- | --- |
| [smaug](/user_profile?user_id=39966) | [in-testsuite](#a4666809_39966 "15 years ago") | + |
| --- | --- | --- |
| [smaug](/user_profile?user_id=39966) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase](/attachment.cgi?id=386714)  [16 years ago](#c4)  [Martijn Wargers (dead)](/user_profile?user_id=55600)   270 bytes, text/html |  | [Details](/attachment.cgi?id=386714&action=edit) |
| --- | --- | --- |
| [fixes the testcase](/attachment.cgi?id=386896)  [16 years ago](#c10)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   764 bytes, patch |  | [Details](/attachment.cgi?id=386896&action=edit) | [Diff](/attachment.cgi?id=386896&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386896) |
| [better](/attachment.cgi?id=386974)  [16 years ago](#c13)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   2.67 KB, patch |  | [Details](/attachment.cgi?id=386974&action=edit) | [Diff](/attachment.cgi?id=386974&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386974) |
| [+better test](/attachment.cgi?id=386995)  [16 years ago](#c16)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   2.71 KB, patch | bzbarsky : [review+](#c25 "16 years ago") | [Details](/attachment.cgi?id=386995&action=edit) | [Diff](/attachment.cgi?id=386995&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386995) |
| [+comments](/attachment.cgi?id=394359)  [15 years ago](#c26)  [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)   2.96 KB, patch | dbaron : [approval1.9.2+](#c28 "15 years ago")  dveditz : [approval1.9.1.4+](#c30 "15 years ago") | [Details](/attachment.cgi?id=394359&action=edit) | [Diff](/attachment.cgi?id=394359&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=394359) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Thomas Frederiksen](/user_profile?user_id=350545)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=502168#c0)• 16 years ago |
|  | |

User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; da; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)
Build Identifier: Mozilla/5.0 (Windows; U; Windows NT 5.1; da; rv:1.9.1) Gecko/20090624 Firefox/3.5 (.NET CLR 3.5.30729)
When you log on to any Fronter installation (used by 4 mio. users in EU) the images in the top navigation appears multiple times after upgrading to Firefox 3.5
This bug was not present in 3.11 or 3.10
Reproducible: Always
Steps to Reproduce:
1. log in to Fronter using the link below:
USERNAME: egh110787MELN
PASSWORD: egh110787MELN
2. Take a look at the images in the top navigation bar
FAST LOGON:
<https://fronter.com/DK-test/index.phtml?username=egh110787MELN&password=egh110787MELN&newlang=de&saveid=-1&mainurl=main.phtml&chp=&USER_SCREEN_SIZE>=
Actual Results:
Images are displayed multiple times, hiding links behind. Making nativation impossible.
Expected Results:
The images should be shown only once.
Take a look at the screenshot here:
<http://frontersupport.dk/ERRORS/firefox_bug.jpg>

|  | [Kevin Brosnan](/user_profile?user_id=106918) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=502168#c1)• 16 years ago |
|  | |

Works for me - Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1.1pre) Gecko/20090702 Shiretoko/3.5.1pre
Please check if Firefox's safe mode or a new profile change this behavior. Information about the steps can be found at [http://support.mozilla.com/en-US/kb/Basic+troubleshooting](http://support.mozilla.com/en-US/kb/Basic%2Btroubleshooting)

|  | [Thomas Frederiksen](/user_profile?user_id=350545)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=502168#c2)• 16 years ago |
|  | |

Tried both
1. Started in safe mode
2. Tried creating a new profile
Same result
Also tried disabling all add ons.
Got confirmed now that a lot more users experience the same problem.

|  | [Ria Klaassen (not reading all bugmail)](/user_profile?user_id=154309) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=502168#c3)• 16 years ago |
|  | |

Yeah, I can reproduce it on Windows Vista. On trunk it behaves somewhat different (it also disappears after doubling itself).
Regression range: <http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=d19424342b43&tochange=dbf96b1b73bd>
So it is probably caused by [Bug 491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered").Blocks: [491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered")Status: UNCONFIRMED → NEWComponent: General → DOMEver confirmed: trueKeywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Product: Firefox → CoreQA Contact: general → generalVersion: unspecified → Trunk

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=502168#c4)• 16 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=386714)
— [Details](attachment.cgi?id=386714&action=edit)

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a17490_55600)• 16 years ago |

Group: core-securityComponent: DOM → LayoutFlags: blocking1.9.1?QA Contact: general → layout

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a17504_55600)• 16 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=502168#c5)• 16 years ago |
|  | |

> So it is probably caused by [Bug 491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered").
Given that Martijn's testcase includes no images, seems a little weird...
When I try that testcase using m-c builds, I see the doubled text start between rev 409416c625bc and rev 0f4de606acd7. Pushlog: <http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=409416c625bc&tochange=0f4de606acd7>
The text is still doubled on trunk in that testcase, unless I use the HTML5 parser.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=502168#c6)• 16 years ago |
|  | |

It looks like the content sink ends up double-notifying on content here. That's really bad; we need to fix ASAP.
My money, given that and the regression range, is on [bug 481566](/show_bug.cgi?id=481566 "RESOLVED FIXED - Content sink needs to be more responsive").Blocks: [481566](/show_bug.cgi?id=481566 "RESOLVED FIXED - Content sink needs to be more responsive")
No longer blocks: [491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered")Flags: blocking1.9.1.1?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=502168#c7)• 16 years ago |
|  | |

Hmm. So I can't reproduce the issue at all on the "FAST LOGON" url from [comment 0](/show_bug.cgi?id=502168#c0 "RESOLVED FIXED - Duplicated content with <embed> inside table markup"). On Martijn's testcase, my debug build of rev 11a3e4008446 is not showing the problem...
But [bug 491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered") is in fact in my range, so maybe it really is causing the problem somehow. Olli, can you look into this?Assignee: nobody → Olli.PettayBlocks: [491063](/show_bug.cgi?id=491063 "RESOLVED FIXED - Mixed mode warning dialog (and other dialog windows) is sometimes not rendered")
No longer blocks: [481566](/show_bug.cgi?id=481566 "RESOLVED FIXED - Content sink needs to be more responsive")

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=502168#c8)• 16 years ago |
|  | |

The problem here is <http://mxr-test.konigsberg.mozilla.org/bonsai/cvsblame.cgi?file=content/base/src/nsObjectLoadingContent.cpp&xrev=3084b64cf578&mark=1518#1488>
Haven't yet figured out how to prevent calling that.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=502168#c9)• 16 years ago |
|  | |

Hmm. Does that not trigger the sync updating its flushed counts? I would have thought it would have. Or is the problem that it's happening while the sink is in the middle of notifying?
God, I look forward to just switching to Henri's parser....

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=502168#c10)• 16 years ago |
|  | |

Attached patch

[fixes the testcase](attachment.cgi?id=386896&action=diff)
— [Details](attachment.cgi?id=386896&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386896)

I'll post this to tryserver too.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=502168#c11)• 16 years ago |
|  | |

And I need to check other similar cases.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=502168#c12)• 16 years ago |
|  | |

Or I need to tweak content sink's flush a bit...

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=502168#c13)• 16 years ago |
|  | |

Attached patch

[better](attachment.cgi?id=386974&action=diff) (obsolete)
— [Details](attachment.cgi?id=386974&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386974)

This changes flushing so that it processes also leafs properly (in which case
DidAddContent doesn't do anything if flushing happened just before calling it).
Posted to tryserver.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=502168#c14)• 16 years ago |
|  | |

Anyone who can reproduce the original bug, could you please test tryserver build
[https://build.mozilla.org/tryserver-builds/opettay@mozilla.com-content\_sink\_flush/](https://build.mozilla.org/tryserver-builds/opettay%40mozilla.com-content_sink_flush/)

|  | [Ria Klaassen (not reading all bugmail)](/user_profile?user_id=154309) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=502168#c15)• 16 years ago |
|  | |

Tryserver build works fine (Win Vista).

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=502168#c16)• 16 years ago |
|  | |

Attached patch

[+better test](attachment.cgi?id=386995&action=diff)
— [Details](attachment.cgi?id=386995&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386995)

What you think about this?
[Attachment #386974](/attachment.cgi?id=386974&action=edit "better") -
Attachment is obsolete: true
[Attachment #386995](/attachment.cgi?id=386995&action=edit "+better test") -
Flags: review?(bzbarsky)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a312131_137548)• 16 years ago |

Flags: blocking1.9.1?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=502168#c17)• 16 years ago |
|  | |

I'm not sure what this patch is actually doing (esp. with that ! business in the assert).... And mrbkap or henri might be better reviewers here.
Also, does the XML sink need anything similar?

|  | [Henri Sivonen (:hsivonen)](/user_profile?user_id=5490) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=502168#c18)• 16 years ago |
|  | |

I'm not at all competent to review this patch, because I don't understand in detail how the old sink works.
It does scare me a bit that the child is read back from the tree by index. Is it possible that a script has changed the tree by then?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=502168#c19)• 16 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=502168#c17 "RESOLVED FIXED - Duplicated content with <embed> inside table markup"))
> I'm not sure what this patch is actually doing
The patch makes sure that we notify leaf tags properly when flushing.
Usually leaf tags are notified in DidAddContent.
> (esp. with that ! business in
> the assert)....
Just keeping the existing assertion to do whatever it is doing now.
> Also, does the XML sink need anything similar?
No, because it doesn't do similar insertion point hacks.

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a520672_39966)• 16 years ago |

[Attachment #386995](/attachment.cgi?id=386995&action=edit "+better test") -
Flags: review?(mrbkap)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=502168#c20)• 16 years ago |
|  | |

> The patch makes sure that we notify leaf tags properly when flushing.
Yes, I gathered that. Why is this particular leaf not notified from DidAddContent? And why do the changes you made make sure to notify on it?
> Just keeping the existing assertion to do whatever it is doing now.
I guess !(a > b) is confusing to me. Why not a <= b? For that matter, you're just trying to guard on |stackPos + 1 <= mStackPos| before getting mStack[stackPos+1], right? Rewriting it that way would be clearer, I think...

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=502168#c21)• 16 years ago |
|  | |

(In reply to [comment #20](/show_bug.cgi?id=502168#c20 "RESOLVED FIXED - Duplicated content with <embed> inside table markup"))
> Yes, I gathered that. Why is this particular leaf not notified from
> DidAddContent? And why do the changes you made make sure to notify on it?
DidAddContent renotifies, but not the right thing, because flush (which doesn't work properly) is called before it.
(I know, not the best situation to be, but I think one could get into
similar problem also elsewhere.)
Other option could be to add script blockers high enough in content sink.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=502168#c22)• 16 years ago |
|  | |

> DidAddContent renotifies, but not the right thing, because flush (which doesn't
> work properly) is called before it.
So with your patch, is that issue fixed? If so, why?
> Other option could be to add script blockers high enough in content sink.
I'm not sure I follow....
Maybe the problem here is just a lack of a description of what goes wrong when the bug appears. If you have that info available, can you summarize?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=502168#c23)• 16 years ago |
|  | |

The problem is that flush is called between binding the element to document
and DidAddContent. And flush doesn't handle leaf tags properly.
If flush worked properly, DidAddContent doesn't do anything because the content is
already notified.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a979449_137548)• 16 years ago |

blocking1.9.1: --- → needed
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.1.1? → blocking1.9.1.1-

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=502168#c24)• 15 years ago |
|  | |

> The problem is that flush is called between binding the element to document
> and DidAddContent.
Aha! That makes things clear. Sorry for the lag here; I needed to sit down and relearn this code a bit...

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=502168#c25)• 15 years ago |
|  | |

Comment on [attachment 386995](/attachment.cgi?id=386995 "+better test") [[details]](/attachment.cgi?id=386995&action=edit "+better test") [[diff]](/attachment.cgi?id=386995&action=diff "+better test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=386995)
+better test
>+++ b/content/html/document/src/nsHTMLContentSink.cpp
>+ if (mStack[stackPos].mInsertionPoint != -1) {
> PRInt32 childIndex =
mStack[stackPos].mInsertionPoint - 1;
Here, please document that we might have popped the child off our stack already but not notified on it yet, which is why we have to get it directly from its parent node.
>+ NS\_ASSERTION(!(mStackPos > (stackPos + 1)) ||
Add "// Child not on stack anymore; can't assert it's correct" to the end of the line there?
With those comment changes, r=bzbarsky. Again, sorry for the terrible lag. :(
I don't think this needs a second review. Please request 1.9.2 approval and get this landed on m-c ASAP? (Either when approved or when the tree reopens, whichever comes first).
We need this on 1.9.1 too, right? What about 1.9.0?
[Attachment #386995](/attachment.cgi?id=386995&action=edit "+better test") -
Flags: review?(mrbkap)
[Attachment #386995](/attachment.cgi?id=386995&action=edit "+better test") -
Flags: review?(bzbarsky)
[Attachment #386995](/attachment.cgi?id=386995&action=edit "+better test") -
Flags: review+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=502168#c26)• 15 years ago |
|  | |

Attached patch

[+comments](attachment.cgi?id=394359&action=diff)
— [Details](attachment.cgi?id=394359&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=394359)

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=502168#c27)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/5d0c03667020>Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a3636057_39966)• 15 years ago |

[Attachment #394359](/attachment.cgi?id=394359&action=edit "+comments") -
Flags: approval1.9.2?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=502168#c28)• 15 years ago |
|  | |

Comment on [attachment 394359](/attachment.cgi?id=394359 "+comments") [[details]](/attachment.cgi?id=394359&action=edit "+comments") [[diff]](/attachment.cgi?id=394359&action=diff "+comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=394359)
+comments
a1.9.2=dbaron
[Attachment #394359](/attachment.cgi?id=394359&action=edit "+comments") -
Flags: approval1.9.2? → approval1.9.2+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=502168#c29)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/ab1f8fa8ea97>Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a4644161_20209)• 15 years ago |

Flags: in-testsuite?

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a4666809_39966)• 15 years ago |

Flags: in-testsuite? → in-testsuite+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a5306064_190622)• 15 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a6001185_1689)• 15 years ago |

blocking1.9.1: needed → .4+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a6922566_39966)• 15 years ago |

[Attachment #394359](/attachment.cgi?id=394359&action=edit "+comments") -
Flags: approval1.9.1.4?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a6961444_1689)• 15 years ago |

Whiteboard: [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a6961471_1689)• 15 years ago |

Flags: wanted1.9.0.x-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=502168#c30)• 15 years ago |
|  | |

Comment on [attachment 394359](/attachment.cgi?id=394359 "+comments") [[details]](/attachment.cgi?id=394359&action=edit "+comments") [[diff]](/attachment.cgi?id=394359&action=diff "+comments") [[review]](/page.cgi?id=splinter.html&ignore=&bug=502168&attachment=394359)
+comments
Approved for 1.9.1.4, a=dveditz for release-drivers
[Attachment #394359](/attachment.cgi?id=394359&action=edit "+comments") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=502168#c31)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/155a04d2d8e6>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=502168#c32)• 15 years ago |
|  | |

Verified the bug using attached testcase in 1.9.1.3 and that it is fixed in 1.9.1.4 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090929 Shiretoko/3.5.4pre.Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a10274495_20209)• 15 years ago |

Depends on: [525276](/show_bug.cgi?id=525276 "VERIFIED FIXED - crashes [@ nsDocument::RegisterNamedItems(nsIContent*)]")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a11213880_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=502168#a26603820_11608)• 15 years ago |

Summary: Particular images are displayed multiple times in a formated way - only FF 3.5 → Duplicated content with <embed> inside table markup
You need to [log in](/show_bug.cgi?id=502168&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martijn Wargers (dead)](/user_profile?user_id=55600)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


