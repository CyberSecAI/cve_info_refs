=== Content from www.vupen.com_3835e338_20250125_045016.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from www.mozilla.org_f6e1889e_20250125_045013.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2009-65

## Crashes with evidence of memory corruption (rv:1.9.1.6/ 1.9.0.16)

Announced
December 15, 2009
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox, SeaMonkey, Thunderbird
Fixed in

* Firefox 3.0.16
* Firefox 3.5.6
* SeaMonkey 2.0.1
* Thunderbird 3.0.1

### Description

Mozilla developers and community members identified and fixed
several stability bugs in the browser engine used in Firefox and other
Mozilla-based products. Some of these crashes showed evidence of
memory corruption under certain circumstances and we presume that with
enough effort at least some of these could be exploited to run
arbitrary code.

### Workaround

Disable JavaScript until a version containing these fixes can be
installed.

### References

Jesse Ruderman, Josh Soref, Martijn Wargers, Jose Angel, and Olli
Pettay reported crashes in the browser engine which affected both
Firefox 3 and Firefox 3.5.

* [Browser engine crashes - Firefox 3, Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=515811,522374,457514,506267,479931,293347,494617,516237)
* [CVE-2009-3979](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3979)

Jeremy Lea and Jesse Ruderman reported crashes in the browser
engine which only affected Firefox 3.5.

* [Browser engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=495875,470487)
* [CVE-2009-3980](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3980)

Jesse Ruderman also reported a crash in the browser engine which
only affected Firefox 3.

* [Browser engine crash - Firefox 3](https://bugzilla.mozilla.org/show_bug.cgi?id=468771)
* [CVE-2009-3981](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3981)

David Mandelin, Gary Kwong, Jason Orendorff and Igor Bukanov
reported crashes in the JavaScript engine which only affected Firefox
3.5.

* [JavaScript engine crashes - Firefox 3.5](https://bugzilla.mozilla.org/buglist.cgi?bug_id=510518,513981,514999,524121)
* [CVE-2009-3982](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3982)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_5854e5b5_20250125_045019.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/470487)
* [XML](/show_bug.cgi?ctype=xml&id=470487)

Closed
[Bug 470487](/show_bug.cgi?id=470487)

Opened 16 years ago
Closed 16 years ago

# Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?

## Categories

### (Core :: Widget: Win32, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Widget%3A%20Win32#Widget%3A%20Win32)

Widget: Win32
▾

Core :: Widget: Win32
Mapping of cross platform widget interfaces to Win32 platform APIs.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Widget%3A%20Win32&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Widget%3A%20Win32)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

1.9.1 Branch

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

Windows XP

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.2a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.6+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.6%2B) |
| status1.9.1 | --- | [.6-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.6-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .6+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .6-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: chofmann, Assigned: jimm)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/16d8dd535dd864f9058fd5152440db74?d=mm&size=40)  [chofmann](/user_profile?user_id=2687)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/605ee8cd1c9a74704916c7bdc4e4865d?d=mm&size=40)  [rkraesig](/user_profile?user_id=699639)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

35 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[523186](/show_bug.cgi?id=523186 "RESOLVED FIXED - Request for a test image access")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[506108](/show_bug.cgi?id=506108 "RESOLVED WORKSFORME - Firefox Crash in [@ nsWindow::GetParentWindow(int)] called from nsIView::CreateWidget"), [530070](/show_bug.cgi?id=530070 "RESOLVED FIXED - Firefox crashes in [@ nsWindow::GetParentWindow(int)] called from nsLayoutUtils::TranslateWidgetToView")

[503561](/show_bug.cgi?id=503561 "VERIFIED FIXED - KB Article: Crash signature - nsWindow::GetParentWindow(int)")

Dependency [tree](/showdependencytree.cgi?id=470487&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=470487)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?][crashkill][crashkill-fix])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---),
[verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?][crashkill][crashkill-fix]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [benjamin](/user_profile?user_id=7044) | [blocking1.9.2](#a18555102_7044 "16 years ago") | + |
| --- | --- | --- |
| [benjamin](/user_profile?user_id=7044) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.19](#c157 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.19 | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.9.0.x](#c15 "16 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.9.0.x | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsWindow::GetParentWindow(int) ]](https://crash-stats.mozilla.org/signature/?signature=nsWindow%3A%3AGetParentWindow%28int%29)

[[@ nsBaseWidget::Destroy() ]](https://crash-stats.mozilla.org/signature/?signature=nsBaseWidget%3A%3ADestroy%28%29)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 5 obsolete files)

| [getparent / destroy variable cleanup v.1](/attachment.cgi?id=373186)  [16 years ago](#c39)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   2.26 KB, patch | vlad : [review+](#c40 "16 years ago") | [Details](/attachment.cgi?id=373186&action=edit) | [Diff](/attachment.cgi?id=373186&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373186) |
| --- | --- | --- |
| [getparent / destroy variable cleanup v.2](/attachment.cgi?id=373201)  [16 years ago](#c42)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   7.61 KB, patch |  | [Details](/attachment.cgi?id=373201&action=edit) | [Diff](/attachment.cgi?id=373201&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373201) |
| [getparent / destroy variable cleanup v.3](/attachment.cgi?id=373343)  [16 years ago](#c47)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   9.97 KB, patch |  | [Details](/attachment.cgi?id=373343&action=edit) | [Diff](/attachment.cgi?id=373343&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373343) |
| [[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3](/attachment.cgi?id=373373)  [16 years ago](#c51)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   10.01 KB, patch | vlad : [review+](#a10357803_24534 "16 years ago")  beltzner : [approval1.9.1+](#c87 "16 years ago") | [Details](/attachment.cgi?id=373373&action=edit) | [Diff](/attachment.cgi?id=373373&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373373) |
| [Properly call Destroy()](/attachment.cgi?id=376333)  [16 years ago](#c58)  [Jeremy Lea](/user_profile?user_id=4774)   44.43 KB, patch |  | [Details](/attachment.cgi?id=376333&action=edit) | [Diff](/attachment.cgi?id=376333&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=376333) |
| [[1.9.1 checkin: 46b703c76f3a] getparent / variable shadowing patch](/attachment.cgi?id=378454)  [16 years ago](#c90)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   9.99 KB, patch |  | [Details](/attachment.cgi?id=378454&action=edit) | [Diff](/attachment.cgi?id=378454&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=378454) |
| [[m-c checkin: da42cf530fa7] teardown refactor v.1](/attachment.cgi?id=387214)  [16 years ago](#c99)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   15.80 KB, patch | neil : [review+](#a17673995_14006 "16 years ago") | [Details](/attachment.cgi?id=387214&action=edit) | [Diff](/attachment.cgi?id=387214&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=387214) |
| [teardown refactor 1.9.1 v.1](/attachment.cgi?id=390333)  [16 years ago](#c109)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   14.84 KB, patch |  | [Details](/attachment.cgi?id=390333&action=edit) | [Diff](/attachment.cgi?id=390333&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=390333) |
| [teardown refactor 1.9.1 v.3](/attachment.cgi?id=395363)  [15 years ago](#c117)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   15.69 KB, patch | samuel.sidler+old : [approval1.9.1.6+](#c148 "15 years ago") | [Details](/attachment.cgi?id=395363&action=edit) | [Diff](/attachment.cgi?id=395363&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=395363) |
| [java refs](/attachment.cgi?id=411102)  [15 years ago](#c142)  [Jim Mathies [:jimm]](/user_profile?user_id=279663)   13.89 KB, text/plain |  | [Details](/attachment.cgi?id=411102&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=470487#c0)• 16 years ago |
|  | |

Currently the #4 top crash in Firefox 3.1b2
0 xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1544
1 xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1518
2 xul.dll nsBaseWidget::Destroy widget/src/xpwidgets/nsBaseWidget.cpp:260
3 xul.dll nsWindow::Destroy widget/src/windows/nsWindow.cpp:1416
4 xul.dll nsPluginInstanceOwner::Destroy layout/generic/nsObjectFrame.cpp:4030
5 xul.dll DoStopPlugin layout/generic/nsObjectFrame.cpp:1987
6 xul.dll nsStopPluginRunnable::Run layout/generic/nsObjectFrame.cpp:2024
7 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:510
8 xul.dll nsBaseAppShell::Run widget/src/xpwidgets/nsBaseAppShell.cpp:170
9 nspr4.dll PR\_GetEnv
10 firefox.exe wmain toolkit/xre/nsWindowsWMain.cpp:87
11 firefox.exe firefox.exe@0x2197
12 kernel32.dll kernel32.dll@0x17066
not many comments to go on.
\*replying to message in yahoo mail at the time it crashed. Had just hit reply

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a145_103593)• 16 years ago |

Component: XUL Widgets → Widget: Win32Product: Toolkit → CoreQA Contact: xul.widgets → win32

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a483_2687)• 16 years ago |

Flags: blocking1.9.1?

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=470487#c1)• 16 years ago |
|  | |

recent changes around that code...
<http://hg.mozilla.org/mozilla-central/log/7cd58efd035a/widget/src/windows/nsWindow.cpp>

|  | [Dave Garrett](/user_profile?user_id=275233) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a2025_275233)• 16 years ago |

Severity: normal → criticalOS: Mac OS X → Windows XPSummary: Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() → Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ]Version: unspecified → 1.9.1 Branch

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=470487#c2)• 16 years ago |
|  | |

there is also another similar stack that goes though
nsWindow::Destroy widget/src/windows/nsWindow.cpp:1416
I wonder if this is a related crash, or another bug that needs to be spun off?
This stack signature "nsBaseWidget::Destroy()" is currently ranked #7
0 xul.dll nsBaseWidget::Destroy widget/src/xpwidgets/nsBaseWidget.cpp:262
1 xul.dll nsWindow::Destroy widget/src/windows/nsWindow.cpp:1416
2 xul.dll nsPluginInstanceOwner::Destroy layout/generic/nsObjectFrame.cpp:4030
3 xul.dll DoStopPlugin layout/generic/nsObjectFrame.cpp:1987
4 xul.dll nsStopPluginRunnable::Run layout/generic/nsObjectFrame.cpp:2024
5 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:510
6 xul.dll nsBaseAppShell::Run widget/src/xpwidgets/nsBaseAppShell.cpp:170
7 nspr4.dll PR\_GetEnv
8 firefox.exe wmain toolkit/xre/nsWindowsWMain.cpp:87
9 firefox.exe firefox.exe@0x2197
10 kernel32.dll kernel32.dll@0x17066Summary: Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ] → Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()?

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=470487#c3)• 16 years ago |
|  | |

I didn't change the actual logic of nsWindow::GetParentWindow which its old name is nsWindow::GetParent.
The crash timing is:
if (widget->mIsDestroying) {
this line.
So, looks like the parent widget is already destroyed.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=470487#c4)• 16 years ago |
|  | |

The pointer to nsWindow is released from HWND by SubclassWindow(FALSE). It is called only in nsWindow::OnDestroy. nsWindow::Destroy and getting WM\_CLOSE.
I guess that the parent window didn't get WM\_CLOSE message but the instance was already released. Then, SubclassWindow(FALSE) is called via nsWindow::Destroy. But then, mWnd was already set to null, so, we fail to release the pointer to nsWindow from HWND.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=470487#c5)• 16 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=470487#c4 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> The pointer to nsWindow is released from HWND by SubclassWindow(FALSE). It is
> called only in nsWindow::OnDestroy. nsWindow::Destroy and getting WM\_CLOSE.
nsWindow::Destroy and getting WM\_CLOSE are callers of nsWindow::OnDestroy.

|  | [Masayuki Nakano [:masayuki] (he/him)(JST, +0900)](/user_profile?user_id=34283) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=470487#c6)• 16 years ago |
|  | |

It's strange... ::DestroyWindow automatically destroys its children. So, why can ::GetParent in nsWindow::GetParentWindow get the destroyed parent window after the parent nsWindow destroyed??

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=470487#c7)• 16 years ago |
|  | |

Masayuki, thanks for helping to investigate. I've cc'ed some others that have some worked in the windows widget code in the past to see if they have ideas.

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a345499_75935)• 16 years ago |

Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=470487#c8)• 16 years ago |
|  | |

any more ideas on this one?

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=470487#c9)• 16 years ago |
|  | |

This is actually more likely to be plugin related -- I know there were some bugs & changes about plugin destruction. Cc'ing jst to see if this looks similar..

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=470487#c10)• 16 years ago |
|  | |

Can we figure out what plugins are loaded for people who are crashing? Is it always yahoo-related? We've had problems with the yahoo state plugin in the past.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=470487#c11)• 16 years ago |
|  | |

Given that this looks windows specific it's even more odd as on windows we reparent the plugins widget to the root widget (the desktop) when we do plugin destruction off of an event, which seems to be the case here.
I looked through a dozen or so crash reports, and only one of them had the yahoo state plugin dll loaded (npYState.dll), so it's likely not specific to yahoo.
It's also interesting to note that out of the 6886 crashes found by my query, 6675 happened on December 1st of 2008. So how much of a top-crash this is atm is not clear to me.

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=470487#c12)• 16 years ago |
|  | |

This query shows 851 crashes in the last week for users on beta2
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.1b2&query_search=signature&query_type=contains&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28%29>
That ranks it as #7 top crash.
Glancing though a few of the module lists I've seen NPAskSBr.dll (the ask tool bar) show up in a couple of reports.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=470487#c13)• 16 years ago |
|  | |

I think this should block.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=470487#c14)• 16 years ago |
|  | |

Not blocking for now since it looks like we might have just seen a spike caused by other software/sites? If it persists in B3 as a topcrash please renom.Flags: blocking1.9.1? → blocking1.9.1-

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=470487#c15)• 16 years ago |
|  | |

This ranks as the number 7 for Firefox 3.0.6. My guess is that it'll be highly present in b3 just as it was for b2.Flags: wanted1.9.0.x+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=470487#c16)• 16 years ago |
|  | |

This is currently #6 in the list of top crashes for Firefxo 3.1 beta 3. Renoming per [comment 14](/show_bug.cgi?id=470487#c14 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?").Flags: blocking1.9.1- → blocking1.9.1?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a8458396_137548)• 16 years ago |

Flags: blocking1.9.1? → blocking1.9.1+Priority: -- → P2

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a8593896_15223)• 16 years ago |

Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Summary: Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()? → Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()]?

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=470487#c17)• 16 years ago |
|  | |

I've stared at this code and I can't see anything obviously wrong; we need to find steps to reproduce.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=470487#c18)• 16 years ago |
|  | |

(In reply to [comment #15](/show_bug.cgi?id=470487#c15 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> This ranks as the number 7 for Firefox 3.0.6. My guess is that it'll be highly
> present in b3 just as it was for b2.
Did this start in 3.0.6, or earlier? A regression range would be quite handy.

|  | [Aakash Desai [:aakashd]](/user_profile?user_id=339035) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=470487#c19)• 16 years ago |
|  | |

I've spent half a day trying different scenarios concerning Yahoo Mail and the Yahoo Mail extension and haven't been able to reproduce it whatsoever. The comments on the crash reports aren't helpful for this at all either. Has anyone been able to see this once or twice on their profile? I'd like to get some deatils as to what extensions, sites and operations/actions were used.

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=470487#c20)• 16 years ago |
|  | |

maybe between 3.0.4 and 3.0.5? searching the topcrasher lists for recent
3.0.x releases I see these in nsWindow code.
release rank stack
3.0.4 43 nsWindow::GetParent()
3.0.5 28 nsWindow::GetParentWindow()
3.0.4 17 nsWindow::GetParentWindow()

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=470487#c21)• 16 years ago |
|  | |

er, that should have been
maybe between 3.0.3 and 3.0.4? searching the topcrasher lists for recent
3.0.x releases I see these in nsWindow code.
release rank stack
3.0.3 43 nsWindow::GetParent()
3.0.4 17 nsWindow::GetParentWindow()
3.0.5 28 nsWindow::GetParentWindow()
3.0.6 20 nsWindow::GetParentWindow()
3.0.7 19 nsWindow::GetParentWindow()

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=470487#c22)• 16 years ago |
|  | |

and for the 1.9.1 related releases
release rank stack
3.1a2 nothing
3.1b1 7 nsWindow::GetParentWindow()
3.1b2 15 nsWindow::GetParentWindow()
3.1b3 9 nsWindow::GetParentWindow()
3.5b4pre 18 nsWindow::GetParentWindow()

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=470487#c23)• 16 years ago |
|  | |

so maybe some time last sept. looks like when it started showing up.
v3.0.3, released September 26, 2008 -- v3.0.4, released November 12, 2008
3.1 alpha2 Sept 5, 2008 --- v3.1 Beta 1, released October 14, 2008

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=470487#c24)• 16 years ago |
|  | |

at first glance the only thing I see landing around then that might be related is [https://bugzilla.mozilla.org/show\_bug.cgi?id=452385](/show_bug.cgi?id=452385 "RESOLVED FIXED - Bookmark This Page panel hangs Firefox when -moz-border-radius is used")
any possibility of some bad interaction between the patches there and plugins?

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=470487#c25)• 16 years ago |
|  | |

[Bug 452385](/show_bug.cgi?id=452385 "RESOLVED FIXED - Bookmark This Page panel hangs Firefox when -moz-border-radius is used") renamed nsWindow::GetParent() to nsWindow::GetParentWindow().
So this bug had occured in 3.0.3.

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=470487#c26)• 16 years ago |
|  | |

> re: [comment 25](/show_bug.cgi?id=470487#c25 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?")
ok, that's helping to make a bit more sense of the pattern seen in the releases. I looked at the stack traces in 3.0.3 and they look basically the same as [comment 0](/show_bug.cgi?id=470487#c0 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?").
one thing looking at this bug shows is an increase in the ranking after 3.0.4, and from no visability to being ranked in 3.1 beta1. the increase in visability in 3.1 beta1 may just be related to more users ramping up on 3.1 when it hit the first beta. It does appear that that it takes a large user pool to hit this problem.
Is it possible the fixes that went in for [bug 452385](/show_bug.cgi?id=452385 "RESOLVED FIXED - Bookmark This Page panel hangs Firefox when -moz-border-radius is used") reduced the chances of bug being surfaced in the bookmark UI case, but increased the chances in plugin window popups or some other windowing cases, or that some hangs for remaining edge cases in that bug have been turned into crashes?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=470487#c27)• 16 years ago |
|  | |

(In reply to [comment #26](/show_bug.cgi?id=470487#c26 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> one thing looking at this bug shows is an increase in the ranking after 3.0.4,
> and from no visability to being ranked in 3.1 beta1. the increase in
> visability in 3.1 beta1 may just be related to more users ramping up on 3.1
> when it hit the first beta. It does appear that that it takes a large user
> pool to hit this problem.
This is likely related to the fact that crash-stats top crash reports don't "freeze", so they're still based on current data (last 2 weeks or whatever). There's likely less users on 3.0.3 than on 3.1b1 or something weird like that...

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=470487#c28)• 16 years ago |
|  | |

A random thought... Can someone who can reproduce this bug (can anyone?) please try removing the mIsDestroying and mOnDestroyCalled variables from windows/nsWindow.h (they already exist in nsBaseWidget). Duplicate variables are never a good idea. They've been there for a long time, but maybe something is now tickling the classes into using different versions?

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=470487#c29)• 16 years ago |
|  | |

Yeah, I don't think we have a way to reproduce it.. the fix you suggest is probably a good one in any case, though.

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=470487#c30)• 16 years ago |
|  | |

This is still sitting on qawanted -- given that noone can reproduce this, it would be helpful for QA to:
- try to find a way to reproduce, by looking at crash info, perhaps by contacting users or some other type of outreach (blog post saying "hey, if you crashed, and you have an about:crashes log that looks like this, get a hold of us");
- get this in the debugger for a developer to look at;
- try to find a regression range.
Cc'ing Jim as well -- Jim, could you take a look at jeremy's suggestion on [comment #28](/show_bug.cgi?id=470487#c28 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?") and fix up those variables?

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=470487#c31)• 16 years ago |
|  | |

<http://crashreports.songbirdnest.com/report/list?range_unit=months&query_search=signature&query_type=contains&signature=nsWindow%3A%3AGetParentWindow%28%29&query=nsWindow%3A%3AGetParentWindow%28%29&range_value=1>
Same signature. There are a couple of reports with comments.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=470487#c32)• 16 years ago |
|  | |

Juan, you probably added the wrong url? This are crashes from Songbird and only two with comments.
Our ones aren't helpful either:
<http://crash-stats.mozilla.com/report/list?product=Firefox&branch=1.9.1&version=Firefox%3A3.1b3&query_search=signature&query_type=exact&query=nsWindow%3A%3AGetParentWindow%28%29&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28%29>
We could file an IT ticket and ask for a couple of URLs where the crash happens.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10085549_279663)• 16 years ago |

Assignee: nobody → jmathies

|  | [juan becerra [:juanb]](/user_profile?user_id=241759) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=470487#c33)• 16 years ago |
|  | |

Henrik, I added the intended URL, because it had a couple of comments, as opposed to our stats site which, when I tried to access, would time out.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=470487#c34)• 16 years ago |
|  | |

(In reply to [comment #32](/show_bug.cgi?id=470487#c32 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Juan, you probably added the wrong url? This are crashes from Songbird and only
> two with comments.
>
> Our ones aren't helpful either:
> <http://crash-stats.mozilla.com/report/list?product=Firefox&branch=1.9.1&version=Firefox%3A3.1b3&query_search=signature&query_type=exact&query=nsWindow%3A%3AGetParentWindow%28%29&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28%29>
>
> We could file an IT ticket and ask for a couple of URLs where the crash
> happens.
Clicking through a number of these, all seem to have some form of plugin loaded, but there doesn't appear to be a particular plugin that's causing it, so I'm guessing it's more generic.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10088533_279663)• 16 years ago |

Summary: Firefox 3.1b2 Crash Report [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()]? → Firefox Crash [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()]?

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=470487#c35)• 16 years ago |
|  | |

OK, here's my debugging assessment. I don't have time to work up a patch and test it now. But basically, widget destruction on windows is completely broken - it's a wonder it doesn't crash more... This is besides the duplicate member variable problem.
The sequence of preferred actions appears to be nsWindow::Destroy() which calls nsBaseWidget::Destroy(), nsWindow::OnDestroy() which calls nsBaseWidget::OnDestroy() and finally nsWindow::~nsWindow(). Lets look at these in order:
1381 NS\_METHOD nsWindow::Destroy()
1382 {
1383 // Switch to the "main gui thread" if necessary... This method must
1384 // be executed on the "gui thread"...
1385 nsToolkit\* toolkit = (nsToolkit \*)mToolkit;
1386 if (toolkit != nsnull && !toolkit->IsGuiThread()) {
1387 MethodInfo info(this, nsWindow::DESTROY);
1388 toolkit->CallMethod(&info);
1389 return NS\_ERROR\_FAILURE;
1390 }
This is fine (the bogus failure code is always ignored).
1392 // disconnect from the parent
1393 if (!mIsDestroying) {
1394 nsBaseWidget::Destroy();
1395 }
This is wrong. This should test be:
if (mIsDestroying) // Should be an atomic test and set...
return NS\_OK;
nsCOMPtr<nsIWidget> kungFuDeathGrip(this);
mIsDestroying = PR\_TRUE;
nsBaseWidget::Destroy();
1397 // just to be safe. If we're going away and for some reason we're still
1398 // the rollup widget, rollup and turn off capture.
1399 if ( this == gRollupWidget ) {
1400 if ( gRollupListener )
1401 gRollupListener->Rollup(nsnull);
1402 CaptureRollupEvents(nsnull, PR\_FALSE, PR\_TRUE);
1403 }
This is OK.
1405 EnableDragDrop(PR\_FALSE);
1406
1407 // destroy the HWND
1408 if (mWnd) {
1409 // prevent the widget from causing additional events
1410 mEventCallback = nsnull;
1411
1412 // if IME is disabled, restore it.
1413 if (mOldIMC) {
1414 mOldIMC = ::ImmAssociateContext(mWnd, mOldIMC);
1415 NS\_ASSERTION(!mOldIMC, "Another IMC was associated");
1416 }
1417
1418 HICON icon;
1419 icon = (HICON) ::SendMessageW(mWnd, WM\_SETICON, (WPARAM)ICON\_BIG, (LPARAM) 0);
1420 if (icon)
1421 ::DestroyIcon(icon);
1422
1423 icon = (HICON) ::SendMessageW(mWnd, WM\_SETICON, (WPARAM)ICON\_SMALL, (LPARAM) 0);
1424 if (icon)
1425 ::DestroyIcon(icon);
1426
1427 #ifdef MOZ\_XUL
1428 if (eTransparencyTransparent == mTransparencyMode)
1429 {
1430 SetupTranslucentWindowMemoryBitmap(eTransparencyOpaque);
1431
1432 }
1433 #endif
This is OK, until here. We should add:
SubclassWindow(FALSE);
1434
1435 VERIFY(::DestroyWindow(mWnd));
1436
1437 mWnd = NULL;
1438 //our windows can be subclassed by
1439 //others and these nameless, faceless others
1440 //may not let us know about WM\_DESTROY. so,
1441 //if OnDestroy() didn't get called, just call
1442 //it now. MMP
1443 if (PR\_FALSE == mOnDestroyCalled)
1444 OnDestroy();
1445 }
1446
1447 return NS\_OK;
1448 }
This should be:
VERIFY(::DestroyWindow(mWnd));
mWnd = NULL;
}
//our windows can be subclassed by
//others and these nameless, faceless others
//may not let us know about WM\_DESTROY. so,
//if OnDestroy() didn't get called, just call
//it now. MMP
if (PR\_FALSE == mOnDestroyCalled)
OnDestroy();
return NS\_OK;
}
Looking at OnDestroy:
5759 void nsWindow::OnDestroy()
5760 {
5761 mOnDestroyCalled = PR\_TRUE;
This should test and exit.
5763 SubclassWindow(FALSE);
5764
5765 // We have to destroy the native drag target before we null out our
5766 // window pointer
5767 EnableDragDrop(PR\_FALSE);
5768
5769 mWnd = NULL;
This should test mIsDestroying and call Destroy() and exit. This should be done before the test for mOnDestroyCalled.
5770
5771 // free GDI objects
5772 if (mBrush) {
5773 VERIFY(::DeleteObject(mBrush));
5774 mBrush = NULL;
5775 }
5776
5777 #if 0
5778 if (mPalette) {
5779 VERIFY(::DeleteObject(mPalette));
5780 mPalette = NULL;
5781 }
5782 #endif
5783
5784 // if we were in the middle of deferred window positioning then
5785 // free the memory for the multiple-window position structure
5786 if (mDeferredPositioner) {
5787 VERIFY(::EndDeferWindowPos(mDeferredPositioner));
5788 mDeferredPositioner = NULL;
5789 }
5790
5791 // release references to children, device context, toolkit, and app shell
5792 nsBaseWidget::OnDestroy();
nsBaseWidget::OnDestroy() does not destroy children (and there is not more app shell). GTK widgets explicitly destroy their children in Destroy()... should windows be doing that too? It seems cleaner... Otherwise OK.
5793
5794 // dispatch the event
5795 if (!mIsDestroying) {
5796 // dispatching of the event may cause the reference count to drop to 0
5797 // and result in this object being destroyed. To avoid that, add a reference
5798 // and then release it after dispatching the event
5799 AddRef();
5800 DispatchStandardEvent(NS\_DESTROY);
5801 Release();
5802 }
5803 }
This is not needed. Or otherwise should the ordering be OnDestroy(), Destroy()? If it is needed, should this have a kungfuDeathGrip?
697 nsWindow::~nsWindow()
698 {
699 mIsDestroying = PR\_TRUE;
This should test and call Destroy(). Or just call destroy unconditionally...
700 if (gCurrentWindow == this) {
701 gCurrentWindow = nsnull;
702 }
703
704 MouseTrailer\* mtrailer = nsToolkit::gMouseTrailer;
705 if (mtrailer) {
706 if (mtrailer->GetMouseTrailerWindow() == mWnd)
707 mtrailer->DestroyTimer();
708
709 if (mtrailer->GetCaptureWindow() == mWnd)
710 mtrailer->SetCaptureWindow(nsnull);
711 }
These need mWnd, so should be moved to Destroy().
713 // If the widget was released without calling Destroy() then the native
714 // window still exists, and we need to destroy it
715 if (NULL != mWnd) {
716 Destroy();
717 }
Called above.
719 if (mCursor == -1) {
720 // A successfull SetCursor call will destroy the custom cursor, if it's ours
721 SetCursor(eCursor\_standard);
722 }
Move to destroy?
724 sInstanceCount--;
725
726 #ifdef NS\_ENABLE\_TSF
727 if (!sInstanceCount)
728 nsTextStore::Terminate();
729 #endif //NS\_ENABLE\_TSF
730
731 #ifndef WINCE
732 //
733 // delete any of the IME structures that we allocated
734 //
735 if (sInstanceCount == 0) {
736 if (sIMECompUnicode)
737 delete sIMECompUnicode;
738 if (sIMEAttributeArray)
739 delete [] sIMEAttributeArray;
740 if (sIMECompClauseArray)
741 delete [] sIMECompClauseArray;
742
743 NS\_IF\_RELEASE(gCursorImgContainer);
744
745 if (sIsOleInitialized) {
746 ::OleFlushClipboard();
747 ::OleUninitialize();
748 sIsOleInitialized = FALSE;
749 }
750 }
751
752 NS\_IF\_RELEASE(mNativeDragTarget);
753 #endif
754
755 }
These are OK.
Otherwise, once the order of Destroy() and OnDestroy() is fixed, all of the other tests for mIsDestroying and mOnDetroyCalled should be changed to whichever is first.
Finally, and what I think is actually the bug here. SubClassWindow should addref and release the this pointer.
Hope this helps.

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=470487#c36)• 16 years ago |
|  | |

One more thing... The WindowProc does and conditional kungfuDeathGrip on the target, which assumes nsIsDestroying is only set in the destructor. GTK has a nsIsDestroyed flag which is set in the destructor. Maybe windows should have one of these too?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=470487#c37)• 16 years ago |
|  | |

Adding a bit of data - I was looking at the normal shutdown steps a windowed plugin takes when it's destroyed. Similar to Jeremy's break down:
Starting a shutdown for a Flash nsObjectFrame:
nsObjectFrame::StopPluginInternal
nsPluginInstanceOwner::PrepareToStop -> mWidget->SetParent(nsnull)
nsObjectFrame::StopPluginInternal done.
(time passes for a delayed plugin teardown which gets fired off as a runnable event)
nsObjectFrame's DoStopPlugin
nsPluginInstanceOwner::Destroy()
nsWindow::Destroy()
nsBaseWidget::Destroy()
nsWindow::GetParentWindow()
mWnd = 0x260afe | parent hwnd = 0x10010 | parent widget = 0x0
This is where this crash would occur.
A couple notes - we set the native parent window of the plugin to null way up in nsPluginInstanceOwner's PrepareToStop. This happens way before we actually destroy the window. This is the same parent hwnd we retrieve in GetParentWindow later on when we are destroying. During destruction, GetParentWindow's ::GetParent(mWnd) call actually returns the handle to the desktop instead, since GetParent returns the parent \_or\_ the owner, which in this case is the desktop. We then query that for a mozilla property through GetProp to get the widget, which fails and everything moves on smoothly...
nsWindow::GetParentWindow() done.
nsBaseWidget::Destroy() done.
nsWindow::OnDestroy()
nsWindow::SubclassWindow(0) 0x260afe
nsBaseWidget::OnDestroy()
nsBaseWidget::OnDestroy() done.
nsWindow::OnDestroy() done.
nsWindow::Destroy() done.
~nsWindow()
~nsWindow() done.
So that's a normal shutdown. This bug is rather odd in that in the crash case GetParentWindow retrieves a valid parent hwnd, retrieves a valid mozilla property for the widget pointer, and then tries to access mIsDestroying for the widget. But if shutdown is working correctly, parent should have been set to null and the desktop hwnd would have been returned.
I still don't have a specific answer as to how this could happen, but I think it's something more than a slight timing issue in how we destroy. I'm going to look a bit more at the plugin code. I'm wondering if there are cases where we do not delay the unload of plugins like flash.
(Also we should probably be calling GetAncestor instead of GetParent in GetParentWindow so we can avoid checking for properties on the desktop window during shutdown.)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=470487#c38)• 16 years ago |
|  | |

Actually, looking at the stacks, all of these crashes occur on threads that are coming through nsStopPluginRunnable::Run, so the delayed vs. immediate destruction isn't the issue. These crashes are all on delayed tear down events.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=470487#c39)• 16 years ago |
|  | |

Attached patch

[getparent / destroy variable cleanup v.1](attachment.cgi?id=373186&action=diff) (obsolete)
— [Details](attachment.cgi?id=373186&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373186)

I'm going to look at Jeremy's other cleanup suggestions but I'd like to start with something simple - cleanup the variable madness and make sure get parent is always working with a parent window handle.
[Attachment #373186](/attachment.cgi?id=373186&action=edit "getparent / destroy variable cleanup v.1") -
Flags: review?(vladimir)

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=470487#c40)• 16 years ago |
|  | |

Comment on [attachment 373186](/attachment.cgi?id=373186 "getparent / destroy variable cleanup v.1") [[details]](/attachment.cgi?id=373186&action=edit "getparent / destroy variable cleanup v.1") [[diff]](/attachment.cgi?id=373186&action=diff "getparent / destroy variable cleanup v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373186)
getparent / destroy variable cleanup v.1
ugh, field shadowing.. can you get rid of the other shadowed fields as well? mIs{Shift,Control,Alt}Down are the ones I see at a quick glance
[Attachment #373186](/attachment.cgi?id=373186&action=edit "getparent / destroy variable cleanup v.1") -
Flags: review?(vladimir) → review+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=470487#c41)• 16 years ago |
|  | |

Looks like it was this little block - beos and os2 also use most of these.
PRPackedBool mIsShiftDown;
PRPackedBool mIsControlDown;
PRPackedBool mIsAltDown;
PRPackedBool mIsDestroying;
PRPackedBool mOnDestroyCalled;
new patch coming up...

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=470487#c42)• 16 years ago |
|  | |

Attached patch

[getparent / destroy variable cleanup v.2](attachment.cgi?id=373201&action=diff) (obsolete)
— [Details](attachment.cgi?id=373201&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373201)

Threw this at try. I'll land it on m-c once that clears.
[Attachment #373186](/attachment.cgi?id=373186&action=edit "getparent / destroy variable cleanup v.1") -
Attachment is obsolete: true

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10191365_279663)• 16 years ago |

[Attachment #373201](/attachment.cgi?id=373201&action=edit "getparent / destroy variable cleanup v.2") -
Attachment is patch: true

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=470487#c43)• 16 years ago |
|  | |

> - HWND parent = ::GetParent(mWnd);
> + HWND parent = ::GetAncestor(mWnd, GA\_PARENT);
Actually we also need the owner here when GetTopLevelWindow() is called with aStopOnDialogOrPopup=PR\_FALSE.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=470487#c44)• 16 years ago |
|  | |

(In reply to [comment #43](/show_bug.cgi?id=470487#c43 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> > - HWND parent = ::GetParent(mWnd);
> > + HWND parent = ::GetAncestor(mWnd, GA\_PARENT);
> Actually we also need the owner here when GetTopLevelWindow() is called with
> aStopOnDialogOrPopup=PR\_FALSE.
Hmm, I'm not seeing why this is. GetTopLevelWindow would return the current window if it's top and I don't see how that would mess up caret position data in calls to ResolveIMECaretPos. I'll do some debugging though and see if I can spot what the potential problem might be. If we do need owner for the ime code, I think it might be best to differentiate between the two calls so that other calls to getparentwindow return the true parent.

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=470487#c45)• 16 years ago |
|  | |

It will affect the popup window (e.g. "Organize Bookmarks" dialog). We want a main window pointer from children of the popup.
> I think it might be best to differentiate between the two calls so that other
> calls to getparentwindow return the true parent.
I agree.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=470487#c46)• 16 years ago |
|  | |

(In reply to [comment #45](/show_bug.cgi?id=470487#c45 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> It will affect the popup window (e.g. "Organize Bookmarks" dialog). We want a
> main window pointer from children of the popup.
> > I think it might be best to differentiate between the two calls so that other
> > calls to getparentwindow return the true parent.
> I agree.
How will it effect windows like organize bookmarks? Is this an IME issue or something more general? I've been using a build of this for a day now and haven't seen any strange behavior during normal use.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=470487#c47)• 16 years ago |
|  | |

Attached patch

[getparent / destroy variable cleanup v.3](attachment.cgi?id=373343&action=diff) (obsolete)
— [Details](attachment.cgi?id=373343&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373343)

Here's an update that chooses between the two so that calls to GetTopLevelWindow continue to return owner.
[Attachment #373201](/attachment.cgi?id=373201&action=edit "getparent / destroy variable cleanup v.2") -
Attachment is obsolete: true

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10261757_279663)• 16 years ago |

[Attachment #373343](/attachment.cgi?id=373343&action=edit "getparent / destroy variable cleanup v.3") -
Attachment is patch: true

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=470487#c48)• 16 years ago |
|  | |

Independent of these changes, this crash still seems pretty prevenlent in pre beta 4. Three crash signatures all seems to tie in with this -
From the last week:
nsWindow::GetParentWindow() (rank 14) -
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.5b4pre&platform=windows&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow>()
0 xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1651
1 xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1625
2 xul.dll nsBaseWidget::Destroy widget/src/xpwidgets/nsBaseWidget.cpp:259
3 xul.dll nsWindow::Destroy widget/src/windows/nsWindow.cpp:1523
nsBaseWidget::Destroy() (rank 39) -
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.5b4pre&platform=windows&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsBaseWidget%3A%3ADestroy>()
0 xul.dll nsBaseWidget::Destroy widget/src/xpwidgets/nsBaseWidget.cpp:261
1 xul.dll nsWindow::Destroy widget/src/windows/nsWindow.cpp:1523
2 xul.dll nsPluginInstanceOwner::Destroy layout/generic/nsObjectFrame.cpp:4069
3 xul.dll DoStopPlugin layout/generic/nsObjectFrame.cpp:1986
254 NS\_METHOD nsBaseWidget::Destroy()
255 {
256 // Just in case our parent is the only ref to us
257 nsCOMPtr<nsIWidget> kungFuDeathGrip(this);
258 // disconnect from the parent
259 nsIWidget \*parent = GetParent();
260 if (parent) {
261 parent->RemoveChild(this);
nsWindow::Destroy() (rank 78) -
(Last one of these was the 12th)
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.5b4pre&platform=windows&query_search=signature&query_type=exact&query=&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3ADestroy>()
0 @0x740072
1 xul.dll nsWindow::Destroy widget/src/windows/nsWindow.cpp:1489
2 xul.dll nsPluginInstanceOwner::Destroy layout/generic/nsObjectFrame.cpp:4069
3 xul.dll DoStopPlugin layout/generic/nsObjectFrame.cpp:1986
4 xul.dll nsStopPluginRunnable::Run layout/generic/nsObjectFrame.cpp:2023
5 xul.dll nsThread::ProcessNextEvent xpcom/threads/nsThread.cpp:510
I was hoping to reproduce this from some extended use of a test build but still haven't seen it.

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=470487#c49)• 16 years ago |
|  | |

(In reply to [comment #46](/show_bug.cgi?id=470487#c46 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> How will it effect windows like organize bookmarks?
Sorry, I have confused a dialog name. It should read "Edit This Bookmark" dialog (i.e. a dialog which will appear when tha star icon is clicked).
> Is this an IME issue or
> something more general? I've been using a build of this for a day now and
> haven't seen any strange behavior during normal use.
IME issue. With cleanup v.2 patch and ChangJie, composition window was displayed at wrong position on "Edit Bookmarks" dialog.
Even worse, With cleanup v.3 patch, Firefox hanged when I tried to input on "Edit Bookmarks" dialog using ChangJie. It seems to regress [bug 452385](/show_bug.cgi?id=452385 "RESOLVED FIXED - Bookmark This Page panel hangs Firefox when -moz-border-radius is used").
Without neither patches, there was no problem.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=470487#c50)• 16 years ago |
|  | |

(In reply to [comment #49](/show_bug.cgi?id=470487#c49 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> (In reply to [comment #46](/show_bug.cgi?id=470487#c46 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> > How will it effect windows like organize bookmarks?
> Sorry, I have confused a dialog name. It should read "Edit This Bookmark"
> dialog (i.e. a dialog which will appear when tha star icon is clicked).
> > Is this an IME issue or
> > something more general? I've been using a build of this for a day now and
> > haven't seen any strange behavior during normal use.
> IME issue. With cleanup v.2 patch and ChangJie, composition window was
> displayed at wrong position on "Edit Bookmarks" dialog.
> Even worse, With cleanup v.3 patch, Firefox hanged when I tried to input on
> "Edit Bookmarks" dialog using ChangJie. It seems to regress [bug 452385](/show_bug.cgi?id=452385 "RESOLVED FIXED - Bookmark This Page panel hangs Firefox when -moz-border-radius is used").
> Without neither patches, there was no problem.
Thanks for testing. I guess I'll go back to using ::GetParent on the IME calls.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=470487#c51)• 16 years ago |
|  | |

Attached patch

[[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3](attachment.cgi?id=373373&action=diff)
— [Details](attachment.cgi?id=373373&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373373)

[Attachment #373343](/attachment.cgi?id=373343&action=edit "getparent / destroy variable cleanup v.3") -
Attachment is obsolete: true

|  | [Masatoshi Kimura [:emk]](/user_profile?user_id=5842) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=470487#c52)• 16 years ago |
|  | |

The new patch looks good.
I haven't find any apparent problems during my short, non-scientific testing.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=470487#c53)• 16 years ago |
|  | |

Comment on [attachment 373373](/attachment.cgi?id=373373 "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[details]](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[diff]](/attachment.cgi?id=373373&action=diff "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373373)
[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3
r? -> vlad since there have been some additional changes. This might fix the crash problem so we should consider getting it into 1.9.1 after it's sat on trunk for a few days.
[Attachment #373373](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") -
Flags: review?(vladimir)

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10357803_24534)• 16 years ago |

[Attachment #373373](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") -
Flags: review?(vladimir) → review+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a10442149_279663)• 16 years ago |

[Attachment #373373](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") -
Attachment description: getparent / destroy variable cleanup v.3 → [m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3

|  | [Tomas](/user_profile?user_id=301780) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=470487#c54)• 16 years ago |
|  | |

And... ?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a11724841_279663)• 16 years ago |

[Attachment #373373](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") -
Flags: approval1.9.1?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=470487#c55)• 16 years ago |
|  | |

(In reply to [comment #54](/show_bug.cgi?id=470487#c54 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> And... ?
It didn't fix it. :)
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.6a1pre&platform=windows&branch=1.9.2&date=&range_value=3&range_unit=weeks&query_search=signature&query_type=contains&query=GetParentWindow>

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=470487#c56)• 16 years ago |
|  | |

So we generally know which thing is NULL; is there any data at that point that we could use to figure out what happened? I'm thinking we should maybe add some logging; unfortunately breakpad doesn't support sending arbitrary logged data, but we could leave a file in some dir and ask people to mail it in if they see it. (Should always append to it, etc.)

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=470487#c57)• 16 years ago |
|  | |

Looks like this can actually be done: <http://mxr.mozilla.org/mozilla-central/source/xpcom/system/nsICrashReporter.idl#101> (appendAppNotesToCrashReport) and it'll show up in breakpad.

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=470487#c58)• 16 years ago |
|  | |

Attached patch

[Properly call Destroy()](attachment.cgi?id=376333&action=diff) (obsolete)
— [Details](attachment.cgi?id=376333&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=376333)

I just pushed this patch to the try server... It's a big hammer approach to this, which makes sure Destroy() is called correctly. To do that, SetParent() also needs to manage the parent's child list, which most platforms where not doing. My brief testing showed that the new asserts were not being called, and that reftests and mochitests looked good, except for a few, which appears to caused by a focus problem (the main window isn't refocused after a popup). I'll see what the tryserver says.
I think this patch is to intrusive for 3.5. But some things I did learn... It appears that nsWindow::~nsWindow could be called multiple times... That's not good. I think what might be happening is that the code is actually stepping through deleted memory which gets overwritten at some point.

|  | [Karl Tomlinson (:karlt)](/user_profile?user_id=274246) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=470487#c59)• 16 years ago |
|  | |

Jeremy, out of interest, do you have a test case where SetParent is called from nsViewManager::ReparentChildWidgets?

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=470487#c60)• 16 years ago |
|  | |

Karl... No. I've just been reading the code. [bug 129034](/show_bug.cgi?id=129034 "VERIFIED FIXED - IFrames display on the wrong page in PP") is the original implementation. The test case there now asserts on something else ([bug 485893](/show_bug.cgi?id=485893 "RESOLVED WORKSFORME - ASSERTION: Unexpected containers: 'SameCOMIdentity(debugDocContainer, debugDocShell)'") - it doesn't get to SetParent()). It seems to have regressed from 3.0.10, but I haven't looked at it carefully. If SetParent(nonnull) is not needed then these could all be changed to ResetParent(), like what Cocoa did recently, and the code greatly simplified. The assert in nsViewManager::ReparentChildWidgets has never had a bug filed on it. But this is getting off topic.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=470487#c61)• 16 years ago |
|  | |

A possible fix for 1.9.1 might be to move (or add) a call to SetParent(nsnull) just before we destroy the widget in nsPluginInstanceOwner's Destroy. We clear it in PrepareToStop (just below Destroy in the code) a little bit before we actually tear down.
<http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsObjectFrame.cpp#4217>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=470487#c62)• 16 years ago |
|  | |

(In reply to [comment #61](/show_bug.cgi?id=470487#c61 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> A possible fix for 1.9.1 might be to move (or add) a call to SetParent(nsnull)
> just before we destroy the widget in nsPluginInstanceOwner's Destroy. We clear
> it in PrepareToStop (just below Destroy in the code) a little bit before we
> actually tear down.
>
> <http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsObjectFrame.cpp#4217>
Hmm, we call GetParent in SetParent, so that's not going to work without changes to the window code.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=470487#c63)• 16 years ago |
|  | |

Summarizing what's known at this point -
- The crash is sporadic, and hard to reproduce
- The crash occurs in delayed tear down of a plugin window
- We know that SetParent is called in PreparToStop before the tear down event is sent, and it seems that it must succeed in setting the parent widget pointer in the native window's property list to null.
- When the event comes back, we go into what is a rather haphazzard process of unhooking and destroying the widget and window. During this process we retrieve the parent widget pointer via the property list.
- The parent widget pointer returned on a valid native window handle is not null and does not point to a valid parent widget which results in the crash.
I've tried to reproduce this, and looked at ways to do a one off for 1.9.1 but really am not coming up with much of anything except hacks. Vlad suggested logging but I didn't see anything there that would help. What has been suggested is a rework of our tear down methodology with a heavy handed patch in the hopes it will fix the problem. But nobody feels confident about applying that to 1.9.1 this late in the ball game.
I'm not entirely sure what direction to take, so I'd welcome any help / suggestions.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=470487#c64)• 16 years ago |
|  | |

(In reply to [comment #63](/show_bug.cgi?id=470487#c63 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> What has been suggested is a rework of our tear down methodology with a heavy
> handed patch in the hopes it will fix the problem. But nobody feels confident
> about applying that to 1.9.1 this late in the ball game.
Can we start working on this now, land it for 1.9.2 as soon as it's ready and see if it fixes the problem there? If so, and if it bakes for a while, we might be able to take it in 1.9.1.x, despite its size/scope.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=470487#c65)• 16 years ago |
|  | |

(In reply to [comment #58](/show_bug.cgi?id=470487#c58 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Created an attachment (id=376333) [details]
> Properly call Destroy()
>
> I just pushed this patch to the try server... It's a big hammer approach to
> this, which makes sure Destroy() is called correctly. To do that, SetParent()
> also needs to manage the parent's child list, which most platforms where not
> doing. My brief testing showed that the new asserts were not being called, and
> that reftests and mochitests looked good, except for a few, which appears to
> caused by a focus problem (the main window isn't refocused after a popup).
> I'll see what the tryserver says.
>
> I think this patch is to intrusive for 3.5. But some things I did learn... It
> appears that nsWindow::~nsWindow could be called multiple times... That's not
> good. I think what might be happening is that the code is actually stepping
> through deleted memory which gets overwritten at some point.
Jeremy, how are you feeling about your destroy rework patch? Want to kick off some reviews?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=470487#c66)• 16 years ago |
|  | |

Spoke to Jeremy through email, his patch had some issues and didn't make it through try, so I'll start in on something myself.

|  | [Jeremy Lea](/user_profile?user_id=4774) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=470487#c67)• 16 years ago |
|  | |

I was going to attach an updated patch, but the more I little bugs I've fixed, the more creep in...
What I have become convinced of is that the windows cleverness of using the windows ::GetParent() call is the main problem, because it's ownership model and semantics are just not compatible with what nsIWidget wants. I think that an alternative approach here is to add a nsRefPtr<nsWindow> mParent to nsWindow, and manage it in Create() [=baseParent], SetParent() and Destroy(). Then we can remove GetParentWindow(), since mParent would now be correct. Also, many of the uses of ::GetParent() in nsWindow.cpp are bogus - they should already be using GetParentWindow().
Also, I think that Destroy() should be called on all widgets. I think that the only needed fixes are in nsXULWindow (the last hunk of my patch), and then a loop over the children in Destroy(), like GTK already does. I would also make the loop over the children use a nsCOMPtr so that they are only Released() and destructed when Destroy has returned, just to make life more predictable.
I'll merge most of the rest of my changes into the cleanup I'm doing in [bug 431634](/show_bug.cgi?id=431634 "RESOLVED DUPLICATE - deCOMtaminate nsIWidget").

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=470487#c68)• 16 years ago |
|  | |

This is marked topcrash - do we know how much of a crasher this is under b4?

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=470487#c69)• 16 years ago |
|  | |

According to a discussion w/ jimm in IRC, we saw 4991 in a week on 3.0.0.11.
In any case, after talking this over with Joe Drew and jimm in IRC, since we can't reproduce this crash, it's in 3.0, we don't have a regression range, \*and\* we're really down to the last 1-3 bugs that are going to actually hold the release, I think we're at the point where we should minus this. Marking as such. If people disagree and think we should hold the release for this bug, please re-nom and comment.Flags: blocking1.9.1+ → blocking1.9.1-

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=470487#c70)• 16 years ago |
|  | |

(In reply to [comment #68](/show_bug.cgi?id=470487#c68 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> This is marked topcrash - do we know how much of a crasher this is under b4?
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.5b4&platform=windows&date=&range_value=1&range_unit=weeks&query_search=signature&query_type=contains&query=GetParentWindow>
1597 for one week.
If anyone has any ideas on how to pull up a regression range pre the 3.0 release I'd welcome the input. This was present in the first 3.0 release.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=470487#c71)• 16 years ago |
|  | |

(In reply to [comment #69](/show_bug.cgi?id=470487#c69 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> If people disagree and think we should hold the release for this bug,
> please re-nom and comment.
I don't disagree, but I think we should block on this for 1.9.2 and consider backporting it to 1.9.1.x if a fix sticks and is relatively safe.Flags: wanted1.9.1.x?Flags: blocking1.9.2?

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=470487#c72)• 16 years ago |
|  | |

Jim, it's hard without any way of reproducing this crash. All the crash stats have no comments.
Chris, could you check if we have a domain or url where this mostly happens? If you can't we should file an it bug to get the results. We still have the email addresses per crash report if users accept their transmission, right? Could we find some users for those the crash happens regularly?Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=470487#c73)• 16 years ago |
|  | |

looking at the url data it doesn't look to helpful in this case. the distribution of sites and urls to these crash signatures is very wide.
that matches up with the ideas in [comment 67](/show_bug.cgi?id=470487#c67 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?") suggesting these crashes are a result of bad interaction within the chrome and general window management; not with anything content related.
As for examples of this it looks like 760 different sites for just the 1500 some odd nsWindow::GetParentWindow() crashes I'm looking at in a weeks worth of data. The list of top sites looks like:
#crash - domain
78 www.youtube.com
23 mail.google.com
22 www.google.com
21 www.facebook.com
9 www.google.com.vn
8 www.google.fr
8 apps.facebook.com
7 www.orkut.com.br
7 win.mail.ru
7 us.mg2.mail.yahoo.com
6 www.orkut.co.in
6 in.mg50.mail.yahoo.com
5 us.mg1.mail.yahoo.com
5 depositfiles.com
5 addons.mozilla.org
4 www.ynet.co.il
4 www.mininova.org
4 www.microsoft.com
4 www.justin.tv
4 www.google.ro
4 www.google.it
4 www.google.co.id
4 www.gametrailers.com
one user might have even hit the crash on about:config , and others hit it on searches, startpage and just a variety of frequent and common browsing activities.
to drill down on the top of the youtube list it looks like:
Firefox 3.5b4 2 <http://www.youtube.com/watch?v=daTTOyu-E1w&hd=1&feature=hd> nsWindow::GetParentWindow()
Firefox 3.5b4 2 <http://www.youtube.com/watch?v=L5brwhalCG0&feature=PlayList&p=BBCB18EBEEF42EC2&index=0&playnext=1> nsWindow::GetParentWindow()
Firefox 3.5b4 2 <http://www.youtube.com/watch?v=BsAtRKrbB8w> nsWindow::GetParentWindow()
Firefox 3.5b4 2 <http://www.youtube.com/watch?v=wXUMZb7gqdg> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=1DODjKLUMVU> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=UYpxIaAI51M> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=SJvtkCFaKaE> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=PGuhX5AmjuA> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=UuBm0dvIzcc&feature=fvst> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=MYNEYp06EkI> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=kMEFCRbbi0g> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/activesharing_history> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=I8kcnYCHxTk> nsWindow::GetParentWindow()
Firefox 3.5b4 1 <http://www.youtube.com/watch?v=eUm-zvGsgiE> nsWindow::GetParentWindow()
for nsBaseWidget::Destroy stack signature its basically the same thing. Another 625 crash reports in a weeks worth of 3.5b4 data and 457 different domains listed in the urls
40 www.youtube.com
29 mail.google.com
17 www.facebook.com
11 www.google.com
11 apps.facebook.com
5 www.orkut.co.in
5 www.google.com.vn
5 hi5.com
4 www.google.co.in

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=470487#c74)• 16 years ago |
|  | |

I do see a few interesting things that appear to be messing with/reading chrome.
I guess one check would be to look at a bunch of reports to try and figure out if there is a common or set of common addons installed like adblockplus, ietab, or speeddial. There really are not very many of these kinds of reports, but the general question of "does chrome get messed up by an addon or cause timing problems not seen otherwise?" might be an interesting one to try and figure out.
release # crashes url at time of crash -- stack signature
Firefox 3.5b4 1 chrome://adblockplus/content/tip\_subscriptions.xul nsWindow::GetParentWindow()
Firefox 3.5b4 1 chrome://ietab/content/reloaded.html?url=<http://dl.xunlei.com/index.htm?tag=1> nsWindow::GetParentWindow()
Firefox 3.5b4 1 chrome://speeddial/content/speeddial.xul nsWindow::GetParentWindow()
Firefox 3.5b4 1 chrome://wot/locale/loading.html#aHR0cDovL3d3dy50dnZhdWdoYW4uY29tLw%3D%3D nsWindow::GetParentWindow()
Firefox 3.5b4 1 about:sessionrestore nsBaseWidget::Destroy()
Firefox 3.5b4 1 chrome://ietab/content/reloaded.html?url=[http://update.microsoft.com/\*de-ch](http://update.microsoft.com/%2Ade-ch) nsBaseWidget::Destroy()
Firefox 3.5b4 1 chrome://speeddial/content/speeddial.xul nsBaseWidget::Destroy()

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=470487#c75)• 16 years ago |
|  | |

Because it generally seems to be related to plugin destruction, the actual URL may not even be relevant -- for example, it could be caused by destroying a plugin that was on the page you were visiting previously. That would be my guess even, given the high number of google.com and speeddial crashes... then again, there's an about:sessionrestore crash, and that's kinda weird :)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=470487#c76)• 16 years ago |
|  | |

(In reply to [comment #75](/show_bug.cgi?id=470487#c75 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Because it generally seems to be related to plugin destruction, the actual URL
> may not even be relevant -- for example, it could be caused by destroying a
> plugin that was on the page you were visiting previously. That would be my
> guess even, given the high number of google.com and speeddial crashes... then
> again, there's an about:sessionrestore crash, and that's kinda weird :)
Yeah the current url is not assured to be accurate. The dealyed tear down can take some time.
There is an interesting little bit of code in nsStopPluginRunnable's Run that delays tear down due to nesting level of events -
<http://mxr.mozilla.org/mozilla-central/source/layout/generic/nsObjectFrame.cpp#1965>
I've been looking at this recently because in my testing this code never gets used. A possible suspect maybe.

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=470487#c77)• 16 years ago |
|  | |

> there's an about:sessionrestore crash, and that's kinda weird :)
yeah, I've been looking at a bunch of cases where this helps as a semi-reliable way to find reproducable crashers. e.g.
1) user crashes on a page
2) sesssion restore kicks in and user selects to load the pages from previous crashes
3) page(s) load and the crash happens again
this case pokes holes in that theory as being fully reliable. I'm guessing the session restore isn't initiating any plugin page teardowns.
I'm getting time of crash, time since last crash, and uptime (time between startup and crash) and that will help to understand and connect these about:sessionrestore crashes to other events on a given users PC a bit better.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=470487#c78)• 16 years ago |
|  | |

I am getting some really crazy stuff going on, including what looked like this crash, by triggering the code in [bug 389931](/show_bug.cgi?id=389931 "VERIFIED FIXED - Can't use menus in other windows while native filepicker is open"). I'm also seeing a lot of slow script warnings, assertions in /mozilla/docshell/shistory/src/nsshentry.cpp's nsSHEntry::AddChild, assertions in the plugin code, hung instances, and plugins that hang around in memory and keep playing.
Steps to reproduce:
1) open two windows
2) in the second window, browse to a page and hit ctrl-s
3) leave the modal file chooser open and switch back to the first window
4) browse around to sites with plugins like youtube & yahoo, use multiple tabs, close tabs, etc.
5) try switching back and forth between the two windows occasionally.
All kinds of interesting things happen.
Script: chrome://global/content/bindings/general.xml:0
Script: chrome://browser/content/browser.js:3552
Script: chrome://global/content/bindings/general.xml:0
&&
WARNING: NS\_ENSURE\_TRUE(doc) failed: file f:/Mozilla/firefox/470487/mozilla/modules/plugin/base/src/nsNPAPIPlugin.cpp, line 1179
WARNING: NS\_ENSURE\_TRUE(cx) failed: file f:/Mozilla/firefox/470487/mozilla/modules/plugin/base/src/nsNPAPIPlugin.cpp, line 1192
WARNING: NS\_ENSURE\_TRUE(doc) failed: file f:/Mozilla/firefox/470487/mozilla/modules/plugin/base/src/nsNPAPIPlugin.cpp, line 1499
are common.
I can't say for sure that this is the cause of this crash. I did see a couple crashes in nswindow's destroy code, but it wasn't in the same place. It was however at points where nswindow was accessing member variables in the base widget.
I can address most of this (except the slow script warnings) by simply commenting out the timer code block in nsObjectFrame's nsStopPluginRunnable::Run(), so that plugins destroy when they are initially asked to. Maybe QA can lend a hand in getting some reproducible cases, so much is going on here I'm not sure where all of it is coming from.
This is all on a trunk build.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=470487#c79)• 16 years ago |
|  | |

The patch in [bug 389931](/show_bug.cgi?id=389931 "VERIFIED FIXED - Can't use menus in other windows while native filepicker is open") looks to have landed in Fx 3.0, beta 3, so that would put it in the right time frame for when this crash started showing up.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=470487#c80)• 16 years ago |
|  | |

I've successfully reproduced a crash in beta 4 (no stack dump though) following the above steps. The browser re-opened both windows and reloaded the same content, which might explain some of the crash reports we've seen.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a12936672_279663)• 16 years ago |

Flags: blocking1.9.1- → blocking1.9.1?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 81](/show_bug.cgi?id=470487#c81)• 16 years ago |
|  | |

[Bug 420886](/show_bug.cgi?id=420886 "RESOLVED FIXED - Crash when reloading page with RealPlayer plugin that has modal child window") is where the delayed tear down code for plugins landed. Apparently it addressed a crash bug in realplayer post the landing of [bug 389931](/show_bug.cgi?id=389931 "VERIFIED FIXED - Can't use menus in other windows while native filepicker is open").

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 82](/show_bug.cgi?id=470487#c82)• 16 years ago |
|  | |

[Bug 422926](/show_bug.cgi?id=422926 "RESOLVED FIXED - MSNBC Videos won't play") may also be related.

|  | [Vladimir Vukicevic [:vlad] [:vladv] (needinfo me, slow to respond)](/user_profile?user_id=24534) |  |
| --- | --- | --- |
| [Comment 83](/show_bug.cgi?id=470487#c83)• 16 years ago |
|  | |

Given Jim's data, I'd like to see this go back on the 1.9.1 blocking list -- I think we've got a potential can of worms here.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 84](/show_bug.cgi?id=470487#c84)• 16 years ago |
|  | |

Filed [bug 493578](/show_bug.cgi?id=493578 "RESOLVED WORKSFORME - \"slow script\"/unresponsive script warning in main browser with file dialog open") on the slow script warnings, they are unrelated to this.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 85](/show_bug.cgi?id=470487#c85)• 16 years ago |
|  | |

(In reply to [comment #81](/show_bug.cgi?id=470487#c81 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> [Bug 420886](/show_bug.cgi?id=420886 "RESOLVED FIXED - Crash when reloading page with RealPlayer plugin that has modal child window") is where the delayed tear down code for plugins landed. Apparently
> it addressed a crash bug in realplayer post the landing of [bug 389931](/show_bug.cgi?id=389931 "VERIFIED FIXED - Can't use menus in other windows while native filepicker is open").
A general observation - the code in [bug 420886](/show_bug.cgi?id=420886 "RESOLVED FIXED - Crash when reloading page with RealPlayer plugin that has modal child window") seems to be compensating for a bug in real player. In nsPluginInstanceOwner's PrepareToStop, we hide the window, disable it, and then during destruction the realplayer window receives wm\_destroy, at which point it should destroy any modal windows. Maybe the right thing to do here is to pull the patch in 420886, and get with real to work on a fix. We seem to be jumping through a lot of hoops and destablizing our own code in other ways to compensate for a an issue in realplayer.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 86](/show_bug.cgi?id=470487#c86)• 16 years ago |
|  | |

Moving the blocking request to [bug 493601](/show_bug.cgi?id=493601 "VERIFIED FIXED - Investigate crash involving Flash module unloading").Flags: blocking1.9.1?

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 87](/show_bug.cgi?id=470487#c87)• 16 years ago |
|  | |

Comment on [attachment 373373](/attachment.cgi?id=373373 "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[details]](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[diff]](/attachment.cgi?id=373373&action=diff "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=373373)
[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3
a191=beltzner
[Attachment #373373](/attachment.cgi?id=373373&action=edit "[m-c checkin: a7b2a881595a] getparent / destroy variable cleanup v.3") -
Flags: approval1.9.1? → approval1.9.1+

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 88](/show_bug.cgi?id=470487#c88)• 16 years ago |
|  | |

re: [comment 85](/show_bug.cgi?id=470487#c85 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?")
kev / jst/ josh, do we have any recent contacts at real that we could open up that discussion.

|  | [Kev Needham [:kev]](/user_profile?user_id=64714) |  |
| --- | --- | --- |
| [Comment 89](/show_bug.cgi?id=470487#c89)• 16 years ago |
|  | |

I'll ping a couple people I know there and see if we can get the RP team engaged.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 90](/show_bug.cgi?id=470487#c90)• 16 years ago |
|  | |

Attached patch

[[1.9.1 checkin: 46b703c76f3a] getparent / variable shadowing patch](attachment.cgi?id=378454&action=diff)
— [Details](attachment.cgi?id=378454&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=378454)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 91](/show_bug.cgi?id=470487#c91)• 16 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/46b703c76f3a>Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 92](/show_bug.cgi?id=470487#c92)• 16 years ago |
|  | |

<http://tinyurl.com/nds6x8> shows the current crashes for the Firefox 3.5 release. With 3058 crashes it is currently the #4 topcrash, so it doesn't appear the patch fixed the issue for 1.9.1.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a16757548_190622)• 16 years ago |

Summary: Firefox Crash [@ nsWindow::GetParentWindow() ] & [@ nsBaseWidget::Destroy()]? → Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 93](/show_bug.cgi?id=470487#c93)• 16 years ago |
|  | |

Might be interesting to look at mozilla-central in a few days with [bug 500925](/show_bug.cgi?id=500925 "RESOLVED FIXED - don't unload plugins as soon as possible by default") landing today.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 94](/show_bug.cgi?id=470487#c94)• 16 years ago |
|  | |

(In reply to [comment #93](/show_bug.cgi?id=470487#c93 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Might be interesting to look at mozilla-central in a few days with [bug 500925](/show_bug.cgi?id=500925 "RESOLVED FIXED - don't unload plugins as soon as possible by default")
> landing today.
My guess is that won't help much as this is a widget tear down issue. In general I guess this is still a top issue and needs to be addressed sooner rather than later. Now that the nswindow refactoring is complete, I'll look at this again.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 95](/show_bug.cgi?id=470487#c95)• 16 years ago |
|  | |

Jim: Is it possible this is fixed in [bug 493601](/show_bug.cgi?id=493601 "VERIFIED FIXED - Investigate crash involving Flash module unloading")? If so, it's likely that this will be fixed in 1.9.1 later.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 96](/show_bug.cgi?id=470487#c96)• 16 years ago |
|  | |

(In reply to [comment #95](/show_bug.cgi?id=470487#c95 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Jim: Is it possible this is fixed in [bug 493601](/show_bug.cgi?id=493601 "VERIFIED FIXED - Investigate crash involving Flash module unloading")? If so, it's likely that this
> will be fixed in 1.9.1 later.
Doesn't look like it as it's still showing up on 3.6a1pre -
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.6a1pre&platform=windows&date=&range_value=1&range_unit=weeks&query_search=signature&query_type=contains&query=GetParentWindow>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 97](/show_bug.cgi?id=470487#c97)• 16 years ago |
|  | |

Seems like we have more signatures now -
xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1668
xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1634
xul.dll nsBaseWidget::SetZIndex widget/src/xpwidgets/nsBaseWidget.cpp:385
xul.dll xul.dll@0x2a44f9
xul.dll nsIView::CreateWidget view/src/nsView.cpp:699
xul.dll nsMenuPopupFrame::CreateWidgetForView layout/xul/base/src/nsMenuPopupFrame.cpp:280
xul.dll xul.dll@0x320c70
--
xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1668
xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1634
xul.dll nsBaseWidget::SetZIndex widget/src/xpwidgets/nsBaseWidget.cpp:385
xul.dll xul.dll@0x2a44f9
xul.dll nsIView::CreateWidget view/src/nsView.cpp:699
xul.dll nsMenuPopupFrame::CreateWidgetForView layout/xul/base/src/nsMenuPopupFrame.cpp:280
xul.dll nsMenuPopupFrame::EnsureWidget layout/xul/base/src/nsMenuPopupFrame.cpp:230
xul.dll nsMenuPopupFrame::InitializePopup layout/xul/base/src/nsMenuPopupFrame.cpp:497
xul.dll nsXULPopupManager::ShowPopup layout/xul/base/src/nsXULPopupManager.cpp:454
The DoStopPlugin one though is still the most common. We might have two bugs here, one on Destroy and another on CreateWidget.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 98](/show_bug.cgi?id=470487#c98)• 16 years ago |
|  | |

The CreateWidget crash is also on trunk -
<http://crash-stats.mozilla.com/report/index/d4431975-aee4-44e4-bcac-f1f3c2090629>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 99](/show_bug.cgi?id=470487#c99)• 16 years ago |
|  | |

Attached patch

[[m-c checkin: da42cf530fa7] teardown refactor v.1](attachment.cgi?id=387214&action=diff)
— [Details](attachment.cgi?id=387214&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=387214)

This is a refactor of the tear down code in nsWindow. I’d welcome comments. I’ve paired Destroy() down to simply calling DestroyWindow, and rely on the WM\_DESTROY event handler to do the actual tear down. Within OnDestroy, I’ve reorganized the order things into what I would consider a more proper tear down order.
This may not fix the crash problem, but it should give us a better feel for exactly what’s going on and when. If the crash still occurs in the call to GetParent in nsBaseWidget’s Destroy(), my guess would be that we could eliminate nsWindow code as being the problem and instead look at the view/plug-in code. The reason I say this is that the plugin code calls SetParent(nsnull) on the widget in nsPluginInstanceOwner’s PrepareToStop, which sets the native parent to null and also removes the window from the parent widget's child list. This (supposedly) happens way before Destroy is called on the window. If a call to GetParent on the final Destroy() call returns a valid Mozilla window handle with a bad |this| pointer, nsWindow’s tear down wouldn’t be the problem AFAICT.
[Attachment #376333](/attachment.cgi?id=376333&action=edit "Properly call Destroy()") -
Attachment is obsolete: true

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a17358059_279663)• 16 years ago |

[Attachment #387214](/attachment.cgi?id=387214&action=edit "[m-c checkin: da42cf530fa7] teardown refactor v.1") -
Flags: review?(neil)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 100](/show_bug.cgi?id=470487#c100)• 16 years ago |
|  | |

Comment on [attachment 387214](/attachment.cgi?id=387214 "[m-c checkin: da42cf530fa7] teardown refactor v.1") [[details]](/attachment.cgi?id=387214&action=edit "[m-c checkin: da42cf530fa7] teardown refactor v.1") [[diff]](/attachment.cgi?id=387214&action=diff "[m-c checkin: da42cf530fa7] teardown refactor v.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=387214)
[m-c checkin: da42cf530fa7] teardown refactor v.1
This passed try fine. I've also been running the try build now for a couple days without problem.
Neil, would you be a good reviewer for something like this?

|  | [Chris Ilias [:cilias]](/user_profile?user_id=61172) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a17524251_61172)• 16 years ago |

Blocks: [503561](/show_bug.cgi?id=503561 "VERIFIED FIXED - KB Article: Crash signature - nsWindow::GetParentWindow(int)")

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a17673995_14006)• 16 years ago |

[Attachment #387214](/attachment.cgi?id=387214&action=edit "[m-c checkin: da42cf530fa7] teardown refactor v.1") -
Flags: review?(neil) → review+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a17774386_279663)• 16 years ago |

[Attachment #387214](/attachment.cgi?id=387214&action=edit "[m-c checkin: da42cf530fa7] teardown refactor v.1") -
Attachment description: teardown refactor v.1 → [m-c checkin: da42cf530fa7] teardown refactor v.1

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 101](/show_bug.cgi?id=470487#c101)• 16 years ago |
|  | |

So, what's the status on this crash?
Currently it's the top crasher for 3.5.1 on Windows
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.5.1&platform=windows&date=&range_value=1&range_unit=weeks&query_search=signature&query_type=exact&query>=

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 102](/show_bug.cgi?id=470487#c102)• 16 years ago |
|  | |

(In reply to [comment #101](/show_bug.cgi?id=470487#c101 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> So, what's the status on this crash?
>
> Currently it's the top crasher for 3.5.1 on Windows
>
> <http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.5.1&platform=windows&date=&range_value=1&range_unit=weeks&query_search=signature&query_type=exact&query>=
<http://crash-stats.mozilla.com/query/query?do_query=1&product=Firefox&version=Firefox%3A3.5.1>

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 103](/show_bug.cgi?id=470487#c103)• 16 years ago |
|  | |

Too early to tell, it has to bake on trunk for a bit.
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.6a1pre&platform=windows&query_search=signature&query_type=contains&query=GetParentWindow&date=&range_value=1&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28int%29>

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 104](/show_bug.cgi?id=470487#c104)• 16 years ago |
|  | |

did this land on the branch?Group: core-securityKeywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a18225517_1689)• 16 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 105](/show_bug.cgi?id=470487#c105)• 16 years ago |
|  | |

(In reply to [comment #104](/show_bug.cgi?id=470487#c104 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> did this land on the branch?
We could do that if it looks like the patch actually addressed the issue. It would require a little back porting since we refactored nswindow on trunk.
I'd like to let this sit on trunk for a while (maybe 2 or 3 weeks) to test to see if it actually fixed the problem. So far we're about 5 days out from the landing and there hasn't been an occurrence in nightlies - not enough time to confirm IMHO.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 106](/show_bug.cgi?id=470487#c106)• 16 years ago |
|  | |

For reference, the patch landed on July 13th -
<http://hg.mozilla.org/mozilla-central/rev/da42cf530fa7>
Crash stats -
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.6a1pre&platform=windows&query_search=signature&query_type=contains&query=GetParentWindow&date=&range_value=2&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28int%29>
The last DoStopPlugin crash was in a build from the 12th. We had a crash in GetParentWindow from a build on the 13th, but that was in CreateWidget, which might be something else. Hard to say at this point if the problem is fixed.

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 107](/show_bug.cgi?id=470487#c107)• 16 years ago |
|  | |

I see. you have two bugs in one here. that's why beltzner marked it fixed1.9.1

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a18304075_1689)• 16 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a18555102_7044)• 16 years ago |

Flags: blocking1.9.2? → blocking1.9.2+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 108](/show_bug.cgi?id=470487#c108)• 16 years ago |
|  | |

on trunk!
I'll get a 1.9.1 patch put together.Status: NEW → RESOLVEDClosed: 16 years agoResolution: --- → FIXED

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 109](/show_bug.cgi?id=470487#c109)• 16 years ago |
|  | |

Attached patch

[teardown refactor 1.9.1 v.1](attachment.cgi?id=390333&action=diff) (obsolete)
— [Details](attachment.cgi?id=390333&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=390333)

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a18660388_279663)• 16 years ago |

Blocks: [506108](/show_bug.cgi?id=506108 "RESOLVED WORKSFORME - Firefox Crash in [@ nsWindow::GetParentWindow(int)] called from nsIView::CreateWidget")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 110](/show_bug.cgi?id=470487#c110)• 16 years ago |
|  | |

This is definitely fixed on trunk.
<http://crash-stats.mozilla.com/report/list?product=Firefox&version=Firefox%3A3.6a1pre&platform=windows&query_search=signature&query_type=contains&query=GetParentWindow&date=&range_value=2&range_unit=weeks&do_query=1&signature=nsWindow%3A%3AGetParentWindow%28int%29>
Posted a 1.9.1 patch to try, if all goes well after a little testing, we should be good for a 1.9.1.3 release. [Bug 506108](/show_bug.cgi?id=506108 "RESOLVED WORKSFORME - Firefox Crash in [@ nsWindow::GetParentWindow(int)] called from nsIView::CreateWidget") is filed on the CreateWidget crash.
We could also back port this pretty easily to 3.0 if somebody thinks it's needed.

|  | [chris hofmann](/user_profile?user_id=2687)  Reporter |  |
| --- | --- | --- |
| [Comment 111](/show_bug.cgi?id=470487#c111)• 15 years ago |
|  | |

looking at crash reports from yesterday I still see this signature on 3.5.2
494 total crashes for nsWindow::GetParentWindow(int) on 20090817
distribution of versions where the crash was found on 20090817-crashdata.csv
430 Firefox 3.5.2
44 Firefox 3.5
20 Firefox 3.5.1
but nothing for 3.0.x
does that match up with the places the patch has landed and/or needs to land?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 112](/show_bug.cgi?id=470487#c112)• 15 years ago |
|  | |

chofmann: This was initially filed with the signature of nsWindow::GetParentWindow() and changed to be nsWindow::GetParentWindow(int) with an additional nsBaseWidget::Destroy() signature. While the "int" version of the first signature does not show on 1.9.0, the non-int version is still present, ranked #31 with the nsBaseWidget signature ranked at #73.
The above is consistent with this patch having not landed on 1.9.1 or 1.9.0.Flags: wanted1.9.1.x?

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 113](/show_bug.cgi?id=470487#c113)• 15 years ago |
|  | |

Verified fixed on trunk based on crash stats.Status: RESOLVED → VERIFIEDKeywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)Target Milestone: --- → mozilla1.9.2a1

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 114](/show_bug.cgi?id=470487#c114)• 15 years ago |
|  | |

(In reply to [comment #111](/show_bug.cgi?id=470487#c111 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> looking at crash reports from yesterday I still see this signature on 3.5.2
>
> 494 total crashes for nsWindow::GetParentWindow(int) on 20090817
>
> distribution of versions where the crash was found on 20090817-crashdata.csv
> 430 Firefox 3.5.2
> 44 Firefox 3.5
> 20 Firefox 3.5.1
>
> but nothing for 3.0.x
>
> does that match up with the places the patch has landed and/or needs to land?
That's correct. 3.6 is what you want to look at to see if it's fixed. A 3.5.x patch hasn't landed because the original 3.6 patch back ported to 3.5 caused leaks in component manager that I was never able to track down.

|  | [Mike Shaver (:shaver emeritus)](/user_profile?user_id=422) |  |
| --- | --- | --- |
| [Comment 115](/show_bug.cgi?id=470487#c115)• 15 years ago |
|  | |

What do you mean "never able to track down"? Are you no longer working on this? It's one of our major crashes, so if you need help with it please do ask for it.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 116](/show_bug.cgi?id=470487#c116)• 15 years ago |
|  | |

(In reply to [comment #115](/show_bug.cgi?id=470487#c115 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> What do you mean "never able to track down"? Are you no longer working on
> this? It's one of our major crashes, so if you need help with it please do ask
> for it.
These are the leaks that I can reliably reproduce on the unit test box:
TEST-UNEXPECTED-FAIL | runtests-leaks | leaked 484 bytes during test execution
TEST-UNEXPECTED-FAIL | runtests-leaks | leaked 1 instance of nsComponentManagerImpl with size 276 bytes
TEST-UNEXPECTED-FAIL | runtests-leaks | leaked 2 instances of nsLocalFile with size 88 bytes each (176 bytes total)
TEST-UNEXPECTED-FAIL | runtests-leaks | leaked 3 instances of nsStringBuffer with size 8 bytes each (24 bytes total)
TEST-UNEXPECTED-FAIL | runtests-leaks | leaked 2 instances of nsTArray\_base with size 4 bytes each (8 bytes total)
<http://tinderbox.mozilla.org/showlog.cgi?log=MozillaTry/1250700153.1250706746.27537.gz&fulltext=1#err7>
Why a slight re-org of the window destruction code causes this is a mystery. I've poked around in component manager looking for an answer but haven't turned anything up. If anyone has any suggestions on how to better track this down I'd welcome the input. I'll post the current rev of the patch here in a sec.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 117](/show_bug.cgi?id=470487#c117)• 15 years ago |
|  | |

Attached patch

[teardown refactor 1.9.1 v.3](attachment.cgi?id=395363&action=diff)
— [Details](attachment.cgi?id=395363&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=395363)

[Attachment #390333](/attachment.cgi?id=390333&action=edit "teardown refactor 1.9.1 v.1") -
Attachment is obsolete: true

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 118](/show_bug.cgi?id=470487#c118)• 15 years ago |
|  | |

Mass change: adding fixed1.9.2 keyword
(This bug was identified as a mozilla1.9.2 blocker which was fixed before the mozilla-1.9.2 repository was branched (August 13th, 2009) as per this query: <http://is.gd/2ydcb> - if this bug is not actually fixed on mozilla1.9.2, please remove the keyword. Apologies for the bugspam)Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---)

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a21497836_76551)• 15 years ago |

Keywords: [fixed1.9.2](/buglist.cgi?keywords=fixed1.9.2&resolution=---) → [verified1.9.2](/buglist.cgi?keywords=verified1.9.2&resolution=---)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a22187392_190622)• 15 years ago |

[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Tim Riley [:timr]](/user_profile?user_id=222474) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a24454499_222474)• 15 years ago |

Assignee: jmathies → jst

|  | [Mike Shaver (:shaver emeritus)](/user_profile?user_id=422) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a24455811_422)• 15 years ago |

blocking1.9.1: --- → ?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 119](/show_bug.cgi?id=470487#c119)• 15 years ago |
|  | |

Are the leaks that bad? If this fixes the topcrash it might be worth it.blocking1.9.1: ? → needed

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 120](/show_bug.cgi?id=470487#c120)• 15 years ago |
|  | |

(In reply to [comment #119](/show_bug.cgi?id=470487#c119 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Are the leaks that bad? If this fixes the topcrash it might be worth it.
They caused leak check test failures on try.
FWIW, I can revisit this next week after the freeze.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 121](/show_bug.cgi?id=470487#c121)• 15 years ago |
|  | |

So that leak output is basically leaking the component manager; everything else that's leaked is members of the component manager: mRegistryFile and mComponentsDir for the nsIFiles, mLoaderData and mPendingServices for the nsTArray\_bases; I'd guess the strings are from mLoaderData (though not sure why it only has 3 entries).
Is it possible that this patch effectively changes the timing of things somehow so that we end up executing code after the component manager has been shut down (via nsComponentManagerImpl::Shutdown) and somehow reinstantiates the component manager? Or something like that....

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 122](/show_bug.cgi?id=470487#c122)• 15 years ago |
|  | |

If this is what people were looking at, it's a different bug:
<http://crash-stats.mozilla.com/query/query?product=Firefox&version=Firefox%3A3.7a1pre&platform=windows&date=&range_value=3&range_unit=weeks&query_search=signature&query_type=contains&query=GetParentWindow&do_query=1>#
0 xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1062
1 xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1024
2 xul.dll GetWidgetOffset layout/base/nsLayoutUtils.cpp:833
3 xul.dll nsLayoutUtils::TranslateWidgetToView layout/base/nsLayoutUtils.cpp:854
4 xul.dll nsLayoutUtils::GetEventCoordinatesRelativeTo layout/base/nsLayoutUtils.cpp:674
5 xul.dll PresShell::HandleEvent layout/base/nsPresShell.cpp:6188
6 xul.dll nsViewManager::HandleEvent view/src/nsViewManager.cpp:1202
7 xul.dll nsViewManager::DispatchEvent view/src/nsViewManager.cpp:1181
8 xul.dll HandleEvent view/src/nsView.cpp:167
9 xul.dll nsWindow::DispatchEvent widget/src/windows/nsWindow.cpp:2763
10 xul.dll nsWindow::DispatchWindowEvent widget/src/windows/nsWindow.cpp:2786
11 xul.dll nsWindow::DispatchMouseEvent widget/src/windows/nsWindow.cpp:3161
12 xul.dll ChildWindow::DispatchMouseEvent

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 123](/show_bug.cgi?id=470487#c123)• 15 years ago |
|  | |

As long as we don't have a testcase or steps how to reproduce this crash there will be no way to run a regression test. Clearing flag for now.Keywords: [regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 124](/show_bug.cgi?id=470487#c124)• 15 years ago |
|  | |

We're going mark this as blocking 1.9.1.5. We'd like to get it in sooner rather than later, however, I'd like a second review on this. Technically security bugs need a superreview, but I'm explicitly asking for a second review (superreview or not) to get a better sanity check on the code since we haven't yet shipped this code in a release.
Jim or Vlad: Is there a Windows person that would be good for a second review here?blocking1.9.1: needed → .5+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 125](/show_bug.cgi?id=470487#c125)• 15 years ago |
|  | |

(In reply to [comment #124](/show_bug.cgi?id=470487#c124 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> We're going mark this as blocking 1.9.1.5. We'd like to get it in sooner rather
> than later, however, I'd like a second review on this. Technically security
> bugs need a superreview, but I'm explicitly asking for a second review
> (superreview or not) to get a better sanity check on the code since we haven't
> yet shipped this code in a release.
>
> Jim or Vlad: Is there a Windows person that would be good for a second review
> here?
rob arnold, neil rashbrook, and doug turner come to mind. we still have the leaks to deal with though, so this isn't ready to be reviewed/land on 1.9.1.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 126](/show_bug.cgi?id=470487#c126)• 15 years ago |
|  | |

Jim, can you fix those leaks? Per our discussion earlier today, crashes are our top priority right now.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 127](/show_bug.cgi?id=470487#c127)• 15 years ago |
|  | |

(In reply to [comment #126](/show_bug.cgi?id=470487#c126 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Jim, can you fix those leaks? Per our discussion earlier today, crashes are
> our top priority right now.
I can certainly try. Will look into what bz thought might be the cause ([comment 121](/show_bug.cgi?id=470487#c121 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?")).

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 128](/show_bug.cgi?id=470487#c128)• 15 years ago |
|  | |

(In reply to [comment #127](/show_bug.cgi?id=470487#c127 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> (In reply to [comment #126](/show_bug.cgi?id=470487#c126 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> > Jim, can you fix those leaks? Per our discussion earlier today, crashes are
> > our top priority right now.
>
> I can certainly try. Will look into what bz thought might be the cause (comment
> 121).
Things haven't changed much since the last time I worked on this. These leaks only show up on try server - reproducing them on an XP vmware image with both debug and release builds doesn't work.
I guess I'll try playing around with a winnt 5.2 unit test image next. If I can reproduce this on something other than try server where I have more control, I might be able to find something.
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 484 bytes during test execution
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsComponentManagerImpl with size 276 bytes
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of nsLocalFile with size 88 bytes each (176 bytes total)
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 3 instances of nsStringBuffer with size 8 bytes each (24 bytes total)
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of nsTArray\_base with size 4 bytes each (8 bytes total)
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 484 bytes during test execution
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 1 instance of nsComponentManagerImpl with size 276 bytes
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of nsLocalFile with size 88 bytes each (176 bytes total)
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 3 instances of nsStringBuffer with size 8 bytes each (24 bytes total)
TEST-UNEXPECTED-FAIL | automationutils.processLeakLog() | leaked 2 instances of nsTArray\_base with size 4 bytes each (8 bytes total)
<http://tinderbox.mozilla.org/showlog.cgi?log=MozillaTry/1255636233.1255645227.4871.gz&fulltext=1#err12>

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 129](/show_bug.cgi?id=470487#c129)• 15 years ago |
|  | |

Reassigning to Jim since he's investigating here...Assignee: jst → jmathies

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a26254110_279663)• 15 years ago |

Depends on: [523186](/show_bug.cgi?id=523186 "RESOLVED FIXED - Request for a test image access")

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a26430631_269330)• 15 years ago |

Whiteboard: [crashkill]

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 130](/show_bug.cgi?id=470487#c130)• 15 years ago |
|  | |

After getting access to a try server slave, I found the crashtest leaks corresponded to two tests involving applets -
layout/base/crashtests/265986-1.html
parser/htmlparser/tests/crashtests/328751-1.html
Disabling those two tests addresses the crashtest leak problem.
Will try to track down the mochitest-plain leaks, they probably related to applets as well.
Another interesting note - disabling one test and leaving the other results in the same number of leaked bytes.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 131](/show_bug.cgi?id=470487#c131)• 15 years ago |
|  | |

The other tests for mochitest-plain all tie to some html validation tests that make use of a java applet:
<http://mxr.mozilla.org/mozilla-central/source/dom/tests/mochitest/dom-level2-html/>
<http://mxr.mozilla.org/mozilla-central/source/dom/tests/mochitest/dom-level2-html/files/>
test\_HTMLBodyElement07.html \
test\_HTMLBodyElement08.html \
test\_HTMLBodyElement09.html \
test\_HTMLBodyElement10.html \
test\_HTMLBodyElement11.html \
test\_HTMLBodyElement12.html \
test\_HTMLDocument01.html \
test\_HTMLDocument02.html \
test\_HTMLDocument03.html \
test\_HTMLDocument04.html \
test\_HTMLDocument05.html \
test\_HTMLDocument07.html \
test\_HTMLDocument08.html \
test\_HTMLDocument09.html \
test\_HTMLDocument10.html \
test\_HTMLDocument11.html \
test\_HTMLDocument13.html \
test\_HTMLDocument14.html \
test\_HTMLDocument15.html \
test\_HTMLDocument16.html \
test\_HTMLDocument17.html \
test\_HTMLDocument18.html \
test\_HTMLDocument19.html \
test\_HTMLDocument20.html \
test\_HTMLDocument21.html \
test\_HTMLDocument22.html \
test\_HTMLDocument23.html \
test\_HTMLDocument24.html \
test\_HTMLDocument25.html \
test\_HTMLDocument26.html \
test\_HTMLDocument27.html \
I'm guessing we probably don't want to disable these on 1.9.1.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 132](/show_bug.cgi?id=470487#c132)• 15 years ago |
|  | |

What's next here? Let's get this done.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 133](/show_bug.cgi?id=470487#c133)• 15 years ago |
|  | |

Ah, nevermind. I see it now.

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a27463650_269330)• 15 years ago |

Whiteboard: [crashkill] → [crashkill][crashkill-fix]

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 134](/show_bug.cgi?id=470487#c134)• 15 years ago |
|  | |

(In reply to [comment #132](/show_bug.cgi?id=470487#c132 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> What's next here? Let's get this done.
Next step would be to make a decision on how to handle these leaks. We can disable the tests (which allows this to pass try cleanly) or we can spend some additional time looking for a fix to the applet problem.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 135](/show_bug.cgi?id=470487#c135)• 15 years ago |
|  | |

I don't think we should disable the tests, but I'm willing to live with the leaks. Can we change our expected leak value to accomodate these new leaks? We'd really like to get this in 1.9.1.6 which code freezes on November 10 at 11:59pm.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 136](/show_bug.cgi?id=470487#c136)• 15 years ago |
|  | |

(In reply to [comment #135](/show_bug.cgi?id=470487#c135 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> I don't think we should disable the tests, but I'm willing to live with the
> leaks. Can we change our expected leak value to accomodate these new leaks?
> We'd really like to get this in 1.9.1.6 which code freezes on November 10 at
> 11:59pm.
Who would make that call? Any pointers on how we would change tolerated leak values? I can work up a patch and request approval on it.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 137](/show_bug.cgi?id=470487#c137)• 15 years ago |
|  | |

I just made that call. :)
I don't know how to change the tolerate leak values, unfortunately. Hopefully someone else can help with that.

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 138](/show_bug.cgi?id=470487#c138)• 15 years ago |
|  | |

Just fix the leaks.

|  | [Mike Shaver (:shaver emeritus)](/user_profile?user_id=422) |  |
| --- | --- | --- |
| [Comment 139](/show_bug.cgi?id=470487#c139)• 15 years ago |
|  | |

I also don't understand why we're so stumped by the leaks here -- what's the interaction that's changed? What have we looked at or tried? A lot of different tests leak, so it seems like we should be able to track the lifecycle of the relevant objects without too much hassle. It's not like we allocate the component manager very often in the normal course of things!

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 140](/show_bug.cgi?id=470487#c140)• 15 years ago |
|  | |

Has anyone else tried reproducing the crashtest leaks? I still can't, and I've even recently upgraded my system. If not I guess I can allocate a try slave again and see if I can get a debug build going on it.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 141](/show_bug.cgi?id=470487#c141)• 15 years ago |
|  | |

(In reply to [comment #140](/show_bug.cgi?id=470487#c140 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> Has anyone else tried reproducing the crashtest leaks? I still can't, and I've
> even recently upgraded my system. If not I guess I can allocate a try slave
> again and see if I can get a debug build going on it.
Never mind! After installing the latest java run time, I'm able to reproduce them!

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 142](/show_bug.cgi?id=470487#c142)• 15 years ago |
|  | |

Attached file
[java refs](attachment.cgi?id=411102)
— [Details](attachment.cgi?id=411102&action=edit)

This appears to be the root of the problem. I can't find corresponding releases for two AddRef's from the java plugin, and on shutdown the component manager asserts with a left over refcount of 2.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 143](/show_bug.cgi?id=470487#c143)• 15 years ago |
|  | |

FWIW, I can reproduce this on 1.9.1, w/Java(TM) Platform SE 6 U17, without the tear down patch applied. Trunk builds don't exhibit the problem.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 144](/show_bug.cgi?id=470487#c144)• 15 years ago |
|  | |

So... code freeze for 1.9.1.6 is tonight (6.5 hours). While I'm all for getting leaks fixed, this is a leak on shutdown when using Java. It's not a huge issue and it only happens on 1.9.1. The trade off of stability vs leaking on shutdown is pretty clear to me (stability wins!).
I don't think we should push off landing this patch longer than 1.9.1.6. The chances are 1.9.1.7 won't be until early February.
Jim, other than the leaks, is [attachment 395363](/attachment.cgi?id=395363 "teardown refactor 1.9.1 v.3") [[details]](/attachment.cgi?id=395363&action=edit "teardown refactor 1.9.1 v.3") [[diff]](/attachment.cgi?id=395363&action=diff "teardown refactor 1.9.1 v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=395363) ready for the 1.9.1 branch?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 145](/show_bug.cgi?id=470487#c145)• 15 years ago |
|  | |

I fully agree with Sam here, let's take this, the leaks mean nothing compared to the stability gains we're hoping to get out of this fix!

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 146](/show_bug.cgi?id=470487#c146)• 15 years ago |
|  | |

(In reply to [comment #144](/show_bug.cgi?id=470487#c144 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> So... code freeze for 1.9.1.6 is tonight (6.5 hours). While I'm all for getting
> leaks fixed, this is a leak on shutdown when using Java. It's not a huge issue
> and it only happens on 1.9.1. The trade off of stability vs leaking on shutdown
> is pretty clear to me (stability wins!).
>
> I don't think we should push off landing this patch longer than 1.9.1.6. The
> chances are 1.9.1.7 won't be until early February.
>
> Jim, other than the leaks, is [attachment 395363](/attachment.cgi?id=395363 "teardown refactor 1.9.1 v.3") [[details]](/attachment.cgi?id=395363&action=edit "teardown refactor 1.9.1 v.3") [[diff]](/attachment.cgi?id=395363&action=diff "teardown refactor 1.9.1 v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=395363) ready for the 1.9.1 branch?
I can now reproduce this sans my patch, so the java issue is independent, although my patch on 1.9.1 triggers it with try server slave config.
Let me see if the patch if fresh, will post back here in a sec.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 147](/show_bug.cgi?id=470487#c147)• 15 years ago |
|  | |

This still applies cleanly.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a28182131_279663)• 15 years ago |

[Attachment #395363](/attachment.cgi?id=395363&action=edit "teardown refactor 1.9.1 v.3") -
Flags: approval1.9.1.6?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 148](/show_bug.cgi?id=470487#c148)• 15 years ago |
|  | |

Comment on [attachment 395363](/attachment.cgi?id=395363 "teardown refactor 1.9.1 v.3") [[details]](/attachment.cgi?id=395363&action=edit "teardown refactor 1.9.1 v.3") [[diff]](/attachment.cgi?id=395363&action=diff "teardown refactor 1.9.1 v.3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=470487&attachment=395363)
teardown refactor 1.9.1 v.3
Approved for 1.9.1.6. a=ss
[Attachment #395363](/attachment.cgi?id=395363&action=edit "teardown refactor 1.9.1 v.3") -
Flags: approval1.9.1.6? → approval1.9.1.6+

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 149](/show_bug.cgi?id=470487#c149)• 15 years ago |
|  | |

This landed tonight:
<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/3d0b0cfd9644>
The java leaks were apparently known. We have leak threshold values related to java set on 1.9.1 that aren't currently set on try, which is why this problem manifested on test runs. (hat tip to nthomas for helping track this down.)
Related bugs: [bug 471647](/show_bug.cgi?id=471647 "RESOLVED FIXED - Some of the dom-level2-html tests trigger a 484 bytes leak, with Java SE 6 Update 1x NPAPI-based plugin"), and [bug 495533](/show_bug.cgi?id=495533 "RESOLVED FIXED - upgrade Windows reference platform to include Java SE 6 Update 14").

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a28184627_279663)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.6-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.6-fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a28949209_1689)• 15 years ago |

Whiteboard: [crashkill][crashkill-fix] → [sg:critical?][crashkill][crashkill-fix]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 150](/show_bug.cgi?id=470487#c150)• 15 years ago |
|  | |

Henrik, you marked this verified fixed for 1.9.2. How did you verify this? I need to know since I need to verify this for 1.9.1 and I don't see a way to do so based on my reading of the comments.

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 151](/show_bug.cgi?id=470487#c151)• 15 years ago |
|  | |

I did that regarding our crash stats due to a missing testcase.
Jim, it looks like that a similar crash has been returned for 1.9.2. The first frames are identical. Shall we open a new bug on that? See [bp-673ba0da-133f-488d-91ff-2d63b2091120](https://crash-stats.mozilla.org/report/index/673ba0da-133f-488d-91ff-2d63b2091120)
0 xul.dll nsWindow::GetParentWindow widget/src/windows/nsWindow.cpp:1063
1 xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1025
2 xul.dll GetWidgetOffset layout/base/nsLayoutUtils.cpp:839
3 xul.dll nsLayoutUtils::TranslateWidgetToView layout/base/nsLayoutUtils.cpp:860
4 xul.dll nsLayoutUtils::GetEventCoordinatesRelativeTo layout/base/nsLayoutUtils.cpp:680

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 152](/show_bug.cgi?id=470487#c152)• 15 years ago |
|  | |

(In reply to [comment #151](/show_bug.cgi?id=470487#c151 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?"))
> I did that regarding our crash stats due to a missing testcase.
>
> Jim, it looks like that a similar crash has been returned for 1.9.2. The first
> frames are identical. Shall we open a new bug on that? See
> [bp-673ba0da-133f-488d-91ff-2d63b2091120](https://crash-stats.mozilla.org/report/index/673ba0da-133f-488d-91ff-2d63b2091120)
>
> 0 xul.dll nsWindow::GetParentWindow
> widget/src/windows/nsWindow.cpp:1063
> 1 xul.dll nsWindow::GetParent widget/src/windows/nsWindow.cpp:1025
> 2 xul.dll GetWidgetOffset layout/base/nsLayoutUtils.cpp:839
> 3 xul.dll nsLayoutUtils::TranslateWidgetToView
> layout/base/nsLayoutUtils.cpp:860
> 4 xul.dll nsLayoutUtils::GetEventCoordinatesRelativeTo
> layout/base/nsLayoutUtils.cpp:680
Definitely, that's a completely different stack. Looks like it has something to do with scroll.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 153](/show_bug.cgi?id=470487#c153)• 15 years ago |
|  | |

There are a few common crash signatures here mixed in together. One is CreateWidget -
<http://crash-stats.mozilla.com/report/index/bcd92777-df9d-4f36-a7f5-8f0e02091120>
<http://crash-stats.mozilla.com/report/index/ebe43c86-d12d-44dd-affc-bf5ec2091120>
That's likely [bug 506108](/show_bug.cgi?id=506108 "RESOLVED WORKSFORME - Firefox Crash in [@ nsWindow::GetParentWindow(int)] called from nsIView::CreateWidget").
Another has to do with dispatching events -
<http://crash-stats.mozilla.com/report/index/a85d727a-fcc7-46df-aab2-b5b652091120>
We should split out a separate bug for the events crash.

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a29001090_279663)• 15 years ago |

Blocks: [530070](/show_bug.cgi?id=530070 "RESOLVED FIXED - Firefox crashes in [@ nsWindow::GetParentWindow(int)] called from nsLayoutUtils::TranslateWidgetToView")

|  | [Jim Mathies [:jimm]](/user_profile?user_id=279663)  Assignee |  |
| --- | --- | --- |
| [Comment 154](/show_bug.cgi?id=470487#c154)• 15 years ago |
|  | |

Filed [bug 530070](/show_bug.cgi?id=530070 "RESOLVED FIXED - Firefox crashes in [@ nsWindow::GetParentWindow(int)] called from nsLayoutUtils::TranslateWidgetToView").
How do we get bug numbers added to crash stats for specific stacks?

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 155](/show_bug.cgi?id=470487#c155)• 15 years ago |
|  | |

I think the only way we could do that would be to add enough of the top frames to the skiplist in the crash processor so that we can tell the two appart from just the signature of the crash report. In these two cases it seems we would need to add at least nsWindow::GetParentWindow and nsWindow::GetParent, so that the signatures for the two individual crashes would become "nsWindow::GetParentWindow | nsWindow::GetParent | nsBaseWidget::SetZIndex" vs "nsWindow::GetParentWindow | nsWindow::GetParent | GetWidgetOffset". I don't know whether that's a good idea in general, or if it's worth it just for this specific case.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 156](/show_bug.cgi?id=470487#c156)• 15 years ago |
|  | |

This appears to still happen on the 1.9.0 branch (where it's topcrash #32 or so). Would the patch here work for that branch? Do we need a new one? Can't really unhide the bug while it's still happening on that branch.
Does not appear to happen on the 1.8 branch, or at least doesn't appear anywhere in the top-500 crash reports. Tried searching to see if it happened at all but can't get a response from the talkback server.Flags: blocking1.9.0.19?Flags: blocking1.9.0.18?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 157](/show_bug.cgi?id=470487#c157)• 15 years ago |
|  | |

Would love to get this into 3.0.18 but blocking may not be realistic. If the patch applies please request approval ASAP, otherwise we'll block for the next 3.0.x release.Flags: blocking1.9.0.19?Flags: blocking1.9.0.19-Flags: blocking1.9.0.18?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a49519808_1689)• 15 years ago |

Group: core-security

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a78258039_1)• 14 years ago |

Crash Signature: [@ nsWindow::GetParentWindow(int)]
[@ nsBaseWidget::Destroy()]

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=470487#a215295070_75935)• 9 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)
You need to [log in](/show_bug.cgi?id=470487&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jim Mathies [:jimm]](/user_profile?user_id=279663)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_d8c6434d_20250126_060731.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Sat Jan 25 2025 22:07:30 PST

* **Bug ID:**
  495875,
  470487

---

| [ID](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=bug_id%20DESC&query_based_on=) | [Type](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=bug_type%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Summary](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=short_desc%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Product](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=product%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Comp](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=component%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Assignee▲](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=assigned_to%20DESC%2Cbug_status%2Cpriority%2Cbug_id&query_based_on=) | [Status▲](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=bug_status%20DESC%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Resolution](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=resolution%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) | [Updated](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&order=changeddate%2Cbug_status%2Cpriority%2Cassigned_to%2Cbug_id&query_based_on=) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [495875](/show_bug.cgi?id=495875 "RESOLVED FIXED - Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs") |  | [Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs](/show_bug.cgi?id=495875) | Core | Layout | smontagu | RESO | FIXE | 2011-06-13 |
| [470487](/show_bug.cgi?id=470487 "VERIFIED FIXED - Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?") |  | [Firefox Crash [@ nsWindow::GetParentWindow(int)] & [@ nsBaseWidget::Destroy()]?](/show_bug.cgi?id=470487) | Core | Widget: Win32 | jmathies | VERI | FIXE | 2015-10-16 |

2 bugs found.

|  |  | [REST](/rest/bug?include_fields=id,summary,status&bug_id=495875%2C470487 "Query as a REST API request") | [CSV](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&ctype=csv&human=1) | [Feed](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&title=Bug%20List&ctype=atom) | [iCalendar](/buglist.cgi?bug_id=495875%2C470487&query_format=advanced&ctype=ics)  [Change Columns](/colchange.cgi?bug_id=495875%2C470487&query_format=advanced&query_based_on=) | [Edit Search](/query.cgi?bug_id=495875%2C470487&query_format=advanced) |  | as |
| --- | --- | --- | --- | --- | --- |

[File
a new bug
in the "Core" product](/enter_bug.cgi?product=Core)



=== Content from bugzilla.mozilla.org_a696bb10_20250125_045020.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/495875)
* [XML](/show_bug.cgi?ctype=xml&id=495875)

Closed
[Bug 495875](/show_bug.cgi?id=495875)

Opened 16 years ago
Closed 15 years ago

# Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs

## Categories

### (Core :: Layout, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta2-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta2-fixed) |
| blocking1.9.1 | --- | [.6+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.6%2B) |
| status1.9.1 | --- | [.6-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.6-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta2-fixed |
| blocking1.9.1 |  | .6+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .6-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: smontagu)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0e30ca39ed75c9efeb4369d80a83b15a?d=mm&size=40)  [smontagu](/user_profile?user_id=11171)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

7 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [textfuzzer](/show_bug.cgi?id=377438 "RESOLVED FIXED - [meta] Text fuzzer"), [465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame")

Dependency [tree](/showdependencytree.cgi?id=495875&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=495875)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.2](#a12380110_5038 "15 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.2 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.9.0.x](#a12007966_190622 "15 years ago") | - |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.9.0.x | - |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#a23409024_11608 "15 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ BuildTextRunsScanner::BreakSink::SetBreaks ]](https://crash-stats.mozilla.org/signature/?signature=BuildTextRunsScanner%3A%3ABreakSink%3A%3ASetBreaks)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=380929)  [16 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   241 bytes, text/html |  | [Details](/attachment.cgi?id=380929&action=edit) |
| --- | --- | --- |
| [Testcase without bidi](/attachment.cgi?id=405772)  [15 years ago](#c2)  [Simon Montagu :smontagu](/user_profile?user_id=11171)   248 bytes, text/html |  | [Details](/attachment.cgi?id=405772&action=edit) |
| [Patch](/attachment.cgi?id=405854)  [15 years ago](#c4)  [Simon Montagu :smontagu](/user_profile?user_id=11171)   2.55 KB, patch | roc : [review+](#a11492321_5038 "15 years ago")  roc : [superreview+](#a11492321_5038 "15 years ago")  dveditz : [approval1.9.1.6+](#c12 "15 years ago") | [Details](/attachment.cgi?id=405854&action=edit) | [Diff](/attachment.cgi?id=405854&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=495875&attachment=405854) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=495875#c0)• 16 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=380929)
— [Details](attachment.cgi?id=380929&action=edit)

###!!! ASSERTION: Flag set that should never be set! (memory safety error?): '!(mTextRun->GetFlags() & (gfxTextRunWordCache::TEXT\_UNUSED\_FLAGS | nsTextFrameUtils::TEXT\_UNUSED\_FLAG))', file /Users/jruderman/central/layout/generic/nsTextFrameThebes.cpp, line 766
or
Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] touching random a memory location.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a26775_11608)• 16 years ago |

Whiteboard: [sg:critical?]

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=495875#c1)• 16 years ago |
|  | |

Still crashes on mozilla-central.

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=495875#c2)• 15 years ago |
|  | |

Attached file
[Testcase without bidi](attachment.cgi?id=405772)
— [Details](attachment.cgi?id=405772&action=edit)

I can only reproduce the crash in debug builds. It turns out that it doesn't depend on bidi but rather on having multiple text runs in the same line, as this variation on the testcase shows.

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a11383824_11171)• 15 years ago |

OS: Mac OS X → AllHardware: x86 → AllSummary: Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, bidi → Debug-only crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=495875#c3)• 15 years ago |
|  | |

Interestingly, this is debug-only on Linux, but not on OS X.
It's a regression from [bug 465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame"), and I think I have a patch.Assignee: nobody → smontaguBlocks: [465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame")blocking1.9.1: --- → ?Flags: blocking1.9.2?Summary: Debug-only crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs → Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=495875#c4)• 15 years ago |
|  | |

Attached patch

[Patch](attachment.cgi?id=405854&action=diff)
— [Details](attachment.cgi?id=405854&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=495875&attachment=405854)

This passed unit tests on tryserver.
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: superreview?(roc)
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: review?(roc)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a11492321_5038)• 15 years ago |

[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: superreview?(roc)
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: superreview+
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: review?(roc)
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=495875#c5)• 15 years ago |
|  | |

Comment on [attachment 405854](/attachment.cgi?id=405854 "Patch") [[details]](/attachment.cgi?id=405854&action=edit "Patch") [[diff]](/attachment.cgi?id=405854&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=495875&attachment=405854)
Patch
Thanks

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a11515018_5038)• 15 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs landing]

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=495875#c6)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/28ac205d2563>Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?][needs landing] → [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=495875#c7)• 15 years ago |
|  | |

Does this bug affect 1.9.0?blocking1.9.1: ? → .5+
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x?Flags: blocking1.9.0.16?

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=495875#c8)• 15 years ago |
|  | |

(In reply to [comment #7](/show_bug.cgi?id=495875#c7 "RESOLVED FIXED - Crash [@ BuildTextRunsScanner::BreakSink::SetBreaks] with -moz-column, pre-wrap, font-size-adjust, multiple text runs"))
> Does this bug affect 1.9.0?
No, the code that caused the regression was never checked in to 1.9.0, and neither test case crashes there.Flags: wanted1.9.0.x?Flags: blocking1.9.0.16?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a12007966_190622)• 15 years ago |

Flags: wanted1.9.0.x-

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a12176897_5038)• 15 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a12380110_5038)• 15 years ago |

Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P2

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=495875#c9)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.2/rev/e82b9a962a9f>
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [final-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=final-fixed)

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=495875#c10)• 15 years ago |
|  | |

Simon, is this patch ready for 1.9.1? If so (and assuming it applies), please request approval on it. Code freeze for 1.9.1.6 is November 10 at 11:59pm.

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=495875#c11)• 15 years ago |
|  | |

Comment on [attachment 405854](/attachment.cgi?id=405854 "Patch") [[details]](/attachment.cgi?id=405854&action=edit "Patch") [[diff]](/attachment.cgi?id=405854&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=495875&attachment=405854)
Patch
Requesting approval for 1.9.1.6.
This fixes a regression from [bug 465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame"), which is one of the dependencies of performance [bug 430332](/show_bug.cgi?id=430332 "VERIFIED FIXED - Hang in nsLineBreaker::AppendText with text-transform:uppercase and a paragraph full of links"). I don't see any regression in performance in the test case there with this patch.
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: approval1.9.1.6?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=495875#c12)• 15 years ago |
|  | |

Comment on [attachment 405854](/attachment.cgi?id=405854 "Patch") [[details]](/attachment.cgi?id=405854&action=edit "Patch") [[diff]](/attachment.cgi?id=405854&action=diff "Patch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=495875&attachment=405854)
Patch
Approved for 1.9.1.6, a=dveditz for release-drivers
[Attachment #405854](/attachment.cgi?id=405854&action=edit "Patch") -
Flags: approval1.9.1.6? → approval1.9.1.6+

|  | [Simon Montagu :smontagu](/user_profile?user_id=11171)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=495875#c13)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/98a52f52cbe5>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.6-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.6-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=495875#c14)• 15 years ago |
|  | |

Verified on OS X with attached testcase. Crashes in 1.9.1.5 but not in the nightly 1.9.1.6 build, Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.6pre) Gecko/20091110 Shiretoko/3.5.6pre.Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a20486304_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a23409024_11608)• 15 years ago |

Flags: in-testsuite+

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=495875#a64089670_1)• 14 years ago |

Crash Signature: [@ BuildTextRunsScanner::BreakSink::SetBreaks]
You need to [log in](/show_bug.cgi?id=495875&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from secunia.com_1c2dac78_20250125_045012.html ===


[Skip to main content](#main-content)
[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

[![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

Search

## Main navigation

* Solutions
  + Column 1
    - Business challenge
      * [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
      * [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
      * [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
      * [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
      * [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
      * [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
      * [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
      * [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
      * [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
      * [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
      * [Public sector](https://www.flexera.com/solutions/public-sector)
  + Column 2
    - Spend management by vendor
      * [IBM](https://www.flexera.com/solutions/vendor/ibm)
      * [Oracle](https://www.flexera.com/solutions/vendor/oracle)
      * [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
      * [SAP](https://www.flexera.com/solutions/vendor/sap)
      * [VMware](https://www.flexera.com/solutions/vendor/vmware)
      * [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
      * [AWS](https://www.flexera.com/solutions/vendor/aws)
      * [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
      * [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
      * [Adobe](https://www.flexera.com/solutions/vendor/adobe)

  ### Achieve more through a united FinOps and ITAM function

  The future is hybrid. Break down the walls between ITAM and FinOps to drive more revenue, more customer growth and more innovation.

  [Discover More](https://www.flexera.com/resources/hybrid-itam-finops)
* Products
  + Column 1
    - [Flexera One](https://www.flexera.com/products/flexera-one)
      * [IT Visibility](https://www.flexera.com/products/flexera-one/it-visibility)
      * [ITAM](https://www.flexera.com/products/flexera-one/it-asset-management)
      * [SaaS Management](https://www.flexera.com/products/flexera-one/saas-management)
      * [FinOps](https://www.flexera.com/products/flexera-one/finops)
      * [Technology Intelligence Platform](https://www.flexera.com/products/flexera-one/technology-intelligence-platform)
  + Column 2
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
      * [Snow Spend Optimizer](https://www.flexera.com/products/snow-atlas/snow-spend-optimizer)
      * [Snow SaaS Management](https://www.flexera.com/products/snow-atlas/snow-saas-management)
  + Column 3
    - Hide group
      * [Security](https://www.flexera.com/products/security)
      * [Application Readiness](https://www.flexera.com/products/adminstudio)
      * [All products](https://www.flexera.com/products)
      * [All Snow products](https://www.flexera.com/products/snow)
      * [Integrations](https://www.flexera.com/products/integrations)

  ### Flexera 2024 State of the Cloud Report

  What do transformative initiatives such as GenAI, machine learning and sustainability mean for the cloud? Check out the 2024 State of the Cloud Report to find the answer as well as all the latest cloud computing trends.

  [View Report](https://info.flexera.com/CM-REPORT-State-of-the-Cloud)
* Success
  + Column 1
    - [Customer success](https://www.flexera.com/customer-success)
      * Support
        + [Flexera support portal](https://community.flexera.com/s/support-hub)
        + [Flexera product documentation](https://docs.flexera.com)
        + [Snow product documentation](https://docs.snowsoftware.io/)
      * Services and training
        + [Services](https://www.flexera.com/customer-success/services)
        + [Training](https://www.flexera.com/customer-success/training)
  + Column 2
    - Hide group
      * [Technology Intelligence Awards](https://www.flexera.com/customer-success/awards)
      * [Flexera community](https://community.flexera.com/s/)

  ### Insights from Gartner®

  Find a curated series of actionable and objective insights for IT executives and their teams. Get expert insights from valued analysts, courtesy of Flexera.

  [Discover More](https://www.flexera.com/resources/gartner-analyst-research)
* Resources
  + Column 1
    - [Resources](https://www.flexera.com/resources)
      * [Webinars](https://www.flexera.com/resources?type%5Bwebinar%5D=webinar)
      * [Videos](https://www.flexera.com/resources?type%5Bvideo%5D=video)
      * [Datasheets](https://www.flexera.com/resources?type%5Bdatasheet%5D=datasheet)
      * [White papers & reports](https://www.flexera.com/resources?type%5Bwhite-paper-industry-report%5D=white-paper-industry-report)
  + Column 2
    - Hide group
      * [Blog](/blog/)
      * [Case studies](https://www.flexera.com/resources/case-studies)
      * [Events](https://www.flexera.com/resources?type%5Bevent%5D=event)
      * [Analyst Research](https://www.flexera.com/resources/gartner-analyst-research)
      * [Glossary](https://www.flexera.com/resources/glossary)
      * [Demos & trials](https://www.flexera.com/resources?type%5Bdemo-trials%5D=demo-trials)
      * [Business value calculator](https://www.flexera.com/resources/business-value-calculator)

  ### Flexera 2025 IT Priorities Report

  Insights from Flexera’s 2025 IT Priorities Report highlight what’s top of mind for IT decision makers in the year ahead. Discover the challenges, priorities and opportunities that will shape the future IT landscape.

  [View Report](https://info.flexera.com/ITV-REPORT-IT-Priorities)
* About
  + Column 1
    - [Company](https://www.flexera.com/about-us)
      * [About](https://www.flexera.com/about-us)
      * [Careers](https://www.flexera.com/about-us/careers)
      * [Contact](https://www.flexera.com/about-us/contact-us)
      * [Leadership](https://www.flexera.com/about-us/leadership)
    - [Partners](https://www.flexera.com/about-us/partners)
      * [Partner program](https://www.flexera.com/about-us/partners/partner-program)
      * [Partner directory](https://www.flexera.com/about-us/partners/directory)
  + Column 2
    - [Press center](https://www.flexera.com/about-us/press-center)
      * [Press releases](https://www.flexera.com/about-us/all-press-releases)
      * [Awards](https://www.flexera.com/about-us/press-center#awards)
      * [Articles](https://www.flexera.com/about-us/all-articles)
    - Hide group
      * Social responsibility
        + [ESG](https://www.flexera.com/about-us/environmental-social-governance)
        + [Diversity](https://www.flexera.com/about-us/diversity)

  ### More value with technology intelligence

  The unparalleled synergy of Flexera and Snow provides the Technology Intelligence you need for more efficiency, insight and governance than ever before.

  [Discover More](https://www.flexera.com/more-value-with-technology-intelligence)

Search

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

## External Links

* External Links
  + [Community](https://community.flexera.com/)
  + [Product Access](https://app.flexera.com/login)
  + [Partner Portal](https://flexera.channeltivity.com/Login)

[Book a demo](/about-us/contact-us?C_Interest1=sales)

# Secunia Research

## The world’s best vulnerability intelligence

The Secunia Research team from Flexera provides the most accurate and reliable source of vulnerability intelligence.

[Contact Us](https://www.flexera.com/about-us/contact-us?C_Interest1=sales&C_SolutionInterest=SVM)
Watch video (0:29)

Related links

* [Anatomy of a security advisory](https://www.flexera.com/resources/infographics/anatomy-of-a-security-advisory)
* [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)
* [Software Vulnerability Manager](/products/software-vulnerability-manager)
* [Security advisories from Secunia Research](https://www.flexera.com/products/security/software-vulnerability-advisories)
* [Report a vulnerability](https://www.flexera.com/about-us/contact-us/report-vulnerability)

 ![Secunia Research](/sites/default/files/2022-04/hero-secunia-research-bg.jpg)

Featured Details

## Multiple ways to consume Secunia Research

Secunia delivers software security research that provides reliable, curated and actionable vulnerability intelligence. Organizations can expect to receive standardized, validated and enriched vulnerability research on a specific version of a software product. Secunia Research supports four solutions:

![Software Vulnerability Research](/sites/default/files/2022-04/icon-secunia-research-svr.svg)

### [Software Vulnerability Research](https://www.flexera.com/products/software-vulnerability-research)

Software Vulnerability Research utilizes Secunia Research to drive awareness of vulnerabilities matching your specified criteria

[Learn More](https://www.flexera.com/products/software-vulnerability-research)

![Software Vulnerability Manager](/sites/default/files/2022-04/icon-secunia-research-svm.svg)

### [Software Vulnerability Manager](/products/software-vulnerability-manager)

Software Vulnerability Manager uses Secunia Research data to identify, prioritize and patch known vulnerable software detected in your environment

[Learn More](/products/software-vulnerability-manager)

![Data Platform](/sites/default/files/2022-04/icon-secunia-research-dp.svg)

### [Data Platform](https://www.flexera.com/products/data-platform)

Data Platform leverages Secunia Research to provide high-level insights based on major or minor versions of software in your normalized inventory

[Learn More](https://www.flexera.com/products/data-platform)

![Flexera One](/sites/default/files/2022-04/icon-secunia-research-flexera-one.svg)

### [Flexera One](/flexera-one)

Flexera One utilizes Secunia Research (alongside public NVD data) to provide more granular matching of build-level versions of software in your normalized inventory within its IT Asset Management and IT Visibility solutions

[Learn More](/flexera-one)

How it works

## Accurate, reliable vulnerability insights at your fingertips

The Secunia Research team from Flexera is comprised of several security specialists who conduct vulnerability research in various products in addition to testing, verifying and validating public vulnerability reports. Since its inception in 2002, the goal of the Secunia Research team is to provide the most accurate and reliable source of vulnerability intelligence.

Delivering the world’s best vulnerability intelligence requires skill and passion. Team members continually develop their skills exploring various high-profile closed and open-source software using a variety of approaches, focusing chiefly on thorough code audits and binary analysis. The team has received industry recognition, including naming members to [Microsoft’s Most Valuable Security Researchers](https://msrc-blog.microsoft.com/2019/08/07/announcing-2019-msrc-most-valuable-security-researchers/) list.

Secunia researchers discover hard-to-find vulnerabilities that aren’t normally identified with techniques such as fuzzing, and the results have been impressive. Members of the Secunia Research team have discovered critical vulnerabilities in products from vendors including Microsoft, Symantec, IBM, Adobe, RealNetworks, Trend Micro, HP, Blue Coat, Samba, CA, Mozilla and Apple.

The team produces invaluable security advisories based on research of the vulnerabilities affecting any given software update. Sometimes a single update can address multiple vulnerabilities of varying criticalities and threats; but these advisories aggregate and distill findings down to a single advisory perfect for the prioritization of patching efforts within [Software Vulnerability Manager](/products/software-vulnerability-manager). Criticality scores are consistently applied along with details around attack vector and other valuable details within [Software Vulnerability Research](/products/software-vulnerability-research/secunia-research). Illegitimate vulnerability reports are also investigated and rejected so you can focus only on what truly matters.

Informing IT, Transforming IT

## Industry insights to help keep you informed

[#### Webinar

### Stay Ahead of Cyber Threats: Flexera's Latest Vulnerability Insights

Join us for this session where we'll explore the latest findings from the Flexera Monthly Vulnerability Insights Report.](https://info.flexera.com/SVM-WBNR-Vulnerability-Insights-Roundtable)

[#### Webinar

### Dive deeper into the Flexera Annual Vulnerability Insights

We'll explore the key findings from the Flexera Annual Vulnerability Insights Report. Learn about the latest cybersecurity trends, the most targeted industries, the types of vulnerabilities, plus management and mitigation strategies.](https://info.flexera.com/SVM-WBNR-Flexera-Annual-Vulnerability-Insights?lead_source=Website%20Visitor&id=Flexera.com-Resources)

#### Video

### Close the Risk Window with Software Vulnerability Manager

Stop reacting. Gain control. Stay secure. Build a more effective risk mitigation process leveraging Secunia Research vulnerability intelligence and the largest repository of third-party patch data in the industry.

Remote video URL

[#### Trial

### Software Vulnerability Manager Assessment free trial

Get access to the complete set of modules of Software Vulnerability Manager: Research, Assessment and Patching](https://info.flexera.com/SVM-EVAL-Software-Vulnerability-Manager)

[#### Datasheet

### Protect your ServiceNow® investment with the highest quality data

IT Visibility offers certified ServiceNow integrations that accelerate platform expansion, improve ROI and increase efficiencies across ITIL processes by delivering clean software and hardware asset data directly.](/sites/default/files/datasheet-itv-maximize-servicenow-investment.pdf)

[#### Blog

### Avoid missing crucial vulnerability intelligence amid NVD backlog

Recent developments regarding the National Vulnerability Database (NVD) have some technology leaders on edge. Since February, the U.S. National Institute of Standards and Technology (NIST) has almost completely stopped enriching software vulnerabi...](https://www.flexera.com/blog/vulnerability-management/avoid-missing-crucial-vulnerability-intelligence-amid-nvd-backlog/)

[View all resources](https://www.flexera.com/resources?category%5Bsoftware-vulnerability-management%5D=software-vulnerability-management)

## Footer Menu

* Column
  + Business challenge
    - [Software renewals and audits](https://www.flexera.com/solutions/software-renewals-audits)
    - [Software license management and optimization](https://www.flexera.com/solutions/software-usage-costs)
    - [SaaS spend management](https://www.flexera.com/solutions/saas-spend)
    - [Cloud cost management](https://www.flexera.com/solutions/cloud-cost)
    - [IT asset lifecycle management](https://www.flexera.com/solutions/it-asset-lifecycle)
    - [CMDB data quality](https://www.flexera.com/solutions/cmdb-data-quality)
    - [Accurate IT inventory](https://www.flexera.com/solutions/it-inventory)
    - [Security and regulatory risk management](https://www.flexera.com/solutions/it-security-regulatory-risk)
    - [Sustainable IT](https://www.flexera.com/solutions/sustainable-it)
    - [AI-powered transformation](https://www.flexera.com/solutions/ai-powered-transformation)
    - [Public sector](https://www.flexera.com/solutions/public-sector)
* Column
  + Spend management by vendor
    - [IBM](https://www.flexera.com/solutions/vendor/ibm)
    - [Oracle](https://www.flexera.com/solutions/vendor/oracle)
    - [Microsoft](https://www.flexera.com/solutions/vendor/microsoft)
    - [SAP](https://www.flexera.com/solutions/vendor/sap)
    - [VMware](https://www.flexera.com/solutions/vendor/vmware)
    - [ServiceNow](https://www.flexera.com/solutions/vendor/servicenow)
    - [AWS](https://www.flexera.com/solutions/vendor/aws)
    - [Salesforce](https://www.flexera.com/solutions/vendor/salesforce)
    - [BMC](https://www.flexera.com/solutions/cmdb-data-quality/bmc)
    - [Adobe](https://www.flexera.com/solutions/vendor/adobe)
* Column
  + Products
    - [Flexera One](https://www.flexera.com/products/flexera-one)
    - [Snow Atlas](https://www.flexera.com/products/snow-atlas)
    - [Security](https://www.flexera.com/products/security)
    - [Application Readiness](https://www.flexera.com/products/adminstudio)
    - [All products](https://www.flexera.com/products)
    - [All Snow products](https://www.flexera.com/products/snow)
    - [Integrations](https://www.flexera.com/products/integrations)
* Column
  + Company
    - [About](https://www.flexera.com/about-us)
    - [Careers](https://www.flexera.com/about-us/careers)
    - [Leadership](https://www.flexera.com/about-us/leadership)
    - [Contact us](https://www.flexera.com/about-us/contact-us)
    - [Media / press center](https://www.flexera.com/about-us/press-center)
    - [Revenera.com](https://www.revenera.com)

 +1.800.374.4353

en

* [English](https://www.flexera.com/products/security/software-vulnerability-research/secunia-research?referrer=secunia)
* [Deutsch](https://www.flexera.de/products/security/software-vulnerability-research/secunia-research?referrer=secunia)

 [![Home](/themes/custom/flexera/images/logo.svg)](https://www.flexera.com/)

© 2025 Flexera. All Rights Reserved.

## Footer

* [Privacy Policy](https://www.flexera.com/legal/privacy-policy)
* [Terms and conditions](https://www.flexera.com/legal)
* [Contact Us](https://www.flexera.com/about-us/contact-us)
* [Impressum](https://www.flexera.com/about-us/impressum)
* [Site Map](https://www.flexera.com/sitemap)

#####

×

...



=== Content from bugzilla.mozilla.org_48185f93_20250126_060732.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/468771)
* [XML](/show_bug.cgi?ctype=xml&id=468771)

Closed
[Bug 468771](/show_bug.cgi?id=468771)
(CVE-2009-3981)

Opened 16 years ago
Closed 16 years ago

# "ASSERTION: the pointer to this sibling will be overwritten" with -moz-column, table

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"ASSERTION: the pointer to this sibling will be overwritten" with -moz-column, table

## Categories

### (Core :: Layout, defect, P3)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P3

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: roc)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e1cadeaaf04bd425d597a571ffe0f522?d=mm&size=40)  [roc](/user_profile?user_id=5038)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[478131](/show_bug.cgi?id=478131 "RESOLVED WORKSFORME - \"ASSERTION: Column set should be complete if the available height is unconstrained\"")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[stirtable](/show_bug.cgi?id=339128 "RESOLVED INACTIVE - [meta] StirTable meta bug"), [430569](/show_bug.cgi?id=430569 "VERIFIED FIXED - Crash [@ nsPropertyTable::PropertyList::Equals] with -moz-column, position:fixed"), [476579](/show_bug.cgi?id=476579 "RESOLVED DUPLICATE - \"ASSERTION: nsTableCellMap::RemoveCell - could not remove cell\" with -moz-column")

[framedest](/show_bug.cgi?id=334514 "RESOLVED FIXED - FrameArena::~FrameArena should assert that it's empty")

Dependency [tree](/showdependencytree.cgi?id=468771&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=468771)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[476579](/show_bug.cgi?id=476579 "RESOLVED DUPLICATE - \"ASSERTION: nsTableCellMap::RemoveCell - could not remove cell\" with -moz-column")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2009-3981

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[fixed1.9.0.16](/buglist.cgi?keywords=fixed1.9.0.16&resolution=---),
[fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.1](#a4378451_5038 "16 years ago") | - |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.1 | - |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | [wanted1.9.1](#a4378451_5038 "16 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | wanted1.9.1 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.16](#c17 "15 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.16 | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#c23 "15 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [testcase](/attachment.cgi?id=352264)  [16 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   624 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=352264&action=edit) |
| --- | --- | --- |
| [testcase for the incomplete assert](/attachment.cgi?id=352271)  [16 years ago](#c3)  [Bernd](/user_profile?user_id=17687)   460 bytes, application/xhtml+xml |  | [Details](/attachment.cgi?id=352271&action=edit) |
| [fix](/attachment.cgi?id=361492)  [16 years ago](#c9)  [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)   2.68 KB, patch | dbaron : [review+](#c10 "16 years ago")  dbaron : [superreview+](#c10 "16 years ago")  dbaron : [approval1.9.1+](#c14 "16 years ago")  dveditz : [approval1.9.0.16+](#c20 "15 years ago") | [Details](/attachment.cgi?id=361492&action=edit) | [Diff](/attachment.cgi?id=361492&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=468771#c0)• 16 years ago |
|  | |

Attached file
[testcase](attachment.cgi?id=352264)
— [Details](attachment.cgi?id=352264&action=edit)

###!!! ASSERTION: the pointer to this sibling will be overwritten: '!aNewFrame->GetNextSibling()', file /Users/jruderman/central/layout/generic/nsFrameList.cpp, line 176
###!!! ASSERTION: Some objects allocated with AllocateFrame were not freed: 'mFrameCount == 0', file /Users/jruderman/central/layout/base/nsPresShell.cpp, line 675
Likely exploitable. The testcase doesn't cause a crash, but a variant (created with the usual trick) makes Firefox dereference 0xdadadaf6.

|  | [Bernd](/user_profile?user_id=17687) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=468771#c1)• 16 years ago |
|  | |

The usual suspects, the block reflow reports incompleteness, the table starts to split, but as it is not in pagination mode, this goes wrong.

|  | [Bernd](/user_profile?user_id=17687) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=468771#c2)• 16 years ago |
|  | |

the crash is preceeded by:
###!!! ASSERTION: Shouldn't be incomplete if availableHeight is UNCONSTRAINED.:
'aReflowState.availableHeight != NS\_UNCONSTRAINEDSIZE', file d:/moz\_src/src/layo
ut/generic/nsBlockFrame.cpp, line 1413

|  | [Bernd](/user_profile?user_id=17687) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=468771#c3)• 16 years ago |
|  | |

Attached file
[testcase for the incomplete assert](attachment.cgi?id=352271)
— [Details](attachment.cgi?id=352271&action=edit)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5223_11608)• 16 years ago |

Whiteboard: [sg:critical?]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=468771#c4)• 16 years ago |
|  | |

Should be fairly easy to fix once we figure out where the incompleteness is being triggered.Flags: blocking1.9.1?

|  | [Bernd](/user_profile?user_id=17687) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=468771#c5)• 16 years ago |
|  | |

we trigger it by asking to reisze to a very small width of the column frame
ColumnSet(div)(0) 05CCE828 Reflow a=60,UC c=60,UC h-resize v-resize cnt=10999
block 05CCE774 Reflow a=60,1200 c=60,UC dirty v-resize nif=05CCF8A4 cnt=11000
text 05CCE9F0 Reflow a=60,UC c=UC,UC dirty v-resize nif=05CCF838 cnt=11001
text 05CCE9F0 Reflow d=600,1140 status=0x1
text 05CCF838 Reflow a=60,UC c=UC,UC dirty v-resize pif=05CCE9F0 cnt=11002
text 05CCF838 Reflow d=660,1140
block 05CCE774 Reflow d=60,1200 status=0x3o=(0,0) 600 x 1200sto=(0,0) 600 x 1200
ColumnSet(div)(0) 05CCE828 Reflow d=60,1200 status=0x3o=(0,0) 600 x 1200sto=(0,0) 600 x 1200
###!!! ASSERTION: Shouldn't be incomplete if availableHeight is UNCONSTRAINED.:'aReflowState.availableHeight != NS\_UNCONSTRAINEDSIZE', file d:/moz\_src/src/layout/generic/nsBlockFrame.cpp, line 1413

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a579311_5038)• 16 years ago |

Flags: blocking1.9.1? → blocking1.9.1+Priority: -- → P3

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=468771#c6)• 16 years ago |
|  | |

FWIW: I hit the assertions from [comment 0](/show_bug.cgi?id=468771#c0 "RESOLVED FIXED - \"ASSERTION: the pointer to this sibling will be overwritten\" with -moz-column, table") and [comment 2](/show_bug.cgi?id=468771#c2 "RESOLVED FIXED - \"ASSERTION: the pointer to this sibling will be overwritten\" with -moz-column, table") on the first testcase, and the incomplete assert on the second testcase, using my linux mozilla-central debug build (updated yesterday).
Platform --> ALL/ALLOS: Mac OS X → AllHardware: x86 → All

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=468771#c7)• 16 years ago |
|  | |

FWIW, the testcase on [bug 435664](/show_bug.cgi?id=435664 "RESOLVED FIXED - Crash after clicking 'Print This Page' on National Grid website (Firefox 3 RC1) [@ ReparentFrame(nsIFrame*, nsIFrame*, nsIFrame*)]") triggers this bug's assertion ("the pointer to this sibling will be overwritten") when printed / print-previewed. (It also crashes, which is what that bug is primarily about.) See [bug 435664 comment 13](/show_bug.cgi?id=435664#c13 "RESOLVED FIXED - Crash after clicking 'Print This Page' on National Grid website (Firefox 3 RC1) [@ ReparentFrame(nsIFrame*, nsIFrame*, nsIFrame*)]"). Possibly related to this bug?

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=468771#c8)• 16 years ago |
|  | |

I think the problem here is that the column set is propagating incompleteness that's ok inside of it to outside of it... although maybe incompleteness isn't ok inside the last column of a column set.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a4032989_5038)• 16 years ago |

Assignee: nobody → roc

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a4130576_3881)• 16 years ago |

Blocks: [430569](/show_bug.cgi?id=430569 "VERIFIED FIXED - Crash [@ nsPropertyTable::PropertyList::Equals] with -moz-column, position:fixed")

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a4378451_5038)• 16 years ago |

Flags: wanted1.9.1+Flags: blocking1.9.1-Flags: blocking1.9.1+

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5008944_3881)• 16 years ago |

Blocks: [476579](/show_bug.cgi?id=476579 "RESOLVED DUPLICATE - \"ASSERTION: nsTableCellMap::RemoveCell - could not remove cell\" with -moz-column")

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=468771#c9)• 16 years ago |
|  | |

Attached patch

[fix](attachment.cgi?id=361492&action=diff)
— [Details](attachment.cgi?id=361492&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492)

The comment should help explain what's going on.
Basically we're just changing the number of columns from 2 to 1. This should mean that the first column pulls all the content out of the second column, but that doesn't happen because we skip reflowing the first column. We need to tweak the incremental reflow test so that we always reflow the last column if we're giving it unbounded height; it will want to pull content from its next-sibling.
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: review?(dbaron)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5380438_5038)• 16 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][needs review]

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=468771#c10)• 16 years ago |
|  | |

Comment on [attachment 361492](/attachment.cgi?id=361492 "fix") [[details]](/attachment.cgi?id=361492&action=edit "fix") [[diff]](/attachment.cgi?id=361492&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492)
fix
r+sr=dbaron
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: superreview+
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: review?(dbaron)
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: review+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5405150_5038)• 16 years ago |

Whiteboard: [sg:critical?][needs review] → [sg:critical?][needs landing]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=468771#c11)• 16 years ago |
|  | |

This fixes [bug 476579](/show_bug.cgi?id=476579 "RESOLVED DUPLICATE - \"ASSERTION: nsTableCellMap::RemoveCell - could not remove cell\" with -moz-column") too.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=468771#c12)• 16 years ago |
|  | |

Pushed <http://hg.mozilla.org/mozilla-central/rev/c0dbc2a40bb1>. I withheld the testcase.Status: NEW → RESOLVEDClosed: 16 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?][needs landing] → [sg:critical?][needs 191 landing]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5458451_5038)• 16 years ago |

[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: approval1.9.1?

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a5515988_11608)• 16 years ago |

Depends on: [478131](/show_bug.cgi?id=478131 "RESOLVED WORKSFORME - \"ASSERTION: Column set should be complete if the available height is unconstrained\"")

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=468771#c14)• 16 years ago |
|  | |

Comment on [attachment 361492](/attachment.cgi?id=361492 "fix") [[details]](/attachment.cgi?id=361492&action=edit "fix") [[diff]](/attachment.cgi?id=361492&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492)
fix
a1.9.1=dbaron
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: approval1.9.1? → approval1.9.1+

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=468771#c15)• 16 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/6f907ad90647>Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)Whiteboard: [sg:critical?][needs 191 landing] → [sg:critical?]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=468771#c16)• 15 years ago |
|  | |

Although the assertion doesn't occur on the 1.9.0 branch the code being patched looks the same. Do we need this fix on the 1.9.0 branch as well?Flags: blocking1.9.0.16?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=468771#c17)• 15 years ago |
|  | |

Blocking 1.9.0 on the assumption the answer to [comment 16](/show_bug.cgi?id=468771#c16 "RESOLVED FIXED - \"ASSERTION: the pointer to this sibling will be overwritten\" with -moz-column, table") is "yes, we do".Flags: blocking1.9.0.16? → blocking1.9.0.16+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=468771#c18)• 15 years ago |
|  | |

Code-freeze for 1.9.0.16 is next Tuesday. If this patch works as-is please request approval, else we need a back-port patch. Thanks.Whiteboard: [sg:critical?] → [sg:critical?][needs 1.9.0 patch]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=468771#c19)• 15 years ago |
|  | |

Comment on [attachment 361492](/attachment.cgi?id=361492 "fix") [[details]](/attachment.cgi?id=361492&action=edit "fix") [[diff]](/attachment.cgi?id=361492&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492)
fix
Patch applies as-is.
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: approval1.9.0.16?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=468771#c20)• 15 years ago |
|  | |

Comment on [attachment 361492](/attachment.cgi?id=361492 "fix") [[details]](/attachment.cgi?id=361492&action=edit "fix") [[diff]](/attachment.cgi?id=361492&action=diff "fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=468771&attachment=361492)
fix
Approved for 1.9.0.16, a=dveditz for release-drivers
[Attachment #361492](/attachment.cgi?id=361492&action=edit "fix") -
Flags: approval1.9.0.16? → approval1.9.0.16+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a29014344_1689)• 15 years ago |

Whiteboard: [sg:critical?][needs 1.9.0 patch] → [sg:critical?][needs 1.9.0 landing]

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=468771#c21)• 15 years ago |
|  | |

Checked into 1.9.0.Keywords: [fixed1.9.0.16](/buglist.cgi?keywords=fixed1.9.0.16&resolution=---)Whiteboard: [sg:critical?][needs 1.9.0 landing] → [sg:critical?]

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=468771#c22)• 15 years ago |
|  | |

Neither of the two testcases trigger the assert in my debug 1.9.0.15 build on OS X. Have we seen these asserts on the 1.9.0 branch?

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a31972984_159758)• 15 years ago |

Alias: CVE-2009-3981

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=468771#a41292956_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=468771#c23)• 15 years ago |
|  | |

Crashtest added: <http://hg.mozilla.org/mozilla-central/rev/d3e7c18f58fc>Flags: in-testsuite+
You need to [log in](/show_bug.cgi?id=468771&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.ubuntu.com_ba2ae2e3_20250125_045015.html ===


Your submission was sent successfully!
*Close*

Thank you for contacting us. A member of our team will be in touch shortly.
*Close*

You have successfully unsubscribed!
*Close*

Thank you for signing up for our newsletter!

In these regular emails you will find the latest updates about
Ubuntu and upcoming events where you can meet our team.*Close*

Your preferences have been successfully updated. *Close*

[Canonical Ubuntu](/)

* [Menu](/navigation)

* [Products](/navigation#products-navigation)
* [Use cases](/navigation#use-case-navigation)
* [Support](/navigation#support-navigation)
* [Community](/navigation#community-navigation)
* [Get Ubuntu](/navigation#get-ubuntu-navigation)

[![](https://assets.ubuntu.com/v1/82818827-CoF_white.svg)

Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

# USN-874-1: Firefox 3.5 and Xulrunner 1.9.1 vulnerabilities

18 December 2009

Firefox 3.5 and Xulrunner 1.9.1 vulnerabilities

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Releases

* [Ubuntu 9.10](/security/notices?release=karmic)

## Packages

* [firefox-3.5](/security/cves?package=firefox-3.5) -
* [xulrunner-1.9.1](/security/cves?package=xulrunner-1.9.1) -

## Details

Jesse Ruderman, Josh Soref, Martijn Wargers, Jose Angel, Olli Pettay, and

David James discovered several flaws in the browser and JavaScript engines

of Firefox. If a user were tricked into viewing a malicious website, a

remote attacker could cause a denial of service or possibly execute

arbitrary code with the privileges of the user invoking the program.

([CVE-2009-3979](/security/CVE-2009-3979), [CVE-2009-3980](/security/CVE-2009-3980), [CVE-2009-3982](/security/CVE-2009-3982), [CVE-2009-3986](/security/CVE-2009-3986))

Takehiro Takahashi discovered flaws in the NTLM implementation in Firefox.

If an NTLM authenticated user visited a malicious website, a remote

attacker could send requests to other applications, authenticated as the

user. ([CVE-2009-3983](/security/CVE-2009-3983))

Jonathan Morgan discovered that Firefox did not properly display SSL

indicators under certain circumstances. This could be used by an attacker

to spoof an encrypted page, such as in a phishing attack. ([CVE-2009-3984](/security/CVE-2009-3984))

Jordi Chancel discovered that Firefox did not properly display invalid URLs

for a blank page. If a user were tricked into accessing a malicious

website, an attacker could exploit this to spoof the location bar, such as

in a phishing attack. ([CVE-2009-3985](/security/CVE-2009-3985))

David Keeler, Bob Clary, and Dan Kaminsky discovered several flaws in third

party media libraries. If a user were tricked into opening a crafted media

file, a remote attacker could cause a denial of service or possibly execute

arbitrary code with the privileges of the user invoking the program.

([CVE-2009-3388](/security/CVE-2009-3388), [CVE-2009-3389](/security/CVE-2009-3389))

### Reduce your security exposure

Ubuntu Pro provides ten-year security coverage to 25,000+ packages in Main and Universe repositories, and it is free for up to five machines.

[Learn more about Ubuntu Pro](/pro)

## Update instructions

The problem can be corrected by updating your system to the following package versions:

##### Ubuntu 9.10

* [xulrunner-1.9.1](https://launchpad.net/ubuntu/%2Bsource/xulrunner-1.9.1)
  -
  [1.9.1.6+nobinonly-0ubuntu0.9.10.1](https://launchpad.net/ubuntu/%2Bsource/xulrunner-1.9.1/1.9.1.6%2Bnobinonly-0ubuntu0.9.10.1)
* [firefox-3.5](https://launchpad.net/ubuntu/%2Bsource/firefox-3.5)
  -
  [3.5.6+nobinonly-0ubuntu0.9.10.1](https://launchpad.net/ubuntu/%2Bsource/firefox-3.5/3.5.6%2Bnobinonly-0ubuntu0.9.10.1)

After a standard system upgrade you need to restart Firefox and any

applications that use xulrunner to effect the necessary changes.

## References

* [CVE-2009-3979](/security/CVE-2009-3979)
* [CVE-2009-3982](/security/CVE-2009-3982)
* [CVE-2009-3388](/security/CVE-2009-3388)
* [CVE-2009-3986](/security/CVE-2009-3986)
* [CVE-2009-3984](/security/CVE-2009-3984)
* [CVE-2009-3985](/security/CVE-2009-3985)
* [CVE-2009-3389](/security/CVE-2009-3389)
* [CVE-2009-3980](/security/CVE-2009-3980)
* [CVE-2009-3983](/security/CVE-2009-3983)

## Related notices

* [USN-873-1](/security/notices/USN-873-1)
* [USN-915-1](/security/notices/USN-915-1)

### Join the discussion

* [Ubuntu security updates mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-hardened)
* [Security announcements mailing list](https://lists.ubuntu.com/mailman/listinfo/ubuntu-security-announce)

### Need help with your security needs?

Ubuntu Pro provides up to ten-year security coverage for over 23,000 open-source packages within the Ubuntu Main and Universe repositories.

[Talk to an expert to find out what would work best for you](/contact-us/form?product=pro)

### Further reading

* *Loading...*

---

## [OpenStack](/openstack) [OpenStack](/openstack)

* [What is OpenStack](/openstack/what-is-openstack)
* [Features](/openstack/features)
* [Managed](/openstack/managed)
* [Consulting](/openstack/consulting)
* [Install](/openstack/install)
* [Support](/openstack/support)

---

## [Ceph](/ceph) [Ceph](/ceph)

* [What is Ceph](/ceph/what-is-ceph)
* [Managed](/ceph/managed)
* [Consulting](/ceph/consulting)
* [Docs](/ceph/docs)
* [Install](/ceph/install)

---

## [Kubernetes](/kubernetes) [Kubernetes](/kubernetes)

* [What is Kubernetes](/kubernetes/what-is-kubernetes)
* [Charmed Kubernetes](/kubernetes/charmed-k8s)
* [Managed](/kubernetes/managed)
* [Install](/kubernetes/install)
* [Docs](/kubernetes/docs)
* [Resources](/kubernetes/resources)

---

## [Managed Services](/managed) [Managed Services](/managed)

* [OpenStack](/openstack/managed)
* [Kubernetes](/kubernetes/managed)
* [Ceph](/ceph/managed)
* [Apps](/managed/apps)
* [Observability](/observability/managed)
* [Firefighting](/managed/firefighting-support)

---

## [AI / ML](/ai) [AI / ML](/ai)

* [MLOps](/ai/mlops)
* [Kubeflow](/ai/what-is-kubeflow)
* [MLflow](/ai/mlflow)
* [Consulting](/ai/consulting)
* [Data Science](/ai/data-science)
* [MLOps workshop](/ai/mlops-workshop)

---

## [Robotics](/robotics) [Robotics](/robotics)

* [What is ROS](/robotics/what-is-ros)
* [ROS ESM](/robotics/ros-esm)
* [Community](/robotics/community)
* [Docs](/robotics/docs)

---

## [IoT](/internet-of-things) [IoT](/internet-of-things)

* [App store](/internet-of-things/appstore)
* [Embedded Linux](/embedded)
* [Management](/internet-of-things/management)

---

## [Ubuntu Core](/core) [Ubuntu Core](/core)

* [Features](/core/features)
* [Success stories](/core/stories)
* [Services](/core/services)
* [Docs](/core/docs)

---

## [Ubuntu Desktop](/desktop) [Ubuntu Desktop](/desktop)

* [Organisations](/desktop/organisations)
* [Developers](/desktop/developers)
* [Flavours](/desktop/flavours)
* [WSL](/desktop/wsl)

---

## [Ubuntu Server](/server) [Ubuntu Server](/server)

* [Hyperscale](/server/hyperscale)
* [Docs](/server/docs)

---

## [Cloud](/cloud) [Cloud](/cloud)

* [What is cloud computing](/cloud/cloud-computing)
* [What is private cloud](/cloud/private-cloud)
* [What is hybrid cloud](/cloud/hybrid-cloud)
* [What is multi-cloud](/cloud/multi-cloud)
* [Public cloud](/cloud/public-cloud)

---

## [Security](/security) [Security](/security)

* [ESM](/security/esm)
* [Livepatch](/security/livepatch)
* [Certifications & Hardening](/security/compliance-automation)
* [CVEs](/security/cves)
* [Notices](/security/notices)
* [Docker Images](/security/docker-images)

---

## [Landscape](/landscape) [Landscape](/landscape)

* [Features](/landscape/features)
* [Managed](/landscape/managed)
* [Compare](/landscape/compare)
* [Install](/landscape/docs/quickstart-deployment)
* [Docs](/landscape/docs)
* [Log in to Landscape](https://landscape.canonical.com/)

---

## [Containers](/containers) [Containers](/containers)

* [What are containers](/containers/what-are-containers)
* [Chiseled Ubuntu](/containers/chiseled)
* [Chiseled and .NET](/containers/chiseled/dotnet)

---

## [Downloads](/download) [Downloads](/download)

* [Desktop](/download/desktop)
* [Server](/download/server)
* [Core](/download/core)
* [Cloud](/download/cloud)

---

## [Support](/support) [Support](/support)

* [Your subscriptions](/pro/dashboard)
* [Account users](/pro/users)
* [Pricing](/pricing/pro)
* [Discourse](https://discourse.ubuntu.com/c/project/ubuntu-pro/116/)

---

## [Observability](/observability) [Observability](/observability)

* [What is observability](/observability/what-is-observability)
* [Managed](/observability/managed)

---

## [Pricing](/pricing) [Pricing](/pricing)

* [Consulting](/pricing/consulting)
* [Desktops](/pricing/desktop)
* [Devices](/pricing/devices)

---

## Solutions

* [AI](https://canonical.com/solutions/ai)
* [Data](https://canonical.com/data)
* [Infrastructure](https://canonical.com/solutions/infrastructure)
* [Secure open source](https://canonical.com/solutions/secure-open-source)

---

## Sectors

* [Automotive](/automotive)
* [Industrial](/industrial)
* [Government](/gov)
* [Telco](/telco)
* [Finance](/financial-services)

---

[Contact us](/contact-us)

* [About us](/about)
* [Community](/community)
* [Careers](https://www.canonical.com/careers)
* [Blog](/blog)
* [Resources](/engage)
* [Press centre](/blog/press-centre)

---

© 2025 Canonical Ltd.

Ubuntu and Canonical are registered trademarks of Canonical Ltd.

---

* [Legal information](/legal)
* [Data privacy](/legal/data-privacy)
* Manage your tracker settings
* [Report a bug on this site](https://github.com/canonical/ubuntu.com/issues/new?template=ISSUE_TEMPLATE.yaml)

Back to top

Go to the top of the page


