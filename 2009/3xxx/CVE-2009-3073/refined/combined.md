=== Content from bugzilla.mozilla.org_6c814ea5_20250126_124424.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/467493)
* [XML](/show_bug.cgi?ctype=xml&id=467493)

Closed
[Bug 467493](/show_bug.cgi?id=467493)

Opened 16 years ago
Closed 16 years ago

# Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos

## Categories

### (Core :: Layout, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Layout#Layout)

Layout
▾

Core :: Layout

Issues in Layout that do not fit into any other Layout component or which span multiple Layout components.

Bugs related to the top level presentation objects (pres shell, pres context, and document viewer), the frame constructor, and the base frame classes, as well as general issues with alignment and sizing, all belong here.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Layout&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Layout&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Layout)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
WORKSFORME

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

WORKSFORME

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Webcompat Score | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.1 | --- | [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| status1.9.1 |  | unaffected |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jruderman, Assigned: roc)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/e1cadeaaf04bd425d597a571ffe0f522?d=mm&size=40)  [roc](/user_profile?user_id=5038)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/d2dc9227eafcd0ec5ba3712ee4f19b75?d=mm&size=40)  [jruderman](/user_profile?user_id=11608)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=40)  [dholbert](/user_profile?user_id=278074)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[randomstyles](/show_bug.cgi?id=306939 "RESOLVED INACTIVE - [meta] Bugs found by Random Styles (adding random style properties to DOM elements)"), [502017](/show_bug.cgi?id=502017 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float")

Dependency [tree](/showdependencytree.cgi?id=467493&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=467493)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [sg:critical?])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[assertion](/buglist.cgi?keywords=assertion&resolution=---),
[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.0.14](/buglist.cgi?keywords=verified1.9.0.14&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [roc](/user_profile?user_id=5038) | [blocking1.9.1](#a1267359_5038 "16 years ago") | + |
| --- | --- | --- |
| [roc](/user_profile?user_id=5038) | blocking1.9.1 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.9](#c0 "16 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.9 | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.9.0.14](#c0 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.9.0.14 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#a8426418_1689 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | [in-testsuite](#c30 "16 years ago") | + |
| --- | --- | --- |
| [jruderman](/user_profile?user_id=11608) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ nsHTMLReflowState::GetHypotheticalBoxContainer ]](https://crash-stats.mozilla.org/signature/?signature=nsHTMLReflowState%3A%3AGetHypotheticalBoxContainer)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 1 obsolete file)

| [testcase (crashes Firefox when loaded)](/attachment.cgi?id=350921)  [16 years ago](#c0)  [Jesse Ruderman](/user_profile?user_id=11608)   240 bytes, text/html |  | [Details](/attachment.cgi?id=350921&action=edit) |
| --- | --- | --- |
| [testcase 2](/attachment.cgi?id=361901)  [16 years ago](#c11)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   412 bytes, text/html |  | [Details](/attachment.cgi?id=361901&action=edit) |
| [semi-reference case 2 (doesn't crash)](/attachment.cgi?id=361905)  [16 years ago](#c12)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   412 bytes, text/html |  | [Details](/attachment.cgi?id=361905&action=edit) |
| [fix for 1.9.0.x?](/attachment.cgi?id=382825)  [16 years ago](#c22)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   1.03 KB, patch |  | [Details](/attachment.cgi?id=382825&action=edit) | [Diff](/attachment.cgi?id=382825&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=467493&attachment=382825) |
| [testcase 3 [moved to bug 502017]](/attachment.cgi?id=386544)  [16 years ago](#c24)  [Daniel Holbert [:dholbert]](/user_profile?user_id=278074)   472 bytes, text/html |  | [Details](/attachment.cgi?id=386544&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=467493#c0)• 16 years ago |
|  | |

Attached file
[testcase (crashes Firefox when loaded)](attachment.cgi?id=350921)
— [Details](attachment.cgi?id=350921&action=edit)

###!!! ASSERTION: bad height: 'Not Reached', file /Users/jruderman/central/layout/generic/nsLineLayout.cpp, line 188
###!!! ASSERTION: Placeholder relationship should have been torn down; see comments in nsPlaceholderFrame.h: '!shell->FrameManager()->GetPlaceholderFrameFor(mOutOfFlowFrame)', file /Users/jruderman/central/layout/generic/nsPlaceholderFrame.cpp, line 132
###!!! ASSERTION: Dead placeholder in placeholder map: 'entry->placeholderFrame->GetOutOfFlowFrame() != (void\*)0xdddddddd', file /Users/jruderman/central/layout/base/nsFrameManager.cpp, line 137
###!!! ASSERTION: no placeholder frame: 'nsnull != placeholderFrame', file /Users/jruderman/central/layout/generic/nsHTMLReflowState.cpp, line 1140
Null deref [@ nsHTMLReflowState::GetHypotheticalBoxContainer], but the third assertion earns this bug a free [sg:critical?].
I suspect this is a recent regression, because I think I wasn't hitting this crash before last week.

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a141_11608)• 16 years ago |

Whiteboard: [sg:critical?]

|  | [Martijn Wargers (dead)](/user_profile?user_id=55600) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a664966_55600)• 16 years ago |

Flags: blocking1.9.1?

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a1267359_5038)• 16 years ago |

Flags: blocking1.9.1? → blocking1.9.1+Priority: -- → P2

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=467493#c1)• 16 years ago |
|  | |

After poking at this for a few minutes in the debugger, my guess would be that it's a regression from [bug 465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame"). However, I haven't verified that, and I'm not really sure.
I started by focusing on the second assertion. What's happening is that we're in nsPlaceholderFrame::Destroy called by nsBlockFrame::DoRemoveFrame via nsBlockReflowContext::ReflowBlock's call to DeleteNextInFlowChild. What I don't know is through what codepath we'd normally expect nsCSSFrameConstructor::RemoveMappingsForFrameSubtree to be called in such a case. Or are we assuming that this frame is empty, and the problem is that it actually isn't? (That's sort of my logic for implicating [bug 465928](/show_bug.cgi?id=465928 "RESOLVED FIXED - Avoid SetInvalidateTextRuns in nsBlockFrame::DoRemoveFrame").)

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a3215838_5038)• 16 years ago |

Assignee: nobody → roc

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=467493#c2)• 16 years ago |
|  | |

I don't crash on Mac trunk. Jesse, is this WFY?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=467493#c3)• 16 years ago |
|  | |

No crash for me either, on Linux trunk (using nightly & debug build).
FWIW, my debug build spits out a bunch of copies of these messages:
WARNING: bad value: file nsFloatManager.cpp, line 149
###!!! ASSERTION: Computed overflow area must contain frame bounds: 'aNewSize.width == 0 || aNewSize.height == 0 || aOverflowArea->Contains(nsRect(nsPoint(0, 0), aNewSize))', file nsFrame.cpp, line 5566
(Maybe the crash was fixed by the spacemanager --> floatmanager change?)

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=467493#c4)• 16 years ago |
|  | |

Yes, WFM.Status: NEW → RESOLVEDClosed: 16 years agoResolution: --- → WORKSFORME

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=467493#c5)• 16 years ago |
|  | |

Hmm, but is it fixed on the 1.9.1 branch?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=467493#c6)• 16 years ago |
|  | |

No, this is \*not\* fixed on 1.9.1 branch. I just tried latest nightly, and it still crashes on this bug's testcase. (No big surprise, given that the suspected fix, [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats"), hasn't landed there.)
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1b3pre) Gecko/20090202 Shiretoko/3.1b3preOS: Mac OS X → All

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a5433351_278074)• 16 years ago |

Whiteboard: [sg:critical?] → [sg:critical?][maybe fixed by 191448 on 1.9.2]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=467493#c7)• 16 years ago |
|  | |

This crash became fixed between these mozilla-central nightly builds:
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2a1pre) Gecko/20090104 Minefield/3.2a1pre
Built from <http://hg.mozilla.org/mozilla-central/rev/9f497b1505d2>
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2a1pre) Gecko/20090105 Minefield/3.2a1pre
Built from <http://hg.mozilla.org/mozilla-central/rev/c04e27e056ba>
<http://hg.mozilla.org/mozilla-central/pushloghtml?fromchange=9f497b1505d2&tochange=c04e27e056ba>
That window includes a number of checkins from [Bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats"), so I'm making the dependency on [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats") official.Depends on: [191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats")

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=467493#c8)• 16 years ago |
|  | |

I don't see why [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats") should have changed any behavior of things outside the space manager code itself, except perhaps for dealing with very large sizes. Such changes were unintentional, and could well indicate a bug in that change.
That said, [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats") hasn't had all that many regressions. But I wouldn't be comfortable shipping it in a release without having it in a beta.
If this was fixed by [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats"), it would be good to know why.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=467493#c9)• 16 years ago |
|  | |

I'll fire off some builds from right around when [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats") landed, to check whether it's really responsible for fixing this (and if so, which of its several patches did it).

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=467493#c10)• 16 years ago |
|  | |

I've confirmed that this was fixed by [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats").
Here are three consecutive changesets (newest first):
changeset 496e0cb5c943 (main 191448 patch): No crash
changeset b19f0a7a3c4c (intermediate 191448 patch): Doesn't compile\*
changeset b087a09f82aa (unrelated): Crash
So, this was fixed by something in these changesets:
<http://hg.mozilla.org/mozilla-central/rev/496e0cb5c943>
<http://hg.mozilla.org/mozilla-central/rev/b19f0a7a3c4c>
\* changeset b19f0a7a3c4c's compile error was from something complaining about nsSpaceManager not being declared (probably since it was in the process of being removed). That issue was apparently fixed in the following checkin.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a5499667_278074)• 16 years ago |

Whiteboard: [sg:critical?][maybe fixed by 191448 on 1.9.2] → [sg:critical?][fixed by 191448 on 1.9.2]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=467493#c11)• 16 years ago |
|  | |

Attached file
[testcase 2](attachment.cgi?id=361901)
— [Details](attachment.cgi?id=361901&action=edit)

Here's a tweaked version of testcase, with the style separated out into a <style> block, with s/margin/margin-top, and with the margin-top value reduced to be \*just\* at the threshold where we crash.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=467493#c12)• 16 years ago |
|  | |

Attached file
[semi-reference case 2 (doesn't crash)](attachment.cgi?id=361905)
— [Details](attachment.cgi?id=361905&action=edit)

Here's a semi-reference case, for comparison with testcase 2. Its just got a margin-top value that's .000000000001 less than the testcase, which is enough to save us from crashing in 1.9.1 builds.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=467493#c13)• 16 years ago |
|  | |

If I dump the frametrees of testcase 2 & semi-reference case #2 in a patched mozilla-central build (which doesn't crash), it looks like the margin-top value is exactly at the point where we wrap around the signed integer boundary.
Here's a cleaned-up snippet of testcase 2's frame tree
ColumnSet(div)(0)@0xb269528c [view=0xb269b100] {0,0,35640,0}<
Block(div)(0)@0xb26951ec {0,0,17340,0} <
line 0xb2695c18: count=1 {0,2147483520,17340,473} <
Block(div)(0)@0xb2695454 {0,2147483520,17340,473} <
...and here's the matching snippet from testcase 2:
ColumnSet(div)(0)@0xb266128c [view=0xb622b6a0] {0,0,35640,0} <
Block(div)(0)@0xb26611ec {0,0,17340,0} <
line 0xb2661c18: count=1 {0,-2147483648,17340,473} <
Block(div)(0)@0xb2661454 {0,-2147483648,17340,473} <
Notice the change from 2147483520 (2^31 - 128) in the reference case to -2147483648 (-2^31 exactly) in the test case -- that's the integer overflow, and the old code's crash is dependent on that, for some reason.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=467493#c14)• 16 years ago |
|  | |

(In reply to [comment #13](/show_bug.cgi?id=467493#c13 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
> Here's a cleaned-up snippet of testcase 2's frame tree
D'oh, sorry, that was a typo -- the first frametree snippet above is from "semi-reference case 2".

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=467493#c15)• 16 years ago |
|  | |

Ok, so I've looked into why our behavior changed on this testcase, and I think I've got a decent summary.
IN SHORT:
The new nsFloatManager::ClearFloats method includes an initial "HaveAnyFloats" check (with an immediate return, if we don't have floats). However, the old version in nsSpaceManager had no such check. In situations with integer overflow in nsSpaceManager.mY, that made nsSpaceManager::ClearFloats return the wrong value, which made us set "clearanceFrame" when we shouldn't, which messed up our handling of placeholders.
IN MORE DETAIL:
(note: below I use "mXXXManager" to refer to mSpaceManager / mFloatManager)
We start off with an integer overflow in the margin-top value, at -2^31 = -214748364 app-units. This traces all the way back to the CSS engine, with a call to nsStyleSides::GetTop (as "styleMargin->mMargin.GetTop()").
Then, during reflow, this happens:
- We hit a call to nsBlockFrame::ReflowBlockFrame on the innermost block that I listed in the frametree snippets above. During that, we call aState.ClearFloats, passing in 0.
- This method calls mXXXManager::ClearFloats, again passing in 0. (Note that at this point, mXXXManager.mY is -2^31)
- IN NEW CODE: We start out by checking "HaveAnyFloats()". We don't have any, so we just return aY, which is 0.
- IN OLD CODE: There's no initial "HaveAnyFloats"-type check, so we plod ahead through the function. We start out by setting "bottom" = mY == -2^31. Then, through a PR\_MAX call, we end up \_increasing\_ bottom to be mMaximalLeftYMost, which is currently nscoord\_MIN == -2^30. Then, finally, we subtract mY = -2^31 off of bottom, which leaves us with (positive) nscoord\_MAX. We return that.
This returned value is passed back up to nsBlockFrame::ReflowBlockFrame and is stored in "clearY". We compare that to curY, at nsBlockFrame.cpp:2915
- IN NEW CODE: clearY == curY == 0. (they're equal)
- IN OLD CODE: clearY is nscoord\_MAX, curY is 0. (they're \*\*not equal\*\*)
So in old code, that makes us evaluate the next clause, which assigns a value to aState.mReflowState.mDiscoveredClearance. (This value never gets set in new code). This "mDiscoveredClearance" is just an alias for a local variable "clearanceFrame" up a few levels in another call to nsBlockFrame::ReflowBlockFrame. When we set this value, it affects our execution path in that function, apparently messing up our handling of placeholder frames.
Then, the crash happens later on, because we assume the fixed-position block has a placeholder frame, when in fact it doesn't (as indicated in the final assertion in [comment 0](/show_bug.cgi?id=467493#c0 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos")).
Note that if I simply tweak the faulty "nsSpaceManager::ClearFloats" call to make it return 0 instead of nscoord\_MAX, then everything goes fine -- no crash, no assertions.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=467493#c16)• 16 years ago |
|  | |

if it's not clear, [comment 15](/show_bug.cgi?id=467493#c15 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos") was in reply to this bit of [comment 8](/show_bug.cgi?id=467493#c8 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"):
> If this was fixed by [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats"), it would be good to know why.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=467493#c17)• 16 years ago |
|  | |

Conclusion from [comment 15](/show_bug.cgi?id=467493#c15 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"):
---------------------------
To fix this particular bug on 1.9.1, it'd probably be sufficient to just add a check with nsSpaceManager's equivalent of "HaveAnyFloats" at the beginning of the ClearFloats method, to match nsFloatManager's behavior there. However, it might be better to just take the whole nsFloatManager patch, since it's been successfully baked on mozilla-central for a little while now. (and it also fixes the sg:crit [bug 437565](/show_bug.cgi?id=437565 "VERIFIED FIXED - Crash [@ nsSpaceManager::GetPrevBand] with floats after nscoord_MAX of height"))
We should make a decision about point this ASAP, to make sure that whatever patch that we land for this will get beta coverage.
Side note:
----------
The root cause of this bug is that large positive margin values suddenly overflow into negative territory (INT\_MIN) somewhere in the CSS engine. It'd be much nicer (and would give much more predictable behavior) if we could cap them at INT\_MAX (if not nscoord\_MAX), rather than letting them take that extra step to INT\_MIN. That would probably help a lot with preventing these sorts of bugs.

|  | [cmtalbert](/user_profile?user_id=250777) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=467493#c18)• 16 years ago |
|  | |

(In reply to [comment #17](/show_bug.cgi?id=467493#c17 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
> Conclusion from [comment 15](/show_bug.cgi?id=467493#c15 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"):
> ---------------------------
> To fix this particular bug on 1.9.1, it'd probably be sufficient to just add a
> check with nsSpaceManager's equivalent of "HaveAnyFloats" at the beginning of
> the ClearFloats method, to match nsFloatManager's behavior there. However, it
> might be better to just take the whole nsFloatManager patch, since it's been
> successfully baked on mozilla-central for a little while now. (and it also
> fixes the sg:crit [bug 437565](/show_bug.cgi?id=437565 "VERIFIED FIXED - Crash [@ nsSpaceManager::GetPrevBand] with floats after nscoord_MAX of height"))
>
> We should make a decision about point this ASAP, to make sure that whatever
> patch that we land for this will get beta coverage.
>
I checked the crash-reporter database and we don't have any user-reported crashes in there of this crash on 1.9.1. Now, that said, if there is a known fix for this, if that fix has baked on trunk without issue for a while and if that fix also fixes a sg:crit bug, I think we should take it on the branch. This is already marked as "blocking 1.9.1" so, it shouldn't need approval, I think the patch that fixes it ought to just land on 1.9.1.
> Side note:
> ----------
> The root cause of this bug is that large positive margin values suddenly
> overflow into negative territory (INT\_MIN) somewhere in the CSS engine. It'd
> be much nicer (and would give much more predictable behavior) if we could cap
> them at INT\_MAX (if not nscoord\_MAX), rather than letting them take that extra
> step to INT\_MIN. That would probably help a lot with preventing these sorts of
> bugs.
That's undoubtedly a problem too, but should probably be a follow-up bug.

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=467493#c19)• 16 years ago |
|  | |

(In reply to [comment #18](/show_bug.cgi?id=467493#c18 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
> This is already marked as "blocking 1.9.1" so, it shouldn't need approval, I
> think the patch that fixes it ought to just land on 1.9.1.
I'd wanted to get dbaron's opinion first, since he wrote the patch that fixes this (in [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats")) & he briefly commented above on its appropriateness for 1.9.1, in [comment 8](/show_bug.cgi?id=467493#c8 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos").
dbaron, (a) does the explanation in [comment 15](/show_bug.cgi?id=467493#c15 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos") make sense to you, and (b) would you be comfortable with [bug 191448](/show_bug.cgi?id=191448 "VERIFIED FIXED - space manager too limited for handling floats")'s patch landing on 1.9.1?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=467493#c20)• 16 years ago |
|  | |

Excellent -- it looks like dbaron fixed this on 1.9.1 in [bug 191448 comment 32](/show_bug.cgi?id=191448#c32 "VERIFIED FIXED - space manager too limited for handling floats"). Adding fixed1.9.1 keyword.Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)Whiteboard: [sg:critical?][fixed by 191448 on 1.9.2] → [sg:critical?]

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a6358316_278074)• 16 years ago |

Flags: in-testsuite?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a8426418_1689)• 16 years ago |

Flags: wanted1.9.0.x+Flags: blocking1.9.0.8-

|  | [Marcia Knous [:marcia]](/user_profile?user_id=8519) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=467493#c21)• 16 years ago |
|  | |

Verified fixed on the 1.9.1 branch using Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1b4pre) Gecko/20090422 Shiretoko/3.5b4pre. Both test cases no longer crash.Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---) → [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=467493#c22)• 16 years ago |
|  | |

Attached patch

[fix for 1.9.0.x?](attachment.cgi?id=382825&action=diff) (obsolete)
— [Details](attachment.cgi?id=382825&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=467493&attachment=382825)

(In reply to [comment #15](/show_bug.cgi?id=467493#c15 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
> The new nsFloatManager::ClearFloats method includes an initial "HaveAnyFloats"
> check (with an immediate return, if we don't have floats). However, the old
> version in nsSpaceManager had no such check.
Here's a patch that simply adds this one check. (Note: I mistyped in the quoted bit above -- the correct function name is "HasAnyFloats", not "HaveAnyFloats")
This fixes the crash on both expected-to-crash testcases, in 1.9.0.x.
dbaron, do you think this check is safe to add on its own?
[Attachment #382825](/attachment.cgi?id=382825&action=edit "fix for 1.9.0.x?") -
Flags: review?(dbaron)

|  | [David Baron :dbaron: (⌚️UTC-4, no longer working on Mozilla)](/user_profile?user_id=3881) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=467493#c23)• 16 years ago |
|  | |

Does it fix the crash if you add an unrelated float (inside the correct block) to those expected-to-crash testcases?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a16633006_1689)• 16 years ago |

Flags: blocking1.9.0.13?

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=467493#c24)• 16 years ago |
|  | |

Attached file
[testcase 3 [moved to bug 502017]](attachment.cgi?id=386544)
— [Details](attachment.cgi?id=386544&action=edit)

(In reply to [comment #23](/show_bug.cgi?id=467493#c23 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
> Does it fix the crash if you add an unrelated float (inside the correct block)
> to those expected-to-crash testcases?
Good question -- sadly [attachment 382825](/attachment.cgi?id=382825 "fix for 1.9.0.x?") [[details]](/attachment.cgi?id=382825&action=edit "fix for 1.9.0.x?") [[diff]](/attachment.cgi?id=382825&action=diff "fix for 1.9.0.x?") [[review]](/page.cgi?id=splinter.html&ignore=&bug=467493&attachment=382825) does \*not\* fix the crash on
1.9.0.x if we add a float inside the first div. (as demonstrated by this new testcase)
[Attachment #382825](/attachment.cgi?id=382825&action=edit "fix for 1.9.0.x?") -
Attachment is obsolete: true
[Attachment #382825](/attachment.cgi?id=382825&action=edit "fix for 1.9.0.x?") -
Flags: review?(dbaron)

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=467493#c25)• 16 years ago |
|  | |

testcase 3 is WFM on mozilla-central, but it actually crashes on 1.9.1, in both debug builds and in the stock Firefox 3.5 release! (and on 1.9.0.x, as stated in [comment 24](/show_bug.cgi?id=467493#c24 "RESOLVED WORKSFORME - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos"))
Testcases 1 and 2 still don't crash on 1.9.1, though.
1.9.1 crash report for testcase 3:
<http://crash-stats.mozilla.com/report/pending/f7955dc3-a1ff-4e8a-a542-bdc8f2090702>
Perhaps I'll file a new bug on testcase 3, since this bug here was already marked verified1.9.1 (for the first two testcases)
CRASHY 1.9.1 build:
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5
WFM mozilla-central build:
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.2a1pre) Gecko/20090701 Minefield/3.6a1pre

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a18360597_278074)• 16 years ago |

Blocks: [502017](/show_bug.cgi?id=502017 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float")

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=467493#c26)• 16 years ago |
|  | |

Comment on [attachment 386544](/attachment.cgi?id=386544 "testcase 3 [moved to bug 502017]") [[details]](/attachment.cgi?id=386544&action=edit "testcase 3 [moved to bug 502017]")
testcase 3 [moved to [bug 502017](/show_bug.cgi?id=502017 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float")]
I've filed [bug 502017](/show_bug.cgi?id=502017 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float") on the "testcase 3" crash in 1.9.1.
[Attachment #386544](/attachment.cgi?id=386544&action=edit "testcase 3 [moved to bug 502017]") -
Attachment description: testcase 3 → testcase 3 [moved to bug 502017]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a18720972_1689)• 16 years ago |

Flags: blocking1.9.0.13?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a19052672_1689)• 16 years ago |

Flags: blocking1.9.0.13+

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=467493#c27)• 16 years ago |
|  | |

The patch posted in [bug 502017](/show_bug.cgi?id=502017 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float") fixes the crashes in all of the testcases posted here, on 1.9.0.x branch, as noted in [bug 502017 comment 15](/show_bug.cgi?id=502017#c15 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float").

|  | [Daniel Holbert [:dholbert]](/user_profile?user_id=278074) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=467493#c28)• 16 years ago |
|  | |

That patch just landed, in per [bug 502017 comment 17](/show_bug.cgi?id=502017#c17 "RESOLVED FIXED - Crash [@ nsHTMLReflowState::GetHypotheticalBoxContainer] with -moz-column, overflow, clear, margin, fixed pos, and float"). --> This is fixed1.9.0.13Keywords: [fixed1.9.0.13](/buglist.cgi?keywords=fixed1.9.0.13&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=467493#c29)• 16 years ago |
|  | |

Verified fixed for 1.9.0.13 with my own debug build (Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.13pre) Gecko/2009072417 GranParadiso/3.0.13pr). No crashes with attached testcases.Keywords: [fixed1.9.0.13](/buglist.cgi?keywords=fixed1.9.0.13&resolution=---) → [verified1.9.0.13](/buglist.cgi?keywords=verified1.9.0.13&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a23203011_1689)• 15 years ago |

[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_191&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a24592375_1689)• 15 years ago |

Group: core-security

|  | [Jesse Ruderman](/user_profile?user_id=11608)  Reporter |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=467493#c30)• 15 years ago |
|  | |

Crashtest: <http://hg.mozilla.org/mozilla-central/rev/4da43cad0331>Flags: in-testsuite? → in-testsuite+

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=467493#a79787137_1)• 14 years ago |

Crash Signature: [@ nsHTMLReflowState::GetHypotheticalBoxContainer]
You need to [log in](/show_bug.cgi?id=467493&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Jesse Ruderman](/user_profile?user_id=11608)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from bugzilla.mozilla.org_60f599c0_20250126_124422.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/507292)
* [XML](/show_bug.cgi?ctype=xml&id=507292)

Closed
[Bug 507292](/show_bug.cgi?id=507292)

Opened 15 years ago
Closed 15 years ago

# Incorrect upvar access on trace involving top-level scripts

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Incorrect upvar access on trace involving top-level scripts

## Categories

### (Core :: JavaScript Engine, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=JavaScript%20Engine#JavaScript%20Engine)

JavaScript Engine
▾

Core :: JavaScript Engine
The interpreter engine for the core JavaScript language, independent of the browser's object model. File ONLY core JavaScript language bugs in this category. For bugs involving browser objects such as "window" and "document", use the "DOM" component. For bugs involving calls between JavaScript and C++, use the "XPConnect" component.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=JavaScript%20Engine&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=JavaScript%20Engine)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 | --- | [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed) |
| blocking1.9.1 | --- | [.3+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.3%2B) |
| status1.9.1 | --- | [.3-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.3-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| status1.9.2 |  | beta1-fixed |
| blocking1.9.1 |  | .3+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .3-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: cbook, Assigned: gal)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/86d014603512abf3c5966ea995551a53?d=mm&size=40)  [gal](/user_profile?user_id=310943)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=40)  [cbook](/user_profile?user_id=277293)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/4fe52ee1503aecf7b6c976b8eb7c1753?d=mm&size=40)  [willyelm](/user_profile?user_id=714609)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

20 people

## References

### ( [URL](http://www.warcraftlatino.com/ulduar/rank.html "http://www.warcraftlatino.com/ulduar/rank.html") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[warcraftlatino.com/ulduar/rank.html](http://www.warcraftlatino.com/ulduar/rank.html "http://www.warcraftlatino.com/ulduar/rank.html")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: crash, testcase, Whiteboard: [sg:critical?], fixed-in-tracemonkey)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?], fixed-in-tracemonkey

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [damons](/user_profile?user_id=269330) | [blocking1.9.2](#c40 "15 years ago") | + |
| --- | --- | --- |
| [damons](/user_profile?user_id=269330) | blocking1.9.2 | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#c29 "15 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | [in-testsuite](#c42 "15 years ago") | - |
| --- | --- | --- |
| [decoder](/user_profile?user_id=395101) | in-testsuite | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files, 4 obsolete files)

| [shell testcase (unreduced)](/attachment.cgi?id=391746)  [15 years ago](#c12)  [Andreas Gal :gal](/user_profile?user_id=310943)   6.34 KB, text/plain |  | [Details](/attachment.cgi?id=391746&action=edit) |
| --- | --- | --- |
| [partially reduced testcase](/attachment.cgi?id=391749)  [15 years ago](#c13)  [Andreas Gal :gal](/user_profile?user_id=310943)   3.19 KB, application/x-javascript |  | [Details](/attachment.cgi?id=391749&action=edit) |
| [reduced testcase](/attachment.cgi?id=391751)  [15 years ago](#c14)  [Andreas Gal :gal](/user_profile?user_id=310943)   316 bytes, application/x-javascript |  | [Details](/attachment.cgi?id=391751&action=edit) |
| [without type instability and constructor](/attachment.cgi?id=391753)  [15 years ago](#c17)  [Andreas Gal :gal](/user_profile?user_id=310943)   328 bytes, application/x-javascript |  | [Details](/attachment.cgi?id=391753&action=edit) |
| [fully reduced testcase](/attachment.cgi?id=391754)  [15 years ago](#c18)  [Andreas Gal :gal](/user_profile?user_id=310943)   195 bytes, application/x-javascript |  | [Details](/attachment.cgi?id=391754&action=edit) |
| [patch based on dmandelin's stack math](/attachment.cgi?id=391770)  [15 years ago](#c20)  [Andreas Gal :gal](/user_profile?user_id=310943)   781 bytes, patch | dmandelin : [review+](#a92198_294323 "15 years ago")  dveditz : [approval1.9.1.3+](#c30 "15 years ago") | [Details](/attachment.cgi?id=391770&action=edit) | [Diff](/attachment.cgi?id=391770&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=507292&attachment=391770) |
| [slightly different test](/attachment.cgi?id=391784)  [15 years ago](#c26)  [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402)   334 bytes, text/plain |  | [Details](/attachment.cgi?id=391784&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=507292#c0)• 15 years ago |
|  | |

BuildID=20090727101705
Steps to reproduce: Load <http://www.warcraftlatino.com/ulduar/rank.html>
(c20.bb4): Access violation - code c0000005 (first chance)
First chance exceptions are reported before any exception handling.
This exception may be expected and handled.
eax=04859130 ebx=7ffdf000 ecx=072a0410 edx=c0000005 esi=0000000f edi=00c8f6f0
eip=00519bd4 esp=0012e718 ebp=0012ee44 iopl=0 nv up ei pl nz na pe nc
cs=001b ss=0023 ds=0023 es=0023 fs=003b gs=0000 efl=00010206
js3250!js\_Interpret+0x103b4:
00519bd4 8b02 mov eax,dword ptr [edx] ds:0023:c0000005=????????
0:000> !exploitable -v
HostMachine\HostUser
Executing Processor Architecture is x86
Debuggee is in User Mode
Debuggee is a live user mode debugging session on the local machine
Event Type: Exception
Exception Faulting Address: 0xffffffffc0000005
First Chance Exception Type: STATUS\_ACCESS\_VIOLATION (0xC0000005)
Exception Sub-Type: Read Access Violation
Faulting Instruction:00519bd4 mov eax,dword ptr [edx]
Basic Block:
00519bd4 mov eax,dword ptr [edx]
Tainted Input Operands: edx
00519bd6 mov ecx,dword ptr [eax+0ch]
Tainted Input Operands: eax
00519bd9 call ecx
Tainted Input Operands: ecx, edx
Exception Hash (Major/Minor): 0x2a690d26.0x1548251d
Stack Trace:
js3250!js\_Interpret+0x103b4
js3250!js\_Execute+0x2e6
js3250!JS\_EvaluateUCScriptForPrincipals+0xe7
gklayout!nsJSContext::EvaluateString+0x2c0
gklayout!nsScriptLoader::EvaluateScript+0x37a
gklayout!nsScriptLoader::ProcessRequest+0xfd
gklayout!nsScriptLoader::ProcessScriptElement+0x1040
gklayout!nsScriptElement::MaybeProcessScript+0x149
gklayout!nsHTMLScriptElement::MaybeProcessScript+0x24
gklayout!nsHTMLScriptElement::DoneAddingChildren+0x1f
gklayout!HTMLContentSink::ProcessSCRIPTEndTag+0xcf
gklayout!SinkContext::CloseContainer+0x31d
gklayout!HTMLContentSink::CloseContainer+0xa0
gkparser!CNavDTD::CloseContainer+0x18a
gkparser!CNavDTD::HandleEndToken+0x214
gkparser!CNavDTD::HandleToken+0x4ae
gkparser!CNavDTD::BuildModel+0x298
gkparser!nsParser::BuildModel+0xe2
gkparser!nsParser::ResumeParse+0x1bc
gkparser!nsParser::ContinueInterruptedParsing+0xe5
gklayout!nsContentSink::ContinueInterruptedParsingIfEnabled+0x54
gklayout!nsRunnableMethod<nsContentSink>::Run+0x24
xpcom\_core!nsThread::ProcessNextEvent+0x1fa
xpcom\_core!NS\_ProcessNextEvent\_P+0x53
gkwidget!nsBaseAppShell::Run+0x5d
tkitcmps!nsAppStartup::Run+0x6b
xul!XRE\_main+0x3000
firefox!NS\_internal\_main+0x2b2
firefox!wmain+0x119
firefox!\_\_tmainCRTStartup+0x1a6
firefox!wmainCRTStartup+0xd
kernel32!BaseProcessStart+0x23
Instruction Address: 0x0000000000519bd4
Description: Data from Faulting Address controls Code Flow
Short Description: TaintedDataControlsCodeFlow
Exploitability Classification: PROBABLY\_EXPLOITABLE
Recommended Bug Title: Probably Exploitable - Data from Faulting Address controls Code Flow starting at js3250!js\_Interpret+0x00000000000103b4 (Hash=0x2a690d26.0x1548251d)
The data from the faulting address is later used as the target for a branch.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=507292#c1)• 15 years ago |
|  | |

stack:
js3250!js\_Interpret(struct JSContext \* cx = 0x04859130)+0x103b4 [c:\work\mozilla\builds\1.9.1\mozilla\js\src\jsinterp.cpp @ 4838]
js3250!js\_Execute(struct JSContext \* cx = 0x04859130, struct JSObject \* chain = 0x072806c0, struct JSScript \* script = 0x05d15bf0, struct JSStackFrame \* down = 0x00000000, unsigned int flags = 0, int \* result = 0x00000000)+0x2e6 [c:\work\mozilla\builds\1.9.1\mozilla\js\src\jsinterp.cpp @ 1622]
js3250!JS\_EvaluateUCScriptForPrincipals(struct JSContext \* cx = 0x04859130, struct JSObject \* obj = 0x072806c0, struct JSPrincipals \* principals = 0x05cb7e0c, unsigned short \* chars = 0x05d0e358, unsigned int length = 0x7a8, char \* filename = 0x05c72720 "<http://www.warcraftlatino.com/ulduar/rank.html>", unsigned int lineno = 0xf, int \* rval = 0x00000000)+0xe7 [c:\work\mozilla\builds\1.9.1\mozilla\js\src\jsapi.cpp @ 5145]
gklayout!nsJSContext::EvaluateString(class nsAString\_internal \* aScript = 0x0012f0bc, void \* aScopeObject = 0x072806c0, class nsIPrincipal \* aPrincipal = 0x05cb7e08, char \* aURL = 0x05c72720 "<http://www.warcraftlatino.com/ulduar/rank.html>", unsigned int aLineNo = 0xf, unsigned int aVersion = 0, class nsAString\_internal \* aRetValue = 0x00000000, int \* aIsUndefined = 0x0012f07c)+0x2c0 [c:\work\mozilla\builds\1.9.1\mozilla\dom\src\base\nsjsenvironment.cpp @ 1631]
gklayout!nsScriptLoader::EvaluateScript(class nsScriptLoadRequest \* aRequest = 0x05d0e2e0, class nsString \* aScript = 0x0012f0bc)+0x37a [c:\work\mozilla\builds\1.9.1\mozilla\content\base\src\nsscriptloader.cpp @ 686]
gklayout!nsScriptLoader::ProcessRequest(class nsScriptLoadRequest \* aRequest = 0x05d0e2e0)+0xfd [c:\work\mozilla\builds\1.9.1\mozilla\content\base\src\nsscriptloader.cpp @ 600]
gklayout!nsScriptLoader::ProcessScriptElement(class nsIScriptElement \* aElement = 0x05d0d844)+0x1040 [c:\work\mozilla\builds\1.9.1\mozilla\content\base\src\nsscriptloader.cpp @ 554]
gklayout!nsScriptElement::MaybeProcessScript(void)+0x149 [c:\work\mozilla\builds\1.9.1\mozilla\content\base\src\nsscriptelement.cpp @ 193]
gklayout!nsHTMLScriptElement::MaybeProcessScript(void)+0x24 [c:\work\mozilla\builds\1.9.1\mozilla\content\html\content\src\nshtmlscriptelement.cpp @ 546]
gklayout!nsHTMLScriptElement::DoneAddingChildren(int aHaveNotified = 1)+0x1f [c:\work\mozilla\builds\1.9.1\mozilla\content\html\content\src\nshtmlscriptelement.cpp @ 484]
gklayout!HTMLContentSink::ProcessSCRIPTEndTag(class nsGenericHTMLElement \* content = 0x05d0d820, int aMalformed = 0)+0xcf [c:\work\mozilla\builds\1.9.1\mozilla\content\html\document\src\nshtmlcontentsink.cpp @ 3145]
gklayout!SinkContext::CloseContainer(nsHTMLTag aTag = eHTMLTag\_script (83), int aMalformed = 0)+0x31d [c:\work\mozilla\builds\1.9.1\mozilla\content\html\document\src\nshtmlcontentsink.cpp @ 1022]
gklayout!HTMLContentSink::CloseContainer(nsHTMLTag aTag = eHTMLTag\_script (83))+0xa0 [c:\work\mozilla\builds\1.9.1\mozilla\content\html\document\src\nshtmlcontentsink.cpp @ 2396]
gkparser!CNavDTD::CloseContainer(nsHTMLTag aTag = eHTMLTag\_script (83), int aMalformed = 0)+0x18a [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\cnavdtd.cpp @ 2804]
gkparser!CNavDTD::HandleEndToken(class CToken \* aToken = 0x05c7f6f0)+0x214 [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\cnavdtd.cpp @ 1683]
gkparser!CNavDTD::HandleToken(class CToken \* aToken = 0x05c7f6f0, class nsIParser \* aParser = 0x05cb8578)+0x4ae [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\cnavdtd.cpp @ 760]
gkparser!CNavDTD::BuildModel(class nsIParser \* aParser = 0x05cb8578, class nsITokenizer \* aTokenizer = 0x05cd4c70, class nsITokenObserver \* anObserver = 0x00000000, class nsIContentSink \* aSink = 0x05cbaf9c)+0x298 [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\cnavdtd.cpp @ 332]
gkparser!nsParser::BuildModel(void)+0xe2 [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\nsparser.cpp @ 2400]
gkparser!nsParser::ResumeParse(int allowIteration = 1, int aIsFinalChunk = 1, int aCanInterrupt = 1)+0x1bc [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\nsparser.cpp @ 2273]
gkparser!nsParser::ContinueInterruptedParsing(void)+0xe5 [c:\work\mozilla\builds\1.9.1\mozilla\parser\htmlparser\src\nsparser.cpp @ 1773]

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=507292#c2)• 15 years ago |
|  | |

FAULTING\_IP:
js3250!js\_Interpret+103b4 [c:\work\mozilla\builds\1.9.1\mozilla\js\src\jsinterp.cpp @ 4838]
00519bd4 8b02 mov eax,dword ptr [edx]
EXCEPTION\_RECORD: ffffffff -- (.exr ffffffffffffffff)
ExceptionAddress: 00519bd4 (js3250!js\_Interpret+0x000103b4)
ExceptionCode: c0000005 (Access violation)
ExceptionFlags: 00000000
NumberParameters: 2
Parameter[0]: 00000000
Parameter[1]: c0000005
Attempt to read from address c0000005
FAULTING\_THREAD: 00000bb4
DEFAULT\_BUCKET\_ID: APPLICATION\_FAULT
PROCESS\_NAME: firefox.exe
ERROR\_CODE: (NTSTATUS) 0xc0000005 - The instruction at "0x%08lx" referenced memory at "0x%08lx". The memory could not be "%s".
READ\_ADDRESS: c0000005
BUGCHECK\_STR: ACCESS\_VIOLATION
LAST\_CONTROL\_TRANSFER: from 005080e6 to 00519bd4
FOLLOWUP\_IP:
js3250!js\_Interpret+103b4 [c:\work\mozilla\builds\1.9.1\mozilla\js\src\jsinterp.cpp @ 4838]
00519bd4 8b02 mov eax,dword ptr [edx]
FAULTING\_SOURCE\_CODE:
4834: if (!js\_InternNonIntElementId(cx, obj, rval, &id))
4835: goto error;
4836: }
4837:
> 4838: if (!OBJ\_GET\_PROPERTY(cx, obj, id, &rval))
4839: goto error;
4840: end\_getelem:
4841: regs.sp--;
4842: STORE\_OPND(-1, rval);
4843: END\_CASE(JSOP\_GETELEM)
SYMBOL\_STACK\_INDEX: 0
FOLLOWUP\_NAME: MachineOwner
MODULE\_NAME: js3250
IMAGE\_NAME: js3250.dll
DEBUG\_FLR\_IMAGE\_TIMESTAMP: 4a6de171
SYMBOL\_NAME: js3250!js\_Interpret+103b4
STACK\_COMMAND: ~0s ; kb
FAILURE\_BUCKET\_ID: ACCESS\_VIOLATION\_js3250!js\_Interpret+103b4
BUCKET\_ID: ACCESS\_VIOLATION\_js3250!js\_Interpret+103b4

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=507292#c3)• 15 years ago |
|  | |

crashes mac 1.9.1/1.9.2 debug
Program received signal EXC\_BAD\_ACCESS, Could not access memory.
Reason: KERN\_INVALID\_ADDRESS at address: 0xc0000005
0x002fbaee in js\_Interpret (cx=0x1441200) at /work/mozilla/builds/1.9.1/mozilla/js/src/jsinterp.cpp:4838
4838 if (!OBJ\_GET\_PROPERTY(cx, obj, id, &rval))
(gdb) bt
#0 0x002fbaee in js\_Interpret (cx=0x1441200) at /work/mozilla/builds/1.9.1/mozilla/js/src/jsinterp.cpp:4838
#1 0x00312c82 in js\_Execute (cx=0x1441200, chain=0x16f80aa0, script=0x1d2ad2d0, down=0x0, flags=0, result=0x0) at jsinterp.cpp:1622
#2 0x0028f201 in JS\_EvaluateUCScriptForPrincipals (cx=0x1441200, obj=0x16f80aa0, principals=0x17489954, chars=0x15bd808, length=1960, filename=0x16e95938 "<http://www.warcraftlatino.com/ulduar/rank.html>", lineno=15, rval=0x0) at /work/mozilla/builds/1.9.1/mozilla/js/src/jsapi.cpp:5145
#3 0x134a7531 in nsJSContext::EvaluateString (this=0x1c56ea00, aScript=@0xbfffc974, aScopeObject=0x16f80aa0, aPrincipal=0x17489950, aURL=0x16e95938 "<http://www.warcraftlatino.com/ulduar/rank.html>", aLineNo=15, aVersion=0, aRetValue=0x0, aIsUndefined=0xbfffc8f4) at /work/mozilla/builds/1.9.1/mozilla/dom/src/base/nsJSEnvironment.cpp:1631
#4 0x1327bb50 in nsScriptLoader::EvaluateScript (this=0x17489870, aRequest=0x1c9436a0, aScript=@0xbfffc974) at /work/mozilla/builds/1.9.1/mozilla/content/base/src/nsScriptLoader.cpp:686
...Keywords: [crash](/buglist.cgi?keywords=crash&resolution=---),
[testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)OS: Windows XP → AllVersion: 1.9.1 Branch → Trunk

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=507292#c4)• 15 years ago |
|  | |

Reproduced on Linux. The interpreter has a JSString that is tagged as an Object. With trace spew enabled this crashes in NativeToValue because it can't print the object classname.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=507292#c5)• 15 years ago |
|  | |

This is the same kind of bug that was exploited with the heap spray. High priority to fix.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=507292#c6)• 15 years ago |
|  | |

(In reply to [comment #4](/show_bug.cgi?id=507292#c4 "RESOLVED FIXED - Incorrect upvar access on trace involving top-level scripts"))
> Reproduced on Linux. The interpreter has a JSString that is tagged as an
> Object. With trace spew enabled this crashes in NativeToValue because it can't
> print the object classname.
I had a bug with that basic cause before. Is there some way we can prevent this condition earlier with more asserts or a LIR validator?

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=507292#c7)• 15 years ago |
|  | |

Maybe. This is probably another case of missing globals. Still investigating.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=507292#c8)• 15 years ago |
|  | |

Andreas: we're currently at the testing phase of Firefox 3.5.2; we can stop to pick up this fix and respin at the cost of a day's work. I guess the question is: can someone get trivially from the previous exploit to this one, or do you think it can wait for 3.5.3 which would be released in early September?

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=507292#c9)• 15 years ago |
|  | |

Trying to figure that out now. Keep doing what you are doing for now. We will post an update asap.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=507292#c10)• 15 years ago |
|  | |

This does not seem to crash on Tracemonkey tip debug, so we might have fixed this inadvertently (and very recently, if 1.9.2 still crashes). Could someone help out with bisecting this to the changeset in Tracemonkey that makes the crash go away? We will debug 1.9.1 in the meantime (where we can reproduce it).Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=507292#c11)• 15 years ago |
|  | |

1.9.2 tip (post graydon's backout is crashing too now, so no QA help needed for the moment.Keywords: [qawanted](/buglist.cgi?keywords=qawanted&resolution=---)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=507292#c12)• 15 years ago |
|  | |

Attached file
[shell testcase (unreduced)](attachment.cgi?id=391746) (obsolete)
— [Details](attachment.cgi?id=391746&action=edit)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a84962_310943)• 15 years ago |

[Attachment #391746](/attachment.cgi?id=391746&action=edit "shell testcase (unreduced)") -
Attachment is patch: false

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=507292#c13)• 15 years ago |
|  | |

Attached file
[partially reduced testcase](attachment.cgi?id=391749) (obsolete)
— [Details](attachment.cgi?id=391749&action=edit)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=507292#c14)• 15 years ago |
|  | |

Attached file
[reduced testcase](attachment.cgi?id=391751) (obsolete)
— [Details](attachment.cgi?id=391751&action=edit)

[Attachment #391746](/attachment.cgi?id=391746&action=edit "shell testcase (unreduced)") -
Attachment is obsolete: true
[Attachment #391749](/attachment.cgi?id=391749&action=edit "partially reduced testcase") -
Attachment is obsolete: true

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=507292#c15)• 15 years ago |
|  | |

We have an upvar inside a constructor here.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=507292#c16)• 15 years ago |
|  | |

Constructor is not necessary.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=507292#c17)• 15 years ago |
|  | |

Attached file
[without type instability and constructor](attachment.cgi?id=391753) (obsolete)
— [Details](attachment.cgi?id=391753&action=edit)

[Attachment #391751](/attachment.cgi?id=391751&action=edit "reduced testcase") -
Attachment is obsolete: true

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=507292#c18)• 15 years ago |
|  | |

Attached file
[fully reduced testcase](attachment.cgi?id=391754)
— [Details](attachment.cgi?id=391754&action=edit)

[Attachment #391753](/attachment.cgi?id=391753&action=edit "without type instability and constructor") -
Attachment is obsolete: true

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=507292#c19)• 15 years ago |
|  | |

The invocation of f has an extra arg. That seems to cause the upvar access of b in g to go wrong.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a89796_310943)• 15 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=507292#c20)• 15 years ago |
|  | |

Attached patch

[patch based on dmandelin's stack math](attachment.cgi?id=391770&action=diff)
— [Details](attachment.cgi?id=391770&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=507292&attachment=391770)

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=507292#c21)• 15 years ago |
|  | |

Please block 3.5.3 on this. We are testing the patch right now.

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=507292#c22)• 15 years ago |
|  | |

The bug is caused by an incorrect computation of |spoffset| in the special case of |callDepth == 0| (i.e., top-level script), as fixed in the patch:
if (callDepth == 0)
- fi->spoffset = 2 /\*callee,this\*/ + argc - fi->spdist;
+ fi->spoffset = -fp->script->nfixed;
Given that the correct computation is much simpler than the incorrect one, it's hard to explain what I was thinking the first time around. :-) The key invariant for |spoffset| is that:
|native\_start| + |spoffset| = |slots|
where |native\_start| is the address of the jsval referred to by the
0th element in the native stack area
|slots| is the address of the caller jsval slots area
(The purpose of this invariant is that FrameInfo::spdist allows us to navigate from caller &slots[0] to callee &slots[0], which is how we navigate the frames. So we need a way to get to the trace entry active frame &slots[0].)
|native\_start| in this case is StackBase(fp) for the outermost frame. Thus, we should compute
spoffset = slots - StackBase(fp)
= slots - (slots + nfixed)
= -nfixed
The first time I wrote the code, I wasn't thinking about StackBase or nfixed. Also, I incorrectly assumed that at a top-level call site, the only things that would be on the stack would be the args, and from there I worked out the original computation, which is in fact correct when there are no other values on the stack, but is not correct in general.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=507292#c23)• 15 years ago |
|  | |

Verified in a TM debug build with patch applied.

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a92167_310943)• 15 years ago |

[Attachment #391770](/attachment.cgi?id=391770&action=edit "patch based on dmandelin's stack math") -
Flags: review?(dmandelin)
[Attachment #391770](/attachment.cgi?id=391770&action=edit "patch based on dmandelin's stack math") -
Flags: approval1.9.1.3?

|  | [David Mandelin [:dmandelin]](/user_profile?user_id=294323) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a92198_294323)• 15 years ago |

[Attachment #391770](/attachment.cgi?id=391770&action=edit "patch based on dmandelin's stack math") -
Flags: review?(dmandelin) → review+

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a92527_310943)• 15 years ago |

Summary: Probably Exploitable - Data from Faulting Address controls Code Flow starting at js3250!js\_Interpret+0x00000000000103b4 → Incorrect upvar access on trace involving top-level scripts

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a92722_310943)• 15 years ago |

Whiteboard: [sg:critical?]

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=507292#c24)• 15 years ago |
|  | |

<http://hg.mozilla.org/tracemonkey/rev/ccef1758e1b8>Hardware: x86 → AllWhiteboard: [sg:critical?] → [sg:critical?], fixed-in-tracemonkey

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a93610_159758)• 15 years ago |

Assignee: general → gal

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=507292#c25)• 15 years ago |
|  | |

Dmandelin did most of the work on this bug.

|  | [Bob Clary [:bc] (inactive)](/user_profile?user_id=23402) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=507292#c26)• 15 years ago |
|  | |

Attached file
[slightly different test](attachment.cgi?id=391784)
— [Details](attachment.cgi?id=391784&action=edit)

this behaved differently for me on 1.9.1 and 1.9.2 from Andreas' test case, so I'm including here. It is fixed in the shell on tracemonkey just as Andreas' is.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=507292#c27)• 15 years ago |
|  | |

I un-hid comments 5, 8, and 9. This is already a private bug. There's no reason for them to be private as well and it actually hurts us if we want to CC someone that doesn't normally have security bug access since they can't see those comments.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a101627_137548)• 15 years ago |

blocking1.9.1: ? → .3+

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a112891_76551)• 15 years ago |

Flags: in-testsuite?Flags: blocking1.9.2?Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=507292#c28)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/ccef1758e1b8>Status: NEW → RESOLVEDClosed: 15 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=507292#c29)• 15 years ago |
|  | |

Just to confirm, we do not need any upvar-related fixes on the 1.9.0 branch right?
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: wanted1.9.0.x-

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=507292#c30)• 15 years ago |
|  | |

Comment on [attachment 391770](/attachment.cgi?id=391770 "patch based on dmandelin's stack math") [[details]](/attachment.cgi?id=391770&action=edit "patch based on dmandelin's stack math") [[diff]](/attachment.cgi?id=391770&action=diff "patch based on dmandelin's stack math") [[review]](/page.cgi?id=splinter.html&ignore=&bug=507292&attachment=391770)
patch based on dmandelin's stack math
Approved for 1.9.1.3, a=dveditz for release-drivers
[Attachment #391770](/attachment.cgi?id=391770&action=edit "patch based on dmandelin's stack math") -
Flags: approval1.9.1.3? → approval1.9.1.3+

|  | [Brendan Eich [:brendan]](/user_profile?user_id=1214) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=507292#c31)• 15 years ago |
|  | |

(In reply to [comment #29](/show_bug.cgi?id=507292#c29 "RESOLVED FIXED - Incorrect upvar access on trace involving top-level scripts"))
> Just to confirm, we do not need any upvar-related fixes on the 1.9.0 branch
> right?
Right.
/be

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=507292#c32)• 15 years ago |
|  | |

gal/sayrer: Is this going to land on 1.9.1 tonight? It's a 1.9.1.3 blocker and code freeze was technically last night, but was extended one day...

|  | [Andreas Gal :gal](/user_profile?user_id=310943)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=507292#c33)• 15 years ago |
|  | |

I can't land. sayrer is on a plane. Asking around for help.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=507292#c34)• 15 years ago |
|  | |

Waldo just landed a JS bug, might be able to land this as well. (I was going to ping him on IRC, but he's just signed off.)

|  | [Blake Kaplan (:mrbkap) (inactive)](/user_profile?user_id=69426) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=507292#c35)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/0d6e6ae6ba52>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.3-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.3-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=507292#c36)• 15 years ago |
|  | |

Carsten, can you verify that this is fixed in the 1.9.1 build from 8/17/2009?

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=507292#c37)• 15 years ago |
|  | |

This bug is basically supplanted by [bug 510987](/show_bug.cgi?id=510987 "RESOLVED FIXED - GetUpvarOnTrace reads from wrong frame"). The problem is superficially mitigated here but underneath the hood, stack computation is still wrong.

|  | [Carsten Book [:Tomcat]](/user_profile?user_id=277293)  Reporter |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=507292#c38)• 15 years ago |
|  | |

verified on Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.1.3pre) Gecko/20090819 Shiretoko/3.5.3pre - no crash

|  | [David Anderson [:dvander] - inactive, e-mail if emergency](/user_profile?user_id=309316) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=507292#c39)• 15 years ago |
|  | |

I should clarify: this is not fixed. It no longer crashes but the fix is incorrect.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=507292#a3957414_1689)• 15 years ago |

Group: core-security

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=507292#c40)• 15 years ago |
|  | |

Blocking 1.9.2 P1, but [bug 510987](/show_bug.cgi?id=510987 "RESOLVED FIXED - GetUpvarOnTrace reads from wrong frame") is a better fix for this.Flags: blocking1.9.2? → blocking1.9.2+Priority: -- → P1

|  | [Robert Sayre](/user_profile?user_id=180188) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=507292#c41)• 15 years ago |
|  | |

this was fixed before 1.9.2 branched
[status1.9.2](/buglist.cgi?f1=cf_status_192&o1=isnotempty):
--- → [beta1-fixed](/buglist.cgi?f1=cf_status_192&o1=equals&v1=beta1-fixed)

|  | [Christian Holler (:decoder)](/user_profile?user_id=395101) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=507292#c42)• 12 years ago |
|  | |

Filter on qa-project-auto-change:
Bug in removed tracer code, setting in-testsuite- flag.Flags: in-testsuite? → in-testsuite-
You need to [log in](/show_bug.cgi?id=507292&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Andreas Gal :gal](/user_profile?user_id=310943)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_66eedf0f_20250125_232120.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2009-47

## Crashes with evidence of memory corruption (rv:1.9.1.3/ 1.9.0.14)

Announced
September 9, 2009
Reporter
Mozilla developers and community
Impact
Critical
Products
Firefox
Fixed in

* Firefox 3.0.14
* Firefox 3.5.3

### Description

Mozilla developers and community members identified and fixed
several stability bugs in the browser engine used in Firefox and other
Mozilla-based products. Some of these crashes showed evidence of
memory corruption under certain circumstances and we presume that with
enough effort at least some of these could be exploited to run
arbitrary code.

### Workaround

Disable JavaScript until a version containing these fixes can be
installed.

### References

Steve Roussey reported a crash in the Firefox 3.5 browser engine that was fixed in Firefox 3.5.3.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=506838>
* [CVE-2009-3069](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3069)

Jesse Ruderman reported crashes in the browser engine which were fixed in Firefox 3.5 and Firefox 3.0.14.

* [Browser crashes - Firefox 3.5, Firefox 3.0.14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=430569,437565,465651)
* [CVE-2009-3070](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3070)

Daniel Holbert, Jesse Ruderman, Olli Pettay and toshi reported crashes in the browser engine which were fixed in Firefox 3.5.2 and Firefox 3.0.14.

* [Browser crashes - Firefox 3.5, Firefox 3.0.14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=493649,495444,490196,502017)
* [CVE-2009-3071](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3071)

Josh Soref, Jesse Ruderman, and Martijn Wargers reported crashes in the browser engine which were fixed in Firefox 3.5.3 and Firefox 3.0.14.

* [Browser crashes - Firefox 3.5.3, Firefox 3.0.14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=501900,508074,494283)
* [CVE-2009-3072](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3072)

Carsten Book reported a crash in the Firefox 3.5 JavaScript engine that was fixed in Firefox 3.5.3.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=507292>
* [CVE-2009-3073](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3073)

Jesse Ruderman reported a crash in the JavaScript engine which was fixed in Firefox 3.5 and Firefox 3.0.14.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=467493>
* [CVE-2009-3074](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3074)

Carsten Book and Taral reported crashes in the JavaScript engine which were fixed in Firefox 3.5.2 and Firefox 3.0.14.

* [Browser crashes - Firefox 3.5.2, Firefox 3.0.14](https://bugzilla.mozilla.org/buglist.cgi?bug_id=505305,441714)
* [CVE-2009-3075](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3075)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


