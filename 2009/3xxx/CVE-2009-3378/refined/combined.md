=== Content from www.vupen.com_cddaa5c4_20250126_004731.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.mozilla.org_77f1bf5a_20250126_131250.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/500311)
* [XML](/show_bug.cgi?ctype=xml&id=500311)

Closed
[Bug 500311](/show_bug.cgi?id=500311)

Opened 16 years ago
Closed 15 years ago

# crash while loading video clip [@ memcpy - oggplay\_data\_handle\_theora\_frame]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

crash while loading video clip [@ memcpy - oggplay\_data\_handle\_theora\_frame]

## Categories

### (Core :: Audio/Video, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Audio%2FVideo#Audio%2FVideo)

Audio/Video
▾

Core :: Audio/Video
For problems related to media (video/audio) -- especially when the reporter is not sure which area of the media stack the problem is in. This category will mostly be for untriaged video/audio issues. Bugs in this category will typically be moved to another media category during the triage process.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Audio%2FVideo&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Audio%2FVideo)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

critical

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.2a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.1 | --- | [.4+](/buglist.cgi?f1=cf_blocking_191&o1=equals&v1=.4%2B) |
| status1.9.1 | --- | [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| blocking1.9.1 |  | .4+ |
| relnote-firefox |  | --- |
| status1.9.1 |  | .4-fixed |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: jbecerra, Assigned: kinetik)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/aeea283b2f56b75a7c959ccfb660a619?d=mm&size=40)  [kinetik](/user_profile?user_id=274575)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/8679e1c6004dffb8ffd44e6419ac9474?d=mm&size=40)  [jbecerra](/user_profile?user_id=241759)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](extensions/Gravatar/web/default.jpg)  [jimm](/user_profile?user_id=279663)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

24 people

## References

### ( [URL](http://tinyvid.tv/show/2fb8pbzg1ahwj "http://tinyvid.tv/show/2fb8pbzg1ahwj") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding")

Dependency [tree](/showdependencytree.cgi?id=500311&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=500311)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[501890](/show_bug.cgi?id=501890 "RESOLVED DUPLICATE - Crash in jemalloc attempting to play video [@ fastcopy_I _VEC_memcpy oggplay_data_handle_theora_frame]"), [520518](/show_bug.cgi?id=520518 "VERIFIED DUPLICATE - seamonkey and firefox segfault on HTML5/video page [@ memcpy - oggplay_data_handle_theora_frame]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[tinyvid.tv/show/2fb8pbzg1ahwj](http://tinyvid.tv/show/2fb8pbzg1ahwj "http://tinyvid.tv/show/2fb8pbzg1ahwj")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:critical?] uninitialized memory)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---),
[verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:critical?] uninitialized memory

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [beltzner](/user_profile?user_id=137548) | [blocking1.9.1](#a75024_137548 "16 years ago") | - |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.1 | - |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | [blocking1.9.1.1](#a1702590_137548 "16 years ago") | - |
| --- | --- | --- |
| [beltzner](/user_profile?user_id=137548) | blocking1.9.1.1 | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.9.0.x](#c16 "16 years ago") | - |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.9.0.x | - |
| --- | --- | --- |
| [cpearce](/user_profile?user_id=287422) | [in-testsuite](#c33 "16 years ago") | + |
| --- | --- | --- |
| [cpearce](/user_profile?user_id=287422) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

[[@ memcpy - oggplay\_data\_handle\_theora\_frame ]](https://crash-stats.mozilla.org/signature/?signature=memcpy%20-%20oggplay_data_handle_theora_frame)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (4 files, 2 obsolete files)

| [testcase](/attachment.cgi?id=385294)  [16 years ago](#c19)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   54.53 KB, video/ogg |  | [Details](/attachment.cgi?id=385294&action=edit) |
| --- | --- | --- |
| [patch v0](/attachment.cgi?id=388421)  [16 years ago](#c25)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   3.14 KB, patch | cajbir : [review+](#a1919694_248229 "16 years ago") | [Details](/attachment.cgi?id=388421&action=edit) | [Diff](/attachment.cgi?id=388421&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=388421) |
| [patch v1](/attachment.cgi?id=391524)  [15 years ago](#c30)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   7.77 KB, patch |  | [Details](/attachment.cgi?id=391524&action=edit) | [Diff](/attachment.cgi?id=391524&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=391524) |
| [Patch - add test](/attachment.cgi?id=392425)  [15 years ago](#c32)  [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422)   66.78 KB, patch | roc : [review+](#a3479820_5038 "15 years ago") | [Details](/attachment.cgi?id=392425&action=edit) | [Diff](/attachment.cgi?id=392425&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=392425) |
| [patch v1 for 1.9.1](/attachment.cgi?id=399820)  [15 years ago](#c39)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   7.71 KB, patch |  | [Details](/attachment.cgi?id=399820&action=edit) | [Diff](/attachment.cgi?id=399820&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=399820) |
| [patch v1 for 1.9.1 with test](/attachment.cgi?id=399925)  [15 years ago](#c41)  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)   76.13 KB, patch | dveditz : [approval1.9.1.4+](#c43 "15 years ago") | [Details](/attachment.cgi?id=399925&action=edit) | [Diff](/attachment.cgi?id=399925&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=399925) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [juan becerra [:juanb]](/user_profile?user_id=241759)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=500311#c0)• 16 years ago |
|  | |

While testing Fx3.5rc3 on Vista, I visited the tinyvid.tv site and clicked on a few links, and one of them consistently crashed the browser while loading. It also crashes RC2, but does NOT crash in b4. Happens on Mac (latest Minefield).
<http://crash-stats.mozilla.com/report/index/75648029-65ea-433f-b3d1-ca3d62090624>
Steps:
1. Visit tinyvid.tv site
2. Click on clip "The Time Traveler's Wife trailer" link (video link is <http://tinyvid.tv/file/2fb8pbzg1ahwj.ogg>)
Expected: Play the clip
Actual: Browsers starts loading the clip, then crashes, consistently.Flags: blocking-firefox3.5?

|  | [:Gavin Sharp [email: gavin@gavinsharp.com]](/user_profile?user_id=103593) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a384_103593)• 16 years ago |

Component: General → Video/AudioFlags: blocking-firefox3.5?Product: Firefox → CoreQA Contact: general → video.audio

|  | [juan becerra [:juanb]](/user_profile?user_id=241759)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a432_241759)• 16 years ago |

Flags: blocking1.9.1?

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=500311#c1)• 16 years ago |
|  | |

Trunk crashes on OS X, too. It's a null pointer deref. Seems like we get a zeroed yuv\_buffer from theora\_decode\_YUVout:
#0 0x193f0d77 in oggplay\_data\_handle\_theora\_frame (decode=0x1c3a3db0, buffer=0xb054d9c4) at /Users/kinetik/work/mozilla-central/mozilla/media/liboggplay/src/liboggplay/oggplay\_data.c:365
365 memcpy(p, q, decode->y\_width);
(gdb) p q
$15 = (unsigned char \*) 0x0
(gdb) p \*buffer
$16 = {
y\_width = 0,
y\_height = 0,
y\_stride = 0,
uv\_width = 0,
uv\_height = 0,
uv\_stride = 0,
y = 0x0,
u = 0x0,
v = 0x0
}

|  | [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=500311#c2)• 16 years ago |
|  | |

On Windows trunk I get the buffer as full of 0xcdcdcdcd, which MS's debug libraries stamp over free'd memory. As a consequence the malloc on line 345 is trying to allocate 1253318069 bytes, which probably isn't helping either.
Seems like buffer is being used/passed in after its been free'd.

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=500311#c3)• 16 years ago |
|  | |

Confirmed crash on Linux i686 as well
Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1) Gecko/20090624012820 Firefox/3.5

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=500311#c4)• 16 years ago |
|  | |

(In reply to [comment #3](/show_bug.cgi?id=500311#c3 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> Confirmed crash on Linux i686 as well
>
> Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1) Gecko/20090624012820
> Firefox/3.5
(In reply to [comment #3](/show_bug.cgi?id=500311#c3 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> Confirmed crash on Linux i686 as well
>
> Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.1) Gecko/20090624012820
> Firefox/3.5
I retract that. I tested again, no crash but the video will not play properly.

|  | [fcp](/user_profile?user_id=277808) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=500311#c5)• 16 years ago |
|  | |

(In reply to [comment #2](/show_bug.cgi?id=500311#c2 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> On Windows trunk I get the buffer as full of 0xcdcdcdcd, which MS's debug
> libraries stamp over free'd memory. As a consequence the malloc on line 345 is
> trying to allocate 1253318069 bytes, which probably isn't helping either.
>
> Seems like buffer is being used/passed in after its been free'd.
In the debug heap of Visual C++, 0xCDCDCDCD means that the memory is allocated but not set to any values. Freed memory is filled with 0xDDDDDDDD.
<http://msdn.microsoft.com/en-us/library/bebs9zyz.aspx>

|  | [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=500311#c6)• 16 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=500311#c5 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> In the debug heap of Visual C++, 0xCDCDCDCD means that the memory is allocated
> but not set to any values. Freed memory is filled with 0xDDDDDDDD.
> <http://msdn.microsoft.com/en-us/library/bebs9zyz.aspx>
You're right, I stand corrected. Though I see 0xEEEEEEEE stamped on free'd memory, which is contrary to the documentation. Madness.

|  | [Aaron Train [:aaronmt]](/user_profile?user_id=299942) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=500311#c7)• 16 years ago |
|  | |

I get a different stack with the same crash on load of the above URL in Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.1) Gecko/20090624 Firefox/3.5. I know there has been some work related imgCacheEntry.
KERN\_PROTECTION\_FAILURE at address: 0x00000000
#0 0xffff0800 in \_\_\_memcpy () at /System/Library/Frameworks/System.framework/PrivateHeaders/i386/cpu\_capabilities.h:246
#1 0x01470683 in std::\_\_adjust\_heap<\_\_gnu\_cxx::\_\_normal\_iterator<nsRefPtr<imgCacheEntry>\*, std::vector<nsRefPtr<imgCacheEntry>, std::allocator<nsRefPtr<imgCacheEntry> > > >, int, nsRefPtr<imgCacheEntry>, bool (\*)(nsRefPtr<imgCacheEntry> const&, nsRefPtr<imgCacheEntry> const&)> ()

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=500311#c8)• 16 years ago |
|  | |

Hard to tell from the comments here on the severity, risk, etc. Do people think we should block on this?

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=500311#c9)• 16 years ago |
|  | |

So, the first time we call theora\_decode\_packetin for this video, th\_decode\_packetin returns TH\_DUPFRAME (which means there's no frame data to extract), and since this error is > 0, theora\_decode\_packetin returns 0. We then call theora\_decode\_YUVout, which returns no error, then pass the still uninitialized yuv\_buffer to oggplay\_data\_handle\_theora\_frame and crash.
If I force oggplay\_data\_handle\_theora\_frame to return early (with the debugger) for this frame, we do not crash. The video plays through, and replays from the beginning without crashing.
oggplayer doesn't crash when playing this video (with or without an oggplay\_seek after load\_metadata).

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=500311#c10)• 16 years ago |
|  | |

I'm not sure if we should block. I'm working on finding the regression range... that may help us understand the severity.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=500311#c11)• 16 years ago |
|  | |

Range is: <http://hg.mozilla.org/releases/mozilla-1.9.1/pushloghtml?startdate=2009-05-20&enddate=2009-05-22>
...which includes a large number of changes to that code. Working on narrowing down the culprit now.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=500311#c12)• 16 years ago |
|  | |

It would also be helpful to know why it's only one video on tinyvid.tv, and how that video got encoded with the bit that's causing us to crash

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=500311#c13)• 16 years ago |
|  | |

And the winner is: <http://hg.mozilla.org/mozilla-central/rev/c3bf078aded1> ([bug 493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding")).
The crash happens when loading via HTTP, but not with local files. I'm not yet sure why that is, given the patch that caused the regression. I've got a fix which I'm pretty sure is the correct thing to do, but I don't yet have an explanation for why this patch caused us to start crashing. Someone who understands oggplay better might be able to explain it. I'll CC Viktor.
The reason why we crash is that the first frame oggplay attempts to decode is a duplicate frame (TH\_DUPFRAME, which means it doesn't exist in the Theora stream, and you're expected to reuse the prior frame). The problem here is that it's the first frame we try to decode, so there's no prior frame data to reuse, and we end up using uninitialized data structures.
Except, it's not really the first frame, it's the second. oggplay incorrectly skips the first frame during decoding. When decoding headers, theora\_decode\_header eventually returns 0, which means all expected headers have been processed \*and the current packet is video data\*. The problem is, oggplay returns as if this was the last header packet, without attempting to decode the video data. This behaviour isn't clear from the old Theora API[0], but it is from the new Theora API[1]. Luckily, Chris Double has been working with the new API recently and pointed this behaviour out.
I'll attach the patch shortly, once I've run through mochitests, reftests, and done some more local testing.
Chris is going to analyze the files on tinyvid.tv and work out how many videos would return TH\_DUPFRAME on the second frame (the first that oggplay would try to decode) to work out how many we'd crash on. This'll give us a better idea of the scope of the bug.
I'm tempted to say that we should make this block anyway, because it'd be easy to construct a file that would invoke this crash, and since it causes us to pass uninitialized stack data to memcpy, there's some chance it could be a security risk. I'll mark this bug as sensitive, just to be sure. Feel free to unmark if you think I'm being paranoid.
[0] <http://theora.org/doc/libtheora-1.0/group__oldfuncs.html#g02915e63c1bd733ee291f577a8b75a82>
[1] <http://theora.org/doc/libtheora-1.0/group__decfuncs.html#g006d01d36fbe64768c571e6a12b7fc50>Group: core-security

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=500311#c14)• 16 years ago |
|  | |

roc/doublec: can you take a look at [comment 13](/show_bug.cgi?id=500311#c13 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]") and see if you agree? Blocking at this point likely means slipping release :(

|  | [timeless](/user_profile?user_id=15223) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a31466_15223)• 16 years ago |

Severity: normal → criticalKeywords: [crash](/buglist.cgi?keywords=crash&resolution=---)Summary: crash while loading video clip → crash while loading video clip [@ memcpy - oggplay\_data\_handle\_theora\_frame]

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=500311#c15)• 16 years ago |
|  | |

The patch changed whether the decoder is initialized as active (it used to be
active, now it's inactive). When it defaulted to active, it would decode a
bunch of packets before getting to the one causing the crash, so Theora's
internal state happened to be set up correctly. Now that it defaults to
inactive, none of the incoming packets are fed to the decoder until the decoder
is activated--and when that happens, the next packet is the one we crash on
with this file.
The HTTP vs local difference comes down to the fact that with a local file,
once the decoder is activated, the packets fed to oggplay\_callback\_theora
restart from packet 0 (so we see packets up to 25, then reset to 0). With
HTTP, the packets never reset to 0--we see 25, then the decoder activates, we
try to process packet 26 and crash.
The reason it doesn't reset is that we don't call oggplay\_seek(mPlayer, 0) for
this video when it's hosted on tinyvid.tv (because it supplies a duration
header), and locally (because my test website doesn't support byte ranges), so
the code at
<http://mxr.mozilla.org/mozilla-central/source/content/media/video/src/nsOggDecoder.cpp#1821>
bails out and we never hit the oggplay\_seek.
So the patch I mentioned earlier is probably not the correct fix for this bug.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=500311#c16)• 16 years ago |
|  | |

This isn't going to be the last unfixed ogg/theora crash for 3.5, shouldn't be a problem if the fix goes into 3.5.1 instead.Flags: wanted1.9.1.x+Flags: wanted1.9.0.x-Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)Whiteboard: [sg:critical?] uninitialized memory

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=500311#c17)• 16 years ago |
|  | |

Testcase only applies to tests we have attached to Bugzilla or in the repository itself. Chris, can we simply shorten those crashing movies to get a local testcase?Flags: in-testsuite?Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---) → [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---)Hardware: x86 → AllVersion: unspecified → Trunk

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a75024_137548)• 16 years ago |

Flags: blocking1.9.1? → blocking1.9.1-Whiteboard: [sg:critical?] uninitialized memory → [3.5.1?][sg:critical?] uninitialized memory

|  | [cajbir (:cajbir)](/user_profile?user_id=248229) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=500311#c18)• 16 years ago |
|  | |

It should be possible to shorten. It just needs a video with the first few frames be duplicates I believe.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=500311#c19)• 16 years ago |
|  | |

Attached video
[testcase](attachment.cgi?id=385294)
— [Details](attachment.cgi?id=385294&action=edit)

I reduced the linked video a bit.Assignee: nobody → kinetikStatus: NEW → ASSIGNED

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a98395_274575)• 16 years ago |

Keywords: [testcase-wanted](/buglist.cgi?keywords=testcase-wanted&resolution=---) → [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a161638_137548)• 16 years ago |

Flags: blocking1.9.1.1?Whiteboard: [3.5.1?][sg:critical?] uninitialized memory → [sg:critical?] uninitialized memory

|  | [cajbir (:cajbir)](/user_profile?user_id=248229) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=500311#c20)• 16 years ago |
|  | |

This redhat bug report for an Ogg file that crashes Firefox seems to be this bug:
<https://bugzilla.redhat.com/show_bug.cgi?id=501632>

|  | [Matěj Cepl](/user_profile?user_id=250435) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=500311#c22)• 16 years ago |
|  | |

(In reply to [comment #20](/show_bug.cgi?id=500311#c20 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> This redhat bug report for an Ogg file that crashes Firefox seems to be this
> bug:
>
> <https://bugzilla.redhat.com/show_bug.cgi?id=501632>
Just to note that I am not totally persuaded that this bug is a duplicate of the Red Hat one. I am not and I have never been able to crash our Firefox with <http://proyectofedora.org/mexico/wp-content/uploads/2009/05/boot.ogg> (and the reporter is apparently not able either with our FF 3.5), but clicking on the tinyvid video from the description of this bug kills even our FF 3.5 immediately.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=500311#c23)• 16 years ago |
|  | |

Matthew: Are you still working on this bug?

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=500311#c24)• 16 years ago |
|  | |

I am. I'm close to understanding the root cause now, so shouldn't be too far away from the correct fix.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=500311#c25)• 16 years ago |
|  | |

Attached patch

[patch v0](attachment.cgi?id=388421&action=diff) (obsolete)
— [Details](attachment.cgi?id=388421&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=388421)

This isn't a perfect fix, but it's fairly simple and returns liboggplay's behaviour to what we had in the past.
Basically, it reverts the change from [bug 493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding") and instead fixes that bug a different way by tracking the pseudo-active tracks via active\_tracks during liboggplay initialization.
[Attachment #388421](/attachment.cgi?id=388421&action=edit "patch v0") -
Flags: review?(chris.double)

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=500311#c26)• 16 years ago |
|  | |

Oops, I thought I had posted information about the root cause before posting the patch.
oggplay\_initialise calls oggz\_read in a loop, reading and processing (via callbacks) a block of data at a time. Each time oggz\_read returns, oggplay\_initialise checks all\_tracks\_initialised, and bails out of the loop if it's true. As the loop condition is only checked after each block of data has been processed, it's possible to have processed all of the track headers and begun processing the track data before the loop in oggplay\_initialise bails out.
With the patch from [bug 493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding"), as each track was detected and initialized, it started off inactive. Prior to that patch, they defaulted to active.
The decoder callbacks have an early return that tests if the track is active, and bails out if not. For Theora decoding, this means that the header decode functions will always be called (for header packets), but the data decode functions will only be called if the decoder is active.
In the situation that leads to the crash, oggplay\_initialise returns successfully after having received callbacks for data packets but not processing them (because the track is inactive). nsOggDecoder activates the tracks, then the first time we call oggplay\_step\_decode, oggplay decodes the next data packet, which happens to be empty in this case. As this is the first data packet that is ever processed, there's no previous-frame data to fetch from the Theora decoder, and we crash handling uninitialized data.
My patch fixes the problem the simplest way, by returning oggplay to the old behaviour where tracks were created as active. When this happens, for tracks that can be marked active, it increments the active\_tracks counter so that track deactivation is tracked correctly to avoid [bug 493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding").
A cleaner way to fix this might be to modify oggplay and oggz so that decoder initialization and the actual decoding were logically separate. One way might be to have the callbacks able to signal that initialization is complete (they can only signal success and failure right now), so that the initialization loop in oggplay\_initialise could bail out as soon as the initial track headers had been processed.
During my analysis of this bug, I found some related incorrect behaviour (not crasher bugs) caused by the way initialization is handled. For instance, in some cases oggplay will decode the same data packets multiple times during initialization, causing a sequence of duplicate frames to be queued in oggplay's buffers. Given our plans for 1.9.2, I'm not sure if it's worth trying to fix this in oggplay or not.

|  | [Mike Beltzner [:beltzner, not reading bugmail]](/user_profile?user_id=137548) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a1702590_137548)• 16 years ago |

blocking1.9.1: --- → needed
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
--- → [wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted)Flags: blocking1.9.1.1? → blocking1.9.1.1-

|  | [cajbir (:cajbir)](/user_profile?user_id=248229) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a1919694_248229)• 16 years ago |

[Attachment #388421](/attachment.cgi?id=388421&action=edit "patch v0") -
Flags: review?(chris.double) → review+

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a1921933_274575)• 16 years ago |

Whiteboard: [sg:critical?] uninitialized memory → [sg:critical?] uninitialized memory [needs landing]

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=500311#c27)• 16 years ago |
|  | |

Is this the same as (or related to) [bug 474077](/show_bug.cgi?id=474077 "RESOLVED WORKSFORME - [10.4] Crash in [@ oggplay_data_handle_theora_frame ] while visiting air.mozilla.com")? If so, should 474077 be marked as security sensitive? (And furthermore, should it or this be marked as a duplicate?)

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=500311#c28)• 16 years ago |
|  | |

Moreover, I can't get the testcase to crash 3.5.1 or mozilla-central trunk (revision 9dfacae57238). Has this been fixed?

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=500311#c29)• 16 years ago |
|  | |

The patch hasn't landed, so it's not fixed. I can still reproduce locally with the right configuration.
Sorry I didn't make it clear, but the testcase probably doesn't crash if loaded from Bugzilla. It needs to be loaded from a webserver that supports byte range request, which I don't think Bugzilla does.
[Bug 474077](/show_bug.cgi?id=474077 "RESOLVED WORKSFORME - [10.4] Crash in [@ oggplay_data_handle_theora_frame ] while visiting air.mozilla.com") doesn't have enough information to be sure if it's a dupe of this (or one of the other crashes we've seen in oggplay\_data\_handle\_theora\_frame). It's probably a dupe of one of them, but I don't know which one.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=500311#c30)• 15 years ago |
|  | |

Attached patch

[patch v1](attachment.cgi?id=391524&action=diff)
— [Details](attachment.cgi?id=391524&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=391524)

Same patch, but with README\_MOZILLA and update.sh updated, and patch of patch included.
[Attachment #388421](/attachment.cgi?id=388421&action=edit "patch v0") -
Attachment is obsolete: true

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=500311#c31)• 15 years ago |
|  | |

<http://hg.mozilla.org/mozilla-central/rev/a328a2594cd5>Status: ASSIGNED → RESOLVEDClosed: 15 years agoResolution: --- → FIXEDWhiteboard: [sg:critical?] uninitialized memory [needs landing] → [sg:critical?] uninitialized memory

|  | [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=500311#c32)• 15 years ago |
|  | |

Attached patch

[Patch - add test](attachment.cgi?id=392425&action=diff)
— [Details](attachment.cgi?id=392425&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=392425)

Adds test which checks that the testcase plays when served with X-Content-Duration header. This ensures the previously crashing code-path is exercised.
[Attachment #392425](/attachment.cgi?id=392425&action=edit "Patch - add test") -
Flags: review?

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a3479820_5038)• 15 years ago |

[Attachment #392425](/attachment.cgi?id=392425&action=edit "Patch - add test") -
Flags: review? → review+

|  | [Chris Pearce [:cpearce (Not reading bugmail)]](/user_profile?user_id=287422) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=500311#c33)• 15 years ago |
|  | |

Testcase pushed to m-c:
<http://hg.mozilla.org/mozilla-central/rev/c7a55d7c39fa>Flags: in-testsuite? → in-testsuite+

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a3490221_76551)• 15 years ago |

Target Milestone: --- → mozilla1.9.2a1

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=500311#c34)• 15 years ago |
|  | |

Verified fixed on OS X and Windows with builds like Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2a1pre) Gecko/20090801 Minefield/3.6a1pre (.NET CLR 3.5.30729) ID:20090801042759Status: RESOLVED → VERIFIED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a3643581_1689)• 15 years ago |

Flags: wanted1.9.1.x+

|  | [Viktor Gal](/user_profile?user_id=331126) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=500311#c35)• 15 years ago |
|  | |

(In reply to [comment #26](/show_bug.cgi?id=500311#c26 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> A cleaner way to fix this might be to modify oggplay and oggz so that decoder
> initialization and the actual decoding were logically separate. One way might
> be to have the callbacks able to signal that initialization is complete (they
> can only signal success and failure right now), so that the initialization loop
> in oggplay\_initialise could bail out as soon as the initial track headers had
> been processed.
This behavior has been implemented in 17ef4ca82df28eab294fb8c41e77add6f96e7ab7.
Basically what it does is that it first tries to read all the streams' headers in oggplay\_initialise, and depending on the success of decoding the headers it marks whether the track can be activated. E.g. it does not allow to activate a stream that had bad headers. For more details see the description of the commit in master branch of oggplay.

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=500311#c36)• 15 years ago |
|  | |

Now that this is fixed on trunk (and before 1.9.2 branched even, I believe), can we get a 1.9.1 branch patch worked up? Or does the one in this bug apply?
Please request approval1.9.1.4 on a 1.9.1-applicable patch.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a6725488_1689)• 15 years ago |

blocking1.9.1: needed → .4+Whiteboard: [sg:critical?] uninitialized memory → [sg:critical?][needs 1.9.1 patch or approval request] uninitialized memory

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=500311#c37)• 15 years ago |
|  | |

Matthew: This is now marked as blocking 1.9.1.4. Code freeze is scheduled for September 22. Please request approval on a 1.9.1-applicable patch.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=500311#c38)• 15 years ago |
|  | |

This was fixed on 1.9.2 before it branched. The patch applies to 1.9.1 with a minor fixup to update.sh. The test needs to be backported to the old test infrastructure--it's not too much work, but on the other hand we already have that test on trunk and 1.9.2.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=500311#c39)• 15 years ago |
|  | |

Attached patch

[patch v1 for 1.9.1](attachment.cgi?id=399820&action=diff) (obsolete)
— [Details](attachment.cgi?id=399820&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=399820)

Rebased patch. I'll port the test and include it in the next rev.

|  | [Robert O'Callahan (:roc) (email my personal email if necessary)](/user_profile?user_id=5038) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=500311#c40)• 15 years ago |
|  | |

In general I think we shouldn't put much effort into backporting tests. If it's easy, great, otherwise it doesn't seem worth it.

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=500311#c41)• 15 years ago |
|  | |

Attached patch

[patch v1 for 1.9.1 with test](attachment.cgi?id=399925&action=diff)
— [Details](attachment.cgi?id=399925&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=399925)

Same patch plus ported testcase. All video/audio mochitests pass with this applied. Requesting approval for 1.9.1.4t--this has been on trunk for about 6 weeks, and effectively reverts the behaviour of this code to what it was before [bug 493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding") landed in late May.
[Attachment #399820](/attachment.cgi?id=399820&action=edit "patch v1 for 1.9.1") -
Attachment is obsolete: true
[Attachment #399925](/attachment.cgi?id=399925&action=edit "patch v1 for 1.9.1 with test") -
Flags: approval1.9.1.4?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=500311#c42)• 15 years ago |
|  | |

(In reply to [comment #40](/show_bug.cgi?id=500311#c40 "VERIFIED FIXED - crash while loading video clip [@ memcpy - oggplay_data_handle_theora_frame]"))
> In general I think we shouldn't put much effort into backporting tests. If it's
> easy, great, otherwise it doesn't seem worth it.
I agree with this, for future reference.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=500311#c43)• 15 years ago |
|  | |

Comment on [attachment 399925](/attachment.cgi?id=399925 "patch v1 for 1.9.1 with test") [[details]](/attachment.cgi?id=399925&action=edit "patch v1 for 1.9.1 with test") [[diff]](/attachment.cgi?id=399925&action=diff "patch v1 for 1.9.1 with test") [[review]](/page.cgi?id=splinter.html&ignore=&bug=500311&attachment=399925)
patch v1 for 1.9.1 with test
Approved for 1.9.1.4, a=dveditz for release-drivers
[Attachment #399925](/attachment.cgi?id=399925&action=edit "patch v1 for 1.9.1 with test") -
Flags: approval1.9.1.4? → approval1.9.1.4+

|  | [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=500311#c44)• 15 years ago |
|  | |

<http://hg.mozilla.org/releases/mozilla-1.9.1/rev/6a56ef5eeae0>
[status1.9.1](/buglist.cgi?f1=cf_status_191&o1=isnotempty):
[wanted](/buglist.cgi?f1=cf_status_191&o1=equals&v1=wanted) → [.4-fixed](/buglist.cgi?f1=cf_status_191&o1=equals&v1=.4-fixed)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=500311#c45)• 15 years ago |
|  | |

Verified crash with testcase in 1.9.1.3 and fixed in Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; en-US; rv:1.9.1.4pre) Gecko/20090914 Shiretoko/3.5.4pre.Keywords: [verified1.9.1](/buglist.cgi?keywords=verified1.9.1&resolution=---)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a10368720_159758)• 15 years ago |

Alias: CVE-2009-3378

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a10368893_159758)• 15 years ago |

Alias: CVE-2009-3378

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a10814842_1689)• 15 years ago |

Blocks: [493678](/show_bug.cgi?id=493678 "RESOLVED FIXED - Another infinite loop in oggplay_step_decoding")Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---)Whiteboard: [sg:critical?][needs 1.9.1 patch or approval request] uninitialized memory → [sg:critical?] uninitialized memory

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a10814947_1689)• 15 years ago |

Group: core-security

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a11032225_159758)• 15 years ago |

[Attachment #399925](/attachment.cgi?id=399925&action=edit "patch v1 for 1.9.1 with test") -
Attachment is patch: true
[Attachment #399925](/attachment.cgi?id=399925&action=edit "patch v1 for 1.9.1 with test") -
Attachment mime type: application/octet-stream → text/plain

|  | [Nobody; OK to take it and work on it](/user_profile?user_id=1) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=500311#a62101579_1)• 14 years ago |

Crash Signature: [@ memcpy - oggplay\_data\_handle\_theora\_frame]
You need to [log in](/show_bug.cgi?id=500311&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Matthew Gregan [:kinetik]](/user_profile?user_id=274575)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_1872d7e7_20250126_004731.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2009-63

## Upgrade media libraries to fix memory safety bugs

Announced
October 27, 2009
Reporter
Mozilla community and developers
Impact
Critical
Products
Firefox
Fixed in

* Firefox 3.5.4

### Description

Mozilla upgraded several third party libraries used in media
rendering to address multiple memory safety and stability bugs
identified by members of the Mozilla community. Some of the bugs
discovered could potentially be used by an attacker to crash a
victim's browser and execute arbitrary code on their
computer. `liboggz`, `libvorbis`,
and `liboggplay` were all upgraded to address these
issues.

Audio and video capabilities were added in Firefox 3.5
so prior releases of Firefox were not affected.

### References

Georgi Guninski reported a crash in liboggz.

* [liboggz bugs](https://bugzilla.mozilla.org/buglist.cgi?bug_id=515376,512327)
* [CVE-2009-3377](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3377)

Lucas Adamski, Matthew Gregan, David Keeler, and Dan Kaminsky reported crashes in libvorbis.

* [libvorbis bugs](https://bugzilla.mozilla.org/buglist.cgi?bug_id=501279,499512,515889,507167)
* [CVE-2009-3379](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3379)

Juan Becerra reported a crash in liboggplay.

* <https://bugzilla.mozilla.org/show_bug.cgi?id=500311>
* [CVE-2009-3378](http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-3378)

The original version of this advisory incorrectly included
bug 500254 as part of CVE-2009-3370. That bug was actually fixed in
Firefox 3.5.2 as CVE-2009-2663

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.2/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mandriva.com_99336644_20250126_004729.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us


