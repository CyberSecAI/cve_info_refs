=== Content from www.citi.umich.edu_21a0b389_20250125_043141.html ===

Translation: [[ES](es/index.html)] [[IT](it/index.html)]

| Center for Information Technology Integration      Systrace - Interactive Policy Generation for System Calls |  |
| --- | --- |
|  |
| Check out the [Systrace Blog](http://www.systrace.org/). Systrace - Interactive Policy Generation for System Calls  | Systrace enforces system call policies for applications by constraining the application's access to the system. The policy is generated interactively. Operations not covered by the policy raise an alarm, allowing an user to refine the currently configured policy. For complicated applications, it is difficult to know the correct policy before running them. Initially, Systrace notifies the user about all system calls that an application tries to execute. The user configures a policy for the specific system call that caused the warning. After a few minutes, a policy is generated that allows the application to run without any warnings. However, events that are not covered still generate a warning. Normally, that is an indication of a security problem. Systrace improves [cyber security](../cybersecurity/) by providing intrusion prevention. Alternatively, policies can be learned automatically. In many instances, the automatically learned policies can be used for sandboxing immediately. Sometimes, minimal manual post-processing is necessary. With Systrace, untrusted binary applications can be sandboxed. Their access to the system can be restricted almost arbitrarily. Sandboxing applications that are available only as binaries is only sensible, as it is not possible to directly analyze what they are designed to do. However, constraining the system calls that large open-source applications are allowed to execute is useful too, as it is very difficult to determine their correctness. System call arguments can be rewritten dynamically. This effects a virtual *chroot* for the sandboxed application. It also prevents race conditions in the argument evaluation. [Answers to some [frequently asked questions](faq.html)] |  | | Features  * Confines untrusted binary applications. * Interactive Policy Generation with Graphical User Interface. * Supports different emulations:   + GNU/Linux, BSDI, etc.. * System Call Argument Rewriting. * Non-interactive Policy Enforcement. * Remote Monitoring and Intrusion Detection. * Privilege Elevation: Add-on capabilities. | | --- | | | --- | --- | --- | --- |  Intrusion DetectionWith Systrace, it is possible to monitor daemons on remote machines and generate warnings at a central location. As these warnings indicate operations not covered by existing policy, it is possible to detect intrusions and prevent them from succeeding. For example, a web server or ftp server can be monitored that way. Non-Interactive Policy EnforcementOnce a policy has been generated, Systrace can enforce it automatically without user interaction. System calls not covered by the existing policy are denied. For example, a shell provider can enforce policy of user shells and executed commands with Systrace. Privilege ElevationUsing the privilege elevation feature of Systrace, it is possible to completely remove the need of *setuid* or *setgid* binaries. Instead, Systrace executes the application without privileges and only elevates them to the desired level when required. For example,  | ```          native-socket: sockdom eq "AF_INET" and socktype eq "SOCK_RAW" then permit as root         native-bind: sockaddr eq "inet-[0.0.0.0]:22" then permit as root 	native-fsread: filename eq "/dev/kmem" then permit as :kmem  ``` | | --- |   Systrace elevates the privileges precisely for the operations that require them. As a result, we get as *fine-grained capabilities* as possible and the privileged code path is reduced extremely. In combination with *dynamic predicates*, it is possible to allow an unprivileged application to bind to a reserved port exactly once, etc. Policy ExampleThe following example illustrates a simple policy for the *ls* binary. If *ls* attempts to list files in */etc*, Systrace disallows the access and */etc* does not seem to exist. Listing the contents of */tmp* works normally, but trying to *ls* */var* generates a warning.  | ```  Policy: /bin/ls, Emulation: native         native-munmap: permit [...]         native-stat: permit         native-fsread: filename match "/usr/*" then permit         native-fsread: filename eq "/tmp" then permit         native-fsread: filename eq "/etc" then deny[enotdir]         native-fchdir: permit         native-fstat: permit         native-fcntl: permit [...]         native-close: permit         native-write: permit         native-exit: permit  ``` | | --- |   Systrace supports multiple applications with multiple policies. Policies can be switched on *execve*.Screenshots  | A web browser tries to access the password database. Monitoring the system calls in a web browser is reasonable, as it is exposed to potentially hostile web pages that try to exploit programming errors in the browser. |  | Systrace may also be used to prevent damage from trojaned software distributions. In this example, Systrace detects a Trojan in the configure script contained in a malicious fragroute distribution. | | --- | --- | --- | |  | |  |  |  |  DownloadSystrace is distributed under a BSD-style license and has been integrated into NetBSD, OpenBSD and OpenDarwin. NetBSD-current contains the most recent [Systrace](http://cvsweb.netbsd.org/bsdweb.cgi/basesrc/bin/systrace/) source code. You can use [AnonCVS](http://www.netbsd.org/Documentation/current/#using-anoncvs) to access it. At the moment, systrace supports native and Linux binaries.Ports  * [GNU/Linux port](linux.html) is finished and kernel patch is maintained actively by Marius Eriksen. Can be run without kernel changes using the ptrace backend. * [Mac OS X port](macosx.html) is almost complete; currently **unmaintained** due to lack of hardware. * [FreeBSD port](freebsd.html) by Rich Murphey; in progress.  Source Code  | * <systrace-1.6f.tar.gz> [[gpg sig]](systrace-1.6f.tar.gz.sig) - 2009-01-05   + prevent a 32-bit program from mapping in 64-bit system calls; from Chris Evans   + support 64-bit Linux on ptrace * <systrace-1.6e.tar.gz> - 2007-12-18   + potential escape of socket aliases and double free; from Tavis Ormandy   + fixed a problem with fork and ptrace; from Tavis Ormandy (CVE-2007-4773) * <systrace-1.6d.tar.gz> [[gpg sig]](systrace-1.6d.tar.gz.sig) [[i386 deb]](systrace_1.6d_i386.deb) - 2006-04-23   + more system call translations.   + ptrace: fixed issues with zombies sticking around. * <systrace-1.6c.tar.gz> [[gpg sig]](systrace-1.6c.tar.gz.sig) [[i386 deb]](systrace_1.6c_i386.deb) - 2006-04-08   + Ptrace: some more work for older 2.4 kernels.   + added translations for chflags, mmap and mprotect. * <systrace-1.6b.tar.gz> [[gpg sig]](systrace-1.6b.tar.gz.sig) - 2006-04-06   + Ptrace: make it work on older 2.4 kernels.   + Ptrace: Detect when headers and kernel are out of sync. * <systrace-1.6a.tar.gz> [[gpg sig]](systrace-1.6a.tar.gz.sig) - 2006-03-26   + Ptrace: support for multi-threading.   + Ptrace: small performance improvement.   + Ptrace: avoid crashing kernels due to ptrace kernel bug. * <systrace-1.6.tar.gz> [[gpg sig]](systrace-1.6.tar.gz.sig) - 2006-03-24   + Ptrace option for Linux to run without kernel changes. * [usr-systrace-2004-01-26](usr-systrace-2004-01-26.tar.gz) [[gpg sig]](usr-systrace-2004-01-26.tar.gz.sig) - Snapshot of systrace userland. (Darwin, Linux, NetBSD, OpenBSD) - 2004-01-26   + Bunch of features including complete policy updates. * [usr-systrace-2003-06-23](usr-systrace-2003-06-23.tar.gz) - Snapshot of systrace userland. (Darwin, Linux, NetBSD, OpenBSD) - 2003-06-23   + UI detaching and multiplexing.   + Allows for escaping of special characters.   + Support for prompt directive.   + Freeing of old policies, requires kernel [patch](policyfree-openbsd.diff) for OpenBSD. * [gtk-systrace-2003-06-23](gtk-systrace-2003-06-23.tar.gz) [[i386 deb]](xsystrace_0.1_i386.deb) - GTK Systrace front end invoked by systrace. Install it as **/usr/X11R6/bin/xsystrace** * [systrace templates](systrace-templates.tar.gz) - Templates for NetBSD/OpenBSD to facilitate policy generation. - 2002-11-22 | | --- |  You need to **install** the systrace userland. The gtk frontend is **required only** for graphical policy generation.References  * [Improving Host Security with System Call Policies](../papers/systrace.pdf)   Niels Provos, *12th USENIX Security Symposium,*   Washington, DC, August 2003.  | Sample Policies  * [httpd](usr_sbin_httpd) - Apache Web Server * [gaim](usr_local_bin_gaim) - GTK AOL Instant Messenger * [konq-e](usr_local_bin_konq_e) - Konquerer Embedded * [mplayer](usr_local_bin_mplayer) - Movie Player | Links  * [Absolute OpenBSD](http://www.amazon.com:80/exec/obidos/ASIN/1886411999/honeyd-20?creative=125577&camp=2321&link_code=as1) - A book about OpenBSD that includes a chapter on **Systrace**. * Systrace has been presented at [CanSecWest](http://www.cansecwest.com/) in May 2002. * [Systrace WIP](../papers/systrace/) at the USENIX Technical conference in June 2002. * [Systrace Talk](../papers/systrace-lsm/) at the Libre Software Meeting in July 2002. * [Firefly - The Complete Series](http://www.amazon.com/exec/obidos/ASIN/B0000AQS0F/honeyd-20) - unrelated but the best Sci-Fi show I have seen so far. | | --- | --- |  Systrace in the Press  * [Creating Systrace Policies](http://www.onlamp.com/pub/a/bsd/2003/02/27/Big_Scary_Daemons.html),   *O'Reilly ONLamp.com*, February 2003. * Systrace - A tightly locked jail of legitimate system calls,   *Linux Magazine*, February 2003. * [Verrouillez les appels systemes avec systrace](http://www.ze-linux.org/index.php?id_news=750), *Login*, Nr. 101, December, 2002. * [Enges Korsett - Systrace setzt Regeln für erlaubte Systemaufrufe durch](http://www.linux-magazin.de/Artikel/ausgabe/2003/01/systrace/systrace.html), *Linux-Magazin*, December, 2002.  AcknowledgementsThanks to Dug Song and Perry Metzger for helpful discussions and suggestions. |  |

---

| Questions and Comments: Niels Provos   Last modified: Mon Jan 5 17:27:24 PST 2009 |  | You can keep me happy while hacking by reducing my **Wishlists:** [Books](../wishlists/amazon.html), [Music](../wishlists/cdnow.html) | [[Get Opera!]](https://secure.bmtmicro.com/opera/buy-opera.html?AID=620358) |
| --- | --- | --- | --- |



=== Content from scary.beasts.org_d33ae8a9_20250125_043140.html ===

## CESA-2009-001 - rev 1

[See all my vulnerabilities at
<http://scary.beasts.org/security>][Blog if you want to subscribe to new findings is at
<http://scarybeastsecurity.blogspot.com/>]
### Linux syscall interception technologies partial bypass

---

Programs affected: Probably many; for example systrace with ptrace()
backend.

Fixed: Systrace 1.6f for 32-bit build (but you are cautioned that ptrace()
is not a security technology).

Severity: Syscall policy violation.Various security technologies make use of syscall filtering. Such technologies
are very powerful because they restrict a compromise not just in terms of
access to files, networks and processes -- but also access to the rich kernel
API (a great source of ring 0 bugs).Syscall filtering technologies typically make an allow / deny decision based
on the syscall (identified by a number) and sometimes also the exact arguments
to the syscall. A vulnerability exists due to the identification of syscall by
number. On 64-bit aware Linux kernels (x86\_64), the syscall number can map to
either the 32-bit or 64-bit syscall table. Since the syscall tables are
different for 32-bit vs. 64-bit, and the user space process gets to control
which table it hits, the syscall number check can often be fooled.For example, a syscall filter technology might be monitoring a 64-bit process,
and configured to allow some subset of the very common `open()`
syscall. That's syscall number 2 in 64-bit land. However, the monitored process
can switch to 32-bit mode and issue syscall 2. That appears to be
`open()` to the monitor but will execute as `fork()`
in the kernel - possibly leading to an unmonitored process.Here is a sample piece of code which does a 32-bit syscall:
```

int
main(int argc, const char* argv[])
{
  /* Syscall 1 is exit on i386 but write on x86_64. */
  asm volatile("movl $1, %eax\n"
               "int $0x80\n");
  for (;;);
}

```
When built 64-bit, and run under strace on my 64-bit machine, the difference
in opinion on the syscall is apparent:
```

write(1, "\370V\355\365\377\177", 140737319359320 <unfinished ... exit status 208>

```
The monitor sees `write()` but the kernel sees (and executes!)
`exit()`.Detecting this situation has some subtleties. Which syscall table the kernel
hits depends on both the instruction used to trap into the kernel, and also
the "long mode" bit in the current descriptor referred to by the code segment
(CS) register. `int80` and `sysenter` always cause a
32-bit syscall, but `syscall` looks at the descriptor. Therefore,
to securely monitor a 32-bit process, it is sufficient just to validate that
the CS register references a privileged 32-bit descriptor. Unfortunately, to
securely monitor a 64-bit process, not only must the CS register be checked,
but the instruction initiating the syscall must be checked. This involves
reading user-space which is of course is subject to well-documented lethal race
conditions when other processes which share writeable address space.
CESA-2009-001 - rev 1

Chris Evans

scarybeasts@gmail.com


=== Content from scarybeastsecurity.blogspot.com_7b42a50b_20250125_043141.html ===


# [Security](https://scarybeastsecurity.blogspot.com/)

Hacking everything, by Chris Evans / scarybeasts

## Friday, January 23, 2009

### Bypassing syscall filtering technologies on Linux x86\_64

For those interested in syscall filtering technologies, check out my latest advisory on how policies can be bypassed under certain circumstances:

<http://scary.beasts.org/security/CESA-2009-001.html>

There's a neat trick on the x86\_64 kernel; this kernel supports both 32-bit and 64-bit processes, and interestingly, the syscall tables are different in either case. However, with a bit of trickery, a 64-bit process can call a 32-bit syscall (and visa versa), and confuse the syscall filter.

This was discovered whilst experimenting on a new security feature for vsftpd; a future post will go into this.

Posted by

[Chris Evans](https://www.blogger.com/profile/01004765479735675808 "author profile")

at

[12:32 PM](https://scarybeastsecurity.blogspot.com/2009/01/bypassing-syscall-filtering.html "permanent link")

[![](https://resources.blogblog.com/img/icon18_edit_allbkg.gif)](https://www.blogger.com/post-edit.g?blogID=3024470480937744884&postID=3518880935792263954&from=pencil "Edit Post")

#### 1 comment:

[![](//resources.blogblog.com/img/blank.gif "Kamagra")](http://www.bellspharmacy.com)
[Kamagra](http://www.bellspharmacy.com)
said...

Hey, Really great work,I would like to join your blog anyway so please continue sharing with us,

[May 1, 2011 at 10:54 PM](https://scarybeastsecurity.blogspot.com/2009/01/bypassing-syscall-filtering.html?showComment=1304315655779#c7306147223499180104 "comment permalink")
[![](https://resources.blogblog.com/img/icon_delete13.gif)](https://www.blogger.com/delete-comment.g?blogID=3024470480937744884&postID=7306147223499180104 "Delete Comment")

[Post a Comment](https://www.blogger.com/comment/fullpage/post/3024470480937744884/3518880935792263954)

[Newer Post](https://scarybeastsecurity.blogspot.com/2009/02/vsftpd-210-released.html "Newer Post")

[Older Post](https://scarybeastsecurity.blogspot.com/2008/12/opera-svgs-and-java-applets.html "Older Post")

[Home](https://scarybeastsecurity.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://scarybeastsecurity.blogspot.com/feeds/3518880935792263954/comments/default)

Subscribe to my Twitter feed: [@scarybeasts](https://twitter.com/scarybeasts).

## Subscribe To ScarybeastSecurity

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2Fposts%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/posts/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Posts

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

[![](https://resources.blogblog.com/img/widgets/subscribe-netvibes.png)](https://www.netvibes.com/subscribe.php?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F3518880935792263954%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/widgets/subscribe-yahoo.png)](https://add.my.yahoo.com/content?url=https%3A%2F%2Fscarybeastsecurity.blogspot.com%2Ffeeds%2F3518880935792263954%2Fcomments%2Fdefault)
[![](https://resources.blogblog.com/img/icon_feed12.png)
Atom](https://scarybeastsecurity.blogspot.com/feeds/3518880935792263954/comments/default)

![](https://resources.blogblog.com/img/widgets/arrow_dropdown.gif)
![](https://resources.blogblog.com/img/icon_feed12.png)
Comments

## Blog Archive

* ►
  [2021](https://scarybeastsecurity.blogspot.com/2021/)
  (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2021/05/)
    (1)

* ►
  [2020](https://scarybeastsecurity.blogspot.com/2020/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2020/12/)
    (1)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2020/11/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2020/07/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2020/06/)
    (3)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2020/04/)
    (1)

* ►
  [2017](https://scarybeastsecurity.blogspot.com/2017/)
  (10)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2017/09/)
    (1)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2017/06/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2017/05/)
    (7)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2017/03/)
    (1)

* ►
  [2016](https://scarybeastsecurity.blogspot.com/2016/)
  (7)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2016/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2016/11/)
    (4)

* ►
  [2015](https://scarybeastsecurity.blogspot.com/2015/)
  (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2015/07/)
    (1)

* ►
  [2014](https://scarybeastsecurity.blogspot.com/2014/)
  (5)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2014/09/)
    (2)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2014/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2014/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2014/02/)
    (1)

* ►
  [2013](https://scarybeastsecurity.blogspot.com/2013/)
  (2)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2013/12/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2013/02/)
    (1)

* ►
  [2012](https://scarybeastsecurity.blogspot.com/2012/)
  (9)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2012/09/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2012/07/)
    (1)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2012/04/)
    (2)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2012/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2012/02/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2012/01/)
    (1)

* ►
  [2011](https://scarybeastsecurity.blogspot.com/2011/)
  (10)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2011/07/)
    (1)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2011/05/)
    (2)
  + ►
    [April](https://scarybeastsecurity.blogspot.com/2011/04/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2011/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2011/02/)
    (2)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2011/01/)
    (1)

* ►
  [2010](https://scarybeastsecurity.blogspot.com/2010/)
  (11)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2010/10/)
    (1)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2010/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2010/08/)
    (1)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2010/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2010/06/)
    (1)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2010/03/)
    (1)
  + ►
    [January](https://scarybeastsecurity.blogspot.com/2010/01/)
    (3)

* ▼
  [2009](https://scarybeastsecurity.blogspot.com/2009/)
  (29)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2009/12/)
    (3)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2009/11/)
    (2)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2009/10/)
    (3)
  + ►
    [September](https://scarybeastsecurity.blogspot.com/2009/09/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2009/08/)
    (2)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2009/07/)
    (3)
  + ►
    [June](https://scarybeastsecurity.blogspot.com/2009/06/)
    (4)
  + ►
    [May](https://scarybeastsecurity.blogspot.com/2009/05/)
    (3)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2009/03/)
    (3)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2009/02/)
    (4)
  + ▼
    [January](https://scarybeastsecurity.blogspot.com/2009/01/)
    (1)
    - [Bypassing syscall filtering technologies on Linux ...](https://scarybeastsecurity.blogspot.com/2009/01/bypassing-syscall-filtering.html)

* ►
  [2008](https://scarybeastsecurity.blogspot.com/2008/)
  (20)
  + ►
    [December](https://scarybeastsecurity.blogspot.com/2008/12/)
    (2)
  + ►
    [November](https://scarybeastsecurity.blogspot.com/2008/11/)
    (5)
  + ►
    [October](https://scarybeastsecurity.blogspot.com/2008/10/)
    (1)
  + ►
    [August](https://scarybeastsecurity.blogspot.com/2008/08/)
    (3)
  + ►
    [July](https://scarybeastsecurity.blogspot.com/2008/07/)
    (5)
  + ►
    [March](https://scarybeastsecurity.blogspot.com/2008/03/)
    (1)
  + ►
    [February](https://scarybeastsecurity.blogspot.com/2008/02/)
    (3)

## My other stuff

* [My security advisories](http://scary.beasts.org/)
* [vsftpd home page](http://vsftpd.beasts.org/)
* [Tavis' security advisories](http://taviso.decsystem.org/research.html)

|  |  |
| --- | --- |

Simple theme. Theme images by [gaffera](https://www.istockphoto.com/googleimages.php?id=4072573&platform=blogger&langregion=en). Powered by [Blogger](https://www.blogger.com).


