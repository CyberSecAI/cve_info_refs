=== Content from cvs.schmorp.de_27ebebf9_20250125_172025.html ===
Deliantra MORPG Server, Maps and Archetypes ChangeLog.
Version numbers sort like decimal numbers.
2.82 Sat Oct 24 03:50:17 CEST 2009
- fixed a classical and exploitable stack buffer overflow in the gsay command.
- fix a memory buffer overflow in the book code.
- add @check, @find npc dialogue commands.
- (maps) add a number of town interiors.
- (maps) add tindervale the fireborn capitol from cfextended.
- (maps) add celvear area from cfextended.
- (server,arch) add a number of inscribables, show their capacity in hint.
- (server,maps) fix bug causing some library books not to be chained down,
cause Scorn/Navar libraries not to have inscribable books.
- (maps) fix bug causing the Greyshield and Greysword to have
inappropriate item power.
- (maps) fix intwell balancing issue.
- improve the look of generated books.
- make slag no\_drop so it can't be dropped from the cauldron.
- fix bug where players could bypass no\_drop by putting items in containers.
- consecutive commands arriving at the same time in the server would be
corrupted if the length was >255.
- support sub-matches in () inside match expressions, not just conditions.
- got rid of motd/rules/news code in C++ part, move motd to it's own tab
and perl.
- implemented new "match" type that combines both check\_inv and pedestal
functionality (and more) inside the same object using the match expressions.
- create simpler match expression compiles in many common cases.
- reduce object size by removing obsolete "seen\_by" member.
- removed the rather broken make\_list\_like utility function, taking advantage
of the new dynbuf::splice function (which gave an unexpected net win
in code size...).
- the server will no longer complain (and subtly fail) when an object
being removed from a map causes another object to get removed.
- banish strncpy from the server, speed up and simplify sending item
descriptions to the client considerably.
- add new "in head" set modifier for matches.
- new BLOCKED\_MOVE event added.
- mapscript archetype now has activate\_on\_xxx true by default, as similar
connected elements.
- (maps) imported all styles from cfextended except
floorstyles/land\_plots and monsterstyles.
- (arch) imported gem treasurelists and archetypes from cfextended.
- don't crash when treasure lists are empty / supply new empty
treasurelist for randomitems when none can be found.
- implement cf::map::static\_maps and use it in map-tags.ext.
- fix a bug in map-tag scanning when moving tags.
- (deliantra.net) improve watchdog to now check both listening ports
for a reaction.
- implement new "loadall" map loading command, purely for debugging.
2.81 Mon Oct 12 20:00:18 CEST 2009
- display spell description for spellbooks, rods, wands, potion and scrolls,
but not horns (to make them more useful for content-creators).
- fix a number of bugs in check\_move\_on: 1) it didn't update the flags
2) it skipped spell effects and 3) it didn't handle the case where
and object was destroyed while iterating over it correctly. all this
allowed players to sometimes walk onto spaces they should not be able to
walk on.
- fix an exploit where inscription/marking runes could execute arbitrary code.
- examining an object now dumps the serialised object form when the user
is a wizard (wizlook).
- altars no longer accept unpaid items.
- party spells didn't work all that well.
- added complex object matching framework (cf::match), and make altars
and pedestals use it.
- identified skill-tools show what skill they grant.
- display the duration of change\_ability spells when examining them
(missing: protection spells, but they are a hack...).
- improve effectiveness of special foods created by woodsman skill,
adding more variety to the different mushrooms.
- fix a minor cfpod formatting bug.
- do not talk about the hintmode so much - die-hards are expected to find
the hintmode setting on the settings page.
- IPO no longer lies about prices; prices tweaked.
- clarified that all deliantra-specific parts are under the Affero GPL.
- enable the object loader to also dump archetypes.
- (maps) fix guild teleporters to Pupland Terminal.
- (maps) put the trapdoor above the floor in sisters/necro\_ruins1.
- force the initial face when loading an object that is time-animated
or a monster, so it does not have to be specified anymore.
- fix a bug where recasting an ability changing spell could shorten
its remaining duration.
- fix pedestal and floor building with builder.
- fix RUNATT attack mode, which was broken before (used e.g. by mice).
- fix a broken bow-related speed optimisation by using splay - speed
up splay operations as well.
- use NDI\_CLEAR for the body command, and make it use observe.
- implement introspection data for C++ classes (%REFLECT).
- (arch) add name\_pl fields and documentation for building materials.
- (maps) random fountains no longer generate permanent stat increases.
- fix transmutation alchemy.
- speed up many frequently-invoked C->perl callbacks.
- added complex object matching framework, to be used in altars and the like.
- switch to YAML::XS from YAML.
2.80 Tue Sep 15 20:22:31 CEST 2009
- fix the "screen stays black on login" bug and remove debug instrumentation
that ultimately was not helpful to catch it :)
- split outer\_env into outer\_env and outer\_env\_self, and fix
all callers to use either one or the other, as appropriate. This
fixes the (rather fragile) light spell, maybe others.
- fixed an overflow and exploit in the bank/payment code.
- fixed a bug in the jeweler quest and added the 'Tome of Jewelery'
to explain the skill a bit more.
- removed a buggy check for zero attacktype. So that we might find
the real bugs in the archs/maps/objects.
- Fixed enabling torches with lighters.
- (maps) Added Heaven Town region.
- (arch+maps) Fixed & normalized warriors on map
/quests/peterm/CTower/Barracks.
- fix the light spell (and possibly diseases and other lights).
- (arch) The clawing skill didn't have the physical attacktype.
- (maps) make the greenway accessible again - this bug was introduced
a long time ago, and similar cases are still to be found in the maps.
- make the socket\_timeout configurable in the code (but not yet for users).
- earth wall health bar is now correct.
2.79 Tue Jul 28 00:56:36 CEST 2009
- IO::AIO chaged to using eventfd internally - updated server to not
freeze with IO::AIO anymore due this change.
- avoid a crash when a player tries to apply a lighter.
- allow a spell argument for dimension door.
- move shop item listing and some otherstuff into the info tab.
- avoid crashes when non-players cast party spells.
- fix a crash in get\_spell\_by\_name (for learn\_spell).
- added pyromancer class with graphics (by Job Vranish).
- small improvement of the number of potions in shops
(by Job Vranish).
- added a few party spells (by Job Vranish).
- use a common message dynbuf.
- destroying tear down objects will now use the full hp range
for animation and will only destroy/lastframe when hp < 0.
- allow monsters to use earth to dust.
- use manhattan distance for get\_rangevector\_from\_mapcoord, just as
in get\_rangevector.
- los updates now correctly take tiled maps into account.
- do los updates even on maps without darkness.
- fixed quiver of holding bolts to be able to hold bolts.
- upgrade to IO::AIO 3.21.
- fixed show invisible, to show objects of type CONTAINER.
- properly catching exceptions from callback in irc.ext.
- fixed a potentially hazardous bug in cfpod regarding Z<>.
- (maps) fixed npc dialog in /pup\_land/nurnberg/reception/reception.
- (arch) added hint about usage to Slag Ex.
- (maps) /darcap/quest/water sea1 tile are now passable by players,
like the rest.
- (maps) added /heaven/gem\_shop by Boes.
- (arch+maps) added rate limited converter and adjusted
/elmex/mana\_fountain.
- store arrow->slaying in custom\_name, to get rid of the spellarg slot.
- reduce size of casting\_time, move\_status, attack\_movement,
last\_heal and last\_sp slots, squeezing some more space out of struct
object, also declare expmul as constant 1.0, as it isn't used
anywhere.
2.78 Sun Apr 5 20:04:29 CEST 2009
- fixed bug in alchemy, where finding the right object for enhancements
didn't work.
- aggressively merge spell effects and do not allow more than 5 spell
effects (w.r.t. put\_more) per mapspace, to give the server a chance
to survive a hundred deathsheads.
- correctly clear op->env when inserting onto map, this was a potentially
disastrous bug of unfortunately unknown proportions...
- fix cone-spell symmetry that was broken for direction 8.
- use gender-neutral place descriptions for invite.
- (arch) new faces for alchemist class, wizard class and quetzalcoatl race.
Thanks go to Lisa Larsen!
- remove support for colour reducing 32x32 images (no cfclient support
anymore).
- actually mention the literacy level when it is too low to learn the spell.
- use better dependency tracking for include/keyword.h.
- add accept-invitation and suicide to the list of asynchronous commands,
so it is possible to invite somebody out of some stck-till-death traps,
or simply to commit suicide.
- replace the "ignoring delayed commands" message by something more useful
(cf. cunning gnome freezeing issue).
- various fixes for weapon improvements.
- fixed small bug with handling connect errors in the IRC gateway.
- support T and G sequences in cfpod.
2.77 Sun Feb 1 16:30:48 CET 2009
- convert me command from per-map to chat, which makes more sense, also
document it.
- more than one spellbooks of same class can now be given
in class selection.
- adjusted the starting\_spell.trs treasure list to the recent
spell rebalancements.
- the IRC gateway filters IRC colors now.
2.76 Sat Jan 17 08:36:51 CET 2009
- (arch) fix quiver of Holding Bolts.
- applying unpaid items will now examine them.
- add "What" column to body command, showing items in that slot.
- redesigned and rebalanced lamps and torches.
- add "..." to item names that have been shortened.
- fixed "assign" function that squeezes strings into fixed length.
- add cursed effect to lamps and (some) torches.
- fixed bad assigned crafting skills and their tools.
2.75 Fri Jan 9 16:13:30 CET 2009
- rebalanced lighting w.r.t. outdoor, darkness and see\_in\_dark.
- fix a bug in the nimbus extension that allowed players to cheat.
- make monster smell logic dependent on their wisdom stat.
- put the death reason into a separate tab.
- converted "connected" slot to string, cleanly got rid of some ugly
hacks such as the path\_attuned hack.
- introduce shstr\_tmp for fast temporary shstr passing.
- replace one-at-a-time hash by faster than smaller FNV-1a hash
when hashing strings.
- sanitized alchemy-like skills and cauldrons to check earlier
whether the right cauldron is used.
- considerably optimise shared string implementation by
making its null value a compiletime constant.
- use shared string matching insteafd of strcmp in a lot of places,
as well as using shstr\_cmp to pass shared stringsa round efficiently,
for lots of code size savings.
- monsters which breed new monsters shouldn't breed new monsters when
they are sleeping: generators now check for the sleeping flag.
- tell gcc not to excessively inline some perl interface functions.
- remove marking rune length limit.
- fix formatting of cfpod when a verbatim block was following
a single newline.
- move resistances, statistics and showpets command output into tabs.
- implement map scripts that can replace the boulder logic without
having to write extensions.
2.74 Mon Dec 29 15:23:38 CET 2008
- fix a longstanding bug that teared multipart monsters
at map boundaries apart.
- temporarily make permanently invisible player visible when
he/she makes noise.
- fix being able to see through walls a bit.
- improve look at output.
- completely replaced the line of sight algorithm with a variant
of spiral fov capable of visibility grades and arbitrary
shadow angles, that uses less memory and less code.
- the new los code supports arbitrary map rectangles and loosens
other restrictions of the old code, supporting further optimisations.
- update los if blocksview-objects are inserted in a map, not just when
removed (e.g. for summon fog).
- permanent invisibility doesn't make immune against making noise:
implement a noise system that allows monsters to locate the player
when he/she makes noise.
- implement a primitive smell system that monsters can use to track
players.
- create bomb now also works when casted by door traps.
- (arch) new torch graphics.
- (maps) considerably soften the subway spider.
- (maps) made the portgate of navar safe ground, to protect
the guards from being killed by players.
- (maps) lots of tweaks in and around scorn.
- (maps) use special non-blocksview jungle, mountain and
darkforest freely on the worldmap, to get gradual sight obstacles
instead of total blackout in those areas.
- no maximum darkness for outdoor maps anymore.
- add more hints, fix some messages.
- fix a bug: firing rods should tell you something about them.
- make light additive even within players.
- darken xrays effect a bit.
- improve handling of los changes when inserting or removing
objects, not perfect yet.
- make map darkness signed (formerly unsigned) to allow
ambient lighting and centrally manage darkness as an offset.
- revamped, fixed and documented the server calendrics, also
tell users the current time and data, to improve awareness.
- implement proper wizlook flag and handling of wizlook, instead
of dumbly just clearing los once.
- speed up los code - it's now about 2-3 times as fast as the old one,
and has a smaller runtime variance.
- daylight/nightfall can now increase/decrease past the natural limit,
making them actually useful.
- see\_in\_dark now increases the viewing radius by 3.
- implement a fast tiled map iterator and use it in LOS for a 20%
speedup, as well as in many other places.
- remove support for extended map infos - these are not used
by the deliantra client and removing them gives us a 10% speedup
when sending map changes.
- remove most gcfclient and other client bug workarounds, as well
as now obsolete protocol versions, simplying the code.
- optimise and simplify generation of random numbers.
- correctly provide a non-zero default density for materials, to
avoid crashes, fix other bugs in the material handling code.
- fix volume calculations.
- fix cfpod parsing when multiple verbatim blocks were separated by
newlines.
- increase monster detection radius from wis/5 to wis/3.
- remove old pickup modes.
- remove obsolete disarm and search commands (search wasn't working
anyways).
- fix a crash when an npc applied a sign.
2.73 Thu Dec 18 20:56:31 CET 2008
- this release is assumed to be very stable.
- (maps) radically redesigned and improved tutorial.
- directional casting no longer immediately removes the invisible effect.
- magic ears now trigger when used inside the NPC dialogue.
- fix overflow in lighting calculations.
- negative glow radii can no longer cause total darkness.
- allow lookat on spaces where we only barely see, as opposed to
only maximally-lit ones.
- class selection has been reworked completely and their documentation corrected.
- swashbucklers got the oratory skill now.
- jump skill was fixed to adhere to all the flags a mapspace has got.
- (maps) small fix w.r.t. magic ear in /scorn/houses/wizz.entry
- fix deadlock in Jeweler::improve\_ring\_by\_plan.
- use Coro::SemaphoreSet instead of our own lock management
(which was probably broken, too).
- support negative glow radii during daytime, too.
- use circular, not rectangular, viewing area.
- use minimum viewing distance of 2 in outdoor maps.
- negative glow is stronger than viewing area or lamps.
- (arch) new darkness spell face.
2.72 Thu Dec 4 22:20:19 CET 2008
- (maps) completely redesigned scorn.
- "cast light" now works on oneself.
- bump max light radius to 9, rewrote glow lighting calculations, fix
negative glow radii again (they were totally broken before).
- the "worldmaps sometimes are black" bug is finally fixed.
- the "player objects are referenced in \_GENxx globals" bug has finally
been fixed, by not relying on buggy perl internals when serialising.
- fixed a long standing bug in the anvil converters in armour shops.
- items shops weren't interested in don't vanish anymore, and are given
back to the player.
- attuned/repell and spell base level system reworked.
- rewrote skill cache (last\_skill\_ob) system and usage - might
be less erratic now.
- refuse to write the uuid file if the uuid is zero
(to avoid writing it in early crashes).
- pathsync the directory after saving a file for added slowdown^Wsafety.
- speed up emergency\_save by not syncing every file separately.
- no longer reattach perl to every object on reload, it's slow, and no longer
necessary since we don't nuke stashes anymore.
- do not bootstrap perl from the commandline args, use separate eval for
better error reporting.
- fix a crash when pushing cone spells met ice attacks.
- pre-cache perl extension files on reload to speed up the reload.
- speed up map refresh in server a bit.
- refactored drop code and fixed some programming errors in it.
- fixed small regression in 'Slag Ex' potion extension.
- fixed a bug where some objects couldn't cross map tile boundaries.
- fixed a bug with weight update of the player, the client showed -0.0
as the current weight of the inventory.
- (arch) the dragonbreath spell is level 12 again, but the high level spell
dragonfire has been introduced for the non-dragon players.
- remove unused "tooltype", "start\_holding" object slots.
- change "weapontype" object slot to uint8.
- convert "hide" object slot into flag.
- reorder object members for better locality of reference and codesize
decrease.
- correct rounding in lerp, add lerp\_rd, lerp\_ru.
- fix a crash when no skill could be found when killing amonster.
- fix a small memleak that would eat one pointer on the perl stack for
every completed aio operation.
- perl mapspace acessor methods now normalise (handle tiled maps)
and update mapspaces if necessary.
2.71 Tue Sep 23 07:02:23 CEST 2008
- removed all command line parsing, only env variables are supported
anymore.
- region-specific monsters will now once more be on the worldmap.
- fix a disastrous "memleak" where temporary memory allocations
would grow out of bounds.
- server now writes a pidfile and makes sure its alter ego is killed.
- fixed a double-escaping bug in the pod-parser.
- rewrote the cfpod parser in C++.
- hintmode moved to C++, players need to re-set their hintmode if
they dislike "show".
- fix RIP inscription.
- bump login name length from 18 to 20 char max.
- correctly support gender in emotes.
- correctly support gender in the death messages.
- correctly generate death messages for players only when they really die,
with increased information.
- fix a bug in the dynbuf code that could potentially lead to crashes
and data corruption (but apparently was never triggered).
- close the $ENV{LOCKUTIL\_LOCK\_FD} fd if in the env, for lockutil.
- make sure Compress::LZF acquires the storable lock, might fix some
data corruption bug.
- tweak coredumping/monitoring a bit.
- completely redid server initialisation to hopefully avoid rare races.
- do not crash in the loader when an inventory object could not be loaded
(from a corrupted file).
- redid skills command to send output to proper channel.
- object->map is no longer refcounting.
- add FLAG\_DEBUG for internal debugging.
- add NDI\_VERBATIM flag to send\_msg.
- add perl backtraces to logBacktrace-initiated backtraces.
- player->exists is no longer a sync\_job.
- split login.ext's player scheduler into
it's own player-scheduler.ext extension.
2.7 Sun Sep 7 16:32:03 CEST 2008
- require perl 5.10.
- make nrof signed, so that code that checks for underflow actually works.
- swap player and observed count's on the map when observing.
- add (mostly untested) mapspace perl class and accessors.
- re-"calibrate" value/weight autopickup to be silver/kg >= pickup\*100.
- fix a crash in cast\_bless (restoration et al.) when no target
could be found.
- pits now have a configurable "random spread" range and default
to a radius of two now.
- rewrite pay\_player\_arch.
- use a more stable perl\_reload implementation.
- do not use Symbol::delete\_package (causes crashes after perl-reload),
use our own, safer, clear\_package instead.
- when asynchronously dumping core, close all file handles to allow
the server to restart concurrently.
- improve the cfpod parser to generate proper xml from proper cfpod
sequences, without double-encoding. it should be faster, too.
- the above fixes wrong display of help tetx and many other issues.
- use lzf and frag packets for large messages for clients supporting them
(0.9976+), use it for long books and other messages.
- eradicate listen command and corresponding code.
- eradicate logs command.
- let the client log into the server log, used for crash backtraces.
- fixed rods/wands/etc. with randomitem spells on maps, but broke
old style spell objects with the spell magic bullet.
- (arch) fixed skill less rods in the archetypes
2.61 Sun Aug 3 17:59:50 CEST 2008
- made jeweler workbench larger and some other minor map
changes in jeweler town.
- fixed wrong item handling in jeweler skill code.
- (arch) use a special "key\_random\_map" for random map keys
that are used up.
- fix a crash when the player who was observed has logged out long
enough for his region/map to be gone.
- port to g++-4.3's incompatible tr1 changes.
- add some missing dependencies.
- log to /var/log/deliantra/ by default.
- hack observe code to enable smooth movmenet when observing.
2.6 Sun Jul 20 18:58:08 CEST 2008
- (maps) extension of the jeweler quest/skill/town
- correctly move gsay to the party channel.
- fix a crash when animate weapon was used in some areas.
- fixed unnecessary identification of by converters created objects.
- (maps) tutorial now contains clues about chatting and talking
with NPCs.
- (arch) dragon scales got proper type now
- object::decrease would sometimes cause container weights to
be wrong, this has been fixed.
- do not send time updates for newly-seen items.
- thawing an icecube will once more drop its contents to the ground.
- fix cone spells etc. going through walls sometimes.
- fix a weight update bug that sometimes left containers
with wrong weights.
- added auto\_apply event and extension for shop tiles.
- work around get\_map\_flags invoking perl and switching the stack.
- make sure the map is loaded when using a town portal return.
- fixed a bug with caching of sp/grace/food points for spells
where healing spells didn't cost any grace.
- fix starvation kill reason.
- fix pk killer name message.
- don't let people apply signs with @match.
- add support for berkeley db 4.7 (the new BDB module also fixes
what seems to be the biggets memleak in the server).
2.56 Wed Jun 4 10:50:40 CEST 2008
- require Coro 4.73 which contains an important performance-bugfix.
- use anyevent to manage listen ports (this enables IPv6 support).
- server supports ipv6 client connections now.
- use newly-available Coro::AnyEvent.
- get rid of the AnyEvent::AIO watcher, start the event thread earlier
to let it handle AIO requests.
2.55 Sat May 24 19:52:52 CEST 2008
- avoid newmap commands when crossing tiled map boundaries. this speeds up
processing considerably (especially in the client) and reduces data transfers
(saves roughly 1kb each crossing in typical configs). works even with gcfclient.
- (arch) fix typo in ixalovh treasurelist causing empty\_archetypes to appear.
- (map) fixed npc dialogue in pup\_land/s\_f/special.
- bugfix: fix a crash when a player casts a swarm spell and then logs out
(swarm spells now stay in the player's inventory).
- bugfix: when unapplying skills also remove them from the range/combat slots.
- bugfix: do not merge items whose archetype name merges, use the
archetype \*archname\* (chairs of different facings were merged).
- bugfix: fix a potential crash issue in find\_object\_name (not used
normally).
- bugfix: locked doors cnanot be bashed down by magical means
(destruction, magic missile etc.).
- swarm spells without a direction now use various spiral patterns
instead of being fully random.
- update AnyEvent API to 3.4 and above.
2.54 Thu May 8 22:01:22 CEST 2008
- change floorbox item ordering to enable more efficient protocol and to
stay in sync with the 0.9971 client update which also reverses ordering.
- bugfix: the jumping skill now gives experience for jumping
and for attacking monsters. it also takes about one second to do a jump.
- bugfix: players couldn't starve in 2.53 :(
- bugfix: correctly send the client a del\_spell when a spell gets removed.
- bugfix: spell effects like word of recall are removed on death.
- bugfix: fix a crash when objects with treasure on top (ground...)
were created outside a map.
- bugfix: couldn't apply inventory items when levitating, but ground items
(fixed by reversing the logic).
- bugfix: fixed a mismatched '"' in the debugging description of objects
- bugfix: the random map generator no longer leaks key objects.
- bugfix: support random maps >127x127.
- (maps) fixed the death certificate system in nimbus.
- (maps) rebalance onefang, build a road to onefang, temporarily closed zorn.
- (arch) the material 'wood' was undefined, it's now a burnable material.
- (arch) give ball lightning a real name.
- (arch) fixed material of bones (was 'wood', is now 'bone')
- support cfpod in ex replies (client item tooltips).
- unapply item in range slow when readying a spell.
- bugfix: account for rounding errors in weight updates.
- remove synchronous mkdir in chargen\_race\_done.
- fix per-race starting maps.
- check hiscore on suicide and quit as well.
- tell players when they are starving.
- get rid of costly object\_from\_name conversion for altar effects.
- fix map difficulty calculation for generators.
- slightly more intelligent handling of "is\_animated" flag.
- support no\_drop map header flag (before it was only available internally).
- make random-map-generated keys crumble after one hour, use more unique slaying.
2.53 Sun May 4 17:32:48 CEST 2008
- bugfix: custom skill settings were not saved by the server.
- bugfix: remove did not actually remove items from the inventory, leaving
ghost items.
- bugfix: properly update items identified on the ground.
- bugfix: use localtime\_r in the logger thread.
- bugfix: player starvation will now give the correct kill reason.
- bugfix: archetype reloads could crash the server.
- bugfix: the mailscrolls are now correctly handed out even when the destination
player is not logged in.
- bugfix: make list\_logins non-blocking (glaring oversight). this caused the lag at
server startup.
- bugfix: fix the door surround check in the random map generator.
- (maps) fix heaven quest difficulty progression.
- (maps) fix some random map styles.
- dropping items a shop is not interested in won't sell them anymore.
- rods and horns with a too low maximum charge allow now at least one discharge.
- implement kill & death statistics.
- random map preparation is no longer synchronous.
- rewrite find\_style in perl, no longer does synchronous I/O.
- improve random map specials placement.
- make the killer a real object pointer instead of a string, improved
kill reason messages.
- take advantage of new aio\_close and aio\_chmod.
- implement archetype::get, object::deep\_clone and update callers.
- change\_abil is much faster.
- update the floorbox more often to work around the reverses item order
display in clients.
- cleaned up object copying by encapsulating it to a single place.
- add hints to the invite messages.
- rewrote key<->value pair handling.
- use an independent random number generator for the random map generator.
2.52 Thu Apr 24 11:47:19 CEST 2008
- completely automate the item add/delete on remove/insert. this should fix
all "ghost" item bugs caused by sloppy coding, as sloppy coding is now correct :)
- completely automate the weight handling, should fix all weight
accounting bugs caused by sloppy coding, as sloppy coding is now correct :)
- reloading archetypes while a user was in the character creation phase
could crash the server.
- fix a nontrivial number of cases of code commented similar
to "is this really correct?", as many of those cases are now handles
automatically by lower level code.
- replace many ad-hoc checks for client visibility by object::visible\_to,
should result in broader applicability of functions using it.
- merge items with different arch pointers refering to the same arch
(due to archetype reloads).
- refactored the object remove/insert functions and most related
functions (decrease, split, merge\_ob etc.).
- make it compile better on freebsd (reported by pippijn).
- remove GT\_UPDATE\_INV (no longer applicable).
- fix the longstanding "container stays open" bug.
- improved floorbox updating to be incremental and other protocol
optimisations.
- get rid of update\_after\_inventory\_change and only do update stats
for weight once/tick/player at max.
- rewrite party commands, use party channel.
2.51 Sun Apr 20 21:27:37 CEST 2008
- properly link against libgthread as that is needed to make the slice
allocator thread-safe.
- support perls not compiled with 64 bit support (though this is not a
recommended configuration) (reported by Samuel Gondouin).
- always put godgiven items into the player inventory, never any containers.
- (maps, arch) the scorn go club was founded!
- (arch) do no longer support player abilities, they didn't work anyways.
- (arch) the alchemy spell is now of the alchemy spell school, which
became a real spell-class.
- (arch) the alchemist class now get an alchemy spell book for new characters.
- (arch) considerably strengthened spark shower and destruction.
- match archetypes by name, not by ptr, in treasure.C, this makes archetypes
finally reloadable at runtime.
- changed archetype loading algorithm to only require one pass and
use delayed resolving of references.
- examine command now uses the examine infobox.
- implement an "incremental garbage collector" for archetypes.
- enable slice allocator again.
- implement optional free memory poisoning.
2.5 Wed Apr 16 15:06:53 CEST 2008
- the two handed weapon skill can no longer be used as unarmed combat
skill.
- append [drop xxx coins] to altar/trigger\_altar/identify\_table/converter
names (also update all maps to use money instead of coins).
- add uuid accessors to perl.
- add coin names and archetype accessors to perl.
- fix runtime uuid file format to use "." instead of ",".
- change perl extensions to not use hardcoded coins and values.
- write uuids asynchronously (no hiccups due to uuid writes)
and be more parsimonous of uuid usage by the exact value out on exit.
- write log messages in another thread, removing another sync point.
- support multi-line log messages in a nicer way.
- be more portable w.r.t. uuids and format specifiers everywhere.
- fix a minor memleak in the random map generator.
- some parts of the random map generator are not coroutine-safe,
so only call it "single-threaded".
- major cleanup of memory management in random map generator.
- slight refactoring of the random map generator, faster too.
- solve the "slice\_alloc becomes negative" mystery - no allocation bug,
bookkeeping bug.
- work around "player is on active list" problem by deactivating player
after loading.
- garbage collect shstr's more evenly and adaptively only when
there have in fact been allocations.
- fix object::insert to do as documented and insert into the env
if necessary.
- fix cf::map::unique\_maps.
- fix nrof overflow check in can\_merge\_slow.
- fix converter code to handle >31 bit values.
- added support for the player\_sold flag
- converters no longer accept unpaid items.
- canonicalize random map meta files for better unification.
2.43 Sun Apr 6 20:35:29 CEST 2008
- work around a glibc bug that causes calloc to return non-zero memory
when mlockall has been used.
- pass environment to perl\_sys\_init3, as required by newer perls.
- use separate thread for ticker timing (and more in the future).
this greatly increases timing accuracy and gets rid of an enourmous
number of gettimeofday calls.
- use a separate thread to signal aio completion, for lower latency.
- require Coro 4.47, which fixes a data corruption bug with its C API.
2.42 Sat Mar 15 12:05:21 CET 2008
- rebalanced default experience table to be more exponential
and much easier up to level ~40, then moderately harder.
- change attuned/repelled level boni to +-8 from +-2.
- use SvUPGRADE to avoid exception in sv\_upgrade with perl 5.10.
- do not exit on reload/load errors but properly cleanup.
- fix a 32 bit uncleanlyness in the slice debugging wrapper.
2.41 Fri Jan 25 13:15:37 CET 2008
- get rid of YAML::Syck, it's too buggy and misparses many files
(this fixes the jeweler skill).
- back-to-back perl\_reloads don't freeze the ticker anymore.
- convert cfutil from Event to EV (forgot to do this earlier...).
- move tombstone to real map if player died due to cave-in (even if
it has reset, which is better than putting it on the savebed, also as
proof that the player didn't use a savebed).
2.4 Sun Jan 13 13:41:29 CET 2008
- work around perl bug in configure perl module version check.
- fix bug in golem move code that would cause a crash at tiling borders.
- fix a freeze bug when looking for an arrow in the inventory.
- fix a bug in animate\_weapon, causing a crash.
- no longer exit when a coroutine throws an exception.
- fix a potential double free bug (nicely exploited by g++ 4.2).
- fix the " is nuts" message.
- fix an exception at logout due to the json\_coder being gone.
- upgrade to EV version 2.0 API.
- when players don't apply a savebed correctly but stand above one,
do not move or kill them.
- implement client-side settings page in playerbook (0.9963+ required).
- implement generic framework for server-side resource files.
- implement resource file update event.
- hook experience table update into the framework.
- move jeweler.yaml to resources (arch/).
- switch from Crossfire to Deliantra perl module.
- implement json2json arch filter.
- implement widget protocol version 2, support for ui templates.
- mapinfo is now handled fully asynchronously.
- ext/irc: also log irc messages.
- ext/schmorplog: write user stat files asynchronously.
2.32 Sun Dec 2 18:11:01 CET 2007
- limited the number of items that can be picked up and dropped
as temporary measurement against bad performance or dropping things
(this lead to long freezes and triggered the watchdog).
- improved the performance of the drop command a bit.
- switch from Event to EV for higher performance, easier usage,
less bugs...
- updated to release version of the gnu affero license.
2.31 Sun Nov 11 17:26:28 CET 2007
- more thoroughly rename the binaries, contact addresses.
- update the copyrights.
- avoid backtraces due to old spells on some maps, sometimes causing
crashes.
- fix a problem where facedata wasn't initialised to zero properly,
potentially causing crashes.
- assign weapons on user load time, not login-time, avoiding
crashes.
2.3 Sat Oct 27 11:22:38 CEST 2007
- fixed an important bug that caused passwords to be forgotten.
- implement \*tag destinations for goto, slaying etc. and use it
in some of the maps.
- bigworldised many maps (islands as in pupland and aldwulf),
which is now trivial to do.
- removed all traces of the old (and never working) plug-in interface
(70kb code less on amd64).
- improve/tune scheduling priorities.
- fix some freezing bugs.
- fix a memory corruption problem in dynbuf.printf.
- use channels for chat and many informational commands.
- improved the tutorial.
- create missile is now fixed.
- race fields must now contain archetypes.
- jumping skill now works as advertised.
2.2 Tue Sep 11 15:41:24 CEST 2007
- relicense under the gnu affero license.
- new inscription skill, can only inscribe INSCRIBABLE items.
- implement server-side framework for generic resources.
- use resource framework for server-provided ambient
music.
- save object owners (players only atm).
- replace limited sound api with server-provided sound effects.
- new sc (sound control) protocol command.
- improve fxix protocol to include types.
- exactly fill tcp segments, if possible.
- output-rate is now an upper limit, the server will automatically
(and quite perfectly) adjust to the network conditions, ensuring
low latency even during bulk transfers (music, images, sounds etc.).
- implement server-side widgets (i.e. client widgets controlled
in the server side). this will allow future expansion without
having to upgrade clients.
- implement a (artwork) world map with realtime player position
tracking.
- new and more efficient extcmd (server still supports old extcmd
protocol).
- fixed lots of underflow/overflow bugs in diseases and general stats
calcluation that could be easily exploited by users.
- rebalanced diseases to spread more naturally/evenly.
- completely asynchronous map loading even for tiled maps.
- replace simple messaging protocol with channels carrying metadata
(similar to message types, but more directed at the user).
- reduce command processing latency by a whopping 120ms by
reordering some processing steps inside the server. this directly
reduces lag by 120ms.
- actually send spell faces to the client.
- implement player genders.
- unclean logout/login results in: nothing if map hasn't reset,
otherwise return to savebed and possible kill if the log-out
was for too long.
- fast socket-dead detection (kick player after 8 seconds without ack).
- greatly reduce the cpu time needed to draw maps \_again\_.
- archetypes are now subclasses of objects.
- rebalanced shop greed and approval functions to be more realistic
(and likely match the actual intention).
- implement "crossfire pod" format for messages, with working bold,
italic, gender-specific text, paragraphs etc.
- implemented hint framework, players can opt to receive hints.
- implemented (long) book framework, added some books from the cf wiki.
- implement generic message framework that uses xml, utf8 for the client
protocol and is capable of transmitting generic meta information.
- implement (in a suboptimal way) per-player instantiated maps.
- replace the nexus by a per-player tutorial map that teaches stuff
better than the newbie house.
- fix the magicmap colours.
- optimise map update even more by removing unneeded code and checks.
- decouple map and stats update from pl->ob and use pl->observe instead.
- implement observe command.
- major speed up in map refresh by replacing most get\_map\_from\_coord
calls with a simple comparison.
- fix a latent crossfire bug that could crash the server because the
map refresh did not update the mapspace.
- support custom keys for regions and maps, regions are now
refcount-managed.
- allow worldmap overlays anywhere in the 000..999 range.
- new system to acquire time slices for background jobs, to reduce
jitter.
- semi-persistent object-referencing framework (currently only players
supported).
- dependency tracking for perl extensions.
- new slag-ex extension for cleaning cauldrons.
- fix invoke result processing.
- there are even less i/o syncpoints in the server now.
- added map-tags extension that scans all maps for object tags
and records them in the database (not used yet).
- metaserver 2 support.
- many more bugfixes and minor optimisations.
2.1 Sun May 27 04:21:29 CEST 2007
- optimised event invocation (non-wanted events can now be
skipped with 4-5 inlined instructions).
- complete rewrite of town\_portal: it now creates a portal
to the "nearest" town only, travel is only possible
to the town and back, anybody can use it (also removes
one of the remaining syncpoints in the server).
- complete rewrite of the range/attack skill slot system:
there are now two slots, one for combat, one for ranged
attacks.
- introduce the concept of a current weapon (either a ranged
or a combat weapon/skill/tool) and switch between them as
needed.
- rewrite bow code so bows get more useful: apply damage,
attacktype and other stats to the arrows and treat
bows as weapons. also rebalance the missile weapons skill
so its damage increases with level.
- rewrite the complete player speed logic: weapon\_speed now
works as documented and there are no unnatural speed boosts.
- implement a utility - cfutil - that simplifies arch and map
installation, replacing the old collect scripts and
simplying deployment by scaling and cutting faces as required.
- simplify the map protocol extensively by taking advantage
of missing bigfaces, speeding up map generation immensely.
- implement inherit keyword allowing archetypes to inherit from
other archetypes.
- rationalise archetype, region and treasurelist file format
into a single file format and make them reloadable asynchronously.
- make the worldmap, facedata (smoothing, faces, magicmap)
reloadable at runtime.
- implement 64x64 faceset support.
- implement fxixsx protocol that saves
a lot of bandwidth over the old image/face/smooth packets
and allows images > packetsize, incremental and background
transfers.
- implement a bandwidth-saving smoothing protocol that works
on a face basis as opposed to a mapspace basis.
- the server can now rate-limit image uploads to not exceed
a certain (client-configurable) speed while guarenteeing full
freedom of movement.
- implement new ex command to request item descriptions.
- implement new msg command for in-game messages with meta
information (using xml).
- enforce utf-8 for all text messages.
- added micropather (not used yet).
- many, many bugfixes.
2.0 Tue Mar 6 15:22:53 CET 2007
- make coroapi accessible to cf+.
- moved map handling logic completely to perl
- per player maps are now marked in the map
- maps are saved completely differently now,
and much more often.
- rewrote map header parser and writer, to be much faster.
- maps and players are now (in the average case) loaded
and saved completely asynchronously, I/O contention will no
longer freeze the server.
- players and maps can be loaded anytime, without the player
being logged in.
- automatically generate method interfaces for perl from headers
- unbundled freezethaw
- mostly rewrote common/map.C
- completely rewrite server/swap.C
- introduced "runtime", the CCT clock (corrected crossfire time) :)
- introduced new keyword for map files: file\_format\_version (integer, server version: 0)
- better message for apply failures due to applymode
- removed most all of the weather code
- unified logging to stderr and file
- too many minor changes to document


=== Content from www.vupen.com_2705cde1_20250125_172025.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61


