=== Content from secure.grepular.com_e1a1fda1_20250125_055654.html ===

# [Grepular](./ "Take me Home Mike")

[Log in](./login?redirect=%2FDNS_Prefetch_Exposure_on_Thunderbird_and_Webmail)[Home](./)[Projects](./projects/)[Blog](./blog/)
## DNS Pre-fetch Exposure on Thunderbird and Webmail

*Written 15 years ago by Mike Cardwell*

When you view an email in [Mozilla Thunderbird](http://getthunderbird.com/), it looks at each of the URLs in the body, and does a DNS lookup on each of the domains. It does this so the page loads faster if you click on the link. It doesn’t just happen on HTML emails, it also happens for plain text emails. Viewing the body in “Plain Text” mode rather than the “Original HTML” or “Simple HTML” modes doesn’t prevent it either. This also happens when using webmail clients like GMail and Hotmail and I will discuss that further down the article.

Email clients tend to have a configuration option to prevent remote images from being loaded, and on sane clients this is set by default. If a remote image is fetched to be displayed inside an email, the sender can determine that the email has been read, when it was read, and the IP address it was read from. Even if remote images are disabled in Thunderbird, the DNS prefetching **still** takes place.

A spammer with the domain “example.com,” could send out a mail-shot to all of their addresses, with each email containing a URL with a unique domain. Eg:

```
http://emailaddressX.mailshotY.example.com/

```

They could configure the DNS server on example.com to log all DNS queries. This is simple to do using the [Bind DNS server](https://www.isc.org/software/bind):

```
logging {
    channel query_logging {
        file "/var/log/bind/query" versions 3 size 100M;
        print-time yes;
    };
    category queries {
        query_logging;
    };
};

```

They would then write a simple script for tailing the log file at /var/log/bind/query looking for DNS lookups containing “mailshotY.example.com”.

I tested this on the very latest version of Thunderbird (3.0.1), on both OSX (Snow Leopard) and Windows XP; both were affected. I also tested on Apple Mail and Outlook 2007, neither of which were affected. I didn’t bother testing Mutt or Pine.

This issue seems to have been [discussed](https://bugzilla.mozilla.org/show_bug.cgi?id=492196) back in May, but they don’t seem to have done anything about it.

Worryingly, this issue also affects viewing email in webmail clients. I tested it using hotmail and gmail and both did DNS prefetching on the URLs in the email body. Using HTTPS rather than HTTP disables DNS prefetching. Luckily for GMail users, they recently made all requests HTTPS by default. This would be easily fixed in webmail clients by using X-DNS-Prefetch-Control. In the HTML just before the email is displayed, you would put the following tag to disable prefetching:

```
<meta http-equiv="x-dns-prefetch-control" content="off">

```

In the HTML immediately after the email you would turn DNS prefetching back on with:

```
<meta http-equiv="x-dns-prefetch-control" content="on">

```

**Update:**

Patches for the Webmail clients [IMP](http://www.horde.org/imp/) ([ref](http://bugs.horde.org/ticket/8836)) and [RoundCube](http://www.roundcube.net/) ([ref](http://trac.roundcube.net/ticket/1486449)) have been produced. If you’re serving Webmail with Apache, you can patch this problem in the web server it’s self by adding some mod\_headers config like this:

```
Header set X-DNS-Prefetch-Control "off"

```

If you’re using Thunderbird, you can fix the problem locally by going into the advanced config editor and adding a preference named “network.dns.disablePrefetch” with a boolean value of “true”

Want to leave a tip?![Bitcoin](./images/bitcoin.png)![Monero](./images/monero.svg)![Zcash](./images/zcash.png)[![Paypal](./images/paypal.png)](//www.paypal.me/grepular "Donate via Paypal")You can follow this Blog using [RSS](./rss) or [Mastodon](//mastodon.social/%40grepular). To read more, visit my [blog index](./blog).

Website design, production and hosting by Mike Cardwell

[![Digital Ocean](./images/digitalocean-badge-white.png)](//www.digitalocean.com/?refcode=2529a7adf896 "This Blog, hosted on Digital Ocean - Fast, Cheap, Reliable VPS hosting (affiliate link)")![Bitcoin](./images/bitcoin.png)![Monero](./images/monero.svg)![Zcash](./images/zcash.png)[![Paypal](./images/paypal.png)](//www.paypal.me/grepular "Leave a Paypal tip")[![RSS Feed](./images/icon/rss-26x26.png)](./rss "RSS Feed")

=== Content from bugzilla.mozilla.org_179368f1_20250125_055653.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/492196)
* [XML](/show_bug.cgi?ctype=xml&id=492196)

Closed
[Bug 492196](/show_bug.cgi?id=492196)

Opened 16 years ago
Closed 16 years ago

# Make DNS-Prefetching subject to user-defined policies

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Make DNS-Prefetching subject to user-defined policies

## Categories

### (Core :: Networking, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking#Networking)

Networking
▾

Core :: Networking
For bugs in Mozilla's modular networking library (aka "Netlib" or "Necko".) The networking library supplies the software interface that Mozilla uses to access physical transports (e.g. the Internet and local drives), perform URL resolutions, and handle a variety of networking protocols.

Examples of appropriate bugs: URLs with backslash not fetched; URLs starting with a single slash turn into http:///; Cannot access authenticated FTP site.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

Trunk

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

x86

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

---

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Priority | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mnyromyr, Assigned: bzbarsky)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](extensions/Gravatar/web/default.jpg)  [bzbarsky](/user_profile?user_id=20209)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/b4e3e00188e65c716b400131f56ac0f0?d=mm&size=40)  [mnyromyr](/user_profile?user_id=34346)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

24 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[493467](/show_bug.cgi?id=493467 "RESOLVED FIXED - preserve allowDNSPrefetch and allowAuth and test for completeness")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[486127](/show_bug.cgi?id=486127 "RESOLVED FIXED - Seamonkey/Thunderbird send DNS queries when viewing mail, could be used to verify existence of mail accounts"), [545407](/show_bug.cgi?id=545407 "RESOLVED FIXED - Remove code that disables DNS pre-fetching for APP_TYPE_MAIL/EDITOR docshells")

[453403](/show_bug.cgi?id=453403 "RESOLVED FIXED - add DNS pre-fetching to Necko and Firefox")

Dependency [tree](/showdependencytree.cgi?id=492196&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=492196)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: fixed1.9.1, privacy, regression, Whiteboard: [tb3needs])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

[fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[regression](/buglist.cgi?keywords=regression&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[tb3needs]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [jst](/user_profile?user_id=12352) | [blocking1.9.1](#c5 "16 years ago") | + |
| --- | --- | --- |
| [jst](/user_profile?user_id=12352) | blocking1.9.1 | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Proposed fix](/attachment.cgi?id=377824)  [16 years ago](#c16)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   19.04 KB, patch | jst : [review+](#c18 "16 years ago")  jst : [superreview+](#c18 "16 years ago") | [Details](/attachment.cgi?id=377824&action=edit) | [Diff](/attachment.cgi?id=377824&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377824) |
| --- | --- | --- |
| [1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)](/attachment.cgi?id=377828)  [16 years ago](#c17)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   21.20 KB, patch | jst : [review+](#a623684_12352 "16 years ago")  jst : [superreview+](#a623684_12352 "16 years ago") | [Details](/attachment.cgi?id=377828&action=edit) | [Diff](/attachment.cgi?id=377828&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377828) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Karsten Düsterloh](/user_profile?user_id=34346)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=492196#c0)• 16 years ago |
|  | |

[Bug 453403](/show_bug.cgi?id=453403 "RESOLVED FIXED - add DNS pre-fetching to Necko and Firefox") implemented DNS prefetching in Necko, which has severe security implications:
Local HTML pages will generate DNS queries even if other remote content is disabled, e.g. for mere <a href="...">!
This gets even more creepy if we take into account that SeaMonkey and Thunderbird render \_all\_ messages (even plaintext ones) as HTML documents in a <browser> element. Thus reading a plaintext(!) message will already make you acknowledge the existence of this account (e.g. by using one-time subdomain entries), because even in plaintext mode links are rendered as clickable items.
Until now, there was a commonly agreed assumption that reading local HTML without remote \*content\* will keep your privacy intact. This promise is broken now.
While you can turn off the prefetching entirely by using network.dns.disablePrefetch, this is no real option for SeaMonkey (although maybe for TB), because you can't seriously apply one single setting to public websurfing, viewing local HTML documents in the browser and reading mail all alike without affecting user experience.
We could even work around the mail case by trying to produce certain markup, but that is rather band-aiding than fixing the real issue. And, of course, this will not help a bit when viewing local HTML documents in the browser...Flags: blocking1.9.2?Flags: blocking1.9.1?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=492196#c1)• 16 years ago |
|  | |

We don't actually need user-defined policies, here? What we need is a way to disable DNS prefetch on a per-document basis. Whether this is done via a setting on the docshell or via content policy or some other mechanism is something to decide on during implementation. Now that the prefetch is done after document load completes, maybe a content policy check would sorta work, except the content policy API is completely inappropriate here (e.g. we have no URI we plan to load).
This is a serious problem for any Gecko-based app that's not a pure web browser, and I should have caught it in review... I think this needs to block 1.9.1.Assignee: nobody → mcmanus

|  | [Magnus Melin [:mkmelin]](/user_profile?user_id=101158) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a18065_101158)• 16 years ago |

Keywords: [privacy](/buglist.cgi?keywords=privacy&resolution=---)

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a20303_112088)• 16 years ago |

Whiteboard: [tb3needs]

|  | [Karsten Düsterloh](/user_profile?user_id=34346)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=492196#c2)• 16 years ago |
|  | |

> We don't actually need user-defined policies, here? What we need is a way to
> disable DNS prefetch on a per-document basis.
My Necko foo ist not particularly strong, so please correct my wording where necessary. :)

|  | [neil@parkwaycc.co.uk](/user_profile?user_id=14006) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=492196#c3)• 16 years ago |
|  | |

Is per-document strong enough? For example, suppose I send an email containing <iframe src=data:text/html,%3Ba%20href=<http://unique.evil.com%3D>> ?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=492196#c4)• 16 years ago |
|  | |

Presumably the disabling would need to inherit to child documents, like other docshell settings.
As for [comment 2](/show_bug.cgi?id=492196#c2 "RESOLVED FIXED - Make DNS-Prefetching subject to user-defined policies"), the point is that we don't need either something users can easily set or something that can be set on a per-site basis, as far as I can tell. Something set on the docshell tree root level should be fine.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=492196#c5)• 16 years ago |
|  | |

Yeah, blocking, but yeah, this is an issue only for some non-Firefox apps.Flags: blocking1.9.1? → blocking1.9.1+

|  | [Jason Duell](/user_profile?user_id=334931) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=492196#c6)• 16 years ago |
|  | |

Boris, who's the right person to work on this? Patrick McManus has touched the DNS code recently, but from your comments it sounds like the code might be more in docshell. I'm guessing the right way to proceed to is to have Patrick or someone else add a necko "don't prefetch DNS for this" API, and then someone else might be the right person to do the docshell work.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=492196#c7)• 16 years ago |
|  | |

Patrick is almost certainly the right person to work on this... There's no reason not to learn a bit about the docshell code if you're doing necko work (and in fact, it's a good idea).

|  | [Karsten Düsterloh](/user_profile?user_id=34346)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=492196#c8)• 16 years ago |
|  | |

(In reply to [comment #5](/show_bug.cgi?id=492196#c5 "RESOLVED FIXED - Make DNS-Prefetching subject to user-defined policies"))
> Yeah, blocking, but yeah, this is an issue only for some non-Firefox apps.
Wrong.
Watching a local HTML file with any <a href="link"> in it will result in a DNS query. Of course you can turn off DNS prefetching entirely, but you can't distinguish between wanted prefetching (web) and unwanted ones (local).

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=492196#c9)• 16 years ago |
|  | |

Hold on. Which problems are we trying to solve? The local file case needs a totally different solution, in general, than the mail case. Or rather, the local file solution (pluggable per-origin behavior of some sort) would also solve the mail case, maybe, but the best solution for the mail case will NOT solve your local file issue, almost certainly.
Given that you can't have "other remote content" disabled without an extension for local file pages, I don't think we necessarily need to worry about that case. That same extension can disable DNS prefetch (yes, you get a performance penalty, but you already have a major performance penalty from the extension's existence; globally disabling DNS prefetch may well be a smaller penalty than running a bunch of JS for every single link on the page).
So I think we should focus on the mail-and-such case here, myself.

|  | [Karsten Düsterloh](/user_profile?user_id=34346)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=492196#c10)• 16 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=492196#c9 "RESOLVED FIXED - Make DNS-Prefetching subject to user-defined policies"))
> So I think we should focus on the mail-and-such case here, myself.
Yes, sure. I just want to avoid the notion that DNS prefetching issues are "just" a problem of "some non-Firefox apps".

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=492196#c11)• 16 years ago |
|  | |

Patrick, do you think you'll have time to look into this before the end of the week?

|  | [James May [:fowl2]](/user_profile?user_id=317549) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=492196#c12)• 16 years ago |
|  | |

Would this be "plugged in" to the content policy system?
Then Adblock, etc could filter requests DNS too, or is that another bug?

|  | [Patrick McManus [:mcmanus]](/user_profile?user_id=32546) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=492196#c13)• 16 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=492196#c11 "RESOLVED FIXED - Make DNS-Prefetching subject to user-defined policies"))
> Patrick, do you think you'll have time to look into this before the end of the
> week?
Sorry, fraid not. Someone else should probably look at it.

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=492196#c14)• 16 years ago |
|  | |

Thanks for letting me know, Patrick. Boris said he can look at this, reassigning.Assignee: mcmanus → bzbarsky

|  | [Damon Sicore (:damons)](/user_profile?user_id=269330) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=492196#c15)• 16 years ago |
|  | |

Boris, you think you are going to be able to make the freeze date of Wed, May 20th here? Just want to make sure we're being realistic, and if you haven't started on this one yet, it makes me worry. Thoughts?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=492196#c16)• 16 years ago |
|  | |

Attached patch

[Proposed fix](attachment.cgi?id=377824&action=diff)
— [Details](attachment.cgi?id=377824&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377824)

A few things going on here.
1) Add a boolean member on documents that indicates whether prefetch is allowed
for that document. This defaults to true.
2) Set this member to false if the document gets a window and the docshell is
not allowing prefetch, if the document has an HTTP header or equivalent
META tag disallowing prefetch, or if the "no DNS prefetch from secure" pref
is set and the document gets a principal that has no URI or has an https
URI. This makes document.write from https do the right thing no matter
what we do with the document URI, for example. The code corresponding to
all this in nsHTMLDNSPrefetch goes away.
3) Docshell defaults to allowing prefetch and exposes an nsIDocShell API to
change this. It also defaults to disallowing prefetch if someone sets the
app type to mail or editor. This should immediately fix the issues
thunderbird and seamonkey have, I would think.
4) nsWebBrowser defaults to NOT allowing prefetch, since those APIs are
frozen, but adds a way to enable it via nsIWebBrowserSetup. If this flies,
I'll file a bug on Cammino to enable it on their end.
I revved the docshell iid, but the other interface changes shouldn't need IID revs, I would think. The nsIDocument one is debatable; if desired I can put this member all the way at the end of the nsIDocument members, in which case it will certainly be ok.
I can't think of a sane way to test this automatically, but I did verify via printfs that I get DNS prefetch in Firefox with this patch, but that if I flip the default value in docshell that stops happening....
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: superreview?(jst)
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: review?(jst)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=492196#c17)• 16 years ago |
|  | |

Attached patch

[1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)](attachment.cgi?id=377828&action=diff)
— [Details](attachment.cgi?id=377828&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377828)

[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: superreview?(jst)
[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: review?(jst)

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=492196#c18)• 16 years ago |
|  | |

Comment on [attachment 377824](/attachment.cgi?id=377824 "Proposed fix") [[details]](/attachment.cgi?id=377824&action=edit "Proposed fix") [[diff]](/attachment.cgi?id=377824&action=diff "Proposed fix") [[review]](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377824)
Proposed fix
Looks good. r+sr=jst
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: superreview?(jst)
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: superreview+
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: review?(jst)
[Attachment #377824](/attachment.cgi?id=377824&action=edit "Proposed fix") -
Flags: review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a623684_12352)• 16 years ago |

[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: superreview?(jst)
[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: superreview+
[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: review?(jst)
[Attachment #377828](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") -
Flags: review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=492196#c19)• 16 years ago |
|  | |

Comment on [attachment 377828](/attachment.cgi?id=377828 "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") [[details]](/attachment.cgi?id=377828&action=edit "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") [[diff]](/attachment.cgi?id=377828&action=diff "1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)") [[review]](/page.cgi?id=splinter.html&ignore=&bug=492196&attachment=377828)
1.9.1 version (same, but with an extra interface instead of changing nsIDocShell)
r+sr=jst for this one too, but do we really care about not changing interfaces for 1.9.1 already? Was that decided, if so, I missed it. And have we really kept any such claims?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=492196#c20)• 16 years ago |
|  | |

We promised compat after b4, and we have in fact been keeping it.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=492196#c21)• 16 years ago |
|  | |

Pushed <http://hg.mozilla.org/mozilla-central/rev/cab8d8a075da>Status: NEW → RESOLVEDClosed: 16 years agoResolution: --- → FIXED

|  | [Simon Bünzli](/user_profile?user_id=160571) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a697491_160571)• 16 years ago |

Blocks: [493467](/show_bug.cgi?id=493467 "RESOLVED FIXED - preserve allowDNSPrefetch and allowAuth and test for completeness")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=492196#c22)• 16 years ago |
|  | |

Pushed <http://hg.mozilla.org/releases/mozilla-1.9.1/rev/1cd394f39075>
Filed [bug 493474](/show_bug.cgi?id=493474 "RESOLVED FIXED - Consider enabling DNS prefetch in camino") on camino.Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a726562_20209)• 16 years ago |

No longer blocks: [493467](/show_bug.cgi?id=493467 "RESOLVED FIXED - preserve allowDNSPrefetch and allowAuth and test for completeness")Depends on: [493467](/show_bug.cgi?id=493467 "RESOLVED FIXED - preserve allowDNSPrefetch and allowAuth and test for completeness")

|  | [Benjamin Smedberg](/user_profile?user_id=7044) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a6388385_7044)• 16 years ago |

Flags: blocking1.9.2?

|  | [Owen Marshall (Not reading bugmail)](/user_profile?user_id=42076) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=492196#c23)• 15 years ago |
|  | |

[Bug 544745](/show_bug.cgi?id=544745 "RESOLVED FIXED - DNS Prefetch security issue: Information leak") indicates that DNS prefetching is still occurring for messages on Thunderbird 3.0.1 as well as TB3.1 beta.
I'm not up on my BMO QA: should we dupe that one over to here and reopen this bug, or just leave that as a separate bug?

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)  Assignee |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=492196#c24)• 15 years ago |
|  | |

Separate bug, please, especially given [bug 486127 comment 15](/show_bug.cgi?id=486127#c15 "RESOLVED FIXED - Seamonkey/Thunderbird send DNS queries when viewing mail, could be used to verify existence of mail accounts").

|  | [Mark Banner (:standard8)](/user_profile?user_id=112088) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=492196#a23932761_112088)• 15 years ago |

Blocks: [545407](/show_bug.cgi?id=545407 "RESOLVED FIXED - Remove code that disables DNS pre-fetching for APP_TYPE_MAIL/EDITOR docshells")
You need to [log in](/show_bug.cgi?id=492196&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


