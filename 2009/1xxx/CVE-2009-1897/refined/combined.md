=== Content from lwn.net_46637527_20250126_050553.html ===


[![LWN.net Logo](https://static.lwn.net/images/logo/barepenguin-70.png)
LWN
.net
News from the source](/)
[![LWN](https://static.lwn.net/images/lcorner-ss.png)](/)

* [**Content**](#t)
  + [Weekly Edition](/current/)
  + [Archives](/Archives/)
  + [Search](/Search/)
  + [Kernel](/Kernel/)
  + [Security](/Security/)
  + [Events calendar](/Calendar/)
  + [Unread comments](/Comments/unread)
  + ---
  + [LWN FAQ](/op/FAQ.lwn)
  + [Write for us](/op/AuthorGuide.lwn)
* [**Edition**](#t)
  + [Return to the Security page](/Articles/341620/)

**User:**
**Password:**    |

 |

[**Subscribe**](/subscribe/) /
[**Log in**](/Login/) /
[**New account**](/Login/newaccount)

# Fun with NULL pointers, part 1

> **Benefits for LWN subscribers**
>
> The primary benefit from [subscribing to LWN](/Promo/nst-nag5/subscribe)
> is helping to keep us publishing, but, beyond that, subscribers get
> immediate access to all site content and access to a number of extra
> site features. Please sign up today!

By **Jonathan Corbet**
July 20, 2009

By now, most readers will be familiar with [the local kernel exploit](http://lwn.net/Articles/341773/) recently
posted by Brad Spengler. This vulnerability, which affects the 2.6.30
kernel (and a test version of the RHEL5 "2.6.18" kernel), is interesting in
a number of ways. This article will look in detail at how the exploit
works and the surprising chain of failures which made it possible.

The TUN/TAP driver provides a virtual network device which performs packet
tunneling; it's useful in a number of situations, including virtualization,
virtual private networks, and more. In normal usage of the TUN driver, a
program will open /dev/net/tun, then make an ioctl() call
to set up the network endpoints. Herbert Xu recently noticed a problem
where a lack of packet accounting could let a hostile application pin down
large amounts of kernel memory and generally degrade system performance.
His solution was [a
patch](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=33dccbb050bbe35b88ca8cf1228dcf3e4d4b3554) which adds a "pseudo-socket" to the device which can be used by
the kernel's accounting mechanisms. Problem solved, but, as it turns out,
at the cost of adding a more severe problem.

The TUN device supports the poll() system call. The beginning of
the function implementing this functionality (in 2.6.30) looks like this:

```

    static unsigned int tun_chr_poll(struct file *file, poll_table * wait)
    {
	struct tun_file *tfile = file->private_data;
	struct tun_struct *tun = __tun_get(tfile);
	struct sock *sk = tun->sk;
	unsigned int mask = 0;

	if (!tun)
	    return POLLERR;

```

The line of code which has been underlined above was added by Herbert's
patch; that is where things begin to go wrong. Well-written kernel code
takes care to avoid dereferencing pointers which might be NULL; in fact,
this code checks the tun pointer for just that condition. And
that's a good thing; it turns out that, if the configuring ioctl()
call has been made, tun will indeed be NULL. If all goes
according to plan, tun\_chr\_poll() will return an error status in
this case.

But Herbert's patch added a line which dereferences the pointer prior to
the check. That, of course, is a bug. In the normal course of operations,
the implications of this bug would be somewhat limited: it should cause a
kernel oops if tun is NULL. That oops will kill the process which
made the bad system call in the first place and put a scary traceback into
the system log, but not much more than that should happen. It should be,
at worst, a denial of service problem.

There is one little problem with that reasoning, though: NULL (zero) can
actually be a valid pointer address. By default, the very bottom of the
virtual address space
(the "zero page," along with a few pages above it) is set to disallow all
access as a way of catching null-pointer bugs (like the one described
above) in both user and kernel space.
But it is possible, using
the mmap() system call, to put
real memory at the bottom of the virtual address space. There are some
valid use cases for this functionality, including running legacy binaries.
Even so, most contemporary systems disable page-zero mappings through the
use of the mmap\_min\_addr sysctl knob.

[PULL QUOTE:
Security module checks
are supposed to be additive to the checks which are already made by the
kernel, but it didn't work that way this time.
 END QUOTE]

This knob should prevent a user-space program from mapping the zero page,
and, thus, should ensure that null pointer dereferences cause a kernel
oops. But, for unknown reasons, the mmap() code in the 2.6.30 kernel
explicitly declines to enforce mmap\_min\_addr if the security
module mechanism has been configured into the kernel. That job, instead,
is left to the specific security module being used. Security module checks
are supposed to be additive to the checks which are already made by the
kernel, but it didn't work that way this time; with regard to page zero,
security modules can grant access which would otherwise be denied. To
complete the failure,
Red Hat's default SELinux policy allows mapping the zero page. So, in this
case, running SELinux actually decreased the security of the system.

Not that life is a whole lot better without SELinux.
In the absence of SELinux, the exploit will run up against the
mmap\_min\_addr limit, which would seem like enough to bring things
to a halt. That particular difficulty can be circumvented, though, through
the use of the personality() system call. Enabling the SVR4
personality causes a read-only page to be mapped at address zero when a
program is invoked with exec(), but
only if the process in question has the CAP\_SYS\_RAWIO capability.
So one more trick is required: the top-level exploit code will set the SVR4
personality, then use exec() to run the pulseaudio server with a
special plugin module. Pulseaudio is installed setuid root, so it will get
the zero page mapped at invocation time. By the time
the plugin code is called, pulseaudio has dropped its privileges, but, by
then, the zero page will be available to the exploit code, which can make
the page writeable and place its own data there.

As a result of all this, it is possible for a user-space process to map the
zero page and prevent tun\_chr\_poll() from causing a kernel oops.
But, one would think, that would not get an attacker very far, since that
function checks tun against NULL as the very next thing it does.
This is where the next interesting step in the chain of failures happens:
the GCC compiler will, by default, optimize the NULL test out. The
reasoning is that, since the pointer has already been dereferenced (and has
not been changed), it cannot be NULL. So there is no point in checking it.
Once again, this logic makes sense most of the time, but not in situations
where NULL might actually be a valid pointer.

So, an attacker is able to get into the body of tun\_chr\_poll()
with a NULL tun pointer. One then needs to figure out how to get
control of the kernel using this situation. The next step takes advantage
of this code from a little further into tun\_chr\_poll():

```

	if (sock_writeable(sk) ||
	    (!test_and_set_bit(SOCK_ASYNC_NOSPACE, &sk->sk_socket->flags) &&
	     sock_writeable(sk)))
		mask |= POLLOUT | POLLWRNORM;

```

The value of sk, remember, came from the dereferencing of
tun, so it's under the attacker's control.
SOCK\_ASYNC\_NOSPACE is zero, so the test\_and\_set\_bit()
call can be used to unconditionally set the least significant bit of any word in
memory. As kernel memory corruptions go, this is a small one, but
it turns out to be enough. In Brad's exploit,
sk->sk\_socket->flags points into the TUN driver's
file\_operations structure; in particular, it points to the
mmap() function. The TUN driver does not support mmap(),
so that pointer is normally NULL; after the poll() call, that
pointer is now one instead.

The final step in the exploit is to call mmap() on a file
descriptor for the open TUN device. Since the internal mmap()
operation is no longer NULL (it has been set to one), the kernel will jump
to it. That address also lives within the zero page mapped by the exploit,
so it is under the attacker's control. The exploit will have populated
that address with another jump to its own code. So, when the kernel calls
(what it thinks is) the TUN driver's mmap() function, the result
is arbitrary code being run in kernel mode; at that point the exploit has
total control.

In well-designed systems, catastrophic failures are rarely the result of a
single failure. That is certainly the case here. Several things went
wrong to make this exploit possible: security modules were able to grant
access to low memory mappings contrary to system policy, the SELinux policy
allowed those mappings, pulseaudio can be exploited to make a specific
privileged operation available to exploit code, a NULL pointer was
dereferenced before being checked, the check was optimized out by the
compiler, and the code used the NULL pointer in a way which allowed the
attacker to take over the system. It is a long chain of failures, each of
which was necessary to make this exploit possible.

This particular vulnerability has been
closed, but there will almost certainly be others like it. See [the second
article](http://lwn.net/Articles/342420/) in this series for a look at how the kernel developers are
responding to this exploit.

| Index entries for this article | |
| --- | --- |
| [Kernel](/Kernel/Index) | [Security/Vulnerabilities](/Kernel/Index#Security-Vulnerabilities) |
| [Security](/Security/Index/) | [Linux kernel](/Security/Index/#Linux_kernel) |
| [Security](/Security/Index/) | [Vulnerabilities/Privilege escalation](/Security/Index/#Vulnerabilities-Privilege_escalation) |

---

 to post comments

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 20:14 UTC (Mon)
by **clugstj** (subscriber, #4020)
[[Link](/Articles/342407/)] (4 responses)

It's even a little more convoluted than mentioned in the next-to-the-last paragraph. Since a pointer was set to 1, it also requires that the processor fetch opcodes at byte boundaries. No RISC processor would do that (AFAIK).

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 20:18 UTC (Mon)
by **jengelh** (subscriber, #33263)
[[Link](/Articles/342412/)]

Yeah but the fact that x86en supporting unaligned access dominate makes up for it :-/

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:38 UTC (Mon)
by **spender** (guest, #23067)
[[Link](/Articles/342443/)] (1 responses)

I could have written to the 2nd byte instead (choose your endianness) and the resulting address would be aligned.

The kernel actually being able to use that address directly would depend on the architecture.

I only chose the first byte because I already had my mapping at NULL, so it was easy to reuse it. The exploit primitive there though allows an arbitrary OR of 0x1 to any byte in memory.

-Brad

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 22:27 UTC (Mon)
by **spender** (guest, #23067)
[[Link](/Articles/342464/)]

Clarification/fix: Since the OR is performed on an unsigned long instead of a single byte, then the address of the target may be subject to whatever alignment on architectures that care.

-Brad

### RISC can do that

Posted Jul 22, 2009 18:13 UTC (Wed)
by **klossner** (subscriber, #30046)
[[Link](/Articles/342887/)]

PowerPC silently drops the two low bits when loading an address into the PC, so a branch to 1 becomes a branch to 0. The misaligned-address exception occurs only for load/store instructions.

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 20:14 UTC (Mon)
by **jengelh** (subscriber, #33263)
[[Link](/Articles/342405/)] (23 responses)

Once upon a dereference

>pulseaudio is installed setuid root

\*cough\*

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:39 UTC (Mon)
by **proski** (subscriber, #104)
[[Link](/Articles/342445/)] (18 responses)

We should ensure that setuid programs exit immediately if they are using non-default personalities.

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:53 UTC (Mon)
by **drag** (guest, #31333)
[[Link](/Articles/342454/)] (17 responses)

It would be a lot better just to do away with setuid binaries altogether.

That's what things like policykit and dbus are for...

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 23:33 UTC (Mon)
by **nix** (subscriber, #2304)
[[Link](/Articles/342483/)] (15 responses)

Oh yeah great. So instead of locating setuid binaries and knowing that

\*that\* is my vulnerability surface, I have to parse a huge pile of XML and

hope that there are no bugs in policykit and dbus that might cause

unintended things to be run (and we know there have been \*none\* like that

before). The setuid implementation in the kernel is tiny and trivially

auditable by comparison, sharing virtually all its code with the

tested-to-death-and-hopefully-audited ELF execve() implementation.

PolicyKit has been done right once before. It was called 'userv'.

PolicyKit itself is a huge step backwards if you actually want security.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 7:21 UTC (Tue)
by **gmaxwell** (guest, #30048)
[[Link](/Articles/342526/)] (7 responses)

Yea policy kit. Great stuff.

By default fedora allows the desktop users to change the system time. All they must do is ender the \*user's\* password (not root!) and even that they only have to do it once.

Great stuff great stuff.

Although many people have pointed out the terrible security implications nothing has been done. Sometimes it really does take some high profile compromises to get things fixed.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 9:45 UTC (Tue)
by **cortana** (subscriber, #24596)
[[Link](/Articles/342543/)] (6 responses)

But that's not the fault of PolicyKit itself. Rather it's the fault of the distributor who shipped it with a policy that a) allows an unprivileged user to change the system time and b) does not force them to re-authenticate whenever they wish to do so.

Concerns about the increased vulnerability surface caused by the complexity of PolicyKit are still justified, but Fedora's default policy being stupid is not relevant to that discussion. If we wanted to blame the system for allowing the user to do stupid things then we may as well all give up and move back to Windows. :)

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 9:56 UTC (Tue)
by **nix** (subscriber, #2304)
[[Link](/Articles/342548/)] (5 responses)

The concern isn't just that the vulnerability surface has increased: it's that we can't even easily tell what it is anymore.

Determining the set of privileged code that could carry out operations on behalf of unprivileged users was fairly simple in the days before PolicyKit: find setuid/setgid binaries, chase their shared library dependencies and (if you're paranoid) see what they can dlopen(). Just a grep away, in any case.

Now, we have to analyze the dbus and PolicyKit policies as well, and XML is... not terribly amenable to analysis with Unix-style shell tools. (Some Perl packages come with XML-style XPath-based grep tools, but they are a) rarely installed and b) seriously cumbersome. We really need an awk for XML.)

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 12:52 UTC (Tue)
by **nim-nim** (subscriber, #34454)
[[Link](/Articles/342567/)] (1 responses)

> We really need an awk for XML.

Just use xsltproc directly (though not having to use a detached xslt file would be nice)

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 22:00 UTC (Wed)
by **nix** (subscriber, #2304)
[[Link](/Articles/342926/)]

Ew, no. Utterly un-awklike and doing awk-like transformations with XSLT is

really quite painful. (And yes, you can do awklike languages for things

other than text streams: see gvpr(1) for example.)

(One of many problems is XSLT's heavy use of <>, which makes it very

annoying to use from the shell prompt. Another is its astonishing

verbosity. Another is its total lack of good taste in design... also the

functional nature of it, while one of its nicer aspects, fits very badly

with the shell in my experience.)

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 14:01 UTC (Tue)
by **gmaxwell** (guest, #30048)
[[Link](/Articles/342580/)]

Poliykit plays a role: If you go look at the discussions on the fedora list you'll see that there was some degree of argument what the actual behaviour was Was it asking for a password at all (some people thought it wasn't because it only did so once) and was it asking for the root password? A lot of people had used and never realized that it was asking for their user password rather than root.

SUID is more unambiguous.

### xml awk

Posted Jul 22, 2009 7:08 UTC (Wed)
by **Frej** (guest, #4165)
[[Link](/Articles/342767/)] (1 responses)

xml cli tool

<http://xmlstar.sourceforge.net/>

### xml awk

Posted Jul 22, 2009 11:18 UTC (Wed)
by **nix** (subscriber, #2304)
[[Link](/Articles/342796/)]

That looks nice. Not very awkish though...

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 10:18 UTC (Tue)
by **cortana** (subscriber, #24596)
[[Link](/Articles/342546/)] (4 responses)

You don't have to start at the XML. You can ask the PolicyKit daemon itself what you are currently allowed to do by running polkit-auth; you can get a list of everything you could possibly do with additional authentication by running polkit-auth --show-obtainable; and you can see all the actions that it is possible to perform on a system, and find out which users may perform that action, by running polkit-gnome-authorization. Of course, this requires you to trust that the PolicyKit daemon has not already been compromised. ;)

I also think the docs for PolicyKit are pretty good; the library reference manual contains a Design Overview at <<http://hal.freedesktop.org/docs/PolicyKit/ref-design.html>> that explains how all the parts of the system fit together.

Of course the system is much more complex than the setuid mechanism in the kernel, but--assuming it is audited well--it has the potential to increase system security a lot, because it would allow you to eliminate other setuid programs on the system.

There is certainly no shortage of badly written programs that are installed setuid, but fail to give away all additional privileges but the exact ones it wishes to keep and deal with any of the infinite combinations of things an attacker may do to them before exec is called, such as messing around with the PATH or another similarly dangerous environment variable; creating symlinks that will cause a badly written 'create temporary file' routine to overwrite vital system files; mapping memory to address 0 to bypass security checks in the kernel (<http://lwn.net/Articles/342330/> anyone?) :)

And of course, setuid does not only consist of one system call, but several (setuid, seteuid, setreuid and setresuid), all with subtly different semantics--sometimes modifying the saved user id, sometimes the real user id, yet others the effective uid... oh, and don't forget setfsuid and the capability mechanism. And the fact that different versions of different operating systems all implement subtly different semantics for these system calls... check out Setuid Demystified <<http://www.eecs.berkeley.edu/~daw/papers/setuid-usenix02.pdf>> and the Secure Programming for Linux and Unix HOWTO <[http://www.dwheeler.com/secure-programs/Secure-Programs-H...](http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/index.html)> for more details and other attack mechanisms.

So yeah, PolicyKit is complicated--but is it more complicated than the intersection of the setuid mechanism and all the other stuff an attacker can do to a setuid process before it is executed? :)

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 11:19 UTC (Wed)
by **nix** (subscriber, #2304)
[[Link](/Articles/342797/)] (2 responses)

So the only way you can see what actions can be run on a system with privilege is... to run a GNOME-specific GUI application?

\*sigh\*

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 12:49 UTC (Wed)
by **cortana** (subscriber, #24596)
[[Link](/Articles/342810/)] (1 responses)

It's not GNOME-specific. It just uses GTK+. Yes, it's unfortunate that there is no command-line equivalent, but it shouldn't be too difficult for one to be written--you are just querying the PolicyKit object after all.

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 21:59 UTC (Wed)
by **nix** (subscriber, #2304)
[[Link](/Articles/342925/)]

I think one is essential if PolicyKit can be considered safe to use: we

have to be able to do automated audits and yell at unexpected quiet

changes, lest we miss attacks or accidental fumbles opening up holes.

You're quite right on the fugliness of the UID-setting syscalls in Unix,

but this is not helped by introducing \*more\* :/ again, userv did all this

better (IMNSHO) many years ago. Why more people don't use it I have no

idea.

### Fun with NULL pointers, part 1

Posted Aug 7, 2009 12:21 UTC (Fri)
by **jschrod** (subscriber, #1646)
[[Link](/Articles/345836/)]

I'll have to say that I don't find PolicyKit's documentation very good. I don't know how it is for a developer, but for me as a long-time Unix admin it was frustrating when I had to delve into it a few weeks ago for the first time.

The document linked by you was one of the 1st that I read, btw. It's not that I didn't understand what PolicyKit was supposed to be doing, that was quite clear from the start. And not even that I couldn't read the config files -- while being rather chatty, they were understandable.

Where I didn't succeed, is finding concise information about the overall architecture: how PolicyKit / ConsoleKit / HAL / D-Bus / pam / login processes, both X and console, are \*supposed\* to work together. That would have delivered pointers to information sources that could have answered questions like Where are the names in the PolicyKit XML files from? Which possible names exist on a given system? Which daemons are started and by whom? What are common PolicyKit authorizations, since it is all about policy and nothing about content? The output of polkit-auth --show-obtainable is not sufficient, IMHO. E.g., I'd need to know what org.freedesktop.hal.lock is, and googling it on site:freedesktop.org does \_not\_ provide an adequate answer, at least not for me. (And yes, I've read <http://people.freedesktop.org/~david/hal-spec/hal-spec.html>.)

It was not easy to find the answers to such questions in reasonable time frames because the overall structure had to be laborously reverse engineered by yours humbly. Well, maybe my Google foo may simply be not good enough.

Just my 0.02 EUR. :-)

Joachim

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 2:14 UTC (Wed)
by **Baylink** (guest, #755)
[[Link](/Articles/342736/)]

"vulnerability surface".

Wow. That's an altogether neat concept. Thanks.

### Fun with NULL pointers, part 1

Posted Jul 25, 2009 2:13 UTC (Sat)
by **mikov** (guest, #33179)
[[Link](/Articles/343374/)]

I am with you.

In my mind the key to reasonable security is simplicity. SUID is extremely simple. Compare changing a user's password using passwd to what has to happen in Windows.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 8:37 UTC (Tue)
by **mmahut** (guest, #45550)
[[Link](/Articles/342536/)]

It will eventually go away if we start using file system compatibilities. As far as I know, they've been already implemented in Fedora 10, but RPM will support it just from Fedora 12.

<http://udrepper.livejournal.com/20709.html>

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 0:26 UTC (Tue)
by **kpfleming** (subscriber, #23250)
[[Link](/Articles/342494/)] (1 responses)

What? pulseaudio is setuid-root \*and\* allows non-privileged users to load modules into its process space? What kind of insanity is that?

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 2:13 UTC (Tue)
by **smurf** (subscriber, #17840)
[[Link](/Articles/342498/)]

A setuid program loading unprivileged modules usually isn't a problem if that program drops its privs before doing so.

Usually.

This whole mess goes to show that security is a hard-to-solve problem.

Taking privs off pulseaudio (Linux has been capable of doing better than all-out-setuid for \_how\_ long, exactly ?!?) may or may not be the solution in this case, I haven't checked.

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 14:24 UTC (Wed)
by **mezcalero** (subscriber, #45103)
[[Link](/Articles/342822/)] (1 responses)

pa 0.9.16 is not setuid anymore, because the introduction of rtkit makes that unnecessary.

### Fun with NULL pointers, part 1

Posted Aug 15, 2009 9:01 UTC (Sat)
by **gvy** (guest, #11981)
[[Link](/Articles/347254/)]

Yeah, previously one had to introduce a rootkit. Now it's half-done by prominent distributors. :(

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:07 UTC (Mon)
by **nhippi** (subscriber, #34640)
[[Link](/Articles/342424/)] (2 responses)

1) If gcc can detect the unnecessary NULL check, cant it warn about it? or coverity give a DEAD\_CODE notification?

2) Does anyone use personality(SVR4) these days? The older personalities could be moved behind a switch (/proc/sys/vm/legacy\_personality = 0), where the default is off. While it is only small part of this exploit, this would again make future exploits slighly harder (until someone notices another piece of ignored legacy code).

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 23:39 UTC (Mon)
by **ncm** (guest, #165)
[[Link](/Articles/342480/)] (1 responses)

(1) Coverity has checks for this. The error is so common that it makes up a large fraction of warnings in typical Coverity reports.

(2) Gcc certainly should have a warning for this. However, putting such a warning in "-W" would make people upset (see (1)). That's not meant to be an argument against. It might be easier to get it into -Wall, but it is generally very hard to move a warning from -W to -Wall or the reverse, so if it gets into -Wall it is probably stuck there forever. The warning would likely be issued only when compiling with strong optimization; without optimization the compiler would be unlikely to perform the analysis that would lead to it noticing the problem.

(3) Depending on the offset within the struct type pointed to, the pointer value dereferenced might not refer to zero page, and thus might not trigger a SEGV signal in normal user-level code, even without memory-mapping games.

### Fun with NULL pointers, part 1

Posted Jul 22, 2009 2:18 UTC (Wed)
by **Baylink** (guest, #755)
[[Link](/Articles/342737/)]

Am I the only person who read "has checks for this" and thought "a wart is a crocky feature"?

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:11 UTC (Mon)
by **taviso** (subscriber, #34037)
[[Link](/Articles/342430/)] (2 responses)

Note that the mmap\_min\_addr bypass using personality() was discovered by me and Julien Tinnes, we described it [here](http://blog.cr0.org/2009/06/bypassing-linux-null-pointer.html). We also sent a patch that corrected it to lklm here http://patchwork.kernel.org/patch/32598/

### Fun with NULL pointers, part 1

Posted Jul 23, 2009 5:01 UTC (Thu)
by **johnflux** (guest, #58833)
[[Link](/Articles/342966/)]

You, sir, are a coding god.

### Fun with NULL pointers, part 1

Posted Jul 24, 2009 16:06 UTC (Fri)
by **rogue@autistici.org** (guest, #59770)
[[Link](/Articles/343281/)]

And, may you be glorified for your find as much as spender is for his exploit.

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 21:15 UTC (Mon)
by **spender** (guest, #23067)
[[Link](/Articles/342423/)] (2 responses)

My last name is Spengler (no idea why people assume my alias is my last name). The analysis of the exploit appears correct however.

The choice of the tun file\_operations struct was arbitrary: a different one could have been chosen if the attacker wanted the exploit to work against a custom kernel with CONFIG\_DEBUG\_RODATA enabled. As I've found, since 2007 when most of those structs were made const, people haven't kept up with the standard, so there are a ton of other reliable function pointers to choose from.

The nature of the NULL tun pointer being confined to the tun\_chr\_poll() function (instead of getting leaked out through some means to other complex functions in the kernel) is what makes the vulnerability 100% reliably exploitable.

-Brad

### Fixed

Posted Jul 20, 2009 21:18 UTC (Mon)
by **corbet** (editor, #1)
[[Link](/Articles/342436/)] (1 responses)

> *My last name is Spengler (no idea why people assume my alias is my last name).*

Because they look somewhat the same and we make silly mistakes? I'm sorry about this one; it's been fixed.

### Fixed

Posted Jul 20, 2009 21:34 UTC (Mon)
by **spender** (guest, #23067)
[[Link](/Articles/342442/)]

No problem, it seems to be a common mistake ;)

-Brad

### mmap\_min\_addr and security modules

Posted Jul 20, 2009 21:47 UTC (Mon)
by **fjpop** (guest, #30115)
[[Link](/Articles/342444/)] (2 responses)

> But, for unknown reasons, the mmap() code in the 2.6.30 kernel

> explicitly declines to enforce mmap\_min\_addr if the security module

> mechanism has been configured into the kernel. That job, instead, is

> left to the specific security module being used.

There are plenty of systems where CONFIG\_SECURITY\_SELINUX is set, but

where selinux is either not installed or not activated.

So if the quoted text is correct, then all those systems would be missing

an apparently useful (basic?) security check. Or is the text imprecise

and does the kernel check if a security module is active before ignoring

mmap\_min\_addr?

### mmap\_min\_addr and security modules

Posted Jul 20, 2009 21:53 UTC (Mon)
by **corbet** (editor, #1)
[[Link](/Articles/342450/)] (1 responses)

The code which performs the check was:

```

static inline unsigned long round_hint_to_min(unsigned long hint)
{
#ifdef CONFIG_SECURITY
	hint &= PAGE_MASK;
	if (((void *)hint != NULL) &&
	    (hint < mmap_min_addr))
		return PAGE_ALIGN(mmap_min_addr);
#endif
	return hint;
}

```

So it was taken out at *compile* time; the presence of an actual security module is not really relevant.

### mmap\_min\_addr and security modules

Posted Jul 20, 2009 22:15 UTC (Mon)
by **spender** (guest, #23067)
[[Link](/Articles/342460/)]

That's not the right check. security\_file\_mmap (which is either set by the capabilities module or overriden by the SELinux module) is what implements the final check. The one you pasted doesn't even apply for MAP\_FIXED but is just to ensure that the allocator doesn't choose an address below mmap\_min\_addr when only a hint is specified.

If SELinux is compiled into the kernel, it needs to be disabled at boot via the kernel command-line, otherwise it registers its hooks with LSM and overrides that of the capabilities module for security\_file\_mmap which performs the mmap\_min\_addr check.

-Brad

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 22:25 UTC (Mon)
by **mjw** (subscriber, #16740)
[[Link](/Articles/342463/)] (3 responses)

Nice overview. What trick was used to actually open the /dev/net/tun device?

On my CentOS systems it is:

crw------- 1 root root 10, 200 Jul 16 12:18 /dev/net/tun

so doesn't seem to be accessible by non-root normally.

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 23:13 UTC (Mon)
by **dwmw2** (subscriber, #2063)
[[Link](/Articles/342473/)]

On up to date systems it should have mode 0666. Only users with CAP\_NET\_ADMIN can create new tun devices, but then they can be made persistent and given to specific users/groups — who need to be able to open /dev/net/tun in order to attach to them.

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 23:18 UTC (Mon)
by **eparis** (guest, #33060)
[[Link](/Articles/342477/)] (1 responses)

apparently some udev script which makes it world rw, I'm told (but haven't verified) that some VPN program changes it so they can run as normal users...

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 16:10 UTC (Tue)
by **dwmw2** (subscriber, #2063)
[[Link](/Articles/342606/)]

> *"apparently some udev script which makes it world rw, I'm told (but haven't verified) that some VPN program changes it so they can run as normal users..."*

Yes, the udev script creates it with mode 0666 because that's the recommended configuration.

It's been possible to make tun devices that can be used by non-root since [February 2002](http://git.kernel.org/?p=linux/kernel/git/tglx/history.git;a=commitdiff;h=4fdbe71c852f4b44203913c93a5d3a8a12041167#patch96).

However, it was only in [June 2006](http://git.kernel.org/linus/ca6bb5d7ab22ac79f608fe6cbc6b12de6a5a19f0) that we made it reasonable to have 0666 permissions on /dev/net/tun, by adding the CAP\_NET\_ADMIN checks before creating new devices.

The [OpenConnect](http://www.infradead.org/openconnect.html) VPN client, when used in conjunction with its NetworkManager plugin, will use this facility to run as its own unprivileged user. After the stupid tmpfile races we saw in Cisco's own client which runs as root, it seemed like an appropriate design choice for limiting security exposure (even though I couldn't *possibly* be as incompetent as the Cisco engineers).

### Fun with NULL pointers, part 1

Posted Jul 20, 2009 23:53 UTC (Mon)
by **job** (guest, #670)
[[Link](/Articles/342486/)] (2 responses)

The fact that those changes make it into the kernel in the first place is slightly worrying. Should an unchecked pointer deference not be caught with a static code checker? What about Sparse, isn't that run routinely? Perhaps automatic comments could be added to code already at the mailing list publication stage.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 0:00 UTC (Tue)
by **spender** (guest, #23067)
[[Link](/Articles/342487/)]

A static checker is useless unless someone actually bothers to fix the things it reports.

It's already been agreed upon that static checkers can find these bugs, yet clearly they're being produced faster than they're fixed.

-Brad

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 0:04 UTC (Tue)
by **proski** (subscriber, #104)
[[Link](/Articles/342490/)]

Sparse doesn't check for it yet. Perhaps it should. But please realize that it's not just an "unchecked code dereference", it's a dereference before check.

### A zero pointer is not a null pointer

Posted Jul 21, 2009 10:57 UTC (Tue)
by **epa** (subscriber, #39769)
[[Link](/Articles/342558/)] (9 responses)

Since the zero page can be mapped and therefore 0x0 is a valid address, the zero bit pattern should not be used for the null pointer. The null pointer is supposed to be an invalid pointer that never points to any addressable memory. From the C99 standard:
> If a null pointer constant is converted to a
> pointer type, the resulting pointer, called a null pointer, is guaranteed to compare unequal to a pointer to any object or function.

The C runtime should use some other magic value to represent the null pointer - and the kernel should promise never to map any addressable memory there.

### A zero pointer is not a null pointer

Posted Jul 21, 2009 11:07 UTC (Tue)
by **tialaramex** (subscriber, #21167)
[[Link](/Articles/342560/)] (8 responses)

Now why would you want people to spill coffee all over their keyboards?

### A zero pointer is not a null pointer

Posted Jul 22, 2009 9:02 UTC (Wed)
by **epa** (subscriber, #39769)
[[Link](/Articles/342780/)] (7 responses)

It would be possible to keep 0x0 for the null pointer while respecting the C99 standard: the compiler would need to put in a couple of extra instructions for every pointer comparison making sure that 0x0 != P for any value of P. Optionally, it could also put in a check before every pointer dereference making sure the pointer is not 0x0 and causing a SIGSEGV if it is (since the memory layout can no longer be relied on to guarantee that).

### A zero pointer is not a null pointer

Posted Jul 24, 2009 20:38 UTC (Fri)
by **giraffedata** (guest, #1954)
[[Link](/Articles/343318/)] (5 responses)

> It would be possible to keep 0x0 for the null pointer while respecting the C99 standard: the compiler would need to put in a couple of extra instructions for every pointer comparison making sure that 0x0 != P for any value of P.

Do we know Gcc doesn't do this? Seems like it would have to, to be C99 compliant.
> Optionally, it could also put in a check before every pointer dereference making sure the pointer is not 0x0 and causing a SIGSEGV if it is (since the memory layout can no longer be relied on to guarantee that).

But then how would you represent a pointer to a data structure that resides at address 0? A pointer should be able to do that.

It would of course be unrealistically expensive on typical machines to represent a pointer with anything but a simple address, but pointer comparisons are rare enough that a few extra instructions for them seems worthwhile to maintain the null pointer concept.

Regardless of how the compiler chooses to represent pointers (null or otherwise), the optimization in question is logically sound. C99 says a dereference of a null pointer causes undefined behavior, so either a) tun is non-null and !tun must be false or b) tun is null and !tun can be anything, including false.

### A zero pointer is not a null pointer

Posted Jul 24, 2009 22:06 UTC (Fri)
by **nix** (subscriber, #2304)
[[Link](/Articles/343336/)] (4 responses)

GCC certainly doesn't insert code checking if a pointer is NULL before

every pointer dereference. Considering how common pointer dereferencing is

in C and related languages, this would be a substantial slowdown for no

real gain, given that multiuser OSes invariably trap such things, and

non-multiuser OSes are specialist environments in which attacks by hostile

local users are not so common (yet).

That kernel space has to work when the lower part of its address space is

effectively under the control of a hostile attacker is a unique problem

which it is really not worth changing the C standard for, nor imposing

vast overheads on all userspace code. -fno-delete-null-pointer-checks does

the job.

### A zero pointer is not a null pointer

Posted Jul 25, 2009 2:51 UTC (Sat)
by **giraffedata** (guest, #1954)
[[Link](/Articles/343376/)] (3 responses)

> GCC certainly doesn't insert code checking if a pointer is NULL before
> every pointer dereference.

Sure, but that wouldn't improve standards compliance anyway. I asked if GCC generates extra code to comply with the C99 requirement that a null pointer not be equal to any non-null one (while still allowing the existence of pointers to a data structure that resides at address 0). Thinking about it now, though, I don't see how any such code is possible since a null pointer still has to compare equal to another null pointer.

> That kernel space has to work when the lower part of its address space is
> effectively under the control of a hostile attacker is a unique problem
> which it is really not worth changing the C standard for,

There has been no proposal to deal with this by changing the standard,
which GCC apparently ignores anyhow. And objection to GCC's conflation of null pointers and zero-address pointers wasn't that it's a security problem but that it's a basic correctness problem. Even without a hostile page 0, unless you proclaim data structures at address 0 don't exist, this optimization breaks code.

### A zero pointer is not a null pointer

Posted Jul 25, 2009 12:49 UTC (Sat)
by **nix** (subscriber, #2304)
[[Link](/Articles/343400/)] (2 responses)

GCC doesn't ignore the standard: you simply can't have data structures

that reside at address zero. Shaving off 1/2^32 or less of the address

space, and disabling an optimization in the one place that cares about

this (the kernel) does not seem like a terrible cost to me.

Data structures at address zero do not exist on any sane C platform.

### A zero pointer is not a null pointer

Posted Jul 25, 2009 23:18 UTC (Sat)
by **PaXTeam** (guest, #24616)
[[Link](/Articles/343434/)] (1 responses)

> Data structures at address zero do not exist on any sane C platform.

so platforms without an MMU are not sane?

### A zero pointer is not a null pointer

Posted Jul 26, 2009 18:27 UTC (Sun)
by **nix** (subscriber, #2304)
[[Link](/Articles/343462/)]

Well, you can't access a structure at address zero on such a platform

without either disabling all optimizations that involve knowing which

pointers are null (as the kernel now is) and taking great care to ensure

that you never need anything that can point to said structure to be NULL

at any time, or defining the null pointer to be other than all-bits-zero

(allowed, but weird, about as rare as platforms with strange word sizes).

I'd say that trying to access structures at address zero, MMU or no MMU,

is extremely unusual and not really sane to handle in a general-purpose

compiler. (GCC goes further than I would expect in actually having a

switch that makes it possible to use such a barmy thing.)

### A zero pointer is not a null pointer

Posted Jul 25, 2009 9:37 UTC (Sat)
by **spitzak** (guest, #4593)
[[Link](/Articles/343395/)]

That won't work, plenty of code assumes that comparing two NULL pointers for equality will return

true.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 11:48 UTC (Tue)
by **dunlapg** (guest, #57764)
[[Link](/Articles/342562/)] (1 responses)

Who on earth implemented the gcc "optimization"? Check-for-null-after-use is almost always a bug, isn't it? It should be throwing a warning out, not optimizing the null check away.

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 12:01 UTC (Tue)
by **johill** (subscriber, #25196)
[[Link](/Articles/342563/)]

I'd think very often it's not. Imagine the NULL pointer check was inserted by a macro or an inlined function, into a function that's known to be called with a non-NULL argument, say because that argument is on the stack.

### Optimizations and undefined behavior

Posted Jul 21, 2009 15:59 UTC (Tue)
by **amnon** (guest, #43382)
[[Link](/Articles/342593/)] (16 responses)

This bug made me think about other scenarios where optimizations can change the meaning of the code:

The program was accessing the pointer without checking for NULL. Since the result of dereferencing a null pointer is undefined, the compiler "inferred" that the pointer is never null, and optimized away the check.

That's valid logic, but there are rare cases where code intentionally uses undefined behavior. For example, OpenSSL tries to get entropy by reading an uninitialized buffer. If at any point in the future an optimization is introduced in the compiler which assumes that uninitialized variables are never accessed, bad things could happen.

### Optimizations and undefined behavior

Posted Jul 21, 2009 18:05 UTC (Tue)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342639/)] (15 responses)

*there are rare cases where code intentionally uses undefined behavior.*

No correct cases.

Undefined really means undefined. There was *never* any guarantee that the value used in the OpenSSL code would provide any entropy. Undefined doesn't mean "random", "unknown", or "non-deterministic", it means "implementation dependent".

So, yes, it's difficult to get entropy without a specific service that provides entropy. But that's what you need, not just a garbage variable.

### Optimizations and undefined behavior

Posted Jul 21, 2009 19:42 UTC (Tue)
by **martinfick** (subscriber, #4455)
[[Link](/Articles/342658/)] (14 responses)

*it means "implementation dependent".*

which as others have pointed out, is the purpose of undefined in the C spec, which does not mean that it has *"No correct cases."*, but rather, that you'd better be familiar with the implementation you are using. It makes no sense to say: "Here is a feature not available elsewhere, that we think it valuable, but you should never use it!" does it?

### Optimizations and undefined behavior

Posted Jul 21, 2009 20:04 UTC (Tue)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342662/)] (12 responses)

"Implementation dependent" means that the folks who change the compiler, the C library, the kernel, and any stack-smashing detection/prevention code that you are using have the right to change the behavior at any time without documenting the particular side-effect that your code is depending upon.

Especially in the context of the various stack-smashing prevention hacks going around, you have no reason to believe that an uninitialized variable would not actually be initialized to a fixed value.

Undefined stuff is not a service that you can count on. Ever.

### Optimizations and undefined behavior

Posted Jul 21, 2009 20:11 UTC (Tue)
by **martinfick** (subscriber, #4455)
[[Link](/Articles/342664/)] (11 responses)

*"Implementation dependent" means that the folks who change the compiler, the C library, the kernel, and any stack-smashing detection/prevention code that you are using have the right to change the behavior at any time without documenting the particular side-effect that your code is depending upon.*

No, it does not always mean this. In this particular case it may, but it is perfectly reasonable for a specific C compiler to specify its behavior when the standard says that it is undefined, that is the point of "undefined" and "Implementation dependent".

"Implementation dependent" != `cat /dev/urandom`

### Optimizations and undefined behavior

Posted Jul 21, 2009 20:55 UTC (Tue)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342668/)] (9 responses)

The recent ext3 fsync() snafu is a good example of implementation dependent behavior becoming taken as an implicit guarantee. And then the developer had to reduce the scope of the promise for performance reasons. He ended up regretting that he had ever made that feature visible.

Anyway, there was no such guarantee in this case.

### Optimizations and undefined behavior

Posted Jul 21, 2009 22:39 UTC (Tue)
by **mjg59** (subscriber, #23239)
[[Link](/Articles/342711/)] (8 responses)

The role of software is to be useful to its consumers. Software that fails in this will tend to end up being ignored in the long run.

### Optimizations and undefined behavior

Posted Jul 22, 2009 1:28 UTC (Wed)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342732/)] (7 responses)

Matt, you aren't seriously proposing that we provide some sort of user contract regarding the contents of uninitialized variables being reliable sources of entropy.

Regarding ext3, this problem came up because fsync() was implemented as a performance pig, at least in ext3, and rather than fix it we trained application developers that they'd be safe without it. Had fsync() been repaired when the mozilla problem came up, nobody would be arguing about it today.

### Optimizations and undefined behavior

Posted Jul 22, 2009 1:39 UTC (Wed)
by **mjg59** (subscriber, #23239)
[[Link](/Articles/342733/)] (6 responses)

If a system left truly random numbers in uninitialised variables and applications started making use of that functionality (even if undocumented), then I think you'd need a very good reason to change that behaviour. But since I can't imagine any sane system ever doing that, no, I'm not proposing that we need a user contract on that point.

Contrast that to the ext3 behaviour. While, yes, the behaviour of fsync() on ext3 did result in people being even less likely to use it, the fact that ext3 also made it possible to overwrite a file without having to go through a cumbersome sequence of fsync()ing both the data and the directory made it attractive to application writers. That behaviour dates back far beyond Firefox 3, as demonstrated by people's long-term complaints about XFS leaving their files full of zeros after a crash. ext4 now provides the same ease of use because people made it clear that they weren't going to use it otherwise. Future Linux filesystems are effectively forced to provide the same semantics, which is a good thing.

### Optimizations and undefined behavior

Posted Jul 22, 2009 3:28 UTC (Wed)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342748/)] (5 responses)

Sigh. Good developers are still going to do create temp, write, fsync file, link to permanent name, unlink temp. Fsync on the directory, though, shouldn't be necessary.

### Optimizations and undefined behavior

Posted Jul 22, 2009 4:16 UTC (Wed)
by **mjg59** (subscriber, #23239)
[[Link](/Articles/342753/)]

Good developers aren't going to have to - good operating systems will provide guarantees above and beyond POSIX. Operating systems that don't will end up poorly supported and gradually become irrelevant.

### Optimizations and undefined behavior

Posted Jul 23, 2009 5:07 UTC (Thu)
by **johnflux** (guest, #58833)
[[Link](/Articles/342968/)]

I hope not. Good developers will realize that fsync is a complete overkill there. They don't need wait for the changes to actually be made to disk before continuing - they only need to make sure that the changes happen in the right order.

### Optimizations and undefined behavior

Posted Jul 30, 2009 13:38 UTC (Thu)
by **forthy** (guest, #1525)
[[Link](/Articles/344428/)] (2 responses)

The problem with fsync() is that it's semantics resemble whery much the
one of "PLEASE" in INTERCAL, which means it is a joke. fsync() basically
has **no** semantics, except "make it so" (make it persistent now).
Now, all file system operations are persistent, anyway, just not made
persistent **now**. You can't properly test (that is: automated),
because to test if there's a missing fsync(), you have to force an
unexpected reboot, and then check if there's any missing data. What's
worse: A number of popular Unix programming languages don't even have
fsync(), starting with all kinds of shell scripts. fsync() is a dirty hack
introduced into Unix because of broken (but extremely fast) file system
implementations.

We know that [Unix is a joke](http://www.asandler.com/jokes/computer/c.shtml)
for quite some time, but parts of the API like fsync() show that this is
not so far away from the truth ;-). From the kernel development side it is
always "easier" to maintain a sloppy specification and blame the loser,
but that's the wrong thinking. You are providing a service. Same thing for
GCC: Compiler writers provide a service. Using a sloppy specification for
questionable "optimizations" is wrong, as well. If the compiler writer
can't know that the code really will break when accessing the NULL
pointer, then he can't take the test out after having accessed an object.
I remember GCC taking out tests like if(x+n>x), because overflows are said
to be unspecified in the C language, but compiling code to a machine where
overflows were very specifically handled as wraparounds in two's
complement representation. This is all wrong thinking.

### Optimizations and undefined behavior

Posted Jul 30, 2009 15:04 UTC (Thu)
by **foom** (subscriber, #14868)
[[Link](/Articles/344437/)]

> I remember GCC taking out tests like if(x+n>x)

Still does. You can use -fwrapv if you want to tell it that you want signed number overflow to be

defined as wrapping.

### Optimizations and undefined behavior

Posted Jul 30, 2009 21:31 UTC (Thu)
by **nix** (subscriber, #2304)
[[Link](/Articles/344584/)]

fsync(), brought to you by the same people who thought up 'volatile',

another equally impossible-to-define-except-by-reference-to-implementation

feature.

### Optimizations and undefined behavior

Posted Jul 30, 2009 13:31 UTC (Thu)
by **lysse** (guest, #3190)
[[Link](/Articles/344432/)]

> "Implementation dependent" != `cat /dev/urandom`

Wasn't that where Bruce came in...? ;)

### Optimizations and undefined behavior

Posted Jul 31, 2009 14:28 UTC (Fri)
by **hozelda** (guest, #19341)
[[Link](/Articles/344720/)]

I know the conversation is partly about what developers should depend on or not, but keep in mind that "undefined behavior" and "implementation-defined behavior" mean something precise and completely different from each other in C99. See Chapter 3 (and 4) and informative Appendix J <http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1336.pdf>

### Fun with NULL pointers, part 1

Posted Jul 21, 2009 19:14 UTC (Tue)
by **zeekec** (subscriber, #2414)
[[Link](/Articles/342652/)] (2 responses)

[Nasal demons!](http://catb.org/jargon/html/N/nasal-demons.html)

### #pragma and GCC

Posted Jul 21, 2009 21:48 UTC (Tue)
by **BrucePerens** (guest, #2510)
[[Link](/Articles/342691/)] (1 responses)

Some time in the 80's, when RMS was still coding GCC, the response to #pragma in C was explicitly stated to be undefined, so that your compiler could have whatever magic happen that it wished.

So, RMS coded GCC to start the game "rogue" when it saw #pragma.

### #pragma and GCC

Posted Jul 22, 2009 15:46 UTC (Wed)
by **zeekec** (subscriber, #2414)
[[Link](/Articles/342844/)]

Wouldn't that be a great response to a NULL dereference in the kernel.

Copyright © 2009, Eklektix, Inc.

This article may be redistributed under the terms of the
[Creative
Commons CC BY-SA 4.0](http://creativecommons.org/licenses/by-sa/4.0/) license

Comments and public postings are copyrighted by their creators.

Linux is a registered trademark of Linus Torvalds



=== Content from access.redhat.com_ba54f775_20250126_050552.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.vupen.com_1bf7eef4_20250125_013805.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.redhat.com_2bd518de_20250126_050551.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D512284)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D512284)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D512284)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 512284

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 512284**](show_bug.cgi?id=512284)
(CVE-2009-1897)
- [CVE-2009-1897](https://access.redhat.com/security/cve/CVE-2009-1897) kernel: tun/tap: Fix crashes if open() /dev/net/tun and then poll() it

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2009-1897 kernel: tun/tap: Fix crashes if open() /dev/net/tun and then po...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED UPSTREAM | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2009-1897 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | Duplicates (1): | [512673](show_bug.cgi?id=512673 "CLOSED DUPLICATE - kernel: security: root-exploit if tun not set")  ([view as bug list](buglist.cgi?bug_id=512673)) | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [512285](show_bug.cgi?id=512285) [512286](show_bug.cgi?id=512286) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | | TreeView+ | [depends on](buglist.cgi?bug_id=512284&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=512284&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2009-07-17 03:48 UTC by Eugene Teo (Security Response) | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2021-11-12 19:58 UTC ([History](show_activity.cgi?id=512284)) | | [CC List:](page.cgi?id=fields.html#cclist) | 16 users (show)  dhoward dkovalsk gregswift herbert.xu jlieskov jmorris jpirko jskrabal liko lwang ma mcepl mjc paul tao vfalico | | Fixed In Version: |  | | | Doc Type: | Bug Fix | | | Doc Text: |  | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2010-12-21 18:00:54 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=512284#c0)  Eugene Teo (Security Response)    2009-07-17 03:48:45 UTC  ``` Reported by Eugene Kapun: Fix NULL pointer dereference in tun_chr_pool() introduced by commit 33dccbb050bbe35b88ca8cf1228dcf3e4d4b3554 ("tun: Limit amount of queued packets per device") and triggered by this code:      int fd;     struct pollfd pfd;     fd = open("/dev/net/tun", O_RDWR);     pfd.fd = fd;     pfd.events = POLLIN | POLLOUT;     poll(&pfd, 1, 0);  Upstream commit: <http://git.kernel.org/linus/3c8a9c63d5fd738c261bd0ceece04d9c8357ca13>  References: <http://lkml.org/lkml/2009/7/6/19> [https://bugzilla.redhat.com/show_bug.cgi?id=495863](show_bug.cgi?id=495863 "CLOSED ERRATA - kernel: tun: Add packet accounting") <http://lists.grok.org.uk/pipermail/full-disclosure/2009-July/069714.html> <http://git.kernel.org/linus/33dccbb050bbe35b88ca8cf1228dcf3e4d4b3554> <http://article.gmane.org/gmane.linux.network/124939> <http://git.kernel.org/linus/a3ca86aea507904148870946d599e07a340b39bf>   ```  [Comment 5](show_bug.cgi?id=512284#c5)  Eugene Teo (Security Response)    2009-07-17 11:23:57 UTC  ``` The Red Hat Security Response Team is aware of the Linux kernel local privilege escalation exploit that is published in a number of security mailing lists and websites. The flaw identified by [CVE-2009-1897](https://access.redhat.com/security/cve/CVE-2009-1897) is a null pointer dereference vulnerability in the tun_chr_poll() function of the Linux kernel, introduced via the upstream git commit 33dccbb0. This flaw affects kernel versions between 2.6.30-rc1 and 2.6.31-rc3, and was addressed via the upstream git commit 3c8a9c63.  The flaw affects only the Red Hat Enterprise Linux 5.4 beta kernel as the upstream git commit 33dccbb0 was backported to the kernel as a normal bug fix. We will be addressing this flaw in a future update to the beta kernel. It is also possible to mitigate this flaw by ensuring that the permissions for /dev/net/tun is restricted to root only.  The default SELinux policy, in Red Hat Enterprise Linux 5, allows processes in the unconfined domains to map low memory in the kernel. The exploit did not bypass the null pointer dereference protection in the Linux kernel. However, we are updating the selinux-policy package to change this default configuration, so that it prevents the unconfined processes from being able to map the low memory. See [bug 511143](show_bug.cgi?id=511143 "CLOSED ERRATA - selinux policy allows addr 0 mappings by default") for more information.  This issue does not affect any other released kernel in any Red Hat product.  In addition, future updates to Red Hat Enterprise Linux kernels may include the '-fno-delete-null-pointer-checks' gcc CFLAGS. See: <http://git.kernel.org/linus/a3ca86aea507904148870946d599e07a340b39bf>  We would like to thank Brad Spengler for bringing these issues to our attention.   ```  [Comment 13](show_bug.cgi?id=512284#c13)  Mark J. Cox    2009-07-20 08:54:54 UTC  ``` The CVSS 'access complexity' metric was originally set to AC:M but I incorrectly changed it to AC:L. I've now put it back to AC:M.  This is because by default /dev/net/tun is restricted to root only access, but it's probable that a system owner could have changed the permissions.   ```  [Comment 14](show_bug.cgi?id=512284#c14)  Jan Lieskovsky    2009-07-20 18:20:31 UTC  ``` MITRE's [CVE-2009-1897](https://access.redhat.com/security/cve/CVE-2009-1897) entry:  The tun_chr_poll function in drivers/net/tun.c in the tun subsystem in the Linux kernel 2.6.30 and 2.6.30.1, when the -fno-delete-null-pointer-checks gcc option is omitted, allows local users to gain privileges via vectors involving a NULL pointer dereference and an mmap of /dev/net/tun, a different vulnerability than [CVE-2009-1894](https://access.redhat.com/security/cve/CVE-2009-1894).  References: ----------- <http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2009-1897> <http://archives.neohapsis.com/archives/fulldisclosure/2009-07/0241.html> <http://archives.neohapsis.com/archives/fulldisclosure/2009-07/0246.html> <http://lkml.org/lkml/2009/7/6/19> <http://article.gmane.org/gmane.linux.network/124939> <http://www.openwall.com/lists/oss-security/2009/07/17/1> <http://grsecurity.net/~spender/cheddar_bay.tgz> <http://isc.sans.org/diary.html?storyid=6820> <http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=3c8a9c63d5fd738c261bd0ceece04d9c8357ca13> [https://bugzilla.redhat.com/show_bug.cgi?id=512284](show_bug.cgi?id=512284 "CLOSED UPSTREAM - CVE-2009-1897 kernel: tun/tap: Fix crashes if open() /dev/net/tun and then poll() it") <http://secunia.com/advisories/35839> <http://www.vupen.com/english/advisories/2009/1925> <http://xforce.iss.net/xforce/xfdb/51803>   ```  [Comment 15](show_bug.cgi?id=512284#c15)  Danny Feng    2009-07-23 05:29:35 UTC  ``` *** [Bug 512673](show_bug.cgi?id=512673 "CLOSED DUPLICATE - kernel: security: root-exploit if tun not set") has been marked as a duplicate of this bug. ***   ```  [Comment 16](show_bug.cgi?id=512284#c16)  Fedora Update System    2009-07-29 22:25:53 UTC  ``` kernel-2.6.29.6-217.2.3.fc11 has been submitted as an update for Fedora 11. <http://admin.fedoraproject.org/updates/kernel-2.6.29.6-217.2.3.fc11>   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=512284&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_01874e4f_20250126_050552.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.redhat.com_42e0bdd0_20250125_013807.html ===

[Skip to content](#rhb-main-content)
## Featured links

* [![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)](https://www.redhat.com/en/summit)
* [Support](https://access.redhat.com/)
* [Documentation](https://docs.redhat.com/en)
* [Console](https://cloud.redhat.com/)
* [Developers](https://developers.redhat.com/)
* [Start a trial](/en/products/trials)
* All Red Hat
  + For customers
    - [Customer support](https://access.redhat.com/)
    - [Subscription management](https://access.redhat.com/management)
    - [Support cases](https://access.redhat.com/support/cases)
    - [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
    - [Find a partner](https://catalog.redhat.com/partners)
  + For partners
    - [Partner portal](https://connect.redhat.com/partner-admin/dashboard)
    - [Partner support](https://connect.redhat.com/en/support)
    - [Become a partner](https://connect.redhat.com/)
  + Try, buy, & sell
    - [Red Hat Marketplace](https://marketplace.redhat.com/en-us)
    - [Red Hat Store](https://www.redhat.com/en/store)
    - [Contact sales](/en/contact)
    - [Start a trial](/en/products/trials)
  + Learning resources
    - [Documentation](https://docs.redhat.com/en)
    - [Training and certification](/en/services/training-and-certification)
    - [Hybrid cloud learning hub](https://cloud.redhat.com/learn)
    - [Interactive labs](/en/interactive-labs)
    - [Learning community](https://learn.redhat.com/)
    - [Red Hat TV](https://tv.redhat.com)
  + Open source communities
    - [Global advocacy](https://access.redhat.com/accelerators)
    - [How we contribute](/en/about/our-community-contributions)
[Red Hat](/en)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* Explore more
### Platform products

* [Red Hat Enterprise LinuxA flexible, stable operating system to support hybrid cloud innovation.](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShiftA container platform to build, modernize, and deploy applications at scale.](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation PlatformNew versionA foundation for implementing enterprise-wide automation.](/en/technologies/management/ansible)
### Try & buy

* [Start a trialAssess a product with a no-cost trial.](/en/products/trials)
* [Buy onlineBuy select products and services in the Red Hat Store.](https://www.redhat.com/en/store)
* [Integrate with major cloud providersBuy Red Hat solutions using committed spend from providers, including:
  ![Cloud providers: Amazon Web Services, Microsoft Azure, and Google Cloud](https://www.redhat.com/rhdc/managed-files/cloud-providers-2x.png)](/en/partners/certified-cloud-and-service-providers)
### Featured

* [Red Hat Enterprise Linux AI](/en/technologies/linux-platforms/enterprise-linux/ai)
* [Red Hat OpenShift AI](/en/technologies/cloud-computing/openshift/openshift-ai)
* [Red Hat OpenShift Virtualization](/en/technologies/cloud-computing/openshift/virtualization)
* [Red Hat OpenShift Service on AWS](/en/technologies/cloud-computing/openshift/aws)
* [Microsoft Azure Red Hat OpenShift](/en/technologies/cloud-computing/openshift/azure)
[See all products](/en/technologies/all-products)

* [Application platformSimplify the way you build, deploy, manage, and secure apps across the hybrid cloud.](/en/solutions/application-platform)
* [Artificial intelligenceBuild, deploy, and monitor AI models and apps with Red Hat's open source platforms.](/en/solutions/ai)
* [Edge computingDeploy workloads closer to the source with security-focused edge technology.](/en/products/edge)

* [IT automationUnite disparate tech, teams, and environments with 1 comprehensive automation platform.](/en/solutions/it-automation)
* [Linux standardizationGet consistency across operating environments with an open, flexible infrastructure.](/en/solutions/linux-standardization)

* [SecurityDeliver software using trusted platforms and real-time security scanning and remediation.](/en/solutions/trusted-software-supply-chain)
* [VirtualizationModernize operations using a single platform for virtualized and containerized workloads.](/en/solutions/virtualization)
### By industry

* [Automotive](/en/solutions/automotive)
* [Financial services](/en/solutions/financial-services)
* [Healthcare](/en/solutions/healthcare)
* [Industrial sector](/en/solutions/industrial-sector)
* [Media and entertainment](/en/solutions/media-entertainment)
* [Public sector](/en/solutions/public-sector)
* [Telecommunications](/en/solutions/telecommunications)
[Explore solutions](/en/solutions)
### [Services](/en/services)

* [Consulting](/en/services/consulting)
* [Services for AI](/en/services/consulting/red-hat-consulting-for-ai)
* [Technical Account Management](/en/services/support/technical-account-management)
### [Training & certification](/en/services/training-and-certification)

* [All courses and exams](/en/services/training/all-courses-exams)
* [All certifications](/en/services/certifications)
* [Verify a certification](https://www.redhat.com/rhtapps/services/verify/)
* [Skills assessment](https://skills.ole.redhat.com)
* [Learning subscription](/en/services/training/learning-subscription)
* [Learning community](https://learn.redhat.com/)
* [Red Hat Academy](/en/services/training/red-hat-academy)
* [FAQs](/en/services/training-and-certification/faq)
* [Connect with learning experts](/en/services/training-and-certification/contact-us)
### Featured

* [Ansible Basics: Automation Technical Overview (No cost)](/en/services/training/do007-ansible-essentials-simplicity-automation-technical-overview)
* [Containers, Kubernetes and Red Hat OpenShift Technical Overview (No cost)](/en/services/training/do080-deploying-containerized-applications-technical-overview)
* [Red Hat Enterprise Linux Technical Overview (No cost)](/en/services/training/rh024-red-hat-linux-technical-overview)
* [Red Hat Certified System Administrator exam](/en/services/training/ex200-red-hat-certified-system-administrator-rhcsa-exam)
* [Red Hat System Administration I](/en/services/training/rh124-red-hat-system-administration-i)
[Explore services](/en/services)
### Topics

* [AI](/en/topics/ai)
* [Application modernization](/en/topics/application-modernization)
* [Automation](/en/topics/automation)
* [Cloud computing](/en/topics/cloud-computing)
* [Cloud-native applications](/en/topics/cloud-native-apps)
* [Containers](/en/topics/containers)
* [DevOps](/en/topics/devops)
* [Edge computing](/en/topics/edge-computing)
* [Linux](/en/topics/linux)
* [Virtualization](/en/topics/virtualization)
* [See all topics](/en/topics)
### Articles

* [What is InstructLab?](/en/topics/ai/what-is-instructlab)
* [What are cloud services?](/en/topics/cloud-computing/what-are-cloud-services)
* [What is edge computing?](/en/topics/edge-computing/what-is-edge-computing)
* [What is hybrid cloud?](/en/topics/cloud-computing/what-is-hybrid-cloud)
* [Why build a Red Hat cloud?](/en/topics/cloud-computing/why-choose-red-hat-cloud)
* [Cloud vs. edge](/en/topics/cloud-computing/cloud-vs-edge)
* [Red Hat OpenShift vs. Kubernetes](/en/technologies/cloud-computing/openshift/red-hat-openshift-kubernetes)
* [Learning Ansible basics](/en/topics/automation/learning-ansible-tutorial)
* [What is Linux?](/en/topics/linux/what-is-linux)
### More to explore

* [Blog](/en/blog)
* [Customer success stories](/en/success-stories)
* [Events and webinars](/en/events)
* [Newsroom](/en/about/newsroom)
* [Podcasts and video series](/en/red-hat-original-series)
* [Documentation](https://docs.redhat.com/en)
* [Resource library](/en/resources)
* [Training and certification](/en/services/training-and-certification)
[Explore resources](/en/resources)
### For customers

* [Our partners](/en/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
### For partners

* [Partner Connect](https://connect.redhat.com)
* [Become a partner](https://connect.redhat.com/en/benefits-of-being-a-partner)
* [Training](https://connect.redhat.com/en/training)
* [Support](https://connect.redhat.com/en/support)
* [Access the partner portal](https://connect.redhat.com/partner-admin/dashboard)
### About us

* [Our company](/en/about/company)
* [How we work](/en/about/our-culture)
* [Our social impact](/en/about/community-social-responsibility)
* [Development model](/en/about/development-model)
* [Subscription model](/en/about/value-of-Red-Hat)
* [Product support](/en/services/support)
### Open source

* [Open source commitments](/en/about/open-source)
* [How we contribute](/en/about/our-community-contributions)
* [Red Hat on GitHub](https://github.com/RedHatOfficial)
### Company details

* [Analyst relations](/en/about/analysts)
* [Blog](/en/blog)
* [Locations](/en/about/office-locations)
* [Newsroom](/en/about/newsroom)
[Explore Red Hat](/en/about)[Contact us](/en/contact)For customers

* [Customer support](https://access.redhat.com/)* [Subscription management](https://access.redhat.com/management)* [Support cases](https://access.redhat.com/support/cases)* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)* [Find a partner](https://catalog.redhat.com/partners)
For partners

* [Partner portal](https://connect.redhat.com/partner-admin/dashboard)* [Partner support](https://connect.redhat.com/en/support)* [Become a partner](https://connect.redhat.com/)
Try, buy, & sell

* [Red Hat Marketplace](https://marketplace.redhat.com/en-us)* [Red Hat Store](https://www.redhat.com/en/store)* [Contact sales](/en/contact)* [Start a trial](/en/products/trials)
Learning resources

* [Documentation](https://docs.redhat.com/en)* [Training and certification](/en/services/training-and-certification) * [Hybrid cloud learning hub](https://cloud.redhat.com/learn)* [Interactive labs](/en/interactive-labs)* [Learning community](https://learn.redhat.com/)* [Red Hat TV](https://tv.redhat.com)
Open source communities

* [Global advocacy](https://access.redhat.com/accelerators)* [How we contribute](/en/about/our-community-contributions)
For you
New
### Recommendations

As you browse redhat.com, we'll recommend resources you may like. For now, try these.

---

* [All Red Hat products](/en/technologies/all-products)
* [Tech topics](/en/topics)
* [Red Hat resources](/en/resources)
![close](https://static.redhat.com/libs/redhat/rh-iconfont/latest/svg/web-icon-close.svg)[![Red Hat Summit](/themes/custom/rh_base_ui/dist/img/red-hat-summit-logo.svg)Red Hat Summit](https://www.redhat.com/en/summit)[Support](https://access.redhat.com/)[Documentation](https://docs.redhat.com/en)[Console](https://cloud.redhat.com/)[Developers](https://developers.redhat.com/)[Start a trial](/en/products/trials)[Contact](/en/contact)Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol[Contact us](/en/contact)
English
### Select a language

* [简体中文](/zh/blog/security-flaws-caused-compiler-optimizations)
* [English](/en/blog/security-flaws-caused-compiler-optimizations)
* [Français](/fr/blog/security-flaws-caused-compiler-optimizations)
* [Deutsch](/de/blog/security-flaws-caused-compiler-optimizations)
* [Italiano](/it/blog/security-flaws-caused-compiler-optimizations)
* [日本語](/ja/blog/security-flaws-caused-compiler-optimizations)
* [한국어](/ko/blog/security-flaws-caused-compiler-optimizations)
* [Português](/pt-br/blog/security-flaws-caused-compiler-optimizations)
* [Español](/es/blog/security-flaws-caused-compiler-optimizations)
Select a language简体中文EnglishFrançaisDeutschItaliano日本語한국어PortuguêsEspañol![](/themes/custom/rh_base_ui/dist/img/talk-bubble.svg)

* [Products](https://www.redhat.com/en/technologies/all-products)
* [Solutions](https://www.redhat.com/en/solutions)
* [Training & services](https://www.redhat.com/en/services)
* [Resources](https://www.redhat.com/en/resources)
* Partners
* [About](https://www.redhat.com/en/about)
* [Contact us](/en/contact)

### Select a language

* [简体中文](/zh/blog/security-flaws-caused-compiler-optimizations)
* [English](/en/blog/security-flaws-caused-compiler-optimizations)
* [Français](/fr/blog/security-flaws-caused-compiler-optimizations)
* [Deutsch](/de/blog/security-flaws-caused-compiler-optimizations)
* [Italiano](/it/blog/security-flaws-caused-compiler-optimizations)
* [日本語](/ja/blog/security-flaws-caused-compiler-optimizations)
* [한국어](/ko/blog/security-flaws-caused-compiler-optimizations)
* [Português](/pt-br/blog/security-flaws-caused-compiler-optimizations)
* [Español](/es/blog/security-flaws-caused-compiler-optimizations)

[Red Hat Blog](/en/blog)

* [By product](/en/blog/product)
  + [Red Hat Enterprise Linux](/en/blog/channel/red-hat-enterprise-linux "Red Hat Enterprise Linux")
  + [Red Hat OpenShift](/en/blog/channel/red-hat-openshift "Red Hat OpenShift")
  + [Red Hat Ansible Automation Platform](/en/blog/channel/red-hat-ansible-automation "Red Hat Ansible Automation Platform")

  ---

  [All products](/en/blog/products "All products")
* [By channel](/en/blog)
  + [AI](/en/blog/channel/artificial-intelligence "AI")
  + [Virtualization](/en/blog/channel/red-hat-virtualization "Virtualization")
  + [Applications](/en/blog/channel/applications "Applications")
  + [Automation](/en/blog/channel/management-and-automation "Automation")
  + [Cloud services](/en/blog/channel/cloud-services "Cloud services")
  + [Edge computing](/en/blog/channel/edge-computing "Edge computing")
  + [Infrastructure](/en/blog/channel/infrastructure "Infrastructure")
  + [Open hybrid cloud](/en/blog/channel/hybrid-cloud-infrastructure "Open hybrid cloud")
  + [Original shows](/en/red-hat-original-series "Original shows")
  + [Security](/en/blog/channel/security "Security")

  ---

  [All channels](/en/blog/channels "All channels")

[Subscribe to the feed](/en/rss/blog "Subscribe to the feed")

# Security flaws caused by compiler optimizations

August 21, 2019[Huzaifa Sidhpurwala](/en/authors/huzaifa-sidhpurwala "See more by Huzaifa Sidhpurwala")*6*-minute read
[Security](/en/blog?f[0]=taxonomy_topic_tid:4491#rhdc-search-listing )

Share

Subscribe

* [Back to all posts](/en/blog)

---

An optimizing compiler is one that tries to maximize some attribute(s) of an executable program at the expense of other attribute(s). Usually the goal is to improve performance or code size at the expense of compiler time and the possibility to debug the program at a later stage. Most modern compilers support some sort of optimization. Normally code optimized for performance is the usual preference. In cases where space is a constraint like embedded systems, developers also prefer code optimized for size.

Code optimization is both an art as well as a science. Various compilers use different techniques for optimizing code. Let us discuss a few of them with examples:

* Copy propagation:

  Consider this code segment:

  *A = B

  C = 2.0 + A*

  The compiler may change this code to:

  *A = B

  C = 2.0 + B*

  This is done so that the CPU can run both the instructions in parallel.
* Removing constants from being calculated during runtime.

Consider this code segment:

*Const A = 1.7320

Const B = 1.4140

C = A + B*

The compiler may change this code to:

*Const A = 1.7320

Const B = 1.4140

Const C = 3.146*

This avoids extra calculation during runtime.

* Dead code removal

Compiler will search for pieces of code which have no effect and will remove them during compilation. For example, variables which are calculated but never used, etc.

Some of these flaws are present in the source code, but are hidden by non-optimizing compilers. Let’s see a few examples:

### [CVE-2009-1897](https://access.redhat.com/security/cve/CVE-2009-1897) [kernel: tun/tap: Fix crashes if open() /dev/net/tun and then poll() it](https://lwn.net/Articles/342330/)

The TUN/TAP driver provides a virtual network device which performs packet tunneling; it's useful in a number of situations, including virtualization, virtual private networks, and more. In normal usage of the TUN driver, a program will open /dev/net/tun, then make an ioctl() call to set up the network endpoints.

The TUN device supports the poll() system call. The beginning of the function implementing this functionality (in 2.6.30) looks like this:

```
   static unsigned int tun_chr_poll(struct file *file, poll_table * wait)
    {
             struct tun_file *tfile = file->private_data;
             struct tun_struct *tun = __tun_get(tfile);
             struct sock *sk = tun->sk;
             unsigned int mask = 0;
             if (!tun)
                 return POLLERR;
```

Herbert Xu noticed a problem where a lack of packet accounting could let a hostile application pin down large amounts of kernel memory and generally degrade system performance.

The line of code which has been underlined above was added by Herbert's patch; that is where things begin to go wrong. The code references the pointer tun before it is checked if it is NULL, which is done later in the code.

GCC will, by default, optimize the NULL test out (referring to “if (!tun)”). The reasoning is that, since the pointer has already been dereferenced (and has not been changed), it cannot be NULL. So there is no point in checking it. This logic makes perfect sense except that in the case of the kernel where NULL might actually be a valid pointer. The default selinux module allowed mapping the zero page, converting this bug into a privilege escalation flaw. This was however later corrected by [preventing processes running as unconfined\_t from being able to map low memory in the kernel.](https://bugzilla.redhat.com/show_bug.cgi?id=511143)

The Linux kernel uses GCC’s -fno-delete-null-pointer-checks to disable such optimization.

### [Issues caused by Dead store removal](https://www.owasp.org/index.php/Insecure_Compiler_Optimization)

Applications often need to read sensitive data from users (like passwords), files (like cryptographic keys), or network. Memory used for this sensitive data needs to be properly scrubbed by overwriting its contents or it may have some security implications.

Attackers typically exploit this type of vulnerability by using a core dump or runtime mechanism to access the memory used by a particular application and recover the secret information. Once an attacker has access to the secret information, it is relatively straightforward to further exploit the system and possibly compromise other resources with which the application interacts.

Optimizing compilers remove memory overwriting code, when the overwritten memory is not used later in the program. This causes sensitive information to be left in the memory after its usage.

Consider the following code, in which the password is read from the user, some processing is performed back on that and then the code attempts to scrub the password from memory:

```
([example taken from the OWASP website](https://www.owasp.org/index.php/Insecure_Compiler_Optimization))

void GetData(char *MFAddr) {
        char pwd[64];
        if (GetPasswordFromUser(pwd, sizeof(pwd))) {
         if (ConnectToMainframe(MFAddr, pwd)) {
                       // Interaction with mainframe
               }
         }
         memset(pwd, 0, sizeof(pwd));
       }
```

If the above code is compiled with optimization enabled, then the call to memset will be removed as a dead store, because the buffer is not used after it is overwritten. Since the buffer has sensitive data it may be vulnerable to attack if the password is left resident in the memory.

GCC has the -fno-dse flag to remove this optimization. However, a better choice is to have a subsequent “use” of the memory which will prevent this behavior. Also using volatile asm that references the password should ensure that the instructions are not deleted by GCC.

Lastly, a possible solution to the above problem is [suggested by the glibc project.](https://www.gnu.org/software/libc/manual/html_node/Erasing-Sensitive-Data.html) However this was added only in glibc-2.29 and is currently not available with any supported versions of Red Hat Enterprise Linux.

### Division by zero

The x86 processor raises an exception when it encounters a division by zero, where as PowerPC and MIPS will silently ignore it. In C division by zero is undefined behaviour and therefore the compiler can assume that the divisor is always non-zero.

Consider the following kernel code:

```
if(!msize)
msize = 1 / msize;/* provoke a signal */

```

When compiling with GCC, this code behaves as intended on an x86, but not on a PowerPC, because it will not generate an exception. When compiling with Clang, the result is even more surprising. Clang assumes that the divisor msize must be non-zero—on any system—since otherwise the division is undefined. Combined with this assumption, the zero check !msize becomes always false, since msize cannot be both zero and non-zero. The compiler determines that the whole block of code is unreachable and removes it, which has the unexpected effect of removing the programmer’s original intention of guarding against the case when msize is zero.

Consider another example, this time from PostgreSQL code:

```
if(arg2 == 0)
        ereport(ERROR, (errcode(ERRCODE_DIVISION_BY_ZERO),
                         errmsg("division by zero")));
/* No overflow is possible */
PG_RETURN_INT32((int32) arg1 / arg2);
```

When arg2 is zero, then it calls an error reporting function, which never returns to the calling function, therefore guarding against the possible division by zero. However, the programmer failed to inform the compiler that the call to ereport(ERROR,...)does not return. This implies that the division will always execute. Combined with the assumption that the divisor must be non-zero, on some platforms (e.g., Alpha, S/390, and SPARC) GCC moves the division before the zero check arg2 == 0, [causing division by zero.](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=616180)

## GCC compiler and optimizations

Various levels of optimizations are provided by the GCC compiler with options to explicitly control various specific behaviours as well. The default optimization level is zero, which provides no optimization at all. This can be explicitly specified with option -O or -O0.

The purpose of level 1 optimization is to produce an optimized binary in a short interval of time. The second level of optimization performs all other supported optimizations within the given architecture that do not involve a space-speed trade-off, a balance between the two objectives. The third and highest level enables even more optimizations by putting emphasis on speed over size. This includes optimizations enabled at -O2 and rename-register. The optimization inline-functions also is enabled here, which can increase performance but also can drastically increase the size of the object, depending upon the functions that are inlined.

GCC also allows individual optimization features to be turned on or off via the command line.

A comprehensive list of various optimization features and their uses is available on the [GCC website.](https://gcc.gnu.org/onlinedocs/gcc/Optimize-Options.html) Also note that in certain cases disabling optimization may make security warnings less effective and also disable [source fortification.](https://access.redhat.com/blogs/766093/posts/3606481)

### Conclusion:

While code optimization is a useful feature of the modern compiler, in some cases it may have certain unwanted side effects. Developers need to understand and be mindful of how their code is being compiled, especially for sections which deal with sensitive data and/or critical sections of code.

---

### About the author

[![Huzaifa Sidhpurwala](https://www.redhat.com/rhdc/managed-files/styles/media_thumbnail/private/Huzaifa_Sidhpurwala-author-photo.jpg?itok=e4bd-EEC)](/en/authors/huzaifa-sidhpurwala)

[### Huzaifa Sidhpurwala

Principal Product Security Engineer](/en/authors/huzaifa-sidhpurwala)

Huzaifa Sidhpurwala is a Principal Product Security Engineer with Red Hat and part of a number of upstream security groups such as Mozilla, LibreOffice, Python, PHP and others. He speaks about security issues at open source conferences, and has been a Fedora contributor for more than 10 years.

[Read full bio](/en/authors/huzaifa-sidhpurwala)

Enter keywords here to search blogs

UI\_Icon-Red\_Hat-Close-A-Black-RGB

Search

## More like this

### [Blog post](/en/blog/introducing-confidential-containers-bare-metal)

#### [Introducing confidential containers on bare metal](/en/blog/introducing-confidential-containers-bare-metal)

### [Blog post](/en/blog/passwords-love-hate)

#### [Passwords: a thin line between love and hate](/en/blog/passwords-love-hate)

### [Original shows](/en/technically-speaking/software-security-recipe)

#### [A new software supply chain security recipe | Technically Speaking](/en/technically-speaking/software-security-recipe)

### [Original shows](/en/technically-speaking/WebAssembly)

#### [WebAssembly breaks away from the browser | Technically Speaking](/en/technically-speaking/WebAssembly)

## Browse by channel

[Explore all channels](/en/blog/channels "Explore all channels")

![automation icon](https://www.redhat.com/cms/managed-files/automation.svg)
### [Automation](/en/blog/channel/management-and-automation)

The latest on IT automation for tech, teams, and environments

![AI icon](https://www.redhat.com/cms/managed-files/AI.svg)
### [Artificial intelligence](/en/blog/channel/artificial-intelligence)

Updates on the platforms that free customers to run AI workloads anywhere

![open hybrid cloud icon](https://www.redhat.com/cms/managed-files/open-hybrid-cloud.svg)
### [Open hybrid cloud](/en/blog/channel/hybrid-cloud-infrastructure)

Explore how we build a more flexible future with hybrid cloud

![security icon](https://www.redhat.com/cms/managed-files/security.svg)
### [Security](/en/blog/channel/security)

The latest on how we reduce risks across environments and technologies

![edge icon](https://www.redhat.com/cms/managed-files/edge_2.svg)
### [Edge computing](/en/blog/channel/edge-computing)

Updates on the platforms that simplify operations at the edge

![Infrastructure icon](https://www.redhat.com/cms/managed-files/infrastructure.svg)
### [Infrastructure](/en/blog/channel/infrastructure)

The latest on the world’s leading enterprise Linux platform

![application development icon](https://www.redhat.com/cms/managed-files/application-development.svg)
### [Applications](/en/blog/channel/applications)

Inside our solutions to the toughest application challenges

![Original series icon](https://www.redhat.com/cms/managed-files/original-series.svg)
### [Original shows](/en/red-hat-original-series)

Entertaining stories from the makers and leaders in enterprise tech

[![Red Hat logo](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](/en)[LinkedIn](https://www.linkedin.com/company/red-hat)[YouTube](https://www.youtube.com/user/RedHatVideos)[Facebook](https://www.facebook.com/redhatinc)[X](https://twitter.com/RedHat)
### Products

* [Red Hat Enterprise Linux](/en/technologies/linux-platforms/enterprise-linux)
* [Red Hat OpenShift](/en/technologies/cloud-computing/openshift)
* [Red Hat Ansible Automation Platform](/en/technologies/management/ansible)
* [Cloud services](/en/technologies/cloud-computing/openshift/cloud-services)
* [See all products](/en/technologies/all-products)

### Tools

* [Training and certification](/en/services/training-and-certification)
* [My account](https://www.redhat.com/wapps/ugc/protected/personalInfo.html)
* [Customer support](https://access.redhat.com)
* [Developer resources](https://developers.redhat.com/)
* [Find a partner](https://catalog.redhat.com/partners)
* [Red Hat Ecosystem Catalog](https://catalog.redhat.com/)
* [Red Hat value calculator](/en/solutions/value-calculator)
* [Documentation](https://docs.redhat.com/en)

### Try, buy, & sell

* [Product trial center](/en/products/trials)
* [Red Hat Marketplace](https://marketplace.redhat.com)
* [Red Hat Store](https://www.redhat.com/en/store)
* [Buy online (Japan)](https://www.redhat.com/en/about/japan-buy)
* [Console](https://cloud.redhat.com/)

### Communicate

* [Contact sales](/en/contact/sales)
* [Contact customer service](/en/contact/customer-service)
* [Contact training](/en/services/training-and-certification/contact-us)
* [Social](/en/about/social)

### About Red Hat

We’re the world’s leading provider of enterprise open source solutions—including Linux, cloud, container, and Kubernetes. We deliver hardened solutions that make it easier for enterprises to work across platforms and environments, from the core datacenter to the network edge.

### Select a language

![](https://static.redhat.com/libs/redhat/rh-iconfont/4/svg/web-icon-globe.svg)

* [简体中文](/zh/blog/security-flaws-caused-compiler-optimizations)
* [English](/en/blog/security-flaws-caused-compiler-optimizations)
* [Français](/fr/blog/security-flaws-caused-compiler-optimizations)
* [Deutsch](/de/blog/security-flaws-caused-compiler-optimizations)
* [Italiano](/it/blog/security-flaws-caused-compiler-optimizations)
* [日本語](/ja/blog/security-flaws-caused-compiler-optimizations)
* [한국어](/ko/blog/security-flaws-caused-compiler-optimizations)
* [Português](/pt-br/blog/security-flaws-caused-compiler-optimizations)
* [Español](/es/blog/security-flaws-caused-compiler-optimizations)
### Red Hat legal and privacy links

* [About Red Hat](/en/about/company)
* [Jobs](/en/jobs)
* [Events](/en/events)
* [Locations](/en/about/office-locations)
* [Contact Red Hat](/en/contact)
* [Red Hat Blog](/en/blog)
* [Diversity, equity, and inclusion](/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

© 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](/en/about/privacy-policy)
* [Terms of use](/en/about/terms-use)
* [All policies and guidelines](/en/about/all-policies-guidelines)
* [Digital accessibility](/en/about/digital-accessibility)



=== Content from www.openwall.com_a1fb0dac_20250125_013805.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2009/07/16/4) [[next>]](../../../2009/07/18/1) [[thread-next>]](../../../2009/07/20/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <b086760e0907170023j19dce375oa7ddbc048321c938@mail.gmail.com>
Date: Fri, 17 Jul 2009 09:23:03 +0200
From: yersinia <yersinia.spiros@...il.com>
To: dailydave <dailydave@...ts.immunitysec.com>, oss-security@...ts.openwall.com
Subject: Linux 2.6.30+/SELinux/RHEL5 test kernel 0day, exploiting the
	unexploitable

FYI, a Sprengler 0-day against Selinux null ptr dereference. Very Nice
to see in action

reference ( with youtube link )

<http://grsecurity.net/~spender/cheddar_bay.tgz>

regards

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


