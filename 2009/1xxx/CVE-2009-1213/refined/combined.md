=== Content from www.vupen.com_8db6b952_20250125_220847.html ===

[![](/__ovh/common/img/logo-white.png)](https://www.ovhcloud.com/)

![](/__ovh/common/img/icon-traffic-cone.png)

# Site en construction

![](/__ovh/common/img/shadow.png)

Besoin d'assistance ou d'informations ?

[![](/__ovh/common/img/icon-book.png)
Guides](https://docs.ovh.com/fr/hosting/ "Guides")
[![](/__ovh/common/img/icon-speech-bubble.png)
Forum](https://community.ovh.com/ "Forum")
[![](/__ovh/common/img/icon-user-support.png)
Contact](https://help.ovhcloud.com/fr/ "Contact")
[![](/__ovh/common/img/icon-app-gear.png)
Espace Client](https://www.ovh.com/manager/ "Espace Client")

© Copyright 1999 [OVHcloud](https://www.ovhcloud.com/)

v1v2v3v4v5v6v7v8v9v10v11v12v13v14v15v16v17v18v19v20v21v22v23v24v25v26v27v28v29v30v31v32v33v34v35v36v37v38v39v40v41v42v43v44v45v46v47v48v49v50v51v52v53v54v55v56v57v58v59v60v61v62v63v64v65v66v67v68v69v70

u1u2u3u4u5u6u7u8u9u10u11u12u13u14u15u16u17u18u19u20u21u22u23u24u25u26u27u28u29u30u31u32u33u34u35u36u37u38u39u40u41u42u43u44u45u46u47u48u49u50u51u52u53u54u55u56u57u58u59u60u61u62u63u64u65u66u67u68u69

p1p2p3p4p5p6p7p8p9p10p11p12p13p14p15p16p17p18p19p20p21p22p23p24p25p26p27p28p29p30p31p32p33p34p35p36p37p38p39p40p41p42p43p44p45p46p47p48p49p50p51p52p53p54p55p56p57p58p59p60p61p62p63p64

e1e2e3e4e5e6e7e8e9e10e11e12e13e14e15e16e17e18e19e20e21e22e23e24e25e26e27e28e29e30e31e32e33e34e35e36e37e38e39e40e41e42e43e44e45e46e47e48e49e50e51e52e53

n1n2n3n4n5n6n7n8n9n10n11n12n13n14n15n16n17n18n19n20n21n22n23n24n25n26n27n28n29n30n31n32n33n34n35n36n37n38n39n40n41n42n43n44n45n46n47n48n49n50n51n52n53n54n55n56n57n58n59n60n61n62

---

c1c2c3c4c5c6c7c8c9c10c11c12c13c14c15c16c17c18c19c20c21c22c23c24c25c26c27c28c29c30c31c32c33c34c35c36c37c38c39c40c41c42c43c44c45c46c47c48c49c50c51

o1o2o3o4o5o6o7o8o9o10o11o12o13o14o15o16o17o18o19o20o21o22o23o24o25o26o27o28o29o30o31o32o33o34o35o36o37o38o39o40o41o42o43o44o45o46o47o48o49o50o51o52o53o54o55o56o57o58o59o60o61o62o63

m1m2m3m4m5m6m7m8m9m10m11m12m13m14m15m16m17m18m19m20m21m22m23m24m25m26m27m28m29m30m31m32m33m34m35m36m37m38m39m40m41m42m43m44m45m46m47m48m49m50m51m52m53m54m55m56m57m58m59m60m61



=== Content from bugzilla.mozilla.org_ecb320c7_20250125_220848.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/476603)
* [XML](/show_bug.cgi?ctype=xml&id=476603)

Closed
[Bug 476603](/show_bug.cgi?id=476603)

Opened 16 years ago
Closed 16 years ago

# [SECURITY] Editing attachments doesn't have any CSRF protection

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

[SECURITY] Editing attachments doesn't have any CSRF protection

## Categories

### (Bugzilla :: Attachments & Requests, defect)

[Product:](/describecomponents.cgi?product=Bugzilla)

Bugzilla
▾

Bugzilla
The [Bugzilla](http://www.bugzilla.org) bug-tracking system.

**Note:** This is **not** the place to request configuration, permission, or account changes to this installation of Bugzilla (bugzilla.mozilla.org). File such changes under the appropriate component in the [**bugzilla.mozilla.org**](enter_bug.cgi?product=bugzilla.mozilla.org) product.
[See Open Bugs in This Product](/buglist.cgi?product=Bugzilla&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Bugzilla)
Watch This Product

[Component:](/describecomponents.cgi?product=Bugzilla&component=Attachments%20%26%20Requests#Attachments%20%26%20Requests)

Attachments & Requests
▾

Bugzilla :: Attachments & Requests
For problems with attachment creation/management and request creation/management. attachment.cgi, request.cgi
[See Open Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Bugzilla&component=Attachments%20%26%20Requests&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Bugzilla&component=Attachments%20%26%20Requests)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

3.2.1

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

major

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

Bugzilla 3.2

## People

### (Reporter: justdave, Assigned: reed)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/a061fe6bd3e9018e6837fba4e1d09206?d=mm&size=40)  [reed](/user_profile?user_id=159758)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

![](https://secure.gravatar.com/avatar/9df24a05a7e63cf07e49d30ddfeee31a?d=mm&size=40)  [default-qa](/user_profile?user_id=5086)

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/e9b8879974f9b8c15f35712b58182a86?d=mm&size=40)  [justdave](/user_profile?user_id=10297)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[480875](/show_bug.cgi?id=480875 "RESOLVED FIXED - Security Advisory for Bugzilla 3.2.3 and 3.3.4"), [488173](/show_bug.cgi?id=488173 "RESOLVED WORKSFORME - Incorrect CSRF protection page after logging in"), [CVE-2013-1734](/show_bug.cgi?id=913904 "RESOLVED FIXED - [SECURITY] CSRF when updating attachments")

Dependency [tree](/showdependencytree.cgi?id=476603&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=476603)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Whiteboard: [sg:want][wanted-bmo]security)

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

---

[Keywords:](/describekeywords.cgi)

---

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:want][wanted-bmo]security

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [LpSolit](/user_profile?user_id=120380) | [approval](#c29 "16 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [blocking3.4](#a670181_120380 "16 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | blocking3.4 | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [approval3.2](#c29 "16 years ago") | + |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | approval3.2 | + |
| --- | --- | --- |
| [mkanat](/user_profile?user_id=73187) | [blocking3.2.3](#c6 "16 years ago") | + |
| --- | --- | --- |
| [mkanat](/user_profile?user_id=73187) | blocking3.2.3 | + |
| --- | --- | --- |
| [mkanat](/user_profile?user_id=73187) | [blocking3.2.2](#c3 "16 years ago") | - |
| --- | --- | --- |
| [mkanat](/user_profile?user_id=73187) | blocking3.2.2 | - |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | [testcase](#a83223779_120380 "13 years ago") | ? |
| --- | --- | --- |
| [LpSolit](/user_profile?user_id=120380) | testcase | ? | | |
| --- | --- | --- | --- | --- |
|  | approval5.0 | ? |
| --- | --- | --- |
|  | approval5.2 | ? |
|  | approval6.0 | ? |
|  | blocking5.0.4.1 | ? |
|  | blocking5.2 | ? |
|  | blocking6.0 | ? |
|  | approval4.4 | ? |
|  | blocking4.4.14 | ? |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | documentation | ? + - |
|  | relnote |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files, 4 obsolete files)

| [patch - v1](/attachment.cgi?id=360262)  [16 years ago](#c4)  [Reed Loden [:reed]](/user_profile?user_id=159758)   5.51 KB, patch |  | [Details](/attachment.cgi?id=360262&action=edit) | [Diff](/attachment.cgi?id=360262&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360262) |
| --- | --- | --- |
| [patch - v1.1](/attachment.cgi?id=360265)  [16 years ago](#c5)  [Reed Loden [:reed]](/user_profile?user_id=159758)   4.83 KB, patch | LpSolit : [review-](#a382199_120380 "16 years ago") | [Details](/attachment.cgi?id=360265&action=edit) | [Diff](/attachment.cgi?id=360265&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360265) |
| [patch - v2](/attachment.cgi?id=361094)  [16 years ago](#c11)  [Reed Loden [:reed]](/user_profile?user_id=159758)   3.41 KB, patch | LpSolit : [review+](#c12 "16 years ago") | [Details](/attachment.cgi?id=361094&action=edit) | [Diff](/attachment.cgi?id=361094&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=361094) |
| [patch for HEAD - v3](/attachment.cgi?id=369948)  [16 years ago](#c21)  [Reed Loden [:reed]](/user_profile?user_id=159758)   5.08 KB, patch | LpSolit : [review+](#c24 "16 years ago") | [Details](/attachment.cgi?id=369948&action=edit) | [Diff](/attachment.cgi?id=369948&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=369948) |
| [patch for HEAD - v3.1](/attachment.cgi?id=370036)  [16 years ago](#c25)  [Reed Loden [:reed]](/user_profile?user_id=159758)   5.22 KB, patch | reed : [review+](#c25 "16 years ago") | [Details](/attachment.cgi?id=370036&action=edit) | [Diff](/attachment.cgi?id=370036&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=370036) |
| [patch for 3.2 - v1](/attachment.cgi?id=370038)  [16 years ago](#c26)  [Reed Loden [:reed]](/user_profile?user_id=159758)   5.22 KB, patch | LpSolit : [review+](#c27 "16 years ago") | [Details](/attachment.cgi?id=370038&action=edit) | [Diff](/attachment.cgi?id=370038&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=370038) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=476603#c0)• 16 years ago |
|  | |

I loaded an attachment.cgi action=view page while logged in with my justdave@mozilla.com account. I then logged out and back in with my justdave@bugzilla.org account, then submitted my changes on the form without reloading it, and it let me. The CSRF check should have failed on that because I was using a different User ID.
LpSolit says that's the only form left that wasn't done yet, and he didn't have a bug on file for it, so here's the bug.

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a121_159758)• 16 years ago |

Flags: blocking3.2.2?Whiteboard: [sg:want][wanted-bmo]

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=476603#c1)• 16 years ago |
|  | |

(In reply to [comment #0](/show_bug.cgi?id=476603#c0 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"))
> LpSolit says that's the only form left that wasn't done yet, and he didn't have
> a bug on file for it, so here's the bug.
Technically, there's also [bug 471801](/show_bug.cgi?id=471801 "NEW"), too.

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=476603#c2)• 16 years ago |
|  | |

We're already doing a version 3.2.2 sometime in the next several hours because of [bug 476594](/show_bug.cgi?id=476594 "RESOLVED FIXED - [SECURITY] Calling srand() at startup time in mod_perl makes the same token be generated over and over"), so if we can get a patch on this and reviewed and tested in that timeframe we might be able to include this in 3.2.2. Since our previous advisory indicated that we now had application-wide CSRF protection it'd probably be a good idea to include this if we can. LpSolit's about to head out to work though, so it won't be him working on it.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=476603#c3)• 16 years ago |
|  | |

This is an emergency release, I need to get it out ASAP, so there will be no fixes other than the emergency fix. We can fix this for 3.2.3.Flags: blocking3.2.2? → blocking3.2.2-

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=476603#c4)• 16 years ago |
|  | |

Attached patch

[patch - v1](attachment.cgi?id=360262&action=diff) (obsolete)
— [Details](attachment.cgi?id=360262&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360262)

Add CSRF protection to edit action and rename the token used by delete action to "deleteattachment".Assignee: attach-and-request → reedStatus: NEW → ASSIGNED
[Attachment #360262](/attachment.cgi?id=360262&action=edit "patch - v1") -
Flags: review?(LpSolit)

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a5447_159758)• 16 years ago |

Flags: blocking3.2.3?Whiteboard: [sg:want][wanted-bmo] → [sg:want][wanted-bmo]securityTarget Milestone: --- → Bugzilla 3.0

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=476603#c5)• 16 years ago |
|  | |

Attached patch

[patch - v1.1](attachment.cgi?id=360265&action=diff) (obsolete)
— [Details](attachment.cgi?id=360265&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360265)

Don't need the delete\_token() call since it's a hash token.
[Attachment #360262](/attachment.cgi?id=360262&action=edit "patch - v1") -
Attachment is obsolete: true
[Attachment #360265](/attachment.cgi?id=360265&action=edit "patch - v1.1") -
Flags: review?(LpSolit)
[Attachment #360262](/attachment.cgi?id=360262&action=edit "patch - v1") -
Flags: review?(LpSolit)

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=476603#c6)• 16 years ago |
|  | |

Yes, definitely a blocker. We already have a patch and this would be good to fix.Flags: blocking3.2.3? → blocking3.2.3+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=476603#c7)• 16 years ago |
|  | |

None of our recent security bugs was marked as more severe than "major", and this one was left intentionally behind -> major as well. I will review it later today when I'm back home.Severity: blocker → major

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a382199_120380)• 16 years ago |

[Attachment #360265](/attachment.cgi?id=360265&action=edit "patch - v1.1") -
Flags: review?(LpSolit) → review-

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=476603#c8)• 16 years ago |
|  | |

Comment on [attachment 360265](/attachment.cgi?id=360265 "patch - v1.1") [[details]](/attachment.cgi?id=360265&action=edit "patch - v1.1") [[diff]](/attachment.cgi?id=360265&action=diff "patch - v1.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360265)
patch - v1.1
>Index: attachment.cgi
>- && ($event eq 'attachment' . $attachment->id))
>+ && ($event eq 'deleteattachment' . $attachment->id))
This change is unrelated to this bug. It's a session token, unrelated to hash tokens. If we change this, all old tokens with "attachment" in them will be seen as invalid. I would only accept this change in 3.4, not on branches (as there is no reason to do this change). Also, it should be named "delete\_attachment".
>Index: template/en/default/attachment/edit.html.tmpl
>+ <input type="hidden" name="token" value="[% issue\_hash\_token([attachment.id, attachment.modification\_time]) FILTER html %]">
This must be enclosed in [% IF user.id %] [% END %], as tokens generated for logged out users are invalid. Also, if the user is logged out before reaching this page, clicking "Submit" will first display the login page, then display the "suspicious action" page. We should try to find a way to avoid this problem.

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=476603#c9)• 16 years ago |
|  | |

(In reply to [comment #8](/show_bug.cgi?id=476603#c8 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"))
> (From update of [attachment 360265](/attachment.cgi?id=360265 "patch - v1.1") [[details]](/attachment.cgi?id=360265&action=edit "patch - v1.1") [[diff]](/attachment.cgi?id=360265&action=diff "patch - v1.1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=360265))
> >Index: attachment.cgi
>
> >- && ($event eq 'attachment' . $attachment->id))
> >+ && ($event eq 'deleteattachment' . $attachment->id))
>
> This change is unrelated to this bug. It's a session token, unrelated to hash
> tokens. If we change this, all old tokens with "attachment" in them will be
> seen as invalid. I would only accept this change in 3.4, not on branches (as
> there is no reason to do this change). Also, it should be named
> "delete\_attachment".
I'm ok with making that change only on tip, but I disagree with your last comment, especially since I used the "createattachment" session token as the example when renaming it:
$vars->{'token'} = issue\_session\_token('createattachment:');
So, do you want delete\_attachment or deleteattachment, and if delete\_attachment, should createattachment be renamed to create\_attachment?
> >Index: template/en/default/attachment/edit.html.tmpl
>
> >+ <input type="hidden" name="token" value="[% issue\_hash\_token([attachment.id, attachment.modification\_time]) FILTER html %]">
>
> This must be enclosed in [% IF user.id %] [% END %], as tokens generated for
> logged out users are invalid. Also, if the user is logged out before reaching
> this page, clicking "Submit" will first display the login page, then display
> the "suspicious action" page. We should try to find a way to avoid this
> problem.
Why do we show the full edit UI on the Edit page for attachments when the user is logged out? We don't do that for show\_bug anymore, so not sure why we're doing it for edit attachment... I was very surprised to see that logged-out users can go to <https://landfill.bugzilla.org/bugzilla-tip/attachment.cgi?id=847&action=edit> and see the full edit UI. That seems like a problem in itself.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=476603#c10)• 16 years ago |
|  | |

(In reply to [comment #9](/show_bug.cgi?id=476603#c9 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"))
> So, do you want delete\_attachment or deleteattachment, and if
> delete\_attachment, should createattachment be renamed to create\_attachment?
Yeah, both with an underscore, please. But not as part of this security bug.
> Why do we show the full edit UI on the Edit page for attachments when the user
> is logged out?
Because it always behaved this way since this page exists. We only fixed show\_bug so far, and attachment.cgi still needs to be fixed to only look editable by logged in users. This should be fixed separately (and I will file a bug if there isn't one yet).

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=476603#c11)• 16 years ago |
|  | |

Attached patch

[patch - v2](attachment.cgi?id=361094&action=diff) (obsolete)
— [Details](attachment.cgi?id=361094&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=361094)

Address review comments. I'll move the rename to a new bug.
[Attachment #360265](/attachment.cgi?id=360265&action=edit "patch - v1.1") -
Attachment is obsolete: true
[Attachment #361094](/attachment.cgi?id=361094&action=edit "patch - v2") -
Flags: review?(LpSolit)

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=476603#c12)• 16 years ago |
|  | |

Comment on [attachment 361094](/attachment.cgi?id=361094 "patch - v2") [[details]](/attachment.cgi?id=361094&action=edit "patch - v2") [[diff]](/attachment.cgi?id=361094&action=diff "patch - v2") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=361094)
patch - v2
>Index: template/en/default/attachment/edit.html.tmpl
>+[% IF user.id %]
>+ <input type="hidden" name="token" ...
>+[% END %]
Please fix the indentation. [% IF ... %] but be aligned with the surrounding HTML elements. Otherwise looks good and works fine (I tested on tip only! It still needs testing on branches, despite I don't suspect any reason to break there). r=LpSolit
Note that due to the problem I mentioned in the second part of my [comment 8](/show_bug.cgi?id=476603#c8 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection") about logged out users, [bug 365267](/show_bug.cgi?id=365267 "RESOLVED FIXED - attachment.cgi should not be editable when the user is not logged in") should be fixed first, which unfortunately won't happen on branches. I don't want the "invalid token" message to be displayed to all logged out users. It's scary, inaccurate, and would break their workflow. We have to discuss and decide what's the best approach for them.
[Attachment #361094](/attachment.cgi?id=361094&action=edit "patch - v2") -
Flags: review?(LpSolit) → review+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=476603#c13)• 16 years ago |
|  | |

I'm not yet requesting approval due to [comment 12](/show_bug.cgi?id=476603#c12 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"). Dave, Max, what's your opinion on this?Depends on: [365267](/show_bug.cgi?id=365267 "RESOLVED FIXED - attachment.cgi should not be editable when the user is not logged in")

|  | [Dave Miller [:justdave]](/user_profile?user_id=10297)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=476603#c14)• 16 years ago |
|  | |

couldn't we check if they authenticated as part of the request? Is there a way to do that? if so you could check either a token or a login if they bounced off the login page during the submit.
We also advertised the conversion to needing to be logged in to edit as a feature on 3.2, so backporting this to 3.2 could still be considered a bugfix, since we intended to have it and forgot, essentially.
Traditionally in the past, the current stable release still gets normal bugfixes until a new stable release replaces it, and then it drops to security-only. So if we keep with tradition [bug 365267](/show_bug.cgi?id=365267 "RESOLVED FIXED - attachment.cgi should not be editable when the user is not logged in") could still be backported to 3.2.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=476603#c15)• 16 years ago |
|  | |

(In reply to [comment #14](/show_bug.cgi?id=476603#c14 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"))
> We also advertised the conversion to needing to be logged in to edit as a
> feature on 3.2, so backporting this to 3.2 could still be considered a bugfix
We said and do so for show\_bug.cgi. But we definitely didn't do it for attachment.cgi. So it doesn't really look like a bugfix to me.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=476603#c16)• 16 years ago |
|  | |

Hmmm. Well, I'd rather have people be secure than have things be convenient for the slightly-less-common case where somebody is logging in at the same time they're editing the page. We're eventually going to make that impossible anyway, so I think it's OK to make it slightly inconvenient now, no?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a670181_120380)• 16 years ago |

Flags: blocking3.4+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=476603#c17)• 16 years ago |
|  | |

Tested successfully with 3.4 and 3.2, but the patch doesn't apply cleanly on the 3.0 branch. It needs to be backported.Flags: approval?Flags: approval3.2?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a2290354_120380)• 16 years ago |

Flags: blocking3.0.9+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=476603#c18)• 16 years ago |
|  | |

OK, reed just noticed that attachments.modification\_time doesn't exist on the 3.0 branch, and editing an attachment doesn't update bugs.delta\_ts, so we cannot use it for hash tokens either. And I'm not going to use session tokens here because everyone viewing an attachment would trigger a new token, even if they are not editing it. So we are not going to take this security fix on this branch (it would require to change the DB schema to add the modification\_time column to the attachments table, which, I suppose, we don't want).No longer depends on: [365267](/show_bug.cgi?id=365267 "RESOLVED FIXED - attachment.cgi should not be editable when the user is not logged in")Flags: blocking3.0.9+Summary: editing attachments doesn't have any CSRF protection → [SECURITY] Editing attachments doesn't have any CSRF protectionTarget Milestone: Bugzilla 3.0 → Bugzilla 3.2

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a2312473_120380)• 16 years ago |

Blocks: [480875](/show_bug.cgi?id=480875 "RESOLVED FIXED - Security Advisory for Bugzilla 3.2.3 and 3.3.4")

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=476603#c19)• 16 years ago |
|  | |

I've CC'ed a few client writers on this security bug here, before we release. Is this fix going to affect your clients? It adds the same sort of token protection for updating attachments that we added for updating bugs, and it doesn't add a token in the XML anywhere for the attachments.

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=476603#c20)• 16 years ago |
|  | |

reed: You know, just to be safe, we should probably add a <token> element to every <attachment> element in a bug's XML.

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=476603#c21)• 16 years ago |
|  | |

Attached patch

[patch for HEAD - v3](attachment.cgi?id=369948&action=diff) (obsolete)
— [Details](attachment.cgi?id=369948&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=369948)

Address [comment #12](/show_bug.cgi?id=476603#c12 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection") nit and [comment #20](/show_bug.cgi?id=476603#c20 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection") suggestion.
[Attachment #361094](/attachment.cgi?id=361094&action=edit "patch - v2") -
Attachment is obsolete: true
[Attachment #369948](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") -
Flags: review?(LpSolit)

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=476603#c22)• 16 years ago |
|  | |

Comment on [attachment 369948](/attachment.cgi?id=369948 "patch for HEAD - v3") [[details]](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") [[diff]](/attachment.cgi?id=369948&action=diff "patch for HEAD - v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=369948)
patch for HEAD - v3
I'll let LpSolit r+ or r-, but this looks good to me. For the comment, though, it's not process\_bug.cgi, it's attachment.cgi.

|  | [Robert Elves](/user_profile?user_id=235471) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=476603#c23)• 16 years ago |
|  | |

Thanks for cc'ing us Max. Yes, we will need the token in the xml. When is this slated for release?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=476603#c24)• 16 years ago |
|  | |

Comment on [attachment 369948](/attachment.cgi?id=369948 "patch for HEAD - v3") [[details]](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") [[diff]](/attachment.cgi?id=369948&action=diff "patch for HEAD - v3") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=369948)
patch for HEAD - v3
>Index: template/en/default/bug/show.xml.tmpl
> <attacher>[% a.attacher.email FILTER email FILTER xml %]</attacher>
|FILTER email| doesn't exist in 3.2 and makes this patch to not apply cleanly on the 3.2 branch. You need to backport this patch due to this change.
>+ [%# This is here so automated clients can still use process\_bug.cgi %]
mkanat is right. It's about attachment.cgi, not process\_bug.cgi.
>+ [% IF displayfields.token && user.id %]
>+ <token>[% issue\_hash\_token([a.id, a.modification\_time]) FILTER xml %]</token>
>+ [% END %]
> [% IF displayfields.attachmentdata %]
> <data encoding="base64">[% a.data FILTER base64 %]</data>
>- [% END %]
>+ [% END %]
These lines are not indented correctly.
r=LpSolit, but it would be nice to fix these comments in a new patch.
[Attachment #369948](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") -
Flags: review?(LpSolit) → review+

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a4790989_120380)• 16 years ago |

[Attachment #369948](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") -
Attachment description: patch - v3 → patch for HEAD - v3

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=476603#c25)• 16 years ago |
|  | |

Attached patch

[patch for HEAD - v3.1](attachment.cgi?id=370036&action=diff)
— [Details](attachment.cgi?id=370036&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=370036)

[Attachment #369948](/attachment.cgi?id=369948&action=edit "patch for HEAD - v3") -
Attachment is obsolete: true
[Attachment #370036](/attachment.cgi?id=370036&action=edit "patch for HEAD - v3.1") -
Flags: review+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=476603#c26)• 16 years ago |
|  | |

Attached patch

[patch for 3.2 - v1](attachment.cgi?id=370038&action=diff)
— [Details](attachment.cgi?id=370038&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=370038)

[Attachment #370038](/attachment.cgi?id=370038&action=edit "patch for 3.2 - v1") -
Flags: review?(LpSolit)

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=476603#c27)• 16 years ago |
|  | |

Comment on [attachment 370038](/attachment.cgi?id=370038 "patch for 3.2 - v1") [[details]](/attachment.cgi?id=370038&action=edit "patch for 3.2 - v1") [[diff]](/attachment.cgi?id=370038&action=diff "patch for 3.2 - v1") [[review]](/page.cgi?id=splinter.html&ignore=&bug=476603&attachment=370038)
patch for 3.2 - v1
r=LpSolit
[Attachment #370038](/attachment.cgi?id=370038&action=edit "patch for 3.2 - v1") -
Flags: review?(LpSolit) → review+

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=476603#c28)• 16 years ago |
|  | |

(In reply to [comment #23](/show_bug.cgi?id=476603#c23 "RESOLVED FIXED - [SECURITY] Editing attachments doesn't have any CSRF protection"))
> Thanks for cc'ing us Max. Yes, we will need the token in the xml. When is this
> slated for release?
Probably some time this week.

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=476603#c29)• 16 years ago |
|  | |

ok for checkin.Flags: approval?Flags: approval3.2?Flags: approval3.2+Flags: approval+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758)  Assignee |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=476603#c30)• 16 years ago |
|  | |

CVS tip:
Checking in attachment.cgi;
/cvsroot/mozilla/webtools/bugzilla/attachment.cgi,v <-- attachment.cgi
new revision: 1.153; previous revision: 1.152
done
Checking in template/en/default/attachment/edit.html.tmpl;
/cvsroot/mozilla/webtools/bugzilla/template/en/default/attachment/edit.html.tmpl,v <-- edit.html.tmpl
new revision: 1.58; previous revision: 1.57
done
Checking in template/en/default/bug/show.xml.tmpl;
/cvsroot/mozilla/webtools/bugzilla/template/en/default/bug/show.xml.tmpl,v <-- show.xml.tmpl
new revision: 1.29; previous revision: 1.28
done
BUGZILLA-3\_2-BRANCH:
Checking in attachment.cgi;
/cvsroot/mozilla/webtools/bugzilla/attachment.cgi,v <-- attachment.cgi
new revision: 1.144.2.5; previous revision: 1.144.2.4
done
Checking in template/en/default/attachment/edit.html.tmpl;
/cvsroot/mozilla/webtools/bugzilla/template/en/default/attachment/edit.html.tmpl,v <-- edit.html.tmpl
new revision: 1.51.2.3; previous revision: 1.51.2.2
done
Checking in template/en/default/bug/show.xml.tmpl;
/cvsroot/mozilla/webtools/bugzilla/template/en/default/bug/show.xml.tmpl,v <-- show.xml.tmpl
new revision: 1.23.2.4; previous revision: 1.23.2.3
doneStatus: ASSIGNED → RESOLVEDClosed: 16 years agoResolution: --- → FIXED

|  | [Max Kanat-Alexander](/user_profile?user_id=73187) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=476603#c31)• 16 years ago |
|  | |

Security advisory sent, unlocking this bug.Group: bugzilla-security

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a6012385_120380)• 16 years ago |

Blocks: [488173](/show_bug.cgi?id=488173 "RESOLVED WORKSFORME - Incorrect CSRF protection page after logging in")

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a83223779_120380)• 13 years ago |

Flags: testcase?

|  | [Frédéric Buclin](/user_profile?user_id=120380) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=476603#a145012142_120380)• 11 years ago |

Blocks: [CVE-2013-1734](/show_bug.cgi?id=913904 "RESOLVED FIXED - [SECURITY] CSRF when updating attachments")
You need to [log in](/show_bug.cgi?id=476603&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Reed Loden [:reed]](/user_profile?user_id=159758)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.bugzilla.org_8e67e2b2_20250125_220847.html ===

[![Bugzilla Logo](/assets/img/logo-header.svg)
Bugzilla](/)
Show Nav Menu

* [About](/about/ "Find out more about Bugzilla.")
  [Project](/about/ "Find out more about Bugzilla.")
  [Features](/about/features.html)
  [Who Uses Bugzilla?](/about/installation-list.html "Hundreds of companies and organizations trust Bugzilla.")
  [Meet the Team](/about/developers "Meet the Bugzilla team.")
  [Zarro Boogs Corporation](/about/zarroboogs.html "Find out about the company managing the Bugzilla Project.")
* [News](/blog/ "Get the low down on what's happening with the project.")
  [Blog](/blog/ "Bugzilla Blog")
  [Release Information](/releases/ "Information on current and previous releases.")
  [Security Advisories](/security/ "Important updates regarding Bugzilla security.")
  [Planet Bugzilla](http://planet.bugzilla.org "View the status of the Bugzilla project.")
* [Download](/download/ "Download Bugzilla")
* [Documentation](/docs/ "Bugzilla Documentation")
* [Support](/support/ "Find out where to get more information and help.")
* [Contribute](/contributing/ "Ways you can help Bugzilla")
  [How to?](/contributing/ "Ways you can help Bugzilla")
  [Report a Bug](/contributing/reporting_bugs "Let us know if there is an error in Bugzilla.")
  [Donate](/donate "Donate to Bugzilla, and see how your money is used.")
  [Wiki](https://wiki.mozilla.org/Bugzilla%3AHome "Collaboratively updated information about Bugzilla.")

Search bugzilla.org

1. [Security Advisories](/security/)
2. 3.2.2 and 3.3.3 Security Advisory

# 3.2.2 and 3.3.3 Security Advisory

Monday, Mar 30th, 2009
```

Summary
=======

Bugzilla is a Web-based bug-tracking system used by a large number of
software projects. The following security issue has been discovered
in Bugzilla:

* Attachment editing was vulnerable to a cross-site request forgery.
  Note that this issue was only fixed for 3.2.3 and 3.3.4 even though
  all versions of Bugzilla are affected (see below for an explanation).

All affected installations are encouraged to upgrade as soon as
possible.

Vulnerability Details
=====================

Class:       Cross-Site Request Forgery
Affected:    Every version before 3.2.3 or 3.3.4
Fixed In:    3.2.3, 3.3.4
Description: Attachment editing was vulnerable to a cross-site request
             forgery, because it did not validate that calls to
             attachment.cgi actually came from Bugzilla.

             Bugzilla now generates a token that is validated when
             an attachment is edited. Unfortunately, a fix for this issue
             was only possible for 3.2.3 and 3.3.4. Fixing it on earlier
             branches was not possible as attachment timestamps are not
             available to generate and validate tokens.

Vulnerability Solutions
=======================

The fix for this issue is included in the
releases. Upgrading to a release with the relevant fix will
protect your installation from possible exploits of this issue.

If you are unable to upgrade but would like to patch just the security
vulnerability, there are patches available for the issue at the
"References" URL.

Full release downloads, patches to upgrade Bugzilla from previous
versions, and git upgrade instructions are available at:

  https://www.bugzilla.org/download/

Credits
=======

The Bugzilla team wish to thank the following people for their
assistance in locating, advising us of, and assisting us to fix this
issue:

Reporter: Dave Miller
Fixed by: Reed Loden, Frédéric Buclin

General information about the Bugzilla bug-tracking system can be found
at:

  https://www.bugzilla.org/

Comments and follow-ups can be directed to the support-bugzilla mailing list.
https://www.bugzilla.org/support/ has directions for accessing this forum.

```

* [GitHub
  GitHub](https://github.com/bugzilla "GitHub")
* [X](https://x.com/%40bugzilla "X")
* [Mastodon
  Mastodon](https://techhub.social/%40bugzilla "Mastodon")
* [Bluesky](https://bsky.app/profile/bugzilla.org "Bluesky")
* [Facebook
  Facebook](https://www.facebook.com/BugzillaProject "Facebook")
* [LinkedIn
  LinkedIn](https://www.linkedin.com/company/bugzilla-project "LinkedIn")
* [IRC
  IRC on Libera.Chat](https://web.libera.chat/#/#bugzilla "IRC on Libera.Chat")
* [Discord
  Discord](https://discord.gg/ZhN6uBA "Discord")
* [Matrix
  Matrix](https://matrix.to/#/#bugzilla:mozilla.org "Matrix")
* [YouTube
  YouTube](https://www.youtube.com/%40bugzillaproject "YouTube")
* [Twitch
  Twitch](https://twitch.tv/bugzillaproject "Twitch")

---

Copyright © 1998-2024 bugzilla.org contributors
Creative Commons Attribution-ShareAlike 2.0[Creative CommonsAttributionShareAlike](https://creativecommons.org/licenses/by-sa/2.0/)


