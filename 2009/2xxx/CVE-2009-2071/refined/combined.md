=== Content from research.microsoft.com_4ab2537c_20250125_182940.html ===


![]()

Skip to main content

[![](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31)
Microsoft](https://www.microsoft.com)

Research

[Research](/en-us/research/)

Research

* [Home](/en-us/research/)
* Our research
  + Resources
    Resources
    - [Publications](/en-us/research/publications/)
    - [Code & data](/en-us/research/tools/)
    - [People](/en-us/research/people/)
    - [Microsoft Research blog](/en-us/research/blog/)
  + Research areas: Intelligence
    Research areas: Intelligence
    - [Artificial intelligence](/en-us/research/focus-area/ai-and-microsoft-research/)
    - [Audio & acoustics](/en-us/research/research-area/audio-acoustics/)
    - [Computer vision](/en-us/research/research-area/computer-vision/)
    - [Graphics & multimedia](/en-us/research/research-area/graphics-and-multimedia/)
    - [Human-computer interaction](/en-us/research/research-area/human-computer-interaction/)
    - [Human language technologies](/en-us/research/research-area/human-language-technologies/)
    - [Search & information retrieval](/en-us/research/research-area/search-information-retrieval/)
  + Research areas: Systems
    Research areas: Systems
    - [Data platforms and analytics](/en-us/research/research-area/data-platform-analytics/)
    - [Hardware & devices](/en-us/research/research-area/hardware-devices/)
    - [Programming languages & software engineering](/en-us/research/research-area/programming-languages-software-engineering/)
    - [Quantum computing](/en-us/research/research-area/quantum/)
    - [Security, privacy & cryptography](/en-us/research/research-area/security-privacy-cryptography/)
    - [Systems & networking](/en-us/research/research-area/systems-and-networking/)
  + Research areas: Theory
    Research areas: Theory
    - [Algorithms](/en-us/research/research-area/algorithms/)
    - [Mathematics](/en-us/research/research-area/computational-sciences-mathematics/)
  + Research areas: Other Sciences
    Research areas: Other Sciences
    - [Ecology & environment](/en-us/research/research-area/ecology-environment/)
    - [Economics](/en-us/research/research-area/economics/)
    - [Medical, health & genomics](/en-us/research/research-area/medical-health-genomics/)
    - [Social sciences](/en-us/research/research-area/social-sciences/)
    - [Technology for emerging markets](/en-us/research/research-area/technology-for-emerging-markets/)
* Programs & events
  + [Academic programs](/en-us/research/academic-programs/)
  + [Events & academic conferences](/en-us/research/events-conferences/)
  + [Microsoft Research Forum](https://researchforum.microsoft.com)
* Connect & learn
  + [Behind the Tech podcast](https://www.microsoft.com/en-us/behind-the-tech%20)
  + [Microsoft Research blog](/en-us/research/blog)
  + [Microsoft Research Forum](https://researchforum.microsoft.com)
  + [Microsoft Research podcast](/en-us/research/podcast/)
* About
  + People & news
    People & news
    - [About Microsoft Research](/en-us/research/about-microsoft-research/)
    - [Careers & internships](/en-us/research/careers/)
    - [People](/en-us/research/people/)
    - [Emeritus program](/en-us/research/microsoft-research-emeritus-program/)
    - [News & awards](/en-us/research/news-and-awards/)
    - [Microsoft Research newsletter](https://info.microsoft.com/ww-landing-microsoft-research-newsletter.html?wt.mc_id=S-webpage_msr-homepage)
  + Microsoft Research Labs
    Microsoft Research Labs
    - [Africa](/en-us/research/lab/microsoft-research-lab-africa-nairobi/)
    - [AI for Science](/en-us/research/lab/microsoft-research-ai-for-science/)
    - [AI Frontiers](/en-us/research/lab/ai-frontiers/)
    - [Asia-Pacific](/en-us/research/lab/microsoft-research-asia/)
    - [Cambridge](/en-us/research/lab/microsoft-research-cambridge/)
    - [Health Futures](/en-us/research/lab/microsoft-health-futures/)
    - [India](/en-us/research/lab/microsoft-research-india/)
    - [Montreal](/en-us/research/lab/microsoft-research-montreal/)
    - [New England](/en-us/research/lab/microsoft-research-new-england/)
    - [New York City](/en-us/research/lab/microsoft-research-new-york/)
    - [Redmond](/en-us/research/lab/microsoft-research-redmond/)
  + Other labs
    Other labs
    - [Applied Sciences](/en-us/research/lab/applied-sciences-group/)
    - [Mixed Reality & AI - Cambridge](/en-us/research/lab/mixed-reality-ai-lab-cambridge/)
    - [Mixed Reality & AI - Zurich](/en-us/research/lab/mixed-reality-ai-zurich/)
* More
* [Register: Research Forum](https://researchforum.microsoft.com)

* All Microsoft
  + ## Global

    - [Microsoft Security](https://www.microsoft.com/en-us/security)
    - [Azure](https://azure.microsoft.com/en-us/)
    - [Dynamics 365](https://dynamics.microsoft.com/en-us/)
    - [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365/business/)
    - [Microsoft Teams](https://www.microsoft.com/en-us/microsoft-teams/group-chat-software)
    - [Windows 365](https://www.microsoft.com/en-us/windows-365)
  + Tech & innovation
    Tech & innovation
    - [Microsoft Cloud](https://www.microsoft.com/en-us/microsoft-cloud)
    - [AI](https://www.microsoft.com/en-us/ai)
    - [Azure Space](https://azure.microsoft.com/en-us/solutions/space/)
    - [Mixed reality](https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality)
    - [Microsoft HoloLens](https://www.microsoft.com/en-us/hololens)
    - [Microsoft Viva](https://www.microsoft.com/en-us/microsoft-viva)
    - [Quantum computing](https://azure.microsoft.com/en-us/solutions/quantum-computing/)
    - [Sustainability](https://www.microsoft.com/en-us/sustainability/)
  + Industries
    Industries
    - [Education](https://www.microsoft.com/en-us/education)
    - [Automotive](https://www.microsoft.com/en-us/industry/automotive)
    - [Financial services](https://www.microsoft.com/en-us/industry/financial-services/banking)
    - [Government](https://www.microsoft.com/en-us/industry/government)
    - [Healthcare](https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare)
    - [Manufacturing](https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing)
    - [Retail](https://www.microsoft.com/en-us/industry/consumer-goods)
    - [All industries](https://www.microsoft.com/en-us/industry)
  + Partners
    Partners
    - [Find a partner](https://partner.microsoft.com/en-US/)
    - [Become a partner](https://partner.microsoft.com/en-US/membership/cloud-solution-provider)
    - [Partner Network](https://partner.microsoft.com/en-us/membership)
    - [Azure Marketplace](https://azuremarketplace.microsoft.com/en-us/)
    - [AppSource](https://appsource.microsoft.com/en-us/)
  + Resources
    Resources
    - [Blog](https://blogs.microsoft.com/)
    - [Microsoft Advertising](https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm)
    - [Developer Center](https://developer.microsoft.com/en-us/)
    - [Documentation](https://learn.microsoft.com/docs/)
    - [Events](https://www.microsoft.com/en-us/events)
    - [Licensing](https://www.microsoft.com/en-us/licensing/)
    - [Microsoft Learn](https://learn.microsoft.com/)
    - [Microsoft Research](https://www.microsoft.com/en-us/research/)
  + [View Sitemap](https://www.microsoft.com/en-us/sitemap)

Search
Search Microsoft Research

* No results

Cancel

Pause video

Microsoft Research

## **AI meets materials discovery: The vision behind MatterGen and MatterSim**

[Learn more](https://www.microsoft.com/en-us/research/story/ai-meets-materials-discovery/)

## What's new

![Ideas podcast | illustration of Tian Xie and Ziheng Lu](https://www.microsoft.com/en-us/research/uploads/prod/2025/01/Tian-Ziheng_Abstracts_Hero_Feature_River_No_Text_1400x788-1280x720.jpg)

* Featured
* [Podcasts](https://www.microsoft.com/en-us/research/podcast)
* Jan 16

### [Ideas: AI for materials discovery with Tian Xie and Ziheng Lu](https://www.microsoft.com/en-us/research/podcast/ideas-ai-for-materials-discovery-with-tian-xie-and-ziheng-lu/)

* Publication
* Video

![A grid of colorful, abstract shapes on a black background. Each cell in the grid features a unique three-dimensional geometric pattern, showcasing a variety of colors including green, red, blue, and purple.](https://www.microsoft.com/en-us/research/uploads/prod/2025/01/MatterGen-Technical-MSR-BLG-BlogHeroFeature-1400x788-1-1280x720.jpg)

* Featured
* [Blogs](https://www.microsoft.com/en-us/research/blog)
* Jan 16

### [MatterGen: A new paradigm of materials design with generative AI](https://www.microsoft.com/en-us/research/blog/mattergen-a-new-paradigm-of-materials-design-with-generative-ai/)

* Publication
* Video

![The v0.4 update introduces a cohesive AutoGen ecosystem that includes the framework, developer tools, and applications. The framework’s layered architecture clearly defines each layer’s functionality. It supports both first-party and third-party applications and extensions.](https://www.microsoft.com/en-us/research/uploads/prod/2025/01/AutoGen-0.4-BlogHeroFeature-1400x788-1-1280x720.jpg)

* Featured
* [Blogs](https://www.microsoft.com/en-us/research/blog)
* Jan 14

### [AutoGen v0.4: Reimagining the foundation of agentic AI for scale, extensibility, and robustness](https://www.microsoft.com/en-us/research/blog/autogen-v0-4-reimagining-the-foundation-of-agentic-ai-for-scale-extensibility-and-robustness/)

* Download

![Ideas podcast | illustration of Shan Lu](https://www.microsoft.com/en-us/research/uploads/prod/2025/01/Shan-Lu_Ideas_Hero_Feature_River_No_Text_1400x788-1-1280x720.jpg)

* [Podcasts](https://www.microsoft.com/en-us/research/podcast)
* Jan 23

### [Ideas: Bug hunting with Shan Lu](https://www.microsoft.com/en-us/research/podcast/ideas-bug-hunting-with-shan-lu/)

* Publication

* [Articles](https://www.microsoft.com/en-us/research/search/?facet%5Bdate%5D%5Bfixed%5D=any&facet%5Btax%5D%5Bmsr-content-type%5D=msr-blog-post&pg=1&q=&sort_by=most-recent)
* Jan 22

### [Universal insights despite data boundaries: how Microsoft’s Experimentation adapted to EU data protection](https://www.microsoft.com/en-us/research/articles/universal-insights-despite-data-boundaries-how-microsofts-experimentation-adapted-to-eu-data-protection/)

* [News](https://www.microsoft.com/en-us/research/news-and-awards)
* Jan 22

### [Microsoft launches $5M grant program for AI projects in WA state as part of 50th anniversary](https://www.microsoft.com/en-us/research/news-and-awards/microsoft-launches-5m-grant-program-for-ai-projects-in-wa-state-as-part-of-50th-anniversary/)

* [News](https://www.microsoft.com/en-us/research/news-and-awards)
* Jan 21

### [Microsoft's 'AI for Good' program offers $5 million in grants for Washington innovators](https://www.microsoft.com/en-us/research/news-and-awards/microsofts-5-million-program-aims-to-use-ai-for-global-good-focuses-on-washington-innovators/)

* [News](https://www.microsoft.com/en-us/research/news-and-awards)
* Jan 22

### [Wei Chen and Benjamin G. Zorn named 2024 ACM Fellows](https://www.microsoft.com/en-us/research/news-and-awards/wei-chen-and-benjamin-g-zorn-named-2024-acm-fellows/)

* [Publications](https://www.microsoft.com/en-us/research/publications)
* Jan 14

### [FLAVARS: A Multimodal Foundational Language and Vision Alignment Model for Remote Sensing](https://www.microsoft.com/en-us/research/publication/flavars-a-multimodal-foundational-language-and-vision-alignment-model-for-remote-sensing/)

* [Publications](https://www.microsoft.com/en-us/research/publications)
* Jan 17

### [Good things come in small packages: Should we adopt Lite-GPUs in AI infrastructure?](https://www.microsoft.com/en-us/research/publication/good-things-come-in-small-packages-should-we-adopt-lite-gpus-in-ai-infrastructure/)

* [Publications](https://www.microsoft.com/en-us/research/publications)
* Jan 16

### [Managed-Retention Memory: A New Class of Memory for the AI Era](https://www.microsoft.com/en-us/research/publication/managed-retention-memory-a-new-class-of-memory-for-the-ai-era/)

![Research Focus: January 17, 2025](https://www.microsoft.com/en-us/research/uploads/prod/2025/01/NEW_RF56-BlogHeroFeature-1400x788-1-1280x720.jpg)

* [Blogs](https://www.microsoft.com/en-us/research/blog)
* Jan 17

### [Research Focus: Week of January 13, 2025](https://www.microsoft.com/en-us/research/blog/research-focus-week-of-january-13-2025/)

* Publication

* [Publications](https://www.microsoft.com/en-us/research/publications)
* Jan 13

### [Enhanced Macular Telangiectasia Type 2 Detection: Leveraging Self-Supervised Learning and Ensemble Models](https://www.microsoft.com/en-us/research/publication/enhanced-macular-telangiectasia-type-2-detection-leveraging-self-supervised-learning-and-ensemble-models/)

Loading

Opens in a new tab

Follow us:

* [Follow on X](https://x.com/intent/follow?original_referrer=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2F&screen_name=MSFTResearch)
* [Like on Facebook](https://www.facebook.com/microsoftresearch/)
* [Follow on LinkedIn](https://www.linkedin.com/showcase/microsoftresearch/)
* [Subscribe on Youtube](https://www.youtube.com/user/MicrosoftResearch)
* [Follow on Instagram](https://www.instagram.com/msft_research/)
* [Subscribe to our RSS feed](https://www.microsoft.com/en-us/research/feed/)

Share this page:

* [Share on X](https://x.com/intent/tweet?text=Home&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2F)
* [Share on Facebook](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2F)
* [Share on LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2F&title=Home&summary=Home&source=Microsoft%20Research)
* [Share on Reddit](http://www.reddit.com/submit?title=Home&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2F)

What's new

* [Surface Pro](https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition)
* [Surface Laptop](https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition)
* [Surface Laptop Studio 2](https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz)
* [Surface Laptop Go 3](https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2)
* [Microsoft Copilot](https://www.microsoft.com/en-us/microsoft-copilot)
* [AI in Windows](https://www.microsoft.com/en-us/windows/copilot-ai-features)
* [Explore Microsoft products](https://www.microsoft.com/en-us/microsoft-products-and-apps)
* [Windows 11 apps](https://www.microsoft.com/windows/windows-11-apps)

Microsoft Store

* [Account profile](https://account.microsoft.com/)
* [Download Center](https://www.microsoft.com/en-us/download)
* [Microsoft Store support](https://go.microsoft.com/fwlink/?linkid=2139749)
* [Returns](https://www.microsoft.com/en-us/store/b/returns)
* [Order tracking](https://www.microsoft.com/en-us/store/b/order-tracking)
* [Certified Refurbished](https://www.microsoft.com/en-us/store/b/certified-refurbished-products)
* [Microsoft Store Promise](https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020)
* [Flexible Payments](https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc)

Education

* [Microsoft in education](https://www.microsoft.com/en-us/education)
* [Devices for education](https://www.microsoft.com/en-us/education/devices/overview)
* [Microsoft Teams for Education](https://www.microsoft.com/en-us/education/products/teams)
* [Microsoft 365 Education](https://www.microsoft.com/en-us/education/products/microsoft-365)
* [How to buy for your school](https://www.microsoft.com/education/how-to-buy)
* [Educator training and development](https://education.microsoft.com/)
* [Deals for students and parents](https://www.microsoft.com/en-us/store/b/education)
* [Azure for students](https://azure.microsoft.com/en-us/free/students/)

Business

* [Microsoft Cloud](https://www.microsoft.com/en-us/microsoft-cloud)
* [Microsoft Security](https://www.microsoft.com/en-us/security)
* [Dynamics 365](https://www.microsoft.com/en-us/dynamics-365)
* [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365/business)
* [Microsoft Power Platform](https://www.microsoft.com/en-us/power-platform)
* [Microsoft Teams](https://www.microsoft.com/en-us/microsoft-teams/group-chat-software)
* [Microsoft 365 Copilot](https://www.microsoft.com/en-us/microsoft-365/copilot/copilot-for-work)
* [Small Business](https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore)

Developer & IT

* [Azure](https://azure.microsoft.com/en-us/)
* [Microsoft Developer](https://developer.microsoft.com/en-us/)
* [Documentation](https://learn.microsoft.com/docs/)
* [Microsoft Learn](https://learn.microsoft.com/)
* [Microsoft Tech Community](https://techcommunity.microsoft.com/)
* [Azure Marketplace](https://azuremarketplace.microsoft.com/en-us/)
* [AppSource](https://appsource.microsoft.com/en-us/)
* [Visual Studio](https://visualstudio.microsoft.com/)

Company

* [Careers](https://careers.microsoft.com/)
* [About Microsoft](https://www.microsoft.com/about)
* [Company news](https://news.microsoft.com/)
* [Privacy at Microsoft](https://privacy.microsoft.com/en-us)
* [Investors](https://www.microsoft.com/investor/default.aspx)
* [Diversity and inclusion](https://www.microsoft.com/en-us/diversity/)
* [Accessibility](https://www.microsoft.com/en-us/accessibility)
* [Sustainability](https://www.microsoft.com/en-us/sustainability/)

[Your Privacy Choices Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)
[Your Privacy Choices Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

[Consumer Health Privacy](https://go.microsoft.com/fwlink/?linkid=2259814)

* [Sitemap](https://www.microsoft.com/en-us/sitemap1.aspx)
* [Contact Microsoft](https://support.microsoft.com/contactus)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* Manage cookies
* [Terms of use](https://go.microsoft.com/fwlink/?LinkID=206977)
* [Trademarks](https://go.microsoft.com/fwlink/?linkid=2196228)
* [Safety & eco](https://go.microsoft.com/fwlink/?linkid=2196227)
* [Recycling](https://www.microsoft.com/en-us/legal/compliance/recycling)
* [About our ads](https://choice.microsoft.com)
* © Microsoft 2025



=== Content from code.google.com_cdf1469b_20250125_182934.html ===



=== Content from code.google.com_711ce704_20250125_182935.html ===



=== Content from bugzilla.mozilla.org_f35cdaf8_20250125_182945.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/479880)
* [XML](/show_bug.cgi?ctype=xml&id=479880)

Closed
[Bug 479880](/show_bug.cgi?id=479880)
(CVE-2009-1836)

Opened 16 years ago
Closed 16 years ago

# Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS

## Categories

### (Core :: Networking: HTTP, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Networking%3A%20HTTP#Networking%3A%20HTTP)

Networking: HTTP
▾

Core :: Networking: HTTP
For bugs in Mozilla's HTTP networking code. This component deals with HTTP specific issues like pipelining, keep-alive, HTTP proxies, 1.1 issues, redirects, authentication (basic), etc.

Examples of appropriate bugs: Problems with proxy authentication; HTTP redirects looping indefinitely, etc.

[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Networking%3A%20HTTP&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Networking%3A%20HTTP)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

normal

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

mozilla1.9.2a1

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Performance Impact | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: abarth-mozilla, Assigned: jduell.mcbugs)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/2531a1c9efafc5fe629a977c514b29b1?d=mm&size=40)  [jduell.mcbugs](/user_profile?user_id=334931)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/afc22cfc53716f933c5412ba5f9a2c38?d=mm&size=40)  [abarth-mozilla](/user_profile?user_id=284575)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/608e04ebca94be52b05c003d51d43e07?d=mm&size=40)  [kershaw](/user_profile?user_id=505624)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

30 people

## References

### ( [URL](http://research.microsoft.com/apps/pubs/default.aspx?id=79323 "http://research.microsoft.com/apps/pubs/default.aspx?id=79323") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page"), [493699](/show_bug.cgi?id=493699 "RESOLVED WONTFIX - Firefox display \"Proxy Server Refused Connection\" instead of custom error page when connect to HTTPS site which blocked by proxy server")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=479880&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=479880)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[488386](/show_bug.cgi?id=488386 "RESOLVED DUPLICATE - SSL MiTM on Firefox while using a Proxy by doing Hi-Jacking the Proxy")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[research.microsoft.com/apps/pubs/defa...](http://research.microsoft.com/apps/pubs/default.aspx?id=79323 "http://research.microsoft.com/apps/pubs/default.aspx?id=79323")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [sg:high])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2009-1836

[Keywords:](/describekeywords.cgi)

[fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---),
[verified1.8.1.22](/buglist.cgi?keywords=verified1.8.1.22&resolution=---),
[verified1.9.0.10](/buglist.cgi?keywords=verified1.9.0.10&resolution=---),
[verified1.9.0.11](/buglist.cgi?keywords=verified1.9.0.11&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[sg:high]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [jst](/user_profile?user_id=12352) | [blocking1.9.1](#c39 "16 years ago") | + |
| --- | --- | --- |
| [jst](/user_profile?user_id=12352) | blocking1.9.1 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.9.0.10](#c46 "16 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.9.0.10 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [blocking1.9.0.11](#c0 "16 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | blocking1.9.0.11 | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | [wanted1.9.0.x](#c40 "16 years ago") | + |
| --- | --- | --- |
| [samuel.sidler+old](/user_profile?user_id=190622) | wanted1.9.0.x | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [blocking1.8.1.next](#c59 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | blocking1.8.1.next | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | [wanted1.8.1.x](#c59 "16 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | wanted1.8.1.x | + |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | [in-testsuite](#c50 "16 years ago") | ? |
| --- | --- | --- |
| [bzbarsky](/user_profile?user_id=20209) | in-testsuite | ? |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 5 obsolete files)

| [test case](/attachment.cgi?id=363796)  [16 years ago](#c1)  [Adam Barth](/user_profile?user_id=284575)   114 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=363796&action=edit) |
| --- | --- | --- |
| [proof-of-concept demo patch](/attachment.cgi?id=371339)  [16 years ago](#c7)  [Jason Duell](/user_profile?user_id=334931)   988 bytes, patch |  | [Details](/attachment.cgi?id=371339&action=edit) | [Diff](/attachment.cgi?id=371339&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=371339) |
| [Possibly correct patch](/attachment.cgi?id=371776)  [16 years ago](#c15)  [Jason Duell](/user_profile?user_id=334931)   1.03 KB, patch |  | [Details](/attachment.cgi?id=371776&action=edit) | [Diff](/attachment.cgi?id=371776&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=371776) |
| [test case: 407 reply from evil proxy (reads target site cookie). Run with "nc -l 8080 < evil\_407\_SSL\_proxy.reply"](/attachment.cgi?id=371987)  [16 years ago](#c23)  [Jason Duell](/user_profile?user_id=334931)   975 bytes, text/plain |  | [Details](/attachment.cgi?id=371987&action=edit) |
| [Partial patch for fix](/attachment.cgi?id=372752)  [16 years ago](#c26)  [Jason Duell](/user_profile?user_id=334931)   4.74 KB, patch |  | [Details](/attachment.cgi?id=372752&action=edit) | [Diff](/attachment.cgi?id=372752&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=372752) |
| [Patch now handles all cases: needs review](/attachment.cgi?id=373024)  [16 years ago](#c27)  [Jason Duell](/user_profile?user_id=334931)   5.26 KB, patch |  | [Details](/attachment.cgi?id=373024&action=edit) | [Diff](/attachment.cgi?id=373024&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373024) |
| [Incorporate Wan-Teh's changes, plus change default error page](/attachment.cgi?id=373182)  [16 years ago](#c29)  [Jason Duell](/user_profile?user_id=334931)   5.26 KB, patch | Waldo : [review+](#c37 "16 years ago")  johnath : [ui-review+](#a4482342_210757 "16 years ago") | [Details](/attachment.cgi?id=373182&action=edit) | [Diff](/attachment.cgi?id=373182&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373182) |
| [Add sanity check to ensure SSL is being used](/attachment.cgi?id=373419)  [16 years ago](#c38)  [Jason Duell](/user_profile?user_id=334931)   5.32 KB, patch | Waldo : [review+](#a4589009_83595 "16 years ago")  bzbarsky : [superreview+](#a5083651_20209 "16 years ago")  samuel.sidler+old : [approval1.9.0.10+](#c47 "16 years ago")  samuel.sidler+old : [approval1.9.0.11+](#c47 "16 years ago") | [Details](/attachment.cgi?id=373419&action=edit) | [Diff](/attachment.cgi?id=373419&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373419) |
| [Diff that applies to 1.9.0 branch](/attachment.cgi?id=374317)  [16 years ago](#c48)  [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209)   5.71 KB, patch |  | [Details](/attachment.cgi?id=374317&action=edit) | [Diff](/attachment.cgi?id=374317&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=374317) |
| [Patch for 1.8 branch](/attachment.cgi?id=380256)  [16 years ago](#c60)  [Jason Duell](/user_profile?user_id=334931)   5.67 KB, patch | bzbarsky : [review+](#a8461585_20209 "16 years ago")  bzbarsky : [superreview+](#a8461585_20209 "16 years ago")  dveditz : [approval1.8.1.next+](#c64 "16 years ago") | [Details](/attachment.cgi?id=380256&action=edit) | [Diff](/attachment.cgi?id=380256&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=380256) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=479880#c0)• 16 years ago |
|  | |

I bet this bug is already on file, but I don't have access to all the security bugs so I'm filing this one in the hopes that it gets duped against an existing bug.
Threat Model:
1) The user has a proxy server configured.
2) There is an active network attacker.
3) The user visits <https://www.paypal.com/>
Attack:
The browser issues a CONNECT request to the proxy server. The active network attacker intercepts this request and replies with the following bytes:
HTTP/1.1 404 Not Found
Content-Type: text/html; charset=ISO-8859-1
<script>alert(document.cookie)</script>
The browser happily runs the network attacker's script in the <https://www.paypal.com> security origin, causing disaster.
Chromium received this bug report (and additional related bugs involving redirects) from Microsoft. My understanding is that some researchers from MSR are going to present about these bugs as the upcoming Oakland Security Conference. We should coordinate so we fix this issue in the same way. More details are available at <<http://code.google.com/p/chromium/issues/detail?id=7338>>, which I can give you access to.
Thanks,
Adam

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=479880#c1)• 16 years ago |
|  | |

Attached file
[test case](attachment.cgi?id=363796)
— [Details](attachment.cgi?id=363796&action=edit)

Hum... This hasn't gotten duped yet. Here's a test case. Download this file and run the following command:
nc -l 8080 < resp
Now, configure Firefox to use localhost:8080 as your proxy. Visit <https://www.paypal.com/>. Notice that your cookie gets alerted.
I have a copy of Shuo's paper. I'll ask him if I can share it with you.

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=479880#c2)• 16 years ago |
|  | |

Apparently I'm not allowed to share the paper until May 19, the day of the conference, because it also describes IE vulnerabilities. Shuo said he reported these issues a year ago, but they don't seem to be fixed in Firefox 3. I haven't tested the nightly.
I think the cleanest fix is to treat any non-200 response to a CONNECT request as a network error and disregard any redirects or response body. The benefit of this approach is that it's easy to see that all these vulnerabilities are fixed. The cost of this approach is that the user doesn't get to see fancy error messages from proxies for HTTPS sites.

|  | [Lucas Adamski [:ladamski]](/user_profile?user_id=322148) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a11643_322148)• 16 years ago |

Whiteboard: [sg:high]

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=479880#c3)• 16 years ago |
|  | |

I don't see any obvious dups in core-security, at least not with proxy, ssl, https, connect in the summary.
nsHttpConnection::OnHeadersAvailable calls nsHttpTransaction::SetSSLConnectFailed. That sets mSSLConnectFailed, which as far as I can tell is only looked at in nsHttpChannel::ProcessResponse in the case of a 407 response; looks to me like if we call trans->SSLConnectFailed() in ProcessResponse before doing anything else we can stop dealing with the response as though it were a normal response.

|  | [Jesse Ruderman](/user_profile?user_id=11608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a210202_11608)• 16 years ago |

Summary: Non-200 responses to CONNECT requests lead to attacks on HTTPS → Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=479880#c4)• 16 years ago |
|  | |

FWIW, Chrome is likely to ship a fix for this issue in its next stable release. If you like, I can ask them to keep the issue description out of their release notes since it might lead others to test Firefox for this issue.

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=479880#c5)• 16 years ago |
|  | |

My understanding is that Shuo is planning to go public with this vulnerability on May 19.

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=479880#c6)• 16 years ago |
|  | |

Jason - how high does this bubble up on your priority list?

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=479880#c7)• 16 years ago |
|  | |

Attached patch

[proof-of-concept demo patch](attachment.cgi?id=371339&action=diff) (obsolete)
— [Details](attachment.cgi?id=371339&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=371339)

I've verified that Waldo's suggestion in [comment #3](/show_bug.cgi?id=479880#c3 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS") works: I can cause the browser to display an error message instead of allowing the exploit by checking for SSLConnectFailed() early in HttpChannel::ProcessResponse().
But I'm not sure on some important details that we'd need to sort out before we can fix this:
1) What \*exactly\* is the behavior we want to have when we encounter this? Adam suggests treating this as a "network error" for non-200 responses in [comment #2](/show_bug.cgi?id=479880#c2 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"). Waldo suggests we barf on \*all\* requests by putting the check early on in the function. My hunch is that if SSLConnectFail has been called, we probably want to treat it as an error, regardless of HTTP response code--but I don't know HTTPS proxy/client protocols very well.
2) Assuming Waldo is correct, how early exactly do we want to do this check, and what's the right behavior? In my patch I've called Cancel() and returned with NS\_ERROR\_NET\_RESET (the closest thing I could find in netwerk/base/public/nsNetError.h to a "network error"). I've done this early enough that if we encounter this failure, we don't notify the ""http-on-examine-response" observers, or set cookies, etc. But I don't know this code at all, so I'm merely guessing that this is correct.
Can anyone point me at a spec for HTTPS proxying?

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=479880#c8)• 16 years ago |
|  | |

I think we want to block all status codes except 407, which is "Proxy Authentication Required". It's essential that we not read unauthenticated bytes from the message payload, even on a 407, but we do want to get far enough in the proxy auth process to show the user the auth challenge dialog.

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=479880#c9)• 16 years ago |
|  | |

Jason,
HTTPS proxy tunneling is originally specified in an expired
Internet-Draft titled "Tunneling TCP based protocols through
Web proxy servers". You can find the Internet-Draft by doing
a Web search for that title.
It is also specified in Section 5 (specifically Sections 5.2
and 5.3) of RFC 2817.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=479880#c10)• 16 years ago |
|  | |

On the patch, I guess you want the mConnectionInfo->UsingSSL() guard that's in the current codepath that hits the SSL-failed check, but I haven't looked to see what the consequences are.
(In reply to [comment #7](/show_bug.cgi?id=479880#c7 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> 1) What \*exactly\* is the behavior we want to have when we encounter this?
> Adam suggests treating this as a "network error" for non-200 responses in
> [comment #2](/show_bug.cgi?id=479880#c2 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"). Waldo suggests we barf on \*all\* requests by putting the check
> early on in the function.
To be clear, my suggestion was off-the-cuff and mostly motivated by the existing code structure and by a desire to fail generally rather than only in specific cases (potentially missing some along the way). I wasn't thinking much about the "right" response or what it should be so much as about ensuring a forceful abort of normal handling in all cases outside the clearly-correct ones. Putting up the proxy-auth dialogs for the 407 case and only using the response data in the 200 case where the handshake must succeed for the data to be used seems most correct on further thought. (The RFC says any 2xx response, but what would a 206 response to a CONNECT request even mean? We'll need to test 200, 203, 206, and at least one other 2xx response here to verify correct behavior in all cases, at least if the current code setup isn't substantially changed.)
> My hunch is that if SSLConnectFail has been called, we probably want to treat
> it as an error, regardless of HTTP response code--but I don't know HTTPS
> proxy/client protocols very well.
I was going to say treat them the same as some typical HTTPS error, maybe untrusted sender, but then the user can click through -- and given that one hopes non-malicious instances of this in the real world are rare, it would be better not to give users the gun in the first place.
> 2) Assuming Waldo is correct, how early exactly do we want to do this check,
> and what's the right behavior? In my patch I've called Cancel() and returned
> with NS\_ERROR\_NET\_RESET (the closest thing I could find in
> netwerk/base/public/nsNetError.h to a "network error").
NS\_ERROR\_PROXY\_CONNECTION\_REFUSED ("The connection attempt to a proxy failed", so the name is a slight misnomer for the description) seems better here (we'd treat responses as though the proxy gave a malformed response), and I'm pretty sure that wouldn't allow a way to click through the error page.
> I've done this early enough that if we encounter this failure, we don't
> notify the ""http-on-examine-response" observers, or set cookies, etc. But
> I don't know this code at all, so I'm merely guessing that this is correct.
Seems right, biesi may know more.
> Can anyone point me at a spec for HTTPS proxying?
<http://curl.haxx.se/rfc/draft-luotonen-web-proxy-tunneling-01.txt>
<http://www.ietf.org/rfc/rfc2817.txt>
are about the closest I could find when I was looking at this in connection with [bug 428009](/show_bug.cgi?id=428009 "RESOLVED FIXED - hook up ssltunnel to mochitest") (they seem to be what [comment 9](/show_bug.cgi?id=479880#c9 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS") was suggesting). The RFCs for this aren't organized very coherently or discoverably as far as I can tell, unfortunately.

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=479880#c11)• 16 years ago |
|  | |

(In reply to [comment #10](/show_bug.cgi?id=479880#c10 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> > My hunch is that if SSLConnectFail has been called, we probably want to treat
> > it as an error, regardless of HTTP response code--but I don't know HTTPS
> > proxy/client protocols very well.
>
> I was going to say treat them the same as some typical HTTPS error, maybe
> untrusted sender, but then the user can click through -- and given that one
> hopes non-malicious instances of this in the real world are rare, it would be
> better not to give users the gun in the first place.
>
> > 2) Assuming Waldo is correct, how early exactly do we want to do this check,
> > and what's the right behavior? In my patch I've called Cancel() and returned
> > with NS\_ERROR\_NET\_RESET (the closest thing I could find in
> > netwerk/base/public/nsNetError.h to a "network error").
>
> NS\_ERROR\_PROXY\_CONNECTION\_REFUSED ("The connection attempt to a proxy failed",
> so the name is a slight misnomer for the description) seems better here (we'd
> treat responses as though the proxy gave a malformed response), and I'm pretty
> sure that wouldn't allow a way to click through the error page.
It won't. The overrides on cert errors are specific to a small set, and that's not one of them, so unless it was added explicitly, it gets a full stop.
Having said that - whatever expedient solution we use for branches that are string frozen, it feels to me like the best thing to do for upcoming versions is just to introduce a new error, and strings, for this case. Hopefully we haven't used up all our error codes?
I'd be happy to recommend strings for a mozilla-central patch, if you agree.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=479880#c12)• 16 years ago |
|  | |

(In reply to [comment #11](/show_bug.cgi?id=479880#c11 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> It won't. The overrides on cert errors are specific to a small set, and that's
> not one of them, so unless it was added explicitly, it gets a full stop.
Mm, good.
> Having said that - whatever expedient solution we use for branches that are
> string frozen, it feels to me like the best thing to do for upcoming versions
> is just to introduce a new error, and strings, for this case. Hopefully we
> haven't used up all our error codes?
Oh, right, too much in the mindset of not being able to change these things...new error is best for trunk, for sure.
> I'd be happy to recommend strings for a mozilla-central patch, if you agree.
Sounds good -- although of course we can hack in bogo-strings in the meantime, until final UI becomes the only holdup here.

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=479880#c13)• 16 years ago |
|  | |

Re: 2xx responses to CONNECT requests: I don't know what
a non-200 2xx response to CONNECT means either. So in
Chromium's network stack, I only consider a 200 response
as successful tunnel setup, and I disallow any response
body after the response headers. So far I haven't received
any bug report that this is overly strict.
Please remember to test the URL
<https://no.such.host/>
against a proxy. This will give you a vivid idea what we
lose by handling any non-200 non-407 response as a network
error. For example, the proxy I use returns a 404 response
whose body contains an informative error message:
While trying to retrieve the URL: no.such.host:443
The following error was encountered:
Unable to determine IP address from host name for
The dnsserver returned:
Name Error: The domain name does not exist.
This means that:
The cache was not able to resolve the hostname
presented in the URL. Check if the address is
correct.
In our testing we have seen our proxy return 403, 404,
and 501 with a useful error page in the response body.
It's too bad that we won't be able to display this error
page to users for security reasons.

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=479880#c14)• 16 years ago |
|  | |

We could potentially show some built in error pages to differentiate the different status codes. In principle, we could use heuristics (like greping the error pages) to figure out if its some common error like "host not found."

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=479880#c15)• 16 years ago |
|  | |

Attached patch

[Possibly correct patch](attachment.cgi?id=371776&action=diff) (obsolete)
— [Details](attachment.cgi?id=371776&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=371776)

OK, so it looks to me like the existing strategy should work fine: by the time we get to the code in the patch we will have set SSLConnectFailed in OnHeadersAvailable() iff we do an SSL proxy connect and the status != 200. So we can and should bail out here if SSLConnectFailed is true. The only exception I've heard are 407 requests, which we let drop through.
I don't know the code well enough to say if my method of "bailing out" is the right one. I'm going to have biesi take a look, as he'll know.
The last remaining issue is the error code to use for branches and the trunk. It sounds like we want a new error code for the trunk; anyone have a suggestion? For now I've stuck in NS\_ERROR\_PROXY\_CONNECTION\_REFUSED.
[Attachment #371339](/attachment.cgi?id=371339&action=edit "proof-of-concept demo patch") -
Attachment is obsolete: true
[Attachment #371776](/attachment.cgi?id=371776&action=edit "Possibly correct patch") -
Flags: superreview?(cbiesinger)
[Attachment #371776](/attachment.cgi?id=371776&action=edit "Possibly correct patch") -
Flags: review?(cbiesinger)

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=479880#c16)• 16 years ago |
|  | |

You can't just let 407 through. You have to make sure we don't render the entity body, even if the user cancels the auth request, etc.

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=479880#c17)• 16 years ago |
|  | |

> In our testing we have seen our proxy return
> 403, 404, and 501 with a useful error page in
> the response body. It's too bad that we won't
> be able to display this error page to users
> for security reasons.
> You can't just let 407 through. You have to
> make sure we don't render the entity body,
> even if the user cancels the auth request, etc.
So, the more I think about this, isn't a more global solution to allow the browser to treat 403/404/407/501 responses with failed SSL "normally" (i.e. render content), but just not as if the HTML were coming from the final destination (i.e paypal)?
I don't know this code base very well yet, but surely we've got some way to let the code upstream know that the content is coming from the proxy server (or from some dummy "unsafe" URL that can't have cookies, etc.), and not the final site. Anyone know of the correct frob for this?

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=479880#c18)• 16 years ago |
|  | |

That's really dicey when you consider that the bogus content might be trying to mount a phishing attack. Better to block the evil content.

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=479880#c19)• 16 years ago |
|  | |

Jason,
Your proposal would be the ideal solution, but it may
requires a lot of work to get it right. (In fact,
that's what I asked Adam to do originally.)
The solution Adam and I suggested is a drastic measure,
but it is much simpler to get right and be secure. If
you decide to proceed with this solution, make sure you
set up a proxy that requires HTTP authentication, visit
<https://bugzilla.mozilla.org/>, and cancel the proxy's
auth dialog. The proxy's 407 response should not be
displayed. I have such a proxy at work, so I can perform
this test for you.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=479880#c20)• 16 years ago |
|  | |

> surely we've got some way to let the code upstream know that the content is
> coming from the proxy server
Not that I can think of, and even if we did the url bar would still have the URI the user typed in, no?

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=479880#c21)• 16 years ago |
|  | |

Right, the URL bar would still have the URI the user typed in,
but it would have the default white background (as opposed to
yellow), and there would be no lock icon.

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=479880#c22)• 16 years ago |
|  | |

I think for the phishing situation that's really not sufficient, esp for the security-conscious user who clicks a bookmark they know points to https... they might not even notice the lack of other indicators, since they "know" their setup is "correct" in terms of not being phishable without screaming in your face warnings about cert mismatches.

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=479880#c23)• 16 years ago |
|  | |

Attached file
[test case: 407 reply from evil proxy (reads target site cookie). Run with "nc -l 8080 < evil\_407\_SSL\_proxy.reply"](attachment.cgi?id=371987)
— [Details](attachment.cgi?id=371987&action=edit)

I've attached a test case that verifies that if we let 407 requests through without further code changes (i.e. if we use the 371776 patch), we are vulnerable to the same cookie/etc attack, as the proxy server's "auth failed" page is treated by Firefox as if it came from paypal.com.
I think we really want to keep these proxy server msgs if we can, so we should try to find a way to display them w/o treating them as from the target destination.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=479880#c24)• 16 years ago |
|  | |

[Bug 488386](/show_bug.cgi?id=488386 "RESOLVED DUPLICATE - SSL MiTM on Firefox while using a Proxy by doing Hi-Jacking the Proxy") is a dup (I didn't mark it as such, will leave to a more seasoned hand to do that); this problem seems to be accumulating attention, although it could just be a complete coincidence. Worth ramping up the pace here since it's something other people are stumbling on?

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=479880#c26)• 16 years ago |
|  | |

Attached patch

[Partial patch for fix](attachment.cgi?id=372752&action=diff) (obsolete)
— [Details](attachment.cgi?id=372752&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=372752)

I've got half a fix here (I'm still tracking down the correct way to handle 407 responses). But since there's some UI-ish decisions here, and I want to try to get this into 3.5b4 in the next day or two, I thought I'd run what I've got by you all.
So we're basically in the game here of trying to match up HTTP response codes from the proxy to the most helpful boilerplate Mozilla error page available. I've poked around a bit at squid's code, to see how it works, and RFC 2616, and the logic in the patch is what seems the most sensible to me. There are a couple of codes where I had to make a choice (500 as DNS failure vs. as internal server error; 504 as DNS vs target failure), and I'm also guessing at what to do for 501 (Wan-Teh, you said you were seeing meaningful pages from proxies with 501: what kind of message?).
There's also the question of what the default page should be for other error codes. There's really nothing else I can see that's a valid response from a proxy, so I shoveled in NS\_ERROR\_UNSAFE\_CONTENT\_TYPE to give the user an "unsafe content" message, to indicate someone may be messing with them. I am not at all certain that's the best UI choice.
So: take a look at the patch, and any comments or opinions would be welcome.
[Attachment #371776](/attachment.cgi?id=371776&action=edit "Possibly correct patch") -
Attachment is obsolete: true
[Attachment #371776](/attachment.cgi?id=371776&action=edit "Possibly correct patch") -
Flags: superreview?(cbiesinger)
[Attachment #371776](/attachment.cgi?id=371776&action=edit "Possibly correct patch") -
Flags: review?(cbiesinger)

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=479880#c27)• 16 years ago |
|  | |

Attached patch

[Patch now handles all cases: needs review](attachment.cgi?id=373024&action=diff) (obsolete)
— [Details](attachment.cgi?id=373024&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373024)

OK, I think I've figured out how to handle the 407 case, too (it's fairly simple), so this patch is ready for review.
Please see notes to previous patch, all of which are still valid issues/questions.
I've verified that this code works both with the 407 test case attached to this bug (which doesn't pop up an auth window, as it lacks the correct headers), and with squid, which does pop up an auth window. We need to handle both cases, of course...Assignee: nobody → jduell.mcbugs
[Attachment #372752](/attachment.cgi?id=372752&action=edit "Partial patch for fix") -
Attachment is obsolete: trueStatus: NEW → ASSIGNED
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: ui-review?(johnath)
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: superreview?(cbiesinger)
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: review?(jwalden+bmo)

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=479880#c28)• 16 years ago |
|  | |

Comment on [attachment 373024](/attachment.cgi?id=373024 "Patch now handles all cases: needs review") [[details]](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") [[diff]](/attachment.cgi?id=373024&action=diff "Patch now handles all cases: needs review") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373024)
Patch now handles all cases: needs review
I don't know the netwerk code that well, so my review isn't
authoritative. Just trying to help...
Assuming that nsHttpChannel::ProcessResponse is the right place
to handle SSL proxy connection failures, your patch looks correct.
I have three nits.
1. I don't know what "fsck" means.
2. Add a "break" statement to the 'default' case in the
switch statement you added.
3. In this LOG statement, you are missing the corresponding format
specifiers for 'this' and 'httpStatus':
>+ LOG(("Cancelling failed SSL proxy connection\n", this, httpStatus));
Compare that with this LOG statement, which has the format specifiers:
> LOG(("nsHttpChannel::ProcessResponse [this=%x httpStatus=%u]\n",
> this, httpStatus));

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=479880#c29)• 16 years ago |
|  | |

Attached patch

[Incorporate Wan-Teh's changes, plus change default error page](attachment.cgi?id=373182&action=diff) (obsolete)
— [Details](attachment.cgi?id=373182&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373182)

OK, I've incorporated Wan-Teh's suggestions,
I've also changed the default response (for HTTP codes that don't make sense) to "Proxy server refused connection" (the last patch returned NS\_ERROR\_UNSAFE\_CONTENT\_TYPE, which gave a page about the "file type being unsafe", which I now think is likely to just confuse people).
Wan-Teh, could you tell me what sort of error page you've gotten from a proxy with a 501 status, as you mentioned in [comment #13](/show_bug.cgi?id=479880#c13 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS")? Thanks.
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Attachment is obsolete: true
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: ui-review?(johnath)
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: superreview?(cbiesinger)
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: review?(jwalden+bmo)
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: ui-review?(johnath)
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: superreview?(cbiesinger)
[Attachment #373024](/attachment.cgi?id=373024&action=edit "Patch now handles all cases: needs review") -
Flags: review?(jwalden+bmo)

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a4482342_210757)• 16 years ago |

[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: ui-review?(johnath) → ui-review+

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=479880#c30)• 16 years ago |
|  | |

Comment on [attachment 373182](/attachment.cgi?id=373182 "Incorporate Wan-Teh's changes, plus change default error page") [[details]](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") [[diff]](/attachment.cgi?id=373182&action=diff "Incorporate Wan-Teh's changes, plus change default error page") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373182)
Incorporate Wan-Teh's changes, plus change default error page
>+ case 403: // HTTP/1.1: "Forbidden"
>+ case 407: // if user's auth failed
>+ case 501: // HTTP/1.1: "Not Implemented"
>+ // user sees boilerplate Mozilla "Proxy Refused Connection" page.
>+ rv = NS\_ERROR\_PROXY\_CONNECTION\_REFUSED;
>+ break;
Makes sense to me
>+ // Squid replies with 404 if DNS fails.
>+ // - note: regular "page not found" 404 from target server handled over
>+ // SSL; different codepath.
>+ case 404: // HTTP/1.1: "Not Found"
>+ // RFC 2616 notes that "some deployed proxies are known to return 400 or
>+ // 500 when DNS lookups time out." (Squid uses 500 if it runs out of
>+ // sockets: so we have a conflict here).
>+ case 400: // HTTP/1.1 "Bad Request"
>+ case 500: // HTTP/1.1: "Internal Server Error"
>+ /\* User sees: "Address Not Found: Firefox can't find the server at
>+ \* www.foo.com."
>+ \*/
>+ rv = NS\_ERROR\_UNKNOWN\_HOST;
>+ break;
I think I would have expected 500 to go up above, with "Proxy Refused Connection". If a proxy is 500'ng, whether it's a DNS thing or not on the proxy's end, I think it's probably more helpful to the user to say "The proxy doesn't like you. Take it up with your proxy admin." than to say "Maybe you typed in the address wrong."
Without the RFC reference, I would have assumed the same about 400, tbh. With it there though, no really committed either way.
>+ case 502: // HTTP/1.1: "Bad Gateway" (invalid resp from target server)
>+ // Squid returns 503 if target request fails for anything but DNS.
>+ case 503: // HTTP/1.1: "Service Unavailable"
>+ /\* User sees: "Failed to Connect:
>+ \* Firefox can't establish a connection to the server at
>+ \* www.foo.com. Though the site seems valid, the browser
>+ \* was unable to establish a connection.
>+ \*/
>+ rv = NS\_ERROR\_CONNECTION\_REFUSED;
Fine by me
>+ // RFC 2616 uses 504 for both DNS and target timeout, so not clear what to
>+ // do here: picking target timeout, as DNS covered by 400/404/500
>+ case 504: // HTTP/1.1: "Gateway Timeout"
>+ // user sees: "Network Timeout: The server at www.foo.com
>+ // is taking too long to respond."
>+ rv = NS\_ERROR\_NET\_TIMEOUT;
>+ break;
Yup
>+ // Assume we're being fsck'd with, and give message about scary content.
>+ default:
>+ rv = NS\_ERROR\_UNSAFE\_CONTENT\_TYPE;
>+ }
This message will be a little confusing, but in a scary way so it's probably the best play given that we can't change strings.
This is an improvement over the current state of affairs, so modulo getting your opinion on 500 above, and filing a follow-up to do this with proper strings on trunk, ui-r=me

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=479880#c31)• 16 years ago |
|  | |

> I think I would have expected 500 to go up above, with "Proxy Refused
> Connection". ... I would have assumed the same about 400...
Yeah, I'm basing the treatment of 400 & 500 purely based on the comment in RFC 2616, and who knows if the "already deployed proxies" are still around 10 years later. That said, squid is using 404 for DNS failure, which is at least as dumb as 400/500. I really don't have a strong sense of what to do here, but at least 400/500 errors should be fairly infrequent.
>+ // Assume we're being fsck'd with, and give message about scary content.
>+ default:
>+ rv = NS\_ERROR\_UNSAFE\_CONTENT\_TYPE;
So note that I've changed this in the latest patch to NS\_ERROR\_PROXY\_CONNECTION\_REFUSED. See my reasoning above. Somehow blaming things on an "unsafe file type" seems likely to confuse people, so just a regular "proxy refused" error seems better to me.
> filing a follow-up to do this with proper strings on trunk
I'm not sure what other strings you've got in mind.

|  | [Johnathan Nightingale [:johnath]](/user_profile?user_id=210757) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=479880#c32)• 16 years ago |
|  | |

(In reply to [comment #31](/show_bug.cgi?id=479880#c31 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> > filing a follow-up to do this with proper strings on trunk
>
> I'm not sure what other strings you've got in mind.
If we weren't in a string freeze, I think the way we would have dealt with this would have been to create some new errors, and strings for the error page, instead of recycling existing mostly-similar errors, no?

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=479880#c33)• 16 years ago |
|  | |

I suppose it is worth a look over the exact error text to see if we want to change the text. But they would only need to be fairly minor changes, i.e. instead of "firefox can't find the server at www.foo.com", "your proxy server can't find ...", etc.
But it's probably worth doing. As long as I don't have to be the one who comes up with the actual text :)

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=479880#c34)• 16 years ago |
|  | |

Jason, we have seen the following response codes from proxies:
403: Squid seems to only allow SSL tunnels to certain ports.
If I visit <https://bugzilla.mozilla.org:80/>, Squid responds
with a 403 error page:
ERROR
The requested URL could not be retrieved
While trying to retrieve the URL: bugzilla.mozilla.org:80
The following error was encountered:
\* Access Denied.
Access control configuration prevents your request
from being allowed at this time. Please contact
your service provider if you feel this is incorrect.
404: Squid returns 404 for host not found. Test case is
<https://no.such.host/>
501: An internal proxy we use for testing purposes doesn't
support HTTPS, so it responds with 501 (not implemented)
to tunnel CONNECT requests. Although this proxy is not
generally available, its use of 501 in this case seems
reasonable.

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=479880#c35)• 16 years ago |
|  | |

OK, I think the current patch covers Wan-Teh's cases appropriately. Getting "proxy refused" from a server that doesn't implement SSL tunneling is close enough, in my opinion--there's no other string-frozen message that we've got that's any better.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=479880#c36)• 16 years ago |
|  | |

(In reply to [comment #34](/show_bug.cgi?id=479880#c34 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> 501: An internal proxy we use for testing purposes doesn't
> support HTTPS, so it responds with 501 (not implemented)
> to tunnel CONNECT requests. Although this proxy is not
> generally available, its use of 501 in this case seems
> reasonable.
501 is explicitly sanctioned for this purpose in RFC 2616 section 5.1.1:
An origin server SHOULD return the status code [...] 501
(Not Implemented) if the method is unrecognized or not
implemented by the origin server.

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=479880#c37)• 16 years ago |
|  | |

Comment on [attachment 373182](/attachment.cgi?id=373182 "Incorporate Wan-Teh's changes, plus change default error page") [[details]](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") [[diff]](/attachment.cgi?id=373182&action=diff "Incorporate Wan-Teh's changes, plus change default error page") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373182)
Incorporate Wan-Teh's changes, plus change default error page
>diff --git a/netwerk/protocol/http/src/nsHttpChannel.cpp b/netwerk/protocol/http/src/nsHttpChannel.cpp
> nsHttpChannel::ProcessResponse()
> {
> nsresult rv;
> PRUint32 httpStatus = mResponseHead->Status();
>
> LOG(("nsHttpChannel::ProcessResponse [this=%x httpStatus=%u]\n",
> this, httpStatus));
>
>+ if (mTransaction->SSLConnectFailed() && httpStatus != 407)
>+ return ProcessFailedSSLConnect(httpStatus);
Returning back to my first note in [comment 10](/show_bug.cgi?id=479880#c10 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"), expand this into:
>+ if (mTransaction->SSLConnectFailed() && httpStatus != 407) {
>+ NS\_ABORT\_IF\_FALSE(mConnectionInfo->UsingSSL(),
>+ "SSL connect failed but not using SSL?");
>+ return ProcessFailedSSLConnect(httpStatus);
>+ }
as a sanity check -- inspection shows the guard isn't necessary, but if we're going to rely on the invariant we should enforce it in debug builds to be safe.
Looks good with that change.
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: review?(jwalden+bmo) → review+

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=479880#c38)• 16 years ago |
|  | |

Attached patch

[Add sanity check to ensure SSL is being used](attachment.cgi?id=373419&action=diff)
— [Details](attachment.cgi?id=373419&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373419)

ProcessFailedSSLConnect is called in two places, and should only ever be called if SSL is being used, so I put the UsingSSL() check at the top of the function.
Skipping UI review, since that hasn't changed from the last patch.
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Attachment is obsolete: true
[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: superreview?(cbiesinger)
[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: review?(jwalden+bmo)
[Attachment #373182](/attachment.cgi?id=373182&action=edit "Incorporate Wan-Teh's changes, plus change default error page") -
Flags: superreview?(cbiesinger)

|  | [Jeff Walden [:Waldo]](/user_profile?user_id=83595) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a4589009_83595)• 16 years ago |

[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: review?(jwalden+bmo) → review+

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=479880#c39)• 16 years ago |
|  | |

Marking this a P2 blocker per discussion with beltzner. Sam (and others), this exploit will be made public on 5/16/2009, we should coordinate landing this in the relevant releases.Flags: blocking1.9.1+Flags: blocking1.9.0.10?Priority: -- → P2Target Milestone: --- → mozilla1.9.1

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=479880#c40)• 16 years ago |
|  | |

Thanks for the heads up. We probably need to block 1.9.0.10 on this. As it stands, we're targeting a May 19 ship date, but I'll talk with Dan about whether this means we need to fix it sooner.Flags: wanted1.9.0.x+Flags: blocking1.9.0.10?Flags: blocking1.9.0.10+

|  | [Reed Loden [:reed]](/user_profile?user_id=159758) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=479880#c41)• 16 years ago |
|  | |

(In reply to [comment #39](/show_bug.cgi?id=479880#c39 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> Marking this a P2 blocker per discussion with beltzner. Sam (and others), this
> exploit will be made public on 5/16/2009, we should coordinate landing this in
> the relevant releases.
5/16 or 5/19? Previous comments from Adam say 5/19.

|  | [Adam Barth](/user_profile?user_id=284575)  Reporter |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=479880#c42)• 16 years ago |
|  | |

Here is what Shou said:
"MSR has told them that the information will become public on May 19th"
Where, I think, "them" is the IE product team. Presumably MS will patch their version of this issue on 5/12 "patch Tuesday."

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=479880#c43)• 16 years ago |
|  | |

Yeah, 5/19, my bad.

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=479880#c44)• 16 years ago |
|  | |

FYI: if we ever want to get smarter about how we reply, it sounds like [Bug 482874](/show_bug.cgi?id=482874 "NEW - Provide a friendlier/more useful alternative when the user encounters a 404 error page.") is tackling some of the same issues for 404 pages.Priority: P2 → --Target Milestone: mozilla1.9.1 → ---

|  | [Johnny Stenback (:jst)](/user_profile?user_id=12352) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a5000372_12352)• 16 years ago |

Priority: -- → P2Target Milestone: --- → mozilla1.9.1

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a5077155_334931)• 16 years ago |

[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: superreview?(cbiesinger) → superreview?(bzbarsky)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=479880#c45)• 16 years ago |
|  | |

This should have a unit test for 1.9.0 and 1.9.1. Can we get one?

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=479880#c46)• 16 years ago |
|  | |

This blocks the, now firedrill, 1.9.0.10 release.Flags: blocking1.9.0.10+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a5083651_20209)• 16 years ago |

[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: superreview?(bzbarsky) → superreview+

|  | [Samuel Sidler (old account; do not CC)](/user_profile?user_id=190622) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=479880#c47)• 16 years ago |
|  | |

Comment on [attachment 373419](/attachment.cgi?id=373419 "Add sanity check to ensure SSL is being used") [[details]](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") [[diff]](/attachment.cgi?id=373419&action=diff "Add sanity check to ensure SSL is being used") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=373419)
Add sanity check to ensure SSL is being used
Approved for 1.9.0.10 and 1.9.0.11. a=ss
Please land on 1.9.0 as well as on GECKO190\_20090406\_RELBRANCH.
[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: approval1.9.0.11+
[Attachment #373419](/attachment.cgi?id=373419&action=edit "Add sanity check to ensure SSL is being used") -
Flags: approval1.9.0.10+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=479880#c48)• 16 years ago |
|  | |

Attached patch

[Diff that applies to 1.9.0 branch](attachment.cgi?id=374317&action=diff)
— [Details](attachment.cgi?id=374317&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=374317)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=479880#c49)• 16 years ago |
|  | |

Checking in netwerk/protocol/http/src/nsHttpChannel.h;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.h,v <-- nsHttpChannel.h
new revision: 1.98; previous revision: 1.97
done
Checking in netwerk/protocol/http/src/nsHttpChannel.cpp;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.cpp,v <-- nsHttpChannel.cpp
new revision: 1.337; previous revision: 1.336
done
Checking in netwerk/protocol/http/src/nsHttpChannel.h;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.h,v <-- nsHttpChannel.h
new revision: 1.97.10.1; previous revision: 1.97
done
Checking in netwerk/protocol/http/src/nsHttpChannel.cpp;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.cpp,v <-- nsHttpChannel.cpp
new revision: 1.336.6.1; previous revision: 1.336
doneKeywords: [fixed1.9.0.10](/buglist.cgi?keywords=fixed1.9.0.10&resolution=---),
[fixed1.9.0.11](/buglist.cgi?keywords=fixed1.9.0.11&resolution=---)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=479880#c50)• 16 years ago |
|  | |

Pushed <http://hg.mozilla.org/mozilla-central/rev/72fd3bd01cbc>
This still needs tests, right?Status: ASSIGNED → RESOLVEDClosed: 16 years agoFlags: in-testsuite?Resolution: --- → FIXED

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=479880#c51)• 16 years ago |
|  | |

Pushed <http://hg.mozilla.org/releases/mozilla-1.9.1/rev/3ce32b4b2493>Keywords: [fixed1.9.1](/buglist.cgi?keywords=fixed1.9.1&resolution=---)

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=479880#c52)• 16 years ago |
|  | |

> This should have a unit test for 1.9.0 and 1.9.1. Can we get one?
Not right away. Waldo tells me we'll need some httpd.js changes to support
testing this. And it'll be a lot of work to test a fairly simple patch.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=479880#c53)• 16 years ago |
|  | |

Testing this with the two manual tests, the behavior looks fixed with the original test but I notice no difference in behavior with the second test between 1.9.0.9 and 1.9.0.10. They act in the same manner (both getting a prompt for a username and password).
This was tested on OS X 10.5.6 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.10) Gecko/2009042315 Firefox/3.0.10.

|  | [Wan-Teh Chang](/user_profile?user_id=1584) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=479880#c54)• 16 years ago |
|  | |

Al: for the second test, you need to cancel the username/password
prompt and see what happens. With the fix, you should not see an
error page from the proxy server.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=479880#c55)• 16 years ago |
|  | |

Thanks, Wan-Teh. I tested that and you do not receive the evil error page with 1.9.0.10 (and do with 1.9.0.9).Keywords: [fixed1.9.0.10](/buglist.cgi?keywords=fixed1.9.0.10&resolution=---) → [verified1.9.0.10](/buglist.cgi?keywords=verified1.9.0.10&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=479880#c56)• 16 years ago |
|  | |

Verified fixed in 1.9.0.11 with Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11pre) Gecko/2009051111 GranParadiso/3.0.11pre using existing testcases.Keywords: [fixed1.9.0.11](/buglist.cgi?keywords=fixed1.9.0.11&resolution=---) → [verified1.9.0.11](/buglist.cgi?keywords=verified1.9.0.11&resolution=---)

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=479880#c57)• 16 years ago |
|  | |

We've got a bug that seems likely to be a result of this fix:
[https://bugzilla.mozilla.org/show\_bug.cgi?id=491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page")
They've got a setup where their proxy redirects unauthorized users to a login page (rather than using the std 407 auth prompt).
The issue: do we have a way to honor a redirect without parsing any page content that the redirect contains? That's what we need in order to make this style of redirect work w/o opening back up the security hole.Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a6741646_334931)• 16 years ago |

Blocks: [491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page")

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=479880#c58)• 16 years ago |
|  | |

> We've got a bug that seems likely to be a result of this fix:
That's the place to fix that issue, then. Please don't reopen bugs unless the patch is actually backed out.Status: REOPENED → RESOLVEDClosed: 16 years ago → 16 years agoResolution: --- → FIXED

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a6744365_1689)• 16 years ago |

No longer blocks: [491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page")Depends on: [491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page")

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a8040312_334931)• 16 years ago |

Depends on: [493699](/show_bug.cgi?id=493699 "RESOLVED WONTFIX - Firefox display \"Proxy Server Refused Connection\" instead of custom error page when connect to HTTPS site which blocked by proxy server")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=479880#c59)• 16 years ago |
|  | |

Jason: Please attach a 1.8-branch version of this fix for Thunderbird2 and SeaMonkey.Group: core-securityFlags: wanted1.8.1.x+Flags: blocking1.8.1.next+

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=479880#c60)• 16 years ago |
|  | |

Attached patch

[Patch for 1.8 branch](attachment.cgi?id=380256&action=diff)
— [Details](attachment.cgi?id=380256&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=380256)

[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: superreview?(bzbarsky)
[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: review?(bzbarsky)

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=479880#c61)• 16 years ago |
|  | |

Comment on [attachment 380256](/attachment.cgi?id=380256 "Patch for 1.8 branch") [[details]](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") [[diff]](/attachment.cgi?id=380256&action=diff "Patch for 1.8 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=380256)
Patch for 1.8 branch
Note: This doesn't include the fix for [bug 491818](/show_bug.cgi?id=491818 "RESOLVED WONTFIX - FF does not follow browser redirection to Proxy Login page"), so redirects are not going to work.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=479880#c62)• 16 years ago |
|  | |

The paper about this bug is available at
<http://research.microsoft.com/apps/pubs/default.aspx?id=79323>URL: [http://research.microsoft.com/apps/pu...](http://research.microsoft.com/apps/pubs/default.aspx?id=79323)

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Comment 63](/show_bug.cgi?id=479880#c63)• 16 years ago |
|  | |

We need to backport that fix too; your call on whether you prefer to do it separately or want to roll it in.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 64](/show_bug.cgi?id=479880#c64)• 16 years ago |
|  | |

Comment on [attachment 380256](/attachment.cgi?id=380256 "Patch for 1.8 branch") [[details]](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") [[diff]](/attachment.cgi?id=380256&action=diff "Patch for 1.8 branch") [[review]](/page.cgi?id=splinter.html&ignore=&bug=479880&attachment=380256)
Patch for 1.8 branch
Assuming bz's review (please wait for that), approved for 1.8.1.22, a=dveditz for release-drivers
[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: approval1.8.1.next+

|  | [Boris Zbarsky [:bzbarsky]](/user_profile?user_id=20209) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a8461585_20209)• 16 years ago |

[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: superreview?(bzbarsky)
[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: superreview+
[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: review?(bzbarsky)
[Attachment #380256](/attachment.cgi?id=380256&action=edit "Patch for 1.8 branch") -
Flags: review+

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 65](/show_bug.cgi?id=479880#c65)• 16 years ago |
|  | |

Patch checked into the 1.8(.1) branch
Checking in netwerk/protocol/http/src/nsHttpChannel.cpp;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.cpp,v <-- nsHttpChannel.cpp
new revision: 1.256.2.23; previous revision: 1.256.2.22
done
Checking in netwerk/protocol/http/src/nsHttpChannel.h;
/cvsroot/mozilla/netwerk/protocol/http/src/nsHttpChannel.h,v <-- nsHttpChannel.h
new revision: 1.70.4.6; previous revision: 1.70.4.5
doneKeywords: [fixed1.8.1.22](/buglist.cgi?keywords=fixed1.8.1.22&resolution=---)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 66](/show_bug.cgi?id=479880#c66)• 16 years ago |
|  | |

Is this behavior Firefox specific?
When testing with 1.8.1 Seamonkey, I see no difference between last night's build and the last shipped Seamonkey (1.1.16). In both instances, the alert, which contains cookie information when this is unpatched, is empty.
Unfortunately, I just checked this in Firefox 3.0.10 and 3.0.11 again on OS X and, for some reason, the 3.0.11 build 2 is exhibiting the bug. With both of the testcases here, the alert is showing cookie information.
I went back to the May 11 build that I verified with (Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11pre) Gecko/2009051104 GranParadiso/3.0.11pre) and it \*is\* fixed there. Something reverted the fix.
I'm not sure if something somehow reverted or

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 67](/show_bug.cgi?id=479880#c67)• 16 years ago |
|  | |

(Ignore the last line above. Bad editing.)

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 68](/show_bug.cgi?id=479880#c68)• 16 years ago |
|  | |

This is still fixed on the 1.9.1 nightly.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 69](/show_bug.cgi?id=479880#c69)• 16 years ago |
|  | |

When I check in any 1.9.0 nightly from 5/11 through 6/4, the bug IS fixed.
When I check in Firefox 3.0.10 release and 3.0.11 build 2 (the current build), the cookie information is shown in the alerts.
I'm utterly baffled here.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 70](/show_bug.cgi?id=479880#c70)• 16 years ago |
|  | |

With 3.0.10:
$ nc -l 8080 < resp
GET <http://en-us.start2.mozilla.com/firefox?client=firefox-a&rls=org.mozilla:en-US:official> HTTP/1.1
Host: en-us.start2.mozilla.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.10) Gecko/2009042315 Firefox/3.0.10
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive
Cookie: \_\_utma=183859642.770291850.1244137527.1244137527.1244137527.1; \_\_utmz=183859642.1244137527.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none); s\_vi=[CS]v1|4A280836000043CA-A02081B000000C1[CE]
$ nc -l 8080 < evil\_407\_SSL\_proxy.reply
GET <http://en-us.start2.mozilla.com/firefox?client=firefox-a&rls=org.mozilla:en-US:official> HTTP/1.1
Host: en-us.start2.mozilla.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.10) Gecko/2009042315 Firefox/3.0.10
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive
Cookie: \_\_utma=183859642.770291850.1244137527.1244137527.1244137527.1; \_\_utmz=183859642.1244137527.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none); s\_vi=[CS]v1|4A280836000043CA-A02081B000000C1[CE]
With 3.0.11:
ABillings-Laptop:Desktop abillings$ nc -l 8080 < resp
GET <http://en-us.start2.mozilla.com/firefox?client=firefox-a&rls=org.mozilla:en-US:official> HTTP/1.1
Host: en-us.start2.mozilla.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11) Gecko/2009060214 Firefox/3.0.11
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive
Cookie: \_\_utma=183859642.770291850.1244137527.1244137527.1244137527.1; \_\_utmz=183859642.1244137527.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none); s\_vi=[CS]v1|4A280836000043CA-A02081B000000C1[CE]
ABillings-Laptop:Desktop abillings$ nc -l 8080 < evil\_407\_SSL\_proxy.reply
GET <http://en-us.start2.mozilla.com/firefox?client=firefox-a&rls=org.mozilla:en-US:official> HTTP/1.1
Host: en-us.start2.mozilla.com
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11) Gecko/2009060214 Firefox/3.0.11
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive
Cookie: \_\_utma=183859642.770291850.1244137527.1244137527.1244137527.1; \_\_utmz=183859642.1244137527.1.1.utmccn=(direct)|utmcsr=(direct)|utmcmd=(none); s\_vi=[CS]v1|4A280836000043CA-A02081B000000C1[CE]
with nightly 1.9.0 build:
ABillings-Laptop:Desktop abillings$ nc -l 8080 < evil\_407\_SSL\_proxy.reply
GET <http://www.mozilla.org/projects/granparadiso/> HTTP/1.1
Host: www.mozilla.org
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.12pre) Gecko/2009060404 GranParadiso/3.0.12pre
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive
ABillings-Laptop:Desktop abillings$ nc -l 8080 < resp
GET <http://www.mozilla.org/projects/granparadiso/> HTTP/1.1
Host: www.mozilla.org
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.12pre) Gecko/2009060404 GranParadiso/3.0.12pre
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,\*/\*;q=0.8
Accept-Language: en-us,en;q=0.5
Accept-Encoding: gzip,deflate
Accept-Charset: ISO-8859-1,utf-8;q=0.7,\*;q=0.7
Keep-Alive: 300
Proxy-Connection: keep-alive

|  | [Jason Duell](/user_profile?user_id=334931)  Assignee |  |
| --- | --- | --- |
| [Comment 71](/show_bug.cgi?id=479880#c71)• 16 years ago |
|  | |

You're testing with HTTP, but this fix is only for HTTPS :) Also note that the correct behavior is to see NO alert, so even seeing an empty alert is a test failure.
I just tested the 3.0.10 release (OSX) and the 3.0.11 build 2 for OSX from here
ftp://ftp.mozilla.org/pub/firefox/nightly/3.0.11-candidates/build2/
It works fine, i.e. I get the boilerplate "proxy refused" page, with no
alert popup of any kind.

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 72](/show_bug.cgi?id=479880#c72)• 16 years ago |
|  | |

doh, httpS. \*sigh\*
I feel stupid now.
Yes, it works correctly with https in 3.0.11 build 2:
ABillings-Laptop:Desktop abillings$ nc -l 8080 < resp
CONNECT www.paypal.com:443 HTTP/1.1
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11) Gecko/2009060214 Firefox/3.0.11
Proxy-Connection: keep-alive
Host: www.paypal.com
ABillings-Laptop:Desktop abillings$ nc -l 8080 < evil\_407\_SSL\_proxy.reply
CONNECT www.paypal.com:443 HTTP/1.1
User-Agent: Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.5; en-US; rv:1.9.0.11) Gecko/2009060214 Firefox/3.0.11
Proxy-Connection: keep-alive
Host: www.paypal.com

|  | [Al Billings [:abillings - ex-MoCo]](/user_profile?user_id=280903) |  |
| --- | --- | --- |
| [Comment 73](/show_bug.cgi?id=479880#c73)• 16 years ago |
|  | |

Verified for 1.8.1.22 with Seamonkey (Mozilla/5.0 (Macintosh; U; Intel Mac OS X; en-US; rv:1.8.1.22pre) Gecko/20090604 SeaMonkey/1.1.17pre) as well.Keywords: [fixed1.8.1.22](/buglist.cgi?keywords=fixed1.8.1.22&resolution=---) → [verified1.8.1.22](/buglist.cgi?keywords=verified1.8.1.22&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a9327672_1689)• 16 years ago |

Alias: CVE-2009-1836

|  | [Henrik Skupin [:whimboo][⌚️UTC+2]](/user_profile?user_id=76551) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=479880#a9513588_76551)• 16 years ago |

Target Milestone: mozilla1.9.1 → mozilla1.9.2a1

|  | [Tomas Hoger](/user_profile?user_id=343623) |  |
| --- | --- | --- |
| [Comment 74](/show_bug.cgi?id=479880#c74)• 16 years ago |
|  | |

For the record - [CVE-2009-2061](https://www.cve.org/CVERecord?id=CVE-2009-2061) was assigned to the redirect / III.B attack described in the paper:
Mozilla Firefox before 3.0.10 processes a 3xx HTTP CONNECT response
before a successful SSL handshake, which allows man-in-the-middle
attackers to execute arbitrary web script, in an https site's context,
by modifying this CONNECT response to specify a 302 redirect to an
arbitrary https web site.
Also [CVE-2009-2065](https://www.cve.org/CVERecord?id=CVE-2009-2065) for III.C (is there a separate bug for that)?

|  | [Henrik Nordstrom](/user_profile?user_id=97500) |  |
| --- | --- | --- |
| [Comment 75](/show_bug.cgi?id=479880#c75)• 16 years ago |
|  | |

Sorry for the late response, but I wasn't aware of this discussion before today.
This change will cause major headache for users behind proxies and the administators of those proxies. The proxy error messages often do contain important information the user is supposed to see. Replacing these messages with general boilerplate messages is not a good idea. We have already seen this with MSIE for a long time (all protocols) and it's a very frequent problem cause from a usability perspective.
Error messages from proxies is not only the dull standard technical messages which has been partially quoted here, but also notifications when the user accesses content he is not allowed to access, terms of use etc.
And even for the technical error messages such as "connection failed" "host not found" etc the error message as such is important in tracking down the error cause. Doing a string search to identify these will not work out well as the error messages is often localized or even replaced entirely with custom site-specific messages.
But I do understand the very valid concerns about phising. I have however a proposal along the lines of Jason comment earlier.
\* Before rendering the response, pop up an error notification dialog, similar to the certificate error dialog, requiring user action before showing the content.
\* When rendering the content, make sure to render the content in a different context blocking any access to cookies etc. I.e. render the content with a different internal requested-URI.
\* When following any links from this content, DON'T use the originilal requested-URI in Referer. Using the internally generated dummy URI mentioned above is fine (assuming it does not contain user specific details), or none at all.
\* Try to block any active content / plugins from being used in rendering the response.
Regarding 407 responses the auth dialog needs to be handled as usual, even for NTLM/Negotiate authentication. Which means the connection as such isn't considered broken. If the user cancels the auth dialog to render the error message then start at the top of the list above.

|  | [Alex Smirnoff](/user_profile?user_id=362535) |  |
| --- | --- | --- |
| [Comment 76](/show_bug.cgi?id=479880#c76)• 15 years ago |
|  | |

I strongly agree. It is not resolved nor fixed in its current state.
I have a proxy that provides detailed certificate status information in error messages and now Firefox just drops it completely.
(In reply to [comment #75](/show_bug.cgi?id=479880#c75 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> Sorry for the late response, but I wasn't aware of this discussion before
> today.
>
> This change will cause major headache for users behind proxies and the
> administators of those proxies. The proxy error messages often do contain
> important information the user is supposed to see. Replacing these messages
> with general boilerplate messages is not a good idea. We have already seen this
> with MSIE for a long time (all protocols) and it's a very frequent problem
> cause from a usability perspective.
>
> Error messages from proxies is not only the dull standard technical messages
> which has been partially quoted here, but also notifications when the user
> accesses content he is not allowed to access, terms of use etc.
>
> And even for the technical error messages such as "connection failed" "host not
> found" etc the error message as such is important in tracking down the error
> cause. Doing a string search to identify these will not work out well as the
> error messages is often localized or even replaced entirely with custom
> site-specific messages.
>
> But I do understand the very valid concerns about phising. I have however a
> proposal along the lines of Jason comment earlier.
>
> \* Before rendering the response, pop up an error notification dialog, similar
> to the certificate error dialog, requiring user action before showing the
> content.
>
> \* When rendering the content, make sure to render the content in a different
> context blocking any access to cookies etc. I.e. render the content with a
> different internal requested-URI.
>
> \* When following any links from this content, DON'T use the originilal
> requested-URI in Referer. Using the internally generated dummy URI mentioned
> above is fine (assuming it does not contain user specific details), or none at
> all.
>
> \* Try to block any active content / plugins from being used in rendering the
> response.
>
> Regarding 407 responses the auth dialog needs to be handled as usual, even for
> NTLM/Negotiate authentication. Which means the connection as such isn't
> considered broken. If the user cancels the auth dialog to render the error
> message then start at the top of the list above.

|  | [Alex Smirnoff](/user_profile?user_id=362535) |  |
| --- | --- | --- |
| [Comment 77](/show_bug.cgi?id=479880#c77)• 15 years ago |
|  | |

(oops, sorry for overquoting, just pressed "submit" too early)

|  | [Mike Hommey [:glandium]](/user_profile?user_id=47192) |  |
| --- | --- | --- |
| [Comment 78](/show_bug.cgi?id=479880#c78)• 15 years ago |
|  | |

(In reply to [comment #74](/show_bug.cgi?id=479880#c74 "RESOLVED FIXED - Non-200 responses to proxy CONNECT requests lead to attacks on HTTPS"))
> For the record - [CVE-2009-2061](https://www.cve.org/CVERecord?id=CVE-2009-2061) was assigned to the redirect / III.B attack
> described in the paper:
>
> Mozilla Firefox before 3.0.10 processes a 3xx HTTP CONNECT response
> before a successful SSL handshake, which allows man-in-the-middle
> attackers to execute arbitrary web script, in an https site's context,
> by modifying this CONNECT response to specify a 302 redirect to an
> arbitrary https web site.
It looks to me like this CVE is fixed by this bug. Shouldn't the CVE be updated ?

|  | [Steve Snodgrass](/user_profile?user_id=145698) |  |
| --- | --- | --- |
| [Comment 79](/show_bug.cgi?id=479880#c79)• 15 years ago |
|  | |

I realize that I'm way late to the party here, but I want to echo what Henrik and Alex said - this fix is terrible for proxy admins (myself included). Our proxy returns a 403 forbidden for filtered SSL content and an error page about why the content is blocked, and Firefox just drops all of it on the floor. :(

|  | [Nicolas Mailhot](/user_profile?user_id=84105) |  |
| --- | --- | --- |
| [Comment 80](/show_bug.cgi?id=479880#c80)• 13 years ago |
|  | |

To fix the unfortunate situation this bug created for proxy and captive portals users, Firefox should ad handling of
HTTP error 511 Network Authentication Required
as soon as possible
(see [bug #728658](/show_bug.cgi?id=728658 "RESOLVED WONTFIX - Handle HTTP error 511 Network Authentication Required (RFC 6585: standard secure proxy authentification/captive portal detection)"))
You need to [log in](/show_bug.cgi?id=479880&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Adam Barth](/user_profile?user_id=284575)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from sites.google.com_51a73a06_20250125_182942.html ===

# Sign in

Use your Google AccountEmail or phoneForgot email?![CAPTCHA image of text used to distinguish humans from robots]()Type the text you hear or seeNot your computer? Use Guest mode to sign in privately. [Learn more about using Guest mode](https://support.google.com/chrome/answer/6130773?hl=en-US)NextCreate account

=== Content from src.chromium.org_c7a853e0_20250125_182942.html ===


This site used to contain a view of the SVN repo used in the early days of Chromium.

Full commit history for Chromium can now be found at
[https://chromium.googlesource.com/chromium/src/+/refs/heads/main](https://chromium.googlesource.com/chromium/src/%2B/refs/heads/main).

For any questions or concerns, please file a bug under the
[Infra>SDK](https://issues.chromium.org/issues/new?noWizard=true&component=1456102) component.



=== Content from research.microsoft.com_a2d01b86_20250125_182937.html ===


![]()

Skip to main content

[![](https://img-prod-cms-rt-microsoft-com.akamaized.net/cms/api/am/imageFileData/RE1Mu3b?ver=5c31)
Microsoft](https://www.microsoft.com)

Research

[Research](/en-us/research/)

Research

* [Home](/en-us/research/)
* Our research
  + Resources
    Resources
    - [Publications](/en-us/research/publications/)
    - [Code & data](/en-us/research/tools/)
    - [People](/en-us/research/people/)
    - [Microsoft Research blog](/en-us/research/blog/)
  + Research areas: Intelligence
    Research areas: Intelligence
    - [Artificial intelligence](/en-us/research/focus-area/ai-and-microsoft-research/)
    - [Audio & acoustics](/en-us/research/research-area/audio-acoustics/)
    - [Computer vision](/en-us/research/research-area/computer-vision/)
    - [Graphics & multimedia](/en-us/research/research-area/graphics-and-multimedia/)
    - [Human-computer interaction](/en-us/research/research-area/human-computer-interaction/)
    - [Human language technologies](/en-us/research/research-area/human-language-technologies/)
    - [Search & information retrieval](/en-us/research/research-area/search-information-retrieval/)
  + Research areas: Systems
    Research areas: Systems
    - [Data platforms and analytics](/en-us/research/research-area/data-platform-analytics/)
    - [Hardware & devices](/en-us/research/research-area/hardware-devices/)
    - [Programming languages & software engineering](/en-us/research/research-area/programming-languages-software-engineering/)
    - [Quantum computing](/en-us/research/research-area/quantum/)
    - [Security, privacy & cryptography](/en-us/research/research-area/security-privacy-cryptography/)
    - [Systems & networking](/en-us/research/research-area/systems-and-networking/)
  + Research areas: Theory
    Research areas: Theory
    - [Algorithms](/en-us/research/research-area/algorithms/)
    - [Mathematics](/en-us/research/research-area/computational-sciences-mathematics/)
  + Research areas: Other Sciences
    Research areas: Other Sciences
    - [Ecology & environment](/en-us/research/research-area/ecology-environment/)
    - [Economics](/en-us/research/research-area/economics/)
    - [Medical, health & genomics](/en-us/research/research-area/medical-health-genomics/)
    - [Social sciences](/en-us/research/research-area/social-sciences/)
    - [Technology for emerging markets](/en-us/research/research-area/technology-for-emerging-markets/)
* Programs & events
  + [Academic programs](/en-us/research/academic-programs/)
  + [Events & academic conferences](/en-us/research/events-conferences/)
  + [Microsoft Research Forum](https://researchforum.microsoft.com)
* Connect & learn
  + [Behind the Tech podcast](https://www.microsoft.com/en-us/behind-the-tech%20)
  + [Microsoft Research blog](/en-us/research/blog)
  + [Microsoft Research Forum](https://researchforum.microsoft.com)
  + [Microsoft Research podcast](/en-us/research/podcast/)
* About
  + People & news
    People & news
    - [About Microsoft Research](/en-us/research/about-microsoft-research/)
    - [Careers & internships](/en-us/research/careers/)
    - [People](/en-us/research/people/)
    - [Emeritus program](/en-us/research/microsoft-research-emeritus-program/)
    - [News & awards](/en-us/research/news-and-awards/)
    - [Microsoft Research newsletter](https://info.microsoft.com/ww-landing-microsoft-research-newsletter.html?wt.mc_id=S-webpage_msr-homepage)
  + Microsoft Research Labs
    Microsoft Research Labs
    - [Africa](/en-us/research/lab/microsoft-research-lab-africa-nairobi/)
    - [AI for Science](/en-us/research/lab/microsoft-research-ai-for-science/)
    - [AI Frontiers](/en-us/research/lab/ai-frontiers/)
    - [Asia-Pacific](/en-us/research/lab/microsoft-research-asia/)
    - [Cambridge](/en-us/research/lab/microsoft-research-cambridge/)
    - [Health Futures](/en-us/research/lab/microsoft-health-futures/)
    - [India](/en-us/research/lab/microsoft-research-india/)
    - [Montreal](/en-us/research/lab/microsoft-research-montreal/)
    - [New England](/en-us/research/lab/microsoft-research-new-england/)
    - [New York City](/en-us/research/lab/microsoft-research-new-york/)
    - [Redmond](/en-us/research/lab/microsoft-research-redmond/)
  + Other labs
    Other labs
    - [Applied Sciences](/en-us/research/lab/applied-sciences-group/)
    - [Mixed Reality & AI - Cambridge](/en-us/research/lab/mixed-reality-ai-lab-cambridge/)
    - [Mixed Reality & AI - Zurich](/en-us/research/lab/mixed-reality-ai-zurich/)
* More
* [Register: Research Forum](https://researchforum.microsoft.com)

* All Microsoft
  + ## Global

    - [Microsoft Security](https://www.microsoft.com/en-us/security)
    - [Azure](https://azure.microsoft.com/en-us/)
    - [Dynamics 365](https://dynamics.microsoft.com/en-us/)
    - [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365/business/)
    - [Microsoft Teams](https://www.microsoft.com/en-us/microsoft-teams/group-chat-software)
    - [Windows 365](https://www.microsoft.com/en-us/windows-365)
  + Tech & innovation
    Tech & innovation
    - [Microsoft Cloud](https://www.microsoft.com/en-us/microsoft-cloud)
    - [AI](https://www.microsoft.com/en-us/ai)
    - [Azure Space](https://azure.microsoft.com/en-us/solutions/space/)
    - [Mixed reality](https://www.microsoft.com/en-us/mixed-reality/windows-mixed-reality)
    - [Microsoft HoloLens](https://www.microsoft.com/en-us/hololens)
    - [Microsoft Viva](https://www.microsoft.com/en-us/microsoft-viva)
    - [Quantum computing](https://azure.microsoft.com/en-us/solutions/quantum-computing/)
    - [Sustainability](https://www.microsoft.com/en-us/sustainability/)
  + Industries
    Industries
    - [Education](https://www.microsoft.com/en-us/education)
    - [Automotive](https://www.microsoft.com/en-us/industry/automotive)
    - [Financial services](https://www.microsoft.com/en-us/industry/financial-services/banking)
    - [Government](https://www.microsoft.com/en-us/industry/government)
    - [Healthcare](https://www.microsoft.com/en-us/industry/health/microsoft-cloud-for-healthcare)
    - [Manufacturing](https://www.microsoft.com/en-us/industry/manufacturing/microsoft-cloud-for-manufacturing)
    - [Retail](https://www.microsoft.com/en-us/industry/consumer-goods)
    - [All industries](https://www.microsoft.com/en-us/industry)
  + Partners
    Partners
    - [Find a partner](https://partner.microsoft.com/en-US/)
    - [Become a partner](https://partner.microsoft.com/en-US/membership/cloud-solution-provider)
    - [Partner Network](https://partner.microsoft.com/en-us/membership)
    - [Azure Marketplace](https://azuremarketplace.microsoft.com/en-us/)
    - [AppSource](https://appsource.microsoft.com/en-us/)
  + Resources
    Resources
    - [Blog](https://blogs.microsoft.com/)
    - [Microsoft Advertising](https://about.ads.microsoft.com/en-us?s_cid=dig-src_uhfcomm)
    - [Developer Center](https://developer.microsoft.com/en-us/)
    - [Documentation](https://learn.microsoft.com/docs/)
    - [Events](https://www.microsoft.com/en-us/events)
    - [Licensing](https://www.microsoft.com/en-us/licensing/)
    - [Microsoft Learn](https://learn.microsoft.com/)
    - [Microsoft Research](https://www.microsoft.com/en-us/research/)
  + [View Sitemap](https://www.microsoft.com/en-us/sitemap)

Search
Search Microsoft Research

* No results

Cancel

# Pretty-Bad-Proxy: An Overlooked Adversary in Browsers’ HTTPS Deployments

* [Shuo Chen](https://www.microsoft.com/en-us/research/people/shuochen/)
  ,
* Ziqing Mao
  ,
* Yi-Min Wang
  ,
* Ming Zhang

***Proceedings of the IEEE Symposium on Security and Privacy (Oakland)***
| May 2009

Published by IEEE Computer Society

[Publication](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/PBP-oakland-public.ppt) | [Publication](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/BillGatesComment2007.txt)

[Download BibTex](https://www.microsoft.com/en-us/research/publication/pretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments/bibtex/)

HTTPS is designed to provide secure web communications over insecure networks. The protocol itself has been rigorously designed and evaluated by assuming the network as an adversary. This paper is motivated by our curiosity about whether such an adversary has been carefully examined when HTTPS is integrated into the browser/web systems. We focus on a specific adversary named “Pretty-Bad-Proxy” (PBP). PBP is a malicious proxy targeting browsers’ rendering modules above the HTTP/HTTPS layer. It attempts to break the end-to-end security guarantees of HTTPS without breaking any cryptographic scheme. We discovered a set of vulnerabilities exploitable by a PBP: in many realistic network environments where attackers can sniff the browser traffic, they can steal sensitive data from an HTTPS server, fake an HTTPS page and impersonate an authenticated user to access an HTTPS server. These vulnerabilities reflect the neglects in the design of modern browsers – they affect all major browsers and a large number of websites. We believe that the PBP adversary has not been rigorously examined in the browser/web industry. The vendors of the affected browsers have all confirmed the vulnerabilities reported in this paper. Most of them have patched or planned on patching their browsers. We believe the attack scenarios described in this paper may only be a subset of the vulnerabilities under PBP. Thus further (and more rigorous) evaluations of the HTTPS deployments in browsers appear to be necessary.

Opens in a new tab

Copyright © 2007 IEEE. Reprinted from IEEE Computer Society.This material is posted here with permission of the IEEE. Internal or personal use of this material is permitted. However, permission to reprint/republish this material for advertising or promotional purposes or for creating new collective works for resale or redistribution must be obtained from the IEEE by writing to pubs-permissions@ieee.org.By choosing to view this document, you agree to all provisions of the copyright laws protecting it.

[Publication](https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/pbp-final-with-update.pdf)
## Groups

* [Networking Research Group](https://www.microsoft.com/en-us/research/group/networking-research/)

## Research Areas

* [Security, privacy, and cryptography](https://www.microsoft.com/en-us/research/research-area/security-privacy-cryptography/)
* [Systems and networking](https://www.microsoft.com/en-us/research/research-area/systems-and-networking/)

Follow us:

* [Follow on X](https://x.com/intent/follow?original_referrer=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2Fpublication%2Fpretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments%2F&screen_name=MSFTResearch)
* [Like on Facebook](https://www.facebook.com/microsoftresearch/)
* [Follow on LinkedIn](https://www.linkedin.com/showcase/microsoftresearch/)
* [Subscribe on Youtube](https://www.youtube.com/user/MicrosoftResearch)
* [Follow on Instagram](https://www.instagram.com/msft_research/)
* [Subscribe to our RSS feed](https://www.microsoft.com/en-us/research/feed/)

Share this page:

* [Share on X](https://x.com/intent/tweet?text=Pretty-Bad-Proxy%3A%20An%20Overlooked%20Adversary%20in%20Browsers%26%238217%3B%20HTTPS%20Deployments&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2Fpublication%2Fpretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments%2F)
* [Share on Facebook](https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2Fpublication%2Fpretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments%2F)
* [Share on LinkedIn](https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2Fpublication%2Fpretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments%2F&title=Pretty-Bad-Proxy%3A%20An%20Overlooked%20Adversary%20in%20Browsers%26%238217%3B%20HTTPS%20Deployments&summary=Pretty-Bad-Proxy%3A%20An%20Overlooked%20Adversary%20in%20Browsers%26%238217%3B%20HTTPS%20Deployments&source=Microsoft%20Research)
* [Share on Reddit](http://www.reddit.com/submit?title=Pretty-Bad-Proxy%3A%20An%20Overlooked%20Adversary%20in%20Browsers%26%238217%3B%20HTTPS%20Deployments&url=https%3A%2F%2Fwww.microsoft.com%2Fen-us%2Fresearch%2Fpublication%2Fpretty-bad-proxy-an-overlooked-adversary-in-browsers-https-deployments%2F)

What's new

* [Surface Pro](https://www.microsoft.com/en-us/surface/devices/surface-pro-11th-edition)
* [Surface Laptop](https://www.microsoft.com/en-us/surface/devices/surface-laptop-7th-edition)
* [Surface Laptop Studio 2](https://www.microsoft.com/en-us/d/Surface-Laptop-Studio-2/8rqr54krf1dz)
* [Surface Laptop Go 3](https://www.microsoft.com/en-us/d/Surface-Laptop-Go-3/8p0wwgj6c6l2)
* [Microsoft Copilot](https://www.microsoft.com/en-us/microsoft-copilot)
* [AI in Windows](https://www.microsoft.com/en-us/windows/copilot-ai-features)
* [Explore Microsoft products](https://www.microsoft.com/en-us/microsoft-products-and-apps)
* [Windows 11 apps](https://www.microsoft.com/windows/windows-11-apps)

Microsoft Store

* [Account profile](https://account.microsoft.com/)
* [Download Center](https://www.microsoft.com/en-us/download)
* [Microsoft Store support](https://go.microsoft.com/fwlink/?linkid=2139749)
* [Returns](https://www.microsoft.com/en-us/store/b/returns)
* [Order tracking](https://www.microsoft.com/en-us/store/b/order-tracking)
* [Certified Refurbished](https://www.microsoft.com/en-us/store/b/certified-refurbished-products)
* [Microsoft Store Promise](https://www.microsoft.com/en-us/store/b/why-microsoft-store?icid=footer_why-msft-store_7102020)
* [Flexible Payments](https://www.microsoft.com/en-us/store/b/payment-financing-options?icid=footer_financing_vcc)

Education

* [Microsoft in education](https://www.microsoft.com/en-us/education)
* [Devices for education](https://www.microsoft.com/en-us/education/devices/overview)
* [Microsoft Teams for Education](https://www.microsoft.com/en-us/education/products/teams)
* [Microsoft 365 Education](https://www.microsoft.com/en-us/education/products/microsoft-365)
* [How to buy for your school](https://www.microsoft.com/education/how-to-buy)
* [Educator training and development](https://education.microsoft.com/)
* [Deals for students and parents](https://www.microsoft.com/en-us/store/b/education)
* [Azure for students](https://azure.microsoft.com/en-us/free/students/)

Business

* [Microsoft Cloud](https://www.microsoft.com/en-us/microsoft-cloud)
* [Microsoft Security](https://www.microsoft.com/en-us/security)
* [Dynamics 365](https://www.microsoft.com/en-us/dynamics-365)
* [Microsoft 365](https://www.microsoft.com/en-us/microsoft-365/business)
* [Microsoft Power Platform](https://www.microsoft.com/en-us/power-platform)
* [Microsoft Teams](https://www.microsoft.com/en-us/microsoft-teams/group-chat-software)
* [Microsoft 365 Copilot](https://www.microsoft.com/en-us/microsoft-365/copilot/copilot-for-work)
* [Small Business](https://www.microsoft.com/en-us/store/b/business?icid=CNavBusinessStore)

Developer & IT

* [Azure](https://azure.microsoft.com/en-us/)
* [Microsoft Developer](https://developer.microsoft.com/en-us/)
* [Documentation](https://learn.microsoft.com/docs/)
* [Microsoft Learn](https://learn.microsoft.com/)
* [Microsoft Tech Community](https://techcommunity.microsoft.com/)
* [Azure Marketplace](https://azuremarketplace.microsoft.com/en-us/)
* [AppSource](https://appsource.microsoft.com/en-us/)
* [Visual Studio](https://visualstudio.microsoft.com/)

Company

* [Careers](https://careers.microsoft.com/)
* [About Microsoft](https://www.microsoft.com/about)
* [Company news](https://news.microsoft.com/)
* [Privacy at Microsoft](https://privacy.microsoft.com/en-us)
* [Investors](https://www.microsoft.com/investor/default.aspx)
* [Diversity and inclusion](https://www.microsoft.com/en-us/diversity/)
* [Accessibility](https://www.microsoft.com/en-us/accessibility)
* [Sustainability](https://www.microsoft.com/en-us/sustainability/)

[Your Privacy Choices Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)
[Your Privacy Choices Opt-Out Icon

Your Privacy Choices](https://aka.ms/yourcaliforniaprivacychoices)

[Consumer Health Privacy](https://go.microsoft.com/fwlink/?linkid=2259814)

* [Sitemap](https://www.microsoft.com/en-us/sitemap1.aspx)
* [Contact Microsoft](https://support.microsoft.com/contactus)
* [Privacy](https://go.microsoft.com/fwlink/?LinkId=521839)
* Manage cookies
* [Terms of use](https://go.microsoft.com/fwlink/?LinkID=206977)
* [Trademarks](https://go.microsoft.com/fwlink/?linkid=2196228)
* [Safety & eco](https://go.microsoft.com/fwlink/?linkid=2196227)
* [Recycling](https://www.microsoft.com/en-us/legal/compliance/recycling)
* [About our ads](https://choice.microsoft.com)
* © Microsoft 2025



=== Content from src.chromium.org_80f2f69d_20250125_182942.html ===


This site used to contain a view of the SVN repo used in the early days of Chromium.

Full commit history for Chromium can now be found at
[https://chromium.googlesource.com/chromium/src/+/refs/heads/main](https://chromium.googlesource.com/chromium/src/%2B/refs/heads/main).

For any questions or concerns, please file a bug under the
[Infra>SDK](https://issues.chromium.org/issues/new?noWizard=true&component=1456102) component.


