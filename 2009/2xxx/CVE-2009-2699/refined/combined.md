=== Content from marc.info_54b8882f_20250125_150508.html ===

```
[[prev in list](?l=bugtraq&m=133355430409550&w=2)] [[next in list](?l=bugtraq&m=133355556010105&w=2)] [prev in thread] [next in thread]
List:       [bugtraq](?l=bugtraq&r=1&w=2)
Subject:    [security bulletin] HPSBMU02753 SSRT100782 rev.1 - HP Business Availability Center (BAC) Running Apa
From:       [security-alert () hp ! com](?a=90366096700007&r=1&w=2)
Date:       [2012-04-03 13:20:52](?l=bugtraq&r=1&w=2&b=201204)
Message-ID: [20120403132052.1FDE120448 () security ! hp ! com](?i=20120403132052.1FDE120448%20()%20security%20!%20hp%20!%20com)
[Download RAW [message](?l=bugtraq&m=133355494609819&q=mbox) or [body](?l=bugtraq&m=133355494609819&q=raw)]

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

SUPPORT COMMUNICATION - SECURITY BULLETIN

Document ID: c03236227
Version: 1

HPSBMU02753 SSRT100782 rev.1 - HP Business Availability Center (BAC) Running Apache, \
Remote Execution of Arbitrary Commands, Denial of Service (DoS)

NOTICE: The information in this Security Bulletin should be acted upon as soon as \
possible.

Release Date: 2012-04-02
Last Updated: 2012-04-02

Potential Security Impact: Remote execution of arbitrary commands, Denial of Service \
(DoS)

Source: Hewlett-Packard Company, HP Software Security Response Team

VULNERABILITY SUMMARY
Potential security vulnerabilities have been identified with HP Business Availability \
Center (BAC) running Apache. The vulnerabilities could be remotely exploited to allow \
execution of arbitrary commands or to create a Denial of Service (DoS).

References: CVE-2009-2699, CVE-2009-3094, CVE-2009-3095, CVE-2010-1452

SUPPORTED SOFTWARE VERSIONS*: ONLY impacted versions are listed.
Business Availability Center (BAC) before v8.07 on Windows and Solaris

BACKGROUND

CVSS 2.0 Base Metrics
===========================================================
  Reference              Base Vector             Base Score
CVE-2009-2699    (AV:N/AC:L/Au:N/C:N/I:N/A:P)       5.0
CVE-2009-3094    (AV:N/AC:H/Au:N/C:N/I:N/A:P)       2.6
CVE-2009-3095    (AV:N/AC:L/Au:N/C:P/I:P/A:P)       7.5
CVE-2010-1452    (AV:N/AC:L/Au:N/C:N/I:N/A:P)       5.0
===========================================================
             Information on CVSS is documented
            in HP Customer Notice: HPSN-2008-002

RESOLUTION

HP has made Business Availability Center (BAC) v8.07 available to resolve the \
vulnerabilities.

BAC v8.07 supplies Apache 2.2.17.

HISTORY
Version:1 (rev.1) 2 April 2012 Initial release

Third Party Security Patches: Third party security patches that are to be installed \
on systems running HP software products should be applied in accordance with the \
customer's patch management policy.

Support: For issues about implementing the recommendations of this Security Bulletin, \
contact normal HP Services support channel.  For other issues about the content of \
this Security Bulletin, send e-mail to security-alert@hp.com.

Report: To report a potential security vulnerability with any HP supported product, \
send Email to: security-alert@hp.com

Subscribe: To initiate a subscription to receive future HP Security Bulletin alerts \
via Email: <http://h41183.www4.hp.com/signup_alerts.php?jumpid=hpsc_secbulletins>

Security Bulletin List: A list of HP Security Bulletins, updated periodically, is \
contained in HP Security Notice HPSN-2011-001: \
<https://h20566.www2.hp.com/portal/site/hpsc/public/kb/docDisplay/?docId=emr_na-c02964430>

Security Bulletin Archive: A list of recently released Security Bulletins is \
available here: <http://h20566.www2.hp.com/portal/site/hpsc/public/kb/secBullArchive/>

Software Product Category: The Software Product Category is represented in the title \
by the two characters following HPSB.

3C = 3COM
3P = 3rd Party Software
GN = HP General Software
HF = HP Hardware and Firmware
MP = MPE/iX
MU = Multi-Platform Software
NS = NonStop Servers
OV = OpenVMS
PI = Printing and Imaging
PV = ProCurve
ST = Storage Software
TU = Tru64 UNIX
UX = HP-UX

Copyright 2012 Hewlett-Packard Development Company, L.P.
Hewlett-Packard Company shall not be liable for technical or editorial errors or \
omissions contained herein. The information provided is provided "as is" without \
warranty of any kind. To the extent permitted by law, neither HP or its affiliates, \
subcontractors or suppliers will be liable for incidental,special or consequential \
damages including downtime cost; lost profits;damages relating to the procurement of \
substitute products or services; or damages for loss of data, or software \
restoration. The information in this document is subject to change without notice. \
Hewlett-Packard Company and the names of Hewlett-Packard products referenced herein \
are trademarks of Hewlett-Packard Company in the United States and other countries. \
Other product and company names mentioned herein may be trademarks of their \
                respective owners.
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.10 (GNU/Linux)

iEYEARECAAYFAk95xZcACgkQ4B86/C0qfVmJjACg284pNcMjsUiBRT6rLWQOUBhn
T5kAoLNV7YmZ8BEkFBsjbGCayUtKuypw
=V1lK
-----END PGP SIGNATURE-----

[[prev in list](?l=bugtraq&m=133355430409550&w=2)] [[next in list](?l=bugtraq&m=133355556010105&w=2)] [prev in thread] [next in thread]

```

[Configure](?q=configure) |
[About](?q=about) |
[News](?q=news) |
Add a list |
Sponsored by [KoreLogic](http://www.korelogic.com/)



=== Content from lists.apache.org_42a88448_20250125_150515.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_709c913e_20250125_150520.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_75a2a7e1_20250125_150514.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_6b8df184_20250125_150518.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_041b9ce4_20250125_150521.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_5222b37a_20250125_150514.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_636e79d1_20250125_150516.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from issues.apache.org_a54ff5bb_20250125_150513.html ===


ASF Bugzilla – Bug 47645
httpd-2.2.12 often hangs for hours
Last modified: 2014-03-31 06:07:36 UTC

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=47645&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=47645&GoAheadAndLogIn=1#forgot)
    Login:

    [x]

[**Bug 47645**](show_bug.cgi?id=47645)
- httpd-2.2.12 often hangs for hours

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
httpd-2.2.12 often hangs for hours

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | APR | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=APR "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | APR ([show other bugs](buglist.cgi?component=APR&product=APR&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 1.3.4 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | HP Windows Server 2003 | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 critical ([vote](page.cgi?id=voting/user.html&bug_id=47645#vote_47645)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Apache Portable Runtime bugs mailinglist | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [46571](show_bug.cgi?id=46571 "RESOLVED FIXED - tcnative blocks in APR poll on Solaris") | |  | Show dependency [tree](showdependencytree.cgi?id=47645&hide_resolved=1) | |  | | Reported: | 2009-08-05 03:12 UTC by HWS | | --- | --- | | Modified: | 2014-03-31 06:07 UTC ([History](show_activity.cgi?id=47645)) | | CC List: | 1 user (show)  jsl | |  | | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)**](attachment.cgi?id=24161 "View the content of the attachment") (718 bytes, text/plain)  [2009-08-24 09:48 UTC](#attach_24161 "Go to the comment associated with the attachment"), Jeff Trawick | [Details](attachment.cgi?id=24161&action=edit) | | [View All](attachment.cgi?bugid=47645&action=viewall)  [Add an attachment](attachment.cgi?bugid=47645&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=47645&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=47645#c0)  HWS    2009-08-05 03:12:31 UTC  ``` After upgrading from httpd 2.2.11 to 2.2.12, the server was blocked at least once per day for up to six hours. In this state, neither any answer packets were generated (tested with network sniffer) nor any log lines written. In one such state, I restarted the server gracefully, then it worked again. The log files do not show any errors. Tracing the running master httpd process with Solaris "truss" showed a loop of pollsys(...) and waitid(P_ALL,...) calls, but this is normal. Only downgrading to 2.2.11 helped.  Replacing the log-pipe syntax "|exec cronolog ..." with the new one, "||cronolog ..." had no effect. Systematic testing will be difficult since I cannot do this on our "production" web server and the bug cannot be triggered at will.  System: Solaris 10 u7 (SPARC), httpd self-compiled with Sun Studio Forte 7 compiler, configure options: CFLAGS='-xO3 -xarch=v8 -xstrconst' --disable-threads --enable-suexec --with-ssl=/usr/sfw (plus module options; mpm=prefork [default]). Additionally, mod_fastcgi was compiled separately. All this and the runtime configuration were identical to previous versions, which always worked reliably.  Process hierarchy (log output is piped through cronolog): httpd        (master)   cronolog   cronolog   cronolog   httpd      (fastcgi controller)     php-fcgi (master, PHP_FCGI_CHILDREN=2)       php-fcgi       php-fcgi   httpd   httpd   ...   httpd ```  [Comment 1](show_bug.cgi?id=47645#c1)  Jeff Trawick    2009-08-05 06:24:25 UTC  ``` Please use pstack to see what the httpd child processes are doing and post unique backtraces here. ```  [Comment 2](show_bug.cgi?id=47645#c2)  HWS    2009-08-06 00:37:31 UTC  ``` I used a duplicate installation on another machine (same OS) for testing and a script executing wget queries to six web-pages (with subqueries to css, images etc.) at a high rate (about 100 times the average load of our web server). The bug did not occur within 16 hours! However, the machines (both SPARC) had different type and number of CPUs. Thus I will have to reinstall 2.2.12 on our web server and wait till it hangs (although I don't like this). Please grant me some time (up to a week) for my next information. ```  [Comment 3](show_bug.cgi?id=47645#c3)  HWS    2009-08-06 05:07:05 UTC  ``` Faster than expected, the bug occurred again, and I could collect some hopefully informative output while the server was hanging:  *** master httpd process: * pstack PID :  fefcc1d0 pollsys  (ffbffb30, 0, ffbffb98, 0)  fef67b68 pselect  (ffbffb30, ff034630, ff034630, 0, ffbffb98, 0) + 1c8  fef67ee0 select   (0, 0, 0, 0, ffbffc00, 4ab82600) + a0  ff21faf0 apr_sleep (0, f4240, f4240, 33c, 9c180, f4000) + 4c  0004398c ap_wait_or_timeout (11175, 11000, ffbffcd0, ffffffff, 3, f4000) + 7c  0006ab00 ap_mpm_run (a, ff220c9c, 0, 0, 9ad84, 9c030) + 2f0  0002787c main     (1, 9957c, 99400, 9a400, 99510, cb188) + 994  00026688 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : pollsys(0xFFBFFB30, 0, 0xFFBFFB98, 0x00000000)  = 0 waitid(P_ALL, 0, 0xFFBFFAB8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0 pollsys(0xFFBFFB30, 0, 0xFFBFFB98, 0x00000000) (sleeping...) pollsys(0xFFBFFB30, 0, 0xFFBFFB98, 0x00000000)  = 0 waitid(P_ALL, 0, 0xFFBFFAB8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0 pollsys(0xFFBFFB30, 0, 0xFFBFFB98, 0x00000000)  = 0 waitid(P_ALL, 0, 0xFFBFFAB8, WEXITED|WTRAPPED|WSTOPPED|WNOHANG) = 0 ... etc.  * truss -t !all -u a.out: -p PID :   (No other process showed any output on this!) /1@1:       -> perform_idle_server_maintenance(0xa6e18, 0x11000, 0xffbffcd0, 0xffffffff) /1@1:       <- ap_wait_or_timeout() = 0xffbffce4 /1@1:       -> ap_wait_or_timeout(0xffbffce4, 0xffbffce0, 0xffbffcd0, 0xa6e18) /1@1:       <- ap_wait_or_timeout() = 0x11175 /1@1:       -> perform_idle_server_maintenance(0xa6e18, 0x11000, 0xffbffcd0, 0xffffffff) /1@1:       <- perform_idle_server_maintenance() = 1 /1@1:       -> ap_wait_or_timeout(0xffbffce4, 0xffbffce0, 0xffbffcd0, 0xa6e18) /1@1:         -> ap_run_monitor(0xa6e18, 0x0, 0x0, 0x0) /1@1:         <- ap_run_monitor() = 0 /1@1:       <- ap_wait_or_timeout() = 0x11175 /1@1:       -> perform_idle_server_maintenance(0xa6e18, 0x11000, 0xffbffcd0, 0xffffffff) /1@1:       <- perform_idle_server_maintenance() = 1 /1@1:       -> ap_wait_or_timeout(0xffbffce4, 0xffbffce0, 0xffbffcd0, 0xa6e18) /1@1:       <- ap_wait_or_timeout() = 0x11175 /1@1:       -> perform_idle_server_maintenance(0xa6e18, 0x11000, 0xffbffcd0, 0xffffffff) ... etc.  *** fcgi-controlling httpd process: * pstack PID :  fefcc1d0 pollsys  (ffbff9b0, 1, 0, 0)  fef67b68 pselect  (ffbff9b0, ff034630, ff034630, 40, 0, 0) + 1c8  fef67ee0 select   (10, ffbffba0, 0, 0, 0, ffbffc29) + a0  feb99a9c fcgi_pm_main (180, 0, febb6b80, feba005c, feba00e8, 3) + 9a4  feb943d4 init_module (a6e18, 18f6a8, aae28, ada58, 9782c, 0) + 264  0003abd4 ap_run_post_config (a6e18, e4f10, aae28, ada58, 9, 1c6908) + 48  00027820 main     (1, 9957c, 99400, 9a400, 99510, cb188) + 938  00026688 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : pollsys(0xFFBFF9B0, 1, 0x00000000, 0x00000000) (sleeping...)  *** one worker httpd process: * pstack PID :  fefcb904 portfs   (6, 8, 1ed548, 2, 1, ffbffa80)  ff21a994 apr_pollset_poll (1ed508, 0, 989680, ffbffaf8, ffbffaf4, 11177) + 12c  0006a218 child_main (18, 989400, 9a400, 1f34d0, 1, 9c400) + 378  0006a4d8 make_child (9a400, d, 9ac00, 0, 9ac00, e) + 128  0006a6f0 perform_idle_server_maintenance (2, ffbffbec, 9ad7c, 1, 2, 9c400) + 164  0006ac18 ap_mpm_run (a, ff220c9c, 0, 0, 9ad84, 9c030) + 408  0002787c main     (1, 9957c, 99400, 9a400, 99510, cb188) + 994  00026688 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : port_getn(8, 0x001ED548, 2, 1, 0xFFBFFA80) (sleeping...) port_getn(8, 0x001ED548, 2, 1, 0xFFBFFA80)      = 0 [62] port_getn(8, 0x001ED548, 2, 1, 0xFFBFFA80) (sleeping...)  *** all other worker httpd processes (adresses varying): * pstack PID :  fefcb804 fcntl    (f, 7, ff232d2c)  fefbb4cc fcntl    (f, 1, ff332a00, ff213f24, ffffedf6, 49db8400) + 84  ff212610 proc_mutex_fcntl_acquire (33c, 0, 1f3f8, fffb7d40, ff2319d4, 18f7f0) + 44  000698cc accept_mutex_on (8, 0, 0, 0, 8, 9c000) + 8  0006a168 child_main (18, 3e8, 9a400, 1f34d0, 1, 9c400) + 2c8  0006a4d8 make_child (9a400, c, 9ac00, 0, 9ac00, d) + 128  0006a6f0 perform_idle_server_maintenance (2, ffbffbe8, 9ad7c, 0, 2, 9c400) + 164  0006ac18 ap_mpm_run (a, ff220c9c, 0, 0, 9ad84, 9c030) + 408  0002787c main     (1, 9957c, 99400, 9a400, 99510, cb188) + 994  00026688 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : fcntl(15, F_SETLKW, 0xFF232D2C) (sleeping...)  *** all cronolog processes (adresses varying): * pstack PID :  ff2cc2e4 read     (0, ffbdfd5c, 10000)  00011c74 main     (26c00, 4a7aac78, 25dd0, 3, 25800, ffbffe8e) + 790  000113dc _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : read(0, 0xFFBDFD5C, 65536)	(sleeping...)  *** master php process: * pstack PID :  feb4c91c waitid   (7, 0, ffbfdbd0, 3)  feb3c120 wait     (ffbffe38, 1, ff2c2a00, 2, 570cf4, 0) + 58  0047182c main     (7fa0, 580f20, 0, 1, 58103c, 1) + 9cc  00042fa8 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : waitid(P_ALL, 0, 0xFFBFDBD0, WEXITED|WTRAPPED) (sleeping...)  *** child php processes: * pstack PID :  feb4b97c accept   (0, ffbfdc3c, ffbfdcac, 1)  00472794 main     (8014, 0, 1f4, 1, 0, 1) + 1934  00042fa8 _start   (0, 0, 0, 0, 0, 0) + 108  * truss -p PID : accept(0, 0xFFBFDC3C, 0xFFBFDCAC, SOV_DEFAULT) (sleeping...) ```  [Comment 4](show_bug.cgi?id=47645#c4)  Jeff Trawick    2009-08-06 05:17:54 UTC  ``` >Please grant me some time (up to a week) for my next information.  No problem.  This is best effort/as-time-allows support on both sides ;)  I'll just mark the status as NEEDINFO, which you can change when you're able to duplicate the problem and post the backtraces. ```  [Comment 5](show_bug.cgi?id=47645#c5)  Jeff Trawick    2009-08-06 05:39:11 UTC  ``` This pid is supposed to wake up for the next client connection:  * pstack PID :  fefcb904 portfs   (6, 8, 1ed548, 2, 1, ffbffa80)  ff21a994 apr_pollset_poll (1ed508, 0, 989680, ffbffaf8, ffbffaf4, 11177) + 12c  0006a218 child_main (18, 989400, 9a400, 1f34d0, 1, 9c400) + 378  From the truss I guess it is waking up every 10 seconds or so (whatever the prefork timeout is), but never finding a new connection.  I don't know exactly what is causing the problem.  I had a similar situation with the event MPM once and this same implementation of apr_pollset_poll(), but I didn't have time to debug or to narrow it down to one of {Event MPM, APR, Solaris kernel}.  You will likely be able to work around the problem by selecting a different poll implementation.  It should be as easy as   $ make distclean $ export ac_cv_func_port_create=no $ ./configure [normal configure options]  (Does that look right to others following the bug list?)  From another standpoint:  >In this state, neither any answer packets were generated (tested with network sniffer) nor any log lines written.  The TCP layer should answer a SYN packet.  Did that happen?  What does netstat show at the time of the hang?  If connections are able to reach the ESTABLISHED state but not responded to, then TCP is doing the right thing and httpd isn't finding the connection.  If none reach the ESTABLISHED state, then it is a TCP layer issue.  What changed in 2.2.12?  The Solaris port code changed in APR, but it doesn't look dangerous:  +    { +        int flags; + +        if ((flags = fcntl((*pollset)->port_fd, F_GETFD)) == -1) +            return errno; + +        flags |= FD_CLOEXEC; +        if (fcntl((*pollset)->port_fd, F_SETFD, flags) == -1) +            return errno; +    } ```  [Comment 6](show_bug.cgi?id=47645#c6)  Jeff Trawick    2009-08-06 05:44:18 UTC  ``` BTW, what exactly did you do to clear up the hang? ```  [Comment 7](show_bug.cgi?id=47645#c7)  HWS    2009-08-06 06:43:46 UTC  ``` Before recompiling and doing new tests (which I have to delay till after the next hang), here some remarks:  > I had a similar situation >with the event MPM once and this same implementation of apr_pollset_poll(), >but I didn't have time to debug or to narrow it down to one of {Event MPM, >APR, Solaris kernel}. >You will likely be able to work around the problem by selecting a different >poll implementation.  As far as I can see, 2.2.11 used exactly the same implementation, without any difficulties. The only change now is setting FD_CLOEXEC.  >The TCP layer should answer a SYN packet.  Did that happen? >What does netstat show at the time of the hang?  If connections are able to >reach the ESTABLISHED state but not responded to, then TCP is doing the right >thing and httpd isn't finding the connection.  If none reach the ESTABLISHED >state, then it is a TCP layer issue.  I have to wait for the next hang, but as far as I remember, snoop did not show any 'A' packets as reply to 'S' packets. If I remember the netstat output correctly, old connections were visible, but no new ones.  >BTW, what exactly did you do to clear up the hang?  Often nothing, but then it took hours to recover. Graceful restart always cleared the hang. ```  [Comment 8](show_bug.cgi?id=47645#c8)  HWS    2009-08-06 08:16:24 UTC  ``` >I have to wait for the next hang, but as far as I remember, snoop did not show >any 'A' packets as reply to 'S' packets. If I remember the netstat output >correctly, old connections were visible, but no new ones.  No, my memory seems to be bad! Now a new hang occurred, but new connection attempts do some handshake, becoming ESTABLISHED. Also netstat shows a lot of connections in CLOSE_WAIT state, which vanished after graceful restart (done in order to revive the server). ```  [Comment 9](show_bug.cgi?id=47645#c9)  HWS    2009-08-10 07:44:54 UTC  ``` >You will likely be able to work around the problem by selecting a different >poll implementation.  For testing, I compiled two new variants of libapr-1.so.0.3.7. First, I removed the line "#define HAVE_PORT_CREATE 1" from srclib/apr/include/arch/unix/apr_private.h, causing poll() instead of port_create() to be used (I verified that no reference to port_create() existed any more in the library). With this library, no hangs happened in 3,5 days. Second, I used port_create() but removed the two occurences of fcntl(fd, F_SETFD, flags) from srclib/apr/poll/unix/port.c, making it act as in httpd-2.2.11. But in spite of this, there soon were hangs again.  Thus, NOT using port_create() seems to be a workaround. But still, I am not content with this, because 2.2.11 also used port_create() without ANY difficulties! (This is why I also tested the effect of F_SETFD in poll.c, which was new since 2.2.11. But there is F_SETFD in many other places, too.) The actual reason of the hanging is, IMHO, still unknown (some subtle, machine-dependent timing problem?). ```  [Comment 10](show_bug.cgi?id=47645#c10)  Jeff Trawick    2009-08-11 12:29:11 UTC  ``` Thanks so much for the valuable research.  I agree that disabling port_create() is not a satisfying work-around; there's no question that something needs to be fixed, but I don't know where (kernel, APR, httpd, or even compiler).  It's more than a little astonishing that you're encountering this with the simplest MPM, with APR/httpd threading support disabled.  I guess that the problem has been there all along but is triggered by some seemingly unrelated change in 2.2.12. ```  [Comment 11](show_bug.cgi?id=47645#c11)  Jeff Trawick    2009-08-19 11:33:44 UTC  ``` I was able to reproduce the event port problem then run successfully with this patch, which applies cleanly to the APR in httpd 2.2.12 or 2.2.13.  (It isn't expected to be needed for httpd older than 2.2.12, unless a certain prefork MPM fix has been applied on top of 2.2.11).  ----------cut here----------- --- poll/unix/port.c.orig	2009-08-19 13:48:22.876217458 -0400 +++ poll/unix/port.c	2009-08-19 13:49:49.908294412 -0400 @@ -320,6 +320,17 @@      ret = port_getn(pollset->port_fd, pollset->port_set, pollset->nalloc,                      &nget, tvptr);   +    if (ret == -1 && nget > 0) { +        /* On at least some levels of Solaris, -1/ETIME can be +         * reported at the same time an event is returned. +         * Since the kernel forgets the event condition as soon as +         * it is returned, we have to ignore the -1/ETIME and +         * process the event to prevent a deadlock. +         */ + +        ret = 0; +    } +      /* decrease the waiting ASAP to reduce the window for calling          port_associate within apr_pollset_add() */      apr_atomic_dec32(&pollset->waiting); ------------cut here-----------  If anyone tries this patch, please report back. ```  [Comment 12](show_bug.cgi?id=47645#c12)  HWS    2009-08-20 00:45:15 UTC  ``` > If anyone tries this patch, please report back.  Before I try: There is another occurrence of port_getn() in port.c on line 501 (after your patch; 490 original). Shouldn't the same patch be applied there, too? (BTW, unfortunately I can hardly carry out tests now because I'll be absent for three weeks after tomorrow.) ```  [Comment 13](show_bug.cgi?id=47645#c13)  Jeff Trawick    2009-08-24 09:48:44 UTC  ``` Created [attachment 24161](attachment.cgi?id=24161 "Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)") [[details]](attachment.cgi?id=24161&action=edit "Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)") Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)  httpd users: This works with httpd 2.2.11-2.2.13 (and possibly earlier levels). cd to the srclib/apr directory before applying patch. ```  [Comment 14](show_bug.cgi?id=47645#c14)  Jeff Trawick    2009-08-24 09:50:32 UTC  ``` (In reply to [comment #12](show_bug.cgi?id=47645#c12)) > > If anyone tries this patch, please report back. >  > Before I try: There is another occurrence of port_getn() in port.c on line 501 > (after your patch; 490 original). Shouldn't the same patch be applied there, > too? > (BTW, unfortunately I can hardly carry out tests now because I'll be absent for > three weeks after tomorrow.)  That unhandled path is for an API isn't used in httpd 2.2.x, but the patch I just attached does fix the problem for that API.  A fix has been committed to APR trunk, 1.4.x, and 1.3.x branches for the next 1.3.x release. ```  [Comment 15](show_bug.cgi?id=47645#c15)  Jason Lingohr    2009-09-26 19:32:47 UTC  ``` I would like to chime in here and add that this issue doesn't only affect Solaris, but Linux (specifically RH9, 2.4 kernel) as well.  I upgraded to 2.2.13 this weekend and experienced the exact same issues.  Upgraded firstly to apr-1.3.8, no change.  Then applied the patch attached here and things are working fine again.  (Point of note to readers: I also then saw MySQL connections fill with queries in a locked state when running Gallery -- you may need to kill some queries if you hit this issue). ```  [Comment 16](show_bug.cgi?id=47645#c16)  Ruediger Pluem    2009-09-27 03:25:17 UTC  ``` (In reply to [comment #15](show_bug.cgi?id=47645#c15)) > I would like to chime in here and add that this issue doesn't only affect > Solaris, but Linux (specifically RH9, 2.4 kernel) as well.  You must be affected by something else. Linux does not have event ports but epoll.  > I upgraded to 2.2.13 this weekend and experienced the exact same issues. >  > Upgraded firstly to apr-1.3.8, no change.  Then applied the patch attached here > and things are working fine again.  As said this is not possible. The patch attached in #13 changes code that is never executed on Linux. ```  [Comment 17](show_bug.cgi?id=47645#c17)  Jason Lingohr    2009-09-27 15:25:35 UTC  ``` (In reply to [comment #16](show_bug.cgi?id=47645#c16)) > You must be affected by something else. Linux does not have event ports but > epoll.  Well, that's strange, because either this patch, or me clearing my MySQL connections (which was caused by this, I'm sure of it) fixed the issue.  > As said this is not possible. The patch attached in #13 changes code that is > never executed on Linux.  Very strange.  I guess I'l revert my patch and rebuild and try again. ```  [Comment 18](show_bug.cgi?id=47645#c18)  Jason Lingohr    2009-09-27 16:08:49 UTC  ``` My apologies... a clean rebuild and everything is working fine. ```  [Comment 19](show_bug.cgi?id=47645#c19)  shenming    2014-03-31 06:07:36 UTC  ``` Comment on [attachment 24161](attachment.cgi?id=24161 "Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)") [[details]](attachment.cgi?id=24161&action=edit "Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)") Fix for PR 47645 to use with apr 1.3.3-1.3.8 (and possibly earlier)  >--- poll/unix/port.c.orig	2009-08-21 08:16:52.140947520 -0400 >+++ poll/unix/port.c	2009-08-21 08:18:58.662675195 -0400 >@@ -325,6 +325,11 @@ >     apr_atomic_dec32(&pollset->waiting); >     (*num) = nget; >  >+    if (ret == -1 && nget && >+        (errno == ETIME || errno == EINTR)) { >+        ret = 0; >+    } >+ >     if (ret == -1) { >         (*num) = 0; >         if (errno == EINTR) { >@@ -490,6 +495,11 @@ >     ret = port_getn(pollcb->port_fd, pollcb->port_set, pollcb->nalloc, >                     &nget, tvptr); >  >+    if (ret == -1 && nget && >+        (errno == ETIME || errno == EINTR)) { >+        ret = 0; >+    } >+ >     if (ret == -1) { >         if (errno == ETIME || errno == EINTR) { >             rv = APR_TIMEUP; ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=47645)
* - [XML](show_bug.cgi?ctype=xml&id=47645)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=47645)
* - Top of page

This is **ASF Bugzilla**: the Apache Software Foundation bug system. In case
of problems with the functioning of ASF Bugzilla, please contact
bugzilla-admin@apache.org.
**Please Note:** this e-mail address is **only** for reporting problems
with ASF Bugzilla. Mail about any other subject will be silently
ignored.

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](docs/en/html/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=47645&GoAheadAndLogIn=1)

    Remember

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=47645&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from lists.apache.org_ad504cfc_20250125_150521.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_a8ade628_20250125_150520.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_3ac61c46_20250125_150519.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from www.mandriva.com_c893a2be_20250125_150511.html ===


* [Tuxedo.org](https://tuxedo.org/ "Go to: Tuxedo")
* Store
* Mandriva Linux
* Enterprise Solutions
* Contact Us
* Language ![](/sites/all/themes/mandriva_customer/images/arrow-grey-bottom.gif)
  + English (International)
  + Français
  + Ð ÑÑÑÐºÐ¸Ð¹

# [Mandriva](/mandriva/)

* Download
* Mandriva Linux
* Community
* Help

## One

### The Linux desktopthat's easy to try and easy to keep

Download
![Mandriva One](/sites/all/themes/mandriva_customer/images/front/packshot_Mandriva_One.png)

## Powerpack

### Mandriva Linux- and more

Download
![Mandriva Linux Powerpack](/sites/all/themes/mandriva_customer/images/front/en-49.png)

## Mandriva Flash

### The mobile and installable Linux desktopon a USB key

Buy on Store
![Mandriva Flash](/sites/all/themes/mandriva_customer/images/front/mandriva-flash2.png)

### [Community](community)

* User Forums
* Support - FAQ
* Free Software
* Become a member

### Enterprise Solutions

* Enterprise Linux Products
* Asset Management Solution
* Professional Services
* Support & Maintenance

* Go to site »

### Mandriva Partners

* Worldwide offices
* Partner Program
* Technology Partners
* OEM
* Classmate PC with Mandriva Linux

### News

* Mandriva presents the launch of its new mobile desktop: Mandriva Flash 2008 Spring
* Speaking about Mandriva Linux 2008 Spring in media
* Speaking about Mandriva Linux 2008 Spring in media
* Mandriva presents its latest distribution: Mandriva Linux 2008 Spring
* Mandriva and Novatice Technologies present Edutice, The ready to use solution dedicated to educationand multimedia spaces
* # [Top 50 Online Casinos UK in 2023](https://montycasinos.com/online-casinos/)

more

* Download
  + Mandriva Linux 2008
  + Writing an ISO image
* Mandriva Linux
  + One
  + Powerpack
  + Mandriva Flash
* Community
  + Start
  + Register
  + Stay informed
  + Participate
  + Free software
* Help
  + Getting help
  + Knowledge Base
  + Documentation
  + Forums
  + Support Requests
  + Customer Care
  + Enterprise Support
* Enterprise Solutions
  + Products
  + Support
  + Services
  + Partners
  + Go to site »

Language
English (International)
Français
Ð ÑÑÑÐºÐ¸Ð¹

* © 2007 Mandriva S.A.
* About Us
* Legal Information
* Privacy Policy
* Contact Us



=== Content from lists.apache.org_050d28b9_20250125_150517.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.



=== Content from lists.apache.org_14439f56_20250125_150516.html ===


[![Foal logo](images/logo.png)](./)

* ![Display Settings](images/cog.png "Display Settings")
  **Email display mode:**

  ---

   Modern rendering

   Legacy rendering
* ![Logged out](images/user_loggedout.png "Not logged in")

This site requires JavaScript enabled. Please enable it.


