```
{
  "vulnerability_details": {
    "root_cause": "The `extractVersionQuadFromString` function uses `strcpy` to copy the server's `appversion` string into a fixed-size buffer of 128 bytes. If the server provides an `appversion` string longer than 127 characters, it causes a stack buffer overflow.",
    "weaknesses": [
      "CWE-120: Buffer Copy without Checking Size Limit"
    ],
    "impact": "A malicious game streaming server could exploit this buffer overflow to crash the Moonlight client. Achieving Remote Code Execution (RCE) is possible but unlikely due to stack canaries used by modern compilers. However, some unofficial clients may not have stack canaries, making them more vulnerable. The CVSS score is based on the worst-case scenario of a client without exploit mitigations.",
    "attack_vectors": "The vulnerability is triggered by a server sending a long `appversion` string in its `/serverinfo` response to the client.",
    "attacker_capabilities": "The attacker needs to control a malicious game streaming server that a user is tricked into pairing with. This cannot be performed through a MITM attack due to public key pinning during pairing."
  },
  "affected_versions": ">= f57bd745b4cbed577ea654fad4701bea4d38b44c",
  "patched_versions": ">= b2497a3918a6d79808d9fd0c04734786e70d5954",
  "cvss_score": "7.6",
  "cvss_vector": "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:H",
    "vulnerable_code": "```c\nint extractVersionQuadFromString(const char* string, int* quad) {\n  char versionString[128];\n  char* nextDot;\n  char* nextNumber;\n  int i;\n\n  strcpy(versionString, string);\n  nextNumber = versionString;\n\n  for (i = 0; i < 4; i++) {\n    if (i == 3) {\n      nextDot = strchr(nextNumber, '\\0');\n    } else {\n      nextDot = strchr(nextNumber, '.');\n    }\n    if (nextDot == NULL) {\n      return -1;\n    }\n\n    // Cut the string off at the next dot\n    *nextDot = '\\0';\n\n    quad[i] = atoi(nextNumber);\n\n    // Move on to the next segment\n    nextNumber = nextDot + 1;\n  }\n\n  return 0;\n}\n```",
  "patch_code": "```c\nint extractVersionQuadFromString(const char* string, int* quad) {\n  const char* nextNumber = string;\n  for (int i = 0; i < 4; i++) {\n    // Parse the next component\n    quad[i] = (int)strtol(nextNumber, (char**)&nextNumber, 10);\n\n    // Skip the dot if we still have version components left.\n    //\n    // We continue looping even when we're at the end of the\n    // input string to ensure all subsequent version components\n    // are zeroed.\n    if (*nextNumber != 0) {\n      nextNumber++;\n    }\n  }\n\n  return 0;\n}\n```"
}
```