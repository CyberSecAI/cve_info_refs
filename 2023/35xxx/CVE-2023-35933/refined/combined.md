=== Content from github.com_969bb549_20250115_080102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenfga%2Fopenfga%2Fsecurity%2Fadvisories%2FGHSA-hr9r-8phq-5x8j)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenfga%2Fopenfga%2Fsecurity%2Fadvisories%2FGHSA-hr9r-8phq-5x8j)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=openfga%2Fopenfga)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openfga](/openfga)
/
**[openfga](/openfga/openfga)**
Public

* [Notifications](/login?return_to=%2Fopenfga%2Fopenfga) You must be signed in to change notification settings
* [Fork
  220](/login?return_to=%2Fopenfga%2Fopenfga)
* [Star
   3.1k](/login?return_to=%2Fopenfga%2Fopenfga)

* [Code](/openfga/openfga)
* [Issues
  111](/openfga/openfga/issues)
* [Pull requests
  17](/openfga/openfga/pulls)
* [Actions](/openfga/openfga/actions)
* [Projects
  1](/openfga/openfga/projects)
* [Security](/openfga/openfga/security)
* [Insights](/openfga/openfga/pulse)

Additional navigation options

* [Code](/openfga/openfga)
* [Issues](/openfga/openfga/issues)
* [Pull requests](/openfga/openfga/pulls)
* [Actions](/openfga/openfga/actions)
* [Projects](/openfga/openfga/projects)
* [Security](/openfga/openfga/security)
* [Insights](/openfga/openfga/pulse)

# OpenFGA DoS

Moderate

[jon-whit](/jon-whit)
published
GHSA-hr9r-8phq-5x8j
Jun 26, 2023

## Package

gomod

github.com/openfga/openfga
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

<1.1.0

## Patched versions

1.1.1

## Description

### Overview

OpenFGA versions v1.1.0 and prior are vulnerable to a DoS attack when certain Check and ListObjects calls are executed against authorization models that contain circular relationship definitions.

### Am I Affected?

You are affected by this vulnerability if you are using OpenFGA v1.1.0 or earlier, and if you are executing certain [Check](https://openfga.dev/api/service#/Relationship%20Queries/Check) or [ListObjects](https://openfga.dev/api/service#/Relationship%20Queries/ListObjects) calls against a vulnerable authorization model. To see which of your models could be vulnerable to this attack, download OpenFGA v1.2.0 and run the following command:

```
./openfga validate-models --datastore-engine <ENGINE> --datastore-uri <URI> | jq .[] | select(.Error | contains("loop"))

```

replacing the variables `<ENGINE>` and `<URI>` as needed.

### Fix

Upgrade to v1.1.1.

### Backward Compatibility

If you are not passing an invalid authorization model (as identified by running `./openfga validate-models`) as a parameter of your Check and ListObjects calls, this upgrade is backwards compatible.

Otherwise, OpenFGA v1.1.1 will start returning HTTP 400 status codes on those calls.

### Severity

Moderate

### CVE ID

CVE-2023-35933

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_43e60d13_20250115_080102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenfga%2Fopenfga%2Fcommit%2F087ce392595f3c319ab3028b5089118ea4063452)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenfga%2Fopenfga%2Fcommit%2F087ce392595f3c319ab3028b5089118ea4063452)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openfga%2Fopenfga)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openfga](/openfga)
/
**[openfga](/openfga/openfga)**
Public

* [Notifications](/login?return_to=%2Fopenfga%2Fopenfga) You must be signed in to change notification settings
* [Fork
  220](/login?return_to=%2Fopenfga%2Fopenfga)
* [Star
   3.1k](/login?return_to=%2Fopenfga%2Fopenfga)

* [Code](/openfga/openfga)
* [Issues
  111](/openfga/openfga/issues)
* [Pull requests
  17](/openfga/openfga/pulls)
* [Actions](/openfga/openfga/actions)
* [Projects
  1](/openfga/openfga/projects)
* [Security](/openfga/openfga/security)
* [Insights](/openfga/openfga/pulse)

Additional navigation options

* [Code](/openfga/openfga)
* [Issues](/openfga/openfga/issues)
* [Pull requests](/openfga/openfga/pulls)
* [Actions](/openfga/openfga/actions)
* [Projects](/openfga/openfga/projects)
* [Security](/openfga/openfga/security)
* [Insights](/openfga/openfga/pulse)

## Commit

[Permalink](/openfga/openfga/commit/087ce392595f3c319ab3028b5089118ea4063452)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-hr9r-8phq-5x8j](https://github.com/advisories/GHSA-hr9r-8phq-5x8j "GHSA-hr9r-8phq-5x8j")

[Browse files](/openfga/openfga/tree/087ce392595f3c319ab3028b5089118ea4063452)
Browse the repository at this point in the history

```
* fix: validate models with no entrypoints correctly

* chore: fix map clone on union case

* fix: clone visited map for base and subtract set in exclusion

* fix: tidy up godoc and resolve issues with tests

* test: drop duplicate test cases

* test: add another valid model to the WriteAuthorizationModel test cases

* fix: add more model validations on empty type name and relations

* fix: add in model validation for check, list object and expand

* chore: fix linter warnings

* chore: fix usage of NewAndValidate

---------

Co-authored-by: Adrian Tam <adrian.tam@okta.com>
```

* Loading branch information

[![@jon-whit](https://avatars.githubusercontent.com/u/2899204?s=40&v=4)](/jon-whit) [![@adriantam](https://avatars.githubusercontent.com/u/10730463?s=40&v=4)](/adriantam)

[jon-whit](/openfga/openfga/commits?author=jon-whit "View all commits by jon-whit")
and
[adriantam](/openfga/openfga/commits?author=adriantam "View all commits by adriantam")
authored
Jun 26, 2023

1 parent
[d180fc3](/openfga/openfga/commit/d180fc3e227f9ec11ff3adb3367ac00a2e21ca81)

commit 087ce39

 Show file tree

 Hide file tree

Showing
**12 changed files**
with
**881 additions**
and
**352 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cmd/validatemodels

  + cmd/validatemodels/validate\_models.go
    [validate\_models.go](#diff-95d9e08545fefe9067f7fbbf90001f7e45e6aaae305f3df6359fa9f5f6d66b33)
* pkg

  + server

    - commands

      * pkg/server/commands/expand.go
        [expand.go](#diff-269e4699d7c689b282685fd0d3a83bb151ba22d56ee017bd934a1b8474464629)
      * pkg/server/commands/write\_authzmodel.go
        [write\_authzmodel.go](#diff-4bbefb0c07a9d1819592bb04d9c11097c68272bc0d96a394573339fe266f5fca)
    - pkg/server/server.go
      [server.go](#diff-104a11712684e520f0affa95e6a053faeb713306a10f69ee99b9729cc9dd1996)
    - pkg/server/server\_test.go
      [server\_test.go](#diff-fe7a244e18e92d8f347af17363209172e1d79224f086b0585a1bbeef3b626c4e)
    - test

      * pkg/server/test/connected\_objects.go
        [connected\_objects.go](#diff-ba89bee14a3aa0f460aa698157fd4399baff4bbaa7e3f38af68ef2f747a96953)
      * pkg/server/test/expand.go
        [expand.go](#diff-bf8224744b6c80f60f50511712b883569d0e032e5b8d0ad70e5306f29b3f7d2b)
      * pkg/server/test/list\_objects.go
        [list\_objects.go](#diff-b2768c12a03ea828c935cefdebd637b32774ef1a48a6f4bbc2a436a43e957cc2)
      * pkg/server/test/server.go
        [server.go](#diff-15fe1625a8038fccbcff2f33bad7cf254063ba1e823d7aa9d3fdc09ed1f6f201)
      * pkg/server/test/write\_authzmodel.go
        [write\_authzmodel.go](#diff-c56eed0e6a74bf819f36d641d1b8124731074c7db7e51a88b25391937680d21a)
  + typesystem

    - pkg/typesystem/typesystem.go
      [typesystem.go](#diff-cc97036cfe9a7c99fee528ae591f760c617ec84cc013c84dd01170657fc43ff4)
    - pkg/typesystem/typesystem\_test.go
      [typesystem\_test.go](#diff-5a15da103952b0c7e42a86c207025fe7a959bcc961cb79b2463aa85118cce83e)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[cmd/validatemodels/validate\_models.go](#diff-95d9e08545fefe9067f7fbbf90001f7e45e6aaae305f3df6359fa9f5f6d66b33 "cmd/validatemodels/validate_models.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/cmd/validatemodels/validate_models.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -126,7 +126,7 @@ func ValidateAllAuthorizationModels(ctx context.Context, db storage.OpenFGADatas |
|  |  |  |
|  |  | // validate each model |
|  |  | for \_, model := range models { |
|  |  | \_, err := typesystem.NewAndValidate(model) |
|  |  | \_, err := typesystem.NewAndValidate(context.Background(), model) |
|  |  |  |
|  |  | validationResult := validationResult{ |
|  |  | StoreID: store.Id, |
| Expand Down | |  |

5 changes: 4 additions & 1 deletion

5
[pkg/server/commands/expand.go](#diff-269e4699d7c689b282685fd0d3a83bb151ba22d56ee017bd934a1b8474464629 "pkg/server/commands/expand.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/pkg/server/commands/expand.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -51,7 +51,10 @@ func (q \*ExpandQuery) Execute(ctx context.Context, req \*openfgapb.ExpandRequest) |
|  |  | return nil, serverErrors.ValidationError(typesystem.ErrInvalidSchemaVersion) |
|  |  | } |
|  |  |  |
|  |  | typesys := typesystem.New(model) |
|  |  | typesys, err := typesystem.NewAndValidate(ctx, model) |
|  |  | if err != nil { |
|  |  | return nil, serverErrors.ValidationError(typesystem.ErrInvalidModel) |
|  |  | } |
|  |  |  |
|  |  | if err = validation.ValidateObject(typesys, tk); err != nil { |
|  |  | return nil, serverErrors.ValidationError(err) |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[pkg/server/commands/write\_authzmodel.go](#diff-4bbefb0c07a9d1819592bb04d9c11097c68272bc0d96a394573339fe266f5fca "pkg/server/commands/write_authzmodel.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/pkg/server/commands/write_authzmodel.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,7 +45,7 @@ func (w \*WriteAuthorizationModelCommand) Execute(ctx context.Context, req \*openf |
|  |  | TypeDefinitions: req.GetTypeDefinitions(), |
|  |  | } |
|  |  |  |
|  |  | \_, err := typesystem.NewAndValidate(model) |
|  |  | \_, err := typesystem.NewAndValidate(ctx, model) |
|  |  | if err != nil { |
|  |  | return nil, serverErrors.InvalidAuthorizationModelInput(err) |
|  |  | } |
| Expand Down | |  |

15 changes: 12 additions & 3 deletions

15
[pkg/server/server.go](#diff-104a11712684e520f0affa95e6a053faeb713306a10f69ee99b9729cc9dd1996 "pkg/server/server.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/pkg/server/server.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -105,7 +105,10 @@ func (s \*Server) ListObjects(ctx context.Context, req \*openfgapb.ListObjectsRequ |
|  |  | return nil, err |
|  |  | } |
|  |  |  |
|  |  | typesys := typesystem.New(model) |
|  |  | typesys, err := typesystem.NewAndValidate(ctx, model) |
|  |  | if err != nil { |
|  |  | return nil, serverErrors.ValidationError(typesystem.ErrInvalidModel) |
|  |  | } |
|  |  |  |
|  |  | ctx = typesystem.ContextWithTypesystem(ctx, typesys) |
|  |  |  |
| Expand Down  Expand Up | | @@ -151,7 +154,10 @@ func (s \*Server) StreamedListObjects(req \*openfgapb.StreamedListObjectsRequest, |
|  |  | return serverErrors.HandleError("", err) |
|  |  | } |
|  |  |  |
|  |  | typesys := typesystem.New(model) |
|  |  | typesys, err := typesystem.NewAndValidate(ctx, model) |
|  |  | if err != nil { |
|  |  | return serverErrors.ValidationError(typesystem.ErrInvalidModel) |
|  |  | } |
|  |  |  |
|  |  | ctx = typesystem.ContextWithTypesystem(ctx, typesys) |
|  |  |  |
| Expand Down  Expand Up | | @@ -237,7 +243,10 @@ func (s \*Server) Check(ctx context.Context, req \*openfgapb.CheckRequest) (\*openf |
|  |  | return nil, serverErrors.ValidationError(typesystem.ErrInvalidSchemaVersion) |
|  |  | } |
|  |  |  |
|  |  | typesys := typesystem.New(model) |
|  |  | typesys, err := typesystem.NewAndValidate(ctx, model) |
|  |  | if err != nil { |
|  |  | return nil, serverErrors.ValidationError(typesystem.ErrInvalidModel) |
|  |  | } |
|  |  |  |
|  |  | if err := validation.ValidateUserObjectRelation(typesys, tk); err != nil { |
|  |  | return nil, serverErrors.ValidationError(err) |
| Expand Down | |  |

99 changes: 93 additions & 6 deletions

99
[pkg/server/server\_test.go](#diff-fe7a244e18e92d8f347af17363209172e1d79224f086b0585a1bbeef3b626c4e "pkg/server/server_test.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/pkg/server/server_test.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -175,7 +175,7 @@ func TestCheckDoesNotThrowBecauseDirectTupleWasFound(t \*testing.T) { |
|  |  | Logger: logger.NewNoopLogger(), |
|  |  | Transport: gateway.NewNoopTransport(), |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | }) |
|  |  |  |
|  |  | checkResponse, err := s.Check(ctx, &openfgapb.CheckRequest{ |
| Expand All | | @@ -187,6 +187,93 @@ func TestCheckDoesNotThrowBecauseDirectTupleWasFound(t \*testing.T) { |
|  |  | require.Equal(t, true, checkResponse.Allowed) |
|  |  | } |
|  |  |  |
|  |  | func TestOperationsWithInvalidModel(t \*testing.T) { |
|  |  | ctx := context.Background() |
|  |  | storeID := ulid.Make().String() |
|  |  | modelID := ulid.Make().String() |
|  |  |  |
|  |  | // The model is invalid |
|  |  | typedefs := parser.MustParse(` |
|  |  | type user |
|  |  |  |
|  |  | type repo |
|  |  | relations |
|  |  | define admin: [user] as self |
|  |  | define r1: [user] as self and r2 and r3 |
|  |  | define r2: [user] as self and r1 and r3 |
|  |  | define r3: [user] as self and r1 and r2 |
|  |  | `) |
|  |  |  |
|  |  | tk := tuple.NewTupleKey("repo:openfga", "r1", "user:anne") |
|  |  | mockController := gomock.NewController(t) |
|  |  | defer mockController.Finish() |
|  |  |  |
|  |  | mockDatastore := mockstorage.NewMockOpenFGADatastore(mockController) |
|  |  |  |
|  |  | mockDatastore.EXPECT(). |
|  |  | ReadAuthorizationModel(gomock.Any(), storeID, modelID). |
|  |  | AnyTimes(). |
|  |  | Return(&openfgapb.AuthorizationModel{ |
|  |  | SchemaVersion: typesystem.SchemaVersion1\_1, |
|  |  | TypeDefinitions: typedefs, |
|  |  | }, nil) |
|  |  |  |
|  |  | // the model is error and err should return |
|  |  |  |
|  |  | s := New(&Dependencies{ |
|  |  | Datastore: mockDatastore, |
|  |  | Logger: logger.NewNoopLogger(), |
|  |  | Transport: gateway.NewNoopTransport(), |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | }) |
|  |  |  |
|  |  | \_, err := s.Check(ctx, &openfgapb.CheckRequest{ |
|  |  | StoreId: storeID, |
|  |  | TupleKey: tk, |
|  |  | AuthorizationModelId: modelID, |
|  |  | }) |
|  |  | require.Error(t, err) |
|  |  | e, ok := status.FromError(err) |
|  |  | require.True(t, ok) |
|  |  | require.Equal(t, codes.Code(openfgapb.ErrorCode\_validation\_error), e.Code()) |
|  |  |  |
|  |  | \_, err = s.ListObjects(ctx, &openfgapb.ListObjectsRequest{ |
|  |  | StoreId: storeID, |
|  |  | AuthorizationModelId: modelID, |
|  |  | Type: "repo", |
|  |  | Relation: "r1", |
|  |  | User: "user:anne", |
|  |  | }) |
|  |  | require.Error(t, err) |
|  |  | e, ok = status.FromError(err) |
|  |  | require.True(t, ok) |
|  |  | require.Equal(t, codes.Code(openfgapb.ErrorCode\_validation\_error), e.Code()) |
|  |  |  |
|  |  | err = s.StreamedListObjects(&openfgapb.StreamedListObjectsRequest{ |
|  |  | StoreId: storeID, |
|  |  | AuthorizationModelId: modelID, |
|  |  | Type: "repo", |
|  |  | Relation: "r1", |
|  |  | User: "user:anne", |
|  |  | }, NewMockStreamServer()) |
|  |  | require.Error(t, err) |
|  |  | e, ok = status.FromError(err) |
|  |  | require.True(t, ok) |
|  |  | require.Equal(t, codes.Code(openfgapb.ErrorCode\_validation\_error), e.Code()) |
|  |  |  |
|  |  | \_, err = s.Expand(ctx, &openfgapb.ExpandRequest{ |
|  |  | StoreId: storeID, |
|  |  | AuthorizationModelId: modelID, |
|  |  | TupleKey: tk, |
|  |  | }) |
|  |  | require.Error(t, err) |
|  |  | e, ok = status.FromError(err) |
|  |  | require.True(t, ok) |
|  |  | require.Equal(t, codes.Code(openfgapb.ErrorCode\_validation\_error), e.Code()) |
|  |  |  |
|  |  | } |
|  |  |  |
|  |  | func TestShortestPathToSolutionWins(t \*testing.T) { |
|  |  | ctx := context.Background() |
|  |  |  |
| Expand Down  Expand Up | | @@ -245,7 +332,7 @@ func TestShortestPathToSolutionWins(t \*testing.T) { |
|  |  | Logger: logger.NewNoopLogger(), |
|  |  | Transport: gateway.NewNoopTransport(), |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | }) |
|  |  |  |
|  |  | start := time.Now() |
| Expand Down  Expand Up | | @@ -380,7 +467,7 @@ func BenchmarkListObjectsNoRaceCondition(b \*testing.B) { |
|  |  | Transport: transport, |
|  |  | Logger: logger, |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | ListObjectsDeadline: 5 \* time.Second, |
|  |  | ListObjectsMaxResults: 1000, |
|  |  | }) |
| Expand Down  Expand Up | | @@ -440,7 +527,7 @@ func TestListObjects\_Unoptimized\_UnhappyPaths(t \*testing.T) { |
|  |  | Transport: transport, |
|  |  | Logger: logger, |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | ListObjectsDeadline: 5 \* time.Second, |
|  |  | ListObjectsMaxResults: 1000, |
|  |  | }) |
| Expand Down  Expand Up | | @@ -521,7 +608,7 @@ func TestListObjects\_UnhappyPaths(t \*testing.T) { |
|  |  | Transport: transport, |
|  |  | Logger: logger, |
|  |  | }, &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | ListObjectsDeadline: 5 \* time.Second, |
|  |  | ListObjectsMaxResults: 1000, |
|  |  | }) |
| Expand Down  Expand Up | | @@ -587,7 +674,7 @@ func TestAuthorizationModelInvalidSchemaVersion(t \*testing.T) { |
|  |  | transport: transport, |
|  |  | logger: logger, |
|  |  | config: &Config{ |
|  |  | ResolveNodeLimit: 25, |
|  |  | ResolveNodeLimit: test.DefaultResolveNodeLimit, |
|  |  | ListObjectsDeadline: 5 \* time.Second, |
|  |  | ListObjectsMaxResults: 1000, |
|  |  | }, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[pkg/server/test/connected\_objects.go](#diff-ba89bee14a3aa0f460aa698157fd4399baff4bbaa7e3f38af68ef2f747a96953 "pkg/server/test/connected_objects.go")

Show comments

[View file](/openfga/openfga/blob/087ce392595f3c319ab3028b5089118ea4063452/pkg/server/test/connected_objects.go)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -908,7 +908,7 @@ func ConnectedObjectsTest(t \*testing.T, ds storage.OpenFGADatastore) { |
|  |  | require.NoError(err) |
|  |  |  |
|  |  | if test.resolveNodeLimit == 0 { |
|  |  | test.resolveNodeLimit = defaultResolveNodeLimit |
|  |  | test.resolveNodeLimit = DefaultResolveNodeLimit |
|  |  | } |
|  |  |  |
|  |  | connectedObjectsCmd := commands.ConnectedObjectsCommand{ |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `087ce39`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenfga%2Fopenfga%2Fcommit%2F087ce392595f3c319ab3028b5089118ea4063452) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from openfga.dev_f410e2b7_20250115_080104.html ===

[Skip to main content](#__docusaurus_skipToContent_fallback)[![OpenFGA](/img/openfga_logo.svg)![OpenFGA](/img/openfga_logo.svg)](/)[Home](/)[Docs](/docs/fga)[API](/api/service)[Blog](/blog)[GitHub](https://github.com/openfga/openfga)[Twitter](https://twitter.com/OpenFGA)[CNCF Slack](https://openfga.dev/community)Loading...[Twitter](https://twitter.com/OpenFGA)·[CNCF Slack](https://openfga.dev/community)·[GitHub](https://github.com/openfga)·[Mastodon](https://mastodon.social/%40openfga)[![CNCF](/img/cncf-icon-white.svg)](https://www.linuxfoundation.org/trademark-usage) © 2025 [The Linux Foundation](https://www.linuxfoundation.org/)®. All rights reserved. For a list of trademarks of The Linux Foundation, see our [Trademark Usage page](https://www.linuxfoundation.org/trademark-usage).


=== Content from openfga.dev_042d42c8_20250115_080103.html ===

[Skip to main content](#__docusaurus_skipToContent_fallback)[![OpenFGA](/img/openfga_logo.svg)![OpenFGA](/img/openfga_logo.svg)](/)[Home](/)[Docs](/docs/fga)[API](/api/service)[Blog](/blog)[GitHub](https://github.com/openfga/openfga)[Twitter](https://twitter.com/OpenFGA)[CNCF Slack](https://openfga.dev/community)Loading...[Twitter](https://twitter.com/OpenFGA)·[CNCF Slack](https://openfga.dev/community)·[GitHub](https://github.com/openfga)·[Mastodon](https://mastodon.social/%40openfga)[![CNCF](/img/cncf-icon-white.svg)](https://www.linuxfoundation.org/trademark-usage) © 2025 [The Linux Foundation](https://www.linuxfoundation.org/)®. All rights reserved. For a list of trademarks of The Linux Foundation, see our [Trademark Usage page](https://www.linuxfoundation.org/trademark-usage).

