=== Content from www.wordfence.com_c1d34a8e_20250114_195630.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Ad Inserter <= 2.7.30 - Unauthenticated Sensitive Information Exposure via ai\_ajax

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Ad Inserter <= 2.7.30 - Unauthenticated Sensitive Information Exposure via ai\_ajax

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2023-4645](https://www.cve.org/CVERecord?id=CVE-2023-4645) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | September 22, 2023 |
| Last Updated | October 19, 2023 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The Ad Inserter for WordPress is vulnerable to Sensitive Information Exposure in versions up to, and including, 2.7.30 via the ai\_ajax function. This can allow unauthenticated attackers to extract sensitive data such as post titles and slugs (including those of protected posts along with their passwords), usernames, available roles, the plugin license key provided the remote debugging option is enabled. In the default state it is disabled.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/ad-inserter/trunk/ad-inserter.php#L6529)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2969942%40ad-inserter%2Ftags%2F2.7.31&old=2922718%40ad-inserter%2Ftrunk)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fad-inserter%2Fad-inserter-2730-unauthenticated-sensitive-information-exposure-via-ai-ajax&t=Ad%20Inserter%20%3C%3D%202.7.30%20-%20Unauthenticated%20Sensitive%20Information%20Exposure%20via%20ai_ajax "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fad-inserter%2Fad-inserter-2730-unauthenticated-sensitive-information-exposure-via-ai-ajax&text=Ad%20Inserter%20%3C%3D%202.7.30%20-%20Unauthenticated%20Sensitive%20Information%20Exposure%20via%20ai_ajax "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fad-inserter%2Fad-inserter-2730-unauthenticated-sensitive-information-exposure-via-ai-ajax "LinkedIn")
Email

## Vulnerability Details for Ad Inserter – Ad Manager & AdSense Ads

#### [Ad Inserter – Ad Manager & AdSense Ads](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ad-inserter)

| Software Type | Plugin |
| --- | --- |
| Software Slug | ad-inserter [(view on wordpress.org)](https://wordpress.org/plugins/ad-inserter) |
| Patched? | Yes |
| Remediation | Update to version 2.7.31, or a newer patched version |
| Affected Version | * <= 2.7.30 |
| Patched Version | * 2.7.31 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_bf8195c0_20250114_195608.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fad-inserter%2Ftrunk%2Fad-inserter.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/ad-inserter/trunk/ad-inserter.php?rev=3209472 "Revision 3209472")
* Next Revision →
* [Blame](/browser/ad-inserter/trunk/ad-inserter.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/ad-inserter/trunk/ad-inserter.php)

---

# [source:](/browser?order=name "Go to repository root") [ad-inserter](/browser/ad-inserter?order=name "View ad-inserter")/[trunk](/browser/ad-inserter/trunk?order=name "View trunk")/[ad-inserter.php](/browser/ad-inserter/trunk/ad-inserter.php?order=name "View ad-inserter.php")

View diff against:

View revision:

| [Last change](/changeset/3214483/ad-inserter/trunk/ad-inserter.php "View differences") on this file was [3214483](/changeset/3214483/ "View changeset 3214483"), checked in by spacetime, [2 weeks ago](/timeline?from=2024-12-29T16%3A28%3A30Z&precision=second "See timeline at 12/29/2024 04:28:30 PM") |
| --- |
| Version 2.7.39 |
| **File size:** 541.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\* |
| [4](#L4) | Plugin Name: Ad Inserter |
| [5](#L5) | Version: 2.7.39 |
| [6](#L6) | Description: Ad management with many advanced advertising features to insert ads at optimal positions |
| [7](#L7) | Author: Igor Funa |
| [8](#L8) | Author URI: http://igorfuna.com/ |
| [9](#L9) | Plugin URI: https://adinserter.pro/documentation |
| [10](#L10) | Text Domain: ad-inserter |
| [11](#L11) | Domain Path: /languages |
| [12](#L12) | Requires at least: 5 |
| [13](#L13) | Requires PHP: 7.2 |
| [14](#L14) | License: GPLv3 |
| [15](#L15) | \*/ |
| [16](#L16) |  |
| [17](#L17) | /\* |
| [18](#L18) |  |
| [19](#L19) | Change Log |
| [20](#L20) |  |
| [21](#L21) | Ad Inserter 2.7.39 - 2024-12-17 |
| [22](#L22) | - Improved frontend code |
| [23](#L23) | - Fix for warning "Function \_load\_textdomain\_just\_in\_time was called incorrectly" |
| [24](#L24) | - Updated Maxmind library (Pro only) |
| [25](#L25) | - Few minor bug fixes, cosmetic changes and code improvements |
| [26](#L26) |  |
| [27](#L27) | Ad Inserter 2.7.38 - 2024-10-03 |
| [28](#L28) | - Security fix for potential cross site scripting |
| [29](#L29) |  |
| [30](#L30) | Ad Inserter 2.7.37 - 2024-09-16 |
| [31](#L31) | - Removed deprecated setting Wait for jQuery |
| [32](#L32) | - Few minor bug fixes, cosmetic changes and code improvements |
| [33](#L33) |  |
| [34](#L34) | Ad Inserter 2.7.36 - 2024-08-11 |
| [35](#L35) | - Added support for WPML languages in the taxonomy list |
| [36](#L36) | - Added support to disable caching for LiteSpeed Cache and WP Fastest Cache plugins |
| [37](#L37) | - Added support to define the minimal block height for the close button to appear (Pro only) |
| [38](#L38) | - Few minor bug fixes, cosmetic changes and code improvements |
| [39](#L39) |  |
| [40](#L40) | Ad Inserter 2.7.35 - 2024-04-23 |
| [41](#L41) | - Added support for "Simple History  user activity log, audit tool" plugin |
| [42](#L42) | - Added support for external tracking for Google Tag Manager code (Pro only) |
| [43](#L43) | - Few minor bug fixes, cosmetic changes and code improvements |
| [44](#L44) |  |
| [45](#L45) | Ad Inserter 2.7.34 - 2024-03-14 |
| [46](#L46) | - Added support for ^ character to invert viewports in the VIEWPORT separator |
| [47](#L47) | - Added support for index parameter for counter shortcodes |
| [48](#L48) | - Changed text for content marker |
| [49](#L49) | - Few minor bug fixes, cosmetic changes and code improvements |
| [50](#L50) |  |
| [51](#L51) | Ad Inserter 2.7.33 - 2024-01-03 |
| [52](#L52) | - Changed widget class name |
| [53](#L53) | - Added option to define maximum number of list selection items |
| [54](#L54) | - Fix for Amazon external script causing false ad blocking detection |
| [55](#L55) | - Few minor bug fixes, cosmetic changes and code improvements |
| [56](#L56) |  |
| [57](#L57) | Ad Inserter 2.7.32 - 2023-10-29 |
| [58](#L58) | - Added experimental support for REST requests |
| [59](#L59) | - Added support for data shortcode for url parameters |
| [60](#L60) | - Added option for shortcodes to ignore category, tag, taxonomy and post ID lists |
| [61](#L61) | - Added support for background parallax ads (Pro only) |
| [62](#L62) | - Few minor bug fixes, cosmetic changes and code improvements |
| [63](#L63) |  |
| [64](#L64) | Ad Inserter 2.7.31 - 2023-09-11 |
| [65](#L65) | - Security fix for some data revealed via remote debugging data |
| [66](#L66) | - Added support to remove ad label when no code is inserted |
| [67](#L67) | - Few minor bug fixes, cosmetic changes and code improvements |
| [68](#L68) |  |
| [69](#L69) | Ad Inserter 2.7.30 - 2023-07-15 |
| [70](#L70) | - Improved debugging |
| [71](#L71) | - Few minor bug fixes, cosmetic changes and code improvements |
| [72](#L72) |  |
| [73](#L73) | Ad Inserter 2.7.29 - 2023-06-03 |
| [74](#L74) | - Added support for shortcode for reusable blocks by name |
| [75](#L75) | - Added support to force using get\_queried\_object function to get post id |
| [76](#L76) | - Few minor bug fixes, cosmetic changes and code improvements |
| [77](#L77) |  |
| [78](#L78) | Ad Inserter 2.7.28 - 2023-04-12 |
| [79](#L79) | - Added support for shortcode for reusable blocks |
| [80](#L80) | - Fix for PDF reports when site\_url is different from home\_url (Pro only) |
| [81](#L81) | - Few minor bug fixes, cosmetic changes and code improvements |
| [82](#L82) |  |
| [83](#L83) | Ad Inserter 2.7.27 - 2023-03-29 |
| [84](#L84) | - Fix for ad blocking detection external script trying to download a file |
| [85](#L85) |  |
| [86](#L86) | Ad Inserter 2.7.26 - 2023-03-20 |
| [87](#L87) | - Improved compatibility with PHP 8.2 |
| [88](#L88) | - Security fix for deserialization |
| [89](#L89) | - Few minor bug fixes, cosmetic changes and code improvements |
| [90](#L90) |  |
| [91](#L91) | Ad Inserter 2.7.25 - 2023-02-19 |
| [92](#L92) | - Improved theme compatibility for sticky widgets with CSS mode |
| [93](#L93) | - Improved tracking for Google Analytics (Pro only) |
| [94](#L94) | - Added information bar when Wait for jQuery is enabled |
| [95](#L95) | - Few minor bug fixes, cosmetic changes and code improvements |
| [96](#L96) |  |
| [97](#L97) | Ad Inserter 2.7.24 - 2023-01-18 |
| [98](#L98) | - Added CSS Push mode for sticky widgets |
| [99](#L99) | - Added support for sticky ads (push mode) inside post/page content (Pro only) |
| [100](#L100) | - Added support for frontend JavaScript code in external file |
| [101](#L101) | - Added support for multiple activations of rotation groups |
| [102](#L102) | - Added support for %N@M format for filter counting |
| [103](#L103) | - Added support to prepend and append code to rotation option codes |
| [104](#L104) | - Added hook for click on the close button (Pro only) |
| [105](#L105) | - Improved front-end code |
| [106](#L106) | - Fix for client-side device detection on AMP pages |
| [107](#L107) | - Few minor bug fixes, cosmetic changes and code improvements |
| [108](#L108) |  |
| [109](#L109) | Ad Inserter 2.7.23 - 2022-12-20 |
| [110](#L110) | - Few minor bug fixes, cosmetic changes and code improvements |
| [111](#L111) |  |
| [112](#L112) | Ad Inserter 2.7.22 - 2022-11-30 |
| [113](#L113) | - Few minor bug fixes, cosmetic changes and code improvements |
| [114](#L114) |  |
| [115](#L115) | Ad Inserter 2.7.21 - 2022-10-25 |
| [116](#L116) | - Added support for Ad Inserter menu position |
| [117](#L117) | - Added support for random paragraph ranges |
| [118](#L118) | - Added support for default waiting time for user interaction (Pro only) |
| [119](#L119) | - Improved front-end code |
| [120](#L120) | - Few minor bug fixes, cosmetic changes and code improvements |
| [121](#L121) |  |
| [122](#L122) | Ad Inserter 2.7.20 - 2022-10-02 |
| [123](#L123) | - Fix for front-end translation |
| [124](#L124) |  |
| [125](#L125) | Ad Inserter 2.7.19 - 2022-09-16 |
| [126](#L126) | - Added constant to disable AdSense API |
| [127](#L127) | - Fix for rotation code editor |
| [128](#L128) | - Fix for advaced click tracker for banners (Pro only) |
| [129](#L129) | - Few minor bug fixes, cosmetic changes and code improvements |
| [130](#L130) |  |
| [131](#L131) | Ad Inserter 2.7.18 - 2022-09-01 |
| [132](#L132) | - Added support to hide ad label when unfilled AdSense block is hidden |
| [133](#L133) | - Simplified AdSense API authorization process |
| [134](#L134) | - Few minor bug fixes, cosmetic changes and code improvements |
| [135](#L135) |  |
| [136](#L136) | Ad Inserter 2.7.17 - 2022-07-06 |
| [137](#L137) | - Fixed bug for url parameters check |
| [138](#L138) | - Added support for reCaptcha v3 score check (Pro only) |
| [139](#L139) | - Few minor bug fixes, cosmetic changes and code improvements |
| [140](#L140) |  |
| [141](#L141) | Ad Inserter 2.7.16 - 2022-06-23 |
| [142](#L142) | - Added support for adb redirection page with url queries |
| [143](#L143) | - Added support for tcf-no-google shortcut |
| [144](#L144) | - Few minor bug fixes, cosmetic changes and code improvements |
| [145](#L145) |  |
| [146](#L146) | Ad Inserter 2.7.15 - 2022-06-01 |
| [147](#L147) | - Added filter hooks for ad labels |
| [148](#L148) | - Added support for constants |
| [149](#L149) | - Added support for rotation option index attribute |
| [150](#L150) | - Added shortcodes for block number and block name |
| [151](#L151) | - Few minor bug fixes, cosmetic changes and code improvements |
| [152](#L152) |  |
| [153](#L153) | Ad Inserter 2.7.14 - 2022-04-28 |
| [154](#L154) | - Added support for demo settings |
| [155](#L155) | - Added support for background transparency |
| [156](#L156) | - Added support for background for sticky ads (Pro only) |
| [157](#L157) | - Added support for statistics for check options (Pro only) |
| [158](#L158) | - Added support for individual rotation option statistics (Pro only) |
| [159](#L159) | - Few minor bug fixes, cosmetic changes and code improvements |
| [160](#L160) |  |
| [161](#L161) | Ad Inserter 2.7.13 - 2022-04-02 |
| [162](#L162) | - Few minor bug fixes, cosmetic changes and code improvements |
| [163](#L163) |  |
| [164](#L164) | Ad Inserter 2.7.12 - 2022-03-09 |
| [165](#L165) | - Security fix for settings page save url |
| [166](#L166) | - Added support to disable ad blocking detection for specific devices |
| [167](#L167) | - Few minor bug fixes, cosmetic changes and code improvements |
| [168](#L168) |  |
| [169](#L169) | Ad Inserter 2.7.11 - 2022-01-28 |
| [170](#L170) | - Security fix for sites using constants to prevent file editing or unfiltered HTML |
| [171](#L171) | - Added filters before the options are saved |
| [172](#L172) | - Added support for a shortcode for comma separated list of categories with quotes (for Google Ad Manager) |
| [173](#L173) | - Few minor bug fixes, cosmetic changes and code improvements |
| [174](#L174) |  |
| [175](#L175) | Ad Inserter 2.7.10 - 2022-01-19 |
| [176](#L176) | - Security fix for XSS (Reported by Krzysztof Zajac via WPScan) |
| [177](#L177) | - Added support to detect and replace blank AdSense blocks |
| [178](#L178) | - Added support to load and save plugins settings to a file (Pro only) |
| [179](#L179) | - Added support for parallax ads (Pro only) |
| [180](#L180) | - Few fixes |
| [181](#L181) |  |
| [182](#L182) | Ad Inserter 2.7.9 - 2022-01-05 |
| [183](#L183) | - Bug fix for timed rotations |
| [184](#L184) | - Bug fix for tr\_TR translation |
| [185](#L185) | - Improved checks for cookies |
| [186](#L186) | - Improved compatibility with PHP 8.1 |
| [187](#L187) | - Added separate list for cookies |
| [188](#L188) | - Few minor bug fixes, cosmetic changes and code improvements |
| [189](#L189) |  |
| [190](#L190) | Ad Inserter 2.7.8 - 2021-12-01 |
| [191](#L191) | - Bug fix for paragraph counting and clearance |
| [192](#L192) | - Bug fix for undefined constant error |
| [193](#L193) |  |
| [194](#L194) | Ad Inserter 2.7.7 - 2021-11-30 |
| [195](#L195) | - Few bug fixes |
| [196](#L196) |  |
| [197](#L197) | Ad Inserter 2.7.6 - 2021-11-28 |
| [198](#L198) | - Improved compatibility with PHP 8 |
| [199](#L199) | - Added translation for tr\_TR |
| [200](#L200) | - Added support to wait for an interaction before the block is loaded (Pro only) |
| [201](#L201) | - Added support to delay insertion of the block (Pro only) |
| [202](#L202) | - Few minor bug fixes, cosmetic changes and code improvements |
| [203](#L203) |  |
| [204](#L204) | Ad Inserter 2.7.5 - 2021-10-20 |
| [205](#L205) | - Added support for fallback block for limits (Pro only) |
| [206](#L206) | - Added support to optimize rotation shares by CTR (Pro only) |
| [207](#L207) | - Added support to animate out sticky ads (Pro only) |
| [208](#L208) | - Few minor bug fixes, cosmetic changes and code improvements |
| [209](#L209) |  |
| [210](#L210) | Ad Inserter 2.7.4 - 2021-09-16 |
| [211](#L211) | - Updated Google API |
| [212](#L212) | - Improved labels for AdSense Auto ads |
| [213](#L213) | - Added external tracking support for WP username (Pro only) |
| [214](#L214) | - Few minor bug fixes, cosmetic changes and code improvements |
| [215](#L215) |  |
| [216](#L216) | Ad Inserter 2.7.3 - 2021-08-10 |
| [217](#L217) | - Improved ad blocking detection |
| [218](#L218) | - Improved compatibility with PHP 8 |
| [219](#L219) | - Improved check for update server accessibility (Pro only) |
| [220](#L220) | - Few minor bug fixes, cosmetic changes and code improvements |
| [221](#L221) |  |
| [222](#L222) | Ad Inserter 2.7.2 - 2021-07-05 |
| [223](#L223) | - Added shortcuts for TCF v2 consent cookie checks |
| [224](#L224) | - Added support for adinserter shortcode to get post ID |
| [225](#L225) | - Improved ad blocking detection |
| [226](#L226) | - Changed internal IP to country database (Pro only) |
| [227](#L227) | - Few minor bug fixes, cosmetic changes and code improvements |
| [228](#L228) |  |
| [229](#L229) | Ad Inserter 2.7.1 - 2021-06-16 |
| [230](#L230) | - Improved ad blocking detection |
| [231](#L231) | - Few minor bug fixes, cosmetic changes and code improvements |
| [232](#L232) |  |
| [233](#L233) | Ad Inserter 2.7.0 - 2021-05-30 |
| [234](#L234) | - Added support to list range of post IDs |
| [235](#L235) | - Added support for browser language in client lists |
| [236](#L236) | - Added support for client-side checks for filter hook ai\_block\_insertion\_check |
| [237](#L237) | - Added support for remote plugin managenent (Pro only) |
| [238](#L238) | - Added support for scheduling check shortcode (Pro only) |
| [239](#L239) | - Added support for daily scheduling time (Pro onlyl) |
| [240](#L240) | - Added support for css attribute in check options (Pro only) |
| [241](#L241) | - Few minor bug fixes, cosmetic changes and code improvements |
| [242](#L242) |  |
| [243](#L243) | Ad Inserter 2.6.27 - 2021-05-29 |
| [244](#L244) | - Added support for scheduled rotation |
| [245](#L245) | - Few minor bug fixes, cosmetic changes and code improvements |
| [246](#L246) |  |
| [247](#L247) | Ad Inserter 2.6.26 - 2021-05-27 |
| [248](#L248) | - Few bug fixes (Pro only) |
| [249](#L249) |  |
| [250](#L250) | Ad Inserter 2.6.25 - 2021-05-24 |
| [251](#L251) | - Added support for block names in adinserter shortcode block attributes |
| [252](#L252) | - Added support for browser language in client list (experimental) |
| [253](#L253) | - Added support for client-side checks for filter hook ai\_block\_insertion\_check (experimental) |
| [254](#L254) | - Added support for remote plugin managenent (Pro only, experimental) |
| [255](#L255) | - Added support for default custom field values |
| [256](#L256) | - Added support for scheduled rotation (experimental) |
| [257](#L257) | - Added support for scheduling check shortcode (Pro only, experimental) |
| [258](#L258) | - Added support for daily scheduling time (Pro only, experimental) |
| [259](#L259) | - Added support for css attribute in check options (Pro only, experimental) |
| [260](#L260) | - Added support to list range of post IDs |
| [261](#L261) | - Improved ad blocking detection |
| [262](#L262) | - Reduced layout shift when using CHECK shortcodes |
| [263](#L263) | - Fix for expanded shortcodes in the rotate code generator |
| [264](#L264) | - Few minor bug fixes, cosmetic changes and code improvements |
| [265](#L265) |  |
| [266](#L266) | Ad Inserter 2.6.24 - 2021-04-19 |
| [267](#L267) | - Added support for consent attribute for code generator for AdSense and Amazon AMP ads |
| [268](#L268) | - Added support for random number shortcode |
| [269](#L269) | - Added support for && and !! operators in client-side client list checks |
| [270](#L270) | - Added scheduling time on blocks list (Pro only) |
| [271](#L271) | - Improved undismissible message when ad blocking is detected |
| [272](#L272) | - Few minor bug fixes, cosmetic changes and code improvements |
| [273](#L273) |  |
| [274](#L274) | Ad Inserter 2.6.23 - 2021-03-17 |
| [275](#L275) | - Reduced layout shift when using lists and client-side dynamic blocks |
| [276](#L276) | - Few minor bug fixes, cosmetic changes and code improvements |
| [277](#L277) |  |
| [278](#L278) | Ad Inserter 2.6.22 - 2021-02-17 |
| [279](#L279) | - Various security fixes |
| [280](#L280) | - Updated AdSense API authorization process |
| [281](#L281) | - Reduced layout shift when using client-side device detection |
| [282](#L282) | - Added option to block IP addresses for click fraud protection (Pro only) |
| [283](#L283) | - Few minor bug fixes, cosmetic changes and code improvements |
| [284](#L284) |  |
| [285](#L285) | Ad Inserter 2.6.21 - 2021-01-24 |
| [286](#L286) | - Improved compatibility with PHP 8 |
| [287](#L287) | - Few minor bug fixes, cosmetic changes and code improvements |
| [288](#L288) |  |
| [289](#L289) | Ad Inserter 2.6.20 - 2021-01-06 |
| [290](#L290) | - Added support for alt text and lazy loading for banner code generator |
| [291](#L291) | - Few minor bug fixes, cosmetic changes and code improvements |
| [292](#L292) |  |
| [293](#L293) | Ad Inserter 2.6.19 - 2020-12-16 |
| [294](#L294) | - Improved code to reduce layout shift when using client-side device detection |
| [295](#L295) | - Added translation for es\_ES |
| [296](#L296) | - Added translation for fr\_FR |
| [297](#L297) | - Added translation for it\_IT |
| [298](#L298) | - Improved compatibility with PHP 8 |
| [299](#L299) | - Few minor bug fixes, cosmetic changes and code improvements |
| [300](#L300) |  |
| [301](#L301) | Ad Inserter 2.6.18 - 2020-11-21 |
| [302](#L302) | - Added support to change Dynamic blocks setting for adinserter PHP function call |
| [303](#L303) | - Few minor bug fixes, cosmetic changes and code improvements |
| [304](#L304) |  |
| [305](#L305) | Ad Inserter 2.6.17 - 2020-10-31 |
| [306](#L306) | - Fix for ADINSERTER shortcodes in block codes |
| [307](#L307) | - Fix for double client-side insertions when using geolocation (Pro only) |
| [308](#L308) |  |
| [309](#L309) | Ad Inserter 2.6.16 - 2020-10-20 |
| [310](#L310) | - Added support for ad blocking detection action every n pageviews |
| [311](#L311) | - Added support to individually disable pageview or click tracking (Pro only) |
| [312](#L312) | - Changed IAB TCF v2 cookie check name from euconsent-v2 to tcf-v2 (euconsent-v2 will still work) |
| [313](#L313) | - Fix for category check on category pages |
| [314](#L314) | - Fix for issues with Safari browser |
| [315](#L315) | - Few minor bug fixes, cosmetic changes and code improvements |
| [316](#L316) |  |
| [317](#L317) | Ad Inserter 2.6.15 - 2020-10-02 |
| [318](#L318) | - No ad blocking detection actions for crawlers and bots |
| [319](#L319) | - Fix for processing Ad Inserter shortcodes inside HTML tags |
| [320](#L320) | - Few minor bug fixes, cosmetic changes and code improvements |
| [321](#L321) |  |
| [322](#L322) | Ad Inserter 2.6.14 - 2020-09-07 |
| [323](#L323) | - Added support to insert [embed] shortcodes |
| [324](#L324) | - Few minor bug fixes, cosmetic changes and code improvements |
| [325](#L325) |  |
| [326](#L326) | Ad Inserter 2.6.13 - 2020-08-26 |
| [327](#L327) | - Few minor bug fixes |
| [328](#L328) |  |
| [329](#L329) | Ad Inserter 2.6.12 - 2020-08-23 |
| [330](#L330) | - Support for PHP 7.4 |
| [331](#L331) | - Improved ad blocking detection |
| [332](#L332) | - Added options to delay client-side insertions at HTML element |
| [333](#L333) | - Added support to check for multiple cookie values (needed for IAB TCF 2.0) |
| [334](#L334) | - Added filter hooks for block processing |
| [335](#L335) | - Few minor bug fixes, cosmetic changes and code improvements |
| [336](#L336) |  |
| [337](#L337) | Ad Inserter 2.6.11 - 2020-07-23 |
| [338](#L338) | - Added support for IAB Transparency & Consent Framework 2.0 |
| [339](#L339) | - Added support for taxonomy for primary category |
| [340](#L340) | - Added support for taxonomy for post meta data |
| [341](#L341) | - Added support to invert contain/do not contain text condition for paragraph counting |
| [342](#L342) | - Few minor bug fixes, cosmetic changes and code improvements |
| [343](#L343) |  |
| [344](#L344) | Ad Inserter 2.6.10 - 2020-06-25 |
| [345](#L345) | - Added user taxonomy items for logged-in and not logged-in users |
| [346](#L346) | - Added option to define tab setup delay (for the plugin settings page) |
| [347](#L347) | - Added option to insert unique ad rotation options when block is inserted more than once |
| [348](#L348) | - Added support for client-side device detection for AMP pages (for method Show) |
| [349](#L349) | - Added support for code generator for Amazon AMP ads |
| [350](#L350) | - Added support for custom tracking events (Pro only) |
| [351](#L351) | - Few minor bug fixes, cosmetic changes and code improvements |
| [352](#L352) |  |
| [353](#L353) | Ad Inserter 2.6.9 - 2020-05-22 |
| [354](#L354) | - Added option for paragraph counting to search only tag attributes for text |
| [355](#L355) | - Added option to embed block Javascript code (to be loaded with Ajax calls) |
| [356](#L356) | - Added support to prevent duplicate insertions when the\_content filter is called more than once (experimental) |
| [357](#L357) | - Added support for the client list to check for partial user agent strings |
| [358](#L358) | - Added support for check of cookie object properties |
| [359](#L359) | - Improved ad blocking detection |
| [360](#L360) | - Viewports no longer need to be in descending width order |
| [361](#L361) | - Added option to protect inserted block content (Pro only) |
| [362](#L362) | - Added support for adb scripts path filter hook (Pro only) |
| [363](#L363) | - Added support to export statistics data to CSV file (Pro only) |
| [364](#L364) | - Few minor bug fixes, cosmetic changes and code improvements |
| [365](#L365) |  |
| [366](#L366) | \*/ |
| [367](#L367) |  |
| [368](#L368) | use Detection\MobileDetect; |
| [369](#L369) |  |
| [370](#L370) | if (!defined ('ABSPATH')) exit; |
| [371](#L371) |  |
| [372](#L372) | if (!defined ('AD\_INSERTER\_VERSION')) { |
| [373](#L373) |  |
| [374](#L374) | function ai\_wp\_default\_editor () { |
| [375](#L375) | return 'tinymce'; |
| [376](#L376) | } |
| [377](#L377) |  |
| [378](#L378) | function ai\_wp\_default\_editor\_html () { |
| [379](#L379) | return 'html'; |
| [380](#L380) | } |
| [381](#L381) |  |
| [382](#L382) | function ai\_disable\_caching () { |
| [383](#L383) | // WP Super Cache, W3 Total Cache, WP Rocket |
| [384](#L384) | if (!defined('DONOTCACHEPAGE')) |
| [385](#L385) | define('DONOTCACHEPAGE', true); |
| [386](#L386) |  |
| [387](#L387) | if (!defined('DONOTCACHEOBJECT')) |
| [388](#L388) | define('DONOTCACHEOBJECT', true); |
| [389](#L389) |  |
| [390](#L390) | if (!defined('DONOTCACHEDB')) |
| [391](#L391) | define('DONOTCACHEDB', true); |
| [392](#L392) |  |
| [393](#L393) | // LiteSpeed Cache |
| [394](#L394) | do\_action ('litespeed\_control\_set\_nocache', /\* translators: %s: Ad Inserter \*/ sprintf (\_\_('Caching disabled by %s settings', 'ad-inserter'), AD\_INSERTER\_NAME)); |
| [395](#L395) |  |
| [396](#L396) | // WP Fastest Cache |
| [397](#L397) | if (function\_exists ('wpfc\_exclude\_current\_page')) { |
| [398](#L398) | wpfc\_exclude\_current\_page (); |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) | if (!headers\_sent () && !is\_user\_logged\_in ()) { |
| [402](#L402) | header('Cache-Control: private, proxy-revalidate, s-maxage=0'); |
| [403](#L403) | } |
| [404](#L404) | } |
| [405](#L405) |  |
| [406](#L406) | function ai\_toolbar\_menu\_items () { |
| [407](#L407) | global $block\_object, $ai\_wp\_data; |
| [408](#L408) |  |
| [409](#L409) | if (isset ($ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS])) return; |
| [410](#L410) |  |
| [411](#L411) | $disable\_block\_insertions = get\_disable\_block\_insertions (); |
| [412](#L412) | $disable\_php\_processing   = get\_disable\_php\_processing (); |
| [413](#L413) | $disable\_html\_code         = get\_disable\_html\_code (); |
| [414](#L414) | $disable\_css\_code         = get\_disable\_css\_code (); |
| [415](#L415) | $disable\_js\_code          = get\_disable\_js\_code (); |
| [416](#L416) | $disable\_footer\_code      = get\_disable\_footer\_code (); |
| [417](#L417) | $disable\_header\_code      = get\_disable\_header\_code (); |
| [418](#L418) |  |
| [419](#L419) | $statuses =  '<span class="ai-insertion-status"'. ($disable\_header\_code ? ' style="color: #f22"' : '') . '">H</span> &nbsp; '; |
| [420](#L420) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_footer\_code ? ' style="color: #f22"' : '') . '">F</span> &nbsp; '; |
| [421](#L421) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_js\_code ? ' style="color: #f22"' : '') . '">JS</span> &nbsp; '; |
| [422](#L422) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_css\_code ? ' style="color: #f22"' : '') . '">CSS</span> &nbsp; '; |
| [423](#L423) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_html\_code ? ' style="color: #f22"' : '') . '">HTML</span> &nbsp; '; |
| [424](#L424) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_php\_processing ? ' style="color: #f22"' : '') . '">PHP</span> &nbsp; '; |
| [425](#L425) | $statuses .= '<span class="ai-insertion-status"'. ($disable\_block\_insertions ? ' style="color: #f22"' : '') . '">BLOCKS</span>'; |
| [426](#L426) |  |
| [427](#L427) | $insertion\_disabled = $disable\_block\_insertions || $disable\_php\_processing || $disable\_html\_code || $disable\_css\_code || $disable\_js\_code || $disable\_footer\_code || $disable\_header\_code; |
| [428](#L428) |  |
| [429](#L429) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS] = array (); |
| [430](#L430) |  |
| [431](#L431) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) == 0) $debug\_blocks = 1; else $debug\_blocks = 0; |
| [432](#L432) | $debug\_blocks\_class = $debug\_blocks == 0 ? ' on' : ''; |
| [433](#L433) |  |
| [434](#L434) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) == 0) $debug\_positions = 0; else $debug\_positions = ''; |
| [435](#L435) | $debug\_positions\_class = $debug\_positions === '' ? ' on' : ''; |
| [436](#L436) |  |
| [437](#L437) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_TAGS) == 0) $debug\_tags = 1; else $debug\_tags = 0; |
| [438](#L438) | $debug\_tags\_class = $debug\_tags == 0 ? ' on' : ''; |
| [439](#L439) |  |
| [440](#L440) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) == 0) $debug\_processing = 1; else $debug\_processing = 0; |
| [441](#L441) | $debug\_processing\_class = $debug\_processing == 0 ? ' on' : ''; |
| [442](#L442) |  |
| [443](#L443) | if (!isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE\_]) || $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE\_] == 0) $debug\_processing\_fe = 1; else $debug\_processing\_fe = 0; |
| [444](#L444) | $debug\_processing\_\_fe\_class = $debug\_processing\_fe == 0 ? ' on' : ''; |
| [445](#L445) |  |
| [446](#L446) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_NO\_INSERTION) == 0) $debug\_no\_insertion = 1; else $debug\_no\_insertion = 0; |
| [447](#L447) | $debug\_no\_insertion\_class = $debug\_no\_insertion == 0 ? ' on' : ''; |
| [448](#L448) |  |
| [449](#L449) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_AD\_BLOCKING) == 0) $debug\_ad\_blocking = 1; else $debug\_ad\_blocking = 0; |
| [450](#L450) | $debug\_ad\_blocking\_class = $debug\_ad\_blocking == 0 ? ' on' : ''; |
| [451](#L451) |  |
| [452](#L452) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_AD\_BLOCKING\_STATUS) == 0) $debug\_ad\_blocking\_status = 1; else $debug\_ad\_blocking\_status = 0; |
| [453](#L453) | $debug\_ad\_blocking\_status\_class = $debug\_ad\_blocking\_status == 0 ? ' on' : ''; |
| [454](#L454) |  |
| [455](#L455) | $debug\_settings\_on = $debug\_blocks == 0 || $debug\_positions === '' || $debug\_tags == 0 || $debug\_processing == 0 || $debug\_no\_insertion == 0 || $debug\_ad\_blocking == 0 || $debug\_ad\_blocking\_status == 0; |
| [456](#L456) |  |
| [457](#L457) | $debug\_settings\_class = $debug\_settings\_on ? ' on' : ''; |
| [458](#L458) | if ($insertion\_disabled) $debug\_settings\_class .= ' red'; |
| [459](#L459) |  |
| [460](#L460) | //  $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [461](#L461) | //  $settings\_link = '<a href="'.admin\_url ($settings\_page).'">'.\_x('Settings', 'Menu item', 'ad-inserter') . '</a>'; |
| [462](#L462) |  |
| [463](#L463) | if (defined ('AI\_DEBUGGING\_DEMO')) { |
| [464](#L464) | $top\_menu\_url = $debug\_settings\_on ? get\_permalink () : |
| [465](#L465) | add\_query\_arg (array (AI\_URL\_DEBUG\_BLOCKS => '1', AI\_URL\_DEBUG\_POSITIONS => '0'), remove\_debug\_parameters\_from\_url ()); |
| [466](#L466) | } else { |
| [467](#L467) | $top\_menu\_url = admin\_url (get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'); |
| [468](#L468) | } |
| [469](#L469) |  |
| [470](#L470) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [471](#L471) | 'id' => 'ai-toolbar', |
| [472](#L472) | 'group' => true |
| [473](#L473) | ); |
| [474](#L474) |  |
| [475](#L475) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [476](#L476) | 'id' => 'ai-toolbar-settings', |
| [477](#L477) | //    'parent' => 'ai-toolbar', |
| [478](#L478) | //    'title' => '<span class="ab-icon'.$debug\_settings\_class.'"></span>'.AD\_INSERTER\_NAME . (defined ('AI\_DEBUGGING\_DEMO') ? ' Debugging DEMO' : ($debug\_settings\_on ? ' Debugging' : '')), |
| [479](#L479) | 'title' => '<span class="ab-icon'.$debug\_settings\_class.'"></span>'.AD\_INSERTER\_NAME . (defined ('AI\_DEBUGGING\_DEMO') ? ' ' . \_x('Debugging DEMO', 'Menu item', 'ad-inserter') : ($debug\_settings\_on ? '' : '')), |
| [480](#L480) | 'href' => $top\_menu\_url, |
| [481](#L481) | //    'meta' => $debug\_settings\_on ? array ('title' => 'Turn Debugging Off') : array (), |
| [482](#L482) | ); |
| [483](#L483) |  |
| [484](#L484) | if ($insertion\_disabled) { |
| [485](#L485) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [486](#L486) | 'id' => 'ai-toolbar-status', |
| [487](#L487) | 'parent' => 'ai-toolbar-settings', |
| [488](#L488) | 'title' => '&nbsp;'.$statuses, |
| [489](#L489) | ); |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | if ($debug\_settings\_on) { |
| [493](#L493) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [494](#L494) | 'id' => 'ai-toolbar-off', |
| [495](#L495) | 'parent' => 'ai-toolbar-settings', |
| [496](#L496) | 'title' => '<span class="ab-icon"></span>' . \_x('Disable Debugging', 'Menu item, to disable debugging', 'ad-inserter'), |
| [497](#L497) | 'href' => add\_query\_arg (AI\_URL\_DEBUG, '0', remove\_debug\_parameters\_from\_url ()), |
| [498](#L498) | ); |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [502](#L502) | 'id' => 'ai-toolbar-blocks', |
| [503](#L503) | 'parent' => 'ai-toolbar-settings', |
| [504](#L504) | 'title' => '<span class="ab-icon'.$debug\_blocks\_class.'"></span>' . \_x('Label Blocks', 'Menu item, to label blocks', 'ad-inserter'), |
| [505](#L505) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_BLOCKS, $debug\_blocks), |
| [506](#L506) | ); |
| [507](#L507) |  |
| [508](#L508) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [509](#L509) | 'id' => 'ai-toolbar-positions', |
| [510](#L510) | 'parent' => 'ai-toolbar-settings', |
| [511](#L511) | 'title' => '<span class="ab-icon'.$debug\_positions\_class.'"></span>' . \_x('Show Positions', 'Menu item', 'ad-inserter'), |
| [512](#L512) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_POSITIONS, $debug\_positions), |
| [513](#L513) | ); |
| [514](#L514) |  |
| [515](#L515) | $paragraph\_blocks = array (); |
| [516](#L516) | for ($block = 0; $block <= 96; $block ++) { |
| [517](#L517) | $obj = $block\_object [$block]; |
| [518](#L518) | $automatic\_insertion = $obj->get\_automatic\_insertion(); |
| [519](#L519) | if ($block == 0 || !$obj->get\_disable\_insertion () && ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_BEFORE\_PARAGRAPH || $automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_AFTER\_PARAGRAPH)) { |
| [520](#L520) |  |
| [521](#L521) | $block\_tags             = trim ($block\_object [$block]->get\_paragraph\_tags ()); |
| [522](#L522) | $direction              = $block\_object [$block]->get\_direction\_type() == AI\_DIRECTION\_FROM\_TOP ? 't' : 'b'; |
| [523](#L523) | $paragraph\_min\_words    = intval ($obj->get\_minimum\_paragraph\_words()); |
| [524](#L524) | $paragraph\_max\_words    = intval ($obj->get\_maximum\_paragraph\_words()); |
| [525](#L525) | $paragraph\_text\_type    = $obj->get\_paragraph\_text\_type (); |
| [526](#L526) | $paragraph\_text         = trim (html\_entity\_decode ($obj->get\_paragraph\_text())); |
| [527](#L527) | $inside\_blockquote      = $obj->get\_count\_inside\_blockquote (); |
| [528](#L528) | $count\_inside\_type      = $obj->get\_count\_inside (); |
| [529](#L529) | $count\_inside\_elements  = $obj->get\_count\_inside\_elements (); |
| [530](#L530) | $that\_contain\_type      = $obj->get\_count\_inside\_elements\_contain (); |
| [531](#L531) | $that\_contain\_text      = trim (html\_entity\_decode ($obj->get\_count\_inside\_elements\_text ())); |
| [532](#L532) |  |
| [533](#L533) | if ($block\_tags != '') { |
| [534](#L534) | $found = false; |
| [535](#L535) | foreach ($paragraph\_blocks as $index => $paragraph\_block) { |
| [536](#L536) | if ($paragraph\_block ['tags']           == $block\_tags && |
| [537](#L537) | $paragraph\_block ['direction']      == $direction && |
| [538](#L538) | $paragraph\_block ['min']            == $paragraph\_min\_words && |
| [539](#L539) | $paragraph\_block ['max']            == $paragraph\_max\_words && |
| [540](#L540) | $paragraph\_block ['text\_type']      == $paragraph\_text\_type && |
| [541](#L541) | $paragraph\_block ['text']           == $paragraph\_text && |
| [542](#L542) | $paragraph\_block ['blockquote']     == $inside\_blockquote && |
| [543](#L543) | $paragraph\_block ['inside\_type']    == $count\_inside\_type && |
| [544](#L544) | $paragraph\_block ['inside\_elemets'] == $count\_inside\_elements && |
| [545](#L545) | $paragraph\_block ['contain\_type']   == $that\_contain\_type && |
| [546](#L546) | $paragraph\_block ['contain\_text']   == $that\_contain\_text |
| [547](#L547) | ) { |
| [548](#L548) | $found = true; |
| [549](#L549) | break; |
| [550](#L550) | } |
| [551](#L551) | } |
| [552](#L552) | if ($found) array\_push ($paragraph\_blocks [$index]['blocks'], $block); else |
| [553](#L553) | $paragraph\_blocks []= array ('blocks' => array ($block), |
| [554](#L554) | 'tags'            => $block\_tags, |
| [555](#L555) | 'direction'       => $direction, |
| [556](#L556) | 'min'             => $paragraph\_min\_words, |
| [557](#L557) | 'max'             => $paragraph\_max\_words, |
| [558](#L558) | 'text\_type'       => $paragraph\_text\_type, |
| [559](#L559) | 'text'            => $paragraph\_text, |
| [560](#L560) | 'blockquote'      => $inside\_blockquote, |
| [561](#L561) | 'inside\_type'     => $count\_inside\_type, |
| [562](#L562) | 'inside\_elemets'  => $count\_inside\_elements, |
| [563](#L563) | 'contain\_type'    => $that\_contain\_type, |
| [564](#L564) | 'contain\_text'    => $that\_contain\_text, |
| [565](#L565) | ); |
| [566](#L566) | } |
| [567](#L567) | } |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) | $no\_paragraph\_counting\_inside = get\_no\_paragraph\_counting\_inside (); |
| [571](#L571) |  |
| [572](#L572) | foreach ($paragraph\_blocks as $index => $paragraph\_block) { |
| [573](#L573) | $debug\_block\_active = $debug\_positions === '' && in\_array ($ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK], $paragraph\_block ['blocks']); |
| [574](#L574) | $block\_class = $debug\_block\_active ? ' on' : ''; |
| [575](#L575) | //    $block\_class = $debug\_positions === '' && in\_array ($ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK], $paragraph\_block ['blocks']) ? ' on' : ''; |
| [576](#L576) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [577](#L577) | 'id' => 'ai-toolbar-positions-'.$index, |
| [578](#L578) | 'parent' => 'ai-toolbar-positions', |
| [579](#L579) | 'title' => '<span class="ab-icon'.$block\_class.'"></span>'. |
| [580](#L580) | $paragraph\_block ['tags']. |
| [581](#L581) | ($paragraph\_block ['direction'] == 'b' ? ' <span class="dashicons dashicons-arrow-up-alt up-icon"></span>' : ''). |
| [582](#L582) | ($paragraph\_block ['min'] != 0 ? ' min '.$paragraph\_block ['min']. ' ' : ''). |
| [583](#L583) | ($paragraph\_block ['max'] != 0 ? ' max '.$paragraph\_block ['max']. ' ' : ''). |
| [584](#L584) | ($paragraph\_block ['blockquote']  ? ' +[' . $no\_paragraph\_counting\_inside . '] ' : ''). |
| [585](#L585) | ($paragraph\_block ['text'] != '' ? ($paragraph\_block ['text\_type'] == AI\_DO\_NOT\_CONTAIN ? ' !has ' : ' has ').' ['.htmlentities ($paragraph\_block ['text']).']' : ''). |
| [586](#L586) | ($paragraph\_block ['inside\_elemets'] != '' ? ($paragraph\_block ['inside\_type'] == AI\_COUNT\_ONLY ? ' insEL' : ' !insEL ').' ['.$paragraph\_block ['inside\_elemets'].']' : ''). |
| [587](#L587) | ($paragraph\_block ['contain\_text'] != '' ? ($paragraph\_block ['contain\_type'] == AI\_CONTAIN ? ' elHAS' : ' !elHAS ').' ['.htmlentities ($paragraph\_block ['contain\_text']).']' : ''), |
| [588](#L588) |  |
| [589](#L589) | //      'href' => set\_url\_parameter (AI\_URL\_DEBUG\_POSITIONS, $paragraph\_block ['blocks'][0]), |
| [590](#L590) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_POSITIONS, $debug\_block\_active ? '' : $paragraph\_block ['blocks'][0]), |
| [591](#L591) | ); |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [595](#L595) | 'id' => 'ai-toolbar-tags', |
| [596](#L596) | 'parent' => 'ai-toolbar-settings', |
| [597](#L597) | 'title' => '<span class="ab-icon'.$debug\_tags\_class.'"></span>' . \_x('Show HTML Tags', 'Menu item', 'ad-inserter'), |
| [598](#L598) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_TAGS, $debug\_tags), |
| [599](#L599) | ); |
| [600](#L600) |  |
| [601](#L601) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [602](#L602) | 'id' => 'ai-toolbar-no-insertion', |
| [603](#L603) | 'parent' => 'ai-toolbar-settings', |
| [604](#L604) | 'title' => '<span class="ab-icon'.$debug\_no\_insertion\_class.'"></span>' . \_x('Disable Insertion', 'Menu item', 'ad-inserter'), |
| [605](#L605) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_NO\_INSERTION, $debug\_no\_insertion), |
| [606](#L606) | ); |
| [607](#L607) |  |
| [608](#L608) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [609](#L609) | if ($ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [610](#L610) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [611](#L611) | 'id' => 'ai-toolbar-adb-status', |
| [612](#L612) | 'parent' => 'ai-toolbar-settings', |
| [613](#L613) | 'title' => '<span class="ab-icon'.$debug\_ad\_blocking\_status\_class.'"></span>' . \_x('Ad Blocking Status', 'Menu item', 'ad-inserter'), |
| [614](#L614) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_AD\_BLOCKING\_STATUS, $debug\_ad\_blocking\_status), |
| [615](#L615) | ); |
| [616](#L616) |  |
| [617](#L617) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [618](#L618) | 'id' => 'ai-toolbar-adb', |
| [619](#L619) | 'parent' => 'ai-toolbar-settings', |
| [620](#L620) | 'title' => '<span class="ab-icon'.$debug\_ad\_blocking\_class.'"></span>' . \_x('Simulate Ad Blocking', 'Menu item', 'ad-inserter'), |
| [621](#L621) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_AD\_BLOCKING, $debug\_ad\_blocking), |
| [622](#L622) | ); |
| [623](#L623) | } |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) | if (!defined ('AI\_DEBUGGING\_DEMO')) { |
| [627](#L627) |  |
| [628](#L628) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [629](#L629) | 'id' => 'ai-toolbar-processing', |
| [630](#L630) | 'parent' => 'ai-toolbar-settings', |
| [631](#L631) | 'title' => '<span class="ab-icon'.$debug\_processing\_class.'"></span>' . \_x('Log Processing', 'Menu item', 'ad-inserter'), |
| [632](#L632) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_PROCESSING, $debug\_processing), |
| [633](#L633) | ); |
| [634](#L634) |  |
| [635](#L635) | $ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS][] = array ( |
| [636](#L636) | 'id' => 'ai-toolbar-processing-fe', |
| [637](#L637) | 'parent' => 'ai-toolbar-processing', |
| [638](#L638) | 'title' => '<span class="ab-icon'.$debug\_processing\_\_fe\_class.'"></span>' . \_x('Show Log', 'Menu item', 'ad-inserter'), |
| [639](#L639) | 'href' => set\_url\_parameter (AI\_URL\_DEBUG\_PROCESSING\_FE, $debug\_processing\_fe), |
| [640](#L640) | ); |
| [641](#L641) | } |
| [642](#L642) | } |
| [643](#L643) |  |
| [644](#L644) | function ai\_toolbar ($wp\_admin\_bar) { |
| [645](#L645) | global $ai\_wp\_data; |
| [646](#L646) |  |
| [647](#L647) | ai\_toolbar\_menu\_items (); |
| [648](#L648) |  |
| [649](#L649) | foreach ($ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS] as $menu\_item) { |
| [650](#L650) | $wp\_admin\_bar->add\_node ($menu\_item); |
| [651](#L651) | } |
| [652](#L652) | } |
| [653](#L653) |  |
| [654](#L654) | function set\_user () { |
| [655](#L655) | global $ai\_wp\_data; |
| [656](#L656) |  |
| [657](#L657) | if ($ai\_wp\_data [AI\_WP\_USER\_SET]) return; |
| [658](#L658) |  |
| [659](#L659) | if (is\_user\_logged\_in ())       $ai\_wp\_data [AI\_WP\_USER] |= AI\_USER\_LOGGED\_IN; |
| [660](#L660) | if (current\_user\_role () >= 5)  $ai\_wp\_data [AI\_WP\_USER] |= AI\_USER\_ADMINISTRATOR; |
| [661](#L661) |  |
| [662](#L662) | //  if (isset ($\_GET [AI\_URL\_DEBUG\_USER]) && $\_GET [AI\_URL\_DEBUG\_USER] != 0) $ai\_wp\_data [AI\_WP\_USER] = $\_GET [AI\_URL\_DEBUG\_USER]; |
| [663](#L663) |  |
| [664](#L664) | $ai\_wp\_data [AI\_WP\_USER\_SET] = true; |
| [665](#L665) | } |
| [666](#L666) |  |
| [667](#L667) |  |
| [668](#L668) | if (!function\_exists ('is\_rest')) { |
| [669](#L669) | /\*\* |
| [670](#L670) | \* Checks if the current request is a WP REST API request. |
| [671](#L671) | \* |
| [672](#L672) | \* Case #1: After WP\_REST\_Request initialisation |
| [673](#L673) | \* Case #2: Support "plain" permalink settings and check if `rest\_route` starts with `/` |
| [674](#L674) | \* Case #3: It can happen that WP\_Rewrite is not yet initialized, |
| [675](#L675) | \*          so do this (wp-settings.php) |
| [676](#L676) | \* Case #4: URL Path begins with wp-json/ (your REST prefix) |
| [677](#L677) | \*          Also supports WP installations in subfolders |
| [678](#L678) | \* |
| [679](#L679) | \* @returns boolean |
| [680](#L680) | \* @author matzeeable |
| [681](#L681) | \*/ |
| [682](#L682) | function is\_rest () { |
| [683](#L683) | if (defined('REST\_REQUEST') && REST\_REQUEST // (#1) |
| [684](#L684) | || isset($\_GET['rest\_route']) // (#2) |
| [685](#L685) | && strpos( $\_GET['rest\_route'], '/', 0 ) === 0) |
| [686](#L686) | return true; |
| [687](#L687) |  |
| [688](#L688) | // (#3) |
| [689](#L689) | global $wp\_rewrite; |
| [690](#L690) | if ($wp\_rewrite === null) $wp\_rewrite = new WP\_Rewrite(); |
| [691](#L691) |  |
| [692](#L692) | // (#4) |
| [693](#L693) | $rest\_url = wp\_parse\_url (trailingslashit (rest\_url ())); |
| [694](#L694) | $current\_url = wp\_parse\_url (add\_query\_arg (array ())); |
| [695](#L695) |  |
| [696](#L696) | if (!isset ($rest\_url ['path'])) { |
| [697](#L697) | return false; |
| [698](#L698) | } |
| [699](#L699) | // PHP 7 |
| [700](#L700) | //        return strpos( $current\_url['path'] ?? '/', $rest\_url['path'], 0 ) === 0; |
| [701](#L701) | return strpos ((isset ($current\_url ['path']) && $current\_url ['path'] != NULL ? $current\_url ['path'] : '/'), $rest\_url ['path'], 0) === 0; |
| [702](#L702) |  |
| [703](#L703) | } |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) | function set\_page\_type () { |
| [707](#L707) | global $ai\_wp\_data, $wp\_query; |
| [708](#L708) |  |
| [709](#L709) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_NONE) return; |
| [710](#L710) |  |
| [711](#L711) | if (is\_front\_page ())                                         $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_HOMEPAGE; |
| [712](#L712) | elseif (is\_single())                                              $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_POST; |
| [713](#L713) | elseif (is\_page())                                                $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_STATIC; |
| [714](#L714) | elseif (is\_feed())                                                $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_FEED; |
| [715](#L715) | elseif (is\_category())                                            $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_CATEGORY; |
| [716](#L716) | elseif (is\_archive() || (is\_home () && !is\_front\_page ()))        $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_ARCHIVE; |
| [717](#L717) | elseif (is\_admin())                                               $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_ADMIN;  // Admin pages may also be search pages or ajax requests |
| [718](#L718) | elseif (is\_search())                                              $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_SEARCH; |
| [719](#L719) | elseif (is\_404())                                                 $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_404; |
| [720](#L720) |  |
| [721](#L721) | if ( |
| [722](#L722) | // AMP, AMP WP |
| [723](#L723) | function\_exists ('is\_amp\_endpoint') && is\_amp\_endpoint () || |
| [724](#L724) |  |
| [725](#L725) | // AMP WP |
| [726](#L726) | function\_exists ('is\_amp\_wp') && is\_amp\_wp ($wp\_query) || |
| [727](#L727) |  |
| [728](#L728) | // AMP for WP - Accelerated Mobile Pages for WordPress |
| [729](#L729) | function\_exists ('ampforwp\_is\_amp\_endpoint') && ampforwp\_is\_amp\_endpoint () || |
| [730](#L730) |  |
| [731](#L731) | // WP AMP Ninja |
| [732](#L732) | isset ($\_GET ['wpamp']) || |
| [733](#L733) |  |
| [734](#L734) | // WP AMP - Accelerated Mobile Pages for WordPress |
| [735](#L735) | function\_exists ('is\_wp\_amp') && is\_wp\_amp () || |
| [736](#L736) |  |
| [737](#L737) | // Better AMP - WordPress Complete AMP |
| [738](#L738) | function\_exists ('is\_better\_amp') && is\_better\_amp ($wp\_query) || |
| [739](#L739) |  |
| [740](#L740) | // PenCi Soledad AMP - WordPress Complete AMP |
| [741](#L741) | function\_exists ('is\_penci\_amp') && is\_penci\_amp ($wp\_query) |
| [742](#L742) | ) { |
| [743](#L743) | $ai\_wp\_data [AI\_WP\_AMP\_PAGE] = true; |
| [744](#L744) | define ('AI\_AMP\_PAGE', true); |
| [745](#L745) | } |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | function ai\_log\_message ($message) { |
| [749](#L749) | global $ai\_last\_time, $ai\_processing\_log; |
| [750](#L750) | $ai\_processing\_log []= rtrim (sprintf ("%4d  %-50s", (microtime (true) - $ai\_last\_time) \* 1000, $message)); |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) | function ai\_log\_filter\_content ($content\_string) { |
| [754](#L754) |  |
| [755](#L755) | $content\_string = preg\_replace ("/\[\[AI\_[A|B]P([\d].?)\]\]/", "", $content\_string); |
| [756](#L756) | return str\_replace (array ("<!--", "-->", "\n", "\r"), array ("<!++", "++>", "\*n", "\*r"), $content\_string); |
| [757](#L757) | } |
| [758](#L758) |  |
| [759](#L759) | function ai\_log\_content (&$content) { |
| [760](#L760) | if (strlen ($content) < 100) ai\_log (ai\_log\_filter\_content ($content) . '  ['.number\_of\_words ($content).' words]'); else |
| [761](#L761) | ai\_log (ai\_log\_filter\_content (html\_entity\_decode (substr ($content, 0, 60))) . ' ... ' . ai\_log\_filter\_content (html\_entity\_decode (substr ($content, - 60))) . '  ['.number\_of\_words ($content).' words]'); |
| [762](#L762) | } |
| [763](#L763) |  |
| [764](#L764) | function ai\_filter\_code ($code) { |
| [765](#L765) | $code = preg\_replace ("/\[\[AI\_[A|B]P([\d].?)\]\]/", "", $code); |
| [766](#L766) | return str\_replace (array ("<!--", "-->"), array ("<!++", "++>"), $code); |
| [767](#L767) | } |
| [768](#L768) |  |
| [769](#L769) | function ai\_dump\_code ($code, $max\_size = 0) { |
| [770](#L770) | if ($max\_size == 0) return ai\_filter\_code ($code); else |
| [771](#L771) | if ($max\_size != 0 && strlen ($code) < $max\_size) return ai\_filter\_code ($code); else |
| [772](#L772) | return ai\_filter\_code (html\_entity\_decode (substr ($code, 0, 120))) . ' ... ' . ai\_filter\_code (html\_entity\_decode (substr ($code, - 120))); |
| [773](#L773) | } |
| [774](#L774) |  |
| [775](#L775) | function ai\_block\_insertion\_status ($block, $ai\_last\_check) { |
| [776](#L776) | global $block\_object; |
| [777](#L777) |  |
| [778](#L778) | if ($block < 1 || $block > 96) $block = 0; |
| [779](#L779) |  |
| [780](#L780) | if ($ai\_last\_check == AI\_CHECK\_INSERTED) return "INSERTED"; |
| [781](#L781) | $status = "FAILED CHECK: "; |
| [782](#L782) | $obj = $block\_object [$block]; |
| [783](#L783) | switch ($ai\_last\_check) { |
| [784](#L784) | case AI\_CHECK\_PAGE\_TYPE\_FRONT\_PAGE:  $status .= "ENABLED ON HOMEPAGE"; break; |
| [785](#L785) | case AI\_CHECK\_PAGE\_TYPE\_STATIC\_PAGE: $status .= "ENABLED ON STATIC PAGE"; break; |
| [786](#L786) | case AI\_CHECK\_PAGE\_TYPE\_POST:        $status .= "ENABLED ON POST"; break; |
| [787](#L787) | case AI\_CHECK\_PAGE\_TYPE\_CATEGORY:    $status .= "ENABLED ON CATEGORY"; break; |
| [788](#L788) | case AI\_CHECK\_PAGE\_TYPE\_SEARCH:      $status .= "ENABLED ON SEARCH"; break; |
| [789](#L789) | case AI\_CHECK\_PAGE\_TYPE\_ARCHIVE:     $status .= "ENABLED ON ARCHIVE"; break; |
| [790](#L790) | case AI\_CHECK\_PAGE\_TYPE\_FEED:        $status .= "ENABLED ON FEED"; break; |
| [791](#L791) | case AI\_CHECK\_PAGE\_TYPE\_404:         $status .= "ENABLED ON 404"; break; |
| [792](#L792) |  |
| [793](#L793) | case AI\_CHECK\_DESKTOP\_DEVICES:          $status .= "DESKTOP DEVICES"; break; |
| [794](#L794) | case AI\_CHECK\_MOBILE\_DEVICES:           $status .= "MOBILE DEVICES"; break; |
| [795](#L795) | case AI\_CHECK\_TABLET\_DEVICES:           $status .= "TABLET DEVICES"; break; |
| [796](#L796) | case AI\_CHECK\_PHONE\_DEVICES:            $status .= "PHONE DEVICES"; break; |
| [797](#L797) | case AI\_CHECK\_DESKTOP\_TABLET\_DEVICES:   $status .= "DESKTOP TABLET DEVICES"; break; |
| [798](#L798) | case AI\_CHECK\_DESKTOP\_PHONE\_DEVICES:    $status .= "DESKTOP PHONE DEVICES"; break; |
| [799](#L799) |  |
| [800](#L800) | case AI\_CHECK\_CATEGORY:                 $status .= "CATEGORY"; break; |
| [801](#L801) | case AI\_CHECK\_TAG:                      $status .= "TAG"; break; |
| [802](#L802) | case AI\_CHECK\_TAXONOMY:                 $status .= "TAXONOMY"; break; |
| [803](#L803) | case AI\_CHECK\_ID:                       $status .= "ID"; break; |
| [804](#L804) | case AI\_CHECK\_URL:                      $status .= "URL"; break; |
| [805](#L805) | case AI\_CHECK\_URL\_PARAMETER:            $status .= "URL PARAMETER"; break; |
| [806](#L806) | case AI\_CHECK\_COOKIE:                   $status .= "COOKIE"; break; |
| [807](#L807) | case AI\_CHECK\_REFERER:                  $status .= "REFERRER ". $obj->get\_ad\_domain\_list(); break; |
| [808](#L808) | case AI\_CHECK\_CLIENT:                   $status .= "CLIENT ". $obj->get\_client\_list(); break; |
| [809](#L809) | case AI\_CHECK\_IP\_ADDRESS:               $status .= "IP ADDRESS ". $obj->get\_ad\_ip\_address\_list(); break; |
| [810](#L810) | case AI\_CHECK\_COUNTRY:                  $status .= "COUNTRY ". $obj->get\_ad\_country\_list (true); break; |
| [811](#L811) |  |
| [812](#L812) | case AI\_CHECK\_SCHEDULING:               $status .= "SCHEDULING"; break; |
| [813](#L813) | case AI\_CHECK\_CODE:                     $status .= "CODE EMPTY"; break; |
| [814](#L814) | case AI\_CHECK\_LOGGED\_IN\_USER:           $status .= "LOGGED-IN USER"; break; |
| [815](#L815) | case AI\_CHECK\_NOT\_LOGGED\_IN\_USER:       $status .= "NOT LOGGED-IN USER"; break; |
| [816](#L816) | case AI\_CHECK\_ADMINISTRATOR:            $status .= "ADMINISTRATOR"; break; |
| [817](#L817) |  |
| [818](#L818) | case AI\_CHECK\_INDIVIDUALLY\_DISABLED:    $status .= "INDIVIDUALLY DISABLED"; break; |
| [819](#L819) | case AI\_CHECK\_INDIVIDUALLY\_ENABLED:     $status .= "INDIVIDUALLY ENABLED"; break; |
| [820](#L820) | case AI\_CHECK\_DISABLED\_MANUALLY:        $status .= "DISABLED BY SHORTCODE"; break; |
| [821](#L821) |  |
| [822](#L822) | case AI\_CHECK\_MAX\_INSERTIONS:           $status .= "MAX INSERTIONS " . $obj->get\_maximum\_insertions (); break; |
| [823](#L823) | case AI\_CHECK\_MAX\_PAGE\_BLOCKS:          $status .= "MAX PAGE BLOCKS " . get\_max\_page\_blocks (); break; |
| [824](#L824) | case AI\_CHECK\_FILTER:                   $status .= ($obj->get\_inverted\_filter() ? 'INVERTED ' : '') . "FILTER " . $obj->get\_call\_filter(); break; |
| [825](#L825) | case AI\_CHECK\_PARAGRAPH\_COUNTING:       $status .= "PARAGRAPH COUNTING"; break; |
| [826](#L826) | case AI\_CHECK\_IMAGE\_COUNTING:           $status .= "IMAGE COUNTING"; break; |
| [827](#L827) | case AI\_CHECK\_MIN\_NUMBER\_OF\_WORDS:      $status .= "MIN NUMBER OF WORDS " . intval ($obj->get\_minimum\_words()); break; |
| [828](#L828) | case AI\_CHECK\_MAX\_NUMBER\_OF\_WORDS:      $status .= "MAX NUMBER OF WORDS " . (intval ($obj->get\_maximum\_words()) == 0 ? 1000000 : intval ($obj->get\_maximum\_words())); break; |
| [829](#L829) | case AI\_CHECK\_DEBUG\_NO\_INSERTION:       $status .= "DEBUG NO INSERTION"; break; |
| [830](#L830) | case AI\_CHECK\_MAX\_IMPRESSIONS:          $status .= "MAX IMPRESSIONS"; break; |
| [831](#L831) | case AI\_CHECK\_LIMIT\_IMPRESSIONS\_PER\_TIME\_PERIOD: $status .= "LIMIT IMPRESSIONS PER TIME PERIOD"; break; |
| [832](#L832) | case AI\_CHECK\_MAX\_CLICKS:               $status .= "MAX CLICKS"; break; |
| [833](#L833) | case AI\_CHECK\_LIMIT\_CLICKS\_PER\_TIME\_PERIOD:      $status .= "LIMIT CLICKS PER TIME PERIOD"; break; |
| [834](#L834) | case AI\_CHECK\_CFP\_IP\_ADDRESS:           $status .= "CLICK FRAUD PROTECTION IP ADDRESS"; break; |
| [835](#L835) | case AI\_CHECK\_INSERTION\_NOT\_DISABLED:   $status .= "INSERTION PAUSED"; break; |
| [836](#L836) | case AI\_CHECK\_PARAGRAPH\_TAGS:           $status .= "PARAGRAPH TAGS"; break; |
| [837](#L837) | case AI\_CHECK\_PARAGRAPHS\_WITH\_TAGS:     $status .= "PARAGRAPHS WITH TAGS"; break; |
| [838](#L838) | case AI\_CHECK\_PARAGRAPHS\_AFTER\_NO\_COUNTING\_INSIDE: $status .= "PARAGRAPHS AFTER NO COUNTING INSIDE"; break; |
| [839](#L839) | case AI\_CHECK\_PARAGRAPHS\_AFTER\_NO\_COUNTING\_INSIDE\_ELEMENTS: $status .= "PARAGRAPHS AFTER NO COUNTING INSIDE ELEMENTS"; break; |
| [840](#L840) | case AI\_CHECK\_PARAGRAPHS\_AFTER\_MIN\_MAX\_WORDS:    $status .= "PARAGRAPHS AFTER MIN MAX WORDS"; break; |
| [841](#L841) | case AI\_CHECK\_PARAGRAPHS\_AFTER\_TEXT:             $status .= "PARAGRAPHS AFTER TEXT"; break; |
| [842](#L842) | case AI\_CHECK\_PARAGRAPHS\_AFTER\_CLEARANCE:        $status .= "PARAGRAPHS AFTER CLEARANCE"; break; |
| [843](#L843) | case AI\_CHECK\_PARAGRAPHS\_MIN\_NUMBER:             $status .= "PARAGRAPHS MIN NUMBER"; break; |
| [844](#L844) | case AI\_CHECK\_PARAGRAPHS\_MAX\_NUMBER:             $status .= "PARAGRAPHS MAX NUMBER"; break; |
| [845](#L845) | case AI\_CHECK\_PARAGRAPH\_NUMBER:                  $status .= "PARAGRAPH NUMBER " . $obj->get\_paragraph\_number(); break; |
| [846](#L846) | case AI\_CHECK\_NO\_PARAGRAPHS:            $status .= "NO PARAGRAPHS"; break; |
| [847](#L847) |  |
| [848](#L848) | case AI\_CHECK\_DO\_NOT\_INSERT:            $status .= "PARAGRAPH CLEARANCE"; break; |
| [849](#L849) | case AI\_CHECK\_AD\_ABOVE:                 $status .= "PARAGRAPH CLEARANCE ABOVE"; break; |
| [850](#L850) | case AI\_CHECK\_AD\_BELOW:                 $status .= "PARAGRAPH CLEARANCE BELOW"; break; |
| [851](#L851) | case AI\_CHECK\_SHORTCODE\_ATTRIBUTES:     $status .= "SHORTCODE ATTRIBUTES"; break; |
| [852](#L852) |  |
| [853](#L853) | case AI\_CHECK\_ENABLED\_PHP:              $status .= "PHP FUNCTION ENABLED"; break; |
| [854](#L854) | case AI\_CHECK\_ENABLED\_SHORTCODE:        $status .= "SHORTCODE ENABLED"; break; |
| [855](#L855) | case AI\_CHECK\_ENABLED\_WIDGET:           $status .= "WIDGET ENABLED"; break; |
| [856](#L856) |  |
| [857](#L857) | case AI\_CUSTOM\_FILTER\_CHECK:            $status .= "CUSTOM FILTER HOOK CHECK"; break; |
| [858](#L858) |  |
| [859](#L859) | case AI\_CHECK\_NONE:                     $status = "BLOCK $block"; break; |
| [860](#L860) | default: $status .= "?"; break; |
| [861](#L861) | } |
| [862](#L862) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [863](#L863) | return $status; |
| [864](#L864) | } |
| [865](#L865) |  |
| [866](#L866) | function ai\_log\_block\_status ($block, $ai\_last\_check) { |
| [867](#L867) | global $block\_object, $block\_insertion\_log, $ad\_inserter\_globals, $ai\_wp\_data; |
| [868](#L868) |  |
| [869](#L869) | if ($block >= 1 && $ai\_last\_check == AI\_CHECK\_INSERTED) { |
| [870](#L870) | $obj = $block\_object [$block]; |
| [871](#L871) | $global\_name = AI\_BLOCK\_COUNTER\_NAME . $block; |
| [872](#L872) |  |
| [873](#L873) | if ($obj->check\_code\_insertions !== null) { |
| [874](#L874) | $block\_insertion\_log [] = sprintf ("% 2d BLOCK % 2d %s %s%s", $block, $block, 'CHECK', '('.$obj->check\_code\_insertions . ')', $ad\_inserter\_globals [$global\_name] != 1 ? '['.$ad\_inserter\_globals [$global\_name] . ']' : ''); |
| [875](#L875) | return ''; |
| [876](#L876) | } |
| [877](#L877) | elseif ($obj->no\_insertion\_text != '') { |
| [878](#L878) | $block\_insertion\_log [] = sprintf ("% 2d BLOCK % 2d %s %s", $block, $block, $obj->no\_insertion\_text, $ad\_inserter\_globals [$global\_name] != 1 ? '['.$ad\_inserter\_globals [$global\_name] . ']' : ''); |
| [879](#L879) | return ''; |
| [880](#L880) | } |
| [881](#L881) | } |
| [882](#L882) |  |
| [883](#L883) | return ai\_log\_block\_insertion\_status ($block, $ai\_last\_check); |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | function ai\_log\_block\_insertion\_status ($block, $ai\_last\_check) { |
| [887](#L887) | global $block\_insertion\_log, $ad\_inserter\_globals; |
| [888](#L888) |  |
| [889](#L889) | if ($block < 1) return 'NO BLOCK SHORTCODE'; |
| [890](#L890) |  |
| [891](#L891) | $global\_name = AI\_BLOCK\_COUNTER\_NAME . $block; |
| [892](#L892) |  |
| [893](#L893) | $block\_status = ai\_block\_insertion\_status ($block, $ai\_last\_check); |
| [894](#L894) | $block\_insertion\_log [] = sprintf ("% 2d BLOCK % 2d %s %s", $block, $block, $block\_status, $ai\_last\_check == AI\_CHECK\_INSERTED && $ad\_inserter\_globals [$global\_name] != 1 ? '['.$ad\_inserter\_globals [$global\_name] . ']' : ''); |
| [895](#L895) |  |
| [896](#L896) | return "BLOCK $block " . $block\_status . "\n"; |
| [897](#L897) | } |
| [898](#L898) |  |
| [899](#L899) | function ai\_log ($message = "") { |
| [900](#L900) | global $ai\_last\_time, $ai\_processing\_log; |
| [901](#L901) |  |
| [902](#L902) | if ($message != "") { |
| [903](#L903) | if ($message [strlen ($message) - 1] == "\n") { |
| [904](#L904) | ai\_log\_message (str\_replace ("\n", "", $message)); |
| [905](#L905) | $ai\_processing\_log []= ""; |
| [906](#L906) | } else ai\_log\_message ($message); |
| [907](#L907) | } else $ai\_processing\_log []= ""; |
| [908](#L908) | $ai\_last\_time = microtime (true); |
| [909](#L909) | } |
| [910](#L910) |  |
| [911](#L911) | function remove\_debug\_parameters\_from\_url ($url = false) { |
| [912](#L912) | if (defined ('AI\_DEBUGGING\_DEMO')) { |
| [913](#L913) | $parameters = array (AI\_URL\_DEBUG, AI\_URL\_DEBUG\_PROCESSING, AI\_URL\_DEBUG\_PROCESSING\_FE); |
| [914](#L914) | } else { |
| [915](#L915) | $parameters = array ( |
| [916](#L916) | AI\_URL\_DEBUG, |
| [917](#L917) | AI\_URL\_DEBUG\_PROCESSING, |
| [918](#L918) | AI\_URL\_DEBUG\_PROCESSING\_FE, |
| [919](#L919) | AI\_URL\_DEBUG\_PHP, |
| [920](#L920) | AI\_URL\_DEBUG\_BLOCKS, |
| [921](#L921) | AI\_URL\_DEBUG\_CODE, |
| [922](#L922) | AI\_URL\_DEBUG\_USER, |
| [923](#L923) | AI\_URL\_DEBUG\_TAGS, |
| [924](#L924) | AI\_URL\_DEBUG\_POSITIONS, |
| [925](#L925) | AI\_URL\_DEBUG\_NO\_INSERTION, |
| [926](#L926) | AI\_URL\_DEBUG\_JAVASCRIPT, |
| [927](#L927) | AI\_URL\_DEBUG\_AD\_BLOCKING, |
| [928](#L928) | AI\_URL\_DEBUG\_AD\_BLOCKING\_STATUS, |
| [929](#L929) | AI\_URL\_DEBUG\_COUNTRY, |
| [930](#L930) | AI\_URL\_DEBUG\_IP\_ADDRESS, |
| [931](#L931) |  |
| [932](#L932) | AI\_URL\_DEBUG\_DISABLE\_CSS\_CODE, |
| [933](#L933) | AI\_URL\_DEBUG\_DISABLE\_JS\_CODE, |
| [934](#L934) | AI\_URL\_DEBUG\_DISABLE\_PHP\_PROCESSING, |
| [935](#L935) | AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS, |
| [936](#L936) | AI\_URL\_DEBUG\_DISABLE\_HEADER\_CODE, |
| [937](#L937) | AI\_URL\_DEBUG\_DISABLE\_FOOTER\_CODE, |
| [938](#L938) | ); |
| [939](#L939) |  |
| [940](#L940) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [941](#L941) | $parameters = array\_merge ($parameters, array (AI\_URL\_DEBUG\_AD\_BLOCKING, AI\_URL\_DEBUG\_AD\_BLOCKING\_STATUS)); |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | return remove\_query\_arg ($parameters, $url); |
| [946](#L946) | } |
| [947](#L947) |  |
| [948](#L948) | function set\_url\_parameter ($parameter, $value) { |
| [949](#L949) | return add\_query\_arg ($parameter, $value, remove\_debug\_parameters\_from\_url ()); |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | function number\_of\_words (&$content) { |
| [953](#L953) | $text = str\_replace ("\r", "", $content); |
| [954](#L954) | $text = str\_replace (array ("\n", "  "), " ", $text); |
| [955](#L955) | $text = preg\_replace('#<style.\*?'.'>(.\*?)</style>#i', '', $text); |
| [956](#L956) | $text = preg\_replace('#<script.\*?'.'>(.\*?)</script>#i', '', $text); |
| [957](#L957) | $text = htmlspecialchars\_decode ($text); |
| [958](#L958) | $text = trim (strip\_tags ($text)); |
| [959](#L959) | $text = preg\_replace ('#\s+#', ' ', $text); |
| [960](#L960) |  |
| [961](#L961) | if ($text == '') return 0; |
| [962](#L962) |  |
| [963](#L963) | return count (explode (' ', $text)); |
| [964](#L964) | } |
| [965](#L965) |  |
| [966](#L966) | function ai\_loop\_check ($query, $action) { |
| [967](#L967) | global $ai\_wp\_data; |
| [968](#L968) |  |
| [969](#L969) | $ai\_wp\_data [AI\_CONTEXT] = $action == 'loop\_start' ? AI\_CONTEXT\_BEFORE\_POST : AI\_CONTEXT\_AFTER\_POST; |
| [970](#L970) |  |
| [971](#L971) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) return true; |
| [972](#L972) |  |
| [973](#L973) | if ($action == 'loop\_end' && !method\_exists ($query, 'is\_main\_query') && method\_exists ($wp\_query, 'is\_main\_query')) { |
| [974](#L974) | $query = $wp\_query; |
| [975](#L975) | } |
| [976](#L976) |  |
| [977](#L977) | if (isset ($query) && method\_exists ($query, 'is\_main\_query')) { |
| [978](#L978) | if ($query->is\_main\_query()) { |
| [979](#L979) | if (isset ($ai\_wp\_data [AI\_HEAD]) && !$ai\_wp\_data [AI\_HEAD]) { |
| [980](#L980) | return true; |
| [981](#L981) | } |
| [982](#L982) | } |
| [983](#L983) | } |
| [984](#L984) |  |
| [985](#L985) | return false; |
| [986](#L986) | } |
| [987](#L987) |  |
| [988](#L988) |  |
| [989](#L989) | function ai\_process\_head\_codes ($head) { |
| [990](#L990) | global $ai\_wp\_data; |
| [991](#L991) |  |
| [992](#L992) | if (!get\_disable\_header\_code ()) { |
| [993](#L993) | if (!empty ($ai\_wp\_data [AI\_HEAD\_CODES])) { |
| [994](#L994) | $head = str\_replace ("<!--[AI\_HEAD\_CODES]-->", implode ("\n", $ai\_wp\_data [AI\_HEAD\_CODES]) . "\n", $head); |
| [995](#L995) |  |
| [996](#L996) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [997](#L997) | $head = str\_replace ("&lt;!--[AI\_HEAD\_CODES]--&gt;", '<span style=\'color: #00f;\'>' . str\_replace (array ('<', '>'), array ('&lt;', '&gt;'), implode ("\\n", $ai\_wp\_data [AI\_HEAD\_CODES])) . '</span>', $head); |
| [998](#L998) | } |
| [999](#L999) | } |
| [1000](#L1000) |  |
| [1001](#L1001) | foreach ($ai\_wp\_data [AI\_HEAD\_GROUPS] as $group\_name => $group\_codes) { |
| [1002](#L1002) | $group\_code = implode ("\n", $group\_codes); |
| [1003](#L1003) | $head = str\_replace ("<!--[AI\_HEAD\_GROUPS $group\_name]-->", $group\_code, $head); |
| [1004](#L1004) |  |
| [1005](#L1005) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [1006](#L1006) | $head = str\_replace ("&lt;!--[AI\_HEAD\_GROUPS $group\_name]--&gt;", str\_replace (array ('<', '>'), array ('<span style=\'color: #c0f;\'>&lt;', '&gt;</span>'), implode ("\\n", $group\_codes)), $head); |
| [1007](#L1007) | } |
| [1008](#L1008) | } |
| [1009](#L1009) | } |
| [1010](#L1010) |  |
| [1011](#L1011) | $head = preg\_replace ("#<!--\[AI(.+?)\]-->#", '', $head); |
| [1012](#L1012) |  |
| [1013](#L1013) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [1014](#L1014) | $head = preg\_replace ("#&lt;!--\[AI(.+?)\]--&gt;#", '', $head); |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | $head = preg\_replace ("#<script .+js/ai\-jquery\.js.+></script>\n#", '', $head); |
| [1018](#L1018) |  |
| [1019](#L1019) | return ($head); |
| [1020](#L1020) | } |
| [1021](#L1021) |  |
| [1022](#L1022) | // Not used |
| [1023](#L1023) | function ai\_buffering\_start\_hook () { |
| [1024](#L1024) | global $ai\_wp\_data; |
| [1025](#L1025) |  |
| [1026](#L1026) | if (defined ('AI\_BUFFERING')) { |
| [1027](#L1027) | if (get\_output\_buffering ()) { |
| [1028](#L1028) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [1029](#L1029) | ai\_buffering\_start (); |
| [1030](#L1030) | } |
| [1031](#L1031) | } |
| [1032](#L1032) | } |
| [1033](#L1033) | } |
| [1034](#L1034) |  |
| [1035](#L1035) | function ai\_buffering\_start () { |
| [1036](#L1036) | global $ai\_wp\_data; |
| [1037](#L1037) |  |
| [1038](#L1038) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1039](#L1039) | ai\_log ("BUFFERING START: level " . ob\_get\_level () ); |
| [1040](#L1040) | } |
| [1041](#L1041) |  |
| [1042](#L1042) | ob\_start (); |
| [1043](#L1043) |  |
| [1044](#L1044) | if (!defined ('AI\_BUFFERING\_START')) define ('AI\_BUFFERING\_START', true); |
| [1045](#L1045) | } |
| [1046](#L1046) |  |
| [1047](#L1047) | function ai\_buffering\_end () { |
| [1048](#L1048) | global $ai\_wp\_data, $ai\_total\_plugin\_time, $ai\_db\_options\_extract, $block\_object, $ad\_inserter\_globals; |
| [1049](#L1049) |  |
| [1050](#L1050) | if (!defined ('AI\_BUFFERING\_START')) return; |
| [1051](#L1051) |  |
| [1052](#L1052) | $page = ob\_get\_clean(); |
| [1053](#L1053) |  |
| [1054](#L1054) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1055](#L1055) | ai\_log ("BUFFERING END: level " . ob\_get\_level ()); |
| [1056](#L1056) | $start\_time = microtime (true); |
| [1057](#L1057) | } |
| [1058](#L1058) |  |
| [1059](#L1059) | $matches = preg\_split ('/(<body.\*?'.'>)/i', $page, - 1, PREG\_SPLIT\_NO\_EMPTY | PREG\_SPLIT\_DELIM\_CAPTURE); |
| [1060](#L1060) |  |
| [1061](#L1061) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1062](#L1062) | ai\_log ("BUFFER body tag matches: " . (count ($matches) - 1) / 2); |
| [1063](#L1063) | ai\_log ("PHP VERSION COMPARE to 5.4: " . (version\_compare (phpversion (), "5.4", ">=") ? 'YES' : 'NO')); |
| [1064](#L1064) |  |
| [1065](#L1065) | if (count ($matches) > 3) { |
| [1066](#L1066) | ai\_log ("NO BUFFER PROCESSING - more than one body tag found"); |
| [1067](#L1067) | } |
| [1068](#L1068) | if (version\_compare (phpversion (), "5.4", "<")) { |
| [1069](#L1069) | ai\_log ("NO BUFFER PROCESSING - PHP version below 5.4"); |
| [1070](#L1070) | } |
| [1071](#L1071) | } |
| [1072](#L1072) |  |
| [1073](#L1073) | if (version\_compare (phpversion (), "5.4", ">=") && count ($matches) == 3) { |
| [1074](#L1074) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1075](#L1075) | ai\_log ("BUFFER PROCESSING"); |
| [1076](#L1076) | } |
| [1077](#L1077) |  |
| [1078](#L1078) | $head     = $matches [0]; |
| [1079](#L1079) | $body\_tag = $matches [1]; |
| [1080](#L1080) | $body     = $matches [2]; |
| [1081](#L1081) |  |
| [1082](#L1082) | if (isset ($ai\_wp\_data [AI\_BODY\_STYLE])) { |
| [1083](#L1083) | if (preg\_match ('#style=[\'"](.\*?)[\'"]#i', $body\_tag, $body\_style)) { |
| [1084](#L1084) | $old\_style = $body\_style [1]; |
| [1085](#L1085) | if ($old\_style != '') { |
| [1086](#L1086) | $old\_style = trim ($old\_style, ' ;'); |
| [1087](#L1087) | if ($old\_style != '') { |
| [1088](#L1088) | $old\_style .= '; '; |
| [1089](#L1089) | } |
| [1090](#L1090) | } |
| [1091](#L1091) | $new\_style = $old\_style . $ai\_wp\_data [AI\_BODY\_STYLE]; |
| [1092](#L1092) |  |
| [1093](#L1093) | $body\_tag = str\_ireplace ($body\_style [0], 'style="'.$new\_style.'"', $body\_tag); |
| [1094](#L1094) | } else { |
| [1095](#L1095) | $body\_tag = str\_replace ('>', ' style="' . $ai\_wp\_data [AI\_BODY\_STYLE] . '">', $body\_tag); |
| [1096](#L1096) | } |
| [1097](#L1097) | } |
| [1098](#L1098) |  |
| [1099](#L1099) | $body = preg\_replace ('/<!-- ' . AI\_CONTENT\_MARKER . " (\d+) -->\n/", '', $body); |
| [1100](#L1100) |  |
| [1101](#L1101) | if (isset ($ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && class\_exists ('DOMDocument')) { |
| [1102](#L1102) |  |
| [1103](#L1103) | $php\_version = explode ('.', PHP\_VERSION); |
| [1104](#L1104) | if ($php\_version [0] >= 8) { |
| [1105](#L1105) | // phpQuery for PHP 8 |
| [1106](#L1106) | require\_once ('includes/phpQuery\_8.php'); |
| [1107](#L1107) | } else |
| [1108](#L1108) | // phpQuery for PHP 5.6 to PHP 7 |
| [1109](#L1109) | require\_once ('includes/phpQuery.php'); |
| [1110](#L1110) |  |
| [1111](#L1111) | $no\_closing\_tag = array ('img', 'hr', 'br'); |
| [1112](#L1112) | $multibyte = $ai\_wp\_data [AI\_MBSTRING\_LOADED] && get\_paragraph\_counting\_functions() == AI\_MULTIBYTE\_PARAGRAPH\_COUNTING\_FUNCTIONS; |
| [1113](#L1113) |  |
| [1114](#L1114) | foreach ($ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [1115](#L1115) |  |
| [1116](#L1116) | $obj = $block\_object [$block]; |
| [1117](#L1117) | $obj->clear\_code\_cache (); |
| [1118](#L1118) |  |
| [1119](#L1119) | switch ($obj->get\_automatic\_insertion ()) { |
| [1120](#L1120) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_HTML\_ELEMENT: |
| [1121](#L1121) | $insertion\_position = 'before'; |
| [1122](#L1122) | break; |
| [1123](#L1123) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_HTML\_ELEMENT: |
| [1124](#L1124) | $insertion\_position = 'after'; |
| [1125](#L1125) | break; |
| [1126](#L1126) | case AI\_AUTOMATIC\_INSERTION\_INSIDE\_HTML\_ELEMENT: |
| [1127](#L1127) | switch ($obj->get\_inside\_element ()) { |
| [1128](#L1128) | case AI\_HTML\_PREPEND\_CONTENT: |
| [1129](#L1129) | $insertion\_position = 'prepend'; |
| [1130](#L1130) | break; |
| [1131](#L1131) | case AI\_HTML\_APPEND\_CONTENT: |
| [1132](#L1132) | $insertion\_position = 'append'; |
| [1133](#L1133) | break; |
| [1134](#L1134) | case AI\_HTML\_REPLACE\_CONTENT: |
| [1135](#L1135) | $insertion\_position = 'replace-content'; |
| [1136](#L1136) | break; |
| [1137](#L1137) | case AI\_HTML\_REPLACE\_ELEMENT: |
| [1138](#L1138) | $insertion\_position = 'replace-element'; |
| [1139](#L1139) | break; |
| [1140](#L1140) | } |
| [1141](#L1141) | break; |
| [1142](#L1142) | } |
| [1143](#L1143) |  |
| [1144](#L1144) | $selector = $obj->get\_html\_selector (); |
| [1145](#L1145) |  |
| [1146](#L1146) | libxml\_use\_internal\_errors (true); |
| [1147](#L1147) | $content = phpQuery::newDocumentHTML ($body); |
| [1148](#L1148) | libxml\_use\_internal\_errors (false); |
| [1149](#L1149) |  |
| [1150](#L1150) | foreach (pq ($selector) as $element) { |
| [1151](#L1151) |  |
| [1152](#L1152) | if (in\_array ($element->tagName, $no\_closing\_tag)) { |
| [1153](#L1153) | switch ($insertion\_position) { |
| [1154](#L1154) | case 'replace-content': |
| [1155](#L1155) | case 'prepend': |
| [1156](#L1156) | case 'append': |
| [1157](#L1157) | $insertion\_position = 'after'; |
| [1158](#L1158) | break; |
| [1159](#L1159) | } |
| [1160](#L1160) | } |
| [1161](#L1161) |  |
| [1162](#L1162) | switch ($insertion\_position) { |
| [1163](#L1163) | case 'before': |
| [1164](#L1164) | pq ($element)->before (AI\_MARKER\_START.$element->tagName.AI\_MARKER\_END); |
| [1165](#L1165) | break; |
| [1166](#L1166) | case 'after': |
| [1167](#L1167) | pq ($element)->after (AI\_MARKER\_START.$element->tagName.AI\_MARKER\_END); |
| [1168](#L1168) | break; |
| [1169](#L1169) | case 'prepend': |
| [1170](#L1170) | pq ($element)->prepend (AI\_MARKER\_START.$element->tagName.AI\_MARKER\_END); |
| [1171](#L1171) | break; |
| [1172](#L1172) | case 'append': |
| [1173](#L1173) | pq ($element)->append (AI\_MARKER\_START.$element->tagName.AI\_MARKER\_END); |
| [1174](#L1174) | break; |
| [1175](#L1175) | case 'replace-content': |
| [1176](#L1176) | pq ($element)->prepend (AI\_MARKER\_START.'-'.$element->tagName.'-'.AI\_MARKER\_END); |
| [1177](#L1177) | pq ($element)->append  (AI\_MARKER\_START.'='.$element->tagName.'='.AI\_MARKER\_END); |
| [1178](#L1178) | break; |
| [1179](#L1179) | case 'replace-element': |
| [1180](#L1180) | pq ($element)->before (AI\_MARKER\_START.'-'.$element->tagName.'-'.AI\_MARKER\_END); |
| [1181](#L1181) | pq ($element)->after  (AI\_MARKER\_START.'='.$element->tagName.'='.AI\_MARKER\_END); |
| [1182](#L1182) | break; |
| [1183](#L1183) | } |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | switch ($insertion\_position) { |
| [1187](#L1187) | case 'replace-content': |
| [1188](#L1188) | case 'replace-element': |
| [1189](#L1189) | $markers  = preg\_split ('/('.AI\_MARKER\_START.'-.\*?-'.AI\_MARKER\_END.')/', $content->htmlOuter (), - 1, PREG\_SPLIT\_NO\_EMPTY | PREG\_SPLIT\_DELIM\_CAPTURE); |
| [1190](#L1190) | $markers2 = preg\_split ('/('.AI\_MARKER\_START.'=.\*?='.AI\_MARKER\_END.')/', $content->htmlOuter (), - 1, PREG\_SPLIT\_NO\_EMPTY | PREG\_SPLIT\_DELIM\_CAPTURE); |
| [1191](#L1191) | break; |
| [1192](#L1192) | default: |
| [1193](#L1193) | $markers = preg\_split ('/('.AI\_MARKER\_START.'.\*?'.AI\_MARKER\_END.')/', $content->htmlOuter (), - 1, PREG\_SPLIT\_NO\_EMPTY | PREG\_SPLIT\_DELIM\_CAPTURE); |
| [1194](#L1194) | break; |
| [1195](#L1195) | } |
| [1196](#L1196) |  |
| [1197](#L1197) | $content\_before = ''; |
| [1198](#L1198) | $insertions = array (); |
| [1199](#L1199) | foreach ($markers as $marker) { |
| [1200](#L1200) | switch ($insertion\_position) { |
| [1201](#L1201) | case 'replace-content': |
| [1202](#L1202) | case 'replace-element': |
| [1203](#L1203) | $marker\_start\_string = AI\_MARKER\_START.'-'; |
| [1204](#L1204) | break; |
| [1205](#L1205) | default: |
| [1206](#L1206) | $marker\_start\_string = AI\_MARKER\_START; |
| [1207](#L1207) | break; |
| [1208](#L1208) | } |
| [1209](#L1209) | if (strpos ($marker, $marker\_start\_string) === 0) { |
| [1210](#L1210) | switch ($insertion\_position) { |
| [1211](#L1211) | case 'replace-content': |
| [1212](#L1212) | case 'replace-element': |
| [1213](#L1213) | $tag = str\_replace (array (AI\_MARKER\_START.'-', '-'.AI\_MARKER\_END), '', $marker); |
| [1214](#L1214) | break; |
| [1215](#L1215) | default: |
| [1216](#L1216) | $tag = str\_replace (array (AI\_MARKER\_START, AI\_MARKER\_END), '', $marker); |
| [1217](#L1217) | break; |
| [1218](#L1218) | } |
| [1219](#L1219) |  |
| [1220](#L1220) | switch ($insertion\_position) { |
| [1221](#L1221) | case 'before': |
| [1222](#L1222) | case 'replace-element': |
| [1223](#L1223) | $tag\_string = "<{$tag}"; |
| [1224](#L1224) | break; |
| [1225](#L1225) | case 'after': |
| [1226](#L1226) | if (in\_array ($tag, $no\_closing\_tag)) $tag\_string = '>'; else $tag\_string = "</{$tag}>"; |
| [1227](#L1227) | break; |
| [1228](#L1228) | case 'prepend': |
| [1229](#L1229) | case 'replace-content': |
| [1230](#L1230) | $tag\_string = "<{$tag}[^>]\*>"; |
| [1231](#L1231) | break; |
| [1232](#L1232) | case 'append': |
| [1233](#L1233) | $tag\_string = "</{$tag}>"; |
| [1234](#L1234) | break; |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | preg\_match\_all ("#{$tag\_string}#i", $content\_before, $tag\_matches); |
| [1238](#L1238) |  |
| [1239](#L1239) | switch ($insertion\_position) { |
| [1240](#L1240) | case 'before': |
| [1241](#L1241) | case 'replace-element': |
| [1242](#L1242) | $insertions []= array ($tag\_string, count ($tag\_matches [0]) + 1); |
| [1243](#L1243) | break; |
| [1244](#L1244) | case 'after': |
| [1245](#L1245) | $insertions []= array ($tag\_string, count ($tag\_matches [0])); |
| [1246](#L1246) | break; |
| [1247](#L1247) | case 'replace-content': |
| [1248](#L1248) | case 'prepend': |
| [1249](#L1249) | $insertions []= array ($tag\_string, count ($tag\_matches [0])); |
| [1250](#L1250) | break; |
| [1251](#L1251) | case 'append': |
| [1252](#L1252) | $insertions []= array ($tag\_string, count ($tag\_matches [0]) + 1); |
| [1253](#L1253) | break; |
| [1254](#L1254) | } |
| [1255](#L1255) |  |
| [1256](#L1256) | continue; |
| [1257](#L1257) | } |
| [1258](#L1258) | $content\_before .= $marker; |
| [1259](#L1259) | } |
| [1260](#L1260) |  |
| [1261](#L1261) | switch ($insertion\_position) { |
| [1262](#L1262) | case 'replace-content': |
| [1263](#L1263) | case 'replace-element': |
| [1264](#L1264) | $content\_before = ''; |
| [1265](#L1265) | $insertions2 = array (); |
| [1266](#L1266) | foreach ($markers2 as $marker) { |
| [1267](#L1267) | if (strpos ($marker, AI\_MARKER\_START.'=') === 0) { |
| [1268](#L1268) | $tag = str\_replace (array (AI\_MARKER\_START.'=', '='.AI\_MARKER\_END), '', $marker); |
| [1269](#L1269) | $tag\_string = "</{$tag}>"; |
| [1270](#L1270) | preg\_match\_all ("#{$tag\_string}#i", $content\_before, $tag\_matches); |
| [1271](#L1271) |  |
| [1272](#L1272) | switch ($insertion\_position) { |
| [1273](#L1273) | case 'replace-content': |
| [1274](#L1274) | $insertions2 []= array ($tag\_string, count ($tag\_matches [0]) + 1); |
| [1275](#L1275) | break; |
| [1276](#L1276) | case 'replace-element': |
| [1277](#L1277) | $insertions2 []= array ($tag\_string, count ($tag\_matches [0])); |
| [1278](#L1278) | break; |
| [1279](#L1279) | } |
| [1280](#L1280) |  |
| [1281](#L1281) | continue; |
| [1282](#L1282) | } |
| [1283](#L1283) | $content\_before .= $marker; |
| [1284](#L1284) | } |
| [1285](#L1285) | break; |
| [1286](#L1286) | } |
| [1287](#L1287) |  |
| [1288](#L1288) | $insertion\_offsets = array (); |
| [1289](#L1289) | foreach ($insertions as $insertion) { |
| [1290](#L1290) | $tag          = $insertion [0]; |
| [1291](#L1291) | $tag\_counter  = $insertion [1]; |
| [1292](#L1292) | preg\_match\_all ("#$tag#i", $body, $org\_tag\_matches, PREG\_OFFSET\_CAPTURE); |
| [1293](#L1293) | if (isset ($org\_tag\_matches [0][$tag\_counter - 1])) { |
| [1294](#L1294) |  |
| [1295](#L1295) | switch ($insertion\_position) { |
| [1296](#L1296) | case 'before': |
| [1297](#L1297) | case 'replace-element': |
| [1298](#L1298) | $insertion\_offsets []= $org\_tag\_matches [0][$tag\_counter - 1][1]; |
| [1299](#L1299) | break; |
| [1300](#L1300) | case 'after': |
| [1301](#L1301) | $insertion\_offsets []= $org\_tag\_matches [0][$tag\_counter - 1][1] + strlen ($tag); |
| [1302](#L1302) | break; |
| [1303](#L1303) | case 'prepend': |
| [1304](#L1304) | case 'replace-content': |
| [1305](#L1305) | $insertion\_offsets []= $org\_tag\_matches [0][$tag\_counter - 1][1] + strlen ($org\_tag\_matches [0][$tag\_counter - 1][0]); |
| [1306](#L1306) | break; |
| [1307](#L1307) | case 'append': |
| [1308](#L1308) | $insertion\_offsets []= $org\_tag\_matches [0][$tag\_counter - 1][1]; |
| [1309](#L1309) | break; |
| [1310](#L1310) | } |
| [1311](#L1311) | } |
| [1312](#L1312) | } |
| [1313](#L1313) |  |
| [1314](#L1314) | sort ($insertion\_offsets); |
| [1315](#L1315) |  |
| [1316](#L1316) | switch ($insertion\_position) { |
| [1317](#L1317) | case 'replace-content': |
| [1318](#L1318) | case 'replace-element': |
| [1319](#L1319) | $insertion\_offsets2 = array (); |
| [1320](#L1320) | foreach ($insertions2 as $insertion) { |
| [1321](#L1321) | $tag          = $insertion [0]; |
| [1322](#L1322) | $tag\_counter  = $insertion [1]; |
| [1323](#L1323) | preg\_match\_all ("#$tag#i", $body, $org\_tag\_matches, PREG\_OFFSET\_CAPTURE); |
| [1324](#L1324) | if (isset ($org\_tag\_matches [0][$tag\_counter - 1])) { |
| [1325](#L1325) |  |
| [1326](#L1326) | switch ($insertion\_position) { |
| [1327](#L1327) | case 'replace-content': |
| [1328](#L1328) | $insertion\_offsets2 []= $org\_tag\_matches [0][$tag\_counter - 1][1]; |
| [1329](#L1329) | break; |
| [1330](#L1330) | case 'replace-element': |
| [1331](#L1331) | $insertion\_offsets2 []= $org\_tag\_matches [0][$tag\_counter - 1][1] + strlen ($tag); |
| [1332](#L1332) | break; |
| [1333](#L1333) | } |
| [1334](#L1334) | } |
| [1335](#L1335) | } |
| [1336](#L1336) |  |
| [1337](#L1337) | sort ($insertion\_offsets2); |
| [1338](#L1338) |  |
| [1339](#L1339) | break; |
| [1340](#L1340) | } |
| [1341](#L1341) |  |
| [1342](#L1342) | $new\_content = ''; |
| [1343](#L1343) | $current\_offset = 0; |
| [1344](#L1344) |  |
| [1345](#L1345) | switch ($insertion\_position) { |
| [1346](#L1346) | case 'before': |
| [1347](#L1347) | $action       = 'before\_html\_element'; |
| [1348](#L1348) | // translators: Debugging position name Before HTML element |
| [1349](#L1349) | $action\_name  = \_\_('Before', 'ad-inserter') . ' ' . $selector; |
| [1350](#L1350) | break; |
| [1351](#L1351) | case 'after': |
| [1352](#L1352) | $action       = 'after\_html\_element'; |
| [1353](#L1353) | // translators: Debugging position name After HTML element |
| [1354](#L1354) | $action\_name  = \_\_('After', 'ad-inserter') . ' ' . $selector; |
| [1355](#L1355) | break; |
| [1356](#L1356) | case 'prepend': |
| [1357](#L1357) | $action       = 'prepend\_html\_element'; |
| [1358](#L1358) | // translators: Debugging position name Prepend content of HTML element (before the content of the HTML element) |
| [1359](#L1359) | $action\_name  = \_\_('Prepend content', 'ad-inserter') . ' ' . $selector; |
| [1360](#L1360) | break; |
| [1361](#L1361) | case 'append': |
| [1362](#L1362) | $action       = 'append\_html\_element'; |
| [1363](#L1363) | // translators: Debugging position name Append content of HTML element (after the content of the HTML element) |
| [1364](#L1364) | $action\_name  = \_\_('Append content', 'ad-inserter') . ' ' . $selector; |
| [1365](#L1365) | break; |
| [1366](#L1366) | case 'replace-content': |
| [1367](#L1367) | $action       = 'replace\_content\_html\_element'; |
| [1368](#L1368) | // translators: Debugging position name Replace content of HTML element |
| [1369](#L1369) | $action\_name  = \_\_('Replace content', 'ad-inserter') . ' ' . $selector; |
| [1370](#L1370) | break; |
| [1371](#L1371) | case 'replace-element': |
| [1372](#L1372) | // translators: Debugging position name Replace HTML element |
| [1373](#L1373) | $action       = 'replace\_html\_element'; |
| [1374](#L1374) | $action\_name  = \_\_('Replace', 'ad-inserter') . ' ' . $selector; |
| [1375](#L1375) | break; |
| [1376](#L1376) | } |
| [1377](#L1377) |  |
| [1378](#L1378) | $globals\_name = 'AI\_' . strtoupper ($action) . '\_COUNTER'; |
| [1379](#L1379) | unset ($ad\_inserter\_globals [$globals\_name]); |
| [1380](#L1380) | $ai\_db\_options\_extract [$action . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] = array ($block); |
| [1381](#L1381) |  |
| [1382](#L1382) | foreach ($insertion\_offsets as $index => $insertion\_offset) { |
| [1383](#L1383) | if ($multibyte) |
| [1384](#L1384) | $new\_content .= mb\_substr ($body, $current\_offset, $insertion\_offset - $current\_offset); |
| [1385](#L1385) | $new\_content .= substr ($body, $current\_offset, $insertion\_offset - $current\_offset); |
| [1386](#L1386) |  |
| [1387](#L1387) | switch ($insertion\_position) { |
| [1388](#L1388) | case 'replace-content': |
| [1389](#L1389) | case 'replace-element': |
| [1390](#L1390) | if (isset ($insertion\_offsets2 [$index])) { |
| [1391](#L1391) | $current\_offset = $insertion\_offsets2 [$index]; |
| [1392](#L1392) | } else $current\_offset = $insertion\_offset; |
| [1393](#L1393) | break; |
| [1394](#L1394) | default: |
| [1395](#L1395) | $current\_offset = $insertion\_offset; |
| [1396](#L1396) | break; |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) | ob\_start (); |
| [1400](#L1400) | // Dummy |
| [1401](#L1401) | ai\_custom\_hook ($action, AI\_AUTOMATIC\_INSERTION\_DISABLED, $action\_name); |
| [1402](#L1402) |  |
| [1403](#L1403) | $new\_content .= ob\_get\_clean(); |
| [1404](#L1404) | } |
| [1405](#L1405) |  |
| [1406](#L1406) | unset ($ai\_db\_options\_extract [$action . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]); |
| [1407](#L1407) |  |
| [1408](#L1408) | $new\_content .= substr ($body, $current\_offset); |
| [1409](#L1409) |  |
| [1410](#L1410) | $body = $new\_content; |
| [1411](#L1411) | } |
| [1412](#L1412) | } |
| [1413](#L1413) |  |
| [1414](#L1414) | $head = ai\_process\_head\_codes ($head); |
| [1415](#L1415) |  |
| [1416](#L1416) | echo $head, $body\_tag; |
| [1417](#L1417) |  |
| [1418](#L1418) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [1419](#L1419) | $class = AI\_DEBUG\_STATUS\_CLASS.' status-ok'; |
| [1420](#L1420) | // translators: Debugging message when output buffering is enabled |
| [1421](#L1421) | echo "<section class='$class'>" . \_\_('OUTPUT BUFFERING', 'ad-inserter') . '</section>'; |
| [1422](#L1422) | } |
| [1423](#L1423) |  |
| [1424](#L1424) | // translators: Debugging position |
| [1425](#L1425) | ai\_custom\_hook ('above\_header', AI\_AUTOMATIC\_INSERTION\_ABOVE\_HEADER, 'Above Header', \_\_('Above Header', 'ad-inserter')); |
| [1426](#L1426) | echo $body; |
| [1427](#L1427) | } else echo $page; |
| [1428](#L1428) |  |
| [1429](#L1429) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1430](#L1430) | ai\_log ("BUFFER PROCESSING END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [1431](#L1431) | //    $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [1432](#L1432) | } |
| [1433](#L1433) | } |
| [1434](#L1434) |  |
| [1435](#L1435) | function ai\_post\_check ($post, $action) { |
| [1436](#L1436) | global $ai\_wp\_data, $ad\_inserter\_globals; |
| [1437](#L1437) |  |
| [1438](#L1438) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST) return false; |
| [1439](#L1439) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) return false; |
| [1440](#L1440) |  |
| [1441](#L1441) | // Don't use the hook before the wp\_head hook ends |
| [1442](#L1442) | if (!isset ($ai\_wp\_data [AI\_HEAD]) || $ai\_wp\_data [AI\_HEAD]) { |
| [1443](#L1443) | return false; |
| [1444](#L1444) | } |
| [1445](#L1445) |  |
| [1446](#L1446) | // in\_the\_loop () is not used on AMP pages (however, AMP plugin uses it) |
| [1447](#L1447) | switch ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [1448](#L1448) | case true: |
| [1449](#L1449) | if ($ai\_wp\_data [AI\_POST\_POSITION] != AI\_POST\_POSITION\_IN\_POST) return false; |
| [1450](#L1450) |  |
| [1451](#L1451) | //      include\_once (ABSPATH . 'wp-admin/includes/plugin.php'); |
| [1452](#L1452) | //      if (is\_plugin\_active ('amp/amp.php')) { |
| [1453](#L1453) | //        if (!in\_the\_loop()) return false; |
| [1454](#L1454) | //      } else { |
| [1455](#L1455) | //          // For other AMP plugins |
| [1456](#L1456) | //          if ($ai\_wp\_data [AI\_POST\_POSITION] != AI\_POST\_POSITION\_IN\_POST) return false; |
| [1457](#L1457) | //        } |
| [1458](#L1458) | break; |
| [1459](#L1459) | default: |
| [1460](#L1460) | if (!in\_the\_loop()) return false; |
| [1461](#L1461) | break; |
| [1462](#L1462) | } |
| [1463](#L1463) |  |
| [1464](#L1464) | // Skip insertion before the first post |
| [1465](#L1465) | if (!defined ('AI\_POST\_CHECK')) { |
| [1466](#L1466) | define ('AI\_POST\_CHECK', true); |
| [1467](#L1467) | return false; |
| [1468](#L1468) | } |
| [1469](#L1469) |  |
| [1470](#L1470) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_BETWEEN\_POSTS; |
| [1471](#L1471) |  |
| [1472](#L1472) | return true; |
| [1473](#L1473) | } |
| [1474](#L1474) |  |
| [1475](#L1475) | function ai\_content\_marker () { |
| [1476](#L1476) | global $ai\_wp\_data; |
| [1477](#L1477) |  |
| [1478](#L1478) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_AJAX || |
| [1479](#L1479) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_REST || |
| [1480](#L1480) | get\_disable\_html\_code ()) return; |
| [1481](#L1481) |  |
| [1482](#L1482) | echo '<span class="ai-content"></span>', "\n"; |
| [1483](#L1483) |  |
| [1484](#L1484) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [1485](#L1485) | $debug\_label = new ai\_block\_labels ('ai-debug-marker'); |
| [1486](#L1486) | $marker\_label = $debug\_label->center\_bar (\_\_('CONTENT MARKER', 'ad-inserter')); |
| [1487](#L1487) | echo $marker\_label; |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | } |
| [1491](#L1491) |  |
| [1492](#L1492) | function ai\_mark\_loop\_start () { |
| [1493](#L1493) | global $ai\_wp\_data; |
| [1494](#L1494) | $ai\_wp\_data [AI\_POST\_POSITION] = AI\_POST\_POSITION\_IN\_POST; |
| [1495](#L1495) | } |
| [1496](#L1496) |  |
| [1497](#L1497) | function ai\_mark\_loop\_end () { |
| [1498](#L1498) | global $ai\_wp\_data; |
| [1499](#L1499) | $ai\_wp\_data [AI\_POST\_POSITION] = AI\_POST\_POSITION\_AFTER\_POST; |
| [1500](#L1500) | } |
| [1501](#L1501) |  |
| [1502](#L1502) | function ai\_hook\_function\_loop\_start ($hook\_parameter) { |
| [1503](#L1503) | ai\_custom\_hook ('loop\_start', AI\_AUTOMATIC\_INSERTION\_BEFORE\_POST, AI\_TEXT\_ENG\_BEFORE\_POST, AI\_TEXT\_BEFORE\_POST, $hook\_parameter, 'ai\_loop\_check'); |
| [1504](#L1504) | } |
| [1505](#L1505) |  |
| [1506](#L1506) | function ai\_hook\_function\_loop\_end ($hook\_parameter) { |
| [1507](#L1507) | ai\_custom\_hook ('loop\_end', AI\_AUTOMATIC\_INSERTION\_AFTER\_POST, AI\_TEXT\_ENG\_AFTER\_POST, AI\_TEXT\_AFTER\_POST, $hook\_parameter, 'ai\_loop\_check'); |
| [1508](#L1508) | } |
| [1509](#L1509) |  |
| [1510](#L1510) | function ai\_hook\_function\_post ($hook\_parameter) { |
| [1511](#L1511) | ai\_custom\_hook ('the\_post', AI\_AUTOMATIC\_INSERTION\_BETWEEN\_POSTS, AI\_TEXT\_ENG\_BETWEEN\_POSTS, AI\_TEXT\_BETWEEN\_POSTS, $hook\_parameter, 'ai\_post\_check'); |
| [1512](#L1512) | } |
| [1513](#L1513) |  |
| [1514](#L1514) | function ai\_hook\_function\_footer () { |
| [1515](#L1515) | ai\_custom\_hook ('wp\_footer', AI\_AUTOMATIC\_INSERTION\_FOOTER, AI\_TEXT\_ENG\_FOOTER, AI\_TEXT\_FOOTER); |
| [1516](#L1516) | } |
| [1517](#L1517) |  |
| [1518](#L1518) |  |
| [1519](#L1519) | // Code for PHP VERSION >= 5.3.0 |
| [1520](#L1520) | //function ai\_get\_custom\_hook\_function ($action, $insertion\_type, $name) { |
| [1521](#L1521) | //  return function () use ($action, $insertion\_type, $name) { |
| [1522](#L1522) | //    ai\_custom\_hook ($action, $insertion\_type, $name); |
| [1523](#L1523) | //  }; |
| [1524](#L1524) | //} |
| [1525](#L1525) |  |
| [1526](#L1526) |  |
| [1527](#L1527) | // Code for PHP VERSION < 5.3.0 |
| [1528](#L1528) | function ai\_custom\_hook\_function\_0 () { |
| [1529](#L1529) | global $ai\_custom\_hooks; |
| [1530](#L1530) | ai\_custom\_hook ($ai\_custom\_hooks [0]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [0]['index'] - 1, $ai\_custom\_hooks [0]['name']); |
| [1531](#L1531) | } |
| [1532](#L1532) |  |
| [1533](#L1533) | function ai\_custom\_hook\_function\_1 () { |
| [1534](#L1534) | global $ai\_custom\_hooks; |
| [1535](#L1535) | ai\_custom\_hook ($ai\_custom\_hooks [1]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [1]['index'] - 1, $ai\_custom\_hooks [1]['name']); |
| [1536](#L1536) | } |
| [1537](#L1537) |  |
| [1538](#L1538) | function ai\_custom\_hook\_function\_2 () { |
| [1539](#L1539) | global $ai\_custom\_hooks; |
| [1540](#L1540) | ai\_custom\_hook ($ai\_custom\_hooks [2]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [2]['index'] - 1, $ai\_custom\_hooks [2]['name']); |
| [1541](#L1541) | } |
| [1542](#L1542) |  |
| [1543](#L1543) | function ai\_custom\_hook\_function\_3 () { |
| [1544](#L1544) | global $ai\_custom\_hooks; |
| [1545](#L1545) | ai\_custom\_hook ($ai\_custom\_hooks [3]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [3]['index'] - 1, $ai\_custom\_hooks [3]['name']); |
| [1546](#L1546) | } |
| [1547](#L1547) |  |
| [1548](#L1548) | function ai\_custom\_hook\_function\_4 () { |
| [1549](#L1549) | global $ai\_custom\_hooks; |
| [1550](#L1550) | ai\_custom\_hook ($ai\_custom\_hooks [4]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [4]['index'] - 1, $ai\_custom\_hooks [4]['name']); |
| [1551](#L1551) | } |
| [1552](#L1552) |  |
| [1553](#L1553) | function ai\_custom\_hook\_function\_5 () { |
| [1554](#L1554) | global $ai\_custom\_hooks; |
| [1555](#L1555) | ai\_custom\_hook ($ai\_custom\_hooks [5]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [5]['index'] - 1, $ai\_custom\_hooks [5]['name']); |
| [1556](#L1556) | } |
| [1557](#L1557) |  |
| [1558](#L1558) | function ai\_custom\_hook\_function\_6 () { |
| [1559](#L1559) | global $ai\_custom\_hooks; |
| [1560](#L1560) | ai\_custom\_hook ($ai\_custom\_hooks [6]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [6]['index'] - 1, $ai\_custom\_hooks [6]['name']); |
| [1561](#L1561) | } |
| [1562](#L1562) |  |
| [1563](#L1563) | function ai\_custom\_hook\_function\_7 () { |
| [1564](#L1564) | global $ai\_custom\_hooks; |
| [1565](#L1565) | ai\_custom\_hook ($ai\_custom\_hooks [7]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [7]['index'] - 1, $ai\_custom\_hooks [7]['name']); |
| [1566](#L1566) | } |
| [1567](#L1567) |  |
| [1568](#L1568) | function ai\_custom\_hook\_function\_8 () { |
| [1569](#L1569) | global $ai\_custom\_hooks; |
| [1570](#L1570) | ai\_custom\_hook ($ai\_custom\_hooks [8]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [8]['index'] - 1, $ai\_custom\_hooks [8]['name']); |
| [1571](#L1571) | } |
| [1572](#L1572) |  |
| [1573](#L1573) | function ai\_custom\_hook\_function\_9 () { |
| [1574](#L1574) | global $ai\_custom\_hooks; |
| [1575](#L1575) | ai\_custom\_hook ($ai\_custom\_hooks [9]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [9]['index'] - 1, $ai\_custom\_hooks [9]['name']); |
| [1576](#L1576) | } |
| [1577](#L1577) |  |
| [1578](#L1578) | function ai\_custom\_hook\_function\_10 () { |
| [1579](#L1579) | global $ai\_custom\_hooks; |
| [1580](#L1580) | ai\_custom\_hook ($ai\_custom\_hooks [10]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [10]['index'] - 1, $ai\_custom\_hooks [10]['name']); |
| [1581](#L1581) | } |
| [1582](#L1582) |  |
| [1583](#L1583) | function ai\_custom\_hook\_function\_11 () { |
| [1584](#L1584) | global $ai\_custom\_hooks; |
| [1585](#L1585) | ai\_custom\_hook ($ai\_custom\_hooks [11]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [11]['index'] - 1, $ai\_custom\_hooks [11]['name']); |
| [1586](#L1586) | } |
| [1587](#L1587) |  |
| [1588](#L1588) | function ai\_custom\_hook\_function\_12 () { |
| [1589](#L1589) | global $ai\_custom\_hooks; |
| [1590](#L1590) | ai\_custom\_hook ($ai\_custom\_hooks [12]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [12]['index'] - 1, $ai\_custom\_hooks [12]['name']); |
| [1591](#L1591) | } |
| [1592](#L1592) |  |
| [1593](#L1593) | function ai\_custom\_hook\_function\_13 () { |
| [1594](#L1594) | global $ai\_custom\_hooks; |
| [1595](#L1595) | ai\_custom\_hook ($ai\_custom\_hooks [13]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [13]['index'] - 1, $ai\_custom\_hooks [13]['name']); |
| [1596](#L1596) | } |
| [1597](#L1597) |  |
| [1598](#L1598) | function ai\_custom\_hook\_function\_14 () { |
| [1599](#L1599) | global $ai\_custom\_hooks; |
| [1600](#L1600) | ai\_custom\_hook ($ai\_custom\_hooks [14]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [14]['index'] - 1, $ai\_custom\_hooks [14]['name']); |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | function ai\_custom\_hook\_function\_15 () { |
| [1604](#L1604) | global $ai\_custom\_hooks; |
| [1605](#L1605) | ai\_custom\_hook ($ai\_custom\_hooks [15]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [15]['index'] - 1, $ai\_custom\_hooks [15]['name']); |
| [1606](#L1606) | } |
| [1607](#L1607) |  |
| [1608](#L1608) | function ai\_custom\_hook\_function\_16 () { |
| [1609](#L1609) | global $ai\_custom\_hooks; |
| [1610](#L1610) | ai\_custom\_hook ($ai\_custom\_hooks [16]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [16]['index'] - 1, $ai\_custom\_hooks [16]['name']); |
| [1611](#L1611) | } |
| [1612](#L1612) |  |
| [1613](#L1613) | function ai\_custom\_hook\_function\_17 () { |
| [1614](#L1614) | global $ai\_custom\_hooks; |
| [1615](#L1615) | ai\_custom\_hook ($ai\_custom\_hooks [17]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [17]['index'] - 1, $ai\_custom\_hooks [17]['name']); |
| [1616](#L1616) | } |
| [1617](#L1617) |  |
| [1618](#L1618) | function ai\_custom\_hook\_function\_18 () { |
| [1619](#L1619) | global $ai\_custom\_hooks; |
| [1620](#L1620) | ai\_custom\_hook ($ai\_custom\_hooks [18]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [18]['index'] - 1, $ai\_custom\_hooks [18]['name']); |
| [1621](#L1621) | } |
| [1622](#L1622) |  |
| [1623](#L1623) | function ai\_custom\_hook\_function\_19 () { |
| [1624](#L1624) | global $ai\_custom\_hooks; |
| [1625](#L1625) | ai\_custom\_hook ($ai\_custom\_hooks [19]['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $ai\_custom\_hooks [19]['index'] - 1, $ai\_custom\_hooks [19]['name']); |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | function ai\_wp\_hook () { |
| [1629](#L1629) | global $ai\_wp\_data, $ai\_db\_options\_extract, $ad\_inserter\_globals, $ai\_total\_plugin\_time, $ai\_walker, $ai\_custom\_hooks, $block\_object; |
| [1630](#L1630) |  |
| [1631](#L1631) | //  if (!get\_remote\_debugging ()) { |
| [1632](#L1632) | //    unset ($\_COOKIE ['AI\_WP\_DEBUGGING']); |
| [1633](#L1633) | //    ai\_setcookie ('AI\_WP\_DEBUGGING', null, - 1, '/'); |
| [1634](#L1634) | //  } |
| [1635](#L1635) |  |
| [1636](#L1636) | if (isset ($\_GET ["ai-get-settings"])) { |
| [1637](#L1637) | if (get\_remote\_debugging ()) { |
| [1638](#L1638) | ai\_disable\_caching (); |
| [1639](#L1639) |  |
| [1640](#L1640) | if (!function\_exists ('get\_editable\_roles')) { |
| [1641](#L1641) | include\_once (ABSPATH . 'wp-admin/includes/user.php'); |
| [1642](#L1642) | } |
| [1643](#L1643) |  |
| [1644](#L1644) | ai\_write\_settings\_string (); |
| [1645](#L1645) | exit; |
| [1646](#L1646) | } |
| [1647](#L1647) | } |
| [1648](#L1648) |  |
| [1649](#L1649) | if (defined ('AI\_WP\_HOOK')) return; |
| [1650](#L1650) | define ('AI\_WP\_HOOK', true); |
| [1651](#L1651) |  |
| [1652](#L1652) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1653](#L1653) | ai\_log ("WP HOOK START"); |
| [1654](#L1654) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [1655](#L1655) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [1656](#L1656) | $start\_time = microtime (true); |
| [1657](#L1657) | } |
| [1658](#L1658) |  |
| [1659](#L1659) | set\_page\_type (); |
| [1660](#L1660) | set\_user (); |
| [1661](#L1661) |  |
| [1662](#L1662) | ai\_http\_header (); |
| [1663](#L1663) |  |
| [1664](#L1664) | if (defined ('AI\_NO\_JQUERY')) { |
| [1665](#L1665) | // Check again if the constant is defined in the wp\_head hook |
| [1666](#L1666) | $ai\_wp\_data [AI\_NO\_JQUERY\_CODE] = true; |
| [1667](#L1667) | } |
| [1668](#L1668) |  |
| [1669](#L1669) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 && get\_disable\_caching ()) ai\_disable\_caching (); |
| [1670](#L1670) |  |
| [1671](#L1671) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0) { |
| [1672](#L1672) | $ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] = isset ($\_POST ['html\_element\_selection']) ? (bool) $\_POST ['html\_element\_selection'] : false; |
| [1673](#L1673) | } |
| [1674](#L1674) |  |
| [1675](#L1675) |  |
| [1676](#L1676) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_ADMIN && |
| [1677](#L1677) | ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 && |
| [1678](#L1678) | get\_admin\_toolbar\_debugging () && |
| [1679](#L1679) | (!is\_multisite() || is\_main\_site () || multisite\_settings\_page\_enabled ())) |
| [1680](#L1680) | add\_action ('admin\_bar\_menu', 'ai\_toolbar', 9920); |
| [1681](#L1681) |  |
| [1682](#L1682) | $url\_debugging = get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 || defined ('AI\_DEBUGGING\_DEMO'); |
| [1683](#L1683) |  |
| [1684](#L1684) | if (!is\_admin() || defined ('DOING\_AJAX') || defined ('AI\_DEBUGGING\_DEMO')) { |
| [1685](#L1685) | if (isset ($\_GET [AI\_URL\_DEBUG]) && $\_GET [AI\_URL\_DEBUG] == 0) { |
| [1686](#L1686) | if (isset ($\_COOKIE ['AI\_WP\_DEBUGGING'])) { |
| [1687](#L1687) | unset ($\_COOKIE ['AI\_WP\_DEBUGGING']); |
| [1688](#L1688) | ai\_setcookie ('AI\_WP\_DEBUGGING', '', time() - (15 \* 60), COOKIEPATH); |
| [1689](#L1689) | } |
| [1690](#L1690) | if (isset ($\_COOKIE ['AI\_WP\_DEBUG\_BLOCK'])) { |
| [1691](#L1691) | unset ($\_COOKIE ['AI\_WP\_DEBUG\_BLOCK']); |
| [1692](#L1692) | ai\_setcookie ('AI\_WP\_DEBUG\_BLOCK', '', time() - (15 \* 60), COOKIEPATH); |
| [1693](#L1693) | } |
| [1694](#L1694) | } else { |
| [1695](#L1695) | $ai\_wp\_data [AI\_WP\_DEBUGGING]   = isset ($\_COOKIE ['AI\_WP\_DEBUGGING'])   ? $ai\_wp\_data [AI\_WP\_DEBUGGING] | ($\_COOKIE ['AI\_WP\_DEBUGGING'] & ~AI\_DEBUG\_PROCESSING) : $ai\_wp\_data [AI\_WP\_DEBUGGING]; |
| [1696](#L1696) | $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] = isset ($\_COOKIE ['AI\_WP\_DEBUG\_BLOCK']) ? $\_COOKIE ['AI\_WP\_DEBUG\_BLOCK'] : 0; |
| [1697](#L1697) |  |
| [1698](#L1698) | if (isset ($\_GET [AI\_URL\_DEBUG\_BLOCKS])) |
| [1699](#L1699) | if ($\_GET [AI\_URL\_DEBUG\_BLOCKS] && $url\_debugging) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_BLOCKS; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_BLOCKS; |
| [1700](#L1700) |  |
| [1701](#L1701) | if (isset ($\_GET [AI\_URL\_DEBUG\_TAGS])) |
| [1702](#L1702) | if ($\_GET [AI\_URL\_DEBUG\_TAGS] && $url\_debugging) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_TAGS; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_TAGS; |
| [1703](#L1703) |  |
| [1704](#L1704) | if (isset ($\_GET [AI\_URL\_DEBUG\_NO\_INSERTION])) |
| [1705](#L1705) | if ($\_GET [AI\_URL\_DEBUG\_NO\_INSERTION] && $url\_debugging) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_NO\_INSERTION; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_NO\_INSERTION; |
| [1706](#L1706) |  |
| [1707](#L1707) | if (isset ($\_GET [AI\_URL\_DEBUG\_AD\_BLOCKING\_STATUS])) |
| [1708](#L1708) | if ($\_GET [AI\_URL\_DEBUG\_AD\_BLOCKING\_STATUS] && $url\_debugging) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_AD\_BLOCKING\_STATUS; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_AD\_BLOCKING\_STATUS; |
| [1709](#L1709) |  |
| [1710](#L1710) | if (isset ($\_GET [AI\_URL\_DEBUG\_AD\_BLOCKING])) |
| [1711](#L1711) | if ($\_GET [AI\_URL\_DEBUG\_AD\_BLOCKING] && $url\_debugging) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_AD\_BLOCKING; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_AD\_BLOCKING; |
| [1712](#L1712) |  |
| [1713](#L1713) | if (isset ($\_GET [AI\_URL\_DEBUG\_POSITIONS])) { |
| [1714](#L1714) | $secret = isset ($\_GET ['ai-secret']) && $\_GET ['ai-secret'] == ai\_secret\_key (); |
| [1715](#L1715) | if ($secret) { |
| [1716](#L1716) | ai\_disable\_caching (); |
| [1717](#L1717) | } |
| [1718](#L1718) | if ($\_GET [AI\_URL\_DEBUG\_POSITIONS] !== '' && ($url\_debugging || $secret)) $ai\_wp\_data [AI\_WP\_DEBUGGING] |= AI\_DEBUG\_POSITIONS; else $ai\_wp\_data [AI\_WP\_DEBUGGING] &= ~AI\_DEBUG\_POSITIONS; |
| [1719](#L1719) | if (is\_numeric ($\_GET [AI\_URL\_DEBUG\_POSITIONS])) $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] = intval ($\_GET [AI\_URL\_DEBUG\_POSITIONS]); |
| [1720](#L1720) | if ($ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] < 0 || $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] > 96) $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] = 0; |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | if (!defined ('AI\_DEBUGGING\_DEMO')) { |
| [1724](#L1724) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) { |
| [1725](#L1725) | if (!isset ($\_GET ['no-cookie'])) { |
| [1726](#L1726) | ai\_setcookie ('AI\_WP\_DEBUGGING',   $ai\_wp\_data [AI\_WP\_DEBUGGING],   time() + AI\_COOKIE\_TIME, COOKIEPATH); |
| [1727](#L1727) | } |
| [1728](#L1728) | } else if (isset ($\_COOKIE ['AI\_WP\_DEBUGGING'])) ai\_setcookie ('AI\_WP\_DEBUGGING', '', time() - (15 \* 60), COOKIEPATH); |
| [1729](#L1729) |  |
| [1730](#L1730) | if ($ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] != 0) { |
| [1731](#L1731) | if (!isset ($\_GET ['no-cookie'])) { |
| [1732](#L1732) | ai\_setcookie ('AI\_WP\_DEBUG\_BLOCK', $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK], time() + AI\_COOKIE\_TIME, COOKIEPATH); |
| [1733](#L1733) | } |
| [1734](#L1734) | } else if (isset ($\_COOKIE ['AI\_WP\_DEBUG\_BLOCK'])) ai\_setcookie ('AI\_WP\_DEBUG\_BLOCK', '', time() - (15 \* 60), COOKIEPATH); |
| [1735](#L1735) |  |
| [1736](#L1736) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0 || isset ($\_GET [AI\_URL\_DEBUG]) || isset ($\_GET [AI\_URL\_DEBUG\_BLOCKS]) || isset ($\_GET [AI\_URL\_DEBUG\_POSITIONS]) || isset ($\_GET [AI\_URL\_DEBUG\_TAGS]) || isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE])) { |
| [1737](#L1737) | ai\_disable\_caching (); |
| [1738](#L1738) | } |
| [1739](#L1739) |  |
| [1740](#L1740) | if ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] && ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0 && get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE\_W3TC && !defined ('AI\_NO\_W3TC')) { |
| [1741](#L1741) | $ai\_wp\_data [AI\_W3TC\_DEBUGGING] = true; |
| [1742](#L1742) | } |
| [1743](#L1743) | } else { |
| [1744](#L1744) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) { |
| [1745](#L1745) | ai\_disable\_caching (); |
| [1746](#L1746) | } |
| [1747](#L1747) | } |
| [1748](#L1748) | } |
| [1749](#L1749) | } |
| [1750](#L1750) |  |
| [1751](#L1751) | if ($ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION]) { |
| [1752](#L1752) | add\_filter ('show\_admin\_bar', '\_\_return\_false', 999999); |
| [1753](#L1753) | $ai\_wp\_data [AI\_WP\_DEBUGGING] = 0; |
| [1754](#L1754) | } |
| [1755](#L1755) | elseif (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) == 0 && |
| [1756](#L1756) | ((get\_remote\_debugging () && ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0 || (isset ($\_GET [AI\_URL\_DEBUG]) && $\_GET [AI\_URL\_DEBUG] == 1))) || |
| [1757](#L1757) | defined ('AI\_DEBUGGING\_DEMO'))) { |
| [1758](#L1758) | function ai\_login\_adminbar ($wp\_admin\_bar) { |
| [1759](#L1759) | $wp\_admin\_bar->add\_menu (array ('id' => 'ai-toolbar-login', 'title' => \_x('Log In', 'Menu item', 'ad-inserter'), 'href' => wp\_login\_url())); |
| [1760](#L1760) | } |
| [1761](#L1761) |  |
| [1762](#L1762) | add\_filter ('show\_admin\_bar', '\_\_return\_true', 999999); |
| [1763](#L1763) | add\_action ('admin\_bar\_menu', 'ai\_toolbar', 9920); |
| [1764](#L1764) | if (!defined ('AI\_DEBUGGING\_DEMO')) { |
| [1765](#L1765) | add\_action ('admin\_bar\_menu', 'ai\_login\_adminbar' ); |
| [1766](#L1766) | } |
| [1767](#L1767) | } |
| [1768](#L1768) |  |
| [1769](#L1769) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 && get\_force\_admin\_toolbar ()) { |
| [1770](#L1770) | add\_filter ('show\_admin\_bar', '\_\_return\_true', 999999); |
| [1771](#L1771) | } |
| [1772](#L1772) |  |
| [1773](#L1773) | $debug\_positions             = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0; |
| [1774](#L1774) | $debug\_tags\_positions        = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_TAGS)) != 0; |
| [1775](#L1775) | $debug\_tags\_positions\_blocks = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_TAGS | AI\_DEBUG\_BLOCKS)) != 0; |
| [1776](#L1776) |  |
| [1777](#L1777) | $plugin\_priority = get\_plugin\_priority (); |
| [1778](#L1778) |  |
| [1779](#L1779) | if (isset ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_tags\_positions) |
| [1780](#L1780) | add\_filter ('the\_content',        'ai\_content\_hook', $plugin\_priority); |
| [1781](#L1781) |  |
| [1782](#L1782) | if (isset ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_tags\_positions\_blocks) |
| [1783](#L1783) | add\_filter ('the\_excerpt',        'ai\_excerpt\_hook', $plugin\_priority); |
| [1784](#L1784) |  |
| [1785](#L1785) | add\_action ('loop\_start', 'ai\_mark\_loop\_start'); |
| [1786](#L1786) | if (isset ($ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) |
| [1787](#L1787) | add\_action ('loop\_start',         'ai\_hook\_function\_loop\_start'); |
| [1788](#L1788) |  |
| [1789](#L1789) | add\_action ('loop\_end', 'ai\_mark\_loop\_end'); |
| [1790](#L1790) | if (isset ($ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) |
| [1791](#L1791) | add\_action ('loop\_end',           'ai\_hook\_function\_loop\_end'); |
| [1792](#L1792) |  |
| [1793](#L1793) | if (isset ($ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) |
| [1794](#L1794) | add\_action ('the\_post',           'ai\_hook\_function\_post'); |
| [1795](#L1795) |  |
| [1796](#L1796) | if ((isset ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0) || |
| [1797](#L1797) | (isset ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0) || |
| [1798](#L1798) | (isset ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0) || |
| [1799](#L1799) | $debug\_positions) { |
| [1800](#L1800) | $ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS] = 0; |
| [1801](#L1801) | add\_filter ('comments\_array' ,        'ai\_comments\_array', 10, 2); |
| [1802](#L1802) | add\_filter ('wp\_list\_comments\_args' , 'ai\_wp\_list\_comments\_args'); |
| [1803](#L1803) | $ai\_walker = new ai\_Walker\_Comment; |
| [1804](#L1804) | } |
| [1805](#L1805) |  |
| [1806](#L1806) |  |
| [1807](#L1807) | // Code for PHP VERSION >= 5.3.0 |
| [1808](#L1808) | //  foreach ($ai\_custom\_hooks as $index => $custom\_hook) { |
| [1809](#L1809) | //    if (isset ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) |
| [1810](#L1810) | //      add\_action ($custom\_hook ['action'], ai\_get\_custom\_hook\_function ($custom\_hook ['action'], AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $custom\_hook ['index'] - 1, $custom\_hook ['name']), $custom\_hook ['priority']); |
| [1811](#L1811) | //  } |
| [1812](#L1812) |  |
| [1813](#L1813) | // Code for PHP VERSION < 5.3.0 |
| [1814](#L1814) | foreach ($ai\_custom\_hooks as $index => $custom\_hook) { |
| [1815](#L1815) | if ($index >= 20) break; |
| [1816](#L1816) |  |
| [1817](#L1817) | // Skip custom hooks on standard WP hooks - they will be processed anyway |
| [1818](#L1818) | switch ($custom\_hook ['action']) { |
| [1819](#L1819) | case 'wp\_footer': |
| [1820](#L1820) | //      case 'wp\_head':   // no block processing on wp\_head |
| [1821](#L1821) | case 'the\_content': |
| [1822](#L1822) | case 'the\_excerpt': |
| [1823](#L1823) | case 'loop\_start': |
| [1824](#L1824) | case 'loop\_end': |
| [1825](#L1825) | //      case 'the\_post':  // ai\_custom\_hook distinguishes between custom hooks and Between posts |
| [1826](#L1826) | continue 2; |
| [1827](#L1827) | } |
| [1828](#L1828) |  |
| [1829](#L1829) | $hook\_number = $custom\_hook ['index']; |
| [1830](#L1830) |  |
| [1831](#L1831) | //    if (isset ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) { |
| [1832](#L1832) | if (get\_hook\_enabled ($hook\_number) && isset ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions) { |
| [1833](#L1833) | // There might be more than one hook with the same action - block can use only one hook |
| [1834](#L1834) | $hook\_used = false; |
| [1835](#L1835) | foreach ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [1836](#L1836) | $obj = $block\_object [$block]; |
| [1837](#L1837) | if ($obj->get\_automatic\_insertion () == AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $hook\_number - 1) { |
| [1838](#L1838) | $hook\_used = true; |
| [1839](#L1839) | break; |
| [1840](#L1840) | } |
| [1841](#L1841) | } |
| [1842](#L1842) |  |
| [1843](#L1843) | if ($hook\_used) { |
| [1844](#L1844) | add\_action ($custom\_hook ['action'], 'ai\_custom\_hook\_function\_' . $index, $custom\_hook ['priority']); |
| [1845](#L1845) | } |
| [1846](#L1846) |  |
| [1847](#L1847) | } |
| [1848](#L1848) | } |
| [1849](#L1849) |  |
| [1850](#L1850) |  |
| [1851](#L1851) | if ($ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT]) { |
| [1852](#L1852) | if (trim (get\_main\_content\_element () == '')) { |
| [1853](#L1853) | if (!defined ('AI\_CONTENT\_MARKER\_NO\_LOOP\_START')) { |
| [1854](#L1854) | add\_action ('loop\_start',    'ai\_content\_marker'); |
| [1855](#L1855) | } |
| [1856](#L1856) | if (!defined ('AI\_CONTENT\_MARKER\_NO\_LOOP\_END')) { |
| [1857](#L1857) | add\_action ('loop\_end',      'ai\_content\_marker'); |
| [1858](#L1858) | } |
| [1859](#L1859) | if (!defined ('AI\_CONTENT\_MARKER\_NO\_GET\_SIDEBAR')) { |
| [1860](#L1860) | add\_action ('get\_sidebar',   'ai\_content\_marker'); |
| [1861](#L1861) | } |
| [1862](#L1862) | } |
| [1863](#L1863) | } |
| [1864](#L1864) |  |
| [1865](#L1865) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE] ) { |
| [1866](#L1866) | // AMP, Accelerated Mobile Pages |
| [1867](#L1867) | add\_action ('amp\_post\_template\_head', 'ai\_amp\_head\_hook', 99999); |
| [1868](#L1868) | add\_action ('amp\_post\_template\_css',  'ai\_amp\_css\_hook',  99999); |
| [1869](#L1869) | add\_action ('wp\_head',                'ai\_amp\_head\_hook', 99999); |
| [1870](#L1870) | add\_action ('wp\_head',                'ai\_amp\_css\_hook\_style',  99999); |
| [1871](#L1871) |  |
| [1872](#L1872) | // WP AMP Ninja |
| [1873](#L1873) | add\_action ('wpamp\_custom\_script',    'ai\_amp\_head\_hook', 99999); |
| [1874](#L1874) | // No usable hook for custom CSS |
| [1875](#L1875) | //    add\_action ('wpamp\_custom\_style',     'ai\_amp\_css\_hook', 99999); |
| [1876](#L1876) |  |
| [1877](#L1877) | // WP AMP - Accelerated Mobile Pages for WordPress |
| [1878](#L1878) | add\_action ('amphtml\_template\_head',  'ai\_amp\_head\_hook', 99999); |
| [1879](#L1879) | add\_action ('amphtml\_template\_css',   'ai\_amp\_css\_hook', 99999); |
| [1880](#L1880) |  |
| [1881](#L1881) | // Better AMP - WordPress Complete AMP |
| [1882](#L1882) | add\_action ('better-amp/template/head', 'ai\_amp\_head\_hook', 99999); |
| [1883](#L1883) | // No usable hook for custom CSS |
| [1884](#L1884) | //    add\_action ('better-amp/template/css',  'ai\_amp\_css\_hook', 99999); |
| [1885](#L1885) |  |
| [1886](#L1886) | // AMP WP - Google AMP For WordPress |
| [1887](#L1887) | add\_action ('amp\_wp\_template\_head', 'ai\_amp\_head\_hook', 99999); |
| [1888](#L1888) | // No usable hook for custom CSS |
| [1889](#L1889) | //    add\_action ('amp\_wp\_template\_head', 'ai\_amp\_css\_hook', 99999); |
| [1890](#L1890) | } else |
| [1891](#L1891) | // WP |
| [1892](#L1892) | add\_action ('wp\_head',                  'ai\_wp\_head\_hook', 99999); |
| [1893](#L1893) |  |
| [1894](#L1894) | $automatic\_insertion\_footer\_hook = isset ($ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) != 0 || $debug\_positions; |
| [1895](#L1895) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [1896](#L1896) | // AMP, Accelerated Mobile Pages |
| [1897](#L1897) | if ($automatic\_insertion\_footer\_hook) { |
| [1898](#L1898) | add\_action ('amp\_post\_template\_footer',     'ai\_hook\_function\_footer', 5); |
| [1899](#L1899) | add\_action ('wp\_footer',                    'ai\_hook\_function\_footer', 5); |
| [1900](#L1900) | } |
| [1901](#L1901) | add\_action ('amp\_post\_template\_footer',     'ai\_amp\_footer\_hook', 5); |
| [1902](#L1902) | add\_action ('wp\_footer',                    'ai\_amp\_footer\_hook', 5); |
| [1903](#L1903) |  |
| [1904](#L1904) | // WP AMP Ninja |
| [1905](#L1905) | if ($automatic\_insertion\_footer\_hook) |
| [1906](#L1906) | add\_action ('wpamp\_google\_analytics\_code',  'ai\_hook\_function\_footer', 5); |
| [1907](#L1907) | add\_action ('wpamp\_google\_analytics\_code',  'ai\_amp\_footer\_hook', 5); |
| [1908](#L1908) |  |
| [1909](#L1909) | // WP AMP - Accelerated Mobile Pages for WordPress |
| [1910](#L1910) | if ($automatic\_insertion\_footer\_hook) |
| [1911](#L1911) | add\_action ('amphtml\_after\_footer',         'ai\_hook\_function\_footer', 5); |
| [1912](#L1912) | add\_action ('amphtml\_after\_footer',         'ai\_amp\_footer\_hook', 5); |
| [1913](#L1913) |  |
| [1914](#L1914) | // Better AMP - WordPress Complete AMP |
| [1915](#L1915) | if ($automatic\_insertion\_footer\_hook) |
| [1916](#L1916) | add\_action ('better-amp/template/footer', 'ai\_hook\_function\_footer', 5); |
| [1917](#L1917) | add\_action ('better-amp/template/footer', 'ai\_amp\_footer\_hook', 5); |
| [1918](#L1918) |  |
| [1919](#L1919) | // AMP WP - Google AMP For WordPress |
| [1920](#L1920) | if ($automatic\_insertion\_footer\_hook) |
| [1921](#L1921) | add\_action ('amp\_wp\_template\_footer', 'ai\_hook\_function\_footer', 5); |
| [1922](#L1922) | add\_action ('amp\_wp\_template\_footer', 'ai\_amp\_footer\_hook', 5); |
| [1923](#L1923) |  |
| [1924](#L1924) | } else { |
| [1925](#L1925) | // WP |
| [1926](#L1926) | if ($automatic\_insertion\_footer\_hook) |
| [1927](#L1927) | add\_action ('wp\_footer', 'ai\_hook\_function\_footer', 5); |
| [1928](#L1928) | add\_action ('wp\_footer', 'ai\_wp\_footer\_hook\_end\_buffering', 5); |
| [1929](#L1929) | add\_action ('wp\_footer', 'ai\_wp\_footer\_hook', 9999999); |
| [1930](#L1930) | } |
| [1931](#L1931) |  |
| [1932](#L1932) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [1933](#L1933) | // No scripts on AMP pages |
| [1934](#L1934) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [1935](#L1935) | $ai\_wp\_data [AI\_ADB\_DETECTION] = false; |
| [1936](#L1936) | $ai\_wp\_data [AI\_TRACKING]      = false; |
| [1937](#L1937) | } |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1941](#L1941) | if (!$ai\_processing\_time\_active) { |
| [1942](#L1942) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [1943](#L1943) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [1944](#L1944) | } |
| [1945](#L1945) | ai\_log ("WP HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [1946](#L1946) | } |
| [1947](#L1947) | }; |
| [1948](#L1948) |  |
| [1949](#L1949) | function ai\_load\_plugin\_textdomain\_hook () { |
| [1950](#L1950) | unload\_textdomain ('ad-inserter'); |
| [1951](#L1951) | load\_plugin\_textdomain ('ad-inserter', false, basename (dirname (\_\_FILE\_\_)) . '/languages/'); |
| [1952](#L1952) | } |
| [1953](#L1953) |  |
| [1954](#L1954) | function ai\_load\_textdomain\_mofile ($mo\_file, $domain) { |
| [1955](#L1955) | global $ai\_wp\_data; |
| [1956](#L1956) |  |
| [1957](#L1957) | if (strpos ($mo\_file, 'ad-inserter') !== false) { |
| [1958](#L1958) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1959](#L1959) |  |
| [1960](#L1960) | $relative\_mo\_file = $mo\_file; |
| [1961](#L1961) | if (defined ('WP\_CONTENT\_DIR')) { |
| [1962](#L1962) | $relative\_mo\_file = str\_replace (WP\_CONTENT\_DIR, '', $relative\_mo\_file); |
| [1963](#L1963) | } else { |
| [1964](#L1964) | $wp\_content\_pos = strpos ($relative\_mo\_file, '/wp-content/'); |
| [1965](#L1965) | if ($wp\_content\_pos !== false) { |
| [1966](#L1966) | $relative\_mo\_file = substr ($relative\_mo\_file, $wp\_content\_pos); |
| [1967](#L1967) | } |
| [1968](#L1968) | } |
| [1969](#L1969) |  |
| [1970](#L1970) | switch (file\_exists ($mo\_file)) { |
| [1971](#L1971) | case true: |
| [1972](#L1972) | ai\_log ("TRANSLATION FILE:     " . $relative\_mo\_file); |
| [1973](#L1973) | break; |
| [1974](#L1974) | default: |
| [1975](#L1975) | ai\_log ("FILE NOT FOUND:       " . $relative\_mo\_file); |
| [1976](#L1976) | break; |
| [1977](#L1977) | } |
| [1978](#L1978) | } |
| [1979](#L1979) |  |
| [1980](#L1980) | $path = explode ('/', $mo\_file); |
| [1981](#L1981) | $new\_mo\_file = dirname (\_\_FILE\_\_) . '/languages/' . end ($path); |
| [1982](#L1982) |  |
| [1983](#L1983) | if (file\_exists ($new\_mo\_file)) { |
| [1984](#L1984) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1985](#L1985) | ai\_log ("USING FILE:           " . $new\_mo\_file); |
| [1986](#L1986) | } |
| [1987](#L1987) | return ($new\_mo\_file); |
| [1988](#L1988) | } |
| [1989](#L1989) | } |
| [1990](#L1990) |  |
| [1991](#L1991) | return ($mo\_file); |
| [1992](#L1992) | } |
| [1993](#L1993) |  |
| [1994](#L1994) |  |
| [1995](#L1995) | function ai\_plugins\_loaded () { |
| [1996](#L1996) | global $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [1997](#L1997) |  |
| [1998](#L1998) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [1999](#L1999) | ai\_log ("PLUGINS LOADED START"); |
| [2000](#L2000) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [2001](#L2001) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [2002](#L2002) | $start\_time = microtime (true); |
| [2003](#L2003) | } |
| [2004](#L2004) |  |
| [2005](#L2005) | add\_shortcode ('adinserter', 'ai\_process\_shortcodes'); |
| [2006](#L2006) | add\_shortcode ('ADINSERTER', 'ai\_process\_shortcodes'); |
| [2007](#L2007) |  |
| [2008](#L2008) | // TO DO: check referrer |
| [2009](#L2009) |  |
| [2010](#L2010) | add\_filter ('pre\_do\_shortcode\_tag', 'ai\_pre\_do\_shortcode\_tag', 10, 4); |
| [2011](#L2011) |  |
| [2012](#L2012) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2013](#L2013) | if (!$ai\_processing\_time\_active) { |
| [2014](#L2014) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [2015](#L2015) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [2016](#L2016) | } |
| [2017](#L2017) | ai\_log ("PLUGINS LOADED END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [2018](#L2018) | } |
| [2019](#L2019) | } |
| [2020](#L2020) |  |
| [2021](#L2021) | function ai\_init\_hook () { |
| [2022](#L2022) | global $block\_object, $ai\_wp\_data, $ai\_db\_options\_extract, $ai\_total\_plugin\_time; |
| [2023](#L2023) |  |
| [2024](#L2024) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2025](#L2025) | ai\_log ("INIT HOOK START"); |
| [2026](#L2026) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [2027](#L2027) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [2028](#L2028) | $start\_time = microtime (true); |
| [2029](#L2029) | } |
| [2030](#L2030) |  |
| [2031](#L2031) | if ($ai\_wp\_data [AI\_DISABLE\_TRANSLATION]) { |
| [2032](#L2032) | unload\_textdomain ('ad-inserter'); |
| [2033](#L2033) |  |
| [2034](#L2034) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2035](#L2035) | ai\_log ("TRANSLATION UNLOADED"); |
| [2036](#L2036) | } |
| [2037](#L2037) | } |
| [2038](#L2038) |  |
| [2039](#L2039) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'strings.php'; |
| [2040](#L2040) |  |
| [2041](#L2041) | if (defined ('DOING\_AJAX') && DOING\_AJAX) { |
| [2042](#L2042) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_AJAX; |
| [2043](#L2043) |  |
| [2044](#L2044) | ai\_load\_extract (); |
| [2045](#L2045) |  |
| [2046](#L2046) | ai\_wp\_hook (); |
| [2047](#L2047) | } |
| [2048](#L2048) |  |
| [2049](#L2049) | // Experimental |
| [2050](#L2050) | elseif (is\_rest ()) { |
| [2051](#L2051) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] = AI\_PT\_REST; |
| [2052](#L2052) |  |
| [2053](#L2053) | ai\_load\_extract (); |
| [2054](#L2054) |  |
| [2055](#L2055) | ai\_wp\_hook (); |
| [2056](#L2056) | } |
| [2057](#L2057) |  |
| [2058](#L2058) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [2059](#L2059) | if ($ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [2060](#L2060) | if (function\_exists ('ai\_check\_files')) ai\_check\_files (); |
| [2061](#L2061) | } |
| [2062](#L2062) | } |
| [2063](#L2063) |  |
| [2064](#L2064) |  |
| [2065](#L2065) | //  add\_shortcode ('adinserter', 'ai\_process\_shortcodes'); |
| [2066](#L2066) | //  add\_shortcode ('ADINSERTER', 'ai\_process\_shortcodes'); |
| [2067](#L2067) |  |
| [2068](#L2068) | //  // TO DO: check referrer |
| [2069](#L2069) |  |
| [2070](#L2070) | //  add\_filter ('pre\_do\_shortcode\_tag', 'ai\_pre\_do\_shortcode\_tag', 10, 4); |
| [2071](#L2071) |  |
| [2072](#L2072) |  |
| [2073](#L2073) |  |
| [2074](#L2074) | //  if (defined ('AI\_BUFFERING')) { |
| [2075](#L2075) | //    if (get\_output\_buffering ()) { |
| [2076](#L2076) | //      if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2077](#L2077) | //        ai\_buffering\_start (); |
| [2078](#L2078) | //      } |
| [2079](#L2079) | //    } |
| [2080](#L2080) | //  } |
| [2081](#L2081) |  |
| [2082](#L2082) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2083](#L2083) | if (!$ai\_processing\_time\_active) { |
| [2084](#L2084) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [2085](#L2085) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [2086](#L2086) | } |
| [2087](#L2087) | ai\_log ("INIT HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [2088](#L2088) | } |
| [2089](#L2089) | } |
| [2090](#L2090) |  |
| [2091](#L2091) | //function ai\_upgrader\_process\_complete\_hook ($upgrader\_object, $options) { |
| [2092](#L2092) | //  global $ai\_db\_options, $ai\_db\_options\_extract; |
| [2093](#L2093) |  |
| [2094](#L2094) | //  if (is\_array ($options) && array\_key\_exists ('action', $options) && $options ['action'] == 'update' && array\_key\_exists ('type', $options)) { |
| [2095](#L2095) | //    if ($options ['type'] == 'plugin' && array\_key\_exists ('plugins', $options) && is\_array ($options ['plugins']) && !empty ($options ['plugins'])) { |
| [2096](#L2096) | //      $this\_plugin = plugin\_basename (\_\_FILE\_\_); |
| [2097](#L2097) | //      foreach ($options ['plugins'] as $plugin) { |
| [2098](#L2098) | //        if ($plugin == $this\_plugin) { |
| [2099](#L2099) | //          if (defined ('AI\_EXTRACT\_GENERATED') && isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'])) { |
| [2100](#L2100) | //            $ai\_db\_options [AI\_OPTION\_EXTRACT] = $ai\_db\_options\_extract; |
| [2101](#L2101) | //            ai\_update\_option (AI\_OPTION\_NAME, $ai\_db\_options); |
| [2102](#L2102) | //          } |
| [2103](#L2103) | //          break; |
| [2104](#L2104) | //        } |
| [2105](#L2105) | //      } |
| [2106](#L2106) | //    } |
| [2107](#L2107) | //  } |
| [2108](#L2108) | //} |
| [2109](#L2109) |  |
| [2110](#L2110) | function ai\_load\_extract ($recreate = true) { |
| [2111](#L2111) | global $ai\_db\_options, $ai\_db\_options\_extract, $version\_string, $subversion\_string; |
| [2112](#L2112) |  |
| [2113](#L2113) | if (isset ($ai\_db\_options\_extract)) return true; |
| [2114](#L2114) |  |
| [2115](#L2115) | $expected\_extract\_version = $version\_string . $subversion\_string . '-' . '96'; |
| [2116](#L2116) | if (function\_exists ('ai\_system\_output\_check')) { |
| [2117](#L2117) | $expected\_extract\_version .= 'P'; |
| [2118](#L2118) | } |
| [2119](#L2119) |  |
| [2120](#L2120) | if (isset ($ai\_db\_options [AI\_OPTION\_EXTRACT]['VERSION']) && $ai\_db\_options [AI\_OPTION\_EXTRACT]['VERSION'] == $expected\_extract\_version) { |
| [2121](#L2121) | $ai\_db\_options\_extract = $ai\_db\_options [AI\_OPTION\_EXTRACT]; |
| [2122](#L2122) | return true; |
| [2123](#L2123) | } else { |
| [2124](#L2124) | if (($saved\_extract = get\_option (AI\_EXTRACT\_NAME)) === false || $saved\_extract ['VERSION'] != $expected\_extract\_version) { |
| [2125](#L2125) | if ($recreate) { |
| [2126](#L2126) | $ai\_db\_options\_extract = ai\_generate\_extract ($ai\_db\_options); |
| [2127](#L2127) | $ai\_db\_options [AI\_OPTION\_EXTRACT] = $ai\_db\_options\_extract; |
| [2128](#L2128) | if (get\_option (AI\_OPTION\_NAME) !== false && !defined ('AI\_LOADED\_REMOTE\_SETTINGS')) { |
| [2129](#L2129) | update\_option (AI\_EXTRACT\_NAME, $ai\_db\_options\_extract); |
| [2130](#L2130) | } |
| [2131](#L2131) | return true; |
| [2132](#L2132) | } |
| [2133](#L2133) | } else { |
| [2134](#L2134) | $ai\_db\_options\_extract = $saved\_extract; |
| [2135](#L2135) | $ai\_db\_options [AI\_OPTION\_EXTRACT] = $ai\_db\_options\_extract; |
| [2136](#L2136) | return true; |
| [2137](#L2137) | } |
| [2138](#L2138) | } |
| [2139](#L2139) | return false; |
| [2140](#L2140) | } |
| [2141](#L2141) |  |
| [2142](#L2142) | function ai\_wp\_loaded\_hook () { |
| [2143](#L2143) | global $ai\_total\_plugin\_time, $ai\_wp\_data; |
| [2144](#L2144) |  |
| [2145](#L2145) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2146](#L2146) | ai\_log ("WP LOADED HOOK START"); |
| [2147](#L2147) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [2148](#L2148) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [2149](#L2149) | $start\_time = microtime (true); |
| [2150](#L2150) | } |
| [2151](#L2151) |  |
| [2152](#L2152) | ai\_load\_extract (); |
| [2153](#L2153) |  |
| [2154](#L2154) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [2155](#L2155) | if (!$ai\_processing\_time\_active) { |
| [2156](#L2156) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [2157](#L2157) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [2158](#L2158) | } |
| [2159](#L2159) | if (defined ('AI\_EXTRACT\_GENERATED')) ai\_log ("EXTRACT GENERATED"); |
| [2160](#L2160) | ai\_log ("WP LOADED HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [2161](#L2161) | } |
| [2162](#L2162) | } |
| [2163](#L2163) |  |
| [2164](#L2164) | function ai\_admin\_menu\_hook () { |
| [2165](#L2165) | global $ai\_settings\_page; |
| [2166](#L2166) |  |
| [2167](#L2167) | if (is\_multisite() && !is\_main\_site () && !multisite\_settings\_page\_enabled ()) return; |
| [2168](#L2168) |  |
| [2169](#L2169) | $menu\_position = get\_menu\_position (); |
| [2170](#L2170) |  |
| [2171](#L2171) | if (isset ($\_POST [AI\_FORM\_SAVE])) { |
| [2172](#L2172) | if (isset ($\_POST ['menu-for-link'])) { |
| [2173](#L2173) | $menu\_position = $\_POST ['menu-for-link']; |
| [2174](#L2174) | } else $menu\_position = DEFAULT\_MENU\_FOR\_LINK; |
| [2175](#L2175) | } |
| [2176](#L2176) |  |
| [2177](#L2177) | if ($menu\_position == AI\_SETTINGS\_SUBMENU) { |
| [2178](#L2178) | // translators: %s: Ad Inserter |
| [2179](#L2179) | $ai\_settings\_page = add\_submenu\_page ('options-general.php', sprintf (\_\_('%s Settings', 'ad-inserter'), AD\_INSERTER\_NAME), AD\_INSERTER\_NAME, 'manage\_options', basename (\_\_FILE\_\_), 'ai\_settings', defined ('AI\_SETTINGS\_MENU\_PRIORITY') ? AI\_SETTINGS\_MENU\_PRIORITY : DEFAULT\_SETTINGS\_SUBMENU\_PRIORITY); |
| [2180](#L2180) | } else { |
| [2181](#L2181) | // translators: %s: Ad Inserter |
| [2182](#L2182) | $ai\_settings\_page = add\_menu\_page (sprintf (\_\_('%s Settings', 'ad-inserter'), AD\_INSERTER\_NAME), AD\_INSERTER\_NAME, 'manage\_options', basename (\_\_FILE\_\_), 'ai\_settings', 'dashicons-layout', defined ('AI\_SETTINGS\_MENU\_PRIORITY') ? AI\_SETTINGS\_MENU\_PRIORITY : DEFAULT\_SETTINGS\_MENU\_PRIORITY); |
| [2183](#L2183) | } |
| [2184](#L2184) |  |
| [2185](#L2185) | add\_action ('admin\_enqueue\_scripts',  'ai\_admin\_enqueue\_scripts'); |
| [2186](#L2186) | add\_action ('admin\_enqueue\_scripts',  'ai\_admin\_enqueue\_scripts\_late', 99999); |
| [2187](#L2187) | add\_action ('admin\_enqueue\_scripts',  'ai\_admin\_remove\_scripts', 99999); |
| [2188](#L2188) | add\_action ('admin\_head',             'ai\_admin\_head'); |
| [2189](#L2189) | add\_filter ('clean\_url',              'ai\_clean\_url', 999999, 2); |
| [2190](#L2190) | } |
| [2191](#L2191) |  |
| [2192](#L2192) | function ai\_admin\_head () { |
| [2193](#L2193) | global $ai\_settings\_page, $hook\_suffix; |
| [2194](#L2194) |  |
| [2195](#L2195) | if ($hook\_suffix == $ai\_settings\_page && wp\_is\_mobile()) { |
| [2196](#L2196) | echo '<meta name="viewport" content="width=762">', PHP\_EOL; |
| [2197](#L2197) | } |
| [2198](#L2198) | } |
| [2199](#L2199) |  |
| [2200](#L2200) | function ai\_admin\_enqueue\_scripts ($hook\_suffix) { |
| [2201](#L2201) | global $ai\_settings\_page, $ai\_admin\_translations; |
| [2202](#L2202) |  |
| [2203](#L2203) | if ($hook\_suffix == $ai\_settings\_page) { |
| [2204](#L2204) | wp\_enqueue\_style  ('ai-admin-jquery-ui', plugins\_url ('css/jquery-ui-1.10.3.custom.min.css', \_\_FILE\_\_), array (), null); |
| [2205](#L2205) |  |
| [2206](#L2206) | wp\_enqueue\_style ('ai-colorpicker-css',  plugins\_url ('includes/colorpicker/css/bootstrap-colorpicker.min.css',    AD\_INSERTER\_FILE), array (), AD\_INSERTER\_VERSION); |
| [2207](#L2207) |  |
| [2208](#L2208) | if (function\_exists ('ai\_admin\_enqueue\_scripts\_1')) ai\_admin\_enqueue\_scripts\_1 (); |
| [2209](#L2209) |  |
| [2210](#L2210) | wp\_enqueue\_style  ('ai-admin-multi-select', plugins\_url ('css/multi-select.css', AD\_INSERTER\_FILE),     array (), AD\_INSERTER\_VERSION); |
| [2211](#L2211) | wp\_enqueue\_style  ('ai-image-picker',    plugins\_url ('css/image-picker.css', \_\_FILE\_\_),                array (), AD\_INSERTER\_VERSION); |
| [2212](#L2212) | wp\_add\_inline\_style ('ai-image-picker', '.thumbnail {border-radius: 6px;}'); |
| [2213](#L2213) |  |
| [2214](#L2214) | wp\_enqueue\_style  ('ai-combobox-css',    plugins\_url ('css/jquery.scombobox.min.css', \_\_FILE\_\_),        array (), AD\_INSERTER\_VERSION); |
| [2215](#L2215) |  |
| [2216](#L2216) | if (function\_exists ('ai\_admin\_enqueue\_scripts\_2')) ai\_admin\_enqueue\_scripts\_2 (); |
| [2217](#L2217) |  |
| [2218](#L2218) | wp\_enqueue\_script ('ai-colorpicker-js',  plugins\_url ('includes/colorpicker/js/bootstrap-colorpicker.min.js', AD\_INSERTER\_FILE ), array (), AD\_INSERTER\_VERSION, true); |
| [2219](#L2219) |  |
| [2220](#L2220) | wp\_enqueue\_script ('ai-multi-select',    plugins\_url ('includes/js/jquery.multi-select.js', AD\_INSERTER\_FILE ),  array (), AD\_INSERTER\_VERSION, true); |
| [2221](#L2221) | wp\_enqueue\_script ('ai-quicksearch',     plugins\_url ('includes/js/jquery.quicksearch.js', AD\_INSERTER\_FILE ),   array (), AD\_INSERTER\_VERSION, true); |
| [2222](#L2222) |  |
| [2223](#L2223) | // Located in the header to load  datepicker js file to prevent error when async tags used |
| [2224](#L2224) | wp\_enqueue\_script ('ai-image-picker-js', plugins\_url ('includes/js/image-picker.min.js', \_\_FILE\_\_ ),    array ( |
| [2225](#L2225) | 'jquery', |
| [2226](#L2226) | 'jquery-ui-datepicker', |
| [2227](#L2227) | ), AD\_INSERTER\_VERSION, false); |
| [2228](#L2228) |  |
| [2229](#L2229) | if (AI\_SYNTAX\_HIGHLIGHTING && !defined ('AI\_SAFE\_MODE')) { |
| [2230](#L2230) | wp\_enqueue\_script ('ai-ace',           plugins\_url ('includes/ace/ace.js', \_\_FILE\_\_ ),                array (), AD\_INSERTER\_VERSION, true); |
| [2231](#L2231) | //      wp\_enqueue\_script ('ai-ace-ext-modelist', plugins\_url ('includes/ace/ext-modelist.js', \_\_FILE\_\_ ),    array (), AD\_INSERTER\_VERSION, true); |
| [2232](#L2232) | wp\_enqueue\_script ('ai-ace-html',      plugins\_url ('includes/ace/mode-html.js', \_\_FILE\_\_ ),          array (), AD\_INSERTER\_VERSION, true); |
| [2233](#L2233) | wp\_enqueue\_script ('ai-ace-php',       plugins\_url ('includes/ace/mode-php.js',  \_\_FILE\_\_ ), array (), AD\_INSERTER\_VERSION, true); |
| [2234](#L2234) |  |
| [2235](#L2235) | if (get\_syntax\_highlighter\_theme () == AI\_SYNTAX\_HIGHLIGHTER\_THEME || isset ($\_POST ["syntax-highlighter-theme"]) && $\_POST ["syntax-highlighter-theme"] == AI\_SYNTAX\_HIGHLIGHTER\_THEME) |
| [2236](#L2236) | wp\_enqueue\_script ('ai-ace-theme',   plugins\_url ('includes/ace/theme-ad\_inserter.js', \_\_FILE\_\_ ),  array (), AD\_INSERTER\_VERSION, true); |
| [2237](#L2237) | } |
| [2238](#L2238) |  |
| [2239](#L2239) | wp\_enqueue\_script  ('ai-combobox',       plugins\_url ('includes/js/jquery.scombobox.min.js', \_\_FILE\_\_), array ( |
| [2240](#L2240) | 'jquery', |
| [2241](#L2241) | ), AD\_INSERTER\_VERSION , true); |
| [2242](#L2242) |  |
| [2243](#L2243) | $admin\_script = get\_backend\_javascript\_debugging () ? 'js/ad-inserter.js' : 'js/ad-inserter.min.js'; |
| [2244](#L2244) | wp\_enqueue\_script ('ai-admin',        plugins\_url ($admin\_script, \_\_FILE\_\_), array ( |
| [2245](#L2245) | 'jquery', |
| [2246](#L2246) | 'jquery-ui-tabs', |
| [2247](#L2247) | 'jquery-ui-button', |
| [2248](#L2248) | 'jquery-ui-tooltip', |
| [2249](#L2249) | 'jquery-ui-datepicker', |
| [2250](#L2250) | 'jquery-ui-dialog', |
| [2251](#L2251) | ), AD\_INSERTER\_VERSION, true); |
| [2252](#L2252) |  |
| [2253](#L2253) | wp\_localize\_script ('ai-admin', 'ai\_admin', $ai\_admin\_translations); |
| [2254](#L2254) |  |
| [2255](#L2255) | wp\_enqueue\_script  ('ai-missed',         plugins\_url ('includes/js/missed.js', \_\_FILE\_\_), array (), AD\_INSERTER\_VERSION , true); |
| [2256](#L2256) | } |
| [2257](#L2257) |  |
| [2258](#L2258) | wp\_enqueue\_style  ('ai-admin-gen',         plugins\_url ('css/ai-admin.css', \_\_FILE\_\_),                      array (), AD\_INSERTER\_VERSION); |
| [2259](#L2259) | wp\_enqueue\_script ('ai-admin-gen',         plugins\_url ('includes/js/ai-admin.js', \_\_FILE\_\_ ),              array (), AD\_INSERTER\_VERSION, true); |
| [2260](#L2260) | } |
| [2261](#L2261) |  |
| [2262](#L2262) | function ai\_admin\_enqueue\_scripts\_late ($hook\_suffix) { |
| [2263](#L2263) | global $ai\_settings\_page; |
| [2264](#L2264) |  |
| [2265](#L2265) | if ($hook\_suffix == $ai\_settings\_page) { |
| [2266](#L2266) | //    wp\_enqueue\_style  ('ai-admin',       plugins\_url ('css/ad-inserter.css', \_\_FILE\_\_),                 array (), AD\_INSERTER\_VERSION); |
| [2267](#L2267) | wp\_enqueue\_style  ('ai-admin',       plugins\_url ('css/ai-settings.css', \_\_FILE\_\_),                 array (), AD\_INSERTER\_VERSION); |
| [2268](#L2268) | wp\_add\_inline\_style ('ai-admin', '.notice {margin: 5px 15px 15px 0;}'); |
| [2269](#L2269) | } |
| [2270](#L2270) | } |
| [2271](#L2271) |  |
| [2272](#L2272) | function ai\_admin\_remove\_scripts ($hook\_suffix) { |
| [2273](#L2273) | global $ai\_settings\_page; |
| [2274](#L2274) |  |
| [2275](#L2275) | if ($hook\_suffix == $ai\_settings\_page) { |
| [2276](#L2276) |  |
| [2277](#L2277) | // Prevent converting emojis to images |
| [2278](#L2278) | remove\_action ('admin\_print\_scripts', 'print\_emoji\_detection\_script'); |
| [2279](#L2279) |  |
| [2280](#L2280) | // Fix for Publisher theme: remove scripts loaded on Ad Inserter admin page |
| [2281](#L2281) | wp\_deregister\_script ('ace-editor-script'); |
| [2282](#L2282) | wp\_dequeue\_script ('publisher-admin'); |
| [2283](#L2283) |  |
| [2284](#L2284) | // Fix for Shell ClubSmart theme (titan framework) |
| [2285](#L2285) | wp\_dequeue\_script ('tf-ace'); |
| [2286](#L2286) | // Default settings |
| [2287](#L2287) | wp\_dequeue\_script ('tf-ace-theme-chrome'); |
| [2288](#L2288) | wp\_dequeue\_script ('tf-ace-mode-css'); |
| [2289](#L2289) |  |
| [2290](#L2290) | // Fix for JNews theme |
| [2291](#L2291) | wp\_dequeue\_style ('global-admin'); |
| [2292](#L2292) | wp\_dequeue\_style ('selectize'); |
| [2293](#L2293) | wp\_dequeue\_style ('select2'); |
| [2294](#L2294) | wp\_dequeue\_style ('tooltipster'); |
| [2295](#L2295) | wp\_dequeue\_style ('jnews-admin'); |
| [2296](#L2296) | wp\_dequeue\_style ('vex'); |
| [2297](#L2297) |  |
| [2298](#L2298) | // Fix for OptimizePress plugin: remove styles loaded on Ad Inserter admin page |
| [2299](#L2299) | wp\_dequeue\_style ('optimizepress-admin-assets'); |
| [2300](#L2300) | wp\_dequeue\_style ('optimizepress-admin-common'); |
| [2301](#L2301) | wp\_dequeue\_style ('optimizepress-tiny-mce-css'); |
| [2302](#L2302) | wp\_dequeue\_style ('optimizepress-dashicons'); |
| [2303](#L2303) |  |
| [2304](#L2304) | // Fix for WP Nav Manager plugin: remove styles loaded on Ad Inserter admin page |
| [2305](#L2305) | wp\_dequeue\_style ('wp-nav-manager-admin-style'); |
| [2306](#L2306) |  |
| [2307](#L2307) | // Fix for Booking.com Product Helper plugin: remove styles loaded on Ad Inserter admin page |
| [2308](#L2308) | wp\_dequeue\_style ('bookingcom-product-helper-css'); |
| [2309](#L2309) |  |
| [2310](#L2310) | // Fix for WP BotWatch plugin: remove styles loaded on Ad Inserter admin page |
| [2311](#L2311) | wp\_dequeue\_style ('wp-botwatch'); |
| [2312](#L2312) |  |
| [2313](#L2313) | // Fix for All in One Schema.org Rich Snippets plugin: remove styles loaded on Ad Inserter admin page |
| [2314](#L2314) | wp\_dequeue\_style ('admin\_style'); |
| [2315](#L2315) | wp\_deregister\_style ('admin\_style'); |
| [2316](#L2316) |  |
| [2317](#L2317) | // Fix for ACF for AMP plugin: remove styles loaded on Ad Inserter admin page |
| [2318](#L2318) | wp\_dequeue\_style ('amp-acf-admin'); |
| [2319](#L2319) | wp\_deregister\_style ('amp-acf-admin'); |
| [2320](#L2320) | wp\_dequeue\_script ('ace\_code\_highlighter\_js'); |
| [2321](#L2321) | wp\_dequeue\_script ('ace\_mode\_js'); |
| [2322](#L2322) | wp\_dequeue\_script ('custom\_css\_js'); |
| [2323](#L2323) | wp\_dequeue\_script ('field-creator'); |
| [2324](#L2324) | wp\_dequeue\_script ('amp\_acf\_field'); |
| [2325](#L2325) |  |
| [2326](#L2326) | // Fix for WP Lightbox 2 plugin: remove styles loaded on Ad Inserter admin page |
| [2327](#L2327) | wp\_dequeue\_style ('jquery-ui-style'); |
| [2328](#L2328) | wp\_deregister\_style ('jquery-ui-style'); |
| [2329](#L2329) |  |
| [2330](#L2330) | // Fix for Widget Options plugin: remove styles loaded on Ad Inserter admin page |
| [2331](#L2331) | wp\_dequeue\_style ('widgetopts-jquery-ui'); |
| [2332](#L2332) | wp\_deregister\_style ('widgetopts-jquery-ui'); |
| [2333](#L2333) | } |
| [2334](#L2334) | } |
| [2335](#L2335) |  |
| [2336](#L2336) | function ai\_set\_footer\_inline\_scripts () { |
| [2337](#L2337) | global $ai\_wp\_data; |
| [2338](#L2338) |  |
| [2339](#L2339) | $adb\_code = defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION && $ai\_wp\_data [AI\_ADB\_DETECTION] && !isset ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_DISABLED]); |
| [2340](#L2340) |  |
| [2341](#L2341) | // Check again later in the footer |
| [2342](#L2342) | $ai\_wp\_data [AI\_FOOTER\_INLINE\_SCRIPTS] = |
| [2343](#L2343) | get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW || |
| [2344](#L2344) | get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT || //  alerady in $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION] |
| [2345](#L2345) | isset ($ai\_wp\_data [AI\_CLIENT\_SIDE\_ROTATION]) || |
| [2346](#L2346) | ($ai\_wp\_data [AI\_TRACKING] && !isset ($ai\_wp\_data [AI\_TRACKING\_SHORTCODE\_DISABLED])) || |
| [2347](#L2347) | $ai\_wp\_data [AI\_STICKY\_WIDGETS] || |
| [2348](#L2348) | $ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT] || |
| [2349](#L2349) | $ai\_wp\_data [AI\_ANIMATION] || |
| [2350](#L2350) | $ai\_wp\_data [AI\_CLOSE\_BUTTONS] || |
| [2351](#L2351) | $ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] || |
| [2352](#L2352) | $ai\_wp\_data [AI\_LAZY\_LOADING] || |
| [2353](#L2353) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION] || |
| [2354](#L2354) | $adb\_code || |
| [2355](#L2355) | ($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_BLOCKS | AI\_DEBUG\_POSITIONS)) != 0 || |
| [2356](#L2356) | $ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] || |
| [2357](#L2357) | $ai\_wp\_data [AI\_CHECK\_BLOCK] || |
| [2358](#L2358) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_FILTER\_CHECKS] || |
| [2359](#L2359) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] != ''; |
| [2360](#L2360) | } |
| [2361](#L2361) |  |
| [2362](#L2362) | function ai\_wp\_enqueue\_scripts\_hook () { |
| [2363](#L2363) | global $ai\_wp\_data, $wp\_version, $wp\_scripts, $ai\_front\_translations; |
| [2364](#L2364) |  |
| [2365](#L2365) | // TEST |
| [2366](#L2366) | //  wp\_deregister\_script ('jquery'); |
| [2367](#L2367) |  |
| [2368](#L2368) | ai\_set\_footer\_inline\_scripts (); |
| [2369](#L2369) |  |
| [2370](#L2370) | if (!wp\_script\_is ('jquery', 'registered') && !wp\_script\_is ('jquery', 'printed')) { |
| [2371](#L2371) | $ai\_wp\_data [AI\_NO\_JQUERY\_CODE] = true; |
| [2372](#L2372) | } |
| [2373](#L2373) |  |
| [2374](#L2374) | if ($ai\_wp\_data [AI\_FOOTER\_INLINE\_SCRIPTS] || |
| [2375](#L2375) | ($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0 || |
| [2376](#L2376) | !empty ($\_GET) || |
| [2377](#L2377) | get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 || |
| [2378](#L2378) | $ai\_wp\_data [AI\_ANIMATION]) { |
| [2379](#L2379) |  |
| [2380](#L2380) | //    Need jQuery: |
| [2381](#L2381) | //      $ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] |
| [2382](#L2382) |  |
| [2383](#L2383) | if (!$ai\_wp\_data [AI\_NO\_JQUERY\_CODE]) { |
| [2384](#L2384) | // Load jQuery on frontend when needed |
| [2385](#L2385) | if (!get\_wait\_for\_jquery () && isset ($wp\_scripts->registered ['jquery'])) { |
| [2386](#L2386) | wp\_enqueue\_script ('jquery'); |
| [2387](#L2387) | } |
| [2388](#L2388) | } |
| [2389](#L2389) |  |
| [2390](#L2390) | if ($ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] && !$ai\_wp\_data [AI\_NO\_JQUERY\_CODE]) { |
| [2391](#L2391) | wp\_enqueue\_script ('ai-jquery-js', plugins\_url ('includes/js/ai-jquery.js', \_\_FILE\_\_), array ('jquery', 'jquery-ui-button'), $wp\_version . '+' . AD\_INSERTER\_VERSION); |
| [2392](#L2392) | wp\_enqueue\_style  ('ai-html-jquery-ui', plugins\_url ('css/jquery-ui-1.10.3.custom.min.css', \_\_FILE\_\_), array (), null); |
| [2393](#L2393) | } |
| [2394](#L2394) |  |
| [2395](#L2395) | if (!get\_disable\_css\_code () && (get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0)) { |
| [2396](#L2396) | wp\_enqueue\_style ('dashicons'); |
| [2397](#L2397) |  |
| [2398](#L2398) | if (get\_remote\_debugging () && isset ($\_GET [AI\_URL\_DEBUG]) && $\_GET [AI\_URL\_DEBUG]) { |
| [2399](#L2399) | wp\_enqueue\_style ('ai-dashicons',         includes\_url ('css/dashicons.min.css'), array (), $wp\_version); |
| [2400](#L2400) | wp\_enqueue\_style ('ai-admin-bar',         includes\_url ('css/admin-bar.min.css'), array (), $wp\_version); |
| [2401](#L2401) | } |
| [2402](#L2402) | } |
| [2403](#L2403) |  |
| [2404](#L2404) | if (!get\_disable\_js\_code () && $ai\_wp\_data [AI\_ANIMATION]) { |
| [2405](#L2405) | if (defined ('AI\_STICKY\_SETTINGS') && AI\_STICKY\_SETTINGS) { |
| [2406](#L2406) | wp\_enqueue\_style  ('ai-aos',    plugins\_url ('includes/aos/ai-aos.css', \_\_FILE\_\_), array (), AD\_INSERTER\_VERSION); |
| [2407](#L2407) | wp\_enqueue\_script ('ai-aos-js', plugins\_url ('includes/aos/aos.js', AD\_INSERTER\_FILE ),  array (), AD\_INSERTER\_VERSION, true); |
| [2408](#L2408) | } |
| [2409](#L2409) | } |
| [2410](#L2410) | } |
| [2411](#L2411) | } |
| [2412](#L2412) |  |
| [2413](#L2413) | function ai\_clean\_url ( $url, $original\_url){ |
| [2414](#L2414) | if (strpos ($url, 'async=') !== false && strpos ($url, '/plugins/ad-inserter') !== false) { |
| [2415](#L2415) | //    $url = $original\_url; |
| [2416](#L2416) | $url = str\_replace ("' async='async", '', $url); |
| [2417](#L2417) | } |
| [2418](#L2418) | return $url; |
| [2419](#L2419) | } |
| [2420](#L2420) |  |
| [2421](#L2421) | function ai\_get\_client\_side\_styles () { |
| [2422](#L2422) | return |
| [2423](#L2423) | ".ai-rotate {position: relative;}\n" . |
| [2424](#L2424) | ".ai-rotate-hidden {visibility: hidden;}\n" . |
| [2425](#L2425) | ".ai-rotate-hidden-2 {position: absolute; top: 0; left: 0; width: 100%; height: 100%;}\n" . |
| [2426](#L2426) | ".ai-list-data, .ai-ip-data, .ai-filter-check, .ai-fallback, .ai-list-block, .ai-list-block-ip, .ai-list-block-filter {".AI\_ALIGNMENT\_CSS\_HIDDEN\_LIST."}\n" . |
| [2427](#L2427) | ".ai-list-data, .ai-ip-data, .ai-filter-check, .ai-fallback {min-width: 1px;}\n" . |
| [2428](#L2428) | ""; |
| [2429](#L2429) | } |
| [2430](#L2430) |  |
| [2431](#L2431) | function ai\_get\_admin\_toolbar\_debugging\_styles () { |
| [2432](#L2432) | global $ai\_wp\_data; |
| [2433](#L2433) |  |
| [2434](#L2434) | $css = ''; |
| [2435](#L2435) |  |
| [2436](#L2436) | if (((get\_admin\_toolbar\_debugging () && ((get\_remote\_debugging () && $ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0)) || defined ('AI\_DEBUGGING\_DEMO')) && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2437](#L2437) | $css .= "#wp-admin-bar-ai-toolbar-settings .ab-icon:before { |
| [2438](#L2438) | content: '\\f538'; |
| [2439](#L2439) | top: 2px; |
| [2440](#L2440) | color: rgba(240,245,250,.6)!important; |
| [2441](#L2441) | } |
| [2442](#L2442) | #wp-admin-bar-ai-toolbar-settings-default .ab-icon:before { |
| [2443](#L2443) | top: 0px; |
| [2444](#L2444) | } |
| [2445](#L2445) | #wp-admin-bar-ai-toolbar-settings .ab-icon.on:before { |
| [2446](#L2446) | color: #00f200!important; |
| [2447](#L2447) | } |
| [2448](#L2448) | #wp-admin-bar-ai-toolbar-settings .ab-icon.red:before { |
| [2449](#L2449) | color: #f22!important; |
| [2450](#L2450) | } |
| [2451](#L2451) | #wp-admin-bar-ai-toolbar-settings-default li, #wp-admin-bar-ai-toolbar-settings-default a, |
| [2452](#L2452) | #wp-admin-bar-ai-toolbar-settings-default li:hover, #wp-admin-bar-ai-toolbar-settings-default a:hover { |
| [2453](#L2453) | border: 1px solid transparent; |
| [2454](#L2454) | } |
| [2455](#L2455) | ul li#wp-admin-bar-ai-toolbar-status { |
| [2456](#L2456) | margin: 0 0 5px 0; |
| [2457](#L2457) | } |
| [2458](#L2458) | #wp-admin-bar-ai-toolbar-off .ab-icon:before { |
| [2459](#L2459) | content: '\\f153'; |
| [2460](#L2460) | } |
| [2461](#L2461) | #wp-admin-bar-ai-toolbar-blocks .ab-icon:before { |
| [2462](#L2462) | content: '\\f135'; |
| [2463](#L2463) | } |
| [2464](#L2464) | #wp-admin-bar-ai-toolbar-positions .ab-icon:before { |
| [2465](#L2465) | content: '\\f207'; |
| [2466](#L2466) | } |
| [2467](#L2467) | #wp-admin-bar-ai-toolbar-positions-default .ab-icon:before { |
| [2468](#L2468) | content: '\\f522'; |
| [2469](#L2469) | } |
| [2470](#L2470) | #wp-admin-bar-ai-toolbar-tags .ab-icon:before { |
| [2471](#L2471) | content: '\\f475'; |
| [2472](#L2472) | } |
| [2473](#L2473) | #wp-admin-bar-ai-toolbar-no-insertion .ab-icon:before { |
| [2474](#L2474) | content: '\\f214'; |
| [2475](#L2475) | } |
| [2476](#L2476) | #wp-admin-bar-ai-toolbar-adb-status .ab-icon:before { |
| [2477](#L2477) | content: '\\f223'; |
| [2478](#L2478) | } |
| [2479](#L2479) | #wp-admin-bar-ai-toolbar-adb .ab-icon:before { |
| [2480](#L2480) | content: '\\f160'; |
| [2481](#L2481) | } |
| [2482](#L2482) | #wp-admin-bar-ai-toolbar-processing .ab-icon:before { |
| [2483](#L2483) | content: '\\f464'; |
| [2484](#L2484) | } |
| [2485](#L2485) | #wp-admin-bar-ai-toolbar-processing-fe .ab-icon:before { |
| [2486](#L2486) | content: '\\f464'; |
| [2487](#L2487) | } |
| [2488](#L2488) | #wp-admin-bar-ai-toolbar-positions span.up-icon { |
| [2489](#L2489) | padding-top: 2px; |
| [2490](#L2490) | } |
| [2491](#L2491) | #wp-admin-bar-ai-toolbar-positions .up-icon:before { |
| [2492](#L2492) | font: 400 20px/1 dashicons; |
| [2493](#L2493) | } |
| [2494](#L2494) | .ai-insertion-status { |
| [2495](#L2495) | line-height: 26px!important; |
| [2496](#L2496) | height: 26px!important; |
| [2497](#L2497) | white-space: nowrap; |
| [2498](#L2498) | min-width: 140px; |
| [2499](#L2499) | } |
| [2500](#L2500) | #wp-admin-bar-ai-toolbar-settings .ab-sub-wrapper { |
| [2501](#L2501) | width: max-content; |
| [2502](#L2502) | width: -moz-max-content; |
| [2503](#L2503) | } |
| [2504](#L2504) | "; |
| [2505](#L2505) | } |
| [2506](#L2506) |  |
| [2507](#L2507) | if (get\_admin\_toolbar\_mobile () && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2508](#L2508) | $css .= "@media screen and (max-width: 782px) { |
| [2509](#L2509) | #wpadminbar #wp-admin-bar-ai-toolbar-settings { |
| [2510](#L2510) | display: block; |
| [2511](#L2511) | position: static; |
| [2512](#L2512) | } |
| [2513](#L2513) |  |
| [2514](#L2514) | #wpadminbar #wp-admin-bar-ai-toolbar-settings > .ab-item { |
| [2515](#L2515) | white-space: nowrap; |
| [2516](#L2516) | overflow: hidden; |
| [2517](#L2517) | width: 52px; |
| [2518](#L2518) | padding: 0; |
| [2519](#L2519) | color: #a0a5aa; |
| [2520](#L2520) | position: relative; |
| [2521](#L2521) | } |
| [2522](#L2522) |  |
| [2523](#L2523) | #wpadminbar .quicklinks .menupop ul li .ab-item, #wpadminbar .quicklinks .menupop.hover ul li .ab-item { |
| [2524](#L2524) | min-height: 28px; |
| [2525](#L2525) | } |
| [2526](#L2526) | } |
| [2527](#L2527) | "; |
| [2528](#L2528) | } |
| [2529](#L2529) |  |
| [2530](#L2530) | return $css; |
| [2531](#L2531) | } |
| [2532](#L2532) |  |
| [2533](#L2533) |  |
| [2534](#L2534) | function add\_head\_inline\_styles () { |
| [2535](#L2535) | global $ai\_wp\_data; |
| [2536](#L2536) |  |
| [2537](#L2537) | if (get\_disable\_css\_code ()) return; // Needed for iframes? $ai\_wp\_data [AI\_CODE\_FOR\_IFRAME] |
| [2538](#L2538) |  |
| [2539](#L2539) | $debugging = |
| [2540](#L2540) | $ai\_wp\_data [AI\_WP\_DEBUGGING] != 0 || |
| [2541](#L2541) | (get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) && |
| [2542](#L2542) | (isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0 || |
| [2543](#L2543) | isset ($\_GET [AI\_URL\_DEBUG\_CODE])); |
| [2544](#L2544) |  |
| [2545](#L2545) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || |
| [2546](#L2546) | get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW || |
| [2547](#L2547) | isset ($ai\_wp\_data [AI\_CLIENT\_SIDE\_ROTATION]) || |
| [2548](#L2548) | $ai\_wp\_data [AI\_CLOSE\_BUTTONS] || |
| [2549](#L2549) | $ai\_wp\_data [AI\_PARALLAX] || |
| [2550](#L2550) | $ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] || |
| [2551](#L2551) | !get\_inline\_styles () || |
| [2552](#L2552) | get\_admin\_toolbar\_debugging () && (get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) || |
| [2553](#L2553) | $debugging) { |
| [2554](#L2554) |  |
| [2555](#L2555) | echo "<style>\n"; |
| [2556](#L2556) |  |
| [2557](#L2557) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) echo get\_viewport\_css (); |
| [2558](#L2558) |  |
| [2559](#L2559) | if (get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW || get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT || isset ($ai\_wp\_data [AI\_CLIENT\_SIDE\_ROTATION])) { |
| [2560](#L2560) | echo ai\_get\_client\_side\_styles (); |
| [2561](#L2561) |  |
| [2562](#L2562) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_CSS] = true; |
| [2563](#L2563) | } |
| [2564](#L2564) |  |
| [2565](#L2565) | if ($ai\_wp\_data [AI\_CLOSE\_BUTTONS] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2566](#L2566) | echo ".ai-close {position: relative;}\n"; // Needed for close button bottom positions |
| [2567](#L2567) | echo ".ai-close-button {position: absolute; top: -11px; right: -11px; width: 24px; height: 24px; background: url(".plugins\_url ('css/images/close-button.png', AD\_INSERTER\_FILE).") no-repeat center center; cursor: pointer; z-index: 9; display: none;}\n"; |
| [2568](#L2568) | echo ".ai-close-show {display: block;}\n"; |
| [2569](#L2569) | echo ".ai-close-left {right: unset; left: -11px;}\n"; |
| [2570](#L2570) | echo ".ai-close-bottom {top: unset; bottom: -10px;}\n"; |
| [2571](#L2571) | echo ".ai-close-none {visibility: hidden;}\n"; |
| [2572](#L2572) | } |
| [2573](#L2573) |  |
| [2574](#L2574) | if ($ai\_wp\_data [AI\_PARALLAX] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2575](#L2575) | echo ".ai-parallax {position: relative;}\n"; |
| [2576](#L2576) | echo ".ai-parallax-background {position: absolute; width: 100%; height: 100%; background-attachment: fixed; background-position: center; background-repeat: no-repeat;}\n"; |
| [2577](#L2577) | // CSS specific to iOS devices |
| [2578](#L2578) | echo "@supports (-webkit-touch-callout: none) {.ai-parallax-background {background-attachment: scroll; }}\n"; |
| [2579](#L2579) | //      echo "@media (max-width: 768px) {.ai-parallax-background {background-attachment: scroll; }}"; |
| [2580](#L2580) | //      echo "@supports (-webkit-overflow-scrolling: touch) {.ai-parallax-background {background-attachment: scroll; }}"; |
| [2581](#L2581) | } |
| [2582](#L2582) |  |
| [2583](#L2583) | // Before alignment CSS to not override alignment margin |
| [2584](#L2584) | if ($debugging) generate\_debug\_css\_base (); |
| [2585](#L2585) |  |
| [2586](#L2586) | if (!get\_inline\_styles () && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2587](#L2587) | echo get\_alignment\_css (); |
| [2588](#L2588) | } |
| [2589](#L2589) |  |
| [2590](#L2590) | // After alignment CSS to override width |
| [2591](#L2591) | if ($ai\_wp\_data [AI\_CLOSE\_BUTTONS] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [2592](#L2592) | echo ".ai-close-fit {width: fit-content; width: -moz-fit-content;}\n"; |
| [2593](#L2593) | } |
| [2594](#L2594) |  |
| [2595](#L2595) | if ($debugging) generate\_debug\_css (); |
| [2596](#L2596) |  |
| [2597](#L2597) | if ($ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION]) generate\_selection\_css (); |
| [2598](#L2598) |  |
| [2599](#L2599) | echo ai\_get\_admin\_toolbar\_debugging\_styles (); |
| [2600](#L2600) |  |
| [2601](#L2601) | echo "</style>\n"; |
| [2602](#L2602) | } |
| [2603](#L2603) | } |
| [2604](#L2604) |  |
| [2605](#L2605) | function ai\_get\_js ($js\_name, $replace\_js\_data = true) { |
| [2606](#L2606) | global $ai\_wp\_data; |
| [2607](#L2607) |  |
| [2608](#L2608) | $jq\_js\_name = $js\_name . '.q'; |
| [2609](#L2609) | if (!$ai\_wp\_data [AI\_NO\_JQUERY\_CODE] && file\_exists (AD\_INSERTER\_PLUGIN\_DIR."includes/js/{$jq\_js\_name}.js")) { |
| [2610](#L2610) | $js\_name = $jq\_js\_name; |
| [2611](#L2611) | } |
| [2612](#L2612) |  |
| [2613](#L2613) | if ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] || !file\_exists (AD\_INSERTER\_PLUGIN\_DIR."includes/js/$js\_name.min.js")) { |
| [2614](#L2614) | $script = @file\_get\_contents (AD\_INSERTER\_PLUGIN\_DIR."includes/js/$js\_name.js"); |
| [2615](#L2615) | } else $script = @file\_get\_contents (AD\_INSERTER\_PLUGIN\_DIR."includes/js/$js\_name.min.js"); |
| [2616](#L2616) |  |
| [2617](#L2617) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [2618](#L2618) | if ($debug\_processing) ai\_log ('LOADING JS CODE: '. $js\_name); |
| [2619](#L2619) |  |
| [2620](#L2620) | if (!$replace\_js\_data) return $script; |
| [2621](#L2621) | return ai\_replace\_js\_data ($script); |
| [2622](#L2622) | } |
| [2623](#L2623) |  |
| [2624](#L2624) | function ai\_randomize\_properties ($style, $z\_index\_min = null, $z\_index\_max = null) { |
| [2625](#L2625) | $style = str\_replace ('&#039;', '\'', $style); |
| [2626](#L2626) |  |
| [2627](#L2627) | $style\_array = explode (';', trim ($style, ';')); |
| [2628](#L2628) | foreach ($style\_array as $index => $property) { |
| [2629](#L2629) | $property = trim ($property); |
| [2630](#L2630) | if ($z\_index\_min != null && $z\_index\_max != null && strpos ($property, 'z-index') === 0) { |
| [2631](#L2631) | $style\_array [$index] = 'z-index: ' . rand ($z\_index\_min, $z\_index\_max); |
| [2632](#L2632) | } |
| [2633](#L2633) | if (strpos ($property, 'opacity') === 0) { |
| [2634](#L2634) | $value = str\_replace (array ('opacity', ':', ' ', ';'), '', $property); |
| [2635](#L2635) | if (is\_numeric ($value)) { |
| [2636](#L2636) | $value = 100 \* $value - 5 + rand (0, 10); |
| [2637](#L2637) | if ($value > 100) $value = 100; |
| [2638](#L2638) | $style\_array [$index] = 'opacity: ' . ($value / 100); |
| [2639](#L2639) | } |
| [2640](#L2640) | } |
| [2641](#L2641) | elseif (strpos ($property, '50%') !== false) { |
| [2642](#L2642) | $style\_array [$index] = str\_replace ('50%', (47 + rand (0, 6)) . '.' . rand (1, 99) . '%', $style\_array [$index]); |
| [2643](#L2643) | } |
| [2644](#L2644) | elseif (strpos ($property, '100%') !== false) { |
| [2645](#L2645) | $style\_array [$index] = str\_replace ('100%', '100.' . rand (1, 99) . '%', $style\_array [$index]); |
| [2646](#L2646) | } |
| [2647](#L2647) | elseif (strpos ($property, '#000') !== false) { |
| [2648](#L2648) | $color = rand (0, 2) . rand (0, 9); |
| [2649](#L2649) | $style\_array [$index] = str\_replace ('#000', '#' . $color . $color . $color, $style\_array [$index]); |
| [2650](#L2650) | } |
| [2651](#L2651) | } |
| [2652](#L2652) | shuffle ($style\_array); |
| [2653](#L2653) | return trim (implode ('; ', $style\_array)) . ';'; |
| [2654](#L2654) | } |
| [2655](#L2655) |  |
| [2656](#L2656) | function ai\_replace\_js\_data ($js) { |
| [2657](#L2657) | global $block\_object, $ai\_wp\_data; |
| [2658](#L2658) |  |
| [2659](#L2659) | if (preg\_match\_all ('/AI\_CONST\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2660](#L2660) | foreach ($match [1] as $index => $constant) { |
| [2661](#L2661) | if (defined ($constant)) |
| [2662](#L2662) | $js = str\_replace ($match [0][$index], constant ($constant), $js); |
| [2663](#L2663) | } |
| [2664](#L2664) | } |
| [2665](#L2665) |  |
| [2666](#L2666) | if (preg\_match\_all ('/AI\_DATA\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2667](#L2667) | foreach ($match [1] as $index => $constant) { |
| [2668](#L2668) | if (defined ($constant) && isset ($ai\_wp\_data [constant ($constant)])) |
| [2669](#L2669) | $js = str\_replace ($match [0][$index], $ai\_wp\_data [constant ($constant)], $js); |
| [2670](#L2670) | } |
| [2671](#L2671) | } |
| [2672](#L2672) |  |
| [2673](#L2673) | if (preg\_match\_all ('/AI\_DATAB\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2674](#L2674) | foreach ($match [1] as $index => $constant) { |
| [2675](#L2675) | if (defined ($constant) && isset ($ai\_wp\_data [constant ($constant)])) |
| [2676](#L2676) | $js = str\_replace ($match [0][$index], $ai\_wp\_data [constant ($constant)] ? 1 : 0, $js); |
| [2677](#L2677) | } |
| [2678](#L2678) | } |
| [2679](#L2679) |  |
| [2680](#L2680) | if (preg\_match\_all ('/AI\_DBG\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2681](#L2681) | foreach ($match [1] as $index => $constant) { |
| [2682](#L2682) | if (defined ($constant)) |
| [2683](#L2683) | $js = str\_replace ($match [0][$index], ($ai\_wp\_data [AI\_WP\_DEBUGGING] & constant ($constant)) != 0 ? 1 : 0, $js); |
| [2684](#L2684) | } |
| [2685](#L2685) | } |
| [2686](#L2686) |  |
| [2687](#L2687) | if (preg\_match\_all ('/AI\_FUNC\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2688](#L2688) | foreach ($match [1] as $index => $function) { |
| [2689](#L2689) | $function = strtolower ($function); |
| [2690](#L2690) | if (function\_exists ($function)) |
| [2691](#L2691) | $js = str\_replace ($match [0][$index], call\_user\_func ($function), $js); |
| [2692](#L2692) | } |
| [2693](#L2693) | } |
| [2694](#L2694) |  |
| [2695](#L2695) | if (preg\_match\_all ('/AI\_FUNCH\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2696](#L2696) | foreach ($match [1] as $index => $function) { |
| [2697](#L2697) | $function = strtolower ($function); |
| [2698](#L2698) | if (function\_exists ($function)) |
| [2699](#L2699) | $js = str\_replace ($match [0][$index], html\_entity\_decode (call\_user\_func ($function)), $js); |
| [2700](#L2700) | } |
| [2701](#L2701) | } |
| [2702](#L2702) |  |
| [2703](#L2703) | if (preg\_match\_all ('/AI\_FUNCB\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2704](#L2704) | foreach ($match [1] as $index => $function) { |
| [2705](#L2705) | $function = strtolower ($function); |
| [2706](#L2706) | if (function\_exists ($function)) |
| [2707](#L2707) | $js = str\_replace ($match [0][$index], call\_user\_func ($function) ? 1 : 0, $js); |
| [2708](#L2708) | } |
| [2709](#L2709) | } |
| [2710](#L2710) |  |
| [2711](#L2711) | if (preg\_match\_all ('/AI\_FUNCT\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2712](#L2712) | foreach ($match [1] as $index => $function) { |
| [2713](#L2713) | $function = strtolower ($function); |
| [2714](#L2714) | if (function\_exists ($function)) |
| [2715](#L2715) | $js = str\_replace ($match [0][$index], call\_user\_func ($function, true), $js); |
| [2716](#L2716) | } |
| [2717](#L2717) | } |
| [2718](#L2718) |  |
| [2719](#L2719) | if (preg\_match\_all ('/AI\_POST\_([\_A-Z0-9]+)/', $js, $match)) { |
| [2720](#L2720) | foreach ($match [1] as $index => $post) { |
| [2721](#L2721) | $post\_name = strtolower ($post); |
| [2722](#L2722) | $js = str\_replace ($match [0][$index], isset ($\_POST [$post\_name]) ? esc\_js (sanitize\_text\_field (urldecode ($\_POST [$post\_name]))) : '', $js); |
| [2723](#L2723) | } |
| [2724](#L2724) | } |
| [2725](#L2725) |  |
| [2726](#L2726) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [2727](#L2727) | if (strpos ($js, 'AI\_ADB\_OVERLAY\_WINDOW') !== false || strpos ($js, 'AI\_ADB\_MSG\_HTML') !== false) { |
| [2728](#L2728) | $adb = $block\_object [AI\_ADB\_MESSAGE\_OPTION\_NAME]; |
| [2729](#L2729) | $tags = array ('div', 'span', 'ins', 'section', 'kbd'); |
| [2730](#L2730) | $message\_tag = $tags [rand (0, count ($tags) - 1)]; |
| [2731](#L2731) | $overlay\_tag = $tags [rand (0, count ($tags) - 1)]; |
| [2732](#L2732) |  |
| [2733](#L2733) | $basic\_adb\_overlay\_css = AI\_BASIC\_ADB\_OVERLAY\_CSS; |
| [2734](#L2734) | $basic\_adb\_message\_css = AI\_BASIC\_ADB\_MESSAGE\_CSS; |
| [2735](#L2735) |  |
| [2736](#L2736) | if (strpos ($js, 'AI\_ADB\_STATUS\_MESSAGE') === false) { |
| [2737](#L2737) | $basic\_adb\_overlay\_css = str\_replace ('pointer', 'no-drop', $basic\_adb\_overlay\_css); |
| [2738](#L2738) | $basic\_adb\_message\_css = str\_replace ('pointer', 'no-drop', $basic\_adb\_message\_css); |
| [2739](#L2739) | } |
| [2740](#L2740) |  |
| [2741](#L2741) | //      $overlay\_code = "jQuery ('<".$overlay\_tag.">', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 1110002, 9914998)) . ai\_randomize\_properties (get\_overlay\_css ())) . "')}})"; |
| [2742](#L2742) | $overlay\_code = "var e = document.createElement ('".$overlay\_tag."'); e.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 1110002, 9914998)) . ai\_randomize\_properties (get\_overlay\_css ())) . "');"; |
| [2743](#L2743) |  |
| [2744](#L2744) | for ($level = 1; $level <= 5; $level ++) { |
| [2745](#L2745) | switch (rand (1, 10)) { |
| [2746](#L2746) | case 1: |
| [2747](#L2747) | case 2: |
| [2748](#L2748) | case 3: |
| [2749](#L2749) | case 4: |
| [2750](#L2750) | $tag = 'div'; |
| [2751](#L2751) | break; |
| [2752](#L2752) | case 5: |
| [2753](#L2753) | case 6: |
| [2754](#L2754) | case 7: |
| [2755](#L2755) | $tag = $tags [rand (0, count ($tags) - 1)]; |
| [2756](#L2756) | break; |
| [2757](#L2757) | default: |
| [2758](#L2758) | continue 2; |
| [2759](#L2759) | } |
| [2760](#L2760) |  |
| [2761](#L2761) | //        $overlay\_code .= ".append (jQuery ('<div>')).append (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "')}}))"; |
| [2762](#L2762) | $overlay\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "');"; |
| [2763](#L2763) | $overlay\_code .= "e.append (f); e.append (document.createElement ('div'));"; |
| [2764](#L2764) |  |
| [2765](#L2765) | //        $overlay\_code = "jQuery ('<".$tag.">').append (" . $overlay\_code . ')'; |
| [2766](#L2766) | $overlay\_code .= "f = document.createElement ('".$tag."'); f.append (e); e = f;"; |
| [2767](#L2767) |  |
| [2768](#L2768) | //        if (rand (1, 10) > 5) $overlay\_code .= ".append (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "')}}))"; |
| [2769](#L2769) | if (rand (1, 10) > 5) $overlay\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "'); e.append (f);"; |
| [2770](#L2770) |  |
| [2771](#L2771) | //        if (rand (1, 10) > 5) $overlay\_code .= ".append (jQuery ('<div>'))"; |
| [2772](#L2772) | if (rand (1, 10) > 5) $overlay\_code .= "e.append (document.createElement ('div'));"; |
| [2773](#L2773) |  |
| [2774](#L2774) | //        if (rand (1, 10) > 5) $overlay\_code .= ".prepend (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "')}}))"; |
| [2775](#L2775) | if (rand (1, 10) > 5) $overlay\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_overlay\_css, 100, 99999))) . "'); e.prepend (f);"; |
| [2776](#L2776) |  |
| [2777](#L2777) | //        if (rand (1, 10) > 5) $overlay\_code .= ".prepend (jQuery ('<div>'))"; |
| [2778](#L2778) | if (rand (1, 10) > 5) $overlay\_code .= "e.prepend (document.createElement ('div'));"; |
| [2779](#L2779) | } |
| [2780](#L2780) |  |
| [2781](#L2781) | $overlay\_code = '(function () {' . $overlay\_code . ' return e;})()'; |
| [2782](#L2782) |  |
| [2783](#L2783) | $js = str\_replace ('AI\_ADB\_OVERLAY\_WINDOW', $overlay\_code, $js); |
| [2784](#L2784) |  |
| [2785](#L2785) | $message\_code = "jQuery ('<".$message\_tag.">', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 96610999, 99919998)) . ai\_randomize\_properties (get\_message\_css ())) . "')}, 'html': b64d ('" . |
| [2786](#L2786) | base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), do\_shortcode ($adb->ai\_getCode ()))) . "')})"; |
| [2787](#L2787) |  |
| [2788](#L2788) | $message\_code = "var e = document.createElement ('".$message\_tag."'); e.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 96610999, 99919998)) . ai\_randomize\_properties (get\_message\_css ())) . "');"; |
| [2789](#L2789) | $message\_code .= "e.innerHTML = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), do\_shortcode ($adb->ai\_getCode ()))) . "');"; |
| [2790](#L2790) |  |
| [2791](#L2791) | for ($level = 1; $level <= 5; $level ++) { |
| [2792](#L2792) | switch (rand (1, 10)) { |
| [2793](#L2793) | case 1: |
| [2794](#L2794) | case 2: |
| [2795](#L2795) | case 3: |
| [2796](#L2796) | $tag = 'div'; |
| [2797](#L2797) | break; |
| [2798](#L2798) | case 4: |
| [2799](#L2799) | case 5: |
| [2800](#L2800) | $tag = 'p'; |
| [2801](#L2801) | break; |
| [2802](#L2802) | case 6: |
| [2803](#L2803) | case 7: |
| [2804](#L2804) | $tag = $tags [rand (0, count ($tags) - 1)]; |
| [2805](#L2805) | break; |
| [2806](#L2806) | default: |
| [2807](#L2807) | continue 2; |
| [2808](#L2808) | } |
| [2809](#L2809) |  |
| [2810](#L2810) | //        $message\_code .= ".append (jQuery ('<p>')).append (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "')}}))"; |
| [2811](#L2811) | $message\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "');"; |
| [2812](#L2812) | $message\_code .= "e.append (document.createElement ('p')); e.append (f);"; |
| [2813](#L2813) |  |
| [2814](#L2814) | //        $message\_code = "jQuery ('<".$tag.">').append (" . $message\_code . ')'; |
| [2815](#L2815) | $message\_code .= "f = document.createElement ('".$tag."'); f.append (e); e = f;"; |
| [2816](#L2816) |  |
| [2817](#L2817) | //        if (rand (1, 10) > 7) $message\_code .= ".append (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "')}}))"; |
| [2818](#L2818) | if (rand (1, 10) > 7) $message\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "'); e.append (f);"; |
| [2819](#L2819) |  |
| [2820](#L2820) | //        if (rand (1, 10) > 7) $message\_code .= ".append (jQuery ('<p>'))"; |
| [2821](#L2821) | if (rand (1, 10) > 7) $message\_code .= "e.append (document.createElement ('p'));"; |
| [2822](#L2822) |  |
| [2823](#L2823) | //        if (rand (1, 10) > 7) $message\_code .= ".prepend (jQuery ('<div>', {attr: {'style': b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "')}}))"; |
| [2824](#L2824) | if (rand (1, 10) > 7) $message\_code .= "var f = document.createElement ('div'); f.style = b64d ('" . base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 10000, 999999))) . "'); e.prepend (f);"; |
| [2825](#L2825) |  |
| [2826](#L2826) | //        if (rand (1, 10) > 7) $message\_code .= ".prepend (jQuery ('<p>'))"; |
| [2827](#L2827) | if (rand (1, 10) > 7) $message\_code .= "e.prepend (document.createElement ('p'));"; |
| [2828](#L2828) |  |
| [2829](#L2829) | //        if (rand (1, 10) > 3) $message\_code .= ".prepend (jQuery ('<p>'))"; |
| [2830](#L2830) | if (rand (1, 10) > 3) $message\_code .= "e.prepend (document.createElement ('p'));"; |
| [2831](#L2831) | } |
| [2832](#L2832) |  |
| [2833](#L2833) | $message\_code = '(function () {' . $message\_code . ' return e;})()'; |
| [2834](#L2834) |  |
| [2835](#L2835) | $js = str\_replace ('AI\_ADB\_MESSAGE\_WINDOW', $message\_code, $js); |
| [2836](#L2836) |  |
| [2837](#L2837) | //      $js = str\_replace ('AI\_ADB\_MSG\_HTML',  base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), do\_shortcode ($adb->ai\_getCode ()))), $js); |
| [2838](#L2838) | $js = str\_replace ('AI\_ADB\_MSG\_HTML',  str\_replace (array ("\r", "\n", '"'), array ('', '', '&quot;'), preg\_replace ( '@<(script|style)[^>]\*?'.'>.\*?</\\1>@si', '', do\_shortcode ($adb->ai\_getCode ()))), $js); |
| [2839](#L2839) | //      $js = str\_replace ('AI\_ADB\_MSG\_STYLE', base64\_encode (str\_replace (array ("\r", "\n"), array ('', ''), ai\_randomize\_properties ($basic\_adb\_message\_css, 100000, 9999999) . ai\_randomize\_properties (get\_message\_css ()))), $js); |
| [2840](#L2840) | $js = str\_replace ('AI\_ADB\_MSG\_STYLE', str\_replace (array ("\r", "\n", '"'), array ('', '', '&quot;'), ai\_randomize\_properties ($basic\_adb\_message\_css, 100000, 9999999) . ai\_randomize\_properties (get\_message\_css ())), $js); |
| [2841](#L2841) |  |
| [2842](#L2842) |  |
| [2843](#L2843) | switch (rand (1, 20)) { |
| [2844](#L2844) | case 1: |
| [2845](#L2845) | $message\_tag = 'section'; |
| [2846](#L2846) | break; |
| [2847](#L2847) | case 2: |
| [2848](#L2848) | $message\_tag = 'article'; |
| [2849](#L2849) | break; |
| [2850](#L2850) | case 3: |
| [2851](#L2851) | $message\_tag = 'span'; |
| [2852](#L2852) | break; |
| [2853](#L2853) | case 4: |
| [2854](#L2854) | $message\_tag = 'header'; |
| [2855](#L2855) | break; |
| [2856](#L2856) | case 5: |
| [2857](#L2857) | $message\_tag = 'footer'; |
| [2858](#L2858) | break; |
| [2859](#L2859) | case 6: |
| [2860](#L2860) | $message\_tag = 'nav'; |
| [2861](#L2861) | break; |
| [2862](#L2862) | case 7: |
| [2863](#L2863) | $message\_tag = 'aside'; |
| [2864](#L2864) | break; |
| [2865](#L2865) | case 8: |
| [2866](#L2866) | $message\_tag = 'h5'; |
| [2867](#L2867) | break; |
| [2868](#L2868) | case 9: |
| [2869](#L2869) | $message\_tag = 'h6'; |
| [2870](#L2870) | break; |
| [2871](#L2871) | default: |
| [2872](#L2872) | $message\_tag = 'div'; |
| [2873](#L2873) | break; |
| [2874](#L2874) | } |
| [2875](#L2875) |  |
| [2876](#L2876) | $js = str\_replace ('AI\_ADB\_MSG\_TAG', $message\_tag, $js); |
| [2877](#L2877) |  |
| [2878](#L2878) |  |
| [2879](#L2879) | $js\_name\_node  = 'n'.rand (10000, 10000000); |
| [2880](#L2880) | $js\_name\_index = 'i'.rand (10000, 10000000); |
| [2881](#L2881) |  |
| [2882](#L2882) | $html\_tags = array (); |
| [2883](#L2883) | if (rand (1, 10) > 3) $html\_tags []= 'DIV'; |
| [2884](#L2884) | if (rand (1, 10) > 4) $html\_tags []= 'P'; |
| [2885](#L2885) | if (rand (1, 10) > 5) $html\_tags []= 'SPAN'; |
| [2886](#L2886) | if (rand (1, 10) > 5) $html\_tags []= 'A'; |
| [2887](#L2887) | if (rand (1, 10) > 5) $html\_tags []= 'ARTICLE'; |
| [2888](#L2888) | if (rand (1, 10) > 5) $html\_tags []= 'H1'; |
| [2889](#L2889) | if (rand (1, 10) > 5) $html\_tags []= 'H2'; |
| [2890](#L2890) | if (rand (1, 10) > 5) $html\_tags []= 'H3'; |
| [2891](#L2891) | if (rand (1, 10) > 5) $html\_tags []= 'H4'; |
| [2892](#L2892) | if (rand (1, 10) > 5) $html\_tags []= 'H5'; |
| [2893](#L2893) | if (rand (1, 10) > 5) $html\_tags []= 'H6'; |
| [2894](#L2894) | if (rand (1, 10) > 5) $html\_tags []= 'BUTTON'; |
| [2895](#L2895) | if (rand (1, 10) > 6) $html\_tags []= 'IFRAME'; |
| [2896](#L2896) | if (rand (1, 10) > 6) $html\_tags []= 'HEADER'; |
| [2897](#L2897) | if (rand (1, 10) > 5) $html\_tags []= 'FOOTER'; |
| [2898](#L2898) | if (rand (1, 10) > 7) $html\_tags []= 'UL'; |
| [2899](#L2899) | if (rand (1, 10) > 7) $html\_tags []= 'OL'; |
| [2900](#L2900) | if (rand (1, 10) > 5) $html\_tags []= 'LI'; |
| [2901](#L2901) | if (rand (1, 10) > 5) $html\_tags []= 'NAV'; |
| [2902](#L2902) | if (rand (1, 10) > 5) $html\_tags []= 'SECTION'; |
| [2903](#L2903) | if (rand (1, 10) > 5) $html\_tags []= 'ASIDE'; |
| [2904](#L2904) | if (empty ($html\_tags)) $html\_tags = array ('DIV, P, LI'); |
| [2905](#L2905) |  |
| [2906](#L2906) | shuffle ($html\_tags); |
| [2907](#L2907) |  |
| [2908](#L2908) | switch (rand (1, 10)) { |
| [2909](#L2909) | case 1: |
| [2910](#L2910) | $js\_code\_1 = 'var '.$js\_name\_node.' = document.getElementsByTagName ("'. ($html\_tags [0]) .'"); for (var '.$js\_name\_index.'=0; '.$js\_name\_index.' < '.$js\_name\_node.'.length; '.$js\_name\_index.'++) {'; |
| [2911](#L2911) | break; |
| [2912](#L2912) | default: |
| [2913](#L2913) | $js\_code\_1 = 'var '.$js\_name\_node.' = document.body.querySelectorAll ("'.(implode (', ', $html\_tags)).'"); for (var '.$js\_name\_index.'=0; '.$js\_name\_index.' < '.$js\_name\_node.'.length; '.$js\_name\_index.'++) {'; |
| [2914](#L2914) | break; |
| [2915](#L2915) | } |
| [2916](#L2916) |  |
| [2917](#L2917) | $js\_code\_3 = '}'; |
| [2918](#L2918) |  |
| [2919](#L2919) | $js\_code\_css = array (); |
| [2920](#L2920) | if (rand (1, 10) > 2) $js\_code\_css []= 'style.filter = "blur('.rand (1, 4).'px) brightness('.rand (60, 80).'%)"'; |
| [2921](#L2921) | if (rand (1, 10) > 4) $js\_code\_css []= 'style.cursor = "no-drop"'; |
| [2922](#L2922) | if (rand (1, 10) > 3) $js\_code\_css []= 'style.cursor = "grab"'; |
| [2923](#L2923) | if (rand (1, 10) > 5) $js\_code\_css []= 'style.cursor = "grabbing"'; |
| [2924](#L2924) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.cursor = "wait"'; |
| [2925](#L2925) | if (rand (1, 10) > 7) $js\_code\_css []= 'style.cursor = "not-allowed"'; |
| [2926](#L2926) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.cursor = "cell"'; |
| [2927](#L2927) | if (rand (1, 10) > 9) $js\_code\_css []= 'style.cursor = "all-scroll"'; |
| [2928](#L2928) | if (rand (1, 10) > 2) $js\_code\_css []= 'style.background = "rgba('.rand (31, 55).', '.rand (31, 55).', '.rand (31, 55).', '.(rand (50, 80)/100).')"'; |
| [2929](#L2929) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.opacity = "0.'.rand (55, 84).'"'; |
| [2930](#L2930) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.zIndex = "'.rand (1, 12345).'"'; |
| [2931](#L2931) | if (rand (1, 10) > 7) $js\_code\_css []= 'style.textTransform = "uppercase"'; |
| [2932](#L2932) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.letterSpacing = "'.rand (0, 5).'px"'; |
| [2933](#L2933) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.border = "'.rand (2, 25).'px solid"'; |
| [2934](#L2934) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.color = "rgba('.rand (1, 255).', '.rand (1, 255).', '.rand (1, 255).', '.(rand (20, 50)/100).')"'; |
| [2935](#L2935) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.fontFamily = "sans-serif"'; |
| [2936](#L2936) | if (rand (1, 10) > 7) $js\_code\_css []= 'style.fontFamily = "serif"'; |
| [2937](#L2937) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.fontFamily = "sans-serif"'; |
| [2938](#L2938) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.fontFamily = "arial"'; |
| [2939](#L2939) | if (rand (1, 10) > 6) $js\_code\_css []= 'style.fontFamily = "monospace"'; |
| [2940](#L2940) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.visibility = "hidden"'; |
| [2941](#L2941) | if (rand (1, 10) > 8) $js\_code\_css []= 'style.visibility = "collapse"'; |
| [2942](#L2942) | if (rand (1, 10) > 9) $js\_code\_css []= 'style.display = "list-item"'; |
| [2943](#L2943) | if (rand (1, 10) > 9) $js\_code\_css []= 'style.display = "inline"'; |
| [2944](#L2944) |  |
| [2945](#L2945) | if (rand (1, 10) > 3) $js\_code\_css []= 'style.margin = "'.rand (500, 2345).'px"'; |
| [2946](#L2946) | if (rand (1, 10) > 4) $js\_code\_css []= 'style.padding = "'.rand (500, 2345).'px"'; |
| [2947](#L2947) |  |
| [2948](#L2948) | if (rand (1, 10) > 7) $js\_code\_css []= 'remove ()'; else |
| [2949](#L2949) | if (rand (1, 10) > 7) $js\_code\_css []= 'parentNode.removeChild (@@)'; |
| [2950](#L2950) | $js\_code\_2 = ''; |
| [2951](#L2951) | foreach ($js\_code\_css as $js\_code\_css\_line) { |
| [2952](#L2952) | $js\_code\_css\_line = str\_replace ('@@', $js\_name\_node.'['.$js\_name\_index.']', $js\_code\_css\_line); |
| [2953](#L2953) | $js\_code\_2 .= $js\_name\_node.'['.$js\_name\_index.'].'.$js\_code\_css\_line.';'; |
| [2954](#L2954) | } |
| [2955](#L2955) |  |
| [2956](#L2956) | //      $js = str\_replace ('AI\_ADB\_HTML', base64\_encode ($js\_code\_1.$js\_code\_2.$js\_code\_3), $js); |
| [2957](#L2957) | //      $js = str\_replace ('var AI\_ADB\_HTML=1;', $js\_code\_1.$js\_code\_2.$js\_code\_3, $js); |
| [2958](#L2958) | $js = str\_replace ('AI\_ADB\_HTML=1;', $js\_code\_1.$js\_code\_2.$js\_code\_3, $js); |
| [2959](#L2959) |  |
| [2960](#L2960) | $body\_js\_code = ''; |
| [2961](#L2961) | if (rand (1, 10) > 5) $body\_js\_code .= 'document.body.style.background = "rgba('.rand (11, 35).', '.rand (11, 35).', '.rand (11, 35).', '.(rand (60, 90)/100).')";'; |
| [2962](#L2962) | if (rand (1, 10) > 6) $body\_js\_code .= 'document.body.style.backgroundColor = "rgba('.rand (21, 45).', '.rand (21, 45).', '.rand (21, 45).', '.(rand (60, 90)/100).')";'; |
| [2963](#L2963) | if (rand (1, 10) > 6) $body\_js\_code .= 'document.body.style.margin = "'.rand (400, 4345).'px";'; |
| [2964](#L2964) |  |
| [2965](#L2965) | //      $js = str\_replace ('var AI\_ADB\_HTML=2;', $body\_js\_code, $js); |
| [2966](#L2966) | $js = str\_replace ('AI\_ADB\_HTML=2', $body\_js\_code, $js); |
| [2967](#L2967) |  |
| [2968](#L2968) | $js = str\_replace ('AI\_ADB\_SELECTORS', get\_adb\_selectors (true), $js); |
| [2969](#L2969) |  |
| [2970](#L2970) | $redirection\_page = get\_redirection\_page (); |
| [2971](#L2971) | if ($redirection\_page != 0) $url = get\_permalink ($redirection\_page); else $url = trim (get\_custom\_redirection\_url ()); |
| [2972](#L2972) | $js = str\_replace ('AI\_ADB\_REDIRECTION\_PAGE', $url, $js); |
| [2973](#L2973) |  |
| [2974](#L2974) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_AD\_BLOCKING\_STATUS | AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0) { |
| [2975](#L2975) | // translators: AD BLOCKING DETECTED, PAGE VIEWS: n - NO ACTION |
| [2976](#L2976) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=1', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING DETECTED, PAGE VIEWS', 'ad-inserter') . '" + ": " + window.ai\_d1 + " - " + "' . \_\_('NO ACTION', 'ad-inserter') . '"),jQuery("#ai-adb-bar").addClass ("adb-on"))', $js); |
| [2977](#L2977) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=2', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING DETECTED, COOKIE DETECTED - NO ACTION', 'ad-inserter') . '"),jQuery("#ai-adb-bar").addClass ("adb-on"))', $js); |
| [2978](#L2978) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=3', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING DETECTED - ACTION', 'ad-inserter') . '"),jQuery("#ai-adb-bar").addClass ("adb-on"))', $js); |
| [2979](#L2979) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=4', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING NOT DETECTED', 'ad-inserter') . '"),jQuery("#ai-adb-bar").addClass ("adb-off"))', $js); |
| [2980](#L2980) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=5', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING DETECTION COOKIES DELETED', 'ad-inserter') . '"))', $js); |
| [2981](#L2981) | //        $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=6', '(jQuery("#ai-adb-status").text ("' . \_\_('AD BLOCKING DETECTED - NO ACTION', 'ad-inserter') . '"),jQuery("#ai-adb-bar").addClass ("adb-on"))', $js); |
| [2982](#L2982) |  |
| [2983](#L2983) | // translators: AD BLOCKING DETECTED, PAGE VIEWS: n - NO ACTION |
| [2984](#L2984) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=1', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING DETECTED, PAGE VIEWS', 'ad-inserter') . '" + ": " + window.ai\_d1 + " - " + "' . \_\_('NO ACTION', 'ad-inserter') . '";if (document.querySelector("#ai-adb-bar") != null) document.querySelector("#ai-adb-bar").classList.add ("adb-on");', $js); |
| [2985](#L2985) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=2', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING DETECTED, COOKIE DETECTED - NO ACTION', 'ad-inserter') . '"; if (document.querySelector("#ai-adb-bar") != null) document.querySelector("#ai-adb-bar").classList.add ("adb-on");', $js); |
| [2986](#L2986) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=3', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING DETECTED - ACTION', 'ad-inserter') . '"; if (document.querySelector("#ai-adb-bar") != null) document.querySelector("#ai-adb-bar").classList.add ("adb-on");', $js); |
| [2987](#L2987) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=4', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING NOT DETECTED', 'ad-inserter') . '"; if (document.querySelector("#ai-adb-bar") != null) document.querySelector("#ai-adb-bar").classList.add ("adb-off");', $js); |
| [2988](#L2988) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=5', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING DETECTION COOKIES DELETED', 'ad-inserter') . '";', $js); |
| [2989](#L2989) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=6', 'if (document.querySelector("#ai-adb-status") != null) document.querySelector("#ai-adb-status").innerText = "' . \_\_('AD BLOCKING DETECTED - NO ACTION', 'ad-inserter') . '"; if (document.querySelector("#ai-adb-bar") != null) document.querySelector("#ai-adb-bar").classList.add ("adb-on");', $js); |
| [2990](#L2990) | } else { |
| [2991](#L2991) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=1', '(0)', $js); |
| [2992](#L2992) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=2', '(0)', $js); |
| [2993](#L2993) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=3', '(0)', $js); |
| [2994](#L2994) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=4', '(0)', $js); |
| [2995](#L2995) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=5', '(0)', $js); |
| [2996](#L2996) | //          $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=6', '(0)', $js); |
| [2997](#L2997) |  |
| [2998](#L2998) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=1', '', $js); |
| [2999](#L2999) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=2', '', $js); |
| [3000](#L3000) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=3', '', $js); |
| [3001](#L3001) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=4', '', $js); |
| [3002](#L3002) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=5', '', $js); |
| [3003](#L3003) | $js = str\_replace ('window.AI\_ADB\_STATUS\_MESSAGE=6', '', $js); |
| [3004](#L3004) | } |
| [3005](#L3005) | } |
| [3006](#L3006) | } |
| [3007](#L3007) |  |
| [3008](#L3008) | //  $js = str\_replace ('AI\_ADB\_ATTR\_NAME', "b64d ('" . base64\_encode ('data-'.(defined ('AI\_ADB\_ATTR') ? AI\_ADB\_ATTR : 'data-mask')) . "')", $js); |
| [3009](#L3009) | $js = str\_replace ('AI\_ADB\_ATTR\_NAME', "'" . base64\_encode ('data-'.(defined ('AI\_ADB\_ATTR') ? AI\_ADB\_ATTR : 'data-mask')) . "'", $js); |
| [3010](#L3010) |  |
| [3011](#L3011) | $js = str\_replace ('AI\_NONCE', wp\_create\_nonce ("adinserter\_data"), $js); |
| [3012](#L3012) | $js = str\_replace ('AI\_AJAXURL', admin\_url ('admin-ajax.php'), $js); |
| [3013](#L3013) | $js = str\_replace ('AI\_SITE\_URL', wp\_make\_link\_relative (get\_site\_url()), $js); |
| [3014](#L3014) | $js = str\_replace ('AI\_HOME\_URL', home\_url (), $js); |
| [3015](#L3015) |  |
| [3016](#L3016) | if (defined ('AI\_STATISTICS') && AI\_STATISTICS) { |
| [3017](#L3017) | $js = str\_replace ('AI\_INTERNAL\_TRACKING',          get\_internal\_tracking () == AI\_ENABLED ? 1 : 0, $js); |
| [3018](#L3018) | $js = str\_replace ('AI\_EXTERNAL\_TRACKING',          get\_external\_tracking () == AI\_ENABLED ? 1 : 0, $js); |
| [3019](#L3019) | $js = str\_replace ('AI\_DEBUG\_TRACKING',             isset ($\_GET [AI\_URL\_DEBUG\_TRACKING]) && $\_GET [AI\_URL\_DEBUG\_TRACKING] ? 1 : 0, $js); |
| [3020](#L3020) |  |
| [3021](#L3021) | $js = str\_replace ('AI\_EXT\_CATEGORY',               get\_external\_tracking\_category (), $js); |
| [3022](#L3022) | $js = str\_replace ('AI\_EXT\_ACTION',                 get\_external\_tracking\_action (), $js); |
| [3023](#L3023) | $js = str\_replace ('AI\_EXT\_LABEL',                  get\_external\_tracking\_label (), $js); |
| [3024](#L3024) |  |
| [3025](#L3025) | $current\_user = wp\_get\_current\_user (); |
| [3026](#L3026) | $wp\_username = $current\_user->user\_login; |
| [3027](#L3027) | $js = str\_replace ('WP\_USERNAME',                   $wp\_username, $js); |
| [3028](#L3028) |  |
| [3029](#L3029) | $js = str\_replace ('AI\_TRACK\_PAGEVIEWS',            get\_track\_pageviews () == AI\_TRACKING\_ENABLED && $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_REST && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME] ? 1 : 0, $js); |
| [3030](#L3030) | $js = str\_replace ('AI\_ADVANCED\_CLICK\_DETECTION',   get\_click\_detection () == AI\_CLICK\_DETECTION\_ADVANCED ? 1 : 0, $js); |
| [3031](#L3031) |  |
| [3032](#L3032) | if (!isset ($ai\_wp\_data [AI\_VIEWPORT\_WIDTHS])) { |
| [3033](#L3033) |  |
| [3034](#L3034) | $viewport\_data = array (); |
| [3035](#L3035) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [3036](#L3036) | $viewport\_name  = get\_viewport\_name ($viewport); |
| [3037](#L3037) | $viewport\_width = get\_viewport\_width ($viewport); |
| [3038](#L3038) | if ($viewport\_name != '') { |
| [3039](#L3039) | $viewport\_data []= array ('index' => $viewport, 'name' => $viewport\_name, 'width' => $viewport\_width); |
| [3040](#L3040) | } |
| [3041](#L3041) | } |
| [3042](#L3042) |  |
| [3043](#L3043) | usort ($viewport\_data, 'ai\_compare\_viewport'); |
| [3044](#L3044) |  |
| [3045](#L3045) | $viewport\_widthss = array (); |
| [3046](#L3046) | $viewport\_indexes = array (); |
| [3047](#L3047) | $viewport\_names   = array (); |
| [3048](#L3048) | foreach ($viewport\_data as $viewport) { |
| [3049](#L3049) | $viewport\_widthss []= $viewport ['width']; |
| [3050](#L3050) | $viewport\_indexes []= $viewport ['index']; |
| [3051](#L3051) | $viewport\_names   []= $viewport ['name']; |
| [3052](#L3052) | } |
| [3053](#L3053) | $ai\_wp\_data [AI\_VIEWPORT\_WIDTHS]  = $viewport\_widthss; |
| [3054](#L3054) | $ai\_wp\_data [AI\_VIEWPORT\_INDEXES] = $viewport\_indexes; |
| [3055](#L3055) | $ai\_wp\_data [AI\_VIEWPORT\_NAMES]   = $viewport\_names; |
| [3056](#L3056) | } |
| [3057](#L3057) | $js = str\_replace ('AI\_VIEWPORT\_WIDTHS', '[' . implode (',', $ai\_wp\_data [AI\_VIEWPORT\_WIDTHS]) . ']', $js); |
| [3058](#L3058) | $js = str\_replace ('AI\_VIEWPORT\_INDEXES', '[' . implode (',', $ai\_wp\_data [AI\_VIEWPORT\_INDEXES]) . ']', $js); |
| [3059](#L3059) | $js = str\_replace ('AI\_VIEWPORT\_NAMES', base64\_encode ('["' . implode ('","', $ai\_wp\_data [AI\_VIEWPORT\_NAMES]) . '"]'), $js); |
| [3060](#L3060) | } |
| [3061](#L3061) | // Deprecated |
| [3062](#L3062) | $js = str\_replace ('AI\_BLOCK\_CLASS\_NAME', get\_block\_class\_name (true), $js); |
| [3063](#L3063) |  |
| [3064](#L3064) | if (function\_exists ('ai\_replace\_js\_data\_2')) ai\_replace\_js\_data\_2 ($js); else { |
| [3065](#L3065) | $js = str\_replace ('AI\_ADB\_CONTENT\_CSS\_BEGIN\_CLASS',      'wp-slider0-pre90', $js); |
| [3066](#L3066) | $js = str\_replace ('AI\_ADB\_CONTENT\_CSS\_END\_CLASS',        'wp-slider1-pre91', $js); |
| [3067](#L3067) | $js = str\_replace ('AI\_ADB\_CONTENT\_DELETE\_BEGIN\_CLASS',   'wp-slider2-pre92', $js); |
| [3068](#L3068) | $js = str\_replace ('AI\_ADB\_CONTENT\_DELETE\_END\_CLASS',     'wp-slider3-pre93', $js); |
| [3069](#L3069) | $js = str\_replace ('AI\_ADB\_CONTENT\_REPLACE\_BEGIN\_CLASS',  'wp-slider4-pre94', $js); |
| [3070](#L3070) | $js = str\_replace ('AI\_ADB\_CONTENT\_REPLACE\_END\_CLASS',    'wp-slider5-pre95', $js); |
| [3071](#L3071) | $js = str\_replace ('ai-adb-url',    AD\_INSERTER\_PLUGIN\_URL . 'js/', $js); |
| [3072](#L3072) | } |
| [3073](#L3073) |  |
| [3074](#L3074) | return $js; |
| [3075](#L3075) | } |
| [3076](#L3076) |  |
| [3077](#L3077) | function ai\_adb\_code () { |
| [3078](#L3078) | return ai\_get\_js ('ai-adb', false); |
| [3079](#L3079) | } |
| [3080](#L3080) |  |
| [3081](#L3081) | //function ai\_ao\_override\_js\_replacetag ($replacetag) { |
| [3082](#L3082) | //  return array ("<span ai-ao></span>","replace"); |
| [3083](#L3083) | //} |
| [3084](#L3084) |  |
| [3085](#L3085) | function ai\_adb\_external\_scripts () { |
| [3086](#L3086) | $code = ''; |
| [3087](#L3087) |  |
| [3088](#L3088) | //  if (!defined ('AI\_ADB\_NO\_DOUBLECLICK\_NET')) { |
| [3089](#L3089) | //    $code .= '<object id="ai-adb-dblclk" data="https://securepubads.g.doubleclick.net/tag/js/gpt.js" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3090](#L3090) | //  } |
| [3091](#L3091) | if (!defined ('AI\_ADB\_NO\_GOOGLE\_ANALYTICS')) { |
| [3092](#L3092) | $code .= '<object id="ai-adb-ga" data="https://www.google-analytics.com/analytics.js" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3093](#L3093) | } |
| [3094](#L3094) | if (!defined ('AI\_ADB\_NO\_MEDIA\_NET')) { |
| [3095](#L3095) | $code .= '<object id="ai-adb-mn" data="//contextual.media.net/dmedianet.js" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3096](#L3096) | } |
| [3097](#L3097) | //  if (!defined ('AI\_ADB\_NO\_AMAZON-ADSYSTEM')) { |
| [3098](#L3098) | //    $code .= '<object id="ai-adb-am" data="https://z-na.amazon-adsystem.com/widgets/onejs" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3099](#L3099) | //  } |
| [3100](#L3100) | if (!defined ('AI\_ADB\_NO\_EZOIC\_CMP')) { |
| [3101](#L3101) | $code .= '<object id="ai-adb-ez" data="https://g.ezodn.com/cmp/v2/v.js" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3102](#L3102) | } |
| [3103](#L3103) | if (!defined ('AI\_ADB\_NO\_QUANT')) { |
| [3104](#L3104) | $code .= '<object id="ai-adb-qu" data="https://secure.quantserve.com/quant.js" style="position:absolute; z-index: -100; top: -1000px; left: -1000px; visibility: hidden;"></object>' . "\n"; |
| [3105](#L3105) | } |
| [3106](#L3106) |  |
| [3107](#L3107) | return $code; |
| [3108](#L3108) | } |
| [3109](#L3109) |  |
| [3110](#L3110) | //function ai\_replace\_prefix ($js\_code) { |
| [3111](#L3111) |  |
| [3112](#L3112) | //  if (!defined ('AI\_ADB\_PREFIX')) { |
| [3113](#L3113) | //    $seed = date ('Y-m-d H'); |
| [3114](#L3114) |  |
| [3115](#L3115) | //    $key = $seed.'AI\_'; |
| [3116](#L3116) | //    if (defined ('NONCE\_KEY')) { |
| [3117](#L3117) | //      $key .= NONCE\_KEY; |
| [3118](#L3118) | //    } |
| [3119](#L3119) | //    if (defined ('AUTH\_KEY')) { |
| [3120](#L3120) | //      $key .= AUTH\_KEY; |
| [3121](#L3121) | //      $auth\_key = $seed.AUTH\_KEY; |
| [3122](#L3122) | //    } else $auth\_key = $seed.'#AI\_'; |
| [3123](#L3123) |  |
| [3124](#L3124) | //    define ('AI\_ADB\_PREFIX', substr (substr (preg\_replace ("/[^A-Za-z]+/", '', strtolower (md5 ($seed.$auth\_key))), 0, 4) . preg\_replace ("/[^A-Za-z0-9]+/", '', strtolower (md5 ($seed.$key))), 0, 8) . '\_'); |
| [3125](#L3125) | //  } |
| [3126](#L3126) |  |
| [3127](#L3127) | ////  return preg\_replace ("/ai\_/", AI\_ADB\_PREFIX, $js\_code); |
| [3128](#L3128) | //  return preg\_replace ("/ai\_adb/", AI\_ADB\_PREFIX, $js\_code); |
| [3129](#L3129) | //} |
| [3130](#L3130) |  |
| [3131](#L3131) | function add\_footer\_inline\_scripts () { |
| [3132](#L3132) | global $ai\_wp\_data, $wp\_version; |
| [3133](#L3133) |  |
| [3134](#L3134) | if (get\_disable\_js\_code ()) return; |
| [3135](#L3135) |  |
| [3136](#L3136) | $adb\_code = defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION && $ai\_wp\_data [AI\_ADB\_DETECTION] && !isset ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_DISABLED]) && !$ai\_wp\_data [AI\_WP\_AMP\_PAGE]; |
| [3137](#L3137) |  |
| [3138](#L3138) | if ($adb\_code) { |
| [3139](#L3139) | if (function\_exists ('add\_footer\_inline\_scripts\_1')) add\_footer\_inline\_scripts\_1 (); else { |
| [3140](#L3140) | echo '<!-- Code for ad blocking detection -->', "\n"; |
| [3141](#L3141) | echo '<!--noptimize-->', "\n"; |
| [3142](#L3142) |  |
| [3143](#L3143) | if (get\_adb\_external\_scripts ()) { |
| [3144](#L3144) | echo ai\_adb\_external\_scripts (); |
| [3145](#L3145) | } |
| [3146](#L3146) |  |
| [3147](#L3147) | if (!defined ('AI\_ADB\_NO\_BANNER\_AD')) { |
| [3148](#L3148) | echo '<div id="banner-advert-container" class="ad-inserter infolinks-ad" style="position:absolute; z-index: -10; height: 1px; width: 1px; top: -100px; left: -100px;"><img id="adsense" class="SponsorAds adsense" src="', AD\_INSERTER\_PLUGIN\_IMAGES\_URL, 'ads.png" width="1" height="1" alt="pixel"></div>', "\n"; |
| [3149](#L3149) | } |
| [3150](#L3150) | if (!defined ('AI\_ADB\_NO\_ADS\_JS')) { |
| [3151](#L3151) | echo '<script async id="ai-adb-ads" src="', plugins\_url ('js/ads.js',       \_\_FILE\_\_ ), "?ver=", AD\_INSERTER\_VERSION, '"></script>', "\n"; |
| [3152](#L3152) | } |
| [3153](#L3153) | if (!defined ('AI\_ADB\_NO\_SPONSORS\_JS')) { |
| [3154](#L3154) | echo '<script async id="ai-adb-sponsors" src="', plugins\_url ('js/sponsors.js',  \_\_FILE\_\_ ), "?ver=", AD\_INSERTER\_VERSION, '"></script>', "\n"; |
| [3155](#L3155) | } |
| [3156](#L3156) | if (!defined ('AI\_ADB\_NO\_BANNER\_JS')) { |
| [3157](#L3157) | echo '<script async id="ai-adb-banner" src="', plugins\_url ('js/banner.js',  \_\_FILE\_\_ ), "?ver=", AD\_INSERTER\_VERSION, '"></script>', "\n"; |
| [3158](#L3158) | } |
| [3159](#L3159) | if (!defined ('AI\_ADB\_NO\_300x250\_JS')) { |
| [3160](#L3160) | echo '<script async id="ai-adb-300x250" src="', plugins\_url ('js/300x250.js',  \_\_FILE\_\_ ), "?ver=", AD\_INSERTER\_VERSION, '"></script>', "\n"; |
| [3161](#L3161) | } |
| [3162](#L3162) | echo '<!--/noptimize-->', "\n"; |
| [3163](#L3163) | echo '<!-- Code for ad blocking detection END -->', "\n"; |
| [3164](#L3164) | } |
| [3165](#L3165) | } |
| [3166](#L3166) |  |
| [3167](#L3167) | // Use updated flags |
| [3168](#L3168) | ai\_set\_footer\_inline\_scripts (); |
| [3169](#L3169) |  |
| [3170](#L3170) | $inline\_js = ai\_inline\_js (); |
| [3171](#L3171) |  |
| [3172](#L3172) | if ($ai\_wp\_data [AI\_FOOTER\_INLINE\_SCRIPTS]) { |
| [3173](#L3173) | if (!$inline\_js) { |
| [3174](#L3174) | echo '<!--noptimize-->', "\n"; |
| [3175](#L3175) | } |
| [3176](#L3176) |  |
| [3177](#L3177) |  |
| [3178](#L3178) | echo "<script>\n"; |
| [3179](#L3179) |  |
| [3180](#L3180) | $client\_side\_dynamic\_blocks = get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW || get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT; |
| [3181](#L3181) | $wait\_for\_jquery = get\_wait\_for\_jquery () && !$ai\_wp\_data [AI\_WP\_AMP\_PAGE]; |
| [3182](#L3182) |  |
| [3183](#L3183) | ob\_start (); |
| [3184](#L3184) |  |
| [3185](#L3185) | if ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING]) { |
| [3186](#L3186) | $js\_code = ""; |
| [3187](#L3187) |  |
| [3188](#L3188) | if (function\_exists ('add\_footer\_inline\_scripts\_3')) { |
| [3189](#L3189) | $js\_code .= add\_footer\_inline\_scripts\_3 ($js\_code); |
| [3190](#L3190) | } |
| [3191](#L3191) |  |
| [3192](#L3192) | $js\_code .= "ai\_debugging = true;\n"; |
| [3193](#L3193) |  |
| [3194](#L3194) | echo $js\_code; |
| [3195](#L3195) | } |
| [3196](#L3196) |  |
| [3197](#L3197) | if ($client\_side\_dynamic\_blocks || |
| [3198](#L3198) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || |
| [3199](#L3199) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION] || |
| [3200](#L3200) | isset ($ai\_wp\_data [AI\_CLIENT\_SIDE\_ROTATION]) || |
| [3201](#L3201) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || |
| [3202](#L3202) | $inline\_js && ($ai\_wp\_data [AI\_CLOSE\_BUTTONS] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) || |
| [3203](#L3203) | $ai\_wp\_data [AI\_PARALLAX] || |
| [3204](#L3204) | $inline\_js && $ai\_wp\_data [AI\_CHECK\_BLOCK] || |
| [3205](#L3205) | $ai\_wp\_data [AI\_LAZY\_LOADING] || |
| [3206](#L3206) | $inline\_js && ($ai\_wp\_data [AI\_TRACKING] && !isset ($ai\_wp\_data [AI\_TRACKING\_SHORTCODE\_DISABLED])) || |
| [3207](#L3207) | $adb\_code |
| [3208](#L3208) | ) { |
| [3209](#L3209) | echo ai\_get\_js ('ai-base64'); |
| [3210](#L3210) | } |
| [3211](#L3211) |  |
| [3212](#L3212) | if ($adb\_code) { |
| [3213](#L3213) | if (get\_adb\_action () == AI\_ADB\_ACTION\_MESSAGE && /\*get\_undismissible\_message ()\*/ !defined ('AI\_ADB\_NO\_JS\_CHECK')) { |
| [3214](#L3214) | echo ai\_get\_js ('ai-adb-try'); |
| [3215](#L3215) |  |
| [3216](#L3216) | // Prevent replacing prefix |
| [3217](#L3217) | //        echo '[[ai-adb-try]]'; |
| [3218](#L3218) | } |
| [3219](#L3219) | } |
| [3220](#L3220) |  |
| [3221](#L3221) | echo ai\_front\_translations\_code (); |
| [3222](#L3222) |  |
| [3223](#L3223) | // Wait for jQuery |
| [3224](#L3224) | if ($wait\_for\_jquery && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3225](#L3225) | $jquery\_ready\_code = explode ("AI\_JS\_CODE=1", ai\_get\_js ('ai-wait-jquery', false)); |
| [3226](#L3226) |  |
| [3227](#L3227) | echo $jquery\_ready\_code [0]; |
| [3228](#L3228) | } |
| [3229](#L3229) |  |
| [3230](#L3230) | if ($ai\_wp\_data [AI\_STICKY\_WIDGETS] && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_JS) { |
| [3231](#L3231) | if ($inline\_js) { |
| [3232](#L3232) | echo ai\_get\_js ('ResizeSensor'); |
| [3233](#L3233) | echo ai\_get\_js ('theia-sticky-sidebar'); |
| [3234](#L3234) | } |
| [3235](#L3235) | } |
| [3236](#L3236) |  |
| [3237](#L3237) | if ($ai\_wp\_data [AI\_STICKY\_WIDGETS] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3238](#L3238) | echo ai\_get\_js ('ai-sidebar-data'); |
| [3239](#L3239) | if ($inline\_js) { |
| [3240](#L3240) | echo ai\_get\_js ('ai-sidebar'); |
| [3241](#L3241) | } |
| [3242](#L3242) | } |
| [3243](#L3243) |  |
| [3244](#L3244) | if (($ai\_wp\_data [AI\_CLOSE\_BUTTONS]  && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) || |
| [3245](#L3245) | $ai\_wp\_data [AI\_CHECK\_BLOCK] || |
| [3246](#L3246) | ($ai\_wp\_data [AI\_TRACKING] && !isset ($ai\_wp\_data [AI\_TRACKING\_SHORTCODE\_DISABLED])) || |
| [3247](#L3247) | $adb\_code || |
| [3248](#L3248) | $client\_side\_dynamic\_blocks || |
| [3249](#L3249) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || |
| [3250](#L3250) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION]) { |
| [3251](#L3251) | echo ai\_get\_js ('ai-cookie-data'); |
| [3252](#L3252) | if ($inline\_js) { |
| [3253](#L3253) | echo ai\_get\_js ('ai-cookie', false); |
| [3254](#L3254) | } |
| [3255](#L3255) | } |
| [3256](#L3256) |  |
| [3257](#L3257) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_FILTER\_CHECKS]) { |
| [3258](#L3258) | echo ai\_get\_js ('ai-filter-data'); |
| [3259](#L3259) | if ($inline\_js) { |
| [3260](#L3260) | echo ai\_get\_js ('ai-filter', false); |
| [3261](#L3261) | } |
| [3262](#L3262) | } |
| [3263](#L3263) |  |
| [3264](#L3264) | if (($ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION] || $ai\_wp\_data [AI\_CHECK\_BLOCK])) { |
| [3265](#L3265) | echo ai\_get\_js ('ai-insert-data'); |
| [3266](#L3266) | if ($inline\_js) { |
| [3267](#L3267) | echo ai\_get\_js ('ai-insert', false); |
| [3268](#L3268) | } |
| [3269](#L3269) | } |
| [3270](#L3270) |  |
| [3271](#L3271) | if (function\_exists ('add\_footer\_inline\_scripts\_2') && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3272](#L3272) | if ($ai\_wp\_data [AI\_LAZY\_LOADING]) { |
| [3273](#L3273) | echo ai\_get\_js ('ai-load-data'); |
| [3274](#L3274) | if ($inline\_js) { |
| [3275](#L3275) | echo ai\_get\_js ('ai-load'); |
| [3276](#L3276) | } |
| [3277](#L3277) | } |
| [3278](#L3278) |  |
| [3279](#L3279) | if ($ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT] || $ai\_wp\_data [AI\_ANIMATION]) { |
| [3280](#L3280) | echo ai\_get\_js ('ai-sticky-data'); |
| [3281](#L3281) | if ($inline\_js) { |
| [3282](#L3282) | echo ai\_get\_js ('ai-sticky'); |
| [3283](#L3283) | } |
| [3284](#L3284) | } |
| [3285](#L3285) | } |
| [3286](#L3286) |  |
| [3287](#L3287) | if (function\_exists ('add\_footer\_inline\_scripts\_2') && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3288](#L3288) | if ($ai\_wp\_data [AI\_PARALLAX]) { |
| [3289](#L3289) | if ($inline\_js) { |
| [3290](#L3290) | echo ai\_get\_js ('ai-parallax'); |
| [3291](#L3291) | } |
| [3292](#L3292) | } |
| [3293](#L3293) | } |
| [3294](#L3294) |  |
| [3295](#L3295) | if ($client\_side\_dynamic\_blocks || isset ($ai\_wp\_data [AI\_CLIENT\_SIDE\_ROTATION])) { |
| [3296](#L3296) | echo ai\_get\_js ('ai-rotation-data'); |
| [3297](#L3297) | if ($inline\_js) { |
| [3298](#L3298) | echo ai\_get\_js ('ai-rotation'); |
| [3299](#L3299) | } |
| [3300](#L3300) | } |
| [3301](#L3301) | // VIEWPORT separators or CHECK viewport |
| [3302](#L3302) | if ($client\_side\_dynamic\_blocks || $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION] || $adb\_code) { |
| [3303](#L3303) | if ($inline\_js) { |
| [3304](#L3304) | echo ai\_get\_js ('ai-mobile-detect'); |
| [3305](#L3305) | } |
| [3306](#L3306) | echo ai\_get\_js ('ai-lists-data'); |
| [3307](#L3307) | if ($inline\_js) { |
| [3308](#L3308) | echo ai\_get\_js ('ai-lists'); |
| [3309](#L3309) | } |
| [3310](#L3310) | } |
| [3311](#L3311) |  |
| [3312](#L3312) | if ($ai\_wp\_data [AI\_CLOSE\_BUTTONS] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3313](#L3313) | if ($inline\_js) { |
| [3314](#L3314) | echo ai\_get\_js ('ai-close'); |
| [3315](#L3315) | } |
| [3316](#L3316) | } |
| [3317](#L3317) |  |
| [3318](#L3318) | if ($ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION]) { |
| [3319](#L3319) | echo ai\_get\_js ('ai-select-data'); |
| [3320](#L3320) | if ($inline\_js) { |
| [3321](#L3321) | echo ai\_get\_js ('ai-select'); |
| [3322](#L3322) | } |
| [3323](#L3323) | } |
| [3324](#L3324) |  |
| [3325](#L3325) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [3326](#L3326) | if (defined ('AI\_ADSENSE\_OVERLAY') && !(isset ($\_GET ["hide-debug-labels"]) && $\_GET ["hide-debug-labels"] == 1)) { |
| [3327](#L3327) | echo ai\_get\_js ('ai-ads-data'); |
| [3328](#L3328) | if ($inline\_js) { |
| [3329](#L3329) | echo ai\_get\_js ('ai-ads'); |
| [3330](#L3330) | echo ai\_get\_js ('ai-auto-ads', false); |
| [3331](#L3331) | } |
| [3332](#L3332) | } |
| [3333](#L3333) | } |
| [3334](#L3334) |  |
| [3335](#L3335) | // Always inline |
| [3336](#L3336) | if ($adb\_code) { |
| [3337](#L3337) | if (!function\_exists ('add\_footer\_inline\_scripts\_2')) { |
| [3338](#L3338) | echo ai\_get\_js ('ai-adb-data'); |
| [3339](#L3339) | //        echo ai\_replace\_js\_data (ai\_adb\_code ()); |
| [3340](#L3340) | echo ai\_replace\_js\_data (ai\_adb\_code (), false); |
| [3341](#L3341) | } |
| [3342](#L3342) | } |
| [3343](#L3343) |  |
| [3344](#L3344) | if (function\_exists ('add\_footer\_inline\_scripts\_2')) { |
| [3345](#L3345) | add\_footer\_inline\_scripts\_2 (); |
| [3346](#L3346) | } |
| [3347](#L3347) |  |
| [3348](#L3348) | if ($ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] != '') { |
| [3349](#L3349) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] = ai\_get\_js ('ai-errors', false) . $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY]; |
| [3350](#L3350) |  |
| [3351](#L3351) |  |
| [3352](#L3352) | if ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING]) { |
| [3353](#L3353) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] = "  var ai\_debug = typeof ai\_debugging !== 'undefined'; |
| [3354](#L3354) | if (typeof ai\_debugging !== 'undefined') console.log ('AI DOM READY JS CODE RUN'); |
| [3355](#L3355) | " . $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] . "if (typeof ai\_debugging !== 'undefined') console.log ('AI DOM READY JS CODE END'); |
| [3356](#L3356) | "; |
| [3357](#L3357) | } |
| [3358](#L3358) |  |
| [3359](#L3359) | echo ai\_js\_dom\_ready ("\n".$ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY], false); |
| [3360](#L3360) | } |
| [3361](#L3361) |  |
| [3362](#L3362) | echo ("\nai\_js\_code = true;"); |
| [3363](#L3363) |  |
| [3364](#L3364) | // Wait for jQuery - for iframe pages it is always loaded |
| [3365](#L3365) | if ($wait\_for\_jquery && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3366](#L3366) | global $wp\_scripts; |
| [3367](#L3367) |  |
| [3368](#L3368) | if (isset ($wp\_scripts->registered ['jquery']->ver)) { |
| [3369](#L3369) | $ver = $wp\_scripts->registered ['jquery']->ver; |
| [3370](#L3370) | } else { |
| [3371](#L3371) | $ver = $wp\_version; |
| [3372](#L3372) | } |
| [3373](#L3373) |  |
| [3374](#L3374) | echo str\_replace (array ( |
| [3375](#L3375) | 'AI\_JS\_JQUERY0', |
| [3376](#L3376) | 'AI\_JS\_JQUERY1', |
| [3377](#L3377) | //        "AI\_JS\_CODE=2" |
| [3378](#L3378) | ), array ( |
| [3379](#L3379) | includes\_url ('js/jquery/jquery.min.js') . '?ver=' . $ver, |
| [3380](#L3380) | includes\_url ('js/jquery/jquery-migrate.min.js') . '?ver=' . $wp\_version, |
| [3381](#L3381) | //        trim (ai\_front\_translations\_code ()) |
| [3382](#L3382) | ), $jquery\_ready\_code [1]); |
| [3383](#L3383) | } |
| [3384](#L3384) |  |
| [3385](#L3385) | $footer\_js\_code = ob\_get\_clean (); |
| [3386](#L3386) |  |
| [3387](#L3387) |  |
| [3388](#L3388) | if (function\_exists ('check\_footer\_inline\_scripts')) { |
| [3389](#L3389) | $footer\_js\_code = check\_footer\_inline\_scripts ($footer\_js\_code); |
| [3390](#L3390) | } |
| [3391](#L3391) |  |
| [3392](#L3392) | echo $footer\_js\_code; |
| [3393](#L3393) |  |
| [3394](#L3394) | echo "\n</script>\n"; |
| [3395](#L3395) |  |
| [3396](#L3396) | if (!$inline\_js) { |
| [3397](#L3397) | echo '<!--/noptimize-->', "\n"; |
| [3398](#L3398) | } |
| [3399](#L3399) | } |
| [3400](#L3400) |  |
| [3401](#L3401) | if (!$inline\_js) { |
| [3402](#L3402) | if ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] || !file\_exists (AD\_INSERTER\_PLUGIN\_DIR."js/ai-functions.min.js")) { |
| [3403](#L3403) | $script = 'ai-functions.js'; |
| [3404](#L3404) | } else $script = 'ai-functions.min.js'; |
| [3405](#L3405) |  |
| [3406](#L3406) | echo '<script async id="ai-functions" src="', plugins\_url ('js/' . $script,  \_\_FILE\_\_ ), "?ver=", AD\_INSERTER\_VERSION . ($ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] ? '-'.time () : ''), '"></script>', "\n"; |
| [3407](#L3407) | } |
| [3408](#L3408) | } |
| [3409](#L3409) |  |
| [3410](#L3410) | function ai\_admin\_notice\_hook () { |
| [3411](#L3411) | global $current\_screen, $ai\_db\_options, $ai\_wp\_data, $ai\_db\_options\_extract; |
| [3412](#L3412) | global $ai\_settings\_page, $hook\_suffix; |
| [3413](#L3413) |  |
| [3414](#L3414) | //  $sidebar\_widgets = wp\_get\_sidebars\_widgets(); |
| [3415](#L3415) | //  $sidebars\_with\_deprecated\_widgets = array (); |
| [3416](#L3416) |  |
| [3417](#L3417) | //  foreach ($sidebar\_widgets as $sidebar\_widget\_index => $sidebar\_widget) { |
| [3418](#L3418) | //    if (is\_array ($sidebar\_widget)) |
| [3419](#L3419) | //      foreach ($sidebar\_widget as $widget) { |
| [3420](#L3420) | //        if (preg\_match ("/ai\_widget([\d]+)/", $widget, $widget\_number)) { |
| [3421](#L3421) | //          if (isset ($widget\_number [1]) && is\_numeric ($widget\_number [1])) { |
| [3422](#L3422) | //            $is\_widget = $ai\_db\_options [$widget\_number [1]][AI\_OPTION\_AUTOMATIC\_INSERTION] == AD\_SELECT\_WIDGET; |
| [3423](#L3423) | //          } else $is\_widget = false; |
| [3424](#L3424) | //          $sidebar\_name = $GLOBALS ['wp\_registered\_sidebars'][$sidebar\_widget\_index]['name']; |
| [3425](#L3425) | //          if ($is\_widget && $sidebar\_name != "") |
| [3426](#L3426) | //            $sidebars\_with\_deprecated\_widgets [$sidebar\_widget\_index] = $sidebar\_name; |
| [3427](#L3427) | //        } |
| [3428](#L3428) | //      } |
| [3429](#L3429) | //  } |
| [3430](#L3430) |  |
| [3431](#L3431) | //  if (!empty ($sidebars\_with\_deprecated\_widgets)) { |
| [3432](#L3432) | //    echo "<div class='notice notice-warning'><p><strong>Warning</strong>: You are using deprecated Ad Inserter widgets in the following sidebars: ", |
| [3433](#L3433) | //    implode (", ", $sidebars\_with\_deprecated\_widgets), |
| [3434](#L3434) | //    ". Please replace them with the new 'Ad Inserter' code block widget. See <a href='https://wordpress.org/plugins/ad-inserter/faq/' target='\_blank'>FAQ</a> for details.</p></div>"; |
| [3435](#L3435) | //  } |
| [3436](#L3436) |  |
| [3437](#L3437) | if (function\_exists ('ai\_admin\_notices')) ai\_admin\_notices (); else { |
| [3438](#L3438) | if (/\*$hook\_suffix == $ai\_settings\_page &&\*/ is\_super\_admin () && !wp\_is\_mobile () && isset ($ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL])) { |
| [3439](#L3439) |  |
| [3440](#L3440) | if (isset ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && is\_string ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && strlen ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) != 0) { |
| [3441](#L3441) | $used\_blocks = count (unserialize ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS])); |
| [3442](#L3442) | } else $used\_blocks = 0; |
| [3443](#L3443) |  |
| [3444](#L3444) | $notice\_option = get\_option ('ai-notice-review'); |
| [3445](#L3445) |  |
| [3446](#L3446) | if ($notice\_option === false && $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL] > 20) $notice\_option = 'later'; |
| [3447](#L3447) |  |
| [3448](#L3448) | if (($notice\_option === false  && $used\_blocks >= 2 && $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL] > 2) || ($notice\_option == 'later' && $used\_blocks >= 2 && $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL] > 20)) { |
| [3449](#L3449) | if ($notice\_option == 'later') { |
| [3450](#L3450) | // Translators: 1: number of blocks, 2: Ad Inserter |
| [3451](#L3451) | $message = sprintf (\_n('Hey, you are now using %1$s %2$s block.', 'Hey, you are now using %1$s %2$s blocks.', $used\_blocks, 'ad-inserter'), "<strong>{$used\_blocks}</strong>", "<strong>Ad Inserter</strong>"); |
| [3452](#L3452) | $option = '<div class="ai-notice-text-button ai-notice-dismiss" data-notice="no"> |
| [3453](#L3453) | <button class="button-primary ai-notice-dismiss" data-notice="no"> |
| [3454](#L3454) | <a href="https://adinserter.pro/contact?ref=notice#help" class="ai-notice-dismiss" target="\_blank" data-notice="no">' . \_\_("Please help me to solve a problem first", "ad-inserter") . '</a> |
| [3455](#L3455) | </button> |
| [3456](#L3456) | </div><div class="ai-notice-text-button ai-notice-dismiss" data-notice="no"> |
| [3457](#L3457) | <button class="button-primary ai-notice-dismiss" data-notice="no"> |
| [3458](#L3458) | ' . \_\_("Maybe later", "ad-inserter") . ' |
| [3459](#L3459) | </button> |
| [3460](#L3460) | </div>'; |
| [3461](#L3461) | } else { |
| [3462](#L3462) | // Translators: %s: Ad Inserter |
| [3463](#L3463) | $message = sprintf (\_\_("Hey, you are using %s and I hope you're happy with it.", 'ad-inserter'), '<strong>Ad Inserter</strong>'); |
| [3464](#L3464) | $option = '<div class="ai-notice-text-button ai-notice-dismiss" data-notice="later"> |
| [3465](#L3465) | <button class="button-primary ai-notice-dismiss" data-notice="later"> |
| [3466](#L3466) | <a href="https://adinserter.pro/contact?ref=notice#help" class="ai-notice-dismiss" target="\_blank" data-notice="later">' . \_\_("OK, but please help me with the settings first", "ad-inserter") . '</a> |
| [3467](#L3467) | </button> |
| [3468](#L3468) | </div>'; |
| [3469](#L3469) |  |
| [3470](#L3470) | } |
| [3471](#L3471) | ?> |
| [3472](#L3472) | <div class="notice notice-info ai-notice ai-no-phone" style="display: none;" data-notice="review" data-value="<?php echo base64\_encode (wp\_create\_nonce ("adinserter\_data")); ?>" nonce="<?php echo wp\_create\_nonce ("adinserter\_data"); ?>" > |
| [3473](#L3473) | <div class="ai-notice-element"> |
| [3474](#L3474) | <img src="<?php echo AD\_INSERTER\_PLUGIN\_IMAGES\_URL; ?>icon-50x50.jpg" style="width: 50px; margin: 5px 10px 0px 10px;" /> |
| [3475](#L3475) | </div> |
| [3476](#L3476) | <div class="ai-notice-element" style="width: 100%; padding: 0 10px 0;"> |
| [3477](#L3477) | <p><?php |
| [3478](#L3478) | echo $message, ' '; |
| [3479](#L3479) | \_e("Please take a moment to rate the plugin. When you rate it with 5 stars it's like saying 'Thank you'. Somebody will be happy.", 'ad-inserter'); |
| [3480](#L3480) | echo '<br />'; |
| [3481](#L3481) | \_e("Positive reviews are a great incentive to fix bugs and to add new features for better monetization of your website.", 'ad-inserter'); |
| [3482](#L3482) | ?></p> |
| [3483](#L3483) | </div> |
| [3484](#L3484) | <div class="ai-notice-element ai-notice-buttons last"> |
| [3485](#L3485) | <div class="ai-notice-text-button ai-notice-dismiss" data-notice="yes"> |
| [3486](#L3486) | <button class="button-primary ai-notice-dismiss" data-notice="yes"> |
| [3487](#L3487) | <a href="https://wordpress.org/support/plugin/ad-inserter/reviews/?filter=5#new-post" class="ai-notice-dismiss" target="\_blank" data-notice="yes"><?php \_e ("Sure", 'ad-inserter'); ?></a> |
| [3488](#L3488) | </button> |
| [3489](#L3489) | </div> |
| [3490](#L3490) |  |
| [3491](#L3491) | <?php echo $option; ?> |
| [3492](#L3492) | </div> |
| [3493](#L3493) | </div> |
| [3494](#L3494) |  |
| [3495](#L3495) | <?php |
| [3496](#L3496) | } |
| [3497](#L3497) | } |
| [3498](#L3498) | } |
| [3499](#L3499) |  |
| [3500](#L3500) | if ($hook\_suffix == $ai\_settings\_page) { |
| [3501](#L3501) | if (ai\_ampforwp\_check\_disabled ()) { |
| [3502](#L3502) | echo '<div class="notice notice-warning is-dismissible" style="margin: 5px 15px 2px 0px;"><p>', |
| [3503](#L3503) | /\* translators: 1: AMPforWP Plugin Manager, 2: Ad Inserter \*/ |
| [3504](#L3504) | sprintf (\_\_('Warning: %1$s %3$s disabled %4$s %2$s on AMP pages.', 'ad-inserter'), 'AMPforWP Plugin Manager', AD\_INSERTER\_NAME, '<a href="https://adinserter.pro/documentation/amp-pages#ampforwp" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>'), |
| [3505](#L3505) | '</p></div>'; |
| [3506](#L3506) | } |
| [3507](#L3507) |  |
| [3508](#L3508) | if (version\_compare (phpversion (), "5.6", "<")) { |
| [3509](#L3509) | echo '<div class="notice notice-warning is-dismissible" style="margin: 5px 15px 2px 0px;"><p>', |
| [3510](#L3510) | /\* translators: 1: Ad Inserter, 2, 3: HTML tags \*/ |
| [3511](#L3511) | sprintf (\_\_('Warning: %1$s requires PHP 5.6 or newer. %2$s Please update! %3$s', 'ad-inserter'), AD\_INSERTER\_NAME, '<a href="https://wordpress.org/support/update-php/" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>'), |
| [3512](#L3512) | '</p></div>'; |
| [3513](#L3513) | } |
| [3514](#L3514) |  |
| [3515](#L3515) | if (defined ('AI\_SETTINGS\_ERROR')) { |
| [3516](#L3516) | echo '<div class="notice notice-error is-dismissible" style="margin: 5px 15px 2px 0px;"><p>', |
| [3517](#L3517) | /\* translators: 1: Ad Inserter, 2, 3: HTML tags \*/ |
| [3518](#L3518) | \_e ('Error: plugin settings corrupt', 'ad-inserter'), |
| [3519](#L3519) | '</p></div>'; |
| [3520](#L3520) | } |
| [3521](#L3521) |  |
| [3522](#L3522) | } |
| [3523](#L3523) | } |
| [3524](#L3524) |  |
| [3525](#L3525) | function ai\_plugin\_action\_links ($links) { |
| [3526](#L3526) | if (is\_multisite() && !is\_main\_site () && !multisite\_settings\_page\_enabled ()) return $links; |
| [3527](#L3527) |  |
| [3528](#L3528) | $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [3529](#L3529) | $settings\_link = '<a href="'.admin\_url ($settings\_page).'">'.\_x('Settings', 'Menu item', 'ad-inserter') . '</a>'; |
| [3530](#L3530) | array\_unshift ($links, $settings\_link); |
| [3531](#L3531) | return $links; |
| [3532](#L3532) | } |
| [3533](#L3533) |  |
| [3534](#L3534) | function ai\_after\_plugin\_row\_1 ($plugin\_file, $plugin\_data, $status) { |
| [3535](#L3535) | global $ad\_inserter\_globals; |
| [3536](#L3536) |  |
| [3537](#L3537) | if (ai\_ampforwp\_check\_disabled ()) { |
| [3538](#L3538) | $plugins\_css = "\n" . '<style> |
| [3539](#L3539) | .plugins tr.active[data-slug=ad-inserter] th, .plugins tr.active[data-slug=ad-inserter] td {box-shadow: none;} |
| [3540](#L3540) | </style>'."\n"; |
| [3541](#L3541) |  |
| [3542](#L3542) | echo $plugins\_css; |
| [3543](#L3543) | echo '<tr class="plugin-update-tr active'; |
| [3544](#L3544) | if (isset ($plugin\_data ['update']) && $plugin\_data ['update']) echo ' update'; |
| [3545](#L3545) | echo '"><td colspan="4" class="plugin-update colspanchange ai-message"><div class="update-message notice inline notice-warning notice-alt"><p> ', |
| [3546](#L3546) | /\* translators: 1: AMPforWP Plugin Manager, 2: Ad Inserter, 3, 4: HTML tags \*/ |
| [3547](#L3547) | sprintf (\_\_('Warning: %1$s %3$s disabled %4$s %2$s on AMP pages.', 'ad-inserter'), 'AMPforWP Plugin Manager', AD\_INSERTER\_NAME, '<a href="https://adinserter.pro/documentation/amp-pages#ampforwp" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>'), |
| [3548](#L3548) | '</p></div></td></tr>'; |
| [3549](#L3549) | } |
| [3550](#L3550) | } |
| [3551](#L3551) |  |
| [3552](#L3552) | function ai\_set\_plugin\_meta ($links, $file) { |
| [3553](#L3553) | if ($file == plugin\_basename (\_\_FILE\_\_)) { |
| [3554](#L3554) | if (is\_multisite() && !is\_main\_site ()) { |
| [3555](#L3555) | foreach ($links as $index => $link) { |
| [3556](#L3556) | if (stripos ($link, "update") !== false) unset ($links [$index]); |
| [3557](#L3557) | } |
| [3558](#L3558) | } |
| [3559](#L3559) |  |
| [3560](#L3560) | if (!is\_multisite () || is\_main\_site ()) { |
| [3561](#L3561) | $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [3562](#L3562) | $inserted = '<a href="'.admin\_url ($settings\_page . '&ai-safe-mode').'" title="'.\_\_('Load settings page in safe mode to avoid collisions with other plugins or theme', 'ad-inserter').'">' . \_\_('Safe mode', 'ad-inserter') . '</a>'; |
| [3563](#L3563) | array\_splice ($links, 4, 0, $inserted); |
| [3564](#L3564) |  |
| [3565](#L3565) | if (function\_exists ('ai\_set\_plugin\_meta\_2')) { |
| [3566](#L3566) | ai\_set\_plugin\_meta\_2 ($links); |
| [3567](#L3567) | } |
| [3568](#L3568) | elseif (file\_exists (AD\_INSERTER\_PLUGIN\_DIR.'includes/js/ai-load.js')) { |
| [3569](#L3569) | $inserted = 'WP'; |
| [3570](#L3570) | array\_splice ($links, 1, 0, $inserted); |
| [3571](#L3571) | } |
| [3572](#L3572) | } |
| [3573](#L3573) | } |
| [3574](#L3574) | return $links; |
| [3575](#L3575) | } |
| [3576](#L3576) |  |
| [3577](#L3577) |  |
| [3578](#L3578) | function current\_user\_role ($user\_role\_name = "") { |
| [3579](#L3579) | $role\_values = array ("super-admin" => 6, "administrator" => 5, "editor" => 4, "author" => 3, "contributor" => 2, "subscriber" => 1); |
| [3580](#L3580) | global $wp\_roles; |
| [3581](#L3581) |  |
| [3582](#L3582) | if ($user\_role\_name != "") { |
| [3583](#L3583) | return isset ($role\_values [$user\_role\_name]) ? $role\_values [$user\_role\_name] : 0; |
| [3584](#L3584) | } |
| [3585](#L3585) |  |
| [3586](#L3586) | $user\_role = 0; |
| [3587](#L3587) | $current\_user = wp\_get\_current\_user(); |
| [3588](#L3588) | $roles = $current\_user->roles; |
| [3589](#L3589) |  |
| [3590](#L3590) | // Fix for empty roles |
| [3591](#L3591) | if (isset ($current\_user->caps) && count ($current\_user->caps) != 0) { |
| [3592](#L3592) | $caps = $current\_user->caps; |
| [3593](#L3593) | foreach ($role\_values as $role\_name => $role\_value) { |
| [3594](#L3594) | if (isset ($caps [$role\_name]) && $caps [$role\_name]) $roles []= $role\_name; |
| [3595](#L3595) | } |
| [3596](#L3596) | } |
| [3597](#L3597) |  |
| [3598](#L3598) | foreach ($roles as $role) { |
| [3599](#L3599) | $current\_user\_role = isset ($role\_values [$role]) ? $role\_values [$role] : 0; |
| [3600](#L3600) | if ($current\_user\_role > $user\_role) $user\_role = $current\_user\_role; |
| [3601](#L3601) | } |
| [3602](#L3602) |  |
| [3603](#L3603) | return $user\_role; |
| [3604](#L3604) | } |
| [3605](#L3605) |  |
| [3606](#L3606) |  |
| [3607](#L3607) | function ai\_current\_user\_role\_ok () { |
| [3608](#L3608) | return current\_user\_role () >= current\_user\_role (get\_minimum\_user\_role ()); |
| [3609](#L3609) | } |
| [3610](#L3610) |  |
| [3611](#L3611) |  |
| [3612](#L3612) | function ai\_add\_meta\_box\_hook() { |
| [3613](#L3613) | global $ai\_wp\_data, $block\_object; |
| [3614](#L3614) |  |
| [3615](#L3615) | if (!ai\_current\_user\_role\_ok ()) return; |
| [3616](#L3616) |  |
| [3617](#L3617) | if (is\_multisite() && !is\_main\_site () && !multisite\_exceptions\_enabled ()) return; |
| [3618](#L3618) |  |
| [3619](#L3619) | $exceptions\_posts = false; |
| [3620](#L3620) | $exceptions\_pages = false; |
| [3621](#L3621) | for ($block = 1; $block <= 96; $block ++) { |
| [3622](#L3622) | $obj = $block\_object [$block]; |
| [3623](#L3623) | if ($obj->get\_exceptions\_enabled ()) { |
| [3624](#L3624) | if ($obj->get\_display\_settings\_post ()) { |
| [3625](#L3625) | $exceptions\_posts = true; |
| [3626](#L3626) | } |
| [3627](#L3627) | if ($obj->get\_display\_settings\_page ()) { |
| [3628](#L3628) | $exceptions\_pages = true; |
| [3629](#L3629) | } |
| [3630](#L3630) | if ($exceptions\_posts && $exceptions\_pages) { |
| [3631](#L3631) | break; |
| [3632](#L3632) | } |
| [3633](#L3633) | } |
| [3634](#L3634) | } |
| [3635](#L3635) |  |
| [3636](#L3636) | $screens = array (); |
| [3637](#L3637) | if ($exceptions\_posts) { |
| [3638](#L3638) | $screens []= 'post'; |
| [3639](#L3639) | } |
| [3640](#L3640) | if ($exceptions\_pages) { |
| [3641](#L3641) | $screens []= 'page'; |
| [3642](#L3642) | } |
| [3643](#L3643) |  |
| [3644](#L3644) | if (empty ($screens)) return; |
| [3645](#L3645) |  |
| [3646](#L3646) | $args = array ( |
| [3647](#L3647) | 'public'    => true, |
| [3648](#L3648) | '\_builtin'  => false |
| [3649](#L3649) | ); |
| [3650](#L3650) | $custom\_post\_types = get\_post\_types ($args, 'names', 'and'); |
| [3651](#L3651) | $screens = array\_values (array\_merge ($screens, $custom\_post\_types)); |
| [3652](#L3652) |  |
| [3653](#L3653) | foreach ($screens as $screen) { |
| [3654](#L3654) | add\_meta\_box ( |
| [3655](#L3655) | 'adinserter\_sectionid', |
| [3656](#L3656) | // translators: %s: Ad Inserter |
| [3657](#L3657) | sprintf (\_x('%s Individual Exceptions', 'Meta box name', 'ad-inserter'), AD\_INSERTER\_NAME), |
| [3658](#L3658) | 'ai\_meta\_box\_callback', |
| [3659](#L3659) | $screen |
| [3660](#L3660) | ); |
| [3661](#L3661) | } |
| [3662](#L3662) | } |
| [3663](#L3663) |  |
| [3664](#L3664) | function ai\_meta\_box\_callback ($post) { |
| [3665](#L3665) | global $block\_object; |
| [3666](#L3666) |  |
| [3667](#L3667) | // Add an nonce field so we can check for it later. |
| [3668](#L3668) | wp\_nonce\_field ('adinserter\_meta\_box', 'adinserter\_meta\_box\_nonce'); |
| [3669](#L3669) |  |
| [3670](#L3670) | $post\_type        = get\_post\_type ($post); |
| [3671](#L3671) | $post\_type\_object = get\_post\_type\_object ($post\_type); |
| [3672](#L3672) | $page\_type\_name   = $post\_type\_object->labels->name; |
| [3673](#L3673) | $page\_type\_name1  = $post\_type\_object->labels->singular\_name; |
| [3674](#L3674) |  |
| [3675](#L3675) | /\* |
| [3676](#L3676) | \* Use get\_post\_meta() to retrieve an existing value |
| [3677](#L3677) | \* from the database and use the value for the form. |
| [3678](#L3678) | \*/ |
| [3679](#L3679) | $post\_meta = get\_post\_meta ($post->ID, '\_adinserter\_block\_exceptions', true); |
| [3680](#L3680) | $selected\_blocks = explode (",", $post\_meta); |
| [3681](#L3681) |  |
| [3682](#L3682) | ob\_start (); |
| [3683](#L3683) |  |
| [3684](#L3684) | echo '<table>'; |
| [3685](#L3685) | echo '<thead style="font-weight: bold;">'; |
| [3686](#L3686) | echo '  <td>', \_\_('Block', 'ad-inserter') . '</td>'; |
| [3687](#L3687) | echo '  <td style="padding: 0 10px 0 10px;">', \_\_('Name', 'ad-inserter') . '</td>'; |
| [3688](#L3688) | //    echo '  <td style="padding: 0 10px 0 10px;">', \_\_('Automatic insertion', 'ad-inserter') . '</td>'; |
| [3689](#L3689) |  |
| [3690](#L3690) | echo '  <td style="padding: 0 10px 0 10px;">', \_\_('Default insertion', 'ad-inserter') . '</td>'; |
| [3691](#L3691) | // translators: For this post or page |
| [3692](#L3692) | if ($post\_type == 'page') |
| [3693](#L3693) | echo '  <td style="padding: 0 10px 0 10px;">', \_x('For this', 'Page', 'ad-inserter'), ' ', $page\_type\_name1, '</td>'; else |
| [3694](#L3694) | echo '  <td style="padding: 0 10px 0 10px;">', \_x('For this', 'Post', 'ad-inserter'), ' ', $page\_type\_name1, '</td>'; |
| [3695](#L3695) |  |
| [3696](#L3696) | echo '</thead>'; |
| [3697](#L3697) | echo '<tbody>'; |
| [3698](#L3698) | $rows = 0; |
| [3699](#L3699) | for ($block = 1; $block <= 96; $block ++) { |
| [3700](#L3700) | $obj = $block\_object [$block]; |
| [3701](#L3701) |  |
| [3702](#L3702) | $exceptions\_enabled = $obj->get\_exceptions\_enabled (); |
| [3703](#L3703) | $exceptions\_function = $obj->get\_exceptions\_function (); |
| [3704](#L3704) |  |
| [3705](#L3705) | if ($post\_type == 'page') { |
| [3706](#L3706) | $page\_name1 = \_x('pages', 'Enabled/disabled on all', 'ad-inserter'); |
| [3707](#L3707) | $general\_enabled = $obj->get\_display\_settings\_page(); |
| [3708](#L3708) | } else { |
| [3709](#L3709) | $page\_name1 = \_x('posts', 'Enabled/disabled on all', 'ad-inserter'); |
| [3710](#L3710) | $general\_enabled  = $obj->get\_display\_settings\_post(); |
| [3711](#L3711) | } |
| [3712](#L3712) |  |
| [3713](#L3713) | if (!$general\_enabled || !$exceptions\_enabled) continue; |
| [3714](#L3714) |  |
| [3715](#L3715) | $individual\_option\_enabled  = $general\_enabled && $exceptions\_enabled; |
| [3716](#L3716) | $individual\_text\_enabled    = $exceptions\_function == AI\_DEFAULT\_INSERTION\_ENABLED; |
| [3717](#L3717) |  |
| [3718](#L3718) | if ($rows % 2 != 0) $background = "#F0F0F0"; else $background = "#FFF"; |
| [3719](#L3719) | echo '<tr style="background: ', $background, ';">'; |
| [3720](#L3720) | echo '  <td style="text-align: right; padding: 0 10px 0 0;">', $obj->number, '</td>'; |
| [3721](#L3721) |  |
| [3722](#L3722) | $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [3723](#L3723) | echo '  <td style="padding: 0 10px 0 10px;"><a href="', admin\_url ($settings\_page), '&start=' . (intval (($block - 1) / 16) \* 16 + 1), '&tab=', $block, '" style="text-decoration: none; box-shadow: 0 0 0;" target="\_blank">', $obj->get\_ad\_name(), '</a></td>'; |
| [3724](#L3724) | //    echo '  <td style="padding: 0 10px 0 10px;">', $obj->get\_automatic\_insertion\_text(), '</td>'; |
| [3725](#L3725) | echo '  <td style="padding: 0 10px 0 10px; text-align: left;">'; |
| [3726](#L3726) |  |
| [3727](#L3727) | if ($individual\_option\_enabled) { |
| [3728](#L3728) | if ($individual\_text\_enabled) echo \_\_('Enabled', 'ad-inserter'); else echo \_\_('Disabled', 'ad-inserter'); |
| [3729](#L3729) | } else { |
| [3730](#L3730) | if ($general\_enabled) echo \_\_('No individual exceptions', 'ad-inserter'); else |
| [3731](#L3731) | // translators: Not enabled for pages or posts |
| [3732](#L3732) | echo \_\_('Not enabled for', 'ad-inserter') . ' ', $page\_name1; |
| [3733](#L3733) | } |
| [3734](#L3734) | echo '  </td>'; |
| [3735](#L3735) | echo '  <td style="padding: 0 10px 0 10px; text-align: left;">'; |
| [3736](#L3736) |  |
| [3737](#L3737) | if ($individual\_option\_enabled) { |
| [3738](#L3738) | echo '<input type="checkbox" style="border-radius: 5px;" name="adinserter\_selected\_block\_', $block, '" id="ai-selected-block-', $block, '" value="1"', in\_array ($block, $selected\_blocks) ? ' checked': '', ' />'; |
| [3739](#L3739) | echo '<label for="ai-selected-block-', $block, '">'; |
| [3740](#L3740) | if (!$individual\_text\_enabled) echo \_\_('Enabled', 'ad-inserter'); else echo \_\_('Disabled', 'ad-inserter'); |
| [3741](#L3741) | echo '</label>'; |
| [3742](#L3742) | } else { |
| [3743](#L3743) | if (in\_array ($block, $selected\_blocks)) { |
| [3744](#L3744) | echo '<span style="margin-left: 6px;">&bull;</span>'; |
| [3745](#L3745) | } |
| [3746](#L3746) | } |
| [3747](#L3747) |  |
| [3748](#L3748) | echo '  </td>'; |
| [3749](#L3749) | echo '</tr>'; |
| [3750](#L3750) | $rows ++; |
| [3751](#L3751) | } |
| [3752](#L3752) |  |
| [3753](#L3753) | echo '</tbody>'; |
| [3754](#L3754) | echo '</table>'; |
| [3755](#L3755) |  |
| [3756](#L3756) | $exceptions\_table = ob\_get\_clean (); |
| [3757](#L3757) |  |
| [3758](#L3758) | if ($rows == 0) { |
| [3759](#L3759) | // translators: No individual exceptions enabled for pages or posts |
| [3760](#L3760) | echo '<p><strong>', \_\_('No block has individual exceptions enabled', 'ad-inserter'), '</strong></p>'; |
| [3761](#L3761) | } else echo $exceptions\_table; |
| [3762](#L3762) |  |
| [3763](#L3763) | $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [3764](#L3764) |  |
| [3765](#L3765) | // translators: 1: Ad Inserter Settings (page), 2: Tag / Archive pages |
| [3766](#L3766) | echo '<p>',                                                                                                                      //; |
| [3767](#L3767) | sprintf (\_\_('Default insertion can be configured for each block on %1$s page - button next to %2$s checkbox.', 'ad-inserter'), |
| [3768](#L3768) | // translators: %s: Ad Inserter |
| [3769](#L3769) | '<a href="' . admin\_url ($settings\_page) . '" style="text-decoration: none; box-shadow: 0 0 0;" target="\_blank">' . sprintf (\_\_('%s Settings', 'ad-inserter'), AD\_INSERTER\_NAME) . '</a>', |
| [3770](#L3770) | '<strong>'.\_\_('Tag / Archive pages', 'ad-inserter').'</strong>'), '<br />', |
| [3771](#L3771) |  |
| [3772](#L3772) | \_\_('When individual exceptions for a block are enabled, a checkbox will be listed here to change default insertion for this post or page.', 'ad-inserter'), '<br />', |
| [3773](#L3773) | \_\_('This way you can individually enable or disable blocks on specific posts or pages.', 'ad-inserter'), '<br />'; |
| [3774](#L3774) |  |
| [3775](#L3775) | printf (\_\_('For more information check page %s', 'ad-inserter'), |
| [3776](#L3776) | // translators: Ad Inserter Exceptions documentation page |
| [3777](#L3777) | '<a href="https://adinserter.pro/documentation/individual-post-and-page-exceptions" style="text-decoration: none; box-shadow: 0 0 0;" target="\_blank">Ad Inserter ' . \_\_('Individual Exceptions', 'ad-inserter') . '</a>.</p>'); |
| [3778](#L3778) | } |
| [3779](#L3779) |  |
| [3780](#L3780) | function ai\_save\_meta\_box\_data\_hook ($post\_id) { |
| [3781](#L3781) | // Check if our nonce is set. |
| [3782](#L3782) | if (!isset ($\_POST ['adinserter\_meta\_box\_nonce'])) return; |
| [3783](#L3783) |  |
| [3784](#L3784) | // Verify that the nonce is valid. |
| [3785](#L3785) | if (!wp\_verify\_nonce ($\_POST ['adinserter\_meta\_box\_nonce'], 'adinserter\_meta\_box')) return; |
| [3786](#L3786) |  |
| [3787](#L3787) | // If this is an autosave, our form has not been submitted, so we don't want to do anything. |
| [3788](#L3788) | if (defined ('DOING\_AUTOSAVE') && DOING\_AUTOSAVE) return; |
| [3789](#L3789) |  |
| [3790](#L3790) | // Check the user's permissions. |
| [3791](#L3791) | if (isset ($\_POST ['post\_type'])) { |
| [3792](#L3792) | if ($\_POST ['post\_type'] == 'page') { |
| [3793](#L3793) | if (!current\_user\_can ('edit\_page', $post\_id)) return; |
| [3794](#L3794) | } else { |
| [3795](#L3795) | if (!current\_user\_can ('edit\_post', $post\_id)) return; |
| [3796](#L3796) | } |
| [3797](#L3797) | } |
| [3798](#L3798) |  |
| [3799](#L3799) | /\* OK, it's safe for us to save the data now. \*/ |
| [3800](#L3800) |  |
| [3801](#L3801) | $selected = array (); |
| [3802](#L3802) | for ($block = 1; $block <= 96; $block ++) { |
| [3803](#L3803) | $option\_name = 'adinserter\_selected\_block\_' . $block; |
| [3804](#L3804) | if (isset ($\_POST [$option\_name]) && $\_POST [$option\_name]) $selected []= $block; |
| [3805](#L3805) | } |
| [3806](#L3806) |  |
| [3807](#L3807) | if (!empty ($selected)) { |
| [3808](#L3808) | // Update the meta field in the database. |
| [3809](#L3809) | update\_post\_meta ($post\_id, '\_adinserter\_block\_exceptions', implode (",", $selected)); |
| [3810](#L3810) | } else delete\_post\_meta ($post\_id, '\_adinserter\_block\_exceptions'); |
| [3811](#L3811) | } |
| [3812](#L3812) |  |
| [3813](#L3813) | function ai\_widgets\_init\_hook () { |
| [3814](#L3814) | if (is\_multisite() && !is\_main\_site () && !multisite\_widgets\_enabled ()) return; |
| [3815](#L3815) | register\_widget ('ai\_widget'); // AI widget PHP class name |
| [3816](#L3816) | } |
| [3817](#L3817) |  |
| [3818](#L3818) | function get\_page\_type\_debug\_info ($text = '') { |
| [3819](#L3819) | global $ai\_wp\_data; |
| [3820](#L3820) |  |
| [3821](#L3821) | switch ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE]) { |
| [3822](#L3822) | case AI\_PT\_STATIC: |
| [3823](#L3823) | $page\_type = \_\_('STATIC PAGE', 'ad-inserter'); |
| [3824](#L3824) | break; |
| [3825](#L3825) | case AI\_PT\_POST: |
| [3826](#L3826) | $page\_type = \_\_('POST', 'ad-inserter'); |
| [3827](#L3827) | break; |
| [3828](#L3828) | case AI\_PT\_HOMEPAGE: |
| [3829](#L3829) | $page\_type = \_\_('HOMEPAGE', 'ad-inserter'); |
| [3830](#L3830) | break; |
| [3831](#L3831) | case AI\_PT\_CATEGORY: |
| [3832](#L3832) | $page\_type = \_\_('CATEGORY PAGE', 'ad-inserter'); |
| [3833](#L3833) | break; |
| [3834](#L3834) | case AI\_PT\_SEARCH: |
| [3835](#L3835) | $page\_type = \_\_('SEARCH PAGE', 'ad-inserter'); |
| [3836](#L3836) | break; |
| [3837](#L3837) | case AI\_PT\_ARCHIVE: |
| [3838](#L3838) | $page\_type = \_\_('ARCHIVE PAGE', 'ad-inserter'); |
| [3839](#L3839) | break; |
| [3840](#L3840) | case AI\_PT\_404: |
| [3841](#L3841) | $page\_type = \_\_('ERROR 404 PAGE', 'ad-inserter'); |
| [3842](#L3842) | break; |
| [3843](#L3843) | case AI\_PT\_AJAX: |
| [3844](#L3844) | $page\_type = \_\_('AJAX CALL', 'ad-inserter'); |
| [3845](#L3845) | break; |
| [3846](#L3846) | case AI\_PT\_REST: |
| [3847](#L3847) | $page\_type = \_\_('REST CALL', 'ad-inserter'); |
| [3848](#L3848) | break; |
| [3849](#L3849) | default: |
| [3850](#L3850) | $page\_type = \_\_('UNKNOWN PAGE TYPE', 'ad-inserter'); |
| [3851](#L3851) | break; |
| [3852](#L3852) | } |
| [3853](#L3853) | $class = AI\_DEBUG\_PAGE\_TYPE\_CLASS; |
| [3854](#L3854) |  |
| [3855](#L3855) | $page\_type = "<section class='$class'>".$text.$page\_type."</section>"; |
| [3856](#L3856) |  |
| [3857](#L3857) | return $page\_type; |
| [3858](#L3858) | } |
| [3859](#L3859) |  |
| [3860](#L3860) | function get\_adb\_status\_debug\_info () { |
| [3861](#L3861) | global $ai\_wp\_data; |
| [3862](#L3862) |  |
| [3863](#L3863) | $page\_type = ''; |
| [3864](#L3864) |  |
| [3865](#L3865) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [3866](#L3866) | if ($ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [3867](#L3867) | $title  = \_\_('Click to delete ad blocking detection cokies', 'ad-inserter'); |
| [3868](#L3868) | $status = \_\_('AD BLOCKING STATUS UNKNOWN', 'ad-inserter'); |
| [3869](#L3869) |  |
| [3870](#L3870) | $events = ''; |
| [3871](#L3871) | if (isset ($\_GET ['ai-debug-adb-events']) && $\_GET ['ai-debug-adb-events']) { |
| [3872](#L3872) | $events = "<span id='ai-adb-events'></span>"; |
| [3873](#L3873) | } |
| [3874](#L3874) | $page\_type = "<section id='ai-adb-bar' class='".AI\_DEBUG\_STATUS\_CLASS.' '.AI\_DEBUG\_ADB\_CLASS."' title='$title'><span id='ai-adb-status'>$status</span>$events</section>"; |
| [3875](#L3875) | } |
| [3876](#L3876) | } |
| [3877](#L3877) |  |
| [3878](#L3878) | return $page\_type; |
| [3879](#L3879) | } |
| [3880](#L3880) |  |
| [3881](#L3881) |  |
| [3882](#L3882) | function ai\_header\_noindex () { |
| [3883](#L3883) | global $ai\_wp\_data; |
| [3884](#L3884) |  |
| [3885](#L3885) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0 || $ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3886](#L3886) | echo '<meta name="robots" content="noindex">'; |
| [3887](#L3887) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) { |
| [3888](#L3888) | echo ' <!-- ', AD\_INSERTER\_NAME, ' debugging enabled (', substr ('00000000' . strtoupper (decbin ($ai\_wp\_data [AI\_WP\_DEBUGGING])), - 8), ') -->'; |
| [3889](#L3889) | } |
| [3890](#L3890) | echo "\n"; |
| [3891](#L3891) | } |
| [3892](#L3892) | } |
| [3893](#L3893) |  |
| [3894](#L3894) | function get\_code\_debug\_block ($name, $message, $right\_text, $code, $inserted\_code, $javascript = false) { |
| [3895](#L3895) | if (strpos ($code, 'enable\_page\_level\_ads') !== false) |
| [3896](#L3896) | // translators: %s: AdSense Auto Ads |
| [3897](#L3897) | $message = sprintf (\_\_('Code for %s detected - Code will automatically insert AdSense ads at optimal positions', 'ad-inserter') . ' ', |
| [3898](#L3898) | '<a style="text-decoration: none; color: #fff; font-weight: bold; box-shadow: none;" href="https://adinserter.pro/documentation/adsense-ads#auto-ads" target="\_blank">AdSense Auto Ads</a>'); |
| [3899](#L3899) |  |
| [3900](#L3900) | $debug\_script = new ai\_block\_labels ('ai-debug-script'); |
| [3901](#L3901) | $debug\_block\_start = $debug\_script->block\_start (); |
| [3902](#L3902) | $debug\_block\_start .= $debug\_script->bar ($name, '', $message, $right\_text); |
| [3903](#L3903) | if ($javascript) $debug\_block\_start = str\_replace (array ('"', "\n", "\r"), array ("'", "\\n", ''), $debug\_block\_start); |
| [3904](#L3904) |  |
| [3905](#L3905) | $debug\_block\_end = $debug\_script->block\_end (); |
| [3906](#L3906) | if ($javascript) $debug\_block\_end = str\_replace (array ('"', "\n", "\r"), array ("'", "\\n", ''), $debug\_block\_end); |
| [3907](#L3907) |  |
| [3908](#L3908) | $html\_code = htmlspecialchars ($code); |
| [3909](#L3909) | if ($javascript) $html\_code = str\_replace (array ("\n", "\r"), array ("\\n", ''), $html\_code); |
| [3910](#L3910) |  |
| [3911](#L3911) | $html\_inserted\_code = htmlspecialchars ($inserted\_code); |
| [3912](#L3912) | if ($javascript) $html\_inserted\_code = str\_replace (array ("\n", "\r"), array ("\\n", ''), $html\_inserted\_code); |
| [3913](#L3913) |  |
| [3914](#L3914) | return $debug\_block\_start . "<pre class='ai-debug-code ai-code-org'>" . $html\_code . "</pre><pre class='ai-debug-code ai-code-inserted'>" . $html\_inserted\_code . "</pre><div style='clear: both;'></div>" . $debug\_block\_end; |
| [3915](#L3915) | } |
| [3916](#L3916) |  |
| [3917](#L3917) | function ai\_http\_header () { |
| [3918](#L3918) | global $block\_object, $ai\_wp\_data; |
| [3919](#L3919) |  |
| [3920](#L3920) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_HTTP\_HEADER; |
| [3921](#L3921) |  |
| [3922](#L3922) | $obj = $block\_object [AI\_HEADER\_OPTION\_NAME]; |
| [3923](#L3923) | $obj->clear\_code\_cache (); |
| [3924](#L3924) |  |
| [3925](#L3925) | if ($obj->get\_enable\_manual ()) { |
| [3926](#L3926) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_404 || $obj->get\_enable\_404()) { |
| [3927](#L3927) |  |
| [3928](#L3928) | // Prevent group activation when processing code for HTTP headers |
| [3929](#L3929) | $ai\_wp\_data [AI\_NO\_GROUP\_ACTIVATION] = true; |
| [3930](#L3930) | $processed\_code = do\_shortcode ($obj->ai\_getCode ()); |
| [3931](#L3931) | unset ($ai\_wp\_data [AI\_NO\_GROUP\_ACTIVATION]); |
| [3932](#L3932) |  |
| [3933](#L3933) | if (strpos ($processed\_code, AD\_HTTP\_SEPARATOR) !== false) { |
| [3934](#L3934) | $codes = explode (AD\_HTTP\_SEPARATOR, $processed\_code); |
| [3935](#L3935) | $processed\_code = $codes [0]; |
| [3936](#L3936) | } else $processed\_code = ''; |
| [3937](#L3937) |  |
| [3938](#L3938) | $header\_lines = explode ("\n", $processed\_code); |
| [3939](#L3939) |  |
| [3940](#L3940) | foreach ($header\_lines as $header\_line) { |
| [3941](#L3941) | if (trim ($header\_line) != '' && strpos ($header\_line, ':') !== false) { |
| [3942](#L3942) | header (trim ($header\_line)); |
| [3943](#L3943) | } |
| [3944](#L3944) | } |
| [3945](#L3945) | } |
| [3946](#L3946) | } |
| [3947](#L3947) | } |
| [3948](#L3948) |  |
| [3949](#L3949) | function ai\_wp\_head\_hook () { |
| [3950](#L3950) | global $block\_object, $ai\_wp\_data, $ai\_total\_plugin\_time/\*, $ai\_front\_translations\*/; |
| [3951](#L3951) |  |
| [3952](#L3952) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [3953](#L3953) | ai\_log ("HEAD HOOK START"); |
| [3954](#L3954) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [3955](#L3955) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [3956](#L3956) | $start\_time = microtime (true); |
| [3957](#L3957) | } |
| [3958](#L3958) |  |
| [3959](#L3959) | $ai\_wp\_data [AI\_HEAD] = true; |
| [3960](#L3960) |  |
| [3961](#L3961) | //  $adb\_code = defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION && $ai\_wp\_data [AI\_ADB\_DETECTION] && !isset ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_DISABLED]); |
| [3962](#L3962) |  |
| [3963](#L3963) | if (defined ('AI\_BUFFERING')) { |
| [3964](#L3964) | if (get\_output\_buffering ()) { |
| [3965](#L3965) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [3966](#L3966) | ai\_buffering\_start (); |
| [3967](#L3967) | } |
| [3968](#L3968) | } |
| [3969](#L3969) | } |
| [3970](#L3970) |  |
| [3971](#L3971) | if (!get\_disable\_js\_code () && |
| [3972](#L3972) | (get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) && |
| [3973](#L3973) | (($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0 || (isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0))) { |
| [3974](#L3974) |  |
| [3975](#L3975) | echo '<!--noptimize-->', "\n"; |
| [3976](#L3976) | //    if ($adb\_code) { |
| [3977](#L3977) | //      echo "<script>\n", ai\_replace\_prefix (ai\_get\_js ('ai-errors-head', false)), "</script>\n"; |
| [3978](#L3978) | //    } else { |
| [3979](#L3979) | echo "<script>\n", ai\_get\_js ('ai-errors-head', false), "</script>\n"; |
| [3980](#L3980) | //      } |
| [3981](#L3981) | echo '<!--/noptimize-->', "\n"; |
| [3982](#L3982) | } |
| [3983](#L3983) |  |
| [3984](#L3984) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_NONE; |
| [3985](#L3985) |  |
| [3986](#L3986) | ai\_header\_noindex (); |
| [3987](#L3987) |  |
| [3988](#L3988) | add\_head\_inline\_styles (); |
| [3989](#L3989) |  |
| [3990](#L3990) | $header\_code = ''; |
| [3991](#L3991) |  |
| [3992](#L3992) | $header = $block\_object [AI\_HEADER\_OPTION\_NAME]; |
| [3993](#L3993) |  |
| [3994](#L3994) | if ($header->get\_enable\_manual ()) { |
| [3995](#L3995) | if (!$header->get\_debug\_disable\_insertion () && !get\_disable\_header\_code ()) { |
| [3996](#L3996) | if ($header->check\_server\_side\_detection ()) { |
| [3997](#L3997) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_404 || $header->get\_enable\_404()) { |
| [3998](#L3998) |  |
| [3999](#L3999) | $processed\_code = do\_shortcode ($header->ai\_getCode ()); |
| [4000](#L4000) |  |
| [4001](#L4001) | if (strpos ($processed\_code, AD\_HTTP\_SEPARATOR) !== false) { |
| [4002](#L4002) | $codes = explode (AD\_HTTP\_SEPARATOR, $processed\_code); |
| [4003](#L4003) | $processed\_code = ltrim ($codes [1]); |
| [4004](#L4004) | } |
| [4005](#L4005) |  |
| [4006](#L4006) | if (strpos ($processed\_code, AD\_AMP\_SEPARATOR) !== false) { |
| [4007](#L4007) | $codes = explode (AD\_AMP\_SEPARATOR, $processed\_code); |
| [4008](#L4008) | $processed\_code = $codes [0]; |
| [4009](#L4009) | } elseif ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) $processed\_code = ''; |
| [4010](#L4010) |  |
| [4011](#L4011) | $header\_code = $processed\_code; |
| [4012](#L4012) |  |
| [4013](#L4013) | echo $processed\_code; |
| [4014](#L4014) |  |
| [4015](#L4015) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4016](#L4016) | if (strlen ($processed\_code) != 0) |
| [4017](#L4017) | ai\_log ("HEAD CODE: " . strlen ($processed\_code) . ' characters'); |
| [4018](#L4018) | } |
| [4019](#L4019) | } |
| [4020](#L4020) | } |
| [4021](#L4021) | } else { |
| [4022](#L4022) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4023](#L4023) | ai\_log ('HEAD CODE DEBUG NO INSERTION'); |
| [4024](#L4024) | } |
| [4025](#L4025) | } |
| [4026](#L4026) | } |
| [4027](#L4027) |  |
| [4028](#L4028) | if (defined ('AI\_BUFFERING')) { |
| [4029](#L4029) | if (get\_output\_buffering () && !get\_disable\_header\_code ()) { |
| [4030](#L4030) | $ai\_head\_codes = "<!--[AI\_HEAD\_CODES]-->"; |
| [4031](#L4031) | echo $ai\_head\_codes; |
| [4032](#L4032) | //      $header\_code .= $ai\_head\_codes; // Don't count this code |
| [4033](#L4033) | } |
| [4034](#L4034) | } |
| [4035](#L4035) |  |
| [4036](#L4036) | if (!$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4037](#L4037) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0 && isset ($\_GET ['ai-debug-code']) && !defined ('AI\_DEBUGGING\_DEMO')) { |
| [4038](#L4038) | if (is\_numeric ($\_GET ['ai-debug-code']) && $\_GET ['ai-debug-code'] >= 1 && $\_GET ['ai-debug-code'] <= 96) { |
| [4039](#L4039) | $obj = $block\_object [(int) $\_GET ['ai-debug-code']]; |
| [4040](#L4040) | $block\_name = $obj->number . ' &nbsp; ' . $obj->get\_ad\_name (); |
| [4041](#L4041) | if (!$header->get\_debug\_disable\_insertion ()) { |
| [4042](#L4042) | $ai\_wp\_debugging = $ai\_wp\_data [AI\_WP\_DEBUGGING]; |
| [4043](#L4043) | $ai\_wp\_data [AI\_WP\_DEBUGGING] = 0; |
| [4044](#L4044) | $code\_for\_insertion = $obj->get\_code\_for\_insertion (); |
| [4045](#L4045) | $ai\_wp\_data [AI\_WP\_DEBUGGING] = $ai\_wp\_debugging; |
| [4046](#L4046) | } else $code\_for\_insertion = ''; |
| [4047](#L4047) |  |
| [4048](#L4048) | //        $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "  jQuery('body').prepend (\"" . get\_code\_debug\_block (' ' . $block\_name, '', \_\_('Code for insertion', 'ad-inserter') . ' ' . strlen ($code\_for\_insertion) . ' ' . \_n('character', 'characters', strlen ($code\_for\_insertion), 'ad-inserter') . ' ', $obj->ai\_getCode (), $code\_for\_insertion, true) . "\"); |
| [4049](#L4049) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "document.querySelector ('body').insertAdjacentHTML ('afterbegin', \"" . get\_code\_debug\_block (' ' . $block\_name, '', \_\_('Code for insertion', 'ad-inserter') . ' ' . strlen ($code\_for\_insertion) . ' ' . \_n('character', 'characters', strlen ($code\_for\_insertion), 'ad-inserter') . ' ', $obj->ai\_getCode (), $code\_for\_insertion, true) . "\"); |
| [4050](#L4050) | "; |
| [4051](#L4051) | } |
| [4052](#L4052) | } |
| [4053](#L4053) |  |
| [4054](#L4054) | if (!get\_disable\_js\_code () && $ai\_wp\_data [AI\_IFRAMES]) { |
| [4055](#L4055) | echo "<script>\n", ai\_get\_js ('ai-iframes', false), "</script>\n"; |
| [4056](#L4056) | } |
| [4057](#L4057) |  |
| [4058](#L4058) | if (!ai\_inline\_js () /\*&& $ai\_wp\_data [AI\_IFRAMES]\*/) { |
| [4059](#L4059) | echo "<script>\n", ai\_get\_js ('ai-wait-functions', false), "</script>\n"; |
| [4060](#L4060) | } |
| [4061](#L4061) |  |
| [4062](#L4062) | if (!get\_disable\_js\_code () && ($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0) { |
| [4063](#L4063) | //      $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= '  setTimeout (function(){jQuery(\'body\').prepend ("' . get\_page\_type\_debug\_info () . '");}, 1); |
| [4064](#L4064) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= 'setTimeout (function(){document.querySelector (\'body\').insertAdjacentHTML (\'afterbegin\', "' . get\_page\_type\_debug\_info () . '");}, 1); |
| [4065](#L4065) | '; |
| [4066](#L4066) | } |
| [4067](#L4067) |  |
| [4068](#L4068) | if (!get\_disable\_header\_code () && isset ($\_GET ['ai-debug-code']) && !defined ('AI\_DEBUGGING\_DEMO')) { |
| [4069](#L4069) | //      $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "  jQuery('body').prepend (\"" . get\_code\_debug\_block (' ' . \_\_('Header code', 'ad-inserter') . ' ' . ($header->get\_enable\_manual () ? '' : ' ' . \_x('DISABLED', 'Header code', 'ad-inserter')), '&lt;head&gt;...&lt;/head&gt;', strlen ($header\_code) . ' ' . \_n('character inserted', 'characters inserted', strlen ($header\_code), 'ad-inserter') . ' ', $header->ai\_getCode (), $header\_code, true) . "\"); |
| [4070](#L4070) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "document.querySelector ('body').insertAdjacentHTML ('afterbegin', \"" . get\_code\_debug\_block (' ' . \_\_('Header code', 'ad-inserter') . ' ' . ($header->get\_enable\_manual () ? '' : ' ' . \_x('DISABLED', 'Header code', 'ad-inserter')), '&lt;head&gt;...&lt;/head&gt;', strlen ($header\_code) . ' ' . \_n('character inserted', 'characters inserted', strlen ($header\_code), 'ad-inserter') . ' ', $header->ai\_getCode (), $header\_code, true) . "\"); |
| [4071](#L4071) | "; |
| [4072](#L4072) | } |
| [4073](#L4073) | } |
| [4074](#L4074) |  |
| [4075](#L4075) |  |
| [4076](#L4076) |  |
| [4077](#L4077) | // After Header code info |
| [4078](#L4078) | if (!$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4079](#L4079) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [4080](#L4080) | // No scripts on AMP pages |
| [4081](#L4081) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_AD\_BLOCKING\_STATUS | AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0 && $ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [4082](#L4082) | //        $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "  jQuery('body').prepend (\"" . get\_adb\_status\_debug\_info () . "\"); |
| [4083](#L4083) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "document.querySelector ('body').insertAdjacentHTML ('afterbegin', \"" . get\_adb\_status\_debug\_info () . "\"); |
| [4084](#L4084) | "; |
| [4085](#L4085) | } |
| [4086](#L4086) | } |
| [4087](#L4087) |  |
| [4088](#L4088) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_AD\_BLOCKING\_STATUS | AI\_DEBUG\_BLOCKS)) != 0) { |
| [4089](#L4089) | //      $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "  jQuery('body').prepend (\"<section id='ai-iab-tcf-bar' class='".AI\_DEBUG\_STATUS\_CLASS."' style='cursor: pointer; display: none;' title='". \_\_('Click to delete the cookie for the consents', 'ad-inserter') ."'><span id='ai-iab-tcf-status'>IAB TCF 2.0</span></section>\"); |
| [4090](#L4090) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "document.querySelector ('body').insertAdjacentHTML ('afterbegin', \"<section id='ai-iab-tcf-bar' class='".AI\_DEBUG\_STATUS\_CLASS."' style='cursor: pointer; display: none;' title='". \_\_('Click to delete the cookie for the consents', 'ad-inserter') ."'><span id='ai-iab-tcf-status'>IAB TCF 2.0</span></section>\"); |
| [4091](#L4091) | "; |
| [4092](#L4092) |  |
| [4093](#L4093) | if (!$ai\_wp\_data [AI\_UNFILTERED\_HTML]) { |
| [4094](#L4094) | //        $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "  jQuery('body').prepend (\"<section class='".AI\_DEBUG\_STATUS\_CLASS." status-error'>".\_\_('UNFILTERED HTML DISABLED', 'ad-inserter')."</section>\"); |
| [4095](#L4095) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= "document.querySelector ('body').insertAdjacentHTML ('afterbegin', \"<section class='".AI\_DEBUG\_STATUS\_CLASS." status-error'>".\_\_('UNFILTERED HTML DISABLED', 'ad-inserter')."</section>\"); |
| [4096](#L4096) | "; |
| [4097](#L4097) | } |
| [4098](#L4098) | } |
| [4099](#L4099) |  |
| [4100](#L4100) | } |
| [4101](#L4101) |  |
| [4102](#L4102) | //  if (!get\_disable\_js\_code () && $ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4103](#L4103) | //    echo '<script>', "\n", ai\_front\_translations\_code (), '</script>', "\n"; |
| [4104](#L4104) | //  } |
| [4105](#L4105) |  |
| [4106](#L4106) | $ai\_wp\_data [AI\_HEAD] = false; |
| [4107](#L4107) |  |
| [4108](#L4108) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4109](#L4109) | if (!$ai\_processing\_time\_active) { |
| [4110](#L4110) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [4111](#L4111) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [4112](#L4112) | } |
| [4113](#L4113) | ai\_log ("HEAD HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [4114](#L4114) | } |
| [4115](#L4115) | } |
| [4116](#L4116) |  |
| [4117](#L4117) | function ai\_amp\_head\_hook () { |
| [4118](#L4118) | global $block\_object, $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [4119](#L4119) |  |
| [4120](#L4120) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4121](#L4121) | ai\_log ("AMP HEAD HOOK START"); |
| [4122](#L4122) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [4123](#L4123) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [4124](#L4124) | $start\_time = microtime (true); |
| [4125](#L4125) | } |
| [4126](#L4126) |  |
| [4127](#L4127) | $ai\_wp\_data [AI\_HEAD] = true; |
| [4128](#L4128) |  |
| [4129](#L4129) | if (defined ('AI\_BUFFERING')) { |
| [4130](#L4130) | if (get\_output\_buffering ()) { |
| [4131](#L4131) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX) { |
| [4132](#L4132) | ai\_buffering\_start (); |
| [4133](#L4133) | } |
| [4134](#L4134) | } |
| [4135](#L4135) | } |
| [4136](#L4136) |  |
| [4137](#L4137) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_NONE; |
| [4138](#L4138) |  |
| [4139](#L4139) | ai\_header\_noindex (); |
| [4140](#L4140) |  |
| [4141](#L4141) | $header = $block\_object [AI\_HEADER\_OPTION\_NAME]; |
| [4142](#L4142) |  |
| [4143](#L4143) | if ($header->get\_enable\_manual ()) { |
| [4144](#L4144) | if (!$header->get\_debug\_disable\_insertion () && !get\_disable\_header\_code ()) { |
| [4145](#L4145) | if ($header->check\_server\_side\_detection ()) { |
| [4146](#L4146) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_404 || $header->get\_enable\_404()) { |
| [4147](#L4147) | $processed\_code = do\_shortcode ($header->ai\_getCode ()); |
| [4148](#L4148) |  |
| [4149](#L4149) | if (strpos ($processed\_code, AD\_HTTP\_SEPARATOR) !== false) { |
| [4150](#L4150) | $codes = explode (AD\_HTTP\_SEPARATOR, $processed\_code); |
| [4151](#L4151) | $processed\_code = ltrim ($codes [1]); |
| [4152](#L4152) | } |
| [4153](#L4153) |  |
| [4154](#L4154) | //    ai\_log ("ai\_amp\_head\_hook "); |
| [4155](#L4155) |  |
| [4156](#L4156) | if (strpos ($processed\_code, AD\_AMP\_SEPARATOR) !== false) { |
| [4157](#L4157) | $codes = explode (AD\_AMP\_SEPARATOR, $processed\_code); |
| [4158](#L4158) | $processed\_code = ltrim ($codes [1]); |
| [4159](#L4159) | echo $processed\_code; |
| [4160](#L4160) |  |
| [4161](#L4161) | //    ai\_log ("ai\_amp\_head\_hook " . $processed\_code); |
| [4162](#L4162) |  |
| [4163](#L4163) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4164](#L4164) | if (strlen ($processed\_code) != 0) |
| [4165](#L4165) | ai\_log ("HEAD CODE: " . strlen ($processed\_code) . ' bytes'); |
| [4166](#L4166) | } |
| [4167](#L4167) | } |
| [4168](#L4168) | } |
| [4169](#L4169) | } |
| [4170](#L4170) | } |
| [4171](#L4171) | } |
| [4172](#L4172) |  |
| [4173](#L4173) | if (defined ('AI\_BUFFERING')) { |
| [4174](#L4174) | if (get\_output\_buffering () && !get\_disable\_header\_code ()) { |
| [4175](#L4175) | $ai\_head\_codes = "<!--[AI\_HEAD\_CODES]-->"; |
| [4176](#L4176) | echo $ai\_head\_codes; |
| [4177](#L4177) | } |
| [4178](#L4178) | } |
| [4179](#L4179) |  |
| [4180](#L4180) | $ai\_wp\_data [AI\_HEAD] = false; |
| [4181](#L4181) |  |
| [4182](#L4182) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4183](#L4183) | if (!$ai\_processing\_time\_active) { |
| [4184](#L4184) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [4185](#L4185) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [4186](#L4186) | } |
| [4187](#L4187) | ai\_log ("AMP HEAD HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [4188](#L4188) | } |
| [4189](#L4189) | } |
| [4190](#L4190) |  |
| [4191](#L4191) |  |
| [4192](#L4192) | function ai\_front\_translations\_code () { |
| [4193](#L4193) | global $ai\_front\_translations, $ai\_wp\_data; |
| [4194](#L4194) |  |
| [4195](#L4195) | //  if (get\_disable\_js\_code () || (!$ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] && $ai\_wp\_data [AI\_WP\_DEBUGGING] == 0)) return ''; |
| [4196](#L4196) | //  if (!$ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] /\*&& $ai\_wp\_data [AI\_WP\_DEBUGGING] == 0\*/) return ''; |
| [4197](#L4197) |  |
| [4198](#L4198) | $object\_name = 'ai\_front'; |
| [4199](#L4199) | $l10n = $ai\_front\_translations; |
| [4200](#L4200) |  |
| [4201](#L4201) | $code = '/\* <![CDATA[ \*/ |
| [4202](#L4202) | '; |
| [4203](#L4203) |  |
| [4204](#L4204) | foreach ($l10n as $key => $value) { |
| [4205](#L4205) | if (!is\_scalar ($value)) continue; |
| [4206](#L4206) | $l10n [$key] = html\_entity\_decode ((string) $value, ENT\_QUOTES, 'UTF-8'); |
| [4207](#L4207) | } |
| [4208](#L4208) | //  $code .= "var $object\_name = " . wp\_json\_encode ($l10n) . ";\n"; |
| [4209](#L4209) | $code .= "$object\_name = " . wp\_json\_encode ($l10n) . ";\n"; |
| [4210](#L4210) | $code .= '/\* ]]> \*/ |
| [4211](#L4211) | '; |
| [4212](#L4212) |  |
| [4213](#L4213) | return ($code); |
| [4214](#L4214) | } |
| [4215](#L4215) |  |
| [4216](#L4216) | function ai\_amp\_css\_hook () { |
| [4217](#L4217) | global $ai\_wp\_data; |
| [4218](#L4218) |  |
| [4219](#L4219) | if (get\_disable\_css\_code ()) return; |
| [4220](#L4220) |  |
| [4221](#L4221) | $ai\_wp\_data [AI\_AMP\_CSS] = 'AMP CSS HOOK'; |
| [4222](#L4222) |  |
| [4223](#L4223) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4224](#L4224) | $viewport\_css = get\_viewport\_css (); |
| [4225](#L4225) | $viewport\_css = str\_replace ('!important', '', $viewport\_css); |
| [4226](#L4226) | echo $viewport\_css; |
| [4227](#L4227) | } |
| [4228](#L4228) |  |
| [4229](#L4229) | if (defined ('AI\_AMP\_HEADER\_STYLES') && AI\_AMP\_HEADER\_STYLES || $ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) { |
| [4230](#L4230) |  |
| [4231](#L4231) | if (defined ('AI\_AMP\_HEADER\_STYLES') && AI\_AMP\_HEADER\_STYLES) { |
| [4232](#L4232) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) generate\_debug\_css\_base (); |
| [4233](#L4233) |  |
| [4234](#L4234) | echo get\_alignment\_css (); |
| [4235](#L4235) |  |
| [4236](#L4236) | echo str\_replace ('!important', '', ai\_get\_admin\_toolbar\_debugging\_styles ()); |
| [4237](#L4237) |  |
| [4238](#L4238) | echo ".ai-align-left \* {margin: 0 auto 0 0; text-align: left;}\n"; |
| [4239](#L4239) | echo ".ai-align-right \* {margin: 0 0 0 auto; text-align: right;}\n"; |
| [4240](#L4240) | echo ".ai-center \* {margin: 0 auto; text-align: center; }\n"; |
| [4241](#L4241) | } |
| [4242](#L4242) |  |
| [4243](#L4243) | if ($ai\_wp\_data [AI\_WP\_DEBUGGING] != 0) generate\_debug\_css (); |
| [4244](#L4244) | } |
| [4245](#L4245) | } |
| [4246](#L4246) |  |
| [4247](#L4247) | function ai\_amp\_css\_hook\_style () { |
| [4248](#L4248) | echo "<style>\n"; |
| [4249](#L4249) | ai\_amp\_css\_hook (); |
| [4250](#L4250) | echo "</style>\n"; |
| [4251](#L4251) | } |
| [4252](#L4252) |  |
| [4253](#L4253) | function ai\_wp\_footer\_hook\_end\_buffering () { |
| [4254](#L4254) | global $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [4255](#L4255) |  |
| [4256](#L4256) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4257](#L4257) | ai\_log ("FOOTER HOOK TO END BUFFERING START"); |
| [4258](#L4258) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [4259](#L4259) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [4260](#L4260) | $start\_time = microtime (true); |
| [4261](#L4261) | } |
| [4262](#L4262) |  |
| [4263](#L4263) | if (defined ('AI\_BUFFERING')) { |
| [4264](#L4264) | if (get\_output\_buffering ()) { |
| [4265](#L4265) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4266](#L4266) | ai\_buffering\_end (); |
| [4267](#L4267) | } |
| [4268](#L4268) | } |
| [4269](#L4269) | } |
| [4270](#L4270) |  |
| [4271](#L4271) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4272](#L4272) | if (!$ai\_processing\_time\_active) { |
| [4273](#L4273) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [4274](#L4274) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [4275](#L4275) | } |
| [4276](#L4276) | ai\_log ("FOOTER HOOK TO END BUFFERING END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [4277](#L4277) | } |
| [4278](#L4278) | } |
| [4279](#L4279) |  |
| [4280](#L4280) | function ai\_wp\_footer\_hook () { |
| [4281](#L4281) | global $block\_object, $ai\_wp\_data, $ad\_inserter\_globals, $ai\_total\_plugin\_time; |
| [4282](#L4282) |  |
| [4283](#L4283) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4284](#L4284) | ai\_log ("FOOTER HOOK START"); |
| [4285](#L4285) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [4286](#L4286) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [4287](#L4287) | $start\_time = microtime (true); |
| [4288](#L4288) | } |
| [4289](#L4289) |  |
| [4290](#L4290) | //  if (defined ('AI\_BUFFERING')) { |
| [4291](#L4291) | //    if (get\_output\_buffering ()) { |
| [4292](#L4292) | //      if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4293](#L4293) | //        ai\_buffering\_end (); |
| [4294](#L4294) | //      } |
| [4295](#L4295) | //    } |
| [4296](#L4296) | //  } |
| [4297](#L4297) |  |
| [4298](#L4298) | if ($ai\_wp\_data [AI\_DISABLE\_CACHING]) ai\_disable\_caching (); |
| [4299](#L4299) |  |
| [4300](#L4300) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_FOOTER; |
| [4301](#L4301) | $footer\_code = ''; |
| [4302](#L4302) |  |
| [4303](#L4303) | if (function\_exists ('add\_footer\_scripts')) { |
| [4304](#L4304) | add\_footer\_scripts (); |
| [4305](#L4305) | } |
| [4306](#L4306) |  |
| [4307](#L4307) | $footer = $block\_object [AI\_FOOTER\_OPTION\_NAME]; |
| [4308](#L4308) | $footer->clear\_code\_cache (); |
| [4309](#L4309) |  |
| [4310](#L4310) | if ($footer->get\_enable\_manual ()) { |
| [4311](#L4311) | if (!$footer->get\_debug\_disable\_insertion () && !get\_disable\_footer\_code ()) { |
| [4312](#L4312) | if ($footer->check\_server\_side\_detection ()) { |
| [4313](#L4313) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_404 || $footer->get\_enable\_404()) { |
| [4314](#L4314) |  |
| [4315](#L4315) | $processed\_code = do\_shortcode ($footer->ai\_getCode ()); |
| [4316](#L4316) |  |
| [4317](#L4317) | if (strpos ($processed\_code, AD\_AMP\_SEPARATOR) !== false) { |
| [4318](#L4318) | $codes = explode (AD\_AMP\_SEPARATOR, $processed\_code); |
| [4319](#L4319) | $processed\_code = $codes [0]; |
| [4320](#L4320) | } elseif ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) $processed\_code = ''; |
| [4321](#L4321) |  |
| [4322](#L4322) | $footer\_code = $processed\_code; |
| [4323](#L4323) |  |
| [4324](#L4324) | echo $processed\_code; |
| [4325](#L4325) |  |
| [4326](#L4326) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4327](#L4327) | if (strlen ($processed\_code) != 0) |
| [4328](#L4328) | ai\_log ("FOOTER CODE: " . strlen ($processed\_code) . ' characters'); |
| [4329](#L4329) | } |
| [4330](#L4330) | } |
| [4331](#L4331) | } |
| [4332](#L4332) | } else { |
| [4333](#L4333) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4334](#L4334) | ai\_log ('FOOTER CODE DEBUG NO INSERTION'); |
| [4335](#L4335) | } |
| [4336](#L4336) | } |
| [4337](#L4337) | } |
| [4338](#L4338) |  |
| [4339](#L4339) | if (!$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4340](#L4340) | if (!get\_disable\_footer\_code () && isset ($\_GET ['ai-debug-code']) && !defined ('AI\_DEBUGGING\_DEMO')) { |
| [4341](#L4341) | echo get\_code\_debug\_block (' ' . \_\_('Footer code', 'ad-inserter') . ' ' . ($footer->get\_enable\_manual () ? '' : ' ' . \_x('DISABLED', 'Footer code', 'ad-inserter')), '...&lt;/body&gt;', strlen ($footer\_code).' ' . \_n('character inserted', 'characters inserted', strlen ($footer\_code), 'ad-inserter'), $footer->ai\_getCode (), $footer\_code); |
| [4342](#L4342) | } |
| [4343](#L4343) |  |
| [4344](#L4344) | if (!get\_disable\_js\_code () && |
| [4345](#L4345) | (get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) && |
| [4346](#L4346) | (($ai\_wp\_data [AI\_WP\_DEBUGGING] & (AI\_DEBUG\_POSITIONS | AI\_DEBUG\_BLOCKS)) != 0 || (isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0))) { |
| [4347](#L4347) |  |
| [4348](#L4348) |  |
| [4349](#L4349) | if (!$ai\_wp\_data [AI\_UNFILTERED\_HTML]) { |
| [4350](#L4350) | echo "<section class='".AI\_DEBUG\_STATUS\_CLASS." status-error'>".\_\_('UNFILTERED HTML DISABLED', 'ad-inserter')."</section>\n"; |
| [4351](#L4351) | } |
| [4352](#L4352) |  |
| [4353](#L4353) | $class\_0 = AI\_DEBUG\_STATUS\_CLASS.' status-error'; |
| [4354](#L4354) | $class\_1 = AI\_DEBUG\_STATUS\_CLASS.' status-ok'; |
| [4355](#L4355) | $javascript\_text = "<section class='ai-js-0 $class\_0'>" . \_\_('JAVASCRIPT NOT WORKING', 'ad-inserter') . "</section><section class='ai-js-1 $class\_1' style='display: none;'>" . \_\_('NO JAVASCRIPT ERRORS', 'ad-inserter') . "</section><section class='ai-js-2 $class\_0' style='display: none;'>" . \_\_('JAVASCRIPT ERRORS', 'ad-inserter') . "</section>"; |
| [4356](#L4356) |  |
| [4357](#L4357) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] .= str\_replace ('AI\_HTML\_CODE', $javascript\_text, ai\_get\_js ('ai-errors-footer', false)); |
| [4358](#L4358) |  |
| [4359](#L4359) | echo $javascript\_text, "\n"; |
| [4360](#L4360) | echo get\_page\_type\_debug\_info () , "\n"; |
| [4361](#L4361) |  |
| [4362](#L4362) | //      if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0 && isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0) { |
| [4363](#L4363) | //        echo "\n<pre class='ai-processing-log'>\n\n"; |
| [4364](#L4364) | //        ai\_write\_debug\_info (true); |
| [4365](#L4365) | //        echo "\n</pre>\n"; |
| [4366](#L4366) | //      } |
| [4367](#L4367) | } |
| [4368](#L4368) | } |
| [4369](#L4369) |  |
| [4370](#L4370) | if (!(defined ('DOING\_AJAX') && DOING\_AJAX) || $ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4371](#L4371) | add\_footer\_inline\_scripts (); |
| [4372](#L4372) |  |
| [4373](#L4373) | if (function\_exists ('ai\_add\_footer\_html')) { |
| [4374](#L4374) | ai\_add\_footer\_html (); |
| [4375](#L4375) | } |
| [4376](#L4376) | } |
| [4377](#L4377) |  |
| [4378](#L4378) | if (function\_exists ('ai\_debug\_footer')) { |
| [4379](#L4379) | ai\_debug\_footer (); |
| [4380](#L4380) | } |
| [4381](#L4381) |  |
| [4382](#L4382) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4383](#L4383) | if (!$ai\_processing\_time\_active) { |
| [4384](#L4384) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [4385](#L4385) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [4386](#L4386) | } |
| [4387](#L4387) | ai\_log ("FOOTER HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [4388](#L4388) | } |
| [4389](#L4389) |  |
| [4390](#L4390) | if (!$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [4391](#L4391) | if ((get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0)) { |
| [4392](#L4392) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0 && isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0) { |
| [4393](#L4393) | echo "\n<pre class='ai-processing-log'>\n\n"; |
| [4394](#L4394) | ai\_write\_debug\_info (true); |
| [4395](#L4395) | echo "\n</pre>\n"; |
| [4396](#L4396) | } |
| [4397](#L4397) | } |
| [4398](#L4398) | } |
| [4399](#L4399) | } |
| [4400](#L4400) |  |
| [4401](#L4401) | function ai\_amp\_footer\_hook () { |
| [4402](#L4402) | global $block\_object, $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [4403](#L4403) |  |
| [4404](#L4404) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4405](#L4405) | ai\_log ("AMP FOOTER HOOK START"); |
| [4406](#L4406) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [4407](#L4407) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [4408](#L4408) | $start\_time = microtime (true); |
| [4409](#L4409) | } |
| [4410](#L4410) |  |
| [4411](#L4411) | if (defined ('AI\_BUFFERING')) { |
| [4412](#L4412) | if (get\_output\_buffering ()) { |
| [4413](#L4413) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_AJAX) { |
| [4414](#L4414) | ai\_buffering\_end (); |
| [4415](#L4415) | } |
| [4416](#L4416) | } |
| [4417](#L4417) | } |
| [4418](#L4418) |  |
| [4419](#L4419) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_FOOTER; |
| [4420](#L4420) |  |
| [4421](#L4421) | $footer = $block\_object [AI\_FOOTER\_OPTION\_NAME]; |
| [4422](#L4422) | $footer->clear\_code\_cache (); |
| [4423](#L4423) |  |
| [4424](#L4424) | if ($footer->get\_enable\_manual ()) { |
| [4425](#L4425) | if (!$footer->get\_debug\_disable\_insertion () && !get\_disable\_footer\_code ()) { |
| [4426](#L4426) | if ($footer->check\_server\_side\_detection ()) { |
| [4427](#L4427) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] != AI\_PT\_404 || $footer->get\_enable\_404()) { |
| [4428](#L4428) | $processed\_code = do\_shortcode ($footer->ai\_getCode ()); |
| [4429](#L4429) |  |
| [4430](#L4430) | if (strpos ($processed\_code, AD\_AMP\_SEPARATOR) !== false) { |
| [4431](#L4431) | $codes = explode (AD\_AMP\_SEPARATOR, $processed\_code); |
| [4432](#L4432) | $processed\_code = ltrim ($codes [1]); |
| [4433](#L4433) | echo $processed\_code; |
| [4434](#L4434) | } |
| [4435](#L4435) | } |
| [4436](#L4436) | } |
| [4437](#L4437) | } |
| [4438](#L4438) | } |
| [4439](#L4439) |  |
| [4440](#L4440) | if (!isset ($ai\_wp\_data [AI\_AMP\_CSS])) { |
| [4441](#L4441) | if (ai\_amp\_plugin\_custom\_css ()) { |
| [4442](#L4442) | ai\_amp\_css\_hook\_style (); |
| [4443](#L4443) | $ai\_wp\_data [AI\_AMP\_CSS] = 'AMP FOOTER STYLE'; |
| [4444](#L4444) | } |
| [4445](#L4445) | } |
| [4446](#L4446) |  |
| [4447](#L4447) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [4448](#L4448) | echo get\_page\_type\_debug\_info ('AMP ') , "\n"; |
| [4449](#L4449) | } |
| [4450](#L4450) |  |
| [4451](#L4451) | if ((get\_remote\_debugging () || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) && |
| [4452](#L4452) | ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0 && |
| [4453](#L4453) | isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE] != 0) { |
| [4454](#L4454) | echo "\n<pre class='ai-processing-log'>\n\n"; |
| [4455](#L4455) | ai\_write\_debug\_info (true); |
| [4456](#L4456) | echo "\n</pre>\n"; |
| [4457](#L4457) | } |
| [4458](#L4458) |  |
| [4459](#L4459) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [4460](#L4460) | if (!$ai\_processing\_time\_active) { |
| [4461](#L4461) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [4462](#L4462) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [4463](#L4463) | } |
| [4464](#L4464) | ai\_log ("AMP FOOTER HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [4465](#L4465) | } |
| [4466](#L4466) | } |
| [4467](#L4467) |  |
| [4468](#L4468) | function ai\_write\_debug\_info ($write\_processing\_log = false) { |
| [4469](#L4469) | global $block\_object, $ai\_last\_time, $ai\_total\_plugin\_time, $ai\_total\_block\_php\_time, $ai\_total\_hook\_php\_time, $ai\_processing\_log, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_db\_options, $block\_insertion\_log, |
| [4470](#L4470) | $ai\_custom\_hooks, $version\_string, $subversion\_string, $filter\_hooks, $wpdb; |
| [4471](#L4471) |  |
| [4472](#L4472) | ob\_start (); |
| [4473](#L4473) |  |
| [4474](#L4474) | echo sprintf ("%-25s%s", AD\_INSERTER\_NAME, AD\_INSERTER\_VERSION); |
| [4475](#L4475) | if (function\_exists ('ai\_debug\_log')) { |
| [4476](#L4476) | ai\_debug\_log (); |
| [4477](#L4477) | } |
| [4478](#L4478) | echo "\n\n"; |
| [4479](#L4479) | if (($install\_timestamp = get\_option (AI\_INSTALL\_NAME)) !== false) { |
| [4480](#L4480) | echo "INSTALLED:               ", date ("Y-m-d H:i:s", $install\_timestamp + get\_option ('gmt\_offset') \* 3600); |
| [4481](#L4481) | if (isset ($ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE])) { |
| [4482](#L4482) | printf (' (%04d-%02d-%02d %02d:%02d:%02d, %d days ago)', $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->y, |
| [4483](#L4483) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->m, |
| [4484](#L4484) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->d, |
| [4485](#L4485) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->h, |
| [4486](#L4486) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->i, |
| [4487](#L4487) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->s, |
| [4488](#L4488) | isset ($ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL]) ? $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL] : null); |
| [4489](#L4489) | } |
| [4490](#L4490) | echo "\n"; |
| [4491](#L4491) | } |
| [4492](#L4492) | echo "GENERATED (WP time):     ", date ("Y-m-d H:i:s", time() + get\_option ('gmt\_offset') \* 3600), "\n"; |
| [4493](#L4493) | echo "GENERATED (Server time): ", date ("Y-m-d H:i:s", time()), "\n"; |
| [4494](#L4494) | echo "PLUGIN CODE PROCESSING:  ", number\_format (($ai\_total\_plugin\_time - $ai\_total\_block\_php\_time - $ai\_total\_hook\_php\_time) \* 1000, 2, '.' , ''), " ms\n"; |
| [4495](#L4495) | echo "PLUGIN HOOKS PROCESSING: ", number\_format ($ai\_total\_hook\_php\_time \* 1000, 2, '.' , ''), " ms\n"; |
| [4496](#L4496) | echo "BLOCK CODE PROCESSING:   ", number\_format ($ai\_total\_block\_php\_time \* 1000, 2, '.' , ''), " ms\n"; |
| [4497](#L4497) | echo "TOTAL PROCESSING TIME:   ", number\_format ($ai\_total\_plugin\_time \* 1000, 2, '.' , ''), " ms\n"; |
| [4498](#L4498) | //  echo "MEMORY USED:             ", number\_format (memory\_get\_usage (true) / 1024 / 1024, 2, '.' , ''), " MB\n"; |
| [4499](#L4499) | //  echo "PEAK MEMORY USED:        ", number\_format (memory\_get\_peak\_usage (true) / 1024 / 1024, 2, '.' , ''), " MB\n"; |
| [4500](#L4500) |  |
| [4501](#L4501) | echo "SETTINGS:                "; |
| [4502](#L4502) | if (isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'])) |
| [4503](#L4503) | echo (int) ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][0].$ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][1]), '.', |
| [4504](#L4504) | (int) ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][2].$ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][3]), '.', |
| [4505](#L4505) | (int) ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][4].$ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'][5]); |
| [4506](#L4506) |  |
| [4507](#L4507) | echo "\n"; |
| [4508](#L4508) | echo "SETTINGS SIZE:           ", strlen (serialize (ai\_get\_option (AI\_OPTION\_NAME))), "\n"; |
| [4509](#L4509) | echo "SETTINGS TIMESTAMP:      "; |
| [4510](#L4510) | echo isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['TIMESTAMP']) ? date ("Y-m-d H:i:s", $ai\_db\_options [AI\_OPTION\_GLOBAL]['TIMESTAMP'] + get\_option ('gmt\_offset') \* 3600) : "", "\n"; |
| [4511](#L4511) |  |
| [4512](#L4512) | $expected\_extract\_version = $version\_string . $subversion\_string . '-' . '96'; |
| [4513](#L4513) | if (function\_exists ('ai\_system\_output\_check')) { |
| [4514](#L4514) | $expected\_extract\_version .= 'P'; |
| [4515](#L4515) | } |
| [4516](#L4516) |  |
| [4517](#L4517) | $extract\_source = ''; |
| [4518](#L4518) | $saved\_settings = ai\_get\_option (AI\_OPTION\_NAME); |
| [4519](#L4519) | if (isset ($saved\_settings [AI\_OPTION\_EXTRACT]['VERSION']) && $saved\_settings [AI\_OPTION\_EXTRACT]['VERSION'] == $expected\_extract\_version) { |
| [4520](#L4520) | $saved\_extract = $saved\_settings [AI\_OPTION\_EXTRACT]; |
| [4521](#L4521) | $extract\_source = 'SAVED SETTINGS'; |
| [4522](#L4522) | } else { |
| [4523](#L4523) | $saved\_extract = get\_option (AI\_EXTRACT\_NAME); |
| [4524](#L4524) | $extract\_source = defined ('AI\_EXTRACT\_GENERATED') ? "REGENERATED" : 'SAVED EXTRACT'; |
| [4525](#L4525) | } |
| [4526](#L4526) | echo "SETTINGS EXTRACT:        "; |
| [4527](#L4527) | if (isset ($saved\_extract ['VERSION'])) { |
| [4528](#L4528) | $extract\_subversion\_blocks = explode ('-', $saved\_extract ['VERSION']); |
| [4529](#L4529) | array\_shift ($extract\_subversion\_blocks); |
| [4530](#L4530) | echo (int) ($saved\_extract ['VERSION'][0].$saved\_extract ['VERSION'][1]), '.', |
| [4531](#L4531) | (int) ($saved\_extract ['VERSION'][2].$saved\_extract ['VERSION'][3]), '.', |
| [4532](#L4532) | (int) ($saved\_extract ['VERSION'][4].$saved\_extract ['VERSION'][5]), '-', implode ('-', $extract\_subversion\_blocks); |
| [4533](#L4533) | } |
| [4534](#L4534) | echo"\n"; |
| [4535](#L4535) | echo "EXTRACT TIMESTAMP:       "; |
| [4536](#L4536) | echo isset ($saved\_extract ['TIMESTAMP']) ? date ("Y-m-d H:i:s", $saved\_extract ['TIMESTAMP'] + get\_option ('gmt\_offset') \* 3600) : "", "\n"; |
| [4537](#L4537) | echo "EXTRACT SOURCE:          ", $extract\_source, "\n"; |
| [4538](#L4538) |  |
| [4539](#L4539) | echo "USER:                    "; |
| [4540](#L4540) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN)     == AI\_USER\_LOGGED\_IN) echo "LOGGED-IN "; else echo "NOT LOGGED-IN "; |
| [4541](#L4541) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) == AI\_USER\_ADMINISTRATOR) echo "ADMINISTRATOR"; |
| [4542](#L4542) | $current\_user = wp\_get\_current\_user(); |
| [4543](#L4543) | echo "\n"; |
| [4544](#L4544) | echo "USERNAME:                ", $current\_user->user\_login, "\n"; |
| [4545](#L4545) | echo 'USER ROLES:              ', implode (', ', $current\_user->roles), "\n"; |
| [4546](#L4546) |  |
| [4547](#L4547) | echo 'MIN.USER FOR EXCEPTIONS: ', get\_minimum\_user\_role (), "\n"; |
| [4548](#L4548) | echo "PAGE TYPE:               "; |
| [4549](#L4549) | switch ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE]) { |
| [4550](#L4550) | case AI\_PT\_STATIC:    echo "STATIC PAGE"; break; |
| [4551](#L4551) | case AI\_PT\_POST:      echo "POST"; break; |
| [4552](#L4552) | case AI\_PT\_HOMEPAGE:  echo "HOMEPAGE"; break; |
| [4553](#L4553) | case AI\_PT\_CATEGORY:  echo "CATEGORY PAGE"; break; |
| [4554](#L4554) | case AI\_PT\_ARCHIVE:   echo "ARCHIVE PAGE"; break; |
| [4555](#L4555) | case AI\_PT\_SEARCH:    echo "SEARCH PAGE"; break; |
| [4556](#L4556) | case AI\_PT\_404:       echo "404 PAGE"; break; |
| [4557](#L4557) | case AI\_PT\_ADMIN:     echo "ADMIN"; break; |
| [4558](#L4558) | case AI\_PT\_FEED:      echo "FEED"; break; |
| [4559](#L4559) | case AI\_PT\_AJAX:      echo "AJAX"; break; |
| [4560](#L4560) | case AI\_PT\_REST:      echo "REST"; break; |
| [4561](#L4561) | case AI\_PT\_ANY:       echo "ANY ?"; break; |
| [4562](#L4562) | case AI\_PT\_NONE:      echo "NONE ?"; break; |
| [4563](#L4563) | default:              echo "?"; break; |
| [4564](#L4564) | } |
| [4565](#L4565) | echo "\n"; |
| [4566](#L4566) |  |
| [4567](#L4567) | switch ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE]) { |
| [4568](#L4568) | case AI\_PT\_STATIC: |
| [4569](#L4569) | case AI\_PT\_POST: |
| [4570](#L4570) | $queried\_object\_id = ''; |
| [4571](#L4571) | $queried\_object = get\_queried\_object (); |
| [4572](#L4572) | if ($queried\_object) { |
| [4573](#L4573) | $queried\_object\_id = $queried\_object->ID; |
| [4574](#L4574) | } |
| [4575](#L4575) |  |
| [4576](#L4576) | echo 'PUBLISHED:               ', date ("Y-m-d H:i:s", get\_the\_date ('U')), "\n"; |
| [4577](#L4577) | echo 'ID:                      ', ai\_get\_post\_id (); |
| [4578](#L4578) | echo " (get\_the\_ID: ", get\_the\_ID (), ", get\_queried\_object: ", $queried\_object\_id, defined ('AI\_USE\_GET\_QUERIED\_OBJECT') && AI\_USE\_GET\_QUERIED\_OBJECT ? ', AI\_USE\_GET\_QUERIED\_OBJECT SET'  : "", ")"; |
| [4579](#L4579) | echo "\n"; |
| [4580](#L4580) | echo 'POST TYPE:               ', get\_post\_type (), "\n"; |
| [4581](#L4581) | echo 'AUTHOR:                  ', strtolower (get\_the\_author\_meta ('user\_login')), ' (', get\_the\_author\_meta ('display\_name'), ")\n"; |
| [4582](#L4582) |  |
| [4583](#L4583) | //  $author       = get\_the\_author\_meta ('display\_name'); |
| [4584](#L4584) | //  $author\_login = get\_the\_author\_meta ('user\_login'); |
| [4585](#L4585) | //  $author\_name  = get\_the\_author\_meta ('first\_name') . " " . get\_the\_author\_meta ('last\_name'); |
| [4586](#L4586) |  |
| [4587](#L4587) |  |
| [4588](#L4588) | $category\_data = get\_the\_category(); |
| [4589](#L4589) | $categories = array (); |
| [4590](#L4590) | foreach ($category\_data as $category) { |
| [4591](#L4591) | $categories []= $category->name . ' ('.$category->slug.')'; |
| [4592](#L4592) | } |
| [4593](#L4593) | echo 'CATEGORIES:              ', implode (', ', $categories), "\n"; |
| [4594](#L4594) |  |
| [4595](#L4595) | $category\_data = get\_categories (); |
| [4596](#L4596) | $categories = array (); |
| [4597](#L4597) | foreach ($category\_data as $category) { |
| [4598](#L4598) | if (ai\_post\_is\_in\_child\_categories ($category->slug)) { |
| [4599](#L4599) | $categories []= $category->name . ' ('.$category->slug.')'; |
| [4600](#L4600) | } |
| [4601](#L4601) | } |
| [4602](#L4602) | echo 'PARENT CATEGORIES:       ', implode (', ', $categories), "\n"; |
| [4603](#L4603) | echo 'PRIMARY CATEGORY:        ', ai\_primary\_category (), "\n"; |
| [4604](#L4604) | $tag\_data = wp\_get\_post\_tags (get\_the\_ID()); |
| [4605](#L4605) | $tags = array (); |
| [4606](#L4606) | foreach ($tag\_data as $tag) { |
| [4607](#L4607) | $tags []= $tag->name . ' ('.$tag->slug.')'; |
| [4608](#L4608) | } |
| [4609](#L4609) | echo 'TAGS:                    ', implode (', ', $tags), "\n"; |
| [4610](#L4610) |  |
| [4611](#L4611) | $taxonomies = array (); |
| [4612](#L4612) | $taxonomy\_names = get\_post\_taxonomies (); |
| [4613](#L4613) | foreach ($taxonomy\_names as $taxonomy\_name) { |
| [4614](#L4614) | $terms = get\_the\_terms (0, $taxonomy\_name); |
| [4615](#L4615) | if (is\_array ($terms)) { |
| [4616](#L4616) | foreach ($terms as $term) { |
| [4617](#L4617) | $taxonomies [] = strtolower ($term->taxonomy) . ':' . strtolower ($term->slug); |
| [4618](#L4618) | } |
| [4619](#L4619) | } |
| [4620](#L4620) | } |
| [4621](#L4621) | echo 'TAXONOMIES:              ', implode (', ', $taxonomies), "\n"; |
| [4622](#L4622) |  |
| [4623](#L4623) | $taxonomy\_data = get\_taxonomies (); |
| [4624](#L4624) | $taxonomies = array (); |
| [4625](#L4625) | foreach ($taxonomy\_data as $taxonomy) { |
| [4626](#L4626) | $terms = get\_terms ($taxonomy); |
| [4627](#L4627) | foreach ($terms as $term) { |
| [4628](#L4628) | if (ai\_post\_is\_in\_child\_taxonomies ($taxonomy, $term->slug)) { |
| [4629](#L4629) | $taxonomies []= $term->name . ' ('.$taxonomy.':'.$term->slug.')'; |
| [4630](#L4630) | } |
| [4631](#L4631) | } |
| [4632](#L4632) | } |
| [4633](#L4633) | echo 'PARENT TAXONOMIES:       ', implode (', ', $taxonomies), "\n"; |
| [4634](#L4634) |  |
| [4635](#L4635) | if (isset ($\_GET [AI\_URL\_DEBUG\_META])) { |
| [4636](#L4636) | $post\_meta = get\_post\_meta (get\_the\_ID()); |
| [4637](#L4637) | $meta\_string = array (); |
| [4638](#L4638) | foreach ($post\_meta as $key => $post\_meta\_field) { |
| [4639](#L4639) | foreach ($post\_meta\_field as $post\_meta\_field\_item) { |
| [4640](#L4640) | $meta\_string []= $key . ':' . $post\_meta\_field\_item; |
| [4641](#L4641) | } |
| [4642](#L4642) | } |
| [4643](#L4643) | echo 'POST META:               ', str\_replace (array ("<!--", "-->", "\n", "\r"), array ("[!--", "--]", "\*n", "\*r"), implode (', ', $meta\_string)), "\n"; |
| [4644](#L4644) | } |
| [4645](#L4645) |  |
| [4646](#L4646) | break; |
| [4647](#L4647) | case AI\_PT\_CATEGORY: |
| [4648](#L4648) | $category\_data = get\_queried\_object(); |
| [4649](#L4649) | $categories = array (); |
| [4650](#L4650) | if ($category\_data instanceof WP\_Term) { |
| [4651](#L4651) | $categories []= $category\_data->slug; |
| [4652](#L4652) | } |
| [4653](#L4653) | echo 'CATEGORY:                ', implode (', ', $categories), "\n"; |
| [4654](#L4654) | break; |
| [4655](#L4655) | case AI\_PT\_ARCHIVE: |
| [4656](#L4656) | $tag\_data = wp\_get\_post\_tags (get\_the\_ID()); |
| [4657](#L4657) | $tags = array (); |
| [4658](#L4658) | foreach ($tag\_data as $tag) { |
| [4659](#L4659) | $tags []= $tag->slug; |
| [4660](#L4660) | } |
| [4661](#L4661) | echo 'TAG:                     ', implode (', ', $tags), "\n"; |
| [4662](#L4662) | break; |
| [4663](#L4663) | } |
| [4664](#L4664) |  |
| [4665](#L4665) |  |
| [4666](#L4666) | echo 'AMP PAGE:                ', ($ai\_wp\_data [AI\_WP\_AMP\_PAGE] ? 'YES' : 'NO'), "\n"; |
| [4667](#L4667) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [4668](#L4668) | echo 'AMP CSS:                 ', (isset ($ai\_wp\_data [AI\_AMP\_CSS]) ? $ai\_wp\_data [AI\_AMP\_CSS] : ''), "\n"; |
| [4669](#L4669) | } |
| [4670](#L4670) |  |
| [4671](#L4671) | echo 'URL:                     ', esc\_attr ($ai\_wp\_data [AI\_WP\_URL]), "\n"; |
| [4672](#L4672) | echo 'REFERRER:                ', isset ($\_SERVER['HTTP\_REFERER']) ? strtolower (parse\_url ($\_SERVER['HTTP\_REFERER'], PHP\_URL\_HOST)) . ' ('. remove\_debug\_parameters\_from\_url ($\_SERVER['HTTP\_REFERER']).')' : "", "\n"; |
| [4673](#L4673) | if (function\_exists ('ai\_debug')) ai\_debug (); |
| [4674](#L4674) |  |
| [4675](#L4675) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] || 1) { |
| [4676](#L4676) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [4677](#L4677) | $viewport\_name  = get\_viewport\_name ($viewport); |
| [4678](#L4678) | $viewport\_width = get\_viewport\_width ($viewport); |
| [4679](#L4679) | if ($viewport\_name != '') { |
| [4680](#L4680) | echo 'VIEWPORT ', $viewport, ':              ', sprintf ("%-16s min width %s", $viewport\_name.' ', $viewport\_width), " px\n"; |
| [4681](#L4681) | } |
| [4682](#L4682) | } |
| [4683](#L4683) | } |
| [4684](#L4684) |  |
| [4685](#L4685) | echo 'SERVER-SIDE DETECTION:   ', $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] ? 'USED' : "NOT USED", "\n"; |
| [4686](#L4686) | if ($ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION]) { |
| [4687](#L4687) | echo 'SERVER-SIDE DEVICE:      '; |
| [4688](#L4688) | if (AI\_DESKTOP) echo "DESKTOP\n"; |
| [4689](#L4689) | elseif (AI\_TABLET) echo "TABLET\n"; |
| [4690](#L4690) | elseif (AI\_PHONE) echo "PHONE\n"; |
| [4691](#L4691) | else echo "?\n"; |
| [4692](#L4692) | } |
| [4693](#L4693) |  |
| [4694](#L4694) | echo 'CLIENT-SIDE DETECTION:   ', $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION] ? 'USED' : "NOT USED", "\n"; |
| [4695](#L4695) | echo 'DISABLE CACHING:         ', $ai\_wp\_data [AI\_DISABLE\_CACHING] ? 'USED' : "NOT USED", "\n"; |
| [4696](#L4696) | echo 'STICKY WIDGETS:          ', $ai\_wp\_data [AI\_STICKY\_WIDGETS] ? 'USED' : "NOT USED", "\n"; |
| [4697](#L4697) |  |
| [4698](#L4698) | if (function\_exists ('ai\_debug\_features')) ai\_debug\_features (); |
| [4699](#L4699) |  |
| [4700](#L4700) | $enabled\_custom\_hooks = array (); |
| [4701](#L4701) | foreach ($ai\_custom\_hooks as $ai\_custom\_hook) { |
| [4702](#L4702) | $hook = $ai\_custom\_hook ['index']; |
| [4703](#L4703) | $enabled\_custom\_hooks [] = $ai\_custom\_hook ['action']; |
| [4704](#L4704) | } |
| [4705](#L4705) | for ($hook = 1; $hook <= 20; $hook ++) { |
| [4706](#L4706) | $name       = str\_replace (array ('&lt;', '&gt;'), array ('<', '>'), get\_hook\_name ($hook)); |
| [4707](#L4707) | $action     = get\_hook\_action ($hook); |
| [4708](#L4708) | if (get\_hook\_enabled ($hook) /\*&& $name != '' && $action != ''\*/) { |
| [4709](#L4709) | $priority   = get\_hook\_priority ($hook); |
| [4710](#L4710) | echo 'CUSTOM HOOK ', sprintf ("%2d", $hook), ':          ', sprintf ("%-30s %-35s %d %s", $name, $action, $priority, !in\_array ($action, $enabled\_custom\_hooks) ? 'INVALID' : ''), "\n"; |
| [4711](#L4711) | } |
| [4712](#L4712) | } |
| [4713](#L4713) | if (!empty ($ai\_wp\_data [AI\_ACTIVE\_GROUP\_NAMES])) { |
| [4714](#L4714) | echo 'ACTIVE GROUPS:           ' . implode (', ', $ai\_wp\_data [AI\_ACTIVE\_GROUP\_NAMES]) . "\n"; |
| [4715](#L4715) | } |
| [4716](#L4716) | echo 'BLOCK CLASS NAME:        ', get\_block\_class\_name (), "\n"; |
| [4717](#L4717) | echo 'INLINE STYLES:           ', get\_inline\_styles () ? 'ENABLED' : 'DISABLED', "\n"; |
| [4718](#L4718) | echo 'DYNAMIC BLOCKS:          '; |
| [4719](#L4719) | switch (get\_dynamic\_blocks()) { |
| [4720](#L4720) | case AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE: |
| [4721](#L4721) | echo AI\_TEXT\_ENG\_SERVER\_SIDE; |
| [4722](#L4722) | break; |
| [4723](#L4723) | case AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE\_W3TC: |
| [4724](#L4724) | echo AI\_TEXT\_ENG\_SERVER\_SIDE\_W3TC; |
| [4725](#L4725) | break; |
| [4726](#L4726) | case AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW: |
| [4727](#L4727) | echo AI\_TEXT\_ENG\_CLIENT\_SIDE\_SHOW; |
| [4728](#L4728) | break; |
| [4729](#L4729) | case AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT: |
| [4730](#L4730) | echo AI\_TEXT\_ENG\_CLIENT\_SIDE\_INSERT; |
| [4731](#L4731) | break; |
| [4732](#L4732) | } |
| [4733](#L4733) | echo "\n"; |
| [4734](#L4734) | echo 'STICKY WIDGET MODE:      '; |
| [4735](#L4735) | switch (get\_sticky\_widget\_mode ()) { |
| [4736](#L4736) | case AI\_STICKY\_WIDGET\_MODE\_CSS: |
| [4737](#L4737) | echo AI\_TEXT\_CSS; |
| [4738](#L4738) | break; |
| [4739](#L4739) | case AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH: |
| [4740](#L4740) | echo AI\_TEXT\_CSS\_PUSH; |
| [4741](#L4741) | break; |
| [4742](#L4742) | case AI\_STICKY\_WIDGET\_MODE\_JS: |
| [4743](#L4743) | echo AI\_TEXT\_JS; |
| [4744](#L4744) | break; |
| [4745](#L4745) | } |
| [4746](#L4746) | echo "\n"; |
| [4747](#L4747) | echo 'PARAGRAPH COUNTING:      '; |
| [4748](#L4748) | switch (get\_paragraph\_counting\_functions()) { |
| [4749](#L4749) | case AI\_STANDARD\_PARAGRAPH\_COUNTING\_FUNCTIONS: |
| [4750](#L4750) | echo AI\_TEXT\_ENG\_STANDARD; |
| [4751](#L4751) | break; |
| [4752](#L4752) | case AI\_MULTIBYTE\_PARAGRAPH\_COUNTING\_FUNCTIONS: |
| [4753](#L4753) | echo AI\_TEXT\_ENG\_MULTIBYTE; |
| [4754](#L4754) | break; |
| [4755](#L4755) | } |
| [4756](#L4756) | echo "\n"; |
| [4757](#L4757) | echo 'NO PAR. COUNTING INSIDE: ', get\_no\_paragraph\_counting\_inside (), "\n"; |
| [4758](#L4758) | if (defined ('AI\_BUFFERING')) { |
| [4759](#L4759) | echo 'OUTPUT BUFFERING:        '; |
| [4760](#L4760) | switch (get\_output\_buffering()) { |
| [4761](#L4761) | case AI\_OUTPUT\_BUFFERING\_DISABLED: |
| [4762](#L4762) | echo AI\_TEXT\_ENG\_DISABLED; |
| [4763](#L4763) | break; |
| [4764](#L4764) | case AI\_OUTPUT\_BUFFERING\_ENABLED: |
| [4765](#L4765) | echo AI\_TEXT\_ENG\_ENABLED; |
| [4766](#L4766) | break; |
| [4767](#L4767) | } |
| [4768](#L4768) | echo "\n"; |
| [4769](#L4769) | } |
| [4770](#L4770) | echo 'AD LABEL:                ', get\_ad\_label (), "\n"; |
| [4771](#L4771) | echo 'AD LABEL HTML CODE:      ', trim (ai\_ad\_label\_code (), "\n"), "\n"; |
| [4772](#L4772) |  |
| [4773](#L4773) | if (defined ('AI\_STICKY\_SETTINGS') && AI\_STICKY\_SETTINGS) { |
| [4774](#L4774) | echo 'MAIN CONTENT:            ', get\_main\_content\_element (), "\n"; |
| [4775](#L4775) | } |
| [4776](#L4776) |  |
| [4777](#L4777) | echo 'PLUGIN PRIORITY:         ', get\_plugin\_priority (), "\n"; |
| [4778](#L4778) | echo 'MAX LIST ITEMS:          ', get\_max\_list\_items (), "\n"; |
| [4779](#L4779) | echo 'TAB SETUP DELAY:         ', get\_tab\_setup\_delay (), "\n"; |
| [4780](#L4780) | echo 'ADMIN DISABLE CACHING:   ', get\_disable\_caching () ? 'ENABLED' : 'DISABLED', "\n"; |
| [4781](#L4781) | echo 'DON\'T USE jQuery CODE:   ', defined ('AI\_NO\_JQUERY') ? 'PHP CONSTANT' : (isset ($\_GET [AI\_URL\_DEBUG\_NO\_JQUERY]) && !empty ($\_GET [AI\_URL\_DEBUG\_NO\_JQUERY]) ? 'URL PARAMETER' : 'NOT SET'), "\n"; |
| [4782](#L4782) | echo 'WAIT FOR JQUERY:         ', get\_wait\_for\_jquery () ? 'ENABLED' : 'DISABLED', "\n"; |
| [4783](#L4783) | echo 'jQuery LOADED:           ', wp\_script\_is ('jquery', 'registered') || wp\_script\_is ('jquery', 'printed') ? 'YES' : 'NO', "\n"; |
| [4784](#L4784) | echo 'PLAIN JS CODE:           ', $ai\_wp\_data [AI\_NO\_JQUERY\_CODE] ? 'YES' : 'NO', "\n"; |
| [4785](#L4785) | echo 'JAVASCRIPT CODE:         ', get\_javascript\_code\_mode () == AI\_JAVASCRIPT\_CODE\_INLINE ? AI\_TEXT\_ENG\_INLINE : AI\_TEXT\_ENG\_FILE, "\n"; |
| [4786](#L4786) | echo 'DO NOT CACHE CONSTANTS:  ', defined ('DONOTCACHEPAGE') ? 'DONOTCACHEPAGE ' : '', defined ('DONOTCACHEOBJECT') ? 'DONOTCACHEOBJECT ' : '', defined ('DONOTCACHEDB') ? 'DONOTCACHEDB ' : '', "\n"; |
| [4787](#L4787) | $virtual\_ads\_txt = get\_option (AI\_ADS\_TXT\_NAME); |
| [4788](#L4788) | $virtual\_ads\_txt\_lines = explode ("\n", $virtual\_ads\_txt); |
| [4789](#L4789) | echo 'VIRTUAL ADS.TXT:         ', $virtual\_ads\_txt !== false ? count ($virtual\_ads\_txt\_lines). ' LINES' : 'NOT USED', "\n"; |
| [4790](#L4790) | echo 'HEADER:                  ', $block\_object [AI\_HEADER\_OPTION\_NAME]->get\_enable\_manual () ? 'ENABLED' : 'DISABLED', "\n"; |
| [4791](#L4791) | echo 'FOOTER:                  ', $block\_object [AI\_FOOTER\_OPTION\_NAME]->get\_enable\_manual () ? 'ENABLED' : 'DISABLED', "\n"; |
| [4792](#L4792) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [4793](#L4793) | echo 'AD BLOCKING DETECTION:   ', $ai\_wp\_data [AI\_ADB\_DETECTION] ? 'ENABLED' : 'DISABLED', "\n"; |
| [4794](#L4794) | echo 'DISABLED BY SHORTCODE:   ', isset ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_DISABLED]) ? 'YES' : "NO", "\n"; |
| [4795](#L4795) |  |
| [4796](#L4796) | if ($ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [4797](#L4797) | echo 'ADB ACTION:              '; |
| [4798](#L4798) | switch (get\_adb\_action (true)) { |
| [4799](#L4799) | case AI\_ADB\_ACTION\_NONE: |
| [4800](#L4800) | echo AI\_TEXT\_ENG\_NONE; |
| [4801](#L4801) | break; |
| [4802](#L4802) | case AI\_ADB\_ACTION\_MESSAGE: |
| [4803](#L4803) | echo AI\_TEXT\_ENG\_POPUP\_MESSAGE; |
| [4804](#L4804) | break; |
| [4805](#L4805) | case AI\_ADB\_ACTION\_REDIRECTION: |
| [4806](#L4806) | echo AI\_TEXT\_ENG\_REDIRECTION; |
| [4807](#L4807) | break; |
| [4808](#L4808) | } |
| [4809](#L4809) | echo "\n"; |
| [4810](#L4810) | echo 'ADB NO ACTION:           '; |
| [4811](#L4811) | switch (get\_adb\_no\_action (true)) { |
| [4812](#L4812) | case AI\_ADB\_NO\_ACTION\_NONE: |
| [4813](#L4813) | echo AI\_TEXT\_ENG\_NONE; |
| [4814](#L4814) | break; |
| [4815](#L4815) | case AI\_ADB\_NO\_ACTION\_LOGGED\_IN: |
| [4816](#L4816) | echo AI\_TEXT\_ENG\_DISPLAY\_LOGGED\_IN\_USERS; |
| [4817](#L4817) | break; |
| [4818](#L4818) | case AI\_ADB\_NO\_ACTION\_ADMINISTRATORS: |
| [4819](#L4819) | echo AI\_TEXT\_ENG\_DISPLAY\_ADMINISTRATORS; |
| [4820](#L4820) | break; |
| [4821](#L4821) | } |
| [4822](#L4822) | echo "\n"; |
| [4823](#L4823) | echo 'ADB DELAY ACTION:        ', get\_delay\_action (), "\n"; |
| [4824](#L4824) | echo 'ADB NO ACTION PERIOD:    ', get\_no\_action\_period (), "\n"; |
| [4825](#L4825) | echo 'ADB SELECTORS:           ', get\_adb\_selectors (true), "\n"; |
| [4826](#L4826) | if (function\_exists ('ai\_debug')) { |
| [4827](#L4827) | echo 'ADB DETECTION:           ', get\_adb\_detection () == AI\_ADB\_DETECTION\_ADVANCED ? 'ADVANCED' : 'STANDARD', "\n"; |
| [4828](#L4828) | } |
| [4829](#L4829) | echo 'ADB EXTERNAL SCRIPTS:    ', get\_adb\_external\_scripts () ? 'ON' : 'OFF', "\n"; |
| [4830](#L4830) |  |
| [4831](#L4831) | $redirection\_page = get\_redirection\_page (); |
| [4832](#L4832) | echo 'ADB REDIRECTION PAGE:    ', $redirection\_page != 0 ? get\_the\_title ($redirection\_page) . ' (' . get\_permalink ($redirection\_page) . ')' : 'Custom Url', "\n"; |
| [4833](#L4833) | echo 'ADB REDIRECTION URL:     ', get\_custom\_redirection\_url (), "\n"; |
| [4834](#L4834) | echo 'ADB MESSAGE:             ', str\_replace (array ("<!--", "-->"), array ("<!++", "++>"), $block\_object [AI\_ADB\_MESSAGE\_OPTION\_NAME]->ai\_getCode ()), "\n"; |
| [4835](#L4835) | echo 'ADB MESSAGE CSS:         ', get\_message\_css (), "\n"; |
| [4836](#L4836) | echo 'ADB OVERLAY CSS:         ', get\_overlay\_css (), "\n"; |
| [4837](#L4837) | echo 'ADB UNDISMISSIBLE:       ', get\_undismissible\_message (true) ? 'ON' : 'OFF', "\n"; |
| [4838](#L4838) | } |
| [4839](#L4839) | } |
| [4840](#L4840) |  |
| [4841](#L4841) | if (isset ($\_SERVER ['HTTP\_USER\_AGENT'])) { |
| [4842](#L4842) | echo 'USER AGENT:              ', $\_SERVER ['HTTP\_USER\_AGENT'], "\n"; |
| [4843](#L4843) | } |
| [4844](#L4844) |  |
| [4845](#L4845) | if (isset ($\_SERVER ['HTTP\_ACCEPT\_LANGUAGE'])) { |
| [4846](#L4846) | echo 'LANGUAGE:                ', $\_SERVER ['HTTP\_ACCEPT\_LANGUAGE'], "\n"; |
| [4847](#L4847) | } |
| [4848](#L4848) |  |
| [4849](#L4849) | if (isset ($ai\_wp\_data [AI\_CLIENTS]) && isset ($ai\_wp\_data [AI\_AGENT])) { |
| [4850](#L4850) | $agent = $ai\_wp\_data [AI\_AGENT]; |
| [4851](#L4851) | if (!empty ($ai\_wp\_data [AI\_CLIENTS])) { |
| [4852](#L4852) | $ai\_wp\_data [AI\_CLIENTS] = array\_unique ($ai\_wp\_data [AI\_CLIENTS]); |
| [4853](#L4853) | foreach ($ai\_wp\_data [AI\_CLIENTS] as $client) { |
| [4854](#L4854) | echo sprintf ("  %-23s", $client.':'), check\_client\_list ($client, true) ? 'YES' : 'NO', "\n"; |
| [4855](#L4855) | } |
| [4856](#L4856) | } |
| [4857](#L4857) | } |
| [4858](#L4858) |  |
| [4859](#L4859) | if (!empty ($filter\_hooks)) { |
| [4860](#L4860) | echo "\n"; |
| [4861](#L4861) | foreach ($filter\_hooks as $filter\_hook) { |
| [4862](#L4862) | echo "ACTIVE FILTER HOOK:      "; |
| [4863](#L4863) | foreach ($filter\_hook as $index => $filter\_hook\_data) { |
| [4864](#L4864) | if ($index != 0) echo ", "; |
| [4865](#L4865) | echo $filter\_hook\_data; |
| [4866](#L4866) | } |
| [4867](#L4867) | echo "\n"; |
| [4868](#L4868) | } |
| [4869](#L4869) | } |
| [4870](#L4870) |  |
| [4871](#L4871) | if (isset ($\_GET [AI\_URL\_DEBUG\_TRACKING]) && $\_GET [AI\_URL\_DEBUG\_TRACKING]) { |
| [4872](#L4872) | if ($log = get\_transient ('ai\_debug\_tracking')) { |
| [4873](#L4873) | echo 'TRACKING LOG:            ', "\n"; |
| [4874](#L4874) | echo $log; |
| [4875](#L4875) | echo "\n"; |
| [4876](#L4876) | } |
| [4877](#L4877) | } |
| [4878](#L4878) |  |
| [4879](#L4879) | echo "\n"; |
| [4880](#L4880) |  |
| [4881](#L4881) |  |
| [4882](#L4882) | //  if ($block\_object [AI\_HEADER\_OPTION\_NAME]->get\_enable\_manual ()) { |
| [4883](#L4883) | //    echo "HEADER CODE ========================================================\n"; |
| [4884](#L4884) | //    echo ai\_dump\_code ($block\_object [AI\_HEADER\_OPTION\_NAME]->ai\_getCode ()); |
| [4885](#L4885) | //    echo "\n====================================================================\n\n"; |
| [4886](#L4886) | //  } |
| [4887](#L4887) | //  if ($block\_object [AI\_FOOTER\_OPTION\_NAME]->get\_enable\_manual ()) { |
| [4888](#L4888) | //    echo "FOOTER CODE ========================================================\n"; |
| [4889](#L4889) | //    echo ai\_dump\_code ($block\_object [AI\_FOOTER\_OPTION\_NAME]->ai\_getCode ()); |
| [4890](#L4890) | //    echo "\n====================================================================\n\n"; |
| [4891](#L4891) | //  } |
| [4892](#L4892) |  |
| [4893](#L4893) | $default = new ai\_Block (1); |
| [4894](#L4894) |  |
| [4895](#L4895) | echo "BLOCK SETTINGS           Po Pa Ho Ca Ar Sr AMP Aj RE Fe 404 Wi Sh PHP\n"; |
| [4896](#L4896) | echo "                         st ge me t  ch ch     ax ST ed     dg or PHP\n"; |
| [4897](#L4897) | for ($block = 1; $block <= 96; $block ++) { |
| [4898](#L4898) | $obj = $block\_object [$block]; |
| [4899](#L4899) |  |
| [4900](#L4900) | $settings = ""; |
| [4901](#L4901) | $insertion\_settings = ''; |
| [4902](#L4902) | $alignment\_settings = ''; |
| [4903](#L4903) | $default\_settings = true; |
| [4904](#L4904) | //    $display\_type = ''; |
| [4905](#L4905) | foreach (array\_keys ($default->wp\_options) as $key){ |
| [4906](#L4906) | switch ($key) { |
| [4907](#L4907) | case AI\_OPTION\_CODE: |
| [4908](#L4908) | case AI\_OPTION\_BLOCK\_NAME: |
| [4909](#L4909) | continue 2; |
| [4910](#L4910) | case AI\_OPTION\_DISPLAY\_ON\_PAGES: |
| [4911](#L4911) | case AI\_OPTION\_DISPLAY\_ON\_POSTS: |
| [4912](#L4912) | case AI\_OPTION\_DISPLAY\_ON\_HOMEPAGE: |
| [4913](#L4913) | case AI\_OPTION\_DISPLAY\_ON\_CATEGORY\_PAGES: |
| [4914](#L4914) | case AI\_OPTION\_DISPLAY\_ON\_SEARCH\_PAGES: |
| [4915](#L4915) | case AI\_OPTION\_DISPLAY\_ON\_ARCHIVE\_PAGES: |
| [4916](#L4916) | case AI\_OPTION\_ENABLE\_AMP: |
| [4917](#L4917) | case AI\_OPTION\_ENABLE\_AJAX: |
| [4918](#L4918) | case AI\_OPTION\_ENABLE\_REST: |
| [4919](#L4919) | case AI\_OPTION\_ENABLE\_FEED: |
| [4920](#L4920) | case AI\_OPTION\_ENABLE\_404: |
| [4921](#L4921) | case AI\_OPTION\_ENABLE\_MANUAL: |
| [4922](#L4922) | case AI\_OPTION\_ENABLE\_WIDGET: |
| [4923](#L4923) | case AI\_OPTION\_ENABLE\_PHP\_CALL: |
| [4924](#L4924) | if ($obj->wp\_options [$key] != $default->wp\_options [$key]) $default\_settings = false; |
| [4925](#L4925) | continue 2; |
| [4926](#L4926) | } |
| [4927](#L4927) |  |
| [4928](#L4928) | //      if (gettype ($obj->wp\_options [$key]) == 'string' && gettype ($default->wp\_options [$key]) == 'integer') { |
| [4929](#L4929) | //        $default->wp\_options [$key] = strval ($default->wp\_options [$key]); |
| [4930](#L4930) | //      } |
| [4931](#L4931) | //      elseif (gettype ($obj->wp\_options [$key]) == 'integer' && gettype ($default->wp\_options [$key]) == 'string') { |
| [4932](#L4932) | //        $default->wp\_options [$key] = intval ($default->wp\_options [$key]); |
| [4933](#L4933) | //      } |
| [4934](#L4934) |  |
| [4935](#L4935) | //      if ($obj->wp\_options [$key] !== $default->wp\_options [$key]) { |
| [4936](#L4936) | if ($obj->wp\_options [$key] != $default->wp\_options [$key]) { |
| [4937](#L4937) | $default\_settings = false; |
| [4938](#L4938) | switch ($key) { |
| [4939](#L4939) | case AI\_OPTION\_AUTOMATIC\_INSERTION: |
| [4940](#L4940) | $insertion\_settings = $obj->get\_automatic\_insertion\_text (false, false); |
| [4941](#L4941) | break; |
| [4942](#L4942) | case AI\_OPTION\_SERVER\_SIDE\_INSERTION: |
| [4943](#L4943) | $settings .= "[" . $key . ": " . $obj->get\_automatic\_insertion\_text (true, false) . ']'; |
| [4944](#L4944) | break; |
| [4945](#L4945) | case AI\_OPTION\_ALIGNMENT\_TYPE: |
| [4946](#L4946) | $alignment\_settings = $obj->get\_alignment\_type\_text (false); |
| [4947](#L4947) | break; |
| [4948](#L4948) | case AI\_OPTION\_ENABLED\_ON\_WHICH\_PAGES: |
| [4949](#L4949) | $settings .= "[" . $key . ": " . $obj->get\_ad\_enabled\_on\_which\_pages\_text (false) . ']'; |
| [4950](#L4950) | break; |
| [4951](#L4951) | case AI\_OPTION\_ENABLED\_ON\_WHICH\_POSTS: |
| [4952](#L4952) | $settings .= "[" . $key . ": " . $obj->get\_ad\_enabled\_on\_which\_posts\_text (false) . ']'; |
| [4953](#L4953) | break; |
| [4954](#L4954) | case AI\_OPTION\_EXCEPTIONS\_FUNCTION: |
| [4955](#L4955) | $settings .= "[" . $key . ": " . $obj->get\_exceptions\_function\_text (false) . ']'; |
| [4956](#L4956) | break; |
| [4957](#L4957) | case AI\_OPTION\_FILTER\_TYPE: |
| [4958](#L4958) | $settings .= "[" . $key . ": " . $obj->get\_filter\_type\_text (false) . ']'; |
| [4959](#L4959) | break; |
| [4960](#L4960) | case AI\_OPTION\_AVOID\_ACTION: |
| [4961](#L4961) | $settings .= "[" . $key . ": " . $obj->get\_avoid\_action\_text (false) . ']'; |
| [4962](#L4962) | break; |
| [4963](#L4963) | case AI\_OPTION\_AVOID\_DIRECTION: |
| [4964](#L4964) | $settings .= "[" . $key . ": " . $obj->get\_avoid\_direction\_text (false) . ']'; |
| [4965](#L4965) | break; |
| [4966](#L4966) | case AI\_OPTION\_DIRECTION\_TYPE: |
| [4967](#L4967) | $settings .= "[" . $key . ": " . $obj->get\_direction\_type\_text (false) . ']'; |
| [4968](#L4968) | break; |
| [4969](#L4969) | case AI\_OPTION\_PARAGRAPH\_TEXT\_TYPE: |
| [4970](#L4970) | $settings .= "[" . $key . ": " . $obj->get\_paragraph\_text\_type\_text (false) . ']'; |
| [4971](#L4971) | break; |
| [4972](#L4972) | case AI\_OPTION\_COUNT\_INSIDE: |
| [4973](#L4973) | $settings .= "[" . $key . ": " . $obj->get\_count\_inside\_text (false) . ']'; |
| [4974](#L4974) | break; |
| [4975](#L4975) | case AI\_OPTION\_COUNT\_INSIDE\_ELEMENTS\_CONTAIN: |
| [4976](#L4976) | $settings .= "[" . $key . ": " . $obj->get\_count\_inside\_elements\_contain\_text (false) . ']'; |
| [4977](#L4977) | break; |
| [4978](#L4978) | case AI\_OPTION\_DISPLAY\_FOR\_USERS: |
| [4979](#L4979) | $settings .= "[" . $key . ": " . $obj->get\_display\_for\_users\_text (false) . ']'; |
| [4980](#L4980) | break; |
| [4981](#L4981) | case AI\_OPTION\_DISPLAY\_FOR\_DEVICES: |
| [4982](#L4982) | $settings .= "[" . $key . ": " . $obj->get\_display\_for\_devices\_text (false) . ']'; |
| [4983](#L4983) | break; |
| [4984](#L4984) | case AI\_OPTION\_PARAGRAPH\_TEXT: |
| [4985](#L4985) | case AI\_OPTION\_COUNT\_INSIDE\_ELEMENTS\_TEXT: |
| [4986](#L4986) | case AI\_OPTION\_AVOID\_TEXT\_ABOVE: |
| [4987](#L4987) | case AI\_OPTION\_AVOID\_TEXT\_BELOW: |
| [4988](#L4988) | case AI\_OPTION\_HTML\_SELECTOR: |
| [4989](#L4989) | if ($write\_processing\_log) |
| [4990](#L4990) | $settings .= "[" . $key . ": " . ai\_log\_filter\_content (html\_entity\_decode ($obj->wp\_options [$key])) . ']'; else |
| [4991](#L4991) | $settings .= "[" . $key . ": " . $obj->wp\_options [$key] . ']'; |
| [4992](#L4992) | break; |
| [4993](#L4993) | default: |
| [4994](#L4994) | $settings .= "[" . $key . ": " . $obj->wp\_options [$key] . ']'; |
| [4995](#L4995) | break; |
| [4996](#L4996) | } |
| [4997](#L4997) |  |
| [4998](#L4998) | //        $settings .= ' ['.gettype ($obj->wp\_options [$key]).':'.$obj->wp\_options [$key].'#'.gettype ($default->wp\_options [$key]).':'.$default->wp\_options [$key].'] '; |
| [4999](#L4999) |  |
| [5000](#L5000) | } else |
| [5001](#L5001) | switch ($key) { |
| [5002](#L5002) | case AI\_OPTION\_AUTOMATIC\_INSERTION: |
| [5003](#L5003) | $insertion\_settings = $obj->get\_automatic\_insertion\_text (false, false); |
| [5004](#L5004) | break; |
| [5005](#L5005) | case AI\_OPTION\_ALIGNMENT\_TYPE: |
| [5006](#L5006) | $alignment\_settings = $obj->get\_alignment\_type\_text (false); |
| [5007](#L5007) | break; |
| [5008](#L5008) | } |
| [5009](#L5009) | } |
| [5010](#L5010) | if ($default\_settings && $settings == '') continue; |
| [5011](#L5011) | $settings = ' [' . $insertion\_settings . '][' . $alignment\_settings . ']' . $settings; |
| [5012](#L5012) |  |
| [5013](#L5013) | echo sprintf ("%2d %-21s ", $block, $ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_substr ($obj->get\_ad\_name(), 0, 21) : substr ($obj->get\_ad\_name(), 0, 21)); |
| [5014](#L5014) |  |
| [5015](#L5015) | echo $obj->get\_display\_settings\_post()     ? "o" : ".", "  "; |
| [5016](#L5016) | echo $obj->get\_display\_settings\_page()     ? "o" : ".", "  "; |
| [5017](#L5017) | echo $obj->get\_display\_settings\_home()     ? "o" : ".", "  "; |
| [5018](#L5018) | echo $obj->get\_display\_settings\_category() ? "o" : ".", "  "; |
| [5019](#L5019) | echo $obj->get\_display\_settings\_archive()  ? "o" : ".", "  "; |
| [5020](#L5020) | echo $obj->get\_display\_settings\_search()   ? "o" : ".", "  "; |
| [5021](#L5021) | echo $obj->get\_enable\_amp()                ? "o" : ".", "   "; |
| [5022](#L5022) | echo $obj->get\_enable\_ajax()               ? "o" : ".", "  "; |
| [5023](#L5023) | echo $obj->get\_enable\_rest()               ? "o" : ".", "  "; |
| [5024](#L5024) | echo $obj->get\_enable\_feed()               ? "o" : ".", "  "; |
| [5025](#L5025) | echo $obj->get\_enable\_404()                ? "o" : ".", "   "; |
| [5026](#L5026) | echo $obj->get\_enable\_widget()             ? "x" : ".", "  "; |
| [5027](#L5027) | echo $obj->get\_enable\_manual()             ? "x" : ".", "  "; |
| [5028](#L5028) | echo $obj->get\_enable\_php\_call()           ? "x" : ".", "  "; |
| [5029](#L5029) |  |
| [5030](#L5030) | echo $settings, "\n"; |
| [5031](#L5031) | } |
| [5032](#L5032) | echo "\n"; |
| [5033](#L5033) |  |
| [5034](#L5034) |  |
| [5035](#L5035) | $args = array ( |
| [5036](#L5036) | 'public'    => true, |
| [5037](#L5037) | '\_builtin'  => false |
| [5038](#L5038) | ); |
| [5039](#L5039) | $custom\_post\_types = get\_post\_types ($args, 'names', 'and'); |
| [5040](#L5040) | $screens = array\_values (array\_merge (array ('post', 'page'), $custom\_post\_types)); |
| [5041](#L5041) |  |
| [5042](#L5042) | $args = array ( |
| [5043](#L5043) | 'posts\_per\_page'   => AI\_LIST\_EXCEPTIONS\_LIMIT, |
| [5044](#L5044) | 'offset'           => 0, |
| [5045](#L5045) | 'category'         => '', |
| [5046](#L5046) | 'category\_name'    => '', |
| [5047](#L5047) | 'orderby'          => 'type', |
| [5048](#L5048) | 'order'            => 'ASC', |
| [5049](#L5049) | 'include'          => '', |
| [5050](#L5050) | 'exclude'          => '', |
| [5051](#L5051) | 'meta\_query' => array ( |
| [5052](#L5052) | array ( |
| [5053](#L5053) | 'key' => '\_adinserter\_block\_exceptions', |
| [5054](#L5054) | 'value' => '', |
| [5055](#L5055) | 'compare' => '!=' |
| [5056](#L5056) | ) |
| [5057](#L5057) | ), |
| [5058](#L5058) | 'post\_type'        => $screens, |
| [5059](#L5059) | 'post\_mime\_type'   => '', |
| [5060](#L5060) | 'post\_parent'      => '', |
| [5061](#L5061) | 'author'           => '', |
| [5062](#L5062) | 'author\_name'      => '', |
| [5063](#L5063) | 'post\_status'      => '', |
| [5064](#L5064) | 'suppress\_filters' => true |
| [5065](#L5065) | ); |
| [5066](#L5066) | $posts\_pages = get\_posts ($args); |
| [5067](#L5067) |  |
| [5068](#L5068) | if (count ($posts\_pages) != 0) { |
| [5069](#L5069) | echo "EXCEPTIONS FOR BLOCKS    ID     TYPE                      TITLE                                                            URL\n"; |
| [5070](#L5070) | foreach ($posts\_pages as $page) { |
| [5071](#L5071) | $post\_meta = get\_post\_meta ($page->ID, '\_adinserter\_block\_exceptions', true); |
| [5072](#L5072) | if ($post\_meta == '') continue; |
| [5073](#L5073) | $post\_type\_object = get\_post\_type\_object ($page->post\_type); |
| [5074](#L5074) | echo sprintf ("%-24s %-6s %-24s  %-64s %s", $post\_meta, $page->ID, $post\_type\_object->labels->singular\_name, mb\_substr ($page->post\_title, 0, 64), get\_permalink ($page->ID)), "\n"; |
| [5075](#L5075) | } |
| [5076](#L5076) | echo "\n"; |
| [5077](#L5077) | } |
| [5078](#L5078) |  |
| [5079](#L5079) | echo "TOTAL BLOCKS\n"; |
| [5080](#L5080) | if (count ($ai\_db\_options\_extract [ABOVE\_HEADER\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5081](#L5081) | echo "ABOVE HEADER:            ", implode (", ", $ai\_db\_options\_extract [ABOVE\_HEADER\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5082](#L5082) | if (count ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5083](#L5083) | echo "CONTENT HOOK:            ", implode (", ", $ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5084](#L5084) | if (count ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5085](#L5085) | echo "EXCERPT HOOK:            ", implode (", ", $ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5086](#L5086) | if (count ($ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5087](#L5087) | echo "LOOP START HOOK:         ", implode (", ", $ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5088](#L5088) | if (count ($ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5089](#L5089) | echo "LOOP END HOOK:           ", implode (", ", $ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5090](#L5090) | if (count ($ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5091](#L5091) | echo "POST HOOK:               ", implode (", ", $ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5092](#L5092) | if (count ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5093](#L5093) | echo "BEFORE COMMENTS HOOK:     ", implode (", ", $ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5094](#L5094) | if (count ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5095](#L5095) | echo "BETWEEN COMMENTS HOOK    ", implode (", ", $ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5096](#L5096) | if (count ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5097](#L5097) | echo "AFTER COMMENTS HOOK:     ", implode (", ", $ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5098](#L5098) | if (count ($ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5099](#L5099) | echo "FOOTER HOOK:             ", implode (", ", $ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5100](#L5100) | foreach ($ai\_custom\_hooks as $index => $custom\_hook) { |
| [5101](#L5101) |  |
| [5102](#L5102) | switch ($custom\_hook ['action']) { |
| [5103](#L5103) | case 'wp\_footer': |
| [5104](#L5104) | //      case 'wp\_head': |
| [5105](#L5105) | case 'the\_content': |
| [5106](#L5106) | case 'the\_excerpt': |
| [5107](#L5107) | case 'loop\_start': |
| [5108](#L5108) | case 'loop\_end': |
| [5109](#L5109) | //      case 'the\_post': |
| [5110](#L5110) | continue 2; |
| [5111](#L5111) | } |
| [5112](#L5112) |  |
| [5113](#L5113) | if (count ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][AI\_PT\_ANY])) { |
| [5114](#L5114) | $blocks\_using\_hook = array (); |
| [5115](#L5115) | foreach ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [5116](#L5116) | $obj = $block\_object [$block]; |
| [5117](#L5117) | if ($obj->get\_automatic\_insertion () == AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $custom\_hook ['index'] - 1) { |
| [5118](#L5118) | $blocks\_using\_hook [] = $block; |
| [5119](#L5119) | } |
| [5120](#L5120) | } |
| [5121](#L5121) |  |
| [5122](#L5122) | if (!empty ($blocks\_using\_hook)) { |
| [5123](#L5123) | echo substr (strtoupper (str\_replace (array ('&lt;', '&gt;'), array ('<', '>'), get\_hook\_name ($custom\_hook ['index']))) . " HOOK:                   ", 0, 25), implode (", ", $blocks\_using\_hook), "\n"; |
| [5124](#L5124) | } |
| [5125](#L5125) | } |
| [5126](#L5126) | } |
| [5127](#L5127) | if (count ($ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][AI\_PT\_ANY])) |
| [5128](#L5128) | echo "HTML ELEMENT:            ", implode (", ", $ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][AI\_PT\_ANY]), "\n"; |
| [5129](#L5129) |  |
| [5130](#L5130) | echo "\nBLOCKS FOR THIS PAGE TYPE\n"; |
| [5131](#L5131) | if (isset ($ai\_db\_options\_extract [ABOVE\_HEADER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [ABOVE\_HEADER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5132](#L5132) | echo "ABOVE HEADER:            ", implode (", ", $ai\_db\_options\_extract [ABOVE\_HEADER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5133](#L5133) | if (isset ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5134](#L5134) | echo "CONTENT HOOK:            ", implode (", ", $ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5135](#L5135) | if (isset ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5136](#L5136) | echo "EXCERPT HOOK:            ", implode (", ", $ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5137](#L5137) | if (isset ($ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5138](#L5138) | echo "LOOP START HOOK:         ", implode (", ", $ai\_db\_options\_extract [LOOP\_START\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5139](#L5139) | if (isset ($ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5140](#L5140) | echo "LOOP END HOOK:           ", implode (", ", $ai\_db\_options\_extract [LOOP\_END\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5141](#L5141) | if (isset ($ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5142](#L5142) | echo "POST HOOK:               ", implode (", ", $ai\_db\_options\_extract [POST\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5143](#L5143) | if (isset ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5144](#L5144) | echo "AFTER COMMENTS HOOK:     ", implode (", ", $ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5145](#L5145) | if (isset ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5146](#L5146) | echo "BETWEEN COMMENTS HOOK:   ", implode (", ", $ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5147](#L5147) | if (isset ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5148](#L5148) | echo "AFTER COMMENTS HOOK:     ", implode (", ", $ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5149](#L5149) | if (isset ($ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5150](#L5150) | echo "FOOTER HOOK              ", implode (", ", $ai\_db\_options\_extract [FOOTER\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5151](#L5151) | foreach ($ai\_custom\_hooks as $index => $custom\_hook) { |
| [5152](#L5152) |  |
| [5153](#L5153) | switch ($custom\_hook ['action']) { |
| [5154](#L5154) | case 'wp\_footer': |
| [5155](#L5155) | //      case 'wp\_head': |
| [5156](#L5156) | case 'the\_content': |
| [5157](#L5157) | case 'the\_excerpt': |
| [5158](#L5158) | case 'loop\_start': |
| [5159](#L5159) | case 'loop\_end': |
| [5160](#L5160) | //      case 'the\_post': |
| [5161](#L5161) | continue 2; |
| [5162](#L5162) | } |
| [5163](#L5163) |  |
| [5164](#L5164) | if (isset ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) { |
| [5165](#L5165) | $blocks\_using\_hook = array (); |
| [5166](#L5166) | foreach ($ai\_db\_options\_extract [$custom\_hook ['action'] . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [5167](#L5167) | $obj = $block\_object [$block]; |
| [5168](#L5168) | if ($obj->get\_automatic\_insertion () == AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + $custom\_hook ['index'] - 1) { |
| [5169](#L5169) | $blocks\_using\_hook [] = $block; |
| [5170](#L5170) | } |
| [5171](#L5171) | } |
| [5172](#L5172) |  |
| [5173](#L5173) | if (!empty ($blocks\_using\_hook)) { |
| [5174](#L5174) | echo substr (strtoupper (str\_replace (array ('&lt;', '&gt;'), array ('<', '>'), get\_hook\_name ($custom\_hook ['index']))) . " HOOK:                   ", 0, 25), implode (", ", $blocks\_using\_hook), "\n"; |
| [5175](#L5175) | } |
| [5176](#L5176) | } |
| [5177](#L5177) | } |
| [5178](#L5178) | if (isset ($ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && count ($ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [5179](#L5179) | echo "HTML ELEMENT:            ", implode (", ", $ai\_db\_options\_extract [HTML\_ELEMENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]), "\n"; |
| [5180](#L5180) |  |
| [5181](#L5181) | echo "\nDISABLED BLOCKS:         ", isset ($ai\_wp\_data [AI\_DISABLED\_BLOCKS]) ? implode (', ', $ai\_wp\_data [AI\_DISABLED\_BLOCKS]) : '', "\n"; |
| [5182](#L5182) |  |
| [5183](#L5183) | if ($write\_processing\_log) { |
| [5184](#L5184) | echo "\nTIME  EVENT\n"; |
| [5185](#L5185) | echo "======================================\n"; |
| [5186](#L5186) |  |
| [5187](#L5187) | foreach ($ai\_processing\_log as $log\_line) { |
| [5188](#L5188) | echo $log\_line, "\n"; |
| [5189](#L5189) | } |
| [5190](#L5190) |  |
| [5191](#L5191) | sort ($block\_insertion\_log); |
| [5192](#L5192) | echo "\nINSERTION SUMMARY\n"; |
| [5193](#L5193) | echo "======================================\n"; |
| [5194](#L5194) | foreach ($block\_insertion\_log as $log\_line) { |
| [5195](#L5195) | echo substr ($log\_line, 3), "\n"; |
| [5196](#L5196) | } |
| [5197](#L5197) |  |
| [5198](#L5198) | echo "\n\n"; |
| [5199](#L5199) |  |
| [5200](#L5200) |  |
| [5201](#L5201) | echo "SERVER\_ADDR:             ", isset ($\_SERVER ['SERVER\_ADDR']) ? $\_SERVER ['SERVER\_ADDR'] : '', "\n"; |
| [5202](#L5202) | echo "HTTP\_CF\_CONNECTING\_IP:   ", isset ($\_SERVER ['HTTP\_CF\_CONNECTING\_IP']) ? $\_SERVER ['HTTP\_CF\_CONNECTING\_IP'] : '', "\n"; |
| [5203](#L5203) | echo "HTTP\_CLIENT\_IP:          ", isset ($\_SERVER ['HTTP\_CLIENT\_IP']) ? $\_SERVER ['HTTP\_CLIENT\_IP'] : '', "\n"; |
| [5204](#L5204) | echo "HTTP\_INCAP\_CLIENT\_IP:    ", isset ($\_SERVER ['HTTP\_INCAP\_CLIENT\_IP']) ? $\_SERVER ['HTTP\_INCAP\_CLIENT\_IP'] : '', "\n"; |
| [5205](#L5205) | echo "HTTP\_X\_FORWARDED\_FOR:    ", isset ($\_SERVER ['HTTP\_X\_FORWARDED\_FOR']) ? $\_SERVER ['HTTP\_X\_FORWARDED\_FOR'] : '', "\n"; |
| [5206](#L5206) | echo "HTTP\_X\_FORWARDED:        ", isset ($\_SERVER ['HTTP\_X\_FORWARDED']) ? $\_SERVER ['HTTP\_X\_FORWARDED'] : '', "\n"; |
| [5207](#L5207) | echo "HTTP\_X\_CLUSTER\_CLIENT\_IP:", isset ($\_SERVER ['HTTP\_X\_CLUSTER\_CLIENT\_IP']) ? $\_SERVER ['HTTP\_X\_CLUSTER\_CLIENT\_IP'] : '', "\n"; |
| [5208](#L5208) | echo "HTTP\_FORWARDED\_FOR:      ", isset ($\_SERVER ['HTTP\_FORWARDED\_FOR']) ? $\_SERVER ['HTTP\_FORWARDED\_FOR'] : '', "\n"; |
| [5209](#L5209) | echo "HTTP\_FORWARDED:          ", isset ($\_SERVER ['HTTP\_FORWARDED']) ? $\_SERVER ['HTTP\_FORWARDED'] : '', "\n"; |
| [5210](#L5210) | echo "REMOTE\_ADDR:             ", isset ($\_SERVER ['REMOTE\_ADDR']) ? $\_SERVER ['REMOTE\_ADDR'] : '', "\n"; |
| [5211](#L5211) |  |
| [5212](#L5212) | echo "\n"; |
| [5213](#L5213) |  |
| [5214](#L5214) | echo 'AI\_NO\_PHP\_PROCESSING:    ', defined ('AI\_NO\_PHP\_PROCESSING')       ? 'SET'  : "NO", "\n"; |
| [5215](#L5215) | echo 'DISALLOW\_FILE\_EDIT:      ', defined ('DISALLOW\_FILE\_EDIT') && DISALLOW\_FILE\_EDIT ? 'SET'  : "NO", "\n"; |
| [5216](#L5216) | echo 'DISALLOW\_FILE\_MODS:      ', defined ('DISALLOW\_FILE\_MODS') && DISALLOW\_FILE\_MODS ? 'SET'  : "NO", "\n"; |
| [5217](#L5217) | echo 'DISALLOW\_UNFILTERED\_HTML:', defined ('DISALLOW\_UNFILTERED\_HTML') && DISALLOW\_UNFILTERED\_HTML ? 'SET'  : "NO", "\n"; |
| [5218](#L5218) | echo 'AI\_NO\_ADSENSE\_API:       ', defined ('AI\_NO\_ADSENSE\_API') ? 'SET'  : "NO", "\n"; |
| [5219](#L5219) |  |
| [5220](#L5220) | echo "\n"; |
| [5221](#L5221) |  |
| [5222](#L5222) | echo 'W3TC\_DYNAMIC\_SECURITY:   ', defined ('W3TC\_DYNAMIC\_SECURITY') ? 'SET'  : "NO", "\n"; |
| [5223](#L5223) |  |
| [5224](#L5224) | echo "\n"; |
| [5225](#L5225) |  |
| [5226](#L5226) | echo "MULTISITE:               ", is\_multisite() ? "YES" : "NO", "\n"; |
| [5227](#L5227) | if (is\_multisite()) { |
| [5228](#L5228) | echo "MAIN SITE:               ", is\_main\_site () ? "YES" : "NO", "\n"; |
| [5229](#L5229) | echo "SITE COUNT:              ", get\_blog\_count(), "\n"; |
| [5230](#L5230) | } |
| [5231](#L5231) |  |
| [5232](#L5232) | echo "OPTIONS DATABASE TABLE:  ", $wpdb->prefix, "options\n"; |
| [5233](#L5233) |  |
| [5234](#L5234) | if (function\_exists ('ai\_debug\_features\_2')) ai\_debug\_features\_2 (); |
| [5235](#L5235) | else echo "\n"; |
| [5236](#L5236) |  |
| [5237](#L5237) | echo "mbstring:                ", $ai\_wp\_data [AI\_MBSTRING\_LOADED] ? 'LOADED' : 'NO', "\n"; |
| [5238](#L5238) | echo "Default charset:         ", ini\_get ("default\_charset"), "\n"; |
| [5239](#L5239) | echo "Memory Limit:            ", ini\_get ('memory\_limit'), "\n"; |
| [5240](#L5240) | echo "Upload Max Filesize:     ", ini\_get ('upload\_max\_filesize'), "\n"; |
| [5241](#L5241) | echo "Post Max Size:           ", ini\_get ('post\_max\_size'), "\n"; |
| [5242](#L5242) | echo "Max Execution Time:      ", ini\_get ('max\_execution\_time'), "\n"; |
| [5243](#L5243) | echo "Max Input Vars:          ", ini\_get ('max\_input\_vars'), "\n"; |
| [5244](#L5244) | echo "Display Errors:          ", ini\_get ('display\_errors'), "\n"; |
| [5245](#L5245) | echo "cURL:                    ", function\_exists ('curl\_version') ? 'ENABLED' : 'DISABLED', "\n"; |
| [5246](#L5246) | echo "fsockopen:               ", function\_exists ('fsockopen') ? 'ENABLED' : 'DISABLED', "\n"; |
| [5247](#L5247) | echo "DOMDocument:             ", class\_exists ('DOMDocument') ? 'YES' : 'NO', "\n"; |
| [5248](#L5248) | echo "\n\n"; |
| [5249](#L5249) |  |
| [5250](#L5250) | global $wp\_version; |
| [5251](#L5251) | echo "Wordpress:               ", $wp\_version, "\n"; |
| [5252](#L5252) | $current\_theme = wp\_get\_theme(); |
| [5253](#L5253) |  |
| [5254](#L5254) | echo "Current Theme:           ", $current\_theme->get ('Name') . " " . $current\_theme->get ('Version'), "\n"; |
| [5255](#L5255) |  |
| [5256](#L5256) | if (function\_exists ('ai\_debug\_features\_3')) ai\_debug\_features\_3 (); |
| [5257](#L5257) | } |
| [5258](#L5258) |  |
| [5259](#L5259) | $log = ob\_get\_clean (); |
| [5260](#L5260) |  |
| [5261](#L5261) | $log = str\_replace (array ('<', '>'), array ('&lt;', '&gt;'), $log); |
| [5262](#L5262) | echo $log; |
| [5263](#L5263) | } |
| [5264](#L5264) |  |
| [5265](#L5265) | function ai\_shutdown\_hook () { |
| [5266](#L5266) | global $ai\_wp\_data, $ad\_inserter\_globals; |
| [5267](#L5267) |  |
| [5268](#L5268) | $global\_name = implode ('\_', array ( |
| [5269](#L5269) | 'AI', |
| [5270](#L5270) | 'STATUS') |
| [5271](#L5271) | ); |
| [5272](#L5272) |  |
| [5273](#L5273) | if (function\_exists ('ai\_system\_output')) ai\_system\_output (); |
| [5274](#L5274) |  |
| [5275](#L5275) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0 && (get\_remote\_debugging () || (isset ($ad\_inserter\_globals [$global\_name]) && $ad\_inserter\_globals [$global\_name] == 1) || ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0)) { |
| [5276](#L5276) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_HOMEPAGE || |
| [5277](#L5277) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC || |
| [5278](#L5278) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || |
| [5279](#L5279) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_CATEGORY || |
| [5280](#L5280) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_SEARCH || |
| [5281](#L5281) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_ARCHIVE || |
| [5282](#L5282) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_404 || |
| [5283](#L5283) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_NONE || |
| [5284](#L5284) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_REST || |
| [5285](#L5285) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_ANY) { |
| [5286](#L5286) | echo "\n<!--\n\n"; |
| [5287](#L5287) | ai\_write\_debug\_info (true); |
| [5288](#L5288) | echo "\n-->\n"; |
| [5289](#L5289) | } |
| [5290](#L5290) | } |
| [5291](#L5291) | } |
| [5292](#L5292) |  |
| [5293](#L5293) | function ai\_activation\_hook () { |
| [5294](#L5294) | ai\_add\_rewrite\_rules (); |
| [5295](#L5295) | flush\_rewrite\_rules(); |
| [5296](#L5296) | } |
| [5297](#L5297) |  |
| [5298](#L5298) | function ai\_deactivation\_hook () { |
| [5299](#L5299) | flush\_rewrite\_rules(); |
| [5300](#L5300) | } |
| [5301](#L5301) |  |
| [5302](#L5302) |  |
| [5303](#L5303) | function ai\_check\_multisite\_options (&$multisite\_options) { |
| [5304](#L5304) | if (!isset ($multisite\_options ['MULTISITE\_SETTINGS\_PAGE']))      $multisite\_options ['MULTISITE\_SETTINGS\_PAGE']      = DEFAULT\_MULTISITE\_SETTINGS\_PAGE; |
| [5305](#L5305) | if (!isset ($multisite\_options ['MULTISITE\_WIDGETS']))            $multisite\_options ['MULTISITE\_WIDGETS']            = DEFAULT\_MULTISITE\_WIDGETS; |
| [5306](#L5306) | if (!isset ($multisite\_options ['MULTISITE\_PHP\_PROCESSING']))     $multisite\_options ['MULTISITE\_PHP\_PROCESSING']     = DEFAULT\_MULTISITE\_PHP\_PROCESSING; |
| [5307](#L5307) | if (!isset ($multisite\_options ['MULTISITE\_EXCEPTIONS']))         $multisite\_options ['MULTISITE\_EXCEPTIONS']         = DEFAULT\_MULTISITE\_EXCEPTIONS; |
| [5308](#L5308) | if (!isset ($multisite\_options ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'])) $multisite\_options ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'] = DEFAULT\_MULTISITE\_MAIN\_FOR\_ALL\_BLOGS; |
| [5309](#L5309) | if (!isset ($multisite\_options ['MULTISITE\_SITE\_ADMIN\_PAGE']))    $multisite\_options ['MULTISITE\_SITE\_ADMIN\_PAGE']    = DEFAULT\_MULTISITE\_SITE\_ADMIN\_PAGE; |
| [5310](#L5310) |  |
| [5311](#L5311) | if (function\_exists ('ai\_check\_multisite\_options\_2')) ai\_check\_multisite\_options\_2 ($multisite\_options); |
| [5312](#L5312) | } |
| [5313](#L5313) |  |
| [5314](#L5314) | function ai\_check\_limits ($value, $min, $max, $default) { |
| [5315](#L5315) | if (!is\_numeric ($value)) { |
| [5316](#L5316) | $value = $default; |
| [5317](#L5317) | } |
| [5318](#L5318) | $value = intval ($value); |
| [5319](#L5319) | if ($value < $min) { |
| [5320](#L5320) | $value = $min; |
| [5321](#L5321) | } |
| [5322](#L5322) | if ($value > $max) { |
| [5323](#L5323) | $value = $max; |
| [5324](#L5324) | } |
| [5325](#L5325) | return $value; |
| [5326](#L5326) | } |
| [5327](#L5327) |  |
| [5328](#L5328) | function ai\_check\_plugin\_options ($plugin\_options = array ()) { |
| [5329](#L5329) | global $version\_string; |
| [5330](#L5330) |  |
| [5331](#L5331) | $plugin\_options ['VERSION'] = $version\_string; |
| [5332](#L5332) |  |
| [5333](#L5333) | if (!isset ($plugin\_options ['SYNTAX\_HIGHLIGHTER\_THEME']))      $plugin\_options ['SYNTAX\_HIGHLIGHTER\_THEME']      = DEFAULT\_SYNTAX\_HIGHLIGHTER\_THEME; |
| [5334](#L5334) |  |
| [5335](#L5335) | if (!isset ($plugin\_options ['BLOCK\_CLASS\_NAME']))              $plugin\_options ['BLOCK\_CLASS\_NAME']              = DEFAULT\_BLOCK\_CLASS\_NAME; |
| [5336](#L5336) | if (!isset ($plugin\_options ['BLOCK\_CLASS']))                   $plugin\_options ['BLOCK\_CLASS']                   = DEFAULT\_BLOCK\_CLASS; |
| [5337](#L5337) | if (!isset ($plugin\_options ['BLOCK\_NUMBER\_CLASS']))            $plugin\_options ['BLOCK\_NUMBER\_CLASS']            = DEFAULT\_BLOCK\_NUMBER\_CLASS; |
| [5338](#L5338) | if (!isset ($plugin\_options ['BLOCK\_NAME\_CLASS']))              $plugin\_options ['BLOCK\_NAME\_CLASS']              = DEFAULT\_BLOCK\_NAME\_CLASS; |
| [5339](#L5339) | if (!isset ($plugin\_options ['INLINE\_STYLES']))                 $plugin\_options ['INLINE\_STYLES']                 = DEFAULT\_INLINE\_STYLES; |
| [5340](#L5340) |  |
| [5341](#L5341) | if (!isset ($plugin\_options ['MINIMUM\_USER\_ROLE']))             $plugin\_options ['MINIMUM\_USER\_ROLE']             = DEFAULT\_MINIMUM\_USER\_ROLE; |
| [5342](#L5342) |  |
| [5343](#L5343) | if (!isset ($plugin\_options ['STICKY\_WIDGET\_MODE']))            $plugin\_options ['STICKY\_WIDGET\_MODE']            = DEFAULT\_STICKY\_WIDGET\_MODE; |
| [5344](#L5344) |  |
| [5345](#L5345) | if (!isset ($plugin\_options ['STICKY\_WIDGET\_MARGIN']))          $plugin\_options ['STICKY\_WIDGET\_MARGIN']          = DEFAULT\_STICKY\_WIDGET\_MARGIN; |
| [5346](#L5346) | $plugin\_options ['STICKY\_WIDGET\_MARGIN'] =                      ai\_check\_limits ($plugin\_options ['STICKY\_WIDGET\_MARGIN'], 0, 999, DEFAULT\_STICKY\_WIDGET\_MARGIN); |
| [5347](#L5347) |  |
| [5348](#L5348) | if (!isset ($plugin\_options ['LAZY\_LOADING\_OFFSET']))           $plugin\_options ['LAZY\_LOADING\_OFFSET']           = DEFAULT\_LAZY\_LOADING\_OFFSET; |
| [5349](#L5349) | $plugin\_options ['LAZY\_LOADING\_OFFSET'] =                       ai\_check\_limits ($plugin\_options ['LAZY\_LOADING\_OFFSET'], 0, 9999, DEFAULT\_LAZY\_LOADING\_OFFSET); |
| [5350](#L5350) |  |
| [5351](#L5351) | if (!isset ($plugin\_options ['MAX\_PAGE\_BLOCKS']))               $plugin\_options ['MAX\_PAGE\_BLOCKS']               = DEFAULT\_MAX\_PAGE\_BLOCKS; |
| [5352](#L5352) | $plugin\_options ['MAX\_PAGE\_BLOCKS'] =                           ai\_check\_limits ($plugin\_options ['MAX\_PAGE\_BLOCKS'], 0, 9999, DEFAULT\_MAX\_PAGE\_BLOCKS); |
| [5353](#L5353) |  |
| [5354](#L5354) | if (!isset ($plugin\_options ['PLUGIN\_PRIORITY']))               $plugin\_options ['PLUGIN\_PRIORITY']               = DEFAULT\_PLUGIN\_PRIORITY; |
| [5355](#L5355) | $plugin\_options ['PLUGIN\_PRIORITY'] =                           ai\_check\_limits ($plugin\_options ['PLUGIN\_PRIORITY'], 0, 999999, DEFAULT\_PLUGIN\_PRIORITY); |
| [5356](#L5356) |  |
| [5357](#L5357) | if (!isset ($plugin\_options ['MAX\_LIST\_ITEMS']))                $plugin\_options ['MAX\_LIST\_ITEMS']                = DEFAULT\_MAX\_LIST\_ITEMS; |
| [5358](#L5358) | $plugin\_options ['MAX\_LIST\_ITEMS'] =                            ai\_check\_limits ($plugin\_options ['MAX\_LIST\_ITEMS'], 100, 99999, DEFAULT\_MAX\_LIST\_ITEMS); |
| [5359](#L5359) |  |
| [5360](#L5360) | if (!isset ($plugin\_options ['TAB\_SETUP\_DELAY']))               $plugin\_options ['TAB\_SETUP\_DELAY']               = DEFAULT\_TAB\_SETUP\_DELAY; |
| [5361](#L5361) | $plugin\_options ['TAB\_SETUP\_DELAY'] =                           ai\_check\_limits ($plugin\_options ['TAB\_SETUP\_DELAY'], 0, 9999, DEFAULT\_TAB\_SETUP\_DELAY); |
| [5362](#L5362) |  |
| [5363](#L5363) |  |
| [5364](#L5364) | if (!isset ($plugin\_options ['CLICK\_FRAUD\_PROTECTION']))        $plugin\_options ['CLICK\_FRAUD\_PROTECTION']        = DEFAULT\_CLICK\_FRAUD\_PROTECTION; |
| [5365](#L5365) | if (!isset ($plugin\_options ['CLICK\_FRAUD\_PROTECTION\_TIME']))   $plugin\_options ['CLICK\_FRAUD\_PROTECTION\_TIME']   = DEFAULT\_CLICK\_FRAUD\_PROTECTION\_TIME; |
| [5366](#L5366) | if (!isset ($plugin\_options ['GLOBAL\_VISITOR\_LIMIT\_CPT']))      $plugin\_options ['GLOBAL\_VISITOR\_LIMIT\_CPT']      = DEFAULT\_GLOBAL\_VISITOR\_LIMIT\_CPT; |
| [5367](#L5367) | if (!isset ($plugin\_options ['GLOBAL\_VISITOR\_LIMIT\_TIME']))     $plugin\_options ['GLOBAL\_VISITOR\_LIMIT\_TIME']     = DEFAULT\_GLOBAL\_VISITOR\_LIMIT\_TIME; |
| [5368](#L5368) | if (!isset ($plugin\_options ['CFP\_BLOCK\_IP\_ADDRESS']))          $plugin\_options ['CFP\_BLOCK\_IP\_ADDRESS']          = DEFAULT\_CFP\_BLOCK\_IP\_ADDRESS; |
| [5369](#L5369) | if (!isset ($plugin\_options ['DYNAMIC\_BLOCKS']))                $plugin\_options ['DYNAMIC\_BLOCKS']                = DEFAULT\_DYNAMIC\_BLOCKS; |
| [5370](#L5370) | if (!isset ($plugin\_options ['PARAGRAPH\_COUNTING\_FUNCTIONS']))  $plugin\_options ['PARAGRAPH\_COUNTING\_FUNCTIONS']  = DEFAULT\_PARAGRAPH\_COUNTING\_FUNCTIONS; |
| [5371](#L5371) | if (!isset ($plugin\_options ['OUTPUT\_BUFFERING']))              $plugin\_options ['OUTPUT\_BUFFERING']              = DEFAULT\_OUTPUT\_BUFFERING; |
| [5372](#L5372) | if (!isset ($plugin\_options ['DISABLE\_CACHING']))               $plugin\_options ['DISABLE\_CACHING']               = DEFAULT\_DISABLE\_CACHING; |
| [5373](#L5373) | if (!isset ($plugin\_options ['MENU\_FOR\_LINK']))                 $plugin\_options ['MENU\_FOR\_LINK']                 = DEFAULT\_MENU\_FOR\_LINK; |
| [5374](#L5374) | if (!isset ($plugin\_options ['WAIT\_FOR\_JQUERY']))               $plugin\_options ['WAIT\_FOR\_JQUERY']               = DEFAULT\_WAIT\_FOR\_JQUERY; |
| [5375](#L5375) | if (!isset ($plugin\_options ['JAVASCRIPT\_CODE\_MODE']))          $plugin\_options ['JAVASCRIPT\_CODE\_MODE']          = DEFAULT\_JAVASCRIPT\_CODE\_MODE; |
| [5376](#L5376) | if (!isset ($plugin\_options ['NO\_PARAGRAPH\_COUNTING\_INSIDE']))  $plugin\_options ['NO\_PARAGRAPH\_COUNTING\_INSIDE']  = DEFAULT\_NO\_PARAGRAPH\_COUNTING\_INSIDE; |
| [5377](#L5377) | if (!isset ($plugin\_options ['AD\_LABEL']))                      $plugin\_options ['AD\_LABEL']                      = DEFAULT\_AD\_TITLE; |
| [5378](#L5378) | if (!isset ($plugin\_options ['MAIN\_CONTENT\_ELEMENT']))          $plugin\_options ['MAIN\_CONTENT\_ELEMENT']          = DEFAULT\_MAIN\_CONTENT\_ELEMENT; |
| [5379](#L5379) | if (!isset ($plugin\_options ['ADB\_DEVICES']))                   $plugin\_options ['ADB\_DEVICES']                   = AI\_DEFAULT\_ADB\_DEVICES; |
| [5380](#L5380) | if (!isset ($plugin\_options ['ADB\_ACTION']))                    $plugin\_options ['ADB\_ACTION']                    = AI\_DEFAULT\_ADB\_ACTION; |
| [5381](#L5381) | if (!isset ($plugin\_options ['ADB\_NO\_ACTION']))                 $plugin\_options ['ADB\_NO\_ACTION']                 = AI\_DEFAULT\_ADB\_NO\_ACTION; |
| [5382](#L5382) | if (!isset ($plugin\_options ['ADB\_DELAY\_ACTION']))              $plugin\_options ['ADB\_DELAY\_ACTION']              = ''; |
| [5383](#L5383) | if (!isset ($plugin\_options ['ADB\_NO\_ACTION\_PERIOD']))          $plugin\_options ['ADB\_NO\_ACTION\_PERIOD']          = AI\_DEFAULT\_ADB\_NO\_ACTION\_PERIOD; |
| [5384](#L5384) | if (!isset ($plugin\_options ['ADB\_SELECTORS']))                 $plugin\_options ['ADB\_SELECTORS']                 = ''; |
| [5385](#L5385) | if (!isset ($plugin\_options ['ADB\_REDIRECTION\_PAGE']))          $plugin\_options ['ADB\_REDIRECTION\_PAGE']          = AI\_DEFAULT\_ADB\_REDIRECTION\_PAGE; |
| [5386](#L5386) | if (!isset ($plugin\_options ['ADB\_CUSTOM\_REDIRECTION\_URL']))    $plugin\_options ['ADB\_CUSTOM\_REDIRECTION\_URL']    = ''; |
| [5387](#L5387) | if (!isset ($plugin\_options ['ADB\_OVERLAY\_CSS']))               $plugin\_options ['ADB\_OVERLAY\_CSS']               = AI\_DEFAULT\_ADB\_OVERLAY\_CSS; |
| [5388](#L5388) | if (!isset ($plugin\_options ['ADB\_MESSAGE\_CSS']))               $plugin\_options ['ADB\_MESSAGE\_CSS']               = AI\_DEFAULT\_ADB\_MESSAGE\_CSS; |
| [5389](#L5389) | if (!isset ($plugin\_options ['ADB\_UNDISMISSIBLE\_MESSAGE']))     $plugin\_options ['ADB\_UNDISMISSIBLE\_MESSAGE']     = AI\_DEFAULT\_ADB\_UNDISMISSIBLE\_MESSAGE; |
| [5390](#L5390) | if (!isset ($plugin\_options ['ADB\_EXTERNAL\_SCRIPTS']))          $plugin\_options ['ADB\_EXTERNAL\_SCRIPTS']          = AI\_DEFAULT\_ADB\_EXTERNAL\_SCRIPTS; |
| [5391](#L5391) | if (!isset ($plugin\_options ['ADB\_NO\_UNDISMISSIBLE\_MESSAGE']))  $plugin\_options ['ADB\_NO\_UNDISMISSIBLE\_MESSAGE']  = AI\_DEFAULT\_ADB\_NO\_UNDISMISSIBLE\_MESSAGE; |
| [5392](#L5392) | if (!isset ($plugin\_options ['ADMIN\_TOOLBAR\_DEBUGGING']))       $plugin\_options ['ADMIN\_TOOLBAR\_DEBUGGING']       = DEFAULT\_ADMIN\_TOOLBAR\_DEBUGGING; |
| [5393](#L5393) | if (!isset ($plugin\_options ['ADMIN\_TOOLBAR\_MOBILE']))          $plugin\_options ['ADMIN\_TOOLBAR\_MOBILE']          = DEFAULT\_ADMIN\_TOOLBAR\_MOBILE; |
| [5394](#L5394) | if (!isset ($plugin\_options ['FORCE\_ADMIN\_TOOLBAR']))           $plugin\_options ['FORCE\_ADMIN\_TOOLBAR']           = DEFAULT\_FORCE\_ADMIN\_TOOLBAR; |
| [5395](#L5395) | if (!isset ($plugin\_options ['REMOTE\_DEBUGGING']))              $plugin\_options ['REMOTE\_DEBUGGING']              = DEFAULT\_REMOTE\_DEBUGGING; |
| [5396](#L5396) | if (!isset ($plugin\_options ['DISABLE\_TRANSLATION']))           $plugin\_options ['DISABLE\_TRANSLATION']           = DEFAULT\_DISABLE\_TRANSLATION; |
| [5397](#L5397) | if (!isset ($plugin\_options ['BACKEND\_JS\_DEBUGGING']))          $plugin\_options ['BACKEND\_JS\_DEBUGGING']          = DEFAULT\_BACKEND\_JS\_DEBUGGING; |
| [5398](#L5398) | if (!isset ($plugin\_options ['FRONTEND\_JS\_DEBUGGING']))         $plugin\_options ['FRONTEND\_JS\_DEBUGGING']         = DEFAULT\_FRONTEND\_JS\_DEBUGGING; |
| [5399](#L5399) | if (!isset ($plugin\_options ['DISABLE\_BLOCK\_INSERTIONS']))      $plugin\_options ['DISABLE\_BLOCK\_INSERTIONS']      = DEFAULT\_DISABLE\_BLOCK\_INSERTIONS; |
| [5400](#L5400) | if (!isset ($plugin\_options ['DISABLE\_PHP\_PROCESSING']))        $plugin\_options ['DISABLE\_PHP\_PROCESSING']        = DEFAULT\_DISABLE\_PHP\_PROCESSING; |
| [5401](#L5401) | if (!isset ($plugin\_options ['DISABLE\_HTML\_CODE']))             $plugin\_options ['DISABLE\_HTML\_CODE']             = DEFAULT\_DISABLE\_HTML\_CODE; |
| [5402](#L5402) | if (!isset ($plugin\_options ['DISABLE\_CSS\_CODE']))              $plugin\_options ['DISABLE\_CSS\_CODE']              = DEFAULT\_DISABLE\_CSS\_CODE; |
| [5403](#L5403) | if (!isset ($plugin\_options ['DISABLE\_JS\_CODE']))               $plugin\_options ['DISABLE\_JS\_CODE']               = DEFAULT\_DISABLE\_JS\_CODE; |
| [5404](#L5404) | if (!isset ($plugin\_options ['DISABLE\_HEADER\_CODE']))           $plugin\_options ['DISABLE\_HEADER\_CODE']           = DEFAULT\_DISABLE\_HEADER\_CODE; |
| [5405](#L5405) | if (!isset ($plugin\_options ['DISABLE\_FOOTER\_CODE']))           $plugin\_options ['DISABLE\_FOOTER\_CODE']           = DEFAULT\_DISABLE\_FOOTER\_CODE; |
| [5406](#L5406) |  |
| [5407](#L5407) | $min\_width\_0\_defined = false; |
| [5408](#L5408) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [5409](#L5409) | $viewport\_name\_option\_name   = 'VIEWPORT\_NAME\_'  . $viewport; |
| [5410](#L5410) | $viewport\_width\_option\_name  = 'VIEWPORT\_WIDTH\_' . $viewport; |
| [5411](#L5411) |  |
| [5412](#L5412) | if (!isset ($plugin\_options [$viewport\_name\_option\_name]))     $plugin\_options [$viewport\_name\_option\_name] = |
| [5413](#L5413) | defined ("DEFAULT\_VIEWPORT\_NAME\_" . $viewport) ? constant ("DEFAULT\_VIEWPORT\_NAME\_" . $viewport) : ""; |
| [5414](#L5414) |  |
| [5415](#L5415) | if ($viewport == 1 && $plugin\_options [$viewport\_name\_option\_name] == '') |
| [5416](#L5416) | $plugin\_options [$viewport\_name\_option\_name] = constant ("DEFAULT\_VIEWPORT\_NAME\_1"); |
| [5417](#L5417) |  |
| [5418](#L5418) | if ($plugin\_options [$viewport\_name\_option\_name] != '') { |
| [5419](#L5419) | $last\_viewport\_width\_option\_name = $viewport\_width\_option\_name; |
| [5420](#L5420) |  |
| [5421](#L5421) | if (!isset ($plugin\_options [$viewport\_width\_option\_name]))  $plugin\_options [$viewport\_width\_option\_name] = |
| [5422](#L5422) | defined ("DEFAULT\_VIEWPORT\_WIDTH\_" . $viewport) ? constant ("DEFAULT\_VIEWPORT\_WIDTH\_" . $viewport) : 0; |
| [5423](#L5423) |  |
| [5424](#L5424) | $viewport\_width = $plugin\_options [$viewport\_width\_option\_name]; |
| [5425](#L5425) |  |
| [5426](#L5426) | if ($viewport > 1) { |
| [5427](#L5427) | $previous\_viewport\_option\_width = $plugin\_options ['VIEWPORT\_WIDTH\_' . ($viewport - 1)]; |
| [5428](#L5428) | } |
| [5429](#L5429) |  |
| [5430](#L5430) | if (!is\_numeric ($viewport\_width)) { |
| [5431](#L5431) | if ($viewport == 1) |
| [5432](#L5432) | $viewport\_width = constant ("DEFAULT\_VIEWPORT\_WIDTH\_1"); else |
| [5433](#L5433) | $viewport\_width = $previous\_viewport\_option\_width - 1; |
| [5434](#L5434) |  |
| [5435](#L5435) | } |
| [5436](#L5436) | if ($viewport\_width > 9999) { |
| [5437](#L5437) | $viewport\_width = 9999; |
| [5438](#L5438) | } |
| [5439](#L5439) |  |
| [5440](#L5440) | //      if ($viewport > 1) { |
| [5441](#L5441) | //        if ($viewport\_width >= $previous\_viewport\_option\_width) |
| [5442](#L5442) | //          $viewport\_width = $previous\_viewport\_option\_width - 1; |
| [5443](#L5443) | //      } |
| [5444](#L5444) |  |
| [5445](#L5445) | $viewport\_width = intval ($viewport\_width); |
| [5446](#L5446) | if ($viewport\_width < 0) { |
| [5447](#L5447) | $viewport\_width = 0; |
| [5448](#L5448) | } |
| [5449](#L5449) |  |
| [5450](#L5450) | if ($viewport\_width == 0) { |
| [5451](#L5451) | $min\_width\_0\_defined = true; |
| [5452](#L5452) | } |
| [5453](#L5453) |  |
| [5454](#L5454) | $plugin\_options [$viewport\_width\_option\_name] = $viewport\_width; |
| [5455](#L5455) | } else $plugin\_options [$viewport\_width\_option\_name] = ''; |
| [5456](#L5456) | } |
| [5457](#L5457) | if (!$min\_width\_0\_defined) { |
| [5458](#L5458) | $plugin\_options [$last\_viewport\_width\_option\_name] = 0; |
| [5459](#L5459) | } |
| [5460](#L5460) |  |
| [5461](#L5461) | for ($constant = 1; $constant <= 6; $constant ++) { |
| [5462](#L5462) | $constant\_name\_option\_name   = 'CONSTANT\_NAME\_'  . $constant; |
| [5463](#L5463) | $constant\_value\_option\_name  = 'CONSTANT\_VALUE\_' . $constant; |
| [5464](#L5464) |  |
| [5465](#L5465) | if (!isset ($plugin\_options [$constant\_name\_option\_name]))  $plugin\_options [$constant\_name\_option\_name]  = ""; |
| [5466](#L5466) | if (!isset ($plugin\_options [$constant\_value\_option\_name])) $plugin\_options [$constant\_value\_option\_name] = ""; |
| [5467](#L5467) | } |
| [5468](#L5468) |  |
| [5469](#L5469) | for ($hook = 1; $hook <= 20; $hook ++) { |
| [5470](#L5470) | $hook\_enabled\_settins\_name  = 'HOOK\_ENABLED\_' . $hook; |
| [5471](#L5471) | $hook\_name\_settins\_name     = 'HOOK\_NAME\_' . $hook; |
| [5472](#L5472) | $hook\_action\_settins\_name   = 'HOOK\_ACTION\_' . $hook; |
| [5473](#L5473) | $hook\_priority\_settins\_name = 'HOOK\_PRIORITY\_' . $hook; |
| [5474](#L5474) |  |
| [5475](#L5475) | if (!isset ($plugin\_options [$hook\_enabled\_settins\_name]))  $plugin\_options [$hook\_enabled\_settins\_name] = AI\_DISABLED; |
| [5476](#L5476) | if (!isset ($plugin\_options [$hook\_name\_settins\_name]))     $plugin\_options [$hook\_name\_settins\_name] = ''; |
| [5477](#L5477) | if (!isset ($plugin\_options [$hook\_action\_settins\_name]))   $plugin\_options [$hook\_action\_settins\_name] = ''; |
| [5478](#L5478) | if (!isset ($plugin\_options [$hook\_priority\_settins\_name]) || !is\_numeric ($plugin\_options [$hook\_priority\_settins\_name])) $plugin\_options [$hook\_priority\_settins\_name] = DEFAULT\_CUSTOM\_HOOK\_PRIORITY; |
| [5479](#L5479) | } |
| [5480](#L5480) |  |
| [5481](#L5481) | if (function\_exists ('ai\_check\_options')) ai\_check\_options ($plugin\_options); |
| [5482](#L5482) |  |
| [5483](#L5483) | return ($plugin\_options); |
| [5484](#L5484) | } |
| [5485](#L5485) |  |
| [5486](#L5486) | function option\_stripslashes (&$options) { |
| [5487](#L5487) | $options = wp\_unslash ($options); |
| [5488](#L5488) | } |
| [5489](#L5489) |  |
| [5490](#L5490) | // Deprecated |
| [5491](#L5491) | function ai\_get\_old\_option ($option\_name) { |
| [5492](#L5492) | $options = get\_option ($option\_name); |
| [5493](#L5493) | option\_stripslashes ($options); |
| [5494](#L5494) | return ($options); |
| [5495](#L5495) | } |
| [5496](#L5496) |  |
| [5497](#L5497) | function ai\_get\_option ($option\_name, $default = false) { |
| [5498](#L5498) | $ai\_db\_options = get\_option ($option\_name, $default); |
| [5499](#L5499) |  |
| [5500](#L5500) | if ($ai\_db\_options === false) { |
| [5501](#L5501) | return $ai\_db\_options; |
| [5502](#L5502) | } |
| [5503](#L5503) |  |
| [5504](#L5504) | if (is\_string ($ai\_db\_options) && substr ($ai\_db\_options, 0, 4) === ':AI:') { |
| [5505](#L5505) | $ai\_db\_options = unserialize (base64\_decode (substr ($ai\_db\_options, 4), true)); |
| [5506](#L5506) | } |
| [5507](#L5507) |  |
| [5508](#L5508) | return $ai\_db\_options; |
| [5509](#L5509) | } |
| [5510](#L5510) |  |
| [5511](#L5511) | function ai\_update\_option ($option\_name, $value) { |
| [5512](#L5512) | update\_option ($option\_name, ':AI:'. base64\_encode (serialize ($value))); |
| [5513](#L5513) | } |
| [5514](#L5514) |  |
| [5515](#L5515) | function ai\_save\_options ($options, $multisite\_options = null, $blocks\_org = null, $blocks\_new = null) { |
| [5516](#L5516) |  |
| [5517](#L5517) | if (function\_exists ('ai\_save\_remote\_settings')) { |
| [5518](#L5518) | if (ai\_save\_remote\_settings ($options, $multisite\_options, $blocks\_org, $blocks\_new)) return; |
| [5519](#L5519) | } |
| [5520](#L5520) |  |
| [5521](#L5521) | $options           = apply\_filters ('ai\_save\_options',           $options); |
| [5522](#L5522) | $multisite\_options = apply\_filters ('ai\_save\_multisite\_options', $multisite\_options); |
| [5523](#L5523) |  |
| [5524](#L5524) | // Generate and save extract |
| [5525](#L5525) | ai\_update\_option (AI\_OPTION\_NAME, $options); |
| [5526](#L5526) | ai\_load\_settings (); |
| [5527](#L5527) |  |
| [5528](#L5528) | $options [AI\_OPTION\_EXTRACT] = ai\_generate\_extract ($options); |
| [5529](#L5529) | $ai\_db\_options\_extract = $options [AI\_OPTION\_EXTRACT]; |
| [5530](#L5530) |  |
| [5531](#L5531) | $options [AI\_OPTION\_GLOBAL]['VIEWPORT\_CSS']  = generate\_viewport\_css (); |
| [5532](#L5532) | $options [AI\_OPTION\_GLOBAL]['ALIGNMENT\_CSS'] = generate\_alignment\_css (); |
| [5533](#L5533) |  |
| [5534](#L5534) | $options [AI\_OPTION\_GLOBAL]['TIMESTAMP'] = time (); |
| [5535](#L5535) |  |
| [5536](#L5536) | if (!get\_option (AI\_INSTALL\_NAME)) { |
| [5537](#L5537) | update\_option (AI\_INSTALL\_NAME, time ()); |
| [5538](#L5538) | } |
| [5539](#L5539) |  |
| [5540](#L5540) | if (is\_multisite () && !is\_main\_site ()) { |
| [5541](#L5541) | unset ($options [AI\_OPTION\_GLOBAL]['PLUGIN\_TYPE']); |
| [5542](#L5542) | unset ($options [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS']); |
| [5543](#L5543) | unset ($options [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS\_COUNTER']); |
| [5544](#L5544) | } |
| [5545](#L5545) |  |
| [5546](#L5546) | ai\_update\_option (AI\_OPTION\_NAME, $options); |
| [5547](#L5547) |  |
| [5548](#L5548) | update\_option (AI\_EXTRACT\_NAME, $ai\_db\_options\_extract); |
| [5549](#L5549) |  |
| [5550](#L5550) | // Multisite |
| [5551](#L5551) | if (is\_array ($multisite\_options) && is\_multisite () && is\_main\_site ()) { |
| [5552](#L5552) | update\_site\_option (AI\_OPTION\_NAME, $multisite\_options); |
| [5553](#L5553) | } |
| [5554](#L5554) |  |
| [5555](#L5555) | ai\_load\_settings (); |
| [5556](#L5556) |  |
| [5557](#L5557) | if (is\_array ($blocks\_org) && is\_array ($blocks\_new)) { |
| [5558](#L5558) | ai\_update\_block\_numbers ($blocks\_org, $blocks\_new); |
| [5559](#L5559) | } |
| [5560](#L5560) | } |
| [5561](#L5561) |  |
| [5562](#L5562) | function ai\_load\_options () { |
| [5563](#L5563) | global $ai\_db\_options, $ai\_db\_options\_multisite, $ai\_wp\_data; |
| [5564](#L5564) |  |
| [5565](#L5565) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("LOAD OPTIONS START"); |
| [5566](#L5566) |  |
| [5567](#L5567) | if (function\_exists ('ai\_load\_remote\_settings')) { |
| [5568](#L5568) | if (ai\_load\_remote\_settings ()) { |
| [5569](#L5569) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("LOAD OPTIONS END"); |
| [5570](#L5570) |  |
| [5571](#L5571) | return; |
| [5572](#L5572) | } |
| [5573](#L5573) | } |
| [5574](#L5574) |  |
| [5575](#L5575) | if (is\_multisite ()) { |
| [5576](#L5576) | $ai\_db\_options\_multisite = get\_site\_option (AI\_OPTION\_NAME, array ()); |
| [5577](#L5577) | option\_stripslashes ($ai\_db\_options\_multisite); |
| [5578](#L5578) | } |
| [5579](#L5579) |  |
| [5580](#L5580) | if (is\_multisite () && multisite\_main\_for\_all\_blogs () && defined ('BLOG\_ID\_CURRENT\_SITE')) { |
| [5581](#L5581) | $ai\_db\_options = get\_blog\_option (BLOG\_ID\_CURRENT\_SITE, AI\_OPTION\_NAME, array ()); |
| [5582](#L5582) |  |
| [5583](#L5583) | if (is\_string ($ai\_db\_options) && substr ($ai\_db\_options, 0, 4) === ':AI:') { |
| [5584](#L5584) | $ai\_db\_options = unserialize (base64\_decode (substr ($ai\_db\_options, 4), true)); |
| [5585](#L5585) | } |
| [5586](#L5586) |  |
| [5587](#L5587) | option\_stripslashes ($ai\_db\_options); |
| [5588](#L5588) | } else { |
| [5589](#L5589) | $ai\_db\_options = ai\_get\_option (AI\_OPTION\_NAME, array ()); |
| [5590](#L5590) |  |
| [5591](#L5591) | option\_stripslashes ($ai\_db\_options); |
| [5592](#L5592) | } |
| [5593](#L5593) |  |
| [5594](#L5594) | if (is\_multisite () && !is\_main\_site () && defined ('BLOG\_ID\_CURRENT\_SITE')) { |
| [5595](#L5595) | $ai\_db\_options\_main = get\_blog\_option (BLOG\_ID\_CURRENT\_SITE, AI\_OPTION\_NAME, array ()); |
| [5596](#L5596) |  |
| [5597](#L5597) | if (is\_string ($ai\_db\_options\_main) && substr ($ai\_db\_options\_main, 0, 4) === ':AI:') { |
| [5598](#L5598) | $ai\_db\_options\_main = unserialize (base64\_decode (substr ($ai\_db\_options\_main, 4), true)); |
| [5599](#L5599) | } |
| [5600](#L5600) |  |
| [5601](#L5601) | if (isset ($ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_TYPE']))            $ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_TYPE']            = $ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_TYPE']; |
| [5602](#L5602) | if (isset ($ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS']))          $ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS']          = $ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS']; |
| [5603](#L5603) | if (isset ($ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS\_COUNTER']))  $ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS\_COUNTER']  = $ai\_db\_options\_main [AI\_OPTION\_GLOBAL]['PLUGIN\_STATUS\_COUNTER']; |
| [5604](#L5604) | } |
| [5605](#L5605) |  |
| [5606](#L5606) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("LOAD OPTIONS END"); |
| [5607](#L5607) | } |
| [5608](#L5608) |  |
| [5609](#L5609) | function get\_viewport\_css () { |
| [5610](#L5610) | global $ai\_db\_options; |
| [5611](#L5611) |  |
| [5612](#L5612) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VIEWPORT\_CSS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['VIEWPORT\_CSS'] = generate\_viewport\_css (); |
| [5613](#L5613) |  |
| [5614](#L5614) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VIEWPORT\_CSS']); |
| [5615](#L5615) | } |
| [5616](#L5616) |  |
| [5617](#L5617) | function get\_alignment\_css () { |
| [5618](#L5618) | global $ai\_db\_options; |
| [5619](#L5619) |  |
| [5620](#L5620) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ALIGNMENT\_CSS']) || |
| [5621](#L5621) | isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION']) && $ai\_db\_options [AI\_OPTION\_GLOBAL]['VERSION'] < '020211' |
| [5622](#L5622) | ) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ALIGNMENT\_CSS'] = generate\_alignment\_css (); |
| [5623](#L5623) |  |
| [5624](#L5624) | return (str\_replace ('&#039;', "'", $ai\_db\_options [AI\_OPTION\_GLOBAL]['ALIGNMENT\_CSS'])); |
| [5625](#L5625) | } |
| [5626](#L5626) |  |
| [5627](#L5627) | function get\_syntax\_highlighter\_theme () { |
| [5628](#L5628) | global $ai\_db\_options; |
| [5629](#L5629) |  |
| [5630](#L5630) | //  return 'ad-inserter'; |
| [5631](#L5631) |  |
| [5632](#L5632) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['SYNTAX\_HIGHLIGHTER\_THEME'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['SYNTAX\_HIGHLIGHTER\_THEME'] = DEFAULT\_SYNTAX\_HIGHLIGHTER\_THEME; |
| [5633](#L5633) |  |
| [5634](#L5634) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['SYNTAX\_HIGHLIGHTER\_THEME']); |
| [5635](#L5635) | } |
| [5636](#L5636) |  |
| [5637](#L5637) | function get\_block\_class\_name ($default\_if\_empty = false) { |
| [5638](#L5638) | global $ai\_db\_options; |
| [5639](#L5639) |  |
| [5640](#L5640) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS\_NAME'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS\_NAME'] = DEFAULT\_BLOCK\_CLASS\_NAME; |
| [5641](#L5641) |  |
| [5642](#L5642) | if ($default\_if\_empty && $ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS\_NAME'] == '') return (DEFAULT\_BLOCK\_CLASS\_NAME); |
| [5643](#L5643) |  |
| [5644](#L5644) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS\_NAME']); |
| [5645](#L5645) | } |
| [5646](#L5646) |  |
| [5647](#L5647) | function get\_block\_class () { |
| [5648](#L5648) | global $ai\_db\_options; |
| [5649](#L5649) |  |
| [5650](#L5650) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS'] = DEFAULT\_BLOCK\_CLASS; |
| [5651](#L5651) |  |
| [5652](#L5652) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_CLASS']); |
| [5653](#L5653) | } |
| [5654](#L5654) |  |
| [5655](#L5655) | function get\_block\_number\_class () { |
| [5656](#L5656) | global $ai\_db\_options; |
| [5657](#L5657) |  |
| [5658](#L5658) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NUMBER\_CLASS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NUMBER\_CLASS'] = DEFAULT\_BLOCK\_NUMBER\_CLASS; |
| [5659](#L5659) |  |
| [5660](#L5660) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NUMBER\_CLASS']); |
| [5661](#L5661) | } |
| [5662](#L5662) |  |
| [5663](#L5663) | function get\_block\_name\_class () { |
| [5664](#L5664) | global $ai\_db\_options; |
| [5665](#L5665) |  |
| [5666](#L5666) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NAME\_CLASS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NAME\_CLASS'] = DEFAULT\_BLOCK\_NAME\_CLASS; |
| [5667](#L5667) |  |
| [5668](#L5668) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BLOCK\_NAME\_CLASS']); |
| [5669](#L5669) | } |
| [5670](#L5670) |  |
| [5671](#L5671) | function get\_inline\_styles () { |
| [5672](#L5672) | global $ai\_db\_options; |
| [5673](#L5673) |  |
| [5674](#L5674) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['INLINE\_STYLES'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['INLINE\_STYLES'] = DEFAULT\_INLINE\_STYLES; |
| [5675](#L5675) |  |
| [5676](#L5676) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['INLINE\_STYLES']); |
| [5677](#L5677) | } |
| [5678](#L5678) |  |
| [5679](#L5679) | function get\_minimum\_user\_role () { |
| [5680](#L5680) | global $ai\_db\_options; |
| [5681](#L5681) |  |
| [5682](#L5682) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MINIMUM\_USER\_ROLE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['MINIMUM\_USER\_ROLE'] = DEFAULT\_MINIMUM\_USER\_ROLE; |
| [5683](#L5683) |  |
| [5684](#L5684) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MINIMUM\_USER\_ROLE']); |
| [5685](#L5685) | } |
| [5686](#L5686) |  |
| [5687](#L5687) | function get\_sticky\_widget\_mode () { |
| [5688](#L5688) | global $ai\_db\_options; |
| [5689](#L5689) |  |
| [5690](#L5690) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MODE'] = DEFAULT\_STICKY\_WIDGET\_MODE; |
| [5691](#L5691) |  |
| [5692](#L5692) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MODE']); |
| [5693](#L5693) | } |
| [5694](#L5694) |  |
| [5695](#L5695) | function get\_sticky\_widget\_margin () { |
| [5696](#L5696) | global $ai\_db\_options; |
| [5697](#L5697) |  |
| [5698](#L5698) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MARGIN'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MARGIN'] = DEFAULT\_STICKY\_WIDGET\_MARGIN; |
| [5699](#L5699) |  |
| [5700](#L5700) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['STICKY\_WIDGET\_MARGIN']); |
| [5701](#L5701) | } |
| [5702](#L5702) |  |
| [5703](#L5703) | function get\_lazy\_loading\_offset () { |
| [5704](#L5704) | global $ai\_db\_options; |
| [5705](#L5705) |  |
| [5706](#L5706) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['LAZY\_LOADING\_OFFSET'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['LAZY\_LOADING\_OFFSET'] = DEFAULT\_LAZY\_LOADING\_OFFSET; |
| [5707](#L5707) |  |
| [5708](#L5708) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['LAZY\_LOADING\_OFFSET']); |
| [5709](#L5709) | } |
| [5710](#L5710) |  |
| [5711](#L5711) | function get\_click\_fraud\_protection () { |
| [5712](#L5712) | global $ai\_db\_options; |
| [5713](#L5713) |  |
| [5714](#L5714) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION'] = DEFAULT\_CLICK\_FRAUD\_PROTECTION; |
| [5715](#L5715) |  |
| [5716](#L5716) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION']); |
| [5717](#L5717) | } |
| [5718](#L5718) |  |
| [5719](#L5719) | function get\_click\_fraud\_protection\_time () { |
| [5720](#L5720) | global $ai\_db\_options; |
| [5721](#L5721) |  |
| [5722](#L5722) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION\_TIME'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION\_TIME'] = DEFAULT\_CLICK\_FRAUD\_PROTECTION\_TIME; |
| [5723](#L5723) |  |
| [5724](#L5724) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CLICK\_FRAUD\_PROTECTION\_TIME']); |
| [5725](#L5725) | } |
| [5726](#L5726) |  |
| [5727](#L5727) | function get\_global\_visitor\_limit\_clicks\_per\_time\_period () { |
| [5728](#L5728) | global $ai\_db\_options; |
| [5729](#L5729) |  |
| [5730](#L5730) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_CPT'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_CPT'] = DEFAULT\_GLOBAL\_VISITOR\_LIMIT\_CPT; |
| [5731](#L5731) |  |
| [5732](#L5732) | $option = $ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_CPT']; |
| [5733](#L5733) | if ($option == '0') $option = ''; |
| [5734](#L5734) |  |
| [5735](#L5735) | return ($option); |
| [5736](#L5736) | } |
| [5737](#L5737) |  |
| [5738](#L5738) | function get\_global\_visitor\_limit\_clicks\_time\_period () { |
| [5739](#L5739) | global $ai\_db\_options; |
| [5740](#L5740) |  |
| [5741](#L5741) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_TIME'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_TIME'] = DEFAULT\_GLOBAL\_VISITOR\_LIMIT\_TIME; |
| [5742](#L5742) |  |
| [5743](#L5743) | $option = $ai\_db\_options [AI\_OPTION\_GLOBAL]['GLOBAL\_VISITOR\_LIMIT\_TIME']; |
| [5744](#L5744) | if ($option == '0') $option = ''; |
| [5745](#L5745) |  |
| [5746](#L5746) | return ($option); |
| [5747](#L5747) | } |
| [5748](#L5748) |  |
| [5749](#L5749) | function get\_cfp\_block\_ip\_address () { |
| [5750](#L5750) | global $ai\_db\_options; |
| [5751](#L5751) |  |
| [5752](#L5752) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CFP\_BLOCK\_IP\_ADDRESS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['CFP\_BLOCK\_IP\_ADDRESS'] = DEFAULT\_CFP\_BLOCK\_IP\_ADDRESS; |
| [5753](#L5753) |  |
| [5754](#L5754) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['CFP\_BLOCK\_IP\_ADDRESS']); |
| [5755](#L5755) | } |
| [5756](#L5756) |  |
| [5757](#L5757) | function get\_max\_page\_blocks () { |
| [5758](#L5758) | global $ai\_db\_options; |
| [5759](#L5759) |  |
| [5760](#L5760) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_PAGE\_BLOCKS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_PAGE\_BLOCKS'] = DEFAULT\_MAX\_PAGE\_BLOCKS; |
| [5761](#L5761) |  |
| [5762](#L5762) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_PAGE\_BLOCKS']); |
| [5763](#L5763) | } |
| [5764](#L5764) |  |
| [5765](#L5765) | function get\_plugin\_priority () { |
| [5766](#L5766) | global $ai\_db\_options; |
| [5767](#L5767) |  |
| [5768](#L5768) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_PRIORITY'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_PRIORITY'] = DEFAULT\_PLUGIN\_PRIORITY; |
| [5769](#L5769) |  |
| [5770](#L5770) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['PLUGIN\_PRIORITY']); |
| [5771](#L5771) | } |
| [5772](#L5772) |  |
| [5773](#L5773) | function get\_max\_list\_items () { |
| [5774](#L5774) | global $ai\_db\_options; |
| [5775](#L5775) |  |
| [5776](#L5776) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_LIST\_ITEMS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_LIST\_ITEMS'] = DEFAULT\_MAX\_LIST\_ITEMS; |
| [5777](#L5777) |  |
| [5778](#L5778) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAX\_LIST\_ITEMS']); |
| [5779](#L5779) | } |
| [5780](#L5780) |  |
| [5781](#L5781) | function get\_tab\_setup\_delay () { |
| [5782](#L5782) | global $ai\_db\_options; |
| [5783](#L5783) |  |
| [5784](#L5784) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['TAB\_SETUP\_DELAY'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['TAB\_SETUP\_DELAY'] = DEFAULT\_TAB\_SETUP\_DELAY; |
| [5785](#L5785) |  |
| [5786](#L5786) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['TAB\_SETUP\_DELAY']); |
| [5787](#L5787) | } |
| [5788](#L5788) |  |
| [5789](#L5789) | function get\_dynamic\_blocks(){ |
| [5790](#L5790) | global $ai\_db\_options, $ai\_wp\_data; |
| [5791](#L5791) |  |
| [5792](#L5792) | if (isset ($ai\_wp\_data [AI\_DYNAMIC\_BLOCKS])) { |
| [5793](#L5793) | return ($ai\_wp\_data [AI\_DYNAMIC\_BLOCKS]); |
| [5794](#L5794) | } |
| [5795](#L5795) |  |
| [5796](#L5796) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DYNAMIC\_BLOCKS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DYNAMIC\_BLOCKS'] = DEFAULT\_DYNAMIC\_BLOCKS; |
| [5797](#L5797) |  |
| [5798](#L5798) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DYNAMIC\_BLOCKS']); |
| [5799](#L5799) | } |
| [5800](#L5800) |  |
| [5801](#L5801) | function get\_paragraph\_counting\_functions(){ |
| [5802](#L5802) | global $ai\_db\_options; |
| [5803](#L5803) |  |
| [5804](#L5804) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['PARAGRAPH\_COUNTING\_FUNCTIONS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['PARAGRAPH\_COUNTING\_FUNCTIONS'] = DEFAULT\_PARAGRAPH\_COUNTING\_FUNCTIONS; |
| [5805](#L5805) |  |
| [5806](#L5806) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['PARAGRAPH\_COUNTING\_FUNCTIONS']); |
| [5807](#L5807) | } |
| [5808](#L5808) |  |
| [5809](#L5809) | function get\_output\_buffering(){ |
| [5810](#L5810) | global $ai\_db\_options; |
| [5811](#L5811) |  |
| [5812](#L5812) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['OUTPUT\_BUFFERING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['OUTPUT\_BUFFERING'] = DEFAULT\_OUTPUT\_BUFFERING; |
| [5813](#L5813) |  |
| [5814](#L5814) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['OUTPUT\_BUFFERING']); |
| [5815](#L5815) | } |
| [5816](#L5816) |  |
| [5817](#L5817) | function get\_menu\_position (){ |
| [5818](#L5818) | global $ai\_db\_options; |
| [5819](#L5819) |  |
| [5820](#L5820) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MENU\_FOR\_LINK'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['MENU\_FOR\_LINK'] = DEFAULT\_MENU\_FOR\_LINK; |
| [5821](#L5821) |  |
| [5822](#L5822) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MENU\_FOR\_LINK']); |
| [5823](#L5823) | } |
| [5824](#L5824) |  |
| [5825](#L5825) | function get\_disable\_caching (){ |
| [5826](#L5826) | global $ai\_db\_options; |
| [5827](#L5827) |  |
| [5828](#L5828) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CACHING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CACHING'] = DEFAULT\_DISABLE\_CACHING; |
| [5829](#L5829) |  |
| [5830](#L5830) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CACHING']); |
| [5831](#L5831) | } |
| [5832](#L5832) |  |
| [5833](#L5833) | function get\_wait\_for\_jquery (){ |
| [5834](#L5834) | global $ai\_db\_options; |
| [5835](#L5835) |  |
| [5836](#L5836) | // Deprecated - return false |
| [5837](#L5837) | return false; |
| [5838](#L5838) |  |
| [5839](#L5839) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['WAIT\_FOR\_JQUERY'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['WAIT\_FOR\_JQUERY'] = DEFAULT\_WAIT\_FOR\_JQUERY; |
| [5840](#L5840) |  |
| [5841](#L5841) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['WAIT\_FOR\_JQUERY']); |
| [5842](#L5842) | } |
| [5843](#L5843) |  |
| [5844](#L5844) | function get\_javascript\_code\_mode (){ |
| [5845](#L5845) | global $ai\_db\_options; |
| [5846](#L5846) |  |
| [5847](#L5847) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['JAVASCRIPT\_CODE\_MODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['JAVASCRIPT\_CODE\_MODE'] = DEFAULT\_JAVASCRIPT\_CODE\_MODE; |
| [5848](#L5848) |  |
| [5849](#L5849) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['JAVASCRIPT\_CODE\_MODE']); |
| [5850](#L5850) | } |
| [5851](#L5851) |  |
| [5852](#L5852) | function get\_no\_paragraph\_counting\_inside () { |
| [5853](#L5853) | global $ai\_db\_options; |
| [5854](#L5854) |  |
| [5855](#L5855) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['NO\_PARAGRAPH\_COUNTING\_INSIDE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['NO\_PARAGRAPH\_COUNTING\_INSIDE'] = DEFAULT\_NO\_PARAGRAPH\_COUNTING\_INSIDE; |
| [5856](#L5856) |  |
| [5857](#L5857) | return (str\_replace (array ('<', '>'), '', $ai\_db\_options [AI\_OPTION\_GLOBAL]['NO\_PARAGRAPH\_COUNTING\_INSIDE'])); |
| [5858](#L5858) | } |
| [5859](#L5859) |  |
| [5860](#L5860) | function get\_ad\_label ($decode = false) { |
| [5861](#L5861) | global $ai\_db\_options; |
| [5862](#L5862) |  |
| [5863](#L5863) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['AD\_LABEL'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['AD\_LABEL'] = DEFAULT\_AD\_TITLE; |
| [5864](#L5864) |  |
| [5865](#L5865) | if ($decode) return (html\_entity\_decode ($ai\_db\_options [AI\_OPTION\_GLOBAL]['AD\_LABEL'])); |
| [5866](#L5866) |  |
| [5867](#L5867) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['AD\_LABEL']); |
| [5868](#L5868) | } |
| [5869](#L5869) |  |
| [5870](#L5870) | function get\_main\_content\_element () { |
| [5871](#L5871) | global $ai\_db\_options; |
| [5872](#L5872) |  |
| [5873](#L5873) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAIN\_CONTENT\_ELEMENT'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['MAIN\_CONTENT\_ELEMENT'] = DEFAULT\_MAIN\_CONTENT\_ELEMENT; |
| [5874](#L5874) |  |
| [5875](#L5875) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['MAIN\_CONTENT\_ELEMENT']); |
| [5876](#L5876) | } |
| [5877](#L5877) |  |
| [5878](#L5878) | function get\_force\_admin\_toolbar () { |
| [5879](#L5879) | global $ai\_db\_options; |
| [5880](#L5880) |  |
| [5881](#L5881) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['FORCE\_ADMIN\_TOOLBAR'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['FORCE\_ADMIN\_TOOLBAR'] = DEFAULT\_FORCE\_ADMIN\_TOOLBAR; |
| [5882](#L5882) |  |
| [5883](#L5883) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['FORCE\_ADMIN\_TOOLBAR']); |
| [5884](#L5884) | } |
| [5885](#L5885) |  |
| [5886](#L5886) | function get\_admin\_toolbar\_debugging () { |
| [5887](#L5887) | global $ai\_db\_options; |
| [5888](#L5888) |  |
| [5889](#L5889) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_DEBUGGING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_DEBUGGING'] = DEFAULT\_ADMIN\_TOOLBAR\_DEBUGGING; |
| [5890](#L5890) |  |
| [5891](#L5891) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_DEBUGGING']); |
| [5892](#L5892) | } |
| [5893](#L5893) |  |
| [5894](#L5894) | function get\_admin\_toolbar\_mobile () { |
| [5895](#L5895) | global $ai\_db\_options; |
| [5896](#L5896) |  |
| [5897](#L5897) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_MOBILE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_MOBILE'] = DEFAULT\_ADMIN\_TOOLBAR\_MOBILE; |
| [5898](#L5898) |  |
| [5899](#L5899) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADMIN\_TOOLBAR\_MOBILE']); |
| [5900](#L5900) | } |
| [5901](#L5901) |  |
| [5902](#L5902) | function get\_remote\_debugging () { |
| [5903](#L5903) | global $ai\_db\_options; |
| [5904](#L5904) |  |
| [5905](#L5905) | if (function\_exists ('ai\_remote\_debugging')) return ai\_remote\_debugging (); |
| [5906](#L5906) |  |
| [5907](#L5907) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['REMOTE\_DEBUGGING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['REMOTE\_DEBUGGING'] = DEFAULT\_REMOTE\_DEBUGGING; |
| [5908](#L5908) |  |
| [5909](#L5909) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['REMOTE\_DEBUGGING']); |
| [5910](#L5910) | } |
| [5911](#L5911) |  |
| [5912](#L5912) | function get\_disable\_translation () { |
| [5913](#L5913) | global $ai\_db\_options; |
| [5914](#L5914) |  |
| [5915](#L5915) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_TRANSLATION'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_TRANSLATION'] = DEFAULT\_DISABLE\_TRANSLATION; |
| [5916](#L5916) |  |
| [5917](#L5917) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_TRANSLATION']); |
| [5918](#L5918) | } |
| [5919](#L5919) |  |
| [5920](#L5920) | function get\_backend\_javascript\_debugging () { |
| [5921](#L5921) | global $ai\_db\_options; |
| [5922](#L5922) |  |
| [5923](#L5923) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BACKEND\_JS\_DEBUGGING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['BACKEND\_JS\_DEBUGGING'] = DEFAULT\_BACKEND\_JS\_DEBUGGING; |
| [5924](#L5924) |  |
| [5925](#L5925) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['BACKEND\_JS\_DEBUGGING']); |
| [5926](#L5926) | } |
| [5927](#L5927) |  |
| [5928](#L5928) | function get\_frontend\_javascript\_debugging () { |
| [5929](#L5929) | global $ai\_db\_options; |
| [5930](#L5930) |  |
| [5931](#L5931) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['FRONTEND\_JS\_DEBUGGING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['FRONTEND\_JS\_DEBUGGING'] = DEFAULT\_FRONTEND\_JS\_DEBUGGING; |
| [5932](#L5932) |  |
| [5933](#L5933) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['FRONTEND\_JS\_DEBUGGING']); |
| [5934](#L5934) | } |
| [5935](#L5935) |  |
| [5936](#L5936) | function get\_disable\_block\_insertions () { |
| [5937](#L5937) | global $ai\_db\_options; |
| [5938](#L5938) |  |
| [5939](#L5939) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'all' && get\_remote\_debugging ()) return true; |
| [5940](#L5940) |  |
| [5941](#L5941) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_BLOCK\_INSERTIONS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_BLOCK\_INSERTIONS'] = DEFAULT\_DISABLE\_BLOCK\_INSERTIONS; |
| [5942](#L5942) |  |
| [5943](#L5943) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_BLOCK\_INSERTIONS']); |
| [5944](#L5944) | } |
| [5945](#L5945) |  |
| [5946](#L5946) | function get\_disable\_php\_processing () { |
| [5947](#L5947) | global $ai\_db\_options; |
| [5948](#L5948) |  |
| [5949](#L5949) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_PHP\_PROCESSING]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_PHP\_PROCESSING] && get\_remote\_debugging ()) return true; |
| [5950](#L5950) |  |
| [5951](#L5951) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [5952](#L5952) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'php') return true; |
| [5953](#L5953) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [5954](#L5954) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [5955](#L5955) | if (in\_array ('php', $blocks)) return true; |
| [5956](#L5956) | } |
| [5957](#L5957) | } |
| [5958](#L5958) |  |
| [5959](#L5959) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_PHP\_PROCESSING'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_PHP\_PROCESSING'] = DEFAULT\_DISABLE\_PHP\_PROCESSING; |
| [5960](#L5960) |  |
| [5961](#L5961) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_PHP\_PROCESSING']); |
| [5962](#L5962) | } |
| [5963](#L5963) |  |
| [5964](#L5964) | function get\_disable\_html\_code () { |
| [5965](#L5965) | global $ai\_db\_options; |
| [5966](#L5966) |  |
| [5967](#L5967) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_HTML\_CODE]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_HTML\_CODE] && get\_remote\_debugging ()) return true; |
| [5968](#L5968) |  |
| [5969](#L5969) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [5970](#L5970) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'html') return true; |
| [5971](#L5971) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [5972](#L5972) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [5973](#L5973) | if (in\_array ('html', $blocks)) return true; |
| [5974](#L5974) | } |
| [5975](#L5975) | } |
| [5976](#L5976) |  |
| [5977](#L5977) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HTML\_CODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HTML\_CODE'] = DEFAULT\_DISABLE\_CSS\_CODE; |
| [5978](#L5978) |  |
| [5979](#L5979) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HTML\_CODE']); |
| [5980](#L5980) | } |
| [5981](#L5981) |  |
| [5982](#L5982) | function get\_disable\_css\_code () { |
| [5983](#L5983) | global $ai\_db\_options; |
| [5984](#L5984) |  |
| [5985](#L5985) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_CSS\_CODE]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_CSS\_CODE] && get\_remote\_debugging ()) return true; |
| [5986](#L5986) |  |
| [5987](#L5987) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [5988](#L5988) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'css') return true; |
| [5989](#L5989) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [5990](#L5990) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [5991](#L5991) | if (in\_array ('css', $blocks)) return true; |
| [5992](#L5992) | } |
| [5993](#L5993) | } |
| [5994](#L5994) |  |
| [5995](#L5995) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CSS\_CODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CSS\_CODE'] = DEFAULT\_DISABLE\_CSS\_CODE; |
| [5996](#L5996) |  |
| [5997](#L5997) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_CSS\_CODE']); |
| [5998](#L5998) | } |
| [5999](#L5999) |  |
| [6000](#L6000) | function get\_disable\_js\_code () { |
| [6001](#L6001) | global $ai\_db\_options; |
| [6002](#L6002) |  |
| [6003](#L6003) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_JS\_CODE]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_JS\_CODE] && get\_remote\_debugging ()) return true; |
| [6004](#L6004) |  |
| [6005](#L6005) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [6006](#L6006) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'js') return true; |
| [6007](#L6007) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [6008](#L6008) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [6009](#L6009) | if (in\_array ('js', $blocks)) return true; |
| [6010](#L6010) | } |
| [6011](#L6011) | } |
| [6012](#L6012) |  |
| [6013](#L6013) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_JS\_CODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_JS\_CODE'] = DEFAULT\_DISABLE\_JS\_CODE; |
| [6014](#L6014) |  |
| [6015](#L6015) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_JS\_CODE']); |
| [6016](#L6016) | } |
| [6017](#L6017) |  |
| [6018](#L6018) | function get\_disable\_header\_code () { |
| [6019](#L6019) | global $ai\_db\_options; |
| [6020](#L6020) |  |
| [6021](#L6021) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_HEADER\_CODE]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_HEADER\_CODE] && get\_remote\_debugging ()) return true; |
| [6022](#L6022) |  |
| [6023](#L6023) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [6024](#L6024) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'h') return true; |
| [6025](#L6025) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [6026](#L6026) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [6027](#L6027) | if (in\_array ('h', $blocks)) return true; |
| [6028](#L6028) | } |
| [6029](#L6029) | } |
| [6030](#L6030) |  |
| [6031](#L6031) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HEADER\_CODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HEADER\_CODE'] = DEFAULT\_DISABLE\_HEADER\_CODE; |
| [6032](#L6032) |  |
| [6033](#L6033) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_HEADER\_CODE']); |
| [6034](#L6034) | } |
| [6035](#L6035) |  |
| [6036](#L6036) | function get\_disable\_footer\_code () { |
| [6037](#L6037) | global $ai\_db\_options; |
| [6038](#L6038) |  |
| [6039](#L6039) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_FOOTER\_CODE]) && $\_GET [AI\_URL\_DEBUG\_DISABLE\_FOOTER\_CODE] && get\_remote\_debugging ()) return true; |
| [6040](#L6040) |  |
| [6041](#L6041) | if (isset ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]) && get\_remote\_debugging ()) { |
| [6042](#L6042) | if ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS] == 'f') return true; |
| [6043](#L6043) | if (strpos ($\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS], '-') !== false) { |
| [6044](#L6044) | $blocks = explode ('-', $\_GET [AI\_URL\_DEBUG\_DISABLE\_BLOCK\_INSERTIONS]); |
| [6045](#L6045) | if (in\_array ('f', $blocks)) return true; |
| [6046](#L6046) | } |
| [6047](#L6047) | } |
| [6048](#L6048) |  |
| [6049](#L6049) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_FOOTER\_CODE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_FOOTER\_CODE'] = DEFAULT\_DISABLE\_FOOTER\_CODE; |
| [6050](#L6050) |  |
| [6051](#L6051) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['DISABLE\_FOOTER\_CODE']); |
| [6052](#L6052) | } |
| [6053](#L6053) |  |
| [6054](#L6054) | function get\_blocks\_sticky () { |
| [6055](#L6055) | if (!function\_exists ('ai\_block\_list\_buttons')) return false; |
| [6056](#L6056) |  |
| [6057](#L6057) | $current\_flags = get\_option (AI\_FLAGS\_NAME, 0); |
| [6058](#L6058) | return (($current\_flags & AD\_FLAGS\_BLOCKS\_STICKY) != 0); |
| [6059](#L6059) | } |
| [6060](#L6060) |  |
| [6061](#L6061) | function get\_settings\_hidden () { |
| [6062](#L6062) | if (!function\_exists ('ai\_block\_list\_buttons')) return false; |
| [6063](#L6063) |  |
| [6064](#L6064) | $current\_flags = get\_option (AI\_FLAGS\_NAME, 0); |
| [6065](#L6065) | return (($current\_flags & AD\_FLAGS\_SETTINGS\_HIDDEN) != 0); |
| [6066](#L6066) | } |
| [6067](#L6067) |  |
| [6068](#L6068) | function get\_viewport\_name ($viewport\_number) { |
| [6069](#L6069) | global $ai\_db\_options; |
| [6070](#L6070) |  |
| [6071](#L6071) | $viewport\_settins\_name = 'VIEWPORT\_NAME\_' . $viewport\_number; |
| [6072](#L6072) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name])) |
| [6073](#L6073) | $ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name] = defined ("DEFAULT\_VIEWPORT\_NAME\_" . $viewport\_number) ? constant ("DEFAULT\_VIEWPORT\_NAME\_" . $viewport\_number) : ""; |
| [6074](#L6074) |  |
| [6075](#L6075) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name]); |
| [6076](#L6076) | } |
| [6077](#L6077) |  |
| [6078](#L6078) | function get\_viewport\_width ($viewport\_number) { |
| [6079](#L6079) | global $ai\_db\_options; |
| [6080](#L6080) |  |
| [6081](#L6081) | $viewport\_settins\_name = 'VIEWPORT\_WIDTH\_' . $viewport\_number; |
| [6082](#L6082) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name])) |
| [6083](#L6083) | $ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name] = defined ("DEFAULT\_VIEWPORT\_WIDTH\_" . $viewport\_number) ? constant ("DEFAULT\_VIEWPORT\_WIDTH\_" . $viewport\_number) : ""; |
| [6084](#L6084) |  |
| [6085](#L6085) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$viewport\_settins\_name]); |
| [6086](#L6086) | } |
| [6087](#L6087) |  |
| [6088](#L6088) | function get\_constant\_name ($constant\_number) { |
| [6089](#L6089) | global $ai\_db\_options; |
| [6090](#L6090) |  |
| [6091](#L6091) | $constant\_settins\_name = 'CONSTANT\_NAME\_' . $constant\_number; |
| [6092](#L6092) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name] = ""; |
| [6093](#L6093) |  |
| [6094](#L6094) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name]); |
| [6095](#L6095) | } |
| [6096](#L6096) |  |
| [6097](#L6097) | function get\_constant\_value ($constant\_number) { |
| [6098](#L6098) | global $ai\_db\_options; |
| [6099](#L6099) |  |
| [6100](#L6100) | $constant\_settins\_name = 'CONSTANT\_VALUE\_' . $constant\_number; |
| [6101](#L6101) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name] = ""; |
| [6102](#L6102) |  |
| [6103](#L6103) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$constant\_settins\_name]); |
| [6104](#L6104) | } |
| [6105](#L6105) |  |
| [6106](#L6106) | function get\_hook\_enabled ($hook\_number) { |
| [6107](#L6107) | global $ai\_db\_options; |
| [6108](#L6108) |  |
| [6109](#L6109) | $hook\_settins\_name = 'HOOK\_ENABLED\_' . $hook\_number; |
| [6110](#L6110) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name] = AI\_DISABLED; |
| [6111](#L6111) |  |
| [6112](#L6112) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name]); |
| [6113](#L6113) | } |
| [6114](#L6114) |  |
| [6115](#L6115) | function get\_hook\_name ($hook\_number) { |
| [6116](#L6116) | global $ai\_db\_options; |
| [6117](#L6117) |  |
| [6118](#L6118) | $hook\_settins\_name = 'HOOK\_NAME\_' . $hook\_number; |
| [6119](#L6119) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name] = ""; |
| [6120](#L6120) |  |
| [6121](#L6121) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name]); |
| [6122](#L6122) | } |
| [6123](#L6123) |  |
| [6124](#L6124) | function get\_hook\_action ($hook\_number) { |
| [6125](#L6125) | global $ai\_db\_options; |
| [6126](#L6126) |  |
| [6127](#L6127) | $hook\_settins\_name = 'HOOK\_ACTION\_' . $hook\_number; |
| [6128](#L6128) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name] = ""; |
| [6129](#L6129) |  |
| [6130](#L6130) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name]); |
| [6131](#L6131) | } |
| [6132](#L6132) |  |
| [6133](#L6133) | function get\_hook\_priority ($hook\_number) { |
| [6134](#L6134) | global $ai\_db\_options; |
| [6135](#L6135) |  |
| [6136](#L6136) | $hook\_settins\_name = 'HOOK\_PRIORITY\_' . $hook\_number; |
| [6137](#L6137) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name] = DEFAULT\_CUSTOM\_HOOK\_PRIORITY; |
| [6138](#L6138) |  |
| [6139](#L6139) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$hook\_settins\_name]); |
| [6140](#L6140) | } |
| [6141](#L6141) |  |
| [6142](#L6142) | function get\_country\_group\_name ($group\_number) { |
| [6143](#L6143) | global $ai\_db\_options; |
| [6144](#L6144) |  |
| [6145](#L6145) | $country\_group\_settins\_name = 'COUNTRY\_GROUP\_NAME\_' . $group\_number; |
| [6146](#L6146) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$country\_group\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$country\_group\_settins\_name] = DEFAULT\_COUNTRY\_GROUP\_NAME . ' ' . $group\_number; |
| [6147](#L6147) |  |
| [6148](#L6148) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$country\_group\_settins\_name]); |
| [6149](#L6149) | } |
| [6150](#L6150) |  |
| [6151](#L6151) | function get\_group\_country\_list ($group\_number) { |
| [6152](#L6152) | global $ai\_db\_options; |
| [6153](#L6153) |  |
| [6154](#L6154) | $group\_countries\_settins\_name = 'GROUP\_COUNTRIES\_' . $group\_number; |
| [6155](#L6155) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL][$group\_countries\_settins\_name])) $ai\_db\_options [AI\_OPTION\_GLOBAL][$group\_countries\_settins\_name] = ''; |
| [6156](#L6156) |  |
| [6157](#L6157) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL][$group\_countries\_settins\_name]); |
| [6158](#L6158) | } |
| [6159](#L6159) |  |
| [6160](#L6160) | function multisite\_settings\_page\_enabled () { |
| [6161](#L6161) | global $ai\_db\_options\_multisite; |
| [6162](#L6162) |  |
| [6163](#L6163) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6164](#L6164) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'])) $ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'] = DEFAULT\_MULTISITE\_SETTINGS\_PAGE; |
| [6165](#L6165) | if ($ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'] == '')    $ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'] = DEFAULT\_MULTISITE\_SETTINGS\_PAGE; |
| [6166](#L6166) |  |
| [6167](#L6167) | if (multisite\_main\_for\_all\_blogs ()) $ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'] = AI\_DISABLED; |
| [6168](#L6168) | elseif (current\_user\_can ('manage\_network\_plugins')) $ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE'] = AI\_ENABLED; |
| [6169](#L6169) |  |
| [6170](#L6170) | return ($ai\_db\_options\_multisite ['MULTISITE\_SETTINGS\_PAGE']); |
| [6171](#L6171) | } |
| [6172](#L6172) |  |
| [6173](#L6173) | return DEFAULT\_MULTISITE\_SETTINGS\_PAGE; |
| [6174](#L6174) | } |
| [6175](#L6175) |  |
| [6176](#L6176) | function multisite\_widgets\_enabled () { |
| [6177](#L6177) | global $ai\_db\_options\_multisite; |
| [6178](#L6178) |  |
| [6179](#L6179) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6180](#L6180) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_WIDGETS'])) $ai\_db\_options\_multisite ['MULTISITE\_WIDGETS'] = DEFAULT\_MULTISITE\_WIDGETS; |
| [6181](#L6181) | if ($ai\_db\_options\_multisite ['MULTISITE\_WIDGETS'] == '')    $ai\_db\_options\_multisite ['MULTISITE\_WIDGETS'] = DEFAULT\_MULTISITE\_WIDGETS; |
| [6182](#L6182) |  |
| [6183](#L6183) | return ($ai\_db\_options\_multisite ['MULTISITE\_WIDGETS']); |
| [6184](#L6184) | } |
| [6185](#L6185) |  |
| [6186](#L6186) | return DEFAULT\_MULTISITE\_WIDGETS; |
| [6187](#L6187) | } |
| [6188](#L6188) |  |
| [6189](#L6189) | function multisite\_php\_processing () { |
| [6190](#L6190) | global $ai\_db\_options\_multisite; |
| [6191](#L6191) |  |
| [6192](#L6192) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6193](#L6193) | if (function\_exists ('ai\_filter\_multisite\_settings')) { |
| [6194](#L6194) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_PHP\_PROCESSING'])) $ai\_db\_options\_multisite ['MULTISITE\_PHP\_PROCESSING'] = DEFAULT\_MULTISITE\_PHP\_PROCESSING; |
| [6195](#L6195) | if ($ai\_db\_options\_multisite ['MULTISITE\_PHP\_PROCESSING'] == '')    $ai\_db\_options\_multisite ['MULTISITE\_PHP\_PROCESSING'] = DEFAULT\_MULTISITE\_PHP\_PROCESSING; |
| [6196](#L6196) |  |
| [6197](#L6197) | return ($ai\_db\_options\_multisite ['MULTISITE\_PHP\_PROCESSING']); |
| [6198](#L6198) | } |
| [6199](#L6199) |  |
| [6200](#L6200) | return AI\_ENABLED; |
| [6201](#L6201) | } |
| [6202](#L6202) |  |
| [6203](#L6203) | return DEFAULT\_MULTISITE\_PHP\_PROCESSING; |
| [6204](#L6204) | } |
| [6205](#L6205) |  |
| [6206](#L6206) | function multisite\_exceptions\_enabled () { |
| [6207](#L6207) | global $ai\_db\_options\_multisite; |
| [6208](#L6208) |  |
| [6209](#L6209) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6210](#L6210) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_EXCEPTIONS'])) $ai\_db\_options\_multisite ['MULTISITE\_EXCEPTIONS'] = DEFAULT\_MULTISITE\_EXCEPTIONS; |
| [6211](#L6211) | if ($ai\_db\_options\_multisite ['MULTISITE\_EXCEPTIONS'] == '')    $ai\_db\_options\_multisite ['MULTISITE\_EXCEPTIONS'] = DEFAULT\_MULTISITE\_EXCEPTIONS; |
| [6212](#L6212) |  |
| [6213](#L6213) | return ($ai\_db\_options\_multisite ['MULTISITE\_EXCEPTIONS']); |
| [6214](#L6214) | } |
| [6215](#L6215) |  |
| [6216](#L6216) | return DEFAULT\_MULTISITE\_EXCEPTIONS; |
| [6217](#L6217) | } |
| [6218](#L6218) |  |
| [6219](#L6219) | function multisite\_main\_for\_all\_blogs () { |
| [6220](#L6220) | global $ai\_db\_options\_multisite; |
| [6221](#L6221) |  |
| [6222](#L6222) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6223](#L6223) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'])) $ai\_db\_options\_multisite ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'] = DEFAULT\_MULTISITE\_MAIN\_FOR\_ALL\_BLOGS; |
| [6224](#L6224) | if ($ai\_db\_options\_multisite ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'] == '')    $ai\_db\_options\_multisite ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS'] = DEFAULT\_MULTISITE\_MAIN\_FOR\_ALL\_BLOGS; |
| [6225](#L6225) |  |
| [6226](#L6226) | return ($ai\_db\_options\_multisite ['MULTISITE\_MAIN\_FOR\_ALL\_BLOGS']); |
| [6227](#L6227) | } |
| [6228](#L6228) |  |
| [6229](#L6229) | return DEFAULT\_MULTISITE\_MAIN\_FOR\_ALL\_BLOGS; |
| [6230](#L6230) | } |
| [6231](#L6231) |  |
| [6232](#L6232) | function multisite\_site\_admin\_page () { |
| [6233](#L6233) | global $ai\_db\_options\_multisite; |
| [6234](#L6234) |  |
| [6235](#L6235) | if (ai\_remote ('multisite', is\_multisite ())) { |
| [6236](#L6236) | if (!isset ($ai\_db\_options\_multisite ['MULTISITE\_SITE\_ADMIN\_PAGE'])) $ai\_db\_options\_multisite ['MULTISITE\_SITE\_ADMIN\_PAGE'] = DEFAULT\_MULTISITE\_SITE\_ADMIN\_PAGE; |
| [6237](#L6237) |  |
| [6238](#L6238) | if (multisite\_main\_for\_all\_blogs ()) $ai\_db\_options\_multisite ['MULTISITE\_SITE\_ADMIN\_PAGE'] = AI\_DISABLED; |
| [6239](#L6239) |  |
| [6240](#L6240) | return ($ai\_db\_options\_multisite ['MULTISITE\_SITE\_ADMIN\_PAGE']); |
| [6241](#L6241) | } |
| [6242](#L6242) |  |
| [6243](#L6243) | return DEFAULT\_MULTISITE\_SITE\_ADMIN\_PAGE; |
| [6244](#L6244) | } |
| [6245](#L6245) |  |
| [6246](#L6246) | function get\_adb\_devices () { |
| [6247](#L6247) | global $ai\_db\_options, $ai\_wp\_data; |
| [6248](#L6248) |  |
| [6249](#L6249) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DEVICES'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DEVICES'] = AI\_DEFAULT\_ADB\_DEVICES; |
| [6250](#L6250) |  |
| [6251](#L6251) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DEVICES']); |
| [6252](#L6252) | } |
| [6253](#L6253) |  |
| [6254](#L6254) | function get\_adb\_action ($saved\_value = false) { |
| [6255](#L6255) | global $ai\_db\_options, $ai\_wp\_data; |
| [6256](#L6256) |  |
| [6257](#L6257) | if (!$saved\_value) { |
| [6258](#L6258) | if ($ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) return AI\_ADB\_ACTION\_NONE; |
| [6259](#L6259) |  |
| [6260](#L6260) | switch (get\_adb\_no\_action ()) { |
| [6261](#L6261) | case AI\_ADB\_NO\_ACTION\_LOGGED\_IN: |
| [6262](#L6262) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) return AI\_ADB\_ACTION\_NONE; |
| [6263](#L6263) | break; |
| [6264](#L6264) | case AI\_ADB\_NO\_ACTION\_ADMINISTRATORS: |
| [6265](#L6265) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0) return AI\_ADB\_ACTION\_NONE; |
| [6266](#L6266) | break; |
| [6267](#L6267) | } |
| [6268](#L6268) |  |
| [6269](#L6269) | if (isset ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_ACTION])) return ($ai\_wp\_data [AI\_ADB\_SHORTCODE\_ACTION]); |
| [6270](#L6270) | } |
| [6271](#L6271) |  |
| [6272](#L6272) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_ACTION'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_ACTION'] = AI\_DEFAULT\_ADB\_ACTION; |
| [6273](#L6273) |  |
| [6274](#L6274) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_ACTION']); |
| [6275](#L6275) | } |
| [6276](#L6276) |  |
| [6277](#L6277) | function get\_adb\_no\_action ($saved\_value = false) { |
| [6278](#L6278) | global $ai\_db\_options, $ai\_wp\_data; |
| [6279](#L6279) |  |
| [6280](#L6280) | if (!$saved\_value) { |
| [6281](#L6281) | if ($ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) return AI\_ADB\_NO\_ACTION\_NONE; |
| [6282](#L6282) | } |
| [6283](#L6283) |  |
| [6284](#L6284) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION'] = AI\_DEFAULT\_ADB\_NO\_ACTION; |
| [6285](#L6285) |  |
| [6286](#L6286) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION']); |
| [6287](#L6287) | } |
| [6288](#L6288) |  |
| [6289](#L6289) | function get\_delay\_action ($return\_number = false) { |
| [6290](#L6290) | global $ai\_db\_options; |
| [6291](#L6291) |  |
| [6292](#L6292) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DELAY\_ACTION'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DELAY\_ACTION'] = ''; |
| [6293](#L6293) |  |
| [6294](#L6294) | if ($return\_number) { |
| [6295](#L6295) | $value = trim ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DELAY\_ACTION']); |
| [6296](#L6296) | if ($value == '') $value = 0; |
| [6297](#L6297) | //    if (is\_numeric ($value)) return $value; else return 0; |
| [6298](#L6298) | } |
| [6299](#L6299) |  |
| [6300](#L6300) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_DELAY\_ACTION']); |
| [6301](#L6301) | } |
| [6302](#L6302) |  |
| [6303](#L6303) | function get\_no\_action\_period ($return\_number = false) { |
| [6304](#L6304) | global $ai\_db\_options; |
| [6305](#L6305) |  |
| [6306](#L6306) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION\_PERIOD'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION\_PERIOD'] = AI\_DEFAULT\_ADB\_NO\_ACTION\_PERIOD; |
| [6307](#L6307) |  |
| [6308](#L6308) | if ($return\_number) { |
| [6309](#L6309) | $value = trim ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION\_PERIOD']); |
| [6310](#L6310) | if ($value == '') $value = 0; |
| [6311](#L6311) | if (is\_numeric ($value)) return $value; else return AI\_DEFAULT\_ADB\_NO\_ACTION\_PERIOD; |
| [6312](#L6312) | } |
| [6313](#L6313) |  |
| [6314](#L6314) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_ACTION\_PERIOD']); |
| [6315](#L6315) | } |
| [6316](#L6316) |  |
| [6317](#L6317) | function get\_adb\_selectors ($decode = false) { |
| [6318](#L6318) | global $ai\_db\_options; |
| [6319](#L6319) |  |
| [6320](#L6320) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_SELECTORS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_SELECTORS'] = ''; |
| [6321](#L6321) |  |
| [6322](#L6322) | if ($decode) |
| [6323](#L6323) | return (html\_entity\_decode ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_SELECTORS'])); else |
| [6324](#L6324) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_SELECTORS']); |
| [6325](#L6325) | } |
| [6326](#L6326) |  |
| [6327](#L6327) | function get\_redirection\_page ($return\_number = false) { |
| [6328](#L6328) | global $ai\_db\_options; |
| [6329](#L6329) |  |
| [6330](#L6330) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_REDIRECTION\_PAGE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_REDIRECTION\_PAGE'] = AI\_DEFAULT\_ADB\_REDIRECTION\_PAGE; |
| [6331](#L6331) |  |
| [6332](#L6332) | if ($return\_number) { |
| [6333](#L6333) | $value = trim ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_REDIRECTION\_PAGE']); |
| [6334](#L6334) | if ($value == '') $value = 0; |
| [6335](#L6335) | if (is\_numeric ($value)) return $value; else return AI\_DEFAULT\_ADB\_REDIRECTION\_PAGE; |
| [6336](#L6336) | } |
| [6337](#L6337) |  |
| [6338](#L6338) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_REDIRECTION\_PAGE']); |
| [6339](#L6339) | } |
| [6340](#L6340) |  |
| [6341](#L6341) | function get\_custom\_redirection\_url () { |
| [6342](#L6342) | global $ai\_db\_options; |
| [6343](#L6343) |  |
| [6344](#L6344) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_CUSTOM\_REDIRECTION\_URL'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_CUSTOM\_REDIRECTION\_URL'] = ''; |
| [6345](#L6345) |  |
| [6346](#L6346) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_CUSTOM\_REDIRECTION\_URL']); |
| [6347](#L6347) | } |
| [6348](#L6348) |  |
| [6349](#L6349) | function get\_adb\_external\_scripts () { |
| [6350](#L6350) | global $ai\_db\_options; |
| [6351](#L6351) |  |
| [6352](#L6352) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_EXTERNAL\_SCRIPTS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_EXTERNAL\_SCRIPTS'] = AI\_DEFAULT\_ADB\_EXTERNAL\_SCRIPTS; |
| [6353](#L6353) |  |
| [6354](#L6354) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_EXTERNAL\_SCRIPTS']); |
| [6355](#L6355) | } |
| [6356](#L6356) |  |
| [6357](#L6357) | function get\_message\_css () { |
| [6358](#L6358) | global $ai\_db\_options; |
| [6359](#L6359) |  |
| [6360](#L6360) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_MESSAGE\_CSS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_MESSAGE\_CSS'] = AI\_DEFAULT\_ADB\_MESSAGE\_CSS; |
| [6361](#L6361) |  |
| [6362](#L6362) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_MESSAGE\_CSS']); |
| [6363](#L6363) | } |
| [6364](#L6364) |  |
| [6365](#L6365) | function get\_overlay\_css () { |
| [6366](#L6366) | global $ai\_db\_options; |
| [6367](#L6367) |  |
| [6368](#L6368) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_OVERLAY\_CSS'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_OVERLAY\_CSS'] = AI\_DEFAULT\_ADB\_OVERLAY\_CSS; |
| [6369](#L6369) |  |
| [6370](#L6370) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_OVERLAY\_CSS']); |
| [6371](#L6371) | } |
| [6372](#L6372) |  |
| [6373](#L6373) | function get\_undismissible\_message ($saved\_value = false) { |
| [6374](#L6374) | global $ai\_db\_options, $ai\_wp\_data; |
| [6375](#L6375) |  |
| [6376](#L6376) | if (!$saved\_value) { |
| [6377](#L6377) | switch (get\_no\_undismissible\_message ()) { |
| [6378](#L6378) | case AI\_ADB\_NO\_ACTION\_LOGGED\_IN: |
| [6379](#L6379) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_LOGGED\_IN) != 0) return AI\_DISABLED; |
| [6380](#L6380) | break; |
| [6381](#L6381) | case AI\_ADB\_NO\_ACTION\_ADMINISTRATORS: |
| [6382](#L6382) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0) return AI\_DISABLED; |
| [6383](#L6383) | break; |
| [6384](#L6384) | } |
| [6385](#L6385) | } |
| [6386](#L6386) |  |
| [6387](#L6387) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_UNDISMISSIBLE\_MESSAGE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_UNDISMISSIBLE\_MESSAGE'] = AI\_DEFAULT\_ADB\_UNDISMISSIBLE\_MESSAGE; |
| [6388](#L6388) |  |
| [6389](#L6389) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_UNDISMISSIBLE\_MESSAGE']); |
| [6390](#L6390) | } |
| [6391](#L6391) |  |
| [6392](#L6392) | function get\_no\_undismissible\_message () { |
| [6393](#L6393) | global $ai\_db\_options; |
| [6394](#L6394) |  |
| [6395](#L6395) | if (!isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_UNDISMISSIBLE\_MESSAGE'])) $ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_UNDISMISSIBLE\_MESSAGE'] = AI\_DEFAULT\_ADB\_NO\_UNDISMISSIBLE\_MESSAGE; |
| [6396](#L6396) |  |
| [6397](#L6397) | return ($ai\_db\_options [AI\_OPTION\_GLOBAL]['ADB\_NO\_UNDISMISSIBLE\_MESSAGE']); |
| [6398](#L6398) | } |
| [6399](#L6399) |  |
| [6400](#L6400) | function filter\_html\_class ($str){ |
| [6401](#L6401) |  |
| [6402](#L6402) | $str = str\_replace (array ("\\\""), array ("\""), $str); |
| [6403](#L6403) | $str = sanitize\_html\_class ($str); |
| [6404](#L6404) |  |
| [6405](#L6405) | return $str; |
| [6406](#L6406) | } |
| [6407](#L6407) |  |
| [6408](#L6408) | function filter\_string ($str){ |
| [6409](#L6409) |  |
| [6410](#L6410) | $str = str\_replace (array ("\\\""), array ("\""), $str); |
| [6411](#L6411) | $str = str\_replace (array ("\"", "<", ">"), "", $str); |
| [6412](#L6412) | $str = trim (esc\_html ($str)); |
| [6413](#L6413) |  |
| [6414](#L6414) | return $str; |
| [6415](#L6415) | } |
| [6416](#L6416) |  |
| [6417](#L6417) | function filter\_string\_tags ($str){ |
| [6418](#L6418) |  |
| [6419](#L6419) | $str = str\_replace (array ("\\\""), array ("\""), $str); |
| [6420](#L6420) | $str = str\_replace (array ("\""), "", $str); |
| [6421](#L6421) | $str = str\_replace (array ("<", ">"), array ("&lt;", "&gt;"), $str); |
| [6422](#L6422) | $str = trim (esc\_html ($str)); |
| [6423](#L6423) |  |
| [6424](#L6424) | return $str; |
| [6425](#L6425) | } |
| [6426](#L6426) |  |
| [6427](#L6427) | function filter\_option ($option, $value, $delete\_escaped\_backslashes = true){ |
| [6428](#L6428) | if ($delete\_escaped\_backslashes) |
| [6429](#L6429) | $value = str\_replace (array ("\\\""), array ("\""), $value); |
| [6430](#L6430) |  |
| [6431](#L6431) | if ($option == 'ADB\_SELECTORS' || |
| [6432](#L6432) | $option == AI\_OPTION\_HTML\_SELECTOR || |
| [6433](#L6433) | $option == AI\_OPTION\_ANIMATION\_TRIGGER\_VALUE || |
| [6434](#L6434) | $option == 'MAIN\_CONTENT\_ELEMENT') { |
| [6435](#L6435) | $value = str\_replace (array ("\\", "/", "?", "\"", "'", "'", '"'), "", $value); |
| [6436](#L6436) | $value = esc\_html ($value); |
| [6437](#L6437) | } |
| [6438](#L6438) | elseif ($option == AI\_OPTION\_DOMAIN\_LIST || |
| [6439](#L6439) | $option == 'NO\_PARAGRAPH\_COUNTING\_INSIDE' || |
| [6440](#L6440) | $option == AI\_OPTION\_BACKGROUND\_COLOR || |
| [6441](#L6441) | $option == AI\_OPTION\_BLOCK\_BACKGROUND\_COLOR || |
| [6442](#L6442) | $option == AI\_OPTION\_PARAGRAPH\_TAGS || |
| [6443](#L6443) | $option == AI\_OPTION\_COUNT\_INSIDE\_ELEMENTS || |
| [6444](#L6444) | $option == AI\_OPTION\_IP\_ADDRESS\_LIST || |
| [6445](#L6445) | $option == AI\_OPTION\_COUNTRY\_LIST) { |
| [6446](#L6446) | $value = str\_replace (array ("\\", "/", "?", "\"", "'", "<", ">", "[", "]", "'", '"'), "", $value); |
| [6447](#L6447) | $value = esc\_html ($value); |
| [6448](#L6448) | } |
| [6449](#L6449) | elseif ($option == AI\_OPTION\_BLOCK\_WIDTH || |
| [6450](#L6450) | $option == AI\_OPTION\_BLOCK\_HEIGHT) { |
| [6451](#L6451) | $value = str\_replace (array ("\"", "'", "<", ">", "[", "]", "'", '"'), "", $value); |
| [6452](#L6452) | $value = esc\_html ($value); |
| [6453](#L6453) | } |
| [6454](#L6454) | elseif ( |
| [6455](#L6455) | $option == AI\_OPTION\_PARAGRAPH\_TEXT || |
| [6456](#L6456) | $option == AI\_OPTION\_COUNT\_INSIDE\_ELEMENTS\_TEXT || |
| [6457](#L6457) | $option == AI\_OPTION\_AVOID\_TEXT\_ABOVE || |
| [6458](#L6458) | $option == AI\_OPTION\_AVOID\_TEXT\_BELOW || |
| [6459](#L6459) | $option == AI\_OPTION\_CLIENT\_LIST |
| [6460](#L6460) | ) { |
| [6461](#L6461) | $value = esc\_html ($value); |
| [6462](#L6462) | } |
| [6463](#L6463) | elseif ($option == AI\_OPTION\_BLOCK\_NAME || |
| [6464](#L6464) | $option == AI\_OPTION\_GENERAL\_TAG || |
| [6465](#L6465) | $option == AI\_OPTION\_DOMAIN\_LIST || |
| [6466](#L6466) | $option == AI\_OPTION\_CATEGORY\_LIST || |
| [6467](#L6467) | $option == AI\_OPTION\_TAG\_LIST || |
| [6468](#L6468) | $option == AI\_OPTION\_TAXONOMY\_LIST || |
| [6469](#L6469) | $option == AI\_OPTION\_ID\_LIST || |
| [6470](#L6470) | $option == AI\_OPTION\_URL\_LIST || |
| [6471](#L6471) | $option == AI\_OPTION\_MIN\_PARAGRAPHS || |
| [6472](#L6472) | $option == AI\_OPTION\_MAX\_PARAGRAPHS || |
| [6473](#L6473) | $option == AI\_OPTION\_SKIP\_FIRST\_PARAGRAPHS || |
| [6474](#L6474) | $option == AI\_OPTION\_SKIP\_LAST\_PARAGRAPHS || |
| [6475](#L6475) | $option == AI\_OPTION\_MIN\_WORDS\_ABOVE || |
| [6476](#L6476) | $option == AI\_OPTION\_AVOID\_PARAGRAPHS\_ABOVE || |
| [6477](#L6477) | $option == AI\_OPTION\_AVOID\_PARAGRAPHS\_BELOW || |
| [6478](#L6478) | $option == AI\_OPTION\_AVOID\_TRY\_LIMIT || |
| [6479](#L6479) | $option == AI\_OPTION\_MIN\_WORDS || |
| [6480](#L6480) | $option == AI\_OPTION\_MAX\_WORDS || |
| [6481](#L6481) | $option == AI\_OPTION\_MIN\_PARAGRAPH\_WORDS || |
| [6482](#L6482) | $option == AI\_OPTION\_MAX\_PARAGRAPH\_WORDS || |
| [6483](#L6483) | $option == AI\_OPTION\_MAXIMUM\_INSERTIONS || |
| [6484](#L6484) | $option == AI\_OPTION\_AFTER\_DAYS || |
| [6485](#L6485) | $option == AI\_OPTION\_START\_DATE || |
| [6486](#L6486) | $option == AI\_OPTION\_END\_DATE || |
| [6487](#L6487) | $option == AI\_OPTION\_SCHEDULING\_FALLBACK || |
| [6488](#L6488) | $option == AI\_OPTION\_LIMITS\_FALLBACK || |
| [6489](#L6489) | $option == AI\_OPTION\_EXCERPT\_NUMBER || |
| [6490](#L6490) | $option == AI\_OPTION\_WAIT\_FOR\_DELAY || |
| [6491](#L6491) | $option == AI\_OPTION\_HORIZONTAL\_MARGIN || |
| [6492](#L6492) | $option == AI\_OPTION\_VERTICAL\_MARGIN || |
| [6493](#L6493) | $option == AI\_OPTION\_ANIMATION\_TRIGGER\_OFFSET || |
| [6494](#L6494) | $option == AI\_OPTION\_ANIMATION\_TRIGGER\_DELAY || |
| [6495](#L6495) | $option == AI\_OPTION\_IFRAME\_WIDTH || |
| [6496](#L6496) | $option == AI\_OPTION\_IFRAME\_HEIGHT || |
| [6497](#L6497) | $option == AI\_OPTION\_STICKY\_HEIGHT || |
| [6498](#L6498) |  |
| [6499](#L6499) | $option == AI\_OPTION\_AUTO\_CLOSE\_TIME || |
| [6500](#L6500) | $option == AI\_OPTION\_STAY\_CLOSED\_TIME || |
| [6501](#L6501) | $option == AI\_OPTION\_DELAY\_SHOWING || |
| [6502](#L6502) | $option == AI\_OPTION\_SHOW\_EVERY || |
| [6503](#L6503) | $option == AI\_OPTION\_VISITOR\_MAX\_IMPRESSIONS || |
| [6504](#L6504) | $option == AI\_OPTION\_VISITOR\_LIMIT\_IMPRESSIONS\_PER\_TIME\_PERIOD || |
| [6505](#L6505) | $option == AI\_OPTION\_VISITOR\_LIMIT\_IMPRESSIONS\_TIME\_PERIOD || |
| [6506](#L6506) | $option == AI\_OPTION\_MAX\_IMPRESSIONS || |
| [6507](#L6507) | $option == AI\_OPTION\_LIMIT\_IMPRESSIONS\_PER\_TIME\_PERIOD || |
| [6508](#L6508) | $option == AI\_OPTION\_LIMIT\_IMPRESSIONS\_TIME\_PERIOD || |
| [6509](#L6509) | $option == AI\_OPTION\_VISITOR\_MAX\_CLICKS || |
| [6510](#L6510) | $option == AI\_OPTION\_VISITOR\_LIMIT\_CLICKS\_PER\_TIME\_PERIOD || |
| [6511](#L6511) | $option == AI\_OPTION\_VISITOR\_LIMIT\_CLICKS\_TIME\_PERIOD || |
| [6512](#L6512) | $option == AI\_OPTION\_MAX\_CLICKS || |
| [6513](#L6513) | $option == AI\_OPTION\_LIMIT\_CLICKS\_PER\_TIME\_PERIOD || |
| [6514](#L6514) | $option == AI\_OPTION\_LIMIT\_CLICKS\_TIME\_PERIOD || |
| [6515](#L6515) | $option == AI\_OPTION\_BACKGROUND\_IMAGE || |
| [6516](#L6516) | $option == AI\_OPTION\_PARALLAX . '\_1' || |
| [6517](#L6517) | $option == AI\_OPTION\_PARALLAX . '\_2' || |
| [6518](#L6518) | $option == AI\_OPTION\_PARALLAX . '\_3' || |
| [6519](#L6519) | $option == AI\_OPTION\_PARALLAX\_IMAGE . '\_1' || |
| [6520](#L6520) | $option == AI\_OPTION\_PARALLAX\_IMAGE . '\_2' || |
| [6521](#L6521) | $option == AI\_OPTION\_PARALLAX\_IMAGE . '\_3' || |
| [6522](#L6522) | $option == AI\_OPTION\_PARALLAX\_SHIFT . '\_1' || |
| [6523](#L6523) | $option == AI\_OPTION\_PARALLAX\_SHIFT . '\_2' || |
| [6524](#L6524) | $option == AI\_OPTION\_PARALLAX\_SHIFT . '\_3' || |
| [6525](#L6525) | $option == AI\_OPTION\_PARALLAX\_LINK || |
| [6526](#L6526) | $option == 'CLICK\_FRAUD\_PROTECTION\_TIME' || |
| [6527](#L6527) | $option == 'GLOBAL\_VISITOR\_LIMIT\_CPT' || |
| [6528](#L6528) | $option == 'GLOBAL\_VISITOR\_LIMIT\_TIME' || |
| [6529](#L6529) | $option == 'ADB\_DELAY\_ACTION' || |
| [6530](#L6530) | $option == 'ADB\_NO\_ACTION\_PERIOD' || |
| [6531](#L6531) | $option == 'ADB\_REDIRECTION\_PAGE' || |
| [6532](#L6532) | $option == 'ADB\_CUSTOM\_REDIRECTION\_URL' || |
| [6533](#L6533) | $option == AI\_OPTION\_CUSTOM\_CSS || |
| [6534](#L6534) | $option == 'HOOK\_PRIORITY' || |
| [6535](#L6535) | $option == 'ADB\_OVERLAY\_CSS' || |
| [6536](#L6536) | $option == 'ADB\_MESSAGE\_CSS') { |
| [6537](#L6537) | $value = str\_replace (array ("\"", "<", ">", "[", "]"), "", $value); |
| [6538](#L6538) | $value = esc\_html ($value); |
| [6539](#L6539) | } |
| [6540](#L6540) | elseif ($option == AI\_OPTION\_PARAGRAPH\_NUMBER) { |
| [6541](#L6541) | $value = str\_replace (array ("\"", "<", ">"), "", $value); |
| [6542](#L6542) | $value = esc\_html ($value); |
| [6543](#L6543) | } |
| [6544](#L6544) | elseif ($option == AI\_OPTION\_URL\_PARAMETER\_LIST || |
| [6545](#L6545) | $option == AI\_OPTION\_COOKIE\_LIST) { |
| [6546](#L6546) | $value = str\_replace (array ("\"", "<", ">"), "", $value); |
| [6547](#L6547) | $value = esc\_html ($value); |
| [6548](#L6548) | } |
| [6549](#L6549) | elseif ($option == 'AD\_LABEL') { |
| [6550](#L6550) | $value = str\_replace (array ("\\"), "", $value); |
| [6551](#L6551) | $value = esc\_html ($value); |
| [6552](#L6552) | } |
| [6553](#L6553) | elseif ($option == 'REPORT\_HEADER\_TITLE' || |
| [6554](#L6554) | $option == 'REPORT\_HEADER\_DESCRIPTION' || |
| [6555](#L6555) | $option == 'EXTERNAL\_TRACKING\_CATEGORY' || |
| [6556](#L6556) | $option == 'EXTERNAL\_TRACKING\_ACTION' || |
| [6557](#L6557) | $option == 'EXTERNAL\_TRACKING\_LABEL' || |
| [6558](#L6558) | $option == 'REPORT\_FOOTER') { |
| [6559](#L6559) | $value = str\_replace (array ("\\", "?"), "", $value); |
| [6560](#L6560) | $value = esc\_html ($value); |
| [6561](#L6561) | } |
| [6562](#L6562) | elseif ( |
| [6563](#L6563) | $option == 'REPORT\_HEADER\_IMAGE') { |
| [6564](#L6564) | $value = str\_replace (home\_url () . '/', '', $value); |
| [6565](#L6565) | $value = str\_replace (array ("http://", "https://", ":". "\"", "<", ">", "[", "]"), "", $value); |
| [6566](#L6566) | $value = esc\_html ($value); |
| [6567](#L6567) | } |
| [6568](#L6568) | elseif ( |
| [6569](#L6569) | $option == 'RECAPTCHA\_THRESHOLD' |
| [6570](#L6570) | ) { |
| [6571](#L6571) | $value = str\_replace (array (":". "\"", "<", ">", "[", "]"), "", $value); |
| [6572](#L6572) | $value = esc\_html ($value); |
| [6573](#L6573) | } |
| [6574](#L6574) | elseif ( |
| [6575](#L6575) | $option == 'MAXMIND\_LICENSE\_KEY' || |
| [6576](#L6576) | $option == 'GEO\_DB' |
| [6577](#L6577) | ) { |
| [6578](#L6578) | $value = str\_replace (array (":". "\"", "<", ">", "[", "]"), "", $value); |
| [6579](#L6579) | } |
| [6580](#L6580) |  |
| [6581](#L6581) | return $value; |
| [6582](#L6582) | } |
| [6583](#L6583) |  |
| [6584](#L6584) | function filter\_option\_hf ($option, $value){ |
| [6585](#L6585) | $value = str\_replace (array ("\\\""), array ("\""), $value); |
| [6586](#L6586) |  |
| [6587](#L6587) | //        if ($option == AI\_OPTION\_CODE ) { |
| [6588](#L6588) | //  } elseif ($option == AI\_OPTION\_ENABLE\_MANUAL) { |
| [6589](#L6589) | //  } elseif ($option == AI\_OPTION\_PROCESS\_PHP) { |
| [6590](#L6590) | //  } elseif ($option == AI\_OPTION\_ENABLE\_404) { |
| [6591](#L6591) | //  } elseif ($option == AI\_OPTION\_DETECT\_SERVER\_SIDE) { |
| [6592](#L6592) | //  } elseif ($option == AI\_OPTION\_DISPLAY\_FOR\_DEVICES) { |
| [6593](#L6593) | //  } |
| [6594](#L6594) |  |
| [6595](#L6595) | return $value; |
| [6596](#L6596) | } |
| [6597](#L6597) |  |
| [6598](#L6598) |  |
| [6599](#L6599) | function ai\_write\_settings\_string () { |
| [6600](#L6600) | if (get\_remote\_debugging ()) { |
| [6601](#L6601) | global $ai\_wp\_data, $ai\_db\_options, $ai\_db\_options\_multisite; |
| [6602](#L6602) |  |
| [6603](#L6603) | if (isset ($\_GET ["ai-show-errors"])) { |
| [6604](#L6604) | ini\_set ('display\_errors', 1); |
| [6605](#L6605) | error\_reporting (E\_ALL); |
| [6606](#L6606) | } |
| [6607](#L6607) |  |
| [6608](#L6608) | if (function\_exists ('ai\_check\_remote\_settings')) { |
| [6609](#L6609) | ai\_check\_remote\_settings (); |
| [6610](#L6610) | } |
| [6611](#L6611) |  |
| [6612](#L6612) | $tracking = false; |
| [6613](#L6613) | if (defined ('AI\_PLUGIN\_TRACKING') && AI\_PLUGIN\_TRACKING) { |
| [6614](#L6614) | global $ai\_dst; |
| [6615](#L6615) | if (isset ($ai\_dst) && is\_object ($ai\_dst) && $ai\_dst->get\_plugin\_tracking () !== null) { |
| [6616](#L6616) | $tracking = $ai\_dst->get\_tracking (); |
| [6617](#L6617) | } |
| [6618](#L6618) | } |
| [6619](#L6619) |  |
| [6620](#L6620) | $current\_theme = wp\_get\_theme (); |
| [6621](#L6621) |  |
| [6622](#L6622) | $plugin\_data = array ( |
| [6623](#L6623) | 'version' => AD\_INSERTER\_NAME . ' ' . AD\_INSERTER\_VERSION, |
| [6624](#L6624) | 'install' => get\_option (AI\_INSTALL\_NAME), |
| [6625](#L6625) | 'install-time' => isset ($ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]) ? $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE] : '', |
| [6626](#L6626) | 'since-install' => isset ($ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL]) ? $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL] : null, |
| [6627](#L6627) | 'tracking' => $tracking, |
| [6628](#L6628) | 'review' => get\_option ('ai-notice-review', ''), |
| [6629](#L6629) | 'pro' => false, |
| [6630](#L6630) | 'write' => false, |
| [6631](#L6631) | 'sidebar-widgets' => get\_sidebar\_widgets (), |
| [6632](#L6632) | 'exceptions' => ai\_get\_exceptions (/\*ai\_current\_user\_role\_ok () && \*/(!is\_multisite() || is\_main\_site () || multisite\_exceptions\_enabled ())), |
| [6633](#L6633) | 'current-theme' => array ('name' => $current\_theme->get ('Name'), 'version' => $current\_theme->get ('Version')), |
| [6634](#L6634) | 'virtual-ads-txt' => get\_option (AI\_ADS\_TXT\_NAME) !== false, |
| [6635](#L6635) | 'categories' => ai\_get\_category\_list (), |
| [6636](#L6636) | 'tags' => ai\_get\_tag\_list (), |
| [6637](#L6637) | 'post-ids' => ai\_get\_post\_id\_list (), |
| [6638](#L6638) |  |
| [6639](#L6639) | 'license-key' => '', |
| [6640](#L6640) | 'type' => '', |
| [6641](#L6641) | 'status' => '', |
| [6642](#L6642) | 'last-update' => '', |
| [6643](#L6643) | 'client' => false, |
| [6644](#L6644) | 'counter' => '', |
| [6645](#L6645) | ); |
| [6646](#L6646) |  |
| [6647](#L6647) | if (function\_exists ('ai\_plugin\_data')) { |
| [6648](#L6648) | ai\_plugin\_data ($plugin\_data); |
| [6649](#L6649) | } else $plugin\_data ['taxonomies'] = ai\_get\_taxonomy\_list (true); |
| [6650](#L6650) |  |
| [6651](#L6651) | echo '#', base64\_encode (serialize ($plugin\_data)), '#'; |
| [6652](#L6652) |  |
| [6653](#L6653) | if (is\_multisite()) { |
| [6654](#L6654) | echo base64\_encode (serialize ($ai\_db\_options\_multisite)); |
| [6655](#L6655) | } |
| [6656](#L6656) |  |
| [6657](#L6657) | echo "#"; |
| [6658](#L6658) |  |
| [6659](#L6659) | if (is\_multisite() && multisite\_main\_for\_all\_blogs () && defined ('BLOG\_ID\_CURRENT\_SITE')) { |
| [6660](#L6660) | echo BLOG\_ID\_CURRENT\_SITE; |
| [6661](#L6661) | } |
| [6662](#L6662) |  |
| [6663](#L6663) | echo "#"; |
| [6664](#L6664) |  |
| [6665](#L6665) | if (function\_exists ('ai\_filter\_remote\_settings')) { |
| [6666](#L6666) | ai\_filter\_remote\_settings ($ai\_db\_options); |
| [6667](#L6667) | } |
| [6668](#L6668) |  |
| [6669](#L6669) | echo base64\_encode (serialize ($ai\_db\_options)); |
| [6670](#L6670) | } |
| [6671](#L6671) | } |
| [6672](#L6672) |  |
| [6673](#L6673) |  |
| [6674](#L6674) | function ai\_ajax () { |
| [6675](#L6675) | global $ai\_wp\_data; |
| [6676](#L6676) |  |
| [6677](#L6677) | //  check\_ajax\_referer ("adinserter\_data", "ai\_check"); |
| [6678](#L6678) | //  check\_admin\_referer ("adinserter\_data", "ai\_check"); |
| [6679](#L6679) |  |
| [6680](#L6680) | if (isset ($\_POST ["adsense-ad-units"])) { |
| [6681](#L6681) | if (defined ('AI\_ADSENSE\_API')) { |
| [6682](#L6682) | adsense\_ad\_name (); |
| [6683](#L6683) | } |
| [6684](#L6684) | } |
| [6685](#L6685) |  |
| [6686](#L6686) | elseif (isset ($\_GET ["block"])) { |
| [6687](#L6687) | $block = sanitize\_text\_field ((int) $\_GET ["block"]); |
| [6688](#L6688) | if (is\_numeric ($block) && $block >= 1 && $block <= 96) { |
| [6689](#L6689) | global $block\_object; |
| [6690](#L6690) | $block = $block\_object [$block]; |
| [6691](#L6691) | if (isset ($\_GET ["cookie\_check"]) && $\_GET ["cookie\_check"] == 1) { |
| [6692](#L6692) | $block->client\_side\_cookie\_check = true; |
| [6693](#L6693) | } |
| [6694](#L6694) | if (isset ($\_GET ["cookie\_check\_url"]) && $\_GET ["cookie\_check\_url"] == 1) { |
| [6695](#L6695) | $block->client\_side\_cookie\_check\_url = true; |
| [6696](#L6696) | } |
| [6697](#L6697) | if (isset ($\_GET ["hide-debug-labels"]) && $\_GET ["hide-debug-labels"] == 1) { |
| [6698](#L6698) | $block->hide\_debug\_labels = true; |
| [6699](#L6699) | } |
| [6700](#L6700) | if ($block->get\_iframe ()) |
| [6701](#L6701) | echo $block->get\_iframe\_page (); |
| [6702](#L6702) | } |
| [6703](#L6703) | } |
| [6704](#L6704) |  |
| [6705](#L6705) | elseif (isset ($\_GET ["ads-txt"])) { |
| [6706](#L6706) | $ads\_txt = get\_option (AI\_ADS\_TXT\_NAME); |
| [6707](#L6707) | if ($ads\_txt === false) { |
| [6708](#L6708) | wp\_die ('Page not found', 404); |
| [6709](#L6709) | } |
| [6710](#L6710) |  |
| [6711](#L6711) | header ('Content-Type: text/plain'); |
| [6712](#L6712) | echo esc\_html ($ads\_txt); |
| [6713](#L6713) | wp\_die (); |
| [6714](#L6714) | } |
| [6715](#L6715) |  |
| [6716](#L6716) | elseif (isset ($\_GET ["remote-ads-txt"]) && !function\_exists ('ai\_ajax\_processing\_2')) { |
| [6717](#L6717) | if (get\_remote\_debugging ()) { |
| [6718](#L6718) | // Read-only access |
| [6719](#L6719) | if ($\_GET ["remote-ads-txt"] == 'save') { |
| [6720](#L6720) | wp\_die (); |
| [6721](#L6721) | } |
| [6722](#L6722) |  |
| [6723](#L6723) | $\_GET ["virtual"] = get\_option (AI\_ADS\_TXT\_NAME) !== false ? '1' : '0'; |
| [6724](#L6724) |  |
| [6725](#L6725) | ads\_txt (sanitize\_text\_field ($\_GET ["remote-ads-txt"])); |
| [6726](#L6726) | } |
| [6727](#L6727) | } |
| [6728](#L6728) |  |
| [6729](#L6729) | elseif (isset ($\_GET ["ai-get-settings"])) { |
| [6730](#L6730) | ai\_write\_settings\_string (); |
| [6731](#L6731) | } |
| [6732](#L6732) |  |
| [6733](#L6733) | elseif (isset ($\_GET ["check-page"])) { |
| [6734](#L6734) | if (get\_remote\_debugging ()) { |
| [6735](#L6735) | ai\_check\_page (); |
| [6736](#L6736) | } |
| [6737](#L6737) | } |
| [6738](#L6738) |  |
| [6739](#L6739) | elseif (function\_exists ('ai\_ajax\_processing\_2')) { |
| [6740](#L6740) | ai\_ajax\_processing\_2 (); |
| [6741](#L6741) | } |
| [6742](#L6742) |  |
| [6743](#L6743) | wp\_die (); |
| [6744](#L6744) | } |
| [6745](#L6745) |  |
| [6746](#L6746) |  |
| [6747](#L6747) | function ai\_ajax\_backend () { |
| [6748](#L6748) | global $preview\_name, $preview\_alignment, $preview\_css; |
| [6749](#L6749) |  |
| [6750](#L6750) | //  check\_ajax\_referer ("adinserter\_data", "ai\_check"); |
| [6751](#L6751) | check\_admin\_referer ("adinserter\_data", "ai\_check"); |
| [6752](#L6752) |  |
| [6753](#L6753) | if (is\_multisite() && !is\_main\_site () && !multisite\_settings\_page\_enabled ()) { |
| [6754](#L6754) | wp\_die (); |
| [6755](#L6755) | } |
| [6756](#L6756) |  |
| [6757](#L6757) | if (!current\_user\_can ('manage\_options')) { |
| [6758](#L6758) | wp\_die (); |
| [6759](#L6759) | } |
| [6760](#L6760) |  |
| [6761](#L6761) | if (isset ($\_POST ["preview"])) { |
| [6762](#L6762) | $block = urldecode ((int) $\_POST ["preview"]); |
| [6763](#L6763) | if (is\_numeric ($block) && $block >= 1 && $block <= 96) { |
| [6764](#L6764) | $preview\_parameters = array (); |
| [6765](#L6765) |  |
| [6766](#L6766) | if (isset ($\_POST ['name']))              $preview\_parameters ['name']              = base64\_decode ($\_POST ['name']); |
| [6767](#L6767) | if (isset ($\_POST ['code']))              $preview\_parameters ['code']              = base64\_decode ($\_POST ['code']); |
| [6768](#L6768) | if (isset ($\_POST ['alignment']))         $preview\_parameters ['alignment']         = base64\_decode ($\_POST ['alignment']); |
| [6769](#L6769) | if (isset ($\_POST ['horizontal']))        $preview\_parameters ['horizontal']        = base64\_decode ($\_POST ['horizontal']); |
| [6770](#L6770) | if (isset ($\_POST ['vertical']))          $preview\_parameters ['vertical']          = base64\_decode ($\_POST ['vertical']); |
| [6771](#L6771) | if (isset ($\_POST ['horizontal\_margin'])) $preview\_parameters ['horizontal\_margin'] = base64\_decode ($\_POST ['horizontal\_margin']); |
| [6772](#L6772) | if (isset ($\_POST ['vertical\_margin']))   $preview\_parameters ['vertical\_margin']   = base64\_decode ($\_POST ['vertical\_margin']); |
| [6773](#L6773) | if (isset ($\_POST ['animation']))         $preview\_parameters ['animation']         = base64\_decode ($\_POST ['animation']); |
| [6774](#L6774) | if (isset ($\_POST ['alignment\_css']))     $preview\_parameters ['alignment\_css']     = base64\_decode ($\_POST ['alignment\_css']); |
| [6775](#L6775) | if (isset ($\_POST ['custom\_css']))        $preview\_parameters ['custom\_css']        = base64\_decode ($\_POST ['custom\_css']); |
| [6776](#L6776) | if (isset ($\_POST ['php']))               $preview\_parameters ['php']               = $\_POST ['php']; |
| [6777](#L6777) | if (isset ($\_POST ['close']))             $preview\_parameters ['close']             = $\_POST ['close']; |
| [6778](#L6778) | if (isset ($\_POST ['background']))        $preview\_parameters ['background']        = $\_POST ['background']; |
| [6779](#L6779) | if (isset ($\_POST ['body\_background']))   $preview\_parameters ['body\_background']   = $\_POST ['body\_background']; |
| [6780](#L6780) | if (isset ($\_POST ['background\_image']))  $preview\_parameters ['background\_image']  = base64\_decode ($\_POST ['background\_image']); |
| [6781](#L6781) | if (isset ($\_POST ['background\_color']))  $preview\_parameters ['background\_color']  = base64\_decode ($\_POST ['background\_color']); |
| [6782](#L6782) | if (isset ($\_POST ['background\_size']))   $preview\_parameters ['background\_size']   = base64\_decode ($\_POST ['background\_size']); |
| [6783](#L6783) | if (isset ($\_POST ['background\_repeat'])) $preview\_parameters ['background\_repeat'] = base64\_decode ($\_POST ['background\_repeat']); |
| [6784](#L6784) | if (isset ($\_POST ['label']))             $preview\_parameters ['label']             = $\_POST ['label']; |
| [6785](#L6785) | if (isset ($\_POST ['sticky\_block']))      $preview\_parameters ['sticky\_block']      = $\_POST ['sticky\_block']; |
| [6786](#L6786) | if (isset ($\_POST ['sticky\_height']))     $preview\_parameters ['sticky\_height']     = $\_POST ['sticky\_height']; |
| [6787](#L6787) | if (isset ($\_POST ['read\_only']))         $preview\_parameters ['read\_only']         = $\_POST ['read\_only']; |
| [6788](#L6788) | if (isset ($\_POST ['iframe']))            $preview\_parameters ['iframe']            = $\_POST ['iframe']; |
| [6789](#L6789) | if (isset ($\_POST ['check']))             $preview\_parameters ['check']             = $\_POST ['check']; |
| [6790](#L6790) | if (isset ($\_POST ['count']))             $preview\_parameters ['count']             = $\_POST ['count']; |
| [6791](#L6791) | if (isset ($\_POST ['rotate']))            $preview\_parameters ['rotate']            = $\_POST ['rotate']; |
| [6792](#L6792) | if (isset ($\_POST ['viewport']))          $preview\_parameters ['viewport']          = $\_POST ['viewport']; |
| [6793](#L6793) | if (isset ($\_POST ['fallback']))          $preview\_parameters ['fallback']          = $\_POST ['fallback']; |
| [6794](#L6794) |  |
| [6795](#L6795) | if (function\_exists ('ai\_remote\_preview')) { |
| [6796](#L6796) | ai\_remote\_preview ($block, $preview\_parameters); |
| [6797](#L6797) | } |
| [6798](#L6798) |  |
| [6799](#L6799) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/preview.php'; |
| [6800](#L6800) |  |
| [6801](#L6801) | generate\_code\_preview ( |
| [6802](#L6802) | $block, |
| [6803](#L6803) | $preview\_parameters |
| [6804](#L6804) | ); |
| [6805](#L6805) | } |
| [6806](#L6806) | elseif ($\_POST ["preview"] == 'adb') { |
| [6807](#L6807) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/preview-adb.php'; |
| [6808](#L6808) |  |
| [6809](#L6809) | $message = base64\_decode ($\_POST ["code"]); |
| [6810](#L6810) | $process\_php = isset ($\_POST ["php"]) && $\_POST ["php"] == 1; |
| [6811](#L6811) | $head = null; |
| [6812](#L6812) | $processed\_message = null; |
| [6813](#L6813) | $footer = null; |
| [6814](#L6814) |  |
| [6815](#L6815) | if (function\_exists ('ai\_remote\_preview\_adb')) { |
| [6816](#L6816) | ai\_remote\_preview\_adb ($message, $process\_php, $head, $processed\_message, $footer); |
| [6817](#L6817) | } |
| [6818](#L6818) |  |
| [6819](#L6819) | generate\_code\_preview\_adb ($message, $process\_php, false, $head, $processed\_message, $footer); |
| [6820](#L6820) | } |
| [6821](#L6821) | elseif ($\_POST ["preview"] == 'adsense') { |
| [6822](#L6822) |  |
| [6823](#L6823) | if (defined ('AI\_ADSENSE\_API')) { |
| [6824](#L6824) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/preview.php'; |
| [6825](#L6825) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/adsense-api.php'; |
| [6826](#L6826) |  |
| [6827](#L6827) | if (defined ('AI\_ADSENSE\_AUTHORIZATION\_CODE')) { |
| [6828](#L6828) |  |
| [6829](#L6829) | $adsense = new adsense\_api(); |
| [6830](#L6830) |  |
| [6831](#L6831) | $adsense\_code   = $adsense->getAdCode (base64\_decode ($\_POST ["slot\_id"])); |
| [6832](#L6832) | $adsense\_error  = $adsense->getError (); |
| [6833](#L6833) |  |
| [6834](#L6834) | $preview\_parameters = array ( |
| [6835](#L6835) | "name"          => isset ($\_POST ["name"]) ? base64\_decode ($\_POST ["name"]) : 'ADSENSE CODE', |
| [6836](#L6836) | "alignment"     => '', |
| [6837](#L6837) | "horizontal"    => '', |
| [6838](#L6838) | "vertical"      => '', |
| [6839](#L6839) | "alignment\_css" => '', |
| [6840](#L6840) | "custom\_css"    => '', |
| [6841](#L6841) | "code"          => $adsense\_error == '' ? $adsense\_code : '<div style="color: red;">'.$adsense\_error.'</div>', |
| [6842](#L6842) | "php"           => false, |
| [6843](#L6843) | "label"         => false, |
| [6844](#L6844) | "close"         => AI\_CLOSE\_NONE, |
| [6845](#L6845) | "read\_only"     => true, |
| [6846](#L6846) | ); |
| [6847](#L6847) |  |
| [6848](#L6848) | generate\_code\_preview ( |
| [6849](#L6849) | 0, // Default settings |
| [6850](#L6850) | $preview\_parameters |
| [6851](#L6851) | ); |
| [6852](#L6852) |  |
| [6853](#L6853) | } |
| [6854](#L6854) | } |
| [6855](#L6855) | } |
| [6856](#L6856) | } |
| [6857](#L6857) |  |
| [6858](#L6858) | elseif (isset ($\_POST ["edit"])) { |
| [6859](#L6859) | if (is\_numeric ($\_POST ["edit"]) && $\_POST ["edit"] >= 1 && $\_POST ["edit"] <= 96) { |
| [6860](#L6860) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/editor.php'; |
| [6861](#L6861) |  |
| [6862](#L6862) | $process\_php = isset ($\_POST ["php"]) && $\_POST ["php"] == 1; |
| [6863](#L6863) |  |
| [6864](#L6864) | generate\_code\_editor ((int) $\_POST ["edit"], base64\_decode ($\_POST ["code"]), $process\_php); |
| [6865](#L6865) | } |
| [6866](#L6866) | } |
| [6867](#L6867) |  |
| [6868](#L6868) | if (isset ($\_POST ["placeholder"])) { |
| [6869](#L6869) | $block = urldecode ((int) $\_POST ["block"]); |
| [6870](#L6870) | if (is\_numeric ($block) && $block >= 1 && $block <= 96) { |
| [6871](#L6871) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/placeholders.php'; |
| [6872](#L6872) |  |
| [6873](#L6873) | generate\_placeholder\_editor (str\_replace (array ('"', "\\'"), array ('&quot', '&#039'), urldecode ($\_POST ["placeholder"])), $block); |
| [6874](#L6874) | } |
| [6875](#L6875) | } |
| [6876](#L6876) |  |
| [6877](#L6877) | elseif (isset ($\_POST ["generate-code"])) { |
| [6878](#L6878) | $code\_generator = new ai\_code\_generator (); |
| [6879](#L6879) |  |
| [6880](#L6880) | echo json\_encode ($code\_generator->generate ($\_POST)); |
| [6881](#L6881) | } |
| [6882](#L6882) |  |
| [6883](#L6883) | elseif (isset ($\_POST ["import-code"])) { |
| [6884](#L6884) | $code\_generator = new ai\_code\_generator (); |
| [6885](#L6885) |  |
| [6886](#L6886) | echo json\_encode ($code\_generator->import (base64\_decode ($\_POST ["import-code"]))); |
| [6887](#L6887) | } |
| [6888](#L6888) |  |
| [6889](#L6889) | elseif (isset ($\_POST ["import-rotation-code"])) { |
| [6890](#L6890) | $code\_generator = new ai\_code\_generator (); |
| [6891](#L6891) |  |
| [6892](#L6892) | echo json\_encode ($code\_generator->import\_rotation (base64\_decode ($\_POST ["import-rotation-code"]))); |
| [6893](#L6893) | } |
| [6894](#L6894) |  |
| [6895](#L6895) | elseif (isset ($\_POST ["generate-rotation-code"])) { |
| [6896](#L6896) | $code\_generator = new ai\_code\_generator (); |
| [6897](#L6897) |  |
| [6898](#L6898) | echo json\_encode ($code\_generator->generate\_rotation (json\_decode (base64\_decode ($\_POST ['generate-rotation-code']), true))); |
| [6899](#L6899) | } |
| [6900](#L6900) |  |
| [6901](#L6901) | elseif (isset ($\_GET ["image"])) { |
| [6902](#L6902) | $filename = sanitize\_file\_name ($\_GET ["image"]); |
| [6903](#L6903) | header ("Content-Type: image/png"); |
| [6904](#L6904) | header ("Content-Length: " . filesize (AD\_INSERTER\_PLUGIN\_DIR.'images/'.$filename)); |
| [6905](#L6905) | readfile  (AD\_INSERTER\_PLUGIN\_DIR.'images/'.$filename); |
| [6906](#L6906) | } |
| [6907](#L6907) | elseif (isset ($\_GET ["css"])) { |
| [6908](#L6908) | $filename = sanitize\_file\_name ($\_GET ["css"]); |
| [6909](#L6909) | header ("Content-Type: text/css"); |
| [6910](#L6910) | header ("Content-Length: " . filesize (AD\_INSERTER\_PLUGIN\_DIR.'css/'.$filename)); |
| [6911](#L6911) | readfile  (AD\_INSERTER\_PLUGIN\_DIR.'css/'.$filename); |
| [6912](#L6912) | } |
| [6913](#L6913) | elseif (isset ($\_GET ["js"])) { |
| [6914](#L6914) | $filename = sanitize\_file\_name ($\_GET ["js"]); |
| [6915](#L6915) | header ("Content-Type: application/javascript"); |
| [6916](#L6916) | header ("Content-Length: " . filesize (AD\_INSERTER\_PLUGIN\_DIR.'js/'.$filename)); |
| [6917](#L6917) | readfile  (AD\_INSERTER\_PLUGIN\_DIR.'js/'.$filename); |
| [6918](#L6918) | } |
| [6919](#L6919) |  |
| [6920](#L6920) | elseif (isset ($\_GET ["rating"])) { |
| [6921](#L6921) | $cache\_time = $\_GET ["rating"] == 'update' ? 0 \* 60 : AI\_TRANSIENT\_RATING\_EXPIRATION; |
| [6922](#L6922) | if (!get\_transient (AI\_TRANSIENT\_RATING) || !($transient\_timeout = get\_option ('\_transient\_timeout\_' . AI\_TRANSIENT\_RATING)) || AI\_TRANSIENT\_RATING\_EXPIRATION - ($transient\_timeout - time ()) > $cache\_time) { |
| [6923](#L6923) | $args = (object) array ('slug' => 'ad-inserter'); |
| [6924](#L6924) | $request = array ('action' => 'plugin\_information', 'timeout' => 5, 'request' => serialize ($args)); |
| [6925](#L6925) | $url = 'http://api.wordpress.org/plugins/info/1.0/'; |
| [6926](#L6926) | $response = wp\_remote\_post ($url, array ('body' => $request)); |
| [6927](#L6927) | $plugin\_info = @unserialize ($response ['body']); |
| [6928](#L6928) | if (isset ($plugin\_info->ratings)) { |
| [6929](#L6929) | $total\_rating = 0; |
| [6930](#L6930) | $total\_count = 0; |
| [6931](#L6931) | foreach ($plugin\_info->ratings as $rating => $count) { |
| [6932](#L6932) | $total\_rating += $rating \* $count; |
| [6933](#L6933) | $total\_count += $count; |
| [6934](#L6934) | } |
| [6935](#L6935) | $rating = number\_format ($total\_rating / $total\_count, 4); |
| [6936](#L6936) | set\_transient (AI\_TRANSIENT\_RATING, $rating, AI\_TRANSIENT\_RATING\_EXPIRATION); |
| [6937](#L6937) | } |
| [6938](#L6938) | } |
| [6939](#L6939) | if ($rating = get\_transient (AI\_TRANSIENT\_RATING)) { |
| [6940](#L6940) | if ($rating > 1 && $rating <= 5) echo $rating; |
| [6941](#L6941) | } |
| [6942](#L6942) | } |
| [6943](#L6943) |  |
| [6944](#L6944) | elseif (isset ($\_POST ["notice"])) { |
| [6945](#L6945) | update\_option ('ai-notice-' . esc\_html ($\_POST ["notice"]), esc\_html ($\_POST ["click"])); |
| [6946](#L6946) | } |
| [6947](#L6947) |  |
| [6948](#L6948) | elseif (isset ($\_POST ["notice-check"])) { |
| [6949](#L6949) | echo esc\_html ($\_POST ["notice-check"]); |
| [6950](#L6950) | } |
| [6951](#L6951) |  |
| [6952](#L6952) | elseif (isset ($\_GET ["list"])) { |
| [6953](#L6953) | $search\_text = esc\_html (trim ($\_GET ["list"])); |
| [6954](#L6954) |  |
| [6955](#L6955) | $show\_all\_blocks = isset ($\_GET ["all"]) && $\_GET ["all"]; |
| [6956](#L6956) |  |
| [6957](#L6957) | $start = (int) $\_GET ["start"]; |
| [6958](#L6958) | if ($start < 1 || $start > 96) $start = 1; |
| [6959](#L6959) |  |
| [6960](#L6960) | $end = (int) $\_GET ["end"]; |
| [6961](#L6961) | if ($end < 1 || $end > 96 || $end < $start) $end = 16; |
| [6962](#L6962) |  |
| [6963](#L6963) | $active = (int) $\_GET ["active"]; |
| [6964](#L6964) | if ($active < 1 || $active > 96) $active = 1; |
| [6965](#L6965) |  |
| [6966](#L6966) | code\_block\_list ($start, $end, $search\_text, $show\_all\_blocks, $active); |
| [6967](#L6967) | } |
| [6968](#L6968) |  |
| [6969](#L6969) | elseif (isset ($\_GET ["adsense-list"])) { |
| [6970](#L6970) | if (defined ('AI\_ADSENSE\_API')) { |
| [6971](#L6971) | adsense\_list (); |
| [6972](#L6972) | } |
| [6973](#L6973) | } |
| [6974](#L6974) |  |
| [6975](#L6975) | elseif (isset ($\_GET ["adsense-code"])) { |
| [6976](#L6976) | if (defined ('AI\_ADSENSE\_API')) { |
| [6977](#L6977) | ai\_adsense\_code (esc\_html ($\_GET ["adsense-code"])); |
| [6978](#L6978) | } |
| [6979](#L6979) | } |
| [6980](#L6980) |  |
| [6981](#L6981) | elseif (isset ($\_GET ["adsense-authorization-code"])) { |
| [6982](#L6982) | if (defined ('AI\_ADSENSE\_API')) { |
| [6983](#L6983) | if ($\_GET ['adsense-authorization-code'] == '') { |
| [6984](#L6984) | delete\_option (AI\_ADSENSE\_CLIENT\_IDS); |
| [6985](#L6985) | delete\_option (AI\_ADSENSE\_AUTH\_CODE); |
| [6986](#L6986) | delete\_option (AI\_ADSENSE\_OWN\_IDS); |
| [6987](#L6987) |  |
| [6988](#L6988) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN\_1); |
| [6989](#L6989) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN); |
| [6990](#L6990) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_ADS); |
| [6991](#L6991) | } |
| [6992](#L6992) | elseif (base64\_decode ($\_GET ['adsense-authorization-code']) == 'own-ids') { |
| [6993](#L6993) | update\_option (AI\_ADSENSE\_OWN\_IDS, '1'); |
| [6994](#L6994) |  |
| [6995](#L6995) | delete\_option (AI\_ADSENSE\_CLIENT\_IDS); |
| [6996](#L6996) | delete\_option (AI\_ADSENSE\_AUTH\_CODE); |
| [6997](#L6997) |  |
| [6998](#L6998) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN\_1); |
| [6999](#L6999) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN); |
| [7000](#L7000) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_ADS); |
| [7001](#L7001) | } |
| [7002](#L7002) | //      else update\_option (AI\_ADSENSE\_AUTH\_CODE, base64\_decode ($\_GET ['adsense-authorization-code'])); |
| [7003](#L7003) | } |
| [7004](#L7004) | } |
| [7005](#L7005) |  |
| [7006](#L7006) | elseif (isset ($\_GET ["adsense-client-id"])) { |
| [7007](#L7007) | if (defined ('AI\_ADSENSE\_API')) { |
| [7008](#L7008) | if ($\_GET ['adsense-client-id'] == '') { |
| [7009](#L7009) | delete\_option (AI\_ADSENSE\_CLIENT\_IDS); |
| [7010](#L7010) | delete\_option (AI\_ADSENSE\_AUTH\_CODE); |
| [7011](#L7011) |  |
| [7012](#L7012) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN\_1); |
| [7013](#L7013) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_TOKEN); |
| [7014](#L7014) | delete\_transient (AI\_TRANSIENT\_ADSENSE\_ADS); |
| [7015](#L7015) | } else update\_option (AI\_ADSENSE\_CLIENT\_IDS, array ('ID' => base64\_decode ($\_GET ['adsense-client-id']), 'SECRET' => base64\_decode ($\_GET ['adsense-client-secret']))); |
| [7016](#L7016) | } |
| [7017](#L7017) | } |
| [7018](#L7018) |  |
| [7019](#L7019) | elseif (isset ($\_GET ["ads-txt"])) { |
| [7020](#L7020) | if (!is\_multisite() || is\_main\_site ()) { |
| [7021](#L7021) | if (function\_exists ('ai\_remote\_ads\_txt') && ai\_remote\_ads\_txt ()) { |
| [7022](#L7022) | wp\_die (); |
| [7023](#L7023) | } |
| [7024](#L7024) |  |
| [7025](#L7025) | ads\_txt (esc\_html ($\_GET ["ads-txt"])); |
| [7026](#L7026) | } |
| [7027](#L7027) | } |
| [7028](#L7028) |  |
| [7029](#L7029) | elseif (isset ($\_GET ["settings"])) { |
| [7030](#L7030) | generate\_settings\_form (); |
| [7031](#L7031) | } |
| [7032](#L7032) |  |
| [7033](#L7033) | elseif (isset ($\_GET ["list-options"])) { |
| [7034](#L7034) | generate\_list\_options (esc\_html ($\_GET ["list-options"])); |
| [7035](#L7035) | } |
| [7036](#L7036) |  |
| [7037](#L7037) | elseif (isset ($\_GET ["update"])) { |
| [7038](#L7038) | if ($\_GET ["update"] == 'block-code-demo') { |
| [7039](#L7039) | ai\_block\_code\_demo (urldecode ($\_GET ["block\_class\_name"]), esc\_html ($\_GET ["block\_class"]), esc\_html ($\_GET ["block\_number\_class"]), esc\_html ($\_GET ["block\_name\_class"]), esc\_html ($\_GET ["inline\_styles"])); |
| [7040](#L7040) | } |
| [7041](#L7041) | elseif (function\_exists ('ai\_ajax\_backend\_2')) { |
| [7042](#L7042) | ai\_ajax\_backend\_2 (); |
| [7043](#L7043) | } |
| [7044](#L7044) | } |
| [7045](#L7045) |  |
| [7046](#L7046) | elseif (isset ($\_GET ["check-page"])) { |
| [7047](#L7047) | if (function\_exists ('ai\_check\_remote\_page') && ai\_check\_remote\_page ()) { |
| [7048](#L7048) | wp\_die (); |
| [7049](#L7049) | } |
| [7050](#L7050) |  |
| [7051](#L7051) | ai\_check\_page (); |
| [7052](#L7052) | } |
| [7053](#L7053) |  |
| [7054](#L7054) | elseif (function\_exists ('ai\_ajax\_backend\_2')) { |
| [7055](#L7055) | ai\_ajax\_backend\_2 (); |
| [7056](#L7056) | } |
| [7057](#L7057) |  |
| [7058](#L7058) | wp\_die (); |
| [7059](#L7059) | } |
| [7060](#L7060) |  |
| [7061](#L7061) | function ai\_generate\_extract (&$settings) { |
| [7062](#L7062) | global $ai\_custom\_hooks, $ai\_wp\_data, $version\_string, $subversion\_string; |
| [7063](#L7063) |  |
| [7064](#L7064) | if (!defined ('AI\_EXTRACT\_GENERATED')) |
| [7065](#L7065) | define ('AI\_EXTRACT\_GENERATED', true); |
| [7066](#L7066) |  |
| [7067](#L7067) | $obj = new ai\_Block (1); |
| [7068](#L7068) |  |
| [7069](#L7069) | $extract = array (); |
| [7070](#L7070) |  |
| [7071](#L7071) | if (defined ('AI\_BUFFERING')) { |
| [7072](#L7072) | $above\_header\_hook\_blocks     = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7073](#L7073) | $html\_element\_hook\_blocks     = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7074](#L7074) | } |
| [7075](#L7075) |  |
| [7076](#L7076) | $content\_hook\_blocks          = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7077](#L7077) | $excerpt\_hook\_blocks          = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7078](#L7078) | $loop\_start\_hook\_blocks       = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7079](#L7079) | $loop\_end\_hook\_blocks         = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7080](#L7080) | $post\_hook\_blocks             = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7081](#L7081) | $before\_comments\_hook\_blocks  = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7082](#L7082) | $between\_comments\_hook\_blocks = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7083](#L7083) | $after\_comments\_hook\_blocks   = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7084](#L7084) | $footer\_hook\_blocks           = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7085](#L7085) | $custom\_hook\_blocks           = array (); |
| [7086](#L7086) | for ($custom\_hook = 1; $custom\_hook <= 20; $custom\_hook ++) { |
| [7087](#L7087) | $custom\_hook\_blocks     []  = array (AI\_PT\_ANY => array (), AI\_PT\_HOMEPAGE => array(), AI\_PT\_CATEGORY => array(), AI\_PT\_SEARCH => array(), AI\_PT\_ARCHIVE => array(), AI\_PT\_STATIC => array(), AI\_PT\_POST => array(), AI\_PT\_404 => array(), AI\_PT\_FEED => array(), AI\_PT\_AJAX => array(), AI\_PT\_REST => array()); |
| [7088](#L7088) | } |
| [7089](#L7089) |  |
| [7090](#L7090) | // Get blocks used in sidebar widgets |
| [7091](#L7091) | $sidebar\_widgets = wp\_get\_sidebars\_widgets(); |
| [7092](#L7092) | // 'widget\_' + registered AI widget name |
| [7093](#L7093) | $widget\_options = get\_option ('widget\_ai\_widget'); |
| [7094](#L7094) |  |
| [7095](#L7095) | $widget\_blocks = array (); |
| [7096](#L7096) | foreach ($sidebar\_widgets as $sidebar\_index => $sidebar\_widget) { |
| [7097](#L7097) | if (is\_array ($sidebar\_widget) && isset ($GLOBALS ['wp\_registered\_sidebars'][$sidebar\_index]['name'])) { |
| [7098](#L7098) | $sidebar\_name = $GLOBALS ['wp\_registered\_sidebars'][$sidebar\_index]['name']; |
| [7099](#L7099) | if ($sidebar\_name != "") { |
| [7100](#L7100) | foreach ($sidebar\_widget as $widget) { |
| [7101](#L7101) | if (preg\_match ("/ai\_widget-([\d]+)/", $widget, $widget\_id)) { |
| [7102](#L7102) | if (isset ($widget\_id [1]) && is\_numeric ($widget\_id [1])) { |
| [7103](#L7103) | $widget\_option = $widget\_options [$widget\_id [1]]; |
| [7104](#L7104) | $widget\_block = $widget\_option ['block']; |
| [7105](#L7105) | if ($widget\_block >= 1 && $widget\_block <= 96) { |
| [7106](#L7106) | $widget\_blocks [] = $widget\_block; |
| [7107](#L7107) | } |
| [7108](#L7108) | } |
| [7109](#L7109) | } |
| [7110](#L7110) | } |
| [7111](#L7111) | } |
| [7112](#L7112) | } |
| [7113](#L7113) | } |
| [7114](#L7114) | $widget\_blocks = array\_unique ($widget\_blocks); |
| [7115](#L7115) |  |
| [7116](#L7116) | // Generate extracted data |
| [7117](#L7117) | $active\_blocks = array (); |
| [7118](#L7118) |  |
| [7119](#L7119) | $temp\_ai\_wp\_data = $ai\_wp\_data; |
| [7120](#L7120) |  |
| [7121](#L7121) | $ai\_wp\_data [AI\_MOBILE\_DETECT\_JS]          = false; |
| [7122](#L7122) | $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION]     = false; |
| [7123](#L7123) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION]     = false; |
| [7124](#L7124) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION]     = get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT; |
| [7125](#L7125) | $ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT]      = false; |
| [7126](#L7126) | $ai\_wp\_data [AI\_TRACKING]                  = false; |
| [7127](#L7127) | $ai\_wp\_data [AI\_CLOSE\_BUTTONS]             = false; |
| [7128](#L7128) | $ai\_wp\_data [AI\_PARALLAX]                  = false; |
| [7129](#L7129) | $ai\_wp\_data [AI\_CHECK\_BLOCK]               = false; |
| [7130](#L7130) | $ai\_wp\_data [AI\_IFRAMES]                   = false; |
| [7131](#L7131) | $ai\_wp\_data [AI\_ANIMATION]                 = false; |
| [7132](#L7132) | $ai\_wp\_data [AI\_LAZY\_LOADING]              = false; |
| [7133](#L7133) | $ai\_wp\_data [AI\_GEOLOCATION]               = false; |
| [7134](#L7134) |  |
| [7135](#L7135) | for ($block = 1; $block <= 96; $block ++) { |
| [7136](#L7136) |  |
| [7137](#L7137) | if (!isset ($settings [$block])) continue; |
| [7138](#L7138) |  |
| [7139](#L7139) | $obj->number = $block; |
| [7140](#L7140) | $obj->wp\_options = $settings [$block]; |
| [7141](#L7141) |  |
| [7142](#L7142) | $page\_types = array (); |
| [7143](#L7143) | if ($obj->get\_display\_settings\_home())     $page\_types []= AI\_PT\_HOMEPAGE; |
| [7144](#L7144) | if ($obj->get\_display\_settings\_page())     $page\_types []= AI\_PT\_STATIC; |
| [7145](#L7145) | if ($obj->get\_display\_settings\_post())     $page\_types []= AI\_PT\_POST; |
| [7146](#L7146) | if ($obj->get\_display\_settings\_category()) $page\_types []= AI\_PT\_CATEGORY; |
| [7147](#L7147) | if ($obj->get\_display\_settings\_search())   $page\_types []= AI\_PT\_SEARCH; |
| [7148](#L7148) | if ($obj->get\_display\_settings\_archive())  $page\_types []= AI\_PT\_ARCHIVE; |
| [7149](#L7149) | if ($obj->get\_enable\_ajax())               $page\_types []= AI\_PT\_AJAX; |
| [7150](#L7150) | if ($obj->get\_enable\_rest())               $page\_types []= AI\_PT\_REST; |
| [7151](#L7151) | if ($obj->get\_enable\_feed())               $page\_types []= AI\_PT\_FEED; |
| [7152](#L7152) | if ($obj->get\_enable\_404())                $page\_types []= AI\_PT\_404; |
| [7153](#L7153) |  |
| [7154](#L7154) | $automatic\_insertion = $obj->get\_automatic\_insertion(); |
| [7155](#L7155) | $enabled\_insertion   = $obj->get\_disable\_insertion() == AI\_DISABLED; |
| [7156](#L7156) |  |
| [7157](#L7157) | if ($page\_types && $enabled\_insertion) { |
| [7158](#L7158) |  |
| [7159](#L7159) | // Change insertion position to actual server-side insertion position |
| [7160](#L7160) | switch ($automatic\_insertion) { |
| [7161](#L7161) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_HTML\_ELEMENT: |
| [7162](#L7162) | case AI\_AUTOMATIC\_INSERTION\_INSIDE\_HTML\_ELEMENT: |
| [7163](#L7163) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_HTML\_ELEMENT: |
| [7164](#L7164) | switch ($obj->get\_html\_element\_insertion ()) { |
| [7165](#L7165) | case AI\_HTML\_INSERTION\_SEREVR\_SIDE: |
| [7166](#L7166) | $automatic\_insertion = AI\_AUTOMATIC\_INSERTION\_OUTPUT\_BUFFERING; |
| [7167](#L7167) | break; |
| [7168](#L7168) | default: |
| [7169](#L7169) | $automatic\_insertion = $obj->get\_server\_side\_insertion (); |
| [7170](#L7170) | break; |
| [7171](#L7171) | } |
| [7172](#L7172) | break; |
| [7173](#L7173) | } |
| [7174](#L7174) |  |
| [7175](#L7175) | switch ($automatic\_insertion) { |
| [7176](#L7176) | case AI\_AUTOMATIC\_INSERTION\_ABOVE\_HEADER: |
| [7177](#L7177) | if (defined ('AI\_BUFFERING')) { |
| [7178](#L7178) | foreach ($page\_types as $block\_page\_type) $above\_header\_hook\_blocks [$block\_page\_type][]= $block; |
| [7179](#L7179) | $above\_header\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7180](#L7180) | } |
| [7181](#L7181) | break; |
| [7182](#L7182) | case AI\_AUTOMATIC\_INSERTION\_OUTPUT\_BUFFERING: |
| [7183](#L7183) | if (defined ('AI\_BUFFERING')) { |
| [7184](#L7184) | foreach ($page\_types as $block\_page\_type) $html\_element\_hook\_blocks [$block\_page\_type][]= $block; |
| [7185](#L7185) | $html\_element\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7186](#L7186) | } |
| [7187](#L7187) | break; |
| [7188](#L7188) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_PARAGRAPH: |
| [7189](#L7189) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_PARAGRAPH: |
| [7190](#L7190) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_IMAGE: |
| [7191](#L7191) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_IMAGE: |
| [7192](#L7192) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_CONTENT: |
| [7193](#L7193) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_CONTENT: |
| [7194](#L7194) | foreach ($page\_types as $block\_page\_type) $content\_hook\_blocks [$block\_page\_type][]= $block; |
| [7195](#L7195) | $content\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7196](#L7196) | break; |
| [7197](#L7197) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_EXCERPT: |
| [7198](#L7198) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_EXCERPT: |
| [7199](#L7199) | foreach ($page\_types as $block\_page\_type) $excerpt\_hook\_blocks [$block\_page\_type][]= $block; |
| [7200](#L7200) | $excerpt\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7201](#L7201) | break; |
| [7202](#L7202) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_POST: |
| [7203](#L7203) | foreach ($page\_types as $block\_page\_type) $loop\_start\_hook\_blocks [$block\_page\_type][]= $block; |
| [7204](#L7204) | $loop\_start\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7205](#L7205) | break; |
| [7206](#L7206) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_POST: |
| [7207](#L7207) | foreach ($page\_types as $block\_page\_type) $loop\_end\_hook\_blocks [$block\_page\_type][]= $block; |
| [7208](#L7208) | $loop\_end\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7209](#L7209) | break; |
| [7210](#L7210) | case AI\_AUTOMATIC\_INSERTION\_BETWEEN\_POSTS: |
| [7211](#L7211) | foreach ($page\_types as $block\_page\_type) $post\_hook\_blocks [$block\_page\_type][]= $block; |
| [7212](#L7212) | $post\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7213](#L7213) | break; |
| [7214](#L7214) | case AI\_AUTOMATIC\_INSERTION\_BEFORE\_COMMENTS: |
| [7215](#L7215) | foreach ($page\_types as $block\_page\_type) $before\_comments\_hook\_blocks [$block\_page\_type][]= $block; |
| [7216](#L7216) | $before\_comments\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7217](#L7217) | break; |
| [7218](#L7218) | case AI\_AUTOMATIC\_INSERTION\_BETWEEN\_COMMENTS: |
| [7219](#L7219) | foreach ($page\_types as $block\_page\_type) $between\_comments\_hook\_blocks [$block\_page\_type][]= $block; |
| [7220](#L7220) | $between\_comments\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7221](#L7221) | break; |
| [7222](#L7222) | case AI\_AUTOMATIC\_INSERTION\_AFTER\_COMMENTS: |
| [7223](#L7223) | foreach ($page\_types as $block\_page\_type) $after\_comments\_hook\_blocks [$block\_page\_type][]= $block; |
| [7224](#L7224) | $after\_comments\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7225](#L7225) | break; |
| [7226](#L7226) | case AI\_AUTOMATIC\_INSERTION\_FOOTER: |
| [7227](#L7227) | foreach ($page\_types as $block\_page\_type) $footer\_hook\_blocks [$block\_page\_type][]= $block; |
| [7228](#L7228) | $footer\_hook\_blocks [AI\_PT\_ANY][]= $block; |
| [7229](#L7229) | break; |
| [7230](#L7230) | default: |
| [7231](#L7231) | if ($automatic\_insertion >= AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK && $automatic\_insertion < AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK + 20) { |
| [7232](#L7232) | $hook\_index = $automatic\_insertion - AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK; |
| [7233](#L7233) | foreach ($page\_types as $block\_page\_type) $custom\_hook\_blocks [$hook\_index][$block\_page\_type][]= $block; |
| [7234](#L7234) | $custom\_hook\_blocks [$hook\_index][AI\_PT\_ANY][]= $block; |
| [7235](#L7235) | } |
| [7236](#L7236) | break; |
| [7237](#L7237) | } |
| [7238](#L7238) | } |
| [7239](#L7239) |  |
| [7240](#L7240) | $automatic           = $automatic\_insertion         != AI\_AUTOMATIC\_INSERTION\_DISABLED; |
| [7241](#L7241) | $manual\_widget       = $obj->get\_enable\_widget()     == AI\_ENABLED; |
| [7242](#L7242) | $manual\_shortcode    = $obj->get\_enable\_manual()     == AI\_ENABLED; |
| [7243](#L7243) | $manual\_php\_function = $obj->get\_enable\_php\_call()   == AI\_ENABLED; |
| [7244](#L7244) | if ($enabled\_insertion && ($automatic || ($manual\_widget && in\_array ($block, $widget\_blocks)) || $manual\_shortcode || $manual\_php\_function)) { |
| [7245](#L7245) | $active\_blocks []= $block; |
| [7246](#L7246) |  |
| [7247](#L7247) | $obj->extract\_features (); |
| [7248](#L7248) | } |
| [7249](#L7249) | } |
| [7250](#L7250) |  |
| [7251](#L7251) | $extract [AI\_EXTRACT\_USED\_BLOCKS] = serialize ($active\_blocks); |
| [7252](#L7252) |  |
| [7253](#L7253) | if (isset ($settings [AI\_HEADER\_OPTION\_NAME])) { |
| [7254](#L7254) | $obj->wp\_options = $settings [AI\_HEADER\_OPTION\_NAME]; |
| [7255](#L7255) | if ($obj->get\_enable\_manual () && $obj->get\_detection\_server\_side())  $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] = true; |
| [7256](#L7256) | } |
| [7257](#L7257) |  |
| [7258](#L7258) | if (isset ($settings [AI\_FOOTER\_OPTION\_NAME])) { |
| [7259](#L7259) | $obj->wp\_options = $settings [AI\_FOOTER\_OPTION\_NAME]; |
| [7260](#L7260) | if ($obj->get\_enable\_manual () && $obj->get\_detection\_server\_side())  $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] = true; |
| [7261](#L7261) | } |
| [7262](#L7262) |  |
| [7263](#L7263) | if (function\_exists ('ai\_global\_extract\_features')) { |
| [7264](#L7264) | ai\_global\_extract\_features (); |
| [7265](#L7265) | } |
| [7266](#L7266) |  |
| [7267](#L7267) | $extract [AI\_EXTRACT\_FEATURES] = array ( |
| [7268](#L7268) | AI\_MOBILE\_DETECT\_JS           => $ai\_wp\_data [AI\_MOBILE\_DETECT\_JS], |
| [7269](#L7269) | AI\_SERVER\_SIDE\_DETECTION      => $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION], |
| [7270](#L7270) | AI\_CLIENT\_SIDE\_DETECTION      => $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION], |
| [7271](#L7271) | AI\_CLIENT\_SIDE\_INSERTION      => $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION], |
| [7272](#L7272) | AI\_STICK\_TO\_THE\_CONTENT       => $ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT], |
| [7273](#L7273) | AI\_TRACKING                   => $ai\_wp\_data [AI\_TRACKING], |
| [7274](#L7274) | AI\_CLOSE\_BUTTONS              => $ai\_wp\_data [AI\_CLOSE\_BUTTONS], |
| [7275](#L7275) | AI\_PARALLAX                   => $ai\_wp\_data [AI\_PARALLAX], |
| [7276](#L7276) | AI\_CHECK\_BLOCK                => $ai\_wp\_data [AI\_CHECK\_BLOCK], |
| [7277](#L7277) | AI\_IFRAMES                    => $ai\_wp\_data [AI\_IFRAMES], |
| [7278](#L7278) | AI\_ANIMATION                  => $ai\_wp\_data [AI\_ANIMATION], |
| [7279](#L7279) | AI\_LAZY\_LOADING               => $ai\_wp\_data [AI\_LAZY\_LOADING], |
| [7280](#L7280) | AI\_GEOLOCATION                => $ai\_wp\_data [AI\_GEOLOCATION] |
| [7281](#L7281) | ); |
| [7282](#L7282) |  |
| [7283](#L7283) | $ai\_wp\_data = $temp\_ai\_wp\_data; |
| [7284](#L7284) |  |
| [7285](#L7285) |  |
| [7286](#L7286) | if (defined ('AI\_BUFFERING')) { |
| [7287](#L7287) | $extract [ABOVE\_HEADER\_HOOK\_BLOCKS] = $above\_header\_hook\_blocks; |
| [7288](#L7288) | $extract [HTML\_ELEMENT\_HOOK\_BLOCKS] = $html\_element\_hook\_blocks; |
| [7289](#L7289) | } |
| [7290](#L7290) |  |
| [7291](#L7291) | $extract [CONTENT\_HOOK\_BLOCKS]          = $content\_hook\_blocks; |
| [7292](#L7292) | $extract [EXCERPT\_HOOK\_BLOCKS]          = $excerpt\_hook\_blocks; |
| [7293](#L7293) | $extract [LOOP\_START\_HOOK\_BLOCKS]       = $loop\_start\_hook\_blocks; |
| [7294](#L7294) | $extract [LOOP\_END\_HOOK\_BLOCKS]         = $loop\_end\_hook\_blocks; |
| [7295](#L7295) | $extract [POST\_HOOK\_BLOCKS]             = $post\_hook\_blocks; |
| [7296](#L7296) | $extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS]  = $before\_comments\_hook\_blocks; |
| [7297](#L7297) | $extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS] = $between\_comments\_hook\_blocks; |
| [7298](#L7298) | $extract [AFTER\_COMMENTS\_HOOK\_BLOCKS]   = $after\_comments\_hook\_blocks; |
| [7299](#L7299) | $extract [FOOTER\_HOOK\_BLOCKS]           = $footer\_hook\_blocks; |
| [7300](#L7300) |  |
| [7301](#L7301) | for ($custom\_hook = 1; $custom\_hook <= 20; $custom\_hook ++) { |
| [7302](#L7302) | $action = get\_hook\_action ($custom\_hook); |
| [7303](#L7303) |  |
| [7304](#L7304) | if (get\_hook\_enabled ($custom\_hook) && get\_hook\_name ($custom\_hook) != '' && $action != '') { |
| [7305](#L7305) |  |
| [7306](#L7306) | $custom\_hook\_extract\_index = $action . CUSTOM\_HOOK\_BLOCKS; |
| [7307](#L7307) |  |
| [7308](#L7308) | if (isset ($extract [$custom\_hook\_extract\_index])) { |
| [7309](#L7309) | // Custom hook on WP hook used by the plugin - merge blocks |
| [7310](#L7310) | foreach ($extract [$custom\_hook\_extract\_index] as $page\_type => $blocks) { |
| [7311](#L7311) | $extract [$custom\_hook\_extract\_index][$page\_type] = array\_merge ($blocks, $custom\_hook\_blocks [$custom\_hook - 1][$page\_type]); |
| [7312](#L7312) | } |
| [7313](#L7313) | } else $extract [$custom\_hook\_extract\_index] = $custom\_hook\_blocks [$custom\_hook - 1]; |
| [7314](#L7314) |  |
| [7315](#L7315) | } |
| [7316](#L7316) | } |
| [7317](#L7317) |  |
| [7318](#L7318) | $extract\_version = $version\_string . $subversion\_string . '-' . '96'; |
| [7319](#L7319) | if (function\_exists ('ai\_system\_output\_check')) { |
| [7320](#L7320) | $extract\_version .= 'P'; |
| [7321](#L7321) | } |
| [7322](#L7322) | $extract ['VERSION'] = $extract\_version; |
| [7323](#L7323) |  |
| [7324](#L7324) | $extract ['TIMESTAMP'] = time (); |
| [7325](#L7325) |  |
| [7326](#L7326) | return ($extract); |
| [7327](#L7327) | } |
| [7328](#L7328) |  |
| [7329](#L7329) | function ai\_load\_settings () { |
| [7330](#L7330) | global $ai\_db\_options, $block\_object, $ai\_wp\_data, $version\_string, $ai\_custom\_hooks; |
| [7331](#L7331) |  |
| [7332](#L7332) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("LOAD SETTINGS START"); |
| [7333](#L7333) |  |
| [7334](#L7334) |  |
| [7335](#L7335) |  |
| [7336](#L7336) |  |
| [7337](#L7337) | if (get\_option (AI\_OPTION\_NAME) === false) { |
| [7338](#L7338) | $initial\_settings = ''; |
| [7339](#L7339) | $initial\_settings = apply\_filters ('ai\_initial\_settings', $initial\_settings); |
| [7340](#L7340) |  |
| [7341](#L7341) | if (is\_string ($initial\_settings) && substr ($initial\_settings, 0, 4) === ':AI:') { |
| [7342](#L7342) | update\_option (AI\_OPTION\_NAME, $initial\_settings); |
| [7343](#L7343) | } |
| [7344](#L7344) |  |
| [7345](#L7345) | elseif (is\_array ($initial\_settings)) { |
| [7346](#L7346) | $ai\_db\_options = $initial\_settings; |
| [7347](#L7347) | ai\_save\_options ($ai\_db\_options); |
| [7348](#L7348) | } |
| [7349](#L7349) | } |
| [7350](#L7350) |  |
| [7351](#L7351) |  |
| [7352](#L7352) |  |
| [7353](#L7353) | ai\_load\_options (); |
| [7354](#L7354) |  |
| [7355](#L7355) | if (!is\_array ($ai\_db\_options)) { |
| [7356](#L7356) | $ai\_db\_options = array (); |
| [7357](#L7357) | define ('AI\_SETTINGS\_ERROR', true); |
| [7358](#L7358) | } |
| [7359](#L7359) |  |
| [7360](#L7360) | $extract\_ok = ai\_load\_extract (false); |
| [7361](#L7361) |  |
| [7362](#L7362) | $ai\_custom\_hooks = array (); |
| [7363](#L7363) | for ($hook = 1; $hook <= 20; $hook ++) { |
| [7364](#L7364) | $name   = get\_hook\_name   ($hook); |
| [7365](#L7365) | $action = get\_hook\_action ($hook); |
| [7366](#L7366) |  |
| [7367](#L7367) | if (get\_hook\_enabled ($hook) && $name != '' && $action != '') { |
| [7368](#L7368) | $ai\_custom\_hooks [] = array ('index' => $hook, 'name' => $name, 'action' => $action, 'priority' => get\_hook\_priority ($hook)); |
| [7369](#L7369) | } |
| [7370](#L7370) | } |
| [7371](#L7371) |  |
| [7372](#L7372) | $features\_in\_extract = $extract\_ok && isset ($ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES]); |
| [7373](#L7373) |  |
| [7374](#L7374) | if (isset ($ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_USED\_BLOCKS]) && is\_string ($ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_USED\_BLOCKS]) && strlen ($ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_USED\_BLOCKS]) != 0) { |
| [7375](#L7375) | $used\_blocks = @unserialize ($ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_USED\_BLOCKS]); |
| [7376](#L7376) | } else $used\_blocks = false; |
| [7377](#L7377) |  |
| [7378](#L7378) | $obj = new ai\_Block (0);                  // translators: block name (block with default settings) |
| [7379](#L7379) | //  $obj->wp\_options [AI\_OPTION\_BLOCK\_NAME] = \_x('Default', 'Block name', 'ad-inserter'); // Function \_load\_textdomain\_just\_in\_time was called incorrectly. Translation loading for the ad-inserter domain was triggered too early. |
| [7380](#L7380) | $obj->wp\_options [AI\_OPTION\_BLOCK\_NAME] = 'Default'; |
| [7381](#L7381) | $block\_object [0] = $obj; |
| [7382](#L7382) |  |
| [7383](#L7383) | for ($block = 1; $block <= 96; $block ++) { |
| [7384](#L7384) | $obj = new ai\_Block ($block); |
| [7385](#L7385) |  |
| [7386](#L7386) | $obj->load\_options ($block); |
| [7387](#L7387) | $block\_object [$block] = $obj; |
| [7388](#L7388) |  |
| [7389](#L7389) | if (!$features\_in\_extract && (!is\_array ($used\_blocks) || in\_array ($block, $used\_blocks))) $obj->extract\_features (); |
| [7390](#L7390) | } |
| [7391](#L7391) |  |
| [7392](#L7392) | $adH  = new ai\_AdH(); |
| [7393](#L7393) | $adF  = new ai\_AdF(); |
| [7394](#L7394) | $adH->load\_options (AI\_HEADER\_OPTION\_NAME); |
| [7395](#L7395) | $adF->load\_options (AI\_FOOTER\_OPTION\_NAME); |
| [7396](#L7396) | $block\_object [AI\_HEADER\_OPTION\_NAME]       = $adH; |
| [7397](#L7397) | $block\_object [AI\_FOOTER\_OPTION\_NAME]       = $adF; |
| [7398](#L7398) |  |
| [7399](#L7399) | if ($features\_in\_extract) { |
| [7400](#L7400) | $ai\_wp\_data [AI\_MOBILE\_DETECT\_JS]          = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_MOBILE\_DETECT\_JS]; |
| [7401](#L7401) | $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION]     = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_SERVER\_SIDE\_DETECTION]; |
| [7402](#L7402) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION]     = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_CLIENT\_SIDE\_DETECTION]; |
| [7403](#L7403) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION]     = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_CLIENT\_SIDE\_INSERTION]; |
| [7404](#L7404) | $ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT]      = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_STICK\_TO\_THE\_CONTENT]; |
| [7405](#L7405) | $ai\_wp\_data [AI\_TRACKING]                  = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_TRACKING]; |
| [7406](#L7406) | $ai\_wp\_data [AI\_CLOSE\_BUTTONS]             = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_CLOSE\_BUTTONS]; |
| [7407](#L7407) | $ai\_wp\_data [AI\_PARALLAX]                  = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_PARALLAX]; |
| [7408](#L7408) | $ai\_wp\_data [AI\_CHECK\_BLOCK]               = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_CHECK\_BLOCK]; |
| [7409](#L7409) | $ai\_wp\_data [AI\_IFRAMES]                   = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_IFRAMES]; |
| [7410](#L7410) | $ai\_wp\_data [AI\_ANIMATION]                 = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_ANIMATION]; |
| [7411](#L7411) | $ai\_wp\_data [AI\_LAZY\_LOADING]              = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_LAZY\_LOADING]; |
| [7412](#L7412) | $ai\_wp\_data [AI\_GEOLOCATION]               = $ai\_db\_options [AI\_OPTION\_EXTRACT][AI\_EXTRACT\_FEATURES][AI\_GEOLOCATION]; |
| [7413](#L7413) | } else { |
| [7414](#L7414) | if ($adH->get\_enable\_manual () && $adH->get\_detection\_server\_side())  $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] = true; |
| [7415](#L7415) | if ($adF->get\_enable\_manual () && $adF->get\_detection\_server\_side())  $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] = true; |
| [7416](#L7416) | } |
| [7417](#L7417) |  |
| [7418](#L7418) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [7419](#L7419) | $adA  = new ai\_AdA(); |
| [7420](#L7420) | $adA->load\_options (AI\_ADB\_MESSAGE\_OPTION\_NAME); |
| [7421](#L7421) | $block\_object [AI\_ADB\_MESSAGE\_OPTION\_NAME]  = $adA; |
| [7422](#L7422) | $ai\_wp\_data [AI\_ADB\_DETECTION] = $adA->get\_enable\_manual (); |
| [7423](#L7423) | } |
| [7424](#L7424) |  |
| [7425](#L7425) | if (($install\_timestamp = get\_option (AI\_INSTALL\_NAME)) !== false) { |
| [7426](#L7426) | $install    = new DateTime (date('Y-m-d H:i:s', $install\_timestamp)); |
| [7427](#L7427) | $now        = new DateTime (date('Y-m-d H:i:s', time())); |
| [7428](#L7428) | if (method\_exists ($install, 'diff')) { |
| [7429](#L7429) | $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE] = $install->diff ($now); |
| [7430](#L7430) | $ai\_wp\_data [AI\_DAYS\_SINCE\_INSTAL]       = $ai\_wp\_data [AI\_INSTALL\_TIME\_DIFFERENCE]->days; |
| [7431](#L7431) | } |
| [7432](#L7432) | } |
| [7433](#L7433) |  |
| [7434](#L7434) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("LOAD SETTINGS END"); |
| [7435](#L7435) | } |
| [7436](#L7436) |  |
| [7437](#L7437) |  |
| [7438](#L7438) | function ai\_compare\_viewport ($a, $b) { |
| [7439](#L7439) |  |
| [7440](#L7440) | if ($a ['width'] == $b ['width']) return 0; |
| [7441](#L7441) | return ($a ['width'] > $b ['width']) ? - 1 : 1; |
| [7442](#L7442) | } |
| [7443](#L7443) |  |
| [7444](#L7444) | function generate\_viewport\_css () { |
| [7445](#L7445) |  |
| [7446](#L7446) | $viewports = array (); |
| [7447](#L7447) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [7448](#L7448) | $viewport\_name  = get\_viewport\_name ($viewport); |
| [7449](#L7449) | $viewport\_width = get\_viewport\_width ($viewport); |
| [7450](#L7450) | if ($viewport\_name != '') { |
| [7451](#L7451) | $viewports []= array ('index' => $viewport, 'name' => $viewport\_name, 'width' => $viewport\_width); |
| [7452](#L7452) | } |
| [7453](#L7453) | } |
| [7454](#L7454) |  |
| [7455](#L7455) | usort ($viewports, 'ai\_compare\_viewport'); |
| [7456](#L7456) |  |
| [7457](#L7457) | $viewport\_styles = ''; |
| [7458](#L7458) | $number\_of\_viewports = count ($viewports); |
| [7459](#L7459) | if ($number\_of\_viewports != 0) { |
| [7460](#L7460) | $viewport\_styles = ".ai-viewports                 {--ai: 1;}\n";  // Mark unprocessed block for viewports, also dummy style to prevent not loading viewport rules when optimizers join them with other (broken) styles on the page |
| [7461](#L7461) | foreach ($viewports as $index => $viewport) { |
| [7462](#L7462) | if ($index == 0) { |
| [7463](#L7463) | foreach (array\_reverse ($viewports) as $index2 => $viewport2) { |
| [7464](#L7464) | if ($index2 != $number\_of\_viewports - 1) { |
| [7465](#L7465) | $viewport\_styles .= ".ai-viewport-" . $viewport2 ['index'] . "                { display: none !important;}\n"; |
| [7466](#L7466) | } |
| [7467](#L7467) | } |
| [7468](#L7468) | $viewport\_styles .= ".ai-viewport-".$viewports [0]['index']."                { display: inherit !important;}\n"; |
| [7469](#L7469) | $viewport\_styles .= ".ai-viewport-0                { display: none !important;}\n"; |
| [7470](#L7470) | } else { |
| [7471](#L7471) | $viewport\_styles .= "@media "; |
| [7472](#L7472) | if ($viewport ['width'] != 0) |
| [7473](#L7473) | $viewport\_styles .= "(min-width: " . $viewport ['width'] . "px) and "; |
| [7474](#L7474) | $viewport\_styles .= "(max-width: " . ($viewports [$index - 1]['width'] - 1) . "px) {\n"; |
| [7475](#L7475) | foreach ($viewports as $index2 => $viewport2) { |
| [7476](#L7476) | if ($index2 == 0) |
| [7477](#L7477) | $viewport\_styles .= ".ai-viewport-" . $viewport2 ['index'] . "                { display: none !important;}\n"; |
| [7478](#L7478) | elseif ($index == $index2) |
| [7479](#L7479) | $viewport\_styles .= ".ai-viewport-" . $viewport2 ['index'] . "                { display: inherit !important;}\n"; |
| [7480](#L7480) |  |
| [7481](#L7481) | } |
| [7482](#L7482) | $viewport\_styles .= "}\n"; |
| [7483](#L7483) | } |
| [7484](#L7484) | } |
| [7485](#L7485) | } |
| [7486](#L7486) | return ($viewport\_styles); |
| [7487](#L7487) | } |
| [7488](#L7488) |  |
| [7489](#L7489) | function get\_main\_alignment\_css ($alt\_styles\_text) { |
| [7490](#L7490) | if (strpos ($alt\_styles\_text, "||") !== false) { |
| [7491](#L7491) | $styles = explode ("||", $alt\_styles\_text); |
| [7492](#L7492) | return $styles [0]; |
| [7493](#L7493) | } |
| [7494](#L7494) | return $alt\_styles\_text; |
| [7495](#L7495) | } |
| [7496](#L7496) |  |
| [7497](#L7497) | function ai\_change\_css ($css, $property, $value) { |
| [7498](#L7498) | $styles = explode (';', $css); |
| [7499](#L7499) | $replaced = false; |
| [7500](#L7500) | foreach ($styles as $index => $style) { |
| [7501](#L7501) | if (strpos (trim ($style), $property) === 0) { |
| [7502](#L7502) | $styles [$index] = preg\_replace ('/\:\s\*(.+)/', ': ' . $value, $styles [$index]); |
| [7503](#L7503) | $replaced = true; |
| [7504](#L7504) | break; |
| [7505](#L7505) | } |
| [7506](#L7506) | } |
| [7507](#L7507) |  |
| [7508](#L7508) | $new\_style = implode (';', $styles); |
| [7509](#L7509) |  |
| [7510](#L7510) | if (!$replaced) { |
| [7511](#L7511) | $new\_style = rtrim ($new\_style, '; '); |
| [7512](#L7512) | return  $new\_style . '; ' . $property . ': ' . $value . ';'; |
| [7513](#L7513) | } |
| [7514](#L7514) |  |
| [7515](#L7515) | return  $new\_style; |
| [7516](#L7516) | } |
| [7517](#L7517) |  |
| [7518](#L7518) | function generate\_alignment\_css () { |
| [7519](#L7519) | global $ai\_db\_options\_extract, $block\_object; |
| [7520](#L7520) |  |
| [7521](#L7521) | $block\_class\_name = get\_block\_class\_name (true) . '-'; |
| [7522](#L7522) |  |
| [7523](#L7523) | $styles = array (); |
| [7524](#L7524) |  |
| [7525](#L7525) | $styles [AI\_ALIGNMENT\_DEFAULT]      = array (AI\_TEXT\_ENG\_DEFAULT,      get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_DEFAULT)); |
| [7526](#L7526) | $styles [AI\_ALIGNMENT\_LEFT]         = array (AI\_TEXT\_ENG\_LEFT,         get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_LEFT)); |
| [7527](#L7527) | $styles [AI\_ALIGNMENT\_RIGHT]        = array (AI\_TEXT\_ENG\_RIGHT,        get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_RIGHT)); |
| [7528](#L7528) | $styles [AI\_ALIGNMENT\_CENTER]       = array (AI\_TEXT\_ENG\_CENTER,       get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_CENTER)); |
| [7529](#L7529) | $styles [AI\_ALIGNMENT\_FLOAT\_LEFT]   = array (AI\_TEXT\_ENG\_FLOAT\_LEFT,   get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_FLOAT\_LEFT)); |
| [7530](#L7530) | $styles [AI\_ALIGNMENT\_FLOAT\_RIGHT]  = array (AI\_TEXT\_ENG\_FLOAT\_RIGHT,  get\_main\_alignment\_css (AI\_ALIGNMENT\_CSS\_FLOAT\_RIGHT)); |
| [7531](#L7531) |  |
| [7532](#L7532) | if (function\_exists ('generate\_alignment\_css\_2')) $styles = array\_replace ($styles, generate\_alignment\_css\_2 ()); |
| [7533](#L7533) |  |
| [7534](#L7534) | $alignment\_css = ''; |
| [7535](#L7535) | $alignments = array (); |
| [7536](#L7536) |  |
| [7537](#L7537) | if (isset ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && is\_string ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && strlen ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) != 0) { |
| [7538](#L7538) | $used\_blocks = unserialize ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]); |
| [7539](#L7539) | foreach ($used\_blocks as $used\_block) { |
| [7540](#L7540) | $obj = $block\_object [$used\_block]; |
| [7541](#L7541) | $alignment\_type = $obj->get\_alignment\_type (); |
| [7542](#L7542) |  |
| [7543](#L7543) | switch ($alignment\_type) { |
| [7544](#L7544) | case AI\_ALIGNMENT\_DEFAULT: |
| [7545](#L7545) | case AI\_ALIGNMENT\_LEFT: |
| [7546](#L7546) | case AI\_ALIGNMENT\_RIGHT: |
| [7547](#L7547) | case AI\_ALIGNMENT\_CENTER: |
| [7548](#L7548) | case AI\_ALIGNMENT\_FLOAT\_LEFT: |
| [7549](#L7549) | case AI\_ALIGNMENT\_FLOAT\_RIGHT: |
| [7550](#L7550) | //      case AI\_ALIGNMENT\_STICKY\_LEFT: |
| [7551](#L7551) | //      case AI\_ALIGNMENT\_STICKY\_RIGHT: |
| [7552](#L7552) | //      case AI\_ALIGNMENT\_STICKY\_TOP: |
| [7553](#L7553) | //      case AI\_ALIGNMENT\_STICKY\_BOTTOM: |
| [7554](#L7554) | $alignment\_name = strtolower ($styles [$alignment\_type][0]); |
| [7555](#L7555) | if (!in\_array ($alignment\_name, $alignments)) { |
| [7556](#L7556) | $alignments []= $alignment\_name; |
| [7557](#L7557) | $alignment\_css .= '.' . $block\_class\_name . str\_replace (' ', '-', $alignment\_name) .' {' . $styles [$alignment\_type][1] . "}\n"; |
| [7558](#L7558) | } |
| [7559](#L7559) | break; |
| [7560](#L7560) | case AI\_ALIGNMENT\_STICKY: |
| [7561](#L7561) | $sticky\_css = $obj->alignment\_style ($alignment\_type); |
| [7562](#L7562) | $alignment\_name = strtolower (md5 ($sticky\_css)); |
| [7563](#L7563) | if (!in\_array ($alignment\_name, $alignments)) { |
| [7564](#L7564) | $alignments []= $alignment\_name; |
| [7565](#L7565) | //          $alignment\_css .= '.' . $block\_class\_name . str\_replace (' ', '-', $alignment\_name) .' {' . $sticky\_css . "}\n"; |
| [7566](#L7566) | $alignment\_css .= '.' . $block\_class\_name . $alignment\_name .' {' . $sticky\_css . "}\n"; |
| [7567](#L7567) | } |
| [7568](#L7568) | break; |
| [7569](#L7569) | case AI\_ALIGNMENT\_CUSTOM\_CSS: |
| [7570](#L7570) | $custom\_css = $obj->get\_custom\_css (); |
| [7571](#L7571) | $alignment\_name = strtolower (md5 ($custom\_css)); |
| [7572](#L7572) | if (!in\_array ($alignment\_name, $alignments)) { |
| [7573](#L7573) | $alignments []= $alignment\_name; |
| [7574](#L7574) | //          $alignment\_css .= '.' . $block\_class\_name . str\_replace (' ', '-', $alignment\_name) .' {' . str\_replace ('&#039;', "'", $custom\_css) . "}\n"; |
| [7575](#L7575) | $alignment\_css .= '.' . $block\_class\_name . $alignment\_name .' {' . str\_replace ('&#039;', "'", $custom\_css) . "}\n"; |
| [7576](#L7576) | } |
| [7577](#L7577) | break; |
| [7578](#L7578) | } |
| [7579](#L7579) |  |
| [7580](#L7580) | if ($alignment\_type != AI\_ALIGNMENT\_CUSTOM\_CSS) { |
| [7581](#L7581) | $size\_css = $obj->size\_background\_style (); |
| [7582](#L7582) | //      $size\_name = strtolower (md5 ($size\_css)); |
| [7583](#L7583) | $size\_name = ai\_css\_to\_name ($size\_css); |
| [7584](#L7584) | if (!in\_array ($size\_name, $alignments)) { |
| [7585](#L7585) | $alignments []= $size\_name; |
| [7586](#L7586) | $alignment\_css .= '.' . $block\_class\_name . $size\_name .' {' . str\_replace ('&#039;', "'", $size\_css) . "}\n"; |
| [7587](#L7587) | } |
| [7588](#L7588) | } |
| [7589](#L7589) | } |
| [7590](#L7590) | } |
| [7591](#L7591) |  |
| [7592](#L7592) | return $alignment\_css; |
| [7593](#L7593) | } |
| [7594](#L7594) |  |
| [7595](#L7595) | function generate\_debug\_css\_base () { |
| [7596](#L7596) | ?> |
| [7597](#L7597) |  |
| [7598](#L7598) | .ai-debug-block {padding: 0; margin: 0;} |
| [7599](#L7599) |  |
| [7600](#L7600) | <?php |
| [7601](#L7601) | } |
| [7602](#L7602) |  |
| [7603](#L7603) | function generate\_debug\_css () { |
| [7604](#L7604) | ?> |
| [7605](#L7605) |  |
| [7606](#L7606) | .ai-debug-tags {font-weight: bold; color: white; padding: 2px;} |
| [7607](#L7607) | .ai-debug-positions {clear: both; text-align: center; padding: 10px 0; font-family: arial; font-weight: bold; line-height: 20px; border: 1px solid blue; color: blue; background: #eef;} |
| [7608](#L7608) | .ai-debug-positions.ai-images {border: 1px solid #444; color: #444; background: #fff9ab;} |
| [7609](#L7609) | .ai-debug-page-type {text-align: center; padding: 10px 0; font-family: arial; font-weight: bold; line-height: 20px; border: 1px solid #000; color: #000; background: #fff;} |
| [7610](#L7610) | .ai-debug-status {clear: both; text-align: center; padding: 10px 0; font-family: arial; font-weight: bold; line-height: 20px; border: 1px solid #eee; color: #666; background: #eee;} |
| [7611](#L7611) | .ai-debug-status.status-ok, .ai-debug-status.adb-off {border: 1px solid green; color: green; background: #efe;} |
| [7612](#L7612) | .ai-debug-status.status-error, .ai-debug-status.adb-on {border: 1px solid red; color: red; background: #fee;} |
| [7613](#L7613) | .ai-debug-adb {opacity: 0.85; cursor: pointer;} |
| [7614](#L7614) | .ai-debug-widget {margin: 0; padding: 0 5px; font-size: 10px; white-space: pre; overflow-x: auto; overflow-y: hidden;} |
| [7615](#L7615) | a.ai-debug-left {float: left; cursor: default; font-size: 10px; text-decoration: none; color: transparent; padding: 0px 10px 0 0; border: 0; box-shadow: none;} |
| [7616](#L7616) | a.ai-debug-right {float: right; cursor: default; font-size: 10px; text-decoration: none; color: #88f; padding: 0px 10px 0 0; border: 0; box-shadow: none;} |
| [7617](#L7617) | a.ai-debug-center {text-align: center; cursor: default; font-size: 10px; text-decoration: none; color: white; padding: 0px 10px 0 0; border: 0; box-shadow: none;} |
| [7618](#L7618) | .ai-debug-invisible {display: none;} |
| [7619](#L7619) | .ai-debug-content-hook-positions {color: blue;} |
| [7620](#L7620) | .ai-debug-removed-html-tags {color: red;} |
| [7621](#L7621) | .ai-debug-rnrn {background: #0ff; color: #000;} |
| [7622](#L7622) | .ai-debug-p {background: #0a0;} |
| [7623](#L7623) | .ai-debug-div {background: #46f;} |
| [7624](#L7624) | .ai-debug-h {background: #d4e;} |
| [7625](#L7625) | .ai-debug-img {background: #ee0; color: #000;} |
| [7626](#L7626) | .ai-debug-pre {background: #222;} |
| [7627](#L7627) | .ai-debug-span {background: #cff; color: #000;} |
| [7628](#L7628) | .ai-debug-special {background: #fb0; color: #000;} |
| [7629](#L7629) |  |
| [7630](#L7630) | .ai-debug-ad-overlay {position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #8f8; opacity: 0.6; z-index: 999999990} |
| [7631](#L7631) |  |
| [7632](#L7632) | .ai-debug-block ins.adsbygoogle[data-ad-status="unfilled"] .ai-debug-ad-overlay {display: none;} |
| [7633](#L7633) | .ai-debug-block ins.adsbygoogle[data-ad-status="unfilled"] {background: url(https://via.placeholder.com/800x800/aaffaa/000000.png?text=NO%20AD%20SERVED); background-size: cover; background-repeat: no-repeat; background-position: center;} |
| [7634](#L7634) |  |
| [7635](#L7635) | .ai-auto-ads {background-color: #84f;} |
| [7636](#L7636) | .ai-no-slot {background-color: #48f;} |
| [7637](#L7637) | .ai-debug-ad-info {position: absolute; top: 0; left: 0; overflow: hidden; width: auto; height: auto; font-family: arial; font-size: 11px; line-height: 11px; text-align: left; z-index: 999999991;} |
| [7638](#L7638) | .ai-info {display: inline-block; padding: 2px 4px;} |
| [7639](#L7639) | .ai-info-1 {background: #000; color: #fff;} |
| [7640](#L7640) | .ai-info-2 {background: #fff; color: #000;} |
| [7641](#L7641) |  |
| [7642](#L7642) | .ai-debug-block {outline: 1px solid;} |
| [7643](#L7643) | .ai-debug-bar {background: #666;} |
| [7644](#L7644) |  |
| [7645](#L7645) | .ai-debug-block kbd kbd {font-weight: normal;} |
| [7646](#L7646) |  |
| [7647](#L7647) | .ai-debug-code {margin: 0; padding: 0; border: 0; font-family: monospace, sans-serif; font-size: 12px; line-height: 13px; background: #fff; color: #000;} |
| [7648](#L7648) |  |
| [7649](#L7649) | .ai-debug-code.ai-code-org {float: left; max-width: 47%;} |
| [7650](#L7650) | .ai-debug-code.ai-code-inserted {float: right; max-width: 47%;} |
| [7651](#L7651) |  |
| [7652](#L7652) | .ai-debug-block.ai-debug-default {border-color: #e00; outline-color: #e00;} |
| [7653](#L7653) | .ai-debug-bar.ai-debug-default {background: #e00;} |
| [7654](#L7654) |  |
| [7655](#L7655) | .ai-debug-bar.ai-debug-no-wrapping kbd {color: #ff0;} |
| [7656](#L7656) |  |
| [7657](#L7657) | .ai-debug-block.ai-debug-viewport-invisible {border-color: #00f; outline-color: #00f;} |
| [7658](#L7658) | .ai-debug-bar.ai-debug-viewport-invisible {background: #00f;} |
| [7659](#L7659) |  |
| [7660](#L7660) | .ai-debug-block.ai-debug-amp {border-color: #0c0; outline-color: #0c0;} |
| [7661](#L7661) | .ai-debug-bar.ai-debug-amp {background: #0c0;} |
| [7662](#L7662) |  |
| [7663](#L7663) | .ai-debug-block.ai-debug-fallback {border-color: #a0f; outline-color: #a0f;} |
| [7664](#L7664) | .ai-debug-bar.ai-debug-fallback {background: #a0f;} |
| [7665](#L7665) |  |
| [7666](#L7666) | .ai-debug-block.ai-debug-script {border-color: #00bae6; outline-color: #00bae6; background: #eee;} |
| [7667](#L7667) | .ai-debug-bar.ai-debug-script {background: #00bae6;} |
| [7668](#L7668) |  |
| [7669](#L7669) | .ai-debug-block.ai-debug-cookie {border-color: #9be3ff; outline-color: #9be3ff; background: #eee;} |
| [7670](#L7670) | .ai-debug-bar.ai-debug-cookie {background: #9be3ff;} |
| [7671](#L7671) | .ai-debug-bar.ai-debug-cookie kbd {color: #000;} |
| [7672](#L7672) |  |
| [7673](#L7673) | .ai-debug-block.ai-debug-filter {border-color: #9be3ff; outline-color: #9be3ff; background: #eee;} |
| [7674](#L7674) | .ai-debug-bar.ai-debug-filter {background: #9be3ff;} |
| [7675](#L7675) | .ai-debug-bar.ai-debug-filter kbd {color: #000;} |
| [7676](#L7676) |  |
| [7677](#L7677) | .ai-debug-block.ai-debug-adb-status {border-color: #000; outline-color: #000;} |
| [7678](#L7678) | .ai-debug-bar.ai-debug-adb-status {background: #000;} |
| [7679](#L7679) |  |
| [7680](#L7680) | .ai-debug-block.ai-debug-adsense {border-color: #e0a; outline-color: #e0a;} |
| [7681](#L7681) | .ai-debug-bar.ai-debug-adsense {background: #e0a;} |
| [7682](#L7682) |  |
| [7683](#L7683) | .ai-debug-block.ai-debug-marker {border-color: #a0f; outline-color: #a0f;} |
| [7684](#L7684) | .ai-debug-bar.ai-debug-marker {background: #a0f; display: inline;} |
| [7685](#L7685) |  |
| [7686](#L7686) | .ai-debug-block.ai-debug-adsense.ai-adsense-auto-ads {position: absolute; top: -20px; width: 100%;} |
| [7687](#L7687) |  |
| [7688](#L7688) | .ai-debug-block.ai-debug-ajax {border-color: #ffd600; outline-color: #ffd600;} |
| [7689](#L7689) | .ai-debug-bar.ai-debug-ajax {background: #ffd600;} |
| [7690](#L7690) | .ai-debug-bar.ai-debug-ajax kbd {color: #000;} |
| [7691](#L7691) |  |
| [7692](#L7692) | .ai-debug-block.ai-debug-iframe {border-color: #ff9e38; outline-color: #ff9e38; line-height: 1px;} |
| [7693](#L7693) | .ai-debug-bar.ai-debug-iframe {background: #ff9e38;} |
| [7694](#L7694) | .ai-debug-bar.ai-debug-iframe kbd {color: #000;} |
| [7695](#L7695) | .ai-debug-block.ai-debug-iframe .ai-attributes {line-height: initial;} |
| [7696](#L7696) |  |
| [7697](#L7697) | .ai-debug-adb-status.on kbd {color: #f00;} |
| [7698](#L7698) | .ai-debug-adb-status.off kbd {color: #0f0;} |
| [7699](#L7699) |  |
| [7700](#L7700) | .ai-debug-block.ai-debug-lists {border-color: #00c5be; outline-color: #00c5be;} |
| [7701](#L7701) | .ai-debug-bar.ai-debug-lists {background: #00c5be;} |
| [7702](#L7702) |  |
| [7703](#L7703) | .ai-debug-block.ai-debug-scheduling {border-color: #00c5be; outline-color: #00c5be;} |
| [7704](#L7704) | .ai-debug-bar.ai-debug-scheduling {background: #00c5be;} |
| [7705](#L7705) |  |
| [7706](#L7706) | .ai-debug-adb-hidden {visibility: hidden; display: none;} |
| [7707](#L7707) | .ai-debug-adb-center {text-align: center; font-weight: bold; margin: 0; padding: 4px 0;} |
| [7708](#L7708) |  |
| [7709](#L7709) | .ai-debug-bar {margin: 0; padding: 1px 0 1px 5px; color: white; font-size: 12px; font-family: arial; font-weight: normal; line-height: 20px; text-align: center; overflow: hidden; word-break: break-word;} |
| [7710](#L7710) |  |
| [7711](#L7711) | .ai-debug-bar .ai-debug-text-left {float: left; text-align: left; margin-top: 3px;} |
| [7712](#L7712) | .ai-debug-bar .ai-debug-text-right {float: right; text-align: right; padding-right: 3px; margin-top: 3px;} |
| [7713](#L7713) | .ai-debug-bar .ai-debug-text-center {text-align: center;} |
| [7714](#L7714) |  |
| [7715](#L7715) | .ai-debug-lists .ai-debug-text-left, .ai-debug-viewport-invisible .ai-debug-text-left, .ai-debug-filter .ai-debug-text-left {min-width: 40%;} |
| [7716](#L7716) | .ai-debug-lists .ai-debug-text-right, .ai-debug-viewport-invisible .ai-debug-text-right, .ai-debug-filter .ai-debug-text-right {min-width: 40%;} |
| [7717](#L7717) |  |
| [7718](#L7718) | .ai-debug-message {text-align: center; font-weight: bold;} |
| [7719](#L7719) |  |
| [7720](#L7720) | .ai-debug-bar kbd {margin: 0; padding: 0; color: #fff; font-size: inherit; font-family: arial; background-color: transparent; text-shadow: none; border: 0; box-shadow: none;} |
| [7721](#L7721) |  |
| [7722](#L7722) | .ai-debug-visibility-hidden {visibility: hidden} |
| [7723](#L7723) |  |
| [7724](#L7724) | .ai-debug-display-none {display: none} |
| [7725](#L7725) |  |
| [7726](#L7726) | .ai-debug-block pre {direction: ltr; text-align: left; margin: 0; padding: 2px 5px 2px; line-height: 14px; background: #fff; color: #000; font-family: monospace; font-size: 12px;} |
| [7727](#L7727) |  |
| [7728](#L7728) | pre.ai-w3tc-debug {font-size: 12px;} |
| [7729](#L7729) |  |
| [7730](#L7730) | pre.ai-w3tc-debug.ai-w3tc-run {color: #00f;} |
| [7731](#L7731) |  |
| [7732](#L7732) | pre.ai-processing-log {direction: ltr; text-align: left; padding: 10px; background: #eee; color: #000; font-family: monospace; font-size: 12px; line-height: 18px; white-space: pre-wrap; white-space: -moz-pre-wrap; white-space: -pre-wrap; white-space: -o-pre-wrap; word-wrap: break-word;} |
| [7733](#L7733) |  |
| [7734](#L7734) | .ai-debug-bar.ai-debug-lists.ai-debug-iab-tcf-2 kbd.ai-debug-text-left, .ai-debug-bar.ai-debug-lists.ai-debug-iab-tcf-2 kbd.ai-debug-text-right { |
| [7735](#L7735) | min-width: 10%; |
| [7736](#L7736) | } |
| [7737](#L7737) |  |
| [7738](#L7738) | <?php |
| [7739](#L7739) | } |
| [7740](#L7740) |  |
| [7741](#L7741) |  |
| [7742](#L7742) | function ai\_css\_to\_name ($css) { |
| [7743](#L7743) | //  return strtolower (rtrim (str\_replace (array ('width', 'height', 'background', ' ', ':', ';', '#'), array ('w', 'h', 'b', '', '-', '-', ''), $css), '-')); |
| [7744](#L7744) | return strtolower (rtrim (str\_replace (array ('width', 'height', 'background-color', 'background', ' ', ':', ';', '#', '(', ')', ','), array ('w', 'h', 'bc', 'b', '', '-', '-', '', '-', '-', '-'), $css), '-')); |
| [7745](#L7745) | } |
| [7746](#L7746) |  |
| [7747](#L7747) | function generate\_selection\_css () { |
| [7748](#L7748) | ?> |
| [7749](#L7749) | #ai-selector-data { |
| [7750](#L7750) | position: fixed; |
| [7751](#L7751) | top: 0; |
| [7752](#L7752) | z-index: 999999; |
| [7753](#L7753) | background: #fff; |
| [7754](#L7754) | width: 100%; |
| [7755](#L7755) | border: 1px solid #000; |
| [7756](#L7756) | } |
| [7757](#L7757) | #ai-selector-data kbd { |
| [7758](#L7758) | background-color: #fff; |
| [7759](#L7759) | box-shadow: none; |
| [7760](#L7760) | } |
| [7761](#L7761) | #ai-selector-data table { |
| [7762](#L7762) | width: 100%; |
| [7763](#L7763) | margin: 5px; |
| [7764](#L7764) | } |
| [7765](#L7765) | #ai-selector-data td { |
| [7766](#L7766) | padding: 5px 10px; |
| [7767](#L7767) | vertical-align: middle; |
| [7768](#L7768) | } |
| [7769](#L7769) | #ai-selector-data td button { |
| [7770](#L7770) | margin: 0 15px; |
| [7771](#L7771) | } |
| [7772](#L7772) | #ai-selector-data .ui-button-text-only .ui-button-text { |
| [7773](#L7773) | padding: 3px 10px; |
| [7774](#L7774) | } |
| [7775](#L7775) | #ai-selector-data td.data-name { |
| [7776](#L7776) | width: 100px; |
| [7777](#L7777) | } |
| [7778](#L7778) | #ai-selector-element, #ai-selector-path { |
| [7779](#L7779) | user-select: text; |
| [7780](#L7780) | } |
| [7781](#L7781) | #ai-selector { |
| [7782](#L7782) | width: 100%; |
| [7783](#L7783) | display: inline-block; |
| [7784](#L7784) | border-radius: 4px; |
| [7785](#L7785) | font-size: 12px; |
| [7786](#L7786) | font-family: Courier, 'Courier New', monospace; |
| [7787](#L7787) | font-weight: bold; |
| [7788](#L7788) | } |
| [7789](#L7789) | .ai-highlighted { |
| [7790](#L7790) | outline: 3px dashed #00f; |
| [7791](#L7791) | background: rgba(50, 140, 220, 0.2); |
| [7792](#L7792) | cursor: default; |
| [7793](#L7793) | } |
| [7794](#L7794) | .ai-selected { |
| [7795](#L7795) | outline: 3px dashed #f00; |
| [7796](#L7796) | background: rgba(255, 0, 0, 0.2); |
| [7797](#L7797) | } |
| [7798](#L7798) | .ai-highlighted.ai-selected { |
| [7799](#L7799) | } |
| [7800](#L7800) | .ai-html-element { |
| [7801](#L7801) | color: #00a; |
| [7802](#L7802) | cursor: pointer; |
| [7803](#L7803) | } |
| [7804](#L7804) | .ai-html-element:hover { |
| [7805](#L7805) | color: #00f; |
| [7806](#L7806) | } |
| [7807](#L7807) |  |
| [7808](#L7808) | #ai-selector-data .ui-button.ui-corner-all.ui-widget { |
| [7809](#L7809) | border: 1px solid #d3d3d3; |
| [7810](#L7810) | background: #e6e6e6 url(<?php echo plugins\_url ('css/images/ui-bg\_glass\_75\_e6e6e6\_1x400.png', \_\_FILE\_\_); ?>) 50% 50% repeat-x; |
| [7811](#L7811) | color: rgb(85, 85, 85); |
| [7812](#L7812) | } |
| [7813](#L7813) |  |
| [7814](#L7814) |  |
| [7815](#L7815) | <?php |
| [7816](#L7816) | } |
| [7817](#L7817) |  |
| [7818](#L7818) | function ai\_settings () { |
| [7819](#L7819) | global $ai\_db\_options, $block\_object, $wpdb, $ai\_db\_options\_extract; |
| [7820](#L7820) |  |
| [7821](#L7821) | if (is\_multisite() && !is\_main\_site () && !multisite\_settings\_page\_enabled ()) return; |
| [7822](#L7822) |  |
| [7823](#L7823) | if (!current\_user\_can ('manage\_options')) { |
| [7824](#L7824) | return; |
| [7825](#L7825) | } |
| [7826](#L7826) |  |
| [7827](#L7827) | $settings\_data\_valid = true; |
| [7828](#L7828) | if (function\_exists ('ai\_check\_remote\_connection')) { |
| [7829](#L7829) | if (!ai\_check\_remote\_connection ()) { |
| [7830](#L7830) | if (isset ($\_POST [AI\_FORM\_SAVE]) || |
| [7831](#L7831) | isset ($\_POST [AI\_FORM\_CLEAR]) || |
| [7832](#L7832) | isset ($\_POST [AI\_FORM\_CLEAR\_EXCEPTIONS]) || |
| [7833](#L7833) | isset ($\_POST [AI\_FORM\_CLEAR\_STATISTICS]) |
| [7834](#L7834) | ) { |
| [7835](#L7835) | // translators: %s: Ad Inserter |
| [7836](#L7836) | echo '<div class="notice notice-error is-dismissible" style="margin: 5px 15px 2px 0px;"><p>' . sprintf (\_\_('Invalid data received - %s settings not saved.', 'ad-inserter'), AD\_INSERTER\_NAME) . '</p></div>'; |
| [7837](#L7837) | } |
| [7838](#L7838) | $settings\_data\_valid = false; |
| [7839](#L7839) | } |
| [7840](#L7840) | } |
| [7841](#L7841) |  |
| [7842](#L7842) | if (isset ($\_POST [AI\_FORM\_SAVE]) && $settings\_data\_valid) { |
| [7843](#L7843) |  |
| [7844](#L7844) | check\_admin\_referer ('save\_adinserter\_settings'); |
| [7845](#L7845) |  |
| [7846](#L7846) | $subpage = 'main'; |
| [7847](#L7847) | $start =  1; |
| [7848](#L7848) | $end   = 16; |
| [7849](#L7849) |  |
| [7850](#L7850) | $button\_keys = array (AI\_FORM\_SAVE, AI\_FORM\_CLEAR\_EXCEPTIONS); |
| [7851](#L7851) |  |
| [7852](#L7852) | $settings\_ok = true; |
| [7853](#L7853) | $settings\_errors = array (); |
| [7854](#L7854) |  |
| [7855](#L7855) | if (isset ($\_GET ['start']) && is\_numeric ($start) && $start >= 1 && $start <= 96) $start = (int) $\_GET ['start']; else $start = 1; |
| [7856](#L7856) | $end = min ($start + 15, 96); |
| [7857](#L7857) |  |
| [7858](#L7858) | $invalid\_blocks = array (); |
| [7859](#L7859) |  |
| [7860](#L7860) | $import\_switch\_name = AI\_OPTION\_IMPORT . WP\_FORM\_FIELD\_POSTFIX . '0'; |
| [7861](#L7861) | if (isset ($\_POST [$import\_switch\_name]) && $\_POST [$import\_switch\_name] == "1") { |
| [7862](#L7862) | // Import Ad Inserter settings |
| [7863](#L7863) |  |
| [7864](#L7864) | $settings = str\_replace (array ("\\\""), array ("\""), $\_POST ["export\_settings\_0"]); |
| [7865](#L7865) | if (substr ($settings, 0, 4) === ':AI:') { |
| [7866](#L7866) | $settings = substr ($settings, 4); |
| [7867](#L7867) | } |
| [7868](#L7868) |  |
| [7869](#L7869) | $ai\_options = ai\_unserialize (base64\_decode ($settings)); |
| [7870](#L7870) |  |
| [7871](#L7871) | if ($ai\_options === false) { |
| [7872](#L7872) | // Use saved settings |
| [7873](#L7873) | $ai\_options = wp\_slash ($ai\_db\_options); |
| [7874](#L7874) | $invalid\_blocks []= 0; |
| [7875](#L7875) | $settings\_ok = false; |
| [7876](#L7876) | $settings\_errors []= 'Import plugin settings: unserialize failed'; |
| [7877](#L7877) | } else { |
| [7878](#L7878) | $ai\_options = wp\_slash ($ai\_options); |
| [7879](#L7879) |  |
| [7880](#L7880) | $history\_string = \_\_('plugin settings imported', 'ad-inserter'); |
| [7881](#L7881) | } |
| [7882](#L7882) | } else { |
| [7883](#L7883) | // Try to import individual settings |
| [7884](#L7884) | $ai\_options = array (); |
| [7885](#L7885) |  |
| [7886](#L7886) | $history\_string = sprintf (\_\_('blocks %d to %d', 'ad-inserter'), $start, $end); |
| [7887](#L7887) |  |
| [7888](#L7888) | $default\_block = new ai\_Block (1); |
| [7889](#L7889) | for ($block = 1; $block <= 96; $block ++) { |
| [7890](#L7890) | if (isset ($ai\_db\_options [$block])) $saved\_settings = wp\_slash ($ai\_db\_options [$block]); else |
| [7891](#L7891) | $saved\_settings = array (); |
| [7892](#L7892) |  |
| [7893](#L7893) | if ($block < $start || $block > $end) { |
| [7894](#L7894) | // Block not on the settings page |
| [7895](#L7895) | $ai\_options [$block] = $saved\_settings; |
| [7896](#L7896) | continue; |
| [7897](#L7897) | } |
| [7898](#L7898) |  |
| [7899](#L7899) | $import\_switch\_name      = AI\_OPTION\_IMPORT      . WP\_FORM\_FIELD\_POSTFIX . $block; |
| [7900](#L7900) | $import\_name\_switch\_name = AI\_OPTION\_IMPORT\_NAME . WP\_FORM\_FIELD\_POSTFIX . $block; |
| [7901](#L7901) | if (isset ($\_POST [$import\_switch\_name]) && $\_POST [$import\_switch\_name] == "1") { |
| [7902](#L7902) | // Try to import block settings |
| [7903](#L7903) | $exported\_settings = ai\_unserialize (base64\_decode (str\_replace (array ("\\\""), array ("\""), $\_POST ["export\_settings\_" . $block]))); |
| [7904](#L7904) |  |
| [7905](#L7905) | if ($exported\_settings !== false) { |
| [7906](#L7906) | $history\_string = sprintf (\_\_('block %d settings imported', 'ad-inserter'), $block); |
| [7907](#L7907) |  |
| [7908](#L7908) | $exported\_settings = wp\_slash ($exported\_settings); |
| [7909](#L7909) | foreach (array\_keys ($default\_block->wp\_options) as $key){ |
| [7910](#L7910) | if ($key == AI\_OPTION\_BLOCK\_NAME && isset ($\_POST [$import\_name\_switch\_name]) && $\_POST [$import\_name\_switch\_name] != "1") { |
| [7911](#L7911) | $form\_field\_name = $key . WP\_FORM\_FIELD\_POSTFIX . $block; |
| [7912](#L7912) | if (isset ($\_POST [$form\_field\_name])){ |
| [7913](#L7913) | $ai\_options [$block][$key] = filter\_option ($key, $\_POST [$form\_field\_name]); |
| [7914](#L7914) | } |
| [7915](#L7915) | } else { |
| [7916](#L7916) | if (isset ($exported\_settings [$key])) { |
| [7917](#L7917) | $ai\_options [$block][$key] = filter\_option ($key, $exported\_settings [$key], false); |
| [7918](#L7918) | } |
| [7919](#L7919) | } |
| [7920](#L7920) | } |
| [7921](#L7921) | } else { |
| [7922](#L7922) | // Block import failed - use existing settings |
| [7923](#L7923) | $ai\_options [$block] = $saved\_settings; |
| [7924](#L7924) | $invalid\_blocks []= $block; |
| [7925](#L7925) | } |
| [7926](#L7926) | } else { |
| [7927](#L7927) | // Process block settings |
| [7928](#L7928) | foreach (array\_keys ($default\_block->wp\_options) as $key){ |
| [7929](#L7929) | $form\_field\_name = $key . WP\_FORM\_FIELD\_POSTFIX . $block; |
| [7930](#L7930) | if (isset ($\_POST [$form\_field\_name])){ |
| [7931](#L7931) | $field\_value = $\_POST [$form\_field\_name]; |
| [7932](#L7932) |  |
| [7933](#L7933) | //                  if ($key == AI\_OPTION\_CODE && strpos ($field\_value, ':AI:') === 0) { |
| [7934](#L7934) | if ($key == AI\_OPTION\_CODE && substr ($field\_value, 0, 4) === ':AI:') { |
| [7935](#L7935) | $code = base64\_decode (substr ($field\_value, 4), true); |
| [7936](#L7936) |  |
| [7937](#L7937) | if ($code !== false) { |
| [7938](#L7938) | $field\_value = wp\_slash ($code); |
| [7939](#L7939) | } else { |
| [7940](#L7940) | $field\_value = ''; |
| [7941](#L7941) | $settings\_ok = false; |
| [7942](#L7942) | $settings\_errors []= "Block $block code: base64\_decode failed"; |
| [7943](#L7943) | } |
| [7944](#L7944) | } |
| [7945](#L7945) |  |
| [7946](#L7946) | $ai\_options [$block][$key] = filter\_option ($key, $field\_value); |
| [7947](#L7947) | } |
| [7948](#L7948) | } |
| [7949](#L7949) |  |
| [7950](#L7950) |  |
| [7951](#L7951) | if (!isset ($ai\_options [$block]) || count ($ai\_options [$block]) == 0) { |
| [7952](#L7952) | if (isset ($\_POST ['block-parameters-' . $block])) { |
| [7953](#L7953) | $block\_options = json\_decode (base64\_decode ($\_POST ['block-parameters-' . $block])); |
| [7954](#L7954) |  |
| [7955](#L7955) | if (is\_array ($block\_options)) { |
| [7956](#L7956) | foreach ($button\_keys as $button\_key) { |
| [7957](#L7957) | $button\_index = array\_search ($button\_key, $block\_options); |
| [7958](#L7958) | if ($button\_index !== false) { |
| [7959](#L7959) | unset ($block\_options [$button\_index]); |
| [7960](#L7960) | } |
| [7961](#L7961) | } |
| [7962](#L7962) |  |
| [7963](#L7963) | if (count ($block\_options) != 0) { |
| [7964](#L7964) | $settings\_ok = false; |
| [7965](#L7965) | $settings\_errors []= "Missing settings for block $block: " . implode (', ', $block\_options); |
| [7966](#L7966) | } |
| [7967](#L7967) | } else { |
| [7968](#L7968) | $settings\_ok = false; |
| [7969](#L7969) | $settings\_errors []= "Invalid parameter names for block $block"; |
| [7970](#L7970) | } |
| [7971](#L7971) | } else { |
| [7972](#L7972) | $settings\_ok = false; |
| [7973](#L7973) | $settings\_errors []= "Missing parameter names for block $block"; |
| [7974](#L7974) | } |
| [7975](#L7975) | } |
| [7976](#L7976) | } |
| [7977](#L7977) |  |
| [7978](#L7978) | delete\_option (str\_replace ("#", $block, AD\_ADx\_OPTIONS)); |
| [7979](#L7979) | } |
| [7980](#L7980) |  |
| [7981](#L7981) | $default\_block\_H  = new ai\_AdH(); |
| [7982](#L7982) | $wp\_options = array (); |
| [7983](#L7983) | foreach(array\_keys ($default\_block\_H->wp\_options) as $key){ |
| [7984](#L7984) | $form\_field\_name = $key . WP\_FORM\_FIELD\_POSTFIX . AI\_HEADER\_OPTION\_NAME; |
| [7985](#L7985) | if(isset ($\_POST [$form\_field\_name])){ |
| [7986](#L7986) | $field\_value = $\_POST [$form\_field\_name]; |
| [7987](#L7987) |  |
| [7988](#L7988) | if ($key == AI\_OPTION\_CODE && strpos ($field\_value, ':AI:') === 0) { |
| [7989](#L7989) | $code = base64\_decode (substr ($field\_value, 4), true); |
| [7990](#L7990) | if ($code !== false) { |
| [7991](#L7991) | $field\_value = wp\_slash ($code); |
| [7992](#L7992) | } else { |
| [7993](#L7993) | $field\_value = ''; |
| [7994](#L7994) | $settings\_ok = false; |
| [7995](#L7995) | $settings\_errors []= "Header code: base64\_decode failed"; |
| [7996](#L7996) | } |
| [7997](#L7997) | } |
| [7998](#L7998) |  |
| [7999](#L7999) | $wp\_options [$key] = filter\_option\_hf ($key, $field\_value); |
| [8000](#L8000) | } |
| [8001](#L8001) | } |
| [8002](#L8002) | $ai\_options [AI\_HEADER\_OPTION\_NAME] = $wp\_options; |
| [8003](#L8003) |  |
| [8004](#L8004) | $default\_block\_F  = new ai\_AdF(); |
| [8005](#L8005) | $wp\_options = array (); |
| [8006](#L8006) | foreach(array\_keys($default\_block\_F->wp\_options) as $key){ |
| [8007](#L8007) | $form\_field\_name = $key . WP\_FORM\_FIELD\_POSTFIX . AI\_FOOTER\_OPTION\_NAME; |
| [8008](#L8008) | if(isset ($\_POST [$form\_field\_name])){ |
| [8009](#L8009) | $field\_value = $\_POST [$form\_field\_name]; |
| [8010](#L8010) |  |
| [8011](#L8011) | if ($key == AI\_OPTION\_CODE && strpos ($field\_value, ':AI:') === 0) { |
| [8012](#L8012) | $code = base64\_decode (substr ($field\_value, 4), true); |
| [8013](#L8013) | if ($code !== false) { |
| [8014](#L8014) | $field\_value = wp\_slash ($code); |
| [8015](#L8015) | } else { |
| [8016](#L8016) | $field\_value = ''; |
| [8017](#L8017) | $settings\_ok = false; |
| [8018](#L8018) | $settings\_errors []= "Footer code: base64\_decode failed"; |
| [8019](#L8019) | } |
| [8020](#L8020) |  |
| [8021](#L8021) | } |
| [8022](#L8022) |  |
| [8023](#L8023) | $wp\_options [$key] = filter\_option\_hf ($key, $field\_value); |
| [8024](#L8024) | } |
| [8025](#L8025) | } |
| [8026](#L8026) | $ai\_options [AI\_FOOTER\_OPTION\_NAME] = $wp\_options; |
| [8027](#L8027) |  |
| [8028](#L8028) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [8029](#L8029) | $default\_block\_A  = new ai\_AdA(); |
| [8030](#L8030) | $wp\_options = array (); |
| [8031](#L8031) | foreach(array\_keys($default\_block\_A->wp\_options) as $key){ |
| [8032](#L8032) | $form\_field\_name = $key . WP\_FORM\_FIELD\_POSTFIX . AI\_ADB\_MESSAGE\_OPTION\_NAME; |
| [8033](#L8033) | if(isset ($\_POST [$form\_field\_name])){ |
| [8034](#L8034) | $field\_value = $\_POST [$form\_field\_name]; |
| [8035](#L8035) |  |
| [8036](#L8036) | if ($key == AI\_OPTION\_CODE && strpos ($field\_value, ':AI:') === 0) { |
| [8037](#L8037) | $code = base64\_decode (substr ($field\_value, 4), true); |
| [8038](#L8038) | if ($code !== false) { |
| [8039](#L8039) | $field\_value = wp\_slash ($code); |
| [8040](#L8040) | } else { |
| [8041](#L8041) | $field\_value = ''; |
| [8042](#L8042) | $settings\_ok = false; |
| [8043](#L8043) | $settings\_errors []= "Ad blocking message code: base64\_decode failed"; |
| [8044](#L8044) | } |
| [8045](#L8045) | } |
| [8046](#L8046) |  |
| [8047](#L8047) | $wp\_options [$key] = filter\_option\_hf ($key, $field\_value); |
| [8048](#L8048) | } |
| [8049](#L8049) | } |
| [8050](#L8050) | $ai\_options [AI\_ADB\_MESSAGE\_OPTION\_NAME]  = $wp\_options; |
| [8051](#L8051) | } |
| [8052](#L8052) |  |
| [8053](#L8053) | $options = array (); |
| [8054](#L8054) |  |
| [8055](#L8055) | $ai\_options = apply\_filters ('ai\_save\_settings', $ai\_options); |
| [8056](#L8056) |  |
| [8057](#L8057) | if (function\_exists ('ai\_filter\_global\_settings')) ai\_filter\_global\_settings ($options); |
| [8058](#L8058) |  |
| [8059](#L8059) | if (isset ($\_POST ['syntax-highlighter-theme']))            $options ['SYNTAX\_HIGHLIGHTER\_THEME']     = filter\_string ($\_POST ['syntax-highlighter-theme']); |
| [8060](#L8060) | if (isset ($\_POST ['block-class-name']))                    $options ['BLOCK\_CLASS\_NAME']             = filter\_html\_class ($\_POST ['block-class-name']); |
| [8061](#L8061) | if (isset ($\_POST ['block-class']))                         $options ['BLOCK\_CLASS']                  = filter\_option ('BLOCK\_CLASS',                   $\_POST ['block-class']); |
| [8062](#L8062) | if (isset ($\_POST ['block-number-class']))                  $options ['BLOCK\_NUMBER\_CLASS']           = filter\_option ('BLOCK\_NUMBER\_CLASS',            $\_POST ['block-number-class']); |
| [8063](#L8063) | if (isset ($\_POST ['block-name-class']))                    $options ['BLOCK\_NAME\_CLASS']             = filter\_option ('BLOCK\_NAME\_CLASS',              $\_POST ['block-name-class']); |
| [8064](#L8064) | if (isset ($\_POST ['inline-styles']))                       $options ['INLINE\_STYLES']                = filter\_option ('INLINE\_STYLES',                 $\_POST ['inline-styles']); |
| [8065](#L8065) | if (isset ($\_POST ['minimum-user-role']))                   $options ['MINIMUM\_USER\_ROLE']            = filter\_string ($\_POST ['minimum-user-role']); |
| [8066](#L8066) | if (isset ($\_POST ['sticky-widget-mode']))                  $options ['STICKY\_WIDGET\_MODE']           = filter\_option ('STICKY\_WIDGET\_MODE',            $\_POST ['sticky-widget-mode']); |
| [8067](#L8067) | if (isset ($\_POST ['sticky-widget-margin']))                $options ['STICKY\_WIDGET\_MARGIN']         = filter\_option ('STICKY\_WIDGET\_MARGIN',          $\_POST ['sticky-widget-margin']); |
| [8068](#L8068) | if (isset ($\_POST ['lazy-loading-offset']))                 $options ['LAZY\_LOADING\_OFFSET']          = filter\_option ('LAZY\_LOADING\_OFFSET',           $\_POST ['lazy-loading-offset']); |
| [8069](#L8069) | if (isset ($\_POST ['cfp']))                                 $options ['CLICK\_FRAUD\_PROTECTION']       = filter\_option ('CLICK\_FRAUD\_PROTECTION',        $\_POST ['cfp']); |
| [8070](#L8070) | if (isset ($\_POST ['cfp-time']))                            $options ['CLICK\_FRAUD\_PROTECTION\_TIME']  = filter\_option ('CLICK\_FRAUD\_PROTECTION\_TIME',   $\_POST ['cfp-time']); |
| [8071](#L8071) | if (isset ($\_POST ['global-visitor-limit-cpt']))            $options ['GLOBAL\_VISITOR\_LIMIT\_CPT']     = filter\_option ('GLOBAL\_VISITOR\_LIMIT\_CPT',      $\_POST ['global-visitor-limit-cpt']); |
| [8072](#L8072) | if (isset ($\_POST ['global-visitor-limit-time']))           $options ['GLOBAL\_VISITOR\_LIMIT\_TIME']    = filter\_option ('GLOBAL\_VISITOR\_LIMIT\_TIME',     $\_POST ['global-visitor-limit-time']); |
| [8073](#L8073) | if (isset ($\_POST ['cfp-block-ip-address']))                $options ['CFP\_BLOCK\_IP\_ADDRESS']         = filter\_option ('CFP\_BLOCK\_IP\_ADDRESS',          $\_POST ['cfp-block-ip-address']); |
| [8074](#L8074) | if (isset ($\_POST ['max-page-blocks']))                     $options ['MAX\_PAGE\_BLOCKS']              = filter\_option ('MAX\_PAGE\_BLOCKS',               $\_POST ['max-page-blocks']); |
| [8075](#L8075) | if (isset ($\_POST ['plugin\_priority']))                     $options ['PLUGIN\_PRIORITY']              = filter\_option ('PLUGIN\_PRIORITY',               $\_POST ['plugin\_priority']); |
| [8076](#L8076) | if (isset ($\_POST ['max-list-items']))                      $options ['MAX\_LIST\_ITEMS']               = filter\_option ('MAX\_LIST\_ITEMS',                $\_POST ['max-list-items']); |
| [8077](#L8077) | if (isset ($\_POST ['tab-setup-delay']))                     $options ['TAB\_SETUP\_DELAY']              = filter\_option ('TAB\_SETUP\_DELAY',               $\_POST ['tab-setup-delay']); |
| [8078](#L8078) | if (isset ($\_POST ['dynamic\_blocks']))                      $options ['DYNAMIC\_BLOCKS']               = filter\_option ('DYNAMIC\_BLOCKS',                $\_POST ['dynamic\_blocks']); |
| [8079](#L8079) | if (isset ($\_POST ['paragraph\_counting\_functions']))        $options ['PARAGRAPH\_COUNTING\_FUNCTIONS'] = filter\_option ('PARAGRAPH\_COUNTING\_FUNCTIONS',  $\_POST ['paragraph\_counting\_functions']); |
| [8080](#L8080) | if (isset ($\_POST ['output-buffering']))                    $options ['OUTPUT\_BUFFERING']             = filter\_option ('OUTPUT\_BUFFERING',              $\_POST ['output-buffering']); |
| [8081](#L8081) | if (isset ($\_POST ['disable-caching-admin']))               $options ['DISABLE\_CACHING']              = filter\_option ('DISABLE\_CACHING',               $\_POST ['disable-caching-admin']); |
| [8082](#L8082) | if (isset ($\_POST ['menu-for-link']))                       $options ['MENU\_FOR\_LINK']                = filter\_option ('MENU\_FOR\_LINK',                 $\_POST ['menu-for-link']); |
| [8083](#L8083) | if (isset ($\_POST ['wait-for-jquery']))                     $options ['WAIT\_FOR\_JQUERY']              = filter\_option ('WAIT\_FOR\_JQUERY',               $\_POST ['wait-for-jquery']); |
| [8084](#L8084) | if (isset ($\_POST ['javascript-code']))                     $options ['JAVASCRIPT\_CODE\_MODE']         = filter\_option ('JAVASCRIPT\_CODE\_MODE',          $\_POST ['javascript-code']); |
| [8085](#L8085) | if (isset ($\_POST ['no-paragraph-counting-inside']))        $options ['NO\_PARAGRAPH\_COUNTING\_INSIDE'] = filter\_option ('NO\_PARAGRAPH\_COUNTING\_INSIDE',  $\_POST ['no-paragraph-counting-inside']); |
| [8086](#L8086) | if (isset ($\_POST ['ad-label']))                            $options ['AD\_LABEL']                     = filter\_option ('AD\_LABEL',                      $\_POST ['ad-label']); |
| [8087](#L8087) | if (isset ($\_POST ['main-content-element']))                $options ['MAIN\_CONTENT\_ELEMENT']         = filter\_option ('MAIN\_CONTENT\_ELEMENT',          $\_POST ['main-content-element']); |
| [8088](#L8088) | if (isset ($\_POST [AI\_OPTION\_ADB\_DEVICES]))                 $options ['ADB\_DEVICES']                  = filter\_option ('ADB\_DEVICES',                   $\_POST [AI\_OPTION\_ADB\_DEVICES]); |
| [8089](#L8089) | if (isset ($\_POST [AI\_OPTION\_ADB\_ACTION]))                  $options ['ADB\_ACTION']                   = filter\_option ('ADB\_ACTION',                    $\_POST [AI\_OPTION\_ADB\_ACTION]); |
| [8090](#L8090) | if (isset ($\_POST [AI\_OPTION\_ADB\_NO\_ACTION]))               $options ['ADB\_NO\_ACTION']                = filter\_option ('ADB\_NO\_ACTION',                 $\_POST [AI\_OPTION\_ADB\_NO\_ACTION]); |
| [8091](#L8091) | if (isset ($\_POST [AI\_OPTION\_ADB\_DELAY\_ACTION]))            $options ['ADB\_DELAY\_ACTION']             = filter\_option ('ADB\_DELAY\_ACTION',              $\_POST [AI\_OPTION\_ADB\_DELAY\_ACTION]); |
| [8092](#L8092) | if (isset ($\_POST [AI\_OPTION\_ADB\_NO\_ACTION\_PERIOD]))        $options ['ADB\_NO\_ACTION\_PERIOD']         = filter\_option ('ADB\_NO\_ACTION\_PERIOD',          $\_POST [AI\_OPTION\_ADB\_NO\_ACTION\_PERIOD]); |
| [8093](#L8093) | if (isset ($\_POST [AI\_OPTION\_ADB\_SELECTORS]))               $options ['ADB\_SELECTORS']                = filter\_option ('ADB\_SELECTORS',                 $\_POST [AI\_OPTION\_ADB\_SELECTORS]); |
| [8094](#L8094) | if (isset ($\_POST [AI\_OPTION\_ADB\_REDIRECTION\_PAGE]))        $options ['ADB\_REDIRECTION\_PAGE']         = filter\_option ('ADB\_REDIRECTION\_PAGE',          $\_POST [AI\_OPTION\_ADB\_REDIRECTION\_PAGE]); |
| [8095](#L8095) | if (isset ($\_POST [AI\_OPTION\_ADB\_CUSTOM\_REDIRECTION\_URL]))  $options ['ADB\_CUSTOM\_REDIRECTION\_URL']   = filter\_option ('ADB\_CUSTOM\_REDIRECTION\_URL',    $\_POST [AI\_OPTION\_ADB\_CUSTOM\_REDIRECTION\_URL]); |
| [8096](#L8096) | if (isset ($\_POST [AI\_OPTION\_ADB\_MESSAGE\_CSS]))             $options ['ADB\_MESSAGE\_CSS']              = filter\_option ('ADB\_MESSAGE\_CSS',               $\_POST [AI\_OPTION\_ADB\_MESSAGE\_CSS]); |
| [8097](#L8097) | if (isset ($\_POST [AI\_OPTION\_ADB\_OVERLAY\_CSS]))             $options ['ADB\_OVERLAY\_CSS']              = filter\_option ('ADB\_OVERLAY\_CSS',               $\_POST [AI\_OPTION\_ADB\_OVERLAY\_CSS]); |
| [8098](#L8098) | if (isset ($\_POST [AI\_OPTION\_ADB\_UNDISMISSIBLE\_MESSAGE]))   $options ['ADB\_UNDISMISSIBLE\_MESSAGE']    = filter\_option ('ADB\_UNDISMISSIBLE\_MESSAGE',     $\_POST [AI\_OPTION\_ADB\_UNDISMISSIBLE\_MESSAGE]); |
| [8099](#L8099) | if (isset ($\_POST [AI\_OPTION\_ADB\_EXTERNAL\_SCRIPTS]))        $options ['ADB\_EXTERNAL\_SCRIPTS']         = filter\_option ('ADB\_EXTERNAL\_SCRIPTS',          $\_POST [AI\_OPTION\_ADB\_EXTERNAL\_SCRIPTS]); |
| [8100](#L8100) | if (isset ($\_POST [AI\_OPTION\_ADB\_NO\_UNDISMISSIBLE\_MESSAGE]))$options ['ADB\_NO\_UNDISMISSIBLE\_MESSAGE'] = filter\_option ('ADB\_NO\_UNDISMISSIBLE\_MESSAGE',  $\_POST [AI\_OPTION\_ADB\_NO\_UNDISMISSIBLE\_MESSAGE]); |
| [8101](#L8101) | if (isset ($\_POST ['force\_admin\_toolbar']))                 $options ['FORCE\_ADMIN\_TOOLBAR']          = filter\_option ('FORCE\_ADMIN\_TOOLBAR',           $\_POST ['force\_admin\_toolbar']); |
| [8102](#L8102) | if (isset ($\_POST ['admin\_toolbar\_debugging']))             $options ['ADMIN\_TOOLBAR\_DEBUGGING']      = filter\_option ('ADMIN\_TOOLBAR\_DEBUGGING',       $\_POST ['admin\_toolbar\_debugging']); |
| [8103](#L8103) | if (isset ($\_POST ['admin\_toolbar\_mobile']))                $options ['ADMIN\_TOOLBAR\_MOBILE']         = filter\_option ('ADMIN\_TOOLBAR\_MOBILE',          $\_POST ['admin\_toolbar\_mobile']); |
| [8104](#L8104) | if (isset ($\_POST ['remote\_debugging']))                    $options ['REMOTE\_DEBUGGING']             = filter\_option ('REMOTE\_DEBUGGING',              $\_POST ['remote\_debugging']); |
| [8105](#L8105) | if (isset ($\_POST ['disable\_translation']))                 $options ['DISABLE\_TRANSLATION']          = filter\_option ('DISABLE\_TRANSLATION',           $\_POST ['disable\_translation']); |
| [8106](#L8106) | if (isset ($\_POST ['backend\_js\_debugging']))                $options ['BACKEND\_JS\_DEBUGGING']         = filter\_option ('BACKEND\_JS\_DEBUGGING',          $\_POST ['backend\_js\_debugging']); |
| [8107](#L8107) | if (isset ($\_POST ['frontend\_js\_debugging']))               $options ['FRONTEND\_JS\_DEBUGGING']        = filter\_option ('FRONTEND\_JS\_DEBUGGING',         $\_POST ['frontend\_js\_debugging']); |
| [8108](#L8108) | if (isset ($\_POST ['disable-blocks']))                      $options ['DISABLE\_BLOCK\_INSERTIONS']     = filter\_option ('DISABLE\_BLOCK\_INSERTIONS',      $\_POST ['disable-blocks']); |
| [8109](#L8109) | if (isset ($\_POST ['disable-php-processing']))              $options ['DISABLE\_PHP\_PROCESSING']       = filter\_option ('DISABLE\_PHP\_PROCESSING',        $\_POST ['disable-php-processing']); |
| [8110](#L8110) | if (isset ($\_POST ['disable-html-code']))                   $options ['DISABLE\_HTML\_CODE']            = filter\_option ('DISABLE\_HTML\_CODE',             $\_POST ['disable-html-code']); |
| [8111](#L8111) | if (isset ($\_POST ['disable-css-code']))                    $options ['DISABLE\_CSS\_CODE']             = filter\_option ('DISABLE\_CSS\_CODE',              $\_POST ['disable-css-code']); |
| [8112](#L8112) | if (isset ($\_POST ['disable-js-code']))                     $options ['DISABLE\_JS\_CODE']              = filter\_option ('DISABLE\_JS\_CODE',               $\_POST ['disable-js-code']); |
| [8113](#L8113) | if (isset ($\_POST ['disable-footer-code']))                 $options ['DISABLE\_FOOTER\_CODE']          = filter\_option ('DISABLE\_FOOTER\_CODE',           $\_POST ['disable-footer-code']); |
| [8114](#L8114) | if (isset ($\_POST ['disable-header-code']))                 $options ['DISABLE\_HEADER\_CODE']          = filter\_option ('DISABLE\_HEADER\_CODE',           $\_POST ['disable-header-code']); |
| [8115](#L8115) |  |
| [8116](#L8116) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [8117](#L8117) | if (isset ($\_POST ['viewport-name-'.$viewport]))  $options ['VIEWPORT\_NAME\_'.$viewport]   = filter\_string ($\_POST ['viewport-name-'.$viewport]); |
| [8118](#L8118) | if (isset ($\_POST ['viewport-width-'.$viewport])) $options ['VIEWPORT\_WIDTH\_'.$viewport]  = filter\_option ('viewport\_width', $\_POST ['viewport-width-'.$viewport]); |
| [8119](#L8119) | } |
| [8120](#L8120) |  |
| [8121](#L8121) | for ($constant = 1; $constant <= 6; $constant ++) { |
| [8122](#L8122) | if (isset ($\_POST ['constant-name-'.$constant]))  $options ['CONSTANT\_NAME\_'.$constant]   = filter\_string ($\_POST ['constant-name-'.$constant]); |
| [8123](#L8123) | if (isset ($\_POST ['constant-value-'.$constant])) $options ['CONSTANT\_VALUE\_'.$constant]  = filter\_string ($\_POST ['constant-value-'.$constant]); |
| [8124](#L8124) | } |
| [8125](#L8125) |  |
| [8126](#L8126) | for ($hook = 1; $hook <= 20; $hook ++) { |
| [8127](#L8127) | if (isset ($\_POST ['hook-enabled-'.$hook]))  $options ['HOOK\_ENABLED\_'.$hook]   = filter\_option ('HOOK\_ENABLED', $\_POST ['hook-enabled-'.$hook]); |
| [8128](#L8128) | if (isset ($\_POST ['hook-name-'.$hook]))     $options ['HOOK\_NAME\_'.$hook]      = filter\_string\_tags ($\_POST ['hook-name-'.$hook]); |
| [8129](#L8129) | if (isset ($\_POST ['hook-action-'.$hook]))   $options ['HOOK\_ACTION\_'.$hook]    = filter\_string ($\_POST ['hook-action-'.$hook]); |
| [8130](#L8130) | if (isset ($\_POST ['hook-priority-'.$hook])) $options ['HOOK\_PRIORITY\_'.$hook]  = filter\_option ('HOOK\_PRIORITY', $\_POST ['hook-priority-'.$hook]); |
| [8131](#L8131) | } |
| [8132](#L8132) |  |
| [8133](#L8133) | $ai\_options [AI\_OPTION\_GLOBAL] = ai\_check\_plugin\_options ($options); |
| [8134](#L8134) | } |
| [8135](#L8135) |  |
| [8136](#L8136) | if (!empty ($invalid\_blocks)) { |
| [8137](#L8137) | if ($invalid\_blocks [0] == 0) {                                                               // translators: %s: Ad Inserter |
| [8138](#L8138) | echo '<div class="notice notice-error is-dismissible" style="margin: 5px 15px 2px 0px;"><p>'. sprintf (\_\_('Error importing %s settings.', 'ad-inserter'), AD\_INSERTER\_NAME) . '</p></div>'; |
| [8139](#L8139) | } else echo '<div class="notice notice-error is-dismissible" style="margin: 5px 15px 2px 0px;"><p>'. \_n('Error importing settings for block', 'Error importing settings for blocks:', count ($invalid\_blocks), 'ad-inserter') , ' ', implode (', ', $invalid\_blocks) . '</p></div>'; |
| [8140](#L8140) | } |
| [8141](#L8141) |  |
| [8142](#L8142) | if ($settings\_ok) { |
| [8143](#L8143) |  |
| [8144](#L8144) | // Multisite |
| [8145](#L8145) | $multisite\_options = array (); |
| [8146](#L8146) | if (function\_exists ('ai\_filter\_multisite\_settings')) ai\_filter\_multisite\_settings ($multisite\_options); |
| [8147](#L8147) | ai\_check\_multisite\_options ($multisite\_options); |
| [8148](#L8148) |  |
| [8149](#L8149) | ai\_save\_options ($ai\_options, $multisite\_options); |
| [8150](#L8150) |  |
| [8151](#L8151) | if (function\_exists ('ai\_load\_globals')) ai\_load\_globals (); |
| [8152](#L8152) |  |
| [8153](#L8153) | if (defined ('AI\_PLUGIN\_TRACKING') && AI\_PLUGIN\_TRACKING) { |
| [8154](#L8154) | if (isset ($\_POST ['plugin-usage-tracking'])) { |
| [8155](#L8155) | global $ai\_dst; |
| [8156](#L8156) | if (isset ($ai\_dst) && is\_object ($ai\_dst)) { |
| [8157](#L8157) | $ai\_dst->set\_tracking ((bool) $\_POST ['plugin-usage-tracking']); |
| [8158](#L8158) | } |
| [8159](#L8159) | } |
| [8160](#L8160) | } |
| [8161](#L8161) |  |
| [8162](#L8162) | echo '<div class="notice notice-success is-dismissible" style="margin: 5px 15px 2px 0px;"><p>' . \_\_('Settings saved.', 'ad-inserter') . '</p></div>'; |
| [8163](#L8163) |  |
| [8164](#L8164) | apply\_filters ('simple\_history\_log', AD\_INSERTER\_NAME . ' ' . \_\_('settings saved', 'ad-inserter') . ' (' . $history\_string . ')'); |
| [8165](#L8165) | } else {                                                                                                    // translators: %s: Ad Inserter |
| [8166](#L8166) | echo '<div class="notice notice-error is-dismissible" style="margin: 5px 15px 2px 0px;"><p>' . sprintf (\_\_('Invalid data received - %s settings not saved.', 'ad-inserter'), AD\_INSERTER\_NAME) . '</p>'; |
| [8167](#L8167) | if (!empty ($settings\_errors)) { |
| [8168](#L8168) | foreach ($settings\_errors as $settings\_error) { |
| [8169](#L8169) | echo '<div>', $settings\_error, '</div>'; |
| [8170](#L8170) | } |
| [8171](#L8171) | } |
| [8172](#L8172) | echo '</div>'; |
| [8173](#L8173) | } |
| [8174](#L8174) | } elseif (isset ($\_POST [AI\_FORM\_CLEAR]) && $settings\_data\_valid) { |
| [8175](#L8175) |  |
| [8176](#L8176) | check\_admin\_referer ('save\_adinserter\_settings'); |
| [8177](#L8177) |  |
| [8178](#L8178) | if (function\_exists ('ai\_clear\_settings\_2')) { |
| [8179](#L8179) | $remote\_cleared = ai\_clear\_settings\_2 (); |
| [8180](#L8180) | } else $remote\_cleared = false; |
| [8181](#L8181) |  |
| [8182](#L8182) | if (!$remote\_cleared) { |
| [8183](#L8183) | ai\_clear\_settings (); |
| [8184](#L8184) | } |
| [8185](#L8185) |  |
| [8186](#L8186) | echo '<div class="notice notice-warning is-dismissible" style="margin: 5px 15px 2px 0px;"><p><strong>' . \_\_('Settings cleared.', 'ad-inserter') . '</strong></p></div>'; |
| [8187](#L8187) |  |
| [8188](#L8188) | apply\_filters ('simple\_history\_log', AD\_INSERTER\_NAME . ' ' . \_\_('settings cleared', 'ad-inserter')); |
| [8189](#L8189) | } elseif (isset ($\_POST [AI\_FORM\_CLEAR\_EXCEPTIONS]) && $settings\_data\_valid) { |
| [8190](#L8190) |  |
| [8191](#L8191) | check\_admin\_referer ('save\_adinserter\_settings'); |
| [8192](#L8192) |  |
| [8193](#L8193) | if (ai\_current\_user\_role\_ok () && (!is\_multisite() || is\_main\_site () || multisite\_exceptions\_enabled ())) { |
| [8194](#L8194) |  |
| [8195](#L8195) | if (function\_exists ('ai\_clear\_exceptions\_2')) { |
| [8196](#L8196) | $remote\_cleared = ai\_clear\_exceptions\_2 (); |
| [8197](#L8197) | } else $remote\_cleared = false; |
| [8198](#L8198) |  |
| [8199](#L8199) | if (!$remote\_cleared) { |
| [8200](#L8200) | ai\_clear\_exceptions (); |
| [8201](#L8201) | } |
| [8202](#L8202) | } |
| [8203](#L8203) | } elseif (isset ($\_POST [AI\_FORM\_CLEAR\_STATISTICS]) && is\_numeric ($\_POST [AI\_FORM\_CLEAR\_STATISTICS]) && $settings\_data\_valid) { |
| [8204](#L8204) |  |
| [8205](#L8205) | check\_admin\_referer ('save\_adinserter\_settings'); |
| [8206](#L8206) |  |
| [8207](#L8207) | if (function\_exists ('ai\_clear\_statistics\_2')) { |
| [8208](#L8208) | $remote\_cleared = ai\_clear\_statistics\_2 (); |
| [8209](#L8209) | } else $remote\_cleared = false; |
| [8210](#L8210) |  |
| [8211](#L8211) | if (!$remote\_cleared) { |
| [8212](#L8212) | ai\_clear\_statistics (); |
| [8213](#L8213) | } |
| [8214](#L8214) | } |
| [8215](#L8215) |  |
| [8216](#L8216) | generate\_settings\_form (); |
| [8217](#L8217) | } |
| [8218](#L8218) |  |
| [8219](#L8219) |  |
| [8220](#L8220) | function ai\_adinserter ($block\_parameter, $options, &$block) { |
| [8221](#L8221) | global $block\_object, $ad\_inserter\_globals, $ai\_wp\_data, $ai\_last\_check; |
| [8222](#L8222) |  |
| [8223](#L8223) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8224](#L8224) |  |
| [8225](#L8225) | if ($block\_parameter == "") return ""; |
| [8226](#L8226) | $block\_number = $block\_parameter; |
| [8227](#L8227) |  |
| [8228](#L8228) | if (!is\_numeric ($block\_parameter)) { |
| [8229](#L8229) | $function\_block\_parameter = strtolower ($block\_parameter); |
| [8230](#L8230) | for ($counter = 1; $counter <= 96; $counter ++) { |
| [8231](#L8231) | $obj = $block\_object [$counter]; |
| [8232](#L8232) | $ad\_name = strtolower (trim ($obj->get\_ad\_name())); |
| [8233](#L8233) | if ($function\_block\_parameter == $ad\_name) { |
| [8234](#L8234) | $block\_number = $counter; |
| [8235](#L8235) | break; |
| [8236](#L8236) | } |
| [8237](#L8237) | } |
| [8238](#L8238) | } |
| [8239](#L8239) |  |
| [8240](#L8240) | if (!is\_numeric ($block\_number)) return ""; |
| [8241](#L8241) |  |
| [8242](#L8242) | $block = (int) $block\_number; |
| [8243](#L8243) |  |
| [8244](#L8244) | if ($block < 1 || $block > 96) return ""; |
| [8245](#L8245) |  |
| [8246](#L8246) | $globals\_name = AI\_PHP\_FUNCTION\_CALL\_COUNTER\_NAME . $block; |
| [8247](#L8247) |  |
| [8248](#L8248) | if (!isset ($ad\_inserter\_globals [$globals\_name])) { |
| [8249](#L8249) | $ad\_inserter\_globals [$globals\_name] = 1; |
| [8250](#L8250) | } else $ad\_inserter\_globals [$globals\_name] ++; |
| [8251](#L8251) |  |
| [8252](#L8252) | if ($debug\_processing) ai\_log ("PHP FUNCTION CALL adinserter ($block\_parameter".($options == '' ? '' : (', \''.$options.'\''))."), block $block [" . $ad\_inserter\_globals [$globals\_name] . ']'); |
| [8253](#L8253) |  |
| [8254](#L8254) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_PHP\_FUNCTION; |
| [8255](#L8255) |  |
| [8256](#L8256) | $options\_array = array (); |
| [8257](#L8257) | if (trim ($options) != '') { |
| [8258](#L8258) | $options\_array = explode (",", str\_replace (" ", "", $options)); |
| [8259](#L8259) |  |
| [8260](#L8260) | if (in\_array ("server-side", $options\_array)) { |
| [8261](#L8261) | $ai\_wp\_data [AI\_DYNAMIC\_BLOCKS] = AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE; |
| [8262](#L8262) | } |
| [8263](#L8263) | elseif (in\_array ("client-side-show", $options\_array)) { |
| [8264](#L8264) | $ai\_wp\_data [AI\_DYNAMIC\_BLOCKS] = AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_SHOW; |
| [8265](#L8265) | } |
| [8266](#L8266) | elseif (in\_array ("client-side-insert", $options\_array)) { |
| [8267](#L8267) | $ai\_wp\_data [AI\_DYNAMIC\_BLOCKS] = AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT; |
| [8268](#L8268) | } |
| [8269](#L8269) | elseif (in\_array ("server-side-w3c", $options\_array)) { |
| [8270](#L8270) | $ai\_wp\_data [AI\_DYNAMIC\_BLOCKS] = AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE\_W3TC; |
| [8271](#L8271) | } |
| [8272](#L8272) | } |
| [8273](#L8273) |  |
| [8274](#L8274) | $obj = $block\_object [$block]; |
| [8275](#L8275) | $obj->clear\_code\_cache (); |
| [8276](#L8276) |  |
| [8277](#L8277) | $ai\_last\_check = AI\_CHECK\_ENABLED\_PHP; |
| [8278](#L8278) | if (!$obj->get\_enable\_php\_call ()) return ""; |
| [8279](#L8279) | if (!$obj->check\_server\_side\_detection ()) return ""; |
| [8280](#L8280) | /\* Deprecated \*/ |
| [8281](#L8281) | if (!$obj->check\_page\_types\_lists\_users (in\_array ("page-type", $options\_array) || in\_array ("ignore-page-type", $options\_array))) return ""; |
| [8282](#L8282) | if (!$obj->check\_filter ($ad\_inserter\_globals [$globals\_name])) return ""; |
| [8283](#L8283) | if (!$obj->check\_number\_of\_words ()) return ""; |
| [8284](#L8284) |  |
| [8285](#L8285) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [8286](#L8286) | //    $meta\_value = get\_post\_meta (get\_the\_ID (), '\_adinserter\_block\_exceptions', true); |
| [8287](#L8287) | $meta\_value = ai\_get\_post\_meta (); |
| [8288](#L8288) |  |
| [8289](#L8289) | $selected\_blocks = explode (",", $meta\_value); |
| [8290](#L8290) |  |
| [8291](#L8291) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) return ""; |
| [8292](#L8292) | } |
| [8293](#L8293) |  |
| [8294](#L8294) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [8295](#L8295) | if (!$obj->check\_disabled ()) return ""; |
| [8296](#L8296) |  |
| [8297](#L8297) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [8298](#L8298) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) return ""; |
| [8299](#L8299) |  |
| [8300](#L8300) | // Last check before counter check before insertion |
| [8301](#L8301) | //  $ai\_last\_check = AI\_CHECK\_CODE; |
| [8302](#L8302) | //  if ($obj->ai\_getCode () == '') return ""; |
| [8303](#L8303) | if ($obj->empty\_code ()) return ""; |
| [8304](#L8304) |  |
| [8305](#L8305) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [8306](#L8306) |  |
| [8307](#L8307) | if ($max\_page\_blocks\_enabled) { |
| [8308](#L8308) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [8309](#L8309) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) return ""; |
| [8310](#L8310) | } |
| [8311](#L8311) |  |
| [8312](#L8312) | if (!$obj->check\_filter\_hook ($debug\_processing)) return ""; |
| [8313](#L8313) |  |
| [8314](#L8314) | // Last check before insertion |
| [8315](#L8315) | if (!$obj->check\_and\_increment\_block\_counter ()) return ""; |
| [8316](#L8316) |  |
| [8317](#L8317) | // Increment page block counter |
| [8318](#L8318) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [8319](#L8319) |  |
| [8320](#L8320) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [8321](#L8321) | if ($obj->get\_debug\_disable\_insertion ()) return ""; |
| [8322](#L8322) |  |
| [8323](#L8323) | $code = $obj->get\_code\_for\_serverside\_insertion (); |
| [8324](#L8324) | // Must be after get\_code\_for\_serverside\_insertion () |
| [8325](#L8325) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [8326](#L8326) |  |
| [8327](#L8327) | unset ($ai\_wp\_data [AI\_DYNAMIC\_BLOCKS]); |
| [8328](#L8328) |  |
| [8329](#L8329) | return $code; |
| [8330](#L8330) | } |
| [8331](#L8331) |  |
| [8332](#L8332) | function adinserter ($block = '', $options = '') { |
| [8333](#L8333) | global $ai\_last\_check, $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [8334](#L8334) |  |
| [8335](#L8335) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8336](#L8336) | if ($debug\_processing) { |
| [8337](#L8337) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [8338](#L8338) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [8339](#L8339) | $start\_time = microtime (true); |
| [8340](#L8340) | } |
| [8341](#L8341) |  |
| [8342](#L8342) |  |
| [8343](#L8343) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8344](#L8344) | $block\_number = 0; |
| [8345](#L8345) | $code = ai\_adinserter ($block, $options, $block\_number); |
| [8346](#L8346) |  |
| [8347](#L8347) | if ($debug\_processing) { |
| [8348](#L8348) | if (!$ai\_processing\_time\_active) { |
| [8349](#L8349) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [8350](#L8350) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [8351](#L8351) | } |
| [8352](#L8352) | if ($ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($block\_number, $ai\_last\_check)); |
| [8353](#L8353) |  |
| [8354](#L8354) | ai\_log ("PHP FUNCTION CALL END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [8355](#L8355) | } |
| [8356](#L8356) |  |
| [8357](#L8357) | return $code; |
| [8358](#L8358) | } |
| [8359](#L8359) |  |
| [8360](#L8360) |  |
| [8361](#L8361) |  |
| [8362](#L8362) | function ai\_content\_hook ($content = '') { |
| [8363](#L8363) | global $block\_object, $ad\_inserter\_globals, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_last\_check, $ai\_total\_plugin\_time, $special\_element\_tags; |
| [8364](#L8364) |  |
| [8365](#L8365) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_ADMIN) return $content; |
| [8366](#L8366) |  |
| [8367](#L8367) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8368](#L8368) |  |
| [8369](#L8369) | $globals\_name = AI\_CONTENT\_COUNTER\_NAME; |
| [8370](#L8370) |  |
| [8371](#L8371) | if (!isset ($ad\_inserter\_globals [$globals\_name])) { |
| [8372](#L8372) | $ad\_inserter\_globals [$globals\_name] = 1; |
| [8373](#L8373) | } else $ad\_inserter\_globals [$globals\_name] ++; |
| [8374](#L8374) |  |
| [8375](#L8375) | if (!is\_string ($content)) { |
| [8376](#L8376) | if ($debug\_processing) { |
| [8377](#L8377) | ai\_log ("CONTENT HOOK START [" . $ad\_inserter\_globals [$globals\_name]  . (in\_the\_loop () ? ', IN THE LOOP' : ', NOT IN THE LOOP') . '] - CONTENT NOT STRING - NO PROCESING'); |
| [8378](#L8378) | ai\_log (""); |
| [8379](#L8379) | } |
| [8380](#L8380) | return $content; |
| [8381](#L8381) | } |
| [8382](#L8382) |  |
| [8383](#L8383) | // TEMP CHECK |
| [8384](#L8384) | if (get\_plugin\_priority () % 2 == 1) { |
| [8385](#L8385) | if (strpos ($content, '<!-- ' . AI\_CONTENT\_MARKER) !== false) { |
| [8386](#L8386) | if ($debug\_processing) { |
| [8387](#L8387) | ai\_log ("THE CONTENT ALREADY PROCESSED\n"); |
| [8388](#L8388) | } |
| [8389](#L8389) |  |
| [8390](#L8390) | return $content; |
| [8391](#L8391) | } |
| [8392](#L8392) | } |
| [8393](#L8393) |  |
| [8394](#L8394) | $special\_element\_tags = explode (',', str\_replace (' ', '', get\_no\_paragraph\_counting\_inside ())); |
| [8395](#L8395) |  |
| [8396](#L8396) | if ($debug\_processing) { |
| [8397](#L8397) | ai\_log ("CONTENT HOOK START [" . $ad\_inserter\_globals [$globals\_name]  . (in\_the\_loop () ? ', IN THE LOOP' : ', NOT IN THE LOOP') . ']'); |
| [8398](#L8398) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [8399](#L8399) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [8400](#L8400) | $start\_time = microtime (true); |
| [8401](#L8401) | } |
| [8402](#L8402) |  |
| [8403](#L8403) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_CONTENT; |
| [8404](#L8404) |  |
| [8405](#L8405) | $content\_words = number\_of\_words ($content); |
| [8406](#L8406) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [8407](#L8407) | $preview = $block\_object [0]; |
| [8408](#L8408) | $positions\_inserted = false; |
| [8409](#L8409) |  |
| [8410](#L8410) | if ($ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] == 0) { |
| [8411](#L8411) | $content = $preview->before\_paragraph ($content, true); |
| [8412](#L8412) | $content = $preview->after\_paragraph ($content, true); |
| [8413](#L8413) | $positions\_inserted = true; |
| [8414](#L8414) | } |
| [8415](#L8415) |  |
| [8416](#L8416) | $content = $preview->before\_paragraph ($content, true, true); |
| [8417](#L8417) | $content = $preview->after\_paragraph ($content, true, true); |
| [8418](#L8418) | } |
| [8419](#L8419) |  |
| [8420](#L8420) | if ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) { |
| [8421](#L8421) | if ($debug\_processing) ai\_log\_content ($content); |
| [8422](#L8422) |  |
| [8423](#L8423) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [8424](#L8424) | //      $meta\_value = get\_post\_meta (get\_the\_ID (), '\_adinserter\_block\_exceptions', true); |
| [8425](#L8425) | $meta\_value = ai\_get\_post\_meta (); |
| [8426](#L8426) |  |
| [8427](#L8427) | $selected\_blocks = explode (",", $meta\_value); |
| [8428](#L8428) |  |
| [8429](#L8429) | ai\_log ("INDIVIDUAL EXCEPTIONS [" . $meta\_value . ']'); |
| [8430](#L8430) |  |
| [8431](#L8431) | } else $selected\_blocks = array (); |
| [8432](#L8432) |  |
| [8433](#L8433) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8434](#L8434) | $current\_block = 0; |
| [8435](#L8435) | $in\_the\_loop = in\_the\_loop (); |
| [8436](#L8436) |  |
| [8437](#L8437) | if (isset ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [8438](#L8438) | foreach ($ai\_db\_options\_extract [CONTENT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [8439](#L8439) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8440](#L8440) |  |
| [8441](#L8441) | if (!isset ($block\_object [$block])) continue; |
| [8442](#L8442) |  |
| [8443](#L8443) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8444](#L8444) | $current\_block = $block; |
| [8445](#L8445) |  |
| [8446](#L8446) | $obj = $block\_object [$block]; |
| [8447](#L8447) | $obj->clear\_code\_cache (); |
| [8448](#L8448) |  |
| [8449](#L8449) | if ($in\_the\_loop || !$obj->get\_only\_in\_the\_loop ()) { |
| [8450](#L8450) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0 && !$positions\_inserted && $ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK] <= $block) { |
| [8451](#L8451) | $preview = $block\_object [$ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK]]; |
| [8452](#L8452) |  |
| [8453](#L8453) | $content = $preview->before\_paragraph ($content, true); |
| [8454](#L8454) | $content = $preview->after\_paragraph ($content, true); |
| [8455](#L8455) |  |
| [8456](#L8456) | $positions\_inserted = true; |
| [8457](#L8457) | } |
| [8458](#L8458) |  |
| [8459](#L8459) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [8460](#L8460) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [8461](#L8461) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) continue; |
| [8462](#L8462) | if (!$obj->check\_filter ($ad\_inserter\_globals [$globals\_name])) continue; |
| [8463](#L8463) | if (!$obj->check\_number\_of\_words ($content, $content\_words)) continue; |
| [8464](#L8464) |  |
| [8465](#L8465) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [8466](#L8466) | if (!$obj->check\_disabled ()) continue; |
| [8467](#L8467) |  |
| [8468](#L8468) | // Deprecated |
| [8469](#L8469) | if ($obj->display\_disabled ($content)) continue; |
| [8470](#L8470) |  |
| [8471](#L8471) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [8472](#L8472) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [8473](#L8473) |  |
| [8474](#L8474) | // Last check before counter check before insertion |
| [8475](#L8475) | if ($obj->empty\_code ()) continue; |
| [8476](#L8476) |  |
| [8477](#L8477) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [8478](#L8478) | if ($max\_page\_blocks\_enabled) { |
| [8479](#L8479) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [8480](#L8480) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [8481](#L8481) | } |
| [8482](#L8482) |  |
| [8483](#L8483) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [8484](#L8484) |  |
| [8485](#L8485) | $automatic\_insertion = $obj->get\_automatic\_insertion(); |
| [8486](#L8486) |  |
| [8487](#L8487) | if ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_BEFORE\_PARAGRAPH) { |
| [8488](#L8488) | $ai\_last\_check = AI\_CHECK\_PARAGRAPH\_COUNTING; |
| [8489](#L8489) | $content = $obj->before\_paragraph ($content); |
| [8490](#L8490) | } |
| [8491](#L8491) | elseif ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_AFTER\_PARAGRAPH) { |
| [8492](#L8492) | $ai\_last\_check = AI\_CHECK\_PARAGRAPH\_COUNTING; |
| [8493](#L8493) | $content = $obj->after\_paragraph ($content); |
| [8494](#L8494) | } |
| [8495](#L8495) | if ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_BEFORE\_IMAGE) { |
| [8496](#L8496) | $ai\_last\_check = AI\_CHECK\_IMAGE\_COUNTING; |
| [8497](#L8497) | $content = $obj->before\_image ($content); |
| [8498](#L8498) | } |
| [8499](#L8499) | elseif ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_AFTER\_IMAGE) { |
| [8500](#L8500) | $ai\_last\_check = AI\_CHECK\_IMAGE\_COUNTING; |
| [8501](#L8501) | $content = $obj->after\_image ($content); |
| [8502](#L8502) | } |
| [8503](#L8503) | elseif ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_BEFORE\_CONTENT) { |
| [8504](#L8504) | // Last check before insertion |
| [8505](#L8505) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [8506](#L8506) |  |
| [8507](#L8507) | // Increment page block counter |
| [8508](#L8508) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [8509](#L8509) |  |
| [8510](#L8510) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [8511](#L8511) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [8512](#L8512) | $content = $obj->get\_code\_for\_serverside\_insertion () . $content; |
| [8513](#L8513) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [8514](#L8514) | } |
| [8515](#L8515) | } |
| [8516](#L8516) | elseif ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_AFTER\_CONTENT) { |
| [8517](#L8517) | // Last check before insertion |
| [8518](#L8518) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [8519](#L8519) |  |
| [8520](#L8520) | // Increment page block counter |
| [8521](#L8521) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [8522](#L8522) |  |
| [8523](#L8523) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [8524](#L8524) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [8525](#L8525) | $content = $content . $obj->get\_code\_for\_serverside\_insertion (); |
| [8526](#L8526) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [8527](#L8527) | } |
| [8528](#L8528) | } |
| [8529](#L8529) | } |
| [8530](#L8530) | } |
| [8531](#L8531) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8532](#L8532) | } |
| [8533](#L8533) |  |
| [8534](#L8534) |  |
| [8535](#L8535) | if (function\_exists ('ai\_content')) ai\_content ($content); |
| [8536](#L8536) |  |
| [8537](#L8537) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_TAGS) != 0) { |
| [8538](#L8538) | $class = AI\_DEBUG\_TAGS\_CLASS; |
| [8539](#L8539) |  |
| [8540](#L8540) | $content = preg\_replace ("/\r\n\r\n/", "\r\n\r\n<kbd class='$class ai-debug-rnrn'>\\r\\n\\r\\n</kbd>", $content); |
| [8541](#L8541) |  |
| [8542](#L8542) | //    $content = preg\_replace ("/<p>/i", "<p><kbd class='$class ai-debug-p'>&lt;p&gt;</kbd>", $content); |
| [8543](#L8543) | //    $content = preg\_replace ("/<p ([^>]\*?)>/i", "<p$1><kbd class='$class ai-debug-p'>&lt;p$1&gt;</kbd>", $content);          // Full p tags |
| [8544](#L8544) | $content = preg\_replace ("/<p([^>]\*?)>/i", "<p$1><kbd class='$class ai-debug-p'>&lt;p&gt;</kbd>", $content); |
| [8545](#L8545) | //      $content = preg\_replace ("/<div([^>]\*?)>/i", "<div$1><kbd class='$class ai-debug-div'>&lt;div$1&gt;</kbd>", $content);  // Full div tags |
| [8546](#L8546) | $content = preg\_replace ("/<div([^>]\*?)>/i", "<div$1><kbd class='$class ai-debug-div'>&lt;div&gt;</kbd>", $content); |
| [8547](#L8547) | $content = preg\_replace ("/<h([1-6])([^>]\*?)>/i", "<h$1$2><kbd class='$class ai-debug-h'>&lt;h$1&gt;</kbd>", $content); |
| [8548](#L8548) | $content = preg\_replace ("/<img([^>]\*?)>/i", "<img$1><kbd class='$class ai-debug-img'>&lt;img$1&gt;</kbd>", $content); |
| [8549](#L8549) | $content = preg\_replace ("/<pre([^>]\*?)>/i", "<pre$1><kbd class='$class ai-debug-pre'>&lt;pre&gt;</kbd>", $content); |
| [8550](#L8550) | $content = preg\_replace ("/<span([^>]\*?)>/i", "<kbd class='$class ai-debug-span'>&lt;span&gt;</kbd><span$1>", $content); |
| [8551](#L8551) | $content = preg\_replace ("/<(?!section|ins|script|kbd|a|strong|pre|span|p|div|h[1-6]|img)([a-z0-9]+)([^>]\*?)>/i", "<$1$2><kbd class='$class ai-debug-special'>&lt;$1$2&gt;</kbd>", $content); |
| [8552](#L8552) |  |
| [8553](#L8553) | $content = preg\_replace ("/<\/p>/i", "<kbd class='$class ai-debug-p'>&lt;/p&gt;</kbd></p>", $content); |
| [8554](#L8554) | $content = preg\_replace ("/<\/div>/i", "<kbd class='$class ai-debug-div'>&lt;/div&gt;</kbd></div>", $content); |
| [8555](#L8555) | $content = preg\_replace ("/<\/h([1-6])>/i", "<kbd class='$class ai-debug-h'>&lt;/h$1&gt;</kbd></h$1>", $content); |
| [8556](#L8556) | $content = preg\_replace ("/<\/pre>/i", "<kbd class='$class ai-debug-pre'>&lt;/pre&gt;</kbd></pre>", $content); |
| [8557](#L8557) | $content = preg\_replace ("/<\/span>/i", "</span><kbd class='$class ai-debug-span'>&lt;/span&gt;</kbd>", $content); |
| [8558](#L8558) | $content = preg\_replace ("/<\/(?!section|ins|script|kbd|a|strong|pre|span|p|div|h[1-6])([a-z0-9]+)>/i", "<kbd class='$class ai-debug-special'>&lt;/$1&gt;</kbd></$1>", $content); |
| [8559](#L8559) | } |
| [8560](#L8560) |  |
| [8561](#L8561) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [8562](#L8562) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [8563](#L8563) |  |
| [8564](#L8564) | if (!$positions\_inserted) { |
| [8565](#L8565) | $preview = $block\_object [$ai\_wp\_data [AI\_WP\_DEBUG\_BLOCK]]; |
| [8566](#L8566) | $content = $preview->before\_paragraph ($content, true); |
| [8567](#L8567) | $content = $preview->after\_paragraph ($content, true); |
| [8568](#L8568) | } |
| [8569](#L8569) |  |
| [8570](#L8570) | if (preg\_match\_all ("/\[\[AI\_BP([\d]+?)=([\d]+?)\]\]/", $content, $matches)) { |
| [8571](#L8571) | foreach ($matches [0] as $index => $match) { |
| [8572](#L8572) | $content = str\_replace ($match, |
| [8573](#L8573) | "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BEFORE\_PARAGRAPH ."' class='$class'><a href='#' class='ai-debug-left ai-debug-visibility-hidden'><span class='ai-debug-display-none'>[(]</span>" . $matches [2][$index] . " " . \_n('word', 'words', $matches [2][$index], 'ad-inserter') . '<span class="ai-debug-display-none">[)]</span></a>' . |
| [8574](#L8574) | ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH) : strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH)) . ' ' . $matches [1][$index] . |
| [8575](#L8575) | "<a href='#' class='ai-debug-right'><span class='ai-debug-display-none'>[(]</span>" . $matches [2][$index] . ' ' . \_n('word', 'words', $matches [2][$index], 'ad-inserter') . '<span class="ai-debug-display-none">[)]</span></a></section>', |
| [8576](#L8576) | $content); |
| [8577](#L8577) | } |
| [8578](#L8578) | } |
| [8579](#L8579) |  |
| [8580](#L8580) | if (preg\_match\_all ("/\[\[AI\_BI([\d]+?)=([\d]+?)\]\]/", $content, $matches)) { |
| [8581](#L8581) | foreach ($matches [0] as $index => $match) { |
| [8582](#L8582) | $content = str\_replace ($match, |
| [8583](#L8583) | "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BEFORE\_IMAGE ."' class='$class ai-images'><a href='#' class='ai-debug-left ai-debug-visibility-hidden'><span class='ai-debug-display-none'>[(]</span>".'<span class="ai-debug-display-none">[)]</span></a>' . |
| [8584](#L8584) | ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_IMAGE) : strtoupper (AI\_TEXT\_BEFORE\_IMAGE)) . ' ' . $matches [1][$index] . |
| [8585](#L8585) | "<a href='#' class='ai-debug-right'><span class='ai-debug-display-none'>[(]</span>" . '<span class="ai-debug-display-none">[)]</span></a></section>', |
| [8586](#L8586) | $content); |
| [8587](#L8587) | } |
| [8588](#L8588) | } |
| [8589](#L8589) |  |
| [8590](#L8590) | //    $content = preg\_replace ("/\[\[AI\_BP([\d]+?)=([\d]+?)\]\]/", "<section class='$class'><a class='ai-debug-left' style='visibility: hidden;'><span style='display: none'>[(]</span>$2 " . \_\_('words', 'ad-inserter') . '[)]</a>' . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH) : strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH)) . " $1<a class='ai-debug-right'><span style='display: none'>[(]</span>$2 " . \_\_('word', 'words', 'ad-inserter') . '<span style="display: none">[)]</span></a></section>', $content); |
| [8591](#L8591) | $content = preg\_replace ("/\[\[AI\_AP([\d]+?)\]\]/", "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_AFTER\_PARAGRAPH ."' class='$class'>" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_PARAGRAPH) : strtoupper (AI\_TEXT\_AFTER\_PARAGRAPH)) . " $1</section>", $content); |
| [8592](#L8592) |  |
| [8593](#L8593) | $content = preg\_replace ("/\[\[AI\_AI([\d]+?)\]\]/", "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_AFTER\_IMAGE ."' class='$class ai-images'>" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_IMAGE) : strtoupper (AI\_TEXT\_AFTER\_IMAGE)) . " $1</section>", $content); |
| [8594](#L8594) |  |
| [8595](#L8595) | $counter = $ad\_inserter\_globals [$globals\_name]; |
| [8596](#L8596) | if ($counter == 1) $counter = ''; |
| [8597](#L8597) |  |
| [8598](#L8598) | $content = "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BEFORE\_CONTENT ."' class='$class'><a href='#' class='ai-debug-left ai-debug-visibility-hidden'><span class='ai-debug-display-none'>[(]</span>".$content\_words . ' ' . \_n('word', 'words', $content\_words, 'ad-inserter') . '</a> ' . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_CONTENT): strtoupper (AI\_TEXT\_BEFORE\_CONTENT)) . ' '.$counter."<a href='#' class='ai-debug-right'>".$content\_words.' ' . \_n('word', 'words', $content\_words, 'ad-inserter') . '<span class="ai-debug-display-none">[)]</span></a></section>'. $content; |
| [8599](#L8599) |  |
| [8600](#L8600) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [8601](#L8601) | $content = get\_page\_type\_debug\_info ('AMP ') . $content; |
| [8602](#L8602) | } |
| [8603](#L8603) |  |
| [8604](#L8604) | $content = $content . "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_AFTER\_CONTENT ."' class='$class'>" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_CONTENT) : strtoupper (AI\_TEXT\_AFTER\_CONTENT)) . ' '.$counter."</section>"; |
| [8605](#L8605) |  |
| [8606](#L8606) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [8607](#L8607) | $content = $content . get\_page\_type\_debug\_info ('AMP '); |
| [8608](#L8608) | } else $content = $content . get\_page\_type\_debug\_info (''); |
| [8609](#L8609) | } |
| [8610](#L8610) |  |
| [8611](#L8611) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_TAGS) != 0) { |
| [8612](#L8612) | $content = '<kbd class="ai-debug-invisible">[' . \_\_('HTML TAGS REMOVED', 'ad-inserter') . ']</kbd>' . $content; |
| [8613](#L8613) | } |
| [8614](#L8614) |  |
| [8615](#L8615) | if (($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_AJAX || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_REST) && !$ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]) { |
| [8616](#L8616) | if ($ai\_wp\_data [AI\_CLOSE\_BUTTONS]) { |
| [8617](#L8617) | $content .= '<script>if (typeof ai\_install\_close\_buttons == "function") {ai\_install\_close\_buttons (document);}</script>'; |
| [8618](#L8618) | } |
| [8619](#L8619) | } |
| [8620](#L8620) |  |
| [8621](#L8621) | $content .= '<!-- ' . AI\_CONTENT\_MARKER . ' ' . $ad\_inserter\_globals [$globals\_name] . " -->\n"; |
| [8622](#L8622) |  |
| [8623](#L8623) | if ($debug\_processing) { |
| [8624](#L8624) | if (!$ai\_processing\_time\_active) { |
| [8625](#L8625) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [8626](#L8626) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [8627](#L8627) | } |
| [8628](#L8628) | ai\_log ("CONTENT HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [8629](#L8629) | } |
| [8630](#L8630) |  |
| [8631](#L8631) | return $content; |
| [8632](#L8632) | } |
| [8633](#L8633) |  |
| [8634](#L8634) | // Process Before/After Excerpt postion |
| [8635](#L8635) | function ai\_excerpt\_hook ($content = '') { |
| [8636](#L8636) | global $ad\_inserter\_globals, $block\_object, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_last\_check, $ai\_total\_plugin\_time; |
| [8637](#L8637) |  |
| [8638](#L8638) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_ADMIN) return; |
| [8639](#L8639) |  |
| [8640](#L8640) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8641](#L8641) | $globals\_name = AI\_EXCERPT\_COUNTER\_NAME; |
| [8642](#L8642) |  |
| [8643](#L8643) | if (!isset ($ad\_inserter\_globals [$globals\_name])) { |
| [8644](#L8644) | $ad\_inserter\_globals [$globals\_name] = 1; |
| [8645](#L8645) | } else $ad\_inserter\_globals [$globals\_name] ++; |
| [8646](#L8646) |  |
| [8647](#L8647) | if ($debug\_processing) { |
| [8648](#L8648) | ai\_log ("EXCERPT HOOK START [" . $ad\_inserter\_globals [$globals\_name] . ']'); |
| [8649](#L8649) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [8650](#L8650) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [8651](#L8651) | $start\_time = microtime (true); |
| [8652](#L8652) | } |
| [8653](#L8653) |  |
| [8654](#L8654) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_EXCERPT; |
| [8655](#L8655) |  |
| [8656](#L8656) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8657](#L8657) | $current\_block = 0; |
| [8658](#L8658) |  |
| [8659](#L8659) | if (isset ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [8660](#L8660) | foreach ($ai\_db\_options\_extract [EXCERPT\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [8661](#L8661) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8662](#L8662) |  |
| [8663](#L8663) | if (!isset ($block\_object [$block])) continue; |
| [8664](#L8664) |  |
| [8665](#L8665) | $current\_block = $block; |
| [8666](#L8666) | $obj = $block\_object [$block]; |
| [8667](#L8667) | $obj->clear\_code\_cache (); |
| [8668](#L8668) |  |
| [8669](#L8669) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [8670](#L8670) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [8671](#L8671) | if (!$obj->check\_filter ($ad\_inserter\_globals [$globals\_name])) continue; |
| [8672](#L8672) |  |
| [8673](#L8673) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [8674](#L8674) | if (!$obj->check\_disabled ()) continue; |
| [8675](#L8675) |  |
| [8676](#L8676) | // Deprecated |
| [8677](#L8677) | if ($obj->display\_disabled ($content)) continue; |
| [8678](#L8678) |  |
| [8679](#L8679) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [8680](#L8680) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [8681](#L8681) |  |
| [8682](#L8682) | // Last check before counter check before insertion |
| [8683](#L8683) | //    $ai\_last\_check = AI\_CHECK\_CODE; |
| [8684](#L8684) | //    if ($obj->ai\_getCode () == '') continue; |
| [8685](#L8685) | if ($obj->empty\_code ()) continue; |
| [8686](#L8686) |  |
| [8687](#L8687) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [8688](#L8688) | if ($max\_page\_blocks\_enabled) { |
| [8689](#L8689) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [8690](#L8690) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [8691](#L8691) | } |
| [8692](#L8692) |  |
| [8693](#L8693) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [8694](#L8694) |  |
| [8695](#L8695) | // Last check before insertion |
| [8696](#L8696) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [8697](#L8697) |  |
| [8698](#L8698) | // Increment page block counter |
| [8699](#L8699) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [8700](#L8700) |  |
| [8701](#L8701) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [8702](#L8702) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [8703](#L8703) |  |
| [8704](#L8704) | $automatic\_insertion = $obj->get\_automatic\_insertion (); |
| [8705](#L8705) | if ($automatic\_insertion == AI\_AUTOMATIC\_INSERTION\_BEFORE\_EXCERPT) |
| [8706](#L8706) | $content = $obj->get\_code\_for\_serverside\_insertion () . $content; else |
| [8707](#L8707) | $content = $content . $obj->get\_code\_for\_serverside\_insertion (); |
| [8708](#L8708) |  |
| [8709](#L8709) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [8710](#L8710) | } |
| [8711](#L8711) | } |
| [8712](#L8712) |  |
| [8713](#L8713) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8714](#L8714) |  |
| [8715](#L8715) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [8716](#L8716) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [8717](#L8717) |  |
| [8718](#L8718) | $content = "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BEFORE\_EXCERPT ."' class='$class'>" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_EXCERPT) : strtoupper (AI\_TEXT\_BEFORE\_EXCERPT)) . ' ' . $ad\_inserter\_globals [$globals\_name]."</section>". |
| [8719](#L8719) | $content . "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_AFTER\_EXCERPT ."' class='$class'>" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_EXCERPT) : strtoupper (AI\_TEXT\_AFTER\_EXCERPT)) . ' ' .$ad\_inserter\_globals [$globals\_name]."</section>"; |
| [8720](#L8720) |  |
| [8721](#L8721) |  |
| [8722](#L8722) | // Remove word counts |
| [8723](#L8723) | $content = preg\_replace ("/\[\(\](.+?)\[\)\]/", "", $content); |
| [8724](#L8724) | $content = preg\_replace ("/\[\(\].\*/", "", $content); |
| [8725](#L8725) |  |
| [8726](#L8726) | // Color positions from the content hook |
| [8727](#L8727) | //    $content = preg\_replace ("/((BEFORE|AFTER) (CONTENT|PARAGRAPH) ?[\d]\*)/", "<span class='ai-debug-content-hook-positions'> [$1] </span>", $content); |
| [8728](#L8728) | $content = preg\_replace ("/(" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_CONTENT) :   strtoupper (AI\_TEXT\_BEFORE\_CONTENT)) . " ?[\d]\*)/", "<span class='ai-debug-content-hook-positions'> [$1] </span>", $content); |
| [8729](#L8729) | $content = preg\_replace ("/(" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_CONTENT) :    strtoupper (AI\_TEXT\_AFTER\_CONTENT)) . " ?[\d]\*)/", "<span class='ai-debug-content-hook-positions'> [$1] </span>", $content); |
| [8730](#L8730) | $content = preg\_replace ("/(" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH) : strtoupper (AI\_TEXT\_BEFORE\_PARAGRAPH)) . " ?[\d]\*)/", "<span class='ai-debug-content-hook-positions'> [$1] </span>", $content); |
| [8731](#L8731) | $content = preg\_replace ("/(" . ($ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper (AI\_TEXT\_AFTER\_PARAGRAPH) :  strtoupper (AI\_TEXT\_AFTER\_PARAGRAPH)) . " ?[\d]\*)/", "<span class='ai-debug-content-hook-positions'> [$1] </span>", $content); |
| [8732](#L8732) | } |
| [8733](#L8733) |  |
| [8734](#L8734) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_TAGS) != 0) { |
| [8735](#L8735) | // Remove marked tags from the content hook |
| [8736](#L8736) | $content = preg\_replace ("/&lt;(.+?)&gt;/", "", $content); |
| [8737](#L8737) |  |
| [8738](#L8738) | // Color text to mark removed HTML tags |
| [8739](#L8739) | $content = str\_replace ('[' . \_\_('HTML TAGS REMOVED', 'ad-inserter') . ']', '<span class="ai-debug-removed-html-tags">[' . \_\_('HTML TAGS REMOVED', 'ad-inserter') . ']</span>', $content); |
| [8740](#L8740) | } |
| [8741](#L8741) |  |
| [8742](#L8742) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0) { |
| [8743](#L8743) | // Remove block labels from the content hook |
| [8744](#L8744) | if (strpos ($content, '>[AI]<') === false) |
| [8745](#L8745) | $content = preg\_replace ("/\[AI\](.+?)\[\/AI\]/", "", $content); |
| [8746](#L8746) | } |
| [8747](#L8747) |  |
| [8748](#L8748) | if ($debug\_processing) { |
| [8749](#L8749) | if (!$ai\_processing\_time\_active) { |
| [8750](#L8750) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [8751](#L8751) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [8752](#L8752) | } |
| [8753](#L8753) | ai\_log ("EXCERPT HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [8754](#L8754) | } |
| [8755](#L8755) |  |
| [8756](#L8756) | return $content; |
| [8757](#L8757) | } |
| [8758](#L8758) |  |
| [8759](#L8759) | function ai\_comments\_array ($comments , $post\_id ){ |
| [8760](#L8760) | global $ai\_wp\_data; |
| [8761](#L8761) |  |
| [8762](#L8762) | $thread\_comments = get\_option ('thread\_comments'); |
| [8763](#L8763) | $comment\_counter = 0; |
| [8764](#L8764) | foreach ($comments as $comment) { |
| [8765](#L8765) | if (!$thread\_comments || empty ($comment->comment\_parent)) |
| [8766](#L8766) | $comment\_counter ++; |
| [8767](#L8767) | } |
| [8768](#L8768) | $ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS] = $comment\_counter; |
| [8769](#L8769) |  |
| [8770](#L8770) | return $comments; |
| [8771](#L8771) | } |
| [8772](#L8772) |  |
| [8773](#L8773) | function ai\_wp\_list\_comments\_args ($args) { |
| [8774](#L8774) | global $ai\_wp\_data; |
| [8775](#L8775) |  |
| [8776](#L8776) | //  print\_r ($args); |
| [8777](#L8777) | //  $args['per\_page'] = 3; |
| [8778](#L8778) | //  $args['page'] = 2; |
| [8779](#L8779) |  |
| [8780](#L8780) | $ai\_wp\_data ['AI\_COMMENTS\_SAVED\_CALLBACK'] = $args ['callback']; |
| [8781](#L8781) | $args ['callback'] = 'ai\_comment\_callback'; |
| [8782](#L8782) |  |
| [8783](#L8783) | $ai\_wp\_data ['AI\_COMMENTS\_SAVED\_END\_CALLBACK'] = $args ['end-callback']; |
| [8784](#L8784) | $args ['end-callback'] = 'ai\_comment\_end\_callback'; |
| [8785](#L8785) |  |
| [8786](#L8786) | return $args; |
| [8787](#L8787) | } |
| [8788](#L8788) |  |
| [8789](#L8789) | // Process comments counter + Before Comments postion |
| [8790](#L8790) | function ai\_comment\_callback ($comment, $args, $depth) { |
| [8791](#L8791) | global $block\_object, $ad\_inserter\_globals, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_last\_check, $ai\_total\_plugin\_time, $ai\_walker; |
| [8792](#L8792) |  |
| [8793](#L8793) | if ($depth == 1) { |
| [8794](#L8794) | if (!isset ($ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME])) { |
| [8795](#L8795) | $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] = 1; |
| [8796](#L8796) | } else $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] ++; |
| [8797](#L8797) | } |
| [8798](#L8798) |  |
| [8799](#L8799) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8800](#L8800) | if ($debug\_processing) { |
| [8801](#L8801) | ai\_log ('COMMENT START HOOK START [' . $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] . ':'. $depth . ']'); |
| [8802](#L8802) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [8803](#L8803) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [8804](#L8804) | $start\_time = microtime (true); |
| [8805](#L8805) | } |
| [8806](#L8806) |  |
| [8807](#L8807) | if ($depth == 1 && $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] == 1) { |
| [8808](#L8808) |  |
| [8809](#L8809) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_BEFORE\_COMMENTS; |
| [8810](#L8810) |  |
| [8811](#L8811) | if ($args ['style'] == 'div') $tag = 'div'; else $tag = 'li'; |
| [8812](#L8812) |  |
| [8813](#L8813) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [8814](#L8814) |  |
| [8815](#L8815) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [8816](#L8816) |  |
| [8817](#L8817) | echo "<$tag>\n"; |
| [8818](#L8818) | echo "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BEFORE\_COMMENTS ."' class='$class'>" . \_\_('BEFORE COMMENTS', 'ad-inserter') . '</section>'; |
| [8819](#L8819) | echo "</$tag>\n"; |
| [8820](#L8820) | } |
| [8821](#L8821) |  |
| [8822](#L8822) | $ad\_code = ""; |
| [8823](#L8823) |  |
| [8824](#L8824) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8825](#L8825) | $current\_block = 0; |
| [8826](#L8826) |  |
| [8827](#L8827) | if (isset ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [8828](#L8828) | foreach ($ai\_db\_options\_extract [BEFORE\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [8829](#L8829) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8830](#L8830) |  |
| [8831](#L8831) | if (!isset ($block\_object [$block])) continue; |
| [8832](#L8832) |  |
| [8833](#L8833) | $current\_block = $block; |
| [8834](#L8834) |  |
| [8835](#L8835) | $obj = $block\_object [$block]; |
| [8836](#L8836) | $obj->clear\_code\_cache (); |
| [8837](#L8837) |  |
| [8838](#L8838) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [8839](#L8839) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [8840](#L8840) | // No filter check |
| [8841](#L8841) | if (!$obj->check\_number\_of\_words ()) continue; |
| [8842](#L8842) |  |
| [8843](#L8843) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [8844](#L8844) | $meta\_value = ai\_get\_post\_meta (); |
| [8845](#L8845) | $selected\_blocks = explode (",", $meta\_value); |
| [8846](#L8846) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) continue; |
| [8847](#L8847) | } |
| [8848](#L8848) |  |
| [8849](#L8849) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [8850](#L8850) | if (!$obj->check\_disabled ()) continue; |
| [8851](#L8851) |  |
| [8852](#L8852) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [8853](#L8853) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [8854](#L8854) |  |
| [8855](#L8855) | // Last check before counter check before insertion |
| [8856](#L8856) | //      $ai\_last\_check = AI\_CHECK\_CODE; |
| [8857](#L8857) | //      if ($obj->ai\_getCode () == '') continue; |
| [8858](#L8858) | if ($obj->empty\_code ()) continue; |
| [8859](#L8859) |  |
| [8860](#L8860) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [8861](#L8861) | if ($max\_page\_blocks\_enabled) { |
| [8862](#L8862) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [8863](#L8863) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [8864](#L8864) | } |
| [8865](#L8865) |  |
| [8866](#L8866) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [8867](#L8867) |  |
| [8868](#L8868) | // Last check before insertion |
| [8869](#L8869) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [8870](#L8870) |  |
| [8871](#L8871) | // Increment page block counter |
| [8872](#L8872) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [8873](#L8873) |  |
| [8874](#L8874) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [8875](#L8875) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [8876](#L8876) | $ad\_code .= $obj->get\_code\_for\_serverside\_insertion (); |
| [8877](#L8877) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [8878](#L8878) | } |
| [8879](#L8879) | } |
| [8880](#L8880) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8881](#L8881) |  |
| [8882](#L8882) | if ($ad\_code != '') { |
| [8883](#L8883) | echo "<$tag>\n"; |
| [8884](#L8884) | echo $ad\_code; |
| [8885](#L8885) | echo "</$tag>\n"; |
| [8886](#L8886) | } |
| [8887](#L8887) | } |
| [8888](#L8888) |  |
| [8889](#L8889) | if ($debug\_processing) { |
| [8890](#L8890) | if (!$ai\_processing\_time\_active) { |
| [8891](#L8891) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [8892](#L8892) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [8893](#L8893) | } |
| [8894](#L8894) | ai\_log ("COMMENT START HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [8895](#L8895) | } |
| [8896](#L8896) |  |
| [8897](#L8897) | if (!empty ($ai\_wp\_data ['AI\_COMMENTS\_SAVED\_CALLBACK'])) { |
| [8898](#L8898) | echo call\_user\_func ($ai\_wp\_data ['AI\_COMMENTS\_SAVED\_CALLBACK'], $comment, $args, $depth ); |
| [8899](#L8899) | } else { |
| [8900](#L8900) | $ai\_walker->comment\_callback ($comment, $args, $depth); |
| [8901](#L8901) | } |
| [8902](#L8902) | } |
| [8903](#L8903) |  |
| [8904](#L8904) | // Process Between Comments postion |
| [8905](#L8905) | function ai\_comment\_end\_callback ($comment, $args, $depth) { |
| [8906](#L8906) | global $block\_object, $ad\_inserter\_globals, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_last\_check, $ai\_total\_plugin\_time; |
| [8907](#L8907) |  |
| [8908](#L8908) | if ($args ['style'] == 'div') $tag = 'div'; else $tag = 'li'; |
| [8909](#L8909) |  |
| [8910](#L8910) | if (!empty ($ai\_wp\_data ['AI\_COMMENTS\_SAVED\_END\_CALLBACK'])) { |
| [8911](#L8911) | echo call\_user\_func ($ai\_wp\_data ['AI\_COMMENTS\_SAVED\_END\_CALLBACK'], $comment, $args, $depth); |
| [8912](#L8912) | } else echo "</$tag><!-- #comment-## -->\n"; |
| [8913](#L8913) |  |
| [8914](#L8914) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [8915](#L8915) | if ($debug\_processing) { |
| [8916](#L8916) | ai\_log ('COMMENT END HOOK START [' . $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] . ':'. ($depth + 1) . ']'); |
| [8917](#L8917) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [8918](#L8918) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [8919](#L8919) | $start\_time = microtime (true); |
| [8920](#L8920) | } |
| [8921](#L8921) |  |
| [8922](#L8922) | if ($depth == 0) { |
| [8923](#L8923) |  |
| [8924](#L8924) | if (!isset ($ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS])) { |
| [8925](#L8925) | $ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS] = 0; |
| [8926](#L8926) | } |
| [8927](#L8927) |  |
| [8928](#L8928) | if (isset ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]]) && |
| [8929](#L8929) | $ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] != 0 && |
| [8930](#L8930) | !empty ($args ['per\_page']) && !empty ($args ['page'])) { |
| [8931](#L8931) | $number\_of\_comments\_mod\_per\_page = $ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS] % $args ['per\_page']; |
| [8932](#L8932) | if ($number\_of\_comments\_mod\_per\_page != 0) { |
| [8933](#L8933) | $last\_page = (int) ($ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS] / $args ['per\_page']) + 1; |
| [8934](#L8934) | $last\_comment\_number = $args ['page'] == $last\_page ? $number\_of\_comments\_mod\_per\_page : $args ['per\_page']; |
| [8935](#L8935) | } else $last\_comment\_number = $args ['per\_page']; |
| [8936](#L8936) | } else $last\_comment\_number = $ai\_wp\_data [AI\_NUMBER\_OF\_COMMENTS]; |
| [8937](#L8937) |  |
| [8938](#L8938) | if ($ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME] == $last\_comment\_number) { |
| [8939](#L8939) |  |
| [8940](#L8940) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_AFTER\_COMMENTS; |
| [8941](#L8941) |  |
| [8942](#L8942) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [8943](#L8943) |  |
| [8944](#L8944) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [8945](#L8945) |  |
| [8946](#L8946) | echo "<$tag>\n"; |
| [8947](#L8947) | echo "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_AFTER\_COMMENTS ."' class='$class'>" . \_\_('AFTER COMMENTS', 'ad-inserter') . '</section>'; |
| [8948](#L8948) | echo "</$tag>\n"; |
| [8949](#L8949) | } |
| [8950](#L8950) |  |
| [8951](#L8951) | $ad\_code = ""; |
| [8952](#L8952) |  |
| [8953](#L8953) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [8954](#L8954) | $current\_block = 0; |
| [8955](#L8955) |  |
| [8956](#L8956) | if (isset ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [8957](#L8957) | foreach ($ai\_db\_options\_extract [AFTER\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [8958](#L8958) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [8959](#L8959) |  |
| [8960](#L8960) | if (!isset ($block\_object [$block])) continue; |
| [8961](#L8961) |  |
| [8962](#L8962) | $current\_block = $block; |
| [8963](#L8963) |  |
| [8964](#L8964) | $obj = $block\_object [$block]; |
| [8965](#L8965) | $obj->clear\_code\_cache (); |
| [8966](#L8966) |  |
| [8967](#L8967) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [8968](#L8968) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [8969](#L8969) | // No filter check |
| [8970](#L8970) | if (!$obj->check\_number\_of\_words ()) continue; |
| [8971](#L8971) |  |
| [8972](#L8972) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [8973](#L8973) | $meta\_value = ai\_get\_post\_meta (); |
| [8974](#L8974) | $selected\_blocks = explode (",", $meta\_value); |
| [8975](#L8975) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) continue; |
| [8976](#L8976) | } |
| [8977](#L8977) |  |
| [8978](#L8978) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [8979](#L8979) | if (!$obj->check\_disabled ()) continue; |
| [8980](#L8980) |  |
| [8981](#L8981) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [8982](#L8982) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [8983](#L8983) |  |
| [8984](#L8984) | // Last check before counter check before insertion |
| [8985](#L8985) | //        $ai\_last\_check = AI\_CHECK\_CODE; |
| [8986](#L8986) | //        if ($obj->ai\_getCode () == '') continue; |
| [8987](#L8987) | if ($obj->empty\_code ()) continue; |
| [8988](#L8988) |  |
| [8989](#L8989) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [8990](#L8990) | if ($max\_page\_blocks\_enabled) { |
| [8991](#L8991) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [8992](#L8992) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [8993](#L8993) | } |
| [8994](#L8994) |  |
| [8995](#L8995) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [8996](#L8996) |  |
| [8997](#L8997) | // Last check before insertion |
| [8998](#L8998) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [8999](#L8999) |  |
| [9000](#L9000) | // Increment page block counter |
| [9001](#L9001) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [9002](#L9002) |  |
| [9003](#L9003) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [9004](#L9004) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [9005](#L9005) | $ad\_code .= $obj->get\_code\_for\_serverside\_insertion (); |
| [9006](#L9006) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [9007](#L9007) | } |
| [9008](#L9008) | } |
| [9009](#L9009) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [9010](#L9010) |  |
| [9011](#L9011) | if ($ad\_code != '') { |
| [9012](#L9012) | echo "<$tag>\n"; |
| [9013](#L9013) | echo $ad\_code; |
| [9014](#L9014) | echo "</$tag>\n"; |
| [9015](#L9015) | } |
| [9016](#L9016) | } else { |
| [9017](#L9017) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_BETWEEN\_COMMENTS; |
| [9018](#L9018) |  |
| [9019](#L9019) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [9020](#L9020) |  |
| [9021](#L9021) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [9022](#L9022) |  |
| [9023](#L9023) | echo "<$tag>\n"; |
| [9024](#L9024) | echo "<section data-ai-position='" .AI\_AUTOMATIC\_INSERTION\_BETWEEN\_COMMENTS ."' class='$class'>" . \_\_('BETWEEN COMMENTS', 'ad-inserter') . ' ' . $ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME]."</section>"; |
| [9025](#L9025) | echo "</$tag>\n"; |
| [9026](#L9026) | } |
| [9027](#L9027) |  |
| [9028](#L9028) | $ad\_code = ""; |
| [9029](#L9029) |  |
| [9030](#L9030) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [9031](#L9031) | $current\_block = 0; |
| [9032](#L9032) |  |
| [9033](#L9033) | if (isset ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [9034](#L9034) | foreach ($ai\_db\_options\_extract [BETWEEN\_COMMENTS\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [9035](#L9035) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [9036](#L9036) |  |
| [9037](#L9037) | if (!isset ($block\_object [$block])) continue; |
| [9038](#L9038) |  |
| [9039](#L9039) | $current\_block = $block; |
| [9040](#L9040) |  |
| [9041](#L9041) | $obj = $block\_object [$block]; |
| [9042](#L9042) | $obj->clear\_code\_cache (); |
| [9043](#L9043) |  |
| [9044](#L9044) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [9045](#L9045) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [9046](#L9046) | if (!$obj->check\_filter ($ad\_inserter\_globals [AI\_COMMENT\_COUNTER\_NAME])) continue; |
| [9047](#L9047) | if (!$obj->check\_number\_of\_words ()) continue; |
| [9048](#L9048) |  |
| [9049](#L9049) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [9050](#L9050) | $meta\_value = ai\_get\_post\_meta (); |
| [9051](#L9051) | $selected\_blocks = explode (",", $meta\_value); |
| [9052](#L9052) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) continue; |
| [9053](#L9053) | } |
| [9054](#L9054) |  |
| [9055](#L9055) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [9056](#L9056) | if (!$obj->check\_disabled ()) continue; |
| [9057](#L9057) |  |
| [9058](#L9058) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [9059](#L9059) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [9060](#L9060) |  |
| [9061](#L9061) | // Last check before counter check before insertion |
| [9062](#L9062) | //          $ai\_last\_check = AI\_CHECK\_CODE; |
| [9063](#L9063) | //          if ($obj->ai\_getCode () == '') continue; |
| [9064](#L9064) | if ($obj->empty\_code ()) continue; |
| [9065](#L9065) |  |
| [9066](#L9066) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [9067](#L9067) | if ($max\_page\_blocks\_enabled) { |
| [9068](#L9068) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [9069](#L9069) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [9070](#L9070) | } |
| [9071](#L9071) |  |
| [9072](#L9072) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [9073](#L9073) |  |
| [9074](#L9074) | // Last check before insertion |
| [9075](#L9075) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [9076](#L9076) |  |
| [9077](#L9077) | // Increment page block counter |
| [9078](#L9078) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [9079](#L9079) |  |
| [9080](#L9080) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [9081](#L9081) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [9082](#L9082) | $ad\_code .= $obj->get\_code\_for\_serverside\_insertion (); |
| [9083](#L9083) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [9084](#L9084) | } |
| [9085](#L9085) | } |
| [9086](#L9086) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [9087](#L9087) |  |
| [9088](#L9088) | if ($ad\_code != '') { |
| [9089](#L9089) | echo "<$tag>\n"; |
| [9090](#L9090) | echo $ad\_code; |
| [9091](#L9091) | echo "</$tag>\n"; |
| [9092](#L9092) | } |
| [9093](#L9093) | } |
| [9094](#L9094) | } |
| [9095](#L9095) |  |
| [9096](#L9096) | if ($debug\_processing) { |
| [9097](#L9097) | if (!$ai\_processing\_time\_active) { |
| [9098](#L9098) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [9099](#L9099) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [9100](#L9100) | } |
| [9101](#L9101) | ai\_log ("COMMENT END HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [9102](#L9102) | } |
| [9103](#L9103) | } |
| [9104](#L9104) |  |
| [9105](#L9105) | function ai\_custom\_hook ($action, $insertion\_type, $name, $translated\_name = '', $hook\_parameter = null, $hook\_check = null) { |
| [9106](#L9106) | global $block\_object, $ad\_inserter\_globals, $ai\_db\_options\_extract, $ai\_wp\_data, $ai\_last\_check, $ai\_total\_plugin\_time; |
| [9107](#L9107) |  |
| [9108](#L9108) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [9109](#L9109) |  |
| [9110](#L9110) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_ADMIN) return; |
| [9111](#L9111) | if (is\_admin()) return; |
| [9112](#L9112) |  |
| [9113](#L9113) | if ($insertion\_type < AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK) { |
| [9114](#L9114) | $globals\_name = 'AI\_' . strtoupper ($action) .'\_COUNTER'; |
| [9115](#L9115) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_NONE; |
| [9116](#L9116) | } else { |
| [9117](#L9117) | $globals\_name = 'AI\_' . strtoupper ($action) . '\_' . $insertion\_type . '\_COUNTER'; |
| [9118](#L9118) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_CUSTOM\_HOOK + $insertion\_type - AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK; |
| [9119](#L9119) | } |
| [9120](#L9120) |  |
| [9121](#L9121) | if (isset ($hook\_check) && $insertion\_type < AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK) { |
| [9122](#L9122) | if (!call\_user\_func ($hook\_check, $hook\_parameter, $action)) return; |
| [9123](#L9123) | } |
| [9124](#L9124) |  |
| [9125](#L9125) | if ($debug\_processing) { |
| [9126](#L9126) | $hook\_name = $ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper ($name) : strtoupper ($name); |
| [9127](#L9127) |  |
| [9128](#L9128) | ai\_log (str\_replace (array ('&LT;', '&GT;'), array ('<', '>'), $hook\_name) . " HOOK START"); |
| [9129](#L9129) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [9130](#L9130) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [9131](#L9131) | $start\_time = microtime (true); |
| [9132](#L9132) | } |
| [9133](#L9133) |  |
| [9134](#L9134) | if (!isset ($ad\_inserter\_globals [$globals\_name])) { |
| [9135](#L9135) | $ad\_inserter\_globals [$globals\_name] = 1; |
| [9136](#L9136) | } else $ad\_inserter\_globals [$globals\_name] ++; |
| [9137](#L9137) |  |
| [9138](#L9138) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_POSITIONS) != 0) { |
| [9139](#L9139) |  |
| [9140](#L9140) | $counter = $ad\_inserter\_globals [$globals\_name]; |
| [9141](#L9141) | if ($counter == 1) $counter = ''; |
| [9142](#L9142) |  |
| [9143](#L9143) | $class = AI\_DEBUG\_POSITIONS\_CLASS; |
| [9144](#L9144) | if ($translated\_name == '') $translated\_name = $name; |
| [9145](#L9145) | $translated\_hook\_name = $ai\_wp\_data [AI\_MBSTRING\_LOADED] ? mb\_strtoupper ($translated\_name) : strtoupper ($translated\_name); |
| [9146](#L9146) |  |
| [9147](#L9147) | echo "<section data-ai-position='$insertion\_type' class='$class'>".$translated\_hook\_name." ".$counter."</section>"; |
| [9148](#L9148) | } |
| [9149](#L9149) |  |
| [9150](#L9150) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [9151](#L9151) | //    $meta\_value = get\_post\_meta (get\_the\_ID (), '\_adinserter\_block\_exceptions', true); |
| [9152](#L9152) | $meta\_value = ai\_get\_post\_meta (); |
| [9153](#L9153) |  |
| [9154](#L9154) | $selected\_blocks = explode (",", $meta\_value); |
| [9155](#L9155) | } else $selected\_blocks = array (); |
| [9156](#L9156) |  |
| [9157](#L9157) | $ad\_code = ""; |
| [9158](#L9158) |  |
| [9159](#L9159) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [9160](#L9160) | $current\_block = 0; |
| [9161](#L9161) |  |
| [9162](#L9162) | if (isset ($ai\_db\_options\_extract [$action . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]])) |
| [9163](#L9163) | foreach ($ai\_db\_options\_extract [$action . CUSTOM\_HOOK\_BLOCKS][$ai\_wp\_data [AI\_WP\_PAGE\_TYPE]] as $block) { |
| [9164](#L9164) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [9165](#L9165) |  |
| [9166](#L9166) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [9167](#L9167) |  |
| [9168](#L9168) | if (!isset ($block\_object [$block])) continue; |
| [9169](#L9169) |  |
| [9170](#L9170) | $current\_block = $block; |
| [9171](#L9171) |  |
| [9172](#L9172) | $obj = $block\_object [$block]; |
| [9173](#L9173) |  |
| [9174](#L9174) | if ($insertion\_type >= AI\_AUTOMATIC\_INSERTION\_CUSTOM\_HOOK) { |
| [9175](#L9175) | if ($obj->get\_automatic\_insertion () != $insertion\_type) continue; |
| [9176](#L9176) | } |
| [9177](#L9177) |  |
| [9178](#L9178) | if (!in\_the\_loop () && $obj->get\_only\_in\_the\_loop ()) continue; |
| [9179](#L9179) |  |
| [9180](#L9180) | $obj->clear\_code\_cache (); |
| [9181](#L9181) |  |
| [9182](#L9182) | // Action can be called as insertion Between posts or as custom hook - uses the same $ai\_db\_options\_extract index |
| [9183](#L9183) | if ($action == 'the\_post' && $insertion\_type != $obj->get\_automatic\_insertion ()) continue; |
| [9184](#L9184) |  |
| [9185](#L9185) | if (!$obj->check\_server\_side\_detection ()) continue; |
| [9186](#L9186) | if (!$obj->check\_page\_types\_lists\_users ()) continue; |
| [9187](#L9187) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) continue; |
| [9188](#L9188) | if (!$obj->check\_filter ($ad\_inserter\_globals [$globals\_name])) continue; |
| [9189](#L9189) | if (!$obj->check\_number\_of\_words ()) continue; |
| [9190](#L9190) |  |
| [9191](#L9191) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [9192](#L9192) | if (!$obj->check\_disabled ()) continue; |
| [9193](#L9193) |  |
| [9194](#L9194) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [9195](#L9195) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) continue; |
| [9196](#L9196) |  |
| [9197](#L9197) | // Last check before counter check before insertion |
| [9198](#L9198) | if ($obj->empty\_code ()) continue; |
| [9199](#L9199) |  |
| [9200](#L9200) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [9201](#L9201) | if ($max\_page\_blocks\_enabled) { |
| [9202](#L9202) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [9203](#L9203) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) continue; |
| [9204](#L9204) | } |
| [9205](#L9205) |  |
| [9206](#L9206) | if (!$obj->check\_filter\_hook ($debug\_processing)) continue; |
| [9207](#L9207) |  |
| [9208](#L9208) | // Last check before insertion |
| [9209](#L9209) | if (!$obj->check\_and\_increment\_block\_counter ()) continue; |
| [9210](#L9210) |  |
| [9211](#L9211) | // Increment page block counter |
| [9212](#L9212) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [9213](#L9213) |  |
| [9214](#L9214) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [9215](#L9215) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [9216](#L9216) | $block\_code = $obj->get\_code\_for\_serverside\_insertion (); |
| [9217](#L9217) |  |
| [9218](#L9218) | if ($action == 'wp\_head') { |
| [9219](#L9219) | // Replace div tag in the head with meta tag |
| [9220](#L9220) | $block\_code = preg\_replace ("#<div class='ai-dynamic (.+?)></div>#", "<meta class='ai-dynamic $1 />", $block\_code); |
| [9221](#L9221) | } |
| [9222](#L9222) |  |
| [9223](#L9223) | $ad\_code .= $block\_code; |
| [9224](#L9224) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [9225](#L9225) | } |
| [9226](#L9226) | } |
| [9227](#L9227) | if ($debug\_processing && $ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($current\_block, $ai\_last\_check)); |
| [9228](#L9228) |  |
| [9229](#L9229) | echo $ad\_code; |
| [9230](#L9230) |  |
| [9231](#L9231) | if ($debug\_processing) { |
| [9232](#L9232) | if (!$ai\_processing\_time\_active) { |
| [9233](#L9233) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [9234](#L9234) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [9235](#L9235) | } |
| [9236](#L9236) | ai\_log (str\_replace (array ('&LT;', '&GT;'), array ('<', '>'), $hook\_name) . " HOOK END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [9237](#L9237) | } |
| [9238](#L9238) | } |
| [9239](#L9239) |  |
| [9240](#L9240) |  |
| [9241](#L9241) | function ai\_pre\_do\_shortcode\_tag ($return, $tag, $attr, $m) { |
| [9242](#L9242) | global $ai\_expand\_only\_rotate\_count\_check, $ai\_wp\_data; |
| [9243](#L9243) |  |
| [9244](#L9244) | //    Array |
| [9245](#L9245) | //( |
| [9246](#L9246) | //    [0] => [ADINSERTER ROTATE='1'] |
| [9247](#L9247) | //    [1] => |
| [9248](#L9248) | //    [2] => ADINSERTER |
| [9249](#L9249) | //    [3] =>  ROTATE='1' |
| [9250](#L9250) | //    [4] => |
| [9251](#L9251) | //    [5] => |
| [9252](#L9252) | //    [6] => |
| [9253](#L9253) |  |
| [9254](#L9254) | if ($ai\_expand\_only\_rotate\_count\_check) { |
| [9255](#L9255) | if (strtolower ($tag) == 'adinserter') { |
| [9256](#L9256) | // Expand only ROTATE / COUNT / CHECK |
| [9257](#L9257) | if (isset ($attr ['rotate']) || in\_array ('ROTATE', $attr) || in\_array ('rotate', $attr)) { |
| [9258](#L9258) | return false; |
| [9259](#L9259) | } |
| [9260](#L9260) | elseif (isset ($attr ['count']) || in\_array ('COUNT', $attr) || in\_array ('count', $attr)) { |
| [9261](#L9261) | return false; |
| [9262](#L9262) | } |
| [9263](#L9263) | elseif (isset ($attr ['check']) || in\_array ('CHECK', $attr) || in\_array ('check', $attr)) { |
| [9264](#L9264) | return false; |
| [9265](#L9265) | } |
| [9266](#L9266) | else return $m [0]; |
| [9267](#L9267) | } else return $m [0]; |
| [9268](#L9268) | } |
| [9269](#L9269) |  |
| [9270](#L9270) | return $return; |
| [9271](#L9271) | } |
| [9272](#L9272) |  |
| [9273](#L9273) | function ai\_process\_shortcode (&$block, $atts) { |
| [9274](#L9274) | global $block\_object, $ai\_last\_check, $ai\_wp\_data, $ad\_inserter\_globals; |
| [9275](#L9275) |  |
| [9276](#L9276) | if ($atts == '') return ''; |
| [9277](#L9277) |  |
| [9278](#L9278) | $parameters = shortcode\_atts (array ( |
| [9279](#L9279) | "block" => "", |
| [9280](#L9280) | "code" => "", |
| [9281](#L9281) | "name" => "", |
| [9282](#L9282) | "group" => "", |
| [9283](#L9283) | "ignore" => "", |
| [9284](#L9284) | "disable" => "", |
| [9285](#L9285) | "index" => "", |
| [9286](#L9286) | "check" => "", |
| [9287](#L9287) | "viewport" => "", |
| [9288](#L9288) | "fallback" => "", |
| [9289](#L9289) | "adb" => "", |
| [9290](#L9290) | "tracking" => "", |
| [9291](#L9291) | "css" => "", |
| [9292](#L9292) | "text" => "", |
| [9293](#L9293) | "selectors" => "", |
| [9294](#L9294) | "amp" => "", |
| [9295](#L9295) | "head" => "", |
| [9296](#L9296) | "rotate" => "", |
| [9297](#L9297) | "count" => "", |
| [9298](#L9298) | "counter" => "", |
| [9299](#L9299) | "http" => "", |
| [9300](#L9300) | "custom-field" => "", |
| [9301](#L9301) | "random" => "", |
| [9302](#L9302) | "data" => "", |
| [9303](#L9303) | "share" => "", |
| [9304](#L9304) | "time" => "", |
| [9305](#L9305) | "category" => "", |
| [9306](#L9306) | "categories" => "", |
| [9307](#L9307) | "tag" => "", |
| [9308](#L9308) | "tags" => "", |
| [9309](#L9309) | "taxonomy" => "", |
| [9310](#L9310) | "taxonomies" => "", |
| [9311](#L9311) | "id" => "", |
| [9312](#L9312) | "ids" => "", |
| [9313](#L9313) | "url" => "", |
| [9314](#L9314) | "urls" => "", |
| [9315](#L9315) | "url-parameter" => "", |
| [9316](#L9316) | "url-parameters" => "", |
| [9317](#L9317) | "cookie" => "", |
| [9318](#L9318) | "cookies" => "", |
| [9319](#L9319) | "referrer" => "", |
| [9320](#L9320) | "referrers" => "", |
| [9321](#L9321) | "client" => "", |
| [9322](#L9322) | "clients" => "", |
| [9323](#L9323) | "scheduling" => "", |
| [9324](#L9324) | "ip-address" => "", |
| [9325](#L9325) | "ip-addresses" => "", |
| [9326](#L9326) | "country" => "", |
| [9327](#L9327) | "countries" => "", |
| [9328](#L9328) | ), $atts); |
| [9329](#L9329) |  |
| [9330](#L9330) |  |
| [9331](#L9331) | $output = ""; |
| [9332](#L9332) | if (function\_exists ('ai\_shortcode')) { |
| [9333](#L9333) | $output = ai\_shortcode ($parameters); |
| [9334](#L9334) | if ($output != '') return $output; |
| [9335](#L9335) | } |
| [9336](#L9336) |  |
| [9337](#L9337) | if (($adb = trim ($parameters ['adb'])) != '') { |
| [9338](#L9338) | //    message html |
| [9339](#L9339) | //    message css |
| [9340](#L9340) | //    overlay css |
| [9341](#L9341) | //    undismissible |
| [9342](#L9342) |  |
| [9343](#L9343) | //    redirection page |
| [9344](#L9344) | //    redirection url |
| [9345](#L9345) |  |
| [9346](#L9346) | switch (strtolower ($adb)) { |
| [9347](#L9347) | case 'message': |
| [9348](#L9348) | $ai\_wp\_data [AI\_ADB\_SHORTCODE\_ACTION] = AI\_ADB\_ACTION\_MESSAGE; |
| [9349](#L9349) | break; |
| [9350](#L9350) | case 'redirection': |
| [9351](#L9351) | $ai\_wp\_data [AI\_ADB\_SHORTCODE\_ACTION] = AI\_ADB\_ACTION\_REDIRECTION; |
| [9352](#L9352) | break; |
| [9353](#L9353) | case 'no-action': |
| [9354](#L9354) | $ai\_wp\_data [AI\_ADB\_SHORTCODE\_ACTION] = AI\_ADB\_ACTION\_NONE; |
| [9355](#L9355) | break; |
| [9356](#L9356) | case 'disabled': |
| [9357](#L9357) | $ai\_wp\_data [AI\_ADB\_SHORTCODE\_DISABLED] = true; |
| [9358](#L9358) | break; |
| [9359](#L9359) | case 'external-scripts': |
| [9360](#L9360) | if (!get\_adb\_external\_scripts ()) { |
| [9361](#L9361) | return ai\_adb\_external\_scripts (); |
| [9362](#L9362) | } |
| [9363](#L9363) | } |
| [9364](#L9364) | return  ""; |
| [9365](#L9365) | } |
| [9366](#L9366) |  |
| [9367](#L9367) | if (($tracking = trim ($parameters ['tracking'])) != '') { |
| [9368](#L9368) | switch (strtolower ($tracking)) { |
| [9369](#L9369) | case 'disabled': |
| [9370](#L9370) | $ai\_wp\_data [AI\_TRACKING\_SHORTCODE\_DISABLED] = true; |
| [9371](#L9371) | break; |
| [9372](#L9372) | } |
| [9373](#L9373) | return  ""; |
| [9374](#L9374) | } |
| [9375](#L9375) |  |
| [9376](#L9376) | $block = - 1; |
| [9377](#L9377) | $code\_only = false; |
| [9378](#L9378) | $name\_only = false; |
| [9379](#L9379) |  |
| [9380](#L9380) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [9381](#L9381) |  |
| [9382](#L9382) | if ($parameters ['block'] == '' && $parameters ['code'] != '' && !($parameters ['viewport'] != '' || in\_array ('VIEWPORT', $atts) || in\_array ('viewport', $atts))) { |
| [9383](#L9383) | $parameters ['block'] = $parameters ['code']; |
| [9384](#L9384) | $code\_only = true; |
| [9385](#L9385) | } |
| [9386](#L9386) |  |
| [9387](#L9387) | // To convert name attribute to block |
| [9388](#L9388) | elseif ($parameters ['block'] == '' && $parameters ['name'] != '' && !($parameters ['rotate'] != '' || in\_array ('ROTATE', $atts) || in\_array ('rotate', $atts))) { |
| [9389](#L9389) | $parameters ['block'] = $parameters ['name']; |
| [9390](#L9390) | $name\_only = true; |
| [9391](#L9391) | } |
| [9392](#L9392) |  |
| [9393](#L9393) | if (is\_numeric ($parameters ['block']) && !$name\_only) { |
| [9394](#L9394) | $block = intval ($parameters ['block']); |
| [9395](#L9395) |  |
| [9396](#L9396) | //  } elseif ($parameters ['name'] != '' && !($parameters ['rotate'] != '' || in\_array ('ROTATE', $atts) || in\_array ('rotate', $atts))) { |
| [9397](#L9397) | //      $shortcode\_name = strtolower ($parameters ['name']); |
| [9398](#L9398) |  |
| [9399](#L9399) | } elseif ($parameters ['block'] != '' && !($parameters ['rotate'] != '' || in\_array ('ROTATE', $atts) || in\_array ('rotate', $atts))) { |
| [9400](#L9400) | $shortcode\_name = strtolower ($parameters ['block']); |
| [9401](#L9401) | for ($counter = 1; $counter <= 96; $counter ++) { |
| [9402](#L9402) | $obj = $block\_object [$counter]; |
| [9403](#L9403) | $ad\_name = strtolower (trim ($obj->get\_ad\_name())); |
| [9404](#L9404) |  |
| [9405](#L9405) | if ($shortcode\_name == $ad\_name && $obj->get\_enable\_manual ()) { |
| [9406](#L9406) | $block = $counter; |
| [9407](#L9407) | break; |
| [9408](#L9408) | } |
| [9409](#L9409) | } |
| [9410](#L9410) |  |
| [9411](#L9411) | if ($block == - 1) { |
| [9412](#L9412) | // Check if it is a reusable block with this name |
| [9413](#L9413) | $query = new WP\_Query ( |
| [9414](#L9414) | array ( |
| [9415](#L9415) | 'post\_type'       => 'wp\_block', // reusable block |
| [9416](#L9416) | 'title'           => $parameters ['block'], |
| [9417](#L9417) | 'post\_status'     => 'published', |
| [9418](#L9418) | 'posts\_per\_page'  => 1, |
| [9419](#L9419) | ) |
| [9420](#L9420) | ); |
| [9421](#L9421) |  |
| [9422](#L9422) | if (!empty ($query->post)) { |
| [9423](#L9423) | // Return reusable block |
| [9424](#L9424) | return $query->post->post\_content; |
| [9425](#L9425) | } |
| [9426](#L9426) | } |
| [9427](#L9427) |  |
| [9428](#L9428) | } |
| [9429](#L9429) |  |
| [9430](#L9430) | if ($block == - 1) { |
| [9431](#L9431) | if (function\_exists ('ai\_check\_separators')) { |
| [9432](#L9432) | if ($parameters ['check'] != '' || in\_array ('CHECK', $atts) || in\_array ('check', $atts)) { |
| [9433](#L9433) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['check'])) $ai\_wp\_data [AI\_SHORTCODES]['check'] = array (); |
| [9434](#L9434) | $ai\_wp\_data [AI\_SHORTCODES]['check'] []= $parameters; |
| [9435](#L9435) | return AD\_CHECK\_SEPARATOR; |
| [9436](#L9436) | } |
| [9437](#L9437) | } |
| [9438](#L9438) | if ($parameters ['viewport'] != '' || in\_array ('VIEWPORT', $atts) || in\_array ('viewport', $atts)) { |
| [9439](#L9439) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['viewport'])) $ai\_wp\_data [AI\_SHORTCODES]['viewport'] = array (); |
| [9440](#L9440) | $ai\_wp\_data [AI\_SHORTCODES]['viewport'] []= $parameters; |
| [9441](#L9441) | return '|viewport'. (count ($ai\_wp\_data [AI\_SHORTCODES]['viewport']) - 1). '|'; |
| [9442](#L9442) | } |
| [9443](#L9443) | if ($parameters ['count'] != '' || in\_array ('COUNT', $atts) || in\_array ('count', $atts)) { |
| [9444](#L9444) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['count'])) $ai\_wp\_data [AI\_SHORTCODES]['count'] = array (); |
| [9445](#L9445) | $ai\_wp\_data [AI\_SHORTCODES]['count'] []= $parameters; |
| [9446](#L9446) | //      return AD\_COUNT\_SEPARATOR; |
| [9447](#L9447) | return '|count'. (count ($ai\_wp\_data [AI\_SHORTCODES]['count']) - 1). '|'; |
| [9448](#L9448) | } |
| [9449](#L9449) | if ($parameters ['rotate'] != '' || in\_array ('ROTATE', $atts) || in\_array ('rotate', $atts)) { |
| [9450](#L9450) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['rotate'])) $ai\_wp\_data [AI\_SHORTCODES]['rotate'] = array (); |
| [9451](#L9451) | $ai\_wp\_data [AI\_SHORTCODES]['rotate'] []= $parameters; |
| [9452](#L9452) | //      return AD\_ROTATE\_SEPARATOR; |
| [9453](#L9453) | return '|rotate'. (count ($ai\_wp\_data [AI\_SHORTCODES]['rotate']) - 1). '|'; |
| [9454](#L9454) | } |
| [9455](#L9455) | if ($parameters ['amp'] != '' || in\_array ('AMP', $atts) || in\_array ('amp', $atts)) { |
| [9456](#L9456) | return AD\_AMP\_SEPARATOR; |
| [9457](#L9457) | } |
| [9458](#L9458) | if ($parameters ['head'] != '' || in\_array ('HEAD', $atts) || in\_array ('head', $atts)) { |
| [9459](#L9459) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['head'])) $ai\_wp\_data [AI\_SHORTCODES]['head'] = array (); |
| [9460](#L9460) | $ai\_wp\_data [AI\_SHORTCODES]['head'] []= $parameters; |
| [9461](#L9461) | return AD\_HEAD\_SEPARATOR; |
| [9462](#L9462) | } |
| [9463](#L9463) | if ($parameters ['http'] != '' || in\_array ('HTTP', $atts) || in\_array ('http', $atts)) { |
| [9464](#L9464) | return AD\_HTTP\_SEPARATOR; |
| [9465](#L9465) | } |
| [9466](#L9466) | if ($parameters ['fallback'] != '' || in\_array ('FALLBACK', $atts) || in\_array ('fallback', $atts)) { |
| [9467](#L9467) | if (!isset ($ai\_wp\_data [AI\_SHORTCODES]['fallback'])) $ai\_wp\_data [AI\_SHORTCODES]['fallback'] = array (); |
| [9468](#L9468) | $ai\_wp\_data [AI\_SHORTCODES]['fallback'] []= $parameters; |
| [9469](#L9469) | return AD\_FALLBACK\_SEPARATOR; |
| [9470](#L9470) | } |
| [9471](#L9471) | if ($parameters ['group'] != '' || in\_array ('GROUP', $atts) || in\_array ('group', $atts)) { |
| [9472](#L9472) |  |
| [9473](#L9473) | // Prevent group activation |
| [9474](#L9474) | if (isset ($ai\_wp\_data [AI\_NO\_GROUP\_ACTIVATION]) && $ai\_wp\_data [AI\_NO\_GROUP\_ACTIVATION]) { |
| [9475](#L9475) | return ''; |
| [9476](#L9476) | } |
| [9477](#L9477) |  |
| [9478](#L9478) | if ($parameters ['group'] != '') { |
| [9479](#L9479) | $parameters ['group'] = mb\_strtolower ($parameters ['group']); |
| [9480](#L9480) | if (strpos ($parameters ['group'], ',') !== false) { |
| [9481](#L9481) | $group\_names = explode (',', $parameters ['group']); |
| [9482](#L9482) | foreach ($group\_names as $index => $group\_name) { |
| [9483](#L9483) | $group\_names [$index] = trim ($group\_names [$index]); |
| [9484](#L9484) | } |
| [9485](#L9485) | } else $group\_names = array (trim ($parameters ['group'])); |
| [9486](#L9486) | } else $group\_names = array (); |
| [9487](#L9487) |  |
| [9488](#L9488) | return '<span data-ai-groups="' . base64\_encode (json\_encode ($group\_names)) . '"></span>'; |
| [9489](#L9489) | } |
| [9490](#L9490) | if ($parameters ['disable'] != '' || in\_array ('DISABLE', $atts) || in\_array ('disable', $atts)) { |
| [9491](#L9491) | if (!isset ($ai\_wp\_data [AI\_DISABLED\_BLOCKS])) $ai\_wp\_data [AI\_DISABLED\_BLOCKS] = array (); |
| [9492](#L9492) |  |
| [9493](#L9493) | $shortcode\_disabled = explode (',', strtolower (str\_replace (' ', '', $parameters ['disable']))); |
| [9494](#L9494) | $ai\_wp\_data [AI\_DISABLED\_BLOCKS] = array\_unique (array\_merge ($ai\_wp\_data [AI\_DISABLED\_BLOCKS], $shortcode\_disabled)); |
| [9495](#L9495) |  |
| [9496](#L9496) | if ($debug\_processing) { |
| [9497](#L9497) | ai\_log ('DISABLED BLOCKS: ' . implode (', ', $ai\_wp\_data [AI\_DISABLED\_BLOCKS])); |
| [9498](#L9498) | } |
| [9499](#L9499) |  |
| [9500](#L9500) | return ''; |
| [9501](#L9501) | } |
| [9502](#L9502) |  |
| [9503](#L9503) | if ($parameters ['custom-field'] != '') { |
| [9504](#L9504) | $custom\_field\_name = trim ($parameters ['custom-field']); |
| [9505](#L9505) |  |
| [9506](#L9506) | $default\_value = null; |
| [9507](#L9507) | if (trim ($parameters ['data']) != '') { |
| [9508](#L9508) | $custom\_field\_value = trim ($parameters ['data']); |
| [9509](#L9509) |  |
| [9510](#L9510) | if ($parameters ['data'][0] == ':') { |
| [9511](#L9511) | $default\_value = substr ($parameters ['data'], 1); |
| [9512](#L9512) | } else { |
| [9513](#L9513) | $ai\_wp\_data [AI\_CUSTOM\_FIELDS][$custom\_field\_name] = $custom\_field\_value; |
| [9514](#L9514) |  |
| [9515](#L9515) | return ''; |
| [9516](#L9516) | } |
| [9517](#L9517) | } |
| [9518](#L9518) |  |
| [9519](#L9519) | if (isset ($ai\_wp\_data [AI\_CUSTOM\_FIELDS][$custom\_field\_name])) { |
| [9520](#L9520) | return $ai\_wp\_data [AI\_CUSTOM\_FIELDS][$custom\_field\_name]; |
| [9521](#L9521) | } |
| [9522](#L9522) |  |
| [9523](#L9523) | $post\_meta = get\_post\_meta (get\_the\_ID (), $parameters ['custom-field']); |
| [9524](#L9524) |  |
| [9525](#L9525) | if (is\_array ($post\_meta)) { |
| [9526](#L9526) | $post\_meta = implode (', ', $post\_meta); |
| [9527](#L9527) | } |
| [9528](#L9528) |  |
| [9529](#L9529) | return empty ($post\_meta) && $default\_value !== null ? $default\_value : $post\_meta; |
| [9530](#L9530) | } |
| [9531](#L9531) |  |
| [9532](#L9532) | if ($parameters ['url-parameter'] != '') { |
| [9533](#L9533) | $url\_parameter = trim ($parameters ['url-parameter']); |
| [9534](#L9534) |  |
| [9535](#L9535) | return isset ($\_GET [$url\_parameter]) && is\_string ($\_GET [$url\_parameter]) ? htmlspecialchars ($\_GET [$url\_parameter]) : ''; |
| [9536](#L9536) | } |
| [9537](#L9537) |  |
| [9538](#L9538) | if ($parameters ['random'] != '' || isset ($atts ['RANDOM']) || isset ($atts ['random'])) { |
| [9539](#L9539) | $random\_value\_limits = trim ($parameters ['random']); |
| [9540](#L9540) | $random\_value = ''; |
| [9541](#L9541) | if ($random\_value\_limits == '') { |
| [9542](#L9542) | // Not used |
| [9543](#L9543) | $random\_value = rand (); |
| [9544](#L9544) | } else { |
| [9545](#L9545) | if (strpos ($random\_value\_limits, ',') !== false) { |
| [9546](#L9546) | $limits = explode (',', $random\_value\_limits); |
| [9547](#L9547) | $random\_value = rand ((int) $limits [0], (int) $limits [1]); |
| [9548](#L9548) | } else $random\_value = rand (0, (int) $random\_value\_limits); |
| [9549](#L9549) | } |
| [9550](#L9550) |  |
| [9551](#L9551) | return ($random\_value); |
| [9552](#L9552) | } |
| [9553](#L9553) |  |
| [9554](#L9554) | if ($parameters ['data'] != '') { |
| [9555](#L9555) | for ($constant = 1; $constant <= 6; $constant ++) { |
| [9556](#L9556) | $constant\_name = trim (get\_constant\_name ($constant)); |
| [9557](#L9557) | if ($constant\_name != '' && $parameters ['data'] == $constant\_name) { |
| [9558](#L9558) | return get\_constant\_value ($constant); |
| [9559](#L9559) | } |
| [9560](#L9560) | } |
| [9561](#L9561) |  |
| [9562](#L9562) | if (strpos ($parameters ['data'], ',') !== false) { |
| [9563](#L9563) | $data\_tags = explode (',', $parameters ['data']); |
| [9564](#L9564) | $data = array (); |
| [9565](#L9565) | foreach ($data\_tags as $data\_tag) { |
| [9566](#L9566) |  |
| [9567](#L9567) | $constant\_found = false; |
| [9568](#L9568) | for ($constant = 1; $constant <= 6; $constant ++) { |
| [9569](#L9569) | $constant\_name = trim (get\_constant\_name ($constant)); |
| [9570](#L9570) | if ($constant\_name != '' && $data\_tag == $constant\_name) { |
| [9571](#L9571) | $data []= get\_constant\_value ($constant); |
| [9572](#L9572) | $constant\_found = true; |
| [9573](#L9573) | break; |
| [9574](#L9574) | } |
| [9575](#L9575) | } |
| [9576](#L9576) |  |
| [9577](#L9577) | if (!$constant\_found) { |
| [9578](#L9578) | $data []= replace\_ai\_tags ('{'.trim ($data\_tag).'}'); |
| [9579](#L9579) | } |
| [9580](#L9580) | } |
| [9581](#L9581) | return implode (', ', $data); |
| [9582](#L9582) | } |
| [9583](#L9583) |  |
| [9584](#L9584) | return replace\_ai\_tags ('{'.$parameters ['data'].'}'); |
| [9585](#L9585) | } |
| [9586](#L9586) |  |
| [9587](#L9587) | if ($parameters ['counter'] != '') { |
| [9588](#L9588) | $counter\_name = strtolower ($parameters ['counter']); |
| [9589](#L9589) |  |
| [9590](#L9590) | $index = 0; |
| [9591](#L9591) | if ($parameters ['index'] != '' && is\_numeric ($parameters ['index'])) { |
| [9592](#L9592) | $index = (int) $parameters ['index']; |
| [9593](#L9593) | } |
| [9594](#L9594) |  |
| [9595](#L9595) | switch ($counter\_name) { |
| [9596](#L9596) | case 'block': |
| [9597](#L9597) | if (isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]) && isset ($ad\_inserter\_globals [AI\_BLOCK\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]])) { |
| [9598](#L9598) | return $ad\_inserter\_globals [AI\_BLOCK\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]] + $index; |
| [9599](#L9599) | } |
| [9600](#L9600) | break; |
| [9601](#L9601) | case 'content': |
| [9602](#L9602) | if (isset ($ad\_inserter\_globals [AI\_CONTENT\_COUNTER\_NAME])) { |
| [9603](#L9603) | return $ad\_inserter\_globals [AI\_CONTENT\_COUNTER\_NAME] + $index; |
| [9604](#L9604) | } |
| [9605](#L9605) | break; |
| [9606](#L9606) | case 'excerpt': |
| [9607](#L9607) | if (isset ($ad\_inserter\_globals [AI\_EXCERPT\_COUNTER\_NAME])) { |
| [9608](#L9608) | return $ad\_inserter\_globals [AI\_EXCERPT\_COUNTER\_NAME] + $index; |
| [9609](#L9609) | } |
| [9610](#L9610) | break; |
| [9611](#L9611) | case 'before-post': |
| [9612](#L9612) | if (isset ($ad\_inserter\_globals [AI\_LOOP\_BEFORE\_COUNTER\_NAME])) { |
| [9613](#L9613) | return $ad\_inserter\_globals [AI\_LOOP\_BEFORE\_COUNTER\_NAME] + $index; |
| [9614](#L9614) | } |
| [9615](#L9615) | break; |
| [9616](#L9616) | case 'after-post': |
| [9617](#L9617) | if (isset ($ad\_inserter\_globals [AI\_LOOP\_AFTER\_COUNTER\_NAME])) { |
| [9618](#L9618) | return $ad\_inserter\_globals [AI\_LOOP\_AFTER\_COUNTER\_NAME] + $index; |
| [9619](#L9619) | } |
| [9620](#L9620) | break; |
| [9621](#L9621) | case 'widget': |
| [9622](#L9622) | if (isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]) && isset ($ad\_inserter\_globals [AI\_WIDGET\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]])) { |
| [9623](#L9623) | return $ad\_inserter\_globals [AI\_WIDGET\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]] + $index; |
| [9624](#L9624) | } |
| [9625](#L9625) | break; |
| [9626](#L9626) | case 'php': |
| [9627](#L9627) | if (isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]) && isset ($ad\_inserter\_globals [AI\_PHP\_FUNCTION\_CALL\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]])) { |
| [9628](#L9628) | return $ad\_inserter\_globals [AI\_PHP\_FUNCTION\_CALL\_COUNTER\_NAME . $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]] + $index; |
| [9629](#L9629) | } |
| [9630](#L9630) | break; |
| [9631](#L9631) | } |
| [9632](#L9632) | return ''; |
| [9633](#L9633) | } |
| [9634](#L9634) | if ($parameters ['name'] != '') { |
| [9635](#L9635) | $shortcode\_name = strtolower ($parameters ['name']); |
| [9636](#L9636) | switch ($shortcode\_name) { |
| [9637](#L9637) | case 'processing-log': |
| [9638](#L9638) | if (/\*get\_remote\_debugging () ||\*/ ($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0) { |
| [9639](#L9639) | ob\_start (); |
| [9640](#L9640) | echo "<pre style='", AI\_DEBUG\_WIDGET\_STYLE, "'>\n"; |
| [9641](#L9641) | ai\_write\_debug\_info (); |
| [9642](#L9642) | echo "</pre>"; |
| [9643](#L9643) | return ob\_get\_clean (); |
| [9644](#L9644) | } |
| [9645](#L9645) | return ""; |
| [9646](#L9646) | case 'debugging-tools': |
| [9647](#L9647) | if (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 || defined ('AI\_DEBUGGING\_DEMO')) { |
| [9648](#L9648) | ob\_start (); |
| [9649](#L9649) | ai\_write\_debugging\_tools (); |
| [9650](#L9650) | return ob\_get\_clean (); |
| [9651](#L9651) | } |
| [9652](#L9652) | default: |
| [9653](#L9653) | if (defined ('AI\_BUFFERING')) { |
| [9654](#L9654) | if (get\_output\_buffering () && !get\_disable\_header\_code ()) { |
| [9655](#L9655) | return "<!--[AI\_HEAD\_GROUPS $shortcode\_name]-->"; |
| [9656](#L9656) | } |
| [9657](#L9657) | } |
| [9658](#L9658) | return ""; |
| [9659](#L9659) | } |
| [9660](#L9660) | } |
| [9661](#L9661) | } |
| [9662](#L9662) |  |
| [9663](#L9663) | $ai\_last\_check = AI\_CHECK\_SHORTCODE\_ATTRIBUTES; |
| [9664](#L9664) | if ($block < 1 || $block > 96) return ""; |
| [9665](#L9665) |  |
| [9666](#L9666) | //  if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("SHORTCODE $block (".($parameters ['block'] != '' ? 'block="'.$parameters ['block'].'"' : '').($parameters ['name'] != '' ? 'name="'.$parameters ['name'].'"' : '').")"); |
| [9667](#L9667) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) ai\_log ("SHORTCODE ADINSERTER ".($parameters ['block'] != '' ? 'block="'.$block.'" ' : '').($parameters ['name'] != '' ? 'name="'.$parameters ['name'].'"' : '').""); |
| [9668](#L9668) |  |
| [9669](#L9669) | //  IGNORE SETTINGS |
| [9670](#L9670) | //  page-type |
| [9671](#L9671) | //  post-id |
| [9672](#L9672) | //  category |
| [9673](#L9673) | //  tag |
| [9674](#L9674) | //  taxonomy |
| [9675](#L9675) | //  \*block-counter |
| [9676](#L9676) |  |
| [9677](#L9677) | //  CHECK SETTINGS |
| [9678](#L9678) | //  exceptions |
| [9679](#L9679) |  |
| [9680](#L9680) | $ignore\_array = array (); |
| [9681](#L9681) | if (trim ($parameters ['ignore']) != '') { |
| [9682](#L9682) | $ignore\_array = explode (",", str\_replace (" ", "", $parameters ['ignore'])); |
| [9683](#L9683) | } |
| [9684](#L9684) |  |
| [9685](#L9685) | $check\_array = array (); |
| [9686](#L9686) | if (trim ($parameters ['check']) != '') { |
| [9687](#L9687) | $check\_array = explode (",", str\_replace (" ", "", $parameters ['check'])); |
| [9688](#L9688) | } |
| [9689](#L9689) |  |
| [9690](#L9690) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_SHORTCODE; |
| [9691](#L9691) |  |
| [9692](#L9692) | $obj = $block\_object [$block]; |
| [9693](#L9693) | $obj->clear\_code\_cache (); |
| [9694](#L9694) |  |
| [9695](#L9695) | $ai\_last\_check = AI\_CHECK\_ENABLED\_SHORTCODE; |
| [9696](#L9696) | if (!$obj->get\_enable\_manual ()) return ""; |
| [9697](#L9697) |  |
| [9698](#L9698) | if (!$obj->check\_server\_side\_detection ()) return ""; |
| [9699](#L9699) | if (!$obj->check\_page\_types\_lists\_users (in\_array ("page-type", $ignore\_array), in\_array ("category", $ignore\_array), in\_array ("tag", $ignore\_array), in\_array ("taxonomy", $ignore\_array), in\_array ("post-id", $ignore\_array))) return ""; |
| [9700](#L9700) |  |
| [9701](#L9701) | if (in\_array ("exceptions", $check\_array)) { |
| [9702](#L9702) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [9703](#L9703) | //      $meta\_value = get\_post\_meta (get\_the\_ID (), '\_adinserter\_block\_exceptions', true); |
| [9704](#L9704) | $meta\_value = ai\_get\_post\_meta (); |
| [9705](#L9705) |  |
| [9706](#L9706) | $selected\_blocks = explode (",", $meta\_value); |
| [9707](#L9707) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) return ""; |
| [9708](#L9708) | } |
| [9709](#L9709) | } |
| [9710](#L9710) |  |
| [9711](#L9711) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [9712](#L9712) | if (!$obj->check\_disabled ()) return ""; |
| [9713](#L9713) |  |
| [9714](#L9714) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [9715](#L9715) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) return ""; |
| [9716](#L9716) |  |
| [9717](#L9717) | // Last check before counter check before insertion |
| [9718](#L9718) | //  $ai\_last\_check = AI\_CHECK\_CODE; |
| [9719](#L9719) | //  if ($obj->ai\_getCode () == '') return ""; |
| [9720](#L9720) | if ($obj->empty\_code ()) return ""; |
| [9721](#L9721) |  |
| [9722](#L9722) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [9723](#L9723) | if ($max\_page\_blocks\_enabled) { |
| [9724](#L9724) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [9725](#L9725) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) return ""; |
| [9726](#L9726) | } |
| [9727](#L9727) |  |
| [9728](#L9728) | if (!$obj->check\_filter\_hook ($debug\_processing)) return ""; |
| [9729](#L9729) |  |
| [9730](#L9730) | // Last check before insertion |
| [9731](#L9731) | if (!$obj->check\_and\_increment\_block\_counter ()) return ""; |
| [9732](#L9732) |  |
| [9733](#L9733) | // Increment page block counter |
| [9734](#L9734) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [9735](#L9735) |  |
| [9736](#L9736) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [9737](#L9737) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [9738](#L9738) |  |
| [9739](#L9739) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['force\_serverside'])) { |
| [9740](#L9740) | $saved\_force\_serverside = $ai\_wp\_data [AI\_SHORTCODES]['force\_serverside']; |
| [9741](#L9741) | } |
| [9742](#L9742) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['viewport'])) { |
| [9743](#L9743) | $saved\_viewport = $ai\_wp\_data [AI\_SHORTCODES]['viewport']; |
| [9744](#L9744) | } |
| [9745](#L9745) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['check'])) { |
| [9746](#L9746) | $saved\_check = $ai\_wp\_data [AI\_SHORTCODES]['check']; |
| [9747](#L9747) | } |
| [9748](#L9748) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['count'])) { |
| [9749](#L9749) | $saved\_count = $ai\_wp\_data [AI\_SHORTCODES]['count']; |
| [9750](#L9750) | } |
| [9751](#L9751) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['rotate'])) { |
| [9752](#L9752) | $saved\_rotate = $ai\_wp\_data [AI\_SHORTCODES]['rotate']; |
| [9753](#L9753) | } |
| [9754](#L9754) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['head'])) { |
| [9755](#L9755) | $saved\_head = $ai\_wp\_data [AI\_SHORTCODES]['head']; |
| [9756](#L9756) | } |
| [9757](#L9757) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['fallback'])) { |
| [9758](#L9758) | $saved\_fallback = $ai\_wp\_data [AI\_SHORTCODES]['fallback']; |
| [9759](#L9759) | } |
| [9760](#L9760) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['atts'])) { |
| [9761](#L9761) | $saved\_atts = $ai\_wp\_data [AI\_SHORTCODES]['atts']; |
| [9762](#L9762) | } |
| [9763](#L9763) | $ai\_wp\_data [AI\_SHORTCODES]['atts'] = $atts; |
| [9764](#L9764) | if (isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER])) { |
| [9765](#L9765) | $saved\_block\_number = $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]; |
| [9766](#L9766) | } |
| [9767](#L9767) | if (isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME])) { |
| [9768](#L9768) | $saved\_block\_name = $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME]; |
| [9769](#L9769) | } |
| [9770](#L9770) |  |
| [9771](#L9771) | $code = $obj->get\_code\_for\_serverside\_insertion (true, false, $code\_only); |
| [9772](#L9772) |  |
| [9773](#L9773) | if (isset ($saved\_force\_serverside)) { |
| [9774](#L9774) | $ai\_wp\_data [AI\_SHORTCODES]['force\_serverside'] = $saved\_force\_serverside; |
| [9775](#L9775) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['force\_serverside']); |
| [9776](#L9776) | if (isset ($saved\_viewport)) { |
| [9777](#L9777) | $ai\_wp\_data [AI\_SHORTCODES]['viewport'] = $saved\_viewport; |
| [9778](#L9778) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['viewport']); |
| [9779](#L9779) | if (isset ($saved\_check)) { |
| [9780](#L9780) | $ai\_wp\_data [AI\_SHORTCODES]['check'] = $saved\_check; |
| [9781](#L9781) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['check']); |
| [9782](#L9782) | if (isset ($saved\_count)) { |
| [9783](#L9783) | $ai\_wp\_data [AI\_SHORTCODES]['count'] = $saved\_count; |
| [9784](#L9784) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['count']); |
| [9785](#L9785) | if (isset ($saved\_rotate)) { |
| [9786](#L9786) | $ai\_wp\_data [AI\_SHORTCODES]['rotate'] = $saved\_rotate; |
| [9787](#L9787) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['rotate']); |
| [9788](#L9788) | if (isset ($saved\_fallback)) { |
| [9789](#L9789) | $ai\_wp\_data [AI\_SHORTCODES]['fallback'] = $saved\_fallback; |
| [9790](#L9790) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['fallback']); |
| [9791](#L9791) | if (isset ($saved\_head)) { |
| [9792](#L9792) | $ai\_wp\_data [AI\_SHORTCODES]['head'] = $saved\_head; |
| [9793](#L9793) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['head']); |
| [9794](#L9794) | if (isset ($saved\_atts)) { |
| [9795](#L9795) | $ai\_wp\_data [AI\_SHORTCODES]['atts'] = $saved\_atts; |
| [9796](#L9796) | } else unset ($ai\_wp\_data [AI\_SHORTCODES]['atts']); |
| [9797](#L9797) | if (isset ($saved\_block\_number)) { |
| [9798](#L9798) | $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER] = $saved\_block\_number; |
| [9799](#L9799) | } else unset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]); |
| [9800](#L9800) | if (isset ($saved\_block\_number)) { |
| [9801](#L9801) | $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME] = $saved\_block\_name; |
| [9802](#L9802) | } else unset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME]); |
| [9803](#L9803) |  |
| [9804](#L9804) | // Must be after get\_code\_for\_serverside\_insertion () |
| [9805](#L9805) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [9806](#L9806) | return $code; |
| [9807](#L9807) | } |
| [9808](#L9808) | } |
| [9809](#L9809) |  |
| [9810](#L9810) | function ai\_process\_shortcodes ($atts, $content, $tag) { |
| [9811](#L9811) | global $ai\_last\_check, $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [9812](#L9812) |  |
| [9813](#L9813) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [9814](#L9814) | if ($debug\_processing) { |
| [9815](#L9815) | $atts\_string = ''; |
| [9816](#L9816) | if (is\_array ($atts)) |
| [9817](#L9817) | foreach ($atts as $index => $att) { |
| [9818](#L9818) | if (is\_numeric ($index)) |
| [9819](#L9819) | $atts\_string .= $att.' '; else |
| [9820](#L9820) | $atts\_string .= $index.("='".$att."'").' '; |
| [9821](#L9821) | } |
| [9822](#L9822) | ai\_log ("PROCESS SHORTCODES [$tag ".trim ($atts\_string).']'); |
| [9823](#L9823) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [9824](#L9824) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [9825](#L9825) | $start\_time = microtime (true); |
| [9826](#L9826) | } |
| [9827](#L9827) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [9828](#L9828) | $block = - 1; |
| [9829](#L9829) | $shortcode = ai\_process\_shortcode ($block, $atts); |
| [9830](#L9830) |  |
| [9831](#L9831) | if ($debug\_processing) { |
| [9832](#L9832) | if ($block == - 1) { |
| [9833](#L9833) | if (strlen ($shortcode) < 100) ai\_log ('SHORTCODE TEXT: "' . ai\_log\_filter\_content ($shortcode) . '"'); else |
| [9834](#L9834) | ai\_log ('SHORTCODE TEXT: "' . ai\_log\_filter\_content (html\_entity\_decode (substr ($shortcode, 0, 60))) . ' ... ' . ai\_log\_filter\_content (html\_entity\_decode (substr ($shortcode, - 60))) . '"'); |
| [9835](#L9835) | } |
| [9836](#L9836) | elseif ($ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($block, $ai\_last\_check)); |
| [9837](#L9837) | if (!$ai\_processing\_time\_active) { |
| [9838](#L9838) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [9839](#L9839) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [9840](#L9840) | } |
| [9841](#L9841) | ai\_log ("SHORTCODE END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [9842](#L9842) | } |
| [9843](#L9843) |  |
| [9844](#L9844) | return $shortcode; |
| [9845](#L9845) | } |
| [9846](#L9846) |  |
| [9847](#L9847) |  |
| [9848](#L9848) | function ai\_add\_attr\_data (&$tag, $attr, $new\_data) { |
| [9849](#L9849) |  |
| [9850](#L9850) | if (trim ($tag) != '' && strpos ($tag,  '<!--') === false) { |
| [9851](#L9851) | if (stripos ($tag, $attr."=") !== false) { |
| [9852](#L9852) | preg\_match ("/$attr=[\'\"](.+?)[\'\"]/", $tag, $classes); |
| [9853](#L9853) | $tag = str\_replace ($classes [1], $classes [1]. ' ' . $new\_data, $tag); |
| [9854](#L9854) | return true; |
| [9855](#L9855) | } |
| [9856](#L9856) | elseif (strpos ($tag, ">") !== false) { |
| [9857](#L9857) | $tag = str\_replace ('>', ' ' . $attr . '="' . $new\_data . '">', $tag); |
| [9858](#L9858) | return true; |
| [9859](#L9859) | } |
| [9860](#L9860) | } |
| [9861](#L9861) |  |
| [9862](#L9862) | return false; |
| [9863](#L9863) | } |
| [9864](#L9864) |  |
| [9865](#L9865) | function ai\_debug\_widget\_comment ($label, $end = false) { |
| [9866](#L9866) | $end\_label = ''; |
| [9867](#L9867) | if ($end) { |
| [9868](#L9868) | $end\_label = '/'; |
| [9869](#L9869) | } |
| [9870](#L9870) | echo "<!-- {$end\_label}AI $label -->"; |
| [9871](#L9871) | } |
| [9872](#L9872) |  |
| [9873](#L9873) | function ai\_widget\_draw ($args, $instance, &$block) { |
| [9874](#L9874) | global $block\_object, $ad\_inserter\_globals, $ai\_wp\_data, $ai\_last\_check; |
| [9875](#L9875) |  |
| [9876](#L9876) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [9877](#L9877) |  |
| [9878](#L9878) | $block  = isset ($instance ['block'])  ? $instance ['block']  : 1; |
| [9879](#L9879) | $sticky = isset ($instance ['sticky']) ? $instance ['sticky'] : 0; |
| [9880](#L9880) |  |
| [9881](#L9881) | if ($block == 0 || $block == - 2) { |
| [9882](#L9882) | if (!get\_disable\_block\_insertions () && (($ai\_wp\_data [AI\_WP\_USER] & AI\_USER\_ADMINISTRATOR) != 0 || defined ('AI\_DEBUGGING\_DEMO'))) { |
| [9883](#L9883) | ai\_special\_widget ($args, $instance, $block); |
| [9884](#L9884) | } |
| [9885](#L9885) | return; |
| [9886](#L9886) | } |
| [9887](#L9887) |  |
| [9888](#L9888) | if ($sticky) { |
| [9889](#L9889) | $ai\_wp\_data [AI\_STICKY\_WIDGETS] = true; |
| [9890](#L9890) | if ($block == - 1 && !get\_disable\_block\_insertions ()) { |
| [9891](#L9891) | // Dummy widget |
| [9892](#L9892) | $before\_widget = $args ['before\_widget']; |
| [9893](#L9893) | ai\_add\_attr\_data ($before\_widget, 'style', 'padding: 0; border: 0; margin: 0; color: transparent; background: transparent;'); |
| [9894](#L9894) | ai\_add\_attr\_data ($before\_widget, 'class', 'ai-sticky-widget'); |
| [9895](#L9895) |  |
| [9896](#L9896) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget'); |
| [9897](#L9897) | echo $before\_widget; |
| [9898](#L9898) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget', true); |
| [9899](#L9899) |  |
| [9900](#L9900) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget'); |
| [9901](#L9901) | // No sense for empty dummy widgets |
| [9902](#L9902) | //      if (get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [9903](#L9903) | //        echo '<div class="ai-sticky-space" style="height: 1500px;"></div>'; |
| [9904](#L9904) | //      } |
| [9905](#L9905) | echo $args ['after\_widget']; |
| [9906](#L9906) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget', true); |
| [9907](#L9907) |  |
| [9908](#L9908) | return; |
| [9909](#L9909) | } |
| [9910](#L9910) | } |
| [9911](#L9911) |  |
| [9912](#L9912) | if ($block < 1 || $block > 96) return; |
| [9913](#L9913) |  |
| [9914](#L9914) | $title = !empty ($instance ['widget-title']) ? $instance ['widget-title'] : ''; |
| [9915](#L9915) |  |
| [9916](#L9916) | $obj = $block\_object [$block]; |
| [9917](#L9917) | $obj->clear\_code\_cache (); |
| [9918](#L9918) |  |
| [9919](#L9919) | $globals\_name = AI\_WIDGET\_COUNTER\_NAME . $block; |
| [9920](#L9920) |  |
| [9921](#L9921) | if (!isset ($ad\_inserter\_globals [$globals\_name])) { |
| [9922](#L9922) | $ad\_inserter\_globals [$globals\_name] = 1; |
| [9923](#L9923) | } else $ad\_inserter\_globals [$globals\_name] ++; |
| [9924](#L9924) |  |
| [9925](#L9925) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) |
| [9926](#L9926) | ai\_log ("WIDGET (". $obj->number . ') ['.$ad\_inserter\_globals [$globals\_name] . ']'); |
| [9927](#L9927) |  |
| [9928](#L9928) | $ai\_wp\_data [AI\_CONTEXT] = AI\_CONTEXT\_WIDGET; |
| [9929](#L9929) |  |
| [9930](#L9930) | $ai\_last\_check = AI\_CHECK\_ENABLED\_WIDGET; |
| [9931](#L9931) | if (!$obj->get\_enable\_widget ()) return; |
| [9932](#L9932) | if (!$obj->check\_server\_side\_detection ()) return; |
| [9933](#L9933) | if (!$obj->check\_page\_types\_lists\_users ()) return; |
| [9934](#L9934) | if (!$obj->check\_filter ($ad\_inserter\_globals [$globals\_name])) return; |
| [9935](#L9935) | if (!$obj->check\_number\_of\_words ()) return; |
| [9936](#L9936) |  |
| [9937](#L9937) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC) { |
| [9938](#L9938) | //    $meta\_value = get\_post\_meta (get\_the\_ID (), '\_adinserter\_block\_exceptions', true); |
| [9939](#L9939) | $meta\_value = ai\_get\_post\_meta (); |
| [9940](#L9940) |  |
| [9941](#L9941) | $selected\_blocks = explode (",", $meta\_value); |
| [9942](#L9942) | if (!$obj->check\_post\_page\_exceptions ($selected\_blocks)) return; |
| [9943](#L9943) | } |
| [9944](#L9944) |  |
| [9945](#L9945) | $ai\_last\_check = AI\_CHECK\_DISABLED\_MANUALLY; |
| [9946](#L9946) | if (!$obj->check\_disabled ()) return; |
| [9947](#L9947) |  |
| [9948](#L9948) | $ai\_last\_check = AI\_CHECK\_INSERTION\_NOT\_DISABLED; |
| [9949](#L9949) | if ($obj->get\_disable\_insertion () || get\_disable\_block\_insertions ()) return; |
| [9950](#L9950) |  |
| [9951](#L9951) | // Last check before counter check before insertion |
| [9952](#L9952) | $ai\_last\_check = AI\_CHECK\_CODE; |
| [9953](#L9953) | if ($obj->ai\_getCode () == '') { |
| [9954](#L9954) | if ($sticky) { |
| [9955](#L9955) | $before\_widget = $args ['before\_widget']; |
| [9956](#L9956) | ai\_add\_attr\_data ($before\_widget, 'style', 'padding: 0; border: 0; margin: 0; color: transparent; background: transparent;'); |
| [9957](#L9957) | ai\_add\_attr\_data ($before\_widget, 'class', 'ai-sticky-widget'); |
| [9958](#L9958) |  |
| [9959](#L9959) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget'); |
| [9960](#L9960) | echo $before\_widget; |
| [9961](#L9961) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget', true); |
| [9962](#L9962) |  |
| [9963](#L9963) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget'); |
| [9964](#L9964) | // No sense for empty widgets |
| [9965](#L9965) | //      if (get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [9966](#L9966) | //        echo '<div class="ai-sticky-space" style="height: 1500px;"></div>'; |
| [9967](#L9967) | //      } |
| [9968](#L9968) | echo $args ['after\_widget']; |
| [9969](#L9969) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget', true); |
| [9970](#L9970) | } |
| [9971](#L9971) | return; |
| [9972](#L9972) | } |
| [9973](#L9973) |  |
| [9974](#L9974) | $max\_page\_blocks\_enabled = $obj->get\_max\_page\_blocks\_enabled (); |
| [9975](#L9975) | if ($max\_page\_blocks\_enabled) { |
| [9976](#L9976) | $ai\_last\_check = AI\_CHECK\_MAX\_PAGE\_BLOCKS; |
| [9977](#L9977) | if ($ai\_wp\_data [AI\_PAGE\_BLOCKS] >= get\_max\_page\_blocks ()) return; |
| [9978](#L9978) | } |
| [9979](#L9979) |  |
| [9980](#L9980) | if (!$obj->check\_filter\_hook ($debug\_processing)) return; |
| [9981](#L9981) |  |
| [9982](#L9982) | // Last check before insertion |
| [9983](#L9983) | if (!$obj->check\_and\_increment\_block\_counter ()) return; |
| [9984](#L9984) |  |
| [9985](#L9985) | // Increment page block counter |
| [9986](#L9986) | if ($max\_page\_blocks\_enabled) $ai\_wp\_data [AI\_PAGE\_BLOCKS] ++; |
| [9987](#L9987) |  |
| [9988](#L9988) | $ai\_last\_check = AI\_CHECK\_DEBUG\_NO\_INSERTION; |
| [9989](#L9989) | if (!$obj->get\_debug\_disable\_insertion ()) { |
| [9990](#L9990) |  |
| [9991](#L9991) | $viewport\_classes = $obj->get\_client\_side\_action () == AI\_CLIENT\_SIDE\_ACTION\_INSERT ? '' : trim ($obj->get\_viewport\_classes ()); |
| [9992](#L9992) | $sticky\_class = $sticky ? ' ai-sticky-widget' : ''; |
| [9993](#L9993) | $widget\_classes = trim ($viewport\_classes . $sticky\_class); |
| [9994](#L9994) |  |
| [9995](#L9995) | $before\_widget = $args ['before\_widget']; |
| [9996](#L9996) | if ($widget\_classes != "") { |
| [9997](#L9997) | ai\_add\_attr\_data ($before\_widget, 'class', $widget\_classes); |
| [9998](#L9998) | } |
| [9999](#L9999) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget'); |
| [10000](#L10000) | echo $before\_widget; |
| [10001](#L10001) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget', true); |
| [10002](#L10002) |  |
| [10003](#L10003) | if (!empty ($title)) { |
| [10004](#L10004) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_title'); |
| [10005](#L10005) | echo $args ['before\_title']; |
| [10006](#L10006) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_title', true); |
| [10007](#L10007) |  |
| [10008](#L10008) | echo apply\_filters ('widget\_title', $title); |
| [10009](#L10009) |  |
| [10010](#L10010) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_title'); |
| [10011](#L10011) | echo $args ['after\_title']; |
| [10012](#L10012) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_title', true); |
| [10013](#L10013) | } |
| [10014](#L10014) |  |
| [10015](#L10015) | $obj->needs\_class = true; |
| [10016](#L10016) | echo $obj->get\_code\_for\_serverside\_insertion (false); |
| [10017](#L10017) |  |
| [10018](#L10018) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget'); |
| [10019](#L10019) | if ($sticky && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [10020](#L10020) | echo '<div class="ai-sticky-space" style="height: 1500px;"></div>'; |
| [10021](#L10021) | } |
| [10022](#L10022) | echo $args ['after\_widget']; |
| [10023](#L10023) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget', true); |
| [10024](#L10024) |  |
| [10025](#L10025) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_BLOCKS) != 0 && $obj->get\_detection\_client\_side () && $obj->get\_client\_side\_action () == AI\_CLIENT\_SIDE\_ACTION\_SHOW) |
| [10026](#L10026) | echo $obj->get\_code\_for\_serverside\_insertion (false, true); |
| [10027](#L10027) |  |
| [10028](#L10028) | $ai\_last\_check = AI\_CHECK\_INSERTED; |
| [10029](#L10029) | } |
| [10030](#L10030) | } |
| [10031](#L10031) |  |
| [10032](#L10032) | function ai\_write\_debugging\_tools () { |
| [10033](#L10033) | global $ai\_wp\_data; |
| [10034](#L10034) |  |
| [10035](#L10035) | ai\_toolbar\_menu\_items (); |
| [10036](#L10036) |  |
| [10037](#L10037) |  |
| [10038](#L10038) | echo "<style> |
| [10039](#L10039) |  |
| [10040](#L10040) | ul.ai-debug-tools { |
| [10041](#L10041) | list-style: none; |
| [10042](#L10042) | background: #000; |
| [10043](#L10043) | color: #eee; |
| [10044](#L10044) | margin: 0; |
| [10045](#L10045) | padding: 10px; |
| [10046](#L10046) | font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen-Sans,Ubuntu,Cantarell,'Helvetica Neue',sans-serif; |
| [10047](#L10047) | font-size: 14px; |
| [10048](#L10048) | line-height: 22px; |
| [10049](#L10049) | -webkit-user-select: none;  /\* Chrome all / Safari all \*/ |
| [10050](#L10050) | -moz-user-select: none;     /\* Firefox all \*/ |
| [10051](#L10051) | -ms-user-select: none;      /\* IE 10+ \*/ |
| [10052](#L10052) | user-select: none; |
| [10053](#L10053) | } |
| [10054](#L10054) |  |
| [10055](#L10055) | ul.ai-debug-tools li { |
| [10056](#L10056) | margin: 0; |
| [10057](#L10057) | padding: 0; |
| [10058](#L10058) | border: 0; |
| [10059](#L10059) | } |
| [10060](#L10060) |  |
| [10061](#L10061) | ul.ai-debug-tools a, ul.ai-debug-tools a:link, ul.ai-debug-tools a:visited { |
| [10062](#L10062) | text-decoration: none; |
| [10063](#L10063) | color: #aaa; |
| [10064](#L10064) | } |
| [10065](#L10065) |  |
| [10066](#L10066) | ul.ai-debug-tools a:hover { |
| [10067](#L10067) | color: #5faff9!important; |
| [10068](#L10068) | } |
| [10069](#L10069) |  |
| [10070](#L10070) | ul.ai-debug-tools .ab-icon { |
| [10071](#L10071) | position: relative; |
| [10072](#L10072) | font: 400 20px/1 dashicons; |
| [10073](#L10073) | speak: none; |
| [10074](#L10074) | padding: 4px 0; |
| [10075](#L10075) | -webkit-font-smoothing: antialiased; |
| [10076](#L10076) | -moz-osx-font-smoothing: grayscale; |
| [10077](#L10077) | background-image: none!important; |
| [10078](#L10078) | margin-right: 6px; |
| [10079](#L10079) | vertical-align: text-top; |
| [10080](#L10080) | } |
| [10081](#L10081) |  |
| [10082](#L10082) | ul.ai-debug-tools .ai-debug-tools-title { |
| [10083](#L10083) | padding-bottom: 10px; |
| [10084](#L10084) | } |
| [10085](#L10085) |  |
| [10086](#L10086) | .ai-debug-tools-title .ab-icon:before { |
| [10087](#L10087) | content: '\\f538'; |
| [10088](#L10088) | top: 2px; |
| [10089](#L10089) | color: rgba(240,245,250,.6)!important; |
| [10090](#L10090) | } |
| [10091](#L10091) | ul.ai-debug-tools .ab-icon.on:before { |
| [10092](#L10092) | color: #00f200!important; |
| [10093](#L10093) | } |
| [10094](#L10094) | ul.ai-debug-tools .ab-icon.red:before { |
| [10095](#L10095) | color: #f22!important; |
| [10096](#L10096) | } |
| [10097](#L10097) | ul li.ai-debug-ai-toolbar-status { |
| [10098](#L10098) | color: #aaa; |
| [10099](#L10099) | margin: 0 0 10px 0; |
| [10100](#L10100) | } |
| [10101](#L10101) | .ai-debug-ai-toolbar-off .ab-icon:before { |
| [10102](#L10102) | content: '\\f153'; |
| [10103](#L10103) | } |
| [10104](#L10104) | .ai-debug-ai-toolbar-blocks .ab-icon:before { |
| [10105](#L10105) | content: '\\f135'; |
| [10106](#L10106) | } |
| [10107](#L10107) | .ai-debug-ai-toolbar-positions .ab-icon:before { |
| [10108](#L10108) | content: '\\f207'; |
| [10109](#L10109) | } |
| [10110](#L10110) | ul.ai-debug-tools .ai-debug-tools-positions { |
| [10111](#L10111) | margin-left: 22px; |
| [10112](#L10112) | } |
| [10113](#L10113) | .ai-debug-tools-positions .ab-icon:before { |
| [10114](#L10114) | content: '\\f522'; |
| [10115](#L10115) | } |
| [10116](#L10116) | .ai-debug-ai-toolbar-tags .ab-icon:before { |
| [10117](#L10117) | content: '\\f475'; |
| [10118](#L10118) | } |
| [10119](#L10119) | .ai-debug-ai-toolbar-no-insertion .ab-icon:before { |
| [10120](#L10120) | content: '\\f214'; |
| [10121](#L10121) | } |
| [10122](#L10122) | .ai-debug-ai-toolbar-adb-status .ab-icon:before { |
| [10123](#L10123) | content: '\\f223'; |
| [10124](#L10124) | } |
| [10125](#L10125) | .ai-debug-ai-toolbar-adb .ab-icon:before { |
| [10126](#L10126) | content: '\\f160'; |
| [10127](#L10127) | } |
| [10128](#L10128) | .ai-debug-ai-toolbar-processing .ab-icon:before { |
| [10129](#L10129) | content: '\\f464'; |
| [10130](#L10130) | } |
| [10131](#L10131) | </style> |
| [10132](#L10132) | "; |
| [10133](#L10133) | echo ' |
| [10134](#L10134) | <ul class="ai-debug-tools"> |
| [10135](#L10135) | '; |
| [10136](#L10136) | foreach ($ai\_wp\_data [AI\_DEBUG\_MENU\_ITEMS] as $menu\_item) { |
| [10137](#L10137) | if (isset ($menu\_item ['parent'])) { |
| [10138](#L10138) | if ($menu\_item ['parent'] == 'ai-toolbar-settings') { |
| [10139](#L10139) | if ($menu\_item ['id'] == 'ai-toolbar-status') { |
| [10140](#L10140) | echo '  <li class="ai-debug-', $menu\_item ['id'], '">'; |
| [10141](#L10141) | echo $menu\_item ['title']; |
| [10142](#L10142) | echo "</li>\n"; |
| [10143](#L10143) | } else { |
| [10144](#L10144) | echo '  <li class="ai-debug-', $menu\_item ['id'], '">'; |
| [10145](#L10145) | echo '<a href="', $menu\_item ['href'], '">', $menu\_item ['title'], '</a>'; |
| [10146](#L10146) | echo "</li>\n"; |
| [10147](#L10147) | } |
| [10148](#L10148) | } |
| [10149](#L10149) | elseif ($menu\_item ['parent'] == 'ai-toolbar-positions') { |
| [10150](#L10150) | echo '  <li class="ai-debug-', $menu\_item ['id'], ' ai-debug-tools-positions">'; |
| [10151](#L10151) | echo '<a href="', $menu\_item ['href'], '">', $menu\_item ['title'], '</a>'; |
| [10152](#L10152) | echo "</li>\n"; |
| [10153](#L10153) | } |
| [10154](#L10154) | } else if ($menu\_item ['id'] == 'ai-toolbar-settings') { |
| [10155](#L10155) | echo '  <li class="ai-debug-', $menu\_item ['id'], ' ai-debug-tools-title">'; |
| [10156](#L10156) | echo '<a href="', $menu\_item ['href'], '">', $menu\_item ['title'], '</a>'; |
| [10157](#L10157) | echo "</li>\n"; |
| [10158](#L10158) | } |
| [10159](#L10159) | } |
| [10160](#L10160) |  |
| [10161](#L10161) | echo '</ul> |
| [10162](#L10162) | '; |
| [10163](#L10163) | } |
| [10164](#L10164) |  |
| [10165](#L10165) | function ai\_special\_widget ($args, $instance, $block) { |
| [10166](#L10166) | global $ai\_wp\_data, $ai\_db\_options, $block\_object; |
| [10167](#L10167) |  |
| [10168](#L10168) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [10169](#L10169) |  |
| [10170](#L10170) | $sticky = isset ($instance ['sticky']) ? $instance ['sticky'] : 0; |
| [10171](#L10171) |  |
| [10172](#L10172) | if ($sticky) { |
| [10173](#L10173) | $ai\_wp\_data [AI\_STICKY\_WIDGETS] = true; |
| [10174](#L10174) | ai\_add\_attr\_data ($args ['before\_widget'], 'class', 'ai-sticky-widget'); |
| [10175](#L10175) | } |
| [10176](#L10176) |  |
| [10177](#L10177) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget'); |
| [10178](#L10178) | echo $args ['before\_widget']; |
| [10179](#L10179) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_widget', true); |
| [10180](#L10180) |  |
| [10181](#L10181) | $title = !empty ($instance ['widget-title']) ? $instance ['widget-title'] : ''; |
| [10182](#L10182) |  |
| [10183](#L10183) | if (!empty ($title)) { |
| [10184](#L10184) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_title'); |
| [10185](#L10185) | echo $args ['before\_title']; |
| [10186](#L10186) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('before\_title', true); |
| [10187](#L10187) |  |
| [10188](#L10188) | echo apply\_filters ('widget\_title', $title); |
| [10189](#L10189) |  |
| [10190](#L10190) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_title'); |
| [10191](#L10191) | echo $args ['after\_title']; |
| [10192](#L10192) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_title', true); |
| [10193](#L10193) | } |
| [10194](#L10194) |  |
| [10195](#L10195) | switch ($block) { |
| [10196](#L10196) | case 0: |
| [10197](#L10197) | // Processing log |
| [10198](#L10198) | echo "<pre"; |
| [10199](#L10199) | if ($sticky && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [10200](#L10200) | echo " class='", get\_block\_class\_name (true), "'"; |
| [10201](#L10201) | } |
| [10202](#L10202) | echo " style='", AI\_DEBUG\_WIDGET\_STYLE, "'>\n"; |
| [10203](#L10203) | ai\_write\_debug\_info (); |
| [10204](#L10204) | echo "</pre>"; |
| [10205](#L10205) |  |
| [10206](#L10206) | if ($ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION]) { |
| [10207](#L10207) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [10208](#L10208) | $viewport\_name = get\_viewport\_name ($viewport); |
| [10209](#L10209) | if ($viewport\_name != '') { |
| [10210](#L10210) | echo "<pre class='ai-viewport-" . $viewport ."' style='", AI\_DEBUG\_WIDGET\_STYLE, "'>\n"; |
| [10211](#L10211) | echo "CLIENT-SIDE DEVICE:      ", $viewport\_name; |
| [10212](#L10212) | echo "</pre>"; |
| [10213](#L10213) | } |
| [10214](#L10214) | } |
| [10215](#L10215) | } |
| [10216](#L10216) | break; |
| [10217](#L10217) | case - 2: |
| [10218](#L10218) | // Debugging tools |
| [10219](#L10219) | if ($sticky && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [10220](#L10220) | echo "<div class='", get\_block\_class\_name (true), "'>\n"; |
| [10221](#L10221) | } |
| [10222](#L10222) | ai\_write\_debugging\_tools (); |
| [10223](#L10223) | if ($sticky && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [10224](#L10224) | echo "</div>\n"; |
| [10225](#L10225) | } |
| [10226](#L10226) | break; |
| [10227](#L10227) | } |
| [10228](#L10228) |  |
| [10229](#L10229) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget'); |
| [10230](#L10230) | if ($sticky && get\_sticky\_widget\_mode() == AI\_STICKY\_WIDGET\_MODE\_CSS\_PUSH) { |
| [10231](#L10231) | echo '<div class="ai-sticky-space" style="height: 1500px;"></div>'; |
| [10232](#L10232) | } |
| [10233](#L10233) | echo $args ['after\_widget']; |
| [10234](#L10234) | if ($debug\_processing) echo ai\_debug\_widget\_comment ('after\_widget', true); |
| [10235](#L10235) | } |
| [10236](#L10236) |  |
| [10237](#L10237) | function ai\_pro () { |
| [10238](#L10238) | if (!function\_exists ('ai\_remote\_plugin\_data')) return false; |
| [10239](#L10239) | return ai\_remote\_plugin\_data ('pro', true); |
| [10240](#L10240) | } |
| [10241](#L10241) |  |
| [10242](#L10242) | function ai\_remote ($name, $default\_data = false) { |
| [10243](#L10243) | if (!function\_exists ('ai\_remote\_plugin\_data')) return $default\_data; |
| [10244](#L10244) | return ai\_remote\_plugin\_data ($name, $default\_data); |
| [10245](#L10245) | } |
| [10246](#L10246) |  |
| [10247](#L10247) | function ai\_is\_json ($string, $return\_data = false) { |
| [10248](#L10248) | $data = json\_decode ($string); |
| [10249](#L10249) | return (json\_last\_error () == JSON\_ERROR\_NONE) ? ($return\_data ? $data : true) : false; |
| [10250](#L10250) | } |
| [10251](#L10251) |  |
| [10252](#L10252) | function ai\_structured\_data\_item ($indexes, $data, $value = '!@!') { |
| [10253](#L10253) | if (is\_object ($data)) $data = (array) $data; |
| [10254](#L10254) |  |
| [10255](#L10255) | if (empty ($indexes)) { |
| [10256](#L10256) | if ($value == '!@!') return true; |
| [10257](#L10257) |  |
| [10258](#L10258) | return $data == $value; |
| [10259](#L10259) | } |
| [10260](#L10260) |  |
| [10261](#L10261) | if (!is\_array ($data)) return false; |
| [10262](#L10262) |  |
| [10263](#L10263) | // Workaround because after json decode array indexes are strings and can't be accessed |
| [10264](#L10264) | $data = array\_combine (array\_keys ($data), array\_values ($data)); |
| [10265](#L10265) |  |
| [10266](#L10266) | $index = array\_shift ($indexes); |
| [10267](#L10267) |  |
| [10268](#L10268) | if ($index == '\*') { |
| [10269](#L10269) | foreach ($data as $data\_index => $data\_item) { |
| [10270](#L10270) | if (ai\_structured\_data\_item ($indexes, $data\_item, $value)) return true; |
| [10271](#L10271) | } |
| [10272](#L10272) | } |
| [10273](#L10273) | elseif (isset ($data [$index])) { |
| [10274](#L10274) | return ai\_structured\_data\_item ($indexes, $data [$index], $value); |
| [10275](#L10275) | } |
| [10276](#L10276) |  |
| [10277](#L10277) | return false; |
| [10278](#L10278) | } |
| [10279](#L10279) |  |
| [10280](#L10280) | function ai\_structured\_data ($data, $selector, $value = '') { |
| [10281](#L10281) | if (!is\_array ($data)) return false; |
| [10282](#L10282) | if (strpos ($selector, '[') === false) return false; |
| [10283](#L10283) |  |
| [10284](#L10284) | $indexes = explode ('[', str\_replace (array (']', ' '), '', $selector)); |
| [10285](#L10285) |  |
| [10286](#L10286) | return ai\_structured\_data\_item ($indexes, $data, $value); |
| [10287](#L10287) | } |
| [10288](#L10288) |  |
| [10289](#L10289) | function check\_url\_parameter\_cookie\_list ($list, $white\_list, $parameters, &$found) { |
| [10290](#L10290) | $parameter\_list = trim ($list); |
| [10291](#L10291) | $return = $white\_list; |
| [10292](#L10292) | $found = false; |
| [10293](#L10293) | $query\_string = isset ($\_SERVER ['QUERY\_STRING']) ? trim ($\_SERVER ['QUERY\_STRING']) != '' : false; |
| [10294](#L10294) |  |
| [10295](#L10295) | if ($parameter\_list == AD\_EMPTY\_DATA) return true; |
| [10296](#L10296) |  |
| [10297](#L10297) | if (count ($parameters) == 0 && strpos ($list, '#') === false) { |
| [10298](#L10298) | return !$return; |
| [10299](#L10299) | } |
| [10300](#L10300) |  |
| [10301](#L10301) | $found = true; |
| [10302](#L10302) |  |
| [10303](#L10303) | $parameter\_data = array (); |
| [10304](#L10304) | foreach ($parameters as $index => $parameter) { |
| [10305](#L10305) | $parameter\_data [$index] = false; |
| [10306](#L10306) | if (is\_string ($parameter)) { |
| [10307](#L10307) | $data = trim (stripslashes ($parameter)); |
| [10308](#L10308) | if (strpos ($data, '{') === 0) { |
| [10309](#L10309) | $parameter\_data [$index] = ai\_is\_json ($data, true); |
| [10310](#L10310) | } |
| [10311](#L10311) | $parameters [$index] = urlencode ($parameter); |
| [10312](#L10312) | } |
| [10313](#L10313) | } |
| [10314](#L10314) |  |
| [10315](#L10315) | $parameters\_listed = explode (",", $parameter\_list); |
| [10316](#L10316) | foreach ($parameters\_listed as $index => $parameter\_listed) { |
| [10317](#L10317) | if (trim ($parameter\_listed) == "") unset ($parameters\_listed [$index]); else |
| [10318](#L10318) | $parameters\_listed [$index] = trim ($parameter\_listed); |
| [10319](#L10319) | } |
| [10320](#L10320) |  |
| [10321](#L10321) | foreach ($parameters\_listed as $parameter) { |
| [10322](#L10322) | if ($parameter == '#') { |
| [10323](#L10323) | if (!$query\_string) return $return; |
| [10324](#L10324) | } |
| [10325](#L10325) | elseif (strpos ($parameter, "=") !== false) { |
| [10326](#L10326) | $parameter\_value = explode ("=", $parameter); |
| [10327](#L10327) |  |
| [10328](#L10328) | if (array\_key\_exists ($parameter\_value [0], $parameters) && $parameters [$parameter\_value [0]] == $parameter\_value [1]) return $return; |
| [10329](#L10329) |  |
| [10330](#L10330) | if (ai\_structured\_data ($parameter\_data, $parameter\_value [0], $parameter\_value [1])) return $return; |
| [10331](#L10331) | } |
| [10332](#L10332) | else { |
| [10333](#L10333) | if (array\_key\_exists ($parameter, $parameters)) return $return; |
| [10334](#L10334) |  |
| [10335](#L10335) | if (ai\_structured\_data ($parameter\_data, $parameter)) return $return; |
| [10336](#L10336) | } |
| [10337](#L10337) | } |
| [10338](#L10338) |  |
| [10339](#L10339) | $found = false; |
| [10340](#L10340) | return !$return; |
| [10341](#L10341) | } |
| [10342](#L10342) |  |
| [10343](#L10343) |  |
| [10344](#L10344) | function check\_url\_parameter\_list ($url\_parameters, $white\_list, &$found) { |
| [10345](#L10345) | return check\_url\_parameter\_cookie\_list ($url\_parameters, $white\_list, $\_GET, $found); |
| [10346](#L10346) | } |
| [10347](#L10347) |  |
| [10348](#L10348) | function check\_cookie\_list ($url\_parameters, $white\_list) { |
| [10349](#L10349) | $dummy = false; |
| [10350](#L10350) | return check\_url\_parameter\_cookie\_list ($url\_parameters, $white\_list, $\_COOKIE, $dummy); |
| [10351](#L10351) | } |
| [10352](#L10352) |  |
| [10353](#L10353) | function check\_url\_parameter\_and\_cookie\_list ($url\_parameters, $white\_list) { |
| [10354](#L10354) | $dummy = false; |
| [10355](#L10355) | return check\_url\_parameter\_cookie\_list ($url\_parameters, $white\_list, array\_merge ($\_COOKIE, $\_GET), $dummy); |
| [10356](#L10356) | } |
| [10357](#L10357) |  |
| [10358](#L10358) | function check\_scheduled\_rotation ($scheduling) { |
| [10359](#L10359) | If (strpos ($scheduling, '=') === false) return false; |
| [10360](#L10360) |  |
| [10361](#L10361) | $result = true; |
| [10362](#L10362) | if (strpos ($scheduling, '^') !== false) { |
| [10363](#L10363) | $result = false; |
| [10364](#L10364) | $scheduling = substr ($scheduling, 1); |
| [10365](#L10365) | } |
| [10366](#L10366) |  |
| [10367](#L10367) | $scheduling\_data\_array = explode ('=', $scheduling); |
| [10368](#L10368) |  |
| [10369](#L10369) | if (strpos ($scheduling\_data\_array [0], '%') !== false) { |
| [10370](#L10370) | $scheduling\_data\_time = explode ('%', $scheduling\_data\_array [0]); |
| [10371](#L10371) | } else $scheduling\_data\_time = array ($scheduling\_data\_array [0]); |
| [10372](#L10372) |  |
| [10373](#L10373) | $time\_unit = strtolower (trim ($scheduling\_data\_time [0])); |
| [10374](#L10374) |  |
| [10375](#L10375) | $time\_division = isset ($scheduling\_data\_time [1]) ? trim ($scheduling\_data\_time [1]) : 0; |
| [10376](#L10376) | $scheduling\_time\_option = str\_replace (' ', '',  ($scheduling\_data\_array [1])); |
| [10377](#L10377) |  |
| [10378](#L10378) | $current\_time = current\_time ('timestamp'); |
| [10379](#L10379) |  |
| [10380](#L10380) | $time\_value = 0; |
| [10381](#L10381) | switch ($time\_unit) { |
| [10382](#L10382) | case 's': |
| [10383](#L10383) | $time\_value = ltrim (date ('s', $current\_time), '0'); |
| [10384](#L10384) | break; |
| [10385](#L10385) | case 'i': |
| [10386](#L10386) | $time\_value = ltrim (date ('i', $current\_time), '0'); |
| [10387](#L10387) | break; |
| [10388](#L10388) | case 'h': |
| [10389](#L10389) | $time\_value = date ('G', $current\_time); |
| [10390](#L10390) | break; |
| [10391](#L10391) | case 'd': |
| [10392](#L10392) | $time\_value = date ('j', $current\_time); |
| [10393](#L10393) | break; |
| [10394](#L10394) | case 'm': |
| [10395](#L10395) | $time\_value = date ('n', $current\_time); |
| [10396](#L10396) | break; |
| [10397](#L10397) | case 'y': |
| [10398](#L10398) | $time\_value = date ('Y', $current\_time); |
| [10399](#L10399) | break; |
| [10400](#L10400) | case 'w': |
| [10401](#L10401) | $time\_value = date ('w', $current\_time); |
| [10402](#L10402) | if ($time\_value == 0) $time\_value = 6; else $time\_value = $time\_value - 1; |
| [10403](#L10403) | } |
| [10404](#L10404) |  |
| [10405](#L10405) | $time\_modulo = $time\_division != 0 ? $time\_value % $time\_division : $time\_value; |
| [10406](#L10406) |  |
| [10407](#L10407) | $scheduling\_time\_options = explode (',', $scheduling\_time\_option); |
| [10408](#L10408) | foreach ($scheduling\_time\_options as $time\_option) { |
| [10409](#L10409) | if (strpos ($time\_option, '-') !== false) { |
| [10410](#L10410) | $time\_limits = explode ('-', $time\_option); |
| [10411](#L10411) | if ($time\_modulo >= $time\_limits [0] && $time\_modulo <= $time\_limits [1]) return $result; |
| [10412](#L10412) | } else if ($time\_modulo == $time\_option) return $result; |
| [10413](#L10413) | } |
| [10414](#L10414) |  |
| [10415](#L10415) | return !$result; |
| [10416](#L10416) | } |
| [10417](#L10417) |  |
| [10418](#L10418) | function check\_scheduling\_time ($start\_time, $end\_time, $days\_in\_week, $between) { |
| [10419](#L10419) | if (!function\_exists ('ai\_scheduling\_options')) return true; |
| [10420](#L10420) |  |
| [10421](#L10421) | $current\_time = current\_time ('timestamp'); |
| [10422](#L10422) | $current\_weekday =  (date ('w', $current\_time) + 6) % 7; |
| [10423](#L10423) |  |
| [10424](#L10424) | if (strpos ($start\_time, '-') === false && strpos ($end\_time, '-') === false) { |
| [10425](#L10425) | $current\_time -= (strtotime (current\_time ('Y-m-d'))); |
| [10426](#L10426) | if ($current\_time < 0) { |
| [10427](#L10427) | $current\_time += 24 \* 3600; |
| [10428](#L10428) | } |
| [10429](#L10429) | } |
| [10430](#L10430) |  |
| [10431](#L10431) | $start\_time   = (int) strtotime ($start\_time, $current\_time); |
| [10432](#L10432) | $end\_time     = (int) strtotime ($end\_time,   $current\_time); |
| [10433](#L10433) |  |
| [10434](#L10434) | $weekdays = explode (',', $days\_in\_week); |
| [10435](#L10435) | if (isset ($weekdays [0]) and $weekdays [0] === '') $weekdays = array (); |
| [10436](#L10436) |  |
| [10437](#L10437) | $insertion\_enabled = $current\_time >= $start\_time && ($end\_time == 0 || $current\_time < $end\_time) && in\_array ($current\_weekday, $weekdays); |
| [10438](#L10438) |  |
| [10439](#L10439) | return ($between ? $insertion\_enabled : !$insertion\_enabled); |
| [10440](#L10440) | } |
| [10441](#L10441) |  |
| [10442](#L10442) | function check\_referer\_list ($referers, $white\_list) { |
| [10443](#L10443) |  |
| [10444](#L10444) | if (isset ($\_GET ['referrer'])) { |
| [10445](#L10445) | $referer\_host = esc\_html ($\_GET ['referrer']); |
| [10446](#L10446) | } |
| [10447](#L10447) | elseif (isset ($\_SERVER['HTTP\_REFERER']) && $\_SERVER['HTTP\_REFERER'] != '') { |
| [10448](#L10448) | $http\_referer = parse\_url ($\_SERVER ['HTTP\_REFERER'], PHP\_URL\_HOST); |
| [10449](#L10449) | if (!empty ($http\_referer)) { |
| [10450](#L10450) | $referer\_host = strtolower ($http\_referer); |
| [10451](#L10451) | } else $referer\_host = ''; |
| [10452](#L10452) | } |
| [10453](#L10453) | else $referer\_host = ''; |
| [10454](#L10454) |  |
| [10455](#L10455) | //  echo " referers='$referers' referer\_host='$referer\_host' "; |
| [10456](#L10456) |  |
| [10457](#L10457) | $return = $white\_list; |
| [10458](#L10458) |  |
| [10459](#L10459) | $domains = strtolower (trim ($referers)); |
| [10460](#L10460) | if ($domains == AD\_EMPTY\_DATA) return true; |
| [10461](#L10461) | $domains = explode (",", $domains); |
| [10462](#L10462) |  |
| [10463](#L10463) | foreach ($domains as $domain) { |
| [10464](#L10464) | $domain = trim ($domain); |
| [10465](#L10465) | if ($domain == "") continue; |
| [10466](#L10466) |  |
| [10467](#L10467) | if ($domain [0] == '\*') { |
| [10468](#L10468) | if ($domain [strlen ($domain) - 1] == '\*') { |
| [10469](#L10469) | $domain = substr ($domain, 1, strlen ($domain) - 2); |
| [10470](#L10470) | if (strpos ($referer\_host, $domain) !== false) return $return; |
| [10471](#L10471) | } else { |
| [10472](#L10472) | $domain = substr ($domain, 1); |
| [10473](#L10473) | if (substr ($referer\_host, - strlen ($domain)) == $domain) return $return; |
| [10474](#L10474) | } |
| [10475](#L10475) | } |
| [10476](#L10476) | elseif ($domain [strlen ($domain) - 1] == '\*') { |
| [10477](#L10477) | $domain = substr ($domain, 0, strlen ($domain) - 1); |
| [10478](#L10478) | if (strpos ($referer\_host, $domain) === 0) return $return; |
| [10479](#L10479) | } |
| [10480](#L10480) |  |
| [10481](#L10481) | if ($domain == "#") { |
| [10482](#L10482) | if ($referer\_host == "") return $return; |
| [10483](#L10483) | } elseif ($domain == $referer\_host) return $return; |
| [10484](#L10484) | } |
| [10485](#L10485) | return !$return; |
| [10486](#L10486) | } |
| [10487](#L10487) |  |
| [10488](#L10488) | function check\_client\_list ($clients, $white\_list) { |
| [10489](#L10489) | global $ai\_wp\_data; |
| [10490](#L10490) |  |
| [10491](#L10491) | $languages = array ( |
| [10492](#L10492) | 'af' => 'Afrikaans', |
| [10493](#L10493) | 'sq' => 'Albanian', |
| [10494](#L10494) | 'an' => 'Aragonese', |
| [10495](#L10495) | 'ar\*' => 'Arabic (Standard)', |
| [10496](#L10496) | 'ar-dz' => 'Arabic (Algeria)', |
| [10497](#L10497) | 'ar-bh' => 'Arabic (Bahrain)', |
| [10498](#L10498) | 'ar-eg' => 'Arabic (Egypt)', |
| [10499](#L10499) | 'ar-iq' => 'Arabic (Iraq)', |
| [10500](#L10500) | 'ar-jo' => 'Arabic (Jordan)', |
| [10501](#L10501) | 'ar-kw' => 'Arabic (Kuwait)', |
| [10502](#L10502) | 'ar-lb' => 'Arabic (Lebanon)', |
| [10503](#L10503) | 'ar-ly' => 'Arabic (Libya)', |
| [10504](#L10504) | 'ar-ma' => 'Arabic (Morocco)', |
| [10505](#L10505) | 'ar-om' => 'Arabic (Oman)', |
| [10506](#L10506) | 'ar-qa' => 'Arabic (Qatar)', |
| [10507](#L10507) | 'ar-sa' => 'Arabic (Saudi Arabia)', |
| [10508](#L10508) | 'ar-sy' => 'Arabic (Syria)', |
| [10509](#L10509) | 'ar-tn' => 'Arabic (Tunisia)', |
| [10510](#L10510) | 'ar-ae' => 'Arabic (U.A.E.)', |
| [10511](#L10511) | 'ar-ye' => 'Arabic (Yemen)', |
| [10512](#L10512) | 'hy' => 'Armenian', |
| [10513](#L10513) | 'as' => 'Assamese', |
| [10514](#L10514) | 'ast' => 'Asturian', |
| [10515](#L10515) | 'az' => 'Azerbaijani', |
| [10516](#L10516) | 'eu' => 'Basque', |
| [10517](#L10517) | 'bg' => 'Bulgarian', |
| [10518](#L10518) | 'be' => 'Belarusian', |
| [10519](#L10519) | 'bn' => 'Bengali', |
| [10520](#L10520) | 'bs' => 'Bosnian', |
| [10521](#L10521) | 'br' => 'Breton', |
| [10522](#L10522) | 'my' => 'Burmese', |
| [10523](#L10523) | 'ca' => 'Catalan', |
| [10524](#L10524) | 'ch' => 'Chamorro', |
| [10525](#L10525) | 'ce' => 'Chechen', |
| [10526](#L10526) | 'zh\*' => 'Chinese', |
| [10527](#L10527) | 'zh-hk' => 'Chinese (Hong Kong)', |
| [10528](#L10528) | 'zh-cn' => 'Chinese (PRC)', |
| [10529](#L10529) | 'zh-sg' => 'Chinese (Singapore)', |
| [10530](#L10530) | 'zh-tw' => 'Chinese (Taiwan)', |
| [10531](#L10531) | 'cv' => 'Chuvash', |
| [10532](#L10532) | 'co' => 'Corsican', |
| [10533](#L10533) | 'cr' => 'Cree', |
| [10534](#L10534) | 'hr' => 'Croatian', |
| [10535](#L10535) | 'cs' => 'Czech', |
| [10536](#L10536) | 'da' => 'Danish', |
| [10537](#L10537) | 'nl\*' => 'Dutch (Standard)', |
| [10538](#L10538) | 'nl-be' => 'Dutch (Belgian)', |
| [10539](#L10539) | 'en\*' => 'English', |
| [10540](#L10540) | 'en-au' => 'English (Australia)', |
| [10541](#L10541) | 'en-bz' => 'English (Belize)', |
| [10542](#L10542) | 'en-ca' => 'English (Canada)', |
| [10543](#L10543) | 'en-ie' => 'English (Ireland)', |
| [10544](#L10544) | 'en-jm' => 'English (Jamaica)', |
| [10545](#L10545) | 'en-nz' => 'English (New Zealand)', |
| [10546](#L10546) | 'en-ph' => 'English (Philippines)', |
| [10547](#L10547) | 'en-za' => 'English (South Africa)', |
| [10548](#L10548) | 'en-tt' => 'English (Trinidad & Tobago)', |
| [10549](#L10549) | 'en-gb' => 'English (United Kingdom)', |
| [10550](#L10550) | 'en-us' => 'English (United States)', |
| [10551](#L10551) | 'en-zw' => 'English (Zimbabwe)', |
| [10552](#L10552) | 'eo' => 'Esperanto', |
| [10553](#L10553) | 'et' => 'Estonian', |
| [10554](#L10554) | 'fo' => 'Faeroese', |
| [10555](#L10555) | 'fa' => 'Persian', |
| [10556](#L10556) | 'fj' => 'Fijian', |
| [10557](#L10557) | 'fi' => 'Finnish', |
| [10558](#L10558) | 'fr\*' => 'French (Standard)', |
| [10559](#L10559) | 'fr-be' => 'French (Belgium)', |
| [10560](#L10560) | 'fr-ca' => 'French (Canada)', |
| [10561](#L10561) | 'fr-fr' => 'French (France)', |
| [10562](#L10562) | 'fr-lu' => 'French (Luxembourg)', |
| [10563](#L10563) | 'fr-mc' => 'French (Monaco)', |
| [10564](#L10564) | 'fr-ch' => 'French (Switzerland)', |
| [10565](#L10565) | 'fy' => 'Frisian', |
| [10566](#L10566) | 'fur' => 'Friulian', |
| [10567](#L10567) | 'gd\*' => 'Scots Gaelic', |
| [10568](#L10568) | 'gd-ie' => 'Gaelic (Irish)', |
| [10569](#L10569) | 'gl' => 'Galacian', |
| [10570](#L10570) | 'ka' => 'Georgian', |
| [10571](#L10571) | 'de\*' => 'German (Standard)', |
| [10572](#L10572) | 'de-at' => 'German (Austria)', |
| [10573](#L10573) | 'de-de' => 'German (Germany)', |
| [10574](#L10574) | 'de-li' => 'German (Liechtenstein)', |
| [10575](#L10575) | 'de-lu' => 'German (Luxembourg)', |
| [10576](#L10576) | 'de-ch' => 'German (Switzerland)', |
| [10577](#L10577) | 'el' => 'Greek', |
| [10578](#L10578) | 'gu' => 'Gujurati', |
| [10579](#L10579) | 'ht' => 'Haitian', |
| [10580](#L10580) | 'he' => 'Hebrew', |
| [10581](#L10581) | 'hi' => 'Hindi', |
| [10582](#L10582) | 'hu' => 'Hungarian', |
| [10583](#L10583) | 'is' => 'Icelandic', |
| [10584](#L10584) | 'id' => 'Indonesian', |
| [10585](#L10585) | 'iu' => 'Inuktitut', |
| [10586](#L10586) | 'ga' => 'Irish', |
| [10587](#L10587) | 'it\*' => 'Italian (Standard)', |
| [10588](#L10588) | 'it-ch' => 'Italian (Switzerland)', |
| [10589](#L10589) | 'ja' => 'Japanese', |
| [10590](#L10590) | 'kn' => 'Kannada', |
| [10591](#L10591) | 'ks' => 'Kashmiri', |
| [10592](#L10592) | 'kk' => 'Kazakh', |
| [10593](#L10593) | 'km' => 'Khmer', |
| [10594](#L10594) | 'ky' => 'Kirghiz', |
| [10595](#L10595) | 'tlh' => 'Klingon', |
| [10596](#L10596) | 'ko\*' => 'Korean', |
| [10597](#L10597) | 'ko-kp' => 'Korean (North Korea)', |
| [10598](#L10598) | 'ko-kr' => 'Korean (South Korea)', |
| [10599](#L10599) | 'la' => 'Latin', |
| [10600](#L10600) | 'lv' => 'Latvian', |
| [10601](#L10601) | 'lt' => 'Lithuanian', |
| [10602](#L10602) | 'lb' => 'Luxembourgish', |
| [10603](#L10603) | 'mk' => 'Macedonian', |
| [10604](#L10604) | 'ms' => 'Malay', |
| [10605](#L10605) | 'ml' => 'Malayalam', |
| [10606](#L10606) | 'mt' => 'Maltese', |
| [10607](#L10607) | 'mi' => 'Maori', |
| [10608](#L10608) | 'mr' => 'Marathi', |
| [10609](#L10609) | 'mo' => 'Moldavian', |
| [10610](#L10610) | 'nv' => 'Navajo', |
| [10611](#L10611) | 'ng' => 'Ndonga', |
| [10612](#L10612) | 'ne' => 'Nepali', |
| [10613](#L10613) | 'no' => 'Norwegian', |
| [10614](#L10614) | 'nb' => 'Norwegian (Bokmal)', |
| [10615](#L10615) | 'nn' => 'Norwegian (Nynorsk)', |
| [10616](#L10616) | 'oc' => 'Occitan', |
| [10617](#L10617) | 'or' => 'Oriya', |
| [10618](#L10618) | 'om' => 'Oromo', |
| [10619](#L10619) | 'fa-ir' => 'Persian/Iran', |
| [10620](#L10620) | 'pl' => 'Polish', |
| [10621](#L10621) | 'pt\*' => 'Portuguese', |
| [10622](#L10622) | 'pt-br' => 'Portuguese (Brazil)', |
| [10623](#L10623) | 'pa\*' => 'Punjabi', |
| [10624](#L10624) | 'pa-in' => 'Punjabi (India)', |
| [10625](#L10625) | 'pa-pk' => 'Punjabi (Pakistan)', |
| [10626](#L10626) | 'qu' => 'Quechua', |
| [10627](#L10627) | 'rm' => 'Rhaeto-Romanic', |
| [10628](#L10628) | 'ro\*' => 'Romanian', |
| [10629](#L10629) | 'ro-mo' => 'Romanian (Moldavia)', |
| [10630](#L10630) | 'ru\*' => 'Russian', |
| [10631](#L10631) | 'ru-mo' => 'Russian (Moldavia)', |
| [10632](#L10632) | 'sz' => 'Sami (Lappish)', |
| [10633](#L10633) | 'sg' => 'Sango', |
| [10634](#L10634) | 'sa' => 'Sanskrit', |
| [10635](#L10635) | 'sc' => 'Sardinian', |
| [10636](#L10636) | 'sd' => 'Sindhi', |
| [10637](#L10637) | 'si' => 'Singhalese', |
| [10638](#L10638) | 'sr' => 'Serbian', |
| [10639](#L10639) | 'sk' => 'Slovak', |
| [10640](#L10640) | 'sl' => 'Slovenian', |
| [10641](#L10641) | 'so' => 'Somani', |
| [10642](#L10642) | 'sb' => 'Sorbian', |
| [10643](#L10643) | 'es\*' => 'Spanish', |
| [10644](#L10644) | 'es-ar' => 'Spanish (Argentina)', |
| [10645](#L10645) | 'es-bo' => 'Spanish (Bolivia)', |
| [10646](#L10646) | 'es-cl' => 'Spanish (Chile)', |
| [10647](#L10647) | 'es-co' => 'Spanish (Colombia)', |
| [10648](#L10648) | 'es-cr' => 'Spanish (Costa Rica)', |
| [10649](#L10649) | 'es-do' => 'Spanish (Dominican Republic)', |
| [10650](#L10650) | 'es-ec' => 'Spanish (Ecuador)', |
| [10651](#L10651) | 'es-sv' => 'Spanish (El Salvador)', |
| [10652](#L10652) | 'es-gt' => 'Spanish (Guatemala)', |
| [10653](#L10653) | 'es-hn' => 'Spanish (Honduras)', |
| [10654](#L10654) | 'es-mx' => 'Spanish (Mexico)', |
| [10655](#L10655) | 'es-ni' => 'Spanish (Nicaragua)', |
| [10656](#L10656) | 'es-pa' => 'Spanish (Panama)', |
| [10657](#L10657) | 'es-py' => 'Spanish (Paraguay)', |
| [10658](#L10658) | 'es-pe' => 'Spanish (Peru)', |
| [10659](#L10659) | 'es-pr' => 'Spanish (Puerto Rico)', |
| [10660](#L10660) | 'es-es' => 'Spanish (Spain)', |
| [10661](#L10661) | 'es-uy' => 'Spanish (Uruguay)', |
| [10662](#L10662) | 'es-ve' => 'Spanish (Venezuela)', |
| [10663](#L10663) | 'sx' => 'Sutu', |
| [10664](#L10664) | 'sw' => 'Swahili', |
| [10665](#L10665) | 'sv\*' => 'Swedish', |
| [10666](#L10666) | 'sv-fi' => 'Swedish (Finland)', |
| [10667](#L10667) | 'sv-sv' => 'Swedish (Sweden)', |
| [10668](#L10668) | 'ta' => 'Tamil', |
| [10669](#L10669) | 'tt' => 'Tatar', |
| [10670](#L10670) | 'te' => 'Teluga', |
| [10671](#L10671) | 'th' => 'Thai', |
| [10672](#L10672) | 'tig' => 'Tigre', |
| [10673](#L10673) | 'ts' => 'Tsonga', |
| [10674](#L10674) | 'tn' => 'Tswana', |
| [10675](#L10675) | 'tr' => 'Turkish', |
| [10676](#L10676) | 'tk' => 'Turkmen', |
| [10677](#L10677) | 'uk' => 'Ukrainian', |
| [10678](#L10678) | 'hsb' => 'Upper Sorbian', |
| [10679](#L10679) | 'ur' => 'Urdu', |
| [10680](#L10680) | 've' => 'Venda', |
| [10681](#L10681) | 'vi' => 'Vietnamese', |
| [10682](#L10682) | 'vo' => 'Volapuk', |
| [10683](#L10683) | 'wa' => 'Walloon', |
| [10684](#L10684) | 'cy' => 'Welsh', |
| [10685](#L10685) | 'xh' => 'Xhosa', |
| [10686](#L10686) | 'ji' => 'Yiddish', |
| [10687](#L10687) | 'zu' => 'Zulu', |
| [10688](#L10688) | ); |
| [10689](#L10689) |  |
| [10690](#L10690) | if (version\_compare (phpversion (), "5.6", ">=")) { |
| [10691](#L10691) | if (!isset ($ai\_wp\_data [AI\_AGENT])) { |
| [10692](#L10692) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/agent/Agent.php'; |
| [10693](#L10693) | $agent = new Agent(); |
| [10694](#L10694) | $ai\_wp\_data [AI\_AGENT] = $agent; |
| [10695](#L10695) | } else $agent = $ai\_wp\_data [AI\_AGENT]; |
| [10696](#L10696) |  |
| [10697](#L10697) | $language  = isset ($\_SERVER ['HTTP\_ACCEPT\_LANGUAGE']) ? $\_SERVER ['HTTP\_ACCEPT\_LANGUAGE'] : ''; |
| [10698](#L10698) |  |
| [10699](#L10699) | $return = $white\_list; |
| [10700](#L10700) |  |
| [10701](#L10701) | if ($clients == AD\_EMPTY\_DATA) return true; |
| [10702](#L10702) | $clients = explode (",", $clients); |
| [10703](#L10703) |  |
| [10704](#L10704) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [10705](#L10705) | if (!isset ($ai\_wp\_data [AI\_CLIENTS])) $ai\_wp\_data [AI\_CLIENTS] = array (); |
| [10706](#L10706) | foreach ($clients as $client) { |
| [10707](#L10707) | $client = trim ($client); |
| [10708](#L10708) | if ($client == "") continue; |
| [10709](#L10709) | $ai\_wp\_data [AI\_CLIENTS][] = $client; |
| [10710](#L10710) | } |
| [10711](#L10711) | } |
| [10712](#L10712) |  |
| [10713](#L10713) | foreach ($clients as $client) { |
| [10714](#L10714) | $client = trim ($client); |
| [10715](#L10715) | if ($client == "") continue; |
| [10716](#L10716) |  |
| [10717](#L10717) | $check\_language = false; |
| [10718](#L10718) | if (strpos ($client, 'language:') === 0) { |
| [10719](#L10719) | $check\_language = true; |
| [10720](#L10720) | $client = substr ($client, 9); |
| [10721](#L10721) | } |
| [10722](#L10722) |  |
| [10723](#L10723) | if ($check\_language) { |
| [10724](#L10724) | if ($client [0] == '\*') { |
| [10725](#L10725) | if ($client [strlen ($client) - 1] == '\*') { |
| [10726](#L10726) | $client = substr ($client, 1, strlen ($client) - 2); |
| [10727](#L10727) | if (stripos ($language, $client) !== false) return $return; |
| [10728](#L10728) | } else { |
| [10729](#L10729) | $client = substr ($client, 1); |
| [10730](#L10730) | if (strtolower (substr ($language, - strlen ($client))) == strtolower ($client)) return $return; |
| [10731](#L10731) | } |
| [10732](#L10732) | } |
| [10733](#L10733) | elseif ($client [strlen ($client) - 1] == '\*') { |
| [10734](#L10734) | $client = substr ($client, 0, strlen ($client) - 1); |
| [10735](#L10735) | if (stripos ($language, $client) === 0) return $return; |
| [10736](#L10736) | } |
| [10737](#L10737) | elseif (strtolower ($client) == strtolower ($language)) return $return; |
| [10738](#L10738) | } else { |
| [10739](#L10739) | if ($client [0] == '\*') { |
| [10740](#L10740) | if ($client [strlen ($client) - 1] == '\*') { |
| [10741](#L10741) | $client = substr ($client, 1, strlen ($client) - 2); |
| [10742](#L10742) | if (stripos ($agent->getUserAgent (), $client) !== false) return $return; |
| [10743](#L10743) | } else { |
| [10744](#L10744) | $client = substr ($client, 1); |
| [10745](#L10745) | if (strtolower (substr ($agent->getUserAgent (), - strlen ($client))) == strtolower ($client)) return $return; |
| [10746](#L10746) | } |
| [10747](#L10747) | } |
| [10748](#L10748) | elseif ($client [strlen ($client) - 1] == '\*') { |
| [10749](#L10749) | $client = substr ($client, 0, strlen ($client) - 1); |
| [10750](#L10750) | if (stripos ($agent->getUserAgent (), $client) === 0) return $return; |
| [10751](#L10751) | } |
| [10752](#L10752) | elseif ($agent->is ($client)) return $return; |
| [10753](#L10753) | } |
| [10754](#L10754) |  |
| [10755](#L10755) | } |
| [10756](#L10756) | return !$return; |
| [10757](#L10757) | } else { |
| [10758](#L10758) | return true; |
| [10759](#L10759) | } |
| [10760](#L10760) | } |
| [10761](#L10761) |  |
| [10762](#L10762) | function ai\_check\_block ($block) { |
| [10763](#L10763) | global $ai\_delay\_showing\_pageviews; |
| [10764](#L10764) |  |
| [10765](#L10765) | $ai\_cookie\_name = 'aiBLOCKS'; |
| [10766](#L10766) |  |
| [10767](#L10767) | if (isset ($\_COOKIE [$ai\_cookie\_name])) { |
| [10768](#L10768) | $ai\_cookie = json\_decode (stripslashes ($\_COOKIE [$ai\_cookie\_name])); |
| [10769](#L10769) | } else $ai\_cookie = new stdClass(); |
| [10770](#L10770) |  |
| [10771](#L10771) | if (isset ($ai\_delay\_showing\_pageviews)) { |
| [10772](#L10772) | if (!isset ($ai\_cookie->$block)) { |
| [10773](#L10773) | $ai\_cookie->$block = new stdClass(); |
| [10774](#L10774) | } |
| [10775](#L10775) |  |
| [10776](#L10776) | if (!isset ($ai\_cookie->$block->d)) { |
| [10777](#L10777) | $ai\_cookie->$block->d = $ai\_delay\_showing\_pageviews; |
| [10778](#L10778) | } |
| [10779](#L10779) |  |
| [10780](#L10780) | unset ($ai\_delay\_showing\_pageviews); |
| [10781](#L10781) | } |
| [10782](#L10782) |  |
| [10783](#L10783) | if (isset ($ai\_cookie)) { |
| [10784](#L10784) | if (isset ($ai\_cookie->$block) && is\_object ($ai\_cookie->$block)) { |
| [10785](#L10785) | foreach ($ai\_cookie->$block as $property => $value) { |
| [10786](#L10786) | switch ($property) { |
| [10787](#L10787) | case 'x': |
| [10788](#L10788) | $closed\_for = $value - time (); |
| [10789](#L10789) |  |
| [10790](#L10790) | if ($closed\_for > 0) { |
| [10791](#L10791) | return false; |
| [10792](#L10792) | } else { |
| [10793](#L10793) | ai\_set\_cookie ($block, 'x', ''); |
| [10794](#L10794) | } |
| [10795](#L10795) | break; |
| [10796](#L10796) | case 'd': |
| [10797](#L10797) | if ($value != 0) { |
| [10798](#L10798) | return false; |
| [10799](#L10799) | } |
| [10800](#L10800) | break; |
| [10801](#L10801) | case 'i': |
| [10802](#L10802) | if ($value == 0) { |
| [10803](#L10803) | return false; |
| [10804](#L10804) | } |
| [10805](#L10805) | elseif ($value < 0) { |
| [10806](#L10806) | $closed\_for = - $value - time (); |
| [10807](#L10807) |  |
| [10808](#L10808) | if ($closed\_for > 0) { |
| [10809](#L10809) | return false; |
| [10810](#L10810) | } else { |
| [10811](#L10811) | ai\_set\_cookie ($block, 'i', ''); |
| [10812](#L10812) | if (!isset ($ai\_cookie->$block->c) && !isset ($ai\_cookie->$block->x)) { |
| [10813](#L10813) | ai\_set\_cookie ($block, 'h', ''); |
| [10814](#L10814) | } |
| [10815](#L10815) | } |
| [10816](#L10816) | } |
| [10817](#L10817) | break; |
| [10818](#L10818) | case 'ipt': |
| [10819](#L10819) | if ($value == 0 && isset ($ai\_cookie->$block->it)) { |
| [10820](#L10820) | $closed\_for = $ai\_cookie->$block->it - time (); |
| [10821](#L10821) | if ($closed\_for > 0) { |
| [10822](#L10822) | return false; |
| [10823](#L10823) | } |
| [10824](#L10824) | } |
| [10825](#L10825) | break; |
| [10826](#L10826) | case 'c': |
| [10827](#L10827) | if ($value == 0) { |
| [10828](#L10828) | return false; |
| [10829](#L10829) | } |
| [10830](#L10830) | elseif ($value < 0) { |
| [10831](#L10831) | $closed\_for = - $value - time (); |
| [10832](#L10832) |  |
| [10833](#L10833) | if ($closed\_for > 0) { |
| [10834](#L10834) | return false; |
| [10835](#L10835) | } else { |
| [10836](#L10836) | ai\_set\_cookie ($block, 'c', ''); |
| [10837](#L10837) | if (!isset ($ai\_cookie->$block->i) && !isset ($ai\_cookie->$block->x)) { |
| [10838](#L10838) | ai\_set\_cookie ($block, 'h', ''); |
| [10839](#L10839) | } |
| [10840](#L10840) | } |
| [10841](#L10841) | } |
| [10842](#L10842) | break; |
| [10843](#L10843) | case 'cpt': |
| [10844](#L10844) | if ($value == 0 && isset ($ai\_cookie->$block->ct)) { |
| [10845](#L10845) | $closed\_for = $ai\_cookie->$block->ct - time (); |
| [10846](#L10846) | if ($closed\_for > 0) { |
| [10847](#L10847) | return false; |
| [10848](#L10848) | } |
| [10849](#L10849) | } |
| [10850](#L10850) | break; |
| [10851](#L10851) | } |
| [10852](#L10852) | } |
| [10853](#L10853) |  |
| [10854](#L10854) | if (isset ($ai\_cookie->G) && is\_object ($ai\_cookie->G) && isset ($ai\_cookie->G->cpt)) { |
| [10855](#L10855) | if ($ai\_cookie->G->cpt == 0 && isset ($ai\_cookie->$block->ct)) { |
| [10856](#L10856) | $closed\_for = $ai\_cookie->$block->ct - time (); |
| [10857](#L10857) | if ($closed\_for > 0) { |
| [10858](#L10858) | return false; |
| [10859](#L10859) | } |
| [10860](#L10860) | } |
| [10861](#L10861) | } |
| [10862](#L10862) | } |
| [10863](#L10863) | } |
| [10864](#L10864) |  |
| [10865](#L10865) | return true; |
| [10866](#L10866) | } |
| [10867](#L10867) |  |
| [10868](#L10868) | function ai\_get\_category\_list () { |
| [10869](#L10869) | if (function\_exists ('ai\_remote\_plugin\_data')) { |
| [10870](#L10870) | $data = ai\_remote\_plugin\_data ('categories'); |
| [10871](#L10871) | if (is\_array ($data)) return $data; |
| [10872](#L10872) | } |
| [10873](#L10873) |  |
| [10874](#L10874) | $args = array ("hide\_empty" => 0, 'number' => get\_max\_list\_items ()); |
| [10875](#L10875) | return (get\_categories ($args)); |
| [10876](#L10876) | } |
| [10877](#L10877) |  |
| [10878](#L10878) | function ai\_get\_tag\_list () { |
| [10879](#L10879) | if (function\_exists ('ai\_remote\_plugin\_data')) { |
| [10880](#L10880) | $data = ai\_remote\_plugin\_data ('tags'); |
| [10881](#L10881) | if (is\_array ($data)) return $data; |
| [10882](#L10882) | } |
| [10883](#L10883) |  |
| [10884](#L10884) | $args = array ('number' => get\_max\_list\_items ()); |
| [10885](#L10885) | return (get\_tags ($args)); |
| [10886](#L10886) | } |
| [10887](#L10887) |  |
| [10888](#L10888) | function ai\_get\_taxonomy\_list ($limited = false) { |
| [10889](#L10889) | if (function\_exists ('ai\_remote\_plugin\_data')) { |
| [10890](#L10890) | $data = ai\_remote\_plugin\_data ('taxonomies'); |
| [10891](#L10891) | if (is\_array ($data)) return $data; |
| [10892](#L10892) | } |
| [10893](#L10893) |  |
| [10894](#L10894) | $term\_data = get\_terms (); |
| [10895](#L10895) | $taxonomies = array (); |
| [10896](#L10896) | $max\_list\_items = get\_max\_list\_items (); |
| [10897](#L10897) | foreach ($term\_data as $term) { |
| [10898](#L10898) | if ($term->taxonomy == 'category') continue; |
| [10899](#L10899) | if ($term->taxonomy == 'post\_tag') continue; |
| [10900](#L10900) |  |
| [10901](#L10901) | $term\_taxonomy = strtolower ($term->taxonomy); |
| [10902](#L10902) | $taxonomies [$term\_taxonomy . ':' . strtolower ($term->slug)] = $term->name; |
| [10903](#L10903) | if (count ($taxonomies) > $max\_list\_items) break; |
| [10904](#L10904) | } |
| [10905](#L10905) |  |
| [10906](#L10906) | $args = array ( |
| [10907](#L10907) | 'public'    => true, |
| [10908](#L10908) | ); |
| [10909](#L10909) | $custom\_post\_types = get\_post\_types ($args, 'objects', 'and'); |
| [10910](#L10910) | foreach ($custom\_post\_types as $custom\_post\_type => $custom\_post\_data) { |
| [10911](#L10911) | $taxonomies ['post-type:' . strtolower ($custom\_post\_type)] = $custom\_post\_data->labels->singular\_name; |
| [10912](#L10912) | } |
| [10913](#L10913) |  |
| [10914](#L10914) | if (!$limited) { |
| [10915](#L10915) | $editable\_roles = get\_editable\_roles (); |
| [10916](#L10916) | foreach ($editable\_roles as $editable\_role\_slug => $editable\_role) { |
| [10917](#L10917) | $taxonomies ['user-role:' . strtolower ($editable\_role\_slug)] = $editable\_role ['name']; |
| [10918](#L10918) | } |
| [10919](#L10919) | } |
| [10920](#L10920) |  |
| [10921](#L10921) | $taxonomies ['user:logged-in'] = 'User logged in'; |
| [10922](#L10922) | $taxonomies ['user:not-logged-in'] = 'User not logged in'; |
| [10923](#L10923) |  |
| [10924](#L10924) | if (!$limited) { |
| [10925](#L10925) | $users = get\_users (); |
| [10926](#L10926) | $max\_list\_items = get\_max\_list\_items (); |
| [10927](#L10927) | foreach ($users as $user) { |
| [10928](#L10928) | $taxonomies ['user:'   . strtolower ($user->data->user\_login)] = $user->data->display\_name; |
| [10929](#L10929) | $taxonomies ['author:' . strtolower ($user->data->user\_login)] = $user->data->display\_name; |
| [10930](#L10930) | if (count ($taxonomies) > $max\_list\_items) break; |
| [10931](#L10931) | } |
| [10932](#L10932) | } |
| [10933](#L10933) |  |
| [10934](#L10934) | if (has\_filter ('wpml\_active\_languages') !== false) { |
| [10935](#L10935) | $wpml\_active\_languages = apply\_filters ('wpml\_active\_languages', null, 'orderby=id&order=desc'); |
| [10936](#L10936) |  |
| [10937](#L10937) | if (!empty ($wpml\_active\_languages)) { |
| [10938](#L10938) | foreach ($wpml\_active\_languages as $language\_code => $language) { |
| [10939](#L10939) | $taxonomies ['wpml-current-language:' . $language\_code] = esc\_html ($language ['native\_name']); |
| [10940](#L10940) | } |
| [10941](#L10941) | } |
| [10942](#L10942) | } |
| [10943](#L10943) |  |
| [10944](#L10944) | ksort ($taxonomies); |
| [10945](#L10945) |  |
| [10946](#L10946) | return $taxonomies; |
| [10947](#L10947) | } |
| [10948](#L10948) |  |
| [10949](#L10949) | function ai\_get\_post\_id\_list () { |
| [10950](#L10950) | if (function\_exists ('ai\_remote\_plugin\_data')) { |
| [10951](#L10951) | $data = ai\_remote\_plugin\_data ('post-ids'); |
| [10952](#L10952) | if (is\_array ($data)) return $data; |
| [10953](#L10953) | } |
| [10954](#L10954) |  |
| [10955](#L10955) | $args = array ( |
| [10956](#L10956) | 'public'    => true, |
| [10957](#L10957) | '\_builtin'  => false |
| [10958](#L10958) | ); |
| [10959](#L10959) | $custom\_post\_types = get\_post\_types ($args, 'names', 'and'); |
| [10960](#L10960) | $screens = array\_values (array\_merge (array ('post', 'page'), $custom\_post\_types)); |
| [10961](#L10961) |  |
| [10962](#L10962) | $posts\_pages = array (); |
| [10963](#L10963) | $offset = 0; |
| [10964](#L10964) |  |
| [10965](#L10965) | $max\_list\_items = get\_max\_list\_items (); |
| [10966](#L10966) |  |
| [10967](#L10967) | do { |
| [10968](#L10968) | $args = array ( |
| [10969](#L10969) | 'posts\_per\_page'   => AI\_MAX\_WP\_QUERY\_ITEMS, |
| [10970](#L10970) | 'offset'           => $offset, |
| [10971](#L10971) | 'category'         => '', |
| [10972](#L10972) | 'category\_name'    => '', |
| [10973](#L10973) | 'orderby'          => 'ID', |
| [10974](#L10974) | 'order'            => 'ASC', |
| [10975](#L10975) | 'include'          => '', |
| [10976](#L10976) | 'exclude'          => '', |
| [10977](#L10977) | 'meta\_key'         => '', |
| [10978](#L10978) | 'meta\_value'       => '', |
| [10979](#L10979) | 'post\_type'        => $screens, |
| [10980](#L10980) | 'post\_mime\_type'   => '', |
| [10981](#L10981) | 'post\_parent'      => '', |
| [10982](#L10982) | 'author'           => '', |
| [10983](#L10983) | 'author\_name'      => '', |
| [10984](#L10984) | 'post\_status'      => '', |
| [10985](#L10985) | 'suppress\_filters' => true, |
| [10986](#L10986) | ); |
| [10987](#L10987) | $temp\_posts\_pages = get\_posts ($args); |
| [10988](#L10988) |  |
| [10989](#L10989) | foreach ($temp\_posts\_pages as $index => $post\_page) { |
| [10990](#L10990) | $posts\_pages [] =  (object) ['ID' => $post\_page->ID, 'post\_type' => $post\_page->post\_type, 'post\_title' => $post\_page->post\_title]; |
| [10991](#L10991) | } |
| [10992](#L10992) |  |
| [10993](#L10993) | $offset += count ($temp\_posts\_pages); |
| [10994](#L10994) | } while (count ($temp\_posts\_pages) != 0 && count ($posts\_pages) <= $max\_list\_items); |
| [10995](#L10995) |  |
| [10996](#L10996) | $posts\_pages = array\_slice ($posts\_pages, 0, $max\_list\_items); |
| [10997](#L10997) |  |
| [10998](#L10998) | return $posts\_pages; |
| [10999](#L10999) | } |
| [11000](#L11000) |  |
| [11001](#L11001) | function ai\_check\_filter\_hook ($block) { |
| [11002](#L11002) | // Called by W3TC code and Ajax requests |
| [11003](#L11003) |  |
| [11004](#L11004) | $check = apply\_filters ("ai\_block\_insertion\_check", true, $block, false); |
| [11005](#L11005) |  |
| [11006](#L11006) | // Called with false as $server\_side\_check = client-side check or W3TC check so null should not be returned from the filter hook - return false |
| [11007](#L11007) | if ($check === null) { |
| [11008](#L11008) | return false; |
| [11009](#L11009) | } |
| [11010](#L11010) |  |
| [11011](#L11011) | return $check; |
| [11012](#L11012) | } |
| [11013](#L11013) |  |
| [11014](#L11014) | function ai\_set\_cookie ($block, $property, $value) { |
| [11015](#L11015) | $ai\_cookie\_name = 'aiBLOCKS'; |
| [11016](#L11016) |  |
| [11017](#L11017) | if (isset ($\_COOKIE [$ai\_cookie\_name])) { |
| [11018](#L11018) | $ai\_cookie = json\_decode (stripslashes ($\_COOKIE [$ai\_cookie\_name])); |
| [11019](#L11019) | } else $ai\_cookie = new stdClass(); |
| [11020](#L11020) |  |
| [11021](#L11021) | //  print\_r ($ai\_cookie); |
| [11022](#L11022) |  |
| [11023](#L11023) | if ($value == '') { |
| [11024](#L11024) | if (isset ($ai\_cookie->$block) && is\_object ($ai\_cookie->$block)) { |
| [11025](#L11025) | unset ($ai\_cookie->$block->$property); |
| [11026](#L11026) | $ai\_cookie\_array = (array) $ai\_cookie->$block; |
| [11027](#L11027) | if (empty ($ai\_cookie\_array)) { |
| [11028](#L11028) | unset ($ai\_cookie->$block); |
| [11029](#L11029) | } |
| [11030](#L11030) | } |
| [11031](#L11031) | } else { |
| [11032](#L11032) | if (!isset ($ai\_cookie->$block)) { |
| [11033](#L11033) | $ai\_cookie->$block = new stdClass(); |
| [11034](#L11034) | } |
| [11035](#L11035) | $ai\_cookie->$block->$property = $value; |
| [11036](#L11036) | } |
| [11037](#L11037) |  |
| [11038](#L11038) | $ai\_cookie\_array = (array) $ai\_cookie; |
| [11039](#L11039) | if (empty ($ai\_cookie\_array)) { |
| [11040](#L11040) | unset ($\_COOKIE [$ai\_cookie\_name]); |
| [11041](#L11041) | ai\_setcookie ($ai\_cookie\_name, null, - 1, '/'); |
| [11042](#L11042) | } else { |
| [11043](#L11043) | //      $\_COOKIE [$ai\_cookie\_name] = addslashes (json\_encode ($ai\_cookie)); |
| [11044](#L11044) | $\_COOKIE [$ai\_cookie\_name] = json\_encode ($ai\_cookie); |
| [11045](#L11045) | ai\_setcookie ($ai\_cookie\_name, $\_COOKIE [$ai\_cookie\_name], time () + 365 \* 24 \* 3600, '/'); |
| [11046](#L11046) | } |
| [11047](#L11047) |  |
| [11048](#L11048) | //    if (isset ($\_COOKIE [$ai\_cookie\_name])) { |
| [11049](#L11049) | //      print\_r ($\_COOKIE [$ai\_cookie\_name]); |
| [11050](#L11050) | //    } else echo "NO COOKIE <br />"; |
| [11051](#L11051) | } |
| [11052](#L11052) |  |
| [11053](#L11053) | function get\_paragraph\_start\_positions ($content, $multibyte, $paragraph\_end\_positions, $paragraph\_start\_strings, &$paragraph\_positions, &$active\_paragraph\_positions) { |
| [11054](#L11054) | foreach ($paragraph\_start\_strings as $paragraph\_start\_string) { |
| [11055](#L11055) | if (trim ($paragraph\_start\_string) == '') continue; |
| [11056](#L11056) |  |
| [11057](#L11057) | $last\_position = - 1; |
| [11058](#L11058) |  |
| [11059](#L11059) | $paragraph\_start\_string = trim ($paragraph\_start\_string); |
| [11060](#L11060) | if ($paragraph\_start\_string == "#") { |
| [11061](#L11061) | $paragraph\_start = "\r\n\r\n"; |
| [11062](#L11062) | if (!in\_array (0, $paragraph\_positions)) { |
| [11063](#L11063) | $paragraph\_positions [] = 0; |
| [11064](#L11064) | $active\_paragraph\_positions [0] = 1; |
| [11065](#L11065) | } |
| [11066](#L11066) | } else $paragraph\_start = '<' . $paragraph\_start\_string; |
| [11067](#L11067) |  |
| [11068](#L11068) | if ($multibyte) { |
| [11069](#L11069) | $paragraph\_start\_len = mb\_strlen ($paragraph\_start); |
| [11070](#L11070) | while (mb\_stripos ($content, $paragraph\_start, $last\_position + 1) !== false) { |
| [11071](#L11071) | $last\_position = mb\_stripos ($content, $paragraph\_start, $last\_position + 1); |
| [11072](#L11072) | if ($paragraph\_start\_string == "#") { |
| [11073](#L11073) | $paragraph\_positions [] = $last\_position + 4; |
| [11074](#L11074) | $active\_paragraph\_positions [$last\_position + 4] = 1; |
| [11075](#L11075) | } elseif (mb\_substr ($content, $last\_position + $paragraph\_start\_len, 1) == ">" || mb\_substr ($content, $last\_position + $paragraph\_start\_len, 1) == " ") { |
| [11076](#L11076) | $paragraph\_positions [] = $last\_position; |
| [11077](#L11077) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11078](#L11078) | } |
| [11079](#L11079) | } |
| [11080](#L11080) | } else { |
| [11081](#L11081) | $paragraph\_start\_len = strlen ($paragraph\_start); |
| [11082](#L11082) | while (stripos ($content, $paragraph\_start, $last\_position + 1) !== false) { |
| [11083](#L11083) | $last\_position = stripos ($content, $paragraph\_start, $last\_position + 1); |
| [11084](#L11084) | if ($paragraph\_start\_string == "#") { |
| [11085](#L11085) | $paragraph\_positions [] = $last\_position + 4; |
| [11086](#L11086) | $active\_paragraph\_positions [$last\_position + 4] = 1; |
| [11087](#L11087) | } elseif ($content [$last\_position + $paragraph\_start\_len] == ">" || $content [$last\_position + $paragraph\_start\_len] == " ") { |
| [11088](#L11088) | $paragraph\_positions [] = $last\_position; |
| [11089](#L11089) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11090](#L11090) | } |
| [11091](#L11091) | } |
| [11092](#L11092) | } |
| [11093](#L11093) | } |
| [11094](#L11094) |  |
| [11095](#L11095) | // Consistency check |
| [11096](#L11096) | // Not possible when there is more than one tag - the second and next tag positions are counting content from the beginning |
| [11097](#L11097) | if (count ($paragraph\_start\_strings) == 1 && count ($paragraph\_end\_positions) != 0) { |
| [11098](#L11098) | foreach ($paragraph\_end\_positions as $index => $paragraph\_end\_position) { |
| [11099](#L11099) | if ($index == 0) { |
| [11100](#L11100) | if (!isset ($paragraph\_positions [$index]) || $paragraph\_positions [$index] >= $paragraph\_end\_position) { |
| [11101](#L11101) | $paragraph\_positions [$index] = 0; |
| [11102](#L11102) | } |
| [11103](#L11103) | } else { |
| [11104](#L11104) | if (!isset ($paragraph\_positions [$index]) || $paragraph\_positions [$index] >= $paragraph\_end\_position || $paragraph\_positions [$index] <= $paragraph\_end\_positions [$index - 1]) { |
| [11105](#L11105) | $paragraph\_positions [$index] = $paragraph\_end\_positions [$index - 1] + 1; |
| [11106](#L11106) | } |
| [11107](#L11107) | } |
| [11108](#L11108) | } |
| [11109](#L11109) | } |
| [11110](#L11110) | } |
| [11111](#L11111) |  |
| [11112](#L11112) | function get\_paragraph\_end\_positions ($content, $multibyte, $paragraph\_start\_positions, $paragraph\_end\_strings, &$paragraph\_positions, &$active\_paragraph\_positions) { |
| [11113](#L11113) |  |
| [11114](#L11114) | $no\_closing\_tag = array ('img', 'hr', 'br'); |
| [11115](#L11115) |  |
| [11116](#L11116) | foreach ($paragraph\_end\_strings as $paragraph\_end\_string) { |
| [11117](#L11117) |  |
| [11118](#L11118) | $last\_position = - 1; |
| [11119](#L11119) |  |
| [11120](#L11120) | $paragraph\_end\_string = trim ($paragraph\_end\_string); |
| [11121](#L11121) | if ($paragraph\_end\_string == '') continue; |
| [11122](#L11122) |  |
| [11123](#L11123) | if (in\_array ($paragraph\_end\_string, $no\_closing\_tag)) { |
| [11124](#L11124) | if (preg\_match\_all ("/<$paragraph\_end\_string([^>]\*?)>/", $content, $images)) { |
| [11125](#L11125) | foreach ($images [0] as $paragraph\_end) { |
| [11126](#L11126) | if ($multibyte) { |
| [11127](#L11127) | $last\_position = mb\_stripos ($content, $paragraph\_end, $last\_position + 1) + mb\_strlen ($paragraph\_end) - 1; |
| [11128](#L11128) | $paragraph\_positions [] = $last\_position; |
| [11129](#L11129) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11130](#L11130) | } else { |
| [11131](#L11131) | $last\_position = stripos ($content, $paragraph\_end, $last\_position + 1) + strlen ($paragraph\_end) - 1; |
| [11132](#L11132) | $paragraph\_positions [] = $last\_position; |
| [11133](#L11133) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11134](#L11134) | } |
| [11135](#L11135) | } |
| [11136](#L11136) | } |
| [11137](#L11137) | continue; |
| [11138](#L11138) | } |
| [11139](#L11139) | elseif ($paragraph\_end\_string == "#") { |
| [11140](#L11140) | $paragraph\_end = "\r\n\r\n"; |
| [11141](#L11141) |  |
| [11142](#L11142) | if ($multibyte) { |
| [11143](#L11143) | $last\_content\_position = mb\_strlen ($content) - 1; |
| [11144](#L11144) | } else { |
| [11145](#L11145) | $last\_content\_position = strlen ($content) - 1; |
| [11146](#L11146) | } |
| [11147](#L11147) |  |
| [11148](#L11148) | if (!in\_array ($last\_content\_position, $paragraph\_positions)) { |
| [11149](#L11149) | $paragraph\_positions [] = $last\_content\_position; |
| [11150](#L11150) | $active\_paragraph\_positions [$last\_content\_position] = 1; |
| [11151](#L11151) | } |
| [11152](#L11152) | } else $paragraph\_end = '</' . $paragraph\_end\_string . '>'; |
| [11153](#L11153) |  |
| [11154](#L11154) | if ($multibyte) { |
| [11155](#L11155) | while (mb\_stripos ($content, $paragraph\_end, $last\_position + 1) !== false) { |
| [11156](#L11156) | $last\_position = mb\_stripos ($content, $paragraph\_end, $last\_position + 1) + mb\_strlen ($paragraph\_end) - 1; |
| [11157](#L11157) | if ($paragraph\_end\_string == "#") { |
| [11158](#L11158) | $paragraph\_positions [] = $last\_position - 4; |
| [11159](#L11159) | $active\_paragraph\_positions [$last\_position - 4] = 1; |
| [11160](#L11160) | } else { |
| [11161](#L11161) | $paragraph\_positions [] = $last\_position; |
| [11162](#L11162) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11163](#L11163) | } |
| [11164](#L11164) | } |
| [11165](#L11165) | } else { |
| [11166](#L11166) | // Weird timeout |
| [11167](#L11167) | if (strlen ($paragraph\_end) >= 4) |
| [11168](#L11168) |  |
| [11169](#L11169) | while (stripos ($content, $paragraph\_end, $last\_position + 1) !== false) { |
| [11170](#L11170) | //          echo strlen ($content),  ' ', strlen ($paragraph\_end), "<br />\n"; |
| [11171](#L11171) | $last\_position = stripos ($content, $paragraph\_end, $last\_position + 1) + strlen ($paragraph\_end) - 1; |
| [11172](#L11172) | if ($paragraph\_end\_string == "#") { |
| [11173](#L11173) | $paragraph\_positions [] = $last\_position - 4; |
| [11174](#L11174) | $active\_paragraph\_positions [$last\_position - 4] = 1; |
| [11175](#L11175) | } else { |
| [11176](#L11176) | $paragraph\_positions [] = $last\_position; |
| [11177](#L11177) | $active\_paragraph\_positions [$last\_position] = 1; |
| [11178](#L11178) | } |
| [11179](#L11179) | } |
| [11180](#L11180) | } |
| [11181](#L11181) | } |
| [11182](#L11182) |  |
| [11183](#L11183) | // Consistency check |
| [11184](#L11184) | // Not possible when there is more than one tag - the second and next tag positions are counting content from the beginning |
| [11185](#L11185) | if (count ($paragraph\_end\_strings) == 1 && count ($paragraph\_start\_positions) != 0) { |
| [11186](#L11186) | foreach ($paragraph\_start\_positions as $index => $paragraph\_start\_position) { |
| [11187](#L11187) | if ($index == count ($paragraph\_start\_positions) - 1) { |
| [11188](#L11188) | if (!isset ($paragraph\_positions [$index]) || $paragraph\_positions [$index] <= $paragraph\_start\_position) { |
| [11189](#L11189) | $paragraph\_positions [$index] = strlen ($content) - 1; |
| [11190](#L11190) | } |
| [11191](#L11191) | } else { |
| [11192](#L11192) | if (!isset ($paragraph\_positions [$index]) || $paragraph\_positions [$index] <= $paragraph\_start\_position || $paragraph\_positions [$index] >= $paragraph\_start\_positions [$index + 1]) { |
| [11193](#L11193) | $paragraph\_positions [$index] = $paragraph\_start\_positions [$index + 1] - 1; |
| [11194](#L11194) | } |
| [11195](#L11195) | } |
| [11196](#L11196) | } |
| [11197](#L11197) | } |
| [11198](#L11198) | } |
| [11199](#L11199) |  |
| [11200](#L11200) | function ai\_secret\_key () { |
| [11201](#L11201) | $key = ''; |
| [11202](#L11202) | if (defined ('NONCE\_KEY')) { |
| [11203](#L11203) | $key = NONCE\_KEY; |
| [11204](#L11204) | } |
| [11205](#L11205) | $key .= AD\_INSERTER\_VERSION; |
| [11206](#L11206) | return (substr (preg\_replace ("/[^A-Za-z]+/", '', base64\_encode ($key)), 0, 16)); |
| [11207](#L11207) | } |
| [11208](#L11208) |  |
| [11209](#L11209) | //function ai\_the\_generator ($generator) { |
| [11210](#L11210) | ////  return preg\_replace ('/content="(.\*?)"/', 'content="$1, '.AD\_INSERTER\_NAME.' '. AD\_INSERTER\_VERSION.'"', $generator); |
| [11211](#L11211) | //  return $generator . PHP\_EOL . '<meta name="generator" content="'.AD\_INSERTER\_NAME.' '.AD\_INSERTER\_VERSION.'" />'; |
| [11212](#L11212) | //} |
| [11213](#L11213) |  |
| [11214](#L11214) | function ai\_ampforwp\_check\_disabled () { |
| [11215](#L11215) | if (is\_multisite()) { |
| [11216](#L11216) | $option\_active\_plugins = array\_merge (array\_flip (get\_site\_option ('active\_sitewide\_plugins', array ())), get\_option ('active\_plugins', array ())); |
| [11217](#L11217) | } else $option\_active\_plugins = get\_option ('active\_plugins'); |
| [11218](#L11218) |  |
| [11219](#L11219) | $present = false; |
| [11220](#L11220) | foreach ($option\_active\_plugins as $option\_active\_plugin) { |
| [11221](#L11221) | if ($option\_active\_plugin == AD\_INSERTER\_SLUG . '/ad-inserter.php') { |
| [11222](#L11222) | $present = true; |
| [11223](#L11223) | break; |
| [11224](#L11224) | } |
| [11225](#L11225) | } |
| [11226](#L11226) |  |
| [11227](#L11227) | if (!$present) return false; |
| [11228](#L11228) |  |
| [11229](#L11229) | if (function\_exists ('ampforwp\_api\_request\_disable\_plugin')) { |
| [11230](#L11230) | $option\_active\_plugins = ampforwp\_api\_request\_disable\_plugin ($option\_active\_plugins); |
| [11231](#L11231) | } |
| [11232](#L11232) |  |
| [11233](#L11233) | $disabled = true; |
| [11234](#L11234) | foreach ($option\_active\_plugins as $option\_active\_plugin) { |
| [11235](#L11235) | if ($option\_active\_plugin == AD\_INSERTER\_SLUG . '/ad-inserter.php') { |
| [11236](#L11236) | $disabled = false; |
| [11237](#L11237) | break; |
| [11238](#L11238) | } |
| [11239](#L11239) | } |
| [11240](#L11240) |  |
| [11241](#L11241) | return $disabled; |
| [11242](#L11242) | } |
| [11243](#L11243) |  |
| [11244](#L11244) |  |
| [11245](#L11245) | function ai\_amp\_plugin\_custom\_css () { |
| [11246](#L11246) | if (is\_multisite()) { |
| [11247](#L11247) | $option\_active\_plugins = array\_merge (array\_flip (get\_site\_option ('active\_sitewide\_plugins', array ())), get\_option ('active\_plugins', array ())); |
| [11248](#L11248) | } else $option\_active\_plugins = get\_option ('active\_plugins'); |
| [11249](#L11249) |  |
| [11250](#L11250) | //  echo "<pre>"; |
| [11251](#L11251) | //  print\_r ($option\_active\_plugins); |
| [11252](#L11252) | //  echo "</pre>"; |
| [11253](#L11253) |  |
| [11254](#L11254) | foreach ($option\_active\_plugins as $option\_active\_plugin) { |
| [11255](#L11255) | if ($option\_active\_plugin == 'amp-wp/amp-wp.php') { |
| [11256](#L11256) | return true; |
| [11257](#L11257) | } |
| [11258](#L11258) | if ($option\_active\_plugin == 'better-amp/better-amp.php') { |
| [11259](#L11259) | return true; |
| [11260](#L11260) | } |
| [11261](#L11261) | } |
| [11262](#L11262) |  |
| [11263](#L11263) | return false; |
| [11264](#L11264) | } |
| [11265](#L11265) |  |
| [11266](#L11266) | function ai\_primary\_category () { |
| [11267](#L11267) | $primary\_category = ai\_rank\_math\_primary\_category (); |
| [11268](#L11268) | if ($primary\_category != '') { |
| [11269](#L11269) | return $primary\_category; |
| [11270](#L11270) | } |
| [11271](#L11271) | // Returns the first category if primary category is not defined |
| [11272](#L11272) | $primary\_category = ai\_yoast\_primary\_category (); |
| [11273](#L11273) | return $primary\_category; |
| [11274](#L11274) | } |
| [11275](#L11275) |  |
| [11276](#L11276) | function ai\_yoast\_primary\_category () { |
| [11277](#L11277) | $primary\_category = ''; |
| [11278](#L11278) | $category = get\_the\_category (); |
| [11279](#L11279) | // If post has a category assigned. |
| [11280](#L11280) | if ($category) { |
| [11281](#L11281) | if (class\_exists ('WPSEO\_Primary\_Term')) { |
| [11282](#L11282) | // Show the post's 'Primary' category, if this Yoast feature is available, & one is set |
| [11283](#L11283) | $wpseo\_primary\_term = new WPSEO\_Primary\_Term ('category', get\_the\_id ()); |
| [11284](#L11284) | $wpseo\_primary\_term = $wpseo\_primary\_term->get\_primary\_term (); |
| [11285](#L11285) | $term = get\_term ($wpseo\_primary\_term); |
| [11286](#L11286) |  |
| [11287](#L11287) | if (is\_wp\_error ($term)) { |
| [11288](#L11288) | // Default to first category (not Yoast) if an error is returned |
| [11289](#L11289) | $primary\_category = $category [0]->slug; |
| [11290](#L11290) | } else { |
| [11291](#L11291) | // Yoast Primary category |
| [11292](#L11292) | $primary\_category = $term->slug; |
| [11293](#L11293) | } |
| [11294](#L11294) | } else { |
| [11295](#L11295) | // Default, display the first category in WP's list of assigned categories |
| [11296](#L11296) | $primary\_category = $category [0]->slug; |
| [11297](#L11297) | } |
| [11298](#L11298) | } |
| [11299](#L11299) | return $primary\_category; |
| [11300](#L11300) | } |
| [11301](#L11301) |  |
| [11302](#L11302) | function ai\_rank\_math\_primary\_category () { |
| [11303](#L11303) | $primary\_category = ''; |
| [11304](#L11304) | if (class\_exists ('RankMath')) { |
| [11305](#L11305) | $primary\_cat\_id = get\_post\_meta (get\_the\_id (), 'rank\_math\_primary\_category', true); |
| [11306](#L11306) | if ($primary\_cat\_id) { |
| [11307](#L11307) | $category = get\_term ($primary\_cat\_id, 'category'); |
| [11308](#L11308) | $primary\_category = $category->slug; |
| [11309](#L11309) | } |
| [11310](#L11310) | } |
| [11311](#L11311) | return $primary\_category; |
| [11312](#L11312) | } |
| [11313](#L11313) |  |
| [11314](#L11314) | function ai\_is\_page\_builder () { |
| [11315](#L11315) | //  echo $\_SERVER ['HTTP\_HOST'], ' ', $\_SERVER ['REQUEST\_URI'], "<br />\n"; |
| [11316](#L11316) | //  global $ai\_wp\_data; |
| [11317](#L11317) | //  echo $ai\_wp\_data [AI\_WP\_PAGE\_TYPE], "<br />\n"; |
| [11318](#L11318) |  |
| [11319](#L11319) | // Elemetor |
| [11320](#L11320) | if (class\_exists ('Elementor\Plugin') && (\Elementor\Plugin::$instance->editor->is\_edit\_mode () || \Elementor\Plugin::$instance->preview->is\_preview\_mode ())) { |
| [11321](#L11321) | return true; |
| [11322](#L11322) | } |
| [11323](#L11323) |  |
| [11324](#L11324) | return false; |
| [11325](#L11325) | } |
| [11326](#L11326) |  |
| [11327](#L11327) |  |
| [11328](#L11328) | function ai\_add\_rewrite\_rules () { |
| [11329](#L11329) | if (get\_option (AI\_ADS\_TXT\_NAME) !== false) { |
| [11330](#L11330) | add\_rewrite\_rule ('ads\.txt', str\_replace (home\_url () .'/', '', admin\_url ('admin-ajax.php?action=ai\_ajax&ads-txt=')), 'top'); |
| [11331](#L11331) | } |
| [11332](#L11332) |  |
| [11333](#L11333) | if (function\_exists ('ai\_add\_rewrite\_rules\_2')) ai\_add\_rewrite\_rules\_2 (); |
| [11334](#L11334) | } |
| [11335](#L11335) |  |
| [11336](#L11336) | function ai\_js\_dom\_ready ($js\_code, $script\_tag = true, $script\_class = '') { |
| [11337](#L11337) | $id = rand (100000, 999999) . rand (100000, 999999); |
| [11338](#L11338) | $id\_fn = ''; |
| [11339](#L11339) | $code = ''; |
| [11340](#L11340) |  |
| [11341](#L11341) | $inline\_js = ai\_inline\_js (); |
| [11342](#L11342) |  |
| [11343](#L11343) | if (!$inline\_js) { |
| [11344](#L11344) | $id\_fn = '\_fn'; |
| [11345](#L11345) | } |
| [11346](#L11346) |  |
| [11347](#L11347) | if ($script\_class != '') { |
| [11348](#L11348) | $script\_class = ' class="' . $script\_class . '"'; |
| [11349](#L11349) | } |
| [11350](#L11350) |  |
| [11351](#L11351) | if ($script\_tag) { |
| [11352](#L11352) | $code .= "<!-- AI\_JS --><script{$script\_class}> |
| [11353](#L11353) | "; |
| [11354](#L11354) |  |
| [11355](#L11355) | $js\_code = '/\* AI\_JS \*/' . $js\_code . '/\* AI\_JS \*/'; |
| [11356](#L11356) | } |
| [11357](#L11357) |  |
| [11358](#L11358) | $code .= "ai\_run\_{$id} = function(){{$js\_code}};"; |
| [11359](#L11359) |  |
| [11360](#L11360) | if (!$inline\_js) { |
| [11361](#L11361) | $code .= "ai\_run\_{$id}{$id\_fn} = function(){ai\_wait\_for\_functions ().then (ai\_run\_{$id})}"; |
| [11362](#L11362) | } |
| [11363](#L11363) |  |
| [11364](#L11364) | $code .= " |
| [11365](#L11365) | "; |
| [11366](#L11366) |  |
| [11367](#L11367) | if ($script\_tag) { |
| [11368](#L11368) | $code .= "  "; |
| [11369](#L11369) | } |
| [11370](#L11370) |  |
| [11371](#L11371) | $code .= "if (document.readyState === 'complete' || (document.readyState !== 'loading' && !document.documentElement.doScroll)) ai\_run\_{$id}{$id\_fn} (); else document.addEventListener ('DOMContentLoaded', ai\_run\_{$id}{$id\_fn});"; |
| [11372](#L11372) |  |
| [11373](#L11373) | if ($script\_tag) { |
| [11374](#L11374) | $code .= " |
| [11375](#L11375) | </script><!-- AI\_JS --> |
| [11376](#L11376) | "; |
| [11377](#L11377) | } |
| [11378](#L11378) | return ($code); |
| [11379](#L11379) | } |
| [11380](#L11380) |  |
| [11381](#L11381) | function ai\_extract\_js\_code ($code) { |
| [11382](#L11382) | global $ai\_wp\_data; |
| [11383](#L11383) |  |
| [11384](#L11384) | if (strpos ($code, '<!-- AI\_JS -->') !== false) { |
| [11385](#L11385) | if (preg\_match\_all ('#/\\* AI\_JS \\*/(.+?)/\\* AI\_JS \\*/#s', $code, $js\_matches)) { |
| [11386](#L11386) | $js\_code\_dom\_ready = ''; |
| [11387](#L11387) | foreach ($js\_matches [1] as $js\_code) { |
| [11388](#L11388) | $js\_code\_dom\_ready .= $js\_code."\n"; |
| [11389](#L11389) | } |
| [11390](#L11390) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] = $js\_code\_dom\_ready . $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY]; |
| [11391](#L11391) | } |
| [11392](#L11392) |  |
| [11393](#L11393) | $code = preg\_replace ('#<!-- AI\_JS -->(.+?)<!-- AI\_JS -->#s', '', $code); |
| [11394](#L11394) | } |
| [11395](#L11395) | return $code; |
| [11396](#L11396) | } |
| [11397](#L11397) |  |
| [11398](#L11398) | function ai\_strip\_js\_markers ($code) { |
| [11399](#L11399) | $code = preg\_replace ('#<!-- AI\_JS -->#s', '', $code); |
| [11400](#L11400) | $code = preg\_replace ('#/\\* AI\_JS \\*/#s', '', $code); |
| [11401](#L11401) |  |
| [11402](#L11402) | return ($code); |
| [11403](#L11403) | } |
| [11404](#L11404) |  |
| [11405](#L11405) | function ai\_strip\_w3tc\_markers ($code) { |
| [11406](#L11406) | if (defined ('W3TC\_DYNAMIC\_SECURITY')) { |
| [11407](#L11407) | //    $code = preg\_replace ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->(.+?)<!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#s', '', $code); |
| [11408](#L11408) | $code = preg\_replace ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' (.+?) --><!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#s', '', $code); |
| [11409](#L11409) | } |
| [11410](#L11410) |  |
| [11411](#L11411) | return ($code); |
| [11412](#L11412) | } |
| [11413](#L11413) |  |
| [11414](#L11414) | function ai\_extract\_debug\_bar ($ai\_code) { |
| [11415](#L11415) | if (preg\_match ('#<section class=["\']ai-debug-bar.\*?</section>#s', $ai\_code, $match)) { |
| [11416](#L11416) | $debug\_bar = str\_replace (array ('ai-debug-default', 'debug-viewport-invisible'), '', $match [0]); |
| [11417](#L11417) | $debug\_bar = preg\_replace ('#<kbd class=["\']ai-debug-text-center["\']>(.\*?)<kbd#s', '<kbd class="ai-debug-text-center"><kbd', $debug\_bar); |
| [11418](#L11418) |  |
| [11419](#L11419) | if (preg\_match ('#<pre class=["\']ai-w3tc-debug ai-w3tc-run.\*?</pre>#s', $ai\_code, $match)) { |
| [11420](#L11420) | $w3tc\_debug = $match [0]; |
| [11421](#L11421) | } else $w3tc\_debug = ''; |
| [11422](#L11422) |  |
| [11423](#L11423) | return '<section class="ai-debug-block">' . $debug\_bar . $w3tc\_debug . '</section><!-- AI-W3TC-LOG -->'; |
| [11424](#L11424) | } |
| [11425](#L11425) | } |
| [11426](#L11426) |  |
| [11427](#L11427) | function ai\_w3tc\_debug\_info ($w3tc\_debug, $class = '') { |
| [11428](#L11428) | return '<pre class="ai-w3tc-debug '.$class.'">' . implode ("\n", $w3tc\_debug) . "</pre>\n"; |
| [11429](#L11429) | } |
| [11430](#L11430) |  |
| [11431](#L11431) | function ai\_w3tc\_block\_start ($block) { |
| [11432](#L11432) | global $ai\_w3tc\_nesting\_level; |
| [11433](#L11433) |  |
| [11434](#L11434) | if (!isset ($ai\_w3tc\_nesting\_level)) { |
| [11435](#L11435) | $ai\_w3tc\_nesting\_level = 0; |
| [11436](#L11436) | } |
| [11437](#L11437) |  |
| [11438](#L11438) | $ai\_w3tc\_nesting\_level ++; |
| [11439](#L11439) |  |
| [11440](#L11440) | if ($ai\_w3tc\_nesting\_level > 1) { |
| [11441](#L11441) | ai\_w3tc\_log\_run (''); |
| [11442](#L11442) | } |
| [11443](#L11443) |  |
| [11444](#L11444) | ai\_w3tc\_log\_run ("BLOCK $block W3TC START"); |
| [11445](#L11445) | } |
| [11446](#L11446) |  |
| [11447](#L11447) | function ai\_w3tc\_block\_end ($block, $ai\_code, $ai\_enabled, $ai\_fallback, $ai\_index) { |
| [11448](#L11448) | global $ai\_w3tc\_debugging, $ai\_w3tc\_nesting\_level; |
| [11449](#L11449) |  |
| [11450](#L11450) | if (!isset ($ai\_w3tc\_nesting\_level)) { |
| [11451](#L11451) | $ai\_w3tc\_nesting\_level = 0; |
| [11452](#L11452) | } |
| [11453](#L11453) |  |
| [11454](#L11454) | ai\_w3tc\_log\_run ("BLOCK $block W3TC END" . ($ai\_enabled ? '' : ': NOT ENABLED') . ' [' . (isset ($ai\_fallback) ? $ai\_fallback : '') . ',' . (isset ($ai\_index) ? $ai\_index : '') . ']'); |
| [11455](#L11455) |  |
| [11456](#L11456) | $ai\_w3tc\_nesting\_level --; |
| [11457](#L11457) |  |
| [11458](#L11458) | if ($ai\_w3tc\_nesting\_level != 0) { |
| [11459](#L11459) | ai\_w3tc\_log\_run (''); |
| [11460](#L11460) | return $ai\_code = str\_replace ("<!-- AI-W3TC-LOG -->", '', $ai\_code); |
| [11461](#L11461) | } |
| [11462](#L11462) |  |
| [11463](#L11463) | // Placeholder for additional messages |
| [11464](#L11464) | $ai\_w3tc\_debugging []= "<!-- AI-W3TC-LOG-END -->"; |
| [11465](#L11465) |  |
| [11466](#L11466) | $new\_code = str\_replace ("<!-- AI-W3TC-LOG -->", ai\_w3tc\_debug\_info ($ai\_w3tc\_debugging, "ai-w3tc-run"), $ai\_code); |
| [11467](#L11467) |  |
| [11468](#L11468) | $ai\_w3tc\_debugging = array (); |
| [11469](#L11469) |  |
| [11470](#L11470) | return $new\_code; |
| [11471](#L11471) | } |
| [11472](#L11472) |  |
| [11473](#L11473) | function ai\_w3tc\_block\_end\_message ($message, $ai\_code) { |
| [11474](#L11474) | return str\_replace ("<!-- AI-W3TC-LOG-END -->", $message . "<!-- AI-W3TC-LOG-END -->\n", $ai\_code); |
| [11475](#L11475) | } |
| [11476](#L11476) |  |
| [11477](#L11477) |  |
| [11478](#L11478) | function ai\_w3tc\_log\_run ($w3tc\_debug\_text, $css = '') { |
| [11479](#L11479) | global $ai\_w3tc\_debugging, $ai\_w3tc\_nesting\_level; |
| [11480](#L11480) |  |
| [11481](#L11481) | if (!isset ($ai\_w3tc\_debugging)) { |
| [11482](#L11482) | $ai\_w3tc\_debugging = array (); |
| [11483](#L11483) | } |
| [11484](#L11484) |  |
| [11485](#L11485) | if (!isset ($ai\_w3tc\_nesting\_level)) { |
| [11486](#L11486) | $ai\_w3tc\_nesting\_level = 0; |
| [11487](#L11487) | } |
| [11488](#L11488) |  |
| [11489](#L11489) | if ($css != '') { |
| [11490](#L11490) | if (is\_array ($w3tc\_debug\_text)) { |
| [11491](#L11491) | foreach ($w3tc\_debug\_text as $index => $w3tc\_debug\_line) { |
| [11492](#L11492) | $w3tc\_debug\_text [$index] = "<span style='$css'>" . $w3tc\_debug\_text [$index] . '</span>'; |
| [11493](#L11493) | } |
| [11494](#L11494) | array\_unshift ($w3tc\_debug\_text, "\n"); |
| [11495](#L11495) | } else $w3tc\_debug\_text = "<span style='$css'>" . $w3tc\_debug\_text . '</span>'; |
| [11496](#L11496) | } |
| [11497](#L11497) |  |
| [11498](#L11498) | if (isset ($ai\_w3tc\_nesting\_level) && $ai\_w3tc\_nesting\_level > 1) { |
| [11499](#L11499) | if (is\_array ($w3tc\_debug\_text)) { |
| [11500](#L11500) | foreach ($w3tc\_debug\_text as $index => $w3tc\_debug\_line) { |
| [11501](#L11501) | $w3tc\_debug\_text [$index] = str\_repeat ('  ', $ai\_w3tc\_nesting\_level - 1) . $w3tc\_debug\_text [$index]; |
| [11502](#L11502) | } |
| [11503](#L11503) | array\_unshift ($w3tc\_debug\_text, "\n"); |
| [11504](#L11504) | } else $w3tc\_debug\_text = str\_repeat ('  ', $ai\_w3tc\_nesting\_level - 1) . $w3tc\_debug\_text; |
| [11505](#L11505) | } |
| [11506](#L11506) |  |
| [11507](#L11507) | if (is\_array ($w3tc\_debug\_text)) { |
| [11508](#L11508) | $ai\_w3tc\_debugging = array\_merge ($ai\_w3tc\_debugging, $w3tc\_debug\_text); |
| [11509](#L11509) | } else $ai\_w3tc\_debugging []= $w3tc\_debug\_text; |
| [11510](#L11510) | } |
| [11511](#L11511) |  |
| [11512](#L11512) | function ai\_w3tc\_execute\_php ($code, &$ai\_index, &$ai\_fallback) { |
| [11513](#L11513) | global $ai\_wp\_data; |
| [11514](#L11514) |  |
| [11515](#L11515) | if (strpos ($code, '<!-- mfunc') === false) return $code; |
| [11516](#L11516) |  |
| [11517](#L11517) | //  preg\_match\_all ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->(.\*?)<!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#', $code, $php\_codes); |
| [11518](#L11518) | //  $html\_codes = explode ('[?#?]', preg\_replace ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->(.\*?)<!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#', '[?#?]', $code)); |
| [11519](#L11519) |  |
| [11520](#L11520) | preg\_match\_all ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' (.\*?) --><!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#', $code, $php\_codes); |
| [11521](#L11521) | $html\_codes = explode ('[?#?]', preg\_replace ('#<!-- mfunc '.W3TC\_DYNAMIC\_SECURITY.' (.\*?) --><!-- /mfunc '.W3TC\_DYNAMIC\_SECURITY.' -->#', '[?#?]', $code)); |
| [11522](#L11522) |  |
| [11523](#L11523) | ob\_start (); |
| [11524](#L11524) |  |
| [11525](#L11525) | if ($ai\_wp\_data [AI\_W3TC\_DEBUGGING]) { |
| [11526](#L11526) | ai\_w3tc\_log\_run ('  EXECUTE PHP' . ' ['.(isset ($ai\_fallback) ? $ai\_fallback : '') . ',' . (isset ($ai\_index) ? $ai\_index : '').']'); |
| [11527](#L11527) | } |
| [11528](#L11528) |  |
| [11529](#L11529) | foreach ($html\_codes as $index => $html\_code) { |
| [11530](#L11530) | if ($html\_code != '') { |
| [11531](#L11531) | if ($ai\_wp\_data [AI\_W3TC\_DEBUGGING]) { |
| [11532](#L11532) | ai\_w3tc\_log\_run ('  HTML: ' . strlen ($html\_code) . ' bytes'); |
| [11533](#L11533) | } |
| [11534](#L11534) |  |
| [11535](#L11535) | echo $html\_code; |
| [11536](#L11536) | } |
| [11537](#L11537) | if ($index < count ($html\_codes) - 1) { |
| [11538](#L11538) | if ($ai\_wp\_data [AI\_W3TC\_DEBUGGING]) { |
| [11539](#L11539) | ai\_w3tc\_log\_run ($w3tc\_info []= '  PHP:  ' . strlen ($php\_codes [1][$index]) . ' bytes'); |
| [11540](#L11540) | } |
| [11541](#L11541) |  |
| [11542](#L11542) | eval ($php\_codes [1][$index]); |
| [11543](#L11543) | } |
| [11544](#L11544) | } |
| [11545](#L11545) |  |
| [11546](#L11546) | $html = ob\_get\_clean(); |
| [11547](#L11547) |  |
| [11548](#L11548) | if ($ai\_wp\_data [AI\_W3TC\_DEBUGGING]) { |
| [11549](#L11549) | ai\_w3tc\_log\_run ('  EXECUTE END' . ' ['.(isset ($ai\_fallback) ? $ai\_fallback : '')  . ',' . (isset ($ai\_index) ? $ai\_index : '').']'); |
| [11550](#L11550) | } |
| [11551](#L11551) |  |
| [11552](#L11552) | return ($html); |
| [11553](#L11553) | } |
| [11554](#L11554) |  |
| [11555](#L11555) | function ai\_get\_post\_id () { |
| [11556](#L11556) | $queried\_object = get\_queried\_object (); |
| [11557](#L11557) | $post\_id = get\_the\_ID (); |
| [11558](#L11558) |  |
| [11559](#L11559) | if (defined ('AI\_USE\_GET\_QUERIED\_OBJECT') && AI\_USE\_GET\_QUERIED\_OBJECT && $queried\_object && isset ($queried\_object->ID)) { |
| [11560](#L11560) | return $queried\_object->ID; |
| [11561](#L11561) | } |
| [11562](#L11562) |  |
| [11563](#L11563) | if ($queried\_object && $post\_id) { |
| [11564](#L11564) | return $post\_id; |
| [11565](#L11565) | } |
| [11566](#L11566) |  |
| [11567](#L11567) | if ($queried\_object && isset ($queried\_object->ID)) { |
| [11568](#L11568) | return $queried\_object->ID; |
| [11569](#L11569) | } |
| [11570](#L11570) |  |
| [11571](#L11571) | return $post\_id; |
| [11572](#L11572) | } |
| [11573](#L11573) |  |
| [11574](#L11574) | function ai\_get\_post\_meta () { |
| [11575](#L11575) | $meta\_value = get\_post\_meta (ai\_get\_post\_id (), '\_adinserter\_block\_exceptions', true); |
| [11576](#L11576) | return $meta\_value; |
| [11577](#L11577) | } |
| [11578](#L11578) |  |
| [11579](#L11579) | function ai\_post\_is\_in\_child\_categories ($category) { |
| [11580](#L11580) | $category\_to\_check = get\_term\_by ('slug', $category, 'category'); |
| [11581](#L11581) | if ($category\_to\_check) { |
| [11582](#L11582) | $post\_id = ai\_get\_post\_id (); |
| [11583](#L11583) | $children = get\_term\_children ($category\_to\_check->term\_id, 'category'); |
| [11584](#L11584) | if ($children && in\_category ($children, $post\_id)) return true; |
| [11585](#L11585) | } |
| [11586](#L11586) | return false; |
| [11587](#L11587) | } |
| [11588](#L11588) |  |
| [11589](#L11589) | function ai\_post\_is\_in\_child\_taxonomies ($taxonomy, $term) { |
| [11590](#L11590) | $taxonomy\_to\_check = get\_term\_by ('slug', $term, $taxonomy); |
| [11591](#L11591) | if ($taxonomy\_to\_check) { |
| [11592](#L11592) | $post\_id = ai\_get\_post\_id (); |
| [11593](#L11593) | $children = get\_term\_children ($taxonomy\_to\_check->term\_id, $taxonomy); |
| [11594](#L11594) | if ($children && has\_term ($children, $taxonomy, $post\_id)) return true; |
| [11595](#L11595) | } |
| [11596](#L11596) | return false; |
| [11597](#L11597) | } |
| [11598](#L11598) |  |
| [11599](#L11599) | function ai\_get\_permalink ($id) { |
| [11600](#L11600) | if (defined ('AI\_CONNECTED\_WEBSITE')) { |
| [11601](#L11601) | $connected\_website = get\_transient (AI\_CONNECTED\_WEBSITE); |
| [11602](#L11602) |  |
| [11603](#L11603) | if ($connected\_website !== false) return ''; |
| [11604](#L11604) | } |
| [11605](#L11605) |  |
| [11606](#L11606) | return (get\_permalink ($id)); |
| [11607](#L11607) | } |
| [11608](#L11608) |  |
| [11609](#L11609) | function ai\_get\_edit\_post\_link ($id) { |
| [11610](#L11610) | if (defined ('AI\_CONNECTED\_WEBSITE')) { |
| [11611](#L11611) | $connected\_website = get\_transient (AI\_CONNECTED\_WEBSITE); |
| [11612](#L11612) |  |
| [11613](#L11613) | if ($connected\_website !== false) return ''; |
| [11614](#L11614) | } |
| [11615](#L11615) |  |
| [11616](#L11616) | return (get\_edit\_post\_link ($id)); |
| [11617](#L11617) | } |
| [11618](#L11618) |  |
| [11619](#L11619) |  |
| [11620](#L11620) | function ai\_setcookie ($name, $value, $expire, $path, $samesite = 'Lax') { |
| [11621](#L11621) | if (PHP\_VERSION\_ID < 70300) { |
| [11622](#L11622) | setcookie ($name, $value, $expire, $path . '; samesite=' . $samesite); |
| [11623](#L11623) | return; |
| [11624](#L11624) | } |
| [11625](#L11625) |  |
| [11626](#L11626) | setcookie ($name, $value, [ |
| [11627](#L11627) | 'expires' => $expire, |
| [11628](#L11628) | 'path' => $path, |
| [11629](#L11629) | 'samesite' => $samesite, |
| [11630](#L11630) | ]); |
| [11631](#L11631) | } |
| [11632](#L11632) |  |
| [11633](#L11633) |  |
| [11634](#L11634) | function ai\_process\_viewport\_separators ($code, $shortcode\_data) { |
| [11635](#L11635) | global $ai\_wp\_data; |
| [11636](#L11636) |  |
| [11637](#L11637) | $viewport\_shortcode\_data = $shortcode\_data ['viewport']; |
| [11638](#L11638) |  |
| [11639](#L11639) | preg\_match\_all ('/\|viewport([0-9]+?)\|/', $code, $matches); |
| [11640](#L11640) | if (count ($matches [1]) != 0) { |
| [11641](#L11641) | $viewport\_parameters = array (); |
| [11642](#L11642) | foreach ($matches [1] as $match) { |
| [11643](#L11643) | $viewport\_parameters []= $viewport\_shortcode\_data [$match]; |
| [11644](#L11644) | } |
| [11645](#L11645) | if ($ai\_wp\_data [AI\_WP\_AMP\_PAGE]) { |
| [11646](#L11646) | $code = preg\_replace ('/\|viewport([0-9]+?)\|/', '', $code); |
| [11647](#L11647) | } else $code = preg\_replace ('/\|viewport([0-9]+?)\|/', AD\_VIEWPORT\_SEPARATOR, $code); |
| [11648](#L11648) | } |
| [11649](#L11649) |  |
| [11650](#L11650) | $processed\_code = $code; |
| [11651](#L11651) |  |
| [11652](#L11652) | if (strpos ($code, AD\_VIEWPORT\_SEPARATOR) !== false) { |
| [11653](#L11653) |  |
| [11654](#L11654) | $processed\_code = ''; |
| [11655](#L11655) |  |
| [11656](#L11656) | $codes = explode (AD\_VIEWPORT\_SEPARATOR, $code); |
| [11657](#L11657) |  |
| [11658](#L11658) | if (trim ($codes [0]) == '') { |
| [11659](#L11659) | unset ($codes [0]); |
| [11660](#L11660) | $codes = array\_values ($codes); |
| [11661](#L11661) | } else array\_unshift ($viewport\_parameters, array ('viewport' => '', 'code' => '')); |
| [11662](#L11662) |  |
| [11663](#L11663) | foreach ($codes as $viewport\_code\_index => $viewport\_code) { |
| [11664](#L11664) |  |
| [11665](#L11665) | $viewport\_code = ai\_process\_fallback\_separator ($viewport\_code, $shortcode\_data); |
| [11666](#L11666) |  |
| [11667](#L11667) | $separator\_viewports = explode (',', strtolower ($viewport\_parameters [$viewport\_code\_index]['viewport'])); |
| [11668](#L11668) | foreach ($separator\_viewports as $index => $separator\_viewport) { |
| [11669](#L11669) | $separator\_viewports [$index] = trim ($separator\_viewport); |
| [11670](#L11670) | } |
| [11671](#L11671) |  |
| [11672](#L11672) | $viewport\_classes = ''; |
| [11673](#L11673) | for ($viewport = 1; $viewport <= 6; $viewport ++) { |
| [11674](#L11674) | $viewport\_name  = strtolower (get\_viewport\_name ($viewport)); |
| [11675](#L11675) |  |
| [11676](#L11676) | if ($viewport\_name != '') { |
| [11677](#L11677) | $viewport\_found = in\_array ($viewport\_name, $separator\_viewports); |
| [11678](#L11678) | if ($viewport\_found) { |
| [11679](#L11679) | $viewport\_classes .= " ai-viewport-" . $viewport; |
| [11680](#L11680) | } |
| [11681](#L11681) | } |
| [11682](#L11682) | } |
| [11683](#L11683) |  |
| [11684](#L11684) | if ($viewport\_classes == '') { |
| [11685](#L11685) | if ($viewport\_parameters [$viewport\_code\_index]['viewport'] != '') { |
| [11686](#L11686) | // Invalid viewport - Code will never be inserted |
| [11687](#L11687) | continue; |
| [11688](#L11688) | } |
| [11689](#L11689) | } |
| [11690](#L11690) | $viewport\_classes = trim ($viewport\_classes); |
| [11691](#L11691) |  |
| [11692](#L11692) | if ($viewport\_classes != '') { |
| [11693](#L11693) | $viewport\_class = " class='" . $viewport\_classes . "'"; |
| [11694](#L11694) | } else $viewport\_class = ''; |
| [11695](#L11695) |  |
| [11696](#L11696) | $insert\_code = get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT; |
| [11697](#L11697) | switch (strtolower ($viewport\_parameters [$viewport\_code\_index]['code'])) { |
| [11698](#L11698) | case 'insert': |
| [11699](#L11699) | $insert\_code = true; |
| [11700](#L11700) | break; |
| [11701](#L11701) | case 'show': |
| [11702](#L11702) | $insert\_code = false; |
| [11703](#L11703) | break; |
| [11704](#L11704) | } |
| [11705](#L11705) |  |
| [11706](#L11706) | if ($insert\_code) { |
| [11707](#L11707) | $code\_id = 'ai-viewport-code-' . rand (1000, 9999) . rand (1000, 9999); |
| [11708](#L11708) |  |
| [11709](#L11709) | if ($viewport\_classes != '') { |
| [11710](#L11710) | $viewport\_classes = 'ai-viewports ' . $viewport\_classes . ' '; |
| [11711](#L11711) | } |
| [11712](#L11712) |  |
| [11713](#L11713) | $ai\_code = base64\_encode (ai\_strip\_js\_markers ($viewport\_code)); |
| [11714](#L11714) |  |
| [11715](#L11715) | $processed\_code .= "<div class='{$viewport\_classes} {$code\_id}' data-insertion-position='after' data-selector='.{$code\_id}' data-insertion-no-dbg data-code='$ai\_code'></div>\n"; |
| [11716](#L11716) | if (!get\_disable\_js\_code ()) { |
| [11717](#L11717) | //          $js\_code = "ai\_insert\_code (document.getElementsByClassName ('$code\_id') [0]);"; |
| [11718](#L11718) | $js\_code = "ai\_insert\_code\_by\_class ('$code\_id');"; |
| [11719](#L11719) |  |
| [11720](#L11720) | $processed\_code .= ai\_strip\_js\_markers (ai\_js\_dom\_ready ($js\_code)); |
| [11721](#L11721) | } |
| [11722](#L11722) | } else { |
| [11723](#L11723) | if ($viewport\_class != '') { |
| [11724](#L11724) | $processed\_code .= "<div{$viewport\_class}>\n" . $viewport\_code . "\n</div>\n"; |
| [11725](#L11725) | } else $processed\_code .= $viewport\_code; |
| [11726](#L11726) | } |
| [11727](#L11727) | } |
| [11728](#L11728) | } |
| [11729](#L11729) |  |
| [11730](#L11730) | return $processed\_code; |
| [11731](#L11731) | } |
| [11732](#L11732) |  |
| [11733](#L11733) |  |
| [11734](#L11734) | function ai\_process\_fallback\_separator ($code, $shortcode\_data) { |
| [11735](#L11735) | global $ai\_wp\_data; |
| [11736](#L11736) |  |
| [11737](#L11737) | $fallback\_shortcode\_data = $shortcode\_data ['fallback']; |
| [11738](#L11738) |  |
| [11739](#L11739) | $processed\_code = $code; |
| [11740](#L11740) |  |
| [11741](#L11741) | if (strpos ($code, AD\_FALLBACK\_SEPARATOR) !== false) { |
| [11742](#L11742) |  |
| [11743](#L11743) | $codes = explode (AD\_FALLBACK\_SEPARATOR, $code); |
| [11744](#L11744) |  |
| [11745](#L11745) | $processed\_code = $codes [0]; |
| [11746](#L11746) |  |
| [11747](#L11747) | // AdSense unfilled |
| [11748](#L11748) | if (strtolower ($fallback\_shortcode\_data [0]['fallback']) == 'adsense') { |
| [11749](#L11749) |  |
| [11750](#L11750) | $insert\_code = get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_CLIENT\_SIDE\_INSERT; |
| [11751](#L11751) | switch (strtolower ($fallback\_shortcode\_data [0]['code'])) { |
| [11752](#L11752) | case 'insert': |
| [11753](#L11753) | $insert\_code = true; |
| [11754](#L11754) | break; |
| [11755](#L11755) | case 'show': |
| [11756](#L11756) | $insert\_code = false; |
| [11757](#L11757) | break; |
| [11758](#L11758) | } |
| [11759](#L11759) |  |
| [11760](#L11760) | $empty\_fallback\_code\_class = trim ($codes [1]) == '' ? " ai-empty-code" : ''; |
| [11761](#L11761) |  |
| [11762](#L11762) | $processed\_code = "<div class='ai-fallback-adsense{$empty\_fallback\_code\_class}'>" . $processed\_code . "</div>\n"; |
| [11763](#L11763) |  |
| [11764](#L11764) | if ($insert\_code) { |
| [11765](#L11765) | $ai\_code = base64\_encode (ai\_strip\_js\_markers (trim ($codes [1]))); |
| [11766](#L11766) |  |
| [11767](#L11767) | $processed\_code .= "<div data-code='$ai\_code'></div>\n"; |
| [11768](#L11768) | } else { |
| [11769](#L11769) | $processed\_code .= "<div style='display: none;'>\n" . trim ($codes [1]) . "\n</div>\n"; |
| [11770](#L11770) | } |
| [11771](#L11771) | } |
| [11772](#L11772) | } |
| [11773](#L11773) |  |
| [11774](#L11774) | return $processed\_code; |
| [11775](#L11775) | } |
| [11776](#L11776) |  |
| [11777](#L11777) |  |
| [11778](#L11778) | function replace\_ai\_tags ($content, $general\_tag = '') { |
| [11779](#L11779) | global $ai\_wp\_data; |
| [11780](#L11780) |  |
| [11781](#L11781) | if (preg\_match\_all ('#\[ADINSERTER (.+)\]#i', $content, $matches)) { |
| [11782](#L11782) | if (count ($matches [0])) { |
| [11783](#L11783) | foreach ($matches [0] as $match) { |
| [11784](#L11784) | $content = str\_replace ($match, do\_shortcode ($match), $content); |
| [11785](#L11785) | } |
| [11786](#L11786) | } |
| [11787](#L11787) | } |
| [11788](#L11788) |  |
| [11789](#L11789) | if (strpos ($content, '{') === false) return $content; |
| [11790](#L11790) |  |
| [11791](#L11791) | if (isset ($ai\_wp\_data [AI\_SHORTCODES]['atts']) && is\_array ($ai\_wp\_data [AI\_SHORTCODES]['atts']) && !empty ($ai\_wp\_data [AI\_SHORTCODES]['atts'])) { |
| [11792](#L11792) | foreach ($ai\_wp\_data [AI\_SHORTCODES]['atts'] as $name => $value) { |
| [11793](#L11793) | $content = preg\_replace ("/\{\#$name(\:[^{}]\*?)?\#\}/i", $value, $content); |
| [11794](#L11794) | } |
| [11795](#L11795) | } |
| [11796](#L11796) |  |
| [11797](#L11797) | if (!isset ($ai\_wp\_data [AI\_TAGS])) { |
| [11798](#L11798) | $general\_tag = str\_replace ("&amp;", " and ", $general\_tag); |
| [11799](#L11799) | $title = $general\_tag; |
| [11800](#L11800) | $short\_title = $general\_tag; |
| [11801](#L11801) | $category = $general\_tag; |
| [11802](#L11802) | $categories = $general\_tag; |
| [11803](#L11803) | $categories\_array = array (); |
| [11804](#L11804) | $category\_slugs\_array = array (); |
| [11805](#L11805) | $categories\_spaces = $general\_tag; |
| [11806](#L11806) | $short\_category = $general\_tag; |
| [11807](#L11807) | $tag = $general\_tag; |
| [11808](#L11808) | $tags = $general\_tag; |
| [11809](#L11809) | $tags\_array = array (); |
| [11810](#L11810) | $tag\_slugs\_array = array (); |
| [11811](#L11811) | $tags\_spaces = $general\_tag; |
| [11812](#L11812) | $categories\_single\_quotes = $general\_tag; |
| [11813](#L11813) | $categories\_double\_quotes = $general\_tag; |
| [11814](#L11814) | $smart\_tag = $general\_tag; |
| [11815](#L11815) | if ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_CATEGORY) { |
| [11816](#L11816) | $wp\_categories = get\_queried\_object (); |
| [11817](#L11817) | if (!empty ($wp\_categories) && $wp\_categories instanceof WP\_Term) { |
| [11818](#L11818) | $first\_category = $wp\_categories; |
| [11819](#L11819) | $category = str\_replace ("&amp;", "and", $first\_category->name); |
| [11820](#L11820) | if ($category == \_x('Uncategorized', 'category name', 'ad-inserter')) $category = $general\_tag; |
| [11821](#L11821) | } else { |
| [11822](#L11822) | $category = $general\_tag; |
| [11823](#L11823) | } |
| [11824](#L11824) | if (strpos ($category, ",") !== false) { |
| [11825](#L11825) | $short\_category = trim (substr ($category, 0, strpos ($category, ","))); |
| [11826](#L11826) | } else $short\_category = $category; |
| [11827](#L11827) | if (strpos ($short\_category, "and") !== false) { |
| [11828](#L11828) | $short\_category = trim (substr ($short\_category, 0, strpos ($short\_category, "and"))); |
| [11829](#L11829) | } |
| [11830](#L11830) |  |
| [11831](#L11831) | $title = $category; |
| [11832](#L11832) | $title = str\_replace ("&amp;", "and", $title); |
| [11833](#L11833) | $short\_title = implode (" ", array\_slice (explode (" ", $title), 0, 3)); |
| [11834](#L11834) | $tag = $short\_title; |
| [11835](#L11835) | $smart\_tag = $short\_title; |
| [11836](#L11836) |  |
| [11837](#L11837) | //        $wp\_categories = get\_the\_category(); |
| [11838](#L11838) | //        if (!empty ($wp\_categories)) { |
| [11839](#L11839) | //          foreach ($wp\_categories as $single\_category) { |
| [11840](#L11840) | //            $categories\_array [] = str\_replace (array ("&amp;", "#"), array ("and", ""), isset ($single\_category->name) ? $single\_category->name : ''); |
| [11841](#L11841) | //            $category\_slugs\_array [] = $single\_category->slug; |
| [11842](#L11842) | //          } |
| [11843](#L11843) | $wp\_categories = get\_queried\_object(); |
| [11844](#L11844) | if ($wp\_categories instanceof WP\_Term) { |
| [11845](#L11845) | $categories\_array [] = str\_replace (array ("&amp;", "#"), array ("and", ""), isset ($wp\_categories->name) ? $wp\_categories->name : ''); |
| [11846](#L11846) | $category\_slugs\_array [] = $wp\_categories->slug; |
| [11847](#L11847) |  |
| [11848](#L11848) | $categories               = implode (',',     $categories\_array); |
| [11849](#L11849) | $categories\_spaces        = implode (' ',     $categories\_array); |
| [11850](#L11850) |  |
| [11851](#L11851) | $categories\_single\_quotes = implode ("','", $categories\_array); |
| [11852](#L11852) | if ($categories\_single\_quotes != '') $categories\_single\_quotes = "'".$categories\_single\_quotes."'"; |
| [11853](#L11853) |  |
| [11854](#L11854) | $categories\_double\_quotes = implode ('","', $categories\_array); |
| [11855](#L11855) | if ($categories\_double\_quotes != '') $categories\_double\_quotes = '"'.$categories\_double\_quotes.'"'; |
| [11856](#L11856) | } |
| [11857](#L11857) | } elseif (is\_tag ()) { |
| [11858](#L11858) | $title = single\_tag\_title('', false); |
| [11859](#L11859) | $title = str\_replace (array ("&amp;", "#", '"', "'"), array ("and", "", '', ''), $title); |
| [11860](#L11860) | $short\_title = implode (" ", array\_slice (explode (" ", $title), 0, 3)); |
| [11861](#L11861) | $category = $short\_title; |
| [11862](#L11862) | if (strpos ($category, ",") !== false) { |
| [11863](#L11863) | $short\_category = trim (substr ($category, 0, strpos ($category, ","))); |
| [11864](#L11864) | } else $short\_category = $category; |
| [11865](#L11865) | if (strpos ($short\_category, "and") !== false) { |
| [11866](#L11866) | $short\_category = trim (substr ($short\_category, 0, strpos ($short\_category, "and"))); |
| [11867](#L11867) | } |
| [11868](#L11868) | $tag = $short\_title; |
| [11869](#L11869) | $smart\_tag = $short\_title; |
| [11870](#L11870) |  |
| [11871](#L11871) | $wp\_tags = get\_the\_tags (); |
| [11872](#L11872) | if (!empty ($wp\_tags)) { |
| [11873](#L11873) | foreach ($wp\_tags as $single\_tag) { |
| [11874](#L11874) | $tags\_array [] = str\_replace (array ("&amp;", "#"), array ("and", ""), isset ($single\_tag->name) ? $single\_tag->name : ''); |
| [11875](#L11875) | $tag\_slugs\_array [] = $single\_tag->slug; |
| [11876](#L11876) | } |
| [11877](#L11877) |  |
| [11878](#L11878) | $tags = implode (',', $tags\_array); |
| [11879](#L11879) | $tags\_spaces = implode (' ', $tags\_array); |
| [11880](#L11880) | } |
| [11881](#L11881) | } elseif ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_SEARCH) { |
| [11882](#L11882) | $title = get\_search\_query(); |
| [11883](#L11883) | $title = str\_replace ("&amp;", "and", $title); |
| [11884](#L11884) | $short\_title = implode (" ", array\_slice (explode (" ", $title), 0, 3)); |
| [11885](#L11885) | $category = $short\_title; |
| [11886](#L11886) | if (strpos ($category, ",") !== false) { |
| [11887](#L11887) | $short\_category = trim (substr ($category, 0, strpos ($category, ","))); |
| [11888](#L11888) | } else $short\_category = $category; |
| [11889](#L11889) | if (strpos ($short\_category, "and") !== false) { |
| [11890](#L11890) | $short\_category = trim (substr ($short\_category, 0, strpos ($short\_category, "and"))); |
| [11891](#L11891) | } |
| [11892](#L11892) | $tag = $short\_title; |
| [11893](#L11893) | $smart\_tag = $short\_title; |
| [11894](#L11894) | } elseif ($ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_STATIC || $ai\_wp\_data [AI\_WP\_PAGE\_TYPE] == AI\_PT\_POST) { |
| [11895](#L11895) | $title = get\_the\_title(); |
| [11896](#L11896) | $title = str\_replace (array ("&amp;", '"', "'"), array ("and", '', ''), $title); |
| [11897](#L11897) |  |
| [11898](#L11898) | $short\_title = implode (" ", array\_slice (explode (" ", $title), 0, 3)); |
| [11899](#L11899) |  |
| [11900](#L11900) | $wp\_categories = get\_the\_category(); |
| [11901](#L11901) | if (!empty ($wp\_categories)) { |
| [11902](#L11902) | foreach ($wp\_categories as $single\_category) { |
| [11903](#L11903) | if (isset ($single\_category->slug)) { |
| [11904](#L11904) | $categories\_array [] = str\_replace (array ("&amp;", "#"), array ("and", ""), isset ($single\_category->name) ? $single\_category->name : ''); |
| [11905](#L11905) | $category\_slugs\_array [] = $single\_category->slug; |
| [11906](#L11906) | } |
| [11907](#L11907) | } |
| [11908](#L11908) |  |
| [11909](#L11909) | $categories               = implode (',',   $categories\_array); |
| [11910](#L11910) | $categories\_spaces        = implode (' ',   $categories\_array); |
| [11911](#L11911) |  |
| [11912](#L11912) | $categories\_single\_quotes = implode ("','", $categories\_array); |
| [11913](#L11913) | if ($categories\_single\_quotes != '') $categories\_single\_quotes = "'".$categories\_single\_quotes."'"; |
| [11914](#L11914) |  |
| [11915](#L11915) | $categories\_double\_quotes = implode ('","', $categories\_array); |
| [11916](#L11916) | if ($categories\_double\_quotes != '') $categories\_double\_quotes = '"'.$categories\_double\_quotes.'"'; |
| [11917](#L11917) |  |
| [11918](#L11918) | $first\_category = $categories\_array [0]; |
| [11919](#L11919) | $category = $first\_category; |
| [11920](#L11920) |  |
| [11921](#L11921) | if ($category == \_x('Uncategorized', 'category name', 'ad-inserter')) $category = $general\_tag; |
| [11922](#L11922) | } else { |
| [11923](#L11923) | $category = $short\_title; |
| [11924](#L11924) | } |
| [11925](#L11925) | if (strpos ($category, ",") !== false) { |
| [11926](#L11926) | $short\_category = trim (substr ($category, 0, strpos ($category, ","))); |
| [11927](#L11927) | } else $short\_category = $category; |
| [11928](#L11928) | if (strpos ($short\_category, "and") !== false) { |
| [11929](#L11929) | $short\_category = trim (substr ($short\_category, 0, strpos ($short\_category, "and"))); |
| [11930](#L11930) | } |
| [11931](#L11931) |  |
| [11932](#L11932) | $wp\_tags = get\_the\_tags(); |
| [11933](#L11933) | if (!empty ($wp\_tags)) { |
| [11934](#L11934) | foreach ($wp\_tags as $single\_tag) { |
| [11935](#L11935) | $tags\_array [] = str\_replace (array ("&amp;", "#"), array ("and", ""), isset ($single\_tag->name) ? $single\_tag->name : ''); |
| [11936](#L11936) | $tag\_slugs\_array [] = $single\_tag->slug; |
| [11937](#L11937) | } |
| [11938](#L11938) |  |
| [11939](#L11939) | $tags = implode (',', $tags\_array); |
| [11940](#L11940) | $tags\_spaces = implode (' ', $tags\_array); |
| [11941](#L11941) |  |
| [11942](#L11942) | $first\_tag = $tags\_array [0]; |
| [11943](#L11943) | $tag = $first\_tag; |
| [11944](#L11944) |  |
| [11945](#L11945) | $tag\_array = array (); |
| [11946](#L11946) | foreach ($wp\_tags as $tag\_data) { |
| [11947](#L11947) | if (isset ($tag\_data->name)) |
| [11948](#L11948) | $tag\_array [] = explode (" ", $tag\_data->name); |
| [11949](#L11949) | } |
| [11950](#L11950) |  |
| [11951](#L11951) | $selected\_tag = ''; |
| [11952](#L11952) |  |
| [11953](#L11953) | if (count ($tag\_array [0]) == 2) $selected\_tag = $tag\_array [0]; |
| [11954](#L11954) | elseif (count ($tag\_array) > 1 && count ($tag\_array [1]) == 2) $selected\_tag = $tag\_array [1]; |
| [11955](#L11955) | elseif (count ($tag\_array) > 2 && count ($tag\_array [2]) == 2) $selected\_tag = $tag\_array [2]; |
| [11956](#L11956) | elseif (count ($tag\_array) > 3 && count ($tag\_array [3]) == 2) $selected\_tag = $tag\_array [3]; |
| [11957](#L11957) | elseif (count ($tag\_array) > 4 && count ($tag\_array [4]) == 2) $selected\_tag = $tag\_array [4]; |
| [11958](#L11958) |  |
| [11959](#L11959) |  |
| [11960](#L11960) | if ($selected\_tag == '' && count ($tag\_array) >= 2 && count ($tag\_array [0]) == 1 && count ($tag\_array [1]) == 1) { |
| [11961](#L11961) |  |
| [11962](#L11962) | if (isset ($tag\_array [0][0]) && isset ($tag\_array [1][0])) { |
| [11963](#L11963) | if (strpos ($tag\_array [0][0], $tag\_array [1][0]) !== false) $tag\_array = array\_slice ($tag\_array, 1, count ($tag\_array) - 1); |
| [11964](#L11964) | } |
| [11965](#L11965) |  |
| [11966](#L11966) | if (isset ($tag\_array [0][0]) && isset ($tag\_array [1][0])) { |
| [11967](#L11967) | if (strpos ($tag\_array [1][0], $tag\_array [0][0]) !== false) $tag\_array = array\_slice ($tag\_array, 1, count ($tag\_array) - 1); |
| [11968](#L11968) | } |
| [11969](#L11969) |  |
| [11970](#L11970) | if (isset ($tag\_array [0][0]) && isset ($tag\_array [1][0])) { |
| [11971](#L11971) | if (count ($tag\_array) >= 2 && count ($tag\_array [0]) == 1 && count ($tag\_array [1]) == 1) { |
| [11972](#L11972) | $selected\_tag = array ($tag\_array [0][0], $tag\_array [1][0]); |
| [11973](#L11973) | } |
| [11974](#L11974) | } |
| [11975](#L11975) | } |
| [11976](#L11976) |  |
| [11977](#L11977) | if ($selected\_tag == '') { |
| [11978](#L11978) | $first\_tag = $tags\_array [0]; |
| [11979](#L11979) | $smart\_tag = implode (" ", array\_slice (explode (" ", $first\_tag), 0, 3)); |
| [11980](#L11980) | } else $smart\_tag = implode (" ", $selected\_tag); |
| [11981](#L11981) |  |
| [11982](#L11982) | $smart\_tag = str\_replace (array ("&amp;", "#"), array ("and", ""), $smart\_tag); |
| [11983](#L11983) |  |
| [11984](#L11984) | } else { |
| [11985](#L11985) | $tag = $category; |
| [11986](#L11986) | $smart\_tag = $category; |
| [11987](#L11987) | } |
| [11988](#L11988) | } |
| [11989](#L11989) |  |
| [11990](#L11990) | $title = str\_replace (array ("'", '"'), array ("&#8217;", "&#8221;"), $title); |
| [11991](#L11991) | $title = html\_entity\_decode ($title, ENT\_QUOTES, "utf-8"); |
| [11992](#L11992) |  |
| [11993](#L11993) | $short\_title = str\_replace (array ("'", '"'), array ("&#8217;", "&#8221;"), $short\_title); |
| [11994](#L11994) | $short\_title = html\_entity\_decode ($short\_title, ENT\_QUOTES, "utf-8"); |
| [11995](#L11995) |  |
| [11996](#L11996) | $search\_query = ""; |
| [11997](#L11997) | if (isset ($\_SERVER['HTTP\_REFERER'])) { |
| [11998](#L11998) | $referrer = $\_SERVER['HTTP\_REFERER']; |
| [11999](#L11999) | } else $referrer = ''; |
| [12000](#L12000) |  |
| [12001](#L12001) | if (preg\_match ("/[\.\/](google|yahoo|bing|ask)\.[a-z\.]{2,5}[\/]/i", $referrer, $search\_engine)){ |
| [12002](#L12002) | $referrer\_query = parse\_url ($referrer); |
| [12003](#L12003) | $referrer\_query = isset ($referrer\_query ["query"]) ? $referrer\_query ["query"] : ""; |
| [12004](#L12004) | parse\_str ($referrer\_query, $value); |
| [12005](#L12005) | $search\_query = isset ($value ["q"]) ? $value ["q"] : ""; |
| [12006](#L12006) | if ($search\_query == "") { |
| [12007](#L12007) | $search\_query = isset ($value ["p"]) ? $value ["p"] : ""; |
| [12008](#L12008) | } |
| [12009](#L12009) | } |
| [12010](#L12010) | if ($search\_query == "") $search\_query = $smart\_tag; |
| [12011](#L12011) |  |
| [12012](#L12012) | //    $author = get\_the\_author\_meta ('display\_name'); |
| [12013](#L12013) | //    $author\_name = get\_the\_author\_meta ('first\_name') . " " . get\_the\_author\_meta ('last\_name'); |
| [12014](#L12014) | //    if ($author\_name == ' ') $author\_name = $author; |
| [12015](#L12015) |  |
| [12016](#L12016) | $host = isset ($\_SERVER ['HTTP\_HOST']) ? $\_SERVER ['HTTP\_HOST'] : ''; |
| [12017](#L12017) | if ($host == '' && isset ($\_SERVER ['SERVER\_NAME'])) { |
| [12018](#L12018) | $host = $\_SERVER ['SERVER\_NAME']; |
| [12019](#L12019) | } |
| [12020](#L12020) | $url = remove\_debug\_parameters\_from\_url ((isset ($\_SERVER ['HTTPS']) && $\_SERVER ['HTTPS'] === 'on' ? "https" : "http") . '://'. $host . $\_SERVER ['REQUEST\_URI']); |
| [12021](#L12021) |  |
| [12022](#L12022) | $post\_id = ai\_get\_post\_id (); |
| [12023](#L12023) |  |
| [12024](#L12024) | $ai\_wp\_data [AI\_TAGS]['TITLE']                = $title; |
| [12025](#L12025) | $ai\_wp\_data [AI\_TAGS]['SHORT\_TITLE']          = $short\_title; |
| [12026](#L12026) | $ai\_wp\_data [AI\_TAGS]['CATEGORY']             = $category; |
| [12027](#L12027) | $ai\_wp\_data [AI\_TAGS]['CATEGORIES']           = $categories; |
| [12028](#L12028) | $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_ARRAY']     = $categories\_array; |
| [12029](#L12029) | $ai\_wp\_data [AI\_TAGS]['CATEGORY\_SLUGS\_ARRAY'] = $category\_slugs\_array; |
| [12030](#L12030) | $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_SPACES']        = $categories\_spaces; |
| [12031](#L12031) | $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_SINGLE\_QUOTES'] = $categories\_single\_quotes; |
| [12032](#L12032) | $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_DOUBLE\_QUOTES'] = $categories\_double\_quotes; |
| [12033](#L12033) | $ai\_wp\_data [AI\_TAGS]['SHORT\_CATEGORY']       = $short\_category; |
| [12034](#L12034) | $ai\_wp\_data [AI\_TAGS]['TAG']                  = $tag; |
| [12035](#L12035) | $ai\_wp\_data [AI\_TAGS]['TAGS']                 = $tags; |
| [12036](#L12036) | $ai\_wp\_data [AI\_TAGS]['TAGS\_ARRAY']           = $tags\_array; |
| [12037](#L12037) | $ai\_wp\_data [AI\_TAGS]['TAG\_SLUGS\_ARRAY']      = $tag\_slugs\_array; |
| [12038](#L12038) | $ai\_wp\_data [AI\_TAGS]['TAGS\_SPACES']          = $tags\_spaces; |
| [12039](#L12039) | $ai\_wp\_data [AI\_TAGS]['SMART\_TAG']            = $smart\_tag; |
| [12040](#L12040) | $ai\_wp\_data [AI\_TAGS]['SEARCH\_QUERY']         = $search\_query; |
| [12041](#L12041) | //    $ai\_wp\_data [AI\_TAGS]['AUTHOR']               = $author; |
| [12042](#L12042) | //    $ai\_wp\_data [AI\_TAGS]['AUTHOR\_NAME']          = $author\_name; |
| [12043](#L12043) | $ai\_wp\_data [AI\_TAGS]['POST\_ID']              = $post\_id; |
| [12044](#L12044) | $ai\_wp\_data [AI\_TAGS]['URL']                  = $url; |
| [12045](#L12045) | } |
| [12046](#L12046) |  |
| [12047](#L12047) | // Author should not be cached |
| [12048](#L12048) | $author       = get\_the\_author\_meta ('display\_name'); |
| [12049](#L12049) | $author\_login = get\_the\_author\_meta ('user\_login'); |
| [12050](#L12050) | $author\_name  = get\_the\_author\_meta ('first\_name') . " " . get\_the\_author\_meta ('last\_name'); |
| [12051](#L12051) | if ($author\_name == ' ') $author\_name = $author; |
| [12052](#L12052) |  |
| [12053](#L12053) | $ai\_wp\_data [AI\_TAGS]['AUTHOR']               = $author; |
| [12054](#L12054) | $ai\_wp\_data [AI\_TAGS]['AUTHOR\_NAME']          = $author\_name; |
| [12055](#L12055) | $ai\_wp\_data [AI\_TAGS]['AUTHOR\_LOGIN']         = $author\_login; |
| [12056](#L12056) |  |
| [12057](#L12057) | $ad\_data = preg\_replace ("/{title}/i",              $ai\_wp\_data [AI\_TAGS]['TITLE'],             $content); |
| [12058](#L12058) | $ad\_data = preg\_replace ("/{short-title}/i",        $ai\_wp\_data [AI\_TAGS]['SHORT\_TITLE'],       $ad\_data); |
| [12059](#L12059) | $ad\_data = preg\_replace ("/{category}/i",           $ai\_wp\_data [AI\_TAGS]['CATEGORY'],          $ad\_data); |
| [12060](#L12060) | $ad\_data = preg\_replace ("/{categories}/i",         $ai\_wp\_data [AI\_TAGS]['CATEGORIES'],        $ad\_data); |
| [12061](#L12061) | $ad\_data = preg\_replace ("/{categories-spaces}/i",          $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_SPACES'], $ad\_data); |
| [12062](#L12062) | $ad\_data = preg\_replace ("/{categories-single-quotes}/i",   $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_SINGLE\_QUOTES'], $ad\_data); |
| [12063](#L12063) | $ad\_data = preg\_replace ("/{categories-double-quotes}/i",   $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_DOUBLE\_QUOTES'], $ad\_data); |
| [12064](#L12064) | $ad\_data = preg\_replace ("/{short-category}/i",     $ai\_wp\_data [AI\_TAGS]['SHORT\_CATEGORY'],    $ad\_data); |
| [12065](#L12065) | $ad\_data = preg\_replace ("/{tag}/i",                $ai\_wp\_data [AI\_TAGS]['TAG'],               $ad\_data); |
| [12066](#L12066) | $ad\_data = preg\_replace ("/{tags}/i",               $ai\_wp\_data [AI\_TAGS]['TAGS'],              $ad\_data); |
| [12067](#L12067) | $ad\_data = preg\_replace ("/{tags-spaces}/i",        $ai\_wp\_data [AI\_TAGS]['TAGS\_SPACES'],       $ad\_data); |
| [12068](#L12068) | $ad\_data = preg\_replace ("/{smart-tag}/i",          $ai\_wp\_data [AI\_TAGS]['SMART\_TAG'],         $ad\_data); |
| [12069](#L12069) | $ad\_data = preg\_replace ("/{search-query}/i",       $ai\_wp\_data [AI\_TAGS]['SEARCH\_QUERY'],      $ad\_data); |
| [12070](#L12070) | $ad\_data = preg\_replace ("/{author}/i",             $ai\_wp\_data [AI\_TAGS]['AUTHOR'],            $ad\_data); |
| [12071](#L12071) | $ad\_data = preg\_replace ("/{author-name}/i",        $ai\_wp\_data [AI\_TAGS]['AUTHOR\_NAME'],       $ad\_data); |
| [12072](#L12072) | $ad\_data = preg\_replace ("/{author-login}/i",       $ai\_wp\_data [AI\_TAGS]['AUTHOR\_LOGIN'],      $ad\_data); |
| [12073](#L12073) | $ad\_data = preg\_replace ("/{post-id}/i",            $ai\_wp\_data [AI\_TAGS]['POST\_ID'],           $ad\_data); |
| [12074](#L12074) |  |
| [12075](#L12075) | $ad\_data = preg\_replace ("/{short\_title}/i",        $ai\_wp\_data [AI\_TAGS]['SHORT\_TITLE'],       $ad\_data); |
| [12076](#L12076) | $ad\_data = preg\_replace ("/{short\_category}/i",     $ai\_wp\_data [AI\_TAGS]['SHORT\_CATEGORY'],    $ad\_data); |
| [12077](#L12077) | $ad\_data = preg\_replace ("/{smart\_tag}/i",          $ai\_wp\_data [AI\_TAGS]['SMART\_TAG'],         $ad\_data); |
| [12078](#L12078) | $ad\_data = preg\_replace ("/{search\_query}/i",       $ai\_wp\_data [AI\_TAGS]['SEARCH\_QUERY'],      $ad\_data); |
| [12079](#L12079) | $ad\_data = preg\_replace ("/{author\_name}/i",        $ai\_wp\_data [AI\_TAGS]['AUTHOR\_NAME'],       $ad\_data); |
| [12080](#L12080) |  |
| [12081](#L12081) | $ad\_data = preg\_replace ("/{block-number}/i",       isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER]) ? $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NUMBER] : '', $ad\_data); |
| [12082](#L12082) | $ad\_data = preg\_replace ("/{block-name}/i",         isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME])   ? $ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME]   : '', $ad\_data); |
| [12083](#L12083) | $ad\_data = preg\_replace ("/{block-name-encoded}/i", isset ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME])   ? urlencode ($ai\_wp\_data [AI\_CURRENT\_BLOCK\_NAME])   : '', $ad\_data); |
| [12084](#L12084) |  |
| [12085](#L12085) | $ad\_data = preg\_replace ("/{url}/i",                $ai\_wp\_data [AI\_TAGS]['URL'],               $ad\_data); |
| [12086](#L12086) |  |
| [12087](#L12087) | if (preg\_match ("/{reusable-block-([\d]+)}/i", $ad\_data, $block\_match)) { |
| [12088](#L12088) | $block\_id  = $block\_match [1]; |
| [12089](#L12089) |  |
| [12090](#L12090) | $reusable\_block = ''; |
| [12091](#L12091) | if (!empty ($block\_id) && (int) $block\_id == $block\_id) { |
| [12092](#L12092) | $reusable\_block = get\_post\_field ('post\_content', $block\_id); |
| [12093](#L12093) | } |
| [12094](#L12094) |  |
| [12095](#L12095) | $ad\_data = preg\_replace ("/".$block\_match [0]."/i", $reusable\_block, $ad\_data); |
| [12096](#L12096) | } |
| [12097](#L12097) |  |
| [12098](#L12098) | if (preg\_match\_all ("/{tag-([\d+])}/i", $ad\_data, $tag\_matches)) { |
| [12099](#L12099) | foreach ($tag\_matches [1] as $tag\_index) { |
| [12100](#L12100) | $tag\_to\_replace = isset ($ai\_wp\_data [AI\_TAGS]['TAGS\_ARRAY'][$tag\_index - 1]) ? $ai\_wp\_data [AI\_TAGS]['TAGS\_ARRAY'][$tag\_index - 1] : ''; |
| [12101](#L12101) | $ad\_data = preg\_replace ("/{tag-$tag\_index}/i", $tag\_to\_replace, $ad\_data); |
| [12102](#L12102) | } |
| [12103](#L12103) | } |
| [12104](#L12104) |  |
| [12105](#L12105) | if (preg\_match\_all ("/{tag-slug-([\d+])}/i", $ad\_data, $tag\_matches)) { |
| [12106](#L12106) | foreach ($tag\_matches [1] as $tag\_index) { |
| [12107](#L12107) | $tag\_to\_replace = isset ($ai\_wp\_data [AI\_TAGS]['TAG\_SLUGS\_ARRAY'][$tag\_index - 1]) ? $ai\_wp\_data [AI\_TAGS]['TAG\_SLUGS\_ARRAY'][$tag\_index - 1] : ''; |
| [12108](#L12108) | $ad\_data = preg\_replace ("/{tag-slug-$tag\_index}/i", $tag\_to\_replace, $ad\_data); |
| [12109](#L12109) | } |
| [12110](#L12110) | } |
| [12111](#L12111) |  |
| [12112](#L12112) | if (preg\_match\_all ("/{category-([\d+])}/i", $ad\_data, $category\_matches)) { |
| [12113](#L12113) | foreach ($category\_matches [1] as $category\_index) { |
| [12114](#L12114) | $category\_to\_replace = isset ($ai\_wp\_data [AI\_TAGS]['CATEGORIES\_ARRAY'][$category\_index - 1]) ? $ai\_wp\_data [AI\_TAGS]['CATEGORIES\_ARRAY'][$category\_index - 1] : ''; |
| [12115](#L12115) | $ad\_data = preg\_replace ("/{category-$category\_index}/i", $category\_to\_replace, $ad\_data); |
| [12116](#L12116) | } |
| [12117](#L12117) | } |
| [12118](#L12118) |  |
| [12119](#L12119) | if (preg\_match\_all ("/{category-slug-([\d+])}/i", $ad\_data, $category\_matches)) { |
| [12120](#L12120) | foreach ($category\_matches [1] as $category\_index) { |
| [12121](#L12121) | $category\_to\_replace = isset ($ai\_wp\_data [AI\_TAGS]['CATEGORY\_SLUGS\_ARRAY'][$category\_index - 1]) ? $ai\_wp\_data [AI\_TAGS]['CATEGORY\_SLUGS\_ARRAY'][$category\_index - 1] : ''; |
| [12122](#L12122) | $ad\_data = preg\_replace ("/{category-slug-$category\_index}/i", $category\_to\_replace, $ad\_data); |
| [12123](#L12123) | } |
| [12124](#L12124) | } |
| [12125](#L12125) |  |
| [12126](#L12126) | if (function\_exists ('ai\_tags')) ai\_tags ($ad\_data); |
| [12127](#L12127) |  |
| [12128](#L12128) | // Replace default values {tag:default} |
| [12129](#L12129) | $default\_value\_tags = preg\_match\_all ("/\{\#[a-zA-Z\-\_][a-zA-Z0-9\-\_]\*?\:(.\*?)\#\}/", $ad\_data, $matches); |
| [12130](#L12130) | if ($default\_value\_tags) { |
| [12131](#L12131) | foreach ($matches [0] as $index => $match) { |
| [12132](#L12132) | $ad\_data = str\_replace ($match, $matches [1][$index], $ad\_data); |
| [12133](#L12133) | } |
| [12134](#L12134) | } |
| [12135](#L12135) |  |
| [12136](#L12136) | return $ad\_data; |
| [12137](#L12137) | } |
| [12138](#L12138) |  |
| [12139](#L12139) | function ai\_ad\_label\_code () { |
| [12140](#L12140) | global $ai\_wp\_data; |
| [12141](#L12141) |  |
| [12142](#L12142) | $ad\_label = get\_ad\_label (true); |
| [12143](#L12143) |  |
| [12144](#L12144) | $ad\_label = apply\_filters ("ai\_ad\_label", $ad\_label); |
| [12145](#L12145) |  |
| [12146](#L12146) | if (strpos ($ad\_label, '<') === false && strpos ($ad\_label, '>') === false) { |
| [12147](#L12147) | $ad\_label = '<div class="' . get\_block\_class\_name (true) . '-label">' . $ad\_label . '</div>'; |
| [12148](#L12148) | } |
| [12149](#L12149) |  |
| [12150](#L12150) | $unfiltered\_html = $ai\_wp\_data [AI\_UNFILTERED\_HTML]; |
| [12151](#L12151) | if (defined ('DISALLOW\_UNFILTERED\_HTML') && DISALLOW\_UNFILTERED\_HTML) { |
| [12152](#L12152) | $unfiltered\_html = false; |
| [12153](#L12153) | } |
| [12154](#L12154) |  |
| [12155](#L12155) | if (!$unfiltered\_html) { |
| [12156](#L12156) | $ad\_label = wp\_kses ($ad\_label, 'post'); |
| [12157](#L12157) | } |
| [12158](#L12158) |  |
| [12159](#L12159) | return $ad\_label .= "\n"; |
| [12160](#L12160) | } |
| [12161](#L12161) |  |
| [12162](#L12162) | function ai\_php\_enabled () { |
| [12163](#L12163) | $php\_enabled = !(defined ('DISALLOW\_FILE\_EDIT') && DISALLOW\_FILE\_EDIT) && !(defined ('DISALLOW\_FILE\_MODS') && DISALLOW\_FILE\_MODS); |
| [12164](#L12164) | return apply\_filters ('ai\_php\_enabled', $php\_enabled); |
| [12165](#L12165) | } |
| [12166](#L12166) |  |
| [12167](#L12167) | function ai\_inline\_js () { |
| [12168](#L12168) | //  return (get\_wait\_for\_jquery () || !defined ('AI\_EXTERNAL\_JS')); |
| [12169](#L12169) | return (get\_wait\_for\_jquery () == AI\_WAIT\_FOR\_JQUERY\_ENABLED || (get\_javascript\_code\_mode () == AI\_JAVASCRIPT\_CODE\_INLINE && !defined ('AI\_EXTERNAL\_JS'))); |
| [12170](#L12170) | } |
| [12171](#L12171) |  |
| [12172](#L12172) | function ai\_unserialize ($string) { |
| [12173](#L12173) | // Clear objects - O:5:"Class":0:{} |
| [12174](#L12174) | //  $string = preg\_replace ('#o:\d+:"[a-z0-9\_]+":\d+:{.\*?}#i', '', $string); |
| [12175](#L12175) |  |
| [12176](#L12176) | return @unserialize ($string, ['allowed\_classes' => false]); |
| [12177](#L12177) | } |
| [12178](#L12178) |  |
| [12179](#L12179) | // =========================================================================================== |
| [12180](#L12180) |  |
| [12181](#L12181) |  |
| [12182](#L12182) | global $block\_object, $ai\_wp\_data, $ad\_inserter\_globals, $ai\_last\_check, $ai\_last\_time, $ai\_total\_plugin\_time, $ai\_total\_block\_php\_time, $ai\_total\_hook\_php\_time, $ai\_processing\_log, $ai\_db\_options\_extract, $ai\_db\_options, $block\_insertion\_log; |
| [12183](#L12183) |  |
| [12184](#L12184) | if (!defined ('AD\_INSERTER\_PLUGIN\_DIR')) |
| [12185](#L12185) | define ('AD\_INSERTER\_PLUGIN\_DIR', plugin\_dir\_path (\_\_FILE\_\_)); |
| [12186](#L12186) |  |
| [12187](#L12187) | define ('AI\_WP\_DEBUGGING\_',                0); |
| [12188](#L12188) | define ('AI\_DEBUG\_PROCESSING\_',            0x01); |
| [12189](#L12189) | define ('AI\_URL\_DEBUG\_',                   'ai-debug'); |
| [12190](#L12190) | define ('AI\_URL\_DEBUG\_PROCESSING\_',        'ai-debug-processing'); |
| [12191](#L12191) | define ('AI\_URL\_DEBUG\_PROCESSING\_FE\_',     'ai-debug-processing-fe'); |
| [12192](#L12192) | define ('AI\_URL\_DEBUG\_PHP\_',               'ai-debug-php'); |
| [12193](#L12193) |  |
| [12194](#L12194) | if (isset ($\_GET [AI\_URL\_DEBUG\_PHP\_]) && $\_GET [AI\_URL\_DEBUG\_PHP\_] != '') { |
| [12195](#L12195) | if (isset ($\_COOKIE ['AI\_WP\_DEBUGGING'])) { |
| [12196](#L12196) | ini\_set ('display\_errors', 1); |
| [12197](#L12197) | error\_reporting (E\_ALL); |
| [12198](#L12198) | } |
| [12199](#L12199) | } |
| [12200](#L12200) |  |
| [12201](#L12201) | $ai\_wp\_data [AI\_WP\_DEBUGGING\_] = 0; |
| [12202](#L12202) | $start\_time = 0; |
| [12203](#L12203) |  |
| [12204](#L12204) | if (!is\_admin()) { |
| [12205](#L12205) | if (!isset ($\_GET [AI\_URL\_DEBUG\_]) || $\_GET [AI\_URL\_DEBUG\_] != 0) |
| [12206](#L12206) | if (isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_]) || isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE\_]) || (isset ($\_COOKIE ['AI\_WP\_DEBUGGING']) && ($\_COOKIE ['AI\_WP\_DEBUGGING'] & AI\_DEBUG\_PROCESSING\_) != 0))  { |
| [12207](#L12207) | if ((isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_] == 1) || (isset ($\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE\_]) && $\_GET [AI\_URL\_DEBUG\_PROCESSING\_FE\_] == 1)) { |
| [12208](#L12208) | $ai\_wp\_data [AI\_WP\_DEBUGGING\_] |= AI\_DEBUG\_PROCESSING\_; |
| [12209](#L12209) |  |
| [12210](#L12210) | $ai\_total\_plugin\_time = 0; |
| [12211](#L12211) | $start\_time = microtime (true); |
| [12212](#L12212) | $ai\_total\_block\_php\_time = 0; |
| [12213](#L12213) | $ai\_total\_hook\_php\_time = 0; |
| [12214](#L12214) | $ai\_last\_time = microtime (true); |
| [12215](#L12215) | $ai\_processing\_log = array (); |
| [12216](#L12216) | ai\_log ('INITIALIZATION START'); |
| [12217](#L12217) | } |
| [12218](#L12218) | } |
| [12219](#L12219) | } |
| [12220](#L12220) |  |
| [12221](#L12221) |  |
| [12222](#L12222) | // Version check |
| [12223](#L12223) | global $wp\_version, $version\_string, $subversion\_string, $filter\_hooks; |
| [12224](#L12224) |  |
| [12225](#L12225) | if (version\_compare ($wp\_version, "4.6", "<")) { |
| [12226](#L12226) | exit ('Ad Inserter ' . \_\_('requires WordPress 4.6 or newer', 'ad-inserter') . '. <a href="https://wordpress.org/support/article/updating-wordpress/" target=\_blank">'. \_\_('Please update!', 'ad-inserter') . '</a>'); |
| [12227](#L12227) | } |
| [12228](#L12228) |  |
| [12229](#L12229) | //if (version\_compare (phpversion (), "5.6", "<")) { |
| [12230](#L12230) | //  exit ('Ad Inserter ' . \_\_('requires PHP 5.6 or newer', 'ad-inserter') . '. <a href="https://wordpress.org/support/update-php/" target=\_blank">'. \_\_('Please update!', 'ad-inserter') . '</a>'); |
| [12231](#L12231) | //} |
| [12232](#L12232) |  |
| [12233](#L12233) | $filter\_hooks = array (); |
| [12234](#L12234) |  |
| [12235](#L12235) | if (isset ($\_GET ['ai-safe-mode'])) { |
| [12236](#L12236) | define ('AI\_SAFE\_MODE', 1); |
| [12237](#L12237) | } |
| [12238](#L12238) |  |
| [12239](#L12239) | //include required files |
| [12240](#L12240) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'class.php'; |
| [12241](#L12241) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'constants.php'; |
| [12242](#L12242) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'settings.php'; |
| [12243](#L12243) |  |
| [12244](#L12244) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) |
| [12245](#L12245) | ai\_log ("AFTER REQUIRE: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms"); |
| [12246](#L12246) |  |
| [12247](#L12247) | $subversion\_array = explode ("-", AD\_INSERTER\_VERSION); |
| [12248](#L12248) | $subversion\_string = isset ($subversion\_array [1]) ? '-'.$subversion\_array [1] : ''; |
| [12249](#L12249) | $version\_array = explode (".", $subversion\_array [0]); |
| [12250](#L12250) | $version\_string = ""; |
| [12251](#L12251) | foreach ($version\_array as $number) { |
| [12252](#L12252) | $version\_string .= sprintf ("%02d", $number); |
| [12253](#L12253) | } |
| [12254](#L12254) |  |
| [12255](#L12255) | $ai\_wp\_data [AI\_WP\_URL] = remove\_debug\_parameters\_from\_url (); |
| [12256](#L12256) |  |
| [12257](#L12257) | $ad\_inserter\_globals = array (); |
| [12258](#L12258) | $block\_object = array (); |
| [12259](#L12259) | $block\_insertion\_log = array (); |
| [12260](#L12260) |  |
| [12261](#L12261) | $ai\_wp\_data [AI\_WP\_PAGE\_TYPE]           = AI\_PT\_NONE; |
| [12262](#L12262) | $ai\_wp\_data [AI\_WP\_AMP\_PAGE]            = false; |
| [12263](#L12263) | $ai\_wp\_data [AI\_WP\_USER\_SET]            = false; |
| [12264](#L12264) | $ai\_wp\_data [AI\_WP\_USER]                = AI\_USER\_NOT\_LOGGED\_IN; |
| [12265](#L12265) | $ai\_wp\_data [AI\_CONTEXT]                = AI\_CONTEXT\_NONE; |
| [12266](#L12266) |  |
| [12267](#L12267) | $ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION]  = false; |
| [12268](#L12268) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_DETECTION]  = false; |
| [12269](#L12269) | $ai\_wp\_data [AI\_MOBILE\_DETECT\_JS]       = false; |
| [12270](#L12270) | $ai\_wp\_data [AI\_TRACKING]               = false; |
| [12271](#L12271) | $ai\_wp\_data [AI\_STICKY\_WIDGETS]         = false; |
| [12272](#L12272) | $ai\_wp\_data [AI\_STICK\_TO\_THE\_CONTENT]   = false; |
| [12273](#L12273) | $ai\_wp\_data [AI\_ANIMATION]              = false; |
| [12274](#L12274) | $ai\_wp\_data [AI\_CLOSE\_BUTTONS]          = false; |
| [12275](#L12275) | $ai\_wp\_data [AI\_IFRAMES]                = false; |
| [12276](#L12276) | $ai\_wp\_data [AI\_DISABLE\_CACHING]        = false; |
| [12277](#L12277) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_INSERTION]  = false; |
| [12278](#L12278) | $ai\_wp\_data [AI\_LAZY\_LOADING]           = false; |
| [12279](#L12279) | $ai\_wp\_data [AI\_PAGE\_BLOCKS]            = 0; |
| [12280](#L12280) | $ai\_wp\_data [AI\_GEOLOCATION]            = false; |
| [12281](#L12281) | //$ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] = isset ($\_POST ['html\_element\_selection']) ? (bool) $\_POST ['html\_element\_selection'] : false; |
| [12282](#L12282) | $ai\_wp\_data [AI\_HTML\_ELEMENT\_SELECTION] = false; |
| [12283](#L12283) | $ai\_wp\_data [AI\_MBSTRING\_LOADED]        = extension\_loaded ('mbstring'); |
| [12284](#L12284) | $ai\_wp\_data [AI\_PROCESSING\_TIME]        = false; |
| [12285](#L12285) | $ai\_wp\_data [AI\_FORCE\_SERVERSIDE\_CODE]  = false; |
| [12286](#L12286) | $ai\_wp\_data [AI\_CODE\_FOR\_IFRAME]        = false; |
| [12287](#L12287) | $ai\_wp\_data [AI\_HEAD\_CODES]             = array (); |
| [12288](#L12288) | $ai\_wp\_data [AI\_HEAD\_GROUPS]            = array (); |
| [12289](#L12289) | $ai\_wp\_data [AI\_ACTIVE\_GROUP\_NAMES]     = array (); |
| [12290](#L12290) | $ai\_wp\_data [AI\_CHECK\_BLOCK]            = false; |
| [12291](#L12291) | $ai\_wp\_data [AI\_POST\_POSITION]          = AI\_POST\_POSITION\_BEFORE\_POST; |
| [12292](#L12292) | $ai\_wp\_data [AI\_FOOTER\_JS\_CODE\_DOM\_READY] = ''; |
| [12293](#L12293) | $ai\_wp\_data [AI\_FOOTER\_INLINE\_SCRIPTS]  = false; |
| [12294](#L12294) | $ai\_wp\_data [AI\_W3TC\_DEBUGGING]         = false; |
| [12295](#L12295) | $ai\_wp\_data [AI\_CLIENT\_SIDE\_FILTER\_CHECKS] = false; |
| [12296](#L12296) | $ai\_wp\_data [AI\_PARALLAX]               = false; |
| [12297](#L12297) | $ai\_wp\_data [AI\_PHP\_PROCESSING]         = ai\_php\_enabled (); |
| [12298](#L12298) | $ai\_wp\_data [AI\_UNFILTERED\_HTML]        = !(defined ('DISALLOW\_UNFILTERED\_HTML') && DISALLOW\_UNFILTERED\_HTML); |
| [12299](#L12299) |  |
| [12300](#L12300) | ai\_load\_settings (); |
| [12301](#L12301) |  |
| [12302](#L12302) | $ai\_wp\_data [AI\_NO\_JQUERY\_CODE]         = defined ('AI\_NO\_JQUERY') || !get\_wait\_for\_jquery () || (isset ($\_GET [AI\_URL\_DEBUG\_NO\_JQUERY]) && !empty ($\_GET [AI\_URL\_DEBUG\_NO\_JQUERY])); |
| [12303](#L12303) |  |
| [12304](#L12304) |  |
| [12305](#L12305) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) |
| [12306](#L12306) | ai\_log ("AFTER LOAD SETTINGS: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms"); |
| [12307](#L12307) |  |
| [12308](#L12308) | $ai\_wp\_data [AI\_BACKEND\_JS\_DEBUGGING]  = get\_backend\_javascript\_debugging (); |
| [12309](#L12309) | $ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] = get\_frontend\_javascript\_debugging (); |
| [12310](#L12310) |  |
| [12311](#L12311) | if (isset ($\_GET [AI\_URL\_DEBUG\_PHP]) && $\_GET [AI\_URL\_DEBUG\_PHP] == '1') { |
| [12312](#L12312) | if (get\_remote\_debugging ()) { |
| [12313](#L12313) | ini\_set ('display\_errors', 1); |
| [12314](#L12314) | error\_reporting (E\_ALL); |
| [12315](#L12315) | } |
| [12316](#L12316) | } |
| [12317](#L12317) |  |
| [12318](#L12318) | if (isset ($\_GET [AI\_URL\_DEBUG\_JAVASCRIPT]) && $\_GET [AI\_URL\_DEBUG\_JAVASCRIPT] == '1' || isset ($\_GET [AI\_URL\_DEBUG\_TRACKING]) && $\_GET [AI\_URL\_DEBUG\_TRACKING] == '1') { |
| [12319](#L12319) | if (get\_remote\_debugging ()) { |
| [12320](#L12320) | $ai\_wp\_data [AI\_FRONTEND\_JS\_DEBUGGING] = true; |
| [12321](#L12321) | } |
| [12322](#L12322) | } |
| [12323](#L12323) |  |
| [12324](#L12324) | if (defined ('AI\_ADBLOCKING\_DETECTION') && AI\_ADBLOCKING\_DETECTION) { |
| [12325](#L12325) | $ai\_wp\_data [AI\_ADB\_DETECTION] = $block\_object [AI\_ADB\_MESSAGE\_OPTION\_NAME]->get\_enable\_manual (); |
| [12326](#L12326) |  |
| [12327](#L12327) | $logged\_in\_key = defined ('LOGGED\_IN\_KEY') ? LOGGED\_IN\_KEY : 'key'; |
| [12328](#L12328) |  |
| [12329](#L12329) | if ($ai\_wp\_data [AI\_ADB\_DETECTION]) { |
| [12330](#L12330) |  |
| [12331](#L12331) | $key = '#AI'; |
| [12332](#L12332) | if (defined ('AUTH\_KEY')) { |
| [12333](#L12333) | $key .= AUTH\_KEY; |
| [12334](#L12334) | } |
| [12335](#L12335) | if (defined ('NONCE\_KEY')) { |
| [12336](#L12336) | $key .= NONCE\_KEY; |
| [12337](#L12337) | } |
| [12338](#L12338) |  |
| [12339](#L12339) | $adb\_2\_name = AI\_ADB\_2\_DEFAULT\_NAME; |
| [12340](#L12340) | define ('AI\_ADB\_COOKIE\_VALUE', substr (preg\_replace ("/[^A-Za-z]+/", '', strtolower (md5 ($logged\_in\_key.md5 ($key)))), 0, 8)); |
| [12341](#L12341) |  |
| [12342](#L12342) | $script\_path = AD\_INSERTER\_PLUGIN\_DIR.'js'; |
| [12343](#L12343) | $script = $script\_path.'/sponsors.js'; |
| [12344](#L12344) |  |
| [12345](#L12345) | if (is\_writable ($script\_path) && is\_writable ($script)) { |
| [12346](#L12346) | $adb\_2\_name = substr (preg\_replace ("/[^A-Za-z]+/", '', strtolower (md5 ($logged\_in\_key).md5 ($key))), 0, 8); |
| [12347](#L12347) |  |
| [12348](#L12348) | $js\_ok = false; |
| [12349](#L12349) | if (file\_exists ($script)) { |
| [12350](#L12350) | if (strpos (file\_get\_contents ($script), $adb\_2\_name) !== false) $js\_ok = true; |
| [12351](#L12351) | } |
| [12352](#L12352) |  |
| [12353](#L12353) | if (!$js\_ok) { |
| [12354](#L12354) | file\_put\_contents ($script, 'window.' . $adb\_2\_name . '=true;'); |
| [12355](#L12355) | define ('AI\_ADB\_2\_FILE\_RECREATED', true); |
| [12356](#L12356) | } |
| [12357](#L12357) | } |
| [12358](#L12358) |  |
| [12359](#L12359) | define ('AI\_ADB\_2\_NAME', $adb\_2\_name); |
| [12360](#L12360) | } |
| [12361](#L12361) | } |
| [12362](#L12362) |  |
| [12363](#L12363) | if (function\_exists ('ai\_load\_globals')) ai\_load\_globals ($start\_time); |
| [12364](#L12364) |  |
| [12365](#L12365) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) |
| [12366](#L12366) | ai\_log ("AFTER LOAD GLOBALS: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms"); |
| [12367](#L12367) |  |
| [12368](#L12368) | if (get\_dynamic\_blocks () == AI\_DYNAMIC\_BLOCKS\_SERVER\_SIDE\_W3TC) { |
| [12369](#L12369) | if (!in\_array ('w3-total-cache/w3-total-cache.php', get\_option ('active\_plugins'))) { |
| [12370](#L12370) | define ('AI\_NO\_W3TC', true); |
| [12371](#L12371) | if (!defined ('W3TC\_DYNAMIC\_SECURITY')) define ('W3TC\_DYNAMIC\_SECURITY', 'W3 Total Cache plugin not active'); |
| [12372](#L12372) | } |
| [12373](#L12373) | if (!defined ('W3TC\_DYNAMIC\_SECURITY')) { |
| [12374](#L12374) | $string = AD\_INSERTER\_PLUGIN\_DIR; |
| [12375](#L12375) | if (defined ('AUTH\_KEY'))      $string .= AUTH\_KEY; |
| [12376](#L12376) | if (defined ('LOGGED\_IN\_KEY')) $string .= LOGGED\_IN\_KEY; |
| [12377](#L12377) |  |
| [12378](#L12378) | define ('W3TC\_DYNAMIC\_SECURITY', md5 ($string)); |
| [12379](#L12379) | } |
| [12380](#L12380) | } |
| [12381](#L12381) |  |
| [12382](#L12382) | if ($ai\_wp\_data [AI\_SERVER\_SIDE\_DETECTION] && !is\_admin ()) { |
| [12383](#L12383) | require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/Mobile\_Detect.php'; |
| [12384](#L12384) |  |
| [12385](#L12385) | //  require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/MobileDetect.php'; |
| [12386](#L12386) | //  require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/Cache/CacheItem.php'; |
| [12387](#L12387) | //  require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/Cache/Cache.php'; |
| [12388](#L12388) | //  require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/Cache/CacheException.php'; |
| [12389](#L12389) | //  require\_once AD\_INSERTER\_PLUGIN\_DIR.'includes/mobiledetect/Exception/MobileDetectException.php'; |
| [12390](#L12390) |  |
| [12391](#L12391) | $detect = new ai\_Mobile\_Detect; |
| [12392](#L12392) |  |
| [12393](#L12393) | //  $detect = new MobileDetect (); |
| [12394](#L12394) |  |
| [12395](#L12395) | define ('AI\_MOBILE',   $detect->isMobile ()); |
| [12396](#L12396) | define ('AI\_TABLET',   $detect->isTablet ()); |
| [12397](#L12397) | define ('AI\_PHONE',    AI\_MOBILE && !AI\_TABLET); |
| [12398](#L12398) | define ('AI\_DESKTOP',  !AI\_MOBILE); |
| [12399](#L12399) | } else { |
| [12400](#L12400) | define ('AI\_MOBILE',   true); |
| [12401](#L12401) | define ('AI\_TABLET',   true); |
| [12402](#L12402) | define ('AI\_PHONE',    true); |
| [12403](#L12403) | define ('AI\_DESKTOP',  true); |
| [12404](#L12404) | } |
| [12405](#L12405) |  |
| [12406](#L12406) | if (isset ($\_POST [AI\_FORM\_SAVE])) |
| [12407](#L12407) | define ('AI\_SYNTAX\_HIGHLIGHTING', isset ($\_POST ["syntax-highlighter-theme"]) && $\_POST ["syntax-highlighter-theme"] != AI\_OPTION\_DISABLED); else |
| [12408](#L12408) | define ('AI\_SYNTAX\_HIGHLIGHTING', get\_syntax\_highlighter\_theme () != AI\_OPTION\_DISABLED); |
| [12409](#L12409) |  |
| [12410](#L12410) | if (isset ($\_POST [AI\_FORM\_SAVE])) { |
| [12411](#L12411) | $ai\_wp\_data [AI\_DISABLE\_TRANSLATION] = isset ($\_POST ['disable\_translation']) ? $\_POST ['disable\_translation'] : DEFAULT\_DISABLE\_TRANSLATION; |
| [12412](#L12412) | } else $ai\_wp\_data [AI\_DISABLE\_TRANSLATION] = get\_disable\_translation () || (isset ($\_GET [AI\_URL\_DEBUG\_TRANSLATION]) && get\_remote\_debugging ()); |
| [12413](#L12413) |  |
| [12414](#L12414) | if (!$ai\_wp\_data [AI\_DISABLE\_TRANSLATION]) { |
| [12415](#L12415) | add\_action ('plugins\_loaded',             'ai\_load\_plugin\_textdomain\_hook'); |
| [12416](#L12416) | add\_filter ('load\_textdomain\_mofile',     'ai\_load\_textdomain\_mofile', 10, 2); |
| [12417](#L12417) | } |
| [12418](#L12418) |  |
| [12419](#L12419) |  |
| [12420](#L12420) | add\_action ('plugins\_loaded',             'ai\_plugins\_loaded'); |
| [12421](#L12421) | add\_action ('init',                       'ai\_init\_hook'); |
| [12422](#L12422) | add\_action ('wp\_loaded',                  'ai\_wp\_loaded\_hook'); |
| [12423](#L12423) | add\_action ('admin\_menu',                 'ai\_admin\_menu\_hook'); |
| [12424](#L12424) | add\_action ('admin\_notices',              'ai\_admin\_notice\_hook'); |
| [12425](#L12425) | add\_action ('wp',                         'ai\_wp\_hook'); |
| [12426](#L12426) | add\_action ('wp\_enqueue\_scripts',         'ai\_wp\_enqueue\_scripts\_hook' ); |
| [12427](#L12427) | //add\_action ('upgrader\_process\_complete',  'ai\_upgrader\_process\_complete\_hook', 10, 2); |
| [12428](#L12428) |  |
| [12429](#L12429) | if (function\_exists ('ai\_system\_output\_check')) $ai\_system\_output = ai\_system\_output\_check (); else $ai\_system\_output = false; |
| [12430](#L12430) |  |
| [12431](#L12431) | //if (defined ('AI\_BUFFERING')) { |
| [12432](#L12432) | //  add\_action ('get\_header',       'ai\_buffering\_start\_hook', 99999); |
| [12433](#L12433) | //} |
| [12434](#L12434) |  |
| [12435](#L12435) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0 || $ai\_system\_output) { |
| [12436](#L12436) | add\_action ('shutdown',         'ai\_shutdown\_hook', 0); |
| [12437](#L12437) | } |
| [12438](#L12438) |  |
| [12439](#L12439) | register\_activation\_hook    (AD\_INSERTER\_PLUGIN\_DIR.'ad-inserter.php', 'ai\_activation\_hook'); |
| [12440](#L12440) | register\_deactivation\_hook  (AD\_INSERTER\_PLUGIN\_DIR.'ad-inserter.php', 'ai\_deactivation\_hook' ); |
| [12441](#L12441) |  |
| [12442](#L12442) | add\_action ('widgets\_init',       'ai\_widgets\_init\_hook'); |
| [12443](#L12443) | add\_action ('add\_meta\_boxes',     'ai\_add\_meta\_box\_hook'); |
| [12444](#L12444) | add\_action ('save\_post',          'ai\_save\_meta\_box\_data\_hook'); |
| [12445](#L12445) |  |
| [12446](#L12446) | if (function\_exists ('ai\_hooks')) ai\_hooks (); |
| [12447](#L12447) |  |
| [12448](#L12448) | add\_filter ('plugin\_action\_links\_'.plugin\_basename (\_\_FILE\_\_), 'ai\_plugin\_action\_links'); |
| [12449](#L12449) | add\_action ('after\_plugin\_row\_' . AD\_INSERTER\_SLUG . '/ad-inserter.php', 'ai\_after\_plugin\_row\_1', 10, 3); |
| [12450](#L12450) |  |
| [12451](#L12451) | add\_filter ('plugin\_row\_meta',    'ai\_set\_plugin\_meta', 99999, 2); |
| [12452](#L12452) | //add\_filter ('the\_generator',      'ai\_the\_generator'); |
| [12453](#L12453) |  |
| [12454](#L12454) | // If using Autoptimize plugin |
| [12455](#L12455) | //add\_filter ('autoptimize\_filter\_js\_replacetag','ai\_ao\_override\_js\_replacetag', 10, 1); |
| [12456](#L12456) |  |
| [12457](#L12457) | if (is\_admin () === true) { |
| [12458](#L12458) | add\_action ('wp\_ajax\_ai\_ajax\_backend', 'ai\_ajax\_backend'); |
| [12459](#L12459) | add\_action ('wp\_ajax\_ai\_ajax',         'ai\_ajax'); |
| [12460](#L12460) | add\_action ('wp\_ajax\_nopriv\_ai\_ajax',  'ai\_ajax'); |
| [12461](#L12461) | } |
| [12462](#L12462) |  |
| [12463](#L12463) |  |
| [12464](#L12464) | if (!get\_option (AI\_INSTALL\_NAME)) { |
| [12465](#L12465) | update\_option (AI\_INSTALL\_NAME, time ()); |
| [12466](#L12466) | } |
| [12467](#L12467) |  |
| [12468](#L12468) |  |
| [12469](#L12469) | if (defined ('AI\_PLUGIN\_TRACKING') && AI\_PLUGIN\_TRACKING) { |
| [12470](#L12470) |  |
| [12471](#L12471) | add\_action ('plugins\_loaded', 'ai\_install\_dst'); |
| [12472](#L12472) |  |
| [12473](#L12473) | function ai\_install\_dst () { |
| [12474](#L12474) | global $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [12475](#L12475) |  |
| [12476](#L12476) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [12477](#L12477) | ai\_log ("PLUGINS LOADED INSTALL DST START"); |
| [12478](#L12478) | $ai\_processing\_time\_active = $ai\_wp\_data [AI\_PROCESSING\_TIME]; |
| [12479](#L12479) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = true; |
| [12480](#L12480) | $start\_time = microtime (true); |
| [12481](#L12481) | } |
| [12482](#L12482) |  |
| [12483](#L12483) | if (!class\_exists ('DST\_Client')) { |
| [12484](#L12484) | require\_once dirname (\_\_FILE\_\_) . '/includes/dst/dst.php'; |
| [12485](#L12485) | } |
| [12486](#L12486) |  |
| [12487](#L12487) | if (!function\_exists ('ai\_start\_dst') && defined ('DST\_Client::DST\_FILTER\_OPTIONS')) { |
| [12488](#L12488) | function ai\_start\_dst () { |
| [12489](#L12489) | global $ai\_dst; |
| [12490](#L12490) |  |
| [12491](#L12491) | $dst\_settings = array ( |
| [12492](#L12492) | 'main\_file'           => \_\_FILE\_\_, |
| [12493](#L12493) | 'tracking\_url'        => 'https://analytics.adinserter.pro/', |
| [12494](#L12494) | 'track\_local'         => true, |
| [12495](#L12495) | 'tracking'            => DST\_Client::DST\_TRACKING\_OPTIN, |
| [12496](#L12496) | 'use\_email'           => DST\_Client::DST\_USE\_EMAIL\_OFF, |
| [12497](#L12497) | 'multisite\_tracking'  => DST\_Client::DST\_MULTISITE\_SITES\_TRACKING\_WAIT\_FOR\_MAIN, |
| [12498](#L12498) | 'deactivation\_form'   => true, |
| [12499](#L12499) | 'admin\_ip\_tracking'   => true, |
| [12500](#L12500) | 'notice\_icon'         => AD\_INSERTER\_PLUGIN\_IMAGES\_URL.'icon-50x50.jpg', |
| [12501](#L12501) | ); |
| [12502](#L12502) |  |
| [12503](#L12503) | if (function\_exists ('ai\_dst\_settings')) ai\_dst\_settings ($dst\_settings); |
| [12504](#L12504) |  |
| [12505](#L12505) | $ai\_dst = new DST\_Client ($dst\_settings); |
| [12506](#L12506) | } |
| [12507](#L12507) |  |
| [12508](#L12508) | function ai\_notice\_text ($text) { |
| [12509](#L12509) | $text = |
| [12510](#L12510) | // translators: Opt-in message: Thank you for installing Ad Inserter (plugin name with HTML tags will be added) |
| [12511](#L12511) | \_\_("Thank you for installing", 'ad-inserter') . ' [STRONG][NAME][/STRONG]. ' . |
| [12512](#L12512) | // translators: Opt-in message: %s: HTML tags |
| [12513](#L12513) | sprintf (\_\_("We would like to %s track its usage %s on your site. This is completely optional and can be disabled at any time.", 'ad-inserter'), |
| [12514](#L12514) | '<a href="https://wordpress.org/plugins/ad-inserter/#privacy%20policy%20-%20plugin%20usage%20tracking" target=\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>') . '[P]' . |
| [12515](#L12515) | \_\_("We don't record any sensitive data, only information regarding the WordPress environment and plugin usage, which will help us to make improvements to the plugin.", 'ad-inserter'); |
| [12516](#L12516) |  |
| [12517](#L12517) | return $text; |
| [12518](#L12518) | } |
| [12519](#L12519) |  |
| [12520](#L12520) | function ai\_dst\_options ($options) { |
| [12521](#L12521) | global $ai\_db\_options, $ai\_db\_options\_extract; |
| [12522](#L12522) |  |
| [12523](#L12523) | if (isset ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && is\_string ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) && strlen ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS]) != 0) { |
| [12524](#L12524) | $used\_blocks = count (unserialize ($ai\_db\_options\_extract [AI\_EXTRACT\_USED\_BLOCKS])); |
| [12525](#L12525) | } else $used\_blocks = ''; |
| [12526](#L12526) |  |
| [12527](#L12527) | $install\_timestamp = get\_option (AI\_INSTALL\_NAME); |
| [12528](#L12528) | if ($install\_timestamp) { |
| [12529](#L12529) | $install\_date = $install\_timestamp; |
| [12530](#L12530) | } else $install\_date = ''; |
| [12531](#L12531) |  |
| [12532](#L12532) | if (isset ($ai\_db\_options [AI\_OPTION\_GLOBAL]['TIMESTAMP'])) { |
| [12533](#L12533) | $settings\_date = $ai\_db\_options [AI\_OPTION\_GLOBAL]['TIMESTAMP']; |
| [12534](#L12534) | } else $settings\_date = ''; |
| [12535](#L12535) |  |
| [12536](#L12536) | $count\_posts = wp\_count\_posts (); |
| [12537](#L12537) |  |
| [12538](#L12538) | $options ['posts']             = is\_numeric ($count\_posts->publish) ? $count\_posts->publish : 0; |
| [12539](#L12539) | $options ['blocks']            = $used\_blocks; |
| [12540](#L12540) | $options ['installation']      = $install\_date; |
| [12541](#L12541) | $options ['settings']          = $settings\_date; |
| [12542](#L12542) | $options ['notice\_review']     = ($review = get\_option ('ai-notice-review')) ? $review : ''; |
| [12543](#L12543) | $options ['remote\_debugging']  = get\_remote\_debugging (); |
| [12544](#L12544) | $options ['block\_class']       = get\_block\_class\_name (); |
| [12545](#L12545) |  |
| [12546](#L12546) | if (function\_exists ('ai\_dst\_options\_2')) ai\_dst\_options\_2 ($options); |
| [12547](#L12547) |  |
| [12548](#L12548) | return ($options); |
| [12549](#L12549) | } |
| [12550](#L12550) |  |
| [12551](#L12551) | function ai\_dst\_form\_text ($form) { |
| [12552](#L12552) | $form ['body'] = |
| [12553](#L12553) | '</p>' . |
| [12554](#L12554) | // translators: Deactivation message: %s: HTML tags |
| [12555](#L12555) | sprintf (\_\_("Looking for %s Documentation, %s %s Common Settings, %s %s Quick Start %s or help for %s AdSense ads? %s The plugin doesn't work with your theme? %s Let us know %s and we'll try to help you.", 'ad-inserter'), |
| [12556](#L12556) | '<a href="https://adinserter.pro/documentation" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>', |
| [12557](#L12557) | '<a href="https://adinserter.pro/documentation/common-settings" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>', |
| [12558](#L12558) | '<a href="https://adinserter.pro/documentation/quick-start" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>', |
| [12559](#L12559) | '<a href="https://adinserter.pro/documentation/adsense-ads" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>', |
| [12560](#L12560) | '<a href="https://adinserter.pro/contact#help" target="\_blank" style="text-decoration: none; box-shadow: 0 0 0;">', '</a>') . |
| [12561](#L12561) | '<hr /><p>' . |
| [12562](#L12562) | $form ['body']; |
| [12563](#L12563) | return ($form); |
| [12564](#L12564) | } |
| [12565](#L12565) |  |
| [12566](#L12566) | add\_filter (DST\_Client::DST\_FILTER\_OPTIN\_NOTICE\_TEXT . AD\_INSERTER\_SLUG, 'ai\_notice\_text'); |
| [12567](#L12567) | add\_filter (DST\_Client::DST\_FILTER\_OPTIONS .           AD\_INSERTER\_SLUG, 'ai\_dst\_options'); |
| [12568](#L12568) | add\_filter (DST\_Client::DST\_FILTER\_FORM\_TEXT .         AD\_INSERTER\_SLUG, 'ai\_dst\_form\_text'); |
| [12569](#L12569) |  |
| [12570](#L12570) | ai\_start\_dst (); |
| [12571](#L12571) | } |
| [12572](#L12572) |  |
| [12573](#L12573) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [12574](#L12574) | if (!$ai\_processing\_time\_active) { |
| [12575](#L12575) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [12576](#L12576) | $ai\_wp\_data [AI\_PROCESSING\_TIME] = false; |
| [12577](#L12577) | } |
| [12578](#L12578) | ai\_log ("PLUGINS LOADED INSTALL DST END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [12579](#L12579) | } |
| [12580](#L12580) | } |
| [12581](#L12581) | } |
| [12582](#L12582) |  |
| [12583](#L12583) |  |
| [12584](#L12584) | if (($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0) { |
| [12585](#L12585) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [12586](#L12586) | ai\_log ("INITIALIZATION END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [12587](#L12587) | } |
| [12588](#L12588) |  |
| [12589](#L12589) | // =========================================================================================== |
| [12590](#L12590) |  |
| [12591](#L12591) | // PHP class name as registered AI widget |
| [12592](#L12592) | if (!class\_exists ('ai\_widget')) { |
| [12593](#L12593) | class ai\_widget extends WP\_Widget { |
| [12594](#L12594) |  |
| [12595](#L12595) | function \_\_construct () { |
| [12596](#L12596) | parent::\_\_construct ( |
| [12597](#L12597) | false,                                  // Base ID |
| [12598](#L12598) | AD\_INSERTER\_NAME,                       // Name |
| [12599](#L12599) | array (                                 // Args |
| [12600](#L12600) | //          'classname'   => 'ai\_widget', |
| [12601](#L12601) | 'classname'   => 'block-widget', |
| [12602](#L12602) | // translators: %s: Ad Inserter |
| [12603](#L12603) | 'description' => sprintf (\_\_('%s block.', 'ad-inserter'), AD\_INSERTER\_NAME) |
| [12604](#L12604) | ) |
| [12605](#L12605) | ); |
| [12606](#L12606) | } |
| [12607](#L12607) |  |
| [12608](#L12608) | function form ($instance) { |
| [12609](#L12609) | global $block\_object; |
| [12610](#L12610) |  |
| [12611](#L12611) | // Output admin widget options form |
| [12612](#L12612) |  |
| [12613](#L12613) | $widget\_title = !empty ($instance ['widget-title']) ? $instance ['widget-title'] : ''; |
| [12614](#L12614) | $block  = isset ($instance ['block'])   ? $instance ['block']   : 1; |
| [12615](#L12615) | if ($block > 96) $block = 1; |
| [12616](#L12616) | $sticky = isset ($instance ['sticky'])  ? $instance ['sticky']  : 0; |
| [12617](#L12617) |  |
| [12618](#L12618) | // translators: widget title |
| [12619](#L12619) | if ($block == 0) $title = \_\_('Processing log', 'ad-inserter'); |
| [12620](#L12620) | // translators: widget title |
| [12621](#L12621) | elseif ($block == - 1) $title = \_\_('Dummy widget', 'ad-inserter'); |
| [12622](#L12622) | // translators: widget title |
| [12623](#L12623) | elseif ($block == - 2) $title = \_\_('Debugging tools', 'ad-inserter'); |
| [12624](#L12624) | elseif ($block >= 1) { |
| [12625](#L12625) | $obj = $block\_object [$block]; |
| [12626](#L12626) |  |
| [12627](#L12627) | $title = '[' . $block . '] ' . $obj->get\_ad\_name(); |
| [12628](#L12628) | if (!empty ($widget\_title)) $title .= ' - ' . $widget\_title; |
| [12629](#L12629) | // translators: block status (widget title) |
| [12630](#L12630) | if ($obj->get\_disable\_insertion ()) $title .= ' - ' . \_x('PAUSED', 'block', 'ad-inserter') . ' '; |
| [12631](#L12631) | if (!$obj->get\_enable\_widget ()) $title .= ' - ' . \_\_('WIDGET DISABLED', 'ad-inserter'); |
| [12632](#L12632) | } else $title = \_\_('Unknown block', 'ad-inserter'); |
| [12633](#L12633) |  |
| [12634](#L12634) | $url\_parameters = '&start=' . (intval (($block - 1) / 16) \* 16 + 1); |
| [12635](#L12635) | $settings\_page = get\_menu\_position () == AI\_SETTINGS\_SUBMENU ? 'options-general.php?page=ad-inserter.php' : 'admin.php?page=ad-inserter.php'; |
| [12636](#L12636) |  |
| [12637](#L12637) | ?> |
| [12638](#L12638) | <input id="<?php echo $this->get\_field\_id ('title'); ?>" name="<?php echo $this->get\_field\_name ('title'); ?>" type="hidden" value="<?php echo esc\_attr ($title); ?>"> |
| [12639](#L12639) |  |
| [12640](#L12640) | <p> |
| [12641](#L12641) | <label for="<?php echo $this->get\_field\_id ('widget-title'); ?>"><?php \_e('Title', 'ad-inserter'); ?>: &nbsp;</label> |
| [12642](#L12642) | <input id="<?php echo $this->get\_field\_id ('widget-title'); ?>" name="<?php echo $this->get\_field\_name ('widget-title'); ?>" type="text" value="<?php echo esc\_attr ($widget\_title); ?>" style="width: 100%;"> |
| [12643](#L12643) | </p> |
| [12644](#L12644) |  |
| [12645](#L12645) | <p> |
| [12646](#L12646) | <label for="<?php echo $this->get\_field\_id ('block'); ?>"><a href='<?php echo admin\_url ($settings\_page), $url\_parameters, "&tab=", $block; ?>' title='Click for block settings' style='text-decoration: none;'><?php \_e('Block', 'ad-inserter'); ?></a>:</label> |
| [12647](#L12647) | <select id="<?php echo $this->get\_field\_id ('block'); ?>" name="<?php echo $this->get\_field\_name('block'); ?>" style="width: 100%;"> |
| [12648](#L12648) | <?php |
| [12649](#L12649) | for ($block\_index = 1; $block\_index <= 96; $block\_index ++) { |
| [12650](#L12650) | $obj = $block\_object [$block\_index]; |
| [12651](#L12651) | ?> |
| [12652](#L12652) | <option value='<?php echo $block\_index; ?>' <?php if ($block\_index == $block) echo 'selected="selected"'; ?>><?php echo $block\_index, ' - ', $obj->get\_ad\_name(), $obj->get\_disable\_insertion () ? ' - PAUSED' : ''; ?></option> |
| [12653](#L12653) | <?php } ?> |
| [12654](#L12654) | <option value='-2' <?php if ($block == - 2) echo 'selected="selected"'; ?>><?php \_e('Debugging tools', 'ad-inserter'); ?></option> |
| [12655](#L12655) | <option value='0' <?php if ($block == 0) echo 'selected="selected"'; ?>><?php \_e('Processing log', 'ad-inserter'); ?></option> |
| [12656](#L12656) | <option value='-1' <?php if ($block == - 1) echo 'selected="selected"'; ?>><?php \_e('Dummy widget', 'ad-inserter'); ?></option> |
| [12657](#L12657) | </select> |
| [12658](#L12658) | </p> |
| [12659](#L12659) |  |
| [12660](#L12660) | <p> |
| [12661](#L12661) | <input type="hidden"   name='<?php echo $this->get\_field\_name ('sticky'); ?>' value="0" /> |
| [12662](#L12662) | <input type='checkbox' id='<?php echo $this->get\_field\_id ('sticky'); ?>' name='<?php echo $this->get\_field\_name ('sticky'); ?>' value='1' <?php if ($sticky) echo 'checked '; ?>> |
| [12663](#L12663) | <label for='<?php echo $this->get\_field\_id ('sticky'); ?>'><?php \_ex('Sticky', 'Widget', 'ad-inserter'); ?></label> |
| [12664](#L12664) | </p> |
| [12665](#L12665) | <?php |
| [12666](#L12666) | } |
| [12667](#L12667) |  |
| [12668](#L12668) | function update ($new\_instance, $old\_instance) { |
| [12669](#L12669) | // Save widget options |
| [12670](#L12670) | $instance = $old\_instance; |
| [12671](#L12671) |  |
| [12672](#L12672) | $instance ['widget-title'] = (!empty ($new\_instance ['widget-title'])) ? strip\_tags ($new\_instance ['widget-title']) : ''; |
| [12673](#L12673) | $instance ['title']   = (!empty ($new\_instance ['title'])) ?  ($new\_instance ['title']) : ''; |
| [12674](#L12674) | $instance ['block']   = (isset ($new\_instance ['block'])) ? $new\_instance ['block'] : 1; |
| [12675](#L12675) | $instance ['sticky']  = (isset ($new\_instance ['sticky'])) ? $new\_instance ['sticky'] : 0; |
| [12676](#L12676) |  |
| [12677](#L12677) | return $instance; |
| [12678](#L12678) | } |
| [12679](#L12679) |  |
| [12680](#L12680) | function widget ($args, $instance) { |
| [12681](#L12681) | global $ai\_last\_check, $ai\_wp\_data, $ai\_total\_plugin\_time; |
| [12682](#L12682) |  |
| [12683](#L12683) | $debug\_processing = ($ai\_wp\_data [AI\_WP\_DEBUGGING] & AI\_DEBUG\_PROCESSING) != 0; |
| [12684](#L12684) | if ($debug\_processing) $start\_time = microtime (true); |
| [12685](#L12685) |  |
| [12686](#L12686) | $ai\_last\_check = AI\_CHECK\_NONE; |
| [12687](#L12687) |  |
| [12688](#L12688) | $block = 0; |
| [12689](#L12689) | if ($debug\_processing) ai\_debug\_widget\_comment ('widget'); |
| [12690](#L12690) | ai\_widget\_draw ($args, $instance, $block); |
| [12691](#L12691) | if ($debug\_processing) ai\_debug\_widget\_comment ('widget', true); |
| [12692](#L12692) |  |
| [12693](#L12693) | if ($debug\_processing) { |
| [12694](#L12694) | $ai\_total\_plugin\_time += microtime (true) - $start\_time; |
| [12695](#L12695) | if ($ai\_last\_check != AI\_CHECK\_NONE) ai\_log (ai\_log\_block\_status ($block, $ai\_last\_check)); |
| [12696](#L12696) | ai\_log ("WIDGET END: ". number\_format (1000 \* (microtime (true) - $start\_time), 2)." ms\n"); |
| [12697](#L12697) | } |
| [12698](#L12698) | } |
| [12699](#L12699) | } |
| [12700](#L12700) | } |
| [12701](#L12701) |  |
| [12702](#L12702) |  |
| [12703](#L12703) | } else { |
| [12704](#L12704) | if (!function\_exists ('ai\_activation\_error')) { |
| [12705](#L12705) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [12706](#L12706) |  |
| [12707](#L12707) | function ai\_activation\_error () { |
| [12708](#L12708) | ?> |
| [12709](#L12709) | <div class="notice notice-error is-dismissible"> |
| [12710](#L12710) | <div class="ai-notice-element"> |
| [12711](#L12711) | <img src="<?php echo AD\_INSERTER\_PLUGIN\_IMAGES\_URL; ?>icon-50x50.jpg" style="width: 50px; margin: 5px 10px 0px 10px;" /> |
| [12712](#L12712) | </div> |
| [12713](#L12713) | <div class="ai-notice-element" style="width: 100%; padding: 0 10px 0;"> |
| [12714](#L12714) | <p><?php \_e("Ad Inserter can't be used while Ad Inserter Pro is active! To activate Ad Inserter you need to first deactivate Ad Inserter Pro.", 'ad-inserter'); ?></p> |
| [12715](#L12715) | <p><?php \_e("<strong>WARNING</strong>: Please note that saving settings in Ad Inserter will clear all settings that are available only in the Pro version (additional block and plugin settings)!", 'ad-inserter'); ?></p> |
| [12716](#L12716) | </div> |
| [12717](#L12717) | </div> |
| [12718](#L12718) | <?php |
| [12719](#L12719) | } |
| [12720](#L12720) |  |
| [12721](#L12721) | unset ($\_GET ['activate']); |
| [12722](#L12722) | deactivate\_plugins ('ad-inserter/ad-inserter.php'); |
| [12723](#L12723) | add\_action ('admin\_notices', 'ai\_activation\_error'); |
| [12724](#L12724) | } |
| [12725](#L12725) | } |
| [12726](#L12726) |  |
| [12727](#L12727) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/ad-inserter/trunk/ad-inserter.php?format=txt)
* [Original Format](/export/3222464/ad-inserter/trunk/ad-inserter.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_cb3b8807_20250114_195629.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D2969942%2540ad-inserter%252Ftags%252F2.7.31%26old%3D2922718%2540ad-inserter%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2922718/ad-inserter/trunk?old=2969942&old_path=%2Fad-inserter%2Ftags%2F2.7.31)

---

# Changes from [ad-inserter/trunk](/browser/ad-inserter/trunk?rev=2922718 "Show entry in browser") at [r2922718](/changeset/2922718 "Show full changeset") to [ad-inserter/tags/2.7.31](/browser/ad-inserter/tags/2.7.31?rev=2969942 "Show entry in browser") at [r2969942](/changeset/2969942 "Show full changeset")

Location:
[ad-inserter/tags/2.7.31](/browser/ad-inserter/tags/2.7.31?rev=2969942)
Files:

2 added
22 edited

* [ad-inserter.php](/browser/ad-inserter/tags/2.7.31/ad-inserter.php?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/ad-inserter.php?old=2922718&old_path=ad-inserter%2Ftrunk%2Fad-inserter.php "Show differences"))
* [class.php](/browser/ad-inserter/tags/2.7.31/class.php?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/class.php?old=2922490&old_path=ad-inserter%2Ftrunk%2Fclass.php "Show differences"))
* [constants.php](/browser/ad-inserter/tags/2.7.31/constants.php?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/constants.php?old=2922718&old_path=ad-inserter%2Ftrunk%2Fconstants.php "Show differences"))
* [css/ai-settings.css](/browser/ad-inserter/tags/2.7.31/css/ai-settings.css?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/css/ai-settings.css?old=2921043&old_path=ad-inserter%2Ftrunk%2Fcss%2Fai-settings.css "Show differences"))
* [images/pu-1.png](/browser/ad-inserter/tags/2.7.31/images/pu-1.png?rev=2969941 "Show entry in browser")
  (added)
* [images/pu-2.png](/browser/ad-inserter/tags/2.7.31/images/pu-2.png?rev=2969941 "Show entry in browser")
  (added)
* [includes/js/ai-ads.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-ads.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-ads.js?old=2884481&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-ads.js "Show differences"))
* [includes/js/ai-ads.q.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-ads.q.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-ads.q.js?old=2796746&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-ads.q.js "Show differences"))
* [includes/js/ai-ads.q.min.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-ads.q.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-ads.q.min.js?old=2796746&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-ads.q.min.js "Show differences"))
* [includes/js/ai-lists.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-lists.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-lists.js?old=2842081&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-lists.js "Show differences"))
* [includes/js/ai-lists.min.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-lists.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-lists.min.js?old=2842081&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-lists.min.js "Show differences"))
* [includes/js/ai-rotation.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-rotation.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-rotation.js?old=2850700&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-rotation.js "Show differences"))
* [includes/js/ai-rotation.min.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-rotation.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-rotation.min.js?old=2850700&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-rotation.min.js "Show differences"))
* [includes/js/ai-rotation.q.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-rotation.q.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-rotation.q.js?old=2850700&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-rotation.q.js "Show differences"))
* [includes/js/ai-rotation.q.min.js](/browser/ad-inserter/tags/2.7.31/includes/js/ai-rotation.q.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/includes/js/ai-rotation.q.min.js?old=2850700&old_path=ad-inserter%2Ftrunk%2Fincludes%2Fjs%2Fai-rotation.q.min.js "Show differences"))
* [js/ad-inserter.js](/browser/ad-inserter/tags/2.7.31/js/ad-inserter.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/js/ad-inserter.js?old=2921043&old_path=ad-inserter%2Ftrunk%2Fjs%2Fad-inserter.js "Show differences"))
* [js/ad-inserter.min.js](/browser/ad-inserter/tags/2.7.31/js/ad-inserter.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/js/ad-inserter.min.js?old=2921043&old_path=ad-inserter%2Ftrunk%2Fjs%2Fad-inserter.min.js "Show differences"))
* [js/ai-functions.js](/browser/ad-inserter/tags/2.7.31/js/ai-functions.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/js/ai-functions.js?old=2884481&old_path=ad-inserter%2Ftrunk%2Fjs%2Fai-functions.js "Show differences"))
* [js/ai-functions.min.js](/browser/ad-inserter/tags/2.7.31/js/ai-functions.min.js?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/js/ai-functions.min.js?old=2884481&old_path=ad-inserter%2Ftrunk%2Fjs%2Fai-functions.min.js "Show differences"))
* [languages/ad-inserter-sl\_SI.mo](/browser/ad-inserter/tags/2.7.31/languages/ad-inserter-sl_SI.mo?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/languages/ad-inserter-sl_SI.mo?old=2850002&old_path=ad-inserter%2Ftrunk%2Flanguages%2Fad-inserter-sl_SI.mo "Show differences"))
* [languages/ad-inserter-sl\_SI.po](/browser/ad-inserter/tags/2.7.31/languages/ad-inserter-sl_SI.po?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/languages/ad-inserter-sl_SI.po?old=2850002&old_path=ad-inserter%2Ftrunk%2Flanguages%2Fad-inserter-sl_SI.po "Show differences"))
* [languages/ad-inserter.pot](/browser/ad-inserter/tags/2.7.31/languages/ad-inserter.pot?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/languages/ad-inserter.pot?old=2907618&old_path=ad-inserter%2Ftrunk%2Flanguages%2Fad-inserter.pot "Show differences"))
* [readme.txt](/browser/ad-inserter/tags/2.7.31/readme.txt?rev=2969942 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969942/ad-inserter/tags/2.7.31/readme.txt?old=2922024&old_path=ad-inserter%2Ftrunk%2Freadme.txt "Show differences"))
* [settings.php](/browser/ad-inserter/tags/2.7.31/settings.php?rev=2969941 "Show entry in browser")
  (modified)
  ([view diffs](/changeset/2969941/ad-inserter/tags/2.7.31/settings.php?old=2921043&old_path=ad-inserter%2Ftrunk%2Fsettings.php "Show differences"))

**Changeset view not shown**, since the total size (6.2 MB) exceeds
[4.0 MB](/wiki/TracIni#changeset-max_diff_bytes-option)

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2969942&old=2922718&new_path=%2Fad-inserter%2Ftags%2F2.7.31&old_path=%2Fad-inserter%2Ftrunk)
* [Zip Archive](?format=zip&new=2969942&old=2922718&new_path=%2Fad-inserter%2Ftags%2F2.7.31&old_path=%2Fad-inserter%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


