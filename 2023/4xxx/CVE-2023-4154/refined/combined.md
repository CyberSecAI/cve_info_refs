=== Content from bugzilla.samba.org_21ee3dd5_20250115_124356.html ===


The Samba-Bugzilla – Bug 15424
CVE-2023-4154 [SECURITY] dirsync allows SYSTEM access with only "GUID\_DRS\_GET\_CHANGES" right, not "GUID\_DRS\_GET\_ALL\_CHANGES"
Last modified: 2023-10-20 09:14:24 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=15424&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=15424&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 15424**](show_bug.cgi?id=15424)
(CVE-2023-4154)
- CVE-2023-4154 [SECURITY] dirsync allows SYSTEM access with only "GUID\_DRS\_GET\_CHANGES" right, not "GUID\_DRS\_GET\_ALL\_CHANGES"

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2023-4154 [SECURITY] dirsync allows SYSTEM access with only "GUID\_DRS\_GET...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2023-4154 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Samba 4.1 and newer | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Samba 4.1 and newer "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | AD: LDB/DSDB/SAMDB ([show other bugs](buglist.cgi?component=AD%3A%20LDB%2FDSDB%2FSAMDB&product=Samba%204.1%20and%20newer&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 4.18.4 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | P5 normal ([vote](page.cgi?id=voting/user.html&bug_id=15424#vote_15424)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Jule Anger | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Samba QA Contact | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [15483](show_bug.cgi?id=15483 "RESOLVED FIXED") | |  | Show dependency [tree](showdependencytree.cgi?id=15424&hide_resolved=1) / [graph](showdependencygraph.cgi?id=15424) | |  | | Reported: | 2023-07-19 05:18 UTC by Andrew Bartlett | | --- | --- | | Modified: | 2023-10-20 09:14 UTC ([History](show_activity.cgi?id=15424)) | | CC List: | 3 users (show)  diana.della.rocchetta metze Muskaan.kalra | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**initial advisory without CVE number**](attachment.cgi?id=18025 "View the content of the attachment") (2.89 KB, text/plain)  [2023-08-04 09:15 UTC](#attach_18025 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18025&action=edit) | | [**Updated advisory without CVE**](attachment.cgi?id=18026 "View the content of the attachment") (3.20 KB, text/plain)  [2023-08-04 09:31 UTC](#attach_18026 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18026&action=edit) | | [**Updated advisory without CVE (v3)**](attachment.cgi?id=18027 "View the content of the attachment") (3.33 KB, text/plain)  [2023-08-04 09:38 UTC](#attach_18027 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18027&action=edit) | | [**draft patch for this issue**](attachment.cgi?id=18040 "View the content of the attachment") (16.80 KB, patch)  [2023-08-10 22:20 UTC](#attach_18040 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18040&action=edit) | | [**Patch for master v1**](attachment.cgi?id=18075 "View the content of the attachment") (47.66 KB, patch)  [2023-09-03 21:56 UTC](#attach_18075 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18075&action=edit) | | [**Patch for master v2**](attachment.cgi?id=18076 "View the content of the attachment") (50.37 KB, patch)  [2023-09-03 23:05 UTC](#attach_18076 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=18076&action=edit) | | [**Patch for master v5**](attachment.cgi?id=18084 "View the content of the attachment") (52.29 KB, patch)  [2023-09-08 03:25 UTC](#attach_18084 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+  abartlet: ci-passed+ | [Details](attachment.cgi?id=18084&action=edit) | | [**patch in master backported to Samba 4.19 v5**](attachment.cgi?id=18085 "View the content of the attachment") (75.34 KB, patch)  [2023-09-08 03:26 UTC](#attach_18085 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+  abartlet: ci-passed+ | [Details](attachment.cgi?id=18085&action=edit) | | [**patch in master backported to Samba 4.18 v5**](attachment.cgi?id=18086 "View the content of the attachment") (118.67 KB, patch)  [2023-09-08 03:27 UTC](#attach_18086 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+  abartlet: ci-passed+ | [Details](attachment.cgi?id=18086&action=edit) | | [**patch in master backported to Samba 4.17 v5**](attachment.cgi?id=18087 "View the content of the attachment") (125.25 KB, patch)  [2023-09-08 03:28 UTC](#attach_18087 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review-  abartlet: ci-passed+ | [Details](attachment.cgi?id=18087&action=edit) | | [**Advisory v4**](attachment.cgi?id=18088 "View the content of the attachment") (3.35 KB, text/plain)  [2023-09-08 03:30 UTC](#attach_18088 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review- | [Details](attachment.cgi?id=18088&action=edit) | | [**patch in master backported to Samba 4.16 v5**](attachment.cgi?id=18089 "View the content of the attachment") (124.20 KB, patch)  [2023-09-11 04:04 UTC](#attach_18089 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review- | [Details](attachment.cgi?id=18089&action=edit) | | [**Patch in master backported to Samba 4.16 (v5.1)**](attachment.cgi?id=18090 "View the content of the attachment") (124.23 KB, patch)  [2023-09-11 20:36 UTC](#attach_18090 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review-  abartlet: ci-passed+ | [Details](attachment.cgi?id=18090&action=edit) | | [**Patch in master backported to Samba 4.17 (v5.1)**](attachment.cgi?id=18091 "View the content of the attachment") (125.39 KB, patch)  [2023-09-11 20:48 UTC](#attach_18091 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+  abartlet: ci-passed+ | [Details](attachment.cgi?id=18091&action=edit) | | [**Updated advisory with CVE (v5)**](attachment.cgi?id=18092 "View the content of the attachment") (3.56 KB, text/plain)  [2023-09-11 21:03 UTC](#attach_18092 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+ | [Details](attachment.cgi?id=18092&action=edit) | | [**Patch in master backported to Samba 4.16 (v5.2)**](attachment.cgi?id=18098 "View the content of the attachment") (124.36 KB, patch)  [2023-09-12 20:30 UTC](#attach_18098 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+  abartlet: ci-passed+ | [Details](attachment.cgi?id=18098&action=edit) | | [Show Obsolete](#a0) (10) [View All](attachment.cgi?bugid=15424&action=viewall&hide_obsolete=1)  [Add an attachment](attachment.cgi?bugid=15424&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=15424&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=15424#c0)  Andrew Bartlett    2023-07-19 05:18:59 UTC  ``` As foreshadowed in [https://bugzilla.samba.org/show_bug.cgi?id=13556](show_bug.cgi?id=13556 "NEW - dirsync is untested and narrowly avoids security issues") dirsync has multiple potential and real issues.  A recent review shows that a user having GUID_DRS_GET_CHANGES rights, like an RODC, is still given full system privileges, as per GUID_DRS_GET_ALL_CHANGES.  We need to confirm if this really does allow such a user to read passwords.   Also, the access check looks for a specific error code of LDB_ERR_INSUFFICIENT_ACCESS_RIGHTS, any other error code, such as LDB_ERR_OPERATIONS_ERROR, appears to allow access.  We need to carefully examine, in particular around the intersection of this, [bug 13556](show_bug.cgi?id=13556 "NEW - dirsync is untested and narrowly avoids security issues") and MR <https://gitlab.com/samba-team/samba/-/merge_requests/3146> ```  [Comment 1](show_bug.cgi?id=15424#c1)  Andrew Bartlett    2023-08-03 21:09:03 UTC  ``` I have shown that Administrators and RODCs can trivially read the krbtgt key.   CVSS 3.1: AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H (7.2) ```  [Comment 2](show_bug.cgi?id=15424#c2)  Andrew Bartlett    2023-08-04 09:15:10 UTC  ``` Created [attachment 18025](attachment.cgi?id=18025 "initial advisory without CVE number") [[details]](attachment.cgi?id=18025&action=edit "initial advisory without CVE number") initial advisory without CVE number ```  [Comment 3](show_bug.cgi?id=15424#c3)  Andrew Bartlett    2023-08-04 09:29:58 UTC  ``` In terms of a fix for this, I've looked into a few different options.  One is to have a new control 'dirsync ACL checked', and to check this bypassing the ACL rules, distinct from AS_SYSTEM.  The problem with this is finding and setting all the special cases.  The other option would be to have the attribute redaction happen for all 'untrusted' requests.  However the private/ldapi socket is expected to show passwords and secrets, but is 'untrusted', being LDAP and not being trusted regarding our internal controls (mostly as there is no ABI to their behaviour at all).   So we can't make the encrypted_secrets module fail to decrypt these, for example, or always redact in acl_read for 'untrusted' searches.  I think the best and simplest solution is to instead create an 'administrator' token in dirsync, as the 'bypass all restrictions' token, this will still see (essentially) all objects but still be limited by the redaction of secrets because it won't shortcut out the top of acl_search().  The main effort remaining this is to write a clear set of tests, particularly to confirm expected behaviour around confidential attributes and attribute filters, just to be very sure we don't have any more trouble here. ```  [Comment 4](show_bug.cgi?id=15424#c4)  Andrew Bartlett    2023-08-04 09:31:06 UTC  ``` Created [attachment 18026](attachment.cgi?id=18026 "Updated advisory without CVE") [[details]](attachment.cgi?id=18026&action=edit "Updated advisory without CVE") Updated advisory without CVE  I update the advisory to mention the fail-open on the access check. ```  [Comment 5](show_bug.cgi?id=15424#c5)  Andrew Bartlett    2023-08-04 09:38:26 UTC  ``` Created [attachment 18027](attachment.cgi?id=18027 "Updated advisory without CVE (v3)") [[details]](attachment.cgi?id=18027&action=edit "Updated advisory without CVE (v3)") Updated advisory without CVE (v3)  Updated to give both CVSS lines for both variants of the issue. ```  [Comment 6](show_bug.cgi?id=15424#c6)  Andrew Bartlett    2023-08-07 04:50:05 UTC  ``` I'm thinking to only implement LDAP_DIRSYNC_OBJECT_SECURITY and not the windows 2000 variant without that.  The reason is, even if we do all the work to check if the account is not reading an object in the filtered attribute set (things an RODC should not send), we still have to redact the filter or else end up back where we started.  We have already seen the difficulty in filtering filters, and chose a safe and well tested approach for those.  We should not be trying to pre-sanitise them in a special case for DirSync.   Therefore we could ignore the absence of this flag, and most things would work just as they always had.  The DirSync sub-protocol is for the most part about public information, so the full ACL bypass was always a poor design, so it will be much safer and more internally consistent without AS_SYSTEM floating around.    If a use case exists that needs access to all objects via GUID_DRS_GET_CHANGES they can be given a broad inherited right, or just Administrator access, via the normal (and not a special override) permission. ```  [Comment 9](show_bug.cgi?id=15424#c9)  Andrew Bartlett    2023-08-10 22:20:40 UTC  ``` Created [attachment 18040](attachment.cgi?id=18040 "draft patch for this issue") [[details]](attachment.cgi?id=18040&action=edit "draft patch for this issue") draft patch for this issue ```  [Comment 12](show_bug.cgi?id=15424#c12)  Andrew Bartlett    2023-09-03 21:56:05 UTC  ``` Created [attachment 18075](attachment.cgi?id=18075 "Patch for master v1") [[details]](attachment.cgi?id=18075&action=edit "Patch for master v1") Patch for master v1  This is the patch for master, including extensive tests that show how we match MS behaviour, and where we differ.  In particular we choose only to implement the ACL semantics of OBJECT_SECURITY, we ignore any GET_CHANGES and similar rights at the per-object level (we retain support of the Windows 2000 mode only to match error codes at the start).   I do this because our ACL handling is just not set up to securely implement the original DirSync semantics, and these are quite unexpected in any case.  (This also matches our restrictive behaviour on GetNCChanges) ```  [Comment 13](show_bug.cgi?id=15424#c13)  Andrew Bartlett    2023-09-03 23:05:49 UTC  ``` Created [attachment 18076](attachment.cgi?id=18076 "Patch for master v2") [[details]](attachment.cgi?id=18076&action=edit "Patch for master v2") Patch for master v2 ```  [Comment 14](show_bug.cgi?id=15424#c14)  Andrew Bartlett    2023-09-03 23:06:56 UTC  ``` Comment on [attachment 18076](attachment.cgi?id=18076 "Patch for master v2") [[details]](attachment.cgi?id=18076&action=edit "Patch for master v2") Patch for master v2  CI passes on this except for the samba-fips job, which has a persistent unrelated failure. ```  [Comment 15](show_bug.cgi?id=15424#c15)  Jennifer Sutton    2023-09-03 23:39:08 UTC  ``` Comment on [attachment 18076](attachment.cgi?id=18076 "Patch for master v2") [[details]](attachment.cgi?id=18076&action=edit "Patch for master v2") Patch for master v2  The first commit disables two tests, namely SimpleDirsyncTests.​test_dirsync_deleted_items and SimpleDirsyncTests.​test_dirsync_linkedattributes, by moving into SimpleDirsyncTests two tests with names identical to those mentioned. I suggest renaming one or the other of each conflicting pair. ```  [Comment 16](show_bug.cgi?id=15424#c16)  Andrew Bartlett    2023-09-08 03:25:44 UTC  ``` Created [attachment 18084](attachment.cgi?id=18084 "Patch for master v5") [[details]](attachment.cgi?id=18084&action=edit "Patch for master v5") Patch for master v5 ```  [Comment 17](show_bug.cgi?id=15424#c17)  Andrew Bartlett    2023-09-08 03:26:49 UTC  ``` Created [attachment 18085](attachment.cgi?id=18085 "patch in master backported to Samba 4.19 v5") [[details]](attachment.cgi?id=18085&action=edit "patch in master backported to Samba 4.19 v5") patch in master backported to Samba 4.19 v5 ```  [Comment 18](show_bug.cgi?id=15424#c18)  Andrew Bartlett    2023-09-08 03:27:20 UTC  ``` Created [attachment 18086](attachment.cgi?id=18086 "patch in master backported to Samba 4.18 v5") [[details]](attachment.cgi?id=18086&action=edit "patch in master backported to Samba 4.18 v5") patch in master backported to Samba 4.18 v5 ```  [Comment 19](show_bug.cgi?id=15424#c19)  Andrew Bartlett    2023-09-08 03:28:18 UTC  ``` Created [attachment 18087](attachment.cgi?id=18087 "patch in master backported to Samba 4.17 v5") [[details]](attachment.cgi?id=18087&action=edit "patch in master backported to Samba 4.17 v5") patch in master backported to Samba 4.17 v5 ```  [Comment 20](show_bug.cgi?id=15424#c20)  Andrew Bartlett    2023-09-08 03:30:13 UTC  ``` Created [attachment 18088](attachment.cgi?id=18088 "Advisory v4") [[details]](attachment.cgi?id=18088&action=edit "Advisory v4") Advisory v4 ```  [Comment 21](show_bug.cgi?id=15424#c21)  Andrew Bartlett    2023-09-11 04:04:03 UTC  ``` Created [attachment 18089](attachment.cgi?id=18089 "patch in master backported to Samba 4.16 v5") [[details]](attachment.cgi?id=18089&action=edit "patch in master backported to Samba 4.16 v5") patch in master backported to Samba 4.16 v5 ```  [Comment 22](show_bug.cgi?id=15424#c22)  Stefan Metzmacher    2023-09-11 13:56:01 UTC  ``` Comment on [attachment 18087](attachment.cgi?id=18087 "patch in master backported to Samba 4.17 v5") [[details]](attachment.cgi?id=18087&action=edit "patch in master backported to Samba 4.17 v5") patch in master backported to Samba 4.17 v5  The first two commits should also be prefixed with 'CVE-2023-4154: ' ```  [Comment 23](show_bug.cgi?id=15424#c23)  Stefan Metzmacher    2023-09-11 13:58:53 UTC  ``` Comment on [attachment 18089](attachment.cgi?id=18089 "patch in master backported to Samba 4.16 v5") [[details]](attachment.cgi?id=18089&action=edit "patch in master backported to Samba 4.16 v5") patch in master backported to Samba 4.16 v5  The first two commits should be prefixed with 'CVE-2023-4154: ' and please upload patches matching the commit hash used for the ci-run, that makes it easier to review via git tools, but just fetching the related repo ```  [Comment 24](show_bug.cgi?id=15424#c24)  Stefan Metzmacher    2023-09-11 14:03:45 UTC  ``` Comment on [attachment 18088](attachment.cgi?id=18088 "Advisory v4") [[details]](attachment.cgi?id=18088&action=edit "Advisory v4") Advisory v4  This sounds very strange...  ..., the access check for this functionality will fail open on error conditions, ...  "will fail open"??? ```  [Comment 25](show_bug.cgi?id=15424#c25)  Andrew Bartlett    2023-09-11 19:12:36 UTC  ``` (In reply to Stefan Metzmacher from [comment #24](show_bug.cgi?id=15424#c24)) I'll see if can improve the wording, but yes, an out of memory is considered success in this (now deleted) codepath.  It only restricted on the access denied error. ```  [Comment 26](show_bug.cgi?id=15424#c26)  Andrew Bartlett    2023-09-11 20:36:23 UTC  ``` Created [attachment 18090](attachment.cgi?id=18090 "Patch in master backported to Samba 4.16 (v5.1)") [[details]](attachment.cgi?id=18090&action=edit "Patch in master backported to Samba 4.16 (v5.1)") Patch in master backported to Samba 4.16 (v5.1)  This patch matches what was in the CI pipeline, the commit messages have been updated. ```  [Comment 27](show_bug.cgi?id=15424#c27)  Andrew Bartlett    2023-09-11 20:48:05 UTC  ``` Created [attachment 18091](attachment.cgi?id=18091 "Patch in master backported to Samba 4.17 (v5.1)") [[details]](attachment.cgi?id=18091&action=edit "Patch in master backported to Samba 4.17 (v5.1)") Patch in master backported to Samba 4.17 (v5.1) ```  [Comment 28](show_bug.cgi?id=15424#c28)  Andrew Bartlett    2023-09-11 21:03:45 UTC  ``` Created [attachment 18092](attachment.cgi?id=18092 "Updated advisory with CVE (v5)") [[details]](attachment.cgi?id=18092&action=edit "Updated advisory with CVE (v5)") Updated advisory with CVE (v5)  I hope this advisory is clearer.   The one remaining thing I've considered is to have a script like was use in [https://bugzilla.samba.org/show_bug.cgi?id=13272](show_bug.cgi?id=13272 "RESOLVED FIXED - [SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) password") to remove this right.  It might help folks who have no RODCs sleep better.   I don't know if it is worthwhile or just cause alarm to give info on how to reset secrets etc - if a domain is impacted everything would need to be reset. ```  [Comment 29](show_bug.cgi?id=15424#c29)  Stefan Metzmacher    2023-09-12 10:11:33 UTC  ``` Comment on [attachment 18090](attachment.cgi?id=18090 "Patch in master backported to Samba 4.16 (v5.1)") [[details]](attachment.cgi?id=18090&action=edit "Patch in master backported to Samba 4.16 (v5.1)") Patch in master backported to Samba 4.16 (v5.1)  You need to upload b5310cff753e8bcbc703dd4900b4fb9349d11d74 instead of a2f53d6c3b3e8878ca0609ad2921102078ff9642 ... ```  [Comment 30](show_bug.cgi?id=15424#c30)  Andrew Bartlett    2023-09-12 20:30:28 UTC  ``` Created [attachment 18098](attachment.cgi?id=18098 "Patch in master backported to Samba 4.16 (v5.2)") [[details]](attachment.cgi?id=18098&action=edit "Patch in master backported to Samba 4.16 (v5.2)") Patch in master backported to Samba 4.16 (v5.2)  Thank you for your continued vigilance.   I've confirmed that v5.2 is the same as v5.1 except for extra CVE makers.  5.1 is a2f53d6c3b3e8878ca0609ad2921102078ff9642 and passed CI. ```  [Comment 31](show_bug.cgi?id=15424#c31)  Andrew Bartlett    2023-09-29 03:24:22 UTC  ``` Assigning to Jule for the security release. ```  [Comment 32](show_bug.cgi?id=15424#c32)  Jule Anger    2023-10-02 07:21:57 UTC  ``` Opening security bugs to vendors. Release date is currently proposed to be October 10. ```  [Comment 33](show_bug.cgi?id=15424#c33)  Jule Anger    2023-10-10 14:42:07 UTC  ``` Removing vendor CC (so that any public comments don't need to be broadcast so widely) and opening these bugs to the public. If you wish to continue to be informed about any changes here please CC individually. ```  [Comment 34](show_bug.cgi?id=15424#c34)  Samba QA Contact    2023-10-10 14:46:56 UTC  ``` This bug was referenced in samba v4-17-stable:  25585fda53fd2b6c2d7e21e7829945b51e984d07 bd5213a918edef9397ef41c1fe93d3d03264a396 e8b68aa5c9ad4ad6fbe11cdfe67d313b41326625 119ff0ef75212d21fea5147cf197ef3e53cca33d 5313a30714889ba96c68a8809a16697f99febb55 d221d0a79022b65df7eecc7b47a859b003345a0f b4849183a68c35e06f06f5b1ee2539fbfa990b29 10c4b6ea09f70aebf7cc7381e947ac49c559b27a 4cfec08d7ee7dae1bf42528b31b7c65cdd4600d4 22904d2b9dc4c0db5b7642b3dd3f44ac2fbf4247 b59a4266f1b17d9aaf1485b09db15b911b470228 8b1f1c9f90fd66c333ce1effab8ab78165266bd5 68eda471b8f4aeb64bb0e6f2dd72201e47949be7 8de964597772cbbdef8b0fd7cb0d3e71aacd698c 649bccf87ef1ad90c2a7219c59285af30ae7ba03 8a9dac9d4e52713152a085730c5d12462322f760 92a4df11b2dd696f5ba1c283602a6b3435d082ea 4c1f1fe39c6e75a377f46d2f9a60749244c1247a 4e5f060cdc3ca03cc1d6509ee9b9cdc0b24b5ca9 c0d6e6db657135f772fc2b4d1ee8b57bd50a1d54 cbd68f39d5255336ddf1559e46c841f14598d2a8 ```  [Comment 35](show_bug.cgi?id=15424#c35)  Samba QA Contact    2023-10-10 14:48:57 UTC  ``` This bug was referenced in samba v4-19-stable:  05c370c4698fc7773bceeaa97595fc0ba131c3b3 937e50b1d67a49ae7cb7ea2216b9264a5c5f53f5 c284a9229c07874a2a24d2b36061945eaef3e8e7 e46a30aa1d2c27eca57a87dfb3195abf98d00b39 e9cbf161261e7818e988c1b391dd31a5dd5e10f8 1eca806c13f250b21e6a3dd4579903d84c608b3f f70bdb46f85b5c721e0835766d2ce4a56175b3cb 56c13448d21555fde2d7e6e2903e4ef1c487f352 72248a51335d24d715fd31cf19e3de194a60ece1 ```  [Comment 36](show_bug.cgi?id=15424#c36)  Samba QA Contact    2023-10-10 14:49:07 UTC  ``` This bug was referenced in samba v4-18-stable:  fbc27662712aba02c8c99346f21d26df05d16232 d1e0ee0ba7f4ab76d8a438f9fd862474f2c970c6 13eac83bc6ef57172dc6fefbb89fafdb55791af4 563b7a566721ba4a4355b4915133c1b042ae76dc 39707a06cc562c154788328cdd60834a6920016f f29255affdfed72916114da6200d0ab517d25bf2 b56849aa64b64d1991a60ee50bae53e5569d1ceb 571d3bf48ee095dd3aca6dfd19d52854688827fc c896afcaf2f0027bc495155317666bd3bfe0a84d 939f243222e45f37f27db96bdd1502958b6e9c6c 9dade2ab67fedacf047047d2a7634945b8ee83d3 2cff332edb5516656c047483245cc14e836c68ab ee3ac4fb9af7fd9007a4bca30977a89fc2b6de45 029c47f2a4002a25a8a1f93698f3675f3d06df78 5dc5062ba28037a0a67de7887925da4726112b04 9499526ba8e3f96843bc378ba52d4adf18dbaf3a 84dcfc3b40fe9bdda61aea9942bffbd48b681643 6925e6b6051bc3e1bbac9f17fa3e29c66b956883 23c5300d0990129edd29328bfbbd86b9e24deb86 ```  [Comment 37](show_bug.cgi?id=15424#c37)  Samba QA Contact    2023-10-10 15:01:21 UTC  ``` This bug was referenced in samba v4-17-stable:  8c0be1d17a5f4e700fe38b5f58d1caa359e8c383 d7034c4194a2cec0a88870ea3c7709d2a323653a bea7fd5eadccb670d3cfc233fd5cbc6c80d5cf95 38d62aa3b2b202d2080b8814f6d9acd8bf99f226 76091f35016bd6e642237973981b1c88a9e44062 c7fba7218cd2c271e53268fc857e206aec4f98d7 60baeea804aeaf9a2ea618d14985a9b7560e03a7 d038ac36c13b5eb8f17491c9c066d3111a8f7d79 ebd421306e7b1ec37e7a477937d04a27de838cff 92cf3328a00cacb07fe7c6b7abf5335dc8235e86 2c7710bd5bc979d5fa601d2ee841592694bb14df 3c34a51da12c4b1fb446f9a384ff57cdc6019632 3de5d8a01163bfa70464d7532069ed467e4ffd10 d7ab8d4c2ea390d4d4f9be55f7072fa875457721 23b867c70bd995ca6eedcf0b72a24c043e8e7fb0 c18f819f8ce285e014cfb51279e144eb4d141d9e e0cec7f7908ecbdd6a2d9785352279416cae1ece d30349ac4cfa27c5950c54b7c083cb2c53300a0f b586f8cc9c797b3dd89d32d12921e2820dbcf1ce 4c897f5b8542ad29b51ffc9eb219fcb9eaf7754b 8f87277b4e926035d825e81c4f8381d917e9d229 ```  [Comment 38](show_bug.cgi?id=15424#c38)  Samba QA Contact    2023-10-10 15:07:44 UTC  ``` This bug was referenced in samba v4-19-stable:  52c633afa885388094e97b90d782db232f939b2f c04ec1a2f7c7f32b8eefcbd2b81786406cc52e05 b398d8af51b208cdf4c10eaae754e3e6b2a7432f ad11a8718066542593d246d3f03c1008290dc2f3 f7d30cf9df499aa4cef0f8575f97116186e357e0 93424793e594fe34ad36ab58ae2ef878798e085c c443a222ba7eb8ca7d633ff9104b0586faa85cb3 b55e2c328cdd8de9ba6044ddb25d2a5ebcafb800 1b321f4424ab677a812bf0953bbdae6bebc3c377 ```  [Comment 39](show_bug.cgi?id=15424#c39)  Samba QA Contact    2023-10-10 15:08:20 UTC  ``` This bug was referenced in samba v4-18-stable:  582f4f2e844d95e48444d2b98c7397cac32ad6d4 5ca0ee6f111e63ef92bbb8fc94b81a08b490854f e8df1a60866651678ce99d730f6a5e4bcc671b1d 704fadfb60e74bbaee41f0e37415c1f31734fb34 b65b141ed7572503fc896b5efd46b3a48ef847d1 8ebcfe5599c5540da2fdd161d5108275d22c959e 8a2b11fda30eef3883bbe9ea538dae6f68216fd9 217b30b05e24b66a427d9cc605141f917b88745c da9bdf36c357826f4dd25cf1121dfdbba3ed1dd2 7ebf51dd8b57b5932bb6f923d513e3f84c653567 570e892a0e811b1c90b7fe6b065b16591d38f7ee 8ad21108f88be4fcabc1919757eed2ed06c06fba 87ff4f57bf7a1980f2f6299115e35ab12483a150 23031057e8626e61994bf833226c196e0d966e63 3e7bdcd0e488fe0788ca537ca9894f0c4fda6be6 ebc2796a029b4dbe803457db0de9e999d1203460 9d249db44c7c8feb1c4e8719739a5cee60b25842 e691257c61813f2cf9513d149ba82b021ec824ee 4b3da3a97d1cbfd17a4eef466eb3bc1fc4887a34 ```  [Comment 40](show_bug.cgi?id=15424#c40)  Samba QA Contact    2023-10-10 15:18:22 UTC  ``` This bug was referenced in samba v4-17-test:  25585fda53fd2b6c2d7e21e7829945b51e984d07 bd5213a918edef9397ef41c1fe93d3d03264a396 e8b68aa5c9ad4ad6fbe11cdfe67d313b41326625 119ff0ef75212d21fea5147cf197ef3e53cca33d 5313a30714889ba96c68a8809a16697f99febb55 d221d0a79022b65df7eecc7b47a859b003345a0f b4849183a68c35e06f06f5b1ee2539fbfa990b29 10c4b6ea09f70aebf7cc7381e947ac49c559b27a 4cfec08d7ee7dae1bf42528b31b7c65cdd4600d4 22904d2b9dc4c0db5b7642b3dd3f44ac2fbf4247 b59a4266f1b17d9aaf1485b09db15b911b470228 8b1f1c9f90fd66c333ce1effab8ab78165266bd5 68eda471b8f4aeb64bb0e6f2dd72201e47949be7 8de964597772cbbdef8b0fd7cb0d3e71aacd698c 649bccf87ef1ad90c2a7219c59285af30ae7ba03 8a9dac9d4e52713152a085730c5d12462322f760 92a4df11b2dd696f5ba1c283602a6b3435d082ea 4c1f1fe39c6e75a377f46d2f9a60749244c1247a 4e5f060cdc3ca03cc1d6509ee9b9cdc0b24b5ca9 c0d6e6db657135f772fc2b4d1ee8b57bd50a1d54 cbd68f39d5255336ddf1559e46c841f14598d2a8 8c0be1d17a5f4e700fe38b5f58d1caa359e8c383 d7034c4194a2cec0a88870ea3c7709d2a323653a bea7fd5eadccb670d3cfc233fd5cbc6c80d5cf95 38d62aa3b2b202d2080b8814f6d9acd8bf99f226 76091f35016bd6e642237973981b1c88a9e44062 c7fba7218cd2c271e53268fc857e206aec4f98d7 60baeea804aeaf9a2ea618d14985a9b7560e03a7 d038ac36c13b5eb8f17491c9c066d3111a8f7d79 ebd421306e7b1ec37e7a477937d04a27de838cff 92cf3328a00cacb07fe7c6b7abf5335dc8235e86 2c7710bd5bc979d5fa601d2ee841592694bb14df 3c34a51da12c4b1fb446f9a384ff57cdc6019632 3de5d8a01163bfa70464d7532069ed467e4ffd10 d7ab8d4c2ea390d4d4f9be55f7072fa875457721 23b867c70bd995ca6eedcf0b72a24c043e8e7fb0 c18f819f8ce285e014cfb51279e144eb4d141d9e e0cec7f7908ecbdd6a2d9785352279416cae1ece d30349ac4cfa27c5950c54b7c083cb2c53300a0f b586f8cc9c797b3dd89d32d12921e2820dbcf1ce 4c897f5b8542ad29b51ffc9eb219fcb9eaf7754b 8f87277b4e926035d825e81c4f8381d917e9d229 ```  [Comment 41](show_bug.cgi?id=15424#c41)  Samba QA Contact    2023-10-10 15:28:29 UTC  ``` This bug was referenced in samba v4-18-test:  fbc27662712aba02c8c99346f21d26df05d16232 d1e0ee0ba7f4ab76d8a438f9fd862474f2c970c6 13eac83bc6ef57172dc6fefbb89fafdb55791af4 563b7a566721ba4a4355b4915133c1b042ae76dc 39707a06cc562c154788328cdd60834a6920016f f29255affdfed72916114da6200d0ab517d25bf2 b56849aa64b64d1991a60ee50bae53e5569d1ceb 571d3bf48ee095dd3aca6dfd19d52854688827fc c896afcaf2f0027bc495155317666bd3bfe0a84d 939f243222e45f37f27db96bdd1502958b6e9c6c 9dade2ab67fedacf047047d2a7634945b8ee83d3 2cff332edb5516656c047483245cc14e836c68ab ee3ac4fb9af7fd9007a4bca30977a89fc2b6de45 029c47f2a4002a25a8a1f93698f3675f3d06df78 5dc5062ba28037a0a67de7887925da4726112b04 9499526ba8e3f96843bc378ba52d4adf18dbaf3a 84dcfc3b40fe9bdda61aea9942bffbd48b681643 6925e6b6051bc3e1bbac9f17fa3e29c66b956883 23c5300d0990129edd29328bfbbd86b9e24deb86 582f4f2e844d95e48444d2b98c7397cac32ad6d4 5ca0ee6f111e63ef92bbb8fc94b81a08b490854f e8df1a60866651678ce99d730f6a5e4bcc671b1d 704fadfb60e74bbaee41f0e37415c1f31734fb34 b65b141ed7572503fc896b5efd46b3a48ef847d1 8ebcfe5599c5540da2fdd161d5108275d22c959e 8a2b11fda30eef3883bbe9ea538dae6f68216fd9 217b30b05e24b66a427d9cc605141f917b88745c da9bdf36c357826f4dd25cf1121dfdbba3ed1dd2 7ebf51dd8b57b5932bb6f923d513e3f84c653567 570e892a0e811b1c90b7fe6b065b16591d38f7ee 8ad21108f88be4fcabc1919757eed2ed06c06fba 87ff4f57bf7a1980f2f6299115e35ab12483a150 23031057e8626e61994bf833226c196e0d966e63 3e7bdcd0e488fe0788ca537ca9894f0c4fda6be6 ebc2796a029b4dbe803457db0de9e999d1203460 9d249db44c7c8feb1c4e8719739a5cee60b25842 e691257c61813f2cf9513d149ba82b021ec824ee 4b3da3a97d1cbfd17a4eef466eb3bc1fc4887a34 ```  [Comment 42](show_bug.cgi?id=15424#c42)  Samba QA Contact    2023-10-10 15:48:04 UTC  ``` This bug was referenced in samba master:  6578a65ed7bb8740671a10e2fcf36c48fd524c07 07d2b28fb3585c4d5366b0a8ddac9cd299aadf92 b644bb066509b4890b6e1db48160960835f53bac 76b8d3edce1f4e1a3da725b72ebc5b9508d9a120 d4a71fbece8693c8522c429f462cecfb18b607a4 0a79ed2c0b1315986b33cf3dac81f9206d4b6e1e d3d83a8f2e5367c7cb6cbb0c04ccd6e6e6d24236 cfeb9fe50e4b76063a3cddebd4190f420f1c4aca ```  [Comment 43](show_bug.cgi?id=15424#c43)  Samba QA Contact    2023-10-10 15:59:35 UTC  ``` This bug was referenced in samba v4-19-test:  05c370c4698fc7773bceeaa97595fc0ba131c3b3 937e50b1d67a49ae7cb7ea2216b9264a5c5f53f5 c284a9229c07874a2a24d2b36061945eaef3e8e7 e46a30aa1d2c27eca57a87dfb3195abf98d00b39 e9cbf161261e7818e988c1b391dd31a5dd5e10f8 1eca806c13f250b21e6a3dd4579903d84c608b3f f70bdb46f85b5c721e0835766d2ce4a56175b3cb 56c13448d21555fde2d7e6e2903e4ef1c487f352 72248a51335d24d715fd31cf19e3de194a60ece1 52c633afa885388094e97b90d782db232f939b2f c04ec1a2f7c7f32b8eefcbd2b81786406cc52e05 b398d8af51b208cdf4c10eaae754e3e6b2a7432f ad11a8718066542593d246d3f03c1008290dc2f3 f7d30cf9df499aa4cef0f8575f97116186e357e0 93424793e594fe34ad36ab58ae2ef878798e085c c443a222ba7eb8ca7d633ff9104b0586faa85cb3 b55e2c328cdd8de9ba6044ddb25d2a5ebcafb800 1b321f4424ab677a812bf0953bbdae6bebc3c377 ```  [Comment 44](show_bug.cgi?id=15424#c44)  Jule Anger    2023-10-20 09:14:24 UTC  ``` Pushed to all branches. Closing out bug report. Thanks! ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=15424)
* - [XML](show_bug.cgi?ctype=xml&id=15424)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=15424)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=15424&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=15424&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugzilla.samba.org_9a9dbcf9_20250115_124354.html ===


The Samba-Bugzilla – Bug 13556
dirsync is untested and narrowly avoids security issues
Last modified: 2018-08-15 00:53:47 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=13556&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=13556&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 13556**](show_bug.cgi?id=13556)
- dirsync is untested and narrowly avoids security issues

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
dirsync is untested and narrowly avoids security issues

| | [Status](page.cgi?id=fields.html#bug_status): | NEW | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Samba 4.1 and newer | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Samba 4.1 and newer "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | AD: LDB/DSDB/SAMDB ([show other bugs](buglist.cgi?component=AD%3A%20LDB%2FDSDB%2FSAMDB&product=Samba%204.1%20and%20newer&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | 4.9.0rc1 | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | P5 normal ([vote](page.cgi?id=voting/user.html&bug_id=13556#vote_13556)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Andrew Bartlett | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Samba QA Contact | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [CVE-2018-10919](show_bug.cgi?id=13434 "RESOLVED FIXED - [SECURITY] CVE-2018-10919 - Confidential attribute disclosure via substring search") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | Show dependency [tree](showdependencytree.cgi?id=13556&hide_resolved=1) / [graph](showdependencygraph.cgi?id=13556) | |  | | Reported: | 2018-08-02 02:15 UTC by Andrew Bartlett | | --- | --- | | Modified: | 2018-08-15 00:53 UTC ([History](show_activity.cgi?id=13556)) | | CC List: | 1 user (show)  timbeale | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=13556&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=13556&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=13556#c0)  Andrew Bartlett    2018-08-02 02:15:38 UTC  ``` A correctly functioning dirsync might have made [bug 13434](show_bug.cgi?id=13434 "RESOLVED FIXED - [SECURITY] CVE-2018-10919 - Confidential attribute disclosure via substring search") worse. ```  [Comment 1](show_bug.cgi?id=13556#c1)  Tim Beale    2018-08-02 03:35:29 UTC  ``` The dirsync code is misleading and contains dead code that is never hit (due to a single incorrect line of code). However, if this incorrect line of code were corrected, then it could turn into a security hole.  The problematic piece of code is in dirsync.c, dirsync_filter_entry() (line ~182).  	if (replMetaData == NULL) { 		bool guidfound = false;  		/* 		 * We are in the case of deleted object where we don't have the 		 * right to read it. 		 */ 		if (!ldb_msg_find_attr_as_uint(msg, "isDeleted", 0)) {  What's happening here is that acl_read.c has checked the object/attribute and determined that the user doesn't have access rights to see it. acl_read.c makes a special-case for dirsync, and instead of suppressing the search result, it strips off the replPropertyMetaData and passes the object back to dirsync to handle.  The dirsync code looks like it will then suppress non-deleted objects, and return just the objectGUID for deleted objects. However, this isn't actually happening because the check 'ldb_msg_find_attr_as_uint(msg, "isDeleted", 0)' is trying to read a boolean value (i.e. "TRUE") as an integer, which fails and falls back to the default value (zero, or not-deleted).  If this line were corrected, it opena possible security hole, i.e. it would be possible to guess the values of confidential attributes for deleted objects.  The test_search_with_dirsync_deleted_objects() test-case in confidential_attr.py should now exercise this particular behaviour (it'll fail if the code were ever corrected to return the objectGUID).  This bug might be suitable for a new samba developer (with appropriate supervision). Work involved: - First, the trivial part is to just delete the dead code. Change the 'if (replMetaData == NULL)' block to simply always returns LDB_SUCCESS (i.e. always drop the message). - Secondly, the more complicated part is to look into the interaction between acl_read.c and dirsync.c more. Is there any reason for this special replPropertyMetaData handling? I can think of reasons why we might want to do this (i.e. updating the highestUSN seen). However, it looks like the dirsync code drops these replPropertyMetaData-less results before it actually updates any of its global state. In other words, the ac->indirsync special cases in acl_read.c might be completely pointless, and could be deleted as well. ```  [Comment 2](show_bug.cgi?id=13556#c2)  Andrew Bartlett    2018-08-15 00:53:47 UTC  ``` Removing embargo now CVE-2018-10919 is public ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=13556)
* - [XML](show_bug.cgi?ctype=xml&id=13556)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=13556)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=13556&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=13556&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from bugzilla.redhat.com_0a1a64d3_20250114_222929.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2241883)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2241883)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2241883)+ Login using a Red Hat Bugzilla account
  + Forgot Password
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla – Bug 2241883

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug 2241883**](show_bug.cgi?id=2241883)
(CVE-2023-4154)
- [CVE-2023-4154](https://access.redhat.com/security/cve/CVE-2023-4154) samba: AD DC password exposure to privileged users and RODCs

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2023-4154 samba: AD DC password exposure to privileged users and RODCs

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | NEW | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2023-4154 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | medium | | [Severity:](page.cgi?id=fields.html#bug_severity) | medium | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2243230](show_bug.cgi?id=2243230 "CLOSED ERRATA - CVE-2023-4154 samba: AD DC password exposure to privileged users and RODCs [fedora-all]") | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2228383](show_bug.cgi?id=2228383) | | TreeView+ | [depends on](buglist.cgi?bug_id=2241883&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2241883&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2023-10-03 07:34 UTC by TEJ RATHI | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-12-29 04:39 UTC ([History](show_activity.cgi?id=2241883)) | | [CC List:](page.cgi?id=fields.html#cclist) | 5 users (show)  nobody pfilipen rhs-smb security-response-team stefano.biagiotti | | Fixed In Version: | samba 4.19.1, samba 4.18.8, samba 4.17.12 | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A design flaw was found in Samba's DirSync control implementation, which exposes passwords and secrets in Active Directory to privileged users and Read-Only Domain Controllers (RODCs). This flaw allows RODCs and users possessing the GET\_CHANGES right to access all attributes, including sensitive secrets and passwords. Even in a default setup, RODC DC accounts, which should only replicate some passwords, can gain access to all domain secrets, including the vital krbtgt, effectively eliminating the RODC / DC distinction. Furthermore, the vulnerability fails to account for error conditions (fail open), like out-of-memory situations, potentially granting access to secret attributes, even under low-privileged attacker influence. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: |  | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2241883#c0)  TEJ RATHI    2023-10-03 07:34:33 UTC  ``` An RODC and a user with the GET_CHANGES right can view all attributes, including secrets and passwords. In Samba's implementation of the DirSync control, Active Directory accounts authorized to do some replication, but not to replicate sensitive attributes, can instead replicate critical domain passwords and secrets.  In a default installation, this means that RODC DC accounts (which should only be permitted to replicate some passwords) can instead obtain all domain secrets, including the core AD secret: the krbtgt password.  <https://bugzilla.samba.org/show_bug.cgi?id=15424>   ```  [Comment 1](show_bug.cgi?id=2241883#c1)  TEJ RATHI    2023-10-11 10:42:42 UTC  ``` This CVE is now Public: <https://www.samba.org/samba/security/CVE-2023-4154.html>   ```  [Comment 2](show_bug.cgi?id=2241883#c2)  TEJ RATHI    2023-10-11 10:46:07 UTC  ``` Created samba tracking bugs for this issue:  Affects: fedora-all [[bug 2243230](show_bug.cgi?id=2243230 "CLOSED ERRATA - CVE-2023-4154 samba: AD DC password exposure to privileged users and RODCs [fedora-all]")]   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2241883&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from access.redhat.com_13e58132_20250115_195500.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Français](https://access.redhat.com/changeLanguage?language=fr)
* [한국어](https://access.redhat.com/changeLanguage?language=ko)
* [日本語](https://access.redhat.com/changeLanguage?language=ja)
* [中文 (中国)](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

 © 2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from gitlab.com_07c3b68f_20250115_124353.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# CVE-2018-14628: Deleted Object tombstones visible in AD LDAP to normal users (bug #13595)

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/samba-team/samba/-/merge_requests/3146.patch)
* [Plain diff](/samba-team/samba/-/merge_requests/3146.diff)

[Stefan Metzmacher](/metze) requested to merge  [samba-team/devel/samba:metze-dsacls](/samba-team/devel/samba/-/tree/metze-dsacls "samba-team/devel/samba:metze-dsacls")
 into [master](/samba-team/samba/-/tree/master "master") Jun 27, 2023

* [Overview
  13](/samba-team/samba/-/merge_requests/3146)
* [Commits
  6](/samba-team/samba/-/merge_requests/3146/commits)
* [Pipelines
  5](/samba-team/samba/-/merge_requests/3146/pipelines)
* [Changes
  13](/samba-team/samba/-/merge_requests/3146/diffs)

Expand

<https://bugzilla.samba.org/show_bug.cgi?id=13595>

## Checklist

* Commits have `Signed-off-by:` with name/author being identical to the
  commit author
* (optional) This MR is just one part towards a larger feature.
* (optional, if backport required) [Bugzilla bug filed](https://bugzilla.samba.org/enter_bug.cgi) and `BUG:`  tag added
* Test suite updated with functionality tests
* Test suite updated with negative tests
* Documentation updated
* CI timeout is [3h or higher](https://wiki.samba.org/index.php/Contribute#Change_the_1hr_default_CI_timeout) (see [Settings/CICD/General pipelines/
  Timeout](https://docs.gitlab.com/ee/ci/pipelines/settings.html#timeout))

## Reviewer's checklist:

* There is a test suite reasonably covering new functionality or
  modifications
* Function naming, parameters, return values, types, etc., are consistent
  and according to [`README.Coding.md`](https://gitlab.com/samba-team/samba/-/blob/master/README.Coding.md)
* This feature/change has adequate documentation added
* No obvious mistakes in the code

## Merge request reports

Assignee
Loading

Reviewers
Loading

Select reviewersRequest review fromLoading

Time tracking
Loading

Loading



=== Content from security.netapp.com_bdb8ccec_20250114_222930.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [October 2023 Samba Vulnerabilities in NetApp Products](https://security.netapp.com/advisory/ntap-20231124-0002)

## October 2023 Samba Vulnerabilities in NetApp Products

circle-check-alt

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20231124-0002 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20231124-0002 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20231124-0002 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20231124-0002 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20231124-0002
**Version:**
2.0

**Last updated:**
05/20/2024

**Status:**
Final.

**CVEs:** CVE-2023-3961, CVE-2023-4154, CVE-2023-4091, CVE-2023-42669, CVE-2023-42670

Overview
#### Summary

Multiple NetApp products incorporate Samba. Various versions of Samba are susceptible to vulnerabilities which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of these vulnerabilities could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

Management Services for Element Software and NetApp HCI:

Affected by CVE-2023-3961, CVE-2023-42669 and CVE-2023-42670.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2023-3961](https://nvd.nist.gov/vuln/detail/CVE-2023-3961) | 6.8 (MEDIUM) | CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:N/I:H/A:N |
| [CVE-2023-4091](https://nvd.nist.gov/vuln/detail/CVE-2023-4091) | 6.5 (MEDIUM) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N |
| [CVE-2023-4154](https://nvd.nist.gov/vuln/detail/CVE-2023-4154) | 7.5 (HIGH) | CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H |
| [CVE-2023-42669](https://nvd.nist.gov/vuln/detail/CVE-2023-42669) | 6.5 (MEDIUM) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |
| [CVE-2023-42670](https://nvd.nist.gov/vuln/detail/CVE-2023-42670) | 6.5 (MEDIUM) | CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

* Management Services for Element Software and NetApp HCI

#### Products Not Affected

* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7500N
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Insights Acquisition Unit
* Cloud Insights Storage Workload Security Agent
* Cloud Insights Telegraf Agent
* Cloud Volumes ONTAP Mediator
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/A200/2650/2620/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A700s
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200/A200/2650/2620
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* MetroCluster DataCollector
* MetroCluster Tiebreaker for clustered Data ONTAP
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node (Bootstrap OS)
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9 (formerly Clustered Data ONTAP)
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **Management Services for Element Software and NetApp HCI** | <https://mysupport.netapp.com/site/products/all/details/mgmtservices/downloads-tab/download/63086/2.25.42> |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Final.**

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20231124-0002>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20231124 | Initial Public Release |
| 2.0 | 20240520 | Management Services for Element Software and NetApp HCI added to Software Versions and Fixes, Final status |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from bugzilla.samba.org_fb4254c4_20250115_124354.html ===


The Samba-Bugzilla – Bug 13272
[SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) password
Last modified: 2021-08-31 04:02:49 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=13272&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=13272&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 13272**](show_bug.cgi?id=13272)
(CVE-2018-1057)
- [SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) password

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
[SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) p...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2018-1057 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Samba 4.1 and newer | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Samba 4.1 and newer "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | AD: LDB/DSDB/SAMDB ([show other bugs](buglist.cgi?component=AD%3A%20LDB%2FDSDB%2FSAMDB&product=Samba%204.1%20and%20newer&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All All | |  | | | [Importance](page.cgi?id=fields.html#importance): | P5 critical ([vote](page.cgi?id=voting/user.html&bug_id=13272#vote_13272)) | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Ralph Böhme | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Samba QA Contact | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [13271](show_bug.cgi?id=13271 "RESOLVED FIXED") | |  | Show dependency [tree](showdependencytree.cgi?id=13272&hide_resolved=1) / [graph](showdependencygraph.cgi?id=13272) | |  | | Reported: | 2018-02-14 10:17 UTC by Björn Baumbach | | --- | --- | | Modified: | 2021-08-31 04:02 UTC ([History](show_activity.cgi?id=13272)) | | CC List: | 17 users (show)  aaptel abartlet asn carnil dbagnall dmulder garming gary huzaifas jra kseeger meissner metze npower sathieu scabrero slow | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [**CVE-2018-1057-master.metze01.patches.txt**](attachment.cgi?id=13977 "View the content of the attachment") (31.51 KB, text/plain)  [2018-02-23 13:14 UTC](#attach_13977 "Go to the comment associated with the attachment"), Stefan Metzmacher | metze: review+  metze: review? (slow) metze: review? (abartlet) | [Details](attachment.cgi?id=13977&action=edit) | | [**Proposed advisory text**](attachment.cgi?id=13978 "View the content of the attachment") (1.59 KB, text/plain)  [2018-02-23 14:48 UTC](#attach_13978 "Go to the comment associated with the attachment"), Ralph Böhme | *no flags* | [Details](attachment.cgi?id=13978&action=edit) | | [**CVE-2018-1057-v4-8.metze01.patches.txt**](attachment.cgi?id=14008 "View the content of the attachment") (31.51 KB, patch)  [2018-03-01 12:25 UTC](#attach_14008 "Go to the comment associated with the attachment"), Stefan Metzmacher | slow: review+  metze: review? (abartlet) | [Details](attachment.cgi?id=14008&action=edit) | | [**CVE-2018-1057-v4-7.metze01.patches.txt**](attachment.cgi?id=14009 "View the content of the attachment") (31.51 KB, patch)  [2018-03-01 12:26 UTC](#attach_14009 "Go to the comment associated with the attachment"), Stefan Metzmacher | slow: review+  metze: review? (abartlet) | [Details](attachment.cgi?id=14009&action=edit) | | [**CVE-2018-1057-v4-6.metze01.patches.txt**](attachment.cgi?id=14010 "View the content of the attachment") (31.64 KB, patch)  [2018-03-01 12:26 UTC](#attach_14010 "Go to the comment associated with the attachment"), Stefan Metzmacher | slow: review+  metze: review? (abartlet) | [Details](attachment.cgi?id=14010&action=edit) | | [**CVE-2018-1057-v4-5.metze01.patches.txt**](attachment.cgi?id=14011 "View the content of the attachment") (31.65 KB, patch)  [2018-03-01 12:27 UTC](#attach_14011 "Go to the comment associated with the attachment"), Stefan Metzmacher | slow: review+  abartlet: review+ | [Details](attachment.cgi?id=14011&action=edit) | | [**Proposed advisory text**](attachment.cgi?id=14016 "View the content of the attachment") (4.05 KB, text/plain)  [2018-03-02 16:46 UTC](#attach_14016 "Go to the comment associated with the attachment"), Ralph Böhme | *no flags* | [Details](attachment.cgi?id=14016&action=edit) | | [**script to disable password changes by others**](attachment.cgi?id=14028 "View the content of the attachment") (4.04 KB, text/plain)  [2018-03-09 07:04 UTC](#attach_14028 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14028&action=edit) | | [**CVE-2018-1057-description.metze04.txt**](attachment.cgi?id=14029 "View the content of the attachment") (2.40 KB, text/plain)  [2018-03-11 22:19 UTC](#attach_14029 "Go to the comment associated with the attachment"), Stefan Metzmacher | abartlet: review+ | [Details](attachment.cgi?id=14029&action=edit) | | [**CVE-2018-1057-wiki.metze01.txt**](attachment.cgi?id=14030 "View the content of the attachment") (2.85 KB, text/plain)  [2018-03-11 22:26 UTC](#attach_14030 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14030&action=edit) | | [**Updated workaround script, lightly tested**](attachment.cgi?id=14031 "View the content of the attachment") (6.71 KB, text/plain)  [2018-03-11 22:28 UTC](#attach_14031 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14031&action=edit) | | [**Updated workaround script, lightly tested, using metze's guid**](attachment.cgi?id=14032 "View the content of the attachment") (6.71 KB, text/plain)  [2018-03-11 23:16 UTC](#attach_14032 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14032&action=edit) | | [**proposed wiki text describing how to run the script**](attachment.cgi?id=14033 "View the content of the attachment") (4.58 KB, text/plain)  [2018-03-12 03:31 UTC](#attach_14033 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14033&action=edit) | | [**CVE-2018-1057-description.metze04.ks.txt**](attachment.cgi?id=14034 "View the content of the attachment") (2.40 KB, text/plain)  [2018-03-12 08:50 UTC](#attach_14034 "Go to the comment associated with the attachment"), Karolin Seeger | metze: review+ | [Details](attachment.cgi?id=14034&action=edit) | | [**samba\_CVE-2018-1057\_helper**](attachment.cgi?id=14035 "View the content of the attachment") (6.65 KB, text/x-python)  [2018-03-12 17:14 UTC](#attach_14035 "Go to the comment associated with the attachment"), Stefan Metzmacher | abartlet: review+ | [Details](attachment.cgi?id=14035&action=edit) | | [**Improved wiki text**](attachment.cgi?id=14036 "View the content of the attachment") (6.83 KB, text/plain)  [2018-03-13 03:45 UTC](#attach_14036 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14036&action=edit) | | [**CVE-2018-1057-description.metze04.ks\_v2.txt**](attachment.cgi?id=14038 "View the content of the attachment") (2.40 KB, text/plain)  [2018-03-13 07:53 UTC](#attach_14038 "Go to the comment associated with the attachment"), Karolin Seeger | *no flags* | [Details](attachment.cgi?id=14038&action=edit) | | [**CVE-2018-1057-description.abartlet05.txt**](attachment.cgi?id=14039 "View the content of the attachment") (2.49 KB, text/plain)  [2018-03-13 08:23 UTC](#attach_14039 "Go to the comment associated with the attachment"), Andrew Bartlett | kseeger: review+  abartlet: review? (metze) | [Details](attachment.cgi?id=14039&action=edit) | | [**Wiki text containing link to advisory and helper script**](attachment.cgi?id=14040 "View the content of the attachment") (7.24 KB, text/plain)  [2018-03-13 08:32 UTC](#attach_14040 "Go to the comment associated with the attachment"), Karolin Seeger | *no flags* | [Details](attachment.cgi?id=14040&action=edit) | | [**Wiki text containing link to advisory and helper script**](attachment.cgi?id=14041 "View the content of the attachment") (7.27 KB, text/plain)  [2018-03-13 08:39 UTC](#attach_14041 "Go to the comment associated with the attachment"), Andrew Bartlett | metze: review+ | [Details](attachment.cgi?id=14041&action=edit) | | [**CVE-2018-1057-v4-4.metze01.patches.txt**](attachment.cgi?id=14042 "View the content of the attachment") (31.58 KB, patch)  [2018-03-13 09:31 UTC](#attach_14042 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14042&action=edit) | | [**CVE-2018-1057-v4-3.metze01.patches.txt**](attachment.cgi?id=14043 "View the content of the attachment") (31.58 KB, patch)  [2018-03-13 09:31 UTC](#attach_14043 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14043&action=edit) | | [**CVE-2018-1057-v4-4.metze02.patches.txt**](attachment.cgi?id=14044 "View the content of the attachment") (31.56 KB, patch)  [2018-03-13 10:52 UTC](#attach_14044 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14044&action=edit) | | [**CVE-2018-1057-v4-3.metze02.patches.txt**](attachment.cgi?id=14045 "View the content of the attachment") (31.56 KB, patch)  [2018-03-13 10:53 UTC](#attach_14045 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14045&action=edit) | | [**Script with the str(msg.dn) workaround for 4.3 -> 4.6**](attachment.cgi?id=14047 "View the content of the attachment") (6.89 KB, text/x-python)  [2018-03-14 02:38 UTC](#attach_14047 "Go to the comment associated with the attachment"), Andrew Bartlett | *no flags* | [Details](attachment.cgi?id=14047&action=edit) | | [**samba\_CVE-2018-1057\_helper (tested with 4.3, 4.6 and 4.7)**](attachment.cgi?id=14048 "View the content of the attachment") (6.83 KB, text/x-python)  [2018-03-14 10:57 UTC](#attach_14048 "Go to the comment associated with the attachment"), Stefan Metzmacher | *no flags* | [Details](attachment.cgi?id=14048&action=edit) | | [Show Obsolete](#a0) (16) [View All](attachment.cgi?bugid=13272&action=viewall&hide_obsolete=1)  [Add an attachment](attachment.cgi?bugid=13272&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=13272&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=13272#c0)  Björn Baumbach    2018-02-14 10:17:20 UTC   [Comment 1](show_bug.cgi?id=13272#c1)  Björn Baumbach    2018-02-14 10:42:44 UTC  ``` Unprivileged AD users can change any user (and also the Administrator) password without the need to specify the old user password.  Ralph and Metze are currently working on the fix.  Here is an example where a new user "iamnotpriviliged" changes the Administrator's password:  # samba-tool user create iamnotpriviliged --password=Passw0rd1  # samba-tool user setpassword Administrator --newpassword=Passw0rd Changed password OK  # echo IgBHAEAAYQBuAHoARwBlAGgAZQBpAG0AIgA= | base64 -d "G@anzGeheim"  # ldapmodify -D CN=iamnotpriviliged,CN=Users,DC=dxdom,DC=private -w Passw0rd1 -h bb-xenial64.dxdom.private -x -ZZ <<EOF dn: CN=Administrator,CN=Users,DC=dxdom,DC=private changetype: modify delete: unicodePwd - add: unicodePwd unicodePwd:: IgBHAEAAYQBuAHoARwBlAGgAZQBpAG0AIgA= EOF modifying entry "CN=Administrator,CN=Users,DC=dxdom,DC=private"  # wbinfo -a DXDOM\\Administrator%G@anzGeheim plaintext password authentication succeeded challenge/response password authentication succeeded ```  [Comment 2](show_bug.cgi?id=13272#c2)  Ralph Böhme    2018-02-19 13:53:43 UTC  ``` This has been assigned CVE-2018-1057 by Red Hat Product Security. ```  [Comment 3](show_bug.cgi?id=13272#c3)  Stefan Metzmacher    2018-02-23 13:14:16 UTC  ``` Created [attachment 13977](attachment.cgi?id=13977 "CVE-2018-1057-master.metze01.patches.txt") [[details]](attachment.cgi?id=13977&action=edit "CVE-2018-1057-master.metze01.patches.txt") CVE-2018-1057-master.metze01.patches.txt ```  [Comment 4](show_bug.cgi?id=13272#c4)  Ralph Böhme    2018-02-23 14:48:54 UTC  ``` Created [attachment 13978](attachment.cgi?id=13978 "Proposed advisory text") [[details]](attachment.cgi?id=13978&action=edit "Proposed advisory text") Proposed advisory text ```  [Comment 5](show_bug.cgi?id=13272#c5)  Andrew Bartlett    2018-02-23 18:50:00 UTC  ``` (In reply to Ralph Böhme from [comment #4](show_bug.cgi?id=13272#c4)) Can the krbtgt key be changed?  If so, it might not be detected because:  - no human uses it directly  - each KDC only checks the current value in the directory (then one that is changed)  If that key is changed (and so known) this could allow long-term compromise of the directory even after the issue is patched. ```  [Comment 6](show_bug.cgi?id=13272#c6)  Andrew Bartlett    2018-02-23 19:44:43 UTC  ``` Thankfully direct change of the krbtgt is blocked (a test would be good), but could be vectored via a domain admin reset:  (from password_hash.c)  	if (io->u.is_krbtgt) { 		size_t min = 196; 		size_t max = 255; 		size_t diff = max - min; 		size_t len = max; 		struct ldb_val *krbtgt_utf16 = NULL;  		if (!ac->pwd_reset) { 			return dsdb_module_werror(ac->module, 					LDB_ERR_ATTRIBUTE_OR_VALUE_EXISTS, 					WERR_DS_ATT_ALREADY_EXISTS, 					"Password change on krbtgt not permitted!"); 		} ```  [Comment 7](show_bug.cgi?id=13272#c7)  Garming Sam    2018-02-26 04:34:30 UTC  ``` I've taken a look at the patches, and so far they seem reasonable and cover the cases I expect.  I did notice one thing though, you seem to be able to mix and match the different password attributes. e.g. delete: userPassword + add: unicodePwd  As far as I have tested, supplying an differing attribute for the old password (to the new password) still generates the hashes (and checks them) as required. It's an odd behavior, and I would wonder what behavior Windows does in this case. ```  [Comment 10](show_bug.cgi?id=13272#c10)  Andrew Bartlett    2018-02-26 22:53:12 UTC  ``` I think we should extend the workaround section with an actual command that would block the password changes, and another to undo that.   We should also clarify that banning changes by other means (like setting a minimum password age) won't be effective and why (that machine accounts, of a DC in particular, could still be changed). ```  [Comment 11](show_bug.cgi?id=13272#c11)  Stefan Metzmacher    2018-02-27 05:59:02 UTC  ``` Comment on [attachment 13977](attachment.cgi?id=13977 "CVE-2018-1057-master.metze01.patches.txt") [[details]](attachment.cgi?id=13977&action=edit "CVE-2018-1057-master.metze01.patches.txt") CVE-2018-1057-master.metze01.patches.txt  This passed a private autobuild ```  [Comment 12](show_bug.cgi?id=13272#c12)  Stefan Metzmacher    2018-02-27 16:31:18 UTC  ``` (In reply to Andrew Bartlett from [comment #10](show_bug.cgi?id=13272#c10))  The problem is that we don't have tools implement the workaround. If you have a good text we can take that, otherwise we could also say no workaround is possible. ```  [Comment 13](show_bug.cgi?id=13272#c13)  Stefan Metzmacher    2018-02-27 16:37:50 UTC  ``` (In reply to Andrew Bartlett from [comment #6](show_bug.cgi?id=13272#c6))  > if (!ac->pwd_reset) {  In the problematic case we have pwd_reset=true, so that code doesn't protect, but further down we have generate_secret_buffer() to generate a new password instead of using the provides one.  But if someone knows the administrator password the krbtgt key can be fetched easily. ```  [Comment 14](show_bug.cgi?id=13272#c14)  Ralph Böhme    2018-02-28 11:36:12 UTC  ``` (In reply to Stefan Metzmacher from [comment #12](show_bug.cgi?id=13272#c12)) Whatever we do, it would be good to have something asap as we should probably roll the security fix into 4.8.0, so the security releases must be at the same date as the scheduled 4.8.0 release which is next Thursday.  I'm in favour of keeping the generic workaround description. ```  [Comment 15](show_bug.cgi?id=13272#c15)  Andrew Bartlett    2018-02-28 23:57:30 UTC  ``` (In reply to Ralph Böhme from [comment #14](show_bug.cgi?id=13272#c14)) While we debate the exact wording, can we get backported patches (if required) and open it up to vendors?  I don't like the current wording, I think we really need a script that implements the workaround and a listing of the most obvious not-workarounds (like minimum password age).   I ask for this because I'm pretty sure we as a team will be asked for it anyway.  But I also understand the time and resource constraints, and there is a risk even sitting on these patches. ```  [Comment 16](show_bug.cgi?id=13272#c16)  Stefan Metzmacher    2018-03-01 12:25:35 UTC  ``` Created [attachment 14008](attachment.cgi?id=14008 "CVE-2018-1057-v4-8.metze01.patches.txt") [[details]](attachment.cgi?id=14008&action=edit "CVE-2018-1057-v4-8.metze01.patches.txt") CVE-2018-1057-v4-8.metze01.patches.txt ```  [Comment 17](show_bug.cgi?id=13272#c17)  Stefan Metzmacher    2018-03-01 12:26:13 UTC  ``` Created [attachment 14009](attachment.cgi?id=14009 "CVE-2018-1057-v4-7.metze01.patches.txt") [[details]](attachment.cgi?id=14009&action=edit "CVE-2018-1057-v4-7.metze01.patches.txt") CVE-2018-1057-v4-7.metze01.patches.txt ```  [Comment 18](show_bug.cgi?id=13272#c18)  Stefan Metzmacher    2018-03-01 12:26:46 UTC  ``` Created [attachment 14010](attachment.cgi?id=14010 "CVE-2018-1057-v4-6.metze01.patches.txt") [[details]](attachment.cgi?id=14010&action=edit "CVE-2018-1057-v4-6.metze01.patches.txt") CVE-2018-1057-v4-6.metze01.patches.txt ```  [Comment 19](show_bug.cgi?id=13272#c19)  Stefan Metzmacher    2018-03-01 12:27:44 UTC  ``` Created [attachment 14011](attachment.cgi?id=14011 "CVE-2018-1057-v4-5.metze01.patches.txt") [[details]](attachment.cgi?id=14011&action=edit "CVE-2018-1057-v4-5.metze01.patches.txt") CVE-2018-1057-v4-5.metze01.patches.txt ```  [Comment 20](show_bug.cgi?id=13272#c20)  Stefan Metzmacher    2018-03-01 19:29:28 UTC  ``` (In reply to Andrew Bartlett from [comment #15](show_bug.cgi?id=13272#c15))  If you have the resources to write such a script, it's highly welcome:-) ```  [Comment 21](show_bug.cgi?id=13272#c21)  Mathieu Parent    2018-03-01 19:59:00 UTC  ``` I hope this will apply down to 4.2 (in Debian jessie, we have 4.2.14+patches). ```  [Comment 22](show_bug.cgi?id=13272#c22)  Andrew Bartlett    2018-03-01 21:17:07 UTC  ``` (In reply to Mathieu Parent from [comment #21](show_bug.cgi?id=13272#c21)) No, the patches do not apply cleanly.  Two of the patches do not apply.  (And keen as I am to help, I can't promise to do the backport right now).  Sorry.   (In reply to Stefan Metzmacher from [comment #19](show_bug.cgi?id=13272#c19)) Have these backported patches passed private autobuilds yet?  Thanks,   (In reply to Stefan Metzmacher from [comment #20](show_bug.cgi?id=13272#c20)) I do realise that is the most reasonable thing.  I didn't want to promise but it is clearly the next step to take here.    Sorry,  Andrew Bartlett ```  [Comment 23](show_bug.cgi?id=13272#c23)  Stefan Metzmacher    2018-03-01 21:22:43 UTC  ``` (In reply to Andrew Bartlett from [comment #22](show_bug.cgi?id=13272#c22))  Yes, I combined them with the patches for CVE-2018-1050 and run private autobuilds with v4-5-test, v4-6-stable, v4-7-stable, v4-8-test and master from a few days back. ```  [Comment 24](show_bug.cgi?id=13272#c24)  Ming Chan    2018-03-02 02:26:22 UTC  ``` Proposing embargo lift date: 3/19/2018 ```  [Comment 25](show_bug.cgi?id=13272#c25)  Andrew Bartlett    2018-03-02 07:40:02 UTC  ``` Comment on [attachment 14011](attachment.cgi?id=14011 "CVE-2018-1057-v4-5.metze01.patches.txt") [[details]](attachment.cgi?id=14011&action=edit "CVE-2018-1057-v4-5.metze01.patches.txt") CVE-2018-1057-v4-5.metze01.patches.txt  I've checked the patch, it is a direct backport of the one Garming went over with a fine toothed comb for master.   I've run the test, and it passes, but more importantly it fails when the fixing patches are removed.  I've also looked over the logic and I'm happy with that (it is still over-complex however, something we may wish to address in the long term).   Thank you to everyone who has worked so hard on this! ```  [Comment 26](show_bug.cgi?id=13272#c26)  Andrew Bartlett    2018-03-02 07:47:52 UTC  ``` I know folks like to ask for the CVSS v3 Vector, so here is what I came up with:  AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C   CVSS Base Score:     8.8 Impact Subscore:     5.9 Exploitability Subscore:     2.8 CVSS Temporal Score:     8.2 CVSS Environmental Score:     NA Modified Impact Subscore:     NA Overall CVSS Score:     8.2   <https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H/E:F/RL:O/RC:C> ```  [Comment 27](show_bug.cgi?id=13272#c27)  Ralph Böhme    2018-03-02 16:46:54 UTC  ``` Created [attachment 14016](attachment.cgi?id=14016 "Proposed advisory text") [[details]](attachment.cgi?id=14016&action=edit "Proposed advisory text") Proposed advisory text  What about this one? ```  [Comment 28](show_bug.cgi?id=13272#c28)  John Hixson (mail undeliverable)    2018-03-02 22:10:21 UTC  ``` On Thu, Mar 01, 2018 at 07:28:02PM +0000, samba-bugs@samba.org wrote: > [https://bugzilla.samba.org/show_bug.cgi?id=13272](show_bug.cgi?id=13272 "RESOLVED FIXED - [SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) password")  "You are not authorized to access [bug #13272](show_bug.cgi?id=13272 "RESOLVED FIXED - [SECURITY] CVE-2018-1057: Unprivileged user can change any user (and admin) password")".   - John  >  > Stefan Metzmacher <metze@samba.org> changed: >  >            What    |Removed                     |Added > ---------------------------------------------------------------------------- >                  CC|                            |samba-vendor@samba.org >               Group|samba-devel                 |samba-vendor >  > --  > You are receiving this mail because: > You are on the CC list for the bug. > ```  [Comment 29](show_bug.cgi?id=13272#c29)  Stefan Metzmacher    2018-03-04 21:26:31 UTC  ``` The planed release date is March 13th. ```  [Comment 30](show_bug.cgi?id=13272#c30)  Andrew Bartlett    2018-03-06 08:15:24 UTC  ``` (In reply to Ralph Böhme from [comment #27](show_bug.cgi?id=13272#c27)) Honestly, I don't like it either, but even with the high priority this has I've not been able to find the time to write something more automated and so less error prone than ldbedit.  How about this:  We pull this out of the advisory and into a wiki page to be debated here but published on the day.  That way packages can be created etc without blocking on a possible workaround (or not), and advise can be updated after the release. ```  [Comment 31](show_bug.cgi?id=13272#c31)  Andrew Bartlett    2018-03-08 11:09:58 UTC  ``` We don't need a website, and certainly not a theme tune, but letting administrators know they need to be ready to patch any AD DC would be handy given we don't have good mitigations.   What do folks think about a pre-announcement?  I ask here because it impacts vendors too (both ways: concerned customers but also prepared customers).   On mitigations: I spoke with (vendor) Tranquil IT today and they are going to play with some mitigation ideas I had but didn't get a chance to test.  Those are:   setting 'check password script' to bin/false.  Not a total cure, as DC accounts can still be changed, but those are harder to abuse than administrator.   setting 'server services = -ldap'.  Quite drastic but perhaps keeping the KDC and netlogon service up might be enough for some use cases for a short time.   Thanks,  Andrew Bartlett ```  [Comment 32](show_bug.cgi?id=13272#c32)  Stefan Metzmacher    2018-03-08 12:54:57 UTC  ``` (In reply to Andrew Bartlett from [comment #31](show_bug.cgi?id=13272#c31))  We did a pre-announcement before, see <https://lists.samba.org/archive/samba-announce/2017/000405.html>  Should we just take the similar text, like:    this is a heads-up that there will be important Samba security updates   on Wednesday, March 13th (~ 8-11am UTC). Please make sure that your Samba   servers will be updated immediately after the release!  If there are no objections I'll post this tomorrow. ```  [Comment 33](show_bug.cgi?id=13272#c33)  Arvid Requate    2018-03-08 13:24:21 UTC  ``` Tuesday, March 13th ```  [Comment 34](show_bug.cgi?id=13272#c34)  Stefan Metzmacher    2018-03-08 13:28:03 UTC  ``` (In reply to Arvid Requate from [comment #33](show_bug.cgi?id=13272#c33))  Thanks!    this is a heads-up that there will be important Samba security updates   on Tuesday, March 13th (~ 8-11am UTC). Please make sure that your Samba   servers will be updated immediately after the release! ```  [Comment 35](show_bug.cgi?id=13272#c35)  Andrew Bartlett    2018-03-09 00:18:41 UTC  ``` (In reply to Andrew Bartlett from [comment #31](show_bug.cgi?id=13272#c31))  The most effective, easy to enable and disable, short-term mitigation I could find is setting a minimum password length:  Show the existing settings:  # bin/samba-tool domain passwordsettings show -s st/ad_dc/etc/smb.conf  Password informations for domain 'DC=addom,DC=samba,DC=example,DC=com'  Password complexity: on Store plaintext passwords: off Password history length: 24 Minimum password length: 7 Minimum password age (days): 1 Maximum password age (days): 42 Account lockout duration (mins): 30 Account lockout threshold (attempts): 0 Reset account lockout after (mins): 30  Create a pwsettings.ldif file with:  dn: dc=addom,dc=samba,dc=example,dc=com changetype: modify replace: minPwdLength minPwdLength: 2147483639 -  Run this to set the 2GB min pw length.  This is protective as parts of Samba refuse to allocate more than 256MB at a time.  # bin/ldbmodify -H st/ad_dc/private/sam.ldb pwsettings.ldif Modified 1 records successfully  This only needs to be done on one DC, it will replicate and disable password changes or resets.  This shows it has been set: # bin/samba-tool domain passwordsettings show -s st/ad_dc/etc/smb.conf  Password informations for domain 'DC=addom,DC=samba,DC=example,DC=com'  Password complexity: on Store plaintext passwords: off Password history length: 24 Minimum password length: 2147483639 Minimum password age (days): 1 Maximum password age (days): 42 Account lockout duration (mins): 30 Account lockout threshold (attempts): 0 Reset account lockout after (mins): 30  # This shows it works:  bin/ldbmodify -H ldap://$SERVER -Uunpriv%$PASSWORD pwreset.ldif  ERR: (Constraint violation) "LDAP error 19 LDAP_CONSTRAINT_VIOLATION -  <0000052D: Constraint violation - check_password_restrictions: the password is too short. It should be equal or longer than 2147483639 characters!> <>" on DN cn=administrator,cn=users,dc=addom,dc=samba,dc=example,dc=com at block before line 6 Modify failed after processing 0 records   This shows how to undo it:  # bin/samba-tool domain passwordsettings set -s st/ad_dc/etc/smb.conf  --min-pwd-length=7  This still only applies to user accounts, but those (administrator) are the easiest to attack.    Note that other accounts (DC accounts in particular) can also modify the domain or read passwords, but need more complex tools.   Andrew Bartlett ```  [Comment 36](show_bug.cgi?id=13272#c36)  Andrew Bartlett    2018-03-09 03:33:29 UTC  ``` (In reply to Ralph Böhme from [comment #27](show_bug.cgi?id=13272#c27))  I'm writing the tool I promised, but in the meantime I think the text should say to change OA to OD on the ACE, not remove it.    I've tested this and it is effective (OD is object deny) and is easier to reverse later (as you don't have to search for the D: part rather than the S: part). ```  [Comment 37](show_bug.cgi?id=13272#c37)  Andrew Bartlett    2018-03-09 07:04:40 UTC  ``` Created [attachment 14028](attachment.cgi?id=14028 "script to disable password changes by others") [[details]](attachment.cgi?id=14028&action=edit "script to disable password changes by others") script to disable password changes by others  Attached is the first draft of the script I promised  Goal ----  It implementing the workaround that Ralph suggests in the current advisory, but modified in the way I suggested earlier, that is to just change the OA (object allow) to OD (object deny).  Unlike the approach described earlier, this should not block normal password changes, but I need to verify this tomorrow.  In particular I don't expect SAMR, or Kerberos password changes to be impacted, and I've already checked that machine account changes are unaffected.  Also un-impacted should be if the LDAP user connecting at Bind time is the LDAP user changing the password.    (The reason the difference is even allowed is to allow a change of a expired password)   The actual script: ------------------  However as a general principle I also need review of the script, particularly as ACL changes are weird in Samba.  Beyond review, if anyone has the resources to test this out, please do, this is likely to be run extensively early next week.   The script should run against older Samba versions without modification, so can provide a workaround until the server binaries are patched.   To lock # source4/scripting/bin/samba_CVE-2018-1057_helper --lock-pwchange -s st/ad_dc/etc/smb.conf  To unlock # source4/scripting/bin/samba_CVE-2018-1057_helper --unlock-pwchange -s st/ad_dc/etc/smb.conf  Thanks! ```  [Comment 38](show_bug.cgi?id=13272#c38)  Stefan Metzmacher    2018-03-09 07:48:20 UTC  ``` (In reply to Andrew Bartlett from [comment #37](show_bug.cgi?id=13272#c37))  Hi Andrew,  the OD trick is nice!  I'll have a closer look at the script and may extend it to also change the defaultSecurityDescriptor attributes in the schema, so that new accounts will also get this.  I think the maximum password age should also be changed to something very high, so that it can't happen that a user is unable to change an expired password. ```  [Comment 39](show_bug.cgi?id=13272#c39)  Stefan Metzmacher    2018-03-09 16:31:39 UTC  ``` (In reply to Stefan Metzmacher from [comment #34](show_bug.cgi?id=13272#c34))  The "Heads-up" is out, see <https://lists.samba.org/archive/samba-announce/2018/000434.html> <https://lists.samba.org/archive/samba/2018-March/214321.html> <https://lists.samba.org/archive/samba-technical/2018-March/126171.html> ```  [Comment 40](show_bug.cgi?id=13272#c40)  Andrew Bartlett    2018-03-09 18:27:02 UTC  ``` (In reply to Stefan Metzmacher from [comment #38](show_bug.cgi?id=13272#c38))  OK, so what you are saying is to add some text like this:  "While rare, and not used by windows clients by default, if your network does rely on the *LDAP the password change protocol*, you may consider to set a high maximum password age so that passwords do not expire while you are mitigating this issue".  And thanks for the positive feedback on the script, and the defaultSecurityDescriptor point!  For others following along, the reason to flip OA to OD is that is makes it quite trivial to flip back, however I think we also need to flip the GUID to something we make up.    Reading this on ACE ordering again in the NZ morning, I think this will actually deny all LDAP password changes, even for self:    [https://msdn.microsoft.com/en-us/library/windows/desktop/aa379298(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa379298%28v%3Dvs.85%29.aspx)  But if we change the GUID it would just be a meaningless ACE, useful only as the marker and so closer to Ralph's mitigation.   Thanks,  Andrew Bartlett ```  [Comment 41](show_bug.cgi?id=13272#c41)  Stefan Metzmacher    2018-03-09 18:41:18 UTC  ``` (In reply to Andrew Bartlett from [comment #40](show_bug.cgi?id=13272#c40))  Yes, I guess we can just exchange the GUID.  I was too busy to try the defaultSecurityDescriptor thing. ```  [Comment 42](show_bug.cgi?id=13272#c42)  Stefan Metzmacher    2018-03-09 18:43:22 UTC  ``` (In reply to Stefan Metzmacher from [comment #41](show_bug.cgi?id=13272#c41))  I mean keep OA and just change the GUID... ```  [Comment 43](show_bug.cgi?id=13272#c43)  Andrew Bartlett    2018-03-09 19:02:50 UTC  ``` (In reply to Stefan Metzmacher from [comment #42](show_bug.cgi?id=13272#c42)) Thanks.  I'll continue on Monday NZ time.  Contributions by others most welcome!  I realise that is close to deadline but I've tried 'just a little' development on a Saturday and it never stays that way :-) ```  [Comment 45](show_bug.cgi?id=13272#c45)  Stefan Metzmacher    2018-03-11 22:19:49 UTC  ``` Created [attachment 14029](attachment.cgi?id=14029 "CVE-2018-1057-description.metze04.txt") [[details]](attachment.cgi?id=14029&action=edit "CVE-2018-1057-description.metze04.txt") CVE-2018-1057-description.metze04.txt  This refers to <https://wiki.samba.org/index.php/CVE-2018-1057> for possible workarounds. ```  [Comment 47](show_bug.cgi?id=13272#c47)  Andrew Bartlett    2018-03-11 22:26:07 UTC  ``` Comment on [attachment 14029](attachment.cgi?id=14029 "CVE-2018-1057-description.metze04.txt") [[details]](attachment.cgi?id=14029&action=edit "CVE-2018-1057-description.metze04.txt") CVE-2018-1057-description.metze04.txt  This looks good to me. ```  [Comment 48](show_bug.cgi?id=13272#c48)  Stefan Metzmacher    2018-03-11 22:26:29 UTC  ``` Created [attachment 14030](attachment.cgi?id=14030 "CVE-2018-1057-wiki.metze01.txt") [[details]](attachment.cgi?id=14030&action=edit "CVE-2018-1057-wiki.metze01.txt") CVE-2018-1057-wiki.metze01.txt  First draft for <https://wiki.samba.org/index.php/CVE-2018-1057>, but this needs changes once Andrew's script is ready. ```  [Comment 49](show_bug.cgi?id=13272#c49)  Andrew Bartlett    2018-03-11 22:28:01 UTC  ``` Created [attachment 14031](attachment.cgi?id=14031 "Updated workaround script, lightly tested") [[details]](attachment.cgi?id=14031&action=edit "Updated workaround script, lightly tested") Updated workaround script, lightly tested  Attached is an updated script that implements the defaultSecurityDescriptor change metze suggested ```  [Comment 50](show_bug.cgi?id=13272#c50)  Andrew Bartlett    2018-03-11 22:28:34 UTC  ``` Comment on [attachment 14028](attachment.cgi?id=14028 "script to disable password changes by others") [[details]](attachment.cgi?id=14028&action=edit "script to disable password changes by others") script to disable password changes by others  (mark old script as obsolete) ```  [Comment 51](show_bug.cgi?id=13272#c51)  Stefan Metzmacher    2018-03-11 22:50:31 UTC  ``` (In reply to Andrew Bartlett from [comment #49](show_bug.cgi?id=13272#c49))  Thanks! But can we use a more human readable GUID, like this?  ffffffff-CECE-2018-1057-000000b13272 ```  [Comment 52](show_bug.cgi?id=13272#c52)  Andrew Bartlett    2018-03-11 23:16:11 UTC  ``` Created [attachment 14032](attachment.cgi?id=14032 "Updated workaround script, lightly tested, using metze's guid") [[details]](attachment.cgi?id=14032&action=edit "Updated workaround script, lightly tested, using metze's guid") Updated workaround script, lightly tested, using metze's guid  Thanks for the suggestion, here is the updated script. ```  [Comment 53](show_bug.cgi?id=13272#c53)  Andrew Bartlett    2018-03-12 03:31:40 UTC  ``` Created [attachment 14033](attachment.cgi?id=14033 "proposed wiki text describing how to run the script") [[details]](attachment.cgi?id=14033&action=edit "proposed wiki text describing how to run the script") proposed wiki text describing how to run the script  An updated page for the wiki (created by hand, may contain minor formatting errors) ```  [Comment 54](show_bug.cgi?id=13272#c54)  Karolin Seeger    2018-03-12 08:50:35 UTC  ``` Created [attachment 14034](attachment.cgi?id=14034 "CVE-2018-1057-description.metze04.ks.txt") [[details]](attachment.cgi?id=14034&action=edit "CVE-2018-1057-description.metze04.ks.txt") CVE-2018-1057-description.metze04.ks.txt  users -> users' ```  [Comment 58](show_bug.cgi?id=13272#c58)  Stefan Metzmacher    2018-03-12 13:39:06 UTC  ``` Karolin, I think it would be good to send a notification to all three bug reports, 60 or 30 mins before the end of the embargo. ```  [Comment 59](show_bug.cgi?id=13272#c59)  Stefan Metzmacher    2018-03-12 17:14:19 UTC  ``` Created [attachment 14035](attachment.cgi?id=14035 "samba_CVE-2018-1057_helper") [[details]](attachment.cgi?id=14035&action=edit "samba_CVE-2018-1057_helper") samba_CVE-2018-1057_helper  Updated workaround script  This fixes the print statements for the dry-run mode and fixes some trailing whitespaces.  I've tested this within: make -j testenv SELFTEST_TESTENV=ad_dc:local and the ACEs are replacted correctly ```  [Comment 60](show_bug.cgi?id=13272#c60)  Andrew Bartlett    2018-03-12 17:38:23 UTC  ``` Comment on [attachment 14035](attachment.cgi?id=14035 "samba_CVE-2018-1057_helper") [[details]](attachment.cgi?id=14035&action=edit "samba_CVE-2018-1057_helper") samba_CVE-2018-1057_helper  Looks good to me.  Thanks! ```  [Comment 61](show_bug.cgi?id=13272#c61)  Andrew Bartlett    2018-03-13 03:45:44 UTC  ``` Created [attachment 14036](attachment.cgi?id=14036 "Improved wiki text") [[details]](attachment.cgi?id=14036&action=edit "Improved wiki text") Improved wiki text ```  [Comment 62](show_bug.cgi?id=13272#c62)  Karolin Seeger    2018-03-13 07:53:17 UTC  ``` Created [attachment 14038](attachment.cgi?id=14038 "CVE-2018-1057-description.metze04.ks_v2.txt") [[details]](attachment.cgi?id=14038&action=edit "CVE-2018-1057-description.metze04.ks_v2.txt") CVE-2018-1057-description.metze04.ks_v2.txt  Fix version 4.6.15 -> 4.6.14 ```  [Comment 63](show_bug.cgi?id=13272#c63)  Andrew Bartlett    2018-03-13 08:23:22 UTC  ``` Created [attachment 14039](attachment.cgi?id=14039 "CVE-2018-1057-description.abartlet05.txt") [[details]](attachment.cgi?id=14039&action=edit "CVE-2018-1057-description.abartlet05.txt") CVE-2018-1057-description.abartlet05.txt  If there is still time, this simply clarifies that service accounts are 'users' too.  (Otherwise I've tried to clarify this much in the FAQ) ```  [Comment 64](show_bug.cgi?id=13272#c64)  Stefan Metzmacher    2018-03-13 08:31:31 UTC  ``` Comment on [attachment 14035](attachment.cgi?id=14035 "samba_CVE-2018-1057_helper") [[details]](attachment.cgi?id=14035&action=edit "samba_CVE-2018-1057_helper") samba_CVE-2018-1057_helper  This will be available as <https://download.samba.org/pub/samba/misc/samba_CVE-2018-1057_helper> with the signature <https://download.samba.org/pub/samba/misc/samba_CVE-2018-1057_helper.asc> ```  [Comment 65](show_bug.cgi?id=13272#c65)  Karolin Seeger    2018-03-13 08:32:23 UTC  ``` Created [attachment 14040](attachment.cgi?id=14040 "Wiki text containing link to advisory and helper script") [[details]](attachment.cgi?id=14040&action=edit "Wiki text containing link to advisory and helper script") Wiki text containing link to advisory and helper script ```  [Comment 66](show_bug.cgi?id=13272#c66)  Andrew Bartlett    2018-03-13 08:39:26 UTC  ``` Created [attachment 14041](attachment.cgi?id=14041 "Wiki text containing link to advisory and helper script") [[details]](attachment.cgi?id=14041&action=edit "Wiki text containing link to advisory and helper script") Wiki text containing link to advisory and helper script  Updated the wiki text as a quick read showed a formatting issue on the first line and that I could improve the text for the script options.   Thanks so much for filling in the blanks, and particularly for the replication point! ```  [Comment 67](show_bug.cgi?id=13272#c67)  Andrew Bartlett    2018-03-13 08:43:26 UTC  ``` (In reply to Stefan Metzmacher from [comment #64](show_bug.cgi?id=13272#c64))  In the long term this can live in git, I propose   source4/scripting/bin/samba_CVE-2018-1057_helper  as the path.  I'll add it there tomorrow, but you can put it in earlier with my Signed-off-by if you like. ```  [Comment 68](show_bug.cgi?id=13272#c68)  Stefan Metzmacher    2018-03-13 08:45:42 UTC  ``` Comment on [attachment 14041](attachment.cgi?id=14041 "Wiki text containing link to advisory and helper script") [[details]](attachment.cgi?id=14041&action=edit "Wiki text containing link to advisory and helper script") Wiki text containing link to advisory and helper script  Looks good. ```  [Comment 69](show_bug.cgi?id=13272#c69)  Stefan Metzmacher    2018-03-13 08:46:57 UTC  ``` The end of the embargo will be announced in about 30 minutes... ```  [Comment 70](show_bug.cgi?id=13272#c70)  Stefan Metzmacher    2018-03-13 09:20:20 UTC  ``` (In reply to Stefan Metzmacher from [comment #69](show_bug.cgi?id=13272#c69))  End of embargo! ```  [Comment 71](show_bug.cgi?id=13272#c71)  Stefan Metzmacher    2018-03-13 09:24:06 UTC  ``` Pushed to autobuild-v4-8-test and master. ```  [Comment 72](show_bug.cgi?id=13272#c72)  Stefan Metzmacher    2018-03-13 09:31:20 UTC  ``` Created [attachment 14042](attachment.cgi?id=14042 "CVE-2018-1057-v4-4.metze01.patches.txt") [[details]](attachment.cgi?id=14042&action=edit "CVE-2018-1057-v4-4.metze01.patches.txt") CVE-2018-1057-v4-4.metze01.patches.txt ```  [Comment 73](show_bug.cgi?id=13272#c73)  Stefan Metzmacher    2018-03-13 09:31:51 UTC  ``` Created [attachment 14043](attachment.cgi?id=14043 "CVE-2018-1057-v4-3.metze01.patches.txt") [[details]](attachment.cgi?id=14043&action=edit "CVE-2018-1057-v4-3.metze01.patches.txt") CVE-2018-1057-v4-3.metze01.patches.txt ```  [Comment 74](show_bug.cgi?id=13272#c74)  Andrew Bartlett    2018-03-13 09:36:58 UTC  ``` Comment on [attachment 14043](attachment.cgi?id=14043 "CVE-2018-1057-v4-3.metze01.patches.txt") [[details]](attachment.cgi?id=14043&action=edit "CVE-2018-1057-v4-3.metze01.patches.txt") CVE-2018-1057-v4-3.metze01.patches.txt  Can you upload these to <https://www.samba.org/samba/history/security.html> also (as this bug isn't public)?  Thanks, ```  [Comment 75](show_bug.cgi?id=13272#c75)  Stefan Metzmacher    2018-03-13 09:38:19 UTC  ``` (In reply to Andrew Bartlett from [comment #74](show_bug.cgi?id=13272#c74))  I'm working on it... ```  [Comment 76](show_bug.cgi?id=13272#c76)  Stefan Metzmacher    2018-03-13 09:45:25 UTC  ``` (In reply to Stefan Metzmacher from [comment #75](show_bug.cgi?id=13272#c75))  The raw links: <https://download.samba.org/pub/samba/patches/security/samba-4.4.16-CVE-2018-1057.patch> <https://download.samba.org/pub/samba/patches/security/samba-4.4.16-CVE-2018-1057.patch.asc>  <https://download.samba.org/pub/samba/patches/security/samba-4.3.13-CVE-2018-1057.patch> <https://download.samba.org/pub/samba/patches/security/samba-4.3.13-CVE-2018-1057.patch.asc> ```  [Comment 77](show_bug.cgi?id=13272#c77)  Stefan Metzmacher    2018-03-13 09:54:29 UTC  ``` (In reply to Andrew Bartlett from [comment #74](show_bug.cgi?id=13272#c74))  Done, <https://www.samba.org/samba/patches/> as in the advisory text redirects to <https://www.samba.org/samba/history/security.html> now. ```  [Comment 78](show_bug.cgi?id=13272#c78)  Jones Syue (dead mail address)    2018-03-13 10:15:04 UTC  ``` Hello list,  samba-4.4 patch has one compiling failure: > ../source4/dsdb/samdb/ldb_modules/password_hash.c: In function 'setup_io': > ../source4/dsdb/samdb/ldb_modules/password_hash.c:2585:24: error: 'struct ph_context' has no member named 'update_password' >    if (pav == NULL && ac->update_password) {                         ^ Looks like samba-4.4 do not include [Bug#9654](show_bug.cgi?id=9654 "RESOLVED FIXED - pwdLastSet broken (allowing passwords that never expire)") > [https://bugzilla.samba.org/show_bug.cgi?id=9654](show_bug.cgi?id=9654 "RESOLVED FIXED - pwdLastSet broken (allowing passwords that never expire)") > <https://git.samba.org/?p=samba.git;a=commitdiff;h=8ca1c02163901cea29aac1428607742318433ed3>  Should we simply replace this line with on samba-4.4 patch? -    if (pav == NULL && ac->update_password) { +    if (pav == NULL) { ```  [Comment 79](show_bug.cgi?id=13272#c79)  Stefan Metzmacher    2018-03-13 10:40:53 UTC  ``` (In reply to Jones Syue from [comment #78](show_bug.cgi?id=13272#c78))  Yes, that looks correct.  Sorry for the trouble, I'll upload new patches shortly. ```  [Comment 80](show_bug.cgi?id=13272#c80)  Stefan Metzmacher    2018-03-13 10:52:36 UTC  ``` Created [attachment 14044](attachment.cgi?id=14044 "CVE-2018-1057-v4-4.metze02.patches.txt") [[details]](attachment.cgi?id=14044&action=edit "CVE-2018-1057-v4-4.metze02.patches.txt") CVE-2018-1057-v4-4.metze02.patches.txt  This is the same as <https://download.samba.org/pub/samba/patches/security/samba-4.4.16-CVE-2018-1057.patch> ```  [Comment 81](show_bug.cgi?id=13272#c81)  Stefan Metzmacher    2018-03-13 10:53:28 UTC  ``` Created [attachment 14045](attachment.cgi?id=14045 "CVE-2018-1057-v4-3.metze02.patches.txt") [[details]](attachment.cgi?id=14045&action=edit "CVE-2018-1057-v4-3.metze02.patches.txt") CVE-2018-1057-v4-3.metze02.patches.txt  This is the same as <https://download.samba.org/pub/samba/patches/security/samba-4.3.13-CVE-2018-1057.patch> ```  [Comment 82](show_bug.cgi?id=13272#c82)  Jones Syue (dead mail address)    2018-03-13 11:19:06 UTC  ``` (In reply to Stefan Metzmacher from [comment #80](show_bug.cgi?id=13272#c80))  Great! Thank you!  patch => compiling => deploy => works fine!  ldapmodify output: > modifying entry "CN=Administrator,CN=Users,DC=1282t,DC=addc" > ldap_modify: Constraint violation (19) >        additional info: error in module acl: Constraint violation during LDB_MODIFY (19) ```  [Comment 83](show_bug.cgi?id=13272#c83)  Stefan Metzmacher    2018-03-13 15:09:19 UTC  ``` Pushed to v4-8-test and master. ```  [Comment 84](show_bug.cgi?id=13272#c84)  Andrew Bartlett    2018-03-14 02:38:03 UTC  ``` Created [attachment 14047](attachment.cgi?id=14047 "Script with the str(msg.dn) workaround for 4.3 -> 4.6") [[details]](attachment.cgi?id=14047&action=edit "Script with the str(msg.dn) workaround for 4.3 -> 4.6") Script with the str(msg.dn) workaround for 4.3 -> 4.6  The attached script passed a smoke test on Samba 4.3, 4.4, 4.5, 4.6 ```  [Comment 85](show_bug.cgi?id=13272#c85)  Stefan Metzmacher    2018-03-14 06:15:28 UTC  ``` Comment on [attachment 14047](attachment.cgi?id=14047 "Script with the str(msg.dn) workaround for 4.3 -> 4.6") [[details]](attachment.cgi?id=14047&action=edit "Script with the str(msg.dn) workaround for 4.3 -> 4.6") Script with the str(msg.dn) workaround for 4.3 -> 4.6  But does it also work with 4.7? ```  [Comment 86](show_bug.cgi?id=13272#c86)  Stefan Metzmacher    2018-03-14 10:57:18 UTC  ``` Created [attachment 14048](attachment.cgi?id=14048 "samba_CVE-2018-1057_helper (tested with 4.3, 4.6 and 4.7)") [[details]](attachment.cgi?id=14048&action=edit "samba_CVE-2018-1057_helper (tested with 4.3, 4.6 and 4.7)") samba_CVE-2018-1057_helper (tested with 4.3, 4.6 and 4.7)  This is the updated <https://download.samba.org/pub/samba/misc/samba_CVE-2018-1057_helper> ```  [Comment 87](show_bug.cgi?id=13272#c87)  Andrew Bartlett    2018-03-14 18:36:20 UTC  ``` (In reply to Stefan Metzmacher from [comment #86](show_bug.cgi?id=13272#c86)) Thank you very much for handling this!  (I clearly didn't handle this well yesterday, not only didn't I leave enough time to test 4.7 it seems I started from the wrong version of the script!). ```  [Comment 88](show_bug.cgi?id=13272#c88)  Stefan Metzmacher    2018-03-22 09:34:22 UTC  ``` Also fixed in master and 4.8.0 ```  [Comment 89](show_bug.cgi?id=13272#c89)  Andrew Bartlett    2021-08-31 04:02:49 UTC  ``` Removing embargo on long-fixed security bug. ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=13272)
* - [XML](show_bug.cgi?ctype=xml&id=13272)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=13272)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=13272&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=13272&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from www.samba.org_d79dab4e_20250115_195500.html ===

## CVE-2023-4154.html:

```

===========================================================
== Subject:     Samba AD DC password exposure to privileged
==              users and RODCs
==
== CVE ID#:     CVE-2023-4154
==
== Versions:    All versions since Samba 4.0.0
==
== Summary:     An RODC and a user with the GET_CHANGES
==              right can view all attributes, including
==              secrets and passwords.
==
==              Additionally, the access check fails open
==              on error conditions.
===========================================================

===========
Description
===========

In normal operation, passwords and (most) secrets are never disclosed
over LDAP in Active Directory.

However, due to a design flaw in Samba's implementation of the DirSync
control, Active Directory accounts authorized to do some replication,
but not to replicate sensitive attributes, can instead replicate
critical domain passwords and secrets.

In a default installation, this means that RODC DC accounts (which
should only be permitted to replicate some passwords) can instead
obtain all domain secrets, including the core AD secret: the krbtgt
password.

RODCs are given this permission as part of their installation for DRS
replication.  This vulnerability removes the RODC / DC distinction.

Secondly, and just as problematically, the access check for this
functionality did not account for error conditions - errors like
out of memory were regarded as success.  This is sometimes described
as "fail open".  In these error conditions, some of which (eg out of
memory) may be influenced by a low-privileged attacker, access to the
secret attributes could be obtained!

==================
Patch Availability
==================

Patches addressing both these issues have been posted to:

    https://www.samba.org/samba/security/

Additionally, Samba 4.19.1, 4.18.8 and 4.17.12 have been issued
as security releases to correct the defect.  Samba administrators are
advised to upgrade to these releases or apply the patch as soon
as possible.

==================
CVSSv3 calculation
==================

For password disclosure to RODCs and other privileged accounts:
CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H (7.2)

For the fail open on the DirSync access check:
CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H (7.5)

=================================
Workaround and mitigating factors
=================================

If no RODC accounts are in use in the domain, and DirSync users set
LDAP_DIRSYNC_OBJECT_SECURITY then there is no need to give this right
to any users.  If only privileged accounts have this right, only the
error path vulnerability exists.

Since Windows 2003 and in all versions of Samba, it has not been
required to assign accounts this "Get Changes" / GUID_DRS_GET_CHANGES
right to use LDAP DirSync, provided that the
LDAP_DIRSYNC_OBJECT_SECURITY it set in the control.

If any unprivileged accounts do have this right, and either no longer
use DirSync or use LDAP_DIRSYNC_OBJECT_SECURITY, this should be
removed.

GUID_DRS_GET_CHANGES / 1131f6aa-9c07-11d1-f79f-00c04fc2dcd2 is an
extended right set in the ntSecurityDescriptor on the NC root (the DN
at the top of each partition).  These are for example the domain DN,
configuration DN etc.  The domain DN is the most important.

=======
Credits
=======

Originally reported by Andrew Bartlett of Catalyst and the Samba Team
during routine code review.

Patches provided by Andrew Bartlett of Catalyst and the Samba team.

==========================================================
== Our Code, Our Bugs, Our Responsibility.
== The Samba Team
==========================================================

```


