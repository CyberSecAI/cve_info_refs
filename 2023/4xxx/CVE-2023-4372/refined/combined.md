=== Content from plugins.trac.wordpress.org_d6598953_20250115_100819.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2977143%2Flitespeed-cache)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2954001/litespeed-cache "Changeset 2954001 for litespeed-cache")
* [Next Change](/changeset/2983968/litespeed-cache "Changeset 2983968 for litespeed-cache") →

---

# Changeset [2977143](/changeset/2977143 "Show full changeset") for [litespeed-cache](/browser/litespeed-cache?rev=2977143 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/10/2023 05:02:18 PM
([15 months](/timeline?from=2023-10-10T17%3A02%3A18Z&precision=second "See timeline at 10/10/2023 05:02:18 PM") ago)

Author:
LiteSpeedTech
Message:

Release v5.7

Location:
[litespeed-cache](/browser/litespeed-cache?rev=2977143)
Files:

334 added
25 edited

* [tags/5.7](/browser/litespeed-cache/tags/5.7?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/LICENSE](/browser/litespeed-cache/tags/5.7/LICENSE?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets](/browser/litespeed-cache/tags/5.7/assets?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css](/browser/litespeed-cache/tags/5.7/assets/css?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/fonts](/browser/litespeed-cache/tags/5.7/assets/css/fonts?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/fonts/litespeedfont.eot](/browser/litespeed-cache/tags/5.7/assets/css/fonts/litespeedfont.eot?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/fonts/litespeedfont.svg](/browser/litespeed-cache/tags/5.7/assets/css/fonts/litespeedfont.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/fonts/litespeedfont.ttf](/browser/litespeed-cache/tags/5.7/assets/css/fonts/litespeedfont.ttf?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/fonts/litespeedfont.woff](/browser/litespeed-cache/tags/5.7/assets/css/fonts/litespeedfont.woff?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/iziModal.min.css](/browser/litespeed-cache/tags/5.7/assets/css/iziModal.min.css?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/litespeed-legacy.css](/browser/litespeed-cache/tags/5.7/assets/css/litespeed-legacy.css?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/css/litespeed.css](/browser/litespeed-cache/tags/5.7/assets/css/litespeed.css?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img](/browser/litespeed-cache/tags/5.7/assets/img?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/Litespeed.icon.svg](/browser/litespeed-cache/tags/5.7/assets/img/Litespeed.icon.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/iconlscwp.svg](/browser/litespeed-cache/tags/5.7/assets/img/iconlscwp.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons](/browser/litespeed-cache/tags/5.7/assets/img/icons?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/all.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/all.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/all\_transients.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/all_transients.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/auto\_draft.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/auto_draft.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/cross\_icon.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/cross_icon.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/db.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/db.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/empty-cache.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/empty-cache.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/expired\_transient.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/expired_transient.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/img\_optm.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/img_optm.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/img\_optm\_disabled.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/img_optm_disabled.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/img\_webp.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/img_webp.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/img\_webp\_disabled.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/img_webp_disabled.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/optimize\_tables.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/optimize_tables.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-403.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-403.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-404.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-404.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-500.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-500.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-all.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-all.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-cssjs.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-cssjs.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-front.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-front.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-object.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-object.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-opcache.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-opcache.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/purge-pages.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/purge-pages.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/revision.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/revision.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/spam\_comment.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/spam_comment.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/success\_icon.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/success_icon.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/trackback-pingback.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/trackback-pingback.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/trash\_comment.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/trash_comment.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/icons/trash\_post.svg](/browser/litespeed-cache/tags/5.7/assets/img/icons/trash_post.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp-logo\_90x90.png](/browser/litespeed-cache/tags/5.7/assets/img/lscwp-logo_90x90.png?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp\_blue\_font-icon\_22px.svg](/browser/litespeed-cache/tags/5.7/assets/img/lscwp_blue_font-icon_22px.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp\_font-icon\_32px.svg](/browser/litespeed-cache/tags/5.7/assets/img/lscwp_font-icon_32px.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp\_gray-yellow\_font-icon\_22px.svg](/browser/litespeed-cache/tags/5.7/assets/img/lscwp_gray-yellow_font-icon_22px.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp\_gray\_font-icon\_22px.svg](/browser/litespeed-cache/tags/5.7/assets/img/lscwp_gray_font-icon_22px.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/lscwp\_grayscale\_font-icon\_22px.svg](/browser/litespeed-cache/tags/5.7/assets/img/lscwp_grayscale_font-icon_22px.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/quic-cloud-icon-16x16.svg](/browser/litespeed-cache/tags/5.7/assets/img/quic-cloud-icon-16x16.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/quic-cloud-logo-light\_stack\_300px.png](/browser/litespeed-cache/tags/5.7/assets/img/quic-cloud-logo-light_stack_300px.png?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/quic-cloud-logo.svg](/browser/litespeed-cache/tags/5.7/assets/img/quic-cloud-logo.svg?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/img/slack-logo.png](/browser/litespeed-cache/tags/5.7/assets/img/slack-logo.png?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js](/browser/litespeed-cache/tags/5.7/assets/js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/babel.min.js](/browser/litespeed-cache/tags/5.7/assets/js/babel.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/component.cdn.js](/browser/litespeed-cache/tags/5.7/assets/js/component.cdn.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/component.crawler.js](/browser/litespeed-cache/tags/5.7/assets/js/component.crawler.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/css\_async.js](/browser/litespeed-cache/tags/5.7/assets/js/css_async.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/css\_async.min.js](/browser/litespeed-cache/tags/5.7/assets/js/css_async.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/guest.docref.js](/browser/litespeed-cache/tags/5.7/assets/js/guest.docref.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/guest.docref.min.js](/browser/litespeed-cache/tags/5.7/assets/js/guest.docref.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/guest.js](/browser/litespeed-cache/tags/5.7/assets/js/guest.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/guest.min.js](/browser/litespeed-cache/tags/5.7/assets/js/guest.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/instant\_click.min.js](/browser/litespeed-cache/tags/5.7/assets/js/instant_click.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/instant\_click.ori.js](/browser/litespeed-cache/tags/5.7/assets/js/instant_click.ori.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/iziModal.min.js](/browser/litespeed-cache/tags/5.7/assets/js/iziModal.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/js\_delay.js](/browser/litespeed-cache/tags/5.7/assets/js/js_delay.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/js\_delay.min.js](/browser/litespeed-cache/tags/5.7/assets/js/js_delay.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/lazyload.init.js](/browser/litespeed-cache/tags/5.7/assets/js/lazyload.init.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/lazyload.lib.js](/browser/litespeed-cache/tags/5.7/assets/js/lazyload.lib.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/lazyload.min.js](/browser/litespeed-cache/tags/5.7/assets/js/lazyload.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/litespeed-cache-admin.js](/browser/litespeed-cache/tags/5.7/assets/js/litespeed-cache-admin.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/react.min.js](/browser/litespeed-cache/tags/5.7/assets/js/react.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/webfontloader.js](/browser/litespeed-cache/tags/5.7/assets/js/webfontloader.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/assets/js/webfontloader.min.js](/browser/litespeed-cache/tags/5.7/assets/js/webfontloader.min.js?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/autoload.php](/browser/litespeed-cache/tags/5.7/autoload.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli](/browser/litespeed-cache/tags/5.7/cli?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/debug.cls.php](/browser/litespeed-cache/tags/5.7/cli/debug.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/image.cls.php](/browser/litespeed-cache/tags/5.7/cli/image.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/online.cls.php](/browser/litespeed-cache/tags/5.7/cli/online.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/option.cls.php](/browser/litespeed-cache/tags/5.7/cli/option.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/presets.cls.php](/browser/litespeed-cache/tags/5.7/cli/presets.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/cli/purge.cls.php](/browser/litespeed-cache/tags/5.7/cli/purge.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data](/browser/litespeed-cache/tags/5.7/data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/.htaccess](/browser/litespeed-cache/tags/5.7/data/.htaccess?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/const.default.ini](/browser/litespeed-cache/tags/5.7/data/const.default.ini?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/const.network\_default.ini](/browser/litespeed-cache/tags/5.7/data/const.network_default.ini?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/css\_excludes.txt](/browser/litespeed-cache/tags/5.7/data/css_excludes.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/esi.nonce.txt](/browser/litespeed-cache/tags/5.7/data/esi.nonce.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/esi.nonces.txt](/browser/litespeed-cache/tags/5.7/data/esi.nonces.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/js\_defer\_excludes.txt](/browser/litespeed-cache/tags/5.7/data/js_defer_excludes.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/js\_excludes.txt](/browser/litespeed-cache/tags/5.7/data/js_excludes.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/optm\_uri\_exc.txt](/browser/litespeed-cache/tags/5.7/data/optm_uri_exc.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset](/browser/litespeed-cache/tags/5.7/data/preset?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset/advanced.data](/browser/litespeed-cache/tags/5.7/data/preset/advanced.data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset/aggressive.data](/browser/litespeed-cache/tags/5.7/data/preset/aggressive.data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset/basic.data](/browser/litespeed-cache/tags/5.7/data/preset/basic.data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset/essentials.data](/browser/litespeed-cache/tags/5.7/data/preset/essentials.data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/preset/extreme.data](/browser/litespeed-cache/tags/5.7/data/preset/extreme.data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/data/ucss\_whitelist.txt](/browser/litespeed-cache/tags/5.7/data/ucss_whitelist.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/guest.vary.php](/browser/litespeed-cache/tags/5.7/guest.vary.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/inc](/browser/litespeed-cache/tags/5.7/inc?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/inc/object.lib.php](/browser/litespeed-cache/tags/5.7/inc/object.lib.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lang](/browser/litespeed-cache/tags/5.7/lang?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lang/litespeed-cache.pot](/browser/litespeed-cache/tags/5.7/lang/litespeed-cache.pot?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib](/browser/litespeed-cache/tags/5.7/lib?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/css-min](/browser/litespeed-cache/tags/5.7/lib/css-min?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/css-min/colors.cls.php](/browser/litespeed-cache/tags/5.7/lib/css-min/colors.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/css-min/minifier.cls.php](/browser/litespeed-cache/tags/5.7/lib/css-min/minifier.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/css-min/urirewriter.cls.php](/browser/litespeed-cache/tags/5.7/lib/css-min/urirewriter.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/css-min/utils.cls.php](/browser/litespeed-cache/tags/5.7/lib/css-min/utils.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/guest.cls.php](/browser/litespeed-cache/tags/5.7/lib/guest.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/html-min.cls.php](/browser/litespeed-cache/tags/5.7/lib/html-min.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin.cls.php](/browser/litespeed-cache/tags/5.7/lib/jsmin.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data](/browser/litespeed-cache/tags/5.7/lib/jsmin_data?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/keywords\_after.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/keywords_after.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/keywords\_before.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/keywords_before.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/keywords\_reserved.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/keywords_reserved.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/operators.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/operators.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/operators\_after.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/operators_after.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/jsmin\_data/operators\_before.txt](/browser/litespeed-cache/tags/5.7/lib/jsmin_data/operators_before.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/object-cache.php](/browser/litespeed-cache/tags/5.7/lib/object-cache.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/lib/php-compatibility.func.php](/browser/litespeed-cache/tags/5.7/lib/php-compatibility.func.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/litespeed-cache.php](/browser/litespeed-cache/tags/5.7/litespeed-cache.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/qc-ping.txt](/browser/litespeed-cache/tags/5.7/qc-ping.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/readme.txt](/browser/litespeed-cache/tags/5.7/readme.txt?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src](/browser/litespeed-cache/tags/5.7/src?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/activation.cls.php](/browser/litespeed-cache/tags/5.7/src/activation.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/admin-display.cls.php](/browser/litespeed-cache/tags/5.7/src/admin-display.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/admin-settings.cls.php](/browser/litespeed-cache/tags/5.7/src/admin-settings.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/admin.cls.php](/browser/litespeed-cache/tags/5.7/src/admin.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/api.cls.php](/browser/litespeed-cache/tags/5.7/src/api.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/avatar.cls.php](/browser/litespeed-cache/tags/5.7/src/avatar.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/base.cls.php](/browser/litespeed-cache/tags/5.7/src/base.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cdn](/browser/litespeed-cache/tags/5.7/src/cdn?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cdn-setup.cls.php](/browser/litespeed-cache/tags/5.7/src/cdn-setup.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cdn.cls.php](/browser/litespeed-cache/tags/5.7/src/cdn.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cdn/cloudflare.cls.php](/browser/litespeed-cache/tags/5.7/src/cdn/cloudflare.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cdn/quic.cls.php](/browser/litespeed-cache/tags/5.7/src/cdn/quic.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/cloud.cls.php](/browser/litespeed-cache/tags/5.7/src/cloud.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/conf.cls.php](/browser/litespeed-cache/tags/5.7/src/conf.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/control.cls.php](/browser/litespeed-cache/tags/5.7/src/control.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/core.cls.php](/browser/litespeed-cache/tags/5.7/src/core.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/crawler-map.cls.php](/browser/litespeed-cache/tags/5.7/src/crawler-map.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/crawler.cls.php](/browser/litespeed-cache/tags/5.7/src/crawler.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/css.cls.php](/browser/litespeed-cache/tags/5.7/src/css.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data.cls.php](/browser/litespeed-cache/tags/5.7/src/data.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data.upgrade.func.php](/browser/litespeed-cache/tags/5.7/src/data.upgrade.func.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure](/browser/litespeed-cache/tags/5.7/src/data_structure?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/avatar.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/avatar.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/crawler.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/crawler.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/crawler\_blacklist.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/crawler_blacklist.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/img\_optm.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/img_optm.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/img\_optming.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/img_optming.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/url.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/url.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/data\_structure/url\_file.sql](/browser/litespeed-cache/tags/5.7/src/data_structure/url_file.sql?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/db-optm.cls.php](/browser/litespeed-cache/tags/5.7/src/db-optm.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/debug2.cls.php](/browser/litespeed-cache/tags/5.7/src/debug2.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/doc.cls.php](/browser/litespeed-cache/tags/5.7/src/doc.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/error.cls.php](/browser/litespeed-cache/tags/5.7/src/error.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/esi.cls.php](/browser/litespeed-cache/tags/5.7/src/esi.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/file.cls.php](/browser/litespeed-cache/tags/5.7/src/file.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/gui.cls.php](/browser/litespeed-cache/tags/5.7/src/gui.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/health.cls.php](/browser/litespeed-cache/tags/5.7/src/health.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/htaccess.cls.php](/browser/litespeed-cache/tags/5.7/src/htaccess.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/img-optm.cls.php](/browser/litespeed-cache/tags/5.7/src/img-optm.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/import.cls.php](/browser/litespeed-cache/tags/5.7/src/import.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/instance.cls.php](/browser/litespeed-cache/tags/5.7/src/instance.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/lang.cls.php](/browser/litespeed-cache/tags/5.7/src/lang.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/localization.cls.php](/browser/litespeed-cache/tags/5.7/src/localization.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/media.cls.php](/browser/litespeed-cache/tags/5.7/src/media.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/metabox.cls.php](/browser/litespeed-cache/tags/5.7/src/metabox.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/object-cache.cls.php](/browser/litespeed-cache/tags/5.7/src/object-cache.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/object.lib.php](/browser/litespeed-cache/tags/5.7/src/object.lib.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/optimize.cls.php](/browser/litespeed-cache/tags/5.7/src/optimize.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/optimizer.cls.php](/browser/litespeed-cache/tags/5.7/src/optimizer.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/placeholder.cls.php](/browser/litespeed-cache/tags/5.7/src/placeholder.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/preset.cls.php](/browser/litespeed-cache/tags/5.7/src/preset.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/purge.cls.php](/browser/litespeed-cache/tags/5.7/src/purge.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/report.cls.php](/browser/litespeed-cache/tags/5.7/src/report.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/rest.cls.php](/browser/litespeed-cache/tags/5.7/src/rest.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/root.cls.php](/browser/litespeed-cache/tags/5.7/src/root.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/router.cls.php](/browser/litespeed-cache/tags/5.7/src/router.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/str.cls.php](/browser/litespeed-cache/tags/5.7/src/str.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/tag.cls.php](/browser/litespeed-cache/tags/5.7/src/tag.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/task.cls.php](/browser/litespeed-cache/tags/5.7/src/task.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/tool.cls.php](/browser/litespeed-cache/tags/5.7/src/tool.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/ucss.cls.php](/browser/litespeed-cache/tags/5.7/src/ucss.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/utility.cls.php](/browser/litespeed-cache/tags/5.7/src/utility.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/vary.cls.php](/browser/litespeed-cache/tags/5.7/src/vary.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/src/vpi.cls.php](/browser/litespeed-cache/tags/5.7/src/vpi.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty](/browser/litespeed-cache/tags/5.7/thirdparty?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/aelia-currencyswitcher.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/aelia-currencyswitcher.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/amp.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/amp.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/autoptimize.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/autoptimize.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/avada.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/avada.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/bbpress.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/bbpress.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/beaver-builder.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/beaver-builder.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/caldera-forms.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/caldera-forms.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/divi-theme-builder.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/divi-theme-builder.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/elementor.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/elementor.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/entry.inc.php](/browser/litespeed-cache/tags/5.7/thirdparty/entry.inc.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/facetwp.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/facetwp.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/gravity-forms.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/gravity-forms.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/litespeed-check.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/litespeed-check.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/nextgengallery.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/nextgengallery.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/perfmatters.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/perfmatters.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/theme-my-login.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/theme-my-login.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/user-switching.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/user-switching.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wc-pdf-product-vouchers.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wc-pdf-product-vouchers.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wcml.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wcml.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/woo-paypal.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/woo-paypal.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/woocommerce.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/woocommerce.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/woocommerce.content.tpl.php](/browser/litespeed-cache/tags/5.7/thirdparty/woocommerce.content.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/woocommerce.tab.tpl.php](/browser/litespeed-cache/tags/5.7/thirdparty/woocommerce.tab.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wp-polls.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wp-polls.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wp-postratings.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wp-postratings.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wpdiscuz.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wpdiscuz.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wplister.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wplister.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wpml.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wpml.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/wptouch.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/wptouch.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/thirdparty/yith-wishlist.cls.php](/browser/litespeed-cache/tags/5.7/thirdparty/yith-wishlist.cls.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl](/browser/litespeed-cache/tags/5.7/tpl?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner](/browser/litespeed-cache/tags/5.7/tpl/banner?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/ajax.php](/browser/litespeed-cache/tags/5.7/tpl/banner/ajax.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/cloud\_news.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/banner/cloud_news.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/cloud\_promo.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/banner/cloud_promo.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/new\_version.php](/browser/litespeed-cache/tags/5.7/tpl/banner/new_version.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/new\_version\_dev.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/banner/new_version_dev.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/score.php](/browser/litespeed-cache/tags/5.7/tpl/banner/score.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/banner/slack.php](/browser/litespeed-cache/tags/5.7/tpl/banner/slack.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache](/browser/litespeed-cache/tags/5.7/tpl/cache?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/entry\_network.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/entry_network.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/more\_settings\_tip.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/more_settings_tip.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-advanced.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-advanced.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-browser.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-browser.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-cache.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-cache.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-excludes.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-excludes.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-object.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-object.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/network\_settings-purge.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/network_settings-purge.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-advanced.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-advanced.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-browser.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-browser.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-cache.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-cache.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-esi.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-esi.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-excludes.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-excludes.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-object.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-object.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-purge.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-purge.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings-ttl.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings-ttl.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.browser.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.browser.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.cache\_dropquery.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.cache_dropquery.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.cache\_favicon.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.cache_favicon.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.cache\_mobile.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.cache_mobile.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.cache\_resources.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.cache_resources.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.exclude\_cookies.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.exclude_cookies.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.exclude\_useragent.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.exclude_useragent.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.login\_cookie.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.login_cookie.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.object.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.object.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cache/settings\_inc.purge\_on\_upgrade.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cache/settings_inc.purge_on_upgrade.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cdn](/browser/litespeed-cache/tags/5.7/tpl/cdn?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cdn/auto\_setup.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cdn/auto_setup.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cdn/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cdn/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cdn/manage.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cdn/manage.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/cdn/settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/cdn/settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler](/browser/litespeed-cache/tags/5.7/tpl/crawler?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/blacklist.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/blacklist.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/map.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/map.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/settings-general.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/settings-general.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/settings-simulation.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/settings-simulation.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/settings-sitemap.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/settings-sitemap.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/crawler/summary.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/crawler/summary.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/dash](/browser/litespeed-cache/tags/5.7/tpl/dash?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/dash/dashboard.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/dash/dashboard.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/dash/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/dash/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/dash/network\_dash.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/dash/network_dash.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/db\_optm](/browser/litespeed-cache/tags/5.7/tpl/db_optm?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/db\_optm/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/db_optm/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/db\_optm/manage.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/db_optm/manage.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/db\_optm/settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/db_optm/settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/esi.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/esi.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/esi\_widget\_edit.php](/browser/litespeed-cache/tags/5.7/tpl/esi_widget_edit.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general](/browser/litespeed-cache/tags/5.7/tpl/general?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/network\_settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/network_settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/settings\_inc.auto\_upgrade.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/settings_inc.auto_upgrade.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/settings\_inc.guest.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/settings_inc.guest.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/general/settings\_tuning.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/general/settings_tuning.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm](/browser/litespeed-cache/tags/5.7/tpl/img_optm?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/img_optm/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm/network\_settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/img_optm/network_settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm/settings.media\_webp.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/img_optm/settings.media_webp.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm/settings.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/img_optm/settings.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/img\_optm/summary.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/img_optm/summary.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc](/browser/litespeed-cache/tags/5.7/tpl/inc?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/admin\_footer.php](/browser/litespeed-cache/tags/5.7/tpl/inc/admin_footer.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/api\_key.php](/browser/litespeed-cache/tags/5.7/tpl/inc/api_key.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/check\_cache\_disabled.php](/browser/litespeed-cache/tags/5.7/tpl/inc/check_cache_disabled.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/check\_if\_network\_disable\_all.php](/browser/litespeed-cache/tags/5.7/tpl/inc/check_if_network_disable_all.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/disabled\_all.php](/browser/litespeed-cache/tags/5.7/tpl/inc/disabled_all.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/in\_upgrading.php](/browser/litespeed-cache/tags/5.7/tpl/inc/in_upgrading.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/metabox.php](/browser/litespeed-cache/tags/5.7/tpl/inc/metabox.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/modal.footer.php](/browser/litespeed-cache/tags/5.7/tpl/inc/modal.footer.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/modal.header.php](/browser/litespeed-cache/tags/5.7/tpl/inc/modal.header.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/show\_display\_installed.php](/browser/litespeed-cache/tags/5.7/tpl/inc/show_display_installed.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/show\_error\_cookie.php](/browser/litespeed-cache/tags/5.7/tpl/inc/show_error_cookie.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/inc/show\_rule\_conflict.php](/browser/litespeed-cache/tags/5.7/tpl/inc/show_rule_conflict.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm](/browser/litespeed-cache/tags/5.7/tpl/page_optm?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_css.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_css.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_html.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_html.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_js.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_js.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_localization.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_localization.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_media.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_media.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_media\_exc.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_media_exc.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_tuning.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_tuning.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_tuning\_css.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_tuning_css.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/page\_optm/settings\_vpi.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/page_optm/settings_vpi.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/presets](/browser/litespeed-cache/tags/5.7/tpl/presets?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/presets/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/presets/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/presets/standard.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/presets/standard.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox](/browser/litespeed-cache/tags/5.7/tpl/toolbox?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/beta\_test.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/beta_test.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/edit\_htaccess.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/edit_htaccess.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/entry.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/entry.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/heartbeat.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/heartbeat.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/import\_export.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/import_export.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/log\_viewer.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/log_viewer.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/purge.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/purge.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/report.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/report.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [tags/5.7/tpl/toolbox/settings-debug.tpl.php](/browser/litespeed-cache/tags/5.7/tpl/toolbox/settings-debug.tpl.php?rev=2977143 "Show entry in browser")
  (added)
* [trunk/assets/css/litespeed.css](/browser/litespeed-cache/trunk/assets/css/litespeed.css?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file332 "Show differences"))
* [trunk/assets/img/quic-cloud-logo-light\_stack\_300px.png](/browser/litespeed-cache/trunk/assets/img/quic-cloud-logo-light_stack_300px.png?rev=2977143 "Show entry in browser")
  (added)
* [trunk/assets/img/quic-cloud-logo.svg](/browser/litespeed-cache/trunk/assets/img/quic-cloud-logo.svg?rev=2977143 "Show entry in browser")
  (added)
* [trunk/data/const.default.ini](/browser/litespeed-cache/trunk/data/const.default.ini?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file335 "Show differences"))
* [trunk/lang/litespeed-cache.pot](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143 "Show entry in browser")
  (modified)
  ([35 diffs](#file336 "Show differences"))
* [trunk/lib/guest.cls.php](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([12 diffs](#file337 "Show differences"))
* [trunk/litespeed-cache.php](/browser/litespeed-cache/trunk/litespeed-cache.php?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file338 "Show differences"))
* [trunk/readme.txt](/browser/litespeed-cache/trunk/readme.txt?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file339 "Show differences"))
* [trunk/src/admin-settings.cls.php](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([17 diffs](#file340 "Show differences"))
* [trunk/src/base.cls.php](/browser/litespeed-cache/trunk/src/base.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file341 "Show differences"))
* [trunk/src/cdn.cls.php](/browser/litespeed-cache/trunk/src/cdn.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file342 "Show differences"))
* [trunk/src/cdn/quic.cls.php](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([6 diffs](#file343 "Show differences"))
* [trunk/src/cloud.cls.php](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([3 diffs](#file344 "Show differences"))
* [trunk/src/control.cls.php](/browser/litespeed-cache/trunk/src/control.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file345 "Show differences"))
* [trunk/src/crawler.cls.php](/browser/litespeed-cache/trunk/src/crawler.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file346 "Show differences"))
* [trunk/src/doc.cls.php](/browser/litespeed-cache/trunk/src/doc.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file347 "Show differences"))
* [trunk/src/esi.cls.php](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([57 diffs](#file348 "Show differences"))
* [trunk/src/htaccess.cls.php](/browser/litespeed-cache/trunk/src/htaccess.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file349 "Show differences"))
* [trunk/src/img-optm.cls.php](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([3 diffs](#file350 "Show differences"))
* [trunk/src/lang.cls.php](/browser/litespeed-cache/trunk/src/lang.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file351 "Show differences"))
* [trunk/src/media.cls.php](/browser/litespeed-cache/trunk/src/media.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file352 "Show differences"))
* [trunk/src/optimize.cls.php](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([6 diffs](#file353 "Show differences"))
* [trunk/thirdparty/litespeed-check.cls.php](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([9 diffs](#file354 "Show differences"))
* [trunk/thirdparty/woocommerce.cls.php](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143 "Show entry in browser")
  (modified)
  ([36 diffs](#file355 "Show differences"))
* [trunk/thirdparty/woocommerce.content.tpl.php](/browser/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php?rev=2977143 "Show entry in browser")
  (modified)
  ([2 diffs](#file356 "Show differences"))
* [trunk/tpl/dash/dashboard.tpl.php](/browser/litespeed-cache/trunk/tpl/dash/dashboard.tpl.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file357 "Show differences"))
* [trunk/tpl/page\_optm/settings\_html.tpl.php](/browser/litespeed-cache/trunk/tpl/page_optm/settings_html.tpl.php?rev=2977143 "Show entry in browser")
  (modified)
  ([1 diff](#file358 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [litespeed-cache/trunk/assets/css/litespeed.css](/changeset/2977143/litespeed-cache/trunk/assets/css/litespeed.css "Show the changeset 2977143 restricted to litespeed-cache/trunk/assets/css/litespeed.css")

  | [r2954001](/browser/litespeed-cache/trunk/assets/css/litespeed.css?rev=2954001#L298 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/assets/css/litespeed.css?rev=2977143#L298 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 298 | 298 | .litespeed-left20 { |
  | 299 | 299 | margin-left: 20px; |
  |  | 300 | } |
  |  | 301 |  |
  |  | 302 | .litespeed-wrap .litespeed-bg-quic-cloud { |
  |  | 303 | background: linear-gradient(rgba(230,242,242,1) 10%, rgba(250,255,255,1) 30%); |
  | 300 | 304 | } |
  | 301 | 305 |  |
* ## [litespeed-cache/trunk/data/const.default.ini](/changeset/2977143/litespeed-cache/trunk/data/const.default.ini "Show the changeset 2977143 restricted to litespeed-cache/trunk/data/const.default.ini")

  | [r2846360](/browser/litespeed-cache/trunk/data/const.default.ini?rev=2846360#L35 "Show revision 2846360 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/data/const.default.ini?rev=2977143#L35 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 | Pingdom |
  | 36 | 36 | bot |
  |  | 37 | spider |
  | 37 | 38 | PTST |
  | 38 | 39 | HeadlessChrome' |
  | […](/browser/litespeed-cache/trunk/data/const.default.ini?rev=2846360#L391) | […](/browser/litespeed-cache/trunk/data/const.default.ini?rev=2977143#L392) |  |
  | 391 | 392 | optm-dns\_prefetch\_ctrl = false |
  | 392 | 393 |  |
  |  | 394 | ; O\_OPTM\_DNS\_PRECONNECT |
  |  | 395 | optm-dns\_preconnect = '' |
  |  | 396 |  |
  | 393 | 397 | optm-exc = '' |
  | 394 | 398 |  |
* ## [litespeed-cache/trunk/lang/litespeed-cache.pot](/changeset/2977143/litespeed-cache/trunk/lang/litespeed-cache.pot "Show the changeset 2977143 restricted to litespeed-cache/trunk/lang/litespeed-cache.pot")

  | [r2954001](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L3 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L3 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | msgid "" |
  | 4 | 4 | msgstr "" |
  | 5 |  | "Project-Id-Version: LiteSpeed Cache 5.~~6~~\n" |
  |  | 5 | "Project-Id-Version: LiteSpeed Cache 5.7\n" |
  | 6 | 6 | "Report-Msgid-Bugs-To: https://wordpress.org/support/plugin/litespeed-cache\n" |
  | 7 |  | "POT-Creation-Date: 2023-~~07-26 13:52:36~~+00:00\n" |
  |  | 7 | "POT-Creation-Date: 2023-10-10 13:10:37+00:00\n" |
  | 8 | 8 | "MIME-Version: 1.0\n" |
  | 9 | 9 | "Content-Type: text/plain; charset=UTF-8\n" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L72) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L72) |  |
  | 72 | 72 | msgstr "" |
  | 73 | 73 |  |
  | 74 |  | #: src/admin-display.cls.php:135 src/lang.cls.php:24~~3~~ |
  |  | 74 | #: src/admin-display.cls.php:135 src/lang.cls.php:244 |
  | 75 | 75 | msgid "Crawler" |
  | 76 | 76 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L110) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L110) |  |
  | 110 | 110 | #: src/admin-display.cls.php:238 src/admin-display.cls.php:900 |
  | 111 | 111 | #: src/admin-display.cls.php:929 src/admin-display.cls.php:980 |
  | 112 |  | #: src/doc.cls.php:3~~1~~ tpl/cache/settings-cache.tpl.php:19 |
  |  | 112 | #: src/doc.cls.php:32 tpl/cache/settings-cache.tpl.php:19 |
  | 113 | 113 | #: tpl/cache/settings\_inc.cache\_mobile.tpl.php:71 tpl/cdn/settings.tpl.php:49 |
  | 114 | 114 | #: tpl/page\_optm/settings\_css.tpl.php:189 |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L206) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L206) |  |
  | 206 | 206 | #: src/admin-display.cls.php:1180 tpl/cache/settings-esi.tpl.php:95 |
  | 207 | 207 | #: tpl/page\_optm/settings\_css.tpl.php:192 |
  | 208 |  | #: tpl/page\_optm/settings\_html.tpl.php:~~85~~ |
  |  | 208 | #: tpl/page\_optm/settings\_html.tpl.php:106 |
  | 209 | 209 | #: tpl/page\_optm/settings\_media.tpl.php:245 |
  | 210 | 210 | #: tpl/page\_optm/settings\_media\_exc.tpl.php:26 |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L240) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L240) |  |
  | 240 | 240 | msgstr "" |
  | 241 | 241 |  |
  | 242 |  | #: src/admin-display.cls.php:1198 src/doc.cls.php:9~~6~~ |
  |  | 242 | #: src/admin-display.cls.php:1198 src/doc.cls.php:98 |
  | 243 | 243 | msgid "One per line." |
  | 244 | 244 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L260) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L260) |  |
  | 260 | 260 | msgstr "" |
  | 261 | 261 |  |
  | 262 |  | #: src/admin-settings.cls.php:2~~45 src/admin-settings.cls.php:279~~ |
  |  | 262 | #: src/admin-settings.cls.php:270 src/admin-settings.cls.php:305 |
  | 263 | 263 | msgid "Options saved." |
  | 264 | 264 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L327) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L327) |  |
  | 327 | 327 | msgstr "" |
  | 328 | 328 |  |
  | 329 |  | #: src/cdn-setup.cls.php:322 src/cloud.cls.php:82~~0 src/cloud.cls.php:828~~ |
  | 330 |  | #: src/cloud.cls.php:123~~5~~ |
  |  | 329 | #: src/cdn-setup.cls.php:322 src/cloud.cls.php:822 src/cloud.cls.php:830 |
  |  | 330 | #: src/cloud.cls.php:1237 |
  | 331 | 331 | msgid "Message from QUIC.cloud server" |
  | 332 | 332 | msgstr "" |
  | 333 | 333 |  |
  | 334 | 334 | #: src/cloud.cls.php:394 src/cloud.cls.php:407 src/cloud.cls.php:452 |
  | 335 |  | #: src/cloud.cls.php:477 src/cloud.cls.php:62~~5 src/cloud.cls.php:1204~~ |
  |  | 335 | #: src/cloud.cls.php:477 src/cloud.cls.php:627 src/cloud.cls.php:1206 |
  | 336 | 336 | msgid "Cloud Error" |
  | 337 | 337 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L345) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L345) |  |
  | 345 | 345 | msgstr "" |
  | 346 | 346 |  |
  | 347 |  | #: src/cloud.cls.php:58~~4~~ |
  |  | 347 | #: src/cloud.cls.php:585 |
  | 348 | 348 | msgid "In order to use QC services, need a real domain name, cannot use an IP." |
  | 349 | 349 | msgstr "" |
  | 350 | 350 |  |
  | 351 |  | #: src/cloud.cls.php:62~~5~~ |
  |  | 351 | #: src/cloud.cls.php:627 |
  | 352 | 352 | msgid "Please try after %1$s for service %2$s." |
  | 353 | 353 | msgstr "" |
  | 354 | 354 |  |
  | 355 |  | #: src/cloud.cls.php:71~~5 src/cloud.cls.php:736~~ |
  |  | 355 | #: src/cloud.cls.php:717 src/cloud.cls.php:738 |
  | 356 | 356 | msgid "Failed to request via WordPress" |
  | 357 | 357 | msgstr "" |
  | 358 | 358 |  |
  | 359 |  | #: src/cloud.cls.php:75~~5~~ |
  |  | 359 | #: src/cloud.cls.php:757 |
  | 360 | 360 | msgid "" |
  | 361 | 361 | "Cloud server refused the current request due to unpulled images. Please pull " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L363) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L363) |  |
  | 363 | 363 | msgstr "" |
  | 364 | 364 |  |
  | 365 |  | #: src/cloud.cls.php:76~~0~~ |
  |  | 365 | #: src/cloud.cls.php:762 |
  | 366 | 366 | msgid "" |
  | 367 | 367 | "Your domain\_key has been temporarily blocklisted to prevent abuse. You may " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L369) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L369) |  |
  | 369 | 369 | msgstr "" |
  | 370 | 370 |  |
  | 371 |  | #: src/cloud.cls.php:76~~7~~ |
  |  | 371 | #: src/cloud.cls.php:769 |
  | 372 | 372 | msgid "" |
  | 373 | 373 | "Cloud server refused the current request due to rate limiting. Please try " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L375) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L375) |  |
  | 375 | 375 | msgstr "" |
  | 376 | 376 |  |
  | 377 |  | #: src/cloud.cls.php:77~~5~~ |
  |  | 377 | #: src/cloud.cls.php:777 |
  | 378 | 378 | msgid "Redetected node" |
  | 379 | 379 | msgstr "" |
  | 380 | 380 |  |
  | 381 |  | #: src/cloud.cls.php:78~~3~~ |
  |  | 381 | #: src/cloud.cls.php:785 |
  | 382 | 382 | msgid "" |
  | 383 | 383 | "We are working hard to improve your online service experience. The service " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L385) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L385) |  |
  | 385 | 385 | msgstr "" |
  | 386 | 386 |  |
  | 387 |  | #: src/cloud.cls.php:83~~6~~ |
  |  | 387 | #: src/cloud.cls.php:838 |
  | 388 | 388 | msgid "Good news from QUIC.cloud server" |
  | 389 | 389 | msgstr "" |
  | 390 | 390 |  |
  | 391 |  | #: src/cloud.cls.php:84~~5~~ |
  |  | 391 | #: src/cloud.cls.php:847 |
  | 392 | 392 | msgid "%1$s plugin version %2$s required for this action." |
  | 393 | 393 | msgstr "" |
  | 394 | 394 |  |
  | 395 |  | #: src/cloud.cls.php:90~~2 src/cloud.cls.php:1224~~ |
  |  | 395 | #: src/cloud.cls.php:904 src/cloud.cls.php:1226 |
  | 396 | 396 | msgid "Failed to communicate with QUIC.cloud server" |
  | 397 | 397 | msgstr "" |
  | 398 | 398 |  |
  | 399 |  | #: src/cloud.cls.php:94~~5~~ |
  |  | 399 | #: src/cloud.cls.php:947 |
  | 400 | 400 | msgid "" |
  | 401 | 401 | "Site not recognized. Domain Key has been automatically removed. Please " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L403) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L403) |  |
  | 403 | 403 | msgstr "" |
  | 404 | 404 |  |
  | 405 |  | #: src/cloud.cls.php:94~~6~~ src/error.cls.php:48 |
  |  | 405 | #: src/cloud.cls.php:948 src/error.cls.php:48 |
  | 406 | 406 | msgid "Click here to set." |
  | 407 | 407 | msgstr "" |
  | 408 | 408 |  |
  | 409 |  | #: src/cloud.cls.php:101~~4~~ |
  |  | 409 | #: src/cloud.cls.php:1016 |
  | 410 | 410 | msgid "Cannot request REST API, no token saved." |
  | 411 | 411 | msgstr "" |
  | 412 | 412 |  |
  | 413 |  | #: src/cloud.cls.php:104~~0~~ |
  |  | 413 | #: src/cloud.cls.php:1042 |
  | 414 | 414 | msgid "Cloud REST Error" |
  | 415 | 415 | msgstr "" |
  | 416 | 416 |  |
  | 417 |  | #: src/cloud.cls.php:106~~0~~ |
  |  | 417 | #: src/cloud.cls.php:1062 |
  | 418 | 418 | msgid "Unknown error." |
  | 419 | 419 | msgstr "" |
  | 420 | 420 |  |
  | 421 |  | #: src/cloud.cls.php:106~~4~~ |
  |  | 421 | #: src/cloud.cls.php:1066 |
  | 422 | 422 | msgid "Contact QUIC.cloud support" |
  | 423 | 423 | msgstr "" |
  | 424 | 424 |  |
  | 425 |  | #: src/cloud.cls.php:106~~6~~ |
  |  | 425 | #: src/cloud.cls.php:1068 |
  | 426 | 426 | msgid "Cloud REST API returned error: " |
  | 427 | 427 | msgstr "" |
  | 428 | 428 |  |
  | 429 |  | #: src/cloud.cls.php:124~~3~~ |
  |  | 429 | #: src/cloud.cls.php:1245 |
  | 430 | 430 | msgid "" |
  | 431 | 431 | "Applied for Domain Key successfully. Please wait for result. Domain Key will " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L433) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L433) |  |
  | 433 | 433 | msgstr "" |
  | 434 | 434 |  |
  | 435 |  | #: src/cloud.cls.php:1~~299~~ |
  |  | 435 | #: src/cloud.cls.php:1301 |
  | 436 | 436 | msgid "" |
  | 437 | 437 | "Congratulations, your Domain Key has been approved! The setting has been " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L439) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L439) |  |
  | 439 | 439 | msgstr "" |
  | 440 | 440 |  |
  | 441 |  | #: src/cloud.cls.php:1~~395~~ |
  |  | 441 | #: src/cloud.cls.php:1400 |
  | 442 | 442 | msgid "QUIC.cloud account has been created and successfully linked." |
  | 443 | 443 | msgstr "" |
  | 444 | 444 |  |
  | 445 |  | #: src/cloud.cls.php:1~~396~~ |
  |  | 445 | #: src/cloud.cls.php:1401 |
  | 446 | 446 | msgid "QUIC.cloud account has been successfully linked." |
  | 447 | 447 | msgstr "" |
  | 448 | 448 |  |
  | 449 |  | #: src/cloud.cls.php:140~~4~~ |
  |  | 449 | #: src/cloud.cls.php:1409 |
  | 450 | 450 | msgid "Domain Key hash mismatch" |
  | 451 | 451 | msgstr "" |
  | 452 | 452 |  |
  | 453 |  | #: src/cloud.cls.php:153~~0~~ |
  |  | 453 | #: src/cloud.cls.php:1535 |
  | 454 | 454 | msgid "Sync credit allowance with Cloud Server successfully." |
  | 455 | 455 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L573) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L573) |  |
  | 573 | 573 | msgstr "" |
  | 574 | 574 |  |
  | 575 |  | #: src/doc.cls.php:3~~1~~ |
  | 576 |  | msgid "This setting is ~~passively %1$~~s due to %2$s!" |
  | 577 |  | msgstr "" |
  | 578 |  |  |
  | 579 |  | #: src/doc.cls.php:4~~4~~ |
  |  | 575 | #: src/doc.cls.php:32 |
  |  | 576 | msgid "This setting is %1$s for certain qualifying requests due to %2$s!" |
  |  | 577 | msgstr "" |
  |  | 578 |  |
  |  | 579 | #: src/doc.cls.php:46 |
  | 580 | 580 | msgid "This setting will regenerate crawler list and clear the disabled list!" |
  | 581 | 581 | msgstr "" |
  | 582 | 582 |  |
  | 583 |  | #: src/doc.cls.php:5~~6~~ |
  |  | 583 | #: src/doc.cls.php:58 |
  | 584 | 584 | msgid "" |
  | 585 | 585 | "This site utilizes caching in order to facilitate a faster response time and " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L593) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L593) |  |
  | 593 | 593 | msgstr "" |
  | 594 | 594 |  |
  | 595 |  | #: src/doc.cls.php:5~~7~~ |
  |  | 595 | #: src/doc.cls.php:59 |
  | 596 | 596 | msgid "Please see %s for more details." |
  | 597 | 597 | msgstr "" |
  | 598 | 598 |  |
  | 599 |  | #: src/doc.cls.php:7~~4 src/doc.cls.php:128~~ tpl/cdn/manage.tpl.php:67 |
  |  | 599 | #: src/doc.cls.php:76 src/doc.cls.php:130 tpl/cdn/manage.tpl.php:67 |
  | 600 | 600 | #: tpl/dash/dashboard.tpl.php:46 tpl/img\_optm/summary.tpl.php:48 |
  | 601 | 601 | #: tpl/inc/check\_cache\_disabled.php:42 |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L603) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L603) |  |
  | 603 | 603 | msgstr "" |
  | 604 | 604 |  |
  | 605 |  | #: src/doc.cls.php:11~~2~~ |
  |  | 605 | #: src/doc.cls.php:114 |
  | 606 | 606 | msgid "Both full and partial strings can be used." |
  | 607 | 607 | msgstr "" |
  | 608 | 608 |  |
  | 609 |  | #: src/doc.cls.php:11~~4~~ |
  |  | 609 | #: src/doc.cls.php:116 |
  | 610 | 610 | msgid "Both full URLs and partial strings can be used." |
  | 611 | 611 | msgstr "" |
  | 612 | 612 |  |
  | 613 |  | #: src/doc.cls.php:12~~7~~ |
  |  | 613 | #: src/doc.cls.php:129 |
  | 614 | 614 | msgid "This setting will edit the .htaccess file." |
  | 615 | 615 | msgstr "" |
  | 616 | 616 |  |
  | 617 |  | #: src/doc.cls.php:14~~1~~ |
  |  | 617 | #: src/doc.cls.php:143 |
  | 618 | 618 | msgid "" |
  | 619 | 619 | "For online services to work correctly, you must allowlist all %s server IPs." |
  | 620 | 620 | msgstr "" |
  | 621 | 621 |  |
  | 622 |  | #: src/doc.cls.php:14~~2~~ |
  |  | 622 | #: src/doc.cls.php:144 |
  | 623 | 623 | msgid "" |
  | 624 | 624 | "Before generating key, please verify all IPs on this list are allowlisted" |
  | 625 | 625 | msgstr "" |
  | 626 | 626 |  |
  | 627 |  | #: src/doc.cls.php:14~~3~~ tpl/general/settings.tpl.php:89 |
  |  | 627 | #: src/doc.cls.php:145 tpl/general/settings.tpl.php:89 |
  | 628 | 628 | msgid "Current Online Server IPs" |
  | 629 | 629 | msgstr "" |
  | 630 | 630 |  |
  | 631 |  | #: src/doc.cls.php:15~~6~~ |
  |  | 631 | #: src/doc.cls.php:158 |
  | 632 | 632 | msgid "The queue is processed asynchronously. It may take time." |
  | 633 | 633 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L878) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L878) |  |
  | 878 | 878 | msgstr "" |
  | 879 | 879 |  |
  | 880 |  | #: src/gui.cls.php:556 src/gui.cls.php:716 src/lang.cls.php:17~~5~~ |
  |  | 880 | #: src/gui.cls.php:556 src/gui.cls.php:716 src/lang.cls.php:176 |
  | 881 | 881 | #: tpl/presets/standard.tpl.php:42 tpl/toolbox/purge.tpl.php:106 |
  | 882 | 882 | msgid "Gravatar Cache" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L980) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L980) |  |
  | 980 | 980 | msgstr "" |
  | 981 | 981 |  |
  | 982 |  | #: src/img-optm.cls.php:12~~09~~ |
  |  | 982 | #: src/img-optm.cls.php:1215 |
  | 983 | 983 | msgid "Destroy all optimization data successfully." |
  | 984 | 984 | msgstr "" |
  | 985 | 985 |  |
  | 986 |  | #: src/img-optm.cls.php:127~~0 src/img-optm.cls.php:1332~~ |
  |  | 986 | #: src/img-optm.cls.php:1278 src/img-optm.cls.php:1340 |
  | 987 | 987 | msgid "Rescanned successfully." |
  | 988 | 988 | msgstr "" |
  | 989 | 989 |  |
  | 990 |  | #: src/img-optm.cls.php:13~~32~~ |
  |  | 990 | #: src/img-optm.cls.php:1340 |
  | 991 | 991 | msgid "Rescanned %d images successfully." |
  | 992 | 992 | msgstr "" |
  | 993 | 993 |  |
  | 994 |  | #: src/img-optm.cls.php:1~~397~~ |
  |  | 994 | #: src/img-optm.cls.php:1405 |
  | 995 | 995 | msgid "Calculated backups successfully." |
  | 996 | 996 | msgstr "" |
  | 997 | 997 |  |
  | 998 |  | #: src/img-optm.cls.php:14~~89~~ |
  |  | 998 | #: src/img-optm.cls.php:1497 |
  | 999 | 999 | msgid "Removed backups successfully." |
  | 1000 | 1000 | msgstr "" |
  | 1001 | 1001 |  |
  | 1002 |  | #: src/img-optm.cls.php:16~~74~~ |
  |  | 1002 | #: src/img-optm.cls.php:1682 |
  | 1003 | 1003 | msgid "Switched images successfully." |
  | 1004 | 1004 | msgstr "" |
  | 1005 | 1005 |  |
  | 1006 |  | #: src/img-optm.cls.php:17~~19 src/img-optm.cls.php:1765~~ |
  |  | 1006 | #: src/img-optm.cls.php:1727 src/img-optm.cls.php:1773 |
  | 1007 | 1007 | msgid "Switched to optimized file successfully." |
  | 1008 | 1008 | msgstr "" |
  | 1009 | 1009 |  |
  | 1010 |  | #: src/img-optm.cls.php:17~~38~~ |
  |  | 1010 | #: src/img-optm.cls.php:1746 |
  | 1011 | 1011 | msgid "Disabled WebP file successfully." |
  | 1012 | 1012 | msgstr "" |
  | 1013 | 1013 |  |
  | 1014 |  | #: src/img-optm.cls.php:17~~43~~ |
  |  | 1014 | #: src/img-optm.cls.php:1751 |
  | 1015 | 1015 | msgid "Enabled WebP file successfully." |
  | 1016 | 1016 | msgstr "" |
  | 1017 | 1017 |  |
  | 1018 |  | #: src/img-optm.cls.php:17~~59~~ |
  |  | 1018 | #: src/img-optm.cls.php:1767 |
  | 1019 | 1019 | msgid "Restored original file successfully." |
  | 1020 | 1020 | msgstr "" |
  | 1021 | 1021 |  |
  | 1022 |  | #: src/img-optm.cls.php:18~~16~~ |
  |  | 1022 | #: src/img-optm.cls.php:1824 |
  | 1023 | 1023 | msgid "Reset the optimized data successfully." |
  | 1024 | 1024 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L1357) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L1357) |  |
  | 1357 | 1357 |  |
  | 1358 | 1358 | #: src/lang.cls.php:158 |
  |  | 1359 | msgid "DNS Preconnect" |
  |  | 1360 | msgstr "" |
  |  | 1361 |  |
  |  | 1362 | #: src/lang.cls.php:159 |
  | 1359 | 1363 | msgid "CSS Excludes" |
  | 1360 | 1364 | msgstr "" |
  | 1361 | 1365 |  |
  | 1362 |  | #: src/lang.cls.php:1~~59~~ |
  |  | 1366 | #: src/lang.cls.php:160 |
  | 1363 | 1367 | msgid "JS Delayed Includes" |
  | 1364 | 1368 | msgstr "" |
  | 1365 | 1369 |  |
  | 1366 |  | #: src/lang.cls.php:16~~0~~ |
  |  | 1370 | #: src/lang.cls.php:161 |
  | 1367 | 1371 | msgid "JS Excludes" |
  | 1368 | 1372 | msgstr "" |
  | 1369 | 1373 |  |
  | 1370 |  | #: src/lang.cls.php:16~~1~~ |
  |  | 1374 | #: src/lang.cls.php:162 |
  | 1371 | 1375 | msgid "Remove Query Strings" |
  | 1372 | 1376 | msgstr "" |
  | 1373 | 1377 |  |
  | 1374 |  | #: src/lang.cls.php:16~~2~~ |
  |  | 1378 | #: src/lang.cls.php:163 |
  | 1375 | 1379 | msgid "Load Google Fonts Asynchronously" |
  | 1376 | 1380 | msgstr "" |
  | 1377 | 1381 |  |
  | 1378 |  | #: src/lang.cls.php:16~~3~~ |
  |  | 1382 | #: src/lang.cls.php:164 |
  | 1379 | 1383 | msgid "Remove Google Fonts" |
  | 1380 | 1384 | msgstr "" |
  | 1381 | 1385 |  |
  | 1382 |  | #: src/lang.cls.php:16~~4~~ |
  |  | 1386 | #: src/lang.cls.php:165 |
  | 1383 | 1387 | msgid "Critical CSS Rules" |
  | 1384 | 1388 | msgstr "" |
  | 1385 | 1389 |  |
  | 1386 |  | #: src/lang.cls.php:16~~5~~ |
  |  | 1390 | #: src/lang.cls.php:166 |
  | 1387 | 1391 | msgid "Separate CCSS Cache Post Types" |
  | 1388 | 1392 | msgstr "" |
  | 1389 | 1393 |  |
  | 1390 |  | #: src/lang.cls.php:16~~6~~ |
  |  | 1394 | #: src/lang.cls.php:167 |
  | 1391 | 1395 | msgid "Separate CCSS Cache URIs" |
  | 1392 | 1396 | msgstr "" |
  | 1393 | 1397 |  |
  | 1394 |  | #: src/lang.cls.php:16~~7~~ |
  |  | 1398 | #: src/lang.cls.php:168 |
  | 1395 | 1399 | msgid "JS Deferred / Delayed Excludes" |
  | 1396 | 1400 | msgstr "" |
  | 1397 | 1401 |  |
  | 1398 |  | #: src/lang.cls.php:16~~8~~ |
  |  | 1402 | #: src/lang.cls.php:169 |
  | 1399 | 1403 | msgid "Guest Mode JS Excludes" |
  | 1400 | 1404 | msgstr "" |
  | 1401 | 1405 |  |
  | 1402 |  | #: src/lang.cls.php:1~~69~~ tpl/presets/standard.tpl.php:44 |
  |  | 1406 | #: src/lang.cls.php:170 tpl/presets/standard.tpl.php:44 |
  | 1403 | 1407 | msgid "Remove WordPress Emoji" |
  | 1404 | 1408 | msgstr "" |
  | 1405 | 1409 |  |
  | 1406 |  | #: src/lang.cls.php:17~~0~~ tpl/presets/standard.tpl.php:45 |
  |  | 1410 | #: src/lang.cls.php:171 tpl/presets/standard.tpl.php:45 |
  | 1407 | 1411 | msgid "Remove Noscript Tags" |
  | 1408 | 1412 | msgstr "" |
  | 1409 | 1413 |  |
  | 1410 |  | #: src/lang.cls.php:17~~1~~ |
  |  | 1414 | #: src/lang.cls.php:172 |
  | 1411 | 1415 | msgid "URI Excludes" |
  | 1412 | 1416 | msgstr "" |
  | 1413 | 1417 |  |
  | 1414 |  | #: src/lang.cls.php:17~~2~~ |
  |  | 1418 | #: src/lang.cls.php:173 |
  | 1415 | 1419 | msgid "Optimize for Guests Only" |
  | 1416 | 1420 | msgstr "" |
  | 1417 | 1421 |  |
  | 1418 |  | #: src/lang.cls.php:17~~3~~ |
  |  | 1422 | #: src/lang.cls.php:174 |
  | 1419 | 1423 | msgid "Role Excludes" |
  | 1420 | 1424 | msgstr "" |
  | 1421 | 1425 |  |
  | 1422 |  | #: src/lang.cls.php:17~~6~~ |
  |  | 1426 | #: src/lang.cls.php:177 |
  | 1423 | 1427 | msgid "Gravatar Cache Cron" |
  | 1424 | 1428 | msgstr "" |
  | 1425 | 1429 |  |
  | 1426 |  | #: src/lang.cls.php:17~~7~~ |
  |  | 1430 | #: src/lang.cls.php:178 |
  | 1427 | 1431 | msgid "Gravatar Cache TTL" |
  | 1428 | 1432 | msgstr "" |
  | 1429 | 1433 |  |
  | 1430 |  | #: src/lang.cls.php:1~~79~~ |
  |  | 1434 | #: src/lang.cls.php:180 |
  | 1431 | 1435 | msgid "Lazy Load Images" |
  | 1432 | 1436 | msgstr "" |
  | 1433 | 1437 |  |
  | 1434 |  | #: src/lang.cls.php:18~~0~~ |
  |  | 1438 | #: src/lang.cls.php:181 |
  | 1435 | 1439 | msgid "Lazy Load Image Excludes" |
  | 1436 | 1440 | msgstr "" |
  | 1437 | 1441 |  |
  | 1438 |  | #: src/lang.cls.php:18~~1~~ |
  |  | 1442 | #: src/lang.cls.php:182 |
  | 1439 | 1443 | msgid "Lazy Load Image Class Name Excludes" |
  | 1440 | 1444 | msgstr "" |
  | 1441 | 1445 |  |
  | 1442 |  | #: src/lang.cls.php:18~~2~~ |
  |  | 1446 | #: src/lang.cls.php:183 |
  | 1443 | 1447 | msgid "Lazy Load Image Parent Class Name Excludes" |
  | 1444 | 1448 | msgstr "" |
  | 1445 | 1449 |  |
  | 1446 |  | #: src/lang.cls.php:18~~3~~ |
  |  | 1450 | #: src/lang.cls.php:184 |
  | 1447 | 1451 | msgid "Lazy Load Iframe Class Name Excludes" |
  | 1448 | 1452 | msgstr "" |
  | 1449 | 1453 |  |
  | 1450 |  | #: src/lang.cls.php:18~~4~~ |
  |  | 1454 | #: src/lang.cls.php:185 |
  | 1451 | 1455 | msgid "Lazy Load Iframe Parent Class Name Excludes" |
  | 1452 | 1456 | msgstr "" |
  | 1453 | 1457 |  |
  | 1454 |  | #: src/lang.cls.php:18~~5~~ |
  |  | 1458 | #: src/lang.cls.php:186 |
  | 1455 | 1459 | msgid "Lazy Load URI Excludes" |
  | 1456 | 1460 | msgstr "" |
  | 1457 | 1461 |  |
  | 1458 |  | #: src/lang.cls.php:18~~6~~ |
  |  | 1462 | #: src/lang.cls.php:187 |
  | 1459 | 1463 | msgid "LQIP Excludes" |
  | 1460 | 1464 | msgstr "" |
  | 1461 | 1465 |  |
  | 1462 |  | #: src/lang.cls.php:18~~7~~ |
  |  | 1466 | #: src/lang.cls.php:188 |
  | 1463 | 1467 | msgid "Basic Image Placeholder" |
  | 1464 | 1468 | msgstr "" |
  | 1465 | 1469 |  |
  | 1466 |  | #: src/lang.cls.php:18~~8~~ |
  |  | 1470 | #: src/lang.cls.php:189 |
  | 1467 | 1471 | msgid "Responsive Placeholder" |
  | 1468 | 1472 | msgstr "" |
  | 1469 | 1473 |  |
  | 1470 |  | #: src/lang.cls.php:1~~89~~ |
  |  | 1474 | #: src/lang.cls.php:190 |
  | 1471 | 1475 | msgid "Responsive Placeholder Color" |
  | 1472 | 1476 | msgstr "" |
  | 1473 | 1477 |  |
  | 1474 |  | #: src/lang.cls.php:19~~0~~ |
  |  | 1478 | #: src/lang.cls.php:191 |
  | 1475 | 1479 | msgid "Responsive Placeholder SVG" |
  | 1476 | 1480 | msgstr "" |
  | 1477 | 1481 |  |
  | 1478 |  | #: src/lang.cls.php:19~~1~~ |
  |  | 1482 | #: src/lang.cls.php:192 |
  | 1479 | 1483 | msgid "LQIP Cloud Generator" |
  | 1480 | 1484 | msgstr "" |
  | 1481 | 1485 |  |
  | 1482 |  | #: src/lang.cls.php:19~~2~~ |
  |  | 1486 | #: src/lang.cls.php:193 |
  | 1483 | 1487 | msgid "LQIP Quality" |
  | 1484 | 1488 | msgstr "" |
  | 1485 | 1489 |  |
  | 1486 |  | #: src/lang.cls.php:19~~3~~ |
  |  | 1490 | #: src/lang.cls.php:194 |
  | 1487 | 1491 | msgid "LQIP Minimum Dimensions" |
  | 1488 | 1492 | msgstr "" |
  | 1489 | 1493 |  |
  | 1490 |  | #: src/lang.cls.php:19~~5~~ |
  |  | 1494 | #: src/lang.cls.php:196 |
  | 1491 | 1495 | msgid "Generate LQIP In Background" |
  | 1492 | 1496 | msgstr "" |
  | 1493 | 1497 |  |
  | 1494 |  | #: src/lang.cls.php:19~~6~~ |
  |  | 1498 | #: src/lang.cls.php:197 |
  | 1495 | 1499 | msgid "Lazy Load Iframes" |
  | 1496 | 1500 | msgstr "" |
  | 1497 | 1501 |  |
  | 1498 |  | #: src/lang.cls.php:19~~7~~ |
  |  | 1502 | #: src/lang.cls.php:198 |
  | 1499 | 1503 | msgid "Add Missing Sizes" |
  | 1500 | 1504 | msgstr "" |
  | 1501 | 1505 |  |
  | 1502 |  | #: src/lang.cls.php:19~~8~~ src/metabox.cls.php:31 src/metabox.cls.php:32 |
  |  | 1506 | #: src/lang.cls.php:199 src/metabox.cls.php:31 src/metabox.cls.php:32 |
  | 1503 | 1507 | #: tpl/page\_optm/settings\_vpi.tpl.php:12 |
  | 1504 | 1508 | msgid "Viewport Images" |
  | 1505 | 1509 | msgstr "" |
  | 1506 | 1510 |  |
  | 1507 |  | #: src/lang.cls.php:~~199~~ |
  |  | 1511 | #: src/lang.cls.php:200 |
  | 1508 | 1512 | msgid "Viewport Images Cron" |
  | 1509 | 1513 | msgstr "" |
  | 1510 | 1514 |  |
  | 1511 |  | #: src/lang.cls.php:20~~1~~ |
  |  | 1515 | #: src/lang.cls.php:202 |
  | 1512 | 1516 | msgid "Auto Request Cron" |
  | 1513 | 1517 | msgstr "" |
  | 1514 | 1518 |  |
  | 1515 |  | #: src/lang.cls.php:20~~2~~ |
  |  | 1519 | #: src/lang.cls.php:203 |
  | 1516 | 1520 | msgid "Auto Pull Cron" |
  | 1517 | 1521 | msgstr "" |
  | 1518 | 1522 |  |
  | 1519 |  | #: src/lang.cls.php:20~~3~~ |
  |  | 1523 | #: src/lang.cls.php:204 |
  | 1520 | 1524 | msgid "Optimize Original Images" |
  | 1521 | 1525 | msgstr "" |
  | 1522 | 1526 |  |
  | 1523 |  | #: src/lang.cls.php:20~~4~~ |
  |  | 1527 | #: src/lang.cls.php:205 |
  | 1524 | 1528 | msgid "Remove Original Backups" |
  | 1525 | 1529 | msgstr "" |
  | 1526 | 1530 |  |
  | 1527 |  | #: src/lang.cls.php:20~~5~~ |
  |  | 1531 | #: src/lang.cls.php:206 |
  | 1528 | 1532 | msgid "Image WebP Replacement" |
  | 1529 | 1533 | msgstr "" |
  | 1530 | 1534 |  |
  | 1531 |  | #: src/lang.cls.php:20~~6~~ |
  |  | 1535 | #: src/lang.cls.php:207 |
  | 1532 | 1536 | msgid "Optimize Losslessly" |
  | 1533 | 1537 | msgstr "" |
  | 1534 | 1538 |  |
  | 1535 |  | #: src/lang.cls.php:20~~7~~ |
  |  | 1539 | #: src/lang.cls.php:208 |
  | 1536 | 1540 | msgid "Preserve EXIF/XMP data" |
  | 1537 | 1541 | msgstr "" |
  | 1538 | 1542 |  |
  | 1539 |  | #: src/lang.cls.php:20~~8~~ |
  |  | 1543 | #: src/lang.cls.php:209 |
  | 1540 | 1544 | msgid "WebP Attribute To Replace" |
  | 1541 | 1545 | msgstr "" |
  | 1542 | 1546 |  |
  | 1543 |  | #: src/lang.cls.php:2~~09~~ |
  |  | 1547 | #: src/lang.cls.php:210 |
  | 1544 | 1548 | msgid "WebP For Extra srcset" |
  | 1545 | 1549 | msgstr "" |
  | 1546 | 1550 |  |
  | 1547 |  | #: src/lang.cls.php:21~~0~~ |
  |  | 1551 | #: src/lang.cls.php:211 |
  | 1548 | 1552 | msgid "WordPress Image Quality Control" |
  | 1549 | 1553 | msgstr "" |
  | 1550 | 1554 |  |
  | 1551 |  | #: src/lang.cls.php:21~~1~~ tpl/esi\_widget\_edit.php:36 |
  |  | 1555 | #: src/lang.cls.php:212 tpl/esi\_widget\_edit.php:36 |
  | 1552 | 1556 | msgid "Enable ESI" |
  | 1553 | 1557 | msgstr "" |
  | 1554 | 1558 |  |
  | 1555 |  | #: src/lang.cls.php:21~~2~~ |
  |  | 1559 | #: src/lang.cls.php:213 |
  | 1556 | 1560 | msgid "Cache Admin Bar" |
  | 1557 | 1561 | msgstr "" |
  | 1558 | 1562 |  |
  | 1559 |  | #: src/lang.cls.php:21~~3~~ |
  |  | 1563 | #: src/lang.cls.php:214 |
  | 1560 | 1564 | msgid "Cache Comment Form" |
  | 1561 | 1565 | msgstr "" |
  | 1562 | 1566 |  |
  | 1563 |  | #: src/lang.cls.php:21~~4~~ |
  |  | 1567 | #: src/lang.cls.php:215 |
  | 1564 | 1568 | msgid "ESI Nonces" |
  | 1565 | 1569 | msgstr "" |
  | 1566 | 1570 |  |
  | 1567 |  | #: src/lang.cls.php:21~~5~~ tpl/page\_optm/settings\_css.tpl.php:121 |
  |  | 1571 | #: src/lang.cls.php:216 tpl/page\_optm/settings\_css.tpl.php:121 |
  | 1568 | 1572 | #: tpl/page\_optm/settings\_css.tpl.php:238 tpl/page\_optm/settings\_vpi.tpl.php:67 |
  | 1569 | 1573 | msgid "Vary Group" |
  | 1570 | 1574 | msgstr "" |
  | 1571 | 1575 |  |
  | 1572 |  | #: src/lang.cls.php:21~~6~~ |
  |  | 1576 | #: src/lang.cls.php:217 |
  | 1573 | 1577 | msgid "Purge All Hooks" |
  | 1574 | 1578 | msgstr "" |
  | 1575 | 1579 |  |
  | 1576 |  | #: src/lang.cls.php:21~~7~~ |
  |  | 1580 | #: src/lang.cls.php:218 |
  | 1577 | 1581 | msgid "Improve HTTP/HTTPS Compatibility" |
  | 1578 | 1582 | msgstr "" |
  | 1579 | 1583 |  |
  | 1580 |  | #: src/lang.cls.php:21~~8~~ |
  |  | 1584 | #: src/lang.cls.php:219 |
  | 1581 | 1585 | msgid "Instant Click" |
  | 1582 | 1586 | msgstr "" |
  | 1583 | 1587 |  |
  | 1584 |  | #: src/lang.cls.php:2~~19~~ |
  |  | 1588 | #: src/lang.cls.php:220 |
  | 1585 | 1589 | msgid "Do Not Cache Cookies" |
  | 1586 | 1590 | msgstr "" |
  | 1587 | 1591 |  |
  | 1588 |  | #: src/lang.cls.php:22~~0~~ |
  |  | 1592 | #: src/lang.cls.php:221 |
  | 1589 | 1593 | msgid "Do Not Cache User Agents" |
  | 1590 | 1594 | msgstr "" |
  | 1591 | 1595 |  |
  | 1592 |  | #: src/lang.cls.php:22~~1~~ |
  |  | 1596 | #: src/lang.cls.php:222 |
  | 1593 | 1597 | msgid "Login Cookie" |
  | 1594 | 1598 | msgstr "" |
  | 1595 | 1599 |  |
  | 1596 |  | #: src/lang.cls.php:22~~3~~ |
  |  | 1600 | #: src/lang.cls.php:224 |
  | 1597 | 1601 | msgid "Frontend Heartbeat Control" |
  | 1598 | 1602 | msgstr "" |
  | 1599 | 1603 |  |
  | 1600 |  | #: src/lang.cls.php:22~~4~~ |
  |  | 1604 | #: src/lang.cls.php:225 |
  | 1601 | 1605 | msgid "Frontend Heartbeat TTL" |
  | 1602 | 1606 | msgstr "" |
  | 1603 | 1607 |  |
  | 1604 |  | #: src/lang.cls.php:22~~5~~ |
  |  | 1608 | #: src/lang.cls.php:226 |
  | 1605 | 1609 | msgid "Backend Heartbeat Control" |
  | 1606 | 1610 | msgstr "" |
  | 1607 | 1611 |  |
  | 1608 |  | #: src/lang.cls.php:22~~6~~ |
  |  | 1612 | #: src/lang.cls.php:227 |
  | 1609 | 1613 | msgid "Backend Heartbeat TTL" |
  | 1610 | 1614 | msgstr "" |
  | 1611 | 1615 |  |
  | 1612 |  | #: src/lang.cls.php:22~~7~~ |
  |  | 1616 | #: src/lang.cls.php:228 |
  | 1613 | 1617 | msgid "Editor Heartbeat" |
  | 1614 | 1618 | msgstr "" |
  | 1615 | 1619 |  |
  | 1616 |  | #: src/lang.cls.php:22~~8~~ |
  |  | 1620 | #: src/lang.cls.php:229 |
  | 1617 | 1621 | msgid "Editor Heartbeat TTL" |
  | 1618 | 1622 | msgstr "" |
  | 1619 | 1623 |  |
  | 1620 |  | #: src/lang.cls.php:23~~0~~ |
  |  | 1624 | #: src/lang.cls.php:231 |
  | 1621 | 1625 | msgid "QUIC.cloud CDN" |
  | 1622 | 1626 | msgstr "" |
  | 1623 | 1627 |  |
  | 1624 |  | #: src/lang.cls.php:23~~1~~ |
  |  | 1628 | #: src/lang.cls.php:232 |
  | 1625 | 1629 | msgid "Use CDN Mapping" |
  | 1626 | 1630 | msgstr "" |
  | 1627 | 1631 |  |
  | 1628 |  | #: src/lang.cls.php:23~~2~~ |
  |  | 1632 | #: src/lang.cls.php:233 |
  | 1629 | 1633 | msgid "CDN URL" |
  | 1630 | 1634 | msgstr "" |
  | 1631 | 1635 |  |
  | 1632 |  | #: src/lang.cls.php:23~~3~~ |
  |  | 1636 | #: src/lang.cls.php:234 |
  | 1633 | 1637 | msgid "Include Images" |
  | 1634 | 1638 | msgstr "" |
  | 1635 | 1639 |  |
  | 1636 |  | #: src/lang.cls.php:23~~4~~ |
  |  | 1640 | #: src/lang.cls.php:235 |
  | 1637 | 1641 | msgid "Include CSS" |
  | 1638 | 1642 | msgstr "" |
  | 1639 | 1643 |  |
  | 1640 |  | #: src/lang.cls.php:23~~5~~ |
  |  | 1644 | #: src/lang.cls.php:236 |
  | 1641 | 1645 | msgid "Include JS" |
  | 1642 | 1646 | msgstr "" |
  | 1643 | 1647 |  |
  | 1644 |  | #: src/lang.cls.php:23~~6~~ tpl/cdn/settings.tpl.php:102 |
  |  | 1648 | #: src/lang.cls.php:237 tpl/cdn/settings.tpl.php:102 |
  | 1645 | 1649 | msgid "Include File Types" |
  | 1646 | 1650 | msgstr "" |
  | 1647 | 1651 |  |
  | 1648 |  | #: src/lang.cls.php:23~~7~~ |
  |  | 1652 | #: src/lang.cls.php:238 |
  | 1649 | 1653 | msgid "HTML Attribute To Replace" |
  | 1650 | 1654 | msgstr "" |
  | 1651 | 1655 |  |
  | 1652 |  | #: src/lang.cls.php:23~~8~~ |
  |  | 1656 | #: src/lang.cls.php:239 |
  | 1653 | 1657 | msgid "Original URLs" |
  | 1654 | 1658 | msgstr "" |
  | 1655 | 1659 |  |
  | 1656 |  | #: src/lang.cls.php:2~~39~~ |
  |  | 1660 | #: src/lang.cls.php:240 |
  | 1657 | 1661 | msgid "Included Directories" |
  | 1658 | 1662 | msgstr "" |
  | 1659 | 1663 |  |
  | 1660 |  | #: src/lang.cls.php:24~~0~~ |
  |  | 1664 | #: src/lang.cls.php:241 |
  | 1661 | 1665 | msgid "Exclude Path" |
  | 1662 | 1666 | msgstr "" |
  | 1663 | 1667 |  |
  | 1664 |  | #: src/lang.cls.php:24~~1~~ |
  |  | 1668 | #: src/lang.cls.php:242 |
  | 1665 | 1669 | msgid "Cloudflare API" |
  | 1666 | 1670 | msgstr "" |
  | 1667 | 1671 |  |
  | 1668 |  | #: src/lang.cls.php:24~~4~~ |
  |  | 1672 | #: src/lang.cls.php:245 |
  | 1669 | 1673 | msgid "Delay" |
  | 1670 | 1674 | msgstr "" |
  | 1671 | 1675 |  |
  | 1672 |  | #: src/lang.cls.php:24~~5~~ |
  |  | 1676 | #: src/lang.cls.php:246 |
  | 1673 | 1677 | msgid "Run Duration" |
  | 1674 | 1678 | msgstr "" |
  | 1675 | 1679 |  |
  | 1676 |  | #: src/lang.cls.php:24~~6~~ |
  |  | 1680 | #: src/lang.cls.php:247 |
  | 1677 | 1681 | msgid "Interval Between Runs" |
  | 1678 | 1682 | msgstr "" |
  | 1679 | 1683 |  |
  | 1680 |  | #: src/lang.cls.php:24~~7~~ |
  |  | 1684 | #: src/lang.cls.php:248 |
  | 1681 | 1685 | msgid "Crawl Interval" |
  | 1682 | 1686 | msgstr "" |
  | 1683 | 1687 |  |
  | 1684 |  | #: src/lang.cls.php:24~~8~~ |
  |  | 1688 | #: src/lang.cls.php:249 |
  | 1685 | 1689 | msgid "Threads" |
  | 1686 | 1690 | msgstr "" |
  | 1687 | 1691 |  |
  | 1688 |  | #: src/lang.cls.php:2~~49~~ |
  |  | 1692 | #: src/lang.cls.php:250 |
  | 1689 | 1693 | msgid "Timeout" |
  | 1690 | 1694 | msgstr "" |
  | 1691 | 1695 |  |
  | 1692 |  | #: src/lang.cls.php:25~~0~~ |
  |  | 1696 | #: src/lang.cls.php:251 |
  | 1693 | 1697 | msgid "Server Load Limit" |
  | 1694 | 1698 | msgstr "" |
  | 1695 | 1699 |  |
  | 1696 |  | #: src/lang.cls.php:25~~1~~ |
  |  | 1700 | #: src/lang.cls.php:252 |
  | 1697 | 1701 | msgid "Role Simulation" |
  | 1698 | 1702 | msgstr "" |
  | 1699 | 1703 |  |
  | 1700 |  | #: src/lang.cls.php:25~~2~~ |
  |  | 1704 | #: src/lang.cls.php:253 |
  | 1701 | 1705 | msgid "Cookie Simulation" |
  | 1702 | 1706 | msgstr "" |
  | 1703 | 1707 |  |
  | 1704 |  | #: src/lang.cls.php:25~~3~~ |
  |  | 1708 | #: src/lang.cls.php:254 |
  | 1705 | 1709 | msgid "Custom Sitemap" |
  | 1706 | 1710 | msgstr "" |
  | 1707 | 1711 |  |
  | 1708 |  | #: src/lang.cls.php:25~~4~~ |
  |  | 1712 | #: src/lang.cls.php:255 |
  | 1709 | 1713 | msgid "Drop Domain from Sitemap" |
  | 1710 | 1714 | msgstr "" |
  | 1711 | 1715 |  |
  | 1712 |  | #: src/lang.cls.php:25~~5~~ |
  |  | 1716 | #: src/lang.cls.php:256 |
  | 1713 | 1717 | msgid "Sitemap Timeout" |
  | 1714 | 1718 | msgstr "" |
  | 1715 | 1719 |  |
  | 1716 |  | #: src/lang.cls.php:25~~7~~ tpl/inc/disabled\_all.php:5 |
  |  | 1720 | #: src/lang.cls.php:258 tpl/inc/disabled\_all.php:5 |
  | 1717 | 1721 | msgid "Disable All Features" |
  | 1718 | 1722 | msgstr "" |
  | 1719 | 1723 |  |
  | 1720 |  | #: src/lang.cls.php:25~~8~~ tpl/toolbox/log\_viewer.tpl.php:11 |
  |  | 1724 | #: src/lang.cls.php:259 tpl/toolbox/log\_viewer.tpl.php:11 |
  | 1721 | 1725 | msgid "Debug Log" |
  | 1722 | 1726 | msgstr "" |
  | 1723 | 1727 |  |
  | 1724 |  | #: src/lang.cls.php:2~~59~~ |
  |  | 1728 | #: src/lang.cls.php:260 |
  | 1725 | 1729 | msgid "Admin IPs" |
  | 1726 | 1730 | msgstr "" |
  | 1727 | 1731 |  |
  | 1728 |  | #: src/lang.cls.php:26~~0~~ |
  |  | 1732 | #: src/lang.cls.php:261 |
  | 1729 | 1733 | msgid "Debug Level" |
  | 1730 | 1734 | msgstr "" |
  | 1731 | 1735 |  |
  | 1732 |  | #: src/lang.cls.php:26~~1~~ |
  |  | 1736 | #: src/lang.cls.php:262 |
  | 1733 | 1737 | msgid "Log File Size Limit" |
  | 1734 | 1738 | msgstr "" |
  | 1735 | 1739 |  |
  | 1736 |  | #: src/lang.cls.php:26~~2~~ |
  |  | 1740 | #: src/lang.cls.php:263 |
  | 1737 | 1741 | msgid "Log Cookies" |
  | 1738 | 1742 | msgstr "" |
  | 1739 | 1743 |  |
  | 1740 |  | #: src/lang.cls.php:26~~3~~ |
  |  | 1744 | #: src/lang.cls.php:264 |
  | 1741 | 1745 | msgid "Collapse Query Strings" |
  | 1742 | 1746 | msgstr "" |
  | 1743 | 1747 |  |
  | 1744 |  | #: src/lang.cls.php:26~~4~~ |
  |  | 1748 | #: src/lang.cls.php:265 |
  | 1745 | 1749 | msgid "Debug URI Includes" |
  | 1746 | 1750 | msgstr "" |
  | 1747 | 1751 |  |
  | 1748 |  | #: src/lang.cls.php:26~~5~~ |
  |  | 1752 | #: src/lang.cls.php:266 |
  | 1749 | 1753 | msgid "Debug URI Excludes" |
  | 1750 | 1754 | msgstr "" |
  | 1751 | 1755 |  |
  | 1752 |  | #: src/lang.cls.php:26~~6~~ |
  |  | 1756 | #: src/lang.cls.php:267 |
  | 1753 | 1757 | msgid "Debug String Excludes" |
  | 1754 | 1758 | msgstr "" |
  | 1755 | 1759 |  |
  | 1756 |  | #: src/lang.cls.php:26~~8~~ |
  |  | 1760 | #: src/lang.cls.php:269 |
  | 1757 | 1761 | msgid "Revisions Max Number" |
  | 1758 | 1762 | msgstr "" |
  | 1759 | 1763 |  |
  | 1760 |  | #: src/lang.cls.php:2~~69~~ |
  |  | 1764 | #: src/lang.cls.php:270 |
  | 1761 | 1765 | msgid "Revisions Max Age" |
  | 1762 | 1766 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L1988) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L1992) |  |
  | 1988 | 1992 | msgstr "" |
  | 1989 | 1993 |  |
  | 1990 |  | #: thirdparty/litespeed-check.cls.php:~~111~~ |
  |  | 1994 | #: thirdparty/litespeed-check.cls.php:74 thirdparty/litespeed-check.cls.php:136 |
  | 1991 | 1995 | msgid "" |
  | 1992 | 1996 | "Please consider disabling the following detected plugins, as they may " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L1994) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L1998) |  |
  | 1994 | 1998 | msgstr "" |
  | 1995 | 1999 |  |
  | 1996 |  | #: thirdparty/woocommerce.content.tpl.php:1~~6~~ |
  |  | 2000 | #: thirdparty/woocommerce.content.tpl.php:17 |
  | 1997 | 2001 | msgid "WooCommerce Settings" |
  | 1998 | 2002 | msgstr "" |
  | 1999 | 2003 |  |
  | 2000 |  | #: thirdparty/woocommerce.content.tpl.php:2~~1~~ |
  |  | 2004 | #: thirdparty/woocommerce.content.tpl.php:22 |
  | 2001 | 2005 | #: tpl/cache/settings-advanced.tpl.php:12 |
  | 2002 | 2006 | #: tpl/cache/settings\_inc.browser.tpl.php:12 tpl/toolbox/heartbeat.tpl.php:14 |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L2005) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L2009) |  |
  | 2005 | 2009 | msgstr "" |
  | 2006 | 2010 |  |
  | 2007 |  | #: thirdparty/woocommerce.content.tpl.php:2~~2~~ |
  |  | 2011 | #: thirdparty/woocommerce.content.tpl.php:23 |
  | 2008 | 2012 | msgid "After verifying that the cache works in general, please test the cart." |
  | 2009 | 2013 | msgstr "" |
  | 2010 | 2014 |  |
  | 2011 |  | #: thirdparty/woocommerce.content.tpl.php:2~~3~~ |
  |  | 2015 | #: thirdparty/woocommerce.content.tpl.php:24 |
  | 2012 | 2016 | msgid "To test the cart, visit the <a %s>FAQ</a>." |
  | 2013 | 2017 | msgstr "" |
  | 2014 | 2018 |  |
  | 2015 |  | #: thirdparty/woocommerce.content.tpl.php:2~~4~~ |
  |  | 2019 | #: thirdparty/woocommerce.content.tpl.php:25 |
  | 2016 | 2020 | msgid "" |
  | 2017 | 2021 | "By default, the My Account, Checkout, and Cart pages are automatically " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L2020) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L2024) |  |
  | 2020 | 2024 | msgstr "" |
  | 2021 | 2025 |  |
  | 2022 |  | #: thirdparty/woocommerce.content.tpl.php:3~~1~~ |
  |  | 2026 | #: thirdparty/woocommerce.content.tpl.php:33 |
  | 2023 | 2027 | msgid "Product Update Interval" |
  | 2024 | 2028 | msgstr "" |
  | 2025 | 2029 |  |
  | 2026 |  | #: thirdparty/woocommerce.content.tpl.php:3~~6~~ |
  |  | 2030 | #: thirdparty/woocommerce.content.tpl.php:38 |
  | 2027 | 2031 | msgid "Purge product on changes to the quantity or stock status." |
  | 2028 | 2032 | msgstr "" |
  | 2029 | 2033 |  |
  | 2030 |  | #: thirdparty/woocommerce.content.tpl.php:3~~6~~ |
  |  | 2034 | #: thirdparty/woocommerce.content.tpl.php:38 |
  | 2031 | 2035 | msgid "Purge categories only when stock status changes." |
  | 2032 | 2036 | msgstr "" |
  | 2033 | 2037 |  |
  | 2034 |  | #: thirdparty/woocommerce.content.tpl.php:3~~7~~ |
  |  | 2038 | #: thirdparty/woocommerce.content.tpl.php:39 |
  | 2035 | 2039 | msgid "Purge product and categories only when the stock status changes." |
  | 2036 | 2040 | msgstr "" |
  | 2037 | 2041 |  |
  | 2038 |  | #: thirdparty/woocommerce.content.tpl.php:~~38~~ |
  |  | 2042 | #: thirdparty/woocommerce.content.tpl.php:40 |
  | 2039 | 2043 | msgid "Purge product only when the stock status changes." |
  | 2040 | 2044 | msgstr "" |
  | 2041 | 2045 |  |
  | 2042 |  | #: thirdparty/woocommerce.content.tpl.php:~~38~~ |
  |  | 2046 | #: thirdparty/woocommerce.content.tpl.php:40 |
  | 2043 | 2047 | msgid "Do not purge categories on changes to the quantity or stock status." |
  | 2044 | 2048 | msgstr "" |
  | 2045 | 2049 |  |
  | 2046 |  | #: thirdparty/woocommerce.content.tpl.php:~~39~~ |
  |  | 2050 | #: thirdparty/woocommerce.content.tpl.php:41 |
  | 2047 | 2051 | msgid "" |
  | 2048 | 2052 | "Always purge both product and categories on changes to the quantity or stock " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L2050) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L2054) |  |
  | 2050 | 2054 | msgstr "" |
  | 2051 | 2055 |  |
  | 2052 |  | #: thirdparty/woocommerce.content.tpl.php:5~~2~~ |
  |  | 2056 | #: thirdparty/woocommerce.content.tpl.php:54 |
  | 2053 | 2057 | msgid "" |
  | 2054 | 2058 | "Determines how changes in product quantity and product stock status affect " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L2056) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L2060) |  |
  | 2056 | 2060 | msgstr "" |
  | 2057 | 2061 |  |
  |  | 2062 | #: thirdparty/woocommerce.content.tpl.php:62 |
  |  | 2063 | msgid "Vary for Mini Cart" |
  |  | 2064 | msgstr "" |
  |  | 2065 |  |
  |  | 2066 | #: thirdparty/woocommerce.content.tpl.php:69 |
  |  | 2067 | msgid "" |
  |  | 2068 | "Generate a separate vary cache copy for the mini cart when the cart is not " |
  |  | 2069 | "empty." |
  |  | 2070 | msgstr "" |
  |  | 2071 |  |
  |  | 2072 | #: thirdparty/woocommerce.content.tpl.php:70 |
  |  | 2073 | msgid "" |
  |  | 2074 | "If your theme does not use JS to update the mini cart, you must enable this " |
  |  | 2075 | "option to display the correct cart contents." |
  |  | 2076 | msgstr "" |
  |  | 2077 |  |
  | 2058 | 2078 | #: thirdparty/woocommerce.tab.tpl.php:3 |
  | 2059 | 2079 | msgid "WooCommerce" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L2084) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L2104) |  |
  | 2084 | 2104 | msgstr "" |
  | 2085 | 2105 |  |
  | 2086 |  | #. #-#-#-#-#  litespeed-cache.pot (LiteSpeed Cache 5.~~6~~)  #-#-#-#-# |
  |  | 2106 | #. #-#-#-#-#  litespeed-cache.pot (LiteSpeed Cache 5.7)  #-#-#-#-# |
  | 2087 | 2107 | #. Plugin Name of the plugin/theme |
  | 2088 | 2108 | #: tpl/banner/new\_version.php:57 tpl/banner/new\_version\_dev.tpl.php:12 |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L4853) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L4873) |  |
  | 4853 | 4873 | msgstr "" |
  | 4854 | 4874 |  |
  | 4855 |  | #: tpl/page\_optm/entry.tpl.php:8 tpl/page\_optm/settings\_html.tpl.php:~~7~~ |
  |  | 4875 | #: tpl/page\_optm/entry.tpl.php:8 tpl/page\_optm/settings\_html.tpl.php:9 |
  | 4856 | 4876 | msgid "HTML Settings" |
  | 4857 | 4877 | msgstr "" |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L4954) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L4974) |  |
  | 4954 | 4974 |  |
  | 4955 | 4975 | #: tpl/page\_optm/settings\_css.tpl.php:185 |
  | 4956 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~29~~ tpl/page\_optm/settings\_js.tpl.php:73 |
  |  | 4976 | #: tpl/page\_optm/settings\_html.tpl.php:150 tpl/page\_optm/settings\_js.tpl.php:73 |
  | 4957 | 4977 | msgid "" |
  | 4958 | 4978 | "This can improve your speed score in services like Pingdom, GTmetrix and " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L5014) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L5034) |  |
  | 5014 | 5034 | msgstr "" |
  | 5015 | 5035 |  |
  | 5016 |  | #: tpl/page\_optm/settings\_html.tpl.php:2~~0~~ |
  |  | 5036 | #: tpl/page\_optm/settings\_html.tpl.php:23 |
  | 5017 | 5037 | msgid "Minify HTML content." |
  | 5018 | 5038 | msgstr "" |
  | 5019 | 5039 |  |
  | 5020 |  | #: tpl/page\_optm/settings\_html.tpl.php:3~~3~~ |
  |  | 5040 | #: tpl/page\_optm/settings\_html.tpl.php:36 |
  | 5021 | 5041 | msgid "Prefetching DNS can reduce latency for visitors." |
  | 5022 | 5042 | msgstr "" |
  | 5023 | 5043 |  |
  | 5024 |  | #: tpl/page\_optm/settings\_html.tpl.php:34 |
  |  | 5044 | #: tpl/page\_optm/settings\_html.tpl.php:37 |
  |  | 5045 | #: tpl/page\_optm/settings\_html.tpl.php:68 |
  | 5025 | 5046 | msgid "For example" |
  | 5026 | 5047 | msgstr "" |
  | 5027 | 5048 |  |
  | 5028 |  | #: tpl/page\_optm/settings\_html.tpl.php:~~49~~ |
  |  | 5049 | #: tpl/page\_optm/settings\_html.tpl.php:52 |
  | 5029 | 5050 | msgid "" |
  | 5030 | 5051 | "Automatically enable DNS prefetching for all URLs in the document, including " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L5032) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L5053) |  |
  | 5032 | 5053 | msgstr "" |
  | 5033 | 5054 |  |
  | 5034 |  | #: tpl/page\_optm/settings\_html.tpl.php:5~~0~~ |
  |  | 5055 | #: tpl/page\_optm/settings\_html.tpl.php:53 |
  | 5035 | 5056 | msgid "This can improve the page loading speed." |
  | 5036 | 5057 | msgstr "" |
  | 5037 | 5058 |  |
  | 5038 |  | #: tpl/page\_optm/settings\_html.tpl.php:64 |
  |  | 5059 | #: tpl/page\_optm/settings\_html.tpl.php:67 |
  |  | 5060 | msgid "Preconnecting speeds up future loads from a given origin." |
  |  | 5061 | msgstr "" |
  |  | 5062 |  |
  |  | 5063 | #: tpl/page\_optm/settings\_html.tpl.php:83 |
  | 5039 | 5064 | msgid "Delay rendering off-screen HTML elements by its selector." |
  | 5040 | 5065 | msgstr "" |
  | 5041 | 5066 |  |
  | 5042 |  | #: tpl/page\_optm/settings\_html.tpl.php:~~79~~ |
  |  | 5067 | #: tpl/page\_optm/settings\_html.tpl.php:98 |
  | 5043 | 5068 | msgid "Remove query strings from internal static resources." |
  | 5044 | 5069 | msgstr "" |
  | 5045 | 5070 |  |
  | 5046 |  | #: tpl/page\_optm/settings\_html.tpl.php:~~8~~2 |
  |  | 5071 | #: tpl/page\_optm/settings\_html.tpl.php:102 |
  | 5047 | 5072 | msgid "Google reCAPTCHA will be bypassed automatically." |
  | 5048 | 5073 | msgstr "" |
  | 5049 | 5074 |  |
  | 5050 |  | #: tpl/page\_optm/settings\_html.tpl.php:~~86~~ |
  |  | 5075 | #: tpl/page\_optm/settings\_html.tpl.php:107 |
  | 5051 | 5076 | msgid "Append query string %s to the resources to bypass this action." |
  | 5052 | 5077 | msgstr "" |
  | 5053 | 5078 |  |
  | 5054 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~00~~ |
  |  | 5079 | #: tpl/page\_optm/settings\_html.tpl.php:121 |
  | 5055 | 5080 | msgid "" |
  | 5056 | 5081 | "Use Web Font Loader library to load Google Fonts asynchronously while " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L5058) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L5083) |  |
  | 5058 | 5083 | msgstr "" |
  | 5059 | 5084 |  |
  | 5060 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~01~~ |
  |  | 5085 | #: tpl/page\_optm/settings\_html.tpl.php:122 |
  | 5061 | 5086 | msgid "" |
  | 5062 | 5087 | "This will also add a preconnect to Google Fonts to establish a connection " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L5064) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L5089) |  |
  | 5064 | 5089 | msgstr "" |
  | 5065 | 5090 |  |
  | 5066 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~15~~ |
  |  | 5091 | #: tpl/page\_optm/settings\_html.tpl.php:136 |
  | 5067 | 5092 | msgid "Prevent Google Fonts from loading on all pages." |
  | 5068 | 5093 | msgstr "" |
  | 5069 | 5094 |  |
  | 5070 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~28~~ |
  |  | 5095 | #: tpl/page\_optm/settings\_html.tpl.php:149 |
  | 5071 | 5096 | msgid "" |
  | 5072 | 5097 | "Stop loading WordPress.org emoji. Browser default emoji will be displayed " |
  | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2954001#L5074) | […](/browser/litespeed-cache/trunk/lang/litespeed-cache.pot?rev=2977143#L5099) |  |
  | 5074 | 5099 | msgstr "" |
  | 5075 | 5100 |  |
  | 5076 |  | #: tpl/page\_optm/settings\_html.tpl.php:1~~42~~ |
  |  | 5101 | #: tpl/page\_optm/settings\_html.tpl.php:163 |
  | 5077 | 5102 | msgid "This option will remove all %s tags from HTML." |
  | 5078 | 5103 | msgstr "" |
* ## [litespeed-cache/trunk/lib/guest.cls.php](/changeset/2977143/litespeed-cache/trunk/lib/guest.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/lib/guest.cls.php")

  | [r2574982](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L1 "Show revision 2574982 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | namespace LiteSpeed\Lib; |
  | 3 | 4 |  |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L7) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L8) |  |
  | 7 | 8 | \* @since 4.1 |
  | 8 | 9 | \*/ |
  | 9 |  | class Guest { |
  |  | 10 | class Guest |
  |  | 11 | { |
  | 10 | 12 | const CONF\_FILE = '.litespeed\_conf.dat'; |
  | 11 | 13 | const HASH                  = 'hash'; // Not set-able |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L26) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L28) |  |
  | 26 | 28 | \* @since 4.1 |
  | 27 | 29 | \*/ |
  | 28 |  | public function \_\_construct() { |
  | 29 |  | ! defined( 'LSCWP\_CONTENT\_FOLDER' ) && define( 'LSCWP\_CONTENT\_FOLDER', dirname( dirname( dirname( \_\_DIR\_\_ ) ) ) ); |
  |  | 30 | public function \_\_construct() |
  |  | 31 | { |
  |  | 32 | !defined('LSCWP\_CONTENT\_FOLDER') && define('LSCWP\_CONTENT\_FOLDER', dirname(dirname(dirname(\_\_DIR\_\_)))); |
  | 30 | 33 | // Load config |
  | 31 |  | $this->\_conf = file\_get\_contents(~~LSCWP\_CONTENT\_FOLDER . '/' . self::CONF\_FILE~~ ); |
  | 32 |  | if (~~$this->\_conf~~ ) { |
  | 33 |  | $this->\_conf = json\_decode(~~$this->\_conf, true~~ ); |
  |  | 34 | $this->\_conf = file\_get\_contents(LSCWP\_CONTENT\_FOLDER . '/' . self::CONF\_FILE); |
  |  | 35 | if ($this->\_conf) { |
  |  | 36 | $this->\_conf = json\_decode($this->\_conf, true); |
  | 34 | 37 | } |
  | 35 | 38 |  |
  | 36 |  | if (~~! empty( $this->\_conf[ self::O\_CACHE\_LOGIN\_COOKIE ] )~~ ) { |
  | 37 |  | self::$\_vary\_name = $this->\_conf[~~self::O\_CACHE\_LOGIN\_COOKIE~~ ]; |
  |  | 39 | if (!empty($this->\_conf[self::O\_CACHE\_LOGIN\_COOKIE])) { |
  |  | 40 | self::$\_vary\_name = $this->\_conf[self::O\_CACHE\_LOGIN\_COOKIE]; |
  | 38 | 41 | } |
  | 39 | 42 | } |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L44) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L47) |  |
  | 44 | 47 | \* @since  4.0 |
  | 45 | 48 | \*/ |
  | 46 |  | public function update\_guest\_vary() { |
  |  | 49 | public function update\_guest\_vary() |
  |  | 50 | { |
  | 47 | 51 | // This process must not be cached |
  | 48 |  | header( 'X-LiteSpeed-Cache-Control: no-cache' ); |
  |  | 52 | /\*\* |
  |  | 53 | \* @reference https://wordpress.org/support/topic/soft-404-from-google-search-on-litespeed-cache-guest-vary-php/#post-16838583 |
  |  | 54 | \*/ |
  |  | 55 | header('X-Robots-Tag: noindex'); |
  |  | 56 | header('X-LiteSpeed-Cache-Control: no-cache'); |
  | 49 | 57 |  |
  | 50 |  | if (~~$this->always\_guest()~~ ) { |
  |  | 58 | if ($this->always\_guest()) { |
  | 51 | 59 | echo '[]'; |
  | 52 | 60 | exit; |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L54) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L62) |  |
  | 54 | 62 |  |
  | 55 | 63 | // If contains vary already, don't reload to avoid infinite loop when parent page having browser cache |
  | 56 |  | if (~~$this->\_conf && self::has\_vary()~~ ) { |
  |  | 64 | if ($this->\_conf && self::has\_vary()) { |
  | 57 | 65 | echo '[]'; |
  | 58 | 66 | exit; |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L61) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L69) |  |
  | 61 | 69 | // Send vary cookie |
  | 62 | 70 | $vary = 'guest\_mode:1'; |
  | 63 |  | if (~~$this->\_conf && empty( $this->\_conf[ self::O\_DEBUG ] )~~ ) { |
  | 64 |  | $vary = md5(~~$this->\_conf[ self::HASH ] . $vary~~ ); |
  |  | 71 | if ($this->\_conf && empty($this->\_conf[self::O\_DEBUG])) { |
  |  | 72 | $vary = md5($this->\_conf[self::HASH] . $vary); |
  | 65 | 73 | } |
  | 66 | 74 |  |
  | 67 | 75 | $expire = time() + 2 \* 86400; |
  | 68 |  | $is\_ssl = !~~empty( $this->\_conf[ self::O\_UTIL\_NO\_HTTPS\_VARY ]~~ ) ? false : $this->is\_ssl(); |
  | 69 |  | setcookie(~~self::$\_vary\_name, $vary, $expire, '/', false, $is\_ssl, true~~ ); |
  |  | 76 | $is\_ssl = !empty($this->\_conf[self::O\_UTIL\_NO\_HTTPS\_VARY]) ? false : $this->is\_ssl(); |
  |  | 77 | setcookie(self::$\_vary\_name, $vary, $expire, '/', false, $is\_ssl, true); |
  | 70 | 78 |  |
  | 71 | 79 | // return json |
  | 72 |  | echo json\_encode(~~array( 'reload' => 'yes' )~~ ); |
  |  | 80 | echo json\_encode(array('reload' => 'yes')); |
  | 73 | 81 | exit; |
  | 74 | 82 | } |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L79) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L87) |  |
  | 79 | 87 | \* @since 4.1 |
  | 80 | 88 | \*/ |
  | 81 |  | private function is\_ssl() { |
  | 82 |  | if ( isset( $\_SERVER['HTTPS'] ) ) { |
  | 83 |  | if ( 'on' === strtolower( $\_SERVER['HTTPS'] ) ) { |
  |  | 89 | private function is\_ssl() |
  |  | 90 | { |
  |  | 91 | if (isset($\_SERVER['HTTPS'])) { |
  |  | 92 | if ('on' === strtolower($\_SERVER['HTTPS'])) { |
  | 84 | 93 | return true; |
  | 85 | 94 | } |
  | 86 | 95 |  |
  | 87 |  | if (~~'1' == $\_SERVER['HTTPS']~~ ) { |
  |  | 96 | if ('1' == $\_SERVER['HTTPS']) { |
  | 88 | 97 | return true; |
  | 89 | 98 | } |
  | 90 |  | } elseif (~~isset( $\_SERVER['SERVER\_PORT'] ) && ( '443' == $\_SERVER['SERVER\_PORT'] )~~ ) { |
  |  | 99 | } elseif (isset($\_SERVER['SERVER\_PORT']) && ('443' == $\_SERVER['SERVER\_PORT'])) { |
  | 91 | 100 | return true; |
  | 92 | 101 | } |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L100) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L109) |  |
  | 100 | 109 | \* @access public |
  | 101 | 110 | \*/ |
  | 102 |  | public static function has\_vary() { |
  | 103 |  | if ( empty( $\_COOKIE[ self::$\_vary\_name ] ) ) { |
  |  | 111 | public static function has\_vary() |
  |  | 112 | { |
  |  | 113 | if (empty($\_COOKIE[self::$\_vary\_name])) { |
  | 104 | 114 | return false; |
  | 105 | 115 | } |
  | 106 |  | return $\_COOKIE[~~self::$\_vary\_name~~ ]; |
  |  | 116 | return $\_COOKIE[self::$\_vary\_name]; |
  | 107 | 117 | } |
  | 108 | 118 |  |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L112) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L122) |  |
  | 112 | 122 | \* @since  4.0 |
  | 113 | 123 | \*/ |
  | 114 |  | public function always\_guest() { |
  | 115 |  | if ( empty( $\_SERVER[ 'HTTP\_USER\_AGENT' ] ) ) { |
  |  | 124 | public function always\_guest() |
  |  | 125 | { |
  |  | 126 | if (empty($\_SERVER['HTTP\_USER\_AGENT'])) { |
  | 116 | 127 | return false; |
  | 117 | 128 | } |
  | 118 | 129 |  |
  | 119 |  | if (~~$this->\_conf[ self::O\_GUEST\_UAS ]~~ ) { |
  |  | 130 | if ($this->\_conf[self::O\_GUEST\_UAS]) { |
  | 120 | 131 | $quoted\_uas = array(); |
  | 121 |  | foreach (~~$this->\_conf[ self::O\_GUEST\_UAS ] as $v~~ ) { |
  | 122 |  | $quoted\_uas[] = preg\_quote(~~$v, '#'~~ ); |
  |  | 132 | foreach ($this->\_conf[self::O\_GUEST\_UAS] as $v) { |
  |  | 133 | $quoted\_uas[] = preg\_quote($v, '#'); |
  | 123 | 134 | } |
  | 124 |  | $match = preg\_match(~~'#' . implode( '|', $quoted\_uas ) . '#i', $\_SERVER[ 'HTTP\_USER\_AGENT' ]~~ ); |
  | 125 |  | if (~~$match~~ ) { |
  |  | 135 | $match = preg\_match('#' . implode('|', $quoted\_uas) . '#i', $\_SERVER['HTTP\_USER\_AGENT']); |
  |  | 136 | if ($match) { |
  | 126 | 137 | return true; |
  | 127 | 138 | } |
  | 128 | 139 | } |
  | 129 | 140 |  |
  | 130 |  | if (~~$this->ip\_access( $this->\_conf[ self::O\_GUEST\_IPS ] )~~ ) { |
  |  | 141 | if ($this->ip\_access($this->\_conf[self::O\_GUEST\_IPS])) { |
  | 131 | 142 | return true; |
  | 132 | 143 | } |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L141) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L152) |  |
  | 141 | 152 | \* @access public |
  | 142 | 153 | \*/ |
  | 143 |  | public function ip\_access( $ip\_list ) { |
  | 144 |  | if ( ! $ip\_list ) { |
  |  | 154 | public function ip\_access($ip\_list) |
  |  | 155 | { |
  |  | 156 | if (!$ip\_list) { |
  | 145 | 157 | return false; |
  | 146 | 158 | } |
  | 147 |  | if (~~! isset( self::$\_ip )~~ ) { |
  |  | 159 | if (!isset(self::$\_ip)) { |
  | 148 | 160 | self::$\_ip = self::get\_ip(); |
  | 149 | 161 | } |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L155) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L167) |  |
  | 155 | 167 | //  for($i = 0; $i <= 3; $i++) if($ip[$i] == '\*') $ip\_list[$key][$i] = $uip[$i]; |
  | 156 | 168 | // } |
  | 157 |  | return in\_array(~~self::$\_ip, $ip\_list~~ ); |
  |  | 169 | return in\_array(self::$\_ip, $ip\_list); |
  | 158 | 170 | } |
  | 159 | 171 |  |
  | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2574982#L166) | […](/browser/litespeed-cache/trunk/lib/guest.cls.php?rev=2977143#L178) |  |
  | 166 | 178 | \* @return string |
  | 167 | 179 | \*/ |
  | 168 |  | public static function get\_ip() { |
  |  | 180 | public static function get\_ip() |
  |  | 181 | { |
  | 169 | 182 | $\_ip = ''; |
  | 170 |  | if (~~function\_exists( 'apache\_request\_headers' )~~ ) { |
  |  | 183 | if (function\_exists('apache\_request\_headers')) { |
  | 171 | 184 | $apache\_headers = apache\_request\_headers(); |
  | 172 |  | $\_ip = !~~empty( $apache\_headers['True-Client-IP']~~ ) ? $apache\_headers['True-Client-IP'] : false; |
  | 173 |  | if (~~! $\_ip~~ ) { |
  | 174 |  | $\_ip = !~~empty( $apache\_headers['X-Forwarded-For']~~ ) ? $apache\_headers['X-Forwarded-For'] : false; |
  | 175 |  | $\_ip = explode(~~',', $\_ip~~ ); |
  | 176 |  | $\_ip = $\_ip[~~0~~ ]; |
  |  | 185 | $\_ip = !empty($apache\_headers['True-Client-IP']) ? $apache\_headers['True-Client-IP'] : false; |
  |  | 186 | if (!$\_ip) { |
  |  | 187 | $\_ip = !empty($apache\_headers['X-Forwarded-For']) ? $apache\_headers['X-Forwarded-For'] : false; |
  |  | 188 | $\_ip = explode(',', $\_ip); |
  |  | 189 | $\_ip = $\_ip[0]; |
  | 177 | 190 | } |
  | 178 |  |  |
  | 179 | 191 | } |
  | 180 | 192 |  |
  | 181 |  | if (~~! $\_ip~~ ) { |
  | 182 |  | $\_ip = !~~empty( $\_SERVER['REMOTE\_ADDR']~~ ) ? $\_SERVER['REMOTE\_ADDR'] : false; |
  |  | 193 | if (!$\_ip) { |
  |  | 194 | $\_ip = !empty($\_SERVER['REMOTE\_ADDR']) ? $\_SERVER['REMOTE\_ADDR'] : false; |
  | 183 | 195 | } |
  | 184 | 196 | return $\_ip; |
  | 185 | 197 | } |
  | 186 |  |  |
  | 187 |  |  |
  | 188 | 198 | } |
* ## [litespeed-cache/trunk/litespeed-cache.php](/changeset/2977143/litespeed-cache/trunk/litespeed-cache.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/litespeed-cache.php")

  | [r2954001](/browser/litespeed-cache/trunk/litespeed-cache.php?rev=2954001#L5 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/litespeed-cache.php?rev=2977143#L5 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Plugin URI:        https://www.litespeedtech.com/products/cache-plugins/wordpress-acceleration |
  | 6 | 6 | \* Description:       High-performance page caching and site optimization from LiteSpeed |
  | 7 |  | \* Version:           5.~~6~~ |
  |  | 7 | \* Version:           5.7 |
  | 8 | 8 | \* Author:            LiteSpeed Technologies |
  | 9 | 9 | \* Author URI:        https://www.litespeedtech.com |
  | […](/browser/litespeed-cache/trunk/litespeed-cache.php?rev=2954001#L35) | […](/browser/litespeed-cache/trunk/litespeed-cache.php?rev=2977143#L35) |  |
  | 35 | 35 | } |
  | 36 | 36 |  |
  | 37 |  | !defined('LSCWP\_V') && define('LSCWP\_V', '5.~~6~~'); |
  |  | 37 | !defined('LSCWP\_V') && define('LSCWP\_V', '5.7'); |
  | 38 | 38 |  |
  | 39 | 39 | !defined('LSCWP\_CONTENT\_DIR') && define('LSCWP\_CONTENT\_DIR', WP\_CONTENT\_DIR); |
* ## [litespeed-cache/trunk/readme.txt](/changeset/2977143/litespeed-cache/trunk/readme.txt "Show the changeset 2977143 restricted to litespeed-cache/trunk/readme.txt")

  | [r2954001](/browser/litespeed-cache/trunk/readme.txt?rev=2954001#L3 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/readme.txt?rev=2977143#L3 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Tags: caching, optimize, performance, pagespeed, core web vitals, seo, speed, image optimize, compress, object cache, redis, memcached, database cleaner |
  | 4 | 4 | Requires at least: 4.0 |
  | 5 |  | Tested up to: 6.3 |
  | 6 |  | Stable tag: 5.~~6~~ |
  |  | 5 | Tested up to: 6.3.1 |
  |  | 6 | Stable tag: 5.7 |
  | 7 | 7 | License: GPLv3 |
  | 8 | 8 | License URI: http://www.gnu.org/licenses/gpl.html |
  | […](/browser/litespeed-cache/trunk/readme.txt?rev=2954001#L251) | […](/browser/litespeed-cache/trunk/readme.txt?rev=2977143#L251) |  |
  | 251 | 251 | == Changelog == |
  | 252 | 252 |  |
  | 253 |  | = 5.6 - Aug 15 2023 = |
  |  | 253 | = 5.7 - Oct 10 2023 = |
  |  | 254 | \* 🌱\*\*Page Optimize\*\* New option available: Preconnect. (xguiboy/Mukesh Patel) |
  |  | 255 | \* 🌱\*\*3rd\*\* New Vary for Mini Cart option for Woocommerce. (Ruikai) |
  |  | 256 | \* \*\*Cloud\*\* Force syncing the configuration to QUIC.cloud if CDN is reenabled. |
  |  | 257 | \* \*\*Cloud\*\* Force syncing the configuration to QUIC.cloud if domain key is readded. |
  |  | 258 | \* \*\*Cloud\*\* Limit multi-line fields when posting to QC. |
  |  | 259 | \* \*\*Cache\*\* Treat HEAD requests as cacheable as GET. (George Wang) |
  |  | 260 | \* 🐞\*\*ESI\*\* Patched a possible vulnerability issue. (István Márton@Wordfence #841011) |
  |  | 261 | \* 🐞\*\*ESI\*\* Overwrite SCRIPT\_URI to prevent ESI sub request resulting in redirections. (Tobolo) |
  |  | 262 | \* 🐞\*\*Image Optimize\*\* Bypass unnecessary image processing when images were only partially optimized. (Ruikai) |
  |  | 263 | \* 🐞\*\*Guest\*\* Guest mode will not enable WebP directly anymore. (Michael Heymann) |
  |  | 264 | \* \*\*CDN\*\* Auto disable CDN if CDN URL is invalid. (Ruikai) |
  |  | 265 | \* \*\*CDN\*\* Fixed a null parameter warning for PHP v8.1 (#584) |
  |  | 266 | \* \*\*API\*\* Added `litespeed\_media\_add\_missing\_sizes` filter to allow bypassing Media's "add missing sizes" option (for Guest Optimization and otherwise). (PR #564) |
  |  | 267 | \* \*\*Guest\*\* Fixed soft 404 and robots.txt report for guest.vary.php. |
  |  | 268 | \* \*\*Vary\*\* Enabled `litespeed\_vary\_cookies` for LSWS Enterprise. |
  |  | 269 | \* \*\*GUI\*\* Stopped WebP tip from wrongly displaying when Guest Mode is off. |
  |  | 270 | \* \*\*GUI\*\* Added QUIC.cloud promotion postbox on dashboard page. |
  |  | 271 | \* \*\*3rd\*\* Added `pagespeed ninja` to blocklist due to its bad bahavior. |
  |  | 272 |  |
  |  | 273 | = 5.6 - Aug 1 2023 = |
  | 254 | 274 | \* 🌱\*\*Page Optimize\*\* New JS Delay Includes option. (Mitchell Krog/Gerard Reches/Ignacy Hołoga) |
  | 255 | 275 | \* \*\*Crawler\*\* Sitemap can use search for URL now. |
* ## [litespeed-cache/trunk/src/admin-settings.cls.php](/changeset/2977143/litespeed-cache/trunk/src/admin-settings.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/admin-settings.cls.php")

  | [r2761310](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L1 "Show revision 2761310 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* The admin settings handler of the plugin. |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L9) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L10) |  |
  | 9 | 10 | \* @author     LiteSpeed Technologies <info@litespeedtech.com> |
  | 10 | 11 | \*/ |
  |  | 12 |  |
  | 11 | 13 | namespace LiteSpeed; |
  | 12 |  | defined( 'WPINC' ) || exit; |
  | 13 |  |  |
  | 14 |  | class Admin\_Settings extends Base { |
  |  | 14 |  |
  |  | 15 | defined('WPINC') || exit; |
  |  | 16 |  |
  |  | 17 | class Admin\_Settings extends Base |
  |  | 18 | { |
  | 15 | 19 | const ENROLL = '\_settings-enroll'; |
  | 16 | 20 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L25) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L29) |  |
  | 25 | 29 | \* @access public |
  | 26 | 30 | \*/ |
  | 27 |  | public function save( $raw\_data ) { |
  | 28 |  | Debug2::debug( '[Settings] saving' ); |
  | 29 |  |  |
  | 30 |  | if ( empty( $raw\_data[ self::ENROLL ] ) ) { |
  | 31 |  | exit( 'No fields' ); |
  | 32 |  | } |
  | 33 |  |  |
  | 34 |  | $raw\_data = Admin::cleanup\_text( $raw\_data ); |
  |  | 31 | public function save($raw\_data) |
  |  | 32 | { |
  |  | 33 | Debug2::debug('[Settings] saving'); |
  |  | 34 |  |
  |  | 35 | if (empty($raw\_data[self::ENROLL])) { |
  |  | 36 | exit('No fields'); |
  |  | 37 | } |
  |  | 38 |  |
  |  | 39 | $raw\_data = Admin::cleanup\_text($raw\_data); |
  | 35 | 40 |  |
  | 36 | 41 | // Convert data to config format |
  | 37 | 42 | $the\_matrix = array(); |
  | 38 |  | foreach (~~array\_unique( $raw\_data[ self::ENROLL ] ) as $id~~ ) { |
  |  | 43 | foreach (array\_unique($raw\_data[self::ENROLL]) as $id) { |
  | 39 | 44 | $child = false; |
  | 40 | 45 | // Drop array format |
  | 41 |  | if ( strpos( $id, '[' ) !== false ) { |
  | 42 |  | if ( strpos( $id, self::O\_CDN\_MAPPING ) === 0 || strpos( $id, self::O\_CRAWLER\_COOKIES ) === 0 ) { // CDN child | Cookie Crawler settings |
  | 43 |  | $child = substr( $id, strpos( $id, '[' ) + 1, strpos( $id, ']' ) - strpos( $id, '[' ) - 1 ); |
  | 44 |  | $id = substr( $id, 0, strpos( $id, '[' ) ); // Drop ending []; Compatible with xx[0] way from CLI |
  | 45 |  | } |
  | 46 |  | else { |
  | 47 |  | $id = substr( $id, 0, strpos( $id, '[' ) ); // Drop ending [] |
  | 48 |  | } |
  | 49 |  | } |
  | 50 |  |  |
  | 51 |  | if ( ! array\_key\_exists( $id, self::$\_default\_options ) ) { |
  |  | 46 | if (strpos($id, '[') !== false) { |
  |  | 47 | if (strpos($id, self::O\_CDN\_MAPPING) === 0 || strpos($id, self::O\_CRAWLER\_COOKIES) === 0) { // CDN child | Cookie Crawler settings |
  |  | 48 | $child = substr($id, strpos($id, '[') + 1, strpos($id, ']') - strpos($id, '[') - 1); |
  |  | 49 | $id = substr($id, 0, strpos($id, '[')); // Drop ending []; Compatible with xx[0] way from CLI |
  |  | 50 | } else { |
  |  | 51 | $id = substr($id, 0, strpos($id, '[')); // Drop ending [] |
  |  | 52 | } |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | if (!array\_key\_exists($id, self::$\_default\_options)) { |
  | 52 | 56 | continue; |
  | 53 | 57 | } |
  | 54 | 58 |  |
  | 55 | 59 | // Validate $child |
  | 56 |  | if (~~$id == self::O\_CDN\_MAPPING~~ ) { |
  | 57 |  | if (~~! in\_array(~~ $child, array( |
  |  | 60 | if ($id == self::O\_CDN\_MAPPING) { |
  |  | 61 | if (!in\_array($child, array( |
  | 58 | 62 | self::CDN\_MAPPING\_URL, |
  | 59 | 63 | self::CDN\_MAPPING\_INC\_IMG, |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L61) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L65) |  |
  | 61 | 65 | self::CDN\_MAPPING\_INC\_JS, |
  | 62 | 66 | self::CDN\_MAPPING\_FILETYPE, |
  | 63 |  | )~~)~~ ) { |
  |  | 67 | ))) { |
  | 64 | 68 | continue; |
  | 65 | 69 | } |
  | 66 | 70 | } |
  | 67 |  | if (~~$id == self::O\_CRAWLER\_COOKIES~~ ) { |
  | 68 |  | if (~~! in\_array(~~ $child, array( |
  |  | 71 | if ($id == self::O\_CRAWLER\_COOKIES) { |
  |  | 72 | if (!in\_array($child, array( |
  | 69 | 73 | self::CRWL\_COOKIE\_NAME, |
  | 70 | 74 | self::CRWL\_COOKIE\_VALS, |
  | 71 |  | )~~)~~ ) { |
  |  | 75 | ))) { |
  | 72 | 76 | continue; |
  | 73 | 77 | } |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L76) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L80) |  |
  | 76 | 80 | $data = false; |
  | 77 | 81 |  |
  | 78 |  | if ( $child ) { |
  | 79 |  | $data = ! empty( $raw\_data[ $id ][ $child ] ) ? $raw\_data[ $id ][ $child ] : false; // []=xxx or [0]=xxx |
  | 80 |  | } |
  | 81 |  | else { |
  | 82 |  | $data = ! empty( $raw\_data[ $id ] ) ? $raw\_data[ $id ] : false; |
  |  | 82 | if ($child) { |
  |  | 83 | $data = !empty($raw\_data[$id][$child]) ? $raw\_data[$id][$child] : false; // []=xxx or [0]=xxx |
  |  | 84 | } else { |
  |  | 85 | $data = !empty($raw\_data[$id]) ? $raw\_data[$id] : false; |
  | 83 | 86 | } |
  | 84 | 87 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L86) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L89) |  |
  | 86 | 89 | \* Sanitize the value |
  | 87 | 90 | \*/ |
  | 88 |  | if (~~$id == self::O\_CDN\_MAPPING || $id == self::O\_CRAWLER\_COOKIES~~ ) { |
  |  | 91 | if ($id == self::O\_CDN\_MAPPING || $id == self::O\_CRAWLER\_COOKIES) { |
  | 89 | 92 | // Use existing in queue data if existed (Only available when $child != false) |
  | 90 |  | $data2 = array\_key\_exists(~~$id, $the\_matrix ) ? $the\_matrix[ $id ] : ( defined( 'WP\_CLI' ) && WP\_CLI ? $this->conf( $id ) : array()~~ ); |
  | 91 |  | } |
  | 92 |  | switch (~~$id~~ ) { |
  |  | 93 | $data2 = array\_key\_exists($id, $the\_matrix) ? $the\_matrix[$id] : (defined('WP\_CLI') && WP\_CLI ? $this->conf($id) : array()); |
  |  | 94 | } |
  |  | 95 | switch ($id) { |
  | 93 | 96 | case self::O\_CDN\_MAPPING: |
  | 94 | 97 | /\*\* |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L104) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L107) |  |
  | 104 | 107 | \*      cdn-mapping[ 2 ][ url ] = 'xxx2' |
  | 105 | 108 | \*/ |
  | 106 |  | if ( $data ) foreach ( $data as $k => $v ) { |
  | 107 |  | if ( $child == self::CDN\_MAPPING\_FILETYPE ) { |
  | 108 |  | $v = Utility::sanitize\_lines( $v ); |
  | 109 |  | } |
  | 110 |  | if ( $child == self::CDN\_MAPPING\_URL ) { |
  | 111 |  | $v = trailingslashit( $v ); |
  | 112 |  | } |
  | 113 |  | if ( in\_array( $child, array( |
  |  | 109 | if ($data) foreach ($data as $k => $v) { |
  |  | 110 | if ($child == self::CDN\_MAPPING\_FILETYPE) { |
  |  | 111 | $v = Utility::sanitize\_lines($v); |
  |  | 112 | } |
  |  | 113 | if ($child == self::CDN\_MAPPING\_URL) { |
  |  | 114 | # If not a valid URL, turn off CDN |
  |  | 115 | if (strpos($v, 'https://') !== 0) { |
  |  | 116 | self::debug('❌ CDN mapping set to OFF due to invalid URL'); |
  |  | 117 | $the\_matrix[self::O\_CDN] = false; |
  |  | 118 | } |
  |  | 119 | $v = trailingslashit($v); |
  |  | 120 | } |
  |  | 121 | if (in\_array($child, array( |
  | 114 | 122 | self::CDN\_MAPPING\_INC\_IMG, |
  | 115 | 123 | self::CDN\_MAPPING\_INC\_CSS, |
  | 116 | 124 | self::CDN\_MAPPING\_INC\_JS, |
  | 117 |  | )~~)~~ ) { |
  |  | 125 | ))) { |
  | 118 | 126 | // Because these can't be auto detected in `config->update()`, need to format here |
  | 119 | 127 | $v = $v === 'false' ? 0 : (bool) $v; |
  | 120 | 128 | } |
  | 121 | 129 |  |
  | 122 |  | if (~~empty( $data2[ $k ] )~~ ) { |
  | 123 |  | $data2[~~$k~~ ] = array(); |
  | 124 |  | } |
  | 125 |  |  |
  | 126 |  | $data2[~~$k ][ $child~~ ] = $v; |
  |  | 130 | if (empty($data2[$k])) { |
  |  | 131 | $data2[$k] = array(); |
  |  | 132 | } |
  |  | 133 |  |
  |  | 134 | $data2[$k][$child] = $v; |
  | 127 | 135 | } |
  | 128 | 136 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L147) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L155) |  |
  | 147 | 155 | \* empty line for `vals` use literal `\_null` |
  | 148 | 156 | \*/ |
  | 149 |  | if (~~$data ) foreach ( $data as $k => $v~~ ) { |
  | 150 |  | if (~~$child == self::CRWL\_COOKIE\_VALS~~ ) { |
  | 151 |  | $v = Utility::sanitize\_lines(~~$v~~ ); |
  | 152 |  | } |
  | 153 |  |  |
  | 154 |  | if (~~empty( $data2[ $k ] )~~ ) { |
  | 155 |  | $data2[~~$k~~ ] = array(); |
  | 156 |  | } |
  | 157 |  |  |
  | 158 |  | $data2[~~$k ][ $child~~ ] = $v; |
  |  | 157 | if ($data) foreach ($data as $k => $v) { |
  |  | 158 | if ($child == self::CRWL\_COOKIE\_VALS) { |
  |  | 159 | $v = Utility::sanitize\_lines($v); |
  |  | 160 | } |
  |  | 161 |  |
  |  | 162 | if (empty($data2[$k])) { |
  |  | 163 | $data2[$k] = array(); |
  |  | 164 | } |
  |  | 165 |  |
  |  | 166 | $data2[$k][$child] = $v; |
  | 159 | 167 | } |
  | 160 | 168 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L162) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L170) |  |
  | 162 | 170 | break; |
  | 163 | 171 |  |
  | 164 |  | // Cache exclude cat |
  |  | 172 | // Cache exclude cat |
  | 165 | 173 | case self::O\_CACHE\_EXC\_CAT: |
  | 166 | 174 | $data2 = array(); |
  | 167 |  | $data = Utility::sanitize\_lines(~~$data~~ ); |
  | 168 |  | foreach (~~$data as $v~~ ) { |
  | 169 |  | $cat\_id = get\_cat\_ID(~~$v~~ ); |
  | 170 |  | if (~~! $cat\_id~~ ) { |
  |  | 175 | $data = Utility::sanitize\_lines($data); |
  |  | 176 | foreach ($data as $v) { |
  |  | 177 | $cat\_id = get\_cat\_ID($v); |
  |  | 178 | if (!$cat\_id) { |
  | 171 | 179 | continue; |
  | 172 | 180 | } |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L177) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L185) |  |
  | 177 | 185 | break; |
  | 178 | 186 |  |
  | 179 |  | // Cache exclude tag |
  | 180 |  | case self::O\_CACHE\_EXC\_TAG: |
  |  | 187 | // Cache exclude tag |
  |  | 188 | case self::O\_CACHE\_EXC\_TAG: |
  | 181 | 189 | $data2 = array(); |
  | 182 |  | $data = Utility::sanitize\_lines(~~$data~~ ); |
  | 183 |  | foreach (~~$data as $v~~ ) { |
  | 184 |  | $term = get\_term\_by(~~'name', $v, 'post\_tag'~~ ); |
  | 185 |  | if (~~! $term~~ ) { |
  |  | 190 | $data = Utility::sanitize\_lines($data); |
  |  | 191 | foreach ($data as $v) { |
  |  | 192 | $term = get\_term\_by('name', $v, 'post\_tag'); |
  |  | 193 | if (!$term) { |
  | 186 | 194 | // todo: can show the error in admin error msg |
  | 187 | 195 | continue; |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L197) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L205) |  |
  | 197 | 205 | } |
  | 198 | 206 |  |
  | 199 |  | $the\_matrix[~~$id~~ ] = $data; |
  |  | 207 | $the\_matrix[$id] = $data; |
  | 200 | 208 | } |
  | 201 | 209 |  |
  | 202 | 210 | // Special handler for CDN/Crawler 2d list to drop empty rows |
  | 203 |  | foreach (~~$the\_matrix as $id => $data~~ ) { |
  |  | 211 | foreach ($the\_matrix as $id => $data) { |
  | 204 | 212 | /\*\* |
  | 205 | 213 | \*      cdn-mapping[ 0 ][ url ] = 'xxx' |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L210) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L218) |  |
  | 210 | 218 | \*      crawler-cookie[ 2 ][ name ] = 'xxx2' |
  | 211 | 219 | \*/ |
  | 212 |  | if (~~$id == self::O\_CDN\_MAPPING || $id == self::O\_CRAWLER\_COOKIES~~ ) { |
  |  | 220 | if ($id == self::O\_CDN\_MAPPING || $id == self::O\_CRAWLER\_COOKIES) { |
  | 213 | 221 | // Drop this line if all children elements are empty |
  | 214 |  | foreach (~~$data as $k => $v~~ ) { |
  | 215 |  | foreach (~~$v as $v2~~ ) { |
  | 216 |  | if (~~$v2~~ ) { |
  |  | 222 | foreach ($data as $k => $v) { |
  |  | 223 | foreach ($v as $v2) { |
  |  | 224 | if ($v2) { |
  | 217 | 225 | continue 2; |
  | 218 | 226 | } |
  | 219 | 227 | } |
  | 220 | 228 | // If hit here, means all empty |
  | 221 |  | unset(~~$the\_matrix[ $id ][ $k ]~~ ); |
  |  | 229 | unset($the\_matrix[$id][$k]); |
  | 222 | 230 | } |
  | 223 | 231 | } |
  | 224 | 232 |  |
  | 225 | 233 | // Don't allow repeated cookie name |
  | 226 |  | if (~~$id == self::O\_CRAWLER\_COOKIES~~ ) { |
  |  | 234 | if ($id == self::O\_CRAWLER\_COOKIES) { |
  | 227 | 235 | $existed = array(); |
  | 228 |  | foreach (~~$the\_matrix[ $id ] as $k => $v~~ ) { |
  | 229 |  | if (~~! $v[ self::CRWL\_COOKIE\_NAME ] || in\_array( $v[ self::CRWL\_COOKIE\_NAME ], $existed )~~ ) { // Filter repeated or empty name |
  | 230 |  | unset(~~$the\_matrix[ $id ][ $k ]~~ ); |
  |  | 236 | foreach ($the\_matrix[$id] as $k => $v) { |
  |  | 237 | if (!$v[self::CRWL\_COOKIE\_NAME] || in\_array($v[self::CRWL\_COOKIE\_NAME], $existed)) { // Filter repeated or empty name |
  |  | 238 | unset($the\_matrix[$id][$k]); |
  | 231 | 239 | continue; |
  | 232 | 240 | } |
  | 233 | 241 |  |
  | 234 |  | $existed[] = $v[~~self::CRWL\_COOKIE\_NAME~~ ]; |
  |  | 242 | $existed[] = $v[self::CRWL\_COOKIE\_NAME]; |
  | 235 | 243 | } |
  | 236 | 244 | } |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L238) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L246) |  |
  | 238 | 246 | // CDN mapping allow URL values repeated |
  | 239 | 247 | // if ( $id == self::O\_CDN\_MAPPING ) {} |
  |  | 248 |  |
  |  | 249 | // tmp fix the 3rd part woo update hook issue when enabling vary cookie |
  |  | 250 | if ($id == 'wc\_cart\_vary') { |
  |  | 251 | if ($data) |
  |  | 252 | add\_filter('litespeed\_vary\_cookies', function ($list) { |
  |  | 253 | $list[] = 'woocommerce\_cart\_hash'; |
  |  | 254 | return array\_unique($list); |
  |  | 255 | }); |
  |  | 256 | else { |
  |  | 257 | add\_filter('litespeed\_vary\_cookies', function ($list) { |
  |  | 258 | if (in\_array('woocommerce\_cart\_hash', $list)) { |
  |  | 259 | unset($list[array\_search('woocommerce\_cart\_hash', $list)]); |
  |  | 260 | } |
  |  | 261 | return array\_unique($list); |
  |  | 262 | }); |
  |  | 263 | } |
  |  | 264 | } |
  | 240 | 265 | } |
  | 241 | 266 |  |
  | 242 | 267 | // id validation will be inside |
  | 243 |  | $this->cls(~~'Conf' )->update\_confs( $the\_matrix~~ ); |
  | 244 |  |  |
  | 245 |  | $msg = \_\_(~~'Options saved.', 'litespeed-cache'~~ ); |
  | 246 |  | Admin\_Display::succeed(~~$msg~~ ); |
  |  | 268 | $this->cls('Conf')->update\_confs($the\_matrix); |
  |  | 269 |  |
  |  | 270 | $msg = \_\_('Options saved.', 'litespeed-cache'); |
  |  | 271 | Admin\_Display::succeed($msg); |
  | 247 | 272 | } |
  | 248 | 273 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L253) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L278) |  |
  | 253 | 278 | \* @access public |
  | 254 | 279 | \*/ |
  | 255 |  | public function network\_save( $raw\_data ) { |
  | 256 |  | Debug2::debug( '[Settings] network saving' ); |
  | 257 |  |  |
  | 258 |  | if ( empty( $raw\_data[ self::ENROLL ] ) ) { |
  | 259 |  | exit( 'No fields' ); |
  | 260 |  | } |
  | 261 |  |  |
  | 262 |  | $raw\_data = Admin::cleanup\_text( $raw\_data ); |
  | 263 |  |  |
  | 264 |  | foreach ( array\_unique( $raw\_data[ self::ENROLL ] ) as $id ) { |
  |  | 280 | public function network\_save($raw\_data) |
  |  | 281 | { |
  |  | 282 | Debug2::debug('[Settings] network saving'); |
  |  | 283 |  |
  |  | 284 | if (empty($raw\_data[self::ENROLL])) { |
  |  | 285 | exit('No fields'); |
  |  | 286 | } |
  |  | 287 |  |
  |  | 288 | $raw\_data = Admin::cleanup\_text($raw\_data); |
  |  | 289 |  |
  |  | 290 | foreach (array\_unique($raw\_data[self::ENROLL]) as $id) { |
  | 265 | 291 | // Append current field to setting save |
  | 266 |  | if (~~! array\_key\_exists( $id, self::$\_default\_site\_options )~~ ) { |
  |  | 292 | if (!array\_key\_exists($id, self::$\_default\_site\_options)) { |
  | 267 | 293 | continue; |
  | 268 | 294 | } |
  | 269 | 295 |  |
  | 270 |  | $data = !~~empty( $raw\_data[ $id ] ) ? $raw\_data[ $id~~ ] : false; |
  |  | 296 | $data = !empty($raw\_data[$id]) ? $raw\_data[$id] : false; |
  | 271 | 297 |  |
  | 272 | 298 | // id validation will be inside |
  | 273 |  | $this->cls(~~'Conf' )->network\_update( $id, $data~~ ); |
  |  | 299 | $this->cls('Conf')->network\_update($id, $data); |
  | 274 | 300 | } |
  | 275 | 301 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L277) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L303) |  |
  | 277 | 303 | Activation::cls()->update\_files(); |
  | 278 | 304 |  |
  | 279 |  | $msg = \_\_(~~'Options saved.', 'litespeed-cache'~~ ); |
  | 280 |  | Admin\_Display::succeed(~~$msg~~ ); |
  |  | 305 | $msg = \_\_('Options saved.', 'litespeed-cache'); |
  |  | 306 | Admin\_Display::succeed($msg); |
  | 281 | 307 | } |
  | 282 | 308 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L290) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L316) |  |
  | 290 | 316 | \* @return string the updated location string. |
  | 291 | 317 | \*/ |
  | 292 |  | public static function widget\_save\_err( $location ) { |
  | 293 |  | return str\_replace( '?message=0', '?error=0', $location ) ; |
  |  | 318 | public static function widget\_save\_err($location) |
  |  | 319 | { |
  |  | 320 | return str\_replace('?message=0', '?error=0', $location); |
  | 294 | 321 | } |
  | 295 | 322 |  |
  | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2761310#L306) | […](/browser/litespeed-cache/trunk/src/admin-settings.cls.php?rev=2977143#L333) |  |
  | 306 | 333 | \* @return mixed Updated settings on success, false on error. |
  | 307 | 334 | \*/ |
  | 308 |  | public static function validate\_widget\_save( $instance, $new\_instance, $old\_instance, $widget ) { |
  | 309 |  | if ( empty( $new\_instance ) ) { |
  |  | 335 | public static function validate\_widget\_save($instance, $new\_instance, $old\_instance, $widget) |
  |  | 336 | { |
  |  | 337 | if (empty($new\_instance)) { |
  | 310 | 338 | return $instance; |
  | 311 | 339 | } |
  | 312 | 340 |  |
  | 313 |  | if (~~! isset( $new\_instance[ ESI::WIDGET\_O\_ESIENABLE ] ) || ! isset( $new\_instance[ ESI::WIDGET\_O\_TTL ] )~~ ) { |
  |  | 341 | if (!isset($new\_instance[ESI::WIDGET\_O\_ESIENABLE]) || !isset($new\_instance[ESI::WIDGET\_O\_TTL])) { |
  | 314 | 342 | return $instance; |
  | 315 | 343 | } |
  | 316 | 344 |  |
  | 317 |  | $esi = intval( $new\_instance[ ESI::WIDGET\_O\_ESIENABLE ] ) % 3; |
  | 318 |  | $ttl = (int) $new\_instance[ ESI::WIDGET\_O\_TTL ]; |
  | 319 |  |  |
  | 320 |  | if ( $ttl != 0 && $ttl < 30 ) { |
  | 321 |  | add\_filter( 'wp\_redirect', \_\_CLASS\_\_ . '::widget\_save\_err' ) ; |
  | 322 |  | return false ; // invalid ttl. |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | if ( empty( $instance[ Conf::OPTION\_NAME ] ) ) {// todo: to be removed |
  | 326 |  | $instance[ Conf::OPTION\_NAME ] = array() ; |
  | 327 |  | } |
  | 328 |  | $instance[ Conf::OPTION\_NAME ][ ESI::WIDGET\_O\_ESIENABLE ] = $esi ; |
  | 329 |  | $instance[ Conf::OPTION\_NAME ][ ESI::WIDGET\_O\_TTL ] = $ttl ; |
  | 330 |  |  |
  | 331 |  | $current = ! empty( $old\_instance[ Conf::OPTION\_NAME ] ) ? $old\_instance[ Conf::OPTION\_NAME ] : false ; |
  | 332 |  | if ( ! strpos( $\_SERVER[ 'HTTP\_REFERER' ], '/wp-admin/customize.php') ) { |
  | 333 |  | if ( ! $current || $esi != $current[ ESI::WIDGET\_O\_ESIENABLE ] ) { |
  | 334 |  | Purge::purge\_all( 'Wdiget ESI\_enable changed' ) ; |
  | 335 |  | } |
  | 336 |  | elseif ( $ttl != 0 && $ttl != $current[ ESI::WIDGET\_O\_TTL ] ) { |
  | 337 |  | Purge::add( Tag::TYPE\_WIDGET . $widget->id ) ; |
  | 338 |  | } |
  | 339 |  |  |
  | 340 |  | Purge::purge\_all( 'Wdiget saved' ) ; |
  | 341 |  | } |
  | 342 |  | return $instance ; |
  |  | 345 | $esi = intval($new\_instance[ESI::WIDGET\_O\_ESIENABLE]) % 3; |
  |  | 346 | $ttl = (int) $new\_instance[ESI::WIDGET\_O\_TTL]; |
  |  | 347 |  |
  |  | 348 | if ($ttl != 0 && $ttl < 30) { |
  |  | 349 | add\_filter('wp\_redirect', \_\_CLASS\_\_ . '::widget\_save\_err'); |
  |  | 350 | return false; // invalid ttl. |
  |  | 351 | } |
  |  | 352 |  |
  |  | 353 | if (empty($instance[Conf::OPTION\_NAME])) { // todo: to be removed |
  |  | 354 | $instance[Conf::OPTION\_NAME] = array(); |
  |  | 355 | } |
  |  | 356 | $instance[Conf::OPTION\_NAME][ESI::WIDGET\_O\_ESIENABLE] = $esi; |
  |  | 357 | $instance[Conf::OPTION\_NAME][ESI::WIDGET\_O\_TTL] = $ttl; |
  |  | 358 |  |
  |  | 359 | $current = !empty($old\_instance[Conf::OPTION\_NAME]) ? $old\_instance[Conf::OPTION\_NAME] : false; |
  |  | 360 | if (!strpos($\_SERVER['HTTP\_REFERER'], '/wp-admin/customize.php')) { |
  |  | 361 | if (!$current || $esi != $current[ESI::WIDGET\_O\_ESIENABLE]) { |
  |  | 362 | Purge::purge\_all('Wdiget ESI\_enable changed'); |
  |  | 363 | } elseif ($ttl != 0 && $ttl != $current[ESI::WIDGET\_O\_TTL]) { |
  |  | 364 | Purge::add(Tag::TYPE\_WIDGET . $widget->id); |
  |  | 365 | } |
  |  | 366 |  |
  |  | 367 | Purge::purge\_all('Wdiget saved'); |
  |  | 368 | } |
  |  | 369 | return $instance; |
  | 343 | 370 | } |
  | 344 | 371 | } |
* ## [litespeed-cache/trunk/src/base.cls.php](/changeset/2977143/litespeed-cache/trunk/src/base.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/base.cls.php")

  | [r2954001](/browser/litespeed-cache/trunk/src/base.cls.php?rev=2954001#L160 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/base.cls.php?rev=2977143#L160 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 160 | 160 | const O\_OPTM\_DNS\_PREFETCH       = 'optm-dns\_prefetch'; |
  | 161 | 161 | const O\_OPTM\_DNS\_PREFETCH\_CTRL  = 'optm-dns\_prefetch\_ctrl'; |
  |  | 162 | const O\_OPTM\_DNS\_PRECONNECT     = 'optm-dns\_preconnect'; |
  | 162 | 163 | const O\_OPTM\_EXC                = 'optm-exc'; |
  | 163 | 164 | const O\_OPTM\_GUEST\_ONLY         = 'optm-guest\_only'; |
  | […](/browser/litespeed-cache/trunk/src/base.cls.php?rev=2954001#L447) | […](/browser/litespeed-cache/trunk/src/base.cls.php?rev=2977143#L448) |  |
  | 447 | 448 | self::O\_OPTM\_DNS\_PREFETCH       => array(), |
  | 448 | 449 | self::O\_OPTM\_DNS\_PREFETCH\_CTRL  => false, |
  |  | 450 | self::O\_OPTM\_DNS\_PRECONNECT     => array(), |
  | 449 | 451 | self::O\_OPTM\_EXC                => array(), |
  | 450 | 452 | self::O\_OPTM\_GUEST\_ONLY         => false, |
* ## [litespeed-cache/trunk/src/cdn.cls.php](/changeset/2977143/litespeed-cache/trunk/src/cdn.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/cdn.cls.php")

  | [r2524344](/browser/litespeed-cache/trunk/src/cdn.cls.php?rev=2524344#L248 "Show revision 2524344 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/cdn.cls.php?rev=2977143#L248 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 248 | 248 | foreach ( $matches[ $v[ 0 ] ? 3 : 2 ] as $k2 => $url ) { |
  | 249 | 249 | // Debug2::debug2( '[CDN] check ' . $url ); |
  | 250 |  | $postfix = '.' . pathinfo( parse\_url( $url, PHP\_URL\_PATH ), PATHINFO\_EXTENSION ); |
  |  | 250 | $postfix = '.' . pathinfo( (string) parse\_url( $url, PHP\_URL\_PATH ), PATHINFO\_EXTENSION ); |
  | 251 | 251 | if ( ! array\_key\_exists( $postfix, $this->\_cfg\_cdn\_mapping ) ) { |
  | 252 | 252 | // Debug2::debug2( '[CDN] non-existed postfix ' . $postfix ); |
* ## [litespeed-cache/trunk/src/cdn/quic.cls.php](/changeset/2977143/litespeed-cache/trunk/src/cdn/quic.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/cdn/quic.cls.php")

  | [r2771786](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L1 "Show revision 2771786 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* The quic.cloud class. |
  | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L8) | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L9) |  |
  | 8 | 9 | \* @author      LiteSpeed Technologies <info@litespeedtech.com> |
  | 9 | 10 | \*/ |
  |  | 11 |  |
  | 10 | 12 | namespace LiteSpeed\CDN; |
  | 11 | 13 |  |
  | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L13) | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L15) |  |
  | 13 | 15 | use LiteSpeed\Base; |
  | 14 | 16 |  |
  | 15 |  | defined(~~'WPINC'~~ ) || exit; |
  |  | 17 | defined('WPINC') || exit; |
  | 16 | 18 |  |
  | 17 |  | class Quic extends Base { |
  |  | 19 | class Quic extends Base |
  |  | 20 | { |
  | 18 | 21 | const LOG\_TAG = '☁️'; |
  | 19 | 22 |  |
  | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L21) | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L24) |  |
  | 21 | 24 |  |
  | 22 | 25 | protected $\_summary; |
  | 23 |  | public function \_\_construct() { |
  |  | 26 | public function \_\_construct() |
  |  | 27 | { |
  | 24 | 28 | $this->\_summary = self::get\_summary(); |
  | 25 | 29 | } |
  | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L30) | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L34) |  |
  | 30 | 34 | \* @access public |
  | 31 | 35 | \*/ |
  | 32 |  | public static function try\_sync\_config() { |
  |  | 36 | public static function try\_sync\_config() |
  |  | 37 | { |
  | 33 | 38 | self::cls()->try\_sync\_conf(); |
  | 34 | 39 | } |
  | 35 | 40 |  |
  | 36 |  | public function try\_sync\_conf() { |
  |  | 41 | public function try\_sync\_conf($force = false) |
  |  | 42 | { |
  | 37 | 43 | $options = $this->get\_options(); |
  | 38 | 44 |  |
  | 39 |  | if ( ! $options[ self::O\_CDN\_QUIC ] ) { |
  |  | 45 | if (!$options[self::O\_CDN\_QUIC]) { |
  |  | 46 | if (!empty($this->\_summary['conf\_md5'])) self::save\_summary(array('conf\_md5' => '')); |
  | 40 | 47 | return false; |
  | 41 | 48 | } |
  | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2771786#L46) | […](/browser/litespeed-cache/trunk/src/cdn/quic.cls.php?rev=2977143#L53) |  |
  | 46 | 53 | self::O\_OBJECT\_PSWD, |
  | 47 | 54 | ); |
  | 48 |  | foreach (~~$secure\_fields as $v~~ ) { |
  | 49 |  | if (~~! empty( $options[ $v ] )~~ ) { |
  | 50 |  | $options[~~$v ] = str\_repeat( '\*', strlen( $options[ $v ] )~~ ); |
  |  | 55 | foreach ($secure\_fields as $v) { |
  |  | 56 | if (!empty($options[$v])) { |
  |  | 57 | $options[$v] = str\_repeat('\*', strlen($options[$v])); |
  | 51 | 58 | } |
  | 52 | 59 | } |
  | 53 |  | unset( $options[ self::O\_MEDIA\_LQIP\_EXC ] ); |
  |  | 60 | unset($options[self::O\_MEDIA\_LQIP\_EXC]); |
  |  | 61 |  |
  |  | 62 | // Remove overflow multi lines fields |
  |  | 63 | foreach ($options as $k => $v) { |
  |  | 64 | if (is\_array($v) && count($v) > 30) { |
  |  | 65 | $v = array\_slice($v, 0, 30); |
  |  | 66 | $options[$k] = $v; |
  |  | 67 | } |
  |  | 68 | } |
  | 54 | 69 |  |
  | 55 | 70 | // Rest url |
  | 56 |  | $options[~~'\_rest' ] = function\_exists( 'rest\_get\_url\_prefix' ) ? rest\_get\_url\_prefix() : apply\_filters( 'rest\_url\_prefix', 'wp-json'~~ ); |
  | 57 |  | $options[~~'\_home\_url' ] = home\_url( '/'~~ ); |
  |  | 71 | $options['\_rest'] = function\_exists('rest\_get\_url\_prefix') ? rest\_get\_url\_prefix() : apply\_filters('rest\_url\_prefix', 'wp-json'); |
  |  | 72 | $options['\_home\_url'] = home\_url('/'); |
  | 58 | 73 |  |
  | 59 | 74 | // Add server env vars |
  | 60 |  | $options[~~'\_server'~~ ] = $this->server\_vars(); |
  |  | 75 | $options['\_server'] = $this->server\_vars(); |
  | 61 | 76 |  |
  | 62 | 77 | // Append hooks |
  | 63 |  | $options[~~'\_tp\_cookies' ] = apply\_filters( 'litespeed\_vary\_cookies', array()~~ ); |
  |  | 78 | $options['\_tp\_cookies'] = apply\_filters('litespeed\_vary\_cookies', array()); |
  | 64 | 79 |  |
  | 65 |  | $conf\_md5 = md5( json\_encode( $options ) ); |
  | 66 |  | if ( ! empty( $this->\_summary[ 'conf\_md5' ] ) && $conf\_md5 == $this->\_summary[ 'conf\_md5' ] ) { |
  | 67 |  | self::debug( 'Bypass sync conf to QC due to same md5', $conf\_md5 ); |
  | 68 |  | return; |
  |  | 80 | $conf\_md5 = md5(json\_encode($options)); |
  |  | 81 | if (!empty($this->\_summary['conf\_md5']) && $conf\_md5 == $this->\_summary['conf\_md5']) { |
  |  | 82 | if (!$force) { |
  |  | 83 | self::debug('Bypass sync conf to QC due to same md5', $conf\_md5); |
  |  | 84 | return; |
  |  | 85 | } |
  |  | 86 | self::debug('!!!Force sync conf even same md5'); |
  | 69 | 87 | } |
  | 70 | 88 |  |
  | 71 |  | self::save\_summary(~~array( 'conf\_md5' => $conf\_md5 )~~ ); |
  |  | 89 | self::save\_summary(array('conf\_md5' => $conf\_md5)); |
  | 72 | 90 | self::debug('sync conf to QC', $options); |
  | 73 | 91 |  |
  | 74 |  | Cloud::post(~~Cloud::SVC\_D\_SYNC\_CONF, $options~~ ); |
  |  | 92 | Cloud::post(Cloud::SVC\_D\_SYNC\_CONF, $options); |
  | 75 | 93 | } |
  | 76 |  |  |
  | 77 | 94 | } |
* ## [litespeed-cache/trunk/src/cloud.cls.php](/changeset/2977143/litespeed-cache/trunk/src/cloud.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/cloud.cls.php")

  | [r2940517](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2940517#L576 "Show revision 2940517 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2977143#L576 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 576 | 576 | $home\_url = home\_url(); |
  | 577 | 577 | if (!wp\_http\_validate\_url($home\_url)) { |
  |  | 578 | self::debug('wp\_http\_validate\_url failed: ' . $home\_url); |
  | 578 | 579 | return false; |
  | 579 | 580 | } |
  | […](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2940517#L589) | […](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2977143#L590) |  |
  | 589 | 590 | /\*\* @since 5.0 If in valid err\_domains, bypass request \*/ |
  | 590 | 591 | if ($this->\_is\_err\_domain($home\_url)) { |
  |  | 592 | self::debug('home url is in err\_domains, bypass request: ' . $home\_url); |
  | 591 | 593 | return false; |
  | 592 | 594 | } |
  | […](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2940517#L1370) | […](/browser/litespeed-cache/trunk/src/cloud.cls.php?rev=2977143#L1372) |  |
  | 1370 | 1372 | $this->\_summary['is\_linked'] = 1; |
  | 1371 | 1373 | self::save\_summary(); |
  |  | 1374 |  |
  |  | 1375 | # Force resync qc conf |
  |  | 1376 | $this->cls('CDN\Quic')->try\_sync\_conf(true); |
  | 1372 | 1377 | } |
  | 1373 | 1378 |  |
* ## [litespeed-cache/trunk/src/control.cls.php](/changeset/2977143/litespeed-cache/trunk/src/control.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/control.cls.php")

  | [r2869601](/browser/litespeed-cache/trunk/src/control.cls.php?rev=2869601#L743 "Show revision 2869601 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/control.cls.php?rev=2977143#L743 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 743 | 743 |  |
  | 744 | 744 | $method = isset( $\_SERVER['REQUEST\_METHOD'] ) ? $\_SERVER['REQUEST\_METHOD'] : 'unknown'; |
  | 745 |  | if ( 'GET' !== $method ) { |
  |  | 745 | if ( 'GET' !== $method && 'HEAD' !== $method ) { |
  | 746 | 746 | return $this->\_no\_cache\_for('Not GET method: ' . $method); |
  | 747 | 747 | } |
* ## [litespeed-cache/trunk/src/crawler.cls.php](/changeset/2977143/litespeed-cache/trunk/src/crawler.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/crawler.cls.php")

  | [r2928795](/browser/litespeed-cache/trunk/src/crawler.cls.php?rev=2928795#L961 "Show revision 2928795 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/crawler.cls.php?rev=2977143#L961 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 961 | 961 |  |
  | 962 | 962 | // WebP on/off |
  | 963 |  | if (~~$this->conf(Base::O\_GUEST~~) || $this->conf(Base::O\_IMG\_OPTM\_WEBP)) { |
  |  | 963 | if (($this->conf(Base::O\_GUEST) && $this->conf(Base::O\_GUEST\_OPTM)) || $this->conf(Base::O\_IMG\_OPTM\_WEBP)) { |
  | 964 | 964 | $crawler\_factors['webp'] = array(1 => 'WebP', 0 => ''); |
  | 965 | 965 | } |
* ## [litespeed-cache/trunk/src/doc.cls.php](/changeset/2977143/litespeed-cache/trunk/src/doc.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/doc.cls.php")

  | [r2928795](/browser/litespeed-cache/trunk/src/doc.cls.php?rev=2928795#L27 "Show revision 2928795 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/doc.cls.php?rev=2977143#L27 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 27 | 27 | { |
  | 28 | 28 | if (apply\_filters('litespeed\_conf', $id)) return; |
  |  | 29 | if (!apply\_filters('litespeed\_conf', Base::O\_GUEST)) return; |
  | 29 | 30 | if (!apply\_filters('litespeed\_conf', Base::O\_GUEST\_OPTM)) return; |
  | 30 | 31 | echo '<font class="litespeed-warning">'; |
  | 31 |  | echo '⚠️ ' . sprintf(\_\_('This setting is passively %1$s due to %2$s!', 'litespeed-cache'), '<code>' . \_\_('ON', 'litespeed-cache') . '</code>', Lang::title(Base::O\_GUEST\_OPTM)); |
  |  | 32 | echo '⚠️ ' . sprintf(\_\_('This setting is %1$s for certain qualifying requests due to %2$s!', 'litespeed-cache'), '<code>' . \_\_('ON', 'litespeed-cache') . '</code>', Lang::title(Base::O\_GUEST\_OPTM)); |
  |  | 33 | self::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/general/#guest-optimization'); |
  | 32 | 34 | echo '</font>'; |
  | 33 | 35 | } |
* ## [litespeed-cache/trunk/src/esi.cls.php](/changeset/2977143/litespeed-cache/trunk/src/esi.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/esi.cls.php")

  | [r2761310](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L1 "Show revision 2761310 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* The ESI class. |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L10) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L11) |  |
  | 10 | 11 | \* @author      LiteSpeed Technologies <info@litespeedtech.com> |
  | 11 | 12 | \*/ |
  |  | 13 |  |
  | 12 | 14 | namespace LiteSpeed; |
  | 13 | 15 |  |
  | 14 |  | defined( 'WPINC' ) || exit; |
  | 15 |  |  |
  | 16 |  | class ESI extends Root { |
  |  | 16 | defined('WPINC') || exit; |
  |  | 17 |  |
  |  | 18 | class ESI extends Root |
  |  | 19 | { |
  |  | 20 | const LOG\_TAG = '⏺'; |
  |  | 21 |  |
  | 17 | 22 | private static $has\_esi = false; |
  | 18 | 23 | private static $\_combine\_ids = array(); |
  | 19 | 24 | private $esi\_args = null; |
  | 20 | 25 | private $\_esi\_preserve\_list = array(); |
  | 21 |  | private $\_nonce\_actions = array(~~-1 => ''~~ ); // val is cache control |
  |  | 26 | private $\_nonce\_actions = array(-1 => ''); // val is cache control |
  | 22 | 27 |  |
  | 23 | 28 | const QS\_ACTION = 'lsesi'; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L39) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L44) |  |
  | 39 | 44 | \* @since  4.0 Change to be after Vary init in hook 'after\_setup\_theme' |
  | 40 | 45 | \*/ |
  | 41 |  | public function init() { |
  |  | 46 | public function init() |
  |  | 47 | { |
  | 42 | 48 | /\*\* |
  | 43 | 49 | \* Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue |
  | 44 | 50 | \* @since  2.9.7.2 |
  | 45 | 51 | \*/ |
  | 46 |  | if (~~Router::is\_ajax() || ! $this->cls( 'Router' )->esi\_enabled()~~ ) { |
  |  | 52 | if (Router::is\_ajax() || !$this->cls('Router')->esi\_enabled()) { |
  | 47 | 53 | return; |
  | 48 | 54 | } |
  | 49 | 55 |  |
  | 50 | 56 | // Guest mode, don't need to use ESI |
  | 51 |  | if (~~defined( 'LITESPEED\_GUEST' ) && LITESPEED\_GUEST~~ ) { |
  | 52 |  | return; |
  | 53 |  | } |
  | 54 |  |  |
  | 55 |  | if (~~defined( 'LITESPEED\_ESI\_OFF' )~~ ) { |
  |  | 57 | if (defined('LITESPEED\_GUEST') && LITESPEED\_GUEST) { |
  |  | 58 | return; |
  |  | 59 | } |
  |  | 60 |  |
  |  | 61 | if (defined('LITESPEED\_ESI\_OFF')) { |
  | 56 | 62 | return; |
  | 57 | 63 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L66) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L72) |  |
  | 66 | 72 | $this->\_transform\_nonce(); |
  | 67 | 73 |  |
  | 68 |  | !~~defined( 'LITESPEED\_ESI\_INITED' ) && define( 'LITESPEED\_ESI\_INITED', true~~ ); |
  |  | 74 | !defined('LITESPEED\_ESI\_INITED') && define('LITESPEED\_ESI\_INITED', true); |
  | 69 | 75 | } |
  | 70 | 76 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L78) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L84) |  |
  | 78 | 84 | \* @access private |
  | 79 | 85 | \*/ |
  | 80 |  | private function \_hooks() { |
  | 81 |  | add\_filter( 'template\_include', array( $this, 'esi\_template' ), 99999 ); |
  | 82 |  |  |
  | 83 |  | add\_action( 'load-widgets.php', \_\_NAMESPACE\_\_ . '\Purge::purge\_widget' ); |
  | 84 |  | add\_action( 'wp\_update\_comment\_count', \_\_NAMESPACE\_\_ . '\Purge::purge\_comment\_widget' ); |
  |  | 86 | private function \_hooks() |
  |  | 87 | { |
  |  | 88 | add\_filter('template\_include', array($this, 'esi\_template'), 99999); |
  |  | 89 |  |
  |  | 90 | add\_action('load-widgets.php', \_\_NAMESPACE\_\_ . '\Purge::purge\_widget'); |
  |  | 91 | add\_action('wp\_update\_comment\_count', \_\_NAMESPACE\_\_ . '\Purge::purge\_comment\_widget'); |
  | 85 | 92 |  |
  | 86 | 93 | /\*\* |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L88) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L95) |  |
  | 88 | 95 | \* @since  1.8.1 |
  | 89 | 96 | \*/ |
  | 90 |  | if ( ! empty( $\_GET[ self::QS\_ACTION ] ) ) { |
  |  | 97 | if (!empty($\_GET[self::QS\_ACTION])) { |
  |  | 98 | self::debug('ESI req'); |
  | 91 | 99 | $this->\_register\_esi\_actions(); |
  | 92 | 100 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L106) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L114) |  |
  | 106 | 114 | \* @since  2.8.1 Check is\_admin for Elementor compatibility #726013 |
  | 107 | 115 | \*/ |
  | 108 |  | if ( ! is\_admin() ) { |
  | 109 |  | add\_shortcode( 'esi', array( $this, 'shortcode' ) ); |
  | 110 |  | } |
  | 111 |  |  |
  |  | 116 | if (!is\_admin()) { |
  |  | 117 | add\_shortcode('esi', array($this, 'shortcode')); |
  |  | 118 | } |
  | 112 | 119 | } |
  | 113 | 120 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L117) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L124) |  |
  | 117 | 124 | \* @since  2.9.5 |
  | 118 | 125 | \*/ |
  | 119 |  | private function \_transform\_nonce() { |
  | 120 |  | if ( is\_admin() ) { |
  |  | 126 | private function \_transform\_nonce() |
  |  | 127 | { |
  |  | 128 | if (is\_admin()) { |
  | 121 | 129 | return; |
  | 122 | 130 | } |
  | 123 | 131 |  |
  | 124 | 132 | // Load ESI nonces in conf |
  | 125 |  | $nonces = $this->conf(~~Base::O\_ESI\_NONCE~~ ); |
  | 126 |  | add\_filter(~~'litespeed\_esi\_nonces', array( $this->cls( 'Data' ), 'load\_esi\_nonces' )~~ ); |
  | 127 |  | if (~~$nonces = apply\_filters( 'litespeed\_esi\_nonces', $nonces )~~ ) { |
  | 128 |  | foreach (~~$nonces as $action~~ ) { |
  | 129 |  | $this->nonce\_action(~~$action~~ ); |
  | 130 |  | } |
  | 131 |  | } |
  | 132 |  |  |
  | 133 |  | add\_action(~~'litespeed\_nonce', array( $this, 'nonce\_action' )~~ ); |
  |  | 133 | $nonces = $this->conf(Base::O\_ESI\_NONCE); |
  |  | 134 | add\_filter('litespeed\_esi\_nonces', array($this->cls('Data'), 'load\_esi\_nonces')); |
  |  | 135 | if ($nonces = apply\_filters('litespeed\_esi\_nonces', $nonces)) { |
  |  | 136 | foreach ($nonces as $action) { |
  |  | 137 | $this->nonce\_action($action); |
  |  | 138 | } |
  |  | 139 | } |
  |  | 140 |  |
  |  | 141 | add\_action('litespeed\_nonce', array($this, 'nonce\_action')); |
  | 134 | 142 | } |
  | 135 | 143 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L139) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L147) |  |
  | 139 | 147 | \* @since  2.9.5 |
  | 140 | 148 | \*/ |
  | 141 |  | public function nonce\_action( $action ) { |
  |  | 149 | public function nonce\_action($action) |
  |  | 150 | { |
  | 142 | 151 | // Split the Cache Control |
  | 143 |  | $action = explode(~~' ', $action~~ ); |
  | 144 |  | $control = !~~empty( $action[ 1 ] ) ? $action[ 1~~ ] : ''; |
  | 145 |  | $action = $action[~~0~~ ]; |
  |  | 152 | $action = explode(' ', $action); |
  |  | 153 | $control = !empty($action[1]) ? $action[1] : ''; |
  |  | 154 | $action = $action[0]; |
  | 146 | 155 |  |
  | 147 | 156 | // Wildcard supported |
  | 148 |  | $action = Utility::wildcard2regex(~~$action~~ ); |
  | 149 |  |  |
  | 150 |  | if (~~array\_key\_exists( $action, $this->\_nonce\_actions )~~ ) { |
  | 151 |  | return; |
  | 152 |  | } |
  | 153 |  |  |
  | 154 |  | $this->\_nonce\_actions[~~$action~~ ] = $control; |
  | 155 |  |  |
  | 156 |  | Debug2::debug(~~'[ESI] Appended nonce action to nonce list [action] ' . $action~~ ); |
  |  | 157 | $action = Utility::wildcard2regex($action); |
  |  | 158 |  |
  |  | 159 | if (array\_key\_exists($action, $this->\_nonce\_actions)) { |
  |  | 160 | return; |
  |  | 161 | } |
  |  | 162 |  |
  |  | 163 | $this->\_nonce\_actions[$action] = $control; |
  |  | 164 |  |
  |  | 165 | Debug2::debug('[ESI] Appended nonce action to nonce list [action] ' . $action); |
  | 157 | 166 | } |
  | 158 | 167 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L162) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L171) |  |
  | 162 | 171 | \* @since 2.9.5 |
  | 163 | 172 | \*/ |
  | 164 |  | public function is\_nonce\_action( $action ) { |
  |  | 173 | public function is\_nonce\_action($action) |
  |  | 174 | { |
  | 165 | 175 | // If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced. |
  | 166 |  | if (~~! defined( 'LITESPEED\_ESI\_INITED' )~~ ) { |
  |  | 176 | if (!defined('LITESPEED\_ESI\_INITED')) { |
  | 167 | 177 | return null; |
  | 168 | 178 | } |
  | 169 | 179 |  |
  | 170 |  | if (~~is\_admin()~~ ) { |
  |  | 180 | if (is\_admin()) { |
  | 171 | 181 | return null; |
  | 172 | 182 | } |
  | 173 | 183 |  |
  | 174 |  | if (~~defined( 'LITESPEED\_ESI\_OFF' )~~ ) { |
  |  | 184 | if (defined('LITESPEED\_ESI\_OFF')) { |
  | 175 | 185 | return null; |
  | 176 | 186 | } |
  | 177 | 187 |  |
  | 178 |  | foreach (~~$this->\_nonce\_actions as $k => $v~~ ) { |
  | 179 |  | if (~~strpos( $k, '\*' ) !== false~~ ) { |
  | 180 |  | if~~( preg\_match( '#' . $k . '#iU', $action )~~ ) { |
  |  | 188 | foreach ($this->\_nonce\_actions as $k => $v) { |
  |  | 189 | if (strpos($k, '\*') !== false) { |
  |  | 190 | if (preg\_match('#' . $k . '#iU', $action)) { |
  | 181 | 191 | return $v; |
  | 182 | 192 | } |
  | 183 |  | } |
  | 184 |  | else { |
  | 185 |  | if ( $k == $action ) { |
  |  | 193 | } else { |
  |  | 194 | if ($k == $action) { |
  | 186 | 195 | return $v; |
  | 187 | 196 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L198) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L207) |  |
  | 198 | 207 | \* @access public |
  | 199 | 208 | \*/ |
  | 200 |  | public function shortcode( $atts ) { |
  | 201 |  | if ( empty( $atts[ 0 ] ) ) { |
  | 202 |  | Debug2::debug( '[ESI] ===shortcode wrong format', $atts ); |
  |  | 209 | public function shortcode($atts) |
  |  | 210 | { |
  |  | 211 | if (empty($atts[0])) { |
  |  | 212 | Debug2::debug('[ESI] ===shortcode wrong format', $atts); |
  | 203 | 213 | return 'Wrong shortcode esi format'; |
  | 204 | 214 | } |
  | 205 | 215 |  |
  | 206 | 216 | $cache = 'public,no-vary'; |
  | 207 |  | if (~~! empty( $atts[ 'cache' ] )~~ ) { |
  | 208 |  | $cache = $atts[~~'cache'~~ ]; |
  | 209 |  | unset(~~$atts[ 'cache' ]~~ ); |
  |  | 217 | if (!empty($atts['cache'])) { |
  |  | 218 | $cache = $atts['cache']; |
  |  | 219 | unset($atts['cache']); |
  | 210 | 220 | } |
  | 211 | 221 |  |
  | 212 | 222 | $silence = false; |
  | 213 |  | if (~~! empty( $atts[ '\_ls\_silence' ] )~~ ) { |
  |  | 223 | if (!empty($atts['\_ls\_silence'])) { |
  | 214 | 224 | $silence = true; |
  | 215 | 225 | } |
  | 216 | 226 |  |
  | 217 |  | do\_action(~~'litespeed\_esi\_shortcode-' . $atts[ 0 ]~~ ); |
  |  | 227 | do\_action('litespeed\_esi\_shortcode-' . $atts[0]); |
  | 218 | 228 |  |
  | 219 | 229 | // Show ESI link |
  | 220 |  | return $this->sub\_esi\_block(~~'esi', 'esi-shortcode', $atts, $cache, $silence~~ ); |
  |  | 230 | return $this->sub\_esi\_block('esi', 'esi-shortcode', $atts, $cache, $silence); |
  | 221 | 231 | } |
  | 222 | 232 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L229) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L239) |  |
  | 229 | 239 | \* @return string Esi On header if request has esi, empty string otherwise. |
  | 230 | 240 | \*/ |
  | 231 |  | public static function has\_esi() { |
  |  | 241 | public static function has\_esi() |
  |  | 242 | { |
  | 232 | 243 | return self::$has\_esi; |
  | 233 | 244 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L239) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L250) |  |
  | 239 | 250 | \* @access public |
  | 240 | 251 | \*/ |
  | 241 |  | public static function set\_has\_esi() { |
  |  | 252 | public static function set\_has\_esi() |
  |  | 253 | { |
  | 242 | 254 | self::$has\_esi = true; |
  | 243 | 255 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L250) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L262) |  |
  | 250 | 262 | \* @access   private |
  | 251 | 263 | \*/ |
  | 252 |  | private function \_register\_esi\_actions() { |
  | 253 |  | ! defined( 'LSCACHE\_IS\_ESI' ) && define( 'LSCACHE\_IS\_ESI', $\_GET[ self::QS\_ACTION ] );// Reused this to ESI block ID |
  | 254 |  |  |
  | 255 |  | ! empty( $\_SERVER[ 'ESI\_REFERER' ] ) && defined( 'LSCWP\_LOG' ) && Debug2::debug( '[ESI] ESI\_REFERER: ' . $\_SERVER[ 'ESI\_REFERER' ] ); |
  |  | 264 | private function \_register\_esi\_actions() |
  |  | 265 | { |
  |  | 266 | /\*\* |
  |  | 267 | \* This hook is in `init` |
  |  | 268 | \* For any plugin need to check if page is ESI, use `LSCACHE\_IS\_ESI` check after `init` hook |
  |  | 269 | \*/ |
  |  | 270 | !defined('LSCACHE\_IS\_ESI') && define('LSCACHE\_IS\_ESI', $\_GET[self::QS\_ACTION]); // Reused this to ESI block ID |
  |  | 271 |  |
  |  | 272 | !empty($\_SERVER['ESI\_REFERER']) && defined('LSCWP\_LOG') && Debug2::debug('[ESI] ESI\_REFERER: ' . $\_SERVER['ESI\_REFERER']); |
  | 256 | 273 |  |
  | 257 | 274 | /\*\* |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L259) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L276) |  |
  | 259 | 276 | \* @since 2.9.3 |
  | 260 | 277 | \*/ |
  | 261 |  | if ( ! empty( $\_SERVER[ 'ESI\_REFERER' ] ) && ! $this->cls( 'REST' )->is\_rest( $\_SERVER[ 'ESI\_REFERER' ] ) ) { |
  | 262 |  | $\_SERVER[ 'REQUEST\_URI' ] = $\_SERVER[ 'ESI\_REFERER' ]; |
  | 263 |  | } |
  | 264 |  |  |
  | 265 |  | if ( ! empty( $\_SERVER[ 'ESI\_CONTENT\_TYPE' ] ) && strpos( $\_SERVER[ 'ESI\_CONTENT\_TYPE' ], 'application/json' ) === 0 ) { |
  | 266 |  | add\_filter( 'litespeed\_is\_json', '\_\_return\_true' ); |
  |  | 278 | if (!empty($\_SERVER['ESI\_REFERER']) && !$this->cls('REST')->is\_rest($\_SERVER['ESI\_REFERER'])) { |
  |  | 279 | self::debug('overwrite REQUEST\_URI to ESI\_REFERER [from] ' . $\_SERVER['REQUEST\_URI'] . ' [to] ' . $\_SERVER['ESI\_REFERER']); |
  |  | 280 | $\_SERVER['REQUEST\_URI'] = trailingslashit($\_SERVER['ESI\_REFERER']); |
  |  | 281 | # Prevent from 301 redirecting |
  |  | 282 | if (!empty($\_SERVER['SCRIPT\_URI'])) { |
  |  | 283 | $SCRIPT\_URI = parse\_url($\_SERVER['SCRIPT\_URI']); |
  |  | 284 | $SCRIPT\_URI['path'] = $\_SERVER['REQUEST\_URI']; |
  |  | 285 | Utility::compatibility(); |
  |  | 286 | $\_SERVER['SCRIPT\_URI'] = http\_build\_url($SCRIPT\_URI); |
  |  | 287 | } |
  |  | 288 | } |
  |  | 289 |  |
  |  | 290 | if (!empty($\_SERVER['ESI\_CONTENT\_TYPE']) && strpos($\_SERVER['ESI\_CONTENT\_TYPE'], 'application/json') === 0) { |
  |  | 291 | add\_filter('litespeed\_is\_json', '\_\_return\_true'); |
  | 267 | 292 | } |
  | 268 | 293 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L272) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L297) |  |
  | 272 | 297 | \* @since 2.9.4 |
  | 273 | 298 | \*/ |
  | 274 |  | add\_action(~~'rest\_api\_init', array( $this, 'load\_esi\_block' ), 101~~ ); |
  |  | 299 | add\_action('rest\_api\_init', array($this, 'load\_esi\_block'), 101); |
  | 275 | 300 |  |
  | 276 | 301 | // Register ESI blocks |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L279) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L304) |  |
  | 279 | 304 | add\_action('litespeed\_esi\_load-comment-form', array($this, 'load\_comment\_form\_block')); |
  | 280 | 305 |  |
  | 281 |  | add\_action('litespeed\_esi\_load-nonce', array(~~$this, 'load\_nonce\_block' )~~ ); |
  | 282 |  | add\_action('litespeed\_esi\_load-esi', array(~~$this, 'load\_esi\_shortcode' )~~ ); |
  | 283 |  |  |
  | 284 |  | add\_action('litespeed\_esi\_load-' . self::COMBO, array(~~$this, 'load\_combo' )~~ ); |
  |  | 306 | add\_action('litespeed\_esi\_load-nonce', array($this, 'load\_nonce\_block')); |
  |  | 307 | add\_action('litespeed\_esi\_load-esi', array($this, 'load\_esi\_shortcode')); |
  |  | 308 |  |
  |  | 309 | add\_action('litespeed\_esi\_load-' . self::COMBO, array($this, 'load\_combo')); |
  | 285 | 310 | } |
  | 286 | 311 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L294) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L319) |  |
  | 294 | 319 | \* @return string The new template path. |
  | 295 | 320 | \*/ |
  | 296 |  | public function esi\_template( $template ) { |
  |  | 321 | public function esi\_template($template) |
  |  | 322 | { |
  | 297 | 323 | // Check if is an ESI request |
  | 298 |  | if (~~defined( 'LSCACHE\_IS\_ESI' )~~ ) { |
  | 299 |  | ~~Debug2::debug( '[ESI] calling template'~~ ); |
  |  | 324 | if (defined('LSCACHE\_IS\_ESI')) { |
  |  | 325 | self::debug('calling ESI template'); |
  | 300 | 326 |  |
  | 301 | 327 | return LSCWP\_DIR . 'tpl/esi.tpl.php'; |
  | 302 | 328 | } |
  |  | 329 | self::debug('calling default template'); |
  | 303 | 330 | $this->\_register\_not\_esi\_actions(); |
  | 304 | 331 | return $template; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L312) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L339) |  |
  | 312 | 339 | \* @access   private |
  | 313 | 340 | \*/ |
  | 314 |  | private function \_register\_not\_esi\_actions() { |
  | 315 |  | do\_action( 'litespeed\_tpl\_normal' ); |
  | 316 |  |  |
  | 317 |  | if ( ! Control::is\_cacheable() ) { |
  | 318 |  | return; |
  | 319 |  | } |
  | 320 |  |  |
  | 321 |  | if ( Router::is\_ajax() ) { |
  | 322 |  | return; |
  | 323 |  | } |
  | 324 |  |  |
  | 325 |  | add\_filter('widget\_display\_callback', array( $this, 'sub\_widget\_block' ), 0, 3); |
  |  | 341 | private function \_register\_not\_esi\_actions() |
  |  | 342 | { |
  |  | 343 | do\_action('litespeed\_tpl\_normal'); |
  |  | 344 |  |
  |  | 345 | if (!Control::is\_cacheable()) { |
  |  | 346 | return; |
  |  | 347 | } |
  |  | 348 |  |
  |  | 349 | if (Router::is\_ajax()) { |
  |  | 350 | return; |
  |  | 351 | } |
  |  | 352 |  |
  |  | 353 | add\_filter('widget\_display\_callback', array($this, 'sub\_widget\_block'), 0, 3); |
  | 326 | 354 |  |
  | 327 | 355 | // Add admin\_bar esi |
  | 328 |  | if (~~Router::is\_logged\_in()~~ ) { |
  |  | 356 | if (Router::is\_logged\_in()) { |
  | 329 | 357 | remove\_action('wp\_footer', 'wp\_admin\_bar\_render', 1000); |
  | 330 | 358 | add\_action('wp\_footer', array($this, 'sub\_admin\_bar\_block'), 1000); |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L332) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L360) |  |
  | 332 | 360 |  |
  | 333 | 361 | // Add comment forum esi for logged-in user or commenter |
  | 334 |  | if ( ! Router::is\_ajax() && Vary::has\_vary() ) { |
  | 335 |  | add\_filter( 'comment\_form\_defaults', array( $this, 'register\_comment\_form\_actions' ) ); |
  | 336 |  | } |
  | 337 |  |  |
  |  | 362 | if (!Router::is\_ajax() && Vary::has\_vary()) { |
  |  | 363 | add\_filter('comment\_form\_defaults', array($this, 'register\_comment\_form\_actions')); |
  |  | 364 | } |
  | 338 | 365 | } |
  | 339 | 366 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L343) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L370) |  |
  | 343 | 370 | \* @since  3.4.2 |
  | 344 | 371 | \*/ |
  | 345 |  | public static function combine( $block\_id ) { |
  | 346 |  | if ( ! isset( $\_SERVER[ 'X-LSCACHE' ] ) || strpos( $\_SERVER[ 'X-LSCACHE' ], 'combine' ) === false ) { |
  | 347 |  | return; |
  | 348 |  | } |
  | 349 |  |  |
  | 350 |  | if ( in\_array( $block\_id, self::$\_combine\_ids ) ) { |
  |  | 372 | public static function combine($block\_id) |
  |  | 373 | { |
  |  | 374 | if (!isset($\_SERVER['X-LSCACHE']) || strpos($\_SERVER['X-LSCACHE'], 'combine') === false) { |
  |  | 375 | return; |
  |  | 376 | } |
  |  | 377 |  |
  |  | 378 | if (in\_array($block\_id, self::$\_combine\_ids)) { |
  | 351 | 379 | return; |
  | 352 | 380 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L360) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L388) |  |
  | 360 | 388 | \* @since  3.4.2 |
  | 361 | 389 | \*/ |
  | 362 |  | public function load\_combo() { |
  | 363 |  | Control::set\_nocache( 'ESI combine request' ); |
  | 364 |  |  |
  | 365 |  | if ( empty( $\_POST[ 'esi\_include' ] ) ) { |
  |  | 390 | public function load\_combo() |
  |  | 391 | { |
  |  | 392 | Control::set\_nocache('ESI combine request'); |
  |  | 393 |  |
  |  | 394 | if (empty($\_POST['esi\_include'])) { |
  | 366 | 395 | return; |
  | 367 | 396 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L369) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L398) |  |
  | 369 | 398 | self::set\_has\_esi(); |
  | 370 | 399 |  |
  | 371 |  | Debug2::debug(~~'[ESI] 🍔 Load combo', $\_POST[ 'esi\_include' ]~~ ); |
  |  | 400 | Debug2::debug('[ESI] 🍔 Load combo', $\_POST['esi\_include']); |
  | 372 | 401 |  |
  | 373 | 402 | $output = ''; |
  | 374 |  | foreach (~~$\_POST[ 'esi\_include' ] as $url~~ ) { |
  | 375 |  | $qs = parse\_url(~~htmlspecialchars\_decode( $url ), PHP\_URL\_QUERY~~ ); |
  | 376 |  | parse\_str(~~$qs, $qs~~ ); |
  | 377 |  | if (~~empty( $qs[ self::QS\_ACTION ] )~~ ) { |
  |  | 403 | foreach ($\_POST['esi\_include'] as $url) { |
  |  | 404 | $qs = parse\_url(htmlspecialchars\_decode($url), PHP\_URL\_QUERY); |
  |  | 405 | parse\_str($qs, $qs); |
  |  | 406 | if (empty($qs[self::QS\_ACTION])) { |
  | 378 | 407 | continue; |
  | 379 | 408 | } |
  | 380 |  | $esi\_id = $qs[~~self::QS\_ACTION~~ ]; |
  | 381 |  | $esi\_param = !~~empty( $qs[ self::QS\_PARAMS ] ) ? $this->\_parse\_esi\_param( $qs[ self::QS\_PARAMS ]~~ ) : false; |
  | 382 |  | $inline\_param = apply\_filters(~~'litespeed\_esi\_inline-' . $esi\_id, array(), $esi\_param~~ ); // Returned array need to be [ val, control, tag ] |
  | 383 |  | if (~~$inline\_param~~ ) { |
  | 384 |  | $output .= self::\_build\_inline(~~$url, $inline\_param~~ ); |
  |  | 409 | $esi\_id = $qs[self::QS\_ACTION]; |
  |  | 410 | $esi\_param = !empty($qs[self::QS\_PARAMS]) ? $this->\_parse\_esi\_param($qs[self::QS\_PARAMS]) : false; |
  |  | 411 | $inline\_param = apply\_filters('litespeed\_esi\_inline-' . $esi\_id, array(), $esi\_param); // Returned array need to be [ val, control, tag ] |
  |  | 412 | if ($inline\_param) { |
  |  | 413 | $output .= self::\_build\_inline($url, $inline\_param); |
  | 385 | 414 | } |
  | 386 | 415 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L394) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L423) |  |
  | 394 | 423 | \* @since  3.4.2 |
  | 395 | 424 | \*/ |
  | 396 |  | private static function \_build\_inline( $url, $inline\_param ) { |
  | 397 |  | if ( ! $url || empty( $inline\_param[ 'val' ] ) || empty( $inline\_param[ 'control' ] ) || empty( $inline\_param[ 'tag' ] ) ) { |
  |  | 425 | private static function \_build\_inline($url, $inline\_param) |
  |  | 426 | { |
  |  | 427 | if (!$url || empty($inline\_param['val']) || empty($inline\_param['control']) || empty($inline\_param['tag'])) { |
  | 398 | 428 | return ''; |
  | 399 | 429 | } |
  | 400 | 430 |  |
  | 401 |  | return "<esi:inline name='$url' cache-control='" . $inline\_param[ 'control' ] . "' cache-tag='" . $inline\_param[ 'tag' ] . "'>" . $inline\_param[ 'val' ] . "</esi:inline>"; |
  |  | 431 | $url = esc\_attr($url); |
  |  | 432 | $control = esc\_attr($inline\_param['control']); |
  |  | 433 | $tag = esc\_attr($inline\_param['tag']); |
  |  | 434 |  |
  |  | 435 | return "<esi:inline name='$url' cache-control='" . $control . "' cache-tag='" . $tag . "'>" . $inline\_param['val'] . "</esi:inline>"; |
  | 402 | 436 | } |
  | 403 | 437 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L418) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L452) |  |
  | 418 | 452 | \* @param array $inline\_val     If show the current value for current request( this can avoid multiple esi requests in first time cache generating process ) |
  | 419 | 453 | \*/ |
  | 420 |  | public function sub\_esi\_block( $block\_id, $wrapper, $params = array(), $control = 'private,no-vary', $silence = false, $preserved = false, $svar = false, $inline\_param = array() ) { |
  | 421 |  | if ( empty($block\_id) || ! is\_array($params) || preg\_match('/[^\w-]/', $block\_id) ) { |
  |  | 454 | public function sub\_esi\_block($block\_id, $wrapper, $params = array(), $control = 'private,no-vary', $silence = false, $preserved = false, $svar = false, $inline\_param = array()) |
  |  | 455 | { |
  |  | 456 | if (empty($block\_id) || !is\_array($params) || preg\_match('/[^\w-]/', $block\_id)) { |
  | 422 | 457 | return false; |
  | 423 | 458 | } |
  | 424 | 459 |  |
  | 425 |  | if (~~defined( 'LITESPEED\_ESI\_OFF' )~~ ) { |
  | 426 |  | Debug2::debug(~~'[ESI] ESI OFF so force loading [block\_id] ' . $block\_id~~ ); |
  | 427 |  | do\_action(~~'litespeed\_esi\_load-' . $block\_id, $params~~ ); |
  | 428 |  | return; |
  | 429 |  | } |
  | 430 |  |  |
  | 431 |  | if (~~$silence~~ ) { |
  |  | 460 | if (defined('LITESPEED\_ESI\_OFF')) { |
  |  | 461 | Debug2::debug('[ESI] ESI OFF so force loading [block\_id] ' . $block\_id); |
  |  | 462 | do\_action('litespeed\_esi\_load-' . $block\_id, $params); |
  |  | 463 | return; |
  |  | 464 | } |
  |  | 465 |  |
  |  | 466 | if ($silence) { |
  | 432 | 467 | // Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi\_block' ) |
  | 433 |  | $params[~~'\_ls\_silence'~~ ] = true; |
  | 434 |  | } |
  | 435 |  |  |
  | 436 |  | if (~~$this->cls( 'REST' )->is\_rest() || $this->cls( 'REST' )->is\_internal\_rest()~~ ) { |
  | 437 |  | $params[~~'is\_json'~~ ] = 1; |
  | 438 |  | } |
  | 439 |  |  |
  | 440 |  | $params = apply\_filters(~~'litespeed\_esi\_params', $params, $block\_id~~ ); |
  | 441 |  | $control = apply\_filters('litespeed\_esi\_control', $control, $block\_id); |
  | 442 |  |  |
  | 443 |  | if (~~!is\_array($params) || !is\_string($control)~~ ) { |
  | 444 |  | defined(~~'LSCWP\_LOG' ) && Debug2::debug( "[ESI] 🛑 Sub hooks returned Params: \n" . var\_export($params, true) . "\ncache control: \n" . var\_export($control, true)~~ ); |
  |  | 468 | $params['\_ls\_silence'] = true; |
  |  | 469 | } |
  |  | 470 |  |
  |  | 471 | if ($this->cls('REST')->is\_rest() || $this->cls('REST')->is\_internal\_rest()) { |
  |  | 472 | $params['is\_json'] = 1; |
  |  | 473 | } |
  |  | 474 |  |
  |  | 475 | $params = apply\_filters('litespeed\_esi\_params', $params, $block\_id); |
  |  | 476 | $control = apply\_filters('litespeed\_esi\_control', $control, $block\_id); |
  |  | 477 |  |
  |  | 478 | if (!is\_array($params) || !is\_string($control)) { |
  |  | 479 | defined('LSCWP\_LOG') && Debug2::debug("[ESI] 🛑 Sub hooks returned Params: \n" . var\_export($params, true) . "\ncache control: \n" . var\_export($control, true)); |
  | 445 | 480 |  |
  | 446 | 481 | return false; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L451) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L486) |  |
  | 451 | 486 | self::QS\_ACTION => $block\_id, |
  | 452 | 487 | ); |
  | 453 |  | if (~~! empty( $control )~~ ) { |
  | 454 |  | $appended\_params[~~'\_control'~~ ] = $control; |
  | 455 |  | } |
  | 456 |  | if (~~$params~~ ) { |
  | 457 |  | $appended\_params[~~self::QS\_PARAMS ] = base64\_encode( json\_encode( $params )~~ ); |
  | 458 |  | Debug2::debug2(~~'[ESI] param ', $params~~ ); |
  |  | 488 | if (!empty($control)) { |
  |  | 489 | $appended\_params['\_control'] = $control; |
  |  | 490 | } |
  |  | 491 | if ($params) { |
  |  | 492 | $appended\_params[self::QS\_PARAMS] = base64\_encode(json\_encode($params)); |
  |  | 493 | Debug2::debug2('[ESI] param ', $params); |
  | 459 | 494 | } |
  | 460 | 495 |  |
  | 461 | 496 | // Append hash |
  | 462 |  | $appended\_params[~~'\_hash' ] = $this->\_gen\_esi\_md5( $appended\_params~~ ); |
  |  | 497 | $appended\_params['\_hash'] = $this->\_gen\_esi\_md5($appended\_params); |
  | 463 | 498 |  |
  | 464 | 499 | /\*\* |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L466) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L501) |  |
  | 466 | 501 | \* @since 2.9.4 |
  | 467 | 502 | \*/ |
  | 468 |  | $appended\_params = array\_map(~~'urlencode', $appended\_params~~ ); |
  |  | 503 | $appended\_params = array\_map('urlencode', $appended\_params); |
  | 469 | 504 |  |
  | 470 | 505 | // Generate ESI URL |
  | 471 |  | $url = add\_query\_arg(~~$appended\_params, trailingslashit( wp\_make\_link\_relative( home\_url() ) )~~ ); |
  |  | 506 | $url = add\_query\_arg($appended\_params, trailingslashit(wp\_make\_link\_relative(home\_url()))); |
  | 472 | 507 |  |
  | 473 | 508 | $output = ''; |
  | 474 |  | if (~~$inline\_param~~ ) { |
  | 475 |  | $output .= self::\_build\_inline(~~$url, $inline\_param~~ ); |
  |  | 509 | if ($inline\_param) { |
  |  | 510 | $output .= self::\_build\_inline($url, $inline\_param); |
  | 476 | 511 | } |
  | 477 | 512 |  |
  | 478 | 513 | $output .= "<esi:include src='$url'"; |
  | 479 |  | if ( ! empty( $control ) ) { |
  |  | 514 | if (!empty($control)) { |
  |  | 515 | $control = esc\_attr($control); |
  | 480 | 516 | $output .= " cache-control='$control'"; |
  | 481 | 517 | } |
  | 482 |  | if (~~$svar~~ ) { |
  |  | 518 | if ($svar) { |
  | 483 | 519 | $output .= " as-var='1'"; |
  | 484 | 520 | } |
  | 485 |  | if (~~in\_array( $block\_id, self::$\_combine\_ids )~~ ) { |
  |  | 521 | if (in\_array($block\_id, self::$\_combine\_ids)) { |
  | 486 | 522 | $output .= " combine='sub'"; |
  | 487 | 523 | } |
  | 488 |  | if (~~$block\_id == self::COMBO && isset( $\_SERVER[ 'X-LSCACHE' ] ) && strpos( $\_SERVER[ 'X-LSCACHE' ], 'combine' ) !== false~~ ) { |
  |  | 524 | if ($block\_id == self::COMBO && isset($\_SERVER['X-LSCACHE']) && strpos($\_SERVER['X-LSCACHE'], 'combine') !== false) { |
  | 489 | 525 | $output .= " combine='main'"; |
  | 490 | 526 | } |
  | 491 | 527 | $output .= " />"; |
  | 492 | 528 |  |
  | 493 |  | if (~~! $silence~~ ) { |
  |  | 529 | if (!$silence) { |
  | 494 | 530 | $output = "<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->"; |
  | 495 | 531 | } |
  | 496 | 532 |  |
  | 497 |  | ~~Debug2::debug( "[ESI] 💕  [BLock\_ID] $block\_id \t[wrapper] $wrapper \t\t[Control] $control"~~ ); |
  | 498 |  | ~~Debug2::debug2( $output~~ ); |
  |  | 533 | self::debug("💕  [BLock\_ID] $block\_id \t[wrapper] $wrapper \t\t[Control] $control"); |
  |  | 534 | self::debug2($output); |
  | 499 | 535 |  |
  | 500 | 536 | self::set\_has\_esi(); |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L502) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L538) |  |
  | 502 | 538 | // Convert to string to avoid html chars filter when using |
  | 503 | 539 | // Will reverse the buffer when output in self::finalize() |
  | 504 |  | if (~~$preserved~~ ) { |
  | 505 |  | $hash = md5(~~$output~~ ); |
  | 506 |  | $this->\_esi\_preserve\_list[~~$hash~~ ] = $output; |
  | 507 |  | ~~Debug2::debug( "[ESI] Preserved to $hash"~~ ); |
  |  | 540 | if ($preserved) { |
  |  | 541 | $hash = md5($output); |
  |  | 542 | $this->\_esi\_preserve\_list[$hash] = $output; |
  |  | 543 | self::debug("Preserved to $hash"); |
  | 508 | 544 |  |
  | 509 | 545 | return $hash; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L519) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L555) |  |
  | 519 | 555 | \* @access private |
  | 520 | 556 | \*/ |
  | 521 |  | private function \_gen\_esi\_md5( $params ) { |
  |  | 557 | private function \_gen\_esi\_md5($params) |
  |  | 558 | { |
  | 522 | 559 | $keys = array( |
  | 523 | 560 | self::QS\_ACTION, |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L527) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L564) |  |
  | 527 | 564 |  |
  | 528 | 565 | $str = ''; |
  | 529 |  | foreach (~~$keys as $v~~ ) { |
  | 530 |  | if (~~isset( $params[ $v ] ) && is\_string( $params[ $v ] )~~ ) { |
  | 531 |  | $str .= $params[~~$v~~ ]; |
  | 532 |  | } |
  | 533 |  | } |
  | 534 |  | Debug2::debug2(~~'[ESI] md5\_string=' . $str~~ ); |
  | 535 |  |  |
  | 536 |  | return md5(~~$this->conf( Base::HASH ) . $str~~ ); |
  |  | 566 | foreach ($keys as $v) { |
  |  | 567 | if (isset($params[$v]) && is\_string($params[$v])) { |
  |  | 568 | $str .= $params[$v]; |
  |  | 569 | } |
  |  | 570 | } |
  |  | 571 | Debug2::debug2('[ESI] md5\_string=' . $str); |
  |  | 572 |  |
  |  | 573 | return md5($this->conf(Base::HASH) . $str); |
  | 537 | 574 | } |
  | 538 | 575 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L543) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L580) |  |
  | 543 | 580 | \* @access private |
  | 544 | 581 | \*/ |
  | 545 |  | private function \_parse\_esi\_param( $qs\_params = false ) { |
  |  | 582 | private function \_parse\_esi\_param($qs\_params = false) |
  |  | 583 | { |
  | 546 | 584 | $req\_params = false; |
  | 547 |  | if (~~$qs\_params~~ ) { |
  |  | 585 | if ($qs\_params) { |
  | 548 | 586 | $req\_params = $qs\_params; |
  | 549 |  | } |
  | 550 |  | elseif ( isset( $\_REQUEST[ self::QS\_PARAMS ] ) ) { |
  | 551 |  | $req\_params = $\_REQUEST[ self::QS\_PARAMS ]; |
  | 552 |  | } |
  | 553 |  |  |
  | 554 |  | if ( ! $req\_params ) { |
  |  | 587 | } elseif (isset($\_REQUEST[self::QS\_PARAMS])) { |
  |  | 588 | $req\_params = $\_REQUEST[self::QS\_PARAMS]; |
  |  | 589 | } |
  |  | 590 |  |
  |  | 591 | if (!$req\_params) { |
  | 555 | 592 | return false; |
  | 556 | 593 | } |
  | 557 | 594 |  |
  | 558 |  | $unencrypted = base64\_decode(~~$req\_params~~ ); |
  | 559 |  | if (~~$unencrypted === false~~ ) { |
  |  | 595 | $unencrypted = base64\_decode($req\_params); |
  |  | 596 | if ($unencrypted === false) { |
  | 560 | 597 | return false; |
  | 561 | 598 | } |
  | 562 | 599 |  |
  | 563 |  | Debug2::debug2(~~'[ESI] parms', $unencrypted~~ ); |
  |  | 600 | Debug2::debug2('[ESI] parms', $unencrypted); |
  | 564 | 601 | // $unencoded = urldecode($unencrypted); no need to do this as $\_GET is already parsed |
  | 565 |  | $params = json\_decode(~~$unencrypted, true~~ ); |
  |  | 602 | $params = json\_decode($unencrypted, true); |
  | 566 | 603 |  |
  | 567 | 604 | return $params; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L574) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L611) |  |
  | 574 | 611 | \* @access public |
  | 575 | 612 | \*/ |
  | 576 |  | public function load\_esi\_block() { |
  |  | 613 | public function load\_esi\_block() |
  |  | 614 | { |
  | 577 | 615 | /\*\* |
  | 578 | 616 | \* Validate if is a legal ESI req |
  | 579 | 617 | \* @since 2.9.6 |
  | 580 | 618 | \*/ |
  | 581 |  | if (~~empty( $\_GET[ '\_hash' ] ) || $this->\_gen\_esi\_md5( $\_GET ) != $\_GET[ '\_hash' ]~~ ) { |
  | 582 |  | Debug2::debug(~~'[ESI] ❌ Failed to validate \_hash'~~ ); |
  |  | 619 | if (empty($\_GET['\_hash']) || $this->\_gen\_esi\_md5($\_GET) != $\_GET['\_hash']) { |
  |  | 620 | Debug2::debug('[ESI] ❌ Failed to validate \_hash'); |
  | 583 | 621 | return; |
  | 584 | 622 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L586) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L624) |  |
  | 586 | 624 | $params = $this->\_parse\_esi\_param(); |
  | 587 | 625 |  |
  | 588 |  | if (~~defined( 'LSCWP\_LOG' )~~ ) { |
  |  | 626 | if (defined('LSCWP\_LOG')) { |
  | 589 | 627 | $logInfo = '[ESI] ⭕ '; |
  | 590 |  | if~~( ! empty( $params[ self::PARAM\_NAME ] )~~ ) { |
  | 591 |  | $logInfo .= ' Name: ' . $params[~~self::PARAM\_NAME~~ ] . ' ----- '; |
  |  | 628 | if (!empty($params[self::PARAM\_NAME])) { |
  |  | 629 | $logInfo .= ' Name: ' . $params[self::PARAM\_NAME] . ' ----- '; |
  | 592 | 630 | } |
  | 593 | 631 | $logInfo .= ' [ID] ' . LSCACHE\_IS\_ESI; |
  | 594 |  | Debug2::debug(~~$logInfo~~ ); |
  | 595 |  | } |
  | 596 |  |  |
  | 597 |  | if (~~! empty( $params[ '\_ls\_silence' ] )~~ ) { |
  | 598 |  | !~~defined( 'LSCACHE\_ESI\_SILENCE' ) && define( 'LSCACHE\_ESI\_SILENCE', true~~ ); |
  |  | 632 | Debug2::debug($logInfo); |
  |  | 633 | } |
  |  | 634 |  |
  |  | 635 | if (!empty($params['\_ls\_silence'])) { |
  |  | 636 | !defined('LSCACHE\_ESI\_SILENCE') && define('LSCACHE\_ESI\_SILENCE', true); |
  | 599 | 637 | } |
  | 600 | 638 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L603) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L641) |  |
  | 603 | 641 | \* @since  2.9.4 |
  | 604 | 642 | \*/ |
  | 605 |  | if (~~! empty( $params[ 'is\_json' ] )~~ ) { |
  | 606 |  | add\_filter(~~'litespeed\_is\_json', '\_\_return\_true'~~ ); |
  | 607 |  | } |
  | 608 |  |  |
  | 609 |  | Tag::add(~~rtrim( Tag::TYPE\_ESI, '.' )~~ ); |
  | 610 |  | Tag::add(~~Tag::TYPE\_ESI . LSCACHE\_IS\_ESI~~ ); |
  |  | 643 | if (!empty($params['is\_json'])) { |
  |  | 644 | add\_filter('litespeed\_is\_json', '\_\_return\_true'); |
  |  | 645 | } |
  |  | 646 |  |
  |  | 647 | Tag::add(rtrim(Tag::TYPE\_ESI, '.')); |
  |  | 648 | Tag::add(Tag::TYPE\_ESI . LSCACHE\_IS\_ESI); |
  | 611 | 649 |  |
  | 612 | 650 | // Debug2::debug(var\_export($params, true )); |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L617) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L655) |  |
  | 617 | 655 | \* @since  2.2.3 |
  | 618 | 656 | \*/ |
  | 619 |  | if (~~! empty( $\_GET[ '\_control' ] )~~ ) { |
  | 620 |  | $control = explode(~~',', $\_GET[ '\_control' ]~~ ); |
  | 621 |  | if (~~in\_array( 'private', $control )~~ ) { |
  |  | 657 | if (!empty($\_GET['\_control'])) { |
  |  | 658 | $control = explode(',', $\_GET['\_control']); |
  |  | 659 | if (in\_array('private', $control)) { |
  | 622 | 660 | Control::set\_private(); |
  | 623 | 661 | } |
  | 624 | 662 |  |
  | 625 |  | if (~~in\_array( 'no-vary', $control )~~ ) { |
  |  | 663 | if (in\_array('no-vary', $control)) { |
  | 626 | 664 | Control::set\_no\_vary(); |
  | 627 | 665 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L631) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L669) |  |
  | 631 | 669 | } |
  | 632 | 670 |  |
  | 633 |  | // The \*\_sub\_\* functions are helpers for the sub\_\* functions. |
  | 634 |  | // The \*\_load\_\* functions are helpers for the load\_\* functions. |
  |  | 671 | // The \*\_sub\_\* functions are helpers for the sub\_\* functions. |
  |  | 672 | // The \*\_load\_\* functions are helpers for the load\_\* functions. |
  | 635 | 673 |  |
  | 636 | 674 | /\*\* |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L640) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L678) |  |
  | 640 | 678 | \* @access public |
  | 641 | 679 | \*/ |
  | 642 |  | public static function widget\_default\_options($options, $widget) { |
  | 643 |  | if ( ! is\_array($options) ) { |
  |  | 680 | public static function widget\_default\_options($options, $widget) |
  |  | 681 | { |
  |  | 682 | if (!is\_array($options)) { |
  | 644 | 683 | return $options; |
  | 645 | 684 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L647) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L686) |  |
  | 647 | 686 | $widget\_name = get\_class($widget); |
  | 648 | 687 | switch ($widget\_name) { |
  | 649 |  | case 'WP\_Widget\_Recent\_Posts': |
  | 650 |  | case 'WP\_Widget\_Recent\_Comments': |
  |  | 688 | case 'WP\_Widget\_Recent\_Posts': |
  |  | 689 | case 'WP\_Widget\_Recent\_Comments': |
  | 651 | 690 | $options[self::WIDGET\_O\_ESIENABLE] = Base::VAL\_OFF; |
  | 652 | 691 | $options[self::WIDGET\_O\_TTL] = 86400; |
  | 653 | 692 | break; |
  | 654 |  | default: |
  |  | 693 | default: |
  | 655 | 694 | break; |
  | 656 | 695 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L670) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L709) |  |
  | 670 | 709 | \* @return mixed Return false if display through esi, instance otherwise. |
  | 671 | 710 | \*/ |
  | 672 |  | public function sub\_widget\_block( $instance, $widget, $args ) { |
  |  | 711 | public function sub\_widget\_block($instance, $widget, $args) |
  |  | 712 | { |
  | 673 | 713 | // #210407 |
  | 674 |  | if (~~! is\_array( $instance )~~ ) { |
  |  | 714 | if (!is\_array($instance)) { |
  | 675 | 715 | return $instance; |
  | 676 | 716 | } |
  | 677 | 717 |  |
  | 678 |  | $name = get\_class(~~$widget~~ ); |
  | 679 |  | if (~~! isset( $instance[ Base::OPTION\_NAME ] )~~ ) { |
  |  | 718 | $name = get\_class($widget); |
  |  | 719 | if (!isset($instance[Base::OPTION\_NAME])) { |
  | 680 | 720 | return $instance; |
  | 681 | 721 | } |
  | 682 |  | $options = $instance[~~Base::OPTION\_NAME~~ ]; |
  | 683 |  | if (~~! isset( $options ) || ! $options[ self::WIDGET\_O\_ESIENABLE ]~~ ) { |
  | 684 |  | defined(~~'LSCWP\_LOG' ) && Debug2::debug( 'ESI 0 ' . $name . ': '. ( ! isset( $options ) ? 'not set' : 'set off' )~~ ); |
  |  | 722 | $options = $instance[Base::OPTION\_NAME]; |
  |  | 723 | if (!isset($options) || !$options[self::WIDGET\_O\_ESIENABLE]) { |
  |  | 724 | defined('LSCWP\_LOG') && Debug2::debug('ESI 0 ' . $name . ': ' . (!isset($options) ? 'not set' : 'set off')); |
  | 685 | 725 |  |
  | 686 | 726 | return $instance; |
  | 687 | 727 | } |
  | 688 | 728 |  |
  | 689 |  | $esi\_private = $options[~~self::WIDGET\_O\_ESIENABLE~~ ] == Base::VAL\_ON2 ? 'private,' : ''; |
  |  | 729 | $esi\_private = $options[self::WIDGET\_O\_ESIENABLE] == Base::VAL\_ON2 ? 'private,' : ''; |
  | 690 | 730 |  |
  | 691 | 731 | $params = array( |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L696) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L736) |  |
  | 696 | 736 | ); |
  | 697 | 737 |  |
  | 698 |  | echo $this->sub\_esi\_block(~~'widget', 'widget ' . $name, $params, $esi\_private . 'no-vary'~~ ); |
  |  | 738 | echo $this->sub\_esi\_block('widget', 'widget ' . $name, $params, $esi\_private . 'no-vary'); |
  | 699 | 739 |  |
  | 700 | 740 | return false; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L709) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L749) |  |
  | 709 | 749 | \* @global type $wp\_admin\_bar |
  | 710 | 750 | \*/ |
  | 711 |  | public function sub\_admin\_bar\_block() { |
  |  | 751 | public function sub\_admin\_bar\_block() |
  |  | 752 | { |
  | 712 | 753 | global $wp\_admin\_bar; |
  | 713 | 754 |  |
  | 714 |  | if (~~! is\_admin\_bar\_showing() || ! is\_object($wp\_admin\_bar)~~ ) { |
  |  | 755 | if (!is\_admin\_bar\_showing() || !is\_object($wp\_admin\_bar)) { |
  | 715 | 756 | return; |
  | 716 | 757 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L718) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L759) |  |
  | 718 | 759 | // To make each admin bar ESI request different for `Edit` button different link |
  | 719 | 760 | $params = array( |
  | 720 |  | 'ref' => $\_SERVER[~~'REQUEST\_URI'~~ ], |
  |  | 761 | 'ref' => $\_SERVER['REQUEST\_URI'], |
  | 721 | 762 | ); |
  | 722 | 763 |  |
  | 723 |  | echo $this->sub\_esi\_block(~~'admin-bar', 'adminbar', $params~~ ); |
  |  | 764 | echo $this->sub\_esi\_block('admin-bar', 'adminbar', $params); |
  | 724 | 765 | } |
  | 725 | 766 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L732) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L773) |  |
  | 732 | 773 | \* @param array $params Input parameters needed to correctly display widget |
  | 733 | 774 | \*/ |
  | 734 |  | public function load\_widget\_block( $params ) { |
  |  | 775 | public function load\_widget\_block($params) |
  |  | 776 | { |
  | 735 | 777 | // global $wp\_widget\_factory; |
  | 736 | 778 | // $widget = $wp\_widget\_factory->widgets[ $params[ self::PARAM\_NAME ] ]; |
  | 737 |  | $option = $params[~~self::PARAM\_INSTANCE~~ ]; |
  | 738 |  | $option = $option[~~Base::OPTION\_NAME~~ ]; |
  |  | 779 | $option = $params[self::PARAM\_INSTANCE]; |
  |  | 780 | $option = $option[Base::OPTION\_NAME]; |
  | 739 | 781 |  |
  | 740 | 782 | // Since we only reach here via esi, safe to assume setting exists. |
  | 741 |  | $ttl = $option[ self::WIDGET\_O\_TTL ]; |
  | 742 |  | defined( 'LSCWP\_LOG' ) && Debug2::debug( 'ESI widget render: name ' . $params[ self::PARAM\_NAME ] . ', id ' . $params[ self::PARAM\_ID ] . ', ttl ' . $ttl ); |
  | 743 |  | if ( $ttl == 0 ) { |
  | 744 |  | Control::set\_nocache( 'ESI Widget time to live set to 0' ); |
  | 745 |  | } |
  | 746 |  | else { |
  | 747 |  | Control::set\_custom\_ttl( $ttl ); |
  | 748 |  |  |
  | 749 |  | if ( $option[ self::WIDGET\_O\_ESIENABLE ] == Base::VAL\_ON2 ) { |
  |  | 783 | $ttl = $option[self::WIDGET\_O\_TTL]; |
  |  | 784 | defined('LSCWP\_LOG') && Debug2::debug('ESI widget render: name ' . $params[self::PARAM\_NAME] . ', id ' . $params[self::PARAM\_ID] . ', ttl ' . $ttl); |
  |  | 785 | if ($ttl == 0) { |
  |  | 786 | Control::set\_nocache('ESI Widget time to live set to 0'); |
  |  | 787 | } else { |
  |  | 788 | Control::set\_custom\_ttl($ttl); |
  |  | 789 |  |
  |  | 790 | if ($option[self::WIDGET\_O\_ESIENABLE] == Base::VAL\_ON2) { |
  | 750 | 791 | Control::set\_private(); |
  | 751 | 792 | } |
  | 752 | 793 | Control::set\_no\_vary(); |
  | 753 |  | Tag::add(~~Tag::TYPE\_WIDGET . $params[ self::PARAM\_ID ]~~ ); |
  | 754 |  | } |
  | 755 |  | the\_widget(~~$params[ self::PARAM\_NAME ], $params[ self::PARAM\_INSTANCE ], $params[ self::PARAM\_ARGS ]~~ ); |
  |  | 794 | Tag::add(Tag::TYPE\_WIDGET . $params[self::PARAM\_ID]); |
  |  | 795 | } |
  |  | 796 | the\_widget($params[self::PARAM\_NAME], $params[self::PARAM\_INSTANCE], $params[self::PARAM\_ARGS]); |
  | 756 | 797 | } |
  | 757 | 798 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L762) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L803) |  |
  | 762 | 803 | \* @since 1.1.3 |
  | 763 | 804 | \*/ |
  | 764 |  | public function load\_admin\_bar\_block( $params ) { |
  | 765 |  |  |
  | 766 |  | if ( ! empty( $params[ 'ref' ] ) ) { |
  | 767 |  | $ref\_qs = parse\_url( $params[ 'ref' ], PHP\_URL\_QUERY ); |
  | 768 |  | if ( ! empty( $ref\_qs ) ) { |
  | 769 |  | parse\_str( $ref\_qs, $ref\_qs\_arr ); |
  | 770 |  |  |
  | 771 |  | if ( ! empty( $ref\_qs\_arr ) ) { |
  | 772 |  | foreach ( $ref\_qs\_arr as $k => $v ) { |
  | 773 |  | $\_GET[ $k ] = $v; |
  |  | 805 | public function load\_admin\_bar\_block($params) |
  |  | 806 | { |
  |  | 807 |  |
  |  | 808 | if (!empty($params['ref'])) { |
  |  | 809 | $ref\_qs = parse\_url($params['ref'], PHP\_URL\_QUERY); |
  |  | 810 | if (!empty($ref\_qs)) { |
  |  | 811 | parse\_str($ref\_qs, $ref\_qs\_arr); |
  |  | 812 |  |
  |  | 813 | if (!empty($ref\_qs\_arr)) { |
  |  | 814 | foreach ($ref\_qs\_arr as $k => $v) { |
  |  | 815 | $\_GET[$k] = $v; |
  | 774 | 816 | } |
  | 775 | 817 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L778) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L820) |  |
  | 778 | 820 |  |
  | 779 | 821 | wp\_admin\_bar\_render(); |
  | 780 |  | if ( ! $this->conf( Base::O\_ESI\_CACHE\_ADMBAR ) ) { |
  | 781 |  | Control::set\_nocache( 'build-in set to not cacheable' ); |
  | 782 |  | } |
  | 783 |  | else { |
  |  | 822 | if (!$this->conf(Base::O\_ESI\_CACHE\_ADMBAR)) { |
  |  | 823 | Control::set\_nocache('build-in set to not cacheable'); |
  |  | 824 | } else { |
  | 784 | 825 | Control::set\_private(); |
  | 785 | 826 | Control::set\_no\_vary(); |
  | 786 | 827 | } |
  | 787 | 828 |  |
  | 788 |  | defined(~~'LSCWP\_LOG' ) && Debug2::debug( 'ESI: adminbar ref: ' . $\_SERVER[ 'REQUEST\_URI' ]~~ ); |
  |  | 829 | defined('LSCWP\_LOG') && Debug2::debug('ESI: adminbar ref: ' . $\_SERVER['REQUEST\_URI']); |
  | 789 | 830 | } |
  | 790 | 831 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L797) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L838) |  |
  | 797 | 838 | \* @param array $params Input parameters needed to correctly display comment form |
  | 798 | 839 | \*/ |
  | 799 |  | public function load\_comment\_form\_block(~~$params ) {~~ |
  | 800 |  | ~~comment\_form( $params[ self::PARAM\_ARGS ], $params[ self::PARAM\_ID ] );~~ |
  | 801 |  |  |
  | 802 |  | if ( ! $this->conf( Base::O\_ESI\_CACHE\_COMMFORM ) ) { |
  | 803 |  | ~~Control::set\_nocache( 'build-in set to not cacheable' );~~ |
  | 804 |  | ~~}~~ |
  | 805 |  | else { |
  |  | 840 | public function load\_comment\_form\_block($params) |
  |  | 841 | { |
  |  | 842 | comment\_form($params[self::PARAM\_ARGS], $params[self::PARAM\_ID]); |
  |  | 843 |  |
  |  | 844 | if (!$this->conf(Base::O\_ESI\_CACHE\_COMMFORM)) { |
  |  | 845 | Control::set\_nocache('build-in set to not cacheable'); |
  |  | 846 | } else { |
  | 806 | 847 | // by default comment form is public |
  | 807 |  | if (~~Vary::has\_vary()~~ ) { |
  |  | 848 | if (Vary::has\_vary()) { |
  | 808 | 849 | Control::set\_private(); |
  | 809 | 850 | Control::set\_no\_vary(); |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L818) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L859) |  |
  | 818 | 859 | \* @since 2.6 |
  | 819 | 860 | \*/ |
  | 820 |  | public function load\_nonce\_block( $params ) { |
  | 821 |  | $action = $params[ 'action' ]; |
  | 822 |  |  |
  | 823 |  | Debug2::debug( '[ESI] load\_nonce\_block [action] ' . $action ); |
  |  | 861 | public function load\_nonce\_block($params) |
  |  | 862 | { |
  |  | 863 | $action = $params['action']; |
  |  | 864 |  |
  |  | 865 | Debug2::debug('[ESI] load\_nonce\_block [action] ' . $action); |
  | 824 | 866 |  |
  | 825 | 867 | // set nonce TTL to half day |
  | 826 |  | Control::set\_custom\_ttl(~~43200~~ ); |
  | 827 |  |  |
  | 828 |  | if (~~Router::is\_logged\_in()~~ ) { |
  |  | 868 | Control::set\_custom\_ttl(43200); |
  |  | 869 |  |
  |  | 870 | if (Router::is\_logged\_in()) { |
  | 829 | 871 | Control::set\_private(); |
  | 830 | 872 | } |
  | 831 | 873 |  |
  | 832 |  | if ( function\_exists( 'wp\_create\_nonce\_litespeed\_esi' ) ) { |
  | 833 |  | echo wp\_create\_nonce\_litespeed\_esi( $action ); |
  | 834 |  | } |
  | 835 |  | else { |
  | 836 |  | echo wp\_create\_nonce( $action ); |
  |  | 874 | if (function\_exists('wp\_create\_nonce\_litespeed\_esi')) { |
  |  | 875 | echo wp\_create\_nonce\_litespeed\_esi($action); |
  |  | 876 | } else { |
  |  | 877 | echo wp\_create\_nonce($action); |
  | 837 | 878 | } |
  | 838 | 879 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L844) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L885) |  |
  | 844 | 885 | \* @since 2.8 |
  | 845 | 886 | \*/ |
  | 846 |  | public function load\_esi\_shortcode(~~$params ) {~~ |
  | 847 |  | ~~if ( isset( $params[ 'ttl' ] ) )~~ { |
  | 848 |  | ~~if ( ! $params[ 'ttl' ]~~ ) { |
  | 849 |  | ~~Control::set\_nocache( 'ESI shortcode att ttl=0' );~~ |
  | 850 |  | ~~}~~ |
  | 851 |  | else { |
  | 852 |  | Control::set\_custom\_ttl(~~$params[ 'ttl' ]~~ ); |
  | 853 |  | } |
  | 854 |  | unset(~~$params[ 'ttl' ]~~ ); |
  |  | 887 | public function load\_esi\_shortcode($params) |
  |  | 888 | { |
  |  | 889 | if (isset($params['ttl'])) { |
  |  | 890 | if (!$params['ttl']) { |
  |  | 891 | Control::set\_nocache('ESI shortcode att ttl=0'); |
  |  | 892 | } else { |
  |  | 893 | Control::set\_custom\_ttl($params['ttl']); |
  |  | 894 | } |
  |  | 895 | unset($params['ttl']); |
  | 855 | 896 | } |
  | 856 | 897 |  |
  | 857 | 898 | // Replace to original shortcode |
  | 858 |  | $shortcode = $params[~~0~~ ]; |
  |  | 899 | $shortcode = $params[0]; |
  | 859 | 900 | $atts\_ori = array(); |
  | 860 |  | foreach (~~$params as $k => $v~~ ) { |
  | 861 |  | if (~~$k === 0~~ ) { |
  |  | 901 | foreach ($params as $k => $v) { |
  |  | 902 | if ($k === 0) { |
  | 862 | 903 | continue; |
  | 863 | 904 | } |
  | 864 | 905 |  |
  | 865 |  | $atts\_ori[] = is\_string(~~$k ) ? "$k='" . addslashes( $v~~ ) . "'" : $v; |
  | 866 |  | } |
  | 867 |  |  |
  | 868 |  | Tag::add(~~Tag::TYPE\_ESI . "esi.$shortcode"~~ ); |
  |  | 906 | $atts\_ori[] = is\_string($k) ? "$k='" . addslashes($v) . "'" : $v; |
  |  | 907 | } |
  |  | 908 |  |
  |  | 909 | Tag::add(Tag::TYPE\_ESI . "esi.$shortcode"); |
  | 869 | 910 |  |
  | 870 | 911 | // Output original shortcode final content |
  | 871 |  | echo do\_shortcode(~~"[$shortcode " . implode( ' ', $atts\_ori ) . " ]"~~ ); |
  |  | 912 | echo do\_shortcode("[$shortcode " . implode(' ', $atts\_ori) . " ]"); |
  | 872 | 913 | } |
  | 873 | 914 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L881) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L922) |  |
  | 881 | 922 | \* @access public |
  | 882 | 923 | \*/ |
  | 883 |  | public function register\_comment\_form\_actions( $defaults ) { |
  |  | 924 | public function register\_comment\_form\_actions($defaults) |
  |  | 925 | { |
  | 884 | 926 | $this->esi\_args = $defaults; |
  | 885 | 927 | echo GUI::clean\_wrapper\_begin(); |
  | 886 |  | add\_filter(~~'comment\_form\_submit\_button', array( $this, 'sub\_comment\_form\_btn' ), 1000, 2~~ ); // To save the params passed in |
  | 887 |  | add\_action(~~'comment\_form', array( $this, 'sub\_comment\_form\_block' ), 1000~~ ); |
  |  | 928 | add\_filter('comment\_form\_submit\_button', array($this, 'sub\_comment\_form\_btn'), 1000, 2); // To save the params passed in |
  |  | 929 | add\_action('comment\_form', array($this, 'sub\_comment\_form\_block'), 1000); |
  | 888 | 930 | return $defaults; |
  | 889 | 931 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L895) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L937) |  |
  | 895 | 937 | \* @access public |
  | 896 | 938 | \*/ |
  | 897 |  | public function sub\_comment\_form\_btn( $unused, $args ) { |
  | 898 |  | if ( empty( $args ) || empty( $this->esi\_args ) ) { |
  | 899 |  | Debug2::debug( 'comment form args empty?' ); |
  |  | 939 | public function sub\_comment\_form\_btn($unused, $args) |
  |  | 940 | { |
  |  | 941 | if (empty($args) || empty($this->esi\_args)) { |
  |  | 942 | Debug2::debug('comment form args empty?'); |
  | 900 | 943 | return $unused; |
  | 901 | 944 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L903) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L946) |  |
  | 903 | 946 |  |
  | 904 | 947 | // compare current args with default ones |
  | 905 |  | foreach ( $args as $k => $v ) { |
  | 906 |  | if ( ! isset( $this->esi\_args[ $k ] ) ) { |
  | 907 |  | $esi\_args[ $k ] = $v; |
  | 908 |  | } |
  | 909 |  | elseif ( is\_array( $v ) ) { |
  | 910 |  | $diff = array\_diff\_assoc( $v, $this->esi\_args[ $k ] ); |
  | 911 |  | if ( ! empty( $diff ) ) { |
  | 912 |  | $esi\_args[ $k ] = $diff; |
  |  | 948 | foreach ($args as $k => $v) { |
  |  | 949 | if (!isset($this->esi\_args[$k])) { |
  |  | 950 | $esi\_args[$k] = $v; |
  |  | 951 | } elseif (is\_array($v)) { |
  |  | 952 | $diff = array\_diff\_assoc($v, $this->esi\_args[$k]); |
  |  | 953 | if (!empty($diff)) { |
  |  | 954 | $esi\_args[$k] = $diff; |
  | 913 | 955 | } |
  | 914 |  | } |
  | 915 |  | elseif ( $v !== $this->esi\_args[ $k ] ) { |
  | 916 |  | $esi\_args[ $k ] = $v; |
  |  | 956 | } elseif ($v !== $this->esi\_args[$k]) { |
  |  | 957 | $esi\_args[$k] = $v; |
  | 917 | 958 | } |
  | 918 | 959 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L931) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L972) |  |
  | 931 | 972 | \* @since 1.1.3 |
  | 932 | 973 | \*/ |
  | 933 |  | public function sub\_comment\_form\_block( $post\_id ) { |
  |  | 974 | public function sub\_comment\_form\_block($post\_id) |
  |  | 975 | { |
  | 934 | 976 | echo GUI::clean\_wrapper\_end(); |
  | 935 | 977 | $params = array( |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L938) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L980) |  |
  | 938 | 980 | ); |
  | 939 | 981 |  |
  | 940 |  | echo $this->sub\_esi\_block(~~'comment-form', 'comment form', $params~~ ); |
  |  | 982 | echo $this->sub\_esi\_block('comment-form', 'comment form', $params); |
  | 941 | 983 | echo GUI::clean\_wrapper\_begin(); |
  | 942 |  | add\_action(~~'comment\_form\_after', array( $this, 'comment\_form\_sub\_clean' )~~ ); |
  |  | 984 | add\_action('comment\_form\_after', array($this, 'comment\_form\_sub\_clean')); |
  | 943 | 985 | } |
  | 944 | 986 |  |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L950) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L992) |  |
  | 950 | 992 | \* @access public |
  | 951 | 993 | \*/ |
  | 952 |  | public function comment\_form\_sub\_clean() { |
  |  | 994 | public function comment\_form\_sub\_clean() |
  |  | 995 | { |
  | 953 | 996 | echo GUI::clean\_wrapper\_end(); |
  | 954 | 997 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L960) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L1003) |  |
  | 960 | 1003 | \* @access public |
  | 961 | 1004 | \*/ |
  | 962 |  | public function finalize( $buffer ) { |
  |  | 1005 | public function finalize($buffer) |
  |  | 1006 | { |
  | 963 | 1007 | // Prepend combo esi block |
  | 964 |  | if (~~self::$\_combine\_ids~~ ) { |
  | 965 |  | Debug2::debug(~~'[ESI] 🍔 Enabled combo'~~ ); |
  | 966 |  | $esi\_block = $this->sub\_esi\_block(~~self::COMBO, '\_\_COMBINE\_MAIN\_\_', array(), 'no-cache', true~~ ); |
  |  | 1008 | if (self::$\_combine\_ids) { |
  |  | 1009 | Debug2::debug('[ESI] 🍔 Enabled combo'); |
  |  | 1010 | $esi\_block = $this->sub\_esi\_block(self::COMBO, '\_\_COMBINE\_MAIN\_\_', array(), 'no-cache', true); |
  | 967 | 1011 | $buffer = $esi\_block . $buffer; |
  | 968 | 1012 | } |
  | 969 | 1013 |  |
  | 970 | 1014 | // Bypass if no preserved list to be replaced |
  | 971 |  | if (~~! $this->\_esi\_preserve\_list~~ ) { |
  |  | 1015 | if (!$this->\_esi\_preserve\_list) { |
  | 972 | 1016 | return $buffer; |
  | 973 | 1017 | } |
  | 974 | 1018 |  |
  | 975 |  | $keys = array\_keys(~~$this->\_esi\_preserve\_list~~ ); |
  | 976 |  |  |
  | 977 |  | Debug2::debug(~~'[ESI] replacing preserved blocks', $keys~~ ); |
  | 978 |  |  |
  | 979 |  | $buffer = str\_replace(~~$keys, $this->\_esi\_preserve\_list, $buffer~~ ); |
  |  | 1019 | $keys = array\_keys($this->\_esi\_preserve\_list); |
  |  | 1020 |  |
  |  | 1021 | Debug2::debug('[ESI] replacing preserved blocks', $keys); |
  |  | 1022 |  |
  |  | 1023 | $buffer = str\_replace($keys, $this->\_esi\_preserve\_list, $buffer); |
  | 980 | 1024 |  |
  | 981 | 1025 | return $buffer; |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L987) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L1031) |  |
  | 987 | 1031 | \* @since  3.3 |
  | 988 | 1032 | \*/ |
  | 989 |  | public function contain\_preserve\_esi( $content ) { |
  |  | 1033 | public function contain\_preserve\_esi($content) |
  |  | 1034 | { |
  | 990 | 1035 | $hit\_list = array(); |
  | 991 |  | foreach (~~$this->\_esi\_preserve\_list as $k => $v~~ ) { |
  | 992 |  | if (~~strpos( $content, '"' . $k . '"' ) !== false~~ ) { |
  |  | 1036 | foreach ($this->\_esi\_preserve\_list as $k => $v) { |
  |  | 1037 | if (strpos($content, '"' . $k . '"') !== false) { |
  | 993 | 1038 | $hit\_list[] = '"' . $k . '"'; |
  | 994 | 1039 | } |
  | 995 |  | if (~~strpos( $content, "'" . $k . "'" ) !== false~~ ) { |
  |  | 1040 | if (strpos($content, "'" . $k . "'") !== false) { |
  | 996 | 1041 | $hit\_list[] = "'" . $k . "'"; |
  | 997 | 1042 | } |
  | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2761310#L999) | […](/browser/litespeed-cache/trunk/src/esi.cls.php?rev=2977143#L1044) |  |
  | 999 | 1044 | return $hit\_list; |
  | 1000 | 1045 | } |
  | 1001 |  |  |
  | 1002 | 1046 | } |
* ## [litespeed-cache/trunk/src/htaccess.cls.php](/changeset/2977143/litespeed-cache/trunk/src/htaccess.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/htaccess.cls.php")

  | [r2928795](/browser/litespeed-cache/trunk/src/htaccess.cls.php?rev=2928795#L559 "Show revision 2928795 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/htaccess.cls.php?rev=2977143#L559 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 559 | 559 | $vary\_cookies[] = ',wp-postpass\_' . COOKIEHASH; |
  | 560 | 560 | } |
  | 561 |  | ~~$vary\_cookies = apply\_filters('litespeed\_vary\_cookies', $vary\_cookies); // todo: test if response vary header can work in latest OLS, drop the above two lines~~ |
  | 562 |  | ~~}~~ |
  |  | 561 | } |
  |  | 562 | $vary\_cookies = apply\_filters('litespeed\_vary\_cookies', $vary\_cookies); // todo: test if response vary header can work in latest OLS, drop the above two lines |
  | 563 | 563 | // frontend and backend |
  | 564 | 564 | if ($vary\_cookies) { |
  | 565 | 565 | $env = 'Cache-Vary:' . implode(',', $vary\_cookies); |
  | 566 |  | if (LITESPEED\_SERVER\_TYPE === 'LITESPEED\_SERVER\_OLS') { |
  | 567 |  | ~~$env = '"' . $env . '"';~~ |
  | 568 |  | ~~}~~ |
  |  | 566 | // if (LITESPEED\_SERVER\_TYPE === 'LITESPEED\_SERVER\_OLS') { |
  |  | 567 | // } |
  |  | 568 | $env = '"' . $env . '"'; |
  | 569 | 569 | $new\_rules[] = $new\_rules\_backend[] = self::MARKER\_LOGIN\_COOKIE . self::MARKER\_START; |
  | 570 | 570 | $new\_rules[] = $new\_rules\_backend[] = 'RewriteRule .? - [E=' . $env . ']'; |
  | […](/browser/litespeed-cache/trunk/src/htaccess.cls.php?rev=2928795#L594) | […](/browser/litespeed-cache/trunk/src/htaccess.cls.php?rev=2977143#L594) |  |
  | 594 | 594 | // webp support |
  | 595 | 595 | $id = Base::O\_IMG\_OPTM\_WEBP; |
  | 596 |  | if (!empty($cfg[$id]) || ~~!empty($cfg[Base::O\_GUEST]~~)) { |
  |  | 596 | if (!empty($cfg[$id]) || (!empty($cfg[Base::O\_GUEST]) && !empty($cfg[Base::O\_GUEST\_OPTM]))) { |
  | 597 | 597 | $new\_rules[] = self::MARKER\_WEBP . self::MARKER\_START; |
  | 598 | 598 | $new\_rules[] = 'RewriteCond %{HTTP\_ACCEPT} "image/webp"'; |
* ## [litespeed-cache/trunk/src/img-optm.cls.php](/changeset/2977143/litespeed-cache/trunk/src/img-optm.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/img-optm.cls.php")

  | [r2940517](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2940517#L1191 "Show revision 2940517 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2977143#L1191 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1191 | 1191 | $to\_be\_continued = $wpdb->get\_row($wpdb->prepare($img\_q, array($offset \* $limit, 1))); |
  | 1192 | 1192 | if ($to\_be\_continued) { |
  | 1193 |  | return Router::self\_redirect(Router::ACTION\_IMG\_OPTM, self::TYPE\_DESTROY); |
  |  | 1193 | # Check if post\_id is beyond next\_post\_id |
  |  | 1194 | self::debug('[next\_post\_id] ' . $this->\_summary['next\_post\_id'] . ' [cursor post id] ' . $to\_be\_continued->post\_id); |
  |  | 1195 | if ($to\_be\_continued->post\_id <= $this->\_summary['next\_post\_id']) { |
  |  | 1196 | self::debug('redirecting to next'); |
  |  | 1197 | return Router::self\_redirect(Router::ACTION\_IMG\_OPTM, self::TYPE\_DESTROY); |
  |  | 1198 | } |
  |  | 1199 | self::debug('🎊 Finished destroying'); |
  | 1194 | 1200 | } |
  | 1195 | 1201 |  |
  | […](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2940517#L1220) | […](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2977143#L1226) |  |
  | 1220 | 1226 | $short\_file\_path = $this->tmp\_path . $short\_file\_path; |
  | 1221 | 1227 | } |
  |  | 1228 | self::debug('deleting ' . $short\_file\_path); |
  | 1222 | 1229 |  |
  | 1223 | 1230 | // del webp |
  | […](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2940517#L1232) | […](/browser/litespeed-cache/trunk/src/img-optm.cls.php?rev=2977143#L1239) |  |
  | 1232 | 1239 | // del optimized ori |
  | 1233 | 1240 | if ($this->\_\_media->info($bk\_file, $this->tmp\_pid)) { |
  |  | 1241 | self::debug('deleting optim ori'); |
  | 1234 | 1242 | $this->\_\_media->del($short\_file\_path, $this->tmp\_pid); |
  | 1235 | 1243 | $this->\_\_media->rename($bk\_file, $short\_file\_path, $this->tmp\_pid); |
* ## [litespeed-cache/trunk/src/lang.cls.php](/changeset/2977143/litespeed-cache/trunk/src/lang.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/lang.cls.php")

  | [r2954001](/browser/litespeed-cache/trunk/src/lang.cls.php?rev=2954001#L156 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/lang.cls.php?rev=2977143#L156 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 156 | 156 | self::O\_OPTM\_DNS\_PREFETCH           => \_\_('DNS Prefetch', 'litespeed-cache'), |
  | 157 | 157 | self::O\_OPTM\_DNS\_PREFETCH\_CTRL      => \_\_('DNS Prefetch Control', 'litespeed-cache'), |
  |  | 158 | self::O\_OPTM\_DNS\_PRECONNECT         => \_\_('DNS Preconnect', 'litespeed-cache'), |
  | 158 | 159 | self::O\_OPTM\_CSS\_EXC                => \_\_('CSS Excludes', 'litespeed-cache'), |
  | 159 | 160 | self::O\_OPTM\_JS\_DELAY\_INC           => \_\_('JS Delayed Includes', 'litespeed-cache'), |
* ## [litespeed-cache/trunk/src/media.cls.php](/changeset/2977143/litespeed-cache/trunk/src/media.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/media.cls.php")

  | [r2928795](/browser/litespeed-cache/trunk/src/media.cls.php?rev=2928795#L645 "Show revision 2928795 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/media.cls.php?rev=2977143#L645 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 645 | 645 | // Add missing dimensions |
  | 646 | 646 | if (defined('LITESPEED\_GUEST\_OPTM') || $this->conf(Base::O\_MEDIA\_ADD\_MISSING\_SIZES)) { |
  | 647 |  | if (empty($attrs['width']) || $attrs['width'] == 'auto' || empty($attrs['height']) || $attrs['height'] == 'auto') { |
  |  | 647 | if (!apply\_filters('litespeed\_media\_add\_missing\_sizes', true)) { |
  |  | 648 | Debug2::debug2('[Media] add\_missing\_sizes bypassed via litespeed\_media\_add\_missing\_sizes filter'); |
  |  | 649 | } elseif (empty($attrs['width']) || $attrs['width'] == 'auto' || empty($attrs['height']) || $attrs['height'] == 'auto') { |
  | 648 | 650 | self::debug('⚠️ Missing sizes for image [src] ' . $attrs['src']); |
  | 649 | 651 | $dimensions = $this->\_detect\_dimensions($attrs['src']); |
* ## [litespeed-cache/trunk/src/optimize.cls.php](/changeset/2977143/litespeed-cache/trunk/src/optimize.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/src/optimize.cls.php")

  | [r2954001](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L35 "Show revision 2954001 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L35 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 |  |
  | 36 | 36 | private $dns\_prefetch; |
  |  | 37 | private $dns\_preconnect; |
  | 37 | 38 | private $\_ggfonts\_urls = array(); |
  | 38 | 39 | private $\_ccss; |
  | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L128) | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L129) |  |
  | 128 | 129 | \*/ |
  | 129 | 130 | $this->\_dns\_prefetch\_init(); |
  |  | 131 |  |
  |  | 132 | /\*\* |
  |  | 133 | \* Preconnect |
  |  | 134 | \* @since 5.6.1 |
  |  | 135 | \*/ |
  |  | 136 | $this->\_dns\_preconnect\_init(); |
  | 130 | 137 |  |
  | 131 | 138 | add\_filter('litespeed\_buffer\_finalize', array($this, 'finalize'), 20); |
  | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L659) | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L666) |  |
  | 659 | 666 |  |
  | 660 | 667 | /\*\* |
  |  | 668 | \* Preconnect init |
  |  | 669 | \* |
  |  | 670 | \* @since 5.6.1 |
  |  | 671 | \*/ |
  |  | 672 | private function \_dns\_preconnect\_init() |
  |  | 673 | { |
  |  | 674 |  |
  |  | 675 | $this->dns\_preconnect = $this->conf(self::O\_OPTM\_DNS\_PRECONNECT); |
  |  | 676 | if ($this->dns\_preconnect) { |
  |  | 677 | add\_action('litespeed\_optm', array($this, 'dns\_preconnect\_output')); |
  |  | 678 | } |
  |  | 679 | } |
  |  | 680 |  |
  |  | 681 | /\*\* |
  | 661 | 682 | \* Prefetch DNS hook for WP |
  | 662 | 683 | \* |
  | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L690) | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L711) |  |
  | 690 | 711 | if ($v) { |
  | 691 | 712 | $this->html\_head .= '<link rel="dns-prefetch" href="' . $v . '" />'; |
  |  | 713 | } |
  |  | 714 | } |
  |  | 715 | } |
  |  | 716 |  |
  |  | 717 | /\*\* |
  |  | 718 | \* Preconnect |
  |  | 719 | \* |
  |  | 720 | \* @since 5.6.1 |
  |  | 721 | \* @access public |
  |  | 722 | \*/ |
  |  | 723 | public function dns\_preconnect\_output() |
  |  | 724 | { |
  |  | 725 | foreach ($this->dns\_preconnect as $v) { |
  |  | 726 | if ($v) { |
  |  | 727 | $this->html\_head .= '<link rel="preconnect" href="' . $v . '" />'; |
  | 692 | 728 | } |
  | 693 | 729 | } |
  | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L823) | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L859) |  |
  | 823 | 859 |  |
  | 824 | 860 | $combine\_ext\_inl = $this->conf(self::O\_OPTM\_JS\_COMB\_EXT\_INL); |
  |  | 861 | if (!apply\_filters('litespeed\_optm\_js\_comb\_ext\_inl', true)) { |
  |  | 862 | Debug2::debug2('[Optm] js\_comb\_ext\_inl bypassed via litespeed\_optm\_js\_comb\_ext\_inl filter'); |
  |  | 863 | $combine\_ext\_inl = false; |
  |  | 864 | } |
  | 825 | 865 |  |
  | 826 | 866 | $src\_list = array(); |
  | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2954001#L996) | […](/browser/litespeed-cache/trunk/src/optimize.cls.php?rev=2977143#L1036) |  |
  | 996 | 1036 |  |
  | 997 | 1037 | $combine\_ext\_inl = $this->conf(self::O\_OPTM\_CSS\_COMB\_EXT\_INL); |
  |  | 1038 | if (!apply\_filters('litespeed\_optm\_css\_comb\_ext\_inl', true)) { |
  |  | 1039 | Debug2::debug2('[Optm] css\_comb\_ext\_inl bypassed via litespeed\_optm\_css\_comb\_ext\_inl filter'); |
  |  | 1040 | $combine\_ext\_inl = false; |
  |  | 1041 | } |
  | 998 | 1042 |  |
  | 999 | 1043 | $css\_to\_be\_removed = apply\_filters('litespeed\_optm\_css\_to\_be\_removed', array()); |
* ## [litespeed-cache/trunk/thirdparty/litespeed-check.cls.php](/changeset/2977143/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/thirdparty/litespeed-check.cls.php")

  | [r2771786](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L1 "Show revision 2771786 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* Check if any plugins that could conflict with LiteSpeed Cache are active. |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L7) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L8) |  |
  | 7 | 8 | namespace LiteSpeed\Thirdparty; |
  | 8 | 9 |  |
  | 9 |  | defined(~~'WPINC'~~ ) || exit; |
  |  | 10 | defined('WPINC') || exit; |
  | 10 | 11 |  |
  | 11 |  | class LiteSpeed\_Check { |
  |  | 12 | class LiteSpeed\_Check |
  |  | 13 | { |
  | 12 | 14 |  |
  | 13 | 15 | public static $\_incompatible\_plugins = |
  | 14 |  | array( |
  | 15 |  | // 'autoptimize/autoptimize.php', |
  | 16 |  | 'breeze/breeze.php', |
  | 17 |  | 'cache-enabler/cache-enabler.php', |
  | 18 |  | 'cachify/cachify.php', |
  | 19 |  | 'cloudflare/cloudflare.php', |
  | 20 |  | 'comet-cache/comet-cache.php', |
  | 21 |  | 'docket-cache/docket-cache.php', |
  | 22 |  | 'fast-velocity-minify/fvm.php', |
  | 23 |  | 'hummingbird-performance/wp-hummingbird.php', |
  | 24 |  | 'nginx-cache/nginx-cache.php', |
  | 25 |  | 'nitropack/main.php', |
  | 26 |  | 'pantheon-advanced-page-cache/pantheon-advanced-page-cache.php', |
  | 27 |  | 'powered-cache/powered-cache.php', |
  | 28 |  | 'sg-cachepress/sg-cachepress.php', |
  | 29 |  | 'simple-cache/simple-cache.php', |
  | 30 |  | // 'redis-cache/redis-cache.php', |
  | 31 |  | 'w3-total-cache/w3-total-cache.php', |
  | 32 |  | 'wp-cloudflare-page-cache/wp-cloudflare-page-cache.php', |
  | 33 |  | 'wp-fastest-cache/wpFastestCache.php', |
  | 34 |  | 'wp-meteor/wp-meteor.php', |
  | 35 |  | 'wp-optimize/wp-optimize.php', |
  | 36 |  | 'wp-performance-score-booster/wp-performance-score-booster.php', |
  | 37 |  | 'wp-rocket/wp-rocket.php', |
  | 38 |  | 'wp-super-cache/wp-cache.php', |
  | 39 |  | ); |
  |  | 16 | array( |
  |  | 17 | // 'autoptimize/autoptimize.php', |
  |  | 18 | 'breeze/breeze.php', |
  |  | 19 | 'cache-enabler/cache-enabler.php', |
  |  | 20 | 'cachify/cachify.php', |
  |  | 21 | 'cloudflare/cloudflare.php', |
  |  | 22 | 'comet-cache/comet-cache.php', |
  |  | 23 | 'docket-cache/docket-cache.php', |
  |  | 24 | 'fast-velocity-minify/fvm.php', |
  |  | 25 | 'hummingbird-performance/wp-hummingbird.php', |
  |  | 26 | 'nginx-cache/nginx-cache.php', |
  |  | 27 | 'nitropack/main.php', |
  |  | 28 | 'pantheon-advanced-page-cache/pantheon-advanced-page-cache.php', |
  |  | 29 | 'powered-cache/powered-cache.php', |
  |  | 30 | 'psn-pagespeed-ninja/pagespeedninja.php', |
  |  | 31 | 'sg-cachepress/sg-cachepress.php', |
  |  | 32 | 'simple-cache/simple-cache.php', |
  |  | 33 | // 'redis-cache/redis-cache.php', |
  |  | 34 | 'w3-total-cache/w3-total-cache.php', |
  |  | 35 | 'wp-cloudflare-page-cache/wp-cloudflare-page-cache.php', |
  |  | 36 | 'wp-fastest-cache/wpFastestCache.php', |
  |  | 37 | 'wp-meteor/wp-meteor.php', |
  |  | 38 | 'wp-optimize/wp-optimize.php', |
  |  | 39 | 'wp-performance-score-booster/wp-performance-score-booster.php', |
  |  | 40 | 'wp-rocket/wp-rocket.php', |
  |  | 41 | 'wp-super-cache/wp-cache.php', |
  |  | 42 | ); |
  | 40 | 43 |  |
  | 41 | 44 | private static $\_option = 'thirdparty\_litespeed\_check'; |
  | 42 | 45 | private static $\_msg\_id = 'id="lscwp-incompatible-plugin-notice"'; |
  | 43 | 46 |  |
  | 44 |  | public static function detect() { |
  | 45 |  | if ( ! is\_admin() ) { |
  |  | 47 | public static function detect() |
  |  | 48 | { |
  |  | 49 | if (!is\_admin()) { |
  | 46 | 50 | return; |
  | 47 | 51 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L50) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L54) |  |
  | 50 | 54 | \* Check for incompatible plugins when `litespeed-cache` is first activated. |
  | 51 | 55 | \*/ |
  | 52 |  | $plugin = basename(~~LSCWP\_DIR~~ ) . '/litespeed-cache.php'; |
  | 53 |  | register\_deactivation\_hook(~~$plugin, function( $\_network\_wide~~ ) { |
  | 54 |  | \LiteSpeed\Admin\_Display::delete\_option(~~self::$\_option~~ ); |
  | 55 |  | }); |
  | 56 |  | if (~~! \LiteSpeed\Admin\_Display::get\_option( self::$\_option )~~ ) { |
  | 57 |  | self::activated\_plugin(~~$plugin, null~~ ); |
  | 58 |  | \LiteSpeed\Admin\_Display::add\_option(~~self::$\_option, true~~ ); |
  |  | 56 | $plugin = basename(LSCWP\_DIR) . '/litespeed-cache.php'; |
  |  | 57 | register\_deactivation\_hook($plugin, function ($\_network\_wide) { |
  |  | 58 | \LiteSpeed\Admin\_Display::delete\_option(self::$\_option); |
  |  | 59 | }); |
  |  | 60 | if (!\LiteSpeed\Admin\_Display::get\_option(self::$\_option)) { |
  |  | 61 | self::activated\_plugin($plugin, null); |
  |  | 62 | \LiteSpeed\Admin\_Display::add\_option(self::$\_option, true); |
  | 59 | 63 | } |
  | 60 | 64 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L62) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L66) |  |
  | 62 | 66 | \* Check for incompatible plugins when any plugin is (de)activated. |
  | 63 | 67 | \*/ |
  | 64 |  | add\_action( 'activated\_plugin', \_\_CLASS\_\_ . '::activated\_plugin', 10, 2 ); |
  | 65 |  | add\_action( 'deactivated\_plugin', \_\_CLASS\_\_ . '::deactivated\_plugin', 10, 2 ); |
  |  | 68 | add\_action('activated\_plugin', \_\_CLASS\_\_ . '::activated\_plugin', 10, 2); |
  |  | 69 | add\_action('deactivated\_plugin', \_\_CLASS\_\_ . '::deactivated\_plugin', 10, 2); |
  |  | 70 |  |
  |  | 71 | if (class\_exists('PagespeedNinja')) { |
  |  | 72 | \LiteSpeed\Admin\_Display::error( |
  |  | 73 | '<div ' . self::$\_msg\_id . '>' |
  |  | 74 | . esc\_html\_\_( |
  |  | 75 | 'Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', |
  |  | 76 | 'litespeed-cache' |
  |  | 77 | ) |
  |  | 78 | . '<p style="color: red; font-weight: 700;">' |
  |  | 79 | . 'PageSpeed Ninja' |
  |  | 80 | . '</p>' |
  |  | 81 | . '</div>', |
  |  | 82 | false, |
  |  | 83 | true |
  |  | 84 | ); |
  |  | 85 | } |
  | 66 | 86 | } |
  | 67 | 87 |  |
  | 68 |  | public static function activated\_plugin( $plugin, $network\_wide ) { |
  | 69 |  | self::incompatible\_plugin\_notice( $plugin, $network\_wide, 'activated' ); |
  |  | 88 | public static function activated\_plugin($plugin, $network\_wide) |
  |  | 89 | { |
  |  | 90 | self::incompatible\_plugin\_notice($plugin, $network\_wide, 'activated'); |
  | 70 | 91 | } |
  | 71 | 92 |  |
  | 72 |  | public static function deactivated\_plugin( $plugin, $network\_wide ) { |
  | 73 |  | self::incompatible\_plugin\_notice( $plugin, $network\_wide, 'deactivated' ); |
  |  | 93 | public static function deactivated\_plugin($plugin, $network\_wide) |
  |  | 94 | { |
  |  | 95 | self::incompatible\_plugin\_notice($plugin, $network\_wide, 'deactivated'); |
  | 74 | 96 | } |
  | 75 | 97 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L78) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L100) |  |
  | 78 | 100 | \* Show a notification if there are any. |
  | 79 | 101 | \*/ |
  | 80 |  | public static function incompatible\_plugin\_notice( $plugin, $\_network\_wide, $action ) { |
  |  | 102 | public static function incompatible\_plugin\_notice($plugin, $\_network\_wide, $action) |
  |  | 103 | { |
  | 81 | 104 | self::update\_messages(); |
  | 82 | 105 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L86) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L109) |  |
  | 86 | 109 | \* remove `$plugin` from the list. |
  | 87 | 110 | \*/ |
  | 88 |  | $deactivated = 'deactivated' === $action ? array(~~$plugin~~ ) : array(); |
  |  | 111 | $deactivated = 'deactivated' === $action ? array($plugin) : array(); |
  | 89 | 112 |  |
  | 90 | 113 | $incompatible\_plugins = |
  | 91 | 114 | array\_map( |
  | 92 |  | function( $plugin ) { return WP\_PLUGIN\_DIR . '/' . $plugin; }, |
  | 93 |  | array\_diff( self::$\_incompatible\_plugins, $deactivated ) |
  |  | 115 | function ($plugin) { |
  |  | 116 | return WP\_PLUGIN\_DIR . '/' . $plugin; |
  |  | 117 | }, |
  |  | 118 | array\_diff(self::$\_incompatible\_plugins, $deactivated) |
  | 94 | 119 | ); |
  | 95 | 120 |  |
  | 96 | 121 | $active\_incompatible\_plugins = |
  | 97 | 122 | array\_map( |
  | 98 |  | function~~( $plugin~~ ) { |
  | 99 |  | $plugin = get\_plugin\_data(~~$plugin, false, true~~ ); |
  |  | 123 | function ($plugin) { |
  |  | 124 | $plugin = get\_plugin\_data($plugin, false, true); |
  | 100 | 125 | return $plugin['Name']; |
  | 101 | 126 | }, |
  | 102 |  | array\_intersect(~~$incompatible\_plugins, wp\_get\_active\_and\_valid\_plugins()~~ ) |
  |  | 127 | array\_intersect($incompatible\_plugins, wp\_get\_active\_and\_valid\_plugins()) |
  | 103 | 128 | ); |
  | 104 | 129 |  |
  | 105 |  | if (~~empty( $active\_incompatible\_plugins )~~ ) { |
  |  | 130 | if (empty($active\_incompatible\_plugins)) { |
  | 106 | 131 | return; |
  | 107 | 132 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L109) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L134) |  |
  | 109 | 134 | \LiteSpeed\Admin\_Display::error( |
  | 110 | 135 | '<div ' . self::$\_msg\_id . '>' |
  | 111 |  | . esc\_html\_\_( |
  | 112 |  | 'Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', |
  | 113 |  | 'litespeed-cache' |
  | 114 |  | ) |
  | 115 |  | . '<p style="color: red; font-weight: 700;">' |
  | 116 |  | ~~. implode( ', ', $active\_incompatible\_plugins~~ ) |
  | 117 |  | . '</p>' |
  | 118 |  | . '</div>', |
  |  | 136 | . esc\_html\_\_( |
  |  | 137 | 'Please consider disabling the following detected plugins, as they may conflict with LiteSpeed Cache:', |
  |  | 138 | 'litespeed-cache' |
  |  | 139 | ) |
  |  | 140 | . '<p style="color: red; font-weight: 700;">' |
  |  | 141 | . implode(', ', $active\_incompatible\_plugins) |
  |  | 142 | . '</p>' |
  |  | 143 | . '</div>', |
  | 119 | 144 | false, |
  | 120 | 145 | true |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L127) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L152) |  |
  | 127 | 152 | \* notice(s). |
  | 128 | 153 | \*/ |
  | 129 |  | private static function update\_messages() { |
  |  | 154 | private static function update\_messages() |
  |  | 155 | { |
  | 130 | 156 | $messages = |
  | 131 | 157 | \LiteSpeed\Admin\_Display::get\_option( |
  | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2771786#L133) | […](/browser/litespeed-cache/trunk/thirdparty/litespeed-check.cls.php?rev=2977143#L159) |  |
  | 133 | 159 | array() |
  | 134 | 160 | ); |
  | 135 |  | if (~~is\_array( $messages )~~ ) { |
  | 136 |  | foreach (~~$messages as $index => $message~~ ) { |
  | 137 |  | if (~~strpos( $message, self::$\_msg\_id ) !== false~~ ) { |
  | 138 |  | unset(~~$messages[ $index ]~~ ); |
  | 139 |  | if (~~! $messages~~ ) { |
  |  | 161 | if (is\_array($messages)) { |
  |  | 162 | foreach ($messages as $index => $message) { |
  |  | 163 | if (strpos($message, self::$\_msg\_id) !== false) { |
  |  | 164 | unset($messages[$index]); |
  |  | 165 | if (!$messages) { |
  | 140 | 166 | $messages = -1; |
  | 141 | 167 | } |
* ## [litespeed-cache/trunk/thirdparty/woocommerce.cls.php](/changeset/2977143/litespeed-cache/trunk/thirdparty/woocommerce.cls.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/thirdparty/woocommerce.cls.php")

  | [r2832517](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L1 "Show revision 2832517 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | /\*\* |
  | 3 | 4 | \* The Third Party integration with the WooCommerce plugin. |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L9) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L10) |  |
  | 9 | 10 | \* @author        LiteSpeed Technologies <info@litespeedtech.com> |
  | 10 | 11 | \*/ |
  |  | 12 |  |
  | 11 | 13 | namespace LiteSpeed\Thirdparty; |
  | 12 | 14 |  |
  | 13 |  | defined(~~'WPINC'~~ ) || exit; |
  |  | 15 | defined('WPINC') || exit; |
  | 14 | 16 |  |
  | 15 | 17 | use \LiteSpeed\API; |
  | 16 | 18 | use \LiteSpeed\Base; |
  | 17 | 19 |  |
  | 18 |  | class WooCommerce extends Base { |
  |  | 20 | class WooCommerce extends Base |
  |  | 21 | { |
  | 19 | 22 | const O\_CACHE\_TTL\_FRONTPAGE = Base::O\_CACHE\_TTL\_FRONTPAGE; |
  | 20 | 23 |  |
  | 21 |  | const CACHETAG\_SHOP = 'WC\_S' ; |
  | 22 |  | const CACHETAG\_TERM = 'WC\_T.' ; |
  | 23 |  | const O\_UPDATE\_INTERVAL = 'wc\_update\_interval' ; |
  | 24 |  | const O\_PQS\_CS = 0 ; // flush product on quantity + stock change, categories on stock change |
  | 25 |  | const O\_PS\_CS = 1 ; // flush product and categories on stock change |
  | 26 |  | const O\_PS\_CN = 2 ; // flush product on stock change, categories no flush |
  | 27 |  | const O\_PQS\_CQS = 3 ; // flush product and categories on quantity + stock change |
  | 28 |  |  |
  | 29 |  | const ESI\_PARAM\_ARGS = 'wc\_args' ; |
  | 30 |  | const ESI\_PARAM\_POSTID = 'wc\_post\_id' ; |
  | 31 |  | const ESI\_PARAM\_NAME = 'wc\_name' ; |
  | 32 |  | const ESI\_PARAM\_PATH = 'wc\_path' ; |
  | 33 |  | const ESI\_PARAM\_LOCATED = 'wc\_located' ; |
  | 34 |  |  |
  | 35 |  | private $esi\_enabled ; |
  |  | 24 | const CACHETAG\_SHOP = 'WC\_S'; |
  |  | 25 | const CACHETAG\_TERM = 'WC\_T.'; |
  |  | 26 | const O\_UPDATE\_INTERVAL = 'wc\_update\_interval'; |
  |  | 27 | const O\_CART\_VARY = 'wc\_cart\_vary'; |
  |  | 28 | const O\_PQS\_CS = 0; // flush product on quantity + stock change, categories on stock change |
  |  | 29 | const O\_PS\_CS = 1; // flush product and categories on stock change |
  |  | 30 | const O\_PS\_CN = 2; // flush product on stock change, categories no flush |
  |  | 31 | const O\_PQS\_CQS = 3; // flush product and categories on quantity + stock change |
  |  | 32 |  |
  |  | 33 | const ESI\_PARAM\_ARGS = 'wc\_args'; |
  |  | 34 | const ESI\_PARAM\_POSTID = 'wc\_post\_id'; |
  |  | 35 | const ESI\_PARAM\_NAME = 'wc\_name'; |
  |  | 36 | const ESI\_PARAM\_PATH = 'wc\_path'; |
  |  | 37 | const ESI\_PARAM\_LOCATED = 'wc\_located'; |
  |  | 38 |  |
  |  | 39 | private $esi\_enabled; |
  | 36 | 40 |  |
  | 37 | 41 | /\*\* |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L43) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L47) |  |
  | 43 | 47 | public static function detect() |
  | 44 | 48 | { |
  | 45 |  | if ( ! defined( 'WOOCOMMERCE\_VERSION' ) ) { |
  | 46 |  | return ; |
  | 47 |  | } |
  | 48 |  |  |
  | 49 |  | self::cls()->add\_hooks() ; |
  | 50 |  |  |
  |  | 49 | if (!defined('WOOCOMMERCE\_VERSION')) { |
  |  | 50 | return; |
  |  | 51 | } |
  |  | 52 |  |
  |  | 53 | self::cls()->add\_hooks(); |
  | 51 | 54 | } |
  | 52 | 55 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L59) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L62) |  |
  | 59 | 62 | public function add\_hooks() |
  | 60 | 63 | { |
  | 61 |  | $this->\_option\_append(); |
  | 62 |  |  |
  | 63 |  | $this->esi\_enabled = apply\_filters(~~'litespeed\_esi\_status', false~~ ); |
  | 64 |  |  |
  | 65 |  | add\_action(~~'litespeed\_control\_finalize', array( $this, 'set\_control' )~~ ); |
  | 66 |  | add\_action(~~'litespeed\_tag\_finalize', array( $this, 'set\_tag' )~~ ); |
  |  | 64 | $this->\_option\_append(); |
  |  | 65 |  |
  |  | 66 | $this->esi\_enabled = apply\_filters('litespeed\_esi\_status', false); |
  |  | 67 |  |
  |  | 68 | add\_action('litespeed\_control\_finalize', array($this, 'set\_control')); |
  |  | 69 | add\_action('litespeed\_tag\_finalize', array($this, 'set\_tag')); |
  | 67 | 70 |  |
  | 68 | 71 | // Purging a product on stock change should only occur during product purchase. This function will add the purging callback when an order is complete. |
  | 69 |  | add\_action(~~'woocommerce\_product\_set\_stock', array( $this, 'purge\_product' ) )~~ ; |
  | 70 |  | add\_action(~~'woocommerce\_variation\_set\_stock', array( $this, 'purge\_product' ) )~~ ; // #984479 Update variations stock |
  | 71 |  |  |
  | 72 |  | add\_action(~~'comment\_post', array( $this, 'add\_review' ), 10, 3 )~~ ; |
  | 73 |  |  |
  | 74 |  | if (~~$this->esi\_enabled~~ ) { |
  | 75 |  | if (~~function\_exists( 'is\_shop' ) && ! is\_shop()~~ ) { |
  | 76 |  | add\_action(~~'litespeed\_tpl\_normal', array( $this, 'set\_block\_template' )~~ ); |
  |  | 72 | add\_action('woocommerce\_product\_set\_stock', array($this, 'purge\_product')); |
  |  | 73 | add\_action('woocommerce\_variation\_set\_stock', array($this, 'purge\_product')); // #984479 Update variations stock |
  |  | 74 |  |
  |  | 75 | add\_action('comment\_post', array($this, 'add\_review'), 10, 3); |
  |  | 76 |  |
  |  | 77 | if ($this->esi\_enabled) { |
  |  | 78 | if (function\_exists('is\_shop') && !is\_shop()) { |
  |  | 79 | add\_action('litespeed\_tpl\_normal', array($this, 'set\_block\_template')); |
  | 77 | 80 | // No need for add-to-cart button |
  | 78 | 81 | // add\_action( 'litespeed\_esi\_load-wc-add-to-cart-form', array( $this, 'load\_add\_to\_cart\_form\_block' ) ) ; |
  | 79 | 82 |  |
  | 80 |  | add\_action( 'litespeed\_esi\_load-storefront-cart-header', array( $this, 'load\_cart\_header' ) ); |
  | 81 |  | add\_action( 'litespeed\_esi\_load-widget', array( $this, 'register\_post\_view' ) ); |
  | 82 |  | } |
  | 83 |  |  |
  | 84 |  | if ( function\_exists( 'is\_product' ) && is\_product() ) { |
  | 85 |  | add\_filter( 'litespeed\_esi\_params', array( $this, 'add\_post\_id' ), 10, 2 ); |
  | 86 |  | } |
  | 87 |  |  |
  | 88 |  | } |
  | 89 |  |  |
  | 90 |  | if ( is\_admin() ) { |
  | 91 |  | add\_action('litespeed\_api\_purge\_post', array( $this, 'backend\_purge' ) ) ;//todo |
  | 92 |  | add\_action( 'delete\_term\_relationships', array( $this, 'delete\_rel' ), 10, 2 ) ; |
  | 93 |  | add\_action( 'litespeed\_settings\_tab', array( $this, 'settings\_add\_tab' ) ); |
  | 94 |  | add\_action( 'litespeed\_settings\_content', array( $this, 'settings\_add\_content' ) ); |
  | 95 |  | add\_filter( 'litespeed\_widget\_default\_options', array( $this, 'wc\_widget\_default' ), 10, 2 ); |
  | 96 |  | } |
  | 97 |  |  |
  |  | 83 | add\_action('litespeed\_esi\_load-storefront-cart-header', array($this, 'load\_cart\_header')); |
  |  | 84 | add\_action('litespeed\_esi\_load-widget', array($this, 'register\_post\_view')); |
  |  | 85 | } |
  |  | 86 |  |
  |  | 87 | if (function\_exists('is\_product') && is\_product()) { |
  |  | 88 | add\_filter('litespeed\_esi\_params', array($this, 'add\_post\_id'), 10, 2); |
  |  | 89 | } |
  |  | 90 | } |
  |  | 91 |  |
  |  | 92 | if (is\_admin()) { |
  |  | 93 | add\_action('litespeed\_api\_purge\_post', array($this, 'backend\_purge')); //todo |
  |  | 94 | add\_action('delete\_term\_relationships', array($this, 'delete\_rel'), 10, 2); |
  |  | 95 | add\_action('litespeed\_settings\_tab', array($this, 'settings\_add\_tab')); |
  |  | 96 | add\_action('litespeed\_settings\_content', array($this, 'settings\_add\_content')); |
  |  | 97 | add\_filter('litespeed\_widget\_default\_options', array($this, 'wc\_widget\_default'), 10, 2); |
  |  | 98 | } |
  |  | 99 |  |
  |  | 100 | if (apply\_filters('litespeed\_conf', self::O\_CART\_VARY)) { |
  |  | 101 | add\_filter('litespeed\_vary\_cookies', function ($list) { |
  |  | 102 | $list[] = 'woocommerce\_cart\_hash'; |
  |  | 103 | return array\_unique($list); |
  |  | 104 | }); |
  |  | 105 | } |
  | 98 | 106 | } |
  | 99 | 107 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L106) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L114) |  |
  | 106 | 114 | public function purge\_esi() |
  | 107 | 115 | { |
  | 108 |  | do\_action( 'litespeed\_debug', '3rd woo purge ESI in action: ' . current\_filter() ) ; |
  | 109 |  | do\_action( 'litespeed\_purge\_private\_esi', 'storefront-cart-header' ); |
  | 110 |  |  |
  |  | 116 | do\_action('litespeed\_debug', '3rd woo purge ESI in action: ' . current\_filter()); |
  |  | 117 | do\_action('litespeed\_purge\_private\_esi', 'storefront-cart-header'); |
  | 111 | 118 | } |
  | 112 | 119 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L119) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L126) |  |
  | 119 | 126 | public function purge\_private\_all() |
  | 120 | 127 | { |
  | 121 |  | do\_action(~~'litespeed\_purge\_private\_all'~~ ); |
  |  | 128 | do\_action('litespeed\_purge\_private\_all'); |
  | 122 | 129 | } |
  | 123 | 130 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L128) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L135) |  |
  | 128 | 135 | \* @access public |
  | 129 | 136 | \*/ |
  | 130 |  | public function check\_if\_need\_esi(~~$template~~ ) |
  | 131 |  | { |
  | 132 |  | if (~~$this->vary\_needed()~~ ) { |
  | 133 |  | do\_action(~~'litespeed\_debug', 'API: 3rd woo added ESI'~~ ); |
  | 134 |  | add\_action(~~'litespeed\_tpl\_normal', array( $this, 'set\_swap\_header\_cart' )~~ ); |
  |  | 137 | public function check\_if\_need\_esi($template) |
  |  | 138 | { |
  |  | 139 | if ($this->vary\_needed()) { |
  |  | 140 | do\_action('litespeed\_debug', 'API: 3rd woo added ESI'); |
  |  | 141 | add\_action('litespeed\_tpl\_normal', array($this, 'set\_swap\_header\_cart')); |
  | 135 | 142 | } |
  | 136 | 143 |  |
  | 137 | 144 | return $template; |
  | 138 |  |  |
  | 139 | 145 | } |
  | 140 | 146 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L145) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L151) |  |
  | 145 | 151 | \* @access public |
  | 146 | 152 | \*/ |
  | 147 |  | public function vary\_maintain( $vary ) { |
  | 148 |  | if ( $this->vary\_needed() ) { |
  | 149 |  | do\_action( 'litespeed\_debug', 'API: 3rd woo added vary due to cart not empty' ); |
  | 150 |  | $vary[ 'woo\_cart' ] = 1; |
  |  | 153 | public function vary\_maintain($vary) |
  |  | 154 | { |
  |  | 155 | if ($this->vary\_needed()) { |
  |  | 156 | do\_action('litespeed\_debug', 'API: 3rd woo added vary due to cart not empty'); |
  |  | 157 | $vary['woo\_cart'] = 1; |
  | 151 | 158 | } |
  | 152 | 159 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L162) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L169) |  |
  | 162 | 169 | private function vary\_needed() |
  | 163 | 170 | { |
  | 164 |  | if (~~! function\_exists( 'WC' )~~ ) { |
  | 165 |  | return false; |
  | 166 |  | } |
  | 167 |  |  |
  | 168 |  | $woocom = WC(); |
  | 169 |  | if (~~! $woocom~~ ) { |
  | 170 |  | return false; |
  | 171 |  | } |
  | 172 |  |  |
  | 173 |  | if (~~is\_null( $woocom->cart )~~ ) { |
  | 174 |  | return false; |
  | 175 |  | } |
  | 176 |  | return $woocom->cart->get\_cart\_contents\_count() > 0; |
  |  | 171 | if (!function\_exists('WC')) { |
  |  | 172 | return false; |
  |  | 173 | } |
  |  | 174 |  |
  |  | 175 | $woocom = WC(); |
  |  | 176 | if (!$woocom) { |
  |  | 177 | return false; |
  |  | 178 | } |
  |  | 179 |  |
  |  | 180 | if (is\_null($woocom->cart)) { |
  |  | 181 | return false; |
  |  | 182 | } |
  |  | 183 | return $woocom->cart->get\_cart\_contents\_count() > 0; |
  | 177 | 184 | } |
  | 178 | 185 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L186) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L193) |  |
  | 186 | 193 | public function set\_block\_template() |
  | 187 | 194 | { |
  | 188 |  | add\_action('woocommerce\_before\_template\_part', array(~~$this, 'block\_template' ), 999, 4)~~ ; |
  |  | 195 | add\_action('woocommerce\_before\_template\_part', array($this, 'block\_template'), 999, 4); |
  | 189 | 196 | } |
  | 190 | 197 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L202) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L209) |  |
  | 202 | 209 | public function set\_swap\_header\_cart() |
  | 203 | 210 | { |
  | 204 |  | $priority = has\_action('storefront\_header', 'storefront\_header\_cart'); |
  | 205 |  | if (~~$priority !== false~~ ) { |
  | 206 |  | remove\_action('storefront\_header', 'storefront\_header\_cart', $priority); |
  | 207 |  | add\_action('storefront\_header', array(~~$this, 'esi\_cart\_header' ), $priority)~~ ; |
  |  | 211 | $priority = has\_action('storefront\_header', 'storefront\_header\_cart'); |
  |  | 212 | if ($priority !== false) { |
  |  | 213 | remove\_action('storefront\_header', 'storefront\_header\_cart', $priority); |
  |  | 214 | add\_action('storefront\_header', array($this, 'esi\_cart\_header'), $priority); |
  | 208 | 215 | } |
  | 209 | 216 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L220) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L227) |  |
  | 220 | 227 | public function block\_template($template\_name, $template\_path, $located, $args) |
  | 221 | 228 | { |
  | 222 |  | if (~~strpos($template\_name, 'add-to-cart') === false~~ ) { |
  | 223 |  | if (~~strpos($template\_name, 'related.php') !== false~~ ) { |
  | 224 |  | remove\_action('woocommerce\_before\_template\_part', array(~~$this, 'block\_template' ), 999)~~ ; |
  | 225 |  | add\_filter('woocommerce\_related\_products\_args', array(~~$this, 'add\_related\_tags' ) )~~ ; |
  | 226 |  | add\_action('woocommerce\_after\_template\_part', array(~~$this, 'end\_template' ), 999)~~ ; |
  | 227 |  | } |
  | 228 |  | return; |
  | 229 |  | } |
  | 230 |  | return; |
  | 231 |  |  |
  | 232 |  |  |
  | 233 |  |  |
  | 234 |  |  |
  | 235 |  | // todo: wny not use? |
  | 236 |  |  |
  | 237 |  | global $post; |
  |  | 229 | if (strpos($template\_name, 'add-to-cart') === false) { |
  |  | 230 | if (strpos($template\_name, 'related.php') !== false) { |
  |  | 231 | remove\_action('woocommerce\_before\_template\_part', array($this, 'block\_template'), 999); |
  |  | 232 | add\_filter('woocommerce\_related\_products\_args', array($this, 'add\_related\_tags')); |
  |  | 233 | add\_action('woocommerce\_after\_template\_part', array($this, 'end\_template'), 999); |
  |  | 234 | } |
  |  | 235 | return; |
  |  | 236 | } |
  |  | 237 | return; |
  |  | 238 |  |
  |  | 239 |  |
  |  | 240 |  |
  |  | 241 |  |
  |  | 242 | // todo: wny not use? |
  |  | 243 |  |
  |  | 244 | global $post; |
  | 238 | 245 | $params = array( |
  | 239 | 246 | self::ESI\_PARAM\_ARGS => $args, |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L242) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L249) |  |
  | 242 | 249 | self::ESI\_PARAM\_PATH => $template\_path, |
  | 243 | 250 | self::ESI\_PARAM\_LOCATED => $located |
  | 244 |  | ); |
  | 245 |  | add\_action('woocommerce\_after\_add\_to\_cart\_form', array(~~$this, 'end\_form' ) )~~ ; |
  | 246 |  | add\_action('woocommerce\_after\_template\_part', array(~~$this, 'end\_form' ), 999)~~ ; |
  | 247 |  | echo apply\_filters(~~'litespeed\_esi\_url', 'wc-add-to-cart-form', 'WC\_CART\_FORM', $params~~ ); |
  | 248 |  | echo apply\_filters(~~'litespeed\_clean\_wrapper\_begin', ''~~ ); |
  |  | 251 | ); |
  |  | 252 | add\_action('woocommerce\_after\_add\_to\_cart\_form', array($this, 'end\_form')); |
  |  | 253 | add\_action('woocommerce\_after\_template\_part', array($this, 'end\_form'), 999); |
  |  | 254 | echo apply\_filters('litespeed\_esi\_url', 'wc-add-to-cart-form', 'WC\_CART\_FORM', $params); |
  |  | 255 | echo apply\_filters('litespeed\_clean\_wrapper\_begin', ''); |
  | 249 | 256 | } |
  | 250 | 257 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L260) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L267) |  |
  | 260 | 267 | public function end\_form($template\_name = '') |
  | 261 | 268 | { |
  | 262 |  | if (~~! empty($template\_name) && strpos($template\_name, 'add-to-cart') === false~~ ) { |
  | 263 |  | return; |
  | 264 |  | } |
  | 265 |  | echo apply\_filters(~~'litespeed\_clean\_wrapper\_end', ''~~ ); |
  | 266 |  | remove\_action('woocommerce\_after\_add\_to\_cart\_form', array(~~$this, 'end\_form' ) )~~ ; |
  | 267 |  | remove\_action('woocommerce\_after\_template\_part', array(~~$this, 'end\_form' ), 999)~~ ; |
  |  | 269 | if (!empty($template\_name) && strpos($template\_name, 'add-to-cart') === false) { |
  |  | 270 | return; |
  |  | 271 | } |
  |  | 272 | echo apply\_filters('litespeed\_clean\_wrapper\_end', ''); |
  |  | 273 | remove\_action('woocommerce\_after\_add\_to\_cart\_form', array($this, 'end\_form')); |
  |  | 274 | remove\_action('woocommerce\_after\_template\_part', array($this, 'end\_form'), 999); |
  | 268 | 275 | } |
  | 269 | 276 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L281) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L288) |  |
  | 281 | 288 | public function add\_related\_tags($args) |
  | 282 | 289 | { |
  | 283 |  | if (~~empty($args) || ! isset($args['post\_\_in'])~~ ) { |
  | 284 |  | return $args; |
  | 285 |  | } |
  | 286 |  | $related\_posts = $args['post\_\_in']; |
  | 287 |  | foreach (~~$related\_posts as $related~~ ) { |
  | 288 |  | do\_action(~~'litespeed\_tag\_add\_post', $related~~ ); |
  | 289 |  | } |
  | 290 |  | return $args; |
  |  | 290 | if (empty($args) || !isset($args['post\_\_in'])) { |
  |  | 291 | return $args; |
  |  | 292 | } |
  |  | 293 | $related\_posts = $args['post\_\_in']; |
  |  | 294 | foreach ($related\_posts as $related) { |
  |  | 295 | do\_action('litespeed\_tag\_add\_post', $related); |
  |  | 296 | } |
  |  | 297 | return $args; |
  | 291 | 298 | } |
  | 292 | 299 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L302) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L309) |  |
  | 302 | 309 | public function end\_template($template\_name) |
  | 303 | 310 | { |
  | 304 |  | if (~~strpos($template\_name, 'related.php') !== false~~ ) { |
  | 305 |  | remove\_action('woocommerce\_after\_template\_part', array(~~$this, 'end\_template' ), 999)~~ ; |
  | 306 |  | $this->set\_block\_template(); |
  |  | 311 | if (strpos($template\_name, 'related.php') !== false) { |
  |  | 312 | remove\_action('woocommerce\_after\_template\_part', array($this, 'end\_template'), 999); |
  |  | 313 | $this->set\_block\_template(); |
  | 307 | 314 | } |
  | 308 | 315 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L318) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L325) |  |
  | 318 | 325 | public function esi\_cart\_header() |
  | 319 | 326 | { |
  | 320 |  | echo apply\_filters(~~'litespeed\_esi\_url', 'storefront-cart-header', 'STOREFRONT\_CART\_HEADER'~~ ); |
  |  | 327 | echo apply\_filters('litespeed\_esi\_url', 'storefront-cart-header', 'STOREFRONT\_CART\_HEADER'); |
  | 321 | 328 | } |
  | 322 | 329 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L348) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L355) |  |
  | 348 | 355 | public function load\_add\_to\_cart\_form\_block($params) |
  | 349 | 356 | { |
  | 350 |  | global $post, $wp\_query; |
  | 351 |  | $post = get\_post($params[self::ESI\_PARAM\_POSTID]); |
  | 352 |  | $wp\_query->setup\_postdata($post); |
  | 353 |  | function\_exists(~~'wc\_get\_template' ) && wc\_get\_template($params[self::ESI\_PARAM\_NAME], $params[self::ESI\_PARAM\_ARGS], $params[self::ESI\_PARAM\_PATH])~~ ; |
  |  | 357 | global $post, $wp\_query; |
  |  | 358 | $post = get\_post($params[self::ESI\_PARAM\_POSTID]); |
  |  | 359 | $wp\_query->setup\_postdata($post); |
  |  | 360 | function\_exists('wc\_get\_template') && wc\_get\_template($params[self::ESI\_PARAM\_NAME], $params[self::ESI\_PARAM\_ARGS], $params[self::ESI\_PARAM\_PATH]); |
  | 354 | 361 | } |
  | 355 | 362 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L367) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L374) |  |
  | 367 | 374 | public function register\_post\_view($params) |
  | 368 | 375 | { |
  | 369 |  | if (~~$params[API::PARAM\_NAME] !== 'WC\_Widget\_Recently\_Viewed'~~ ) { |
  | 370 |  | return; |
  | 371 |  | } |
  | 372 |  | if (~~! isset($params[self::ESI\_PARAM\_POSTID])~~ ) { |
  | 373 |  | return; |
  | 374 |  | } |
  | 375 |  | $id = $params[self::ESI\_PARAM\_POSTID]; |
  | 376 |  | $esi\_post = get\_post($id); |
  | 377 |  | $product = function\_exists(~~'wc\_get\_product' ) ? wc\_get\_product($esi\_post) : false~~ ; |
  | 378 |  |  |
  | 379 |  | if (~~empty($product)~~ ) { |
  | 380 |  | return; |
  | 381 |  | } |
  | 382 |  |  |
  | 383 |  | global $post; |
  | 384 |  | $post = $esi\_post; |
  | 385 |  | function\_exists(~~'wc\_track\_product\_view' ) && wc\_track\_product\_view()~~ ; |
  |  | 376 | if ($params[API::PARAM\_NAME] !== 'WC\_Widget\_Recently\_Viewed') { |
  |  | 377 | return; |
  |  | 378 | } |
  |  | 379 | if (!isset($params[self::ESI\_PARAM\_POSTID])) { |
  |  | 380 | return; |
  |  | 381 | } |
  |  | 382 | $id = $params[self::ESI\_PARAM\_POSTID]; |
  |  | 383 | $esi\_post = get\_post($id); |
  |  | 384 | $product = function\_exists('wc\_get\_product') ? wc\_get\_product($esi\_post) : false; |
  |  | 385 |  |
  |  | 386 | if (empty($product)) { |
  |  | 387 | return; |
  |  | 388 | } |
  |  | 389 |  |
  |  | 390 | global $post; |
  |  | 391 | $post = $esi\_post; |
  |  | 392 | function\_exists('wc\_track\_product\_view') && wc\_track\_product\_view(); |
  | 386 | 393 | } |
  | 387 | 394 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L394) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L401) |  |
  | 394 | 401 | \* @access public |
  | 395 | 402 | \*/ |
  | 396 |  | public function add\_post\_id(~~$params, $block\_id~~ ) |
  | 397 |  | { |
  | 398 |  | if (~~$block\_id == 'widget'~~ ) { |
  | 399 |  | if (~~$params[ API::PARAM\_NAME ] == 'WC\_Widget\_Recently\_Viewed'~~ ) { |
  | 400 |  | $params[~~self::ESI\_PARAM\_POSTID~~ ] = get\_the\_ID(); |
  |  | 403 | public function add\_post\_id($params, $block\_id) |
  |  | 404 | { |
  |  | 405 | if ($block\_id == 'widget') { |
  |  | 406 | if ($params[API::PARAM\_NAME] == 'WC\_Widget\_Recently\_Viewed') { |
  |  | 407 | $params[self::ESI\_PARAM\_POSTID] = get\_the\_ID(); |
  | 401 | 408 | } |
  | 402 | 409 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L414) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L421) |  |
  | 414 | 421 | \* @access public |
  | 415 | 422 | \*/ |
  | 416 |  | public function wc\_widget\_default(~~$options, $widget~~ ) |
  | 417 |  | { |
  | 418 |  | if (~~! is\_array( $options )~~ ) { |
  |  | 423 | public function wc\_widget\_default($options, $widget) |
  |  | 424 | { |
  |  | 425 | if (!is\_array($options)) { |
  | 419 | 426 | return $options; |
  | 420 | 427 | } |
  | 421 |  | $widget\_name = get\_class( $widget ) ; |
  | 422 |  | if ( $widget\_name === 'WC\_Widget\_Recently\_Viewed' ) { |
  | 423 |  | $options[ API::WIDGET\_O\_ESIENABLE ] = API::VAL\_ON2; |
  | 424 |  | $options[ API::WIDGET\_O\_TTL ] = 0; |
  | 425 |  | } |
  | 426 |  | elseif ( $widget\_name === 'WC\_Widget\_Recent\_Reviews' ) { |
  | 427 |  | $options[ API::WIDGET\_O\_ESIENABLE ] = API::VAL\_ON; |
  | 428 |  | $options[ API::WIDGET\_O\_TTL ] = 86400; |
  |  | 428 | $widget\_name = get\_class($widget); |
  |  | 429 | if ($widget\_name === 'WC\_Widget\_Recently\_Viewed') { |
  |  | 430 | $options[API::WIDGET\_O\_ESIENABLE] = API::VAL\_ON2; |
  |  | 431 | $options[API::WIDGET\_O\_TTL] = 0; |
  |  | 432 | } elseif ($widget\_name === 'WC\_Widget\_Recent\_Reviews') { |
  |  | 433 | $options[API::WIDGET\_O\_ESIENABLE] = API::VAL\_ON; |
  |  | 434 | $options[API::WIDGET\_O\_TTL] = 86400; |
  | 429 | 435 | } |
  | 430 | 436 | return $options; |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L440) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L446) |  |
  | 440 | 446 | public function set\_tag() |
  | 441 | 447 | { |
  | 442 |  | $id = get\_the\_ID(); |
  | 443 |  | if (~~$id === false~~ ) { |
  | 444 |  | return; |
  |  | 448 | $id = get\_the\_ID(); |
  |  | 449 | if ($id === false) { |
  |  | 450 | return; |
  | 445 | 451 | } |
  | 446 | 452 |  |
  | 447 | 453 | // Check if product has a cache ttl limit or not |
  | 448 |  | $sale\_from = (int) get\_post\_meta( $id, '\_sale\_price\_dates\_from', true ) ; |
  | 449 |  | $sale\_to = (int) get\_post\_meta( $id, '\_sale\_price\_dates\_to', true ) ; |
  | 450 |  | $now = current\_time( 'timestamp' ) ; |
  | 451 |  | $ttl = false ; |
  | 452 |  | if ( $sale\_from && $now < $sale\_from ) { |
  | 453 |  | $ttl = $sale\_from - $now ; |
  | 454 |  | } |
  | 455 |  | elseif ( $sale\_to && $now < $sale\_to ) { |
  | 456 |  | $ttl = $sale\_to - $now ; |
  | 457 |  | } |
  | 458 |  | if ( $ttl && $ttl < apply\_filters( 'litespeed\_control\_ttl', 0 ) ) { |
  | 459 |  | do\_action( 'litespeed\_control\_set\_ttl', $ttl, "WooCommerce set scheduled TTL to $ttl" ) ; |
  | 460 |  | } |
  | 461 |  |  |
  | 462 |  | if ( function\_exists( 'is\_shop' ) && is\_shop() ) { |
  | 463 |  | do\_action( 'litespeed\_tag\_add', self::CACHETAG\_SHOP ); |
  | 464 |  | } |
  | 465 |  | if ( function\_exists( 'is\_product\_taxonomy' ) && ! is\_product\_taxonomy() ) { |
  | 466 |  | return ; |
  | 467 |  | } |
  | 468 |  | if ( isset($GLOBALS['product\_cat']) && is\_string( $GLOBALS['product\_cat'] ) ) { // todo: need to check previous woo version to find if its from old woo versions or not! |
  | 469 |  | $term = get\_term\_by('slug', $GLOBALS['product\_cat'], 'product\_cat') ; |
  | 470 |  | } |
  | 471 |  | elseif ( isset($GLOBALS['product\_tag']) && is\_string( $GLOBALS['product\_tag'] ) ) { |
  | 472 |  | $term = get\_term\_by('slug', $GLOBALS['product\_tag'], 'product\_tag') ; |
  | 473 |  | } |
  | 474 |  | else { |
  | 475 |  | $term = false ; |
  | 476 |  | } |
  | 477 |  |  |
  | 478 |  | if ( $term === false ) { |
  | 479 |  | return ; |
  | 480 |  | } |
  | 481 |  | while ( isset($term) ) { |
  | 482 |  | do\_action( 'litespeed\_tag\_add', self::CACHETAG\_TERM . $term->term\_id ); |
  | 483 |  | if ( $term->parent == 0 ) { |
  | 484 |  | break ; |
  | 485 |  | } |
  | 486 |  | $term = get\_term($term->parent) ; |
  |  | 454 | $sale\_from = (int) get\_post\_meta($id, '\_sale\_price\_dates\_from', true); |
  |  | 455 | $sale\_to = (int) get\_post\_meta($id, '\_sale\_price\_dates\_to', true); |
  |  | 456 | $now = current\_time('timestamp'); |
  |  | 457 | $ttl = false; |
  |  | 458 | if ($sale\_from && $now < $sale\_from) { |
  |  | 459 | $ttl = $sale\_from - $now; |
  |  | 460 | } elseif ($sale\_to && $now < $sale\_to) { |
  |  | 461 | $ttl = $sale\_to - $now; |
  |  | 462 | } |
  |  | 463 | if ($ttl && $ttl < apply\_filters('litespeed\_control\_ttl', 0)) { |
  |  | 464 | do\_action('litespeed\_control\_set\_ttl', $ttl, "WooCommerce set scheduled TTL to $ttl"); |
  |  | 465 | } |
  |  | 466 |  |
  |  | 467 | if (function\_exists('is\_shop') && is\_shop()) { |
  |  | 468 | do\_action('litespeed\_tag\_add', self::CACHETAG\_SHOP); |
  |  | 469 | } |
  |  | 470 | if (function\_exists('is\_product\_taxonomy') && !is\_product\_taxonomy()) { |
  |  | 471 | return; |
  |  | 472 | } |
  |  | 473 | if (isset($GLOBALS['product\_cat']) && is\_string($GLOBALS['product\_cat'])) { // todo: need to check previous woo version to find if its from old woo versions or not! |
  |  | 474 | $term = get\_term\_by('slug', $GLOBALS['product\_cat'], 'product\_cat'); |
  |  | 475 | } elseif (isset($GLOBALS['product\_tag']) && is\_string($GLOBALS['product\_tag'])) { |
  |  | 476 | $term = get\_term\_by('slug', $GLOBALS['product\_tag'], 'product\_tag'); |
  |  | 477 | } else { |
  |  | 478 | $term = false; |
  |  | 479 | } |
  |  | 480 |  |
  |  | 481 | if ($term === false) { |
  |  | 482 | return; |
  |  | 483 | } |
  |  | 484 | while (isset($term)) { |
  |  | 485 | do\_action('litespeed\_tag\_add', self::CACHETAG\_TERM . $term->term\_id); |
  |  | 486 | if ($term->parent == 0) { |
  |  | 487 | break; |
  |  | 488 | } |
  |  | 489 | $term = get\_term($term->parent); |
  | 487 | 490 | } |
  | 488 | 491 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L494) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L497) |  |
  | 494 | 497 | \* @since 1.6.3 Removed static |
  | 495 | 498 | \* @access public |
  | 496 |  | \* @param string $esi\_id        The ESI block id if a request is an ESI request. |
  |  | 499 | \* @param string $esi\_id        The ESI block id if a request is an ESI request. |
  | 497 | 500 | \* @return boolean              True if cacheable, false if not. |
  | 498 | 501 | \*/ |
  | 499 | 502 | public function set\_control($esi\_id) |
  | 500 | 503 | { |
  | 501 |  | if (~~! apply\_filters( 'litespeed\_control\_cacheable', false )~~ ) { |
  |  | 504 | if (!apply\_filters('litespeed\_control\_cacheable', false)) { |
  | 502 | 505 | return; |
  | 503 | 506 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L507) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L510) |  |
  | 507 | 510 | \* @since 1.6.2.1 |
  | 508 | 511 | \*/ |
  | 509 |  | if (~~! function\_exists( 'WC' )~~ ) { |
  | 510 |  | return; |
  | 511 |  | } |
  | 512 |  |  |
  | 513 |  | $woocom = WC(); |
  | 514 |  | if (~~! $woocom || empty( $woocom->session )~~ ) { |
  | 515 |  | return; |
  |  | 512 | if (!function\_exists('WC')) { |
  |  | 513 | return; |
  |  | 514 | } |
  |  | 515 |  |
  |  | 516 | $woocom = WC(); |
  |  | 517 | if (!$woocom || empty($woocom->session)) { |
  |  | 518 | return; |
  | 516 | 519 | } |
  | 517 | 520 |  |
  | 518 | 521 | // For later versions, DONOTCACHEPAGE should be set. |
  | 519 | 522 | // No need to check uri/qs. |
  | 520 |  | if ( version\_compare($woocom->version, '1.4.2', '>=') ) { |
  | 521 |  | if ( version\_compare( $woocom->version, '3.2.0', '<' ) && defined('DONOTCACHEPAGE') && DONOTCACHEPAGE ) { |
  | 522 |  | do\_action( 'litespeed\_control\_set\_nocache', '3rd party woocommerce not cache by constant' ); |
  | 523 |  | return ; |
  | 524 |  | } |
  | 525 |  | elseif ( version\_compare($woocom->version, '2.1.0', '>=') ) { |
  | 526 |  | $err = false ; |
  | 527 |  |  |
  | 528 |  | if ( ! function\_exists( 'wc\_get\_page\_id' ) ) { |
  | 529 |  | return ; |
  |  | 523 | if (version\_compare($woocom->version, '1.4.2', '>=')) { |
  |  | 524 | if (version\_compare($woocom->version, '3.2.0', '<') && defined('DONOTCACHEPAGE') && DONOTCACHEPAGE) { |
  |  | 525 | do\_action('litespeed\_control\_set\_nocache', '3rd party woocommerce not cache by constant'); |
  |  | 526 | return; |
  |  | 527 | } elseif (version\_compare($woocom->version, '2.1.0', '>=')) { |
  |  | 528 | $err = false; |
  |  | 529 |  |
  |  | 530 | if (!function\_exists('wc\_get\_page\_id')) { |
  |  | 531 | return; |
  | 530 | 532 | } |
  | 531 | 533 | /\*\* |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L533) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L535) |  |
  | 533 | 535 | \* @since  1.4 |
  | 534 | 536 | \*/ |
  | 535 |  | $page\_ids = array\_filter( array( wc\_get\_page\_id( 'cart' ), wc\_get\_page\_id( 'checkout' ), wc\_get\_page\_id( 'myaccount' ) ) ); |
  | 536 |  | if ( isset( $\_GET['download\_file'] ) || isset( $\_GET['add-to-cart'] ) || is\_page( $page\_ids ) ) { |
  | 537 |  | $err = 'woo non cacheable pages' ; |
  |  | 537 | $page\_ids = array\_filter(array(wc\_get\_page\_id('cart'), wc\_get\_page\_id('checkout'), wc\_get\_page\_id('myaccount'))); |
  |  | 538 | if (isset($\_GET['download\_file']) || isset($\_GET['add-to-cart']) || is\_page($page\_ids)) { |
  |  | 539 | $err = 'woo non cacheable pages'; |
  |  | 540 | } elseif (function\_exists('wc\_notice\_count') && wc\_notice\_count() > 0) { |
  |  | 541 | $err = 'has wc notice'; |
  | 538 | 542 | } |
  | 539 |  | elseif ( function\_exists( 'wc\_notice\_count' ) && wc\_notice\_count() > 0 ) { |
  | 540 |  | $err = 'has wc notice' ; |
  |  | 543 |  |
  |  | 544 | if ($err) { |
  |  | 545 | do\_action('litespeed\_control\_set\_nocache', '3rd party woocommerce not cache due to ' . $err); |
  |  | 546 | return; |
  | 541 | 547 | } |
  | 542 |  |  |
  | 543 |  | if ( $err ) { |
  | 544 |  | do\_action( 'litespeed\_control\_set\_nocache', '3rd party woocommerce not cache due to ' . $err ); |
  | 545 |  | return ; |
  | 546 |  | } |
  | 547 |  | } |
  | 548 |  | return ; |
  | 549 |  | } |
  | 550 |  |  |
  | 551 |  | $uri = esc\_url($\_SERVER["REQUEST\_URI"]) ; |
  | 552 |  | $uri\_len = strlen($uri) ; |
  | 553 |  | if ( $uri\_len < 5 ) { |
  | 554 |  | return ; |
  | 555 |  | } |
  | 556 |  |  |
  | 557 |  | if ( in\_array($uri, array('cart/', 'checkout/', 'my-account/', 'addons/', 'logout/', 'lost-password/', 'product/')) ) { // why contains `product`? |
  | 558 |  | do\_action( 'litespeed\_control\_set\_nocache', 'uri in cart/account/user pages' ); |
  | 559 |  | return ; |
  | 560 |  | } |
  | 561 |  |  |
  | 562 |  | $qs = sanitize\_text\_field($\_SERVER["QUERY\_STRING"]) ; |
  | 563 |  | $qs\_len = strlen($qs) ; |
  | 564 |  | if ( ! empty($qs) && $qs\_len >= 12 && strpos( $qs, 'add-to-cart=' ) === 0 ) { |
  | 565 |  | do\_action( 'litespeed\_control\_set\_nocache', 'qs contains add-to-cart' ); |
  | 566 |  | return ; |
  |  | 548 | } |
  |  | 549 | return; |
  |  | 550 | } |
  |  | 551 |  |
  |  | 552 | $uri = esc\_url($\_SERVER["REQUEST\_URI"]); |
  |  | 553 | $uri\_len = strlen($uri); |
  |  | 554 | if ($uri\_len < 5) { |
  |  | 555 | return; |
  |  | 556 | } |
  |  | 557 |  |
  |  | 558 | if (in\_array($uri, array('cart/', 'checkout/', 'my-account/', 'addons/', 'logout/', 'lost-password/', 'product/'))) { // why contains `product`? |
  |  | 559 | do\_action('litespeed\_control\_set\_nocache', 'uri in cart/account/user pages'); |
  |  | 560 | return; |
  |  | 561 | } |
  |  | 562 |  |
  |  | 563 | $qs = sanitize\_text\_field($\_SERVER["QUERY\_STRING"]); |
  |  | 564 | $qs\_len = strlen($qs); |
  |  | 565 | if (!empty($qs) && $qs\_len >= 12 && strpos($qs, 'add-to-cart=') === 0) { |
  |  | 566 | do\_action('litespeed\_control\_set\_nocache', 'qs contains add-to-cart'); |
  |  | 567 | return; |
  | 567 | 568 | } |
  | 568 | 569 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L576) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L577) |  |
  | 576 | 577 | \* @param WC\_Product $product |
  | 577 | 578 | \*/ |
  | 578 |  | public function purge\_product($product) { |
  | 579 |  | do\_action( 'litespeed\_debug', '[3rd] Woo Purge [pid]' . $product->get\_id() ); |
  | 580 |  |  |
  | 581 |  | $config = apply\_filters( 'litespeed\_conf', self::O\_UPDATE\_INTERVAL ) ; |
  | 582 |  | if ( is\_null($config) ) { |
  | 583 |  | $config = self::O\_PQS\_CS ; |
  | 584 |  | } |
  | 585 |  |  |
  | 586 |  | if ( $config === self::O\_PQS\_CQS ) { |
  | 587 |  | $this->backend\_purge($product->get\_id()) ; |
  | 588 |  | } |
  | 589 |  | elseif ( $config !== self::O\_PQS\_CS && $product->is\_in\_stock() ) { |
  | 590 |  | do\_action( 'litespeed\_debug', '[3rd] Woo No purge needed [option] ' . $config ); |
  | 591 |  | return ; |
  | 592 |  | } |
  | 593 |  | elseif ( $config !== self::O\_PS\_CN && ! $product->is\_in\_stock() ) { |
  | 594 |  | $this->backend\_purge($product->get\_id()) ; |
  | 595 |  | } |
  | 596 |  |  |
  | 597 |  | do\_action( 'litespeed\_purge\_post', $product->get\_id() ); |
  |  | 579 | public function purge\_product($product) |
  |  | 580 | { |
  |  | 581 | do\_action('litespeed\_debug', '[3rd] Woo Purge [pid]' . $product->get\_id()); |
  |  | 582 |  |
  |  | 583 | $config = apply\_filters('litespeed\_conf', self::O\_UPDATE\_INTERVAL); |
  |  | 584 | if (is\_null($config)) { |
  |  | 585 | $config = self::O\_PQS\_CS; |
  |  | 586 | } |
  |  | 587 |  |
  |  | 588 | if ($config === self::O\_PQS\_CQS) { |
  |  | 589 | $this->backend\_purge($product->get\_id()); |
  |  | 590 | } elseif ($config !== self::O\_PQS\_CS && $product->is\_in\_stock()) { |
  |  | 591 | do\_action('litespeed\_debug', '[3rd] Woo No purge needed [option] ' . $config); |
  |  | 592 | return; |
  |  | 593 | } elseif ($config !== self::O\_PS\_CN && !$product->is\_in\_stock()) { |
  |  | 594 | $this->backend\_purge($product->get\_id()); |
  |  | 595 | } |
  |  | 596 |  |
  |  | 597 | do\_action('litespeed\_purge\_post', $product->get\_id()); |
  | 598 | 598 |  |
  | 599 | 599 | // Check if is variation, purge stock too #984479 |
  | 600 |  | if ( $product->is\_type( 'variation' ) ) { |
  | 601 |  | do\_action( 'litespeed\_purge\_post', $product->get\_parent\_id() ); |
  |  | 600 | if ($product->is\_type('variation')) { |
  |  | 601 | do\_action('litespeed\_purge\_post', $product->get\_parent\_id()); |
  |  | 602 | } |
  |  | 603 |  |
  |  | 604 | // Check if WPML is enabled ##972971 |
  |  | 605 | if (  defined( 'WPML\_PLUGIN\_BASENAME' ) ) { |
  |  | 606 | // Check if it is a variable product and get post/parent ID |
  |  | 607 | $wpml\_purge\_id = $product->is\_type( 'variation' ) ? $product->get\_parent\_id() : $product->get\_id(); |
  |  | 608 | $type = apply\_filters( 'wpml\_element\_type', get\_post\_type( $wpml\_purge\_id ) ); |
  |  | 609 | $trid = apply\_filters( 'wpml\_element\_trid', false, $wpml\_purge\_id, $type ); |
  |  | 610 | $translations = apply\_filters( 'wpml\_get\_element\_translations', array(), $trid, $type ); |
  |  | 611 | foreach ( $translations as $lang => $translation ) { |
  |  | 612 | do\_action( 'litespeed\_debug', '[3rd] Woo WPML purge language: ' . $translation->language\_code . ' , post ID: ' . $translation->element\_id); |
  |  | 613 | do\_action( 'litespeed\_purge\_post', $translation->element\_id ); |
  |  | 614 | // use the $translation->element\_id as it is post ID of other languages |
  |  | 615 | } |
  | 602 | 616 | } |
  | 603 | 617 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L616) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L630) |  |
  | 616 | 630 | public function delete\_rel($post\_id, $term\_ids) |
  | 617 | 631 | { |
  | 618 |  | if (~~! function\_exists( 'wc\_get\_product' )~~ ) { |
  | 619 |  | return; |
  | 620 |  | } |
  | 621 |  |  |
  | 622 |  | if (~~empty($term\_ids) || wc\_get\_product($post\_id) === false~~ ) { |
  | 623 |  | return; |
  | 624 |  | } |
  | 625 |  | foreach (~~$term\_ids as $term\_id~~ ) { |
  | 626 |  | do\_action(~~'litespeed\_purge', self::CACHETAG\_TERM . $term\_id~~ ); |
  |  | 632 | if (!function\_exists('wc\_get\_product')) { |
  |  | 633 | return; |
  |  | 634 | } |
  |  | 635 |  |
  |  | 636 | if (empty($term\_ids) || wc\_get\_product($post\_id) === false) { |
  |  | 637 | return; |
  |  | 638 | } |
  |  | 639 | foreach ($term\_ids as $term\_id) { |
  |  | 640 | do\_action('litespeed\_purge', self::CACHETAG\_TERM . $term\_id); |
  | 627 | 641 | } |
  | 628 | 642 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L638) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L652) |  |
  | 638 | 652 | public function backend\_purge($post\_id) |
  | 639 | 653 | { |
  | 640 |  | if (~~! function\_exists( 'wc\_get\_product' )~~ ) { |
  | 641 |  | return; |
  | 642 |  | } |
  | 643 |  |  |
  | 644 |  | if (~~! isset($post\_id) || wc\_get\_product($post\_id) === false~~ ) { |
  | 645 |  | return; |
  | 646 |  | } |
  | 647 |  |  |
  | 648 |  | $cats = $this->get\_cats($post\_id); |
  | 649 |  | if (~~! empty($cats)~~ ) { |
  | 650 |  | foreach (~~$cats as $cat~~ ) { |
  | 651 |  | do\_action(~~'litespeed\_purge', self::CACHETAG\_TERM . $cat~~ ); |
  | 652 |  | } |
  | 653 |  | } |
  | 654 |  |  |
  | 655 |  | if (~~! function\_exists( 'wc\_get\_product\_terms' )~~ ) { |
  | 656 |  | return; |
  | 657 |  | } |
  | 658 |  |  |
  | 659 |  | $tags = wc\_get\_product\_terms($post\_id, 'product\_tag', array('fields' => 'ids')); |
  | 660 |  | if (~~! empty($tags)~~ ) { |
  | 661 |  | foreach (~~$tags as $tag~~ ) { |
  | 662 |  | do\_action(~~'litespeed\_purge', self::CACHETAG\_TERM . $tag~~ ); |
  |  | 654 | if (!function\_exists('wc\_get\_product')) { |
  |  | 655 | return; |
  |  | 656 | } |
  |  | 657 |  |
  |  | 658 | if (!isset($post\_id) || wc\_get\_product($post\_id) === false) { |
  |  | 659 | return; |
  |  | 660 | } |
  |  | 661 |  |
  |  | 662 | $cats = $this->get\_cats($post\_id); |
  |  | 663 | if (!empty($cats)) { |
  |  | 664 | foreach ($cats as $cat) { |
  |  | 665 | do\_action('litespeed\_purge', self::CACHETAG\_TERM . $cat); |
  |  | 666 | } |
  |  | 667 | } |
  |  | 668 |  |
  |  | 669 | if (!function\_exists('wc\_get\_product\_terms')) { |
  |  | 670 | return; |
  |  | 671 | } |
  |  | 672 |  |
  |  | 673 | $tags = wc\_get\_product\_terms($post\_id, 'product\_tag', array('fields' => 'ids')); |
  |  | 674 | if (!empty($tags)) { |
  |  | 675 | foreach ($tags as $tag) { |
  |  | 676 | do\_action('litespeed\_purge', self::CACHETAG\_TERM . $tag); |
  | 663 | 677 | } |
  | 664 | 678 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L677) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L691) |  |
  | 677 | 691 | public function add\_review($unused, $comment\_approved, $commentdata) |
  | 678 | 692 | { |
  | 679 |  | if (~~! function\_exists( 'wc\_get\_product' )~~ ) { |
  | 680 |  | return; |
  | 681 |  | } |
  | 682 |  |  |
  | 683 |  | $post\_id = $commentdata['comment\_post\_ID']; |
  | 684 |  | if (~~$comment\_approved !== 1 || ! isset($post\_id) || wc\_get\_product($post\_id) === false~~ ) { |
  | 685 |  | return; |
  | 686 |  | } |
  | 687 |  | global $wp\_widget\_factory; |
  | 688 |  | $recent\_reviews = $wp\_widget\_factory->widgets[~~'WC\_Widget\_Recent\_Reviews' ]~~ ; |
  | 689 |  | if (~~! is\_null( $recent\_reviews )~~ ) { |
  | 690 |  | do\_action(~~'litespeed\_tag\_add\_widget', $recent\_reviews->id~~ ); |
  |  | 693 | if (!function\_exists('wc\_get\_product')) { |
  |  | 694 | return; |
  |  | 695 | } |
  |  | 696 |  |
  |  | 697 | $post\_id = $commentdata['comment\_post\_ID']; |
  |  | 698 | if ($comment\_approved !== 1 || !isset($post\_id) || wc\_get\_product($post\_id) === false) { |
  |  | 699 | return; |
  |  | 700 | } |
  |  | 701 | global $wp\_widget\_factory; |
  |  | 702 | $recent\_reviews = $wp\_widget\_factory->widgets['WC\_Widget\_Recent\_Reviews']; |
  |  | 703 | if (!is\_null($recent\_reviews)) { |
  |  | 704 | do\_action('litespeed\_tag\_add\_widget', $recent\_reviews->id); |
  | 691 | 705 | } |
  | 692 | 706 | } |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L698) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L712) |  |
  | 698 | 712 | \* @since  3.0 new API |
  | 699 | 713 | \*/ |
  | 700 |  | private function \_option\_append() { |
  |  | 714 | private function \_option\_append() |
  |  | 715 | { |
  | 701 | 716 | // Append option save value filter |
  | 702 |  | do\_action( 'litespeed\_conf\_multi\_switch', self::O\_UPDATE\_INTERVAL, 3 ); // This need to be before conf\_append |
  | 703 |  |  |
  | 704 |  | do\_action( 'litespeed\_conf\_append', self::O\_UPDATE\_INTERVAL, false ); |
  |  | 717 | do\_action('litespeed\_conf\_multi\_switch', self::O\_UPDATE\_INTERVAL, 3); // This need to be before conf\_append |
  |  | 718 |  |
  |  | 719 | do\_action('litespeed\_conf\_append', self::O\_UPDATE\_INTERVAL, false); |
  |  | 720 | do\_action('litespeed\_conf\_append', self::O\_CART\_VARY, false); |
  | 705 | 721 | } |
  | 706 | 722 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L711) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L727) |  |
  | 711 | 727 | \* @since 1.6.3 Removed static |
  | 712 | 728 | \*/ |
  | 713 |  | public function settings\_add\_tab(~~$setting\_page~~ ) |
  | 714 |  | { |
  | 715 |  | if (~~$setting\_page != 'cache'~~ ) { |
  | 716 |  | return; |
  | 717 |  | } |
  | 718 |  |  |
  | 719 |  | require 'woocommerce.tab.tpl.php'; |
  |  | 729 | public function settings\_add\_tab($setting\_page) |
  |  | 730 | { |
  |  | 731 | if ($setting\_page != 'cache') { |
  |  | 732 | return; |
  |  | 733 | } |
  |  | 734 |  |
  |  | 735 | require 'woocommerce.tab.tpl.php'; |
  | 720 | 736 | } |
  | 721 | 737 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L725) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L741) |  |
  | 725 | 741 | \* @since  3.0 |
  | 726 | 742 | \*/ |
  | 727 |  | public function settings\_add\_content(~~$setting\_page~~ ) |
  | 728 |  | { |
  | 729 |  | if (~~$setting\_page != 'cache'~~ ) { |
  | 730 |  | return; |
  | 731 |  | } |
  | 732 |  |  |
  | 733 |  | require 'woocommerce.content.tpl.php'; |
  |  | 743 | public function settings\_add\_content($setting\_page) |
  |  | 744 | { |
  |  | 745 | if ($setting\_page != 'cache') { |
  |  | 746 | return; |
  |  | 747 | } |
  |  | 748 |  |
  |  | 749 | require 'woocommerce.content.tpl.php'; |
  | 734 | 750 | } |
  | 735 | 751 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L746) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L762) |  |
  | 746 | 762 | private function get\_cats($product\_id) |
  | 747 | 763 | { |
  | 748 |  | if (~~! function\_exists( 'WC' )~~ ) { |
  | 749 |  | return; |
  | 750 |  | } |
  | 751 |  |  |
  | 752 |  | $woocom = WC(); |
  | 753 |  | if (~~isset($woocom) && version\_compare($woocom->version, '2.5.0', '>=') && function\_exists( 'wc\_get\_product\_cat\_ids' )~~ ) { |
  | 754 |  | return wc\_get\_product\_cat\_ids($product\_id); |
  | 755 |  | } |
  | 756 |  | $product\_cats = wp\_get\_post\_terms($product\_id, 'product\_cat', array("fields" => "ids")); |
  | 757 |  | foreach (~~$product\_cats as $product\_cat~~ ) { |
  | 758 |  | $product\_cats = array\_merge($product\_cats, get\_ancestors($product\_cat, 'product\_cat')); |
  | 759 |  | } |
  | 760 |  |  |
  | 761 |  | return $product\_cats; |
  |  | 764 | if (!function\_exists('WC')) { |
  |  | 765 | return; |
  |  | 766 | } |
  |  | 767 |  |
  |  | 768 | $woocom = WC(); |
  |  | 769 | if (isset($woocom) && version\_compare($woocom->version, '2.5.0', '>=') && function\_exists('wc\_get\_product\_cat\_ids')) { |
  |  | 770 | return wc\_get\_product\_cat\_ids($product\_id); |
  |  | 771 | } |
  |  | 772 | $product\_cats = wp\_get\_post\_terms($product\_id, 'product\_cat', array("fields" => "ids")); |
  |  | 773 | foreach ($product\_cats as $product\_cat) { |
  |  | 774 | $product\_cats = array\_merge($product\_cats, get\_ancestors($product\_cat, 'product\_cat')); |
  |  | 775 | } |
  |  | 776 |  |
  |  | 777 | return $product\_cats; |
  | 762 | 778 | } |
  | 763 | 779 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L773) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L789) |  |
  | 773 | 789 | \* Bulk edit hook need to add to preload as it will die before detect. |
  | 774 | 790 | \*/ |
  | 775 |  | add\_action(~~'wp\_ajax\_wpmelon\_adv\_bulk\_edit', \_\_CLASS\_\_ . '::bulk\_edit\_purge', 1 )~~ ; |
  |  | 791 | add\_action('wp\_ajax\_wpmelon\_adv\_bulk\_edit', \_\_CLASS\_\_ . '::bulk\_edit\_purge', 1); |
  | 776 | 792 | } |
  | 777 | 793 |  |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L783) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L799) |  |
  | 783 | 799 | public static function bulk\_edit\_purge() |
  | 784 | 800 | { |
  | 785 |  | if (~~empty( $\_POST[ 'type' ] ) || $\_POST[ 'type' ] != 'saveproducts' || empty( $\_POST[ 'data' ] ) ) return~~ ; |
  |  | 801 | if (empty($\_POST['type']) || $\_POST['type'] != 'saveproducts' || empty($\_POST['data'])) return; |
  | 786 | 802 |  |
  | 787 | 803 | /\* |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2832517#L795) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.cls.php?rev=2977143#L811) |  |
  | 795 | 811 | \*   ) |
  | 796 | 812 | \*/ |
  | 797 |  | $stock\_string\_arr = array(); |
  | 798 |  | foreach (~~$\_POST[ 'data' ] as $stock\_value~~ ) { |
  | 799 |  | $stock\_string\_arr = array\_merge(~~$stock\_string\_arr, explode( '#^#', $stock\_value ) )~~ ; |
  | 800 |  | } |
  | 801 |  |  |
  | 802 |  | $lscwp\_3rd\_woocommerce = new self(); |
  | 803 |  |  |
  | 804 |  | if (~~count( $stock\_string\_arr ) < 1~~ ) { |
  | 805 |  | return; |
  | 806 |  | } |
  | 807 |  |  |
  | 808 |  | foreach (~~$stock\_string\_arr as $edited\_stock~~ ) { |
  | 809 |  | $product\_id = strtok(~~$edited\_stock, '$'~~ ); |
  | 810 |  | $product = wc\_get\_product(~~$product\_id )~~ ; |
  | 811 |  |  |
  | 812 |  | if (~~empty( $product )~~ ) { |
  | 813 |  | do\_action(~~'litespeed\_debug', '3rd woo purge: ' . $product\_id . ' not found.' )~~ ; |
  | 814 |  | continue; |
  | 815 |  | } |
  | 816 |  |  |
  | 817 |  | $lscwp\_3rd\_woocommerce->purge\_product(~~$product~~ ); |
  |  | 813 | $stock\_string\_arr = array(); |
  |  | 814 | foreach ($\_POST['data'] as $stock\_value) { |
  |  | 815 | $stock\_string\_arr = array\_merge($stock\_string\_arr, explode('#^#', $stock\_value)); |
  |  | 816 | } |
  |  | 817 |  |
  |  | 818 | $lscwp\_3rd\_woocommerce = new self(); |
  |  | 819 |  |
  |  | 820 | if (count($stock\_string\_arr) < 1) { |
  |  | 821 | return; |
  |  | 822 | } |
  |  | 823 |  |
  |  | 824 | foreach ($stock\_string\_arr as $edited\_stock) { |
  |  | 825 | $product\_id = strtok($edited\_stock, '$'); |
  |  | 826 | $product = wc\_get\_product($product\_id); |
  |  | 827 |  |
  |  | 828 | if (empty($product)) { |
  |  | 829 | do\_action('litespeed\_debug', '3rd woo purge: ' . $product\_id . ' not found.'); |
  |  | 830 | continue; |
  |  | 831 | } |
  |  | 832 |  |
  |  | 833 | $lscwp\_3rd\_woocommerce->purge\_product($product); |
  | 818 | 834 | } |
  | 819 | 835 | } |
  | 820 | 836 | } |
  | 821 |  |  |
* ## [litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php](/changeset/2977143/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php")

  | [r2808204](/browser/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php?rev=2808204#L1 "Show revision 2808204 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | namespace LiteSpeed\Thirdparty; |
  | 3 | 4 |  |
  | 4 |  | defined(~~'WPINC'~~ ) || exit; |
  |  | 5 | defined('WPINC') || exit; |
  | 5 | 6 |  |
  | 6 | 7 | use \LiteSpeed\API; |
  | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php?rev=2808204#L13) | […](/browser/litespeed-cache/trunk/thirdparty/woocommerce.content.tpl.php?rev=2977143#L14) |  |
  | 13 | 14 | <div data-litespeed-layout='woocommerce'> |
  | 14 | 15 |  |
  | 15 |  | <h3 class="litespeed-title-short"> |
  | 16 |  | ~~<?php echo \_\_( 'WooCommerce Settings', 'litespeed-cache'~~ ); ?> |
  | 17 |  | ~~<?php Doc::learn\_more( 'https://docs.litespeedtech.com/lscache/lscwp/cache/#woocommerce-tab'~~ ); ?> |
  | 18 |  | </h3> |
  |  | 16 | <h3 class="litespeed-title-short"> |
  |  | 17 | <?php echo \_\_('WooCommerce Settings', 'litespeed-cache'); ?> |
  |  | 18 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/cache/#woocommerce-tab'); ?> |
  |  | 19 | </h3> |
  | 19 | 20 |  |
  | 20 |  | <div class="litespeed-callout notice notice-warning inline"> |
  | 21 |  | <h4><?php echo \_\_( 'NOTICE:', 'litespeed-cache' ); ?></h4> |
  | 22 |  | <p><?php echo \_\_( 'After verifying that the cache works in general, please test the cart.', 'litespeed-cache' ); ?></p> |
  | 23 |  | <p><?php echo sprintf( \_\_( 'To test the cart, visit the <a %s>FAQ</a>.', 'litespeed-cache' ), 'href="https://docs.litespeedtech.com/lscache/lscwp/installation/#non-cacheable-pages" target="\_blank"' ); ?></p> |
  | 24 |  | <p><?php echo \_\_( 'By default, the My Account, Checkout, and Cart pages are automatically excluded from caching. Misconfiguration of page associations in WooCommerce settings may cause some pages to be erroneously excluded.', 'litespeed-cache' ); ?></p> |
  |  | 21 | <div class="litespeed-callout notice notice-warning inline"> |
  |  | 22 | <h4><?php echo \_\_('NOTICE:', 'litespeed-cache'); ?></h4> |
  |  | 23 | <p><?php echo \_\_('After verifying that the cache works in general, please test the cart.', 'litespeed-cache'); ?></p> |
  |  | 24 | <p><?php echo sprintf(\_\_('To test the cart, visit the <a %s>FAQ</a>.', 'litespeed-cache'), 'href="https://docs.litespeedtech.com/lscache/lscwp/installation/#non-cacheable-pages" target="\_blank"'); ?></p> |
  |  | 25 | <p><?php echo \_\_('By default, the My Account, Checkout, and Cart pages are automatically excluded from caching. Misconfiguration of page associations in WooCommerce settings may cause some pages to be erroneously excluded.', 'litespeed-cache'); ?></p> |
  |  | 26 | </div> |
  |  | 27 |  |
  |  | 28 | <table class="wp-list-table striped litespeed-table"> |
  |  | 29 | <tbody> |
  |  | 30 | <tr> |
  |  | 31 | <th> |
  |  | 32 | <?php $id = self::O\_UPDATE\_INTERVAL; ?> |
  |  | 33 | <?php echo \_\_('Product Update Interval', 'litespeed-cache'); ?> |
  |  | 34 | </th> |
  |  | 35 | <td> |
  |  | 36 | <?php |
  |  | 37 | $options = array( |
  |  | 38 | self::O\_PQS\_CS  => \_\_('Purge product on changes to the quantity or stock status.', 'litespeed-cache') . ' ' . \_\_('Purge categories only when stock status changes.', 'litespeed-cache'), |
  |  | 39 | self::O\_PS\_CS   => \_\_('Purge product and categories only when the stock status changes.', 'litespeed-cache'), |
  |  | 40 | self::O\_PS\_CN   => \_\_('Purge product only when the stock status changes.', 'litespeed-cache') . ' ' . \_\_('Do not purge categories on changes to the quantity or stock status.', 'litespeed-cache'), |
  |  | 41 | self::O\_PQS\_CQS => \_\_('Always purge both product and categories on changes to the quantity or stock status.', 'litespeed-cache'), |
  |  | 42 | ); |
  |  | 43 | $conf = (int) apply\_filters('litespeed\_conf', $id); |
  |  | 44 | foreach ($options as $k => $v) : |
  |  | 45 | $checked = (int) $k === $conf ? ' checked ' : ''; |
  |  | 46 | ?> |
  |  | 47 | <?php do\_action('litespeed\_setting\_enroll', $id); ?> |
  |  | 48 | <div class='litespeed-radio-row'> |
  |  | 49 | <input type='radio' autocomplete='off' name='<?php echo $id; ?>' id='conf\_<?php echo $id; ?>\_<?php echo $k; ?>' value='<?php echo $k; ?>' <?php echo $checked; ?> /> |
  |  | 50 | <label for='conf\_<?php echo $id; ?>\_<?php echo $k; ?>'><?php echo $v; ?></label> |
  |  | 51 | </div> |
  |  | 52 | <?php endforeach; ?> |
  |  | 53 | <div class="litespeed-desc"> |
  |  | 54 | <?php echo \_\_('Determines how changes in product quantity and product stock status affect product pages and their associated category pages.', 'litespeed-cache'); ?> |
  |  | 55 | </div> |
  |  | 56 | </td> |
  |  | 57 | </tr> |
  |  | 58 |  |
  |  | 59 | <tr> |
  |  | 60 | <th> |
  |  | 61 | <?php $id = self::O\_CART\_VARY; ?> |
  |  | 62 | <?php echo \_\_('Vary for Mini Cart', 'litespeed-cache'); ?> |
  |  | 63 | </th> |
  |  | 64 | <td> |
  |  | 65 | <?php |
  |  | 66 | $conf = (int) apply\_filters('litespeed\_conf', $id); |
  |  | 67 | $this->cls('Admin\_Display')->build\_switch($id); ?> |
  |  | 68 | <div class="litespeed-desc"> |
  |  | 69 | <?php echo \_\_('Generate a separate vary cache copy for the mini cart when the cart is not empty.', 'litespeed-cache'); ?> |
  |  | 70 | <?php echo \_\_('If your theme does not use JS to update the mini cart, you must enable this option to display the correct cart contents.', 'litespeed-cache'); ?> |
  |  | 71 | <br /><?php Doc::notice\_htaccess(); ?> |
  |  | 72 | </div> |
  |  | 73 | </td> |
  |  | 74 | </tr> |
  |  | 75 |  |
  |  | 76 | </tbody> |
  |  | 77 | </table> |
  | 25 | 78 | </div> |
  | 26 |  |  |
  | 27 |  | ~~<table class="wp-list-table striped litespeed-table"><tbody>~~ |
  | 28 |  | ~~<tr>~~ |
  | 29 |  | ~~<th>~~ |
  | 30 |  | ~~<?php $id = self::O\_UPDATE\_INTERVAL; ?>~~ |
  | 31 |  | ~~<?php echo \_\_( 'Product Update Interval', 'litespeed-cache' ); ?>~~ |
  | 32 |  | ~~</th>~~ |
  | 33 |  | ~~<td>~~ |
  | 34 |  | ~~<?php~~ |
  | 35 |  | ~~$options = array(~~ |
  | 36 |  | ~~self::O\_PQS\_CS  => \_\_( 'Purge product on changes to the quantity or stock status.', 'litespeed-cache' ) . ' ' . \_\_( 'Purge categories only when stock status changes.', 'litespeed-cache' ),~~ |
  | 37 |  | ~~self::O\_PS\_CS   => \_\_( 'Purge product and categories only when the stock status changes.', 'litespeed-cache' ),~~ |
  | 38 |  | ~~self::O\_PS\_CN   => \_\_( 'Purge product only when the stock status changes.', 'litespeed-cache' ) . ' ' . \_\_( 'Do not purge categories on changes to the quantity or stock status.', 'litespeed-cache' ),~~ |
  | 39 |  | ~~self::O\_PQS\_CQS => \_\_( 'Always purge both product and categories on changes to the quantity or stock status.', 'litespeed-cache' ),~~ |
  | 40 |  | ~~);~~ |
  | 41 |  | ~~$conf = (int) apply\_filters( 'litespeed\_conf', $id );~~ |
  | 42 |  | ~~foreach ( $options as $k => $v ) :~~ |
  | 43 |  | ~~$checked = (int) $k === $conf ? ' checked ' : '';~~ |
  | 44 |  | ~~?>~~ |
  | 45 |  | ~~<?php do\_action( 'litespeed\_setting\_enroll', $id ); ?>~~ |
  | 46 |  | ~~<div class='litespeed-radio-row'>~~ |
  | 47 |  | ~~<input type='radio' autocomplete='off' name='<?php echo $id; ?>' id='conf\_<?php echo $id; ?>\_<?php echo $k; ?>' value='<?php echo $k; ?>' <?php echo $checked; ?> />~~ |
  | 48 |  | ~~<label for='conf\_<?php echo $id; ?>\_<?php echo $k; ?>'><?php echo $v; ?></label>~~ |
  | 49 |  | ~~</div>~~ |
  | 50 |  | ~~<?php endforeach; ?>~~ |
  | 51 |  | ~~<div class="litespeed-desc">~~ |
  | 52 |  | ~~<?php echo \_\_( 'Determines how changes in product quantity and product stock status affect product pages and their associated category pages.', 'litespeed-cache' ); ?>~~ |
  | 53 |  | ~~</div>~~ |
  | 54 |  | ~~</td>~~ |
  | 55 |  | ~~</tr>~~ |
  | 56 |  |  |
  | 57 |  | ~~</tbody></table>~~ |
  | 58 |  |  |
  | 59 |  | ~~</div>~~ |
* ## [litespeed-cache/trunk/tpl/dash/dashboard.tpl.php](/changeset/2977143/litespeed-cache/trunk/tpl/dash/dashboard.tpl.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/tpl/dash/dashboard.tpl.php")

  | [r2928795](/browser/litespeed-cache/trunk/tpl/dash/dashboard.tpl.php?rev=2928795#L607 "Show revision 2928795 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/tpl/dash/dashboard.tpl.php?rev=2977143#L607 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 607 | 607 | </div> |
  | 608 | 608 |  |
  |  | 609 | <div class="postbox litespeed-postbox litespeed-postbox-quiccloud litespeed-bg-quic-cloud"> |
  |  | 610 | <div class="inside litespeed-text-center"> |
  |  | 611 | <h3 class="litespeed-title"> |
  |  | 612 | QUIC.cloud |
  |  | 613 | <a href="https://www.quic.cloud/quic-cloud-services-and-features/litespeed-cache-service/" class="litespeed-title-right-icon">Learn More</a> |
  |  | 614 | </h3> |
  |  | 615 | <p class="litespeed-top20 litespeed-text-bold litespeed-margin-bottom20"> |
  |  | 616 | <a href="https://www.quic.cloud/docs/onboarding/" class="">Try QUIC.cloud CDN!</a> |
  |  | 617 | </p> |
  |  | 618 | <p class="litespeed-margin-y5"> |
  |  | 619 | Best available WordPress performance |
  |  | 620 | </p> |
  |  | 621 | <p class="litespeed-margin-y5"> |
  |  | 622 | Globally fast TTFB, easy setup, and <a href="https://www.quic.cloud/quic-cloud-services-and-features/litespeed-cache-service/">more</a>! |
  |  | 623 | </p> |
  |  | 624 | <div class="litespeed-top10"> |
  |  | 625 | <img src="<?php echo LSWCP\_PLUGIN\_URL; ?>assets/img/quic-cloud-logo.svg" alt="QUIC.cloud" width="45%" height="auto"> |
  |  | 626 | </div> |
  |  | 627 | </div> |
  |  | 628 | </div> |
  |  | 629 |  |
  | 609 | 630 | </div> |
  | 610 | 631 |  |
  | 611 | 632 | </div> |
  | 612 | 633 |  |
  | 613 |  |  |
  | 614 | 634 | </div> |
* ## [litespeed-cache/trunk/tpl/page\_optm/settings\_html.tpl.php](/changeset/2977143/litespeed-cache/trunk/tpl/page_optm/settings_html.tpl.php "Show the changeset 2977143 restricted to litespeed-cache/trunk/tpl/page_optm/settings_html.tpl.php")

  | [r2554181](/browser/litespeed-cache/trunk/tpl/page_optm/settings_html.tpl.php?rev=2554181#L1 "Show revision 2554181 of this file in browser") | [r2977143](/browser/litespeed-cache/trunk/tpl/page_optm/settings_html.tpl.php?rev=2977143#L1 "Show revision 2977143 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  |  | 2 |  |
  | 2 | 3 | namespace LiteSpeed; |
  | 3 |  | defined( 'WPINC' ) || exit; |
  |  | 4 |  |
  |  | 5 | defined('WPINC') || exit; |
  | 4 | 6 | ?> |
  | 5 | 7 |  |
  | 6 | 8 | <h3 class="litespeed-title-short"> |
  | 7 |  | <?php echo \_\_(~~'HTML Settings', 'litespeed-cache'~~ ); ?> |
  | 8 |  | <?php Doc::learn\_more(~~'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-settings-tab'~~ ); ?> |
  |  | 9 | <?php echo \_\_('HTML Settings', 'litespeed-cache'); ?> |
  |  | 10 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-settings-tab'); ?> |
  | 9 | 11 | </h3> |
  | 10 | 12 |  |
  | 11 |  | <table class="wp-list-table striped litespeed-table"><tbody> |
  | 12 |  | <tr> |
  | 13 |  | <th> |
  | 14 |  | <?php $id = Base::O\_OPTM\_HTML\_MIN; ?> |
  | 15 |  | <?php $this->title( $id ); ?> |
  | 16 |  | </th> |
  | 17 |  | <td> |
  | 18 |  | <?php $this->build\_switch( $id ); ?> |
  | 19 |  | <div class="litespeed-desc"> |
  | 20 |  | <?php echo \_\_( 'Minify HTML content.', 'litespeed-cache' ); ?> |
  | 21 |  | </div> |
  | 22 |  | </td> |
  | 23 |  | </tr> |
  |  | 13 | <table class="wp-list-table striped litespeed-table"> |
  |  | 14 | <tbody> |
  |  | 15 | <tr> |
  |  | 16 | <th> |
  |  | 17 | <?php $id = Base::O\_OPTM\_HTML\_MIN; ?> |
  |  | 18 | <?php $this->title($id); ?> |
  |  | 19 | </th> |
  |  | 20 | <td> |
  |  | 21 | <?php $this->build\_switch($id); ?> |
  |  | 22 | <div class="litespeed-desc"> |
  |  | 23 | <?php echo \_\_('Minify HTML content.', 'litespeed-cache'); ?> |
  |  | 24 | </div> |
  |  | 25 | </td> |
  |  | 26 | </tr> |
  | 24 | 27 |  |
  | 25 |  | <tr> |
  | 26 |  | <th> |
  | 27 |  | <?php $id = Base::O\_OPTM\_DNS\_PREFETCH; ?> |
  | 28 |  | ~~<?php $this->title( $id~~ ); ?> |
  | 29 |  | </th> |
  | 30 |  | <td> |
  | 31 |  | ~~<?php $this->build\_textarea( $id~~ ); ?> |
  | 32 |  | <div class="litespeed-desc"> |
  | 33 |  | ~~<?php echo \_\_( 'Prefetching DNS can reduce latency for visitors.', 'litespeed-cache'~~ ); ?> |
  | 34 |  | ~~<?php echo \_\_( 'For example', 'litespeed-cache'~~ ); ?>: <code>//www.example.com</code> |
  | 35 |  | <?php Doc::one\_per\_line(); ?> |
  | 36 |  | ~~<?php Doc::learn\_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#dns-prefetch'~~ ); ?> |
  | 37 |  | </div> |
  | 38 |  | </td> |
  | 39 |  | </tr> |
  |  | 28 | <tr> |
  |  | 29 | <th> |
  |  | 30 | <?php $id = Base::O\_OPTM\_DNS\_PREFETCH; ?> |
  |  | 31 | <?php $this->title($id); ?> |
  |  | 32 | </th> |
  |  | 33 | <td> |
  |  | 34 | <?php $this->build\_textarea($id); ?> |
  |  | 35 | <div class="litespeed-desc"> |
  |  | 36 | <?php echo \_\_('Prefetching DNS can reduce latency for visitors.', 'litespeed-cache'); ?> |
  |  | 37 | <?php echo \_\_('For example', 'litespeed-cache'); ?>: <code>//www.example.com</code> |
  |  | 38 | <?php Doc::one\_per\_line(); ?> |
  |  | 39 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/pageopt/#dns-prefetch'); ?> |
  |  | 40 | </div> |
  |  | 41 | </td> |
  |  | 42 | </tr> |
  | 40 | 43 |  |
  | 41 |  | <tr> |
  | 42 |  | <th> |
  | 43 |  | <?php $id = Base::O\_OPTM\_DNS\_PREFETCH\_CTRL; ?> |
  | 44 |  | ~~<?php $this->title( $id~~ ); ?> |
  | 45 |  | </th> |
  | 46 |  | <td> |
  | 47 |  | ~~<?php $this->build\_switch( $id~~ ); ?> |
  | 48 |  | <div class="litespeed-desc"> |
  | 49 |  | ~~<?php echo \_\_( 'Automatically enable DNS prefetching for all URLs in the document, including images, CSS, JavaScript, and so forth.', 'litespeed-cache'~~ ); ?> |
  | 50 |  | ~~<?php echo \_\_( 'This can improve the page loading speed.', 'litespeed-cache'~~ ); ?> |
  | 51 |  | ~~<?php Doc::learn\_more( 'https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control'~~ ); ?> |
  | 52 |  | </div> |
  | 53 |  | </td> |
  | 54 |  | </tr> |
  |  | 44 | <tr> |
  |  | 45 | <th> |
  |  | 46 | <?php $id = Base::O\_OPTM\_DNS\_PREFETCH\_CTRL; ?> |
  |  | 47 | <?php $this->title($id); ?> |
  |  | 48 | </th> |
  |  | 49 | <td> |
  |  | 50 | <?php $this->build\_switch($id); ?> |
  |  | 51 | <div class="litespeed-desc"> |
  |  | 52 | <?php echo \_\_('Automatically enable DNS prefetching for all URLs in the document, including images, CSS, JavaScript, and so forth.', 'litespeed-cache'); ?> |
  |  | 53 | <?php echo \_\_('This can improve the page loading speed.', 'litespeed-cache'); ?> |
  |  | 54 | <?php Doc::learn\_more('https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-DNS-Prefetch-Control'); ?> |
  |  | 55 | </div> |
  |  | 56 | </td> |
  |  | 57 | </tr> |
  | 55 | 58 |  |
  | 56 |  | <tr> |
  | 57 |  | <th> |
  | 58 |  | <?php $id = Base::O\_OPTM\_HTML\_LAZY; ?> |
  | 59 |  | <?php $this->title( $id ); ?> |
  | 60 |  | </th> |
  | 61 |  | <td> |
  | 62 |  | <?php $this->build\_textarea( $id ); ?> |
  | 63 |  | <div class="litespeed-desc"> |
  | 64 |  | <?php echo \_\_( 'Delay rendering off-screen HTML elements by its selector.', 'litespeed-cache' ); ?> |
  | 65 |  | <?php Doc::one\_per\_line(); ?> |
  | 66 |  | <?php Doc::learn\_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-lazyload-selectors' ); ?> |
  | 67 |  | </div> |
  | 68 |  | </td> |
  | 69 |  | </tr> |
  |  | 59 | <tr> |
  |  | 60 | <th> |
  |  | 61 | <?php $id = Base::O\_OPTM\_DNS\_PRECONNECT; ?> |
  |  | 62 | <?php $this->title($id); ?> |
  |  | 63 | </th> |
  |  | 64 | <td> |
  |  | 65 | <?php $this->build\_textarea($id); ?> |
  |  | 66 | <div class="litespeed-desc"> |
  |  | 67 | <?php echo \_\_('Preconnecting speeds up future loads from a given origin.', 'litespeed-cache'); ?> |
  |  | 68 | <?php echo \_\_('For example', 'litespeed-cache'); ?>: <code>https://example.com</code> |
  |  | 69 | <?php Doc::one\_per\_line(); ?> |
  |  | 70 | <?php Doc::learn\_more('https://developer.mozilla.org/en-US/docs/Web/HTML/Attributes/rel/preconnect'); ?> |
  |  | 71 | </div> |
  |  | 72 | </td> |
  |  | 73 | </tr> |
  | 70 | 74 |  |
  | 71 |  | <tr> |
  | 72 |  | <th> |
  | 73 |  | <?php $id = Base::O\_OPTM\_QS\_RM; ?> |
  | 74 |  | <?php $this->title( $id ); ?> |
  | 75 |  | </th> |
  | 76 |  | <td> |
  | 77 |  | <?php $this->build\_switch( $id ); ?> |
  | 78 |  | <div class="litespeed-desc"> |
  | 79 |  | <?php echo \_\_( 'Remove query strings from internal static resources.', 'litespeed-cache' ); ?> |
  | 80 |  | <br /><font class="litespeed-warning"> |
  | 81 |  | ⚠️ |
  | 82 |  | <?php echo \_\_( 'Google reCAPTCHA will be bypassed automatically.', 'litespeed-cache' ); ?> |
  | 83 |  | </font> |
  | 84 |  | <br /><font class="litespeed-success"> |
  | 85 |  | <?php echo \_\_( 'API', 'litespeed-cache' ); ?>: |
  | 86 |  | <?php echo sprintf( \_\_( 'Append query string %s to the resources to bypass this action.', 'litespeed-cache' ), '<code>&\_litespeed\_rm\_qs=0</code>' ); ?> |
  | 87 |  | </font> |
  | 88 |  | </div> |
  | 89 |  | </td> |
  | 90 |  | </tr> |
  |  | 75 | <tr> |
  |  | 76 | <th> |
  |  | 77 | <?php $id = Base::O\_OPTM\_HTML\_LAZY; ?> |
  |  | 78 | <?php $this->title($id); ?> |
  |  | 79 | </th> |
  |  | 80 | <td> |
  |  | 81 | <?php $this->build\_textarea($id); ?> |
  |  | 82 | <div class="litespeed-desc"> |
  |  | 83 | <?php echo \_\_('Delay rendering off-screen HTML elements by its selector.', 'litespeed-cache'); ?> |
  |  | 84 | <?php Doc::one\_per\_line(); ?> |
  |  | 85 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/pageopt/#html-lazyload-selectors'); ?> |
  |  | 86 | </div> |
  |  | 87 | </td> |
  |  | 88 | </tr> |
  | 91 | 89 |  |
  | 92 |  | <tr> |
  | 93 |  | <th> |
  | 94 |  | <?php $id = Base::O\_OPTM\_GGFONTS\_ASYNC; ?> |
  | 95 |  | <?php $this->title( $id ); ?> |
  | 96 |  | </th> |
  | 97 |  | <td> |
  | 98 |  | <?php $this->build\_switch( $id ); ?> |
  | 99 |  | <div class="litespeed-desc"> |
  | 100 |  | <?php echo \_\_( 'Use Web Font Loader library to load Google Fonts asynchronously while leaving other CSS intact.', 'litespeed-cache' ); ?> |
  | 101 |  | <?php echo \_\_( 'This will also add a preconnect to Google Fonts to establish a connection earlier.', 'litespeed-cache' ); ?> |
  | 102 |  | <?php Doc::learn\_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#load-google-fonts-asynchronously' ); ?> |
  | 103 |  | </div> |
  | 104 |  | </td> |
  | 105 |  | </tr> |
  |  | 90 | <tr> |
  |  | 91 | <th> |
  |  | 92 | <?php $id = Base::O\_OPTM\_QS\_RM; ?> |
  |  | 93 | <?php $this->title($id); ?> |
  |  | 94 | </th> |
  |  | 95 | <td> |
  |  | 96 | <?php $this->build\_switch($id); ?> |
  |  | 97 | <div class="litespeed-desc"> |
  |  | 98 | <?php echo \_\_('Remove query strings from internal static resources.', 'litespeed-cache'); ?> |
  |  | 99 | <br /> |
  |  | 100 | <font class="litespeed-warning"> |
  |  | 101 | ⚠️ |
  |  | 102 | <?php echo \_\_('Google reCAPTCHA will be bypassed automatically.', 'litespeed-cache'); ?> |
  |  | 103 | </font> |
  |  | 104 | <br /> |
  |  | 105 | <font class="litespeed-success"> |
  |  | 106 | <?php echo \_\_('API', 'litespeed-cache'); ?>: |
  |  | 107 | <?php echo sprintf(\_\_('Append query string %s to the resources to bypass this action.', 'litespeed-cache'), '<code>&\_litespeed\_rm\_qs=0</code>'); ?> |
  |  | 108 | </font> |
  |  | 109 | </div> |
  |  | 110 | </td> |
  |  | 111 | </tr> |
  | 106 | 112 |  |
  | 107 |  | <tr> |
  | 108 |  | <th> |
  | 109 |  | <?php $id = Base::O\_OPTM\_GGFONTS\_RM; ?> |
  | 110 |  | <?php $this->title( $id ); ?> |
  | 111 |  | </th> |
  | 112 |  | <td> |
  | 113 |  | <?php $this->build\_switch( $id ); ?> |
  | 114 |  | <div class="litespeed-desc"> |
  | 115 |  | <?php echo \_\_( 'Prevent Google Fonts from loading on all pages.', 'litespeed-cache' ); ?> |
  | 116 |  | </div> |
  | 117 |  | </td> |
  | 118 |  | </tr> |
  |  | 113 | <tr> |
  |  | 114 | <th> |
  |  | 115 | <?php $id = Base::O\_OPTM\_GGFONTS\_ASYNC; ?> |
  |  | 116 | <?php $this->title($id); ?> |
  |  | 117 | </th> |
  |  | 118 | <td> |
  |  | 119 | <?php $this->build\_switch($id); ?> |
  |  | 120 | <div class="litespeed-desc"> |
  |  | 121 | <?php echo \_\_('Use Web Font Loader library to load Google Fonts asynchronously while leaving other CSS intact.', 'litespeed-cache'); ?> |
  |  | 122 | <?php echo \_\_('This will also add a preconnect to Google Fonts to establish a connection earlier.', 'litespeed-cache'); ?> |
  |  | 123 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/pageopt/#load-google-fonts-asynchronously'); ?> |
  |  | 124 | </div> |
  |  | 125 | </td> |
  |  | 126 | </tr> |
  | 119 | 127 |  |
  | 120 |  | <tr> |
  | 121 |  | <th> |
  | 122 |  | <?php $id = Base::O\_OPTM\_EMOJI\_RM; ?> |
  | 123 |  | <?php $this->title( $id ); ?> |
  | 124 |  | </th> |
  | 125 |  | <td> |
  | 126 |  | <?php $this->build\_switch( $id ); ?> |
  | 127 |  | <div class="litespeed-desc"> |
  | 128 |  | <?php echo \_\_( 'Stop loading WordPress.org emoji. Browser default emoji will be displayed instead.', 'litespeed-cache' ); ?> |
  | 129 |  | <?php echo \_\_( 'This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache' ); ?> |
  | 130 |  | </div> |
  | 131 |  | </td> |
  | 132 |  | </tr> |
  |  | 128 | <tr> |
  |  | 129 | <th> |
  |  | 130 | <?php $id = Base::O\_OPTM\_GGFONTS\_RM; ?> |
  |  | 131 | <?php $this->title($id); ?> |
  |  | 132 | </th> |
  |  | 133 | <td> |
  |  | 134 | <?php $this->build\_switch($id); ?> |
  |  | 135 | <div class="litespeed-desc"> |
  |  | 136 | <?php echo \_\_('Prevent Google Fonts from loading on all pages.', 'litespeed-cache'); ?> |
  |  | 137 | </div> |
  |  | 138 | </td> |
  |  | 139 | </tr> |
  | 133 | 140 |  |
  | 134 |  | <tr> |
  | 135 |  | <th> |
  | 136 |  | ~~<?php $id = Base::O\_OPTM\_NOSCRIPT~~\_RM; ?> |
  | 137 |  | ~~<?php $this->title( $id~~ ); ?> |
  | 138 |  | </th> |
  | 139 |  | <td> |
  | 140 |  | ~~<?php $this->build\_switch( $id~~ ); ?> |
  | 141 |  | <div class="litespeed-desc"> |
  | 142 |  | ~~<?php echo sprintf( \_\_( 'This option will remove all %s tags from HTML.', 'litespeed-cache' ), '<code>&lt;noscript&gt;</code>'~~ ); ?> |
  | 143 |  | ~~<?php Doc::learn\_more( 'https://docs.litespeedtech.com/lscache/lscwp/pageopt/#remove-noscript-tags'~~ ); ?> |
  | 144 |  | </div> |
  | 145 |  | </td> |
  | 146 |  | </tr> |
  |  | 141 | <tr> |
  |  | 142 | <th> |
  |  | 143 | <?php $id = Base::O\_OPTM\_EMOJI\_RM; ?> |
  |  | 144 | <?php $this->title($id); ?> |
  |  | 145 | </th> |
  |  | 146 | <td> |
  |  | 147 | <?php $this->build\_switch($id); ?> |
  |  | 148 | <div class="litespeed-desc"> |
  |  | 149 | <?php echo \_\_('Stop loading WordPress.org emoji. Browser default emoji will be displayed instead.', 'litespeed-cache'); ?> |
  |  | 150 | <?php echo \_\_('This can improve your speed score in services like Pingdom, GTmetrix and PageSpeed.', 'litespeed-cache'); ?> |
  |  | 151 | </div> |
  |  | 152 | </td> |
  |  | 153 | </tr> |
  | 147 | 154 |  |
  | 148 |  | </tbody></table> |
  |  | 155 | <tr> |
  |  | 156 | <th> |
  |  | 157 | <?php $id = Base::O\_OPTM\_NOSCRIPT\_RM; ?> |
  |  | 158 | <?php $this->title($id); ?> |
  |  | 159 | </th> |
  |  | 160 | <td> |
  |  | 161 | <?php $this->build\_switch($id); ?> |
  |  | 162 | <div class="litespeed-desc"> |
  |  | 163 | <?php echo sprintf(\_\_('This option will remove all %s tags from HTML.', 'litespeed-cache'), '<code>&lt;noscript&gt;</code>'); ?> |
  |  | 164 | <?php Doc::learn\_more('https://docs.litespeedtech.com/lscache/lscwp/pageopt/#remove-noscript-tags'); ?> |
  |  | 165 | </div> |
  |  | 166 | </td> |
  |  | 167 | </tr> |
  |  | 168 |  |
  |  | 169 | </tbody> |
  |  | 170 | </table> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2977143)
* [Zip Archive](?format=zip&new=2977143)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from github.com_cc3483c9_20250115_100707.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitespeedtech%2Flscache_wp%2Fcommit%2F95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitespeedtech%2Flscache_wp%2Fcommit%2F95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=litespeedtech%2Flscache_wp)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[litespeedtech](/litespeedtech)
/
**[lscache\_wp](/litespeedtech/lscache_wp)**
Public

* [Notifications](/login?return_to=%2Flitespeedtech%2Flscache_wp) You must be signed in to change notification settings
* [Fork
  109](/login?return_to=%2Flitespeedtech%2Flscache_wp)
* [Star
   222](/login?return_to=%2Flitespeedtech%2Flscache_wp)

* [Code](/litespeedtech/lscache_wp)
* [Issues
  156](/litespeedtech/lscache_wp/issues)
* [Pull requests
  25](/litespeedtech/lscache_wp/pulls)
* [Actions](/litespeedtech/lscache_wp/actions)
* [Projects
  0](/litespeedtech/lscache_wp/projects)
* [Security](/litespeedtech/lscache_wp/security)
* [Insights](/litespeedtech/lscache_wp/pulse)

Additional navigation options

* [Code](/litespeedtech/lscache_wp)
* [Issues](/litespeedtech/lscache_wp/issues)
* [Pull requests](/litespeedtech/lscache_wp/pulls)
* [Actions](/litespeedtech/lscache_wp/actions)
* [Projects](/litespeedtech/lscache_wp/projects)
* [Security](/litespeedtech/lscache_wp/security)
* [Insights](/litespeedtech/lscache_wp/pulse)

## Commit

[Permalink](/litespeedtech/lscache_wp/commit/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

v5.6.1-a10: \* 🐞\*\*ESI\*\* Patched a vulnerability issue. (István Márton@…

[Browse files](/litespeedtech/lscache_wp/tree/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7)
Browse the repository at this point in the history

```
…Wordfence #841011)
```

* Loading branch information

Hai Zheng
committed
Aug 16, 2023

1 parent
[0df6449](/litespeedtech/lscache_wp/commit/0df644991b1f2b75640a68e5ad4db71153517266)

commit 95a407d

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**301 additions**
and
**276 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* litespeed-cache.php
  [litespeed-cache.php](#diff-45a182f5eb04f1fba1ae25c1d5e2482478097c51972b3433ac59756c0d4c53d0)
* readme.txt
  [readme.txt](#diff-9e6e4772050998a5c0dc3c61acf3dab0a7e594566171fa5746d6b62f9598efb6)
* src

  + src/esi.cls.php
    [esi.cls.php](#diff-7b2c514b58d1b8a71655607bdfab87cedb013bc1b8927ce0b49a89ddf4a7e01c)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[litespeed-cache.php](#diff-45a182f5eb04f1fba1ae25c1d5e2482478097c51972b3433ac59756c0d4c53d0 "litespeed-cache.php")

Show comments

[View file](/litespeedtech/lscache_wp/blob/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7/litespeed-cache.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4,7 +4,7 @@ |
|  |  | \* Plugin Name: LiteSpeed Cache |
|  |  | \* Plugin URI: https://www.litespeedtech.com/products/cache-plugins/wordpress-acceleration |
|  |  | \* Description: High-performance page caching and site optimization from LiteSpeed |
|  |  | \* Version: 5.6.1-a9 |
|  |  | \* Version: 5.6.1-a10 |
|  |  | \* Author: LiteSpeed Technologies |
|  |  | \* Author URI: https://www.litespeedtech.com |
|  |  | \* License: GPLv3 |
| Expand Down  Expand Up | | @@ -34,7 +34,7 @@ |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | !defined('LSCWP\_V') && define('LSCWP\_V', '5.6.1-a9'); |
|  |  | !defined('LSCWP\_V') && define('LSCWP\_V', '5.6.1-a10'); |
|  |  |  |
|  |  | !defined('LSCWP\_CONTENT\_DIR') && define('LSCWP\_CONTENT\_DIR', WP\_CONTENT\_DIR); |
|  |  | !defined('LSCWP\_DIR') && define('LSCWP\_DIR', \_\_DIR\_\_ . '/'); // Full absolute path '/var/www/html/\*\*\*/wp-content/plugins/litespeed-cache/' or MU |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[readme.txt](#diff-9e6e4772050998a5c0dc3c61acf3dab0a7e594566171fa5746d6b62f9598efb6 "readme.txt")

Show comments

[View file](/litespeedtech/lscache_wp/blob/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7/readme.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -254,6 +254,7 @@ The vast majority of plugins and themes are compatible with LiteSpeed Cache. The |
|  |  | \* 🌱\*\*Page Optimize\*\* New option available: Preconnect. (xguiboy/Mukesh Patel) |
|  |  | \* \*\*Cloud\*\* Force syncing the configuration to QUIC.cloud if CDN is reenabled. |
|  |  | \* \*\*Cloud\*\* Force syncing the configuration to QUIC.cloud if domain key is readded. |
|  |  | \* 🐞\*\*ESI\*\* Patched a possible vulnerability issue. (István Márton@Wordfence #841011) |
|  |  | \* 🐞\*\*Image Optimize\*\* Bypass unnecessary image processing when images were only partially optimized. (Ruikai) |
|  |  | \* \*\*CDN\*\* Auto disabled CDN if CDN URL is invalid. (Ruikai) |
|  |  | \* \*\*API\*\* A third filter `litespeed\_media\_add\_missing\_sizes` allows bypassing Media's "add missing sizes" option (for Guest Optimization and otherwise). (PR #564) |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `95a407d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flitespeedtech%2Flscache_wp%2Fcommit%2F95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.wordfence.com_021447e9_20250115_100821.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# LiteSpeed Cache <= 5.6 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   LiteSpeed Cache <= 5.6 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-4372](https://www.cve.org/CVERecord?id=CVE-2023-4372) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | October 23, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The LiteSpeed Cache plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the 'esi' shortcode in versions up to, and including, 5.6 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/litespeed-cache/tags/5.5.1/src/esi.cls.php#L480)
* [github.com](https://github.com/litespeedtech/lscache_wp/commit/95a407d9f192b37ac6cf96d2aa50f240e3e6b2d7#diff-7b2c514b58d1b8a71655607bdfab87cedb013bc1b8927ce0b49a89ddf4a7e01cR495)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2977143/litespeed-cache#file348)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flitespeed-cache%2Flitespeed-cache-56-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=LiteSpeed%20Cache%20%3C%3D%205.6%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flitespeed-cache%2Flitespeed-cache-56-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=LiteSpeed%20Cache%20%3C%3D%205.6%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Flitespeed-cache%2Flitespeed-cache-56-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for LiteSpeed Cache

#### [LiteSpeed Cache](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/litespeed-cache)

| Software Type | Plugin |
| --- | --- |
| Software Slug | litespeed-cache [(view on wordpress.org)](https://wordpress.org/plugins/litespeed-cache) |
| Patched? | Yes |
| Remediation | Update to version 5.7, or a newer patched version |
| Affected Version | * <= 5.6 |
| Patched Version | * 5.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_ecac8a8b_20250115_100723.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Flitespeed-cache%2Ftags%2F5.5.1%2Fsrc%2Fesi.cls.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/litespeed-cache/tags/5.5.1/src/esi.cls.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/litespeed-cache/tags/5.5.1/src/esi.cls.php)

---

# [source:](/browser?order=name "Go to repository root") [litespeed-cache](/browser/litespeed-cache?order=name "View litespeed-cache")/[tags](/browser/litespeed-cache/tags?order=name "View tags")/[5.5.1](/browser/litespeed-cache/tags/5.5.1?order=name "View 5.5.1")/[src](/browser/litespeed-cache/tags/5.5.1/src?order=name "View src")/[esi.cls.php](/browser/litespeed-cache/tags/5.5.1/src/esi.cls.php?order=name "View esi.cls.php")

View diff against:

View revision:

| [Last change](/changeset/2940517/litespeed-cache/tags/5.5.1/src/esi.cls.php "View differences") on this file was [2940517](/changeset/2940517/ "View changeset 2940517"), checked in by LiteSpeedTech, [18 months ago](/timeline?from=2023-07-19T18%3A53%3A16Z&precision=second "See timeline at 07/19/2023 06:53:16 PM") |
| --- |
| Release v5.5.1 |
| **File size:** 26.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* The ESI class. |
| [4](#L4) | \* |
| [5](#L5) | \* This is used to define all esi related functions. |
| [6](#L6) | \* |
| [7](#L7) | \* @since       1.1.3 |
| [8](#L8) | \* @package     LiteSpeed |
| [9](#L9) | \* @subpackage  LiteSpeed/src |
| [10](#L10) | \* @author      LiteSpeed Technologies <info@litespeedtech.com> |
| [11](#L11) | \*/ |
| [12](#L12) | namespace LiteSpeed; |
| [13](#L13) |  |
| [14](#L14) | defined( 'WPINC' ) || exit; |
| [15](#L15) |  |
| [16](#L16) | class ESI extends Root { |
| [17](#L17) | private static $has\_esi = false; |
| [18](#L18) | private static $\_combine\_ids = array(); |
| [19](#L19) | private $esi\_args = null; |
| [20](#L20) | private $\_esi\_preserve\_list = array(); |
| [21](#L21) | private $\_nonce\_actions = array( -1 => '' ); // val is cache control |
| [22](#L22) |  |
| [23](#L23) | const QS\_ACTION = 'lsesi'; |
| [24](#L24) | const QS\_PARAMS = 'esi'; |
| [25](#L25) | const COMBO = '\_\_combo'; // ESI include combine='main' handler |
| [26](#L26) |  |
| [27](#L27) | const PARAM\_ARGS = 'args'; |
| [28](#L28) | const PARAM\_ID = 'id'; |
| [29](#L29) | const PARAM\_INSTANCE = 'instance'; |
| [30](#L30) | const PARAM\_NAME = 'name'; |
| [31](#L31) |  |
| [32](#L32) | const WIDGET\_O\_ESIENABLE = 'widget\_esi\_enable'; |
| [33](#L33) | const WIDGET\_O\_TTL = 'widget\_ttl'; |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Confructor of ESI |
| [37](#L37) | \* |
| [38](#L38) | \* @since  1.2.0 |
| [39](#L39) | \* @since  4.0 Change to be after Vary init in hook 'after\_setup\_theme' |
| [40](#L40) | \*/ |
| [41](#L41) | public function init() { |
| [42](#L42) | /\*\* |
| [43](#L43) | \* Bypass ESI related funcs if disabled ESI to fix potential DIVI compatibility issue |
| [44](#L44) | \* @since  2.9.7.2 |
| [45](#L45) | \*/ |
| [46](#L46) | if ( Router::is\_ajax() || ! $this->cls( 'Router' )->esi\_enabled() ) { |
| [47](#L47) | return; |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) | // Guest mode, don't need to use ESI |
| [51](#L51) | if ( defined( 'LITESPEED\_GUEST' ) && LITESPEED\_GUEST ) { |
| [52](#L52) | return; |
| [53](#L53) | } |
| [54](#L54) |  |
| [55](#L55) | if ( defined( 'LITESPEED\_ESI\_OFF' ) ) { |
| [56](#L56) | return; |
| [57](#L57) | } |
| [58](#L58) |  |
| [59](#L59) | // Init ESI in `after\_setup\_theme` hook after detected if LITESPEED\_DISABLE\_ALL is ON or not |
| [60](#L60) | $this->\_hooks(); |
| [61](#L61) |  |
| [62](#L62) | /\*\* |
| [63](#L63) | \* Overwrite wp\_create\_nonce func |
| [64](#L64) | \* @since  2.9.5 |
| [65](#L65) | \*/ |
| [66](#L66) | $this->\_transform\_nonce(); |
| [67](#L67) |  |
| [68](#L68) | ! defined( 'LITESPEED\_ESI\_INITED' ) && define( 'LITESPEED\_ESI\_INITED', true ); |
| [69](#L69) | } |
| [70](#L70) |  |
| [71](#L71) | /\*\* |
| [72](#L72) | \* Init ESI related hooks |
| [73](#L73) | \* |
| [74](#L74) | \* Load delayed by hook to give the ability to bypass by LITESPEED\_DISABLE\_ALL const |
| [75](#L75) | \* |
| [76](#L76) | \* @since 2.9.7.2 |
| [77](#L77) | \* @since  4.0 Changed to private from public |
| [78](#L78) | \* @access private |
| [79](#L79) | \*/ |
| [80](#L80) | private function \_hooks() { |
| [81](#L81) | add\_filter( 'template\_include', array( $this, 'esi\_template' ), 99999 ); |
| [82](#L82) |  |
| [83](#L83) | add\_action( 'load-widgets.php', \_\_NAMESPACE\_\_ . '\Purge::purge\_widget' ); |
| [84](#L84) | add\_action( 'wp\_update\_comment\_count', \_\_NAMESPACE\_\_ . '\Purge::purge\_comment\_widget' ); |
| [85](#L85) |  |
| [86](#L86) | /\*\* |
| [87](#L87) | \* Recover REQUEST\_URI |
| [88](#L88) | \* @since  1.8.1 |
| [89](#L89) | \*/ |
| [90](#L90) | if ( ! empty( $\_GET[ self::QS\_ACTION ] ) ) { |
| [91](#L91) | $this->\_register\_esi\_actions(); |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) | /\*\* |
| [95](#L95) | \* Shortcode ESI |
| [96](#L96) | \* |
| [97](#L97) | \* To use it, just change the origianl shortcode as below: |
| [98](#L98) | \*              old: [someshortcode aa='bb'] |
| [99](#L99) | \*              new: [esi someshortcode aa='bb' cache='private,no-vary' ttl='600'] |
| [100](#L100) | \* |
| [101](#L101) | \*      1. `cache` attribute is optional, default to 'public,no-vary'. |
| [102](#L102) | \*      2. `ttl` attribute is optional, default is your public TTL setting. |
| [103](#L103) | \*  3. `\_ls\_silence` attribute is optional, default is false. |
| [104](#L104) | \* |
| [105](#L105) | \* @since  2.8 |
| [106](#L106) | \* @since  2.8.1 Check is\_admin for Elementor compatibility #726013 |
| [107](#L107) | \*/ |
| [108](#L108) | if ( ! is\_admin() ) { |
| [109](#L109) | add\_shortcode( 'esi', array( $this, 'shortcode' ) ); |
| [110](#L110) | } |
| [111](#L111) |  |
| [112](#L112) | } |
| [113](#L113) |  |
| [114](#L114) | /\*\* |
| [115](#L115) | \* Take over all nonce calls and transform to ESI |
| [116](#L116) | \* |
| [117](#L117) | \* @since  2.9.5 |
| [118](#L118) | \*/ |
| [119](#L119) | private function \_transform\_nonce() { |
| [120](#L120) | if ( is\_admin() ) { |
| [121](#L121) | return; |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | // Load ESI nonces in conf |
| [125](#L125) | $nonces = $this->conf( Base::O\_ESI\_NONCE ); |
| [126](#L126) | add\_filter( 'litespeed\_esi\_nonces', array( $this->cls( 'Data' ), 'load\_esi\_nonces' ) ); |
| [127](#L127) | if ( $nonces = apply\_filters( 'litespeed\_esi\_nonces', $nonces ) ) { |
| [128](#L128) | foreach ( $nonces as $action ) { |
| [129](#L129) | $this->nonce\_action( $action ); |
| [130](#L130) | } |
| [131](#L131) | } |
| [132](#L132) |  |
| [133](#L133) | add\_action( 'litespeed\_nonce', array( $this, 'nonce\_action' ) ); |
| [134](#L134) | } |
| [135](#L135) |  |
| [136](#L136) | /\*\* |
| [137](#L137) | \* Register a new nonce action to convert it to ESI |
| [138](#L138) | \* |
| [139](#L139) | \* @since  2.9.5 |
| [140](#L140) | \*/ |
| [141](#L141) | public function nonce\_action( $action ) { |
| [142](#L142) | // Split the Cache Control |
| [143](#L143) | $action = explode( ' ', $action ); |
| [144](#L144) | $control = ! empty( $action[ 1 ] ) ? $action[ 1 ] : ''; |
| [145](#L145) | $action = $action[ 0 ]; |
| [146](#L146) |  |
| [147](#L147) | // Wildcard supported |
| [148](#L148) | $action = Utility::wildcard2regex( $action ); |
| [149](#L149) |  |
| [150](#L150) | if ( array\_key\_exists( $action, $this->\_nonce\_actions ) ) { |
| [151](#L151) | return; |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) | $this->\_nonce\_actions[ $action ] = $control; |
| [155](#L155) |  |
| [156](#L156) | Debug2::debug( '[ESI] Appended nonce action to nonce list [action] ' . $action ); |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | /\*\* |
| [160](#L160) | \* Check if an action is registered to replace ESI |
| [161](#L161) | \* |
| [162](#L162) | \* @since 2.9.5 |
| [163](#L163) | \*/ |
| [164](#L164) | public function is\_nonce\_action( $action ) { |
| [165](#L165) | // If GM not run yet, then ESI not init yet, then ESI nonce will not be allowed even nonce func replaced. |
| [166](#L166) | if ( ! defined( 'LITESPEED\_ESI\_INITED' ) ) { |
| [167](#L167) | return null; |
| [168](#L168) | } |
| [169](#L169) |  |
| [170](#L170) | if ( is\_admin() ) { |
| [171](#L171) | return null; |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | if ( defined( 'LITESPEED\_ESI\_OFF' ) ) { |
| [175](#L175) | return null; |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | foreach ( $this->\_nonce\_actions as $k => $v ) { |
| [179](#L179) | if ( strpos( $k, '\*' ) !== false ) { |
| [180](#L180) | if( preg\_match( '#' . $k . '#iU', $action ) ) { |
| [181](#L181) | return $v; |
| [182](#L182) | } |
| [183](#L183) | } |
| [184](#L184) | else { |
| [185](#L185) | if ( $k == $action ) { |
| [186](#L186) | return $v; |
| [187](#L187) | } |
| [188](#L188) | } |
| [189](#L189) | } |
| [190](#L190) |  |
| [191](#L191) | return null; |
| [192](#L192) | } |
| [193](#L193) |  |
| [194](#L194) | /\*\* |
| [195](#L195) | \* Shortcode ESI |
| [196](#L196) | \* |
| [197](#L197) | \* @since 2.8 |
| [198](#L198) | \* @access public |
| [199](#L199) | \*/ |
| [200](#L200) | public function shortcode( $atts ) { |
| [201](#L201) | if ( empty( $atts[ 0 ] ) ) { |
| [202](#L202) | Debug2::debug( '[ESI] ===shortcode wrong format', $atts ); |
| [203](#L203) | return 'Wrong shortcode esi format'; |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | $cache = 'public,no-vary'; |
| [207](#L207) | if ( ! empty( $atts[ 'cache' ] ) ) { |
| [208](#L208) | $cache = $atts[ 'cache' ]; |
| [209](#L209) | unset( $atts[ 'cache' ] ); |
| [210](#L210) | } |
| [211](#L211) |  |
| [212](#L212) | $silence = false; |
| [213](#L213) | if ( ! empty( $atts[ '\_ls\_silence' ] ) ) { |
| [214](#L214) | $silence = true; |
| [215](#L215) | } |
| [216](#L216) |  |
| [217](#L217) | do\_action( 'litespeed\_esi\_shortcode-' . $atts[ 0 ] ); |
| [218](#L218) |  |
| [219](#L219) | // Show ESI link |
| [220](#L220) | return $this->sub\_esi\_block( 'esi', 'esi-shortcode', $atts, $cache, $silence ); |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | /\*\* |
| [224](#L224) | \* Check if the requested page has esi elements. If so, return esi on |
| [225](#L225) | \* header. |
| [226](#L226) | \* |
| [227](#L227) | \* @since 1.1.3 |
| [228](#L228) | \* @access public |
| [229](#L229) | \* @return string Esi On header if request has esi, empty string otherwise. |
| [230](#L230) | \*/ |
| [231](#L231) | public static function has\_esi() { |
| [232](#L232) | return self::$has\_esi; |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) | /\*\* |
| [236](#L236) | \* Sets that the requested page has esi elements. |
| [237](#L237) | \* |
| [238](#L238) | \* @since 1.1.3 |
| [239](#L239) | \* @access public |
| [240](#L240) | \*/ |
| [241](#L241) | public static function set\_has\_esi() { |
| [242](#L242) | self::$has\_esi = true; |
| [243](#L243) | } |
| [244](#L244) |  |
| [245](#L245) | /\*\* |
| [246](#L246) | \* Register all of the hooks related to the esi logic of the plugin. |
| [247](#L247) | \* Specifically when the page IS an esi page. |
| [248](#L248) | \* |
| [249](#L249) | \* @since    1.1.3 |
| [250](#L250) | \* @access   private |
| [251](#L251) | \*/ |
| [252](#L252) | private function \_register\_esi\_actions() { |
| [253](#L253) | ! defined( 'LSCACHE\_IS\_ESI' ) && define( 'LSCACHE\_IS\_ESI', $\_GET[ self::QS\_ACTION ] );// Reused this to ESI block ID |
| [254](#L254) |  |
| [255](#L255) | ! empty( $\_SERVER[ 'ESI\_REFERER' ] ) && defined( 'LSCWP\_LOG' ) && Debug2::debug( '[ESI] ESI\_REFERER: ' . $\_SERVER[ 'ESI\_REFERER' ] ); |
| [256](#L256) |  |
| [257](#L257) | /\*\* |
| [258](#L258) | \* Only when ESI's parent is not REST, replace REQUEST\_URI to avoid breaking WP5 editor REST call |
| [259](#L259) | \* @since 2.9.3 |
| [260](#L260) | \*/ |
| [261](#L261) | if ( ! empty( $\_SERVER[ 'ESI\_REFERER' ] ) && ! $this->cls( 'REST' )->is\_rest( $\_SERVER[ 'ESI\_REFERER' ] ) ) { |
| [262](#L262) | $\_SERVER[ 'REQUEST\_URI' ] = $\_SERVER[ 'ESI\_REFERER' ]; |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | if ( ! empty( $\_SERVER[ 'ESI\_CONTENT\_TYPE' ] ) && strpos( $\_SERVER[ 'ESI\_CONTENT\_TYPE' ], 'application/json' ) === 0 ) { |
| [266](#L266) | add\_filter( 'litespeed\_is\_json', '\_\_return\_true' ); |
| [267](#L267) | } |
| [268](#L268) |  |
| [269](#L269) | /\*\* |
| [270](#L270) | \* Make REST call be able to parse ESI |
| [271](#L271) | \* NOTE: Not effective due to ESI req are all to `/` yet |
| [272](#L272) | \* @since 2.9.4 |
| [273](#L273) | \*/ |
| [274](#L274) | add\_action( 'rest\_api\_init', array( $this, 'load\_esi\_block' ), 101 ); |
| [275](#L275) |  |
| [276](#L276) | // Register ESI blocks |
| [277](#L277) | add\_action('litespeed\_esi\_load-widget', array($this, 'load\_widget\_block')); |
| [278](#L278) | add\_action('litespeed\_esi\_load-admin-bar', array($this, 'load\_admin\_bar\_block')); |
| [279](#L279) | add\_action('litespeed\_esi\_load-comment-form', array($this, 'load\_comment\_form\_block')); |
| [280](#L280) |  |
| [281](#L281) | add\_action('litespeed\_esi\_load-nonce', array( $this, 'load\_nonce\_block' ) ); |
| [282](#L282) | add\_action('litespeed\_esi\_load-esi', array( $this, 'load\_esi\_shortcode' ) ); |
| [283](#L283) |  |
| [284](#L284) | add\_action('litespeed\_esi\_load-' . self::COMBO, array( $this, 'load\_combo' ) ); |
| [285](#L285) | } |
| [286](#L286) |  |
| [287](#L287) | /\*\* |
| [288](#L288) | \* Hooked to the template\_include action. |
| [289](#L289) | \* Selects the esi template file when the post type is a LiteSpeed ESI page. |
| [290](#L290) | \* |
| [291](#L291) | \* @since 1.1.3 |
| [292](#L292) | \* @access public |
| [293](#L293) | \* @param string $template The template path filtered. |
| [294](#L294) | \* @return string The new template path. |
| [295](#L295) | \*/ |
| [296](#L296) | public function esi\_template( $template ) { |
| [297](#L297) | // Check if is an ESI request |
| [298](#L298) | if ( defined( 'LSCACHE\_IS\_ESI' ) ) { |
| [299](#L299) | Debug2::debug( '[ESI] calling template' ); |
| [300](#L300) |  |
| [301](#L301) | return LSCWP\_DIR . 'tpl/esi.tpl.php'; |
| [302](#L302) | } |
| [303](#L303) | $this->\_register\_not\_esi\_actions(); |
| [304](#L304) | return $template; |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | /\*\* |
| [308](#L308) | \* Register all of the hooks related to the esi logic of the plugin. |
| [309](#L309) | \* Specifically when the page is NOT an esi page. |
| [310](#L310) | \* |
| [311](#L311) | \* @since    1.1.3 |
| [312](#L312) | \* @access   private |
| [313](#L313) | \*/ |
| [314](#L314) | private function \_register\_not\_esi\_actions() { |
| [315](#L315) | do\_action( 'litespeed\_tpl\_normal' ); |
| [316](#L316) |  |
| [317](#L317) | if ( ! Control::is\_cacheable() ) { |
| [318](#L318) | return; |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | if ( Router::is\_ajax() ) { |
| [322](#L322) | return; |
| [323](#L323) | } |
| [324](#L324) |  |
| [325](#L325) | add\_filter('widget\_display\_callback', array( $this, 'sub\_widget\_block' ), 0, 3); |
| [326](#L326) |  |
| [327](#L327) | // Add admin\_bar esi |
| [328](#L328) | if ( Router::is\_logged\_in() ) { |
| [329](#L329) | remove\_action('wp\_footer', 'wp\_admin\_bar\_render', 1000); |
| [330](#L330) | add\_action('wp\_footer', array($this, 'sub\_admin\_bar\_block'), 1000); |
| [331](#L331) | } |
| [332](#L332) |  |
| [333](#L333) | // Add comment forum esi for logged-in user or commenter |
| [334](#L334) | if ( ! Router::is\_ajax() && Vary::has\_vary() ) { |
| [335](#L335) | add\_filter( 'comment\_form\_defaults', array( $this, 'register\_comment\_form\_actions' ) ); |
| [336](#L336) | } |
| [337](#L337) |  |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | /\*\* |
| [341](#L341) | \* Set an ESI to be combine='sub' |
| [342](#L342) | \* |
| [343](#L343) | \* @since  3.4.2 |
| [344](#L344) | \*/ |
| [345](#L345) | public static function combine( $block\_id ) { |
| [346](#L346) | if ( ! isset( $\_SERVER[ 'X-LSCACHE' ] ) || strpos( $\_SERVER[ 'X-LSCACHE' ], 'combine' ) === false ) { |
| [347](#L347) | return; |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | if ( in\_array( $block\_id, self::$\_combine\_ids ) ) { |
| [351](#L351) | return; |
| [352](#L352) | } |
| [353](#L353) |  |
| [354](#L354) | self::$\_combine\_ids[] = $block\_id; |
| [355](#L355) | } |
| [356](#L356) |  |
| [357](#L357) | /\*\* |
| [358](#L358) | \* Load combined ESI |
| [359](#L359) | \* |
| [360](#L360) | \* @since  3.4.2 |
| [361](#L361) | \*/ |
| [362](#L362) | public function load\_combo() { |
| [363](#L363) | Control::set\_nocache( 'ESI combine request' ); |
| [364](#L364) |  |
| [365](#L365) | if ( empty( $\_POST[ 'esi\_include' ] ) ) { |
| [366](#L366) | return; |
| [367](#L367) | } |
| [368](#L368) |  |
| [369](#L369) | self::set\_has\_esi(); |
| [370](#L370) |  |
| [371](#L371) | Debug2::debug( '[ESI] 🍔 Load combo', $\_POST[ 'esi\_include' ] ); |
| [372](#L372) |  |
| [373](#L373) | $output = ''; |
| [374](#L374) | foreach ( $\_POST[ 'esi\_include' ] as $url ) { |
| [375](#L375) | $qs = parse\_url( htmlspecialchars\_decode( $url ), PHP\_URL\_QUERY ); |
| [376](#L376) | parse\_str( $qs, $qs ); |
| [377](#L377) | if ( empty( $qs[ self::QS\_ACTION ] ) ) { |
| [378](#L378) | continue; |
| [379](#L379) | } |
| [380](#L380) | $esi\_id = $qs[ self::QS\_ACTION ]; |
| [381](#L381) | $esi\_param = ! empty( $qs[ self::QS\_PARAMS ] ) ? $this->\_parse\_esi\_param( $qs[ self::QS\_PARAMS ] ) : false; |
| [382](#L382) | $inline\_param = apply\_filters( 'litespeed\_esi\_inline-' . $esi\_id, array(), $esi\_param ); // Returned array need to be [ val, control, tag ] |
| [383](#L383) | if ( $inline\_param ) { |
| [384](#L384) | $output .= self::\_build\_inline( $url, $inline\_param ); |
| [385](#L385) | } |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | echo $output; |
| [389](#L389) | } |
| [390](#L390) |  |
| [391](#L391) | /\*\* |
| [392](#L392) | \* Build a whole inline segment |
| [393](#L393) | \* |
| [394](#L394) | \* @since  3.4.2 |
| [395](#L395) | \*/ |
| [396](#L396) | private static function \_build\_inline( $url, $inline\_param ) { |
| [397](#L397) | if ( ! $url || empty( $inline\_param[ 'val' ] ) || empty( $inline\_param[ 'control' ] ) || empty( $inline\_param[ 'tag' ] ) ) { |
| [398](#L398) | return ''; |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) | return "<esi:inline name='$url' cache-control='" . $inline\_param[ 'control' ] . "' cache-tag='" . $inline\_param[ 'tag' ] . "'>" . $inline\_param[ 'val' ] . "</esi:inline>"; |
| [402](#L402) | } |
| [403](#L403) |  |
| [404](#L404) | /\*\* |
| [405](#L405) | \* Build the esi url. This method will build the html comment wrapper as well as serialize and encode the parameter array. |
| [406](#L406) | \* |
| [407](#L407) | \* The block\_id parameter should contain alphanumeric and '-\_' only. |
| [408](#L408) | \* |
| [409](#L409) | \* @since 1.1.3 |
| [410](#L410) | \* @access private |
| [411](#L411) | \* @param string $block\_id The id to use to display the correct esi block. |
| [412](#L412) | \* @param string $wrapper The wrapper for the esi comments. |
| [413](#L413) | \* @param array $params The esi parameters. |
| [414](#L414) | \* @param string $control The cache control attribute if any. |
| [415](#L415) | \* @param bool $silence If generate wrapper comment or not |
| [416](#L416) | \* @param bool $preserved       If this ESI block is used in any filter, need to temporarily convert it to a string to avoid the HTML tag being removed/filtered. |
| [417](#L417) | \* @param bool $svar            If store the value in memory or not, in memory wil be faster |
| [418](#L418) | \* @param array $inline\_val     If show the current value for current request( this can avoid multiple esi requests in first time cache generating process ) |
| [419](#L419) | \*/ |
| [420](#L420) | public function sub\_esi\_block( $block\_id, $wrapper, $params = array(), $control = 'private,no-vary', $silence = false, $preserved = false, $svar = false, $inline\_param = array() ) { |
| [421](#L421) | if ( empty($block\_id) || ! is\_array($params) || preg\_match('/[^\w-]/', $block\_id) ) { |
| [422](#L422) | return false; |
| [423](#L423) | } |
| [424](#L424) |  |
| [425](#L425) | if ( defined( 'LITESPEED\_ESI\_OFF' ) ) { |
| [426](#L426) | Debug2::debug( '[ESI] ESI OFF so force loading [block\_id] ' . $block\_id ); |
| [427](#L427) | do\_action( 'litespeed\_esi\_load-' . $block\_id, $params ); |
| [428](#L428) | return; |
| [429](#L429) | } |
| [430](#L430) |  |
| [431](#L431) | if ( $silence ) { |
| [432](#L432) | // Don't add comment to esi block ( original for nonce used in tag property data-nonce='esi\_block' ) |
| [433](#L433) | $params[ '\_ls\_silence' ] = true; |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) | if ( $this->cls( 'REST' )->is\_rest() || $this->cls( 'REST' )->is\_internal\_rest() ) { |
| [437](#L437) | $params[ 'is\_json' ] = 1; |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) | $params = apply\_filters( 'litespeed\_esi\_params', $params, $block\_id ); |
| [441](#L441) | $control = apply\_filters('litespeed\_esi\_control', $control, $block\_id ); |
| [442](#L442) |  |
| [443](#L443) | if ( !is\_array($params) || !is\_string($control) ) { |
| [444](#L444) | defined( 'LSCWP\_LOG' ) && Debug2::debug( "[ESI] 🛑 Sub hooks returned Params: \n" . var\_export($params, true) . "\ncache control: \n" . var\_export($control, true) ); |
| [445](#L445) |  |
| [446](#L446) | return false; |
| [447](#L447) | } |
| [448](#L448) |  |
| [449](#L449) | // Build params for URL |
| [450](#L450) | $appended\_params = array( |
| [451](#L451) | self::QS\_ACTION => $block\_id, |
| [452](#L452) | ); |
| [453](#L453) | if ( ! empty( $control ) ) { |
| [454](#L454) | $appended\_params[ '\_control' ] = $control; |
| [455](#L455) | } |
| [456](#L456) | if ( $params ) { |
| [457](#L457) | $appended\_params[ self::QS\_PARAMS ] = base64\_encode( json\_encode( $params ) ); |
| [458](#L458) | Debug2::debug2( '[ESI] param ', $params ); |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) | // Append hash |
| [462](#L462) | $appended\_params[ '\_hash' ] = $this->\_gen\_esi\_md5( $appended\_params ); |
| [463](#L463) |  |
| [464](#L464) | /\*\* |
| [465](#L465) | \* Escape potential chars |
| [466](#L466) | \* @since 2.9.4 |
| [467](#L467) | \*/ |
| [468](#L468) | $appended\_params = array\_map( 'urlencode', $appended\_params ); |
| [469](#L469) |  |
| [470](#L470) | // Generate ESI URL |
| [471](#L471) | $url = add\_query\_arg( $appended\_params, trailingslashit( wp\_make\_link\_relative( home\_url() ) ) ); |
| [472](#L472) |  |
| [473](#L473) | $output = ''; |
| [474](#L474) | if ( $inline\_param ) { |
| [475](#L475) | $output .= self::\_build\_inline( $url, $inline\_param ); |
| [476](#L476) | } |
| [477](#L477) |  |
| [478](#L478) | $output .= "<esi:include src='$url'"; |
| [479](#L479) | if ( ! empty( $control ) ) { |
| [480](#L480) | $output .= " cache-control='$control'"; |
| [481](#L481) | } |
| [482](#L482) | if ( $svar ) { |
| [483](#L483) | $output .= " as-var='1'"; |
| [484](#L484) | } |
| [485](#L485) | if ( in\_array( $block\_id, self::$\_combine\_ids ) ) { |
| [486](#L486) | $output .= " combine='sub'"; |
| [487](#L487) | } |
| [488](#L488) | if ( $block\_id == self::COMBO && isset( $\_SERVER[ 'X-LSCACHE' ] ) && strpos( $\_SERVER[ 'X-LSCACHE' ], 'combine' ) !== false ) { |
| [489](#L489) | $output .= " combine='main'"; |
| [490](#L490) | } |
| [491](#L491) | $output .= " />"; |
| [492](#L492) |  |
| [493](#L493) | if ( ! $silence ) { |
| [494](#L494) | $output = "<!-- lscwp $wrapper -->$output<!-- lscwp $wrapper esi end -->"; |
| [495](#L495) | } |
| [496](#L496) |  |
| [497](#L497) | Debug2::debug( "[ESI] 💕  [BLock\_ID] $block\_id \t[wrapper] $wrapper \t\t[Control] $control" ); |
| [498](#L498) | Debug2::debug2( $output ); |
| [499](#L499) |  |
| [500](#L500) | self::set\_has\_esi(); |
| [501](#L501) |  |
| [502](#L502) | // Convert to string to avoid html chars filter when using |
| [503](#L503) | // Will reverse the buffer when output in self::finalize() |
| [504](#L504) | if ( $preserved ) { |
| [505](#L505) | $hash = md5( $output ); |
| [506](#L506) | $this->\_esi\_preserve\_list[ $hash ] = $output; |
| [507](#L507) | Debug2::debug( "[ESI] Preserved to $hash" ); |
| [508](#L508) |  |
| [509](#L509) | return $hash; |
| [510](#L510) | } |
| [511](#L511) |  |
| [512](#L512) | return $output; |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | /\*\* |
| [516](#L516) | \* Generate ESI hash md5 |
| [517](#L517) | \* |
| [518](#L518) | \* @since  2.9.6 |
| [519](#L519) | \* @access private |
| [520](#L520) | \*/ |
| [521](#L521) | private function \_gen\_esi\_md5( $params ) { |
| [522](#L522) | $keys = array( |
| [523](#L523) | self::QS\_ACTION, |
| [524](#L524) | '\_control', |
| [525](#L525) | self::QS\_PARAMS, |
| [526](#L526) | ); |
| [527](#L527) |  |
| [528](#L528) | $str = ''; |
| [529](#L529) | foreach ( $keys as $v ) { |
| [530](#L530) | if ( isset( $params[ $v ] ) && is\_string( $params[ $v ] ) ) { |
| [531](#L531) | $str .= $params[ $v ]; |
| [532](#L532) | } |
| [533](#L533) | } |
| [534](#L534) | Debug2::debug2( '[ESI] md5\_string=' . $str ); |
| [535](#L535) |  |
| [536](#L536) | return md5( $this->conf( Base::HASH ) . $str ); |
| [537](#L537) | } |
| [538](#L538) |  |
| [539](#L539) | /\*\* |
| [540](#L540) | \* Parses the request parameters on an ESI request |
| [541](#L541) | \* |
| [542](#L542) | \* @since 1.1.3 |
| [543](#L543) | \* @access private |
| [544](#L544) | \*/ |
| [545](#L545) | private function \_parse\_esi\_param( $qs\_params = false ) { |
| [546](#L546) | $req\_params = false; |
| [547](#L547) | if ( $qs\_params ) { |
| [548](#L548) | $req\_params = $qs\_params; |
| [549](#L549) | } |
| [550](#L550) | elseif ( isset( $\_REQUEST[ self::QS\_PARAMS ] ) ) { |
| [551](#L551) | $req\_params = $\_REQUEST[ self::QS\_PARAMS ]; |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | if ( ! $req\_params ) { |
| [555](#L555) | return false; |
| [556](#L556) | } |
| [557](#L557) |  |
| [558](#L558) | $unencrypted = base64\_decode( $req\_params ); |
| [559](#L559) | if ( $unencrypted === false ) { |
| [560](#L560) | return false; |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | Debug2::debug2( '[ESI] parms', $unencrypted ); |
| [564](#L564) | // $unencoded = urldecode($unencrypted); no need to do this as $\_GET is already parsed |
| [565](#L565) | $params = json\_decode( $unencrypted, true ); |
| [566](#L566) |  |
| [567](#L567) | return $params; |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) | /\*\* |
| [571](#L571) | \* Select the correct esi output based on the parameters in an ESI request. |
| [572](#L572) | \* |
| [573](#L573) | \* @since 1.1.3 |
| [574](#L574) | \* @access public |
| [575](#L575) | \*/ |
| [576](#L576) | public function load\_esi\_block() { |
| [577](#L577) | /\*\* |
| [578](#L578) | \* Validate if is a legal ESI req |
| [579](#L579) | \* @since 2.9.6 |
| [580](#L580) | \*/ |
| [581](#L581) | if ( empty( $\_GET[ '\_hash' ] ) || $this->\_gen\_esi\_md5( $\_GET ) != $\_GET[ '\_hash' ] ) { |
| [582](#L582) | Debug2::debug( '[ESI] ❌ Failed to validate \_hash' ); |
| [583](#L583) | return; |
| [584](#L584) | } |
| [585](#L585) |  |
| [586](#L586) | $params = $this->\_parse\_esi\_param(); |
| [587](#L587) |  |
| [588](#L588) | if ( defined( 'LSCWP\_LOG' ) ) { |
| [589](#L589) | $logInfo = '[ESI] ⭕ '; |
| [590](#L590) | if( ! empty( $params[ self::PARAM\_NAME ] ) ) { |
| [591](#L591) | $logInfo .= ' Name: ' . $params[ self::PARAM\_NAME ] . ' ----- '; |
| [592](#L592) | } |
| [593](#L593) | $logInfo .= ' [ID] ' . LSCACHE\_IS\_ESI; |
| [594](#L594) | Debug2::debug( $logInfo ); |
| [595](#L595) | } |
| [596](#L596) |  |
| [597](#L597) | if ( ! empty( $params[ '\_ls\_silence' ] ) ) { |
| [598](#L598) | ! defined( 'LSCACHE\_ESI\_SILENCE' ) && define( 'LSCACHE\_ESI\_SILENCE', true ); |
| [599](#L599) | } |
| [600](#L600) |  |
| [601](#L601) | /\*\* |
| [602](#L602) | \* Buffer needs to be JSON format |
| [603](#L603) | \* @since  2.9.4 |
| [604](#L604) | \*/ |
| [605](#L605) | if ( ! empty( $params[ 'is\_json' ] ) ) { |
| [606](#L606) | add\_filter( 'litespeed\_is\_json', '\_\_return\_true' ); |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | Tag::add( rtrim( Tag::TYPE\_ESI, '.' ) ); |
| [610](#L610) | Tag::add( Tag::TYPE\_ESI . LSCACHE\_IS\_ESI ); |
| [611](#L611) |  |
| [612](#L612) | // Debug2::debug(var\_export($params, true )); |
| [613](#L613) |  |
| [614](#L614) | /\*\* |
| [615](#L615) | \* Handle default cache control 'private,no-vary' for sub\_esi\_block()   @ticket #923505 |
| [616](#L616) | \* |
| [617](#L617) | \* @since  2.2.3 |
| [618](#L618) | \*/ |
| [619](#L619) | if ( ! empty( $\_GET[ '\_control' ] ) ) { |
| [620](#L620) | $control = explode( ',', $\_GET[ '\_control' ] ); |
| [621](#L621) | if ( in\_array( 'private', $control ) ) { |
| [622](#L622) | Control::set\_private(); |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | if ( in\_array( 'no-vary', $control ) ) { |
| [626](#L626) | Control::set\_no\_vary(); |
| [627](#L627) | } |
| [628](#L628) | } |
| [629](#L629) |  |
| [630](#L630) | do\_action('litespeed\_esi\_load-' . LSCACHE\_IS\_ESI, $params); |
| [631](#L631) | } |
| [632](#L632) |  |
| [633](#L633) | // The \*\_sub\_\* functions are helpers for the sub\_\* functions. |
| [634](#L634) | // The \*\_load\_\* functions are helpers for the load\_\* functions. |
| [635](#L635) |  |
| [636](#L636) | /\*\* |
| [637](#L637) | \* Loads the default options for default WordPress widgets. |
| [638](#L638) | \* |
| [639](#L639) | \* @since 1.1.3 |
| [640](#L640) | \* @access public |
| [641](#L641) | \*/ |
| [642](#L642) | public static function widget\_default\_options($options, $widget) { |
| [643](#L643) | if ( ! is\_array($options) ) { |
| [644](#L644) | return $options; |
| [645](#L645) | } |
| [646](#L646) |  |
| [647](#L647) | $widget\_name = get\_class($widget); |
| [648](#L648) | switch ($widget\_name) { |
| [649](#L649) | case 'WP\_Widget\_Recent\_Posts' : |
| [650](#L650) | case 'WP\_Widget\_Recent\_Comments' : |
| [651](#L651) | $options[self::WIDGET\_O\_ESIENABLE] = Base::VAL\_OFF; |
| [652](#L652) | $options[self::WIDGET\_O\_TTL] = 86400; |
| [653](#L653) | break; |
| [654](#L654) | default : |
| [655](#L655) | break; |
| [656](#L656) | } |
| [657](#L657) | return $options; |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | /\*\* |
| [661](#L661) | \* Hooked to the widget\_display\_callback filter. |
| [662](#L662) | \* If the admin configured the widget to display via esi, this function |
| [663](#L663) | \* will set up the esi request and cancel the widget display. |
| [664](#L664) | \* |
| [665](#L665) | \* @since 1.1.3 |
| [666](#L666) | \* @access public |
| [667](#L667) | \* @param array $instance Parameter used to build the widget. |
| [668](#L668) | \* @param WP\_Widget $widget The widget to build. |
| [669](#L669) | \* @param array $args Parameter used to build the widget. |
| [670](#L670) | \* @return mixed Return false if display through esi, instance otherwise. |
| [671](#L671) | \*/ |
| [672](#L672) | public function sub\_widget\_block( $instance, $widget, $args ) { |
| [673](#L673) | // #210407 |
| [674](#L674) | if ( ! is\_array( $instance ) ) { |
| [675](#L675) | return $instance; |
| [676](#L676) | } |
| [677](#L677) |  |
| [678](#L678) | $name = get\_class( $widget ); |
| [679](#L679) | if ( ! isset( $instance[ Base::OPTION\_NAME ] ) ) { |
| [680](#L680) | return $instance; |
| [681](#L681) | } |
| [682](#L682) | $options = $instance[ Base::OPTION\_NAME ]; |
| [683](#L683) | if ( ! isset( $options ) || ! $options[ self::WIDGET\_O\_ESIENABLE ] ) { |
| [684](#L684) | defined( 'LSCWP\_LOG' ) && Debug2::debug( 'ESI 0 ' . $name . ': '. ( ! isset( $options ) ? 'not set' : 'set off' ) ); |
| [685](#L685) |  |
| [686](#L686) | return $instance; |
| [687](#L687) | } |
| [688](#L688) |  |
| [689](#L689) | $esi\_private = $options[ self::WIDGET\_O\_ESIENABLE ] == Base::VAL\_ON2 ? 'private,' : ''; |
| [690](#L690) |  |
| [691](#L691) | $params = array( |
| [692](#L692) | self::PARAM\_NAME => $name, |
| [693](#L693) | self::PARAM\_ID => $widget->id, |
| [694](#L694) | self::PARAM\_INSTANCE => $instance, |
| [695](#L695) | self::PARAM\_ARGS => $args |
| [696](#L696) | ); |
| [697](#L697) |  |
| [698](#L698) | echo $this->sub\_esi\_block( 'widget', 'widget ' . $name, $params, $esi\_private . 'no-vary' ); |
| [699](#L699) |  |
| [700](#L700) | return false; |
| [701](#L701) | } |
| [702](#L702) |  |
| [703](#L703) | /\*\* |
| [704](#L704) | \* Hooked to the wp\_footer action. |
| [705](#L705) | \* Sets up the ESI request for the admin bar. |
| [706](#L706) | \* |
| [707](#L707) | \* @access public |
| [708](#L708) | \* @since 1.1.3 |
| [709](#L709) | \* @global type $wp\_admin\_bar |
| [710](#L710) | \*/ |
| [711](#L711) | public function sub\_admin\_bar\_block() { |
| [712](#L712) | global $wp\_admin\_bar; |
| [713](#L713) |  |
| [714](#L714) | if ( ! is\_admin\_bar\_showing() || ! is\_object($wp\_admin\_bar) ) { |
| [715](#L715) | return; |
| [716](#L716) | } |
| [717](#L717) |  |
| [718](#L718) | // To make each admin bar ESI request different for `Edit` button different link |
| [719](#L719) | $params = array( |
| [720](#L720) | 'ref' => $\_SERVER[ 'REQUEST\_URI' ], |
| [721](#L721) | ); |
| [722](#L722) |  |
| [723](#L723) | echo $this->sub\_esi\_block( 'admin-bar', 'adminbar', $params ); |
| [724](#L724) | } |
| [725](#L725) |  |
| [726](#L726) | /\*\* |
| [727](#L727) | \* Parses the esi input parameters and generates the widget for esi display. |
| [728](#L728) | \* |
| [729](#L729) | \* @access public |
| [730](#L730) | \* @since 1.1.3 |
| [731](#L731) | \* @global $wp\_widget\_factory |
| [732](#L732) | \* @param array $params Input parameters needed to correctly display widget |
| [733](#L733) | \*/ |
| [734](#L734) | public function load\_widget\_block( $params ) { |
| [735](#L735) | // global $wp\_widget\_factory; |
| [736](#L736) | // $widget = $wp\_widget\_factory->widgets[ $params[ self::PARAM\_NAME ] ]; |
| [737](#L737) | $option = $params[ self::PARAM\_INSTANCE ]; |
| [738](#L738) | $option = $option[ Base::OPTION\_NAME ]; |
| [739](#L739) |  |
| [740](#L740) | // Since we only reach here via esi, safe to assume setting exists. |
| [741](#L741) | $ttl = $option[ self::WIDGET\_O\_TTL ]; |
| [742](#L742) | defined( 'LSCWP\_LOG' ) && Debug2::debug( 'ESI widget render: name ' . $params[ self::PARAM\_NAME ] . ', id ' . $params[ self::PARAM\_ID ] . ', ttl ' . $ttl ); |
| [743](#L743) | if ( $ttl == 0 ) { |
| [744](#L744) | Control::set\_nocache( 'ESI Widget time to live set to 0' ); |
| [745](#L745) | } |
| [746](#L746) | else { |
| [747](#L747) | Control::set\_custom\_ttl( $ttl ); |
| [748](#L748) |  |
| [749](#L749) | if ( $option[ self::WIDGET\_O\_ESIENABLE ] == Base::VAL\_ON2 ) { |
| [750](#L750) | Control::set\_private(); |
| [751](#L751) | } |
| [752](#L752) | Control::set\_no\_vary(); |
| [753](#L753) | Tag::add( Tag::TYPE\_WIDGET . $params[ self::PARAM\_ID ] ); |
| [754](#L754) | } |
| [755](#L755) | the\_widget( $params[ self::PARAM\_NAME ], $params[ self::PARAM\_INSTANCE ], $params[ self::PARAM\_ARGS ] ); |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Generates the admin bar for esi display. |
| [760](#L760) | \* |
| [761](#L761) | \* @access public |
| [762](#L762) | \* @since 1.1.3 |
| [763](#L763) | \*/ |
| [764](#L764) | public function load\_admin\_bar\_block( $params ) { |
| [765](#L765) |  |
| [766](#L766) | if ( ! empty( $params[ 'ref' ] ) ) { |
| [767](#L767) | $ref\_qs = parse\_url( $params[ 'ref' ], PHP\_URL\_QUERY ); |
| [768](#L768) | if ( ! empty( $ref\_qs ) ) { |
| [769](#L769) | parse\_str( $ref\_qs, $ref\_qs\_arr ); |
| [770](#L770) |  |
| [771](#L771) | if ( ! empty( $ref\_qs\_arr ) ) { |
| [772](#L772) | foreach ( $ref\_qs\_arr as $k => $v ) { |
| [773](#L773) | $\_GET[ $k ] = $v; |
| [774](#L774) | } |
| [775](#L775) | } |
| [776](#L776) | } |
| [777](#L777) | } |
| [778](#L778) |  |
| [779](#L779) | wp\_admin\_bar\_render(); |
| [780](#L780) | if ( ! $this->conf( Base::O\_ESI\_CACHE\_ADMBAR ) ) { |
| [781](#L781) | Control::set\_nocache( 'build-in set to not cacheable' ); |
| [782](#L782) | } |
| [783](#L783) | else { |
| [784](#L784) | Control::set\_private(); |
| [785](#L785) | Control::set\_no\_vary(); |
| [786](#L786) | } |
| [787](#L787) |  |
| [788](#L788) | defined( 'LSCWP\_LOG' ) && Debug2::debug( 'ESI: adminbar ref: ' . $\_SERVER[ 'REQUEST\_URI' ] ); |
| [789](#L789) | } |
| [790](#L790) |  |
| [791](#L791) |  |
| [792](#L792) | /\*\* |
| [793](#L793) | \* Parses the esi input parameters and generates the comment form for esi display. |
| [794](#L794) | \* |
| [795](#L795) | \* @access public |
| [796](#L796) | \* @since 1.1.3 |
| [797](#L797) | \* @param array $params Input parameters needed to correctly display comment form |
| [798](#L798) | \*/ |
| [799](#L799) | public function load\_comment\_form\_block( $params ) { |
| [800](#L800) | comment\_form( $params[ self::PARAM\_ARGS ], $params[ self::PARAM\_ID ] ); |
| [801](#L801) |  |
| [802](#L802) | if ( ! $this->conf( Base::O\_ESI\_CACHE\_COMMFORM ) ) { |
| [803](#L803) | Control::set\_nocache( 'build-in set to not cacheable' ); |
| [804](#L804) | } |
| [805](#L805) | else { |
| [806](#L806) | // by default comment form is public |
| [807](#L807) | if ( Vary::has\_vary() ) { |
| [808](#L808) | Control::set\_private(); |
| [809](#L809) | Control::set\_no\_vary(); |
| [810](#L810) | } |
| [811](#L811) | } |
| [812](#L812) | } |
| [813](#L813) |  |
| [814](#L814) | /\*\* |
| [815](#L815) | \* Generate nonce for certain action |
| [816](#L816) | \* |
| [817](#L817) | \* @access public |
| [818](#L818) | \* @since 2.6 |
| [819](#L819) | \*/ |
| [820](#L820) | public function load\_nonce\_block( $params ) { |
| [821](#L821) | $action = $params[ 'action' ]; |
| [822](#L822) |  |
| [823](#L823) | Debug2::debug( '[ESI] load\_nonce\_block [action] ' . $action ); |
| [824](#L824) |  |
| [825](#L825) | // set nonce TTL to half day |
| [826](#L826) | Control::set\_custom\_ttl( 43200 ); |
| [827](#L827) |  |
| [828](#L828) | if ( Router::is\_logged\_in() ) { |
| [829](#L829) | Control::set\_private(); |
| [830](#L830) | } |
| [831](#L831) |  |
| [832](#L832) | if ( function\_exists( 'wp\_create\_nonce\_litespeed\_esi' ) ) { |
| [833](#L833) | echo wp\_create\_nonce\_litespeed\_esi( $action ); |
| [834](#L834) | } |
| [835](#L835) | else { |
| [836](#L836) | echo wp\_create\_nonce( $action ); |
| [837](#L837) | } |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | /\*\* |
| [841](#L841) | \* Show original shortcode |
| [842](#L842) | \* |
| [843](#L843) | \* @access public |
| [844](#L844) | \* @since 2.8 |
| [845](#L845) | \*/ |
| [846](#L846) | public function load\_esi\_shortcode( $params ) { |
| [847](#L847) | if ( isset( $params[ 'ttl' ] ) ) { |
| [848](#L848) | if ( ! $params[ 'ttl' ] ) { |
| [849](#L849) | Control::set\_nocache( 'ESI shortcode att ttl=0' ); |
| [850](#L850) | } |
| [851](#L851) | else { |
| [852](#L852) | Control::set\_custom\_ttl( $params[ 'ttl' ] ); |
| [853](#L853) | } |
| [854](#L854) | unset( $params[ 'ttl' ] ); |
| [855](#L855) | } |
| [856](#L856) |  |
| [857](#L857) | // Replace to original shortcode |
| [858](#L858) | $shortcode = $params[ 0 ]; |
| [859](#L859) | $atts\_ori = array(); |
| [860](#L860) | foreach ( $params as $k => $v ) { |
| [861](#L861) | if ( $k === 0 ) { |
| [862](#L862) | continue; |
| [863](#L863) | } |
| [864](#L864) |  |
| [865](#L865) | $atts\_ori[] = is\_string( $k ) ? "$k='" . addslashes( $v ) . "'" : $v; |
| [866](#L866) | } |
| [867](#L867) |  |
| [868](#L868) | Tag::add( Tag::TYPE\_ESI . "esi.$shortcode" ); |
| [869](#L869) |  |
| [870](#L870) | // Output original shortcode final content |
| [871](#L871) | echo do\_shortcode( "[$shortcode " . implode( ' ', $atts\_ori ) . " ]" ); |
| [872](#L872) | } |
| [873](#L873) |  |
| [874](#L874) | /\*\* |
| [875](#L875) | \* Hooked to the comment\_form\_defaults filter. |
| [876](#L876) | \* Stores the default comment form settings. |
| [877](#L877) | \* If sub\_comment\_form\_block is triggered, the output buffer is cleared and an esi block is added. The remaining comment form is also buffered and cleared. |
| [878](#L878) | \* Else there is no need to make the comment form ESI. |
| [879](#L879) | \* |
| [880](#L880) | \* @since 1.1.3 |
| [881](#L881) | \* @access public |
| [882](#L882) | \*/ |
| [883](#L883) | public function register\_comment\_form\_actions( $defaults ) { |
| [884](#L884) | $this->esi\_args = $defaults; |
| [885](#L885) | echo GUI::clean\_wrapper\_begin(); |
| [886](#L886) | add\_filter( 'comment\_form\_submit\_button', array( $this, 'sub\_comment\_form\_btn' ), 1000, 2 ); // To save the params passed in |
| [887](#L887) | add\_action( 'comment\_form', array( $this, 'sub\_comment\_form\_block' ), 1000 ); |
| [888](#L888) | return $defaults; |
| [889](#L889) | } |
| [890](#L890) |  |
| [891](#L891) | /\*\* |
| [892](#L892) | \* Store the args passed in comment\_form for the ESI comment param usage in `$this->sub\_comment\_form\_block()` |
| [893](#L893) | \* |
| [894](#L894) | \* @since  3.4 |
| [895](#L895) | \* @access public |
| [896](#L896) | \*/ |
| [897](#L897) | public function sub\_comment\_form\_btn( $unused, $args ) { |
| [898](#L898) | if ( empty( $args ) || empty( $this->esi\_args ) ) { |
| [899](#L899) | Debug2::debug( 'comment form args empty?' ); |
| [900](#L900) | return $unused; |
| [901](#L901) | } |
| [902](#L902) | $esi\_args = array(); |
| [903](#L903) |  |
| [904](#L904) | // compare current args with default ones |
| [905](#L905) | foreach ( $args as $k => $v ) { |
| [906](#L906) | if ( ! isset( $this->esi\_args[ $k ] ) ) { |
| [907](#L907) | $esi\_args[ $k ] = $v; |
| [908](#L908) | } |
| [909](#L909) | elseif ( is\_array( $v ) ) { |
| [910](#L910) | $diff = array\_diff\_assoc( $v, $this->esi\_args[ $k ] ); |
| [911](#L911) | if ( ! empty( $diff ) ) { |
| [912](#L912) | $esi\_args[ $k ] = $diff; |
| [913](#L913) | } |
| [914](#L914) | } |
| [915](#L915) | elseif ( $v !== $this->esi\_args[ $k ] ) { |
| [916](#L916) | $esi\_args[ $k ] = $v; |
| [917](#L917) | } |
| [918](#L918) | } |
| [919](#L919) |  |
| [920](#L920) | $this->esi\_args = $esi\_args; |
| [921](#L921) |  |
| [922](#L922) | return $unused; |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | /\*\* |
| [926](#L926) | \* Hooked to the comment\_form\_submit\_button filter. |
| [927](#L927) | \* |
| [928](#L928) | \* This method will compare the used comment form args against the default args. The difference will be passed to the esi request. |
| [929](#L929) | \* |
| [930](#L930) | \* @access public |
| [931](#L931) | \* @since 1.1.3 |
| [932](#L932) | \*/ |
| [933](#L933) | public function sub\_comment\_form\_block( $post\_id ) { |
| [934](#L934) | echo GUI::clean\_wrapper\_end(); |
| [935](#L935) | $params = array( |
| [936](#L936) | self::PARAM\_ID => $post\_id, |
| [937](#L937) | self::PARAM\_ARGS => $this->esi\_args, |
| [938](#L938) | ); |
| [939](#L939) |  |
| [940](#L940) | echo $this->sub\_esi\_block( 'comment-form', 'comment form', $params ); |
| [941](#L941) | echo GUI::clean\_wrapper\_begin(); |
| [942](#L942) | add\_action( 'comment\_form\_after', array( $this, 'comment\_form\_sub\_clean' ) ); |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) | /\*\* |
| [946](#L946) | \* Hooked to the comment\_form\_after action. |
| [947](#L947) | \* Cleans up the remaining comment form output. |
| [948](#L948) | \* |
| [949](#L949) | \* @since 1.1.3 |
| [950](#L950) | \* @access public |
| [951](#L951) | \*/ |
| [952](#L952) | public function comment\_form\_sub\_clean() { |
| [953](#L953) | echo GUI::clean\_wrapper\_end(); |
| [954](#L954) | } |
| [955](#L955) |  |
| [956](#L956) | /\*\* |
| [957](#L957) | \* Replace preseved blocks |
| [958](#L958) | \* |
| [959](#L959) | \* @since  2.6 |
| [960](#L960) | \* @access public |
| [961](#L961) | \*/ |
| [962](#L962) | public function finalize( $buffer ) { |
| [963](#L963) | // Prepend combo esi block |
| [964](#L964) | if ( self::$\_combine\_ids ) { |
| [965](#L965) | Debug2::debug( '[ESI] 🍔 Enabled combo' ); |
| [966](#L966) | $esi\_block = $this->sub\_esi\_block( self::COMBO, '\_\_COMBINE\_MAIN\_\_', array(), 'no-cache', true ); |
| [967](#L967) | $buffer = $esi\_block . $buffer; |
| [968](#L968) | } |
| [969](#L969) |  |
| [970](#L970) | // Bypass if no preserved list to be replaced |
| [971](#L971) | if ( ! $this->\_esi\_preserve\_list ) { |
| [972](#L972) | return $buffer; |
| [973](#L973) | } |
| [974](#L974) |  |
| [975](#L975) | $keys = array\_keys( $this->\_esi\_preserve\_list ); |
| [976](#L976) |  |
| [977](#L977) | Debug2::debug( '[ESI] replacing preserved blocks', $keys ); |
| [978](#L978) |  |
| [979](#L979) | $buffer = str\_replace( $keys, $this->\_esi\_preserve\_list, $buffer ); |
| [980](#L980) |  |
| [981](#L981) | return $buffer; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | /\*\* |
| [985](#L985) | \* Check if the content contains preserved list or not |
| [986](#L986) | \* |
| [987](#L987) | \* @since  3.3 |
| [988](#L988) | \*/ |
| [989](#L989) | public function contain\_preserve\_esi( $content ) { |
| [990](#L990) | $hit\_list = array(); |
| [991](#L991) | foreach ( $this->\_esi\_preserve\_list as $k => $v ) { |
| [992](#L992) | if ( strpos( $content, '"' . $k . '"' ) !== false ) { |
| [993](#L993) | $hit\_list[] = '"' . $k . '"'; |
| [994](#L994) | } |
| [995](#L995) | if ( strpos( $content, "'" . $k . "'" ) !== false ) { |
| [996](#L996) | $hit\_list[] = "'" . $k . "'"; |
| [997](#L997) | } |
| [998](#L998) | } |
| [999](#L999) | return $hit\_list; |
| [1000](#L1000) | } |
| [1001](#L1001) |  |
| [1002](#L1002) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/litespeed-cache/tags/5.5.1/src/esi.cls.php?format=txt)
* [Original Format](/export/3222754/litespeed-cache/tags/5.5.1/src/esi.cls.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


