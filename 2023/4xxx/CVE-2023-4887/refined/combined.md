=== Content from plugins.trac.wordpress.org_96243438_20250114_224812.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fintergeo-maps%2Ftags%2F2.3.2%2Findex.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/intergeo-maps/tags/2.3.2/index.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/intergeo-maps/tags/2.3.2/index.php)

---

# [source:](/browser?order=name "Go to repository root") [intergeo-maps](/browser/intergeo-maps?order=name "View intergeo-maps")/[tags](/browser/intergeo-maps/tags?order=name "View tags")/[2.3.2](/browser/intergeo-maps/tags/2.3.2?order=name "View 2.3.2")/[index.php](/browser/intergeo-maps/tags/2.3.2/index.php?order=name "View index.php")

View diff against:

View revision:

| [Last change](/changeset/2192510/intergeo-maps/tags/2.3.2/index.php "View differences") on this file was [2192510](/changeset/2192510/ "View changeset 2192510"), checked in by codeinwp, [5 years ago](/timeline?from=2019-11-14T08%3A28%3A52Z&precision=second "See timeline at 11/14/2019 08:28:52 AM") |
| --- |
| Release v2.3.2 |
| **File size:** 47.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* |
| [4](#L4) | \* Plugin Name: Intergeo - Google Maps Plugin |
| [5](#L5) | \* Plugin URI: http://themeisle.com/plugins/intergeo-maps-lite/ |
| [6](#L6) | \* Description: A simple, easy and quite powerful Google Map tool to create, manage and embed custom Google Maps into your WordPress posts and pages. The plugin allows you to deeply customize look and feel of a map, add overlays like markers, rectangles, circles, polylines and polygons to your map. It could even be integraded with your Google Adsense account and show ad on your maps. |
| [7](#L7) | \* Version: 2.3.2 |
| [8](#L8) | \* Author: Themeisle |
| [9](#L9) | \* Author URI: http://themeisle.com |
| [10](#L10) | \* License: GPL v2.0 or later |
| [11](#L11) | \* License URI: http://www.opensource.org/licenses/gpl-license.php |
| [12](#L12) | \* Text Domain: intergeo-maps |
| [13](#L13) | \* Domain Path: /languages |
| [14](#L14) | \* Requires License: no |
| [15](#L15) | \* WordPress Available: yes |
| [16](#L16) | \*/ |
| [17](#L17) |  |
| [18](#L18) | define( 'INTERGEO\_PLUGIN\_NAME', 'intergeo' ); |
| [19](#L19) | define( 'TI\_INTERGEO\_PLUGIN\_NAME', 'intergeo\_maps' ); |
| [20](#L20) | define( 'INTERGEO\_VERSION', '2.3.2' ); |
| [21](#L21) | define( 'INTERGEO\_ABSPATH', dirname( \_\_FILE\_\_ ) ); |
| [22](#L22) | define( 'INTERGEO\_ABSURL', plugins\_url( '/', \_\_FILE\_\_ ) ); |
| [23](#L23) | defined( 'WPLANG' ) || define( 'WPLANG', '' ); |
| [24](#L24) | define( 'INTERGEO\_DIR', trailingslashit( plugin\_dir\_path( \_\_FILE\_\_ ) ) ); |
| [25](#L25) | define( 'INTERGEO\_DIRNAME', dirname( plugin\_basename( \_\_FILE\_\_ ) ) ); |
| [26](#L26) | define( 'INTERGEO\_DEBUG', false ); |
| [27](#L27) |  |
| [28](#L28) | add\_filter( 'themeisle\_sdk\_products', 'intergeo\_register\_sdk', 10, 1 ); |
| [29](#L29) | /\*\* |
| [30](#L30) | \* Add intergeo in sdk. |
| [31](#L31) | \* |
| [32](#L32) | \* @param array $products Array of products. |
| [33](#L33) | \* |
| [34](#L34) | \* @return array Products array. |
| [35](#L35) | \*/ |
| [36](#L36) | function intergeo\_register\_sdk( $products ) { |
| [37](#L37) | $products[] = \_\_FILE\_\_; |
| [38](#L38) |  |
| [39](#L39) | return $products; |
| [40](#L40) | } |
| [41](#L41) |  |
| [42](#L42) | if ( ! defined( 'INTERGEO\_PRO\_URL' ) ) { |
| [43](#L43) | define( 'INTERGEO\_PRO\_URL', 'http://themeisle.com/plugins/intergeo-maps/' ); |
| [44](#L44) | } |
| [45](#L45) |  |
| [46](#L46) | add\_filter( 'plugin\_action\_links', 'intergeo\_action\_links', 10, 2 ); |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Render plugin actions links. |
| [49](#L49) | \* |
| [50](#L50) | \* @param array  $links Array of actual links. |
| [51](#L51) | \* @param string $file Plugin file. |
| [52](#L52) | \* |
| [53](#L53) | \* @return mixed Plugin table links. |
| [54](#L54) | \*/ |
| [55](#L55) | function intergeo\_action\_links( $links, $file ) { |
| [56](#L56) | if ( $file == plugin\_basename( \_\_FILE\_\_ ) ) { |
| [57](#L57) | array\_unshift( |
| [58](#L58) | $links, |
| [59](#L59) | sprintf( '<a href="%s">%s</a>', add\_query\_arg( 'page', INTERGEO\_PLUGIN\_NAME, admin\_url( 'upload.php' ) ), \_\_( 'Maps', 'intergeo-maps' ) ), |
| [60](#L60) | sprintf( '<a href="%s">%s</a>', intergeo\_settings\_url(), \_\_( 'Settings', 'intergeo-maps' ) ) |
| [61](#L61) | ); |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | return $links; |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | add\_action( 'admin\_init', 'intergeo\_admin\_init' ); |
| [68](#L68) | /\*\* |
| [69](#L69) | \* Init plugin logic. |
| [70](#L70) | \*/ |
| [71](#L71) | function intergeo\_admin\_init() { |
| [72](#L72) | load\_plugin\_textdomain( INTERGEO\_PLUGIN\_NAME, false, dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/' ); |
| [73](#L73) | register\_post\_type( INTERGEO\_PLUGIN\_NAME ); |
| [74](#L74) | } |
| [75](#L75) |  |
| [76](#L76) | add\_action( 'wp\_enqueue\_scripts', 'intergeo\_frontend\_enqueue\_scripts' ); |
| [77](#L77) | /\*\* |
| [78](#L78) | \* Load frontend assets. |
| [79](#L79) | \*/ |
| [80](#L80) | function intergeo\_frontend\_enqueue\_scripts() { |
| [81](#L81) | wp\_register\_style( 'intergeo-frontend', INTERGEO\_ABSURL . 'css/frontend.css', array(), INTERGEO\_VERSION ); |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | add\_action( 'plugins\_loaded', 'intergeo\_i18n' ); |
| [85](#L85) | /\*\* |
| [86](#L86) | \* Load locales. |
| [87](#L87) | \*/ |
| [88](#L88) | function intergeo\_i18n() { |
| [89](#L89) | $pluginDirName = dirname( plugin\_basename( \_\_FILE\_\_ ) ); |
| [90](#L90) | $domain        = INTERGEO\_PLUGIN\_NAME; |
| [91](#L91) | $locale        = apply\_filters( 'plugin\_locale', get\_locale(), $domain ); |
| [92](#L92) | load\_textdomain( $domain, WP\_LANG\_DIR . '/' . $pluginDirName . '/' . $domain . '-' . $locale . '.mo' ); |
| [93](#L93) | load\_plugin\_textdomain( $domain, '', $pluginDirName . '/languages/' ); |
| [94](#L94) | } |
| [95](#L95) |  |
| [96](#L96) | /\*\* |
| [97](#L97) | \* Init settings field. |
| [98](#L98) | \*/ |
| [99](#L99) | function intergeo\_settings() { |
| [100](#L100) | if ( isset( $\_POST['sb-intergeo'] ) && wp\_verify\_nonce( $\_POST['intergeo-nonce'], 'intergeo-settings' ) ) { |
| [101](#L101) | update\_option( 'intergeo\_map\_api\_key', sanitize\_text\_field( $\_POST['intergeo\_map\_api\_key'] ) ); |
| [102](#L102) | if ( intergeo\_is\_developer() ) { |
| [103](#L103) | update\_option( 'intergeo\_adsense\_publisher\_id', sanitize\_text\_field( $\_POST['intergeo\_adsense\_publisher\_id'] ) ); |
| [104](#L104) | } |
| [105](#L105) | } |
| [106](#L106) | echo '<div class="wrap"> |
| [107](#L107) | <h2> |
| [108](#L108) | <div id="intergeo\_lbrr\_ttl">Inter<span style="color:#4067dc">g</span><span style="color:#e21b31">e</span><span style="color:#fcaa08">o</span>' . \_\_( 'Maps Settings', 'intergeo-maps' ) . '</div> '; |
| [109](#L109) | echo '<a   href="' . admin\_url( 'upload.php?page=' . INTERGEO\_PLUGIN\_NAME ) . '" class="add-new-h2">' . \_\_( 'Create New Map', 'intergeo-maps' ) . '</a>'; |
| [110](#L110) |  |
| [111](#L111) | echo '<a id="intergeo\_lbrr\_settings" href="' . admin\_url( 'upload.php?page=' . INTERGEO\_PLUGIN\_NAME ) . '" class="add-new-h2">' . \_\_( 'View Existing Maps', 'intergeo-maps' ) . '</a> |
| [112](#L112) | </h2>'; |
| [113](#L113) | echo '<div class="intergeo\_settings">'; |
| [114](#L114) | echo '<div id="intergeo\_sidebar" class="intergeo\_sidebar\_right">'; |
| [115](#L115) | do\_action( 'intergeo\_render\_subscribe\_box' ); |
| [116](#L116) | echo '</div>'; |
| [117](#L117) | echo '<div class="intergeo\_sidebar\_left">'; |
| [118](#L118) | echo "<form method='post' action=''>"; |
| [119](#L119) | register\_setting( 'intergeo', 'intergeo-settings-map-api-key', 'trim' ); |
| [120](#L120) | add\_settings\_section( 'intergeo-settings-maps', \_\_( 'Intergeo Google Maps', 'intergeo-maps' ), 'intergeo\_settings\_init\_map', INTERGEO\_PLUGIN\_NAME ); |
| [121](#L121) | add\_settings\_field( |
| [122](#L122) | 'intergeo\_map\_api\_key', \_\_( 'Maps API Key', 'intergeo-maps' ), 'intergeo\_settings\_print\_field', INTERGEO\_PLUGIN\_NAME, 'intergeo-settings-maps', array( |
| [123](#L123) | '<input type="text" name="%s" value="%s" class="regular-text">', |
| [124](#L124) | 'intergeo\_map\_api\_key', |
| [125](#L125) | esc\_attr( get\_option( 'intergeo\_map\_api\_key' ) ), |
| [126](#L126) | ) |
| [127](#L127) | ); |
| [128](#L128) |  |
| [129](#L129) | if ( intergeo\_is\_developer() ) { |
| [130](#L130) | register\_setting( 'intergeo', 'intergeo\_adsense\_publisher\_id', 'trim' ); |
| [131](#L131) | add\_settings\_section( 'intergeo-settings-adsense', \_\_( 'Intergeo Google Maps AdSense Integration', 'intergeo-maps' ), 'intergeo\_settings\_init\_adsense', INTERGEO\_PLUGIN\_NAME ); |
| [132](#L132) | add\_settings\_field( |
| [133](#L133) | 'intergeo\_adsense\_publisher\_id', \_\_( 'AdSense Publisher Id', 'intergeo-maps' ), 'intergeo\_settings\_print\_field', INTERGEO\_PLUGIN\_NAME, 'intergeo-settings-adsense', array( |
| [134](#L134) | '<input type="text" name="%s" value="%s" class="regular-text">', |
| [135](#L135) | 'intergeo\_adsense\_publisher\_id', |
| [136](#L136) | esc\_attr( get\_option( 'intergeo\_adsense\_publisher\_id' ) ), |
| [137](#L137) | ) |
| [138](#L138) | ); |
| [139](#L139) | } |
| [140](#L140) | do\_settings\_sections( INTERGEO\_PLUGIN\_NAME ); |
| [141](#L141) | submit\_button( \_\_( 'Save Changes', 'intergeo-maps' ), 'primary', 'sb-intergeo' ); |
| [142](#L142) | wp\_nonce\_field( 'intergeo-settings', 'intergeo-nonce' ); |
| [143](#L143) | echo '</form>'; |
| [144](#L144) | echo '</div>'; |
| [145](#L145) | echo '</div>'; |
| [146](#L146) | echo '</div>'; |
| [147](#L147) | } |
| [148](#L148) |  |
| [149](#L149) | /\*\* |
| [150](#L150) | \* Init map field. |
| [151](#L151) | \*/ |
| [152](#L152) | function intergeo\_settings\_init\_map() { |
| [153](#L153) | ?><p> |
| [154](#L154) | <?php |
| [155](#L155) | printf( esc\_html\_\_( ' Below shows how to find your API Key, after retrieving your key add it to the "Maps API Key" input box.', 'intergeo-maps' ) ); |
| [156](#L156) | ?> |
| [157](#L157) | </p> |
| [158](#L158) | <iframe width="560" height="315" src="https://www.youtube.com/embed/rqucit5YHNk?start=030" frameborder="0" |
| [159](#L159) | allowfullscreen></iframe> |
| [160](#L160) | <?php |
| [161](#L161) | } |
| [162](#L162) |  |
| [163](#L163) | /\*\* |
| [164](#L164) | \* Init adsense field. |
| [165](#L165) | \*/ |
| [166](#L166) | function intergeo\_settings\_init\_adsense() { |
| [167](#L167) |  |
| [168](#L168) | if ( intergeo\_is\_developer() ) { |
| [169](#L169) | ?> |
| [170](#L170) | <p> |
| [171](#L171) | <?php |
| [172](#L172) | printf( esc\_html\_\_( "Adding display ads to your map requires that you have an AdSense account enabled for AdSense for Content. If you don't yet have an AdSense account, %1\$ssign up%3\$s for one. Once you have done so (or if you already have an account) make sure you've also enabled the account with %2\$sAdSense for Content%3\$s.", 'intergeo-maps' ), '<a href="https://www.google.com/adsense/support/bin/answer.py?answer=10162" target="\_blank">', '<a href="https://www.google.com/adsense/support/bin/answer.py?hl=en&answer=17470" target="\_blank">', '</a>' ) |
| [173](#L173) | ?> |
| [174](#L174) | </p><p> |
| [175](#L175) | <?php |
| [176](#L176) | esc\_html\_e( 'Once you have an Adsense for Content account, you will have received an AdSense for Content (AFC) publisher ID. This publisher ID is used to link any advertising shown to your AdSense account, allowing you to share in advertising revenue when a user clicks on one of the ads shown on your maps.', 'intergeo-maps' ) |
| [177](#L177) | ?> |
| [178](#L178) | </p> |
| [179](#L179) | <?php |
| [180](#L180) | } |
| [181](#L181) | } |
| [182](#L182) |  |
| [183](#L183) | /\*\* |
| [184](#L184) | \* |
| [185](#L185) | \* Print settings field. |
| [186](#L186) | \* |
| [187](#L187) | \* @param array $args Settings array. |
| [188](#L188) | \*/ |
| [189](#L189) | function intergeo\_settings\_print\_field( array $args ) { |
| [190](#L190) | vprintf( array\_shift( $args ), $args ); |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | /\*\* |
| [194](#L194) | \* Load libraries assets. |
| [195](#L195) | \* |
| [196](#L196) | \* @param bool $libraries LIbraries to load. |
| [197](#L197) | \*/ |
| [198](#L198) | function intergeo\_enqueue\_google\_maps\_script( $libraries = false ) { |
| [199](#L199) | global $wp\_scripts; |
| [200](#L200) | if ( is\_array( $libraries ) ) { |
| [201](#L201) | $libraries = implode( ',', $libraries ); |
| [202](#L202) | } |
| [203](#L203) | if ( wp\_script\_is( 'google-maps-v3' ) ) { |
| [204](#L204) | $params = array(); |
| [205](#L205) | $arr    = explode( '?', $wp\_scripts->registered['google-maps-v3']->src ); |
| [206](#L206) | parse\_str( end( $arr ), $params ); |
| [207](#L207) | $params['libraries']                           = implode( ',', array\_unique( array\_merge( isset( $params['libraries'] ) ? explode( ',', $params['libraries'] ) : array(), explode( ',', $libraries ) ) ) ); |
| [208](#L208) | $wp\_scripts->registered['google-maps-v3']->src = '//maps.googleapis.com/maps/api/js?' . http\_build\_query( $params ); |
| [209](#L209) |  |
| [210](#L210) | } else { |
| [211](#L211) | $lang   = explode( '\_', WPLANG ? WPLANG : 'en\_US' ); |
| [212](#L212) | $params = array( |
| [213](#L213) | 'region'   => isset( $lang[1] ) ? $lang[1] : 'US', |
| [214](#L214) | 'language' => $lang[0], |
| [215](#L215) | ); |
| [216](#L216) | if ( ! empty( $libraries ) ) { |
| [217](#L217) | $params['libraries'] = $libraries; |
| [218](#L218) | } |
| [219](#L219) | $api\_key = get\_option( 'intergeo\_map\_api\_key' ); |
| [220](#L220) | if ( ! empty( $api\_key ) ) { |
| [221](#L221) | $params['key'] = $api\_key; |
| [222](#L222) | } |
| [223](#L223) | if ( wp\_script\_is( 'google-maps' ) ) { |
| [224](#L224) | wp\_dequeue\_script( 'google-maps' ); |
| [225](#L225) | } |
| [226](#L226) | wp\_enqueue\_script( 'google-maps-v3', '//maps.googleapis.com/maps/api/js?' . http\_build\_query( $params ), array(), null ); |
| [227](#L227) | } |
| [228](#L228) | } |
| [229](#L229) |  |
| [230](#L230) | /\*\* |
| [231](#L231) | \* Check libraries to load. |
| [232](#L232) | \* |
| [233](#L233) | \* @param array $json Settings. |
| [234](#L234) | \* @param array $libraries Libraries. |
| [235](#L235) | \* |
| [236](#L236) | \* @return array Check libraries to load. |
| [237](#L237) | \*/ |
| [238](#L238) | function intergeo\_check\_libraries( $json, $libraries = array() ) { |
| [239](#L239) | if ( isset( $json['layer']['adsense'] ) && $json['layer']['adsense'] && ! in\_array( 'adsense', $libraries ) ) { |
| [240](#L240) | $libraries[] = 'adsense'; |
| [241](#L241) | } |
| [242](#L242) | if ( isset( $json['layer']['panoramio'] ) && $json['layer']['panoramio'] && ! in\_array( 'panoramio', $libraries ) ) { |
| [243](#L243) | $libraries[] = 'panoramio'; |
| [244](#L244) | } |
| [245](#L245) | if ( ( isset( $json['layer']['weather'] ) && $json['layer']['weather'] ) || ( isset( $json['layer']['cloud'] ) && $json['layer']['cloud'] ) ) { |
| [246](#L246) | if ( ! in\_array( 'weather', $libraries ) ) { |
| [247](#L247) | $libraries[] = 'weather'; |
| [248](#L248) | } |
| [249](#L249) | } |
| [250](#L250) |  |
| [251](#L251) | return $libraries; |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) | /\*\* |
| [255](#L255) | \* Encode post id. |
| [256](#L256) | \* |
| [257](#L257) | \* @param int $id post id. |
| [258](#L258) | \* |
| [259](#L259) | \* @return string Encoded string. |
| [260](#L260) | \*/ |
| [261](#L261) | function intergeo\_encode( $id ) { |
| [262](#L262) | return strrev( rtrim( call\_user\_func( 'base64\_' . 'encode', $id ), '=' ) ); |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | /\*\* |
| [266](#L266) | \* Return decoded int value. |
| [267](#L267) | \* |
| [268](#L268) | \* @param string $code Encoded id. |
| [269](#L269) | \* |
| [270](#L270) | \* @return int Return int id. |
| [271](#L271) | \*/ |
| [272](#L272) | function intergeo\_decode( $code ) { |
| [273](#L273) | return intval( call\_user\_func( 'base64' . '\_decode', strrev( $code ) ) ); |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | add\_filter( 'media\_upload\_tabs', 'intergeo\_media\_upload\_tabs' ); |
| [277](#L277) | /\*\* |
| [278](#L278) | \* Alter the media tabs and insert the intergeo one. |
| [279](#L279) | \* |
| [280](#L280) | \* @param array $tabs The actual tabs. |
| [281](#L281) | \* |
| [282](#L282) | \* @return mixed Array of tabs. |
| [283](#L283) | \*/ |
| [284](#L284) | function intergeo\_media\_upload\_tabs( $tabs ) { |
| [285](#L285) | $tabs['intergeo\_map'] = \_\_( 'Intergeo Maps', 'intergeo-maps' ); |
| [286](#L286) |  |
| [287](#L287) | return $tabs; |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | add\_action( 'media\_upload\_intergeo\_map', 'intergeo\_map\_popup\_init' ); |
| [291](#L291) | /\*\* |
| [292](#L292) | \* Routine to show the popup. |
| [293](#L293) | \*/ |
| [294](#L294) | function intergeo\_map\_popup\_init() { |
| [295](#L295) | $post\_id        = filter\_input( |
| [296](#L296) | INPUT\_GET, 'post\_id', FILTER\_VALIDATE\_INT, array( |
| [297](#L297) | 'options' => array( |
| [298](#L298) | 'min\_range' => 1, |
| [299](#L299) | ), |
| [300](#L300) | ) |
| [301](#L301) | ); |
| [302](#L302) | $map\_id         = filter\_input( INPUT\_GET, 'map' ); |
| [303](#L303) | $send\_to\_editor = false; |
| [304](#L304) | if ( $\_SERVER['REQUEST\_METHOD'] == 'POST' ) { |
| [305](#L305) | $shortcode = intergeo\_save\_map( $map\_id, $post\_id ); |
| [306](#L306) | if ( $post\_id ) { |
| [307](#L307) | $send\_to\_editor = $shortcode; |
| [308](#L308) | } else { |
| [309](#L309) | $args = array( |
| [310](#L310) | 'page'    => INTERGEO\_PLUGIN\_NAME, |
| [311](#L311) | 'updated' => current\_time( 'mysql' ), |
| [312](#L312) | ); |
| [313](#L313) | wp\_redirect( add\_query\_arg( $args, admin\_url( 'upload.php' ) ) ); |
| [314](#L314) | exit; |
| [315](#L315) | } |
| [316](#L316) | } |
| [317](#L317) | intergeo\_enqueue\_google\_maps\_script( 'adsense,panoramio,weather,drawing,places' ); |
| [318](#L318) | wp\_enqueue\_script( 'jquery-ddslick', INTERGEO\_ABSURL . 'js/jquery.ddslick.min.js', array( 'jquery' ) ); |
| [319](#L319) | wp\_enqueue\_script( |
| [320](#L320) | 'intergeo-editor', INTERGEO\_ABSURL . 'js/editor.js', array( |
| [321](#L321) | 'jquery-ddslick', |
| [322](#L322) | 'wp-color-picker', |
| [323](#L323) | 'google-maps-v3', |
| [324](#L324) | ), time() |
| [325](#L325) | ); |
| [326](#L326) | wp\_localize\_script( |
| [327](#L327) | 'intergeo-editor', 'intergeo\_options', array( |
| [328](#L328) | 'send\_to\_editor' => $send\_to\_editor, |
| [329](#L329) | 'is\_pro'         => intergeo\_is\_personal() ? 'yes' : 'no', |
| [330](#L330) | 'adsense'        => array( |
| [331](#L331) | 'publisher\_id' => get\_option( 'intergeo\_adsense\_publisher\_id' ), |
| [332](#L332) | ), |
| [333](#L333) | 'ajaxurl'        => admin\_url( 'admin-ajax.php' ), |
| [334](#L334) | 'nonce'          => wp\_create\_nonce( 'editor\_popup' . filter\_input( INPUT\_SERVER, 'REMOTE\_ADDR', FILTER\_VALIDATE\_IP ) ), |
| [335](#L335) | 'l10n'           => array( |
| [336](#L336) | 'marker' => \_\_( 'marker', 'intergeo-maps' ), |
| [337](#L337) | 'error'  => array( |
| [338](#L338) | 'style'      => \_\_( 'Styles are broken. Please, fix it and try again.', 'intergeo-maps' ), |
| [339](#L339) | 'directions' => \_\_( 'Directions were not found. Error: ', 'intergeo-maps' ), |
| [340](#L340) | 'shortcode' => \_\_( 'Unable to render shortcode properly. Error: ', 'intergeo-maps' ), |
| [341](#L341) | ), |
| [342](#L342) | ), |
| [343](#L343) | 'show\_error'    => is\_user\_logged\_in() ? 1 : 0, |
| [344](#L344) | ) |
| [345](#L345) | ); |
| [346](#L346) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [347](#L347) | wp\_enqueue\_style( 'intergeo-editor', INTERGEO\_ABSURL . 'css/editor.css', array(), INTERGEO\_VERSION ); |
| [348](#L348) | do\_action( |
| [349](#L349) | 'intergeo\_enqueue\_assets', array( 'intergeo-editor' ), array( |
| [350](#L350) | 'mapID' => $map\_id, |
| [351](#L351) | ) |
| [352](#L352) | ); |
| [353](#L353) |  |
| [354](#L354) | wp\_iframe( 'intergeo\_iframe', $post\_id, $map\_id ); |
| [355](#L355) | } |
| [356](#L356) |  |
| [357](#L357) | /\*\* |
| [358](#L358) | \* Render the intergeo form iframe. |
| [359](#L359) | \* |
| [360](#L360) | \* @param int $post\_id The post id. |
| [361](#L361) | \* @param int $map\_id The map id. |
| [362](#L362) | \*/ |
| [363](#L363) | function intergeo\_iframe( $post\_id = false, $map\_id = false ) { |
| [364](#L364) | $publisher\_id    = trim( get\_option( 'intergeo\_adsense\_publisher\_id' ) ); |
| [365](#L365) | $show\_map\_center = get\_option( 'intergeo\_show\_map\_center', true ); |
| [366](#L366) | $submit\_text     = \_\_( 'Insert into post', 'intergeo-maps' ); |
| [367](#L367) | if ( ! $post\_id ) { |
| [368](#L368) | $submit\_text = \_\_( 'Create the map', 'intergeo-maps' ); |
| [369](#L369) | } |
| [370](#L370) | $copy = false; |
| [371](#L371) | if ( ! $map\_id ) { |
| [372](#L372) | $copy   = true; |
| [373](#L373) | $map\_id = filter\_input( INPUT\_GET, 'copy' ); |
| [374](#L374) | } |
| [375](#L375) | $json = array(); |
| [376](#L376) | if ( $map\_id ) { |
| [377](#L377) | $map = get\_post( intergeo\_decode( $map\_id ) ); |
| [378](#L378) | if ( $map->post\_type == INTERGEO\_PLUGIN\_NAME ) { |
| [379](#L379) | $json = json\_decode( $map->post\_content, true ); |
| [380](#L380) | if ( ! $copy ) { |
| [381](#L381) | $submit\_text = \_\_( 'Update the map', 'intergeo-maps' ); |
| [382](#L382) | } |
| [383](#L383) | } |
| [384](#L384) | } |
| [385](#L385) | require INTERGEO\_ABSPATH . '/templates/iframe/form.php'; |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | /\*\* |
| [389](#L389) | \* Validate a value inside a haystack. |
| [390](#L390) | \* |
| [391](#L391) | \* @param string $value Value to validate. |
| [392](#L392) | \* @param array  $array Haystack to check in. |
| [393](#L393) | \* |
| [394](#L394) | \* @return null|string Validated value. |
| [395](#L395) | \*/ |
| [396](#L396) | function intergeo\_filter\_value( $value, $array ) { |
| [397](#L397) | $value = strtoupper( $value ); |
| [398](#L398) |  |
| [399](#L399) | return ! in\_array( $value, $array ) ? null : $value; |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | /\*\* |
| [403](#L403) | \* Validate position. |
| [404](#L404) | \* |
| [405](#L405) | \* @param string $position The position to filter. |
| [406](#L406) | \* |
| [407](#L407) | \* @return null|string Position filtered |
| [408](#L408) | \*/ |
| [409](#L409) | function intergeo\_filter\_position( $position ) { |
| [410](#L410) | return intergeo\_filter\_value( |
| [411](#L411) | $position, array( |
| [412](#L412) | 'TOP\_LEFT', |
| [413](#L413) | 'TOP\_CENTER', |
| [414](#L414) | 'TOP\_RIGHT', |
| [415](#L415) | 'RIGHT\_TOP', |
| [416](#L416) | 'RIGHT\_CENTER', |
| [417](#L417) | 'RIGHT\_BOTTOM', |
| [418](#L418) | 'BOTTOM\_RIGHT', |
| [419](#L419) | 'BOTTOM\_CENTER', |
| [420](#L420) | 'BOTTOM\_LEFT', |
| [421](#L421) | 'LEFT\_BOTTOM', |
| [422](#L422) | 'LEFT\_CENTER', |
| [423](#L423) | 'LEFT\_TOP', |
| [424](#L424) | ) |
| [425](#L425) | ); |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | /\*\* |
| [429](#L429) | \* Validate the map type. |
| [430](#L430) | \* |
| [431](#L431) | \* @param string $type Type of the map. |
| [432](#L432) | \* |
| [433](#L433) | \* @return null|string Either the map type is valid or not. |
| [434](#L434) | \*/ |
| [435](#L435) | function intergeo\_filter\_map\_type( $type ) { |
| [436](#L436) | return intergeo\_filter\_value( $type, array( 'ROADMAP', 'TERRAIN', 'SATELLITE', 'HYBRID' ) ); |
| [437](#L437) | } |
| [438](#L438) |  |
| [439](#L439) | /\*\* |
| [440](#L440) | \* Validate the map style. |
| [441](#L441) | \* |
| [442](#L442) | \* @param string $style Style to check. . |
| [443](#L443) | \* |
| [444](#L444) | \* @return null|string the valid style. |
| [445](#L445) | \*/ |
| [446](#L446) | function intergeo\_filter\_map\_type\_style( $style ) { |
| [447](#L447) | return intergeo\_filter\_value( $style, array( 'DEFAULT', 'DROPDOWN\_MENU', 'HORIZONTAL\_BAR' ) ); |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) | /\*\* |
| [451](#L451) | \* Validate zoom style. |
| [452](#L452) | \* |
| [453](#L453) | \* @param string $style Filter zoom style. |
| [454](#L454) | \* |
| [455](#L455) | \* @return null|string Filtered value. |
| [456](#L456) | \*/ |
| [457](#L457) | function intergeo\_filter\_zoom\_style( $style ) { |
| [458](#L458) | return intergeo\_filter\_value( $style, array( 'DEFAULT', 'SMALL', 'LARGE' ) ); |
| [459](#L459) | } |
| [460](#L460) |  |
| [461](#L461) | /\*\* |
| [462](#L462) | \* Validate unit of wind. |
| [463](#L463) | \* |
| [464](#L464) | \* @param string $unit Unit to valide. |
| [465](#L465) | \* |
| [466](#L466) | \* @return null|string Filtered value. |
| [467](#L467) | \*/ |
| [468](#L468) | function intergeo\_filter\_wind\_speed\_units( $unit ) { |
| [469](#L469) | return intergeo\_filter\_value( $unit, array( 'KILOMETERS\_PER\_HOUR', 'METERS\_PER\_SECOND', 'MILES\_PER\_HOUR' ) ); |
| [470](#L470) | } |
| [471](#L471) |  |
| [472](#L472) | /\*\* |
| [473](#L473) | \* Validate unit of temperature. |
| [474](#L474) | \* |
| [475](#L475) | \* @param string $unit Unit to validate. |
| [476](#L476) | \* |
| [477](#L477) | \* @return null|string Filtered value. |
| [478](#L478) | \*/ |
| [479](#L479) | function intergeo\_filter\_temperature\_units( $unit ) { |
| [480](#L480) | return intergeo\_filter\_value( $unit, array( 'CELSIUS', 'FAHRENHEIT' ) ); |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | /\*\* |
| [484](#L484) | \* Filter the format. |
| [485](#L485) | \* |
| [486](#L486) | \* @param string $format Format to filter. |
| [487](#L487) | \* |
| [488](#L488) | \* @return null|string Format to filter. |
| [489](#L489) | \*/ |
| [490](#L490) | function intergeo\_filter\_adsense\_format( $format ) { |
| [491](#L491) | return intergeo\_filter\_value( |
| [492](#L492) | $format, array( |
| [493](#L493) | 'BANNER', |
| [494](#L494) | 'BUTTON', |
| [495](#L495) | 'HALF\_BANNER', |
| [496](#L496) | 'LARGE\_HORIZONTAL\_LINK\_UNIT', |
| [497](#L497) | 'LARGE\_RECTANGLE', |
| [498](#L498) | 'LARGE\_VERTICAL\_LINK\_UNIT', |
| [499](#L499) | 'LEADERBOARD', |
| [500](#L500) | 'MEDIUM\_RECTANGLE', |
| [501](#L501) | 'MEDIUM\_VERTICAL\_LINK\_UNIT', |
| [502](#L502) | 'SKYSCRAPER', |
| [503](#L503) | 'SMALL\_HORIZONTAL\_LINK\_UNIT', |
| [504](#L504) | 'SMALL\_RECTANGLE', |
| [505](#L505) | 'SMALL\_SQUARE', |
| [506](#L506) | 'SMALL\_VERTICAL\_LINK\_UNIT', |
| [507](#L507) | 'SQUARE', |
| [508](#L508) | 'VERTICAL\_BANNER', |
| [509](#L509) | 'WIDE\_SKYSCRAPER', |
| [510](#L510) | 'X\_LARGE\_VERTICAL\_LINK\_UNIT', |
| [511](#L511) | ) |
| [512](#L512) | ); |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | /\*\* |
| [516](#L516) | \* Filter custom style. |
| [517](#L517) | \* |
| [518](#L518) | \* @param string $style Filter custom style. |
| [519](#L519) | \* |
| [520](#L520) | \* @return array|mixed|null|object Filtered custom style. |
| [521](#L521) | \*/ |
| [522](#L522) | function intergeo\_filter\_custom\_style( $style ) { |
| [523](#L523) | $style = trim( $style ); |
| [524](#L524) | $json  = json\_decode( $style, true ); |
| [525](#L525) |  |
| [526](#L526) | return empty( $json ) ? null : $json; |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) | /\*\* |
| [530](#L530) | \* Filter the overlay markers. |
| [531](#L531) | \* |
| [532](#L532) | \* @param array $marker Filter the overlay marker. |
| [533](#L533) | \* |
| [534](#L534) | \* @return array|bool Filtered markers. |
| [535](#L535) | \*/ |
| [536](#L536) | function intergeo\_filter\_overlays\_marker( $marker ) { |
| [537](#L537) | if ( ! isset( $marker['position'] ) || ! preg\_match( '/^-?\d+\.?\d\*,-?\d+\.?\d\*$/', $marker['position'] ) ) { |
| [538](#L538) | return false; |
| [539](#L539) | } |
| [540](#L540) |  |
| [541](#L541) | return array( |
| [542](#L542) | 'position' => explode( ',', $marker['position'] ), |
| [543](#L543) | 'icon'     => isset( $marker['icon'] ) ? filter\_var( $marker['icon'], FILTER\_VALIDATE\_URL ) : '', |
| [544](#L544) | 'info'     => isset( $marker['info'] ) ? trim( preg\_replace( '/\<\/?script.\*?\>/is', '', $marker['info'] ) ) : '', |
| [545](#L545) | 'title'    => isset( $marker['title'] ) ? strip\_tags( trim( $marker['title'] ) ) : '', |
| [546](#L546) | 'loc'      => isset( $marker['loc'] ) ? strip\_tags( trim( $marker['loc'] ) ) : '', |
| [547](#L547) | ); |
| [548](#L548) | } |
| [549](#L549) |  |
| [550](#L550) |  |
| [551](#L551) | /\*\* |
| [552](#L552) | \* Returns the settings URL. |
| [553](#L553) | \* |
| [554](#L554) | \* @return string The settings URL. |
| [555](#L555) | \*/ |
| [556](#L556) | function intergeo\_settings\_url() { |
| [557](#L557) | return admin\_url( 'options-general.php?page=' . INTERGEO\_PLUGIN\_NAME ); |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* Filter polyline. |
| [562](#L562) | \* |
| [563](#L563) | \* @param array $polyline Polyline filter. |
| [564](#L564) | \* |
| [565](#L565) | \* @return array|bool Filtered values. |
| [566](#L566) | \*/ |
| [567](#L567) | function intergeo\_filter\_overlays\_polyline( $polyline ) { |
| [568](#L568) | if ( ! isset( $polyline['path'] ) ) { |
| [569](#L569) | return false; |
| [570](#L570) | } |
| [571](#L571) | $path = array(); |
| [572](#L572) | foreach ( explode( ';', $polyline['path'] ) as $point ) { |
| [573](#L573) | if ( preg\_match( '/^-?\d+\.?\d\*,-?\d+\.?\d\*$/', $point ) ) { |
| [574](#L574) | $path[] = explode( ',', $point ); |
| [575](#L575) | } |
| [576](#L576) | } |
| [577](#L577) | if ( count( $path ) < 2 ) { |
| [578](#L578) | return false; |
| [579](#L579) | } |
| [580](#L580) |  |
| [581](#L581) | return array( |
| [582](#L582) | 'path'    => $path, |
| [583](#L583) | 'weight'  => isset( $polyline['weight'] ) |
| [584](#L584) | ? filter\_var( |
| [585](#L585) | $polyline['weight'], FILTER\_VALIDATE\_INT, array( |
| [586](#L586) | 'options' => array( |
| [587](#L587) | 'min\_range' => 1, |
| [588](#L588) | 'default'   => '', |
| [589](#L589) | ), |
| [590](#L590) | ) |
| [591](#L591) | ) |
| [592](#L592) | : '', |
| [593](#L593) | 'opacity' => isset( $polyline['opacity'] ) |
| [594](#L594) | ? filter\_var( |
| [595](#L595) | $polyline['opacity'], FILTER\_VALIDATE\_FLOAT, array( |
| [596](#L596) | 'options' => array( |
| [597](#L597) | 'min\_range' => 0, |
| [598](#L598) | 'max\_range' => 1, |
| [599](#L599) | 'default'   => '', |
| [600](#L600) | ), |
| [601](#L601) | ) |
| [602](#L602) | ) |
| [603](#L603) | : '', |
| [604](#L604) | 'color'   => isset( $polyline['color'] ) |
| [605](#L605) | ? filter\_var( |
| [606](#L606) | $polyline['color'], FILTER\_VALIDATE\_REGEXP, array( |
| [607](#L607) | 'options' => array( |
| [608](#L608) | 'regexp'  => '/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/', |
| [609](#L609) | 'default' => '#000000', |
| [610](#L610) | ), |
| [611](#L611) | ) |
| [612](#L612) | ) |
| [613](#L613) | : '#000000', |
| [614](#L614) | ); |
| [615](#L615) | } |
| [616](#L616) |  |
| [617](#L617) | /\*\* |
| [618](#L618) | \* Filters polygon. |
| [619](#L619) | \* |
| [620](#L620) | \* @param array $polygon Polygon to filter. |
| [621](#L621) | \* |
| [622](#L622) | \* @return array|bool Filters polygon. |
| [623](#L623) | \*/ |
| [624](#L624) | function intergeo\_filter\_overlays\_polyoverlay( $polygon ) { |
| [625](#L625) | if ( ! isset( $polygon['path'] ) ) { |
| [626](#L626) | return false; |
| [627](#L627) | } |
| [628](#L628) | $path = array(); |
| [629](#L629) | foreach ( explode( ';', $polygon['path'] ) as $point ) { |
| [630](#L630) | if ( preg\_match( '/^-?\d+\.?\d\*,-?\d+\.?\d\*$/', $point ) ) { |
| [631](#L631) | $path[] = explode( ',', $point ); |
| [632](#L632) | } |
| [633](#L633) | } |
| [634](#L634) | if ( count( $path ) < 2 ) { |
| [635](#L635) | return false; |
| [636](#L636) | } |
| [637](#L637) | $position = isset( $polygon['position'] ) ? strtoupper( trim( $polygon['position'] ) ) : 'CENTER'; |
| [638](#L638) |  |
| [639](#L639) | return array( |
| [640](#L640) | 'path'           => $path, |
| [641](#L641) | 'position'       => in\_array( $position, array( 'CENTER', 'INSIDE', 'OUTSIDE' ) ) ? $position : 'CENTER', |
| [642](#L642) | 'weight'         => isset( $polygon['weight'] ) ? filter\_var( |
| [643](#L643) | $polygon['weight'], FILTER\_VALIDATE\_INT, array( |
| [644](#L644) | 'options' => array( |
| [645](#L645) | 'min\_range' => 1, |
| [646](#L646) | 'default'   => '', |
| [647](#L647) | ), |
| [648](#L648) | ) |
| [649](#L649) | ) : '', |
| [650](#L650) | 'stroke\_opacity' => isset( $polygon['stroke\_opacity'] ) ? filter\_var( |
| [651](#L651) | $polygon['stroke\_opacity'], FILTER\_VALIDATE\_FLOAT, array( |
| [652](#L652) | 'options' => array( |
| [653](#L653) | 'min\_range' => 0, |
| [654](#L654) | 'max\_range' => 1, |
| [655](#L655) | 'default'   => '', |
| [656](#L656) | ), |
| [657](#L657) | ) |
| [658](#L658) | ) : '', |
| [659](#L659) | 'stroke\_color'   => isset( $polygon['stroke\_color'] ) ? filter\_var( |
| [660](#L660) | $polygon['stroke\_color'], FILTER\_VALIDATE\_REGEXP, array( |
| [661](#L661) | 'options' => array( |
| [662](#L662) | 'regexp'  => '/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/', |
| [663](#L663) | 'default' => '#000000', |
| [664](#L664) | ), |
| [665](#L665) | ) |
| [666](#L666) | ) : '#000000', |
| [667](#L667) | 'fill\_opacity'   => isset( $polygon['fill\_opacity'] ) ? filter\_var( |
| [668](#L668) | $polygon['fill\_opacity'], FILTER\_VALIDATE\_FLOAT, array( |
| [669](#L669) | 'options' => array( |
| [670](#L670) | 'min\_range' => 0, |
| [671](#L671) | 'max\_range' => 1, |
| [672](#L672) | 'default'   => '', |
| [673](#L673) | ), |
| [674](#L674) | ) |
| [675](#L675) | ) : '', |
| [676](#L676) | 'fill\_color'     => isset( $polygon['fill\_color'] ) ? filter\_var( |
| [677](#L677) | $polygon['fill\_color'], FILTER\_VALIDATE\_REGEXP, array( |
| [678](#L678) | 'options' => array( |
| [679](#L679) | 'regexp'  => '/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/', |
| [680](#L680) | 'default' => '#000000', |
| [681](#L681) | ), |
| [682](#L682) | ) |
| [683](#L683) | ) : '#000000', |
| [684](#L684) | ); |
| [685](#L685) | } |
| [686](#L686) |  |
| [687](#L687) | /\*\* |
| [688](#L688) | \* Filter directions array. |
| [689](#L689) | \* |
| [690](#L690) | \* @param array $direction Direction array to filter. |
| [691](#L691) | \* |
| [692](#L692) | \* @return array|bool Filtered directions. |
| [693](#L693) | \*/ |
| [694](#L694) | function intergeo\_filter\_directions( $direction ) { |
| [695](#L695) | $to   = isset( $direction['to'] ) ? trim( $direction['to'] ) : ''; |
| [696](#L696) | $from = isset( $direction['from'] ) ? trim( $direction['from'] ) : ''; |
| [697](#L697) | if ( empty( $to ) || empty( $from ) ) { |
| [698](#L698) | return false; |
| [699](#L699) | } |
| [700](#L700) | $mode = isset( $direction['mode'] ) ? strtoupper( trim( $direction['mode'] ) ) : 'DRIVING'; |
| [701](#L701) |  |
| [702](#L702) | return array( |
| [703](#L703) | 'mode' => in\_array( $mode, array( 'BICYCLING', 'DRIVING', 'TRANSIT', 'WALKING' ) ) ? $mode : 'DRIVING', |
| [704](#L704) | 'from' => $from, |
| [705](#L705) | 'to'   => $to, |
| [706](#L706) | ); |
| [707](#L707) | } |
| [708](#L708) |  |
| [709](#L709) | /\*\* |
| [710](#L710) | \* Filter map input. |
| [711](#L711) | \* |
| [712](#L712) | \* @return array Array to filter. |
| [713](#L713) | \*/ |
| [714](#L714) | function intergeo\_filter\_input() { |
| [715](#L715) | $color\_regexp    = '/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/'; |
| [716](#L716) | $postion\_filter  = array( |
| [717](#L717) | 'filter'  => FILTER\_CALLBACK, |
| [718](#L718) | 'options' => 'intergeo\_filter\_position', |
| [719](#L719) | ); |
| [720](#L720) | $validationArray = array( |
| [721](#L721) | 'lat'                                   => array( |
| [722](#L722) | 'filter'  => FILTER\_VALIDATE\_FLOAT, |
| [723](#L723) | 'flags'   => FILTER\_REQUIRE\_SCALAR, |
| [724](#L724) | 'options' => array( |
| [725](#L725) | 'min\_range' => - 90, |
| [726](#L726) | 'max\_range' => 90, |
| [727](#L727) | 'default'   => 48.1366069, |
| [728](#L728) | ), |
| [729](#L729) | ), |
| [730](#L730) | 'lng'                                   => array( |
| [731](#L731) | 'filter'  => FILTER\_VALIDATE\_FLOAT, |
| [732](#L732) | 'flags'   => FILTER\_REQUIRE\_SCALAR, |
| [733](#L733) | 'options' => array( |
| [734](#L734) | 'min\_range' => - 180, |
| [735](#L735) | 'max\_range' => 180, |
| [736](#L736) | 'default'   => 11.577085099999977, |
| [737](#L737) | ), |
| [738](#L738) | ), |
| [739](#L739) | 'zoom'                                  => array( |
| [740](#L740) | 'filter'  => FILTER\_VALIDATE\_INT, |
| [741](#L741) | 'flags'   => FILTER\_REQUIRE\_SCALAR, |
| [742](#L742) | 'options' => array( |
| [743](#L743) | 'min\_range' => 0, |
| [744](#L744) | 'max\_range' => 19, |
| [745](#L745) | 'default'   => 5, |
| [746](#L746) | ), |
| [747](#L747) | ), |
| [748](#L748) | 'address'                               => FILTER\_SANITIZE\_STRING, |
| [749](#L749) | 'map\_mapTypeId'                         => array( |
| [750](#L750) | 'filter'  => FILTER\_CALLBACK, |
| [751](#L751) | 'options' => 'intergeo\_filter\_map\_type', |
| [752](#L752) | ), |
| [753](#L753) | 'map\_draggable'                         => FILTER\_VALIDATE\_BOOLEAN, |
| [754](#L754) | 'map\_minZoom'                           => array( |
| [755](#L755) | 'filter'  => FILTER\_VALIDATE\_INT, |
| [756](#L756) | 'flags'   => FILTER\_REQUIRE\_SCALAR, |
| [757](#L757) | 'options' => array( |
| [758](#L758) | 'min\_range' => 0, |
| [759](#L759) | 'max\_range' => 19, |
| [760](#L760) | 'default'   => 0, |
| [761](#L761) | ), |
| [762](#L762) | ), |
| [763](#L763) | 'map\_maxZoom'                           => array( |
| [764](#L764) | 'filter'  => FILTER\_VALIDATE\_INT, |
| [765](#L765) | 'flags'   => FILTER\_REQUIRE\_SCALAR, |
| [766](#L766) | 'options' => array( |
| [767](#L767) | 'min\_range' => 0, |
| [768](#L768) | 'max\_range' => 19, |
| [769](#L769) | 'default'   => 19, |
| [770](#L770) | ), |
| [771](#L771) | ), |
| [772](#L772) | 'map\_scrollwheel'                       => FILTER\_VALIDATE\_BOOLEAN, |
| [773](#L773) | 'map\_zoomControl'                       => FILTER\_VALIDATE\_BOOLEAN, |
| [774](#L774) | 'map\_zoomControlOptions\_position'       => $postion\_filter, |
| [775](#L775) | 'map\_zoomControlOptions\_style'          => array( |
| [776](#L776) | 'filter'  => FILTER\_CALLBACK, |
| [777](#L777) | 'options' => 'intergeo\_filter\_zoom\_style', |
| [778](#L778) | ), |
| [779](#L779) | 'map\_panControl'                        => FILTER\_VALIDATE\_BOOLEAN, |
| [780](#L780) | 'map\_panControlOptions\_position'        => $postion\_filter, |
| [781](#L781) | 'map\_scaleControl'                      => FILTER\_VALIDATE\_BOOLEAN, |
| [782](#L782) | 'map\_scaleControlOptions\_position'      => $postion\_filter, |
| [783](#L783) | 'map\_mapTypeControl'                    => FILTER\_VALIDATE\_BOOLEAN, |
| [784](#L784) | 'map\_mapTypeControlOptions\_position'    => $postion\_filter, |
| [785](#L785) | 'map\_mapTypeControlOptions\_style'       => array( |
| [786](#L786) | 'filter'  => FILTER\_CALLBACK, |
| [787](#L787) | 'options' => 'intergeo\_filter\_map\_type\_style', |
| [788](#L788) | ), |
| [789](#L789) | 'map\_mapTypeControlOptions\_mapTypeIds'  => array( |
| [790](#L790) | 'filter'  => FILTER\_CALLBACK, |
| [791](#L791) | 'flags'   => FILTER\_REQUIRE\_ARRAY, |
| [792](#L792) | 'options' => 'intergeo\_filter\_map\_type', |
| [793](#L793) | ), |
| [794](#L794) | 'map\_streetViewControl'                 => FILTER\_VALIDATE\_BOOLEAN, |
| [795](#L795) | 'map\_streetViewControlOptions\_position' => $postion\_filter, |
| [796](#L796) | 'map\_rotateControl'                     => FILTER\_VALIDATE\_BOOLEAN, |
| [797](#L797) | 'map\_rotateControlOptions\_position'     => $postion\_filter, |
| [798](#L798) | 'map\_overviewMapControl'                => FILTER\_VALIDATE\_BOOLEAN, |
| [799](#L799) | 'map\_overviewMapControlOptions\_opened'  => FILTER\_VALIDATE\_BOOLEAN, |
| [800](#L800) | 'layer\_traffic'                         => FILTER\_VALIDATE\_BOOLEAN, |
| [801](#L801) | 'layer\_bicycling'                       => FILTER\_VALIDATE\_BOOLEAN, |
| [802](#L802) | 'layer\_cloud'                           => FILTER\_VALIDATE\_BOOLEAN, |
| [803](#L803) | 'layer\_weather'                         => FILTER\_VALIDATE\_BOOLEAN, |
| [804](#L804) | 'weather\_temperatureUnits'              => array( |
| [805](#L805) | 'filter'  => FILTER\_CALLBACK, |
| [806](#L806) | 'options' => 'intergeo\_filter\_temperature\_units', |
| [807](#L807) | ), |
| [808](#L808) | 'weather\_windSpeedUnits'                => array( |
| [809](#L809) | 'filter'  => FILTER\_CALLBACK, |
| [810](#L810) | 'options' => 'intergeo\_filter\_wind\_speed\_units', |
| [811](#L811) | ), |
| [812](#L812) | 'layer\_panoramio'                       => FILTER\_VALIDATE\_BOOLEAN, |
| [813](#L813) | 'panoramio\_tag'                         => FILTER\_SANITIZE\_STRING, |
| [814](#L814) | 'panoramio\_userId'                      => FILTER\_SANITIZE\_STRING, |
| [815](#L815) | 'layer\_adsense'                         => FILTER\_VALIDATE\_BOOLEAN, |
| [816](#L816) | 'adsense\_format'                        => array( |
| [817](#L817) | 'filter'  => FILTER\_CALLBACK, |
| [818](#L818) | 'options' => 'intergeo\_filter\_adsense\_format', |
| [819](#L819) | ), |
| [820](#L820) | 'adsense\_position'                      => $postion\_filter, |
| [821](#L821) | 'adsense\_backgroundColor'               => array( |
| [822](#L822) | 'filter'  => FILTER\_VALIDATE\_REGEXP, |
| [823](#L823) | 'options' => array( |
| [824](#L824) | 'regexp'  => $color\_regexp, |
| [825](#L825) | 'default' => '#c4d4f3', |
| [826](#L826) | ), |
| [827](#L827) | ), |
| [828](#L828) | 'adsense\_borderColor'                   => array( |
| [829](#L829) | 'filter'  => FILTER\_VALIDATE\_REGEXP, |
| [830](#L830) | 'options' => array( |
| [831](#L831) | 'regexp'  => $color\_regexp, |
| [832](#L832) | 'default' => '#e5ecf9', |
| [833](#L833) | ), |
| [834](#L834) | ), |
| [835](#L835) | 'adsense\_titleColor'                    => array( |
| [836](#L836) | 'filter'  => FILTER\_VALIDATE\_REGEXP, |
| [837](#L837) | 'options' => array( |
| [838](#L838) | 'regexp'  => $color\_regexp, |
| [839](#L839) | 'default' => '#0000cc', |
| [840](#L840) | ), |
| [841](#L841) | ), |
| [842](#L842) | 'adsense\_textColor'                     => array( |
| [843](#L843) | 'filter'  => FILTER\_VALIDATE\_REGEXP, |
| [844](#L844) | 'options' => array( |
| [845](#L845) | 'regexp'  => $color\_regexp, |
| [846](#L846) | 'default' => '#000000', |
| [847](#L847) | ), |
| [848](#L848) | ), |
| [849](#L849) | 'adsense\_urlColor'                      => array( |
| [850](#L850) | 'filter'  => FILTER\_VALIDATE\_REGEXP, |
| [851](#L851) | 'options' => array( |
| [852](#L852) | 'regexp'  => $color\_regexp, |
| [853](#L853) | 'default' => '#009900', |
| [854](#L854) | ), |
| [855](#L855) | ), |
| [856](#L856) | 'container\_width'                       => FILTER\_SANITIZE\_STRING, |
| [857](#L857) | 'container\_height'                      => FILTER\_SANITIZE\_STRING, |
| [858](#L858) | 'container\_styles'                      => FILTER\_SANITIZE\_STRING, |
| [859](#L859) | 'styles\_type'                           => FILTER\_SANITIZE\_STRING, |
| [860](#L860) | 'styles\_custom'                         => array( |
| [861](#L861) | 'filter'  => FILTER\_CALLBACK, |
| [862](#L862) | 'options' => 'intergeo\_filter\_custom\_style', |
| [863](#L863) | ), |
| [864](#L864) | 'overlays\_marker'                       => array( |
| [865](#L865) | 'filter' => FILTER\_DEFAULT, |
| [866](#L866) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [867](#L867) | ), |
| [868](#L868) | 'overlays\_polyline'                     => array( |
| [869](#L869) | 'filter' => FILTER\_DEFAULT, |
| [870](#L870) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [871](#L871) | ), |
| [872](#L872) | 'overlays\_polygon'                      => array( |
| [873](#L873) | 'filter' => FILTER\_DEFAULT, |
| [874](#L874) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [875](#L875) | ), |
| [876](#L876) | 'overlays\_rectangle'                    => array( |
| [877](#L877) | 'filter' => FILTER\_DEFAULT, |
| [878](#L878) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [879](#L879) | ), |
| [880](#L880) | 'overlays\_circle'                       => array( |
| [881](#L881) | 'filter' => FILTER\_DEFAULT, |
| [882](#L882) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [883](#L883) | ), |
| [884](#L884) | 'directions'                            => array( |
| [885](#L885) | 'filter' => FILTER\_DEFAULT, |
| [886](#L886) | 'flags'  => FILTER\_REQUIRE\_ARRAY, |
| [887](#L887) | ), |
| [888](#L888) | ); |
| [889](#L889) | $defaults        = array( |
| [890](#L890) | 'lat'                                   => 48.1366069, |
| [891](#L891) | 'lng'                                   => 11.577085099999977, |
| [892](#L892) | 'zoom'                                  => 5, |
| [893](#L893) | 'address'                               => '', |
| [894](#L894) | 'map\_mapTypeId'                         => 'ROADMAP', |
| [895](#L895) | 'map\_draggable'                         => true, |
| [896](#L896) | 'map\_minZoom'                           => 0, |
| [897](#L897) | 'map\_maxZoom'                           => 19, |
| [898](#L898) | 'map\_scrollwheel'                       => true, |
| [899](#L899) | 'map\_zoomControl'                       => true, |
| [900](#L900) | 'map\_zoomControlOptions\_position'       => null, |
| [901](#L901) | 'map\_zoomControlOptions\_style'          => 'DEFAULT', |
| [902](#L902) | 'map\_panControl'                        => true, |
| [903](#L903) | 'map\_panControlOptions\_position'        => null, |
| [904](#L904) | 'map\_scaleControl'                      => false, |
| [905](#L905) | 'map\_scaleControlOptions\_position'      => null, |
| [906](#L906) | 'map\_mapTypeControl'                    => true, |
| [907](#L907) | 'map\_mapTypeControlOptions\_position'    => null, |
| [908](#L908) | 'map\_mapTypeControlOptions\_style'       => 'DEFAULT', |
| [909](#L909) | 'map\_mapTypeControlOptions\_mapTypeIds'  => array( 'ROADMAP', 'TERRAIN', 'SATELLITE', 'HYBRID' ), |
| [910](#L910) | 'map\_streetViewControl'                 => true, |
| [911](#L911) | 'map\_streetViewControlOptions\_position' => null, |
| [912](#L912) | 'map\_rotateControl'                     => true, |
| [913](#L913) | 'map\_rotateControlOptions\_position'     => null, |
| [914](#L914) | 'map\_overviewMapControl'                => false, |
| [915](#L915) | 'map\_overviewMapControlOptions\_opened'  => false, |
| [916](#L916) | 'layer\_traffic'                         => false, |
| [917](#L917) | 'layer\_bicycling'                       => false, |
| [918](#L918) | 'layer\_cloud'                           => false, |
| [919](#L919) | 'layer\_weather'                         => false, |
| [920](#L920) | 'weather\_temperatureUnits'              => null, |
| [921](#L921) | 'weather\_windSpeedUnits'                => null, |
| [922](#L922) | 'layer\_panoramio'                       => false, |
| [923](#L923) | 'panoramio\_tag'                         => '', |
| [924](#L924) | 'panoramio\_userId'                      => '', |
| [925](#L925) | 'layer\_adsense'                         => false, |
| [926](#L926) | 'adsense\_format'                        => null, |
| [927](#L927) | 'adsense\_position'                      => null, |
| [928](#L928) | 'adsense\_backgroundColor'               => '#c4d4f3', |
| [929](#L929) | 'adsense\_borderColor'                   => '#e5ecf9', |
| [930](#L930) | 'adsense\_titleColor'                    => '#0000cc', |
| [931](#L931) | 'adsense\_textColor'                     => '#000000', |
| [932](#L932) | 'adsense\_urlColor'                      => '#009900', |
| [933](#L933) | 'container\_width'                       => '', |
| [934](#L934) | 'container\_height'                      => '', |
| [935](#L935) | 'container\_styles'                      => '', |
| [936](#L936) | 'styles\_type'                           => 'DEFAULT', |
| [937](#L937) | 'styles\_custom'                         => null, |
| [938](#L938) | 'overlays\_marker'                       => array(), |
| [939](#L939) | 'overlays\_polyline'                     => array(), |
| [940](#L940) | 'overlays\_polygon'                      => array(), |
| [941](#L941) | 'overlays\_rectangle'                    => array(), |
| [942](#L942) | 'overlays\_circle'                       => array(), |
| [943](#L943) | 'directions'                            => array(), |
| [944](#L944) | ); |
| [945](#L945) | $validated       = apply\_filters( 'intergeo\_validations', array( $validationArray, $defaults ) ); |
| [946](#L946) | $validationArray = $validated[0]; |
| [947](#L947) | $defaults        = $validated[1]; |
| [948](#L948) | $options         = filter\_input\_array( INPUT\_POST, $validationArray ); |
| [949](#L949) | $results         = array(); |
| [950](#L950) | foreach ( $options as $key => $value ) { |
| [951](#L951) | if ( array\_key\_exists( $key, $defaults ) ) { |
| [952](#L952) | $equals = $defaults[ $key ] == $value; |
| [953](#L953) | if ( is\_array( $value ) ) { |
| [954](#L954) | $equals = ( count( $value ) == count( $defaults[ $key ] ) ) && ( count( array\_diff( (array) $defaults[ $key ], $value ) ) == 0 ); |
| [955](#L955) | } |
| [956](#L956) | if ( ! $equals ) { |
| [957](#L957) | $results[ $key ] = $value; |
| [958](#L958) | } |
| [959](#L959) | } |
| [960](#L960) | } |
| [961](#L961) | if ( ! empty( $results['overlays\_marker'] ) ) { |
| [962](#L962) | $results['overlays\_marker'] = array\_filter( array\_map( 'intergeo\_filter\_overlays\_marker', $results['overlays\_marker'] ) ); |
| [963](#L963) | } |
| [964](#L964) | if ( ! empty( $results['overlays\_polyline'] ) ) { |
| [965](#L965) | $results['overlays\_polyline'] = array\_filter( array\_map( 'intergeo\_filter\_overlays\_polyline', $results['overlays\_polyline'] ) ); |
| [966](#L966) | } |
| [967](#L967) | if ( ! empty( $results['directions'] ) ) { |
| [968](#L968) | $results['directions'] = array\_filter( array\_map( 'intergeo\_filter\_directions', $results['directions'] ) ); |
| [969](#L969) | } |
| [970](#L970) | foreach ( array( 'polygon', 'rectangle', 'circle' ) as $overlay ) { |
| [971](#L971) | $overlay = 'overlays\_' . $overlay; |
| [972](#L972) | if ( ! empty( $results[ $overlay ] ) ) { |
| [973](#L973) | $results[ $overlay ] = array\_filter( array\_map( 'intergeo\_filter\_overlays\_polyoverlay', $results[ $overlay ] ) ); |
| [974](#L974) | } |
| [975](#L975) | } |
| [976](#L976) | $results = apply\_filters( 'intergeo\_process\_results', $results ); |
| [977](#L977) |  |
| [978](#L978) | return $results; |
| [979](#L979) | } |
| [980](#L980) |  |
| [981](#L981) | /\*\* |
| [982](#L982) | \* Routine to save the map. |
| [983](#L983) | \* |
| [984](#L984) | \* @param int $map\_id Map id. |
| [985](#L985) | \* @param int $post\_id Post id. |
| [986](#L986) | \* |
| [987](#L987) | \* @return bool|string Return shortcode val. |
| [988](#L988) | \*/ |
| [989](#L989) | function intergeo\_save\_map( $map\_id = false, $post\_id = false ) { |
| [990](#L990) | $options   = array(); |
| [991](#L991) | $array\_ptr = &$options; |
| [992](#L992) | foreach ( intergeo\_filter\_input() as $key => $value ) { |
| [993](#L993) | if ( ! is\_null( $value ) ) { |
| [994](#L994) | $keys     = explode( '\_', $key ); |
| [995](#L995) | $last\_key = array\_pop( $keys ); |
| [996](#L996) | while ( $arr\_key = array\_shift( $keys ) ) { |
| [997](#L997) | if ( ! array\_key\_exists( $arr\_key, $array\_ptr ) ) { |
| [998](#L998) | $array\_ptr[ $arr\_key ] = array(); |
| [999](#L999) | } |
| [1000](#L1000) | $array\_ptr = &$array\_ptr[ $arr\_key ]; |
| [1001](#L1001) | } |
| [1002](#L1002) | $array\_ptr[ $last\_key ] = $value; |
| [1003](#L1003) | $array\_ptr              = &$options; |
| [1004](#L1004) | } |
| [1005](#L1005) | } |
| [1006](#L1006) | $address = ''; |
| [1007](#L1007) | if ( ! empty( $options['address'] ) ) { |
| [1008](#L1008) | $address = $options['address'] = trim( $options['address'] ); |
| [1009](#L1009) | } |
| [1010](#L1010) | $args   = array( |
| [1011](#L1011) | 'post\_type'    => INTERGEO\_PLUGIN\_NAME, |
| [1012](#L1012) | 'post\_content' => addcslashes( json\_encode( $options ), '\\' ), |
| [1013](#L1013) | 'post\_status'  => 'private', |
| [1014](#L1014) | ); |
| [1015](#L1015) | $update = false; |
| [1016](#L1016) | if ( $map\_id ) { |
| [1017](#L1017) | $post = get\_post( intergeo\_decode( $map\_id ) ); |
| [1018](#L1018) | if ( $post && $post->post\_type == INTERGEO\_PLUGIN\_NAME ) { |
| [1019](#L1019) | $update     = true; |
| [1020](#L1020) | $args['ID'] = $post->ID; |
| [1021](#L1021) | } |
| [1022](#L1022) | } |
| [1023](#L1023) | $id = wp\_insert\_post( $args ); |
| [1024](#L1024) | if ( ! empty( $id ) && ! is\_wp\_error( $id ) ) { |
| [1025](#L1025) | if ( ! $post\_id ) { |
| [1026](#L1026) | intergeo\_set\_info( |
| [1027](#L1027) | $update |
| [1028](#L1028) | ? \_\_( 'The map has been updated successfully.', 'intergeo-maps' ) |
| [1029](#L1029) | : \_\_( 'The map has been created successfully.', 'intergeo-maps' ) |
| [1030](#L1030) | ); |
| [1031](#L1031) | } |
| [1032](#L1032) |  |
| [1033](#L1033) | return sprintf( '[intergeo id="%s"]%s[/intergeo]', intergeo\_encode( $id ), $address ); |
| [1034](#L1034) | } |
| [1035](#L1035) | if ( ! $post\_id ) { |
| [1036](#L1036) | intergeo\_set\_error( |
| [1037](#L1037) | $update |
| [1038](#L1038) | ? \_\_( 'The map updating failed.', 'intergeo-maps' ) |
| [1039](#L1039) | : \_\_( 'The map creation failed.', 'intergeo-maps' ) |
| [1040](#L1040) | ); |
| [1041](#L1041) | } |
| [1042](#L1042) |  |
| [1043](#L1043) | return false; |
| [1044](#L1044) | } |
| [1045](#L1045) |  |
| [1046](#L1046) | add\_action( 'wp\_ajax\_intergeo\_show\_map\_center', 'intergeo\_show\_map\_center\_changed' ); |
| [1047](#L1047) | /\*\* |
| [1048](#L1048) | \* Update map status. |
| [1049](#L1049) | \*/ |
| [1050](#L1050) | function intergeo\_show\_map\_center\_changed() { |
| [1051](#L1051) | $nonce = filter\_input( INPUT\_POST, 'nonce' ); |
| [1052](#L1052) | if ( wp\_verify\_nonce( $nonce, 'editor\_popup' . filter\_input( INPUT\_SERVER, 'REMOTE\_ADDR', FILTER\_VALIDATE\_IP ) ) ) { |
| [1053](#L1053) | update\_option( 'intergeo\_show\_map\_center', (int) filter\_input( INPUT\_POST, 'status', FILTER\_VALIDATE\_BOOLEAN ) ); |
| [1054](#L1054) | } |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | /\*\* |
| [1058](#L1058) | \* Render shortcode in widget and terms description. |
| [1059](#L1059) | \*/ |
| [1060](#L1060) | add\_filter( 'widget\_text', 'do\_shortcode' ); |
| [1061](#L1061) | add\_filter( 'term\_description', 'do\_shortcode' ); |
| [1062](#L1062) |  |
| [1063](#L1063) | add\_shortcode( INTERGEO\_PLUGIN\_NAME, 'intergeo\_shortcode' ); |
| [1064](#L1064) | /\*\* |
| [1065](#L1065) | \* Renders the intergeo shortcode. |
| [1066](#L1066) | \* |
| [1067](#L1067) | \* @param array  $attrs The shortcode atts. |
| [1068](#L1068) | \* @param string $address The address used. |
| [1069](#L1069) | \* |
| [1070](#L1070) | \* @return string The shortcode output. |
| [1071](#L1071) | \*/ |
| [1072](#L1072) | function intergeo\_shortcode( $attrs, $address = '' ) { |
| [1073](#L1073) | do\_action( 'intergeo\_shortcode\_render\_before', $attrs ); |
| [1074](#L1074) | $args    = shortcode\_atts( |
| [1075](#L1075) | array( |
| [1076](#L1076) | 'id'     => false, |
| [1077](#L1077) | 'hook'   => false, |
| [1078](#L1078) | 'width'  => false, |
| [1079](#L1079) | 'height' => false, |
| [1080](#L1080) | 'style'  => false, |
| [1081](#L1081) | 'zoom'   => false, |
| [1082](#L1082) | ), $attrs |
| [1083](#L1083) | ); |
| [1084](#L1084) | $address = trim( $address ); |
| [1085](#L1085) | if ( empty( $args['id'] ) && empty( $address ) ) { |
| [1086](#L1086) | return ''; |
| [1087](#L1087) | } |
| [1088](#L1088) | $json = array(); |
| [1089](#L1089) | if ( ! empty( $args['id'] ) ) { |
| [1090](#L1090) | $post = get\_post( intergeo\_decode( $args['id'] ) ); |
| [1091](#L1091) | if ( ! $post || $post->post\_type != INTERGEO\_PLUGIN\_NAME ) { |
| [1092](#L1092) | return ''; |
| [1093](#L1093) | } |
| [1094](#L1094) | $json = json\_decode( $post->post\_content, true ); |
| [1095](#L1095) | } else { |
| [1096](#L1096) | $args['id']   = intergeo\_encode( rand( 0, 100 ) . rand( 0, 10000 ) ); |
| [1097](#L1097) | $json['zoom'] = intval( $args['zoom'] ) ? intval( $args['zoom'] ) : 15; |
| [1098](#L1098) | } |
| [1099](#L1099) | if ( ! empty( $address ) ) { |
| [1100](#L1100) | $json['address'] = $address; |
| [1101](#L1101) | } |
| [1102](#L1102) | if ( trim( $args['hook'] ) != '' ) { |
| [1103](#L1103) | $json = apply\_filters( $args['hook'], $json ); |
| [1104](#L1104) | } |
| [1105](#L1105) | wp\_enqueue\_style( 'intergeo-frontend' ); |
| [1106](#L1106) | intergeo\_enqueue\_google\_maps\_script( intergeo\_check\_libraries( $json ) ); |
| [1107](#L1107) | if ( ! wp\_script\_is( 'intergeo-rendering' ) ) { |
| [1108](#L1108) | wp\_enqueue\_script( |
| [1109](#L1109) | 'intergeo-rendering', INTERGEO\_ABSURL . 'js/rendering.js', array( |
| [1110](#L1110) | 'jquery', |
| [1111](#L1111) | 'google-maps-v3', |
| [1112](#L1112) | ), INTERGEO\_VERSION |
| [1113](#L1113) | ); |
| [1114](#L1114) | wp\_localize\_script( |
| [1115](#L1115) | 'intergeo-rendering', 'intergeo\_options', array( |
| [1116](#L1116) | 'adsense' => array( |
| [1117](#L1117) | 'publisher\_id' => get\_option( 'intergeo\_adsense\_publisher\_id' ), |
| [1118](#L1118) | ), |
| [1119](#L1119) | ) |
| [1120](#L1120) | ); |
| [1121](#L1121) | } |
| [1122](#L1122) | $container = array(); |
| [1123](#L1123) | if ( isset( $json['container'] ) ) { |
| [1124](#L1124) | $container = $json['container']; |
| [1125](#L1125) | unset( $json['container'] ); |
| [1126](#L1126) | } |
| [1127](#L1127) | $width = ! empty( $container['width'] ) ? esc\_attr( $container['width'] ) : '100%'; |
| [1128](#L1128) | if ( trim( $args['width'] ) != '' ) { |
| [1129](#L1129) | $width = $args['width']; |
| [1130](#L1130) | } |
| [1131](#L1131) | if ( is\_numeric( $width ) ) { |
| [1132](#L1132) | $width .= 'px'; |
| [1133](#L1133) | } |
| [1134](#L1134) | $height = ! empty( $container['height'] ) ? esc\_attr( $container['height'] ) : '300px'; |
| [1135](#L1135) | if ( trim( $args['height'] ) != '' ) { |
| [1136](#L1136) | $height = $args['height']; |
| [1137](#L1137) | } |
| [1138](#L1138) | if ( is\_numeric( $height ) ) { |
| [1139](#L1139) | $height .= 'px'; |
| [1140](#L1140) | } |
| [1141](#L1141) | $styles = ! empty( $container['styles'] ) ? esc\_attr( $container['styles'] ) : ''; |
| [1142](#L1142) | if ( trim( $args['style'] ) != '' ) { |
| [1143](#L1143) | $styles = $args['style']; |
| [1144](#L1144) | } |
| [1145](#L1145) |  |
| [1146](#L1146) | return sprintf( |
| [1147](#L1147) | ' |
| [1148](#L1148) | <div id="intergeo\_map%1$s" class="intergeo\_map\_canvas" style="width:100%%;height:300px;width:%2$s;height:%3$s;%4$s"></div> |
| [1149](#L1149) | <script type="text/javascript"> |
| [1150](#L1150) | /\* <![CDATA[ \*/ |
| [1151](#L1151) | if (!window.intergeo\_maps) window.intergeo\_maps = []; |
| [1152](#L1152) | window.intergeo\_maps.push( { container: \'intergeo\_map%1$s\', options: %5$s } ); |
| [1153](#L1153) | if (!window.intergeo\_maps\_current) window.intergeo\_maps\_current = null; |
| [1154](#L1154) | /\* ]]> \*/ |
| [1155](#L1155) | </script> |
| [1156](#L1156) | ', |
| [1157](#L1157) | $args['id'], |
| [1158](#L1158) | $width, |
| [1159](#L1159) | $height, |
| [1160](#L1160) | $styles, |
| [1161](#L1161) | json\_encode( $json ) |
| [1162](#L1162) | ); |
| [1163](#L1163) | } |
| [1164](#L1164) |  |
| [1165](#L1165) | add\_action( 'admin\_menu', 'intergeo\_admin\_menu' ); |
| [1166](#L1166) | /\*\* |
| [1167](#L1167) | \* Adds the intergeo admin menu. |
| [1168](#L1168) | \*/ |
| [1169](#L1169) | function intergeo\_admin\_menu() { |
| [1170](#L1170) | $settings = add\_options\_page( \_\_( 'Intergeo Maps Library', 'intergeo-maps' ), \_\_( 'Intergeo Maps', 'intergeo-maps' ), 'edit\_posts', INTERGEO\_PLUGIN\_NAME, 'intergeo\_settings' ); |
| [1171](#L1171) | if ( $settings ) { |
| [1172](#L1172) | add\_action( "load-{$settings}", 'intergeo\_settings\_init' ); |
| [1173](#L1173) | } |
| [1174](#L1174) | $library = add\_submenu\_page( 'upload.php', \_\_( 'Intergeo Maps Library', 'intergeo-maps' ), \_\_( 'Intergeo Maps', 'intergeo-maps' ), 'edit\_posts', INTERGEO\_PLUGIN\_NAME, 'intergeo\_library' ); |
| [1175](#L1175) | if ( $library ) { |
| [1176](#L1176) | add\_action( "load-{$library}", 'intergeo\_library\_init' ); |
| [1177](#L1177) | } |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | /\*\* |
| [1181](#L1181) | \* Init assets for settings screen. |
| [1182](#L1182) | \*/ |
| [1183](#L1183) | function intergeo\_settings\_init() { |
| [1184](#L1184) | wp\_enqueue\_style( 'intergeo\_library', INTERGEO\_ABSURL . 'css/library.css', array(), INTERGEO\_VERSION ); |
| [1185](#L1185) | wp\_enqueue\_script( 'themeisle-subscribe', INTERGEO\_ABSURL . 'subscribe/subscribe.js', array( 'jquery' ) ); |
| [1186](#L1186) | wp\_localize\_script( 'themeisle-subscribe', 'ti', array() ); |
| [1187](#L1187) | } |
| [1188](#L1188) |  |
| [1189](#L1189) | /\*\* |
| [1190](#L1190) | \* Init library assets and scripts. |
| [1191](#L1191) | \*/ |
| [1192](#L1192) | function intergeo\_library\_init() { |
| [1193](#L1193) | wp\_enqueue\_style( 'intergeo\_library', INTERGEO\_ABSURL . 'css/library.css', array(), INTERGEO\_VERSION ); |
| [1194](#L1194) | wp\_enqueue\_script( 'themeisle-subscribe', INTERGEO\_ABSURL . 'subscribe/subscribe.js', array( 'jquery' ) ); |
| [1195](#L1195) | wp\_localize\_script( 'themeisle-subscribe', 'ti', array() ); |
| [1196](#L1196) | wp\_enqueue\_media(); |
| [1197](#L1197) | $screen = get\_current\_screen(); |
| [1198](#L1198) | $screen->add\_help\_tab( |
| [1199](#L1199) | array( |
| [1200](#L1200) | 'title'   => esc\_html\_\_( 'Overview', 'intergeo-maps' ), |
| [1201](#L1201) | 'id'      => 'overview', |
| [1202](#L1202) | 'content' => sprintf( |
| [1203](#L1203) | '<p>%s</p>', implode( |
| [1204](#L1204) | '</p><p>', array( |
| [1205](#L1205) | esc\_html\_\_( "The library is a list to view all maps you have created in your system. The library is showing you 3x3 grid of maps' previews. You will see the same maps embedded into your posts at front end, as you see here. The library is paginated and if you have more than 9 maps, you will see pagination links under maps grid.", 'intergeo-maps' ), |
| [1206](#L1206) | esc\_html\_\_( 'To create a new map, click on "Add New" button next to the page title and map editor popup will appear. In case you want to edit a map, you can click on pencil icon in the right bottom corner of map preview box and edit popup window will appear.', 'intergeo-maps' ), |
| [1207](#L1207) | esc\_html\_\_( "If you want to delete a map, click on the trash icon in the right bottom corner of a map and confirm your action. Pay attention that whole information about the map will be removed from the system, but all shortcodes will be left where you embed it. However these deprecated shortcodes won't be rendered anymore, so you don't have to worry about it while the plugin is enabled.", 'intergeo-maps' ), |
| [1208](#L1208) | ) |
| [1209](#L1209) | ) |
| [1210](#L1210) | ), |
| [1211](#L1211) | ) |
| [1212](#L1212) | ); |
| [1213](#L1213) | $screen->add\_help\_tab( |
| [1214](#L1214) | array( |
| [1215](#L1215) | 'title'   => esc\_html\_\_( 'Shortcodes', 'intergeo-maps' ), |
| [1216](#L1216) | 'id'      => 'shortcodes', |
| [1217](#L1217) | 'content' => sprintf( |
| [1218](#L1218) | '<p>%s</p>', implode( |
| [1219](#L1219) | '</p><p>', array( |
| [1220](#L1220) | esc\_html\_\_( 'You can easily embed a map into your posts, pages, categories or tags descriptions and text widgets by copying shortcode which you can find in the input field of a map preview box.', 'intergeo-maps' ), |
| [1221](#L1221) | esc\_html\_\_( 'To specify a certain address just type it inside a shortcode, and a map will be automatically centered at this place. Also each shortcode could be extended with custom attributes like width, height, style, zoom and hook. Use standard CSS values for such attributes as width, height and style. Type an integer between 0 and 19 for zoom attribute. You can use hook attribute to set up a filter hook which you can use in your custom plugin or theme to configure all options of a map.', 'intergeo-maps' ), |
| [1222](#L1222) | ) |
| [1223](#L1223) | ) |
| [1224](#L1224) | ), |
| [1225](#L1225) | ) |
| [1226](#L1226) | ); |
| [1227](#L1227) | } |
| [1228](#L1228) |  |
| [1229](#L1229) | /\*\* |
| [1230](#L1230) | \* Render library of maps. |
| [1231](#L1231) | \*/ |
| [1232](#L1232) | function intergeo\_library() { |
| [1233](#L1233) | if ( filter\_input( INPUT\_GET, 'do' ) == 'delete' ) { |
| [1234](#L1234) | intergeo\_library\_delete(); |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | if ( filter\_input( INPUT\_GET, 'do' ) == 'dismiss-notice' && current\_user\_can( 'manage\_options' ) ) { |
| [1238](#L1238) | if ( wp\_verify\_nonce( filter\_input( INPUT\_GET, 'nonce' ), 'dismiss-notice' . filter\_input( INPUT\_SERVER, 'REMOTE\_ADDR', FILTER\_VALIDATE\_IP ) ) ) { |
| [1239](#L1239) | update\_option( 'intergeo\_maps\_otter\_notice', true ); |
| [1240](#L1240) | wp\_redirect( add\_query\_arg( 'page', INTERGEO\_PLUGIN\_NAME, admin\_url( 'upload.php' ) ) ); |
| [1241](#L1241) | exit; |
| [1242](#L1242) | } |
| [1243](#L1243) | } |
| [1244](#L1244) |  |
| [1245](#L1245) | $query      = new WP\_Query( |
| [1246](#L1246) | array( |
| [1247](#L1247) | 'orderby'        => 'ID', |
| [1248](#L1248) | 'order'          => 'DESC', |
| [1249](#L1249) | 'post\_type'      => INTERGEO\_PLUGIN\_NAME, |
| [1250](#L1250) | 'posts\_per\_page' => 9, |
| [1251](#L1251) | 'paged'          => filter\_input( |
| [1252](#L1252) | INPUT\_GET, 'pagenum', FILTER\_VALIDATE\_INT, array( |
| [1253](#L1253) | 'options' => array( |
| [1254](#L1254) | 'min\_range' => 1, |
| [1255](#L1255) | 'default'   => 1, |
| [1256](#L1256) | ), |
| [1257](#L1257) | ) |
| [1258](#L1258) | ), |
| [1259](#L1259) | ) |
| [1260](#L1260) | ); |
| [1261](#L1261) | $libraries  = array(); |
| [1262](#L1262) | $pagination = paginate\_links( |
| [1263](#L1263) | array( |
| [1264](#L1264) | 'base'    => add\_query\_arg( |
| [1265](#L1265) | array( |
| [1266](#L1266) | 'pagenum' => '%#%', |
| [1267](#L1267) | 'updated' => false, |
| [1268](#L1268) | ) |
| [1269](#L1269) | ), |
| [1270](#L1270) | 'format'  => '', |
| [1271](#L1271) | 'current' => max( 1, $query->get( 'paged' ) ), |
| [1272](#L1272) | 'total'   => $query->max\_num\_pages, |
| [1273](#L1273) | 'type'    => 'array', |
| [1274](#L1274) | ) |
| [1275](#L1275) | ); |
| [1276](#L1276) | require INTERGEO\_ABSPATH . '/templates/library/list.php'; |
| [1277](#L1277) | intergeo\_enqueue\_google\_maps\_script( $libraries ); |
| [1278](#L1278) | wp\_enqueue\_script( |
| [1279](#L1279) | 'intergeo-rendering', INTERGEO\_ABSURL . 'js/rendering.js', array( |
| [1280](#L1280) | 'jquery', |
| [1281](#L1281) | 'google-maps-v3', |
| [1282](#L1282) | ), INTERGEO\_VERSION |
| [1283](#L1283) | ); |
| [1284](#L1284) | wp\_enqueue\_script( |
| [1285](#L1285) | 'intergeo-library', INTERGEO\_ABSURL . 'js/library.js', array( |
| [1286](#L1286) | 'intergeo-rendering', |
| [1287](#L1287) | 'media-views', |
| [1288](#L1288) | ), INTERGEO\_VERSION |
| [1289](#L1289) | ); |
| [1290](#L1290) | wp\_localize\_script( |
| [1291](#L1291) | 'intergeo-rendering', 'intergeo\_options', array( |
| [1292](#L1292) | 'adsense' => array( |
| [1293](#L1293) | 'publisher\_id' => get\_option( 'intergeo\_adsense\_publisher\_id' ), |
| [1294](#L1294) | ), |
| [1295](#L1295) | ) |
| [1296](#L1296) | ); |
| [1297](#L1297) | do\_action( 'intergeo\_enqueue\_assets', array( 'intergeo-rendering' ) ); |
| [1298](#L1298) | } |
| [1299](#L1299) |  |
| [1300](#L1300) | /\*\* |
| [1301](#L1301) | \* Routine to delete a map. |
| [1302](#L1302) | \*/ |
| [1303](#L1303) | function intergeo\_library\_delete() { |
| [1304](#L1304) | if ( ! current\_user\_can( 'delete\_posts' ) ) { |
| [1305](#L1305) | return; |
| [1306](#L1306) | } |
| [1307](#L1307) | $id = intergeo\_decode( trim( filter\_input( INPUT\_GET, 'map' ) ) ); |
| [1308](#L1308) | if ( ! $id ) { |
| [1309](#L1309) | return; |
| [1310](#L1310) | } |
| [1311](#L1311) | $post = get\_post( $id ); |
| [1312](#L1312) | if ( wp\_verify\_nonce( filter\_input( INPUT\_GET, 'nonce' ), $id . filter\_input( INPUT\_SERVER, 'REMOTE\_ADDR', FILTER\_VALIDATE\_IP ) ) && $post->post\_type == INTERGEO\_PLUGIN\_NAME ) { |
| [1313](#L1313) | if ( wp\_delete\_post( $id, true ) ) { |
| [1314](#L1314) | intergeo\_set\_info( \_\_( 'The map was deleted successfully.', 'intergeo-maps' ) ); |
| [1315](#L1315) | } |
| [1316](#L1316) | } |
| [1317](#L1317) | if ( filter\_input( INPUT\_GET, 'noheader', FILTER\_VALIDATE\_BOOLEAN ) ) { |
| [1318](#L1318) | wp\_redirect( add\_query\_arg( 'page', INTERGEO\_PLUGIN\_NAME, admin\_url( 'upload.php' ) ) ); |
| [1319](#L1319) | exit; |
| [1320](#L1320) | } |
| [1321](#L1321) | } |
| [1322](#L1322) |  |
| [1323](#L1323) | /\*\* |
| [1324](#L1324) | \* Count the current maps number. |
| [1325](#L1325) | \* |
| [1326](#L1326) | \* @return int The current maps number. |
| [1327](#L1327) | \*/ |
| [1328](#L1328) | function intergeo\_get\_maps() { |
| [1329](#L1329) | $query = new WP\_Query( |
| [1330](#L1330) | array( |
| [1331](#L1331) | 'orderby'                => 'ID', |
| [1332](#L1332) | 'order'                  => 'DESC', |
| [1333](#L1333) | 'fields'                 => 'ids', |
| [1334](#L1334) | 'no\_found\_rows'          => true, |
| [1335](#L1335) | 'update\_post\_meta\_cache' => false, |
| [1336](#L1336) | 'update\_post\_term\_cache' => false, |
| [1337](#L1337) | 'post\_type'              => INTERGEO\_PLUGIN\_NAME, |
| [1338](#L1338) | 'posts\_per\_page'         => 11, |
| [1339](#L1339) | ) |
| [1340](#L1340) | ); |
| [1341](#L1341) |  |
| [1342](#L1342) | return $query->post\_count; |
| [1343](#L1343) | } |
| [1344](#L1344) |  |
| [1345](#L1345) | add\_action( 'admin\_notices', 'intergeo\_print\_messages' ); |
| [1346](#L1346) | /\*\* |
| [1347](#L1347) | \* Print messages. |
| [1348](#L1348) | \*/ |
| [1349](#L1349) | function intergeo\_print\_messages() { |
| [1350](#L1350) | global $pagenow; |
| [1351](#L1351) | if ( $pagenow != 'upload.php' ) { |
| [1352](#L1352) | return; |
| [1353](#L1353) | } |
| [1354](#L1354) | $messages = get\_option( 'intergeo\_messages', array() ); |
| [1355](#L1355) | $user\_id  = get\_current\_user\_id(); |
| [1356](#L1356) | if ( ! isset( $messages[ $user\_id ] ) ) { |
| [1357](#L1357) | return; |
| [1358](#L1358) | } |
| [1359](#L1359) | foreach ( $messages[ $user\_id ] as $message ) { |
| [1360](#L1360) | printf( $message[1] ? '<div class="updated"><p>%s</p></div>' : '<div class="error"><p>%s</p></div>', $message[0] ); |
| [1361](#L1361) | } |
| [1362](#L1362) | $messages[ $user\_id ] = array(); |
| [1363](#L1363) | update\_option( 'intergeo\_messages', $messages ); |
| [1364](#L1364) | } |
| [1365](#L1365) |  |
| [1366](#L1366) | /\*\* |
| [1367](#L1367) | \* Add options. |
| [1368](#L1368) | \*/ |
| [1369](#L1369) | function intergeo\_register\_settings() { |
| [1370](#L1370) | add\_option( 'intergeo\_maps\_otter\_notice', false ); |
| [1371](#L1371) | } |
| [1372](#L1372) | add\_action( 'admin\_init', 'intergeo\_register\_settings' ); |
| [1373](#L1373) |  |
| [1374](#L1374) | /\*\* |
| [1375](#L1375) | \* Show message. |
| [1376](#L1376) | \* |
| [1377](#L1377) | \* @param   string $message Message. |
| [1378](#L1378) | \* @param  string $is\_normal Type. |
| [1379](#L1379) | \* @param int    $user\_id User id. |
| [1380](#L1380) | \*/ |
| [1381](#L1381) | function intergeo\_set\_message( $message, $is\_normal, $user\_id = false ) { |
| [1382](#L1382) | $messages = get\_option( 'intergeo\_messages', array() ); |
| [1383](#L1383) | if ( $user\_id === false ) { |
| [1384](#L1384) | $user\_id = get\_current\_user\_id(); |
| [1385](#L1385) | } |
| [1386](#L1386) | if ( ! isset( $messages[ $user\_id ] ) ) { |
| [1387](#L1387) | $messages[ $user\_id ] = array(); |
| [1388](#L1388) | } |
| [1389](#L1389) | $messages[ $user\_id ][] = array( $message, $is\_normal ); |
| [1390](#L1390) | update\_option( 'intergeo\_messages', $messages ); |
| [1391](#L1391) | } |
| [1392](#L1392) |  |
| [1393](#L1393) | /\*\* |
| [1394](#L1394) | \* Show info message. |
| [1395](#L1395) | \* |
| [1396](#L1396) | \* @param   string $message Message to show. |
| [1397](#L1397) | \* @param int    $user\_id User id. |
| [1398](#L1398) | \*/ |
| [1399](#L1399) | function intergeo\_set\_info( $message, $user\_id = false ) { |
| [1400](#L1400) | intergeo\_set\_message( $message, 1, $user\_id ); |
| [1401](#L1401) | } |
| [1402](#L1402) |  |
| [1403](#L1403) | /\*\* |
| [1404](#L1404) | \* Error to show. |
| [1405](#L1405) | \* |
| [1406](#L1406) | \* @param string $message Message. |
| [1407](#L1407) | \* @param int    $user\_id User id. |
| [1408](#L1408) | \*/ |
| [1409](#L1409) | function intergeo\_set\_error( $message, $user\_id = false ) { |
| [1410](#L1410) | intergeo\_set\_message( $message, 0, $user\_id ); |
| [1411](#L1411) | } |
| [1412](#L1412) |  |
| [1413](#L1413) | /\*\* |
| [1414](#L1414) | \* Return the current plan that the user is using. |
| [1415](#L1415) | \* |
| [1416](#L1416) | \* @return int The current plan for pro version. |
| [1417](#L1417) | \*/ |
| [1418](#L1418) | function intergeo\_get\_plan() { |
| [1419](#L1419) |  |
| [1420](#L1420) | $plan = intval( get\_option( 'intergeo\_maps\_pro\_license\_plan', 0 ) ); |
| [1421](#L1421) |  |
| [1422](#L1422) | return $plan; |
| [1423](#L1423) | } |
| [1424](#L1424) |  |
| [1425](#L1425) | /\*\* |
| [1426](#L1426) | \* Either the user is using a personal plan or not. |
| [1427](#L1427) | \* |
| [1428](#L1428) | \* @return bool Personal plan status. |
| [1429](#L1429) | \*/ |
| [1430](#L1430) | function intergeo\_is\_personal() { |
| [1431](#L1431) | return ( defined( 'IntergeoMapsPro\_Version' ) ); |
| [1432](#L1432) | } |
| [1433](#L1433) |  |
| [1434](#L1434) | /\*\* |
| [1435](#L1435) | \* Either the user is using a developer plan or not. |
| [1436](#L1436) | \* |
| [1437](#L1437) | \* @return bool Developer plan status. |
| [1438](#L1438) | \*/ |
| [1439](#L1439) | function intergeo\_is\_developer() { |
| [1440](#L1440) | $plan = intval( intergeo\_get\_plan() ); |
| [1441](#L1441) | if ( $plan > 0 ) { |
| [1442](#L1442) | return true; |
| [1443](#L1443) | } |
| [1444](#L1444) |  |
| [1445](#L1445) | return false; |
| [1446](#L1446) | } |
| [1447](#L1447) |  |
| [1448](#L1448) | /\*\* |
| [1449](#L1449) | \* Either the user is using a agency plan or not. |
| [1450](#L1450) | \* |
| [1451](#L1451) | \* @return bool Agency plan status. |
| [1452](#L1452) | \*/ |
| [1453](#L1453) | function intergeo\_is\_agency() { |
| [1454](#L1454) | $plan = intval( intergeo\_get\_plan() ); |
| [1455](#L1455) | if ( $plan > 2 ) { |
| [1456](#L1456) | return true; |
| [1457](#L1457) | } |
| [1458](#L1458) |  |
| [1459](#L1459) | return false; |
| [1460](#L1460) | } |
| [1461](#L1461) |  |
| [1462](#L1462) | add\_filter( 'interge\_maps\_friendly\_name', 'intergeo\_maps\_change\_name' ); |
| [1463](#L1463) | /\*\* |
| [1464](#L1464) | \* Change notification name. |
| [1465](#L1465) | \* |
| [1466](#L1466) | \* @return string New name. |
| [1467](#L1467) | \*/ |
| [1468](#L1468) | function intergeo\_maps\_change\_name() { |
| [1469](#L1469) | return 'Intergeo Maps'; |
| [1470](#L1470) | } |
| [1471](#L1471) |  |
| [1472](#L1472) | add\_filter( 'intergeo\_themeisle\_sdk\_subscribe\_list', 'intergeo\_change\_subscribe\_list' ); |
| [1473](#L1473) | /\*\* |
| [1474](#L1474) | \* Alter the subscribe list id. |
| [1475](#L1475) | \* |
| [1476](#L1476) | \* @return int The list id. |
| [1477](#L1477) | \*/ |
| [1478](#L1478) | function intergeo\_change\_subscribe\_list() { |
| [1479](#L1479) | return 81; |
| [1480](#L1480) | } |
| [1481](#L1481) |  |
| [1482](#L1482) | require dirname( \_\_FILE\_\_ ) . '/subscribe/subscribe.php'; |
| [1483](#L1483) | $intergeo\_subscribe = new THEMEISLE\_SUBSCRIBE( INTERGEO\_PLUGIN\_NAME ); |
| [1484](#L1484) | $vendor\_file        = INTERGEO\_ABSPATH . '/vendor/autoload.php'; |
| [1485](#L1485) | if ( is\_readable( $vendor\_file ) ) { |
| [1486](#L1486) | include\_once( $vendor\_file ); |
| [1487](#L1487) | } |
| [1488](#L1488) |  |
| [1489](#L1489) | add\_filter( 'pirate\_parrot\_log', 'intergeo\_register\_parrot', 10, 1 ); |
| [1490](#L1490) | /\*\* |
| [1491](#L1491) | \* Register with parrot. |
| [1492](#L1492) | \*/ |
| [1493](#L1493) | function intergeo\_register\_parrot( $plugins ) { |
| [1494](#L1494) | $plugins[] = INTERGEO\_PLUGIN\_NAME; |
| [1495](#L1495) | return $plugins; |
| [1496](#L1496) | } |
| [1497](#L1497) |  |
| [1498](#L1498) |  |
| [1499](#L1499) | add\_filter( TI\_INTERGEO\_PLUGIN\_NAME . '\_enqueue\_recommend', 'intergeo\_upsell\_plugins', 10, 2 ); |
| [1500](#L1500) | /\*\* |
| [1501](#L1501) | \* Validates the correct screen on which the assets for upsell should be loaded. |
| [1502](#L1502) | \*/ |
| [1503](#L1503) | function intergeo\_upsell\_plugins( $return, $screen\_id ) { |
| [1504](#L1504) | return $screen\_id === 'media\_page\_intergeo'; |
| [1505](#L1505) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/intergeo-maps/tags/2.3.2/index.php?format=txt)
* [Original Format](/export/3222502/intergeo-maps/tags/2.3.2/index.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_c953c3e3_20250114_224813.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Google Maps Plugin by Intergeo <= 2.3.2 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Google Maps Plugin by Intergeo <= 2.3.2 - Authenticated (Contributor+) Stored Cross-Site Scripting via Shortcode

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-4887](https://www.cve.org/CVERecord?id=CVE-2023-4887) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | September 11, 2023 |
| Last Updated | October 24, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Google Maps Plugin by Intergeo plugin for WordPress is vulnerable to Stored Cross-Site Scripting via 'intergeo' shortcode in versions up to, and including, 2.3.2 due to insufficient input sanitization and output escaping on user supplied attributes. This makes it possible for authenticated attackers with contributor-level and above permissions to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/intergeo-maps/tags/2.3.2/index.php#L1146)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fintergeo-maps%2Fgoogle-maps-plugin-by-intergeo-232-authenticated-contributor-stored-cross-site-scripting-via-shortcode&t=Google%20Maps%20Plugin%20by%20Intergeo%20%3C%3D%202.3.2%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fintergeo-maps%2Fgoogle-maps-plugin-by-intergeo-232-authenticated-contributor-stored-cross-site-scripting-via-shortcode&text=Google%20Maps%20Plugin%20by%20Intergeo%20%3C%3D%202.3.2%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20Shortcode "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fintergeo-maps%2Fgoogle-maps-plugin-by-intergeo-232-authenticated-contributor-stored-cross-site-scripting-via-shortcode "LinkedIn")
Email

## Vulnerability Details for Google Maps Plugin by Intergeo

#### [Google Maps Plugin by Intergeo](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/intergeo-maps)

| Software Type | Plugin |
| --- | --- |
| Software Slug | intergeo-maps [(view on wordpress.org)](https://wordpress.org/plugins/intergeo-maps) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 2.3.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


