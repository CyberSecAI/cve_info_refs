=== Content from plugins.trac.wordpress.org_290ebed1_20250115_082231.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2970262%2Fwoo-bulk-editor%2Ftrunk%2Findex.php%3Fcontextall%3D1%26old%3D2968292%26old_path%3D%252Fwoo-bulk-editor%252Ftrunk%252Findex.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/2968292/woo-bulk-editor/trunk/index.php?old=2970262&old_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php)

---

# Changes in [woo-bulk-editor/trunk/index.php](/browser/woo-bulk-editor/trunk/index.php?rev=2970262 "Show entry in browser") [[2968292:2970262]](/log/woo-bulk-editor/trunk/index.php?rev=2970262&stop_rev=2968292 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [woo-bulk-editor/trunk/index.php](/browser/woo-bulk-editor/trunk/index.php?rev=2970262 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [woo-bulk-editor/trunk/index.php](/changeset/2970262/woo-bulk-editor/trunk/index.php?old=2968292&old_path=woo-bulk-editor%2Ftrunk%2Findex.php "Show the [2968292:2970262] differences restricted to woo-bulk-editor/trunk/index.php")

  | [r2968292](/browser/woo-bulk-editor/trunk/index.php?rev=2968292#L1 "Show revision 2968292 of this file in browser") | [r2970262](/browser/woo-bulk-editor/trunk/index.php?rev=2970262#L1 "Show revision 2970262 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\* |
  | 3 | 3 | Plugin Name: BEAR – Bulk Editor and Products Manager Professional for WooCommerce |
  | 4 | 4 | Plugin URI: https://bulk-editor.com/ |
  | 5 | 5 | Description: Tools for managing and bulk edit <strong>WooCommerce Products</strong> data in the reliable and flexible way! Be professionals with managing data of your e-shop! |
  | 6 | 6 | Requires at least: WP 4.9 |
  | 7 | 7 | Tested up to: WP 6.3 |
  | 8 | 8 | Author: realmag777 |
  | 9 | 9 | Author URI: https://pluginus.net/ |
  | 10 |  | Version: 1.1.~~3.3~~ |
  |  | 10 | Version: 1.1.4 |
  | 11 | 11 | Requires PHP: 7.2 |
  | 12 |  | Tags: woocommerce,~~woocommerce bulk edit,bulk edit,bulk,~~products editor |
  |  | 12 | Tags: woocommerce, woocommerce bulk edit, bulk edit, bulk, products editor |
  | 13 | 13 | Text Domain: woo-bulk-editor |
  | 14 | 14 | Domain Path: /languages |
  | 15 | 15 | WC requires at least: 3.6 |
  | 16 | 16 | WC tested up to: 8.1 |
  | 17 | 17 | Forum URI: https://pluginus.net/support/forum/woobe-woocommerce-bulk-editor-professional/ |
  | 18 | 18 | \*/ |
  | 19 | 19 |  |
  | 20 | 20 | //update\_option('woobe\_options\_' . get\_current\_user\_id(), ''); //absolute reset of the plugin settings - be care |
  | 21 | 21 | if (!defined('ABSPATH')) { |
  | 22 | 22 | exit; // Exit if accessed directly |
  | 23 | 23 | } |
  | 24 |  | //\*\*\* |
  |  | 24 |  |
  |  | 25 | if (defined('WOOBE\_PATH')) { |
  |  | 26 | add\_action('admin\_notices', function () { |
  |  | 27 | ?> |
  |  | 28 | <div class="notice notice-error is-dismissible"> |
  |  | 29 | <p><?php esc\_html\_e("Hello, looks like you bought and installed premium version of BEAR - WooCommerce Bulk Editor and Products Manager Professional, please deactivate free version before, then uninstall it. Any way: 2 versions of the same plugin cannot be activated on the same time! Use most new one version.", 'woo-bulk-editor'); ?></p> |
  |  | 30 | </div> |
  |  | 31 | <?php |
  |  | 32 | }); |
  |  | 33 |  |
  |  | 34 | return false; |
  |  | 35 | } |
  |  | 36 |  |
  |  | 37 | //\*\*\* |
  |  | 38 |  |
  | 25 | 39 | add\_action('before\_woocommerce\_init', function () { |
  | 26 | 40 | if (class\_exists('\Automattic\WooCommerce\Utilities\FeaturesUtil')) { |
  | 27 | 41 | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility('custom\_order\_tables', \_\_FILE\_\_, true); |
  | 28 | 42 | } |
  | 29 | 43 | }); |
  | 30 | 44 |  |
  | 31 | 45 | define('WOOBE\_PATH', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 32 | 46 | define('WOOBE\_LINK', plugin\_dir\_url(\_\_FILE\_\_)); |
  | 33 | 47 | define('WOOBE\_ASSETS\_LINK', WOOBE\_LINK . 'assets/'); |
  | 34 | 48 | define('WOOBE\_DATA\_PATH', WOOBE\_PATH . 'data/'); |
  | 35 | 49 | define('WOOBE\_PLUGIN\_NAME', plugin\_basename(\_\_FILE\_\_)); |
  | 36 |  | define('WOOBE\_VERSION', '1.1.~~3.3~~'); |
  |  | 50 | define('WOOBE\_VERSION', '1.1.4'); |
  | 37 | 51 | //define('WOOBE\_VERSION', uniqid('woobe-'));//dev |
  | 38 | 52 | define('WOOBE\_MIN\_WOOCOMMERCE\_VERSION', '3.6'); |
  | 39 | 53 |  |
  | 40 |  | woobe\_init\_translates(); //must be on top to init strings in folder 'data' |
  |  | 54 | //+++ |
  |  | 55 |  |
  |  | 56 | try { |
  |  | 57 | $lang\_domain = 'woo-bulk-editor'; |
  |  | 58 | $lang\_dir = WP\_CONTENT\_DIR . '/languages/plugins/'; |
  |  | 59 | $locale = get\_locale(); |
  |  | 60 | unload\_textdomain($lang\_domain); |
  |  | 61 |  |
  |  | 62 | if (is\_file("{$lang\_dir}{$lang\_domain}-{$locale}.mo")) { |
  |  | 63 | load\_textdomain($lang\_domain, "{$lang\_dir}{$lang\_domain}-{$locale}.mo"); |
  |  | 64 | } else { |
  |  | 65 | if (is\_file(WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo")) { |
  |  | 66 | load\_textdomain($lang\_domain, WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo"); |
  |  | 67 | } else { |
  |  | 68 | load\_plugin\_textdomain($lang\_domain, false, WOOBE\_PATH . 'languages'); |
  |  | 69 | } |
  |  | 70 | } |
  |  | 71 | } catch (Exception $e) { |
  |  | 72 | //+++ |
  |  | 73 | } |
  |  | 74 |  |
  |  | 75 | //+++ |
  | 41 | 76 | //libs |
  | 42 | 77 | include WOOBE\_PATH . 'lib/storage.php'; |
  | 43 | 78 |  |
  | 44 | 79 | //data |
  | 45 | 80 | include\_once WOOBE\_DATA\_PATH . 'fields.php'; |
  | 46 | 81 | include\_once WOOBE\_DATA\_PATH . 'settings.php'; |
  | 47 | 82 |  |
  | 48 | 83 | //classes |
  | 49 | 84 | include WOOBE\_PATH . 'classes/helper.php'; |
  | 50 | 85 | include WOOBE\_PATH . 'classes/models/profiles.php'; |
  | 51 | 86 | include WOOBE\_PATH . 'classes/models/settings.php'; |
  | 52 | 87 | include WOOBE\_PATH . 'classes/models/products.php'; |
  | 53 | 88 | include WOOBE\_PATH . 'classes/ext.php'; |
  | 54 | 89 | include WOOBE\_PATH . 'classes/alert.php'; |
  | 55 | 90 |  |
  | 56 |  | //2~~3-05~~-2023 |
  |  | 91 | //22-09-2023 |
  | 57 | 92 | final class WOOBE { |
  | 58 | 93 |  |
  | 59 | 94 | public $storage = NULL; |
  | 60 | 95 | public $settings = NULL; |
  | 61 | 96 | public $products = NULL; |
  | 62 | 97 | public $profiles = NULL; |
  | 63 | 98 | private $ext = array('filters', 'bulk', 'export', 'meta', 'history', 'calculator', 'info', 'fprofiles', 'bulkoperations', 'vendor\_area'); |
  | 64 | 99 | public $show\_notes = true; |
  |  | 100 | //extensions |
  |  | 101 | public $filters = null; |
  |  | 102 | public $bulk = null; |
  |  | 103 | public $export = null; |
  |  | 104 | public $meta = null; |
  |  | 105 | public $history = null; |
  |  | 106 | public $calculator = null; |
  |  | 107 | public $info = null; |
  |  | 108 | public $fprofiles = null; |
  |  | 109 | public $bulkoperations = null; |
  |  | 110 | public $vendor\_area = null; |
  | 65 | 111 |  |
  | 66 | 112 | public function \_\_construct() { |
  | 67 | 113 | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
  | 68 | 114 | //fix for sheduled post |
  | 69 | 115 | add\_filter('woobe\_product\_statuses', array($this, 'add\_statuses')); |
  | 70 | 116 | } |
  | 71 | 117 |  |
  | 72 | 118 | public function init() { |
  | 73 | 119 |  |
  | 74 | 120 | if (!is\_admin()) { |
  | 75 | 121 | return; |
  | 76 | 122 | } |
  | 77 | 123 |  |
  | 78 | 124 | if (!class\_exists('WooCommerce')) { |
  | 79 | 125 | return; |
  | 80 | 126 | } |
  | 81 | 127 |  |
  | 82 | 128 | //no one operation is possible if user is not products administrator!! |
  | 83 | 129 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 84 | 130 | return; |
  | 85 | 131 | } |
  | 86 | 132 |  |
  | 87 | 133 | $this->ask\_favour(); |
  | 88 | 134 |  |
  | 89 | 135 | //\*\*\* |
  | 90 | 136 |  |
  | 91 | 137 | add\_filter('plugin\_action\_links\_' . WOOBE\_PLUGIN\_NAME, array($this, 'plugin\_action\_links'), 50); |
  | 92 | 138 |  |
  | 93 | 139 | //\*\*\* |
  | 94 | 140 |  |
  | 95 | 141 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woobe') { |
  | 96 | 142 | //WOOCS compatibility |
  | 97 | 143 | if (class\_exists('WOOCS')) { |
  | 98 | 144 | global $WOOCS; |
  | 99 | 145 | $WOOCS->reset\_currency(); |
  | 100 | 146 | remove\_filter('woocommerce\_product\_get\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
  | 101 | 147 | remove\_filter('woocommerce\_product\_variation\_get\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
  | 102 | 148 | remove\_filter('woocommerce\_product\_variation\_get\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
  | 103 | 149 | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($WOOCS, 'raw\_sale\_price\_filter'), 9999, 2); |
  | 104 | 150 | remove\_filter('woocommerce\_product\_get\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
  | 105 | 151 | remove\_filter('woocommerce\_product\_get\_sale\_price', array($WOOCS, 'raw\_woocommerce\_price\_sale'), 9999, 2); |
  | 106 | 152 | remove\_filter('woocommerce\_get\_variation\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 4); |
  | 107 | 153 | remove\_filter('woocommerce\_get\_variation\_sale\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 4); |
  | 108 | 154 | remove\_filter('woocommerce\_variation\_prices', array($WOOCS, 'woocommerce\_variation\_prices'), 9999, 3); |
  | 109 | 155 | } |
  | 110 | 156 |  |
  | 111 | 157 | add\_action('admin\_notices', function () { |
  | 112 | 158 | $user\_id = get\_current\_user\_id(); |
  | 113 | 159 | if (!get\_user\_meta($user\_id, 'woobe\_notice\_dismissed')) { |
  | 114 | 160 | echo '<div class="notice notice-warning"><p>' . sprintf(esc\_html\_\_('If you not familiar with the plugin, firstly %s please', 'woo-bulk-editor'), WOOBE\_HELPER::draw\_link(array( |
  | 115 | 161 | 'title' => esc\_html\_\_('visit this page', 'woo-bulk-editor'), |
  | 116 | 162 | 'href' => 'https://bulk-editor.com/document/woocommerce-products-editor/', |
  | 117 | 163 | 'target' => '\_blank', |
  | 118 | 164 | 'style' => 'line-height: 2em;' |
  | 119 | 165 | ))) . '</p><a href="edit.php?post\_type=product&page=woobe&woobe-notice-dismissed=1" class="notice-dismiss"></a></div>'; |
  | 120 | 166 | } |
  | 121 | 167 | }); |
  | 122 | 168 | add\_action('admin\_init', function () { |
  | 123 | 169 | $user\_id = get\_current\_user\_id(); |
  | 124 | 170 | if (isset($\_GET['woobe-notice-dismissed'])) { |
  | 125 | 171 | add\_user\_meta($user\_id, 'woobe\_notice\_dismissed', 'true', true); |
  | 126 | 172 | } |
  | 127 | 173 | }); |
  | 128 | 174 | } |
  | 129 | 175 |  |
  | 130 | 176 | //side bar menu |
  | 131 | 177 | add\_action('admin\_menu', function () { |
  | 132 | 178 | add\_submenu\_page('edit.php?post\_type=product', 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), 'manage\_woocommerce', 'woobe', function () { |
  | 133 | 179 | $this->print\_plugin\_options(); |
  | 134 | 180 | }); |
  | 135 | 181 | }, 99); |
  | 136 | 182 |  |
  | 137 | 183 | add\_action('admin\_bar\_menu', function ($wp\_admin\_bar) { |
  | 138 |  | $opt = get\_option('woobe\_options\_' . ~~get\_current\_user\_id(~~)); //not beauty but we need it here |
  |  | 184 | $opt = get\_option('woobe\_options\_' . apply\_filters('woobe\_settings\_key\_options', get\_current\_user\_id())); //not beauty but we need it here |
  | 139 | 185 | $show = true; |
  | 140 | 186 | if (isset($opt['options']['show\_admin\_bar\_menu\_btn'])) { |
  | 141 | 187 | $show = intval($opt['options']['show\_admin\_bar\_menu\_btn']); |
  | 142 | 188 | } |
  | 143 | 189 |  |
  | 144 | 190 | if ($show) { |
  | 145 | 191 | $args = array( |
  | 146 | 192 | 'id' => 'woobe-btn', |
  | 147 | 193 | 'title' => 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), |
  | 148 | 194 | 'href' => admin\_url('edit.php?post\_type=product&page=woobe'), |
  | 149 | 195 | 'meta' => array( |
  | 150 | 196 | 'class' => 'wp-admin-bar-woobe-btn', |
  | 151 | 197 | 'title' => 'BEAR - WooCommerce Bulk Editor' |
  | 152 | 198 | ) |
  | 153 | 199 | ); |
  | 154 | 200 | $wp\_admin\_bar->add\_node($args); |
  | 155 | 201 | } |
  | 156 | 202 | unset($opt); |
  | 157 | 203 | }, 250); |
  | 158 | 204 |  |
  | 159 | 205 | //do not init hooks and all other parts of the plugins as we not need it on all site pages |
  | 160 | 206 | if (!$this->is\_should\_init()) { |
  | 161 | 207 | return; |
  | 162 | 208 | } |
  | 163 | 209 |  |
  | 164 | 210 | //\*\*\* |
  | 165 | 211 | //include extensions and their hooks |
  | 166 | 212 | if (!empty($this->ext)) { |
  | 167 | 213 | foreach ($this->ext as $ext\_slug) { |
  | 168 | 214 | include WOOBE\_PATH . 'ext' . DIRECTORY\_SEPARATOR . $ext\_slug . DIRECTORY\_SEPARATOR . $ext\_slug . '.php'; |
  | 169 | 215 | $class\_name = 'WOOBE\_' . strtoupper($ext\_slug); |
  | 170 | 216 | $this->$ext\_slug = new $class\_name(); |
  | 171 | 217 | } |
  | 172 | 218 | } |
  | 173 | 219 |  |
  | 174 | 220 | //woobe\_ext - include extensions from wp-content folder |
  | 175 | 221 | $woobe\_more\_ext\_path = WP\_CONTENT\_DIR . DIRECTORY\_SEPARATOR . 'woobe\_ext'; |
  | 176 | 222 | if (file\_exists($woobe\_more\_ext\_path)) { |
  | 177 | 223 | $dir = new DirectoryIterator($woobe\_more\_ext\_path); |
  | 178 | 224 | foreach ($dir as $fileinfo) { |
  | 179 | 225 | if ($fileinfo->isDir() AND !$fileinfo->isDot()) { |
  | 180 | 226 | $ext\_slug = trim($fileinfo->getFilename()); |
  | 181 | 227 | include $woobe\_more\_ext\_path . DIRECTORY\_SEPARATOR . $ext\_slug . DIRECTORY\_SEPARATOR . $ext\_slug . '.php'; |
  | 182 | 228 | $class\_name = 'WOOBE\_' . strtoupper($ext\_slug); |
  | 183 | 229 | $this->$ext\_slug = new $class\_name(); |
  | 184 | 230 | $this->ext[] = $ext\_slug; |
  | 185 | 231 | } |
  | 186 | 232 | } |
  | 187 | 233 | } |
  | 188 | 234 |  |
  | 189 | 235 |  |
  | 190 | 236 | //\*\*\* |
  | 191 | 237 | //init variables and hooks of the extensions will be applied, for example hook woobe\_extend\_fields |
  | 192 | 238 | $this->storage = new WOOBE\_STORAGE(); |
  | 193 | 239 | $this->settings = new WOOBE\_SETTINGS(); |
  | 194 | 240 |  |
  | 195 | 241 | $this->profiles = new WOOBE\_PROFILES($this->settings); |
  | 196 | 242 | $this->products = new WOOBE\_PRODUCTS($this->settings, $this->storage); |
  | 197 | 243 |  |
  | 198 | 244 | if (!empty($this->ext)) { |
  | 199 | 245 | foreach ($this->ext as $ext\_slug) { |
  | 200 | 246 | //we do it to allow ext hooks works everywhere (in the application and all its extensions) |
  | 201 | 247 | $this->$ext\_slug->init\_vars($this->storage, $this->profiles, $this->settings, $this->products); |
  | 202 | 248 | } |
  | 203 | 249 | } |
  | 204 | 250 |  |
  | 205 | 251 |  |
  | 206 | 252 | //\*\*\* |
  | 207 | 253 | //load\_plugin\_textdomain('woo-bulk-editor', false, 'woo-bulk-editor/languages'); |
  | 208 | 254 | //ajax |
  | 209 | 255 | add\_action('wp\_ajax\_woobe\_get\_products', array($this, 'woobe\_get\_products'), 1); |
  | 210 | 256 | add\_action('wp\_ajax\_woobe\_update\_page\_field', array($this, 'woobe\_update\_page\_field'), 1); |
  | 211 | 257 | add\_action('wp\_ajax\_woobe\_redraw\_table\_row', array($this, 'woobe\_redraw\_table\_row'), 1); |
  | 212 | 258 | add\_action('wp\_ajax\_woobe\_get\_post\_field', array($this, 'get\_post\_field'), 1); |
  | 213 | 259 | add\_action('wp\_ajax\_woobe\_get\_downloads', array($this, 'get\_downloads'), 1); |
  | 214 | 260 | add\_action('wp\_ajax\_woobe\_get\_gallery', array($this, 'woobe\_get\_gallery'), 1); |
  | 215 | 261 | add\_action('wp\_ajax\_woobe\_get\_upsells', array($this, 'woobe\_get\_upsells'), 1); |
  | 216 | 262 | add\_action('wp\_ajax\_woobe\_get\_cross\_sells', array($this, 'woobe\_get\_cross\_sells'), 1); |
  | 217 | 263 | add\_action('wp\_ajax\_woobe\_get\_grouped', array($this, 'woobe\_get\_grouped'), 1); |
  | 218 | 264 |  |
  | 219 | 265 | add\_action('wp\_ajax\_woobe\_create\_new\_product', array($this, 'woobe\_create\_new\_product'), 1); |
  | 220 | 266 | add\_action('wp\_ajax\_woobe\_duplicate\_products', array($this, 'woobe\_duplicate\_products'), 1); |
  | 221 | 267 | add\_action('wp\_ajax\_woobe\_delete\_products', array($this, 'woobe\_delete\_products'), 1); |
  | 222 | 268 |  |
  | 223 | 269 | add\_action('wp\_ajax\_woobe\_create\_new\_term', array($this, 'woobe\_create\_new\_term'), 1); |
  | 224 | 270 | add\_action('wp\_ajax\_woobe\_update\_tax\_term', array($this, 'woobe\_update\_tax\_term'), 1); |
  | 225 | 271 | add\_action('wp\_ajax\_woobe\_delete\_tax\_term', array($this, 'woobe\_delete\_tax\_term'), 1); |
  | 226 | 272 |  |
  | 227 | 273 | //\*\*\* |
  | 228 | 274 | add\_action('wp\_ajax\_woobe\_title\_autocomplete', array($this, 'woobe\_title\_autocomplete')); |
  | 229 | 275 | add\_action('wp\_ajax\_woobe\_save\_options', array($this, 'woobe\_save\_options'), 1); |
  | 230 | 276 |  |
  | 231 | 277 | //\*\*\* |
  | 232 | 278 | add\_post\_type\_support('product', 'author'); |
  | 233 | 279 |  |
  | 234 | 280 | $alert = new WOOBE\_ADV(); |
  | 235 | 281 | $alert->init(); |
  | 236 | 282 | } |
  | 237 | 283 |  |
  | 238 | 284 | /\*\* |
  | 239 | 285 | \* Show action links on the plugins page screen |
  | 240 | 286 | \*/ |
  | 241 | 287 | public function plugin\_action\_links($links) { |
  | 242 | 288 |  |
  | 243 | 289 | $buttons = array( |
  | 244 | 290 | '<a href="' . admin\_url('edit.php?post\_type=product&page=woobe') . '">' . esc\_html\_\_('Products Editor', 'woo-bulk-editor') . '</a>', |
  | 245 | 291 | '<a target="\_blank" href="https://bulk-editor.com/"><span class="icon-book"></span>&nbsp;' . esc\_html\_\_('Documentation', 'woo-bulk-editor') . '</a>' |
  | 246 | 292 | ); |
  | 247 | 293 |  |
  | 248 | 294 | if ($this->show\_notes) { |
  | 249 | 295 | $buttons[] = '<a target="\_blank" style="color: red; font-weight: bold;" href="' . esc\_url('https://pluginus.net/affiliate/woocommerce-bulk-editor') . '">' . esc\_html\_\_('Go Pro!', 'woo-bulk-editor') . '</a>'; |
  | 250 | 296 | } |
  | 251 | 297 |  |
  | 252 | 298 | return array\_merge($buttons, $links); |
  | 253 | 299 | } |
  | 254 | 300 |  |
  | 255 | 301 | public function admin\_enqueue\_scripts() { |
  | 256 | 302 | if (isset($\_GET['page']) AND $\_GET['page'] == 'woobe') { |
  | 257 | 303 | ?> |
  | 258 | 304 | <script> |
  | 259 | 305 | var lang = { |
  | 260 | 306 | move: "<?php echo esc\_html\_\_('move', 'woo-bulk-editor') ?>", |
  | 261 | 307 | search: "<?php echo esc\_html\_\_('Search', 'woo-bulk-editor') ?>", |
  | 262 | 308 | rest\_failed: "<?php echo esc\_html\_\_('Failed', 'woo-bulk-editor') ?>", |
  | 263 | 309 | error: "<?php echo esc\_html\_\_('Error', 'woo-bulk-editor') ?>", |
  | 264 | 310 | delete: "<?php echo esc\_html\_\_('delete', 'woo-bulk-editor') ?>", |
  | 265 | 311 | ignore: "<?php echo esc\_html\_\_('ignore', 'woo-bulk-editor') ?>", |
  | 266 | 312 | no\_deletable: "<?php echo esc\_html\_\_('This is not deletable!', 'woo-bulk-editor') ?>", |
  | 267 | 313 | no\_items: "<?php echo esc\_html\_\_('no items', 'woo-bulk-editor') ?>", |
  | 268 | 314 | none: "<?php echo esc\_html\_\_('none', 'woo-bulk-editor') ?>", |
  | 269 | 315 | no\_data: "<?php echo esc\_html\_\_('no data', 'woo-bulk-editor') ?>", |
  | 270 | 316 | loading: "<?php echo esc\_html\_\_('Loading', 'woo-bulk-editor') ?> ...", |
  | 271 | 317 | loaded: "<?php echo esc\_html\_\_('Loaded', 'woo-bulk-editor') ?>.", |
  | 272 | 318 | saved: "<?php echo esc\_html\_\_('Saved', 'woo-bulk-editor') ?>.", |
  | 273 | 319 | saving: "<?php echo esc\_html\_\_('Saving', 'woo-bulk-editor') ?> ...", |
  | 274 | 320 | apply: "<?php echo esc\_html\_\_('Apply', 'woo-bulk-editor') ?>", |
  | 275 | 321 | cancel: "<?php echo esc\_html\_\_('Cancel', 'woo-bulk-editor') ?>", |
  | 276 | 322 | canceled: "<?php echo esc\_html\_\_('Canceled', 'woo-bulk-editor') ?>", |
  | 277 | 323 | sure: "<?php echo esc\_html\_\_('Sure?', 'woo-bulk-editor') ?>", |
  | 278 | 324 | creating: "<?php echo esc\_html\_\_('Creating', 'woo-bulk-editor') ?> ...", |
  | 279 | 325 | created: "<?php echo esc\_html\_\_('Created!', 'woo-bulk-editor') ?>", |
  | 280 | 326 | duplicating: "<?php echo esc\_html\_\_('Duplicating', 'woo-bulk-editor') ?> ...", |
  | 281 | 327 | duplicated: "<?php echo esc\_html\_\_('Duplicated!', 'woo-bulk-editor') ?>", |
  | 282 | 328 | deleting: "<?php echo esc\_html\_\_('Deleting', 'woo-bulk-editor') ?> ...", |
  | 283 | 329 | deleted: "<?php echo esc\_html\_\_('Deleted!', 'woo-bulk-editor') ?>", |
  | 284 | 330 | reseting: "<?php echo esc\_html\_\_('Reseting', 'woo-bulk-editor') ?> ...", |
  | 285 | 331 | reseted: "<?php echo esc\_html\_\_('Reseted!', 'woo-bulk-editor') ?>", |
  | 286 | 332 | upload\_image: "<?php echo esc\_html\_\_('Upload image', 'woo-bulk-editor') ?>", |
  | 287 | 333 | upload\_images: "<?php echo esc\_html\_\_('Upload images', 'woo-bulk-editor') ?>", |
  | 288 | 334 | select\_all: "<?php echo esc\_html\_\_('Select all', 'woo-bulk-editor') ?>", |
  | 289 | 335 | deselect\_all: "<?php echo esc\_html\_\_('Deselect all', 'woo-bulk-editor') ?>", |
  | 290 | 336 | upload\_file: "<?php echo esc\_html\_\_('Upload file', 'woo-bulk-editor') ?>", |
  | 291 | 337 | fill\_up\_data: "<?php echo esc\_html\_\_('Fill up the data please!', 'woo-bulk-editor') ?>", |
  | 292 | 338 | enter\_duplicate\_count: "<?php echo esc\_html\_\_('Enter how many time duplicate selected product(s)!', 'woo-bulk-editor') ?>", |
  | 293 | 339 | enter\_new\_count: "<?php echo esc\_html\_\_('Enter how many new product(s) to create!', 'woo-bulk-editor') ?>", |
  | 294 | 340 | search\_input\_placeholder: "<?php echo esc\_html\_\_('Text search by title or SKU', 'woo-bulk-editor') ?>", |
  | 295 | 341 | show\_panel: "<?php esc\_html\_e('Show: Filters/Bulk Edit/Export', 'woo-bulk-editor') ?>", |
  | 296 | 342 | close\_panel: "<?php esc\_html\_e('Hide: Filters/Bulk Edit/Export', 'woo-bulk-editor') ?>", |
  | 297 | 343 | per\_page: "<?php esc\_html\_e('Per page', 'woo-bulk-editor') ?>", |
  | 298 | 344 | color\_picker\_col: "<?php esc\_html\_e('Select background color', 'woo-bulk-editor') ?>", |
  | 299 | 345 | color\_picker\_txt: "<?php esc\_html\_e('Select text color', 'woo-bulk-editor') ?>", |
  | 300 | 346 | sEmptyTable: "<?php esc\_html\_e('No data available in the table', 'woo-bulk-editor') ?>", |
  | 301 | 347 | sInfo: "<?php esc\_html\_e('Showing \_START\_ to \_END\_ of \_TOTAL\_ entries', 'woo-bulk-editor') ?>", |
  | 302 | 348 | sInfoEmpty: "<?php esc\_html\_e('Showing 0 to 0 of 0 entries', 'woo-bulk-editor') ?>", |
  | 303 | 349 | sInfoFiltered: "<?php esc\_html\_e('(filtered from \_MAX\_ total entries)', 'woo-bulk-editor') ?>", |
  | 304 | 350 | sLoadingRecords: "<?php esc\_html\_e('Loading...', 'woo-bulk-editor') ?>", |
  | 305 | 351 | sProcessing: "<?php esc\_html\_e('Processing...', 'woo-bulk-editor') ?>", |
  | 306 | 352 | sZeroRecords: "<?php esc\_html\_e('No matching records found', 'woo-bulk-editor') ?>", |
  | 307 | 353 | sFirst: "<?php esc\_html\_e('First', 'woo-bulk-editor') ?>", |
  | 308 | 354 | sLast: "<?php esc\_html\_e('Last', 'woo-bulk-editor') ?>", |
  | 309 | 355 | sNext: "<?php esc\_html\_e('Next', 'woo-bulk-editor') ?>", |
  | 310 | 356 | sPrevious: "<?php esc\_html\_e('Previous', 'woo-bulk-editor') ?>", |
  | 311 | 357 | action\_state\_1: "<?php esc\_html\_e('all the products on the site', 'woo-bulk-editor') ?>", |
  | 312 | 358 | action\_state\_2: "<?php esc\_html\_e('the filtered products. To remove the products filtering press reset button on the tools panel below', 'woo-bulk-editor') ?>", |
  | 313 | 359 | action\_state\_31: "<?php esc\_html\_e('the selected products (variations)', 'woo-bulk-editor') ?>", |
  | 314 | 360 | action\_state\_32: "<?php esc\_html\_e('You can reset selection of the products by its reset button on the panel of the editor OR uncheck them manually!', 'woo-bulk-editor') ?>", |
  | 315 | 361 | term\_maybe\_exist: "<?php esc\_html\_e('Maybe term(s) with such name(s) already exists!', 'woo-bulk-editor') ?>", |
  | 316 | 362 | free\_ver\_profiles: "<?php esc\_html\_e('In FREE version of the plugin you can create one profile only!', 'woo-bulk-editor') ?>", |
  | 317 | 363 | append\_sub\_item: "<?php esc\_html\_e('append sub item', 'woo-bulk-editor') ?>", |
  | 318 | 364 | is\_deactivated\_in\_free: "<?php esc\_html\_e('This field is deactivated in FREE version for bulk edit!', 'woo-bulk-editor') ?>", |
  | 319 | 365 | checked\_products: "<?php esc\_html\_e('Products checked', 'woo-bulk-editor') ?>" |
  | 320 | 366 | }; |
  | 321 | 367 |  |
  | 322 | 368 | var woobe\_settings = { |
  | 323 | 369 | show\_thumbnail\_preview: <?php echo intval($this->settings->show\_thumbnail\_preview) ?>, |
  | 324 | 370 | load\_switchers: <?php echo intval($this->settings->load\_switchers) ?>, |
  | 325 | 371 | autocomplete\_max\_elem\_count: <?php echo intval($this->settings->autocomplete\_max\_elem\_count) ?>, |
  | 326 | 372 | show\_notes: <?php echo intval($this->show\_notes) ?> |
  | 327 | 373 | }; |
  | 328 | 374 |  |
  | 329 | 375 | var woobe\_assets\_link = "<?php echo WOOBE\_ASSETS\_LINK ?>"; |
  | 330 | 376 | var spinner = woobe\_assets\_link + "/images/spinner.gif"; |
  | 331 | 377 |  |
  | 332 | 378 | //\*\*\* |
  | 333 | 379 |  |
  | 334 | 380 | <?php |
  | 335 | 381 | if (class\_exists('SitePress')) { |
  | 336 | 382 | add\_filter('woobe\_current\_language', function () { |
  | 337 | 383 | //WPML compatibility |
  | 338 | 384 | //because if it will be selected 'all' language - will be shown default one |
  | 339 | 385 | return ICL\_LANGUAGE\_CODE; |
  | 340 | 386 | }); |
  | 341 | 387 | } |
  | 342 | 388 | ?> |
  | 343 | 389 |  |
  | 344 | 390 | var woobe\_lang = '<?php echo apply\_filters('woobe\_current\_language', '') ?>';//for translating compatibilities |
  | 345 | 391 |  |
  | 346 | 392 |  |
  | 347 | 393 |  |
  | 348 | 394 | </script> |
  | 349 | 395 |  |
  | 350 | 396 | <?php |
  | 351 | 397 | wp\_enqueue\_style('open\_sans\_font', 'https://fonts.googleapis.com/css?family=Open+Sans'); |
  | 352 | 398 | wp\_enqueue\_style('woobe-bootstrap-grid', WOOBE\_ASSETS\_LINK . 'css/bootstrap-grid.css', array(), WOOBE\_VERSION); |
  | 353 | 399 | wp\_enqueue\_style('woobe', WOOBE\_ASSETS\_LINK . 'css/woobe.css', array(), WOOBE\_VERSION); |
  | 354 | 400 | wp\_enqueue\_style('woobe\_scrollbar', WOOBE\_ASSETS\_LINK . 'css/jquery.scrollbar.css', array(), WOOBE\_VERSION); |
  | 355 | 401 | wp\_enqueue\_style('woobe\_fontello', WOOBE\_ASSETS\_LINK . 'css/fontello.css', array(), WOOBE\_VERSION); |
  | 356 | 402 |  |
  | 357 | 403 | //\*\*\* |
  | 358 | 404 |  |
  | 359 | 405 | wp\_enqueue\_media(); |
  | 360 | 406 | wp\_enqueue\_script('media-upload'); |
  | 361 | 407 | wp\_enqueue\_style('thickbox'); |
  | 362 | 408 | wp\_enqueue\_script('thickbox'); |
  | 363 | 409 |  |
  | 364 | 410 | wp\_enqueue\_style('wp-color-picker'); |
  | 365 | 411 | wp\_enqueue\_script('wp-color-picker'); |
  | 366 | 412 |  |
  | 367 | 413 | wp\_enqueue\_style('woobe\_datatables', WOOBE\_ASSETS\_LINK . 'css/tables.css', array(), WOOBE\_VERSION); |
  | 368 | 414 | wp\_enqueue\_script('woobe\_datatables\_net', WOOBE\_ASSETS\_LINK . 'js/jquery.dataTables.js', array('jquery'), WOOBE\_VERSION); |
  | 369 | 415 |  |
  | 370 | 416 | wp\_enqueue\_script('woobe\_data\_tables', WOOBE\_ASSETS\_LINK . 'js/data-tables.js', array('woobe\_datatables\_net'), WOOBE\_VERSION); |
  | 371 | 417 |  |
  | 372 | 418 | wp\_enqueue\_style('woobe\_data\_tables\_fc', 'https://cdn.datatables.net/fixedcolumns/4.2.1/css/fixedColumns.dataTables.min.css'); |
  | 373 | 419 | wp\_enqueue\_script('woobe\_data\_tables\_fc', 'https://cdn.datatables.net/fixedcolumns/4.2.1/js/dataTables.fixedColumns.min.js'); |
  | 374 | 420 |  |
  | 375 | 421 | wp\_enqueue\_script('woobe\_jquery\_growl', WOOBE\_ASSETS\_LINK . 'js/jquery.growl.js', array('jquery'), WOOBE\_VERSION); |
  | 376 | 422 |  |
  | 377 | 423 | wp\_enqueue\_style('woobe\_switchery', WOOBE\_ASSETS\_LINK . 'js/switchery/switchery.min.css', array(), WOOBE\_VERSION); |
  | 378 | 424 | wp\_enqueue\_script('woobe\_switchery', WOOBE\_ASSETS\_LINK . 'js/switchery/switchery.min.js', array('jquery'), WOOBE\_VERSION); |
  | 379 | 425 |  |
  | 380 | 426 | wp\_enqueue\_style('woobe\_chosen', WOOBE\_ASSETS\_LINK . 'js/chosen/chosen.min.css', array(), WOOBE\_VERSION); |
  | 381 | 427 | wp\_enqueue\_script('woobe\_chosen', WOOBE\_ASSETS\_LINK . 'js/chosen/chosen.jquery.min.js', array('jquery'), WOOBE\_VERSION); |
  | 382 | 428 |  |
  | 383 | 429 | wp\_enqueue\_style('woobe\_autocomplete', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/easy-autocomplete.min.css', array(), WOOBE\_VERSION); |
  | 384 | 430 | wp\_enqueue\_style('woobe\_autocomplete\_theme', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/easy-autocomplete.themes.min.css', array(), WOOBE\_VERSION); |
  | 385 | 431 | wp\_enqueue\_script('woobe\_autocomplete', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/jquery.easy-autocomplete.js', array('jquery'), WOOBE\_VERSION); |
  | 386 | 432 |  |
  | 387 | 433 | wp\_enqueue\_style('woobe\_datetimepicker', WOOBE\_ASSETS\_LINK . 'js/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css', array(), WOOBE\_VERSION); |
  | 388 | 434 | wp\_enqueue\_script('woobe\_datetimepicker\_moment', WOOBE\_ASSETS\_LINK . 'js/datepicker/moment-with-locales.min.js', array('jquery'), WOOBE\_VERSION); |
  | 389 | 435 | wp\_enqueue\_script('woobe\_datetimepicker', WOOBE\_ASSETS\_LINK . 'js/bootstrap-material-datetimepicker/bootstrap-material-datetimepicker.js', array('jquery'), WOOBE\_VERSION); |
  | 390 | 436 |  |
  | 391 | 437 | wp\_enqueue\_script('woobe\_placeholder\_label', WOOBE\_ASSETS\_LINK . 'js/jquery.placeholder.label.min.js', array('jquery'), WOOBE\_VERSION); |
  | 392 | 438 | wp\_enqueue\_script('woobe\_tooltip', WOOBE\_ASSETS\_LINK . 'js/tooltip.js', array('jquery'), WOOBE\_VERSION); |
  | 393 | 439 |  |
  | 394 | 440 | wp\_enqueue\_script('woobe\_tabs', WOOBE\_ASSETS\_LINK . 'js/tabs.js', array(), WOOBE\_VERSION); |
  | 395 | 441 | wp\_enqueue\_script('woobe\_scrollbar', WOOBE\_ASSETS\_LINK . 'js/jquery.scrollbar.min.js', array(), WOOBE\_VERSION); |
  | 396 | 442 | //\*\*\* |
  | 397 | 443 | wp\_enqueue\_script('woobe', WOOBE\_ASSETS\_LINK . 'js/woobe.js', array('jquery', 'jquery-ui-core', 'jquery-ui-sortable', 'woobe\_tabs'), WOOBE\_VERSION); |
  | 398 | 444 | do\_action('woobe\_ext\_scripts'); //including extensions scripts |
  | 399 | 445 | } |
  | 400 | 446 | } |
  | 401 | 447 |  |
  | 402 | 448 | public function print\_plugin\_options() { |
  | 403 | 449 | $args = array(); |
  | 404 | 450 | $args['options'] = $this->settings->get\_options(); |
  | 405 | 451 | $args['total\_settings'] = $this->settings->get\_total\_settings(); |
  | 406 | 452 | $args['tax\_keys'] = array(); |
  | 407 | 453 | $args['attribute\_keys'] = array(); |
  | 408 | 454 |  |
  | 409 | 455 | $args['is\_popupeditor'] = FALSE; |
  | 410 | 456 | $args['is\_downloads'] = FALSE; |
  | 411 | 457 | $args['is\_gallery'] = FALSE; |
  | 412 | 458 | $args['is\_upsells'] = FALSE; |
  | 413 | 459 | $args['is\_cross\_sells'] = FALSE; |
  | 414 | 460 | $args['is\_grouped'] = FALSE; |
  | 415 | 461 |  |
  | 416 | 462 | $args['meta\_popup\_editor'] = FALSE; |
  | 417 | 463 |  |
  | 418 | 464 | //to generate terms in popup taxonomies data |
  | 419 | 465 | if (!empty($this->settings->active\_fields)) { |
  | 420 | 466 | foreach ($this->settings->active\_fields as $k => $f) { |
  | 421 | 467 | if ($f['field\_type'] == 'taxonomy' AND $f['edit\_view'] == 'popup') { |
  | 422 | 468 | $args['tax\_keys'][] = $f['taxonomy']; |
  | 423 | 469 | } |
  | 424 | 470 |  |
  | 425 | 471 | if ($f['field\_type'] == 'attribute') { |
  | 426 | 472 | $args['attribute\_keys'][] = $k; |
  | 427 | 473 | } |
  | 428 | 474 |  |
  | 429 | 475 | //\*\*\* |
  | 430 | 476 |  |
  | 431 | 477 | if ($f['edit\_view'] == 'popupeditor') { |
  | 432 | 478 | $args['is\_popupeditor'] = TRUE; |
  | 433 | 479 | } |
  | 434 | 480 |  |
  | 435 | 481 | if ($f['edit\_view'] == 'downloads\_popup\_editor') { |
  | 436 | 482 | $args['is\_downloads'] = TRUE; |
  | 437 | 483 | } |
  | 438 | 484 |  |
  | 439 | 485 | if ($f['edit\_view'] == 'gallery\_popup\_editor') { |
  | 440 | 486 | $args['is\_gallery'] = TRUE; |
  | 441 | 487 | } |
  | 442 | 488 |  |
  | 443 | 489 | if ($f['edit\_view'] == 'upsells\_popup\_editor') { |
  | 444 | 490 | $args['is\_upsells'] = TRUE; |
  | 445 | 491 | } |
  | 446 | 492 |  |
  | 447 | 493 | if ($f['edit\_view'] == 'cross\_sells\_popup\_editor') { |
  | 448 | 494 | $args['is\_cross\_sells'] = TRUE; |
  | 449 | 495 | } |
  | 450 | 496 |  |
  | 451 | 497 | if ($f['edit\_view'] == 'grouped\_popup\_editor') { |
  | 452 | 498 | $args['is\_grouped'] = TRUE; |
  | 453 | 499 | } |
  | 454 | 500 |  |
  | 455 | 501 | if ($f['edit\_view'] == 'meta\_popup\_editor') { |
  | 456 | 502 | $args['meta\_popup\_editor'] = TRUE; |
  | 457 | 503 | } |
  | 458 | 504 | } |
  | 459 | 505 | } |
  | 460 | 506 |  |
  | 461 | 507 | //\*\*\* |
  | 462 | 508 |  |
  | 463 | 509 | $args['active\_fields'] = $this->settings->active\_fields; |
  | 464 | 510 | $args['settings\_fields'] = $this->settings->get\_fields(); |
  | 465 | 511 | $args['settings\_fields\_full'] = $this->settings->get\_fields(false); |
  | 466 | 512 | $args['settings\_fields\_keys'] = $this->settings->get\_fields\_keys(); |
  | 467 | 513 | $args['editable'] = $this->settings->editable; |
  | 468 | 514 | $args['default\_sortby\_col\_num'] = $this->settings->get\_default\_sortby\_col\_num(); |
  | 469 | 515 | $args['default\_sort'] = $this->settings->default\_sort; |
  | 470 | 516 | $args['no\_order'] = $this->settings->no\_order; |
  | 471 | 517 | $args['per\_page'] = $this->settings->per\_page; |
  | 472 | 518 | $args['extend\_per\_page'] = apply\_filters('woobe\_set\_per\_page\_values', ''); |
  | 473 | 519 | $args['show\_notes'] = $this->show\_notes; |
  | 474 | 520 | $args['current\_user\_role'] = $this->settings->current\_user\_role; |
  | 475 | 521 | $args['profiles'] = $this->profiles->get(); |
  | 476 | 522 |  |
  | 477 | 523 | //\*\*\* |
  | 478 | 524 |  |
  | 479 | 525 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/woobe.php', apply\_filters('woobe\_print\_plugin\_options', $args)); |
  | 480 | 526 | } |
  | 481 | 527 |  |
  | 482 | 528 | //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ |
  | 483 | 529 | //ajax |
  | 484 | 530 | public function woobe\_get\_products($args = array(), $return = false) { |
  | 485 | 531 |  |
  | 486 | 532 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 487 | 533 | return; |
  | 488 | 534 | } |
  | 489 | 535 |  |
  | 490 | 536 | //\*\*\* |
  | 491 | 537 |  |
  | 492 | 538 | $res = array(); |
  | 493 | 539 | $res['draw'] = isset($\_REQUEST['draw']) ? intval($\_REQUEST['draw']) : 0; |
  | 494 | 540 | $res['data'] = array(); |
  | 495 | 541 | $fileds\_keys = $this->settings->get\_fields\_keys(); |
  | 496 | 542 |  |
  | 497 | 543 | if (empty($args)) { |
  | 498 | 544 | //for ajax only |
  | 499 | 545 | $args = array( |
  | 500 | 546 | 'lang' => sanitize\_key($\_REQUEST['lang']), |
  | 501 | 547 | 'per\_page' => intval($\_REQUEST['length']), |
  | 502 | 548 | 'offset' => intval($\_REQUEST['start']), |
  | 503 | 549 | 'order\_by' => $fileds\_keys[intval($\_REQUEST['order'][0]['column'])], |
  | 504 | 550 | 'order' => sanitize\_key($\_REQUEST['order'][0]['dir']), |
  | 505 | 551 | 'search' => sanitize\_text\_field($\_REQUEST['search']['value']) |
  | 506 | 552 | ); |
  | 507 | 553 | } |
  | 508 | 554 |  |
  | 509 | 555 | $products = $this->products->gets($args); |
  | 510 | 556 |  |
  | 511 | 557 | $res['recordsFiltered'] = $res['recordsTotal'] = $products->found\_posts; |
  | 512 | 558 | if ($products->found\_posts > 0) { |
  | 513 | 559 | $products\_types = array(); |
  | 514 | 560 | $products\_titles = array(); |
  |  | 561 | wp\_cache\_flush(); |
  | 515 | 562 | foreach ($products->posts as $p) { |
  | 516 |  | wp\_cache\_flush(); |
  |  | 563 |  |
  | 517 | 564 | $product\_type = WC\_Data\_Store::load('product')->get\_product\_type($p->ID); |
  | 518 | 565 | $res['data'][] = $this->\_pack\_row($p, $product\_type); |
  | 519 | 566 | $products\_types[$p->ID] = $product\_type; |
  | 520 | 567 | $products\_titles[$p->ID] = str\_replace('"', "", str\_replace("'", "", $p->post\_title)); |
  | 521 | 568 |  |
  | 522 | 569 | //get variations if exists and requested |
  | 523 | 570 | if ($product\_type == 'variable' AND ( isset($\_REQUEST['woobe\_show\_variations']) AND intval($\_REQUEST['woobe\_show\_variations']) > 0)) { |
  | 524 | 571 |  |
  | 525 | 572 | $variations = $this->products->gets(array('get\_variations' => $p->ID)); |
  | 526 | 573 | if ($variations->found\_posts > 0) { |
  | 527 | 574 | foreach ($variations->posts as $var) { |
  | 528 | 575 | $res['data'][] = $this->\_pack\_row($var, 'variation'); |
  | 529 | 576 | $products\_types[$var->ID] = 'variation'; |
  | 530 | 577 | $products\_titles[$var->ID] = str\_replace('"', "", str\_replace("'", "", $var->post\_title)); |
  | 531 | 578 |  |
  | 532 | 579 | //\*\*\* |
  | 533 | 580 |  |
  | 534 | 581 | if ($this->settings->add\_vars\_to\_var\_title) { |
  | 535 | 582 | $products\_titles[$var->ID] = $this->products->generate\_product\_title($this->products->get\_product($var->ID)); |
  | 536 | 583 | } |
  | 537 | 584 | } |
  | 538 | 585 | } |
  | 539 | 586 | } |
  | 540 | 587 |  |
  | 541 | 588 | //\*\*\* |
  | 542 | 589 | //data for javascript functionality on the front |
  | 543 | 590 | $res['products\_types'] = $products\_types; |
  | 544 | 591 | $res['products\_titles'] = $products\_titles; |
  | 545 | 592 | //$res['query']=$products->request; |
  | 546 | 593 | } |
  | 547 | 594 | } |
  | 548 | 595 |  |
  | 549 | 596 | //\*\*\* |
  | 550 | 597 | //echo get\_num\_queries() . ' + ';exit; |
  | 551 | 598 | if (!$return) { |
  | 552 | 599 | //if requested by ajax |
  | 553 | 600 | die(json\_encode($res)); |
  | 554 | 601 | } |
  | 555 | 602 |  |
  | 556 | 603 | return $res; |
  | 557 | 604 | } |
  | 558 | 605 |  |
  | 559 | 606 | //service |
  | 560 | 607 | private function \_pack\_row($p, $product\_type) { |
  | 561 | 608 | //wp\_cache\_flush(); |
  | 562 | 609 | $row = array(); |
  | 563 | 610 | $p = (array) $p; |
  | 564 | 611 |  |
  | 565 | 612 | foreach ($this->settings->get\_fields\_keys() as $key) { |
  | 566 | 613 | $row[] = $this->wrap\_field\_val($p, $key, $product\_type); |
  | 567 | 614 | } |
  | 568 | 615 |  |
  | 569 | 616 | if ($product\_type !== 'variation') { |
  | 570 | 617 | //buttons: edit + view |
  | 571 | 618 | $row[] = WOOBE\_HELPER::draw\_link(array( |
  | 572 | 619 | 'title' => '&#xea0b;', |
  | 573 | 620 | 'href' => get\_permalink($p['ID']), |
  | 574 | 621 | 'target' => '\_blank', |
  | 575 | 622 | 'class' => 'button button-primary button-small button-small-2', |
  | 576 | 623 | 'title\_attr' => esc\_html\_\_('View the product on the site front', 'woo-bulk-editor') |
  | 577 | 624 | )) . '&nbsp;' . WOOBE\_HELPER::draw\_link(array( |
  | 578 | 625 | 'title' => '&#xea25;', |
  | 579 | 626 | 'href' => get\_admin\_url() . 'post.php?post=' . $p['ID'] . '&action=edit', |
  | 580 | 627 | 'target' => '\_blank', |
  | 581 | 628 | 'class' => 'button button-primary button-small button-small-2', |
  | 582 | 629 | 'title\_attr' => esc\_html\_\_('Editing of the product on its page', 'woo-bulk-editor') |
  | 583 | 630 | )); |
  | 584 | 631 | } else { |
  | 585 | 632 | $row[] = ''; |
  | 586 | 633 | } |
  | 587 | 634 |  |
  | 588 | 635 | return $row; |
  | 589 | 636 | } |
  | 590 | 637 |  |
  | 591 | 638 | //ajax |
  | 592 | 639 | public function woobe\_update\_page\_field() { |
  | 593 | 640 |  |
  | 594 | 641 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 595 | 642 |  |
  | 596 | 643 | if (!isset($\_REQUEST['value']) || $\_REQUEST['value'] == null) { |
  | 597 | 644 | $\_REQUEST['value'] = array(); |
  | 598 | 645 | } |
  | 599 | 646 | $field\_key = sanitize\_text\_field(trim($\_REQUEST['field'])); //if sanitize by sanitize\_key not all meta keys works normally!! |
  | 600 | 647 | if ($product\_id > 0 AND isset($\_REQUEST['value'])) { |
  | 601 | 648 | if ($\_REQUEST['value']) { |
  | 602 | 649 | if (is\_array($\_REQUEST['value'])) { |
  | 603 | 650 | $value = $\_REQUEST['value']; |
  | 604 | 651 |  |
  | 605 | 652 | $value = WOOBE\_HELPER::sanitize\_array((array) $\_REQUEST['value']); |
  | 606 | 653 | } else { |
  | 607 | 654 | $is\_encoded = preg\_match('~%[0-9A-F]{2}~i', $\_REQUEST['value']); |
  | 608 | 655 | $allowedpost = wp\_kses\_allowed\_html('post'); |
  | 609 | 656 | if ('post\_content' == $\_REQUEST['field'] OR 'post\_excerpt' == $\_REQUEST['field'] OR $this->settings->active\_fields[$field\_key]['edit\_view'] === 'popupeditor') { |
  | 610 | 657 | $is\_encoded = false; |
  | 611 | 658 | $allowedpost['iframe'] = array( |
  | 612 | 659 | 'align' => true, |
  | 613 | 660 | 'frameborder' => true, |
  | 614 | 661 | 'height' => true, |
  | 615 | 662 | 'width' => true, |
  | 616 | 663 | 'sandbox' => true, |
  | 617 | 664 | 'seamless' => true, |
  | 618 | 665 | 'scrolling' => true, |
  | 619 | 666 | 'srcdoc' => true, |
  | 620 | 667 | 'src' => true, |
  | 621 | 668 | 'class' => true, |
  | 622 | 669 | 'id' => true, |
  | 623 | 670 | 'style' => true, |
  | 624 | 671 | 'border' => true, |
  | 625 | 672 | ); |
  | 626 | 673 | } |
  | 627 | 674 |  |
  | 628 | 675 | if ($is\_encoded) { |
  | 629 | 676 | $data\_array = []; |
  | 630 | 677 |  |
  | 631 | 678 | parse\_str($\_REQUEST['value'], $data\_array); |
  | 632 | 679 |  |
  | 633 | 680 | $value = WOOBE\_HELPER::sanitize\_array($data\_array); |
  | 634 | 681 | } else { |
  | 635 |  | $value = wp\_kses($\_REQUEST['value'], $allowedpost); |
  |  | 682 |  |
  |  | 683 | if (apply\_filters('woobe\_use\_kses\_for\_page\_field', true)) { |
  |  | 684 | $value = wp\_kses($\_REQUEST['value'], $allowedpost); |
  |  | 685 | } else { |
  |  | 686 | $value = sanitize\_text\_field($\_REQUEST['value']); |
  |  | 687 | } |
  | 636 | 688 | } |
  | 637 | 689 | } |
  | 638 | 690 | } else { |
  | 639 | 691 | $value = ""; |
  | 640 | 692 | } |
  | 641 | 693 |  |
  | 642 | 694 | //\*\*\* |
  | 643 | 695 | //normalize calendar date |
  | 644 | 696 | if ($this->settings->active\_fields[$field\_key]['edit\_view'] === 'calendar') { |
  | 645 | 697 | if ($this->settings->active\_fields[$field\_key]["field\_type"] AND $this->settings->active\_fields[$field\_key]["field\_type"] == "meta") { |
  | 646 | 698 | $value = strtotime($value); |
  | 647 | 699 | } else { |
  | 648 | 700 | $value = $this->products->normalize\_calendar\_date($value, $field\_key); |
  | 649 | 701 | } |
  | 650 | 702 | } |
  | 651 | 703 |  |
  | 652 | 704 | //\*\*\* |
  | 653 | 705 | //uploated to |
  | 654 | 706 | if (isset($\_REQUEST['uploaded\_to']) AND $\_REQUEST['uploaded\_to'] == 1 AND $field\_key == '\_thumbnail\_id') { |
  | 655 | 707 | $id\_th = intval($value); |
  | 656 | 708 | if ($id\_th) { |
  | 657 | 709 | $my\_post = array(); |
  | 658 | 710 | $my\_post['ID'] = $id\_th; |
  | 659 | 711 | $my\_post['post\_parent'] = $product\_id; |
  | 660 | 712 |  |
  | 661 | 713 | wp\_update\_post(wp\_slash($my\_post)); |
  | 662 | 714 | } |
  | 663 | 715 | } |
  | 664 | 716 |  |
  | 665 | 717 | $value = $this->products->string\_replacer($value, $product\_id); |
  | 666 | 718 | $value = $this->products->string\_macros($value, $field\_key, $product\_id); |
  | 667 | 719 |  |
  | 668 | 720 | echo $this->products->update\_page\_field($product\_id, $field\_key, $value); |
  | 669 | 721 | //die(json\_encode($value)); |
  | 670 | 722 | } |
  | 671 | 723 |  |
  | 672 | 724 | exit; |
  | 673 | 725 | } |
  | 674 | 726 |  |
  | 675 | 727 | //ajax |
  | 676 | 728 | public function woobe\_redraw\_table\_row() { |
  | 677 | 729 | if (is\_array($\_REQUEST['value'])) { |
  | 678 | 730 | $value = (array) $\_REQUEST['value']; |
  | 679 | 731 | } else { |
  | 680 | 732 | $value = sanitize\_text\_field(trim($\_REQUEST['value'])); |
  | 681 | 733 | } |
  | 682 | 734 |  |
  | 683 | 735 | //\*\*\* |
  | 684 | 736 |  |
  | 685 | 737 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 686 | 738 |  |
  | 687 | 739 | if ($product\_id > 0) { |
  | 688 | 740 | if (isset($\_REQUEST['field']) AND !empty($\_REQUEST['field'])) { |
  | 689 | 741 | $field\_key = sanitize\_key($\_REQUEST['field']); |
  | 690 | 742 | if (!empty($field\_key)) { |
  | 691 | 743 | $this->products->update\_page\_field($product\_id, $field\_key, $value); |
  | 692 | 744 | } |
  | 693 | 745 | } |
  | 694 | 746 |  |
  | 695 | 747 |  |
  | 696 | 748 | //generate table row by $product\_id |
  | 697 | 749 | $res = $this->woobe\_get\_products(array( |
  | 698 | 750 | 'p' => $product\_id, |
  | 699 | 751 | 'post\_type' => array('product', 'product\_variation') |
  | 700 | 752 | ), true); |
  | 701 | 753 |  |
  | 702 | 754 | echo(json\_encode($res['data'][0])); |
  | 703 | 755 | } |
  | 704 | 756 | exit; |
  | 705 | 757 | } |
  | 706 | 758 |  |
  | 707 | 759 | //ajax |
  | 708 | 760 | public function get\_post\_field() { |
  | 709 | 761 | $test = $this->products->get\_post\_field(intval($\_REQUEST['product\_id']), sanitize\_key($\_REQUEST['field']), (isset($\_REQUEST['post\_parent']) ? intval($\_REQUEST['post\_parent']) : 0)); |
  | 710 | 762 | echo $test; |
  | 711 | 763 | exit; |
  | 712 | 764 | } |
  | 713 | 765 |  |
  | 714 | 766 | //ajax |
  | 715 | 767 | public function get\_downloads() { |
  | 716 | 768 |  |
  | 717 | 769 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 718 | 770 |  |
  | 719 | 771 | if (!$product\_id) { |
  | 720 | 772 | exit; |
  | 721 | 773 | } |
  | 722 | 774 |  |
  | 723 | 775 | $product = $this->products->get\_product($product\_id); |
  | 724 | 776 |  |
  | 725 | 777 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-downloads.php', array( |
  | 726 | 778 | 'downloadable\_files' => $product->get\_downloads('edit') |
  | 727 | 779 | )); |
  | 728 | 780 |  |
  | 729 | 781 | exit; |
  | 730 | 782 | } |
  | 731 | 783 |  |
  | 732 | 784 | //ajax |
  | 733 | 785 | public function woobe\_get\_gallery() { |
  | 734 | 786 |  |
  | 735 | 787 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 736 | 788 |  |
  | 737 | 789 | if (!$product\_id) { |
  | 738 | 790 | exit; |
  | 739 | 791 | } |
  | 740 | 792 |  |
  | 741 | 793 | $product = $this->products->get\_product($product\_id); |
  | 742 | 794 |  |
  | 743 | 795 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-gallery.php', array( |
  | 744 | 796 | 'images' => $product->get\_gallery\_image\_ids('edit') |
  | 745 | 797 | )); |
  | 746 | 798 |  |
  | 747 | 799 | exit; |
  | 748 | 800 | } |
  | 749 | 801 |  |
  | 750 | 802 | //ajax |
  | 751 | 803 | public function woobe\_get\_upsells() { |
  | 752 | 804 |  |
  | 753 | 805 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 754 | 806 |  |
  | 755 | 807 | if (!$product\_id) { |
  | 756 | 808 | exit; |
  | 757 | 809 | } |
  | 758 | 810 |  |
  | 759 | 811 | $product = $this->products->get\_product($product\_id); |
  | 760 | 812 |  |
  | 761 | 813 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-upsells.php', array( |
  | 762 | 814 | 'products' => $product->get\_upsell\_ids('edit') |
  | 763 | 815 | )); |
  | 764 | 816 |  |
  | 765 | 817 | exit; |
  | 766 | 818 | } |
  | 767 | 819 |  |
  | 768 | 820 | //ajax |
  | 769 | 821 | public function woobe\_get\_cross\_sells() { |
  | 770 | 822 |  |
  | 771 | 823 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 772 | 824 |  |
  | 773 | 825 | if (!$product\_id) { |
  | 774 | 826 | exit; |
  | 775 | 827 | } |
  | 776 | 828 |  |
  | 777 | 829 | $product = $this->products->get\_product($product\_id); |
  | 778 | 830 |  |
  | 779 | 831 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-cross-sells.php', array( |
  | 780 | 832 | 'products' => $product->get\_cross\_sell\_ids('edit') |
  | 781 | 833 | )); |
  | 782 | 834 |  |
  | 783 | 835 | exit; |
  | 784 | 836 | } |
  | 785 | 837 |  |
  | 786 | 838 | //ajax |
  | 787 | 839 | public function woobe\_get\_grouped() { |
  | 788 | 840 |  |
  | 789 | 841 | $product\_id = intval($\_REQUEST['product\_id']); |
  | 790 | 842 |  |
  | 791 | 843 | if (!$product\_id) { |
  | 792 | 844 | exit; |
  | 793 | 845 | } |
  | 794 | 846 |  |
  | 795 | 847 | $product = $this->products->get\_product($product\_id); |
  | 796 | 848 |  |
  | 797 | 849 | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-grouped.php', array( |
  | 798 | 850 | 'products' => $product->get\_children('edit') |
  | 799 | 851 | )); |
  | 800 | 852 |  |
  | 801 | 853 | exit; |
  | 802 | 854 | } |
  | 803 | 855 |  |
  | 804 | 856 | //ajax |
  | 805 | 857 | public function woobe\_save\_options() { |
  | 806 | 858 |  |
  | 807 | 859 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 808 | 860 | die('0'); |
  | 809 | 861 | } |
  |  | 862 | if (!isset($\_REQUEST['mainform\_nonce']) || !wp\_verify\_nonce($\_REQUEST['mainform\_nonce'], 'woobe\_mainform\_nonce')) { |
  |  | 863 | die('0'); |
  |  | 864 | } |
  |  | 865 |  |
  | 810 | 866 |  |
  | 811 | 867 | $data = array(); |
  | 812 | 868 | parse\_str($\_REQUEST['formdata'], $data); |
  | 813 | 869 | $data = WOOBE\_HELPER::sanitize\_array($data); |
  | 814 | 870 |  |
  | 815 | 871 | if (isset($data['woobe\_options'])) { |
  | 816 | 872 | if (is\_array($data['woobe\_options'])) { |
  | 817 | 873 | $this->settings->update\_options($data['woobe\_options']); |
  | 818 | 874 | } |
  | 819 | 875 |  |
  | 820 | 876 | //\*\*\* |
  | 821 | 877 | //save shop manager fields visibility |
  | 822 | 878 | if (in\_array($this->settings->current\_user\_role, apply\_filters('woobe\_permit\_special\_roles', ['administrator']))) { |
  | 823 | 879 | $shop\_manager\_visibility = array(); |
  | 824 | 880 |  |
  | 825 | 881 | foreach ($data['woobe\_options']['fields'] as $key => $v) { |
  | 826 | 882 | if (isset($v['shop\_manager\_visibility'])) { |
  | 827 | 883 | $shop\_manager\_visibility[$key] = intval($v['shop\_manager\_visibility']); |
  | 828 | 884 | } |
  | 829 | 885 | } |
  | 830 | 886 |  |
  | 831 | 887 | update\_option('woobe\_shop\_manager\_visibility', $shop\_manager\_visibility); |
  | 832 | 888 | } |
  | 833 | 889 | } |
  | 834 | 890 |  |
  | 835 | 891 | exit; |
  | 836 | 892 | } |
  | 837 | 893 |  |
  | 838 | 894 | //ajax |
  | 839 | 895 | public function woobe\_title\_autocomplete() { |
  | 840 | 896 | $results = array(); |
  | 841 | 897 | $results[] = array( |
  | 842 | 898 | "name" => esc\_html\_\_("Products not found!", 'woo-bulk-editor'), |
  | 843 | 899 | "id" => 0, |
  | 844 | 900 | "type" => "", |
  | 845 | 901 | "link" => "#", |
  | 846 | 902 | "icon" => WOOBE\_ASSETS\_LINK . 'images/not-found.jpg' |
  | 847 | 903 | ); |
  | 848 | 904 |  |
  | 849 | 905 | //\*\*\* |
  | 850 | 906 |  |
  | 851 | 907 | if (!empty($\_REQUEST['woobe\_txt\_search'])) { |
  | 852 | 908 | $args = array( |
  | 853 | 909 | 'nopaging' => true, |
  | 854 | 910 | 'post\_type' => array('product', 'product\_variation'), |
  | 855 | 911 | 'post\_status' => array\_keys(apply\_filters('woobe\_product\_statuses', get\_post\_statuses())), |
  | 856 | 912 | 'order\_by' => 'title', |
  | 857 | 913 | 'order' => 'ASC', |
  | 858 | 914 | 'per\_page' => intval($\_REQUEST['auto\_res\_count']) > 0 ? intval($\_REQUEST['auto\_res\_count']) : 10, |
  | 859 | 915 | 'max\_num\_pages' => intval($\_REQUEST['auto\_res\_count']) > 0 ? intval($\_REQUEST['auto\_res\_count']) : 10 |
  | 860 | 916 | ); |
  | 861 | 917 |  |
  | 862 | 918 | //\*\*\* |
  | 863 | 919 |  |
  | 864 | 920 | if (!empty($\_REQUEST['exept\_ids'])) { |
  | 865 | 921 | $exept\_ids = array(); //which products exclude as they are on the list already |
  | 866 | 922 | parse\_str($\_REQUEST['exept\_ids'], $exept\_ids); |
  | 867 | 923 |  |
  | 868 | 924 | if (isset($exept\_ids['woobe\_prod\_ids'])) { |
  | 869 | 925 | $args['post\_\_not\_in'] = array\_map(function ($item) { |
  | 870 | 926 | return intval($item); //sanitize intval |
  | 871 | 927 | }, $exept\_ids['woobe\_prod\_ids']); |
  | 872 | 928 | } |
  | 873 | 929 | } |
  | 874 | 930 |  |
  | 875 | 931 | //\*\*\* |
  | 876 | 932 | $st = sanitize\_text\_field($\_REQUEST['woobe\_txt\_search']); |
  | 877 |  | $\_REQUEST['woobe\_txt\_search'] = array(); |
  | 878 |  | $\_REQUEST['woobe\_txt\_search\_behavior'] = array(); |
  | 879 |  | $\_REQUEST['woobe\_txt\_search']['post\_title'] = $st; |
  | 880 |  | $\_REQUEST['woobe\_txt\_search\_behavior']['post\_title'] = 'like'; |
  |  | 933 |  |
  |  | 934 | if (0 == $this->settings->autocomplet\_txt\_search) { |
  |  | 935 | $\_REQUEST['woobe\_txt\_search'] = array(); |
  |  | 936 | $\_REQUEST['woobe\_txt\_search']['post\_title'] = $st; |
  |  | 937 | $\_REQUEST['woobe\_txt\_search\_behavior'] = array(); |
  |  | 938 | $\_REQUEST['woobe\_txt\_search\_behavior']['post\_title'] = 'like'; |
  |  | 939 |  |
  |  | 940 | add\_filter('posts\_where', array($this->filters, 'posts\_txt\_where'), 101); |
  |  | 941 | } elseif (1 == $this->settings->autocomplet\_txt\_search) { |
  |  | 942 | $\_REQUEST['woobe\_autocomplete\_search'] = $st; |
  |  | 943 | add\_filter('posts\_where', array($this, 'autocomplete\_search'), 101); |
  |  | 944 | } |
  |  | 945 |  |
  | 881 | 946 | $this->products->suppress\_filters = true; |
  | 882 |  | add\_filter('posts\_where', array($this->filters, 'posts\_txt\_where'), 101); |
  |  | 947 |  |
  | 883 | 948 | $query = $this->products->gets($args); |
  | 884 | 949 |  |
  | 885 | 950 | //+++ |
  | 886 | 951 | //http://easyautocomplete.com/guide |
  | 887 | 952 | if ($query->have\_posts()) { |
  | 888 | 953 | $results = array(); |
  | 889 | 954 | foreach ($query->posts as $p) { |
  | 890 | 955 | $data = array( |
  | 891 |  | "name" => $p->post\_title . ' (#' . $p->ID . ')', |
  |  | 956 | "name" => $p->post\_title . ' (#' . $p->ID . ')' . ' : ' . get\_post\_meta($p->ID, '\_sku', true), |
  | 892 | 957 | "id" => $p->ID, |
  | 893 | 958 | "type" => "product" |
  | 894 | 959 | ); |
  | 895 | 960 | if (has\_post\_thumbnail($p->ID)) { |
  | 896 | 961 | $img\_src = wp\_get\_attachment\_image\_src(get\_post\_thumbnail\_id($p->ID), 'thumbnail'); |
  | 897 | 962 | $data['icon'] = $img\_src[0]; |
  | 898 | 963 | } else { |
  | 899 | 964 | $data['icon'] = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
  | 900 | 965 | } |
  | 901 | 966 | $data['link'] = get\_post\_permalink($p->ID); |
  | 902 | 967 | $results[] = $data; |
  | 903 | 968 | } |
  | 904 | 969 | } |
  | 905 | 970 | } |
  | 906 | 971 |  |
  | 907 | 972 |  |
  | 908 | 973 | die(json\_encode($results)); |
  |  | 974 | } |
  |  | 975 |  |
  |  | 976 | public function autocomplete\_search($where = '') { |
  |  | 977 |  |
  |  | 978 | if (!isset($\_REQUEST['woobe\_autocomplete\_search'])) { |
  |  | 979 | return $where; |
  |  | 980 | } |
  |  | 981 | global $wpdb; |
  |  | 982 | $search\_text = sanitize\_text\_field($\_REQUEST['woobe\_autocomplete\_search']); |
  |  | 983 |  |
  |  | 984 | //sku |
  |  | 985 | $args = array( |
  |  | 986 | 'post\_type' => array('product', 'product\_variation'), |
  |  | 987 | 'fields' => 'ids', |
  |  | 988 | 'meta\_query' => array( |
  |  | 989 | array( |
  |  | 990 | 'key' => '\_sku', |
  |  | 991 | 'compare' => 'LIKE', |
  |  | 992 | 'value' => $search\_text |
  |  | 993 | ), |
  |  | 994 | ) |
  |  | 995 | ); |
  |  | 996 |  |
  |  | 997 | $product\_variations\_ids = get\_posts($args); |
  |  | 998 |  |
  |  | 999 | if (!empty($product\_variations\_ids)) { |
  |  | 1000 | if (empty($product\_variations\_ids)) { |
  |  | 1001 | foreach ($product\_variations as $v) { |
  |  | 1002 | $product\_variations\_ids[] = $v[0]; |
  |  | 1003 | } |
  |  | 1004 | } |
  |  | 1005 |  |
  |  | 1006 |  |
  |  | 1007 | //+++ |
  |  | 1008 | $product\_variations\_ids\_string = implode(',', $product\_variations\_ids); |
  |  | 1009 |  |
  |  | 1010 | $sql[] = " ($wpdb->posts.ID IN($product\_variations\_ids\_string))"; |
  |  | 1011 | } |
  |  | 1012 |  |
  |  | 1013 | //id |
  |  | 1014 | $id\_search = (int) $search\_text; |
  |  | 1015 | if ($id\_search) { |
  |  | 1016 | $sql[] = " ($wpdb->posts.ID = $id\_search )"; |
  |  | 1017 | } |
  |  | 1018 |  |
  |  | 1019 |  |
  |  | 1020 | //title |
  |  | 1021 | $like = '%' . $wpdb->esc\_like($search\_text) . '%'; |
  |  | 1022 | $sql[] = $wpdb->prepare("($wpdb->posts.post\_title LIKE %s)", $like); |
  |  | 1023 |  |
  |  | 1024 | wpdebug()->log($sql); |
  |  | 1025 |  |
  |  | 1026 | $where .= " AND ( " . implode(' OR ', $sql) . " )"; |
  |  | 1027 | //\*\*\* |
  |  | 1028 | return $where; |
  | 909 | 1029 | } |
  | 910 | 1030 |  |
  | 911 | 1031 | //ajax |
  | 912 | 1032 | public function woobe\_create\_new\_product() { |
  | 913 | 1033 |  |
  | 914 | 1034 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 915 | 1035 | die('0'); |
  | 916 | 1036 | } |
  | 917 | 1037 | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
  | 918 | 1038 | die('0'); |
  | 919 | 1039 | } |
  | 920 | 1040 |  |
  | 921 | 1041 | //also: http://woocommerce.wp-a2z.org/oik\_api/wc\_api\_productscreate\_product/ |
  | 922 | 1042 | $wp\_rest\_request = new WP\_REST\_Request('POST'); |
  | 923 | 1043 | $wp\_rest\_request->set\_body\_params(array( |
  | 924 | 1044 | 'name' => esc\_html\_\_('New Product', 'woo-bulk-editor'), |
  | 925 | 1045 | 'description' => '', |
  | 926 | 1046 | 'status' => apply\_filters('woobe\_new\_product\_status', 'draft') |
  | 927 | 1047 | )); |
  | 928 | 1048 | $products\_controller = new WC\_REST\_Products\_Controller(); |
  | 929 | 1049 |  |
  | 930 | 1050 | $to\_create = intval($\_REQUEST['to\_create']); |
  | 931 | 1051 | while ($to\_create) { |
  | 932 | 1052 | $products\_controller->create\_item($wp\_rest\_request); |
  | 933 | 1053 | $to\_create--; |
  | 934 | 1054 | } |
  | 935 | 1055 |  |
  | 936 | 1056 | exit; |
  | 937 | 1057 | } |
  | 938 | 1058 |  |
  | 939 | 1059 | //ajax |
  | 940 | 1060 | public function woobe\_duplicate\_products() { |
  | 941 | 1061 |  |
  | 942 | 1062 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 943 | 1063 | die('0'); |
  | 944 | 1064 | } |
  | 945 | 1065 | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
  | 946 | 1066 | die('0'); |
  | 947 | 1067 | } |
  | 948 | 1068 |  |
  | 949 | 1069 | if (!empty($\_REQUEST['products\_ids'])) { |
  | 950 | 1070 | if (!class\_exists('WC\_Admin\_Duplicate\_Product', false)) { |
  | 951 | 1071 | include\_once (plugin\_dir\_path('woocommerce/includes/admin/class-wc-admin-duplicate-product.php')); |
  | 952 | 1072 | } |
  | 953 | 1073 | $duplicator = new WC\_Admin\_Duplicate\_Product(); |
  | 954 | 1074 | //$cached\_products = $this->storage->get\_val('woobe\_cached\_products'); |
  | 955 | 1075 |  |
  | 956 | 1076 | foreach ($\_REQUEST['products\_ids'] as $product\_id) { |
  | 957 | 1077 | $product\_id = intval($product\_id); //sanitizing |
  | 958 | 1078 |  |
  | 959 | 1079 | $product = $this->products->get\_product($product\_id); |
  | 960 | 1080 |  |
  | 961 | 1081 | //when duplication do some copies of the same product - just idea |
  | 962 | 1082 | /\* |
  | 963 | 1083 | if (isset($cached\_products[$product\_id])) { |
  | 964 | 1084 | $product = $cached\_products[$product\_id]; |
  | 965 | 1085 | } else { |
  | 966 | 1086 | $product = $this->products->get\_product($product\_id); |
  | 967 | 1087 | $cached\_products[$product\_id] = $product; |
  | 968 | 1088 | $this->storage->set\_val('woobe\_cached\_products', $cached\_products); |
  | 969 | 1089 | } |
  | 970 | 1090 | \*/ |
  | 971 | 1091 | //duplication of variation is locked |
  | 972 | 1092 | if ($product->get\_type() === 'variation') { |
  | 973 | 1093 | continue; |
  | 974 | 1094 | } |
  | 975 | 1095 |  |
  | 976 | 1096 | $duplicate = $duplicator->product\_duplicate($product); |
  | 977 | 1097 | $duplicate->set\_slug($duplicate->get\_title()/\* . '-'.$duplicate->get\_id() \*/); |
  | 978 | 1098 | $this->clone\_custom\_taxonomies($product\_id, $duplicate->get\_id()); |
  | 979 | 1099 | //delete rating |
  | 980 | 1100 | //delete\_post\_meta($duplicate->get\_id(), "\_wc\_average\_rating"); |
  | 981 | 1101 |  |
  | 982 | 1102 | $duplicate->save(); |
  | 983 | 1103 | do\_action('woocommerce\_product\_duplicate', $duplicate, $product); |
  | 984 | 1104 | //clean\_post\_cache($d->get\_id()); |
  | 985 | 1105 | } |
  | 986 | 1106 |  |
  | 987 | 1107 | //wp\_cache\_flush(); |
  | 988 | 1108 | } |
  | 989 | 1109 |  |
  | 990 | 1110 | die('done'); |
  | 991 | 1111 | } |
  | 992 | 1112 |  |
  | 993 | 1113 | //ajax |
  | 994 | 1114 | public function woobe\_delete\_products() { |
  | 995 | 1115 |  |
  | 996 | 1116 | if (!current\_user\_can('manage\_woocommerce')) { |
  | 997 | 1117 | die('0'); |
  | 998 | 1118 | } |
  | 999 | 1119 | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
  | 1000 | 1120 | die('0'); |
  | 1001 | 1121 | } |
  | 1002 | 1122 |  |
  | 1003 | 1123 | if (!empty($\_REQUEST['products\_ids']) AND is\_array($\_REQUEST['products\_ids'])) { |
  | 1004 | 1124 | foreach ($\_REQUEST['products\_ids'] as $product\_id) { |
  | 1005 | 1125 | $product\_id = intval($product\_id); |
  | 1006 | 1126 | $product = $this->products->get\_product(intval($product\_id)); |
  | 1007 | 1127 | $product->delete(false); |
  | 1008 | 1128 | } |
  | 1009 | 1129 |  |
  | 1010 | 1130 | //wp\_cache\_flush(); - hint for possible compatibility |
  | 1011 | 1131 | } |
  | 1012 | 1132 |  |
  | 1013 | 1133 | die('done'); |
  | 1014 | 1134 | } |
  | 1015 | 1135 |  |
  | 1016 | 1136 | public function wrap\_field\_val($post, $field\_key, $product\_type) { |
  | 1017 | 1137 |  |
  | 1018 | 1138 | $res = NULL; |
  | 1019 | 1139 |  |
  | 1020 | 1140 | $product = $this->products->get\_product($post['ID']); |
  | 1021 | 1141 | $product\_id = $product->get\_id(); |
  | 1022 | 1142 |  |
  | 1023 | 1143 | if (isset($this->settings->active\_fields[$field\_key]['allow\_product\_types'])) { |
  | 1024 | 1144 | try { |
  | 1025 | 1145 | if (!in\_array($product\_type, $this->settings->active\_fields[$field\_key]['allow\_product\_types'])) { |
  | 1026 | 1146 | return WOOBE\_HELPER::draw\_restricked(); |
  | 1027 | 1147 | } |
  | 1028 | 1148 | } catch (Exception $e) { |
  | 1029 | 1149 | //\*\*\* |
  | 1030 | 1150 | } |
  | 1031 | 1151 | } |
  | 1032 | 1152 |  |
  | 1033 | 1153 | if (isset($this->settings->active\_fields[$field\_key]['prohibit\_product\_types'])) { |
  | 1034 | 1154 | try { |
  | 1035 | 1155 | if (in\_array($product\_type, $this->settings->active\_fields[$field\_key]['prohibit\_product\_types'])) { |
  | 1036 | 1156 | $additional\_info = ""; |
  | 1037 | 1157 | if ($this->settings->active\_fields[$field\_key]['field\_type'] == 'attribute' && $post['post\_type'] === 'product\_variation') { |
  | 1038 | 1158 | $attr\_name = $product->get\_attribute($field\_key); |
  | 1039 | 1159 | if ($attr\_name) { |
  | 1040 | 1160 | $additional\_info = '<i class="woobe\_variation\_attr\_info" >[' . $attr\_name . ']</i>'; |
  | 1041 | 1161 | } |
  | 1042 | 1162 | } |
  | 1043 | 1163 | return WOOBE\_HELPER::draw\_restricked() . $additional\_info; |
  | 1044 | 1164 | } |
  | 1045 | 1165 | } catch (Exception $e) { |
  | 1046 | 1166 | //\*\*\* |
  | 1047 | 1167 | } |
  | 1048 | 1168 | } |
  | 1049 | 1169 |  |
  | 1050 | 1170 | //\*\*\* |
  | 1051 | 1171 | $val = ''; |
  | 1052 | 1172 | switch ($this->settings->active\_fields[$field\_key]['field\_type']) { |
  | 1053 | 1173 | case 'meta': |
  | 1054 | 1174 | case 'prop': |
  | 1055 | 1175 | case 'attribute': |
  | 1056 | 1176 | $val = $this->products->get\_post\_field($product\_id, $field\_key); |
  | 1057 | 1177 | break; |
  | 1058 | 1178 |  |
  | 1059 | 1179 | case 'taxonomy': |
  | 1060 | 1180 | $terms = $this->products->get\_post\_field($product\_id, $field\_key); |
  | 1061 | 1181 |  |
  | 1062 | 1182 | $ids = array(); |
  | 1063 | 1183 | $titles = array(); |
  | 1064 | 1184 |  |
  | 1065 | 1185 | //\*\*\* |
  | 1066 | 1186 |  |
  | 1067 | 1187 | if (!empty($terms)) { |
  | 1068 | 1188 | foreach ($terms as $t) { |
  | 1069 | 1189 | $ids[] = $t->term\_id; |
  | 1070 | 1190 | $titles[] = $t->name; |
  | 1071 | 1191 | } |
  | 1072 | 1192 | } |
  | 1073 | 1193 |  |
  | 1074 | 1194 | if (!empty($ids)) { |
  | 1075 | 1195 | $ids = array\_map(function ($v) { |
  | 1076 | 1196 | return intval($v); |
  | 1077 | 1197 | }, $ids); |
  | 1078 | 1198 | } |
  | 1079 | 1199 |  |
  | 1080 | 1200 | //\*\*\* |
  | 1081 | 1201 |  |
  | 1082 | 1202 | if ($this->settings->active\_fields[$field\_key]['type'] === 'array') { |
  | 1083 | 1203 | $val = array( |
  | 1084 | 1204 | 'terms\_ids' => $ids, |
  | 1085 | 1205 | 'terms\_titles' => $titles |
  | 1086 | 1206 | ); |
  | 1087 | 1207 |  |
  | 1088 | 1208 | //for drop-down view |
  | 1089 | 1209 | if ($this->settings->active\_fields[$field\_key]['edit\_view'] == 'select') { |
  | 1090 | 1210 | $val['selected'] = $val['terms\_ids']; |
  | 1091 | 1211 | } |
  | 1092 | 1212 | } else { |
  | 1093 | 1213 | //string, for example: product\_type |
  | 1094 | 1214 | $val = $titles[0]; |
  | 1095 | 1215 | } |
  | 1096 | 1216 | if ($field\_key == 'product\_type') { |
  | 1097 | 1217 | $val = $product->get\_type(); |
  | 1098 | 1218 | //$val = $this->products->get\_product\_type($post['ID']); |
  | 1099 | 1219 | } |
  | 1100 | 1220 | break; |
  | 1101 | 1221 |  |
  | 1102 | 1222 | default: |
  | 1103 | 1223 | if (isset($post[$field\_key])) { |
  | 1104 | 1224 | $val = $post[$field\_key]; |
  | 1105 | 1225 | //for variations |
  | 1106 | 1226 | if ($field\_key === 'post\_title' AND $post['post\_type'] === 'product\_variation') { |
  | 1107 | 1227 | if ($this->settings->add\_vars\_to\_var\_title) { |
  | 1108 | 1228 | $val = $this->products->generate\_product\_title($product); |
  | 1109 | 1229 | } |
  | 1110 | 1230 | } |
  | 1111 | 1231 | } |
  | 1112 | 1232 | break; |
  | 1113 | 1233 | } |
  | 1114 | 1234 |  |
  | 1115 | 1235 | //\*\*\* |
  | 1116 | 1236 |  |
  | 1117 | 1237 | switch ($this->settings->active\_fields[$field\_key]['edit\_view']) { |
  | 1118 | 1238 | case 'select': |
  | 1119 | 1239 |  |
  | 1120 | 1240 | $select\_options = $this->settings->active\_fields[$field\_key]['select\_options']; |
  | 1121 | 1241 |  |
  | 1122 | 1242 | //fix for product variations statuses |
  | 1123 | 1243 | if ($field\_key === 'post\_status') { |
  | 1124 | 1244 | if ($product->is\_type('variation')) { |
  | 1125 | 1245 | unset($select\_options['draft']); |
  | 1126 | 1246 | unset($select\_options['pending']); |
  | 1127 | 1247 | } |
  | 1128 | 1248 | } |
  | 1129 | 1249 |  |
  | 1130 | 1250 | //\*\*\* |
  | 1131 | 1251 | $res = WOOBE\_HELPER::draw\_select(array( |
  | 1132 | 1252 | 'field' => $field\_key, |
  | 1133 | 1253 | 'product\_id' => $product\_id, |
  | 1134 | 1254 | 'class' => 'woobe\_data\_select ', |
  | 1135 | 1255 | 'options' => $select\_options, |
  | 1136 | 1256 | 'selected' => (isset($val['selected']) ? $val['selected'] : $val), |
  | 1137 | 1257 | 'onchange' => 'woobe\_act\_select(this)', |
  | 1138 | 1258 | )); |
  | 1139 | 1259 |  |
  | 1140 | 1260 | break; |
  | 1141 | 1261 |  |
  | 1142 | 1262 | case 'multi\_select': |
  | 1143 | 1263 |  |
  | 1144 | 1264 | $res = WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/elements/multi\_select.php', array( |
  | 1145 | 1265 | 'field\_key' => $field\_key, |
  | 1146 | 1266 | 'product\_id' => $product\_id, |
  | 1147 | 1267 | 'val' => $val, |
  | 1148 | 1268 | 'active\_fields' => $this->settings->active\_fields, |
  | 1149 | 1269 | 'post' => $post, |
  | 1150 | 1270 | )); |
  | 1151 | 1271 | break; |
  | 1152 | 1272 | case 'attr\_visibility': |
  | 1153 | 1273 |  |
  | 1154 | 1274 | $attributes = $this->products->get\_attributes($product\_id); |
  | 1155 | 1275 | $res = WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/elements/attribute\_visibility.php', array( |
  | 1156 | 1276 | 'field\_key' => $field\_key, |
  | 1157 | 1277 | 'attributes' => $attributes, |
  | 1158 | 1278 | 'product\_id' => $product\_id, |
  | 1159 | 1279 | 'post' => $post, |
  | 1160 | 1280 | )); |
  | 1161 | 1281 | break; |
  | 1162 | 1282 |  |
  | 1163 | 1283 | case 'popup': |
  | 1164 | 1284 | $res = WOOBE\_HELPER::draw\_taxonomy\_popup\_btn($val, $field\_key, $post); |
  | 1165 | 1285 |  |
  | 1166 | 1286 | break; |
  | 1167 | 1287 |  |
  | 1168 | 1288 | case 'popupeditor': |
  | 1169 | 1289 | $res = WOOBE\_HELPER::draw\_popup\_editor\_btn($val, $field\_key, $post); |
  | 1170 | 1290 | break; |
  | 1171 | 1291 |  |
  | 1172 | 1292 | case 'downloads\_popup\_editor': |
  | 1173 | 1293 | $res = WOOBE\_HELPER::draw\_downloads\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1174 | 1294 | break; |
  | 1175 | 1295 |  |
  | 1176 | 1296 | case 'gallery\_popup\_editor': |
  | 1177 | 1297 |  |
  | 1178 | 1298 | $res = WOOBE\_HELPER::draw\_gallery\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1179 | 1299 | break; |
  | 1180 | 1300 |  |
  | 1181 | 1301 | case 'upsells\_popup\_editor': |
  | 1182 | 1302 | $res = WOOBE\_HELPER::draw\_upsells\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1183 | 1303 | break; |
  | 1184 | 1304 |  |
  | 1185 | 1305 | case 'cross\_sells\_popup\_editor': |
  | 1186 | 1306 | $res = WOOBE\_HELPER::draw\_cross\_sells\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1187 | 1307 | break; |
  | 1188 | 1308 |  |
  | 1189 | 1309 | case 'grouped\_popup\_editor': |
  | 1190 | 1310 | $res = WOOBE\_HELPER::draw\_grouped\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1191 | 1311 | break; |
  | 1192 | 1312 |  |
  | 1193 | 1313 | case 'meta\_popup\_editor': |
  | 1194 | 1314 | $res = WOOBE\_HELPER::draw\_meta\_popup\_editor\_btn($field\_key, $product\_id); |
  | 1195 | 1315 | break; |
  | 1196 | 1316 |  |
  | 1197 | 1317 | case 'thumbnail': |
  | 1198 | 1318 | $thumbnail = wp\_get\_attachment\_image\_src($val, 'thumbnail'); |
  | 1199 | 1319 | $full = wp\_get\_attachment\_image\_src($val, 'full'); |
  | 1200 | 1320 |  |
  | 1201 | 1321 | if (!empty($thumbnail)) { |
  | 1202 | 1322 | $thumbnail = $thumbnail[0]; |
  | 1203 | 1323 | $full = $full[0]; |
  | 1204 | 1324 | } else { |
  | 1205 | 1325 | $thumbnail = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
  | 1206 | 1326 | $full = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
  | 1207 | 1327 | } |
  | 1208 | 1328 |  |
  | 1209 | 1329 | $onmouseover = ''; |
  | 1210 | 1330 | if ($this->settings->show\_thumbnail\_preview) { |
  | 1211 | 1331 | $onmouseover = 'onmouseover="woobe\_init\_image\_preview(this)"'; |
  | 1212 | 1332 | } |
  | 1213 | 1333 |  |
  | 1214 | 1334 | $res = '<a href="' . $full . '" onclick="return woobe\_act\_thumbnail(this)" ' . $onmouseover . ' title="' . $post['post\_title'] . '"><img src="' . $thumbnail . '" class="attachment-thumbnail size-thumbnail" alt="" /></a>'; |
  | 1215 | 1335 | break; |
  | 1216 | 1336 |  |
  | 1217 | 1337 | case 'switcher': |
  | 1218 | 1338 | $labels = array\_values($this->settings->active\_fields[$field\_key]['select\_options']); |
  | 1219 | 1339 | $values = array\_keys($this->settings->active\_fields[$field\_key]['select\_options']); |
  | 1220 | 1340 | if ($val) {//do switcher |
  | 1221 | 1341 | $val = WOOBE\_HELPER::over\_switcher\_val\_to\_swicher($val, $field\_key); |
  | 1222 | 1342 | } |
  | 1223 | 1343 | $res = WOOBE\_HELPER::draw\_advanced\_switcher(($val == $values[0] ? TRUE : FALSE), $product\_id . '\_' . $field\_key, $field\_key, array('true' => $labels[0], 'false' => $labels[1]), array('true' => $values[0], 'false' => $values[1]), 'yes'); |
  | 1224 | 1344 | break; |
  | 1225 | 1345 |  |
  | 1226 | 1346 | case 'calendar': |
  | 1227 | 1347 | if ($this->settings->active\_fields[$field\_key]['type'] === 'timestamp') { |
  | 1228 |  | $val = strtotime($val); |
  |  | 1348 | if ($val) { |
  |  | 1349 | $val = strtotime($val); |
  |  | 1350 | } else { |
  |  | 1351 | $val = false; |
  |  | 1352 | } |
  | 1229 | 1353 | } |
  | 1230 | 1354 | $time = true; |
  | 1231 | 1355 | if (in\_array($field\_key, array('date\_on\_sale\_from', 'date\_on\_sale\_to'))) { |
  | 1232 | 1356 | $time = false; |
  | 1233 | 1357 | if ($val) { |
  | 1234 | 1358 | $val = $val + get\_option('gmt\_offset') \* 3600; |
  | 1235 | 1359 | } |
  | 1236 | 1360 | } |
  | 1237 | 1361 |  |
  | 1238 | 1362 | $post\_title = $post['post\_title']; |
  | 1239 | 1363 |  |
  | 1240 | 1364 | if ($post['post\_type'] === 'product\_variation') { |
  | 1241 | 1365 | if ($this->settings->add\_vars\_to\_var\_title) { |
  | 1242 | 1366 | $post\_title = $this->products->generate\_product\_title($this->products->get\_product($product\_id)); |
  | 1243 | 1367 | } |
  | 1244 | 1368 | } |
  | 1245 | 1369 |  |
  | 1246 | 1370 | $res = WOOBE\_HELPER::draw\_calendar($product\_id, $post\_title . ' (' . $this->settings->active\_fields[$field\_key]['title'] . ')', $field\_key, $val, "", false, $time); |
  | 1247 | 1371 | break; |
  | 1248 | 1372 |  |
  | 1249 | 1373 | case 'checkbox': |
  | 1250 | 1374 | //using for products selection |
  | 1251 | 1375 | $res = WOOBE\_HELPER::draw\_checkbox(array( |
  | 1252 | 1376 | 'class' => 'woobe\_product\_check', |
  | 1253 | 1377 | 'data-product-id' => $product\_id |
  | 1254 | 1378 | )); |
  | 1255 | 1379 | break; |
  | 1256 | 1380 |  |
  | 1257 | 1381 | default: |
  | 1258 | 1382 | //textinput |
  | 1259 | 1383 | $sanitize = ''; |
  | 1260 | 1384 | if (isset($this->settings->active\_fields[$field\_key]['sanitize'])) { |
  | 1261 | 1385 | $sanitize = $this->settings->active\_fields[$field\_key]['sanitize']; |
  | 1262 | 1386 | } |
  | 1263 | 1387 |  |
  | 1264 | 1388 | $res = $this->products->sanitize\_answer\_value($field\_key, $sanitize, $val); |
  | 1265 | 1389 |  |
  | 1266 | 1390 | break; |
  | 1267 | 1391 | } |
  | 1268 | 1392 |  |
  | 1269 | 1393 | //\*\*\* |
  | 1270 | 1394 | //lets show product ID as LINK to the product |
  | 1271 | 1395 | if ($field\_key === 'ID') { |
  | 1272 | 1396 | $class = 'woobe-id-permalink'; |
  | 1273 | 1397 | $title = ''; |
  | 1274 | 1398 |  |
  | 1275 | 1399 | if ($product->get\_type() === 'variable') { |
  | 1276 | 1400 | $class .= ' woobe-id-permalink-var'; |
  | 1277 | 1401 | $title = esc\_html\_\_('see the product on the site OR select products variations if they are shown', 'woo-bulk-editor'); |
  | 1278 | 1402 | } |
  | 1279 | 1403 |  |
  | 1280 | 1404 | $res = '<a href="' . get\_permalink($res) . '" class="' . $class . '" title="' . $title . '" target="\_blank">' . $res . '</a>'; |
  | 1281 | 1405 | } |
  | 1282 | 1406 |  |
  | 1283 | 1407 | //\*\*\* |
  | 1284 | 1408 | /\* for tests |
  | 1285 | 1409 | $woobe\_operation\_time = get\_option('woobe\_operation\_time', 0); |
  | 1286 | 1410 | if (!$woobe\_operation\_time) { |
  | 1287 | 1411 | update\_option('woobe\_operation\_time', time()); |
  | 1288 | 1412 | } |
  | 1289 | 1413 | \*/ |
  | 1290 | 1414 | //\*\*\* |
  | 1291 |  |  |
  | 1292 |  | return $res; |
  |  | 1415 | return apply\_filters('woobe\_wrap\_field\_val', $res, $post, $field\_key, $product\_type); |
  | 1293 | 1416 | } |
  | 1294 | 1417 |  |
  | 1295 | 1418 | //ajax |
  | 1296 | 1419 | public function woobe\_delete\_tax\_term() { |
  | 1297 | 1420 | $term\_id = (int) $\_REQUEST['term\_id']; |
  | 1298 | 1421 | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
  | 1299 | 1422 | if (!taxonomy\_exists($taxonomy)) { |
  | 1300 | 1423 | die('Wrong taxonomy name.'); |
  | 1301 | 1424 | } |
  | 1302 | 1425 | $result = wp\_delete\_term($term\_id, $taxonomy); |
  | 1303 | 1426 | // check the result |
  | 1304 | 1427 | if (is\_wp\_error($result)) { |
  | 1305 | 1428 |  |
  | 1306 | 1429 | die('error wp\_update\_term'); |
  | 1307 | 1430 | } else { |
  | 1308 | 1431 |  |
  | 1309 | 1432 | echo json\_encode(WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy)); |
  | 1310 | 1433 | } |
  | 1311 | 1434 | exit; |
  | 1312 | 1435 | } |
  | 1313 | 1436 |  |
  | 1314 | 1437 | public function woobe\_update\_tax\_term() { |
  | 1315 | 1438 | $term\_id = (int) $\_REQUEST['term\_id']; |
  | 1316 | 1439 | $title = sanitize\_textarea\_field($\_REQUEST['title']); |
  | 1317 | 1440 | $slug = sanitize\_textarea\_field($\_REQUEST['slug']); |
  | 1318 | 1441 | $description = sanitize\_textarea\_field($\_REQUEST['description']); |
  | 1319 | 1442 | $parent = (int) $\_REQUEST['parent']; |
  | 1320 | 1443 | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
  | 1321 | 1444 | if (!taxonomy\_exists($taxonomy)) { |
  | 1322 | 1445 | die('Wrong taxonomy name.'); |
  | 1323 | 1446 | } |
  | 1324 | 1447 |  |
  | 1325 | 1448 | $result = wp\_update\_term($term\_id, $taxonomy, [ |
  | 1326 | 1449 | 'name' => $title, |
  | 1327 | 1450 | 'slug' => $slug, |
  | 1328 | 1451 | 'description' => $description, |
  | 1329 | 1452 | 'parent' => $parent |
  | 1330 |  | ]); |
  |  | 1453 | ]); |
  | 1331 | 1454 |  |
  | 1332 | 1455 | // check the result |
  | 1333 | 1456 | if (is\_wp\_error($result)) { |
  | 1334 | 1457 |  |
  | 1335 | 1458 | die('error wp\_update\_term'); |
  | 1336 | 1459 | } else { |
  | 1337 | 1460 |  |
  | 1338 | 1461 | echo json\_encode(WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy)); |
  | 1339 | 1462 | } |
  | 1340 | 1463 | exit; |
  | 1341 | 1464 | } |
  | 1342 | 1465 |  |
  | 1343 | 1466 | public function woobe\_create\_new\_term() { |
  | 1344 | 1467 |  |
  | 1345 | 1468 | $titles = $\_REQUEST['titles']; //sanitized in cycle |
  | 1346 | 1469 | $slugs = $\_REQUEST['slugs']; //sanitized in cycle |
  | 1347 | 1470 | $description = sanitize\_textarea\_field($\_REQUEST['description']); |
  | 1348 | 1471 | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
  | 1349 | 1472 |  |
  | 1350 | 1473 | if (!taxonomy\_exists($taxonomy)) { |
  | 1351 | 1474 | die('Wrong taxonomy name.'); |
  | 1352 | 1475 | } |
  | 1353 | 1476 |  |
  | 1354 | 1477 | //\*\*\* |
  | 1355 | 1478 |  |
  | 1356 | 1479 | if (!empty($titles)) { |
  | 1357 | 1480 |  |
  | 1358 | 1481 | if (substr\_count($titles, '|') > 0) { |
  | 1359 | 1482 | $titles = explode('|', $titles); |
  | 1360 | 1483 | } else { |
  | 1361 | 1484 | $titles = array($titles); |
  | 1362 | 1485 | } |
  | 1363 | 1486 |  |
  | 1364 | 1487 |  |
  | 1365 | 1488 | if (substr\_count($slugs, '|') > 0) { |
  | 1366 | 1489 | $slugs = explode('|', $slugs); |
  | 1367 | 1490 | } else { |
  | 1368 | 1491 | $slugs = array($slugs); |
  | 1369 | 1492 | } |
  | 1370 | 1493 |  |
  | 1371 | 1494 | //\*\*\* |
  | 1372 | 1495 |  |
  | 1373 | 1496 | $terms\_ids = array(); |
  | 1374 | 1497 | foreach ($titles as $k => $t) { |
  | 1375 | 1498 | $t = sanitize\_text\_field(trim($t)); |
  | 1376 | 1499 | $sl = sanitize\_title\_with\_dashes(trim($slugs[$k])); |
  | 1377 | 1500 |  |
  | 1378 | 1501 | if (!term\_exists($t, $taxonomy)) { |
  | 1379 | 1502 | if (!empty($t)) { |
  | 1380 | 1503 | $res = wp\_insert\_term($t, $taxonomy, array( |
  | 1381 | 1504 | 'parent' => intval($\_REQUEST['parent']), |
  | 1382 | 1505 | 'slug' => (boolval($sl) ? $sl : ''), |
  | 1383 | 1506 | 'description' => $description, |
  | 1384 | 1507 | )); |
  | 1385 | 1508 | $terms\_ids[] = $res['term\_id']; |
  | 1386 | 1509 | } else { |
  | 1387 | 1510 | unset($titles[$k]); |
  | 1388 | 1511 | } |
  | 1389 | 1512 | } |
  | 1390 | 1513 | } |
  | 1391 | 1514 |  |
  | 1392 | 1515 | //\*\*\* |
  | 1393 | 1516 |  |
  | 1394 | 1517 | echo json\_encode(array( |
  | 1395 | 1518 | 'titles' => array\_reverse($titles), |
  | 1396 | 1519 | 'terms\_ids' => array\_reverse($terms\_ids), |
  | 1397 | 1520 | 'terms' => WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy) |
  | 1398 | 1521 | )); |
  | 1399 | 1522 | } |
  | 1400 | 1523 | exit; |
  | 1401 | 1524 | } |
  | 1402 | 1525 |  |
  | 1403 | 1526 | public function clone\_custom\_taxonomies($origin, $clone) { |
  | 1404 | 1527 | $taxonomy\_objects = get\_object\_taxonomies('product', 'objects'); |
  | 1405 | 1528 | $taxonomies = array(); |
  | 1406 | 1529 | $exclude\_tax = array('product\_type', 'product\_visibility', 'product\_shipping\_class', 'product\_cat', 'product\_tag'); |
  | 1407 | 1530 | foreach ($taxonomy\_objects as $key => $taxonomy) { |
  | 1408 | 1531 | if (in\_array($key, $exclude\_tax)) { |
  | 1409 | 1532 | continue; |
  | 1410 | 1533 | } |
  | 1411 | 1534 | if (taxonomy\_is\_product\_attribute($key)) { |
  | 1412 | 1535 | continue; |
  | 1413 | 1536 | } |
  | 1414 | 1537 | $terms = get\_the\_terms($origin, $key); |
  | 1415 | 1538 | if ($terms AND is\_array($terms)) { |
  | 1416 | 1539 | $taxonomies = $taxonomies + $terms; |
  | 1417 | 1540 | } |
  | 1418 | 1541 | } |
  | 1419 | 1542 |  |
  | 1420 | 1543 | foreach ($taxonomies as $term) { |
  | 1421 | 1544 | wp\_set\_post\_terms($clone, $term->term\_id, $term->taxonomy, true); |
  | 1422 | 1545 | } |
  | 1423 | 1546 | } |
  | 1424 | 1547 |  |
  | 1425 | 1548 | //do not init functionality on all site pages as it not nessesary |
  | 1426 | 1549 | private function is\_should\_init() { |
  | 1427 | 1550 | //do not onit it exept of one woobe page and its ajax requests |
  | 1428 | 1551 | $init = (isset($\_GET['page']) AND $\_GET['page'] === 'woobe'); |
  | 1429 | 1552 |  |
  | 1430 | 1553 | if (defined('DOING\_AJAX')) { |
  | 1431 |  | if (strpos($\_REQUEST['action'], 'woobe\_') !== FALSE) { |
  |  | 1554 | if (isset($\_REQUEST['action']) && strpos($\_REQUEST['action'], 'woobe\_') !== FALSE) { |
  | 1432 | 1555 | $init = true; |
  | 1433 | 1556 | } |
  | 1434 | 1557 | } |
  | 1435 | 1558 |  |
  | 1436 | 1559 | return $init; |
  | 1437 | 1560 | } |
  | 1438 | 1561 |  |
  | 1439 | 1562 | public function add\_statuses($statuses) { |
  | 1440 | 1563 | return $statuses + [ |
  | 1441 | 1564 | 'future' => esc\_html\_\_('Scheduled', 'woo-bulk-editor') |
  | 1442 | 1565 | ]; |
  | 1443 | 1566 | } |
  | 1444 | 1567 |  |
  | 1445 | 1568 | public function ask\_favour() { |
  | 1446 | 1569 |  |
  | 1447 | 1570 | if (intval(get\_option('woobe\_manage\_rate\_alert', 0)) === -2) { |
  | 1448 | 1571 | //old rate system mark for already set review users |
  | 1449 | 1572 | return; |
  | 1450 | 1573 | } |
  | 1451 | 1574 |  |
  | 1452 | 1575 | $slug = strtolower(get\_class($this)); |
  | 1453 | 1576 |  |
  | 1454 | 1577 | add\_action("wp\_ajax\_{$slug}\_dismiss\_rate\_alert", function () use ($slug) { |
  | 1455 | 1578 | update\_option("{$slug}\_dismiss\_rate\_alert", 2); |
  | 1456 | 1579 | }); |
  | 1457 | 1580 |  |
  | 1458 | 1581 | add\_action("wp\_ajax\_{$slug}\_later\_rate\_alert", function () use ($slug) { |
  | 1459 | 1582 | update\_option("{$slug}\_later\_rate\_alert", time() + 4 \* 7 \* 24 \* 60 \* 60); //4 weeks |
  | 1460 | 1583 | }); |
  | 1461 | 1584 |  |
  | 1462 | 1585 | //+++ |
  | 1463 | 1586 |  |
  | 1464 | 1587 | add\_action('admin\_notices', function () use ($slug) { |
  | 1465 | 1588 |  |
  | 1466 | 1589 | if (!current\_user\_can('manage\_options')) { |
  | 1467 | 1590 | return; //show to admin only |
  | 1468 | 1591 | } |
  | 1469 | 1592 |  |
  | 1470 | 1593 | if (intval(get\_option("{$slug}\_dismiss\_rate\_alert", 0)) === 2) { |
  | 1471 | 1594 | return; |
  | 1472 | 1595 | } |
  | 1473 | 1596 |  |
  | 1474 | 1597 | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) === 0) { |
  | 1475 | 1598 | update\_option("{$slug}\_later\_rate\_alert", time() + 3 \* 24 \* 60 \* 60); //3 days after install |
  | 1476 | 1599 | return; |
  | 1477 | 1600 | } |
  | 1478 | 1601 |  |
  | 1479 | 1602 | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) > time()) { |
  | 1480 | 1603 | return; |
  | 1481 | 1604 | } |
  | 1482 | 1605 |  |
  | 1483 | 1606 | $link = 'https://codecanyon.net/downloads#item-21779835'; |
  | 1484 | 1607 | $on = 'CodeCanyon'; |
  | 1485 | 1608 | if ($this->show\_notes) { |
  | 1486 | 1609 | $link = 'https://wordpress.org/support/plugin/woo-bulk-editor/reviews/?filter=5#new-post'; |
  | 1487 | 1610 | $on = 'WordPress'; |
  | 1488 | 1611 | } |
  | 1489 | 1612 | ?> |
  | 1490 | 1613 | <div class="notice notice-info" id="pn\_<?php echo $slug ?>\_ask\_favour" style="position: relative;"> |
  | 1491 | 1614 | <button onclick="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); |
  | 1492 |  | void(0);" title="<?php esc\_html\_e('Later', 'woo-bulk-editor'); ?>" class="notice-dismiss"></button> |
  |  | 1615 | void(0);" title="<?php esc\_html\_e('Later', 'woo-bulk-editor'); ?>" class="notice-dismiss"></button> |
  | 1493 | 1616 | <div id="pn\_<?php echo $slug ?>\_review\_suggestion"> |
  | 1494 | 1617 | <p><?php esc\_html\_e('Hi! Are you enjoying using BEAR - WooCommerce Bulk Editor and Products Manager Professional?', 'woo-bulk-editor'); ?></p> |
  | 1495 | 1618 | <p><a href="javascript: pn\_<?php echo $slug ?>\_set\_review(1); void(0);"><?php esc\_html\_e('Yes, I love it', 'woo-bulk-editor'); ?></a> 🙂 | <a href="javascript: pn\_<?php echo $slug ?>\_set\_review(0); void(0);"><?php esc\_html\_e('Not really...', 'woo-bulk-editor'); ?></a></p> |
  | 1496 | 1619 | </div> |
  | 1497 | 1620 |  |
  | 1498 | 1621 | <div id="pn\_<?php echo $slug ?>\_review\_yes" style="display: none;"> |
  | 1499 | 1622 | <p><?php printf(esc\_html\_\_('That\'s awesome! Could you please do us a BIG favor and give it a 5-star rating on %s to help us spread the word and boost our motivation?', 'woo-bulk-editor'), $on) ?></p> |
  | 1500 | 1623 | <p style="font-weight: bold;">~ PluginUs.NET developers team</p> |
  | 1501 | 1624 | <p> |
  | 1502 | 1625 | <a href="<?php echo $link ?>" style="display: inline-block; margin-right: 10px;" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Okay, you deserve it', 'woo-bulk-editor'); ?></a> |
  | 1503 | 1626 | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); void(0);" style="display: inline-block; margin-right: 10px;"><?php esc\_html\_e('Nope, maybe later', 'woo-bulk-editor'); ?></a> |
  | 1504 | 1627 | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('I already did', 'woo-bulk-editor'); ?></a> |
  | 1505 | 1628 | </p> |
  | 1506 | 1629 | </div> |
  | 1507 | 1630 |  |
  | 1508 | 1631 | <div id="pn\_<?php echo $slug ?>\_review\_no" style="display: none;"> |
  | 1509 | 1632 | <p><?php esc\_html\_e('We are sorry to hear you aren\'t enjoying BEAR. We would love a chance to improve it. Could you take a minute and let us know what we can do better?', 'woo-bulk-editor'); ?></p> |
  | 1510 | 1633 | <p> |
  | 1511 | 1634 | <a href="https://pluginus.net/contact-us/" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Give Feedback', 'woo-bulk-editor'); ?></a>&nbsp; |
  | 1512 | 1635 | |&nbsp;<a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('No thanks', 'woo-bulk-editor'); ?></a> |
  | 1513 | 1636 | </p> |
  | 1514 | 1637 | </div> |
  | 1515 | 1638 |  |
  | 1516 | 1639 |  |
  | 1517 | 1640 | <script> |
  | 1518 | 1641 | function pn\_<?php echo $slug ?>\_set\_review(yes) { |
  | 1519 | 1642 | document.getElementById('pn\_<?php echo $slug ?>\_review\_suggestion').style.display = 'none'; |
  | 1520 | 1643 | if (yes) { |
  | 1521 | 1644 | document.getElementById('pn\_<?php echo $slug ?>\_review\_yes').style.display = 'block'; |
  | 1522 | 1645 | } else { |
  | 1523 | 1646 | document.getElementById('pn\_<?php echo $slug ?>\_review\_no').style.display = 'block'; |
  | 1524 | 1647 | } |
  | 1525 | 1648 | } |
  | 1526 | 1649 |  |
  | 1527 | 1650 | function pn\_<?php echo $slug ?>\_dismiss\_review(what = 1) { |
  | 1528 | 1651 | //1 maybe later, 2 do not ask more |
  | 1529 | 1652 | jQuery('#pn\_<?php echo $slug ?>\_ask\_favour').fadeOut(); |
  | 1530 | 1653 |  |
  | 1531 | 1654 | if (what === 1) { |
  | 1532 | 1655 | jQuery.post(ajaxurl, { |
  | 1533 | 1656 | action: '<?php echo $slug ?>\_later\_rate\_alert' |
  | 1534 | 1657 | }); |
  | 1535 | 1658 | } else { |
  | 1536 | 1659 | jQuery.post(ajaxurl, { |
  | 1537 | 1660 | action: '<?php echo $slug ?>\_dismiss\_rate\_alert' |
  | 1538 | 1661 | }); |
  | 1539 | 1662 | } |
  | 1540 | 1663 |  |
  | 1541 | 1664 | return true; |
  | 1542 | 1665 | } |
  | 1543 | 1666 | </script> |
  | 1544 | 1667 | </div> |
  | 1545 | 1668 | <?php |
  | 1546 | 1669 | }); |
  | 1547 | 1670 | } |
  | 1548 | 1671 |  |
  | 1549 | 1672 | } |
  | 1550 | 1673 |  |
  | 1551 | 1674 | //\*\*\* |
  | 1552 | 1675 |  |
  | 1553 |  | ~~function woobe\_init\_translates() {~~ |
  | 1554 |  | ~~try {~~ |
  | 1555 |  | ~~$lang\_domain = 'woo-bulk-editor';~~ |
  | 1556 |  | ~~$lang\_dir = WP\_CONTENT\_DIR . '/languages/plugins/';~~ |
  | 1557 |  | ~~$locale = get\_locale();~~ |
  | 1558 |  | ~~unload\_textdomain($lang\_domain);~~ |
  | 1559 |  |  |
  | 1560 |  | ~~if (is\_file("{$lang\_dir}{$lang\_domain}-{$locale}.mo")) {~~ |
  | 1561 |  | ~~load\_textdomain($lang\_domain, "{$lang\_dir}{$lang\_domain}-{$locale}.mo");~~ |
  | 1562 |  | ~~} else {~~ |
  | 1563 |  | ~~if (is\_file(WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo")) {~~ |
  | 1564 |  | ~~load\_textdomain($lang\_domain, WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo");~~ |
  | 1565 |  | ~~} else {~~ |
  | 1566 |  | ~~load\_plugin\_textdomain($lang\_domain, false, WOOBE\_PATH . 'languages');~~ |
  | 1567 |  | ~~}~~ |
  | 1568 |  | ~~}~~ |
  | 1569 |  | ~~} catch (Exception $e) {~~ |
  | 1570 |  | ~~//+++~~ |
  | 1571 |  | ~~}~~ |
  | 1572 |  | ~~}~~ |
  | 1573 |  |  |
  | 1574 |  | ~~//\*\*\*~~ |
  | 1575 |  |  |
  | 1576 | 1676 |  |
  | 1577 | 1677 | $WOOBE = new WOOBE(); |
  | 1578 | 1678 | $GLOBALS['WOOBE'] = $WOOBE; |
  | 1579 | 1679 | add\_action('init', array($WOOBE, 'init'), 9999); |
  | 1580 | 1680 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2970262&old=2968292&new_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php&old_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php)
* [Zip Archive](?format=zip&new=2970262&old=2968292&new_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php&old_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c27ad9c5_20250115_082225.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwoo-bulk-editor%2Ftrunk%2Findex.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/woo-bulk-editor/trunk/index.php?rev=3123714 "Revision 3123714")
* Next Revision →
* [Blame](/browser/woo-bulk-editor/trunk/index.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/woo-bulk-editor/trunk/index.php)

---

# [source:](/browser?order=name "Go to repository root") [woo-bulk-editor](/browser/woo-bulk-editor?order=name "View woo-bulk-editor")/[trunk](/browser/woo-bulk-editor/trunk?order=name "View trunk")/[index.php](/browser/woo-bulk-editor/trunk/index.php?order=name "View index.php")

View diff against:

View revision:

| [Last change](/changeset/3204795/woo-bulk-editor/trunk/index.php "View differences") on this file was [3204795](/changeset/3204795/ "View changeset 3204795"), checked in by RealMag777, [5 weeks ago](/timeline?from=2024-12-09T11%3A20%3A14Z&precision=second "See timeline at 12/09/2024 11:20:14 AM") |
| --- |
| security fix, thanks to Satrya wira yudha and patchstack.com |
| **File size:** 71.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: BEAR – Bulk Editor and Products Manager Professional for WooCommerce |
| [4](#L4) | Plugin URI: https://bulk-editor.com/ |
| [5](#L5) | Description: Tools for managing and bulk edit <strong>WooCommerce Products</strong> data in the reliable and flexible way! Be professionals with managing data of your e-shop! |
| [6](#L6) | Requires at least: WP 4.9 |
| [7](#L7) | Tested up to: WP 6.7 |
| [8](#L8) | Author: realmag777 |
| [9](#L9) | Author URI: https://pluginus.net/ |
| [10](#L10) | Version: 1.1.4.5 |
| [11](#L11) | Requires PHP: 7.2 |
| [12](#L12) | Tags: woocommerce, woocommerce bulk edit, bulk edit, bulk, products editor |
| [13](#L13) | Text Domain: woo-bulk-editor |
| [14](#L14) | Domain Path: /languages |
| [15](#L15) | WC requires at least: 3.6 |
| [16](#L16) | WC tested up to: 9.4 |
| [17](#L17) | Forum URI: https://pluginus.net/support/forum/woobe-woocommerce-bulk-editor-professional/ |
| [18](#L18) | \*/ |
| [19](#L19) |  |
| [20](#L20) | //update\_option('woobe\_options\_' . get\_current\_user\_id(), ''); //absolute reset of the plugin settings - be care |
| [21](#L21) | if (!defined('ABSPATH')) { |
| [22](#L22) | exit; // Exit if accessed directly |
| [23](#L23) | } |
| [24](#L24) |  |
| [25](#L25) | if (defined('WOOBE\_PATH')) { |
| [26](#L26) | add\_action('admin\_notices', function () { |
| [27](#L27) | ?> |
| [28](#L28) | <div class="notice notice-error is-dismissible"> |
| [29](#L29) | <p><?php esc\_html\_e("Hello, looks like you bought and installed premium version of BEAR - WooCommerce Bulk Editor and Products Manager Professional, please deactivate free version before, then uninstall it. Any way: 2 versions of the same plugin cannot be activated on the same time! Use most new one version.", 'woo-bulk-editor'); ?></p> |
| [30](#L30) | </div> |
| [31](#L31) | <?php |
| [32](#L32) | }); |
| [33](#L33) |  |
| [34](#L34) | return false; |
| [35](#L35) | } |
| [36](#L36) |  |
| [37](#L37) | //\*\*\* |
| [38](#L38) | add\_action('before\_woocommerce\_init', function () { |
| [39](#L39) | if (class\_exists('\Automattic\WooCommerce\Utilities\FeaturesUtil')) { |
| [40](#L40) | \Automattic\WooCommerce\Utilities\FeaturesUtil::declare\_compatibility('custom\_order\_tables', \_\_FILE\_\_, true); |
| [41](#L41) | } |
| [42](#L42) | }); |
| [43](#L43) |  |
| [44](#L44) | define('WOOBE\_PATH', plugin\_dir\_path(\_\_FILE\_\_)); |
| [45](#L45) | define('WOOBE\_LINK', plugin\_dir\_url(\_\_FILE\_\_)); |
| [46](#L46) | define('WOOBE\_ASSETS\_LINK', WOOBE\_LINK . 'assets/'); |
| [47](#L47) | define('WOOBE\_DATA\_PATH', WOOBE\_PATH . 'data/'); |
| [48](#L48) | define('WOOBE\_PLUGIN\_NAME', plugin\_basename(\_\_FILE\_\_)); |
| [49](#L49) | define('WOOBE\_VERSION', '1.1.4.5'); |
| [50](#L50) | //define('WOOBE\_VERSION', uniqid('woobe-'));//dev |
| [51](#L51) | define('WOOBE\_MIN\_WOOCOMMERCE\_VERSION', '3.6'); |
| [52](#L52) |  |
| [53](#L53) | //+++ |
| [54](#L54) |  |
| [55](#L55) | try { |
| [56](#L56) | $lang\_domain = 'woo-bulk-editor'; |
| [57](#L57) | $lang\_dir = WP\_CONTENT\_DIR . '/languages/plugins/'; |
| [58](#L58) | $locale = get\_locale(); |
| [59](#L59) | unload\_textdomain($lang\_domain); |
| [60](#L60) |  |
| [61](#L61) | if (is\_file("{$lang\_dir}{$lang\_domain}-{$locale}.mo")) { |
| [62](#L62) | load\_textdomain($lang\_domain, "{$lang\_dir}{$lang\_domain}-{$locale}.mo"); |
| [63](#L63) | } else { |
| [64](#L64) | if (is\_file(WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo")) { |
| [65](#L65) | load\_textdomain($lang\_domain, WOOBE\_PATH . "languages/{$lang\_domain}-{$locale}.mo"); |
| [66](#L66) | } else { |
| [67](#L67) | load\_plugin\_textdomain($lang\_domain, false, WOOBE\_PATH . 'languages'); |
| [68](#L68) | } |
| [69](#L69) | } |
| [70](#L70) | } catch (Exception $e) { |
| [71](#L71) | //+++ |
| [72](#L72) | } |
| [73](#L73) |  |
| [74](#L74) | //+++ |
| [75](#L75) | //libs |
| [76](#L76) | include WOOBE\_PATH . 'lib/storage.php'; |
| [77](#L77) |  |
| [78](#L78) | //data |
| [79](#L79) | include\_once WOOBE\_DATA\_PATH . 'fields.php'; |
| [80](#L80) | include\_once WOOBE\_DATA\_PATH . 'settings.php'; |
| [81](#L81) |  |
| [82](#L82) | //classes |
| [83](#L83) | include WOOBE\_PATH . 'classes/helper.php'; |
| [84](#L84) | include WOOBE\_PATH . 'classes/models/profiles.php'; |
| [85](#L85) | include WOOBE\_PATH . 'classes/models/settings.php'; |
| [86](#L86) | include WOOBE\_PATH . 'classes/models/products.php'; |
| [87](#L87) | include WOOBE\_PATH . 'classes/ext.php'; |
| [88](#L88) | include WOOBE\_PATH . 'classes/alert.php'; |
| [89](#L89) |  |
| [90](#L90) | //09-12-2024 |
| [91](#L91) | final class WOOBE { |
| [92](#L92) |  |
| [93](#L93) | public $storage = NULL; |
| [94](#L94) | public $settings = NULL; |
| [95](#L95) | public $products = NULL; |
| [96](#L96) | public $profiles = NULL; |
| [97](#L97) | private $ext = array('filters', 'bulk', 'export', 'meta', 'history', 'calculator', 'info', 'fprofiles', 'bulkoperations', 'vendor\_area'); |
| [98](#L98) | public $show\_notes = true; |
| [99](#L99) | //extensions |
| [100](#L100) | public $filters = null; |
| [101](#L101) | public $bulk = null; |
| [102](#L102) | public $export = null; |
| [103](#L103) | public $meta = null; |
| [104](#L104) | public $history = null; |
| [105](#L105) | public $calculator = null; |
| [106](#L106) | public $info = null; |
| [107](#L107) | public $fprofiles = null; |
| [108](#L108) | public $bulkoperations = null; |
| [109](#L109) | public $vendor\_area = null; |
| [110](#L110) |  |
| [111](#L111) | public function \_\_construct() { |
| [112](#L112) | add\_action('admin\_enqueue\_scripts', array($this, 'admin\_enqueue\_scripts')); |
| [113](#L113) | //fix for sheduled post |
| [114](#L114) | add\_filter('woobe\_product\_statuses', array($this, 'add\_statuses')); |
| [115](#L115) | } |
| [116](#L116) |  |
| [117](#L117) | public function init() { |
| [118](#L118) |  |
| [119](#L119) | if (!is\_admin()) { |
| [120](#L120) | return; |
| [121](#L121) | } |
| [122](#L122) |  |
| [123](#L123) | if (!class\_exists('WooCommerce')) { |
| [124](#L124) | return; |
| [125](#L125) | } |
| [126](#L126) |  |
| [127](#L127) | //no one operation is possible if user is not products administrator!! |
| [128](#L128) | if (!current\_user\_can('manage\_woocommerce')) { |
| [129](#L129) | return; |
| [130](#L130) | } |
| [131](#L131) |  |
| [132](#L132) | $this->ask\_favour(); |
| [133](#L133) |  |
| [134](#L134) | //\*\*\* |
| [135](#L135) |  |
| [136](#L136) | add\_filter('plugin\_action\_links\_' . WOOBE\_PLUGIN\_NAME, array($this, 'plugin\_action\_links'), 50); |
| [137](#L137) |  |
| [138](#L138) | //\*\*\* |
| [139](#L139) |  |
| [140](#L140) | if (isset($\_GET['page']) AND $\_GET['page'] == 'woobe') { |
| [141](#L141) | //WOOCS compatibility |
| [142](#L142) | if (class\_exists('WOOCS')) { |
| [143](#L143) | global $WOOCS; |
| [144](#L144) | $WOOCS->reset\_currency(); |
| [145](#L145) | remove\_filter('woocommerce\_product\_get\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
| [146](#L146) | remove\_filter('woocommerce\_product\_variation\_get\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
| [147](#L147) | remove\_filter('woocommerce\_product\_variation\_get\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
| [148](#L148) | remove\_filter('woocommerce\_product\_variation\_get\_sale\_price', array($WOOCS, 'raw\_sale\_price\_filter'), 9999, 2); |
| [149](#L149) | remove\_filter('woocommerce\_product\_get\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 2); |
| [150](#L150) | remove\_filter('woocommerce\_product\_get\_sale\_price', array($WOOCS, 'raw\_woocommerce\_price\_sale'), 9999, 2); |
| [151](#L151) | remove\_filter('woocommerce\_get\_variation\_regular\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 4); |
| [152](#L152) | remove\_filter('woocommerce\_get\_variation\_sale\_price', array($WOOCS, 'raw\_woocommerce\_price'), 9999, 4); |
| [153](#L153) | remove\_filter('woocommerce\_variation\_prices', array($WOOCS, 'woocommerce\_variation\_prices'), 9999, 3); |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | add\_action('admin\_notices', function () { |
| [157](#L157) | $user\_id = get\_current\_user\_id(); |
| [158](#L158) | if (!get\_user\_meta($user\_id, 'woobe\_notice\_dismissed')) { |
| [159](#L159) | echo '<div class="notice notice-warning"><p>' . sprintf(esc\_html\_\_('If you not familiar with the plugin, firstly %s please', 'woo-bulk-editor'), WOOBE\_HELPER::draw\_link(array( |
| [160](#L160) | 'title' => esc\_html\_\_('visit this page', 'woo-bulk-editor'), |
| [161](#L161) | 'href' => 'https://bulk-editor.com/document/woocommerce-products-editor/', |
| [162](#L162) | 'target' => '\_blank', |
| [163](#L163) | 'style' => 'line-height: 2em;' |
| [164](#L164) | ))) . '</p><a href="edit.php?post\_type=product&page=woobe&woobe-notice-dismissed=1&notice\_nonce=' . wp\_create\_nonce('woobe\_notice\_nonce') . '" class="notice-dismiss"></a></div>'; |
| [165](#L165) | } |
| [166](#L166) | }); |
| [167](#L167) | add\_action('admin\_init', function () { |
| [168](#L168) | $user\_id = get\_current\_user\_id(); |
| [169](#L169) | if (isset($\_GET['woobe-notice-dismissed']) && isset($\_GET['notice\_nonce']) && wp\_verify\_nonce($\_GET['notice\_nonce'], 'woobe\_notice\_nonce')) { |
| [170](#L170) | add\_user\_meta($user\_id, 'woobe\_notice\_dismissed', 'true', true); |
| [171](#L171) | } |
| [172](#L172) | }); |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | //side bar menu |
| [176](#L176) | add\_action('admin\_menu', function () { |
| [177](#L177) | add\_submenu\_page('edit.php?post\_type=product', 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), 'manage\_woocommerce', 'woobe', function () { |
| [178](#L178) | $this->print\_plugin\_options(); |
| [179](#L179) | }); |
| [180](#L180) | }, 99); |
| [181](#L181) |  |
| [182](#L182) | add\_action('admin\_bar\_menu', function ($wp\_admin\_bar) { |
| [183](#L183) | $opt = get\_option('woobe\_options\_' . apply\_filters('woobe\_settings\_key\_options', get\_current\_user\_id())); //not beauty but we need it here |
| [184](#L184) | $show = true; |
| [185](#L185) | if (isset($opt['options']['show\_admin\_bar\_menu\_btn'])) { |
| [186](#L186) | $show = intval($opt['options']['show\_admin\_bar\_menu\_btn']); |
| [187](#L187) | } |
| [188](#L188) |  |
| [189](#L189) | if ($show) { |
| [190](#L190) | $args = array( |
| [191](#L191) | 'id' => 'woobe-btn', |
| [192](#L192) | 'title' => 'BEAR ' . esc\_html\_\_('Bulk Editor', 'woo-bulk-editor'), |
| [193](#L193) | 'href' => admin\_url('edit.php?post\_type=product&page=woobe'), |
| [194](#L194) | 'meta' => array( |
| [195](#L195) | 'class' => 'wp-admin-bar-woobe-btn', |
| [196](#L196) | 'title' => 'BEAR - WooCommerce Bulk Editor' |
| [197](#L197) | ) |
| [198](#L198) | ); |
| [199](#L199) | $wp\_admin\_bar->add\_node($args); |
| [200](#L200) | } |
| [201](#L201) | unset($opt); |
| [202](#L202) | }, 250); |
| [203](#L203) |  |
| [204](#L204) | //do not init hooks and all other parts of the plugins as we not need it on all site pages |
| [205](#L205) | if (!$this->is\_should\_init()) { |
| [206](#L206) | return; |
| [207](#L207) | } |
| [208](#L208) |  |
| [209](#L209) | //\*\*\* |
| [210](#L210) | //include extensions and their hooks |
| [211](#L211) | if (!empty($this->ext)) { |
| [212](#L212) | foreach ($this->ext as $ext\_slug) { |
| [213](#L213) | include WOOBE\_PATH . 'ext' . DIRECTORY\_SEPARATOR . $ext\_slug . DIRECTORY\_SEPARATOR . $ext\_slug . '.php'; |
| [214](#L214) | $class\_name = 'WOOBE\_' . strtoupper($ext\_slug); |
| [215](#L215) | $this->$ext\_slug = new $class\_name(); |
| [216](#L216) | } |
| [217](#L217) | } |
| [218](#L218) |  |
| [219](#L219) | //woobe\_ext - include extensions from wp-content folder |
| [220](#L220) | $woobe\_more\_ext\_path = WP\_CONTENT\_DIR . DIRECTORY\_SEPARATOR . 'woobe\_ext'; |
| [221](#L221) | if (file\_exists($woobe\_more\_ext\_path)) { |
| [222](#L222) | $dir = new DirectoryIterator($woobe\_more\_ext\_path); |
| [223](#L223) | foreach ($dir as $fileinfo) { |
| [224](#L224) | if ($fileinfo->isDir() AND !$fileinfo->isDot()) { |
| [225](#L225) | $ext\_slug = trim($fileinfo->getFilename()); |
| [226](#L226) | include $woobe\_more\_ext\_path . DIRECTORY\_SEPARATOR . $ext\_slug . DIRECTORY\_SEPARATOR . $ext\_slug . '.php'; |
| [227](#L227) | $class\_name = 'WOOBE\_' . strtoupper($ext\_slug); |
| [228](#L228) | $this->$ext\_slug = new $class\_name(); |
| [229](#L229) | $this->ext[] = $ext\_slug; |
| [230](#L230) | } |
| [231](#L231) | } |
| [232](#L232) | } |
| [233](#L233) |  |
| [234](#L234) |  |
| [235](#L235) | //\*\*\* |
| [236](#L236) | //init variables and hooks of the extensions will be applied, for example hook woobe\_extend\_fields |
| [237](#L237) | $this->storage = new WOOBE\_STORAGE(); |
| [238](#L238) | $this->settings = new WOOBE\_SETTINGS(); |
| [239](#L239) |  |
| [240](#L240) | $this->profiles = new WOOBE\_PROFILES($this->settings); |
| [241](#L241) | $this->products = new WOOBE\_PRODUCTS($this->settings, $this->storage); |
| [242](#L242) |  |
| [243](#L243) | if (!empty($this->ext)) { |
| [244](#L244) | foreach ($this->ext as $ext\_slug) { |
| [245](#L245) | //we do it to allow ext hooks works everywhere (in the application and all its extensions) |
| [246](#L246) | $this->$ext\_slug->init\_vars($this->storage, $this->profiles, $this->settings, $this->products); |
| [247](#L247) | } |
| [248](#L248) | } |
| [249](#L249) |  |
| [250](#L250) |  |
| [251](#L251) | //\*\*\* |
| [252](#L252) | //load\_plugin\_textdomain('woo-bulk-editor', false, 'woo-bulk-editor/languages'); |
| [253](#L253) | //ajax |
| [254](#L254) | add\_action('wp\_ajax\_woobe\_get\_products', array($this, 'woobe\_get\_products'), 1); |
| [255](#L255) | add\_action('wp\_ajax\_woobe\_update\_page\_field', array($this, 'woobe\_update\_page\_field'), 1); |
| [256](#L256) | add\_action('wp\_ajax\_woobe\_redraw\_table\_row', array($this, 'woobe\_redraw\_table\_row'), 1); |
| [257](#L257) | add\_action('wp\_ajax\_woobe\_get\_post\_field', array($this, 'get\_post\_field'), 1); |
| [258](#L258) | add\_action('wp\_ajax\_woobe\_get\_downloads', array($this, 'get\_downloads'), 1); |
| [259](#L259) | add\_action('wp\_ajax\_woobe\_get\_gallery', array($this, 'woobe\_get\_gallery'), 1); |
| [260](#L260) | add\_action('wp\_ajax\_woobe\_get\_upsells', array($this, 'woobe\_get\_upsells'), 1); |
| [261](#L261) | add\_action('wp\_ajax\_woobe\_get\_cross\_sells', array($this, 'woobe\_get\_cross\_sells'), 1); |
| [262](#L262) | add\_action('wp\_ajax\_woobe\_get\_grouped', array($this, 'woobe\_get\_grouped'), 1); |
| [263](#L263) |  |
| [264](#L264) | add\_action('wp\_ajax\_woobe\_create\_new\_product', array($this, 'woobe\_create\_new\_product'), 1); |
| [265](#L265) | add\_action('wp\_ajax\_woobe\_duplicate\_products', array($this, 'woobe\_duplicate\_products'), 1); |
| [266](#L266) | add\_action('wp\_ajax\_woobe\_delete\_products', array($this, 'woobe\_delete\_products'), 1); |
| [267](#L267) |  |
| [268](#L268) | add\_action('wp\_ajax\_woobe\_create\_new\_term', array($this, 'woobe\_create\_new\_term'), 1); |
| [269](#L269) | add\_action('wp\_ajax\_woobe\_update\_tax\_term', array($this, 'woobe\_update\_tax\_term'), 1); |
| [270](#L270) | add\_action('wp\_ajax\_woobe\_delete\_tax\_term', array($this, 'woobe\_delete\_tax\_term'), 1); |
| [271](#L271) |  |
| [272](#L272) | //\*\*\* |
| [273](#L273) | add\_action('wp\_ajax\_woobe\_title\_autocomplete', array($this, 'woobe\_title\_autocomplete')); |
| [274](#L274) | add\_action('wp\_ajax\_woobe\_save\_options', array($this, 'woobe\_save\_options'), 1); |
| [275](#L275) |  |
| [276](#L276) | //\*\*\* |
| [277](#L277) | add\_post\_type\_support('product', 'author'); |
| [278](#L278) |  |
| [279](#L279) | $alert = new WOOBE\_ADV(); |
| [280](#L280) | $alert->init(); |
| [281](#L281) | } |
| [282](#L282) |  |
| [283](#L283) | /\*\* |
| [284](#L284) | \* Show action links on the plugins page screen |
| [285](#L285) | \*/ |
| [286](#L286) | public function plugin\_action\_links($links) { |
| [287](#L287) |  |
| [288](#L288) | $buttons = array( |
| [289](#L289) | '<a href="' . admin\_url('edit.php?post\_type=product&page=woobe') . '">' . esc\_html\_\_('Products Editor', 'woo-bulk-editor') . '</a>', |
| [290](#L290) | '<a target="\_blank" href="https://bulk-editor.com/"><span class="icon-book"></span>&nbsp;' . esc\_html\_\_('Documentation', 'woo-bulk-editor') . '</a>' |
| [291](#L291) | ); |
| [292](#L292) |  |
| [293](#L293) | if ($this->show\_notes) { |
| [294](#L294) | $buttons[] = '<a target="\_blank" style="color: red; font-weight: bold;" href="' . esc\_url('https://pluginus.net/affiliate/woocommerce-bulk-editor') . '">' . esc\_html\_\_('Go Pro!', 'woo-bulk-editor') . '</a>'; |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | return array\_merge($buttons, $links); |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | public function admin\_enqueue\_scripts() { |
| [301](#L301) | if (isset($\_GET['page']) AND $\_GET['page'] == 'woobe') { |
| [302](#L302) | ?> |
| [303](#L303) | <script> |
| [304](#L304) | var lang = { |
| [305](#L305) | move: "<?php echo esc\_html\_\_('move', 'woo-bulk-editor') ?>", |
| [306](#L306) | search: "<?php echo esc\_html\_\_('Search', 'woo-bulk-editor') ?>", |
| [307](#L307) | rest\_failed: "<?php echo esc\_html\_\_('Failed', 'woo-bulk-editor') ?>", |
| [308](#L308) | error: "<?php echo esc\_html\_\_('Error', 'woo-bulk-editor') ?>", |
| [309](#L309) | delete: "<?php echo esc\_html\_\_('delete', 'woo-bulk-editor') ?>", |
| [310](#L310) | ignore: "<?php echo esc\_html\_\_('ignore', 'woo-bulk-editor') ?>", |
| [311](#L311) | no\_deletable: "<?php echo esc\_html\_\_('This is not deletable!', 'woo-bulk-editor') ?>", |
| [312](#L312) | no\_items: "<?php echo esc\_html\_\_('no items', 'woo-bulk-editor') ?>", |
| [313](#L313) | none: "<?php echo esc\_html\_\_('none', 'woo-bulk-editor') ?>", |
| [314](#L314) | no\_data: "<?php echo esc\_html\_\_('no data', 'woo-bulk-editor') ?>", |
| [315](#L315) | loading: "<?php echo esc\_html\_\_('Loading', 'woo-bulk-editor') ?> ...", |
| [316](#L316) | loaded: "<?php echo esc\_html\_\_('Loaded', 'woo-bulk-editor') ?>.", |
| [317](#L317) | saved: "<?php echo esc\_html\_\_('Saved', 'woo-bulk-editor') ?>.", |
| [318](#L318) | saving: "<?php echo esc\_html\_\_('Saving', 'woo-bulk-editor') ?> ...", |
| [319](#L319) | apply: "<?php echo esc\_html\_\_('Apply', 'woo-bulk-editor') ?>", |
| [320](#L320) | cancel: "<?php echo esc\_html\_\_('Cancel', 'woo-bulk-editor') ?>", |
| [321](#L321) | canceled: "<?php echo esc\_html\_\_('Canceled', 'woo-bulk-editor') ?>", |
| [322](#L322) | sure: "<?php echo esc\_html\_\_('Sure?', 'woo-bulk-editor') ?>", |
| [323](#L323) | creating: "<?php echo esc\_html\_\_('Creating', 'woo-bulk-editor') ?> ...", |
| [324](#L324) | created: "<?php echo esc\_html\_\_('Created!', 'woo-bulk-editor') ?>", |
| [325](#L325) | duplicating: "<?php echo esc\_html\_\_('Duplicating', 'woo-bulk-editor') ?> ...", |
| [326](#L326) | duplicated: "<?php echo esc\_html\_\_('Duplicated!', 'woo-bulk-editor') ?>", |
| [327](#L327) | deleting: "<?php echo esc\_html\_\_('Deleting', 'woo-bulk-editor') ?> ...", |
| [328](#L328) | deleted: "<?php echo esc\_html\_\_('Deleted!', 'woo-bulk-editor') ?>", |
| [329](#L329) | reseting: "<?php echo esc\_html\_\_('Reseting', 'woo-bulk-editor') ?> ...", |
| [330](#L330) | reseted: "<?php echo esc\_html\_\_('Reseted!', 'woo-bulk-editor') ?>", |
| [331](#L331) | upload\_image: "<?php echo esc\_html\_\_('Upload image', 'woo-bulk-editor') ?>", |
| [332](#L332) | upload\_images: "<?php echo esc\_html\_\_('Upload images', 'woo-bulk-editor') ?>", |
| [333](#L333) | select\_all: "<?php echo esc\_html\_\_('Select all', 'woo-bulk-editor') ?>", |
| [334](#L334) | deselect\_all: "<?php echo esc\_html\_\_('Deselect all', 'woo-bulk-editor') ?>", |
| [335](#L335) | upload\_file: "<?php echo esc\_html\_\_('Upload file', 'woo-bulk-editor') ?>", |
| [336](#L336) | fill\_up\_data: "<?php echo esc\_html\_\_('Fill up the data please!', 'woo-bulk-editor') ?>", |
| [337](#L337) | enter\_duplicate\_count: "<?php echo esc\_html\_\_('Enter how many time duplicate selected product(s)!', 'woo-bulk-editor') ?>", |
| [338](#L338) | enter\_new\_count: "<?php echo esc\_html\_\_('Enter how many new product(s) to create!', 'woo-bulk-editor') ?>", |
| [339](#L339) | search\_input\_placeholder: "<?php echo esc\_html\_\_('Text search by title or SKU', 'woo-bulk-editor') ?>", |
| [340](#L340) | show\_panel: "<?php esc\_html\_e('Show: Filters/Bulk Edit/Export', 'woo-bulk-editor') ?>", |
| [341](#L341) | close\_panel: "<?php esc\_html\_e('Hide: Filters/Bulk Edit/Export', 'woo-bulk-editor') ?>", |
| [342](#L342) | per\_page: "<?php esc\_html\_e('Per page', 'woo-bulk-editor') ?>", |
| [343](#L343) | color\_picker\_col: "<?php esc\_html\_e('Select background color', 'woo-bulk-editor') ?>", |
| [344](#L344) | color\_picker\_txt: "<?php esc\_html\_e('Select text color', 'woo-bulk-editor') ?>", |
| [345](#L345) | sEmptyTable: "<?php esc\_html\_e('No data available in the table', 'woo-bulk-editor') ?>", |
| [346](#L346) | sInfo: "<?php esc\_html\_e('Showing \_START\_ to \_END\_ of \_TOTAL\_ entries', 'woo-bulk-editor') ?>", |
| [347](#L347) | sInfoEmpty: "<?php esc\_html\_e('Showing 0 to 0 of 0 entries', 'woo-bulk-editor') ?>", |
| [348](#L348) | sInfoFiltered: "<?php esc\_html\_e('(filtered from \_MAX\_ total entries)', 'woo-bulk-editor') ?>", |
| [349](#L349) | sLoadingRecords: "<?php esc\_html\_e('Loading...', 'woo-bulk-editor') ?>", |
| [350](#L350) | sProcessing: "<?php esc\_html\_e('Processing...', 'woo-bulk-editor') ?>", |
| [351](#L351) | sZeroRecords: "<?php esc\_html\_e('No matching records found', 'woo-bulk-editor') ?>", |
| [352](#L352) | sFirst: "<?php esc\_html\_e('First', 'woo-bulk-editor') ?>", |
| [353](#L353) | sLast: "<?php esc\_html\_e('Last', 'woo-bulk-editor') ?>", |
| [354](#L354) | sNext: "<?php esc\_html\_e('Next', 'woo-bulk-editor') ?>", |
| [355](#L355) | sPrevious: "<?php esc\_html\_e('Previous', 'woo-bulk-editor') ?>", |
| [356](#L356) | action\_state\_1: "<?php esc\_html\_e('all the products on the site', 'woo-bulk-editor') ?>", |
| [357](#L357) | action\_state\_2: "<?php esc\_html\_e('the filtered products. To remove the products filtering press reset button on the tools panel below', 'woo-bulk-editor') ?>", |
| [358](#L358) | action\_state\_31: "<?php esc\_html\_e('the selected products (variations)', 'woo-bulk-editor') ?>", |
| [359](#L359) | action\_state\_32: "<?php esc\_html\_e('You can reset selection of the products by its reset button on the panel of the editor OR uncheck them manually!', 'woo-bulk-editor') ?>", |
| [360](#L360) | term\_maybe\_exist: "<?php esc\_html\_e('Maybe term(s) with such name(s) already exists!', 'woo-bulk-editor') ?>", |
| [361](#L361) | free\_ver\_profiles: "<?php esc\_html\_e('In FREE version of the plugin you can create one profile only!', 'woo-bulk-editor') ?>", |
| [362](#L362) | append\_sub\_item: "<?php esc\_html\_e('append sub item', 'woo-bulk-editor') ?>", |
| [363](#L363) | is\_deactivated\_in\_free: "<?php esc\_html\_e('This field is deactivated in FREE version for bulk edit!', 'woo-bulk-editor') ?>", |
| [364](#L364) | checked\_products: "<?php esc\_html\_e('Products checked', 'woo-bulk-editor') ?>" |
| [365](#L365) | }; |
| [366](#L366) |  |
| [367](#L367) | var woobe\_settings = { |
| [368](#L368) | show\_thumbnail\_preview: <?php echo intval($this->settings->show\_thumbnail\_preview) ?>, |
| [369](#L369) | load\_switchers: <?php echo intval($this->settings->load\_switchers) ?>, |
| [370](#L370) | autocomplete\_max\_elem\_count: <?php echo intval($this->settings->autocomplete\_max\_elem\_count) ?>, |
| [371](#L371) | number\_posts\_processed: <?php echo intval($this->settings->number\_posts\_processed) ?>, |
| [372](#L372) | show\_notes: <?php echo intval($this->show\_notes) ?> |
| [373](#L373) | }; |
| [374](#L374) |  |
| [375](#L375) | var woobe\_assets\_link = "<?php echo WOOBE\_ASSETS\_LINK ?>"; |
| [376](#L376) | var spinner = woobe\_assets\_link + "/images/spinner.gif"; |
| [377](#L377) |  |
| [378](#L378) | //\*\*\* |
| [379](#L379) |  |
| [380](#L380) | <?php |
| [381](#L381) | if (class\_exists('SitePress')) { |
| [382](#L382) | add\_filter('woobe\_current\_language', function () { |
| [383](#L383) | //WPML compatibility |
| [384](#L384) | //because if it will be selected 'all' language - will be shown default one |
| [385](#L385) | return ICL\_LANGUAGE\_CODE; |
| [386](#L386) | }); |
| [387](#L387) | } |
| [388](#L388) | ?> |
| [389](#L389) |  |
| [390](#L390) | var woobe\_lang = '<?php echo apply\_filters('woobe\_current\_language', '') ?>';//for translating compatibilities |
| [391](#L391) |  |
| [392](#L392) |  |
| [393](#L393) |  |
| [394](#L394) | </script> |
| [395](#L395) |  |
| [396](#L396) | <?php |
| [397](#L397) | wp\_enqueue\_style('open\_sans\_font', 'https://fonts.googleapis.com/css?family=Open+Sans'); |
| [398](#L398) | wp\_enqueue\_style('woobe-bootstrap-grid', WOOBE\_ASSETS\_LINK . 'css/bootstrap-grid.css', array(), WOOBE\_VERSION); |
| [399](#L399) | wp\_enqueue\_style('woobe', WOOBE\_ASSETS\_LINK . 'css/woobe.css', array(), WOOBE\_VERSION); |
| [400](#L400) | wp\_enqueue\_style('woobe\_scrollbar', WOOBE\_ASSETS\_LINK . 'css/jquery.scrollbar.css', array(), WOOBE\_VERSION); |
| [401](#L401) | wp\_enqueue\_style('woobe\_fontello', WOOBE\_ASSETS\_LINK . 'css/fontello.css', array(), WOOBE\_VERSION); |
| [402](#L402) |  |
| [403](#L403) | //\*\*\* |
| [404](#L404) |  |
| [405](#L405) | wp\_enqueue\_media(); |
| [406](#L406) | wp\_enqueue\_script('media-upload'); |
| [407](#L407) | wp\_enqueue\_style('thickbox'); |
| [408](#L408) | wp\_enqueue\_script('thickbox'); |
| [409](#L409) |  |
| [410](#L410) | wp\_enqueue\_style('wp-color-picker'); |
| [411](#L411) | wp\_enqueue\_script('wp-color-picker'); |
| [412](#L412) |  |
| [413](#L413) | wp\_enqueue\_style('woobe\_datatables', WOOBE\_ASSETS\_LINK . 'css/tables.css', array(), WOOBE\_VERSION); |
| [414](#L414) | wp\_enqueue\_script('woobe\_datatables\_net', WOOBE\_ASSETS\_LINK . 'js/jquery.dataTables.js', array('jquery'), WOOBE\_VERSION); |
| [415](#L415) |  |
| [416](#L416) | wp\_enqueue\_script('woobe\_data\_tables', WOOBE\_ASSETS\_LINK . 'js/data-tables.js', array('woobe\_datatables\_net'), WOOBE\_VERSION); |
| [417](#L417) |  |
| [418](#L418) | wp\_enqueue\_style('woobe\_data\_tables\_fc', 'https://cdn.datatables.net/fixedcolumns/4.2.1/css/fixedColumns.dataTables.min.css'); |
| [419](#L419) | wp\_enqueue\_script('woobe\_data\_tables\_fc', 'https://cdn.datatables.net/fixedcolumns/4.2.1/js/dataTables.fixedColumns.min.js'); |
| [420](#L420) |  |
| [421](#L421) | wp\_enqueue\_script('woobe\_jquery\_growl', WOOBE\_ASSETS\_LINK . 'js/jquery.growl.js', array('jquery'), WOOBE\_VERSION); |
| [422](#L422) |  |
| [423](#L423) | wp\_enqueue\_style('woobe\_switchery', WOOBE\_ASSETS\_LINK . 'js/switchery/switchery.min.css', array(), WOOBE\_VERSION); |
| [424](#L424) | wp\_enqueue\_script('woobe\_switchery', WOOBE\_ASSETS\_LINK . 'js/switchery/switchery.min.js', array('jquery'), WOOBE\_VERSION); |
| [425](#L425) |  |
| [426](#L426) | wp\_enqueue\_style('woobe\_chosen', WOOBE\_ASSETS\_LINK . 'js/chosen/chosen.min.css', array(), WOOBE\_VERSION); |
| [427](#L427) | wp\_enqueue\_script('woobe\_chosen', WOOBE\_ASSETS\_LINK . 'js/chosen/chosen.jquery.min.js', array('jquery'), WOOBE\_VERSION); |
| [428](#L428) |  |
| [429](#L429) | wp\_enqueue\_style('woobe\_autocomplete', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/easy-autocomplete.min.css', array(), WOOBE\_VERSION); |
| [430](#L430) | wp\_enqueue\_style('woobe\_autocomplete\_theme', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/easy-autocomplete.themes.min.css', array(), WOOBE\_VERSION); |
| [431](#L431) | wp\_enqueue\_script('woobe\_autocomplete', WOOBE\_ASSETS\_LINK . 'js/easy-autocomplete/jquery.easy-autocomplete.js', array('jquery'), WOOBE\_VERSION); |
| [432](#L432) |  |
| [433](#L433) | wp\_enqueue\_style('woobe\_datetimepicker', WOOBE\_ASSETS\_LINK . 'js/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css', array(), WOOBE\_VERSION); |
| [434](#L434) | wp\_enqueue\_script('woobe\_datetimepicker\_moment', WOOBE\_ASSETS\_LINK . 'js/datepicker/moment-with-locales.min.js', array('jquery'), WOOBE\_VERSION); |
| [435](#L435) | wp\_enqueue\_script('woobe\_datetimepicker', WOOBE\_ASSETS\_LINK . 'js/bootstrap-material-datetimepicker/bootstrap-material-datetimepicker.js', array('jquery'), WOOBE\_VERSION); |
| [436](#L436) |  |
| [437](#L437) | wp\_enqueue\_script('woobe\_placeholder\_label', WOOBE\_ASSETS\_LINK . 'js/jquery.placeholder.label.min.js', array('jquery'), WOOBE\_VERSION); |
| [438](#L438) | wp\_enqueue\_script('woobe\_tooltip', WOOBE\_ASSETS\_LINK . 'js/tooltip.js', array('jquery'), WOOBE\_VERSION); |
| [439](#L439) |  |
| [440](#L440) | wp\_enqueue\_script('woobe\_tabs', WOOBE\_ASSETS\_LINK . 'js/tabs.js', array(), WOOBE\_VERSION); |
| [441](#L441) | wp\_enqueue\_script('woobe\_scrollbar', WOOBE\_ASSETS\_LINK . 'js/jquery.scrollbar.min.js', array(), WOOBE\_VERSION); |
| [442](#L442) | //\*\*\* |
| [443](#L443) | wp\_enqueue\_script('woobe', WOOBE\_ASSETS\_LINK . 'js/woobe.js', array('jquery', 'jquery-ui-core', 'jquery-ui-sortable', 'woobe\_tabs'), WOOBE\_VERSION); |
| [444](#L444) | do\_action('woobe\_ext\_scripts'); //including extensions scripts |
| [445](#L445) | } |
| [446](#L446) | } |
| [447](#L447) |  |
| [448](#L448) | public function print\_plugin\_options() { |
| [449](#L449) | $args = array(); |
| [450](#L450) | $args['options'] = $this->settings->get\_options(); |
| [451](#L451) | $args['total\_settings'] = $this->settings->get\_total\_settings(); |
| [452](#L452) | $args['tax\_keys'] = array(); |
| [453](#L453) | $args['attribute\_keys'] = array(); |
| [454](#L454) |  |
| [455](#L455) | $args['is\_popupeditor'] = FALSE; |
| [456](#L456) | $args['is\_downloads'] = FALSE; |
| [457](#L457) | $args['is\_gallery'] = FALSE; |
| [458](#L458) | $args['is\_upsells'] = FALSE; |
| [459](#L459) | $args['is\_cross\_sells'] = FALSE; |
| [460](#L460) | $args['is\_grouped'] = FALSE; |
| [461](#L461) |  |
| [462](#L462) | $args['meta\_popup\_editor'] = FALSE; |
| [463](#L463) |  |
| [464](#L464) | //to generate terms in popup taxonomies data |
| [465](#L465) | if (!empty($this->settings->active\_fields)) { |
| [466](#L466) | foreach ($this->settings->active\_fields as $k => $f) { |
| [467](#L467) | if ($f['field\_type'] == 'taxonomy' AND $f['edit\_view'] == 'popup') { |
| [468](#L468) | $args['tax\_keys'][] = $f['taxonomy']; |
| [469](#L469) | } |
| [470](#L470) |  |
| [471](#L471) | if ($f['field\_type'] == 'attribute') { |
| [472](#L472) | $args['attribute\_keys'][] = $k; |
| [473](#L473) | } |
| [474](#L474) |  |
| [475](#L475) | //\*\*\* |
| [476](#L476) |  |
| [477](#L477) | if ($f['edit\_view'] == 'popupeditor') { |
| [478](#L478) | $args['is\_popupeditor'] = TRUE; |
| [479](#L479) | } |
| [480](#L480) |  |
| [481](#L481) | if ($f['edit\_view'] == 'downloads\_popup\_editor') { |
| [482](#L482) | $args['is\_downloads'] = TRUE; |
| [483](#L483) | } |
| [484](#L484) |  |
| [485](#L485) | if ($f['edit\_view'] == 'gallery\_popup\_editor') { |
| [486](#L486) | $args['is\_gallery'] = TRUE; |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | if ($f['edit\_view'] == 'upsells\_popup\_editor') { |
| [490](#L490) | $args['is\_upsells'] = TRUE; |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | if ($f['edit\_view'] == 'cross\_sells\_popup\_editor') { |
| [494](#L494) | $args['is\_cross\_sells'] = TRUE; |
| [495](#L495) | } |
| [496](#L496) |  |
| [497](#L497) | if ($f['edit\_view'] == 'grouped\_popup\_editor') { |
| [498](#L498) | $args['is\_grouped'] = TRUE; |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | if ($f['edit\_view'] == 'meta\_popup\_editor') { |
| [502](#L502) | $args['meta\_popup\_editor'] = TRUE; |
| [503](#L503) | } |
| [504](#L504) | } |
| [505](#L505) | } |
| [506](#L506) |  |
| [507](#L507) | //\*\*\* |
| [508](#L508) |  |
| [509](#L509) | $args['active\_fields'] = $this->settings->active\_fields; |
| [510](#L510) | $args['settings\_fields'] = $this->settings->get\_fields(); |
| [511](#L511) | $args['settings\_fields\_full'] = $this->settings->get\_fields(false); |
| [512](#L512) | $args['settings\_fields\_keys'] = $this->settings->get\_fields\_keys(); |
| [513](#L513) | $args['editable'] = $this->settings->editable; |
| [514](#L514) | $args['default\_sortby\_col\_num'] = $this->settings->get\_default\_sortby\_col\_num(); |
| [515](#L515) | $args['default\_sort'] = $this->settings->default\_sort; |
| [516](#L516) | $args['no\_order'] = $this->settings->no\_order; |
| [517](#L517) | $args['per\_page'] = $this->settings->per\_page; |
| [518](#L518) | $args['extend\_per\_page'] = apply\_filters('woobe\_set\_per\_page\_values', ''); |
| [519](#L519) | $args['show\_notes'] = $this->show\_notes; |
| [520](#L520) | $args['current\_user\_role'] = $this->settings->current\_user\_role; |
| [521](#L521) | $args['profiles'] = $this->profiles->get(); |
| [522](#L522) |  |
| [523](#L523) | //\*\*\* |
| [524](#L524) |  |
| [525](#L525) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/woobe.php', apply\_filters('woobe\_print\_plugin\_options', $args)); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | //~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ |
| [529](#L529) | //ajax |
| [530](#L530) | public function woobe\_get\_products($args = array(), $return = false) { |
| [531](#L531) |  |
| [532](#L532) | if (!current\_user\_can('manage\_woocommerce')) { |
| [533](#L533) | return; |
| [534](#L534) | } |
| [535](#L535) |  |
| [536](#L536) | //\*\*\* |
| [537](#L537) |  |
| [538](#L538) | $res = array(); |
| [539](#L539) | $res['draw'] = isset($\_REQUEST['draw']) ? intval($\_REQUEST['draw']) : 0; |
| [540](#L540) | $res['data'] = array(); |
| [541](#L541) | $fileds\_keys = $this->settings->get\_fields\_keys(); |
| [542](#L542) |  |
| [543](#L543) | if (empty($args)) { |
| [544](#L544) | //for ajax only |
| [545](#L545) | $args = array( |
| [546](#L546) | 'lang' => sanitize\_key($\_REQUEST['lang']), |
| [547](#L547) | 'per\_page' => intval($\_REQUEST['length']), |
| [548](#L548) | 'offset' => intval($\_REQUEST['start']), |
| [549](#L549) | 'order\_by' => $fileds\_keys[intval($\_REQUEST['order'][0]['column'])], |
| [550](#L550) | 'order' => sanitize\_key($\_REQUEST['order'][0]['dir']), |
| [551](#L551) | 'search' => sanitize\_text\_field($\_REQUEST['search']['value']) |
| [552](#L552) | ); |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | $products = $this->products->gets($args); |
| [556](#L556) |  |
| [557](#L557) | $res['recordsFiltered'] = $res['recordsTotal'] = $products->found\_posts; |
| [558](#L558) | if ($products->found\_posts > 0) { |
| [559](#L559) | $products\_types = array(); |
| [560](#L560) | $products\_titles = array(); |
| [561](#L561) | wp\_cache\_flush(); |
| [562](#L562) | foreach ($products->posts as $p) { |
| [563](#L563) |  |
| [564](#L564) | $product\_type = WC\_Data\_Store::load('product')->get\_product\_type($p->ID); |
| [565](#L565) | $res['data'][] = $this->\_pack\_row($p, $product\_type); |
| [566](#L566) | $products\_types[$p->ID] = $product\_type; |
| [567](#L567) | $products\_titles[$p->ID] = str\_replace('"', "", str\_replace("'", "", $p->post\_title)); |
| [568](#L568) |  |
| [569](#L569) | //get variations if exists and requested |
| [570](#L570) | if ($product\_type == 'variable' AND ( isset($\_REQUEST['woobe\_show\_variations']) AND intval($\_REQUEST['woobe\_show\_variations']) > 0)) { |
| [571](#L571) |  |
| [572](#L572) | $variations = $this->products->gets(array('get\_variations' => $p->ID)); |
| [573](#L573) | if ($variations->found\_posts > 0) { |
| [574](#L574) | foreach ($variations->posts as $var) { |
| [575](#L575) | $res['data'][] = $this->\_pack\_row($var, 'variation'); |
| [576](#L576) | $products\_types[$var->ID] = 'variation'; |
| [577](#L577) | $products\_titles[$var->ID] = str\_replace('"', "", str\_replace("'", "", $var->post\_title)); |
| [578](#L578) |  |
| [579](#L579) | //\*\*\* |
| [580](#L580) |  |
| [581](#L581) | if ($this->settings->add\_vars\_to\_var\_title) { |
| [582](#L582) | $products\_titles[$var->ID] = $this->products->generate\_product\_title($this->products->get\_product($var->ID)); |
| [583](#L583) | } |
| [584](#L584) | } |
| [585](#L585) | } |
| [586](#L586) | } |
| [587](#L587) |  |
| [588](#L588) | //\*\*\* |
| [589](#L589) | //data for javascript functionality on the front |
| [590](#L590) | $res['products\_types'] = $products\_types; |
| [591](#L591) | $res['products\_titles'] = $products\_titles; |
| [592](#L592) | //$res['query']=$products->request; |
| [593](#L593) | } |
| [594](#L594) | } |
| [595](#L595) |  |
| [596](#L596) | //\*\*\* |
| [597](#L597) | //echo get\_num\_queries() . ' + ';exit; |
| [598](#L598) | if (!$return) { |
| [599](#L599) | //if requested by ajax |
| [600](#L600) | die(json\_encode($res)); |
| [601](#L601) | } |
| [602](#L602) |  |
| [603](#L603) | return $res; |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | //service |
| [607](#L607) | private function \_pack\_row($p, $product\_type) { |
| [608](#L608) | //wp\_cache\_flush(); |
| [609](#L609) | $row = array(); |
| [610](#L610) | $p = (array) $p; |
| [611](#L611) |  |
| [612](#L612) | foreach ($this->settings->get\_fields\_keys() as $key) { |
| [613](#L613) | $row[] = $this->wrap\_field\_val($p, $key, $product\_type); |
| [614](#L614) | } |
| [615](#L615) |  |
| [616](#L616) | if ($product\_type !== 'variation') { |
| [617](#L617) | //buttons: edit + view |
| [618](#L618) | $row[] = WOOBE\_HELPER::draw\_link(array( |
| [619](#L619) | 'title' => '&#xea0b;', |
| [620](#L620) | 'href' => get\_permalink($p['ID']), |
| [621](#L621) | 'target' => '\_blank', |
| [622](#L622) | 'class' => 'button button-primary button-small button-small-2', |
| [623](#L623) | 'title\_attr' => esc\_html\_\_('View the product on the site front', 'woo-bulk-editor') |
| [624](#L624) | )) . '&nbsp;' . WOOBE\_HELPER::draw\_link(array( |
| [625](#L625) | 'title' => '&#xea25;', |
| [626](#L626) | 'href' => get\_admin\_url() . 'post.php?post=' . $p['ID'] . '&action=edit', |
| [627](#L627) | 'target' => '\_blank', |
| [628](#L628) | 'class' => 'button button-primary button-small button-small-2', |
| [629](#L629) | 'title\_attr' => esc\_html\_\_('Editing of the product on its page', 'woo-bulk-editor') |
| [630](#L630) | )); |
| [631](#L631) | } else { |
| [632](#L632) | $row[] = ''; |
| [633](#L633) | } |
| [634](#L634) |  |
| [635](#L635) | return $row; |
| [636](#L636) | } |
| [637](#L637) |  |
| [638](#L638) | //ajax |
| [639](#L639) | public function woobe\_update\_page\_field() { |
| [640](#L640) |  |
| [641](#L641) | if (!isset($\_REQUEST['mainform\_nonce']) || !wp\_verify\_nonce($\_REQUEST['mainform\_nonce'], 'woobe\_mainform\_nonce')) { |
| [642](#L642) | die('0'); |
| [643](#L643) | } |
| [644](#L644) |  |
| [645](#L645) | $product\_id = intval($\_REQUEST['product\_id']); |
| [646](#L646) |  |
| [647](#L647) | if (!isset($\_REQUEST['value']) || $\_REQUEST['value'] == null) { |
| [648](#L648) | $\_REQUEST['value'] = array(); |
| [649](#L649) | } |
| [650](#L650) | $field\_key = sanitize\_text\_field(trim($\_REQUEST['field'])); //if sanitize by sanitize\_key not all meta keys works normally!! |
| [651](#L651) | if ($product\_id > 0 AND isset($\_REQUEST['value'])) { |
| [652](#L652) | if ($\_REQUEST['value']) { |
| [653](#L653) | if (is\_array($\_REQUEST['value'])) { |
| [654](#L654) | $value = $\_REQUEST['value']; |
| [655](#L655) |  |
| [656](#L656) | $value = WOOBE\_HELPER::sanitize\_array((array) $\_REQUEST['value']); |
| [657](#L657) | } else { |
| [658](#L658) | $is\_encoded = preg\_match('~%[0-9A-F]{2}~i', $\_REQUEST['value']); |
| [659](#L659) | $allowedpost = wp\_kses\_allowed\_html('post'); |
| [660](#L660) | if ('post\_content' == $\_REQUEST['field'] OR 'post\_excerpt' == $\_REQUEST['field'] OR $this->settings->active\_fields[$field\_key]['edit\_view'] === 'popupeditor') { |
| [661](#L661) | $is\_encoded = false; |
| [662](#L662) | $allowedpost['iframe'] = array( |
| [663](#L663) | 'align' => true, |
| [664](#L664) | 'frameborder' => true, |
| [665](#L665) | 'height' => true, |
| [666](#L666) | 'width' => true, |
| [667](#L667) | 'sandbox' => true, |
| [668](#L668) | 'seamless' => true, |
| [669](#L669) | 'scrolling' => true, |
| [670](#L670) | 'srcdoc' => true, |
| [671](#L671) | 'src' => true, |
| [672](#L672) | 'class' => true, |
| [673](#L673) | 'id' => true, |
| [674](#L674) | 'style' => true, |
| [675](#L675) | 'border' => true, |
| [676](#L676) | ); |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | if ($is\_encoded) { |
| [680](#L680) | $data\_array = []; |
| [681](#L681) |  |
| [682](#L682) | parse\_str($\_REQUEST['value'], $data\_array); |
| [683](#L683) |  |
| [684](#L684) | $value = WOOBE\_HELPER::sanitize\_array($data\_array); |
| [685](#L685) | } else { |
| [686](#L686) |  |
| [687](#L687) | if (apply\_filters('woobe\_use\_kses\_for\_page\_field', true)) { |
| [688](#L688) | $value = wp\_kses($\_REQUEST['value'], $allowedpost); |
| [689](#L689) | } else { |
| [690](#L690) | $value = sanitize\_text\_field($\_REQUEST['value']); |
| [691](#L691) | } |
| [692](#L692) | } |
| [693](#L693) | } |
| [694](#L694) | } else { |
| [695](#L695) | $value = ""; |
| [696](#L696) | if (isset($this->settings->get\_fields()[sanitize\_text\_field($\_REQUEST['field'])]) && 'taxonomy' == $this->settings->get\_fields()[sanitize\_text\_field($\_REQUEST['field'])]['field\_type']) { |
| [697](#L697) | $value = array(); |
| [698](#L698) | } |
| [699](#L699) | } |
| [700](#L700) |  |
| [701](#L701) | //\*\*\* |
| [702](#L702) | //normalize calendar date |
| [703](#L703) | if ($this->settings->active\_fields[$field\_key]['edit\_view'] === 'calendar') { |
| [704](#L704) | if ($this->settings->active\_fields[$field\_key]["field\_type"] AND $this->settings->active\_fields[$field\_key]["field\_type"] == "meta") { |
| [705](#L705) | $value = strtotime($value); |
| [706](#L706) | } else { |
| [707](#L707) | $value = $this->products->normalize\_calendar\_date($value, $field\_key); |
| [708](#L708) | } |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | //\*\*\* |
| [712](#L712) | //uploated to |
| [713](#L713) | if (isset($\_REQUEST['uploaded\_to']) AND $\_REQUEST['uploaded\_to'] == 1 AND $field\_key == '\_thumbnail\_id') { |
| [714](#L714) | $id\_th = intval($value); |
| [715](#L715) | if ($id\_th) { |
| [716](#L716) | $my\_post = array(); |
| [717](#L717) | $my\_post['ID'] = $id\_th; |
| [718](#L718) | $my\_post['post\_parent'] = $product\_id; |
| [719](#L719) |  |
| [720](#L720) | wp\_update\_post(wp\_slash($my\_post)); |
| [721](#L721) | } |
| [722](#L722) | } |
| [723](#L723) |  |
| [724](#L724) | $value = $this->products->string\_replacer($value, $product\_id); |
| [725](#L725) | $value = $this->products->string\_macros($value, $field\_key, $product\_id); |
| [726](#L726) |  |
| [727](#L727) | echo $this->products->update\_page\_field($product\_id, $field\_key, $value); |
| [728](#L728) | //die(json\_encode($value)); |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | exit; |
| [732](#L732) | } |
| [733](#L733) |  |
| [734](#L734) | //ajax |
| [735](#L735) | public function woobe\_redraw\_table\_row() { |
| [736](#L736) | if (is\_array($\_REQUEST['value'])) { |
| [737](#L737) | $value = (array) $\_REQUEST['value']; |
| [738](#L738) | } else { |
| [739](#L739) | $value = sanitize\_text\_field(trim($\_REQUEST['value'])); |
| [740](#L740) | } |
| [741](#L741) |  |
| [742](#L742) | //\*\*\* |
| [743](#L743) |  |
| [744](#L744) | $product\_id = intval($\_REQUEST['product\_id']); |
| [745](#L745) |  |
| [746](#L746) | if ($product\_id > 0) { |
| [747](#L747) | if (isset($\_REQUEST['field']) AND !empty($\_REQUEST['field'])) { |
| [748](#L748) | $field\_key = sanitize\_key($\_REQUEST['field']); |
| [749](#L749) | if (!empty($field\_key)) { |
| [750](#L750) | $this->products->update\_page\_field($product\_id, $field\_key, $value); |
| [751](#L751) | } |
| [752](#L752) | } |
| [753](#L753) |  |
| [754](#L754) |  |
| [755](#L755) | //generate table row by $product\_id |
| [756](#L756) | $res = $this->woobe\_get\_products(array( |
| [757](#L757) | 'p' => $product\_id, |
| [758](#L758) | 'post\_type' => array('product', 'product\_variation') |
| [759](#L759) | ), true); |
| [760](#L760) |  |
| [761](#L761) | echo(json\_encode($res['data'][0])); |
| [762](#L762) | } |
| [763](#L763) | exit; |
| [764](#L764) | } |
| [765](#L765) |  |
| [766](#L766) | //ajax |
| [767](#L767) | public function get\_post\_field() { |
| [768](#L768) | $test = $this->products->get\_post\_field(intval($\_REQUEST['product\_id']), sanitize\_key($\_REQUEST['field']), (isset($\_REQUEST['post\_parent']) ? intval($\_REQUEST['post\_parent']) : 0)); |
| [769](#L769) | echo $test; |
| [770](#L770) | exit; |
| [771](#L771) | } |
| [772](#L772) |  |
| [773](#L773) | //ajax |
| [774](#L774) | public function get\_downloads() { |
| [775](#L775) |  |
| [776](#L776) | $product\_id = intval($\_REQUEST['product\_id']); |
| [777](#L777) |  |
| [778](#L778) | if (!$product\_id) { |
| [779](#L779) | exit; |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | $product = $this->products->get\_product($product\_id); |
| [783](#L783) |  |
| [784](#L784) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-downloads.php', array( |
| [785](#L785) | 'downloadable\_files' => $product->get\_downloads('edit') |
| [786](#L786) | )); |
| [787](#L787) |  |
| [788](#L788) | exit; |
| [789](#L789) | } |
| [790](#L790) |  |
| [791](#L791) | //ajax |
| [792](#L792) | public function woobe\_get\_gallery() { |
| [793](#L793) |  |
| [794](#L794) | $product\_id = intval($\_REQUEST['product\_id']); |
| [795](#L795) |  |
| [796](#L796) | if (!$product\_id) { |
| [797](#L797) | exit; |
| [798](#L798) | } |
| [799](#L799) |  |
| [800](#L800) | $product = $this->products->get\_product($product\_id); |
| [801](#L801) |  |
| [802](#L802) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-gallery.php', array( |
| [803](#L803) | 'images' => $product->get\_gallery\_image\_ids('edit') |
| [804](#L804) | )); |
| [805](#L805) |  |
| [806](#L806) | exit; |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | //ajax |
| [810](#L810) | public function woobe\_get\_upsells() { |
| [811](#L811) |  |
| [812](#L812) | $product\_id = intval($\_REQUEST['product\_id']); |
| [813](#L813) |  |
| [814](#L814) | if (!$product\_id) { |
| [815](#L815) | exit; |
| [816](#L816) | } |
| [817](#L817) |  |
| [818](#L818) | $product = $this->products->get\_product($product\_id); |
| [819](#L819) |  |
| [820](#L820) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-upsells.php', array( |
| [821](#L821) | 'products' => $product->get\_upsell\_ids('edit') |
| [822](#L822) | )); |
| [823](#L823) |  |
| [824](#L824) | exit; |
| [825](#L825) | } |
| [826](#L826) |  |
| [827](#L827) | //ajax |
| [828](#L828) | public function woobe\_get\_cross\_sells() { |
| [829](#L829) |  |
| [830](#L830) | $product\_id = intval($\_REQUEST['product\_id']); |
| [831](#L831) |  |
| [832](#L832) | if (!$product\_id) { |
| [833](#L833) | exit; |
| [834](#L834) | } |
| [835](#L835) |  |
| [836](#L836) | $product = $this->products->get\_product($product\_id); |
| [837](#L837) |  |
| [838](#L838) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-cross-sells.php', array( |
| [839](#L839) | 'products' => $product->get\_cross\_sell\_ids('edit') |
| [840](#L840) | )); |
| [841](#L841) |  |
| [842](#L842) | exit; |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | //ajax |
| [846](#L846) | public function woobe\_get\_grouped() { |
| [847](#L847) |  |
| [848](#L848) | $product\_id = intval($\_REQUEST['product\_id']); |
| [849](#L849) |  |
| [850](#L850) | if (!$product\_id) { |
| [851](#L851) | exit; |
| [852](#L852) | } |
| [853](#L853) |  |
| [854](#L854) | $product = $this->products->get\_product($product\_id); |
| [855](#L855) |  |
| [856](#L856) | echo WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/parts/product-grouped.php', array( |
| [857](#L857) | 'products' => $product->get\_children('edit') |
| [858](#L858) | )); |
| [859](#L859) |  |
| [860](#L860) | exit; |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) | //ajax |
| [864](#L864) | public function woobe\_save\_options() { |
| [865](#L865) |  |
| [866](#L866) | if (!current\_user\_can('manage\_woocommerce')) { |
| [867](#L867) | die('0'); |
| [868](#L868) | } |
| [869](#L869) | if (!isset($\_REQUEST['mainform\_nonce']) || !wp\_verify\_nonce($\_REQUEST['mainform\_nonce'], 'woobe\_mainform\_nonce')) { |
| [870](#L870) | die('0'); |
| [871](#L871) | } |
| [872](#L872) |  |
| [873](#L873) |  |
| [874](#L874) | $data = array(); |
| [875](#L875) | parse\_str($\_REQUEST['formdata'], $data); |
| [876](#L876) | $data = WOOBE\_HELPER::sanitize\_array($data); |
| [877](#L877) |  |
| [878](#L878) | if (isset($data['woobe\_options'])) { |
| [879](#L879) | if (is\_array($data['woobe\_options'])) { |
| [880](#L880) | $this->settings->update\_options($data['woobe\_options']); |
| [881](#L881) | } |
| [882](#L882) |  |
| [883](#L883) | //\*\*\* |
| [884](#L884) | //save shop manager fields visibility |
| [885](#L885) | if (in\_array($this->settings->current\_user\_role, apply\_filters('woobe\_permit\_special\_roles', ['administrator']))) { |
| [886](#L886) | $shop\_manager\_visibility = array(); |
| [887](#L887) |  |
| [888](#L888) | foreach ($data['woobe\_options']['fields'] as $key => $v) { |
| [889](#L889) | if (isset($v['shop\_manager\_visibility'])) { |
| [890](#L890) | $shop\_manager\_visibility[$key] = intval($v['shop\_manager\_visibility']); |
| [891](#L891) | } |
| [892](#L892) | } |
| [893](#L893) |  |
| [894](#L894) | update\_option('woobe\_shop\_manager\_visibility', $shop\_manager\_visibility); |
| [895](#L895) | } |
| [896](#L896) | } |
| [897](#L897) |  |
| [898](#L898) | exit; |
| [899](#L899) | } |
| [900](#L900) |  |
| [901](#L901) | //ajax |
| [902](#L902) | public function woobe\_title\_autocomplete() { |
| [903](#L903) | $results = array(); |
| [904](#L904) | $results[] = array( |
| [905](#L905) | "name" => esc\_html\_\_("Products not found!", 'woo-bulk-editor'), |
| [906](#L906) | "id" => 0, |
| [907](#L907) | "type" => "", |
| [908](#L908) | "link" => "#", |
| [909](#L909) | "icon" => WOOBE\_ASSETS\_LINK . 'images/not-found.jpg' |
| [910](#L910) | ); |
| [911](#L911) |  |
| [912](#L912) | //\*\*\* |
| [913](#L913) |  |
| [914](#L914) | if (!empty($\_REQUEST['woobe\_txt\_search'])) { |
| [915](#L915) | $args = array( |
| [916](#L916) | 'nopaging' => true, |
| [917](#L917) | 'post\_type' => array('product', 'product\_variation'), |
| [918](#L918) | 'post\_status' => array\_keys(apply\_filters('woobe\_product\_statuses', get\_post\_statuses())), |
| [919](#L919) | 'order\_by' => 'title', |
| [920](#L920) | 'order' => 'ASC', |
| [921](#L921) | 'per\_page' => intval($\_REQUEST['auto\_res\_count']) > 0 ? intval($\_REQUEST['auto\_res\_count']) : 10, |
| [922](#L922) | 'max\_num\_pages' => intval($\_REQUEST['auto\_res\_count']) > 0 ? intval($\_REQUEST['auto\_res\_count']) : 10 |
| [923](#L923) | ); |
| [924](#L924) |  |
| [925](#L925) | //\*\*\* |
| [926](#L926) |  |
| [927](#L927) | if (!empty($\_REQUEST['exept\_ids'])) { |
| [928](#L928) | $exept\_ids = array(); //which products exclude as they are on the list already |
| [929](#L929) | parse\_str($\_REQUEST['exept\_ids'], $exept\_ids); |
| [930](#L930) |  |
| [931](#L931) | if (isset($exept\_ids['woobe\_prod\_ids'])) { |
| [932](#L932) | $args['post\_\_not\_in'] = array\_map(function ($item) { |
| [933](#L933) | return intval($item); //sanitize intval |
| [934](#L934) | }, $exept\_ids['woobe\_prod\_ids']); |
| [935](#L935) | } |
| [936](#L936) | } |
| [937](#L937) |  |
| [938](#L938) | //\*\*\* |
| [939](#L939) | $st = sanitize\_text\_field($\_REQUEST['woobe\_txt\_search']); |
| [940](#L940) |  |
| [941](#L941) | if (0 == $this->settings->autocomplet\_txt\_search) { |
| [942](#L942) | $\_REQUEST['woobe\_txt\_search'] = array(); |
| [943](#L943) | $\_REQUEST['woobe\_txt\_search']['post\_title'] = $st; |
| [944](#L944) | $\_REQUEST['woobe\_txt\_search\_behavior'] = array(); |
| [945](#L945) | $\_REQUEST['woobe\_txt\_search\_behavior']['post\_title'] = 'like'; |
| [946](#L946) |  |
| [947](#L947) | add\_filter('posts\_where', array($this->filters, 'posts\_txt\_where'), 101); |
| [948](#L948) | } elseif (1 == $this->settings->autocomplet\_txt\_search) { |
| [949](#L949) | $\_REQUEST['woobe\_autocomplete\_search'] = $st; |
| [950](#L950) | add\_filter('posts\_where', array($this, 'autocomplete\_search'), 101); |
| [951](#L951) | } |
| [952](#L952) |  |
| [953](#L953) | $this->products->suppress\_filters = true; |
| [954](#L954) |  |
| [955](#L955) | $query = $this->products->gets($args); |
| [956](#L956) |  |
| [957](#L957) | //+++ |
| [958](#L958) | //http://easyautocomplete.com/guide |
| [959](#L959) | if ($query->have\_posts()) { |
| [960](#L960) | $results = array(); |
| [961](#L961) | foreach ($query->posts as $p) { |
| [962](#L962) | $data = array( |
| [963](#L963) | "name" => $p->post\_title . ' (#' . $p->ID . ')' . ' : ' . get\_post\_meta($p->ID, '\_sku', true), |
| [964](#L964) | "id" => $p->ID, |
| [965](#L965) | "type" => "product" |
| [966](#L966) | ); |
| [967](#L967) | if (has\_post\_thumbnail($p->ID)) { |
| [968](#L968) | $img\_src = wp\_get\_attachment\_image\_src(get\_post\_thumbnail\_id($p->ID), 'thumbnail'); |
| [969](#L969) | $data['icon'] = $img\_src[0]; |
| [970](#L970) | } else { |
| [971](#L971) | $data['icon'] = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
| [972](#L972) | } |
| [973](#L973) | $data['link'] = get\_post\_permalink($p->ID); |
| [974](#L974) | $results[] = $data; |
| [975](#L975) | } |
| [976](#L976) | } |
| [977](#L977) | } |
| [978](#L978) |  |
| [979](#L979) |  |
| [980](#L980) | die(json\_encode($results)); |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | public function autocomplete\_search($where = '') { |
| [984](#L984) |  |
| [985](#L985) | if (!isset($\_REQUEST['woobe\_autocomplete\_search'])) { |
| [986](#L986) | return $where; |
| [987](#L987) | } |
| [988](#L988) | global $wpdb; |
| [989](#L989) | $search\_text = sanitize\_text\_field($\_REQUEST['woobe\_autocomplete\_search']); |
| [990](#L990) |  |
| [991](#L991) | //sku |
| [992](#L992) | $args = array( |
| [993](#L993) | 'post\_type' => array('product', 'product\_variation'), |
| [994](#L994) | 'fields' => 'ids', |
| [995](#L995) | 'meta\_query' => array( |
| [996](#L996) | array( |
| [997](#L997) | 'key' => '\_sku', |
| [998](#L998) | 'compare' => 'LIKE', |
| [999](#L999) | 'value' => $search\_text |
| [1000](#L1000) | ), |
| [1001](#L1001) | ) |
| [1002](#L1002) | ); |
| [1003](#L1003) |  |
| [1004](#L1004) | $product\_variations\_ids = get\_posts($args); |
| [1005](#L1005) |  |
| [1006](#L1006) | if (!empty($product\_variations\_ids)) { |
| [1007](#L1007) | if (empty($product\_variations\_ids)) { |
| [1008](#L1008) | foreach ($product\_variations as $v) { |
| [1009](#L1009) | $product\_variations\_ids[] = $v[0]; |
| [1010](#L1010) | } |
| [1011](#L1011) | } |
| [1012](#L1012) |  |
| [1013](#L1013) |  |
| [1014](#L1014) | //+++ |
| [1015](#L1015) | $product\_variations\_ids\_string = implode(',', $product\_variations\_ids); |
| [1016](#L1016) |  |
| [1017](#L1017) | $sql[] = " ($wpdb->posts.ID IN($product\_variations\_ids\_string))"; |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | //id |
| [1021](#L1021) | $id\_search = (int) $search\_text; |
| [1022](#L1022) | if ($id\_search) { |
| [1023](#L1023) | $sql[] = " ($wpdb->posts.ID = $id\_search )"; |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) |  |
| [1027](#L1027) | //title |
| [1028](#L1028) | $like = '%' . $wpdb->esc\_like($search\_text) . '%'; |
| [1029](#L1029) | $sql[] = $wpdb->prepare("($wpdb->posts.post\_title LIKE %s)", $like); |
| [1030](#L1030) |  |
| [1031](#L1031) | $where .= " AND ( " . implode(' OR ', $sql) . " )"; |
| [1032](#L1032) | //\*\*\* |
| [1033](#L1033) | return $where; |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | //ajax |
| [1037](#L1037) | public function woobe\_create\_new\_product() { |
| [1038](#L1038) |  |
| [1039](#L1039) | if (!current\_user\_can('manage\_woocommerce')) { |
| [1040](#L1040) | die('0'); |
| [1041](#L1041) | } |
| [1042](#L1042) | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
| [1043](#L1043) | die('0'); |
| [1044](#L1044) | } |
| [1045](#L1045) |  |
| [1046](#L1046) | //also: http://woocommerce.wp-a2z.org/oik\_api/wc\_api\_productscreate\_product/ |
| [1047](#L1047) | $wp\_rest\_request = new WP\_REST\_Request('POST'); |
| [1048](#L1048) | $wp\_rest\_request->set\_body\_params(array( |
| [1049](#L1049) | 'name' => esc\_html\_\_('New Product', 'woo-bulk-editor'), |
| [1050](#L1050) | 'description' => '', |
| [1051](#L1051) | 'status' => apply\_filters('woobe\_new\_product\_status', 'draft') |
| [1052](#L1052) | )); |
| [1053](#L1053) | $products\_controller = new WC\_REST\_Products\_Controller(); |
| [1054](#L1054) |  |
| [1055](#L1055) | $to\_create = intval($\_REQUEST['to\_create']); |
| [1056](#L1056) | while ($to\_create) { |
| [1057](#L1057) | $products\_controller->create\_item($wp\_rest\_request); |
| [1058](#L1058) | $to\_create--; |
| [1059](#L1059) | } |
| [1060](#L1060) |  |
| [1061](#L1061) | exit; |
| [1062](#L1062) | } |
| [1063](#L1063) |  |
| [1064](#L1064) | //ajax |
| [1065](#L1065) | public function woobe\_duplicate\_products() { |
| [1066](#L1066) |  |
| [1067](#L1067) | if (!current\_user\_can('manage\_woocommerce')) { |
| [1068](#L1068) | die('0'); |
| [1069](#L1069) | } |
| [1070](#L1070) | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
| [1071](#L1071) | die('0'); |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | if (!empty($\_REQUEST['products\_ids'])) { |
| [1075](#L1075) | if (!class\_exists('WC\_Admin\_Duplicate\_Product', false)) { |
| [1076](#L1076) | include\_once (plugin\_dir\_path('woocommerce/includes/admin/class-wc-admin-duplicate-product.php')); |
| [1077](#L1077) | } |
| [1078](#L1078) | $duplicator = new WC\_Admin\_Duplicate\_Product(); |
| [1079](#L1079) | //$cached\_products = $this->storage->get\_val('woobe\_cached\_products'); |
| [1080](#L1080) |  |
| [1081](#L1081) | foreach ($\_REQUEST['products\_ids'] as $product\_id) { |
| [1082](#L1082) | $product\_id = intval($product\_id); //sanitizing |
| [1083](#L1083) |  |
| [1084](#L1084) | $product = $this->products->get\_product($product\_id); |
| [1085](#L1085) |  |
| [1086](#L1086) | //when duplication do some copies of the same product - just idea |
| [1087](#L1087) | /\* |
| [1088](#L1088) | if (isset($cached\_products[$product\_id])) { |
| [1089](#L1089) | $product = $cached\_products[$product\_id]; |
| [1090](#L1090) | } else { |
| [1091](#L1091) | $product = $this->products->get\_product($product\_id); |
| [1092](#L1092) | $cached\_products[$product\_id] = $product; |
| [1093](#L1093) | $this->storage->set\_val('woobe\_cached\_products', $cached\_products); |
| [1094](#L1094) | } |
| [1095](#L1095) | \*/ |
| [1096](#L1096) | //duplication of variation is locked |
| [1097](#L1097) | if ($product->get\_type() === 'variation') { |
| [1098](#L1098) | continue; |
| [1099](#L1099) | } |
| [1100](#L1100) |  |
| [1101](#L1101) | $duplicate = $duplicator->product\_duplicate($product); |
| [1102](#L1102) | $duplicate->set\_slug($duplicate->get\_title()/\* . '-'.$duplicate->get\_id() \*/); |
| [1103](#L1103) | $this->clone\_custom\_taxonomies($product\_id, $duplicate->get\_id()); |
| [1104](#L1104) | //delete rating |
| [1105](#L1105) | //delete\_post\_meta($duplicate->get\_id(), "\_wc\_average\_rating"); |
| [1106](#L1106) |  |
| [1107](#L1107) | $duplicate->save(); |
| [1108](#L1108) | do\_action('woocommerce\_product\_duplicate', $duplicate, $product); |
| [1109](#L1109) | //clean\_post\_cache($d->get\_id()); |
| [1110](#L1110) | } |
| [1111](#L1111) |  |
| [1112](#L1112) | //wp\_cache\_flush(); |
| [1113](#L1113) | } |
| [1114](#L1114) |  |
| [1115](#L1115) | die('done'); |
| [1116](#L1116) | } |
| [1117](#L1117) |  |
| [1118](#L1118) | //ajax |
| [1119](#L1119) | public function woobe\_delete\_products() { |
| [1120](#L1120) |  |
| [1121](#L1121) | if (!current\_user\_can('manage\_woocommerce')) { |
| [1122](#L1122) | die('0'); |
| [1123](#L1123) | } |
| [1124](#L1124) | if (!isset($\_REQUEST['woobe\_nonce']) || !wp\_verify\_nonce($\_REQUEST['woobe\_nonce'], 'woobe\_tools\_panel\_nonce')) { |
| [1125](#L1125) | die('0'); |
| [1126](#L1126) | } |
| [1127](#L1127) |  |
| [1128](#L1128) | if (!empty($\_REQUEST['products\_ids']) AND is\_array($\_REQUEST['products\_ids'])) { |
| [1129](#L1129) | foreach ($\_REQUEST['products\_ids'] as $product\_id) { |
| [1130](#L1130) | $product\_id = intval($product\_id); |
| [1131](#L1131) | $product = $this->products->get\_product(intval($product\_id)); |
| [1132](#L1132) | $product->delete(false); |
| [1133](#L1133) | } |
| [1134](#L1134) |  |
| [1135](#L1135) | //wp\_cache\_flush(); - hint for possible compatibility |
| [1136](#L1136) | } |
| [1137](#L1137) |  |
| [1138](#L1138) | die('done'); |
| [1139](#L1139) | } |
| [1140](#L1140) |  |
| [1141](#L1141) | public function wrap\_field\_val($post, $field\_key, $product\_type) { |
| [1142](#L1142) |  |
| [1143](#L1143) | $res = NULL; |
| [1144](#L1144) |  |
| [1145](#L1145) | $product = $this->products->get\_product($post['ID']); |
| [1146](#L1146) | $product\_id = $product->get\_id(); |
| [1147](#L1147) |  |
| [1148](#L1148) | if (isset($this->settings->active\_fields[$field\_key]['allow\_product\_types'])) { |
| [1149](#L1149) | try { |
| [1150](#L1150) | if (!in\_array($product\_type, $this->settings->active\_fields[$field\_key]['allow\_product\_types'])) { |
| [1151](#L1151) | return WOOBE\_HELPER::draw\_restricked(); |
| [1152](#L1152) | } |
| [1153](#L1153) | } catch (Exception $e) { |
| [1154](#L1154) | //\*\*\* |
| [1155](#L1155) | } |
| [1156](#L1156) | } |
| [1157](#L1157) |  |
| [1158](#L1158) | if (isset($this->settings->active\_fields[$field\_key]['prohibit\_product\_types'])) { |
| [1159](#L1159) | try { |
| [1160](#L1160) | if (in\_array($product\_type, $this->settings->active\_fields[$field\_key]['prohibit\_product\_types'])) { |
| [1161](#L1161) | $additional\_info = ""; |
| [1162](#L1162) | if ($this->settings->active\_fields[$field\_key]['field\_type'] == 'attribute' && $post['post\_type'] === 'product\_variation') { |
| [1163](#L1163) | $attr\_name = $product->get\_attribute($field\_key); |
| [1164](#L1164) | if ($attr\_name) { |
| [1165](#L1165) | $additional\_info = '<i class="woobe\_variation\_attr\_info" >[' . $attr\_name . ']</i>'; |
| [1166](#L1166) | } |
| [1167](#L1167) | } |
| [1168](#L1168) | return WOOBE\_HELPER::draw\_restricked() . $additional\_info; |
| [1169](#L1169) | } |
| [1170](#L1170) | } catch (Exception $e) { |
| [1171](#L1171) | //\*\*\* |
| [1172](#L1172) | } |
| [1173](#L1173) | } |
| [1174](#L1174) |  |
| [1175](#L1175) | //\*\*\* |
| [1176](#L1176) | $val = ''; |
| [1177](#L1177) | switch ($this->settings->active\_fields[$field\_key]['field\_type']) { |
| [1178](#L1178) | case 'meta': |
| [1179](#L1179) | case 'prop': |
| [1180](#L1180) | case 'attribute': |
| [1181](#L1181) | $val = $this->products->get\_post\_field($product\_id, $field\_key); |
| [1182](#L1182) |  |
| [1183](#L1183) | break; |
| [1184](#L1184) |  |
| [1185](#L1185) | case 'taxonomy': |
| [1186](#L1186) | $terms = $this->products->get\_post\_field($product\_id, $field\_key); |
| [1187](#L1187) |  |
| [1188](#L1188) | $ids = array(); |
| [1189](#L1189) | $titles = array(); |
| [1190](#L1190) |  |
| [1191](#L1191) | //\*\*\* |
| [1192](#L1192) |  |
| [1193](#L1193) | if (!empty($terms)) { |
| [1194](#L1194) | foreach ($terms as $t) { |
| [1195](#L1195) | $ids[] = $t->term\_id; |
| [1196](#L1196) | $titles[] = $t->name; |
| [1197](#L1197) | } |
| [1198](#L1198) | } |
| [1199](#L1199) |  |
| [1200](#L1200) | if (!empty($ids)) { |
| [1201](#L1201) | $ids = array\_map(function ($v) { |
| [1202](#L1202) | return intval($v); |
| [1203](#L1203) | }, $ids); |
| [1204](#L1204) | } |
| [1205](#L1205) |  |
| [1206](#L1206) | //\*\*\* |
| [1207](#L1207) |  |
| [1208](#L1208) | if ($this->settings->active\_fields[$field\_key]['type'] === 'array') { |
| [1209](#L1209) | $val = array( |
| [1210](#L1210) | 'terms\_ids' => $ids, |
| [1211](#L1211) | 'terms\_titles' => $titles |
| [1212](#L1212) | ); |
| [1213](#L1213) |  |
| [1214](#L1214) | //for drop-down view |
| [1215](#L1215) | if ($this->settings->active\_fields[$field\_key]['edit\_view'] == 'select') { |
| [1216](#L1216) | $val['selected'] = $val['terms\_ids']; |
| [1217](#L1217) | } |
| [1218](#L1218) | } else { |
| [1219](#L1219) | //string, for example: product\_type |
| [1220](#L1220) | $val = $titles[0]; |
| [1221](#L1221) | } |
| [1222](#L1222) | if ($field\_key == 'product\_type') { |
| [1223](#L1223) | $val = $product->get\_type(); |
| [1224](#L1224) | //$val = $this->products->get\_product\_type($post['ID']); |
| [1225](#L1225) | } |
| [1226](#L1226) | break; |
| [1227](#L1227) |  |
| [1228](#L1228) | default: |
| [1229](#L1229) | if (isset($post[$field\_key])) { |
| [1230](#L1230) | $val = $post[$field\_key]; |
| [1231](#L1231) | //for variations |
| [1232](#L1232) | if ($field\_key === 'post\_title' AND $post['post\_type'] === 'product\_variation') { |
| [1233](#L1233) | if ($this->settings->add\_vars\_to\_var\_title) { |
| [1234](#L1234) | $val = $this->products->generate\_product\_title($product); |
| [1235](#L1235) | } |
| [1236](#L1236) | } |
| [1237](#L1237) | } |
| [1238](#L1238) | if ($field\_key == 'post\_content' && $post['post\_type'] === 'product\_variation') { |
| [1239](#L1239) | $val = $this->products->get\_post\_field($product\_id, $field\_key, $post['post\_parent']); |
| [1240](#L1240) | } |
| [1241](#L1241) | break; |
| [1242](#L1242) | } |
| [1243](#L1243) |  |
| [1244](#L1244) | //\*\*\* |
| [1245](#L1245) |  |
| [1246](#L1246) | switch ($this->settings->active\_fields[$field\_key]['edit\_view']) { |
| [1247](#L1247) | case 'select': |
| [1248](#L1248) |  |
| [1249](#L1249) | $select\_options = $this->settings->active\_fields[$field\_key]['select\_options']; |
| [1250](#L1250) |  |
| [1251](#L1251) | //fix for product variations statuses |
| [1252](#L1252) | if ($field\_key === 'post\_status') { |
| [1253](#L1253) | if ($product->is\_type('variation')) { |
| [1254](#L1254) | unset($select\_options['draft']); |
| [1255](#L1255) | unset($select\_options['pending']); |
| [1256](#L1256) | } |
| [1257](#L1257) | } |
| [1258](#L1258) |  |
| [1259](#L1259) | //\*\*\* |
| [1260](#L1260) | $res = WOOBE\_HELPER::draw\_select(array( |
| [1261](#L1261) | 'field' => $field\_key, |
| [1262](#L1262) | 'product\_id' => $product\_id, |
| [1263](#L1263) | 'class' => 'woobe\_data\_select ', |
| [1264](#L1264) | 'options' => $select\_options, |
| [1265](#L1265) | 'selected' => (isset($val['selected']) ? $val['selected'] : $val), |
| [1266](#L1266) | 'onchange' => 'woobe\_act\_select(this)', |
| [1267](#L1267) | )); |
| [1268](#L1268) |  |
| [1269](#L1269) | break; |
| [1270](#L1270) |  |
| [1271](#L1271) | case 'multi\_select': |
| [1272](#L1272) |  |
| [1273](#L1273) | $res = WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/elements/multi\_select.php', array( |
| [1274](#L1274) | 'field\_key' => $field\_key, |
| [1275](#L1275) | 'product\_id' => $product\_id, |
| [1276](#L1276) | 'val' => $val, |
| [1277](#L1277) | 'active\_fields' => $this->settings->active\_fields, |
| [1278](#L1278) | 'post' => $post, |
| [1279](#L1279) | )); |
| [1280](#L1280) | break; |
| [1281](#L1281) | case 'attr\_visibility': |
| [1282](#L1282) |  |
| [1283](#L1283) | $attributes = $this->products->get\_attributes($product\_id); |
| [1284](#L1284) | $res = WOOBE\_HELPER::render\_html(WOOBE\_PATH . 'views/elements/attribute\_visibility.php', array( |
| [1285](#L1285) | 'field\_key' => $field\_key, |
| [1286](#L1286) | 'attributes' => $attributes, |
| [1287](#L1287) | 'product\_id' => $product\_id, |
| [1288](#L1288) | 'post' => $post, |
| [1289](#L1289) | )); |
| [1290](#L1290) | break; |
| [1291](#L1291) |  |
| [1292](#L1292) | case 'popup': |
| [1293](#L1293) | $res = WOOBE\_HELPER::draw\_taxonomy\_popup\_btn($val, $field\_key, $post); |
| [1294](#L1294) |  |
| [1295](#L1295) | break; |
| [1296](#L1296) |  |
| [1297](#L1297) | case 'popupeditor': |
| [1298](#L1298) | $res = WOOBE\_HELPER::draw\_popup\_editor\_btn($val, $field\_key, $post); |
| [1299](#L1299) | break; |
| [1300](#L1300) |  |
| [1301](#L1301) | case 'downloads\_popup\_editor': |
| [1302](#L1302) | $res = WOOBE\_HELPER::draw\_downloads\_popup\_editor\_btn($field\_key, $product\_id); |
| [1303](#L1303) | break; |
| [1304](#L1304) |  |
| [1305](#L1305) | case 'gallery\_popup\_editor': |
| [1306](#L1306) |  |
| [1307](#L1307) | $res = WOOBE\_HELPER::draw\_gallery\_popup\_editor\_btn($field\_key, $product\_id); |
| [1308](#L1308) | break; |
| [1309](#L1309) |  |
| [1310](#L1310) | case 'upsells\_popup\_editor': |
| [1311](#L1311) | $res = WOOBE\_HELPER::draw\_upsells\_popup\_editor\_btn($field\_key, $product\_id); |
| [1312](#L1312) | break; |
| [1313](#L1313) |  |
| [1314](#L1314) | case 'cross\_sells\_popup\_editor': |
| [1315](#L1315) | $res = WOOBE\_HELPER::draw\_cross\_sells\_popup\_editor\_btn($field\_key, $product\_id); |
| [1316](#L1316) | break; |
| [1317](#L1317) |  |
| [1318](#L1318) | case 'grouped\_popup\_editor': |
| [1319](#L1319) | $res = WOOBE\_HELPER::draw\_grouped\_popup\_editor\_btn($field\_key, $product\_id); |
| [1320](#L1320) | break; |
| [1321](#L1321) |  |
| [1322](#L1322) | case 'meta\_popup\_editor': |
| [1323](#L1323) | $res = WOOBE\_HELPER::draw\_meta\_popup\_editor\_btn($field\_key, $product\_id); |
| [1324](#L1324) | break; |
| [1325](#L1325) |  |
| [1326](#L1326) | case 'thumbnail': |
| [1327](#L1327) | $thumbnail = wp\_get\_attachment\_image\_src($val, 'thumbnail'); |
| [1328](#L1328) | $full = wp\_get\_attachment\_image\_src($val, 'full'); |
| [1329](#L1329) |  |
| [1330](#L1330) | if (!empty($thumbnail)) { |
| [1331](#L1331) | $thumbnail = $thumbnail[0]; |
| [1332](#L1332) | $full = $full[0]; |
| [1333](#L1333) | } else { |
| [1334](#L1334) | $thumbnail = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
| [1335](#L1335) | $full = WOOBE\_ASSETS\_LINK . 'images/not-found.jpg'; |
| [1336](#L1336) | } |
| [1337](#L1337) |  |
| [1338](#L1338) | $onmouseover = ''; |
| [1339](#L1339) | if ($this->settings->show\_thumbnail\_preview) { |
| [1340](#L1340) | $onmouseover = 'onmouseover="woobe\_init\_image\_preview(this)"'; |
| [1341](#L1341) | } |
| [1342](#L1342) |  |
| [1343](#L1343) | $res = '<a href="' . $full . '" onclick="return woobe\_act\_thumbnail(this)" ' . $onmouseover . ' title="' . esc\_attr($post['post\_title']) . '"><img src="' . $thumbnail . '" class="attachment-thumbnail size-thumbnail" alt="" /></a>'; |
| [1344](#L1344) | break; |
| [1345](#L1345) |  |
| [1346](#L1346) | case 'switcher': |
| [1347](#L1347) | $labels = array\_values($this->settings->active\_fields[$field\_key]['select\_options']); |
| [1348](#L1348) | $values = array\_keys($this->settings->active\_fields[$field\_key]['select\_options']); |
| [1349](#L1349) | if ($val) {//do switcher |
| [1350](#L1350) | $val = WOOBE\_HELPER::over\_switcher\_val\_to\_swicher($val, $field\_key); |
| [1351](#L1351) | } |
| [1352](#L1352) | $res = WOOBE\_HELPER::draw\_advanced\_switcher(($val == $values[0] ? TRUE : FALSE), $product\_id . '\_' . $field\_key, $field\_key, array('true' => $labels[0], 'false' => $labels[1]), array('true' => $values[0], 'false' => $values[1]), 'yes'); |
| [1353](#L1353) | break; |
| [1354](#L1354) |  |
| [1355](#L1355) | case 'calendar': |
| [1356](#L1356) | if ($this->settings->active\_fields[$field\_key]['type'] === 'timestamp') { |
| [1357](#L1357) | if ($val) { |
| [1358](#L1358) | $val = strtotime($val); |
| [1359](#L1359) | } else { |
| [1360](#L1360) | $val = false; |
| [1361](#L1361) | } |
| [1362](#L1362) | } |
| [1363](#L1363) | $time = true; |
| [1364](#L1364) | if (in\_array($field\_key, array('date\_on\_sale\_from', 'date\_on\_sale\_to'))) { |
| [1365](#L1365) | $time = false; |
| [1366](#L1366) | if ($val) { |
| [1367](#L1367) | $val = $val + get\_option('gmt\_offset') \* 3600; |
| [1368](#L1368) | } |
| [1369](#L1369) | } |
| [1370](#L1370) |  |
| [1371](#L1371) | $post\_title = $post['post\_title']; |
| [1372](#L1372) |  |
| [1373](#L1373) | if ($post['post\_type'] === 'product\_variation') { |
| [1374](#L1374) | if ($this->settings->add\_vars\_to\_var\_title) { |
| [1375](#L1375) | $post\_title = $this->products->generate\_product\_title($this->products->get\_product($product\_id)); |
| [1376](#L1376) | } |
| [1377](#L1377) | } |
| [1378](#L1378) |  |
| [1379](#L1379) | $res = WOOBE\_HELPER::draw\_calendar($product\_id, $post\_title . ' (' . $this->settings->active\_fields[$field\_key]['title'] . ')', $field\_key, $val, "", false, $time); |
| [1380](#L1380) | break; |
| [1381](#L1381) |  |
| [1382](#L1382) | case 'checkbox': |
| [1383](#L1383) | //using for products selection |
| [1384](#L1384) | $res = WOOBE\_HELPER::draw\_checkbox(array( |
| [1385](#L1385) | 'class' => 'woobe\_product\_check', |
| [1386](#L1386) | 'data-product-id' => $product\_id |
| [1387](#L1387) | )); |
| [1388](#L1388) | break; |
| [1389](#L1389) |  |
| [1390](#L1390) | default: |
| [1391](#L1391) | //textinput |
| [1392](#L1392) | $sanitize = ''; |
| [1393](#L1393) | if (isset($this->settings->active\_fields[$field\_key]['sanitize'])) { |
| [1394](#L1394) | $sanitize = $this->settings->active\_fields[$field\_key]['sanitize']; |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | $res = $this->products->sanitize\_answer\_value($field\_key, $sanitize, $val); |
| [1398](#L1398) |  |
| [1399](#L1399) | break; |
| [1400](#L1400) | } |
| [1401](#L1401) |  |
| [1402](#L1402) | //\*\*\* |
| [1403](#L1403) | //lets show product ID as LINK to the product |
| [1404](#L1404) | if ($field\_key === 'ID') { |
| [1405](#L1405) | $class = 'woobe-id-permalink'; |
| [1406](#L1406) | $title = ''; |
| [1407](#L1407) |  |
| [1408](#L1408) | if ($product->get\_type() === 'variable') { |
| [1409](#L1409) | $class .= ' woobe-id-permalink-var'; |
| [1410](#L1410) | $title = esc\_html\_\_('see the product on the site OR select products variations if they are shown', 'woo-bulk-editor'); |
| [1411](#L1411) | } |
| [1412](#L1412) |  |
| [1413](#L1413) | $res = '<a href="' . get\_permalink($res) . '" class="' . $class . '" title="' . $title . '" target="\_blank">' . $res . '</a>'; |
| [1414](#L1414) | } |
| [1415](#L1415) |  |
| [1416](#L1416) | //\*\*\* |
| [1417](#L1417) | /\* for tests |
| [1418](#L1418) | $woobe\_operation\_time = get\_option('woobe\_operation\_time', 0); |
| [1419](#L1419) | if (!$woobe\_operation\_time) { |
| [1420](#L1420) | update\_option('woobe\_operation\_time', time()); |
| [1421](#L1421) | } |
| [1422](#L1422) | \*/ |
| [1423](#L1423) | //\*\*\* |
| [1424](#L1424) | return apply\_filters('woobe\_wrap\_field\_val', $res, $post, $field\_key, $product\_type); |
| [1425](#L1425) | } |
| [1426](#L1426) |  |
| [1427](#L1427) | //ajax |
| [1428](#L1428) | public function woobe\_delete\_tax\_term() { |
| [1429](#L1429) | $term\_id = (int) $\_REQUEST['term\_id']; |
| [1430](#L1430) | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
| [1431](#L1431) | if (!taxonomy\_exists($taxonomy)) { |
| [1432](#L1432) | die('Wrong taxonomy name.'); |
| [1433](#L1433) | } |
| [1434](#L1434) | $result = wp\_delete\_term($term\_id, $taxonomy); |
| [1435](#L1435) | // check the result |
| [1436](#L1436) | if (is\_wp\_error($result)) { |
| [1437](#L1437) |  |
| [1438](#L1438) | die('error wp\_update\_term'); |
| [1439](#L1439) | } else { |
| [1440](#L1440) |  |
| [1441](#L1441) | echo json\_encode(WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy)); |
| [1442](#L1442) | } |
| [1443](#L1443) | exit; |
| [1444](#L1444) | } |
| [1445](#L1445) |  |
| [1446](#L1446) | public function woobe\_update\_tax\_term() { |
| [1447](#L1447) | $term\_id = (int) $\_REQUEST['term\_id']; |
| [1448](#L1448) | $title = sanitize\_textarea\_field($\_REQUEST['title']); |
| [1449](#L1449) | $slug = sanitize\_textarea\_field($\_REQUEST['slug']); |
| [1450](#L1450) | $description = sanitize\_textarea\_field($\_REQUEST['description']); |
| [1451](#L1451) | $parent = (int) $\_REQUEST['parent']; |
| [1452](#L1452) | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
| [1453](#L1453) | if (!taxonomy\_exists($taxonomy)) { |
| [1454](#L1454) | die('Wrong taxonomy name.'); |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) | $result = wp\_update\_term($term\_id, $taxonomy, [ |
| [1458](#L1458) | 'name' => $title, |
| [1459](#L1459) | 'slug' => $slug, |
| [1460](#L1460) | 'description' => $description, |
| [1461](#L1461) | 'parent' => $parent |
| [1462](#L1462) | ]); |
| [1463](#L1463) |  |
| [1464](#L1464) | // check the result |
| [1465](#L1465) | if (is\_wp\_error($result)) { |
| [1466](#L1466) |  |
| [1467](#L1467) | die('error wp\_update\_term'); |
| [1468](#L1468) | } else { |
| [1469](#L1469) |  |
| [1470](#L1470) | echo json\_encode(WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy)); |
| [1471](#L1471) | } |
| [1472](#L1472) | exit; |
| [1473](#L1473) | } |
| [1474](#L1474) |  |
| [1475](#L1475) | public function woobe\_create\_new\_term() { |
| [1476](#L1476) |  |
| [1477](#L1477) | if (!isset($\_REQUEST['mainform\_nonce']) || !wp\_verify\_nonce($\_REQUEST['mainform\_nonce'], 'woobe\_mainform\_nonce')) { |
| [1478](#L1478) | die('0'); |
| [1479](#L1479) | } |
| [1480](#L1480) | if (!current\_user\_can('manage\_woocommerce')) { |
| [1481](#L1481) | die('0'); |
| [1482](#L1482) | } |
| [1483](#L1483) | $titles = wc\_clean($\_REQUEST['titles']); //sanitized in cycle |
| [1484](#L1484) | $slugs = wc\_clean($\_REQUEST['slugs']); //sanitized in cycle |
| [1485](#L1485) | $description = sanitize\_textarea\_field($\_REQUEST['description']); |
| [1486](#L1486) | $taxonomy = sanitize\_text\_field(trim($\_REQUEST['tax\_key'])); |
| [1487](#L1487) |  |
| [1488](#L1488) | if (!taxonomy\_exists($taxonomy)) { |
| [1489](#L1489) | die('Wrong taxonomy name.'); |
| [1490](#L1490) | } |
| [1491](#L1491) |  |
| [1492](#L1492) | //\*\*\* |
| [1493](#L1493) |  |
| [1494](#L1494) | if (!empty($titles)) { |
| [1495](#L1495) |  |
| [1496](#L1496) | if (substr\_count($titles, '|') > 0) { |
| [1497](#L1497) | $titles = explode('|', $titles); |
| [1498](#L1498) | } else { |
| [1499](#L1499) | $titles = array($titles); |
| [1500](#L1500) | } |
| [1501](#L1501) |  |
| [1502](#L1502) |  |
| [1503](#L1503) | if (substr\_count($slugs, '|') > 0) { |
| [1504](#L1504) | $slugs = explode('|', $slugs); |
| [1505](#L1505) | } else { |
| [1506](#L1506) | $slugs = array($slugs); |
| [1507](#L1507) | } |
| [1508](#L1508) |  |
| [1509](#L1509) | //\*\*\* |
| [1510](#L1510) |  |
| [1511](#L1511) | $terms\_ids = array(); |
| [1512](#L1512) | foreach ($titles as $k => $t) { |
| [1513](#L1513) | $t = sanitize\_text\_field(trim($t)); |
| [1514](#L1514) | $sl = sanitize\_title\_with\_dashes(trim($slugs[$k])); |
| [1515](#L1515) |  |
| [1516](#L1516) | if (!term\_exists($t, $taxonomy)) { |
| [1517](#L1517) | if (!empty($t)) { |
| [1518](#L1518) | $res = wp\_insert\_term($t, $taxonomy, array( |
| [1519](#L1519) | 'parent' => intval($\_REQUEST['parent']), |
| [1520](#L1520) | 'slug' => (boolval($sl) ? $sl : ''), |
| [1521](#L1521) | 'description' => $description, |
| [1522](#L1522) | )); |
| [1523](#L1523) | $terms\_ids[] = $res['term\_id']; |
| [1524](#L1524) | } else { |
| [1525](#L1525) | unset($titles[$k]); |
| [1526](#L1526) | } |
| [1527](#L1527) | } |
| [1528](#L1528) | } |
| [1529](#L1529) |  |
| [1530](#L1530) | //\*\*\* |
| [1531](#L1531) | echo wp\_json\_encode(array( |
| [1532](#L1532) | 'titles' => array\_reverse($titles), |
| [1533](#L1533) | 'terms\_ids' => array\_reverse($terms\_ids), |
| [1534](#L1534) | 'terms' => WOOBE\_HELPER::get\_taxonomies\_terms\_hierarchy($taxonomy) |
| [1535](#L1535) | )); |
| [1536](#L1536) |  |
| [1537](#L1537) | } |
| [1538](#L1538) | exit; |
| [1539](#L1539) | } |
| [1540](#L1540) |  |
| [1541](#L1541) | public function clone\_custom\_taxonomies($origin, $clone) { |
| [1542](#L1542) | $taxonomy\_objects = get\_object\_taxonomies('product', 'objects'); |
| [1543](#L1543) | $taxonomies = array(); |
| [1544](#L1544) | $exclude\_tax = array('product\_type', 'product\_visibility', 'product\_shipping\_class', 'product\_cat', 'product\_tag', 'language', 'post\_translations'); |
| [1545](#L1545) | foreach ($taxonomy\_objects as $key => $taxonomy) { |
| [1546](#L1546) | if (in\_array($key, $exclude\_tax)) { |
| [1547](#L1547) | continue; |
| [1548](#L1548) | } |
| [1549](#L1549) | if (taxonomy\_is\_product\_attribute($key)) { |
| [1550](#L1550) | continue; |
| [1551](#L1551) | } |
| [1552](#L1552) | $terms = get\_the\_terms($origin, $key); |
| [1553](#L1553) | if ($terms AND is\_array($terms)) { |
| [1554](#L1554) | $taxonomies = $taxonomies + $terms; |
| [1555](#L1555) | } |
| [1556](#L1556) | } |
| [1557](#L1557) |  |
| [1558](#L1558) | foreach ($taxonomies as $term) { |
| [1559](#L1559) | wp\_set\_post\_terms($clone, $term->term\_id, $term->taxonomy, true); |
| [1560](#L1560) | } |
| [1561](#L1561) | } |
| [1562](#L1562) |  |
| [1563](#L1563) | //do not init functionality on all site pages as it not nessesary |
| [1564](#L1564) | private function is\_should\_init() { |
| [1565](#L1565) | //do not onit it exept of one woobe page and its ajax requests |
| [1566](#L1566) | $init = (isset($\_GET['page']) AND $\_GET['page'] === 'woobe'); |
| [1567](#L1567) |  |
| [1568](#L1568) | if (defined('DOING\_AJAX')) { |
| [1569](#L1569) | if (isset($\_REQUEST['action']) && strpos($\_REQUEST['action'], 'woobe\_') !== FALSE) { |
| [1570](#L1570) | $init = true; |
| [1571](#L1571) | } |
| [1572](#L1572) | } |
| [1573](#L1573) |  |
| [1574](#L1574) | return $init; |
| [1575](#L1575) | } |
| [1576](#L1576) |  |
| [1577](#L1577) | public function add\_statuses($statuses) { |
| [1578](#L1578) | return $statuses + [ |
| [1579](#L1579) | 'future' => esc\_html\_\_('Scheduled', 'woo-bulk-editor') |
| [1580](#L1580) | ]; |
| [1581](#L1581) | } |
| [1582](#L1582) |  |
| [1583](#L1583) | public function ask\_favour() { |
| [1584](#L1584) |  |
| [1585](#L1585) | if (intval(get\_option('woobe\_manage\_rate\_alert', 0)) === -2) { |
| [1586](#L1586) | //old rate system mark for already set review users |
| [1587](#L1587) | return; |
| [1588](#L1588) | } |
| [1589](#L1589) |  |
| [1590](#L1590) | $slug = strtolower(get\_class($this)); |
| [1591](#L1591) |  |
| [1592](#L1592) | add\_action("wp\_ajax\_{$slug}\_dismiss\_rate\_alert", function () use ($slug) { |
| [1593](#L1593) | update\_option("{$slug}\_dismiss\_rate\_alert", 2); |
| [1594](#L1594) | }); |
| [1595](#L1595) |  |
| [1596](#L1596) | add\_action("wp\_ajax\_{$slug}\_later\_rate\_alert", function () use ($slug) { |
| [1597](#L1597) | update\_option("{$slug}\_later\_rate\_alert", time() + 4 \* 7 \* 24 \* 60 \* 60); //4 weeks |
| [1598](#L1598) | }); |
| [1599](#L1599) |  |
| [1600](#L1600) | //+++ |
| [1601](#L1601) |  |
| [1602](#L1602) | add\_action('admin\_notices', function () use ($slug) { |
| [1603](#L1603) |  |
| [1604](#L1604) | if (!current\_user\_can('manage\_options')) { |
| [1605](#L1605) | return; //show to admin only |
| [1606](#L1606) | } |
| [1607](#L1607) |  |
| [1608](#L1608) | if (intval(get\_option("{$slug}\_dismiss\_rate\_alert", 0)) === 2) { |
| [1609](#L1609) | return; |
| [1610](#L1610) | } |
| [1611](#L1611) |  |
| [1612](#L1612) | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) === 0) { |
| [1613](#L1613) | update\_option("{$slug}\_later\_rate\_alert", time() + 3 \* 24 \* 60 \* 60); //3 days after install |
| [1614](#L1614) | return; |
| [1615](#L1615) | } |
| [1616](#L1616) |  |
| [1617](#L1617) | if (intval(get\_option("{$slug}\_later\_rate\_alert", 0)) > time()) { |
| [1618](#L1618) | return; |
| [1619](#L1619) | } |
| [1620](#L1620) |  |
| [1621](#L1621) | $link = 'https://codecanyon.net/downloads#item-21779835'; |
| [1622](#L1622) | $on = 'CodeCanyon'; |
| [1623](#L1623) | if ($this->show\_notes) { |
| [1624](#L1624) | $link = 'https://wordpress.org/support/plugin/woo-bulk-editor/reviews/?filter=5#new-post'; |
| [1625](#L1625) | $on = 'WordPress'; |
| [1626](#L1626) | } |
| [1627](#L1627) | ?> |
| [1628](#L1628) | <div class="notice notice-info" id="pn\_<?php echo $slug ?>\_ask\_favour" style="position: relative;"> |
| [1629](#L1629) | <button onclick="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); |
| [1630](#L1630) | void(0);" title="<?php esc\_html\_e('Later', 'woo-bulk-editor'); ?>" class="notice-dismiss"></button> |
| [1631](#L1631) | <div id="pn\_<?php echo $slug ?>\_review\_suggestion"> |
| [1632](#L1632) | <p><?php esc\_html\_e('Hi! Are you enjoying using BEAR - WooCommerce Bulk Editor and Products Manager Professional?', 'woo-bulk-editor'); ?></p> |
| [1633](#L1633) | <p><a href="javascript: pn\_<?php echo $slug ?>\_set\_review(1); void(0);"><?php esc\_html\_e('Yes, I love it', 'woo-bulk-editor'); ?></a> 🙂 | <a href="javascript: pn\_<?php echo $slug ?>\_set\_review(0); void(0);"><?php esc\_html\_e('Not really...', 'woo-bulk-editor'); ?></a></p> |
| [1634](#L1634) | </div> |
| [1635](#L1635) |  |
| [1636](#L1636) | <div id="pn\_<?php echo $slug ?>\_review\_yes" style="display: none;"> |
| [1637](#L1637) | <p><?php printf(esc\_html\_\_('That\'s awesome! Could you please do us a BIG favor and give it a 5-star rating on %s to help us spread the word and boost our motivation?', 'woo-bulk-editor'), $on) ?></p> |
| [1638](#L1638) | <p style="font-weight: bold;">~ PluginUs.NET developers team</p> |
| [1639](#L1639) | <p> |
| [1640](#L1640) | <a href="<?php echo $link ?>" style="display: inline-block; margin-right: 10px;" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Okay, you deserve it', 'woo-bulk-editor'); ?></a> |
| [1641](#L1641) | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(1); void(0);" style="display: inline-block; margin-right: 10px;"><?php esc\_html\_e('Nope, maybe later', 'woo-bulk-editor'); ?></a> |
| [1642](#L1642) | <a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('I already did', 'woo-bulk-editor'); ?></a> |
| [1643](#L1643) | </p> |
| [1644](#L1644) | </div> |
| [1645](#L1645) |  |
| [1646](#L1646) | <div id="pn\_<?php echo $slug ?>\_review\_no" style="display: none;"> |
| [1647](#L1647) | <p><?php esc\_html\_e('We are sorry to hear you aren\'t enjoying BEAR. We would love a chance to improve it. Could you take a minute and let us know what we can do better?', 'woo-bulk-editor'); ?></p> |
| [1648](#L1648) | <p> |
| [1649](#L1649) | <a href="https://pluginus.net/contact-us/" onclick="pn\_<?php echo $slug ?>\_dismiss\_review(2)" target="\_blank"><?php esc\_html\_e('Give Feedback', 'woo-bulk-editor'); ?></a>&nbsp; |
| [1650](#L1650) | |&nbsp;<a href="javascript: pn\_<?php echo $slug ?>\_dismiss\_review(2); void(0);"><?php esc\_html\_e('No thanks', 'woo-bulk-editor'); ?></a> |
| [1651](#L1651) | </p> |
| [1652](#L1652) | </div> |
| [1653](#L1653) |  |
| [1654](#L1654) |  |
| [1655](#L1655) | <script> |
| [1656](#L1656) | function pn\_<?php echo $slug ?>\_set\_review(yes) { |
| [1657](#L1657) | document.getElementById('pn\_<?php echo $slug ?>\_review\_suggestion').style.display = 'none'; |
| [1658](#L1658) | if (yes) { |
| [1659](#L1659) | document.getElementById('pn\_<?php echo $slug ?>\_review\_yes').style.display = 'block'; |
| [1660](#L1660) | } else { |
| [1661](#L1661) | document.getElementById('pn\_<?php echo $slug ?>\_review\_no').style.display = 'block'; |
| [1662](#L1662) | } |
| [1663](#L1663) | } |
| [1664](#L1664) |  |
| [1665](#L1665) | function pn\_<?php echo $slug ?>\_dismiss\_review(what = 1) { |
| [1666](#L1666) | //1 maybe later, 2 do not ask more |
| [1667](#L1667) | jQuery('#pn\_<?php echo $slug ?>\_ask\_favour').fadeOut(); |
| [1668](#L1668) |  |
| [1669](#L1669) | if (what === 1) { |
| [1670](#L1670) | jQuery.post(ajaxurl, { |
| [1671](#L1671) | action: '<?php echo $slug ?>\_later\_rate\_alert' |
| [1672](#L1672) | }); |
| [1673](#L1673) | } else { |
| [1674](#L1674) | jQuery.post(ajaxurl, { |
| [1675](#L1675) | action: '<?php echo $slug ?>\_dismiss\_rate\_alert' |
| [1676](#L1676) | }); |
| [1677](#L1677) | } |
| [1678](#L1678) |  |
| [1679](#L1679) | return true; |
| [1680](#L1680) | } |
| [1681](#L1681) | </script> |
| [1682](#L1682) | </div> |
| [1683](#L1683) | <?php |
| [1684](#L1684) | }); |
| [1685](#L1685) | } |
| [1686](#L1686) | } |
| [1687](#L1687) |  |
| [1688](#L1688) | //\*\*\* |
| [1689](#L1689) |  |
| [1690](#L1690) |  |
| [1691](#L1691) | $WOOBE = new WOOBE(); |
| [1692](#L1692) | $GLOBALS['WOOBE'] = $WOOBE; |
| [1693](#L1693) | add\_action('init', array($WOOBE, 'init'), 9999); |
| [1694](#L1694) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/woo-bulk-editor/trunk/index.php?format=txt)
* [Original Format](/export/3222674/woo-bulk-editor/trunk/index.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_89fed587_20250115_082238.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# BEAR <= 1.1.3.3 - Cross-Site Request Forgery to Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   BEAR <= 1.1.3.3 - Cross-Site Request Forgery to Stored Cross-Site Scripting

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2023-4920](https://www.cve.org/CVERecord?id=CVE-2023-4920) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | September 25, 2023 |
| Last Updated | October 20, 2023 |
| Researcher | [Marco Wotschka - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/marco-wotschka) |

### Description

The BEAR for WordPress is vulnerable to Cross-Site Request Forgery in versions up to, and including, 1.1.3.3. This is due to missing or incorrect nonce validation on the woobe\_save\_options function. This makes it possible for unauthenticated attackers to modify the plugin's settings via a forged request granted they can trick a site administrator into performing an action such as clicking on a link. Additionally, input sanitization and escaping is insufficient resulting in the possibility of malicious script injection.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/woo-bulk-editor/trunk/index.php#L805)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2970262/woo-bulk-editor/trunk/index.php?contextall=1&old=2968292&old_path=%2Fwoo-bulk-editor%2Ftrunk%2Findex.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoo-bulk-editor%2Fbear-1133-cross-site-request-forgery-to-stored-cross-site-scripting&t=BEAR%20%3C%3D%201.1.3.3%20-%20Cross-Site%20Request%20Forgery%20to%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoo-bulk-editor%2Fbear-1133-cross-site-request-forgery-to-stored-cross-site-scripting&text=BEAR%20%3C%3D%201.1.3.3%20-%20Cross-Site%20Request%20Forgery%20to%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwoo-bulk-editor%2Fbear-1133-cross-site-request-forgery-to-stored-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for BEAR – Bulk Editor and Products Manager Professional for WooCommerce by Pluginus.Net

#### [BEAR – Bulk Editor and Products Manager Professional for WooCommerce by Pluginus.Net](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woo-bulk-editor)

| Software Type | Plugin |
| --- | --- |
| Software Slug | woo-bulk-editor [(view on wordpress.org)](https://wordpress.org/plugins/woo-bulk-editor) |
| Patched? | Yes |
| Remediation | Update to version 1.1.4, or a newer patched version |
| Affected Version | * <= 1.1.3.3 |
| Patched Version | * 1.1.4 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


