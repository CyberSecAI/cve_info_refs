=== Content from www.sonarsource.com_a339212a_20250115_080349.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonarâ€™s industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Visual Studio Code Security: Markdown Vulnerabilities in Third-Party Extensions (2/3)

![](data:image/svg+xml;charset=utf-8...)![Paul Gerste photo]()![Paul Gerste photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/e712603b-cf90-4c56-a666-cd2691b3def2/404b3fe2-4818-41dc-bbe0-9cae851eb542_Paul_Gerste.jpg?w=800&h=800&auto=format&fit=crop)

Paul Gerste

Vulnerability Researcher

November 14, 2023

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/ce58b847-3724-4e35-bcfa-1c2a6e17a497/vs_code_security_markdown_vulnerabilities_in_third_party_extensions_blog_index.webp?w=2400&h=1254&auto=format&fit=crop)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/ce58b847-3724-4e35-bcfa-1c2a6e17a497/vs_code_security_markdown_vulnerabilities_in_third_party_extensions_blog_index.webp?w=2400&h=1254&auto=format&fit=crop)

[Last week's blog post](https://www.sonarsource.com/blog/visual-studio-code-security-deep-dive-into-your-favorite-editor/ "Last week's blog post") summarized our DEF CON talk "Visual Studio Code Is Why I Have (Workspace) Trust Issues". We presented common attack surfaces of the popular code editor Visual Studio Code (VSCode) and showed examples for each of them, either found by us or by other researchers.

When looking at a vulnerability that used a special `command:` link to trigger certain actions, we were intrigued and investigated further. After not finding a vulnerability related to those links in VSCode itself, we turned to third-party extensions that have millions of users themselves.

In this blog post, we present code vulnerabilities we found in [GitLens](https://marketplace.visualstudio.com/items?itemName=eamodio.gitlens "GitLens") (27 million installs) and [GitHub Pull Requests and Issues](https://marketplace.visualstudio.com/items?itemName=GitHub.vscode-pull-request-github "GitHub Pull Requests and Issues") (15 million installs). We will first give some background on VSCode internals, then explain the vulnerable portions of the code, and finally show how these issues can be prevented.

## Impact

We found and responsibly disclosed three vulnerabilities in the code of third-party VSCode extensions, two in *GitLens* by GitKraken and one in *GitHub Pull Requests and Issues* by GitHub:

* GitLens: Git local configuration leading to Arbitrary Code Execution ([CVE-2023-46944](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-46944 "CVE-2023-46944"))
* GitLens: Markdown Injection leading to Arbitrary Code Execution (CVE pending)
* GitHub Pull Requests and Issues: Markdown injection leading to Remote Code Execution ([CVE-2023-36867](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2023-36867 "CVE-2023-36867"))

All three vulnerabilities are fixed. The affected versions are *GitLens* before version 14.0.0 and *GitHub Pull Requests and Issues* before version 0.66.2. The latter one is pre-installed in GitHub Codespaces and on github.dev, GitHub's web version of VSCode.

Fortunately, VSCode updates extensions automatically by default, so most users are expected to be safe as of now. If in doubt, you can always double-check which version you use by going to the *Extensions* tab in VSCode's sidebar, searching for the respective extension, and clicking on the entry to see the extension's details, including the version number.

All three vulnerabilities require some interaction from the victim of the attack. The first GitLens issue (CVE-2023-46944) requires the user to open a malicious folder in VSCode. The second GitLens issue requires the user to click on a certain UI element that appears when opening an untrusted repository in VSCode. The third issue requires the user to click on a certain UI element that is shown based on a malicious GitHub issue or pull request.

Both GitLens vulnerabilities can be exploited in untrusted workspaces, bypassing the [Workspace Trust security boundary](https://www.sonarsource.com/blog/visual-studio-code-security-deep-dive-into-your-favorite-editor/#workspace-trust "Workspace Trust security boundary") of VSCode. The third vulnerability can only be triggered in trusted workspaces, but since attackers can abuse it remotely to attack maintainers of open-source projects, the victims are likely to trust their own projects, allowing the attack to be successful.

## Technical Details

In 2021, we found a vulnerability in VSCode that is related to local Git configurations. You can read the details [in our blog post from back then](https://www.sonarsource.com/blog/securing-developer-tools-git-integrations/ "in our blog post from back then"), but it boils down to the fact that running the `git` executable on untrusted repositories is inherently unsafe because repositories can have their own local configuration that will override the global or user config. Since there are quite some settings that allow to specify custom commands that should be run when certain events occur, it is pretty straightforward to turn this into arbitrary code execution.

The recommended fix is to avoid running `git` on untrusted repos, for example by disabling the entire Git integration in untrusted VSCode workspaces. VSCode implemented this fix for the built-in Git integration, but what about third-party extensions that also use Git?

### GitLens: Git Local Configuration Leads to Code Execution (CVE-2023-46944)

GitLens is an extension developed by GitKraken and has 27 million installs at the time of writing this article. It offers additional features on top of what the built-in Git support of VSCode can do and aims to ease the lives of developers.

We noticed that it would also run in untrusted workspaces, which is a sign to take a closer look at the extension's security. If it uses files or data from the untrusted workspace in a security-sensitive way then attackers could use it to bypass the Workspace Trust boundary.

After observing that GitLens indeed runs `git` commands in the directory of the workspace, we tried our original payload that also worked for VSCode in 2021. As you can see, history repeats itself:

This would allow attackers to execute arbitrary code on the victim's system once a malicious repo is opened in VSCode. After this quick finding, we thought about other VSCode research we've seen in the past and how it could be applicable to third-party extensions such as GitLens.

### GitLens: Markdown Injection Leads to Arbitrary Code Execution

In our previous blog post, we covered several attack surfaces of VSCode, including Cross-Site Scripting (XSS). One example of an XSS vulnerability in VSCode was [CVE-2022-41034](https://github.com/google/security-research/security/advisories/GHSA-pw56-c55x-cm9m "CVE-2022-41034"), discovered by [Thomas Shadwell](https://twitter.com/zemnmez "Thomas Shadwell").

The initial entry point was to include arbitrary HTML in Markdown cells of Jupyter Notebooks. But to go from there to full-blown code execution, he took a different path than other researchers before him. While others would use the usual web attacks of finding and exploiting cross-origin messaging handlers to hijack more privileged origins, he found a way to go straight for code execution.

His magic ingredient was auto-clicking a `command:` link. These links are used throughout VSCode to let the user trigger actions with a click. There are hundreds of these commands, and they can trigger all kinds of actions, from toggling UI elements to starting a debugging session. Even third-party extensions can register new actions that can then be triggered by the user or by other extensions.

After reading Thomas' work, we realized that a big portion of VSCode's UI is just based on Markdown. As an example, an extension can show a custom popup when the user hovers over a piece of code by listening for such an event and supplying a Markdown string with the information that should be shown:

```
vscode.languages.registerHoverProvider('javascript', {
Â Â provideHover(document, position, token) {
Â Â Â Â return {
Â Â Â Â Â Â contents: [new vscode.MarkdownString('# Hover **Content**')]
Â Â Â Â };
Â Â }
});
```

This is exactly what GitLens does to show detailed information about a Git commit. When a user hovers over the inline blame information that GitLens adds to the currently focused line of code, a popup appears. It lists details such as the commit's author, the commit message, and a per-line diff of the changes:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/5bdeab1b-379a-4d7e-87e5-15574825dd65/gitlens-hover-popup.png?w=1298&h=530&auto=format&fit=crop)

Let's take a look at the code that creates this view:

[src/hovers/hovers.ts](https://github.com/gitkraken/vscode-gitlens/blob/9fdb50644b99ebbead2ac66b5a3f51b7d185a1c4/src/hovers/hovers.ts%20#L23-L141 "src/hovers/hovers.ts"):

```
function changesMessage(/* ... */) /* ... */ {
Â Â // ...
Â  current = `[$(git-commit) ${commit.shortSha}](${ShowQuickCommitCommand.getMarkdownCommandArgs(commit.sha)} "Show Commit")`;
Â  // ...
Â Â message = `${diff}\n---\n\nChanges${previous ?? ' added in '}${current} &nbsp;&nbsp;|&nbsp;&nbsp; ${message}`;
Â Â const markdown = new MarkdownString(message, true);
Â Â // ...
Â Â return markdown;
}
```

As we can see, GitLens creates a Markdown string by interpolating information from Git into a Markdown template. GitLens also uses `command:` links, for example, to give the user the ability to open a diff of the whole file. To allow the use of `command:` links, GitLens sets the `isTrusted` property of the resulting Markdown string to `true`:

[src/hovers/hovers.ts](https://github.com/gitkraken/vscode-gitlens/blob/9fdb50644b99ebbead2ac66b5a3f51b7d185a1c4/src/hovers/hovers.ts#L137-L140 "src/hovers/hovers.ts"):

```
const markdown = new MarkdownString(message, true);
markdown.supportHtml = true;
markdown.isTrusted = true;
return markdown;
```

This is required because VSCode sanitizes Markdown strings during rendering and will discard `command:` links from non-trusted strings. But since it is set to true here, attackers could try to somehow insert malicious command links that could trigger unsafe actions.

Looking at how the line diff is generated, we can see that the previous and the current content of the line of code is interpolated into a Markdown code block:

[src/hovers/hovers.ts](https://github.com/gitkraken/vscode-gitlens/blob/9fdb50644b99ebbead2ac66b5a3f51b7d185a1c4/src/hovers/hovers.ts#L283-L291 "src/hovers/hovers.ts"):

```
function getDiffFromHunkLine(hunkLine) {
Â Â // ...
Â Â return `\`\`\`diff${
Â Â Â Â Â Â hunkLine.previous == null ? '' : `\n- ${hunkLine.previous.line.trim()}`
Â Â Â Â }${
Â Â Â Â Â Â hunkLine.current == null ? '' : `\n+ ${hunkLine.current.line.trim()}`
Â Â Â Â }\n\`\`\``;
}
```

There is no Markdown sanitization happening, but the content is inside a code block that does not allow usage of other Markdown until the code block is closed. All that is needed to escape the code block is to insert a closing code fence consisting of three backticks (`````). The closing code fence is required to be at the beginning of a line and the user-controlled content is prefixed with either a plus or a minus sign to make it valid diff syntax. But GitLens only shows the diff for a single line, so how can the three backticks be at the beginning of a line?

Looking at how the Markdown parser determines the start of a line, we can observe that it recognizes the line feed character (`\n`), the carriage return character (`\r`), and the combination of both (`\r\n`) as the separator of two lines. However, GitLens only recognizes the line feed character (`\n`) to be a line separator:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/73832a56-f89e-4f37-8061-2035b8d20a72/gitlens-newline-parser-diff.png?w=1270&h=343&auto=format&fit=crop)

This creates a parsing difference that attackers can abuse to inject Markdown. By placing a `\r` character into a line, they can make GitLens include it in the line diff string. When the Markdown renderer of VSCode encounters the `\r`, it will treat it as a line separator, putting the following three backticks in a new line. This will end the code block and allow the attacker to include arbitrary Markdown:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c8bfaea8-ead2-477f-9a10-4bdf1dee6ce3/gitlens-newline-parser-diff-2.png?w=1730&h=382&auto=format&fit=crop)

The attacker can now add arbitrary Markdown to the hover popup. To show that this is security-sensitive, the attacker can insert a Markdown link that points to a `command:` URL and triggers a VSCode action when clicked.

In the original research that inspired us to dig more into this type of bug, the researcher used the command that opens a new terminal inside VSCode. It is possible to specify the executable and arguments that will be run in the terminal, but this command is only available in trusted workspaces. Since our scenario tries to bypass Workspace Trust, it has to be usable in untrusted workspaces.

Looking through the long list of available commands, we found it to be possible to trigger the installation of an arbitrary extension from the VSCode marketplace using the `workbench.extensions.installExtension` command. It takes the extension's ID in a query parameter and will then install and activate the extension.

The VSCode marketplace is available to everyone and publishing extensions is very easy. There is no manual review process, so new extensions can be installed by anyone within minutes after the extension is published.

This allows attackers to publish a malicious extension and then use the install command to run the install and run the malicious extension on the victim's machine. We created a [dummy extension](https://marketplace.visualstudio.com/items?itemName=pspaul.pop-a-calc "dummy extension") to show the successful execution of arbitrary commands by popping a calculator:

After finding this vulnerability, we continued to look through VSCode's marketplace to find more extensions that use attacker-controlled data unsafely when building Markdown UI elements.

### GitHub Pull Requests and Issues: Markdown Injection Leads to Code Execution (CVE-2023-36867)

This extension, made by GitHub, allows its users to manage issues and pull requests of their projects directly from their IDE. This includes viewing the description of those, which are typically use Markdown for rich-text features:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8c4d8fd2-04c4-496b-bae1-6cfb9105c22c/github-issue-example.png?w=937&h=339&auto=format&fit=crop)

To avoid Markdown injection, the GitHub extension first renders the raw description to text:

[src/issues/util.ts](https://github.com/microsoft/vscode-pull-request-github/blob/v0.66.0/src/issues/util.ts#L225-L227 "src/issues/util.ts"):

```
let body = marked.parse(issue.body, {
Â Â Â Â renderer: new PlainTextRenderer(),
});
```

This consumes the special Markdown character sequences and only outputs the actual content. But there is an issue with this: if the actual content still contains Markdown sequences, they will then be rendered by VSCode!

A simple example of this is a code block. As we already learned previously, the text between code fences is treated as raw text. All special Markdown characters and sequences are put into the output verbatim.

Attackers can abuse this by creating a GitHub issue that contains a Markdown code block, that in turn contains a Markdown link with a `command:` URL:

```
```plain
# [Click here](command:workbench.extensions.installExtension?["pspaul.pop-a-calc",{"donotSync":true}])
```
```

On GitHub's web interface, such a description would be rendered as follows:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e97440f-b0c0-4907-8821-4807ab04810c/github-issue-markdown.png?w=936&h=339&auto=format&fit=crop)

However, the GitHub Pull Requests and Issues extension consumes the surrounding code fence during the plaintext rendering pass and causes the Markdown link to be rendered:

![](data:image/svg+xml;charset=utf-8...)![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/5d1fa16f-fedb-4b50-9e11-19566e7e2cb3/github-malicious-popup.png?w=1060&h=564&auto=format&fit=crop)

When the victim views the issue using the VSCode extension and clicks on the link, the attacker-controlled extension will be installed and run. The impact of this vulnerability can be considered Remote Code Execution because attackers can create a GitHub issue or PR to target the maintainers of the project without requiring the victim to download and open malicious files.

### Patch

#### GitLens

When we reported the two issues to GitLens, they were already aware of the Git local config issue and were already planning to disable the Git integration for untrusted workspaces. This also prevents the second issue from being exploitable, since no attacker-controlled commit information will be shown in the UI when the integration is turned off.

As we mentioned earlier, not executing any Git commands in untrusted repos is the safest approach. Git has a lot of complexity, so trying to prevent just the exploitable behaviors is bound to fail. Additionally, Git is still being developed, so new features would have to be considered as soon as they are released.

#### GitHub Pull Requests and Issues

GitHub fixed the vulnerability in their extension by not setting the `isTrusted` property on their created Markdown strings:

```
Â  const markdown: vscode.MarkdownString = new vscode.MarkdownString(undefined, true);
- markdown.isTrusted = true;
```

This is of course the safest option but it also prevents the developers from using `command:` links. If you really need to use them in your Markdown, you can set the `isTrusted` property to a list of allowed commands. This will prevent attackers from using arbitrary commands in case they find a way to inject Markdown. You can find more information on this in the [VSCode docs](https://code.visualstudio.com/api/references/vscode-api#MarkdownString "VSCode docs").

To avoid the underlying Markdown injection, make sure to always validate, sanitize, or escape data before using it to construct Markdown. A good way to do this in VSCode is to use the [`MarkdownString` class](https://code.visualstudio.com/api/references/vscode-api#MarkdownString "MarkdownString class") that features the `appendText` function that properly escapes raw text before appending it.

## Timeline

### GitLens

| **Date** | **Action** |
| --- | --- |
| 2023-06-07 | We report the two vulnerabilities to GitLens |
| 2023-06-07 | We get an automated acceptance response from GitLens |
| 2023-06-15 | GitLens releases version 14.0.0 that prevents the vulnerable behavior in untrusted workspaces |
| 2023-07-13 | We notice the GitLens release and ask for CVEs and an update from GitLens |
| 2023-07-13 | We get another automated acceptance response from GitLens |
| 2023-07-15 | We get a ticket reference from GitLens, stating they are looking into it |
| 2023-09-01 | GitLens awards us with a $100 bug bounty for the Markdown issue |
| 2023-11-03 | CVE-2023-46944 is assigned by MITRE |

### GitHub Pull Requests and Issues

| **Date** | **Action** |
| --- | --- |
| 2023-06-12 | We report the vulnerability in GitHub Pull Requests and Issues to Microsoft |
| 2023-06-16 | Microsoft confirms the issue |
| 2023-07-11 | CVE-2023-36867 is assigned by Microsoft |
| 2023-07-14 | Microsoft releases a fix in version 0.66.2 of GitHub Pull Requests and Issues |

## Summary

In this article, we took a look at the security of some third-party Visual Studio Code extensions. We saw three vulnerabilities in extensions with millions of installs, all of which have interesting attack vectors that require user interaction to be exploited. We also learned how Markdown is used to create many parts of VSCode's UI, and what risks this has.

Next week, we will finish our series on Visual Studio Code with some new vulnerabilities in VSCode itself. Stay tuned!

## Related Blog Posts

* [Visual Studio Code Security: Deep Dive into Your Favorite Editor (1/3)](https://www.sonarsource.com/blog/visual-studio-code-security-deep-dive-into-your-favorite-editor/ "Visual Studio Code Security: Deep Dive into Your Favorite Editor (1/3)")
* [Securing Developer Tools: Argument Injection in Visual Studio Code](https://www.sonarsource.com/blog/securing-developer-tools-argument-injection-in-vscode/ "Securing Developer Tools: Argument Injection in Visual Studio Code")
* [Securing Developer Tools: Package Managers](https://www.sonarsource.com/blog/securing-developer-tools-package-managers/ "Securing Developer Tools: Package Managers")
* [Securing Developer Tools: Git Integrations](https://www.sonarsource.com/blog/securing-developer-tools-git-integrations/ "Securing Developer Tools: Git Integrations")
* [Securing Developer Tools: OneDev Remote Code Execution](https://www.sonarsource.com/blog/onedev-remote-code-execution/ "Securing Developer Tools: OneDev Remote Code Execution")
#### SHARE

[twitter](https://twitter.com/share?text=undefined)[facebook](https://www.facebook.com/sharer/sharer.php?u=undefined)[linkedin](https://www.linkedin.com/sharing/share-offsite/?url=undefined)mail
## Get new blogs delivered directly to your inbox!

Stay up-to-date with the latest Sonar content. Subscribe now to receive the latest blog articles.

Email\*cheqSign up

By submitting this form, you agree to the storing and processing of your personal data as described in the [Privacy Policy](/company/privacy/ "Privacy Policy") and [Cookie Policy](/company/cookie-policy/ "Cookie Policy"). You can withdraw your consent by unsubscribing at any time.

This site is protected by reCAPTCHA and the Google [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms) apply.

[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

Â© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.



=== Content from github.com_c0312368_20250115_080343.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitkraken%2Fvscode-gitlens%2Fcommit%2Fee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitkraken%2Fvscode-gitlens%2Fcommit%2Fee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=gitkraken%2Fvscode-gitlens)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gitkraken](/gitkraken)
/
**[vscode-gitlens](/gitkraken/vscode-gitlens)**
Public

* [Notifications](/login?return_to=%2Fgitkraken%2Fvscode-gitlens) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgitkraken%2Fvscode-gitlens)
* [Star
   9.1k](/login?return_to=%2Fgitkraken%2Fvscode-gitlens)

* [Code](/gitkraken/vscode-gitlens)
* [Issues
  736](/gitkraken/vscode-gitlens/issues)
* [Pull requests
  50](/gitkraken/vscode-gitlens/pulls)
* [Discussions](/gitkraken/vscode-gitlens/discussions)
* [Actions](/gitkraken/vscode-gitlens/actions)
* [Projects
  0](/gitkraken/vscode-gitlens/projects)
* [Wiki](/gitkraken/vscode-gitlens/wiki)
* [Security](/gitkraken/vscode-gitlens/security)
* [Insights](/gitkraken/vscode-gitlens/pulse)

Additional navigation options

* [Code](/gitkraken/vscode-gitlens)
* [Issues](/gitkraken/vscode-gitlens/issues)
* [Pull requests](/gitkraken/vscode-gitlens/pulls)
* [Discussions](/gitkraken/vscode-gitlens/discussions)
* [Actions](/gitkraken/vscode-gitlens/actions)
* [Projects](/gitkraken/vscode-gitlens/projects)
* [Wiki](/gitkraken/vscode-gitlens/wiki)
* [Security](/gitkraken/vscode-gitlens/security)
* [Insights](/gitkraken/vscode-gitlens/pulse)

## Commit

[Permalink](/gitkraken/vscode-gitlens/commit/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Disables Git access in Restricted Mode (untrusted)

[Browse files](/gitkraken/vscode-gitlens/tree/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440)
Browse the repository at this point in the history

* Loading branch information

[![@eamodio](https://avatars.githubusercontent.com/u/641685?s=40&v=4)](/eamodio)

[eamodio](/gitkraken/vscode-gitlens/commits?author=eamodio "View all commits by eamodio")
committed
May 17, 2023

1 parent
[2ff1890](/gitkraken/vscode-gitlens/commit/2ff1890571a6789ed83c17389e2120d0a18e2177)

commit ee2a0c4

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**105 additions**
and
**35 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + env/node/git

    - src/env/node/git/git.ts
      [git.ts](#diff-825b206f4881fcfecdbc2016c38cd1e5494f97c7d9440bcbd39ce2819221f039)
    - src/env/node/git/localGitProvider.ts
      [localGitProvider.ts](#diff-c6c610518f02359adaf5dd382d0f887762174728d4a6e0b5b33c8a9a845c5526)
  + git

    - src/git/errors.ts
      [errors.ts](#diff-fd5f9838d2eb1ffe33543c66c8102736c11db494a9c5aa2bb8b5d6813a347cc3)
    - src/git/gitProviderService.ts
      [gitProviderService.ts](#diff-55cfbfeb98ecc5647aba5dedf7cf76710df0bdfe0fe4d0c8adebfb29eff78cbe)
  + webviews

    - apps/home

      * src/webviews/apps/home/home.html
        [home.html](#diff-196596a71c80f61af47089a6e993ab4d1a9aad5abce0e6659799d5865f7d852f)
      * src/webviews/apps/home/home.ts
        [home.ts](#diff-dc77a39ff739d8f42fad771c13bfaea6bb1ba405da06cb25edde272bd7aaee24)
    - home

      * src/webviews/home/homeWebview.ts
        [homeWebview.ts](#diff-72f61aded7a0f51af197f84c2466117ad49318540856e3c35f53510c1b12b537)
      * src/webviews/home/protocol.ts
        [protocol.ts](#diff-7cb8fda4b554780b8fea77e8c9ac8dd3d83edb09e8fa372bfeb3c429ec15485e)

## There are no files selected for viewing

8 changes: 7 additions & 1 deletion

8
[src/env/node/git/git.ts](#diff-825b206f4881fcfecdbc2016c38cd1e5494f97c7d9440bcbd39ce2819221f039 "src/env/node/git/git.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/env/node/git/git.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -9,7 +9,7 @@ import type { CoreConfiguration } from '../../../constants'; |
|  |  | import { GlyphChars } from '../../../constants'; |
|  |  | import type { GitCommandOptions, GitSpawnOptions } from '../../../git/commandOptions'; |
|  |  | import { GitErrorHandling } from '../../../git/commandOptions'; |
|  |  | import { StashPushError, StashPushErrorReason } from '../../../git/errors'; |
|  |  | import { StashPushError, StashPushErrorReason, WorkspaceUntrustedError } from '../../../git/errors'; |
|  |  | import type { GitDiffFilter } from '../../../git/models/diff'; |
|  |  | import { isUncommitted, isUncommittedStaged, shortenRevision } from '../../../git/models/reference'; |
|  |  | import type { GitUser } from '../../../git/models/user'; |
| Expand Down  Expand Up | | @@ -123,6 +123,8 @@ export class Git { |
|  |  | async git(options: ExitCodeOnlyGitCommandOptions, ...args: any[]): Promise<number>; |
|  |  | async git<T extends string | Buffer>(options: GitCommandOptions, ...args: any[]): Promise<T>; |
|  |  | async git<T extends string | Buffer>(options: GitCommandOptions, ...args: any[]): Promise<T> { |
|  |  | if (!workspace.isTrusted) throw new WorkspaceUntrustedError(); |
|  |  |  |
|  |  | const start = hrtime(); |
|  |  |  |
|  |  | const { configs, correlationKey, errors: errorHandling, encoding, ...opts } = options; |
| Expand Down  Expand Up | | @@ -224,6 +226,8 @@ export class Git { |
|  |  | } |
|  |  |  |
|  |  | async gitSpawn(options: GitSpawnOptions, ...args: any[]): Promise<ChildProcess> { |
|  |  | if (!workspace.isTrusted) throw new WorkspaceUntrustedError(); |
|  |  |  |
|  |  | const start = hrtime(); |
|  |  |  |
|  |  | const { cancellation, configs, stdin, stdinEncoding, ...opts } = options; |
| Expand Down  Expand Up | | @@ -1645,6 +1649,8 @@ export class Git { |
|  |  | ? (emptyArray as []) |
|  |  | : [true, normalizePath(data.trimStart().replace(/[\r|\n]+$/, ''))]; |
|  |  | } catch (ex) { |
|  |  | if (ex instanceof WorkspaceUntrustedError) return emptyArray as []; |
|  |  |  |
|  |  | const unsafeMatch = |
|  |  | /^fatal: detected dubious ownership in repository at '([^']+)'[\s\S]\*git config --global --add safe\.directory '?([^'\n]+)'?$/m.exec( |
|  |  | ex.stderr, |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/env/node/git/localGitProvider.ts](#diff-c6c610518f02359adaf5dd382d0f887762174728d4a6e0b5b33c8a9a845c5526 "src/env/node/git/localGitProvider.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/env/node/git/localGitProvider.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1088,7 +1088,7 @@ export class LocalGitProvider implements GitProvider, Disposable { |
|  |  | [safe, repoPath] = await this.git.rev\_parse\_\_show\_toplevel(uri.fsPath); |
|  |  | if (safe) { |
|  |  | this.unsafePaths.delete(uri.fsPath); |
|  |  | } else { |
|  |  | } else if (safe === false) { |
|  |  | this.unsafePaths.add(uri.fsPath); |
|  |  | } |
|  |  | if (!repoPath) return undefined; |
| Expand Down | |  |

9 changes: 9 additions & 0 deletions

9
[src/git/errors.ts](#diff-fd5f9838d2eb1ffe33543c66c8102736c11db494a9c5aa2bb8b5d6813a347cc3 "src/git/errors.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/git/errors.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -81,6 +81,15 @@ export class StashPushError extends Error { |
|  |  | Error.captureStackTrace?.(this, StashApplyError); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | export class WorkspaceUntrustedError extends Error { |
|  |  | constructor() { |
|  |  | super('Unable to perform Git operations because the current workspace is untrusted'); |
|  |  |  |
|  |  | Error.captureStackTrace?.(this, WorkspaceUntrustedError); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | export const enum WorktreeCreateErrorReason { |
|  |  | AlreadyCheckedOut = 1, |
|  |  | AlreadyExists = 2, |
| Expand Down | |  |

13 changes: 13 additions & 0 deletions

13
[src/git/gitProviderService.ts](#diff-55cfbfeb98ecc5647aba5dedf7cf76710df0bdfe0fe4d0c8adebfb29eff78cbe "src/git/gitProviderService.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/git/gitProviderService.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -82,6 +82,12 @@ import type { RichRemoteProvider } from './remotes/richRemoteProvider'; |
|  |  | import type { GitSearch, SearchQuery } from './search'; |
|  |  |  |
|  |  | const emptyArray = Object.freeze([]) as unknown as any[]; |
|  |  | const emptyDisposable = Object.freeze({ |
|  |  | dispose: () => { |
|  |  | /\* noop \*/ |
|  |  | }, |
|  |  | }); |
|  |  |  |
|  |  | const maxDefaultBranchWeight = 100; |
|  |  | const weightedDefaultBranches = new Map<string, number>([ |
|  |  | ['master', maxDefaultBranchWeight], |
| Expand Down  Expand Up | | @@ -216,6 +222,13 @@ export class GitProviderService implements Disposable { |
|  |  | this.resetCaches('providers'); |
|  |  | this.updateContext(); |
|  |  | }), |
|  |  | !workspace.isTrusted |
|  |  | ? workspace.onDidGrantWorkspaceTrust(() => { |
|  |  | if (workspace.isTrusted && workspace.workspaceFolders?.length) { |
|  |  | void this.discoverRepositories(workspace.workspaceFolders, { force: true }); |
|  |  | } |
|  |  | }) |
|  |  | : emptyDisposable, |
|  |  | ...this.registerCommands(), |
|  |  | ); |
|  |  |  |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[src/webviews/apps/home/home.html](#diff-196596a71c80f61af47089a6e993ab4d1a9aad5abce0e6659799d5865f7d852f "src/webviews/apps/home/home.html")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/webviews/apps/home/home.html)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,6 +96,17 @@ <h1 class="alert\_\_title">Unsafe repository</h1> |
|  |  | </p> |
|  |  | </div> |
|  |  | </div> |
|  |  | <div id="untrusted-alert" class="alert alert--info mb-0" aria-hidden="true" hidden> |
|  |  | <h1 class="alert\_\_title">Untrusted workspace</h1> |
|  |  | <div class="alert\_\_description"> |
|  |  | <p>Unable to open repositories in Restricted Mode.</p> |
|  |  | <p class="centered"> |
|  |  | <vscode-button data-action="command:workbench.trust.manage" |
|  |  | >Manage Workspace Trust</vscode-button |
|  |  | > |
|  |  | </p> |
|  |  | </div> |
|  |  | </div> |
|  |  | <header-card id="header-card" image="#{webroot}/media/gitlens-logo.webp"></header-card> |
|  |  | </header> |
|  |  | <main class="home\_\_main scrollable" id="main" tabindex="-1"> |
| Expand Down | |  |

64 changes: 36 additions & 28 deletions

64
[src/webviews/apps/home/home.ts](#diff-dc77a39ff739d8f42fad771c13bfaea6bb1ba405da06cb25edde272bd7aaee24 "src/webviews/apps/home/home.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/webviews/apps/home/home.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -247,36 +247,26 @@ export class HomeApp extends App<State> { |
|  |  | } |
|  |  |  |
|  |  | private updateNoRepo() { |
|  |  | const { repositories } = this.state; |
|  |  | const hasRepos = repositories.openCount > 0; |
|  |  | const value = hasRepos ? 'true' : 'false'; |
|  |  |  |
|  |  | let $el = document.getElementById('no-repo'); |
|  |  | $el?.setAttribute('aria-hidden', value); |
|  |  | if (hasRepos) { |
|  |  | $el?.setAttribute('hidden', value); |
|  |  | } else { |
|  |  | $el?.removeAttribute('hidden'); |
|  |  | } |
|  |  | const { |
|  |  | repositories: { openCount, hasUnsafe, trusted }, |
|  |  | } = this.state; |
|  |  |  |
|  |  | $el = document.getElementById('no-repo-alert'); |
|  |  | const showUnsafe = repositories.hasUnsafe && !hasRepos; |
|  |  | const $unsafeEl = document.getElementById('unsafe-repo-alert'); |
|  |  | if (showUnsafe) { |
|  |  | $el?.setAttribute('aria-hidden', 'true'); |
|  |  | $el?.setAttribute('hidden', 'true'); |
|  |  | $unsafeEl?.setAttribute('aria-hidden', 'false'); |
|  |  | $unsafeEl?.removeAttribute('hidden'); |
|  |  | } else { |
|  |  | $unsafeEl?.setAttribute('aria-hidden', 'true'); |
|  |  | $unsafeEl?.setAttribute('hidden', 'true'); |
|  |  | $el?.setAttribute('aria-hidden', value); |
|  |  | if (hasRepos) { |
|  |  | $el?.setAttribute('hidden', value); |
|  |  | } else { |
|  |  | $el?.removeAttribute('hidden'); |
|  |  | } |
|  |  | if (!trusted) { |
|  |  | setElementVisibility('untrusted-alert', true); |
|  |  | setElementVisibility('no-repo', false); |
|  |  | setElementVisibility('no-repo-alert', false); |
|  |  | setElementVisibility('unsafe-repo-alert', false); |
|  |  |  |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | setElementVisibility('untrusted-alert', false); |
|  |  |  |
|  |  | const noRepos = openCount === 0; |
|  |  |  |
|  |  | setElementVisibility('no-repo', noRepos); |
|  |  | setElementVisibility('no-repo-alert', noRepos && !hasUnsafe); |
|  |  | setElementVisibility('unsafe-repo-alert', hasUnsafe); |
|  |  | } |
|  |  |  |
|  |  | private updateLayout() { |
| Expand Down  Expand Up | | @@ -371,6 +361,24 @@ export class HomeApp extends App<State> { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function setElementVisibility(elementOrId: string | HTMLElement | null | undefined, visible: boolean) { |
|  |  | let el; |
|  |  | if (typeof elementOrId === 'string') { |
|  |  | el = document.getElementById(elementOrId); |
|  |  | } else { |
|  |  | el = elementOrId; |
|  |  | } |
|  |  | if (el == null) return; |
|  |  |  |
|  |  | if (visible) { |
|  |  | el.setAttribute('aria-hidden', 'false'); |
|  |  | el.removeAttribute('hidden'); |
|  |  | } else { |
|  |  | el.setAttribute('aria-hidden', 'true'); |
|  |  | el?.setAttribute('hidden', 'true'); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | function toggleArrayItem(list: string[] = [], item: string, add = true) { |
|  |  | const hasStep = list.includes(item); |
|  |  | if (!hasStep && add) { |
| Expand Down | |  |

32 changes: 27 additions & 5 deletions

32
[src/webviews/home/homeWebview.ts](#diff-72f61aded7a0f51af197f84c2466117ad49318540856e3c35f53510c1b12b537 "src/webviews/home/homeWebview.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/webviews/home/homeWebview.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,5 +1,5 @@ |
|  |  | import type { ConfigurationChangeEvent } from 'vscode'; |
|  |  | import { Disposable, window } from 'vscode'; |
|  |  | import { Disposable, window, workspace } from 'vscode'; |
|  |  | import { getAvatarUriFromGravatarEmail } from '../../avatars'; |
|  |  | import { ViewsLayout } from '../../commands/setViewsLayout'; |
|  |  | import type { Container } from '../../container'; |
| Expand All | | @@ -10,11 +10,18 @@ import { executeCoreCommand, registerCommand } from '../../system/command'; |
|  |  | import { configuration } from '../../system/configuration'; |
|  |  | import type { Deferrable } from '../../system/function'; |
|  |  | import { debounce } from '../../system/function'; |
|  |  | import { getSettledValue } from '../../system/promise'; |
|  |  | import type { StorageChangeEvent } from '../../system/storage'; |
|  |  | import type { IpcMessage } from '../protocol'; |
|  |  | import { onIpc } from '../protocol'; |
|  |  | import type { WebviewController, WebviewProvider } from '../webviewController'; |
|  |  | import type { CompleteStepParams, DismissBannerParams, DismissSectionParams, State } from './protocol'; |
|  |  | import type { |
|  |  | CompleteStepParams, |
|  |  | DidChangeRepositoriesParams, |
|  |  | DismissBannerParams, |
|  |  | DismissSectionParams, |
|  |  | State, |
|  |  | } from './protocol'; |
|  |  | import { |
|  |  | CompletedActions, |
|  |  | CompleteStepCommandType, |
| Expand All | | @@ -27,6 +34,12 @@ import { |
|  |  | DismissStatusCommandType, |
|  |  | } from './protocol'; |
|  |  |  |
|  |  | const emptyDisposable = Object.freeze({ |
|  |  | dispose: () => { |
|  |  | /\* noop \*/ |
|  |  | }, |
|  |  | }); |
|  |  |  |
|  |  | export class HomeWebviewProvider implements WebviewProvider<State> { |
|  |  | private readonly \_disposable: Disposable; |
|  |  |  |
| Expand All | | @@ -36,6 +49,9 @@ export class HomeWebviewProvider implements WebviewProvider<State> { |
|  |  | this.container.git.onDidChangeRepositories(this.onRepositoriesChanged, this), |
|  |  | configuration.onDidChange(this.onConfigurationChanged, this), |
|  |  | this.container.storage.onDidChange(this.onStorageChanged, this), |
|  |  | !workspace.isTrusted |
|  |  | ? workspace.onDidGrantWorkspaceTrust(this.notifyDidChangeRepositories, this) |
|  |  | : emptyDisposable, |
|  |  | ); |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -221,7 +237,12 @@ export class HomeWebviewProvider implements WebviewProvider<State> { |
|  |  | } |
|  |  |  |
|  |  | private async getState(subscription?: Subscription): Promise<State> { |
|  |  | const sub = await this.getSubscription(subscription); |
|  |  | const [visibilityResult, subscriptionResult] = await Promise.allSettled([ |
|  |  | this.getRepoVisibility(), |
|  |  | this.getSubscription(subscription), |
|  |  | ]); |
|  |  |  |
|  |  | const sub = getSettledValue(subscriptionResult)!; |
|  |  | const steps = this.container.storage.get('home:steps:completed', []); |
|  |  | const sections = this.container.storage.get('home:sections:dismissed', []); |
|  |  | const dismissedBanners = this.container.storage.get('home:banners:dismissed', []); |
| Expand All | | @@ -233,7 +254,7 @@ export class HomeWebviewProvider implements WebviewProvider<State> { |
|  |  | subscription: sub.subscription, |
|  |  | completedActions: sub.completedActions, |
|  |  | plusEnabled: this.getPlusEnabled(), |
|  |  | visibility: await this.getRepoVisibility(), |
|  |  | visibility: getSettledValue(visibilityResult)!, |
|  |  | completedSteps: steps, |
|  |  | dismissedSections: sections, |
|  |  | avatar: sub.avatar, |
| Expand All | | @@ -255,11 +276,12 @@ export class HomeWebviewProvider implements WebviewProvider<State> { |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | private getRepositoriesState() { |
|  |  | private getRepositoriesState(): DidChangeRepositoriesParams { |
|  |  | return { |
|  |  | count: this.container.git.repositoryCount, |
|  |  | openCount: this.container.git.openRepositoryCount, |
|  |  | hasUnsafe: this.container.git.hasUnsafeRepositories(), |
|  |  | trusted: workspace.isTrusted, |
|  |  | }; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

1 change: 1 addition & 0 deletions

1
[src/webviews/home/protocol.ts](#diff-7cb8fda4b554780b8fea77e8c9ac8dd3d83edb09e8fa372bfeb3c429ec15485e "src/webviews/home/protocol.ts")

Show comments

[View file](/gitkraken/vscode-gitlens/blob/ee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440/src/webviews/home/protocol.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,6 +57,7 @@ export interface DidChangeRepositoriesParams { |
|  |  | count: number; |
|  |  | openCount: number; |
|  |  | hasUnsafe: boolean; |
|  |  | trusted: boolean; |
|  |  | } |
|  |  | export const DidChangeRepositoriesType = new IpcNotificationType<DidChangeRepositoriesParams>('repositories/didChange'); |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ee2a0c4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgitkraken%2Fvscode-gitlens%2Fcommit%2Fee2a0c42a92d33059a39fd15fbbd5dd3d5ab6440) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


