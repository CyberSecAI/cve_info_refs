=== Content from github.com_a09b4f99_20250114_194237.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth1.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth1.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Files

 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth1.php

Copy path Blame  Blame
## Latest commit

## History

[History](/yiisoft/yii2-authclient/commits/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth1.php)405 lines (354 loc) · 12.6 KB 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth1.php

Top
## File metadata and controls

* Code
* Blame

405 lines (354 loc) · 12.6 KB[Raw](https://github.com/yiisoft/yii2-authclient/raw/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth1.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405<?php/\*\* \* @link https://www.yiiframework.com/ \* @copyright Copyright (c) 2008 Yii Software LLC \* @license https://www.yiiframework.com/license/ \*/
namespace yii\authclient;
use Yii;use yii\base\InvalidParamException;use yii\httpclient\Request;use yii\web\HttpException;
/\*\* \* OAuth1 serves as a client for the OAuth 1/1.0a flow. \* \* In order to acquire access token perform following sequence: \* \* ```php \* use yii\authclient\OAuth1; \* use Yii; \* \* // assuming class MyAuthClient extends OAuth1 \* $oauthClient = new MyAuthClient(); \* $requestToken = $oauthClient->fetchRequestToken(); // Get request token \* $url = $oauthClient->buildAuthUrl($requestToken); // Get authorization URL \* return Yii::$app->getResponse()->redirect($url); // Redirect to authorization URL \* \* // After user returns at our site: \* $accessToken = $oauthClient->fetchAccessToken(Yii::$app->request->get('oauth\_token'), $requestToken); // Upgrade to access token \* ``` \* \* @see https://oauth.net/1/ \* https://tools.ietf.org/html/rfc5849 \* \* @author Paul Klimov <klimov.paul@gmail.com> \* @since 2.0 \*/abstract class OAuth1 extends BaseOAuth{ /\*\* \* @var string protocol version. \*/ public $version = '1.0'; /\*\* \* @var string OAuth consumer key. \*/ public $consumerKey; /\*\* \* @var string OAuth consumer secret. \*/ public $consumerSecret; /\*\* \* @var string OAuth request token URL. \*/ public $requestTokenUrl; /\*\* \* @var string request token HTTP method. \*/ public $requestTokenMethod = 'GET'; /\*\* \* @var string OAuth access token URL. \*/ public $accessTokenUrl; /\*\* \* @var string access token HTTP method. \*/ public $accessTokenMethod = 'GET'; /\*\* \* @var array|null list of the request methods, which require adding 'Authorization' header. \* By default only POST requests will have 'Authorization' header. \* You may set this option to `null` in order to make all requests to use 'Authorization' header. \* @since 2.1.1 \*/ public $authorizationHeaderMethods = ['POST'];
 /\*\* \* Fetches the OAuth request token. \* @param array $params additional request params. \* @return OAuthToken request token. \*/ public function fetchRequestToken(array $params = []) { $this->setAccessToken(null); $defaultParams = [ 'oauth\_consumer\_key' => $this->consumerKey, 'oauth\_callback' => $this->getReturnUrl(), //'xoauth\_displayname' => Yii::$app->name, ]; if (!empty($this->scope)) { $defaultParams['scope'] = $this->scope; }
 $request = $this->createRequest() ->setMethod($this->requestTokenMethod) ->setUrl($this->requestTokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->signRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken([ 'params' => $response ]); $this->setState('requestToken', $token);
 return $token; }
 /\*\* \* Composes user authorization URL. \* @param OAuthToken $requestToken OAuth request token. \* @param array $params additional request params. \* @return string authorize URL \* @throws InvalidParamException on failure. \*/ public function buildAuthUrl(OAuthToken $requestToken = null, array $params = []) { if (!is\_object($requestToken)) { $requestToken = $this->getState('requestToken'); if (!is\_object($requestToken)) { throw new InvalidParamException('Request token is required to build authorize URL!'); } } $params['oauth\_token'] = $requestToken->getToken();
 return $this->composeUrl($this->authUrl, $params); }
 /\*\* \* Fetches OAuth access token. \* @param string $oauthToken OAuth token returned with redirection back to client. \* @param OAuthToken $requestToken OAuth request token. \* @param string $oauthVerifier OAuth verifier. \* @param array $params additional request params. \* @return OAuthToken OAuth access token. \* @throws InvalidParamException on failure. \* @throws HttpException in case oauth token miss-matches request token. \*/ public function fetchAccessToken($oauthToken = null, OAuthToken $requestToken = null, $oauthVerifier = null, array $params = []) { $incomingRequest = Yii::$app->getRequest();
 if ($oauthToken === null) { $oauthToken = $incomingRequest->get('oauth\_token', $incomingRequest->post('oauth\_token', $oauthToken)); }
 if (!is\_object($requestToken)) { $requestToken = $this->getState('requestToken'); if (!is\_object($requestToken)) { throw new InvalidParamException('Request token is required to fetch access token!'); } }
 if (strcmp($requestToken->getToken(), $oauthToken) !== 0) { throw new HttpException(400, 'Invalid auth state parameter.'); }
 $this->removeState('requestToken');
 $defaultParams = [ 'oauth\_consumer\_key' => $this->consumerKey, 'oauth\_token' => $requestToken->getToken() ]; if ($oauthVerifier === null) { $oauthVerifier = $incomingRequest->get('oauth\_verifier', $incomingRequest->post('oauth\_verifier')); } if (!empty($oauthVerifier)) { $defaultParams['oauth\_verifier'] = $oauthVerifier; }
 $request = $this->createRequest() ->setMethod($this->accessTokenMethod) ->setUrl($this->accessTokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->signRequest($request, $requestToken);
 $response = $this->sendRequest($request);
 $token = $this->createToken([ 'params' => $response ]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* {@inheritdoc} \*/ public function createRequest() { $request = parent::createRequest(); $request->on(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']); return $request; }
 /\*\* \* {@inheritdoc} \*/ public function createApiRequest() { $request = parent::createApiRequest();
 // ensure correct event handlers order : $request->off(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']); $request->on(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']);
 return $request; }
 /\*\* \* Handles [[Request::EVENT\_BEFORE\_SEND]] event. \* Ensures every request has been signed up before sending. \* @param \yii\httpclient\RequestEvent $event event instance. \* @since 2.1 \*/ public function beforeRequestSend($event) { $this->signRequest($event->request); }
 /\*\* \* {@inheritdoc} \*/ public function applyAccessTokenToRequest($request, $accessToken) { $data = $request->getData(); $data['oauth\_consumer\_key'] = $this->consumerKey; $data['oauth\_token'] = $accessToken->getToken(); $request->setData($data); }
 /\*\* \* Gets new auth token to replace expired one. \* @param OAuthToken $token expired auth token. \* @return OAuthToken new auth token. \*/ public function refreshAccessToken(OAuthToken $token) { // @todo return null; }
 /\*\* \* Generates nonce value. \* @return string nonce value. \*/ protected function generateNonce() { return md5(microtime() . random\_int(0, PHP\_INT\_MAX)); }
 /\*\* \* Generates timestamp. \* @return int timestamp. \*/ protected function generateTimestamp() { return time(); }
 /\*\* \* Generate common request params like version, timestamp etc. \* @return array common request params. \*/ protected function generateCommonRequestParams() { $params = [ 'oauth\_version' => $this->version, 'oauth\_nonce' => $this->generateNonce(), 'oauth\_timestamp' => $this->generateTimestamp(), ];
 return $params; }
 /\*\* \* Sign given request with [[signatureMethod]]. \* @param \yii\httpclient\Request $request request instance. \* @param OAuthToken|null $token OAuth token to be used for signature, if not set [[accessToken]] will be used. \* @since 2.1 this method is public. \*/ public function signRequest($request, $token = null) { $params = $request->getData();
 if (isset($params['oauth\_signature\_method']) || $request->hasHeaders() && $request->getHeaders()->has('authorization')) { // avoid double sign of request return; }
 if (empty($params)) { $params = $this->generateCommonRequestParams(); } else { $params = array\_merge($this->generateCommonRequestParams(), $params); }
 $url = $request->getFullUrl();
 $signatureMethod = $this->getSignatureMethod();
 $params['oauth\_signature\_method'] = $signatureMethod->getName(); $signatureBaseString = $this->composeSignatureBaseString($request->getMethod(), $url, $params); $signatureKey = $this->composeSignatureKey($token); $params['oauth\_signature'] = $signatureMethod->generateSignature($signatureBaseString, $signatureKey);
 if ($this->authorizationHeaderMethods === null || in\_array(strtoupper($request->getMethod()), array\_map('strtoupper', $this->authorizationHeaderMethods), true)) { $authorizationHeader = $this->composeAuthorizationHeader($params); if (!empty($authorizationHeader)) { $request->addHeaders($authorizationHeader);
 // removing authorization header params, avoiding duplicate param server error : foreach ($params as $key => $value) { if (substr\_compare($key, 'oauth', 0, 5) === 0) { unset($params[$key]); } } } }
 $request->setData($params); }
 /\*\* \* Creates signature base string, which will be signed by [[signatureMethod]]. \* @param string $method request method. \* @param string $url request URL. \* @param array $params request params. \* @return string base signature string. \*/ protected function composeSignatureBaseString($method, $url, array $params) { if (strpos($url, '?') !== false) { list($url, $queryString) = explode('?', $url, 2); parse\_str($queryString, $urlParams); $params = array\_merge($urlParams, $params); } unset($params['oauth\_signature']); uksort($params, 'strcmp'); // Parameters are sorted by name, using lexicographical byte value ordering. Ref: Spec: 9.1.1 $parts = [ strtoupper($method), $url, http\_build\_query($params, '', '&', PHP\_QUERY\_RFC3986) ]; $parts = array\_map('rawurlencode', $parts);
 return implode('&', $parts); }
 /\*\* \* Composes request signature key. \* @param OAuthToken|null $token OAuth token to be used for signature key. \* @return string signature key. \*/ protected function composeSignatureKey($token = null) { $signatureKeyParts = [ $this->consumerSecret ];
 if ($token === null) { $token = $this->getAccessToken(); } if (is\_object($token)) { $signatureKeyParts[] = $token->getTokenSecret(); } else { $signatureKeyParts[] = ''; }
 $signatureKeyParts = array\_map('rawurlencode', $signatureKeyParts);
 return implode('&', $signatureKeyParts); }
 /\*\* \* Composes authorization header. \* @param array $params request params. \* @param string $realm authorization realm. \* @return array authorization header in format: [name => content]. \*/ protected function composeAuthorizationHeader(array $params, $realm = '') { $header = 'OAuth'; $headerParams = []; if (!empty($realm)) { $headerParams[] = 'realm="' . rawurlencode($realm) . '"'; } foreach ($params as $key => $value) { if (substr\_compare($key, 'oauth', 0, 5)) { continue; } $headerParams[] = rawurlencode($key) . '="' . rawurlencode($value) . '"'; } if (!empty($headerParams)) { $header .= ' ' . implode(', ', $headerParams); }
 return ['Authorization' => $header]; }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6daf2fd2_20250114_194242.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fsecurity%2Fadvisories%2FGHSA-w8vh-p74j-x9xp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fsecurity%2Fadvisories%2FGHSA-w8vh-p74j-x9xp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

# Possible timing attack on string comparison in OAuth1, OAuth2 and OpenID Connect implementation of yii2-authclient

Low

[samdark](/samdark)
published
GHSA-w8vh-p74j-x9xp
Dec 16, 2023

## Package

composer

yiisoft/yii2-authclient
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<=2.2.14

## Patched versions

2.2.15

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

Original Report:

> The Oauth1/2 "state" and OpenID Connect "nonce" is vulnerable for a "timing attack" since it's compared via regular string
>
> comparison (instead of `Yii::$app->getSecurity()->compareString()`).

Affected Code:

1. OAuth 1 "state"

   [yii2-authclient/src/OAuth1.php](https://github.com/yiisoft/yii2-authclient/blob/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth1.php#L158)

   Line 158
   in
   [0d1c388](/yiisoft/yii2-authclient/commit/0d1c3880f4d79e20aa1d77c012650b54e69695ff)

   |  | if (strcmp($requestToken->getToken(), $oauthToken) !== 0) { |
   | --- | --- |
2. OAuth 2 "state"

   [yii2-authclient/src/OAuth2.php](https://github.com/yiisoft/yii2-authclient/blob/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth2.php#L121)

   Line 121
   in
   [0d1c388](/yiisoft/yii2-authclient/commit/0d1c3880f4d79e20aa1d77c012650b54e69695ff)

   |  | if (!isset($incomingState) || empty($authState) || strcmp($incomingState, $authState) !== 0) { |
   | --- | --- |
3. OpenID Connect "nonce"

   [yii2-authclient/src/OpenIdConnect.php](https://github.com/yiisoft/yii2-authclient/blob/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OpenIdConnect.php#L420)

   Line 420
   in
   [0d1c388](/yiisoft/yii2-authclient/commit/0d1c3880f4d79e20aa1d77c012650b54e69695ff)

   |  | if (!isset($jwsData['nonce']) || empty($authNonce) || strcmp($jwsData['nonce'], $authNonce) !== 0) { |
   | --- | --- |

### Patches

*Has the problem been patched? What versions should users upgrade to?*

TBD: Replace strcmp with `Yii::$app->getSecurity()->compareString()`).

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

not as far as I see.

### References

*Are there any links users can visit to find out more?*

### Severity

Low

0.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
None

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:N/I:N/A:N

### CVE ID

CVE-2023-50708

### Weaknesses

No CWEs

### Credits

* [![@rhertogh](https://avatars.githubusercontent.com/u/1292337?s=40&v=4)](/rhertogh)
  [rhertogh](/rhertogh)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_322baf71_20250114_194240.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOpenIdConnect.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOpenIdConnect.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_28b0a242_20250114_194241.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2Fdabddf2154ab7e7703740205a069202554089248)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2Fdabddf2154ab7e7703740205a069202554089248)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Commit

[Permalink](/yiisoft/yii2-authclient/commit/dabddf2154ab7e7703740205a069202554089248)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-w8vh-p74j-x9xp](https://github.com/advisories/GHSA-w8vh-p74j-x9xp "GHSA-w8vh-p74j-x9xp")

[Browse files](/yiisoft/yii2-authclient/tree/dabddf2154ab7e7703740205a069202554089248)
Browse the repository at this point in the history

```
* Fixed Oauth1/2 and OpenID Connect state/noce check

* Updated changelog for [GHSA-w8vh-p74j-x9xp](https://github.com/advisories/GHSA-w8vh-p74j-x9xp "GHSA-w8vh-p74j-x9xp")

---------

Co-authored-by: Alexander Makarov <sam@rmcreative.ru>
```

* Loading branch information

[![@rhertogh](https://avatars.githubusercontent.com/u/1292337?s=40&v=4)](/rhertogh) [![@samdark](https://avatars.githubusercontent.com/u/47294?s=40&v=4)](/samdark)

[rhertogh](/yiisoft/yii2-authclient/commits?author=rhertogh "View all commits by rhertogh")
and
[samdark](/yiisoft/yii2-authclient/commits?author=samdark "View all commits by samdark")
authored
Dec 16, 2023

1 parent
[721ed97](/yiisoft/yii2-authclient/commit/721ed974bc44137437b0cdc8454e137fff8db213)

commit dabddf2

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**12 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* src

  + src/OAuth1.php
    [OAuth1.php](#diff-b7a1183a7e041be22fddf4bd759a76b29751f16380046227a82a8f1867dab532)
  + src/OAuth2.php
    [OAuth2.php](#diff-ae39669291a69de8ee6407e8e3914c10e05a931e9075fa3851de7a9867859555)
  + src/OpenIdConnect.php
    [OpenIdConnect.php](#diff-ac0364db028cbf2e8f27fb8950548c06ca6ef6a1e79426ff5b096c414b62e2ba)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/yiisoft/yii2-authclient/blob/dabddf2154ab7e7703740205a069202554089248/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -6,6 +6,7 @@ Yii Framework 2 authclient extension Change Log |
|  |  |  |
|  |  | - Bug #364: Use issuer claim from OpenID Configuration (radwouters) |
|  |  | - Enh #367: Throw more specific `ClientErrorResponseException` when the response code in `BaseOAuth::sendRequest()` is a 4xx (rhertogh) |
|  |  | - Enh GHSA-w8vh-p74j-x9xp: Improved security for OAuth1, OAuth2 and OpenID Connect clients by using timing attack safe string comparsion (rhertogh) |
|  |  | - Enh GHSA-rw54-6826-c8j5: Improved security for OAuth2 client by requiring an `authCodeVerifier` if PKCE is enabled and clearing it after usage (rhertogh) |
|  |  |  |
|  |  |  |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/OAuth1.php](#diff-b7a1183a7e041be22fddf4bd759a76b29751f16380046227a82a8f1867dab532 "src/OAuth1.php")

Show comments

[View file](/yiisoft/yii2-authclient/blob/dabddf2154ab7e7703740205a069202554089248/src/OAuth1.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -155,7 +155,7 @@ public function fetchAccessToken($oauthToken = null, OAuthToken $requestToken = |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | if (strcmp($requestToken->getToken(), $oauthToken) !== 0) { |
|  |  | if (!Yii::$app->getSecurity()->compareString($requestToken->getToken(), $oauthToken)) { |
|  |  | throw new HttpException(400, 'Invalid auth state parameter.'); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[src/OAuth2.php](#diff-ae39669291a69de8ee6407e8e3914c10e05a931e9075fa3851de7a9867859555 "src/OAuth2.php")

Show comments

[View file](/yiisoft/yii2-authclient/blob/dabddf2154ab7e7703740205a069202554089248/src/OAuth2.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -118,7 +118,11 @@ public function fetchAccessToken($authCode, array $params = []) |
|  |  | $authState = $this->getState('authState'); |
|  |  | $incomingRequest = Yii::$app->getRequest(); |
|  |  | $incomingState = $incomingRequest->get('state', $incomingRequest->post('state')); |
|  |  | if (!isset($incomingState) || empty($authState) || strcmp($incomingState, $authState) !== 0) { |
|  |  | if ( |
|  |  | !isset($incomingState) |
|  |  | || empty($authState) |
|  |  | || !Yii::$app->getSecurity()->compareString($incomingState, $authState) |
|  |  | ) { |
|  |  | throw new HttpException(400, 'Invalid auth state parameter.'); |
|  |  | } |
|  |  | $this->removeState('authState'); |
| Expand Down | |  |

6 changes: 5 additions & 1 deletion

6
[src/OpenIdConnect.php](#diff-ac0364db028cbf2e8f27fb8950548c06ca6ef6a1e79426ff5b096c414b62e2ba "src/OpenIdConnect.php")

Show comments

[View file](/yiisoft/yii2-authclient/blob/dabddf2154ab7e7703740205a069202554089248/src/OpenIdConnect.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -417,7 +417,11 @@ protected function createToken(array $tokenConfig = []) |
|  |  |  |
|  |  | if ($this->getValidateAuthNonce()) { |
|  |  | $authNonce = $this->getState('authNonce'); |
|  |  | if (!isset($jwsData['nonce']) || empty($authNonce) || strcmp($jwsData['nonce'], $authNonce) !== 0) { |
|  |  | if ( |
|  |  | !isset($jwsData['nonce']) |
|  |  | || empty($authNonce) |
|  |  | || !Yii::$app->getSecurity()->compareString($jwsData['nonce'], $authNonce) |
|  |  | ) { |
|  |  | throw new HttpException(400, 'Invalid auth nonce'); |
|  |  | } else { |
|  |  | $this->removeState('authNonce'); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `dabddf2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2Fdabddf2154ab7e7703740205a069202554089248) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9527cd7f_20250114_194238.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth2.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth2.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Files

 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth2.php

Copy path Blame  Blame
## Latest commit

## History

[History](/yiisoft/yii2-authclient/commits/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth2.php)376 lines (324 loc) · 12.2 KB 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth2.php

Top
## File metadata and controls

* Code
* Blame

376 lines (324 loc) · 12.2 KB[Raw](https://github.com/yiisoft/yii2-authclient/raw/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth2.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376<?php/\*\* \* @link https://www.yiiframework.com/ \* @copyright Copyright (c) 2008 Yii Software LLC \* @license https://www.yiiframework.com/license/ \*/
namespace yii\authclient;
use Yii;use yii\helpers\Json;use yii\helpers\Url;use yii\web\HttpException;
/\*\* \* OAuth2 serves as a client for the OAuth 2 flow. \* \* In oder to acquire access token perform following sequence: \* \* ```php \* use yii\authclient\OAuth2; \* \* // assuming class MyAuthClient extends OAuth2 \* $oauthClient = new MyAuthClient(); \* $url = $oauthClient->buildAuthUrl(); // Build authorization URL \* Yii::$app->getResponse()->redirect($url); // Redirect to authorization URL. \* // After user returns at our site: \* $code = Yii::$app->getRequest()->get('code'); \* $accessToken = $oauthClient->fetchAccessToken($code); // Get access token \* ``` \* \* @see https://oauth.net/2/ \* @see https://tools.ietf.org/html/rfc6749 \* \* @author Paul Klimov <klimov.paul@gmail.com> \* @since 2.0 \*/abstract class OAuth2 extends BaseOAuth{ /\*\* \* @var string protocol version. \*/ public $version = '2.0'; /\*\* \* @var string OAuth client ID. \*/ public $clientId; /\*\* \* @var string OAuth client secret. \*/ public $clientSecret; /\*\* \* @var string token request URL endpoint. \*/ public $tokenUrl; /\*\* \* @var bool whether to use and validate auth 'state' parameter in authentication flow. \* If enabled - the opaque value will be generated and applied to auth URL to maintain \* state between the request and callback. The authorization server includes this value, \* when redirecting the user-agent back to the client. \* The option is used for preventing cross-site request forgery. \* @since 2.1 \*/ public $validateAuthState = true; /\*\* \* @var bool Whether to enable proof key for code exchange (PKCE) support and add \* a `code\_challenge` and `code\_verifier` to the auth request. \* @since 2.2.10 \* \* @see https://oauth.net/2/pkce/ \*/ public $enablePkce = false;
 /\*\* \* Composes user authorization URL. \* @param array $params additional auth GET params. \* @return string authorization URL. \*/ public function buildAuthUrl(array $params = []) { $defaultParams = [ 'client\_id' => $this->clientId, 'response\_type' => 'code', 'redirect\_uri' => $this->getReturnUrl(), 'xoauth\_displayname' => Yii::$app->name, ]; if (!empty($this->scope)) { $defaultParams['scope'] = $this->scope; }
 if ($this->validateAuthState) { $authState = $this->generateAuthState(); $this->setState('authState', $authState); $defaultParams['state'] = $authState; }
 if ($this->enablePkce) { $codeVerifier = bin2hex(Yii::$app->security->generateRandomKey(64)); $this->setState('authCodeVerifier', $codeVerifier); $defaultParams['code\_challenge'] = trim(strtr(base64\_encode(hash('sha256', $codeVerifier, true)), '+/', '-\_'), '='); $defaultParams['code\_challenge\_method'] = 'S256'; }
 return $this->composeUrl($this->authUrl, array\_merge($defaultParams, $params)); }
 /\*\* \* Fetches access token from authorization code. \* @param string $authCode authorization code, usually comes at GET parameter 'code'. \* @param array $params additional request params. \* @return OAuthToken access token. \* @throws HttpException on invalid auth state in case [[enableStateValidation]] is enabled. \*/ public function fetchAccessToken($authCode, array $params = []) { if ($this->validateAuthState) { $authState = $this->getState('authState'); $incomingRequest = Yii::$app->getRequest(); $incomingState = $incomingRequest->get('state', $incomingRequest->post('state')); if (!isset($incomingState) || empty($authState) || strcmp($incomingState, $authState) !== 0) { throw new HttpException(400, 'Invalid auth state parameter.'); } $this->removeState('authState'); }
 $defaultParams = [ 'code' => $authCode, 'grant\_type' => 'authorization\_code', 'redirect\_uri' => $this->getReturnUrl(), ];
 if ($this->enablePkce) { $defaultParams['code\_verifier'] = $this->getState('authCodeVerifier'); }
 $request = $this->createRequest() ->setMethod('POST') ->setUrl($this->tokenUrl) ->setData(array\_merge($defaultParams, $params));
 // Azure AD will complain if there is no `Origin` header. if ($this->enablePkce) { $request->addHeaders(['Origin' => Url::to('/')]); }
 $this->applyClientCredentialsToRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken(['params' => $response]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* {@inheritdoc} \*/ public function applyAccessTokenToRequest($request, $accessToken) { $data = $request->getData(); $data['access\_token'] = $accessToken->getToken(); $request->setData($data); }
 /\*\* \* Applies client credentials (e.g. [[clientId]] and [[clientSecret]]) to the HTTP request instance. \* This method should be invoked before sending any HTTP request, which requires client credentials. \* @param \yii\httpclient\Request $request HTTP request instance. \* @since 2.1.3 \*/ protected function applyClientCredentialsToRequest($request) { $request->addData([ 'client\_id' => $this->clientId, 'client\_secret' => $this->clientSecret, ]); }
 /\*\* \* Gets new auth token to replace expired one. \* @param OAuthToken $token expired auth token. \* @return OAuthToken new auth token. \*/ public function refreshAccessToken(OAuthToken $token) { $params = [ 'grant\_type' => 'refresh\_token' ]; $params = array\_merge($token->getParams(), $params);
 $request = $this->createRequest() ->setMethod('POST') ->setUrl($this->tokenUrl) ->setData($params);
 $this->applyClientCredentialsToRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken(['params' => $response]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* Generates the auth state value. \* @return string auth state value. \* @since 2.1 \*/ protected function generateAuthState() { $baseString = get\_class($this) . '-' . time(); if (Yii::$app->has('session')) { $baseString .= '-' . Yii::$app->session->getId(); } return hash('sha256', uniqid($baseString, true)); }
 /\*\* \* Creates token from its configuration. \* @param array $tokenConfig token configuration. \* @return OAuthToken token instance. \*/ protected function createToken(array $tokenConfig = []) { $defaultTokenConfig = ['tokenParamKey' => 'access\_token']; $tokenConfig = array\_merge($defaultTokenConfig, $tokenConfig);
 return parent::createToken($tokenConfig); }
 /\*\* \* Authenticate OAuth client directly at the provider without third party (user) involved, \* using 'client\_credentials' grant type. \* @see https://tools.ietf.org/html/rfc6749#section-4.4 \* @param array $params additional request params. \* @return OAuthToken access token. \* @since 2.1.0 \*/ public function authenticateClient($params = []) { $defaultParams = [ 'grant\_type' => 'client\_credentials', ];
 if (!empty($this->scope)) { $defaultParams['scope'] = $this->scope; }
 $request = $this->createRequest() ->setMethod('POST') ->setUrl($this->tokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->applyClientCredentialsToRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken(['params' => $response]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* Authenticates user directly by 'username/password' pair, using 'password' grant type. \* @see https://tools.ietf.org/html/rfc6749#section-4.3 \* @param string $username user name. \* @param string $password user password. \* @param array $params additional request params. \* @return OAuthToken access token. \* @since 2.1.0 \*/ public function authenticateUser($username, $password, $params = []) { $defaultParams = [ 'grant\_type' => 'password', 'username' => $username, 'password' => $password, ];
 if (!empty($this->scope)) { $defaultParams['scope'] = $this->scope; }
 $request = $this->createRequest() ->setMethod('POST') ->setUrl($this->tokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->applyClientCredentialsToRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken(['params' => $response]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* Authenticates user directly using JSON Web Token (JWT). \* @see https://tools.ietf.org/html/rfc7515 \* @param string $username \* @param \yii\authclient\signature\BaseMethod|array $signature signature method or its array configuration. \* If empty - [[signatureMethod]] will be used. \* @param array $options additional options. Valid options are: \* \* - header: array, additional JWS header parameters. \* - payload: array, additional JWS payload (message or claim-set) parameters. \* - signatureKey: string, signature key to be used, if not set - [[clientSecret]] will be used. \* \* @param array $params additional request params. \* @return OAuthToken access token. \* @since 2.1.3 \*/ public function authenticateUserJwt($username, $signature = null, $options = [], $params = []) { if (empty($signature)) { $signatureMethod = $this->getSignatureMethod(); } elseif (is\_object($signature)) { $signatureMethod = $signature; } else { $signatureMethod = $this->createSignatureMethod($signature); }
 $header = isset($options['header']) ? $options['header'] : []; $payload = isset($options['payload']) ? $options['payload'] : [];
 $header = array\_merge([ 'typ' => 'JWT' ], $header); if (!isset($header['alg'])) { $signatureName = $signatureMethod->getName(); if (preg\_match('/^([a-z])[a-z]\*\-([a-z])[a-z]\*([0-9]+)$/is', $signatureName, $matches)) { // convert 'RSA-SHA256' to 'RS256' : $signatureName = $matches[1] . $matches[2] . $matches[3]; } $header['alg'] = $signatureName; }
 $payload = array\_merge([ 'iss' => $username, 'scope' => $this->scope, 'aud' => $this->tokenUrl, 'iat' => time(), ], $payload); if (!isset($payload['exp'])) { $payload['exp'] = $payload['iat'] + 3600; }
 $signatureBaseString = base64\_encode(Json::encode($header)) . '.' . base64\_encode(Json::encode($payload)); $signatureKey = isset($options['signatureKey']) ? $options['signatureKey'] : $this->clientSecret; $signature = $signatureMethod->generateSignature($signatureBaseString, $signatureKey);
 $assertion = $signatureBaseString . '.' . $signature;
 $request = $this->createRequest() ->setMethod('POST') ->setUrl($this->tokenUrl) ->setData(array\_merge([ 'grant\_type' => 'urn:ietf:params:oauth:grant-type:jwt-bearer', 'assertion' => $assertion, ], $params));
 $response = $this->sendRequest($request);
 $token = $this->createToken(['params' => $response]); $this->setAccessToken($token);
 return $token; }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


