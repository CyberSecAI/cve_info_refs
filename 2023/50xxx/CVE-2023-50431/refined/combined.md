=== Content from lists.freedesktop.org_ceae9942_20250114_204724.html ===

# [PATCH] habanalabs: fix information leak in sec\_attest\_info()

**Xingyuan Mo**
hdthky0 at gmail.com

*Wed Nov 22 10:49:40 UTC 2023*

* Previous message (by thread): [[PATCH] drm/i915/psr: Fix unsigned expression compared with zero](431885.html)
* Next message (by thread): [[PATCH] drm/amdgpu: Fix cat debugfs amdgpu\_regs\_didt causes kernel null pointer](431731.html)
* **Messages sorted by:**
  [[ date ]](date.html#431772)
  [[ thread ]](thread.html#431772)
  [[ subject ]](subject.html#431772)
  [[ author ]](author.html#431772)

---

```
This function may copy the pad0 field of struct hl_info_sec_attest to
user mode which has not been initialized, resulting in leakage of kernel
heap data to user mode. To prevent this, just zero out the pad0 field
before copying it to user mode.

Fixes: 0c88760f8f5e ("habanalabs/gaudi2: add secured attestation info uapi")
Signed-off-by: Xingyuan Mo <[hdthky0 at gmail.com](https://lists.freedesktop.org/mailman/listinfo/dri-devel)>
---
 drivers/accel/habanalabs/common/habanalabs_ioctl.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/drivers/accel/habanalabs/common/habanalabs_ioctl.c b/drivers/accel/habanalabs/common/habanalabs_ioctl.c
index 8ef36effb95b..9e3feb7ad5e5 100644
--- a/drivers/accel/habanalabs/common/habanalabs_ioctl.c
+++ b/drivers/accel/habanalabs/common/habanalabs_ioctl.c
@@ -707,6 +707,7 @@ static int sec_attest_info(struct hl_fpriv *hpriv, struct hl_info_args *args)
 	memcpy(&info->public_data, &sec_attest_info->public_data, sizeof(info->public_data));
 	memcpy(&info->certificate, &sec_attest_info->certificate, sizeof(info->certificate));
 	memcpy(&info->quote_sig, &sec_attest_info->quote_sig, sizeof(info->quote_sig));
+	memset(&info->pad0, 0, sizeof(info->pad0));

 	rc = copy_to_user(out, info,
 				min_t(size_t, max_size, sizeof(*info))) ? -EFAULT : 0;
--
2.43.0

```

---

* Previous message (by thread): [[PATCH] drm/i915/psr: Fix unsigned expression compared with zero](431885.html)
* Next message (by thread): [[PATCH] drm/amdgpu: Fix cat debugfs amdgpu\_regs\_didt causes kernel null pointer](431731.html)
* **Messages sorted by:**
  [[ date ]](date.html#431772)
  [[ thread ]](thread.html#431772)
  [[ subject ]](subject.html#431772)
  [[ author ]](author.html#431772)

---

[More information about the dri-devel
mailing list](https://lists.freedesktop.org/mailman/listinfo/dri-devel)



=== Content from git.kernel.org_12a42fc5_20250114_204722.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Xingyuan Mo <hdthky0@gmail.com> | 2023-12-08 21:00:59 +0800 |
| --- | --- | --- |
| committer | Oded Gabbay <ogabbay@kernel.org> | 2023-12-19 11:09:44 +0200 |
| commit | [a9f07790a4b2250f0140e9a61c7f842fd9b618c7](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)) | |
| tree | [9e35c9895056311508f4e8ea75d170472acfcdbb](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7) | |
| parent | [bc5f15abcf95ce7e4c2e33daddcb5850ee5e671d](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=bc5f15abcf95ce7e4c2e33daddcb5850ee5e671d) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7&id2=bc5f15abcf95ce7e4c2e33daddcb5850ee5e671d)) | |
| download | [linux-a9f07790a4b2250f0140e9a61c7f842fd9b618c7.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-a9f07790a4b2250f0140e9a61c7f842fd9b618c7.tar.gz) | |

accel/habanalabs: fix information leak in sec\_attest\_info()This function may copy the pad0 field of struct hl\_info\_sec\_attest to user
mode which has not been initialized, resulting in leakage of kernel heap
data to user mode. To prevent this, use kzalloc() to allocate and zero out
the buffer, which can also eliminate other uninitialized holes, if any.
Fixes: 0c88760f8f5e ("habanalabs/gaudi2: add secured attestation info uapi")
Signed-off-by: Xingyuan Mo <hdthky0@gmail.com>
Reviewed-by: Oded Gabbay <ogabbay@kernel.org>
Signed-off-by: Oded Gabbay <ogabbay@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)

| -rw-r--r-- | [drivers/accel/habanalabs/common/habanalabs\_ioctl.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/accel/habanalabs/common/habanalabs_ioctl.c?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/accel/habanalabs/common/habanalabs\_ioctl.c b/drivers/accel/habanalabs/common/habanalabs\_ioctl.cindex a92713e0e58017..1dd6e23172caa3 100644--- a/[drivers/accel/habanalabs/common/habanalabs\_ioctl.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/accel/habanalabs/common/habanalabs_ioctl.c?id=bc5f15abcf95ce7e4c2e33daddcb5850ee5e671d)+++ b/[drivers/accel/habanalabs/common/habanalabs\_ioctl.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/accel/habanalabs/common/habanalabs_ioctl.c?id=a9f07790a4b2250f0140e9a61c7f842fd9b618c7)@@ -688,7 +688,7 @@ static int sec\_attest\_info(struct hl\_fpriv \*hpriv, struct hl\_info\_args \*args) if (!sec\_attest\_info) return -ENOMEM; - info = kmalloc(sizeof(\*info), GFP\_KERNEL);+ info = kzalloc(sizeof(\*info), GFP\_KERNEL); if (!info) { rc = -ENOMEM; goto free\_sec\_attest\_info; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 20:45:59 +0000


