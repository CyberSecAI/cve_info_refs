=== Content from github.com_f3baa695_20250114_221134.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdompdf%2Fphp-svg-lib%2Fcommit%2F88163cbe562d9b391b3a352e54d9c89d02d77ee0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdompdf%2Fphp-svg-lib%2Fcommit%2F88163cbe562d9b391b3a352e54d9c89d02d77ee0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=dompdf%2Fphp-svg-lib)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dompdf](/dompdf)
/
**[php-svg-lib](/dompdf/php-svg-lib)**
Public

* [Notifications](/login?return_to=%2Fdompdf%2Fphp-svg-lib) You must be signed in to change notification settings
* [Fork
  77](/login?return_to=%2Fdompdf%2Fphp-svg-lib)
* [Star
   1.4k](/login?return_to=%2Fdompdf%2Fphp-svg-lib)

* [Code](/dompdf/php-svg-lib)
* [Issues
  17](/dompdf/php-svg-lib/issues)
* [Pull requests
  0](/dompdf/php-svg-lib/pulls)
* [Actions](/dompdf/php-svg-lib/actions)
* [Projects
  0](/dompdf/php-svg-lib/projects)
* [Wiki](/dompdf/php-svg-lib/wiki)
* [Security](/dompdf/php-svg-lib/security)
* [Insights](/dompdf/php-svg-lib/pulse)

Additional navigation options

* [Code](/dompdf/php-svg-lib)
* [Issues](/dompdf/php-svg-lib/issues)
* [Pull requests](/dompdf/php-svg-lib/pulls)
* [Actions](/dompdf/php-svg-lib/actions)
* [Projects](/dompdf/php-svg-lib/projects)
* [Wiki](/dompdf/php-svg-lib/wiki)
* [Security](/dompdf/php-svg-lib/security)
* [Insights](/dompdf/php-svg-lib/pulse)

## Commit

[Permalink](/dompdf/php-svg-lib/commit/88163cbe562d9b391b3a352e54d9c89d02d77ee0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Prevent circular reference in use elements

[Browse files](/dompdf/php-svg-lib/tree/88163cbe562d9b391b3a352e54d9c89d02d77ee0)
Browse the repository at this point in the history

* Loading branch information

[![@bsweeney](https://avatars.githubusercontent.com/u/485897?s=40&v=4)](/bsweeney)

[bsweeney](/dompdf/php-svg-lib/commits?author=bsweeney "View all commits by bsweeney")
committed
Dec 11, 2023

1 parent
[4b43073](/dompdf/php-svg-lib/commit/4b43073f39bffbe2c52a61aebd591461669e3699)

commit 88163cb

Showing
**1 changed file**
with
**20 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

20 changes: 20 additions & 0 deletions

20
[src/Svg/Tag/UseTag.php](#diff-f6b4bcc6c62c47046f7eda961f4e29e8e09cb2215339eb3631d96cdda128e580 "src/Svg/Tag/UseTag.php")

Show comments

[View file](/dompdf/php-svg-lib/blob/88163cbe562d9b391b3a352e54d9c89d02d77ee0/src/Svg/Tag/UseTag.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -14,12 +14,19 @@ class UseTag extends AbstractTag |
|  |  | protected $y = 0; |
|  |  | protected $width; |
|  |  | protected $height; |
|  |  | protected $instances = 0; |
|  |  |  |
|  |  | /\*\* @var AbstractTag \*/ |
|  |  | protected $reference; |
|  |  |  |
|  |  | protected function before($attributes) |
|  |  | { |
|  |  | $this->instances++; |
|  |  | if ($this->instances > 1) { |
|  |  | //TODO: log circular reference error state |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | if (isset($attributes['x'])) { |
|  |  | $this->x = $attributes['x']; |
|  |  | } |
| Expand Down  Expand Up | | @@ -52,6 +59,9 @@ protected function before($attributes) |
|  |  | } |
|  |  |  |
|  |  | protected function after() { |
|  |  | if ($this->instances > 0) { |
|  |  | return; |
|  |  | } |
|  |  | parent::after(); |
|  |  |  |
|  |  | if ($this->reference) { |
| Expand All | | @@ -63,6 +73,11 @@ protected function after() { |
|  |  |  |
|  |  | public function handle($attributes) |
|  |  | { |
|  |  | if ($this->instances > 1) { |
|  |  | //TODO: log circular reference error state |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | parent::handle($attributes); |
|  |  |  |
|  |  | if (!$this->reference) { |
| Expand All | | @@ -87,6 +102,11 @@ public function handle($attributes) |
|  |  |  |
|  |  | public function handleEnd() |
|  |  | { |
|  |  | $this->instances--; |
|  |  | if ($this->instances > 0) { |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | parent::handleEnd(); |
|  |  |  |
|  |  | if (!$this->reference) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `88163cb`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdompdf%2Fphp-svg-lib%2Fcommit%2F88163cbe562d9b391b3a352e54d9c89d02d77ee0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b7c2b58b_20250114_221134.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdompdf%2Fphp-svg-lib%2Fsecurity%2Fadvisories%2FGHSA-ff5x-7qg5-vwf2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdompdf%2Fphp-svg-lib%2Fsecurity%2Fadvisories%2FGHSA-ff5x-7qg5-vwf2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=dompdf%2Fphp-svg-lib)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[dompdf](/dompdf)
/
**[php-svg-lib](/dompdf/php-svg-lib)**
Public

* [Notifications](/login?return_to=%2Fdompdf%2Fphp-svg-lib) You must be signed in to change notification settings
* [Fork
  77](/login?return_to=%2Fdompdf%2Fphp-svg-lib)
* [Star
   1.4k](/login?return_to=%2Fdompdf%2Fphp-svg-lib)

* [Code](/dompdf/php-svg-lib)
* [Issues
  17](/dompdf/php-svg-lib/issues)
* [Pull requests
  0](/dompdf/php-svg-lib/pulls)
* [Actions](/dompdf/php-svg-lib/actions)
* [Projects
  0](/dompdf/php-svg-lib/projects)
* [Wiki](/dompdf/php-svg-lib/wiki)
* [Security](/dompdf/php-svg-lib/security)
* [Insights](/dompdf/php-svg-lib/pulse)

Additional navigation options

* [Code](/dompdf/php-svg-lib)
* [Issues](/dompdf/php-svg-lib/issues)
* [Pull requests](/dompdf/php-svg-lib/pulls)
* [Actions](/dompdf/php-svg-lib/actions)
* [Projects](/dompdf/php-svg-lib/projects)
* [Wiki](/dompdf/php-svg-lib/wiki)
* [Security](/dompdf/php-svg-lib/security)
* [Insights](/dompdf/php-svg-lib/pulse)

# Possible DoS caused by infinite recursion when parsing SVG document

Moderate

[bsweeney](/bsweeney)
published
GHSA-ff5x-7qg5-vwf2
Dec 12, 2023

## Package

composer

phenx/php-svg-lib
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<= 0.5.0

## Patched versions

0.5.1

## Description

### Summary

When parsing the attributes passed to a `use` tag inside an svg document, we can cause the system to go to an infinite recursion. Depending on the system configuration and attack pattern this could exhaust the memory available to the executing process and/or to the server itself.

### Details

Inside `Svg\Tag\UseTag::before`, php-svg-lib parses the attributes passed to an `use` tag inside an svg document. When it finds a `href` or `xlink:href`, it will try to retrieve the object representing this tag:

```
$link = $attributes["href"] ?? $attributes["xlink:href"];
$this->reference = $document->getDef($link);

if ($this->reference) {
    $this->reference->before($attributes);
}

```

`$document->getDef` is implemented as follow:

```
public function getDef($id) {
    $id = ltrim($id, "#");

    return isset($this->defs[$id]) ? $this->defs[$id] : null;
}

```

*Note:* the `$id` in the above method is actually the *link* being used in `use` tag. This part is important, because this behaviour here actually leads to the vulnerability. It will be mentioned later on in this report.

If it finds the referenced object, it will try to call the `before` method on the referenced object (this is still inside `Svg\Tag\UseTag::before`) :

```
if ($this->reference) {
    $this->reference->before($attributes);
}

```

In order to cause an infinte loop, we need to be able to control the `$id` used in the `$this->defs[$id]` code above. This `defs` property (`Svg\Document::defs`) is being populated when `Svg\Document::_tagStart` is called. This is the handler being used when the php-svg-lib is parsing the svg structure:

```
// Svg\Document line 343
if ($tag) {
    if (isset($attributes["id"])) {
        $this->defs[$attributes["id"]] = $tag;
    }
    else {
        // ...
    }

    // ...
}

```

So if the `use` tag contains an `id`, then that `use` tag will be added to the `$defs` array with it's `id` as the key.

Now as noted before, when there is a link inside the `use` tag, the library uses that link as the `id` to actually find the object or `tag` that has been added to the `Svg\Document::defs`.

So if the `id` attribute is equal to the link attribute inside the `use` tag, then the referenced object (in this case it is the `Use` tag object) will be called recursively until the memory given to the script is exhausted.

### PoC

This is an example svg file that can be used to demonstrate the vulnerability.

```
<svg width="200" height="200"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <use id="selfref" xlink:href="#selfref" />
</svg>

```
### Impact

When the lib parses the above payload, it will crash:

```
PHP Fatal error:  Allowed memory size of 536870912 bytes exhausted (tried to allocate 262144 bytes) in /xxx/dompdf/vendor/phenx/php-svg-lib/src/Svg/Tag/UseTag.php on line 37

```

An attacker sending multiple request to a system to render the above payload can potentially cause resource exhaustion to the point that the system is unable to handle incoming request.

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L

### CVE ID

CVE-2023-50251

### Weaknesses

[CWE-674](/advisories?query=cwe%3A674)

### Credits

* [![@cod3beat](https://avatars.githubusercontent.com/u/1164982?s=40&v=4)](/cod3beat)
  [cod3beat](/cod3beat)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


