=== Content from github.com_4ce8b9ce_20250114_192255.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2F721ed974bc44137437b0cdc8454e137fff8db213)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2F721ed974bc44137437b0cdc8454e137fff8db213)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Commit

[Permalink](/yiisoft/yii2-authclient/commit/721ed974bc44137437b0cdc8454e137fff8db213)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-rw54-6826-c8j5](https://github.com/advisories/GHSA-rw54-6826-c8j5 "GHSA-rw54-6826-c8j5")

[Browse files](/yiisoft/yii2-authclient/tree/721ed974bc44137437b0cdc8454e137fff8db213)
Browse the repository at this point in the history

```
* Oauth2 replay attack mitigation for PKCE

* Oauth2 PKCE downgrate attack mitigation

* Updated changelog for [GHSA-rw54-6826-c8j5](https://github.com/advisories/GHSA-rw54-6826-c8j5 "GHSA-rw54-6826-c8j5")
```

* Loading branch information

[![@rhertogh](https://avatars.githubusercontent.com/u/1292337?s=40&v=4)](/rhertogh)

[rhertogh](/yiisoft/yii2-authclient/commits?author=rhertogh "View all commits by rhertogh")
authored
Dec 16, 2023

1 parent
[0d1c388](/yiisoft/yii2-authclient/commit/0d1c3880f4d79e20aa1d77c012650b54e69695ff)

commit 721ed97

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**10 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* src

  + src/OAuth2.php
    [OAuth2.php](#diff-ae39669291a69de8ee6407e8e3914c10e05a931e9075fa3851de7a9867859555)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/yiisoft/yii2-authclient/blob/721ed974bc44137437b0cdc8454e137fff8db213/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -5,7 +5,8 @@ Yii Framework 2 authclient extension Change Log |
|  |  | ------------------------ |
|  |  |  |
|  |  | - Bug #364: Use issuer claim from OpenID Configuration (radwouters) |
|  |  | - Enh: #367: Throw more specific `ClientErrorResponseException` when the response code in `BaseOAuth::sendRequest()` is a 4xx (rhertogh) |
|  |  | - Enh #367: Throw more specific `ClientErrorResponseException` when the response code in `BaseOAuth::sendRequest()` is a 4xx (rhertogh) |
|  |  | - Enh GHSA-rw54-6826-c8j5: Improved security for OAuth2 client by requiring an `authCodeVerifier` if PKCE is enabled and clearing it after usage (rhertogh) |
|  |  |  |
|  |  |  |
|  |  | 2.2.14 November 18, 2022 |
| Expand Down | |  |

9 changes: 8 additions & 1 deletion

9
[src/OAuth2.php](#diff-ae39669291a69de8ee6407e8e3914c10e05a931e9075fa3851de7a9867859555 "src/OAuth2.php")

Show comments

[View file](/yiisoft/yii2-authclient/blob/721ed974bc44137437b0cdc8454e137fff8db213/src/OAuth2.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -131,7 +131,14 @@ public function fetchAccessToken($authCode, array $params = []) |
|  |  | ]; |
|  |  |  |
|  |  | if ($this->enablePkce) { |
|  |  | $defaultParams['code\_verifier'] = $this->getState('authCodeVerifier'); |
|  |  | $authCodeVerifier = $this->getState('authCodeVerifier'); |
|  |  | if (empty($authCodeVerifier)) { |
|  |  | // Prevent PKCE Downgrade Attack |
|  |  | // https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics#name-pkce-downgrade-attack |
|  |  | throw new HttpException(409, 'Invalid auth code verifier.'); |
|  |  | } |
|  |  | $defaultParams['code\_verifier'] = $authCodeVerifier; |
|  |  | $this->removeState('authCodeVerifier'); |
|  |  | } |
|  |  |  |
|  |  | $request = $this->createRequest() |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `721ed97`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fcommit%2F721ed974bc44137437b0cdc8454e137fff8db213) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a94292b0_20250114_192257.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fsecurity%2Fadvisories%2FGHSA-rw54-6826-c8j5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fsecurity%2Fadvisories%2FGHSA-rw54-6826-c8j5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

# The Oauth2 PKCE implementation is vulnerable

Moderate

[samdark](/samdark)
published
GHSA-rw54-6826-c8j5
Dec 16, 2023

## Package

composer

yiisoft/yii2-authclient
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

<=2.2.14

## Patched versions

2.2.15

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

Original Report:

> The Oauth2 PKCE implementation is vulnerable in 2 ways:
>
> 1. The `authCodeVerifier` should be removed after usage (similar to 'authState')
> 2. There is a risk for a "downgrade attack" if PKCE is being relied on for CSRF protection.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

TBD

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

not known yet.

### References

*Are there any links users can visit to find out more?*

### Severity

Moderate

6.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:N

### CVE ID

CVE-2023-50714

### Weaknesses

No CWEs

### Credits

* [![@rhertogh](https://avatars.githubusercontent.com/u/1292337?s=40&v=4)](/rhertogh)
  [rhertogh](/rhertogh)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_322baf71_20250114_192253.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOpenIdConnect.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOpenIdConnect.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Files

 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OpenIdConnect.php

Copy path Blame  Blame
## Latest commit

## History

[History](/yiisoft/yii2-authclient/commits/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OpenIdConnect.php)536 lines (492 loc) · 18.9 KB 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OpenIdConnect.php

Top
## File metadata and controls

* Code
* Blame

536 lines (492 loc) · 18.9 KB[Raw](https://github.com/yiisoft/yii2-authclient/raw/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OpenIdConnect.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536<?php/\*\* \* @link https://www.yiiframework.com/ \* @copyright Copyright (c) 2008 Yii Software LLC \* @license https://www.yiiframework.com/license/ \*/
namespace yii\authclient;
use Jose\Component\Core\AlgorithmManager;use Jose\Component\Checker\AlgorithmChecker;use Jose\Component\Checker\HeaderCheckerManager;use Jose\Component\KeyManagement\JWKFactory;use Jose\Component\Signature\JWSLoader;use Jose\Component\Signature\JWSTokenSupport;use Jose\Component\Signature\JWSVerifier;use Jose\Component\Signature\Serializer\CompactSerializer;use Jose\Component\Signature\Serializer\JWSSerializerManager;use Yii;use yii\authclient\signature\HmacSha;use yii\base\InvalidConfigException;use yii\caching\Cache;use yii\di\Instance;use yii\helpers\Json;use yii\helpers\StringHelper;use yii\web\HttpException;
/\*\* \* OpenIdConnect serves as a client for the OpenIdConnect flow. \* \* Application configuration example: \* \* ```php \* 'components' => [ \* 'authClientCollection' => [ \* 'class' => 'yii\authclient\Collection', \* 'clients' => [ \* 'google' => [ \* 'class' => 'yii\authclient\OpenIdConnect', \* 'issuerUrl' => 'https://accounts.google.com', \* 'clientId' => 'google\_client\_id', \* 'clientSecret' => 'google\_client\_secret', \* 'name' => 'google', \* 'title' => 'Google OpenID Connect', \* ], \* ], \* ] \* // ... \* ] \* ``` \* \* This class requires `web-token/jwt-checker`,`web-token/jwt-key-mgmt`, `web-token/jwt-signature`, `web-token/jwt-signature-algorithm-hmac`, \* `web-token/jwt-signature-algorithm-ecdsa` and `web-token/jwt-signature-algorithm-rsa` libraries to be installed for \* JWS verification. This can be done via composer: \* \* ``` \* composer require --prefer-dist "web-token/jwt-checker:>=1.0 <3.0" "web-token/jwt-signature:>=1.0 <3.0" \* "web-token/jwt-signature:>=1.0 <3.0" "web-token/jwt-signature-algorithm-hmac:>=1.0 <3.0" \* "web-token/jwt-signature-algorithm-ecdsa:>=1.0 <3.0" "web-token/jwt-signature-algorithm-rsa:>=1.0 <3.0" \* ``` \* \* Note: if you are using well-trusted OpenIdConnect provider, you may disable [[validateJws]], making installation of \* `web-token` library redundant, however it is not recommended as it violates the protocol specification. \* \* @see https://openid.net/connect/ \* @see OAuth2 \* \* @property Cache|null $cache The cache object, `null` - if not enabled. Note that the type of this property \* differs in getter and setter. See [[getCache()]] and [[setCache()]] for details. \* @property array $configParams OpenID provider configuration parameters. \* @property bool $validateAuthNonce Whether to use and validate auth 'nonce' parameter in authentication \* flow. \* \* @author Paul Klimov <klimov.paul@gmail.com> \* @since 2.1.3 \*/class OpenIdConnect extends OAuth2{ /\*\* \* @var array Predefined OpenID Connect Claims \* @see https://openid.net/specs/openid-connect-core-1\_0.html#rfc.section.2 \* @since 2.2.12 \*/ public $defaultIdTokenClaims = [ 'iss', // Issuer Identifier for the Issuer of the response. 'sub', // Subject Identifier. 'aud', // Audience(s) that this ID Token is intended for. 'exp', // Expiration time on or after which the ID Token MUST NOT be accepted for processing. 'iat', // Time at which the JWT was issued. 'auth\_time', // Time when the End-User authentication occurred. 'nonce', // String value used to associate a Client session with an ID Token, and to mitigate replay attacks. 'acr', // Authentication Context Class Reference. 'amr', // Authentication Methods References. 'azp', // Authorized party - the party to which the ID Token was issued. ]; /\*\* \* {@inheritdoc} \*/ public $scope = 'openid'; /\*\* \* @var string OpenID Issuer (provider) base URL, e.g. `https://example.com`. \*/ public $issuerUrl; /\*\* \* @var bool whether to validate/decrypt JWS received with Auth token. \* Note: this functionality requires `web-token/jwt-checker`, `web-token/jwt-key-mgmt`, `web-token/jwt-signature` \* composer package to be installed. You can disable this option in case of usage of trusted OpenIDConnect provider, \* however this violates the protocol rules, so you are doing it on your own risk. \*/ public $validateJws = true; /\*\* \* @var array JWS algorithms, which are allowed to be used. \* These are used by `web-token` library for JWS validation/decryption. \* Make sure to install `web-token/jwt-signature-algorithm-hmac`, `web-token/jwt-signature-algorithm-ecdsa` \* and `web-token/jwt-signature-algorithm-rsa` packages that support the particular algorithm before adding it here. \*/ public $allowedJwsAlgorithms = [ 'HS256', 'HS384', 'HS512', 'ES256', 'ES384', 'ES512', 'RS256', 'RS384', 'RS512', 'PS256', 'PS384', 'PS512' ]; /\*\* \* @var string the prefix for the key used to store [[configParams]] data in cache. \* Actual cache key will be formed addition [[id]] value to it. \* @see cache \*/ public $configParamsCacheKeyPrefix = 'config-params-';
 /\*\* \* @var bool|null whether to use and validate auth 'nonce' parameter in authentication flow. \* The option is used for preventing replay attacks. \*/ private $\_validateAuthNonce; /\*\* \* @var array OpenID provider configuration parameters. \*/ private $\_configParams; /\*\* \* @var Cache|string the cache object or the ID of the cache application component that \* is used for caching. This can be one of the following: \* \* - an application component ID (e.g. `cache`) \* - a configuration array \* - a [[\yii\caching\Cache]] object \* \* When this is not set, it means caching is not enabled. \*/ private $\_cache = 'cache'; /\*\* \* @var JWSLoader JSON Web Signature \*/ private $\_jwsLoader; /\*\* \* @var JWKSet Key Set \*/ private $\_jwkSet;
 /\*\* \* @return bool whether to use and validate auth 'nonce' parameter in authentication flow. \*/ public function getValidateAuthNonce() { if ($this->\_validateAuthNonce === null) { $this->\_validateAuthNonce = $this->validateJws && in\_array('nonce', $this->getConfigParam('claims\_supported')); } return $this->\_validateAuthNonce; }
 /\*\* \* @param bool $validateAuthNonce whether to use and validate auth 'nonce' parameter in authentication flow. \*/ public function setValidateAuthNonce($validateAuthNonce) { $this->\_validateAuthNonce = $validateAuthNonce; }
 /\*\* \* @return Cache|null the cache object, `null` - if not enabled. \*/ public function getCache() { if ($this->\_cache !== null && !is\_object($this->\_cache)) { $this->\_cache = Instance::ensure($this->\_cache, Cache::className()); } return $this->\_cache; }
 /\*\* \* Sets up a component to be used for caching. \* This can be one of the following: \* \* - an application component ID (e.g. `cache`) \* - a configuration array \* - a [[\yii\caching\Cache]] object \* \* When `null` is passed, it means caching is not enabled. \* @param Cache|array|string|null $cache the cache object or the ID of the cache application component. \*/ public function setCache($cache) { $this->\_cache = $cache; }
 /\*\* \* @return array OpenID provider configuration parameters. \*/ public function getConfigParams() { if ($this->\_configParams === null) { $cache = $this->getCache(); $cacheKey = $this->configParamsCacheKeyPrefix . $this->getId(); if ($cache === null || ($configParams = $cache->get($cacheKey)) === false) { $configParams = $this->discoverConfig(); }
 $this->\_configParams = $configParams;
 if ($cache !== null) { $cache->set($cacheKey, $configParams); } } return $this->\_configParams; }
 /\*\* \* Returns particular configuration parameter value. \* @param string $name configuration parameter name. \* @param mixed $default value to be returned if the configuration parameter isn't set. \* @return mixed configuration parameter value. \*/ public function getConfigParam($name, $default = null) { $params = $this->getConfigParams(); return array\_key\_exists($name, $params) ? $params[$name] : $default; }
 /\*\* \* Discovers OpenID Provider configuration parameters. \* @return array OpenID Provider configuration parameters. \* @throws InvalidResponseException on failure. \*/ protected function discoverConfig() { $request = $this->createRequest(); $configUrl = rtrim($this->issuerUrl, '/') . '/.well-known/openid-configuration'; $request->setMethod('GET') ->setUrl($configUrl); $response = $this->sendRequest($request); return $response; }
 /\*\* \* Set the OpenID provider configuration manually, this will bypass the automatic discovery via \* the /.well-known/openid-configuration endpoint. \* @param array $configParams OpenID provider configuration parameters. \* @since 2.2.12 \*/ public function setConfigParams($configParams) { $this->\_configParams = $configParams; }
 /\*\* \* {@inheritdoc} \*/ public function buildAuthUrl(array $params = []) { if ($this->authUrl === null) { $this->authUrl = $this->getConfigParam('authorization\_endpoint'); }
 if (!isset($params['nonce']) && $this->getValidateAuthNonce()) { $nonce = $this->generateAuthNonce(); $this->setState('authNonce', $nonce); $params['nonce'] = $nonce; }
 return parent::buildAuthUrl($params); }
 /\*\* \* {@inheritdoc} \*/ public function fetchAccessToken($authCode, array $params = []) { if ($this->tokenUrl === null) { $this->tokenUrl = $this->getConfigParam('token\_endpoint'); }
 if (!isset($params['nonce']) && $this->getValidateAuthNonce()) { $params['nonce'] = $this->getState('authNonce'); }
 return parent::fetchAccessToken($authCode, $params); }
 /\*\* \* {@inheritdoc} \*/ public function refreshAccessToken(OAuthToken $token) { if ($this->tokenUrl === null) { $this->tokenUrl = $this->getConfigParam('token\_endpoint'); }
 if ($this->getValidateAuthNonce()) { $nonce = $this->generateAuthNonce(); $this->setState('authNonce', $nonce); $token->setParam('nonce', $nonce); }
 return parent::refreshAccessToken($token); }
 /\*\* \* {@inheritdoc} \*/ protected function initUserAttributes() { // Use 'userinfo\_endpoint' config if available, // try to extract user claims from access token's 'id\_token' claim otherwise.
 $userinfoEndpoint = $this->getConfigParam('userinfo\_endpoint'); if (!empty($userinfoEndpoint)) { $userInfo = $this->api($userinfoEndpoint, 'GET'); // The userinfo endpoint can return a JSON object (which will be converted to an array) or a JWT. if (is\_array($userInfo)) { return $userInfo; } else { // Use the userInfo endpoint as id\_token and parse it as JWT below $idToken = $userInfo; } } else { $accessToken = $this->accessToken; $idToken = $accessToken->getParam('id\_token'); }
 $idTokenData = []; if (!empty($idToken)) { if ($this->validateJws) { $idTokenClaims = $this->loadJws($idToken); } else { $idTokenClaims = Json::decode(StringHelper::base64UrlDecode(explode('.', $idToken)[1])); } $metaDataFields = array\_flip($this->defaultIdTokenClaims); unset($metaDataFields['sub']); // "Subject Identifier" is not meta data $idTokenData = array\_diff\_key($idTokenClaims, $metaDataFields); }
 return $idTokenData; }
 /\*\* \* {@inheritdoc} \*/ public function applyAccessTokenToRequest($request, $accessToken) { // OpenID Connect requires bearer token auth for the user info endpoint $request->getHeaders()->set('Authorization', 'Bearer ' . $accessToken->getToken()); }
 /\*\* \* {@inheritdoc} \*/ protected function applyClientCredentialsToRequest($request) { $supportedAuthMethods = $this->getConfigParam('token\_endpoint\_auth\_methods\_supported', 'client\_secret\_basic');
 if (in\_array('client\_secret\_basic', $supportedAuthMethods)) { $request->addHeaders([ 'Authorization' => 'Basic ' . base64\_encode($this->clientId . ':' . $this->clientSecret) ]); } elseif (in\_array('client\_secret\_post', $supportedAuthMethods)) { $request->addData([ 'client\_id' => $this->clientId, 'client\_secret' => $this->clientSecret, ]); } elseif (in\_array('client\_secret\_jwt', $supportedAuthMethods)) { $header = [ 'typ' => 'JWT', 'alg' => 'HS256', ]; $payload = [ 'iss' => $this->clientId, 'sub' => $this->clientId, 'aud' => $this->tokenUrl, 'jti' => $this->generateAuthNonce(), 'iat' => time(), 'exp' => time() + 3600, ];
 $signatureBaseString = base64\_encode(Json::encode($header)) . '.' . base64\_encode(Json::encode($payload)); $signatureMethod = new HmacSha(['algorithm' => 'sha256']); $signature = $signatureMethod->generateSignature($signatureBaseString, $this->clientSecret);
 $assertion = $signatureBaseString . '.' . $signature;
 $request->addData([ 'assertion' => $assertion, ]); } else { throw new InvalidConfigException('Unable to authenticate request: none of following auth methods is suported: ' . implode(', ', $supportedAuthMethods)); } }
 /\*\* \* {@inheritdoc} \*/ protected function createToken(array $tokenConfig = []) { if ($this->validateJws) { $jwsData = $this->loadJws($tokenConfig['params']['id\_token']); $this->validateClaims($jwsData); $tokenConfig['params'] = array\_merge($tokenConfig['params'], $jwsData);
 if ($this->getValidateAuthNonce()) { $authNonce = $this->getState('authNonce'); if (!isset($jwsData['nonce']) || empty($authNonce) || strcmp($jwsData['nonce'], $authNonce) !== 0) { throw new HttpException(400, 'Invalid auth nonce'); } else { $this->removeState('authNonce'); } } }
 return parent::createToken($tokenConfig); }
 /\*\* \* Return JwkSet, returning related data. \* @return JWKSet object represents a key set. \* @throws InvalidResponseException on failure. \*/ protected function getJwkSet() { if ($this->\_jwkSet === null) { $cache = $this->getCache(); $cacheKey = $this->configParamsCacheKeyPrefix . '\_jwkSet'; if ($cache === null || ($jwkSet = $cache->get($cacheKey)) === false) { $request = $this->createRequest() ->setMethod('GET') ->setUrl($this->getConfigParam('jwks\_uri')); $response = $this->sendRequest($request); $jwkSet = JWKFactory::createFromValues($response); }
 $this->\_jwkSet = $jwkSet;
 if ($cache !== null) { $cache->set($cacheKey, $jwkSet); } } return $this->\_jwkSet; }
 /\*\* \* Return JWSLoader that validate the JWS token. \* @return JWSLoader to do token validation. \* @throws InvalidConfigException on invalid algorithm provide in configuration. \*/ protected function getJwsLoader() { if ($this->\_jwsLoader === null) { $algorithms = []; foreach ($this->allowedJwsAlgorithms as $algorithm) { $class = '\Jose\Component\Signature\Algorithm\\' . $algorithm; if (!class\_exists($class)) { throw new InvalidConfigException("Alogrithm class $class doesn't exist"); } $algorithms[] = new $class(); } $this->\_jwsLoader = new JWSLoader( new JWSSerializerManager([ new CompactSerializer() ]), new JWSVerifier(new AlgorithmManager($algorithms)), new HeaderCheckerManager( [ new AlgorithmChecker($this->allowedJwsAlgorithms) ], [ new JWSTokenSupport() ] ) ); } return $this->\_jwsLoader; }
 /\*\* \* Decrypts/validates JWS, returning related data. \* @param string $jws raw JWS input. \* @return array JWS underlying data. \* @throws HttpException on invalid JWS signature. \*/ protected function loadJws($jws) { try { $jwsLoader = $this->getJwsLoader(); $signature = null; $jwsVerified = $jwsLoader->loadAndVerifyWithKeySet($jws, $this->getJwkSet(), $signature); return Json::decode($jwsVerified->getPayload()); } catch (\Exception $e) { $message = YII\_DEBUG ? 'Unable to verify JWS: ' . $e->getMessage() : 'Invalid JWS'; throw new HttpException(400, $message, $e->getCode(), $e); } }
 /\*\* \* Validates the claims data received from OpenID provider. \* @param array $claims claims data. \* @throws HttpException on invalid claims. \* @since 2.2.3 \*/ protected function validateClaims(array $claims) { $expectedIssuer = $this->getConfigParam('issuer', $this->issuerUrl); if (!isset($claims['iss']) || (strcmp(rtrim($claims['iss'], '/'), rtrim($expectedIssuer, '/')) !== 0)) { throw new HttpException(400, 'Invalid "iss"'); } if (!isset($claims['aud']) || (!is\_string($claims['aud']) && !is\_array($claims['aud'])) || (is\_string($claims['aud']) && strcmp($claims['aud'], $this->clientId) !== 0) || (is\_array($claims['aud']) && !in\_array($this->clientId, $claims['aud'])) ) { throw new HttpException(400, 'Invalid "aud"'); } }
 /\*\* \* Generates the auth nonce value. \* @return string auth nonce value. \*/ protected function generateAuthNonce() { return Yii::$app->security->generateRandomString(); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9527cd7f_20250114_192249.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth2.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth2.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a09b4f99_20250114_192248.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth1.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fyiisoft%2Fyii2-authclient%2Fblob%2F0d1c3880f4d79e20aa1d77c012650b54e69695ff%2Fsrc%2FOAuth1.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=yiisoft%2Fyii2-authclient)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[yiisoft](/yiisoft)
/
**[yii2-authclient](/yiisoft/yii2-authclient)**
Public

* [Notifications](/login?return_to=%2Fyiisoft%2Fyii2-authclient) You must be signed in to change notification settings
* [Fork
  245](/login?return_to=%2Fyiisoft%2Fyii2-authclient)
* [Star
   461](/login?return_to=%2Fyiisoft%2Fyii2-authclient)

* [Code](/yiisoft/yii2-authclient)
* [Issues
  17](/yiisoft/yii2-authclient/issues)
* [Pull requests
  3](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

Additional navigation options

* [Code](/yiisoft/yii2-authclient)
* [Issues](/yiisoft/yii2-authclient/issues)
* [Pull requests](/yiisoft/yii2-authclient/pulls)
* [Actions](/yiisoft/yii2-authclient/actions)
* [Security](/yiisoft/yii2-authclient/security)
* [Insights](/yiisoft/yii2-authclient/pulse)

## Files

 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth1.php

Copy path Blame  Blame
## Latest commit

## History

[History](/yiisoft/yii2-authclient/commits/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth1.php)405 lines (354 loc) · 12.6 KB 0d1c388
## Breadcrumbs

1. [yii2-authclient](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff)
2. /[src](/yiisoft/yii2-authclient/tree/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src)
/
# OAuth1.php

Top
## File metadata and controls

* Code
* Blame

405 lines (354 loc) · 12.6 KB[Raw](https://github.com/yiisoft/yii2-authclient/raw/0d1c3880f4d79e20aa1d77c012650b54e69695ff/src/OAuth1.php)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405<?php/\*\* \* @link https://www.yiiframework.com/ \* @copyright Copyright (c) 2008 Yii Software LLC \* @license https://www.yiiframework.com/license/ \*/
namespace yii\authclient;
use Yii;use yii\base\InvalidParamException;use yii\httpclient\Request;use yii\web\HttpException;
/\*\* \* OAuth1 serves as a client for the OAuth 1/1.0a flow. \* \* In order to acquire access token perform following sequence: \* \* ```php \* use yii\authclient\OAuth1; \* use Yii; \* \* // assuming class MyAuthClient extends OAuth1 \* $oauthClient = new MyAuthClient(); \* $requestToken = $oauthClient->fetchRequestToken(); // Get request token \* $url = $oauthClient->buildAuthUrl($requestToken); // Get authorization URL \* return Yii::$app->getResponse()->redirect($url); // Redirect to authorization URL \* \* // After user returns at our site: \* $accessToken = $oauthClient->fetchAccessToken(Yii::$app->request->get('oauth\_token'), $requestToken); // Upgrade to access token \* ``` \* \* @see https://oauth.net/1/ \* https://tools.ietf.org/html/rfc5849 \* \* @author Paul Klimov <klimov.paul@gmail.com> \* @since 2.0 \*/abstract class OAuth1 extends BaseOAuth{ /\*\* \* @var string protocol version. \*/ public $version = '1.0'; /\*\* \* @var string OAuth consumer key. \*/ public $consumerKey; /\*\* \* @var string OAuth consumer secret. \*/ public $consumerSecret; /\*\* \* @var string OAuth request token URL. \*/ public $requestTokenUrl; /\*\* \* @var string request token HTTP method. \*/ public $requestTokenMethod = 'GET'; /\*\* \* @var string OAuth access token URL. \*/ public $accessTokenUrl; /\*\* \* @var string access token HTTP method. \*/ public $accessTokenMethod = 'GET'; /\*\* \* @var array|null list of the request methods, which require adding 'Authorization' header. \* By default only POST requests will have 'Authorization' header. \* You may set this option to `null` in order to make all requests to use 'Authorization' header. \* @since 2.1.1 \*/ public $authorizationHeaderMethods = ['POST'];
 /\*\* \* Fetches the OAuth request token. \* @param array $params additional request params. \* @return OAuthToken request token. \*/ public function fetchRequestToken(array $params = []) { $this->setAccessToken(null); $defaultParams = [ 'oauth\_consumer\_key' => $this->consumerKey, 'oauth\_callback' => $this->getReturnUrl(), //'xoauth\_displayname' => Yii::$app->name, ]; if (!empty($this->scope)) { $defaultParams['scope'] = $this->scope; }
 $request = $this->createRequest() ->setMethod($this->requestTokenMethod) ->setUrl($this->requestTokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->signRequest($request);
 $response = $this->sendRequest($request);
 $token = $this->createToken([ 'params' => $response ]); $this->setState('requestToken', $token);
 return $token; }
 /\*\* \* Composes user authorization URL. \* @param OAuthToken $requestToken OAuth request token. \* @param array $params additional request params. \* @return string authorize URL \* @throws InvalidParamException on failure. \*/ public function buildAuthUrl(OAuthToken $requestToken = null, array $params = []) { if (!is\_object($requestToken)) { $requestToken = $this->getState('requestToken'); if (!is\_object($requestToken)) { throw new InvalidParamException('Request token is required to build authorize URL!'); } } $params['oauth\_token'] = $requestToken->getToken();
 return $this->composeUrl($this->authUrl, $params); }
 /\*\* \* Fetches OAuth access token. \* @param string $oauthToken OAuth token returned with redirection back to client. \* @param OAuthToken $requestToken OAuth request token. \* @param string $oauthVerifier OAuth verifier. \* @param array $params additional request params. \* @return OAuthToken OAuth access token. \* @throws InvalidParamException on failure. \* @throws HttpException in case oauth token miss-matches request token. \*/ public function fetchAccessToken($oauthToken = null, OAuthToken $requestToken = null, $oauthVerifier = null, array $params = []) { $incomingRequest = Yii::$app->getRequest();
 if ($oauthToken === null) { $oauthToken = $incomingRequest->get('oauth\_token', $incomingRequest->post('oauth\_token', $oauthToken)); }
 if (!is\_object($requestToken)) { $requestToken = $this->getState('requestToken'); if (!is\_object($requestToken)) { throw new InvalidParamException('Request token is required to fetch access token!'); } }
 if (strcmp($requestToken->getToken(), $oauthToken) !== 0) { throw new HttpException(400, 'Invalid auth state parameter.'); }
 $this->removeState('requestToken');
 $defaultParams = [ 'oauth\_consumer\_key' => $this->consumerKey, 'oauth\_token' => $requestToken->getToken() ]; if ($oauthVerifier === null) { $oauthVerifier = $incomingRequest->get('oauth\_verifier', $incomingRequest->post('oauth\_verifier')); } if (!empty($oauthVerifier)) { $defaultParams['oauth\_verifier'] = $oauthVerifier; }
 $request = $this->createRequest() ->setMethod($this->accessTokenMethod) ->setUrl($this->accessTokenUrl) ->setData(array\_merge($defaultParams, $params));
 $this->signRequest($request, $requestToken);
 $response = $this->sendRequest($request);
 $token = $this->createToken([ 'params' => $response ]); $this->setAccessToken($token);
 return $token; }
 /\*\* \* {@inheritdoc} \*/ public function createRequest() { $request = parent::createRequest(); $request->on(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']); return $request; }
 /\*\* \* {@inheritdoc} \*/ public function createApiRequest() { $request = parent::createApiRequest();
 // ensure correct event handlers order : $request->off(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']); $request->on(Request::EVENT\_BEFORE\_SEND, [$this, 'beforeRequestSend']);
 return $request; }
 /\*\* \* Handles [[Request::EVENT\_BEFORE\_SEND]] event. \* Ensures every request has been signed up before sending. \* @param \yii\httpclient\RequestEvent $event event instance. \* @since 2.1 \*/ public function beforeRequestSend($event) { $this->signRequest($event->request); }
 /\*\* \* {@inheritdoc} \*/ public function applyAccessTokenToRequest($request, $accessToken) { $data = $request->getData(); $data['oauth\_consumer\_key'] = $this->consumerKey; $data['oauth\_token'] = $accessToken->getToken(); $request->setData($data); }
 /\*\* \* Gets new auth token to replace expired one. \* @param OAuthToken $token expired auth token. \* @return OAuthToken new auth token. \*/ public function refreshAccessToken(OAuthToken $token) { // @todo return null; }
 /\*\* \* Generates nonce value. \* @return string nonce value. \*/ protected function generateNonce() { return md5(microtime() . random\_int(0, PHP\_INT\_MAX)); }
 /\*\* \* Generates timestamp. \* @return int timestamp. \*/ protected function generateTimestamp() { return time(); }
 /\*\* \* Generate common request params like version, timestamp etc. \* @return array common request params. \*/ protected function generateCommonRequestParams() { $params = [ 'oauth\_version' => $this->version, 'oauth\_nonce' => $this->generateNonce(), 'oauth\_timestamp' => $this->generateTimestamp(), ];
 return $params; }
 /\*\* \* Sign given request with [[signatureMethod]]. \* @param \yii\httpclient\Request $request request instance. \* @param OAuthToken|null $token OAuth token to be used for signature, if not set [[accessToken]] will be used. \* @since 2.1 this method is public. \*/ public function signRequest($request, $token = null) { $params = $request->getData();
 if (isset($params['oauth\_signature\_method']) || $request->hasHeaders() && $request->getHeaders()->has('authorization')) { // avoid double sign of request return; }
 if (empty($params)) { $params = $this->generateCommonRequestParams(); } else { $params = array\_merge($this->generateCommonRequestParams(), $params); }
 $url = $request->getFullUrl();
 $signatureMethod = $this->getSignatureMethod();
 $params['oauth\_signature\_method'] = $signatureMethod->getName(); $signatureBaseString = $this->composeSignatureBaseString($request->getMethod(), $url, $params); $signatureKey = $this->composeSignatureKey($token); $params['oauth\_signature'] = $signatureMethod->generateSignature($signatureBaseString, $signatureKey);
 if ($this->authorizationHeaderMethods === null || in\_array(strtoupper($request->getMethod()), array\_map('strtoupper', $this->authorizationHeaderMethods), true)) { $authorizationHeader = $this->composeAuthorizationHeader($params); if (!empty($authorizationHeader)) { $request->addHeaders($authorizationHeader);
 // removing authorization header params, avoiding duplicate param server error : foreach ($params as $key => $value) { if (substr\_compare($key, 'oauth', 0, 5) === 0) { unset($params[$key]); } } } }
 $request->setData($params); }
 /\*\* \* Creates signature base string, which will be signed by [[signatureMethod]]. \* @param string $method request method. \* @param string $url request URL. \* @param array $params request params. \* @return string base signature string. \*/ protected function composeSignatureBaseString($method, $url, array $params) { if (strpos($url, '?') !== false) { list($url, $queryString) = explode('?', $url, 2); parse\_str($queryString, $urlParams); $params = array\_merge($urlParams, $params); } unset($params['oauth\_signature']); uksort($params, 'strcmp'); // Parameters are sorted by name, using lexicographical byte value ordering. Ref: Spec: 9.1.1 $parts = [ strtoupper($method), $url, http\_build\_query($params, '', '&', PHP\_QUERY\_RFC3986) ]; $parts = array\_map('rawurlencode', $parts);
 return implode('&', $parts); }
 /\*\* \* Composes request signature key. \* @param OAuthToken|null $token OAuth token to be used for signature key. \* @return string signature key. \*/ protected function composeSignatureKey($token = null) { $signatureKeyParts = [ $this->consumerSecret ];
 if ($token === null) { $token = $this->getAccessToken(); } if (is\_object($token)) { $signatureKeyParts[] = $token->getTokenSecret(); } else { $signatureKeyParts[] = ''; }
 $signatureKeyParts = array\_map('rawurlencode', $signatureKeyParts);
 return implode('&', $signatureKeyParts); }
 /\*\* \* Composes authorization header. \* @param array $params request params. \* @param string $realm authorization realm. \* @return array authorization header in format: [name => content]. \*/ protected function composeAuthorizationHeader(array $params, $realm = '') { $header = 'OAuth'; $headerParams = []; if (!empty($realm)) { $headerParams[] = 'realm="' . rawurlencode($realm) . '"'; } foreach ($params as $key => $value) { if (substr\_compare($key, 'oauth', 0, 5)) { continue; } $headerParams[] = rawurlencode($key) . '="' . rawurlencode($value) . '"'; } if (!empty($headerParams)) { $header .= ' ' . implode(', ', $headerParams); }
 return ['Authorization' => $header]; }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


