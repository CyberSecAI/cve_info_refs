=== Content from www.mozilla.org_ce722dd0_20250114_193333.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-05

## Security Vulnerabilities fixed in Firefox 110

Announced
February 14, 2023
Impact
high
Products
Firefox
Fixed in

* Firefox 110

#### [#CVE-2023-25728: Content security policy leak in violation reports using iframes](#CVE-2023-25728)

Reporter
Johan Carlsson
Impact
high
##### Description

The `Content-Security-Policy-Report-Only` header could allow an attacker to leak a child iframe's unredacted URI when interaction with that iframe triggers a redirect.

##### References

* [Bug 1790345](https://bugzilla.mozilla.org/show_bug.cgi?id=1790345)

#### [#CVE-2023-25730: Screen hijack via browser fullscreen mode](#CVE-2023-25730)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A background script invoking `requestFullscreen` and then blocking the main thread could force the browser into fullscreen mode indefinitely, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1794622](https://bugzilla.mozilla.org/show_bug.cgi?id=1794622)

#### [#CVE-2023-25743: Fullscreen notification not shown in Firefox Focus](#CVE-2023-25743)

Reporter
Hafiizh
Impact
high
##### Description

A lack of in app notification for entering fullscreen mode could have lead to a malicious website spoofing browser chrome.
*This bug only affects Firefox Focus. Other versions of Firefox are unaffected.*

##### References

* [Bug 1800203](https://bugzilla.mozilla.org/show_bug.cgi?id=1800203)

#### [#CVE-2023-0767: Arbitrary memory write via PKCS 12 in NSS](#CVE-2023-0767)

Reporter
Christian Holler
Impact
high
##### Description

An attacker could construct a PKCS 12 cert bundle in such a way that could allow for arbitrary memory writes via PKCS 12 Safe Bag attributes being mishandled.

##### References

* [Bug 1804640](https://bugzilla.mozilla.org/show_bug.cgi?id=1804640)

#### [#CVE-2023-25735: Potential use-after-free from compartment mismatch in SpiderMonkey](#CVE-2023-25735)

Reporter
Samuel Groß
Impact
high
##### Description

Cross-compartment wrappers wrapping a scripted proxy could have caused objects from other compartments to be stored in the main compartment resulting in a use-after-free after unwrapping the proxy.

##### References

* [Bug 1810711](https://bugzilla.mozilla.org/show_bug.cgi?id=1810711)

#### [#CVE-2023-25737: Invalid downcast in SVGUtils::SetupStrokeGeometry](#CVE-2023-25737)

Reporter
Lukas Bernhard
Impact
high
##### Description

An invalid downcast from `nsTextNode` to `SVGElement` could have lead to undefined behavior.

##### References

* [Bug 1811464](https://bugzilla.mozilla.org/show_bug.cgi?id=1811464)

#### [#CVE-2023-25738: Printing on Windows could potentially crash Firefox with some device drivers](#CVE-2023-25738)

Reporter
Mark
Impact
high
##### Description

Members of the `DEVMODEW` struct set by the printer device driver weren't being validated and could have resulted in invalid values which in turn would cause the browser to attempt out of bounds access to related variables.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1811852](https://bugzilla.mozilla.org/show_bug.cgi?id=1811852)

#### [#CVE-2023-25739: Use-after-free in mozilla::dom::ScriptLoadContext::~ScriptLoadContext](#CVE-2023-25739)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

Module load requests that failed were not being checked as to whether or not they were cancelled causing a use-after-free in `ScriptLoadContext`.

##### References

* [Bug 1811939](https://bugzilla.mozilla.org/show_bug.cgi?id=1811939)

#### [#CVE-2023-25729: Extensions could have opened external schemes without user knowledge](#CVE-2023-25729)

Reporter
Vitor Torres
Impact
moderate
##### Description

Permission prompts for opening external schemes were only shown for `ContentPrincipals` resulting in extensions being able to open them without user interaction via `ExpandedPrincipals`. This could lead to further malicious actions such as downloading files or interacting with software already installed on the system.

##### References

* [Bug 1792138](https://bugzilla.mozilla.org/show_bug.cgi?id=1792138)

#### [#CVE-2023-25732: Out of bounds memory write from EncodeInputStream](#CVE-2023-25732)

Reporter
Ronald Crane
Impact
moderate
##### Description

When encoding data from an `inputStream` in `xpcom` the size of the input being encoded was not correctly calculated potentially leading to an out of bounds memory write.

##### References

* [Bug 1804564](https://bugzilla.mozilla.org/show_bug.cgi?id=1804564)

#### [#CVE-2023-25734: Opening local .url files could cause unexpected network loads](#CVE-2023-25734)

Reporter
Ameen Basha M K and Shaheen Fazim
Impact
moderate
##### Description

After downloading a Windows `.url` shortcut from the local filesystem, an attacker could supply a remote path that would lead to unexpected network requests from the operating system. This also had the potential to leak NTLM credentials to the resource.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1809923](https://bugzilla.mozilla.org/show_bug.cgi?id=1809923)
* [Bug 1784451](https://bugzilla.mozilla.org/show_bug.cgi?id=1784451)
* [Bug 1810143](https://bugzilla.mozilla.org/show_bug.cgi?id=1810143)
* [Bug 1812338](https://bugzilla.mozilla.org/show_bug.cgi?id=1812338)

#### [#CVE-2023-25740: Opening local .scf files could cause unexpected network loads](#CVE-2023-25740)

Reporter
Axel Chong (@Haxatron)
Impact
moderate
##### Description

After downloading a Windows `.scf` script from the local filesystem, an attacker could supply a remote path that would lead to unexpected network requests from the operating system. This also had the potential to leak NTLM credentials to the resource.
*This bug only affects Firefox for Windows. Other operating systems are unaffected.*

##### References

* [Bug 1812354](https://bugzilla.mozilla.org/show_bug.cgi?id=1812354)

#### [#CVE-2023-25731: Prototype pollution when rendering URLPreview](#CVE-2023-25731)

Reporter
pyakovlev & Alexander Volkov
Impact
low
##### Description

Due to URL previews in the network panel of developer tools improperly storing URLs, query parameters could potentially be used to overwrite global objects in privileged code.

##### References

* [Bug 1801542](https://bugzilla.mozilla.org/show_bug.cgi?id=1801542)

#### [#CVE-2023-25733: Possible null pointer dereference in TaskbarPreviewCallback](#CVE-2023-25733)

Reporter
Ronald Crane
Impact
low
##### Description

The return value from `gfx::SourceSurfaceSkia::Map()` wasn't being verified which could have potentially lead to a null pointer dereference.

##### References

* [Bug 1808632](https://bugzilla.mozilla.org/show_bug.cgi?id=1808632)

#### [#CVE-2023-25736: Invalid downcast in GetTableSelectionMode](#CVE-2023-25736)

Reporter
Lukas Bernhard
Impact
low
##### Description

An invalid downcast from `nsHTMLDocument` to `nsIContent` could have lead to undefined behavior.

##### References

* [Bug 1811331](https://bugzilla.mozilla.org/show_bug.cgi?id=1811331)

#### [#CVE-2023-25741: Same-origin policy leak via image drag and drop](#CVE-2023-25741)

Reporter
Dohyun Lee (@l33d0hyun) of SSD Labs
Impact
low
##### Description

When dragging and dropping an image cross-origin, the image's size could potentially be leaked. This behavior was shipped in 109 and caused web compatibility problems as well as this security concern, so the behavior was disabled until further review.

##### References

* [Bug 1813376](https://bugzilla.mozilla.org/show_bug.cgi?id=1813376)
* [Bug 1437126](https://bugzilla.mozilla.org/show_bug.cgi?id=1437126)
* [Bug 1812611](https://bugzilla.mozilla.org/show_bug.cgi?id=1812611)

#### [#CVE-2023-25742: Web Crypto ImportKey crashes tab](#CVE-2023-25742)

Reporter
Goras Francesco
Impact
low
##### Description

When importing a SPKI RSA public key as ECDSA P-256, the key would be handled incorrectly causing the tab to crash.

##### References

* [Bug 1813424](https://bugzilla.mozilla.org/show_bug.cgi?id=1813424)

#### [#CVE-2023-25744: Memory safety bugs fixed in Firefox 110 and Firefox ESR 102.8](#CVE-2023-25744)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Kershaw Chang and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 109 and Firefox ESR 102.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 110 and Firefox ESR 102.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1789449%2C1803628%2C1810536)

#### [#CVE-2023-25745: Memory safety bugs fixed in Firefox 110](#CVE-2023-25745)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Timothy Nikkel, Gabriele Svelto, Jeff Muizelaar and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 109. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 110](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1688592%2C1797186%2C1804998%2C1806521%2C1813284)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_38b9263f_20250114_193333.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-07

## Security Vulnerabilities fixed in Thunderbird 102.8

Announced
February 15, 2023
Impact
low
Products
Thunderbird
Fixed in

* Thunderbird 102.8

*Except for CVE-2023--0616, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2023-0616: User Interface lockup with messages combining S/MIME and OpenPGP](#CVE-2023-0616)

Reporter
Kai Engert
Impact
low
##### Description

If a MIME email combines OpenPGP and OpenPGP MIME data in a certain way Thunderbird repeatedly attempts to process and display the message, which could cause Thunderbird's user interface to lock up and no longer respond to the user's actions. An attacker could send a crafted message with this structure to attempt a DoS attack.

##### References

* [Bug 1806507](https://bugzilla.mozilla.org/show_bug.cgi?id=1806507)

#### [#CVE-2023-25728: Content security policy leak in violation reports using iframes](#CVE-2023-25728)

Reporter
Johan Carlsson
Impact
high
##### Description

The `Content-Security-Policy-Report-Only` header could allow an attacker to leak a child iframe's unredacted URI when interaction with that iframe triggers a redirect.

##### References

* [Bug 1790345](https://bugzilla.mozilla.org/show_bug.cgi?id=1790345)

#### [#CVE-2023-25730: Screen hijack via browser fullscreen mode](#CVE-2023-25730)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A background script invoking `requestFullscreen` and then blocking the main thread could force the browser into fullscreen mode indefinitely, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1794622](https://bugzilla.mozilla.org/show_bug.cgi?id=1794622)

#### [#CVE-2023-0767: Arbitrary memory write via PKCS 12 in NSS](#CVE-2023-0767)

Reporter
Christian Holler
Impact
high
##### Description

An attacker could construct a PKCS 12 cert bundle in such a way that could allow for arbitrary memory writes via PKCS 12 Safe Bag attributes being mishandled.

##### References

* [Bug 1804640](https://bugzilla.mozilla.org/show_bug.cgi?id=1804640)

#### [#CVE-2023-25735: Potential use-after-free from compartment mismatch in SpiderMonkey](#CVE-2023-25735)

Reporter
Samuel Groß
Impact
high
##### Description

Cross-compartment wrappers wrapping a scripted proxy could have caused objects from other compartments to be stored in the main compartment resulting in a use-after-free after unwrapping the proxy.

##### References

* [Bug 1810711](https://bugzilla.mozilla.org/show_bug.cgi?id=1810711)

#### [#CVE-2023-25737: Invalid downcast in SVGUtils::SetupStrokeGeometry](#CVE-2023-25737)

Reporter
Lukas Bernhard
Impact
high
##### Description

An invalid downcast from `nsTextNode` to `SVGElement` could have lead to undefined behavior.

##### References

* [Bug 1811464](https://bugzilla.mozilla.org/show_bug.cgi?id=1811464)

#### [#CVE-2023-25738: Printing on Windows could potentially crash Thunderbird with some device drivers](#CVE-2023-25738)

Reporter
Mark
Impact
high
##### Description

Members of the `DEVMODEW` struct set by the printer device driver weren't being validated and could have resulted in invalid values which in turn would cause the browser to attempt out of bounds access to related variables.
*This bug only affects Thunderbird on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1811852](https://bugzilla.mozilla.org/show_bug.cgi?id=1811852)

#### [#CVE-2023-25739: Use-after-free in mozilla::dom::ScriptLoadContext::~ScriptLoadContext](#CVE-2023-25739)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

Module load requests that failed were not being checked as to whether or not they were cancelled causing a use-after-free in `ScriptLoadContext`.

##### References

* [Bug 1811939](https://bugzilla.mozilla.org/show_bug.cgi?id=1811939)

#### [#CVE-2023-25729: Extensions could have opened external schemes without user knowledge](#CVE-2023-25729)

Reporter
Vitor Torres
Impact
moderate
##### Description

Permission prompts for opening external schemes were only shown for `ContentPrincipals` resulting in extensions being able to open them without user interaction via `ExpandedPrincipals`. This could lead to further malicious actions such as downloading files or interacting with software already installed on the system.

##### References

* [Bug 1792138](https://bugzilla.mozilla.org/show_bug.cgi?id=1792138)

#### [#CVE-2023-25732: Out of bounds memory write from EncodeInputStream](#CVE-2023-25732)

Reporter
Ronald Crane
Impact
moderate
##### Description

When encoding data from an `inputStream` in `xpcom` the size of the input being encoded was not correctly calculated potentially leading to an out of bounds memory write.

##### References

* [Bug 1804564](https://bugzilla.mozilla.org/show_bug.cgi?id=1804564)

#### [#CVE-2023-25734: Opening local .url files could cause unexpected network loads](#CVE-2023-25734)

Reporter
Ameen Basha M K and Shaheen Fazim
Impact
moderate
##### Description

After downloading a Windows `.url` shortcut from the local filesystem, an attacker could supply a remote path that would lead to unexpected network requests from the operating system. This also had the potential to leak NTLM credentials to the resource.
*This bug only affects Thunderbird on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1809923](https://bugzilla.mozilla.org/show_bug.cgi?id=1809923)
* [Bug 1784451](https://bugzilla.mozilla.org/show_bug.cgi?id=1784451)
* [Bug 1810143](https://bugzilla.mozilla.org/show_bug.cgi?id=1810143)
* [Bug 1812338](https://bugzilla.mozilla.org/show_bug.cgi?id=1812338)

#### [#CVE-2023-25742: Web Crypto ImportKey crashes tab](#CVE-2023-25742)

Reporter
Goras Francesco
Impact
low
##### Description

When importing a SPKI RSA public key as ECDSA P-256, the key would be handled incorrectly causing the tab to crash.

##### References

* [Bug 1813424](https://bugzilla.mozilla.org/show_bug.cgi?id=1813424)

#### [#CVE-2023-25746: Memory safety bugs fixed in Thunderbird 102.8](#CVE-2023-25746)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Philipp and Gabriele Svelto reported memory safety bugs present in Thunderbird 102.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Thunderbird 102.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544127%2C1762368%2C1789449%2C1803628%2C1810536)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_497f1043_20250114_193332.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1792138)
* [XML](/show_bug.cgi?ctype=xml&id=1792138)

Closed
[Bug 1792138](/show_bug.cgi?id=1792138)
(CVE-2023-25729)

Opened 2 years ago
Closed 2 years ago

# Extensions are not prompted before opening external schemes, leading to security issues

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Extensions are not prompted before opening external schemes, leading to security issues

## Categories

### (Firefox :: File Handling, defect, P1)

[Product:](/describecomponents.cgi?product=Firefox)

Firefox
▾

Firefox
For bugs in Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the [Core](https://bugzilla.mozilla.org/describecomponents.cgi?product=Core) product. Bugs for developer tools (F12) should be filed in the [DevTools](https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools) product. ([more info](https://wiki.mozilla.org/Modules/All#Firefox))
[See Open Bugs in This Product](/buglist.cgi?product=Firefox&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Firefox)
Watch This Product

[Component:](/describecomponents.cgi?product=Firefox&component=File%20Handling#File%20Handling)

File Handling
▾

Firefox :: File Handling
For issues dealing with helper applications, and guessing Content Types when they aren't specified/known (ftp:, file:, jar:, but generally not http:). This component does not cover: backend networking issues, such as those covered by Networking: FTP or Networking: File, nor does it cover the Download Manager which has its own component in the Toolkit product.
[See Open Bugs in This Component](/buglist.cgi?product=Firefox&component=File%20Handling&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Firefox&component=File%20Handling&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Firefox&component=File%20Handling)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

All

All

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S3

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

110 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | [110+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=110%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed) |
| firefox107 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=wontfix) |
| firefox108 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=wontfix) |
| firefox109 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=wontfix) |
| firefox110 | [+](/buglist.cgi?f1=cf_tracking_firefox110&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox110&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| firefox-esr102 | 110+ | fixed |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox107 |  | wontfix |
| firefox108 |  | wontfix |
| firefox109 |  | wontfix |
| firefox110 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: vitortorresvt, Assigned: mossop)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8f56e46f0120d9477f8f320991a2196a?d=mm&size=40)  [mossop](/user_profile?user_id=91159)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/32f8cc92c6cd73cdb3f5bccaf95b7fa4?d=mm&size=40)  [vitortorresvt](/user_profile?user_id=713917)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40)  [Gijs](/user_profile?user_id=159069)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

### ( [URL](https://* "https://*") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1814251](/show_bug.cgi?id=1814251 "RESOLVED FIXED - Update l10n-changesets on ESR102")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1792138&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1792138)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[\*](https://* "https://*")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player"), [CVE-2023-32210](/show_bug.cgi?id=1776755 "RESOLVED FIXED - Logic depending on ExpandedPrincipal ordering in `Document::MaybeDowngradePrincipal` is broken"), [1813975](/show_bug.cgi?id=1813975 "UNCONFIRMED - No prompt to choose application for custom link scheme")

## Details

### (Keywords: csectype-priv-escalation, reporter-external, sec-moderate, Whiteboard: [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage][adv-main110+][adv-esr102.8+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-25729

[Keywords:](/describekeywords.cgi)

[csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [web-bounty-form] [verif?][post-critsmash-triage][adv-main110+][adv-esr102.8+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a9466674_1689 "2 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | [qe-verify](#a9366043_553429 "2 years ago") | - |
| --- | --- | --- |
| [btot](/user_profile?user_id=553429) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | blocking-fx-sync1.7 | ? |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files, 1 obsolete file)

| [Mozilla Add-on to desmontrate the attack](/attachment.cgi?id=9295918)  [2 years ago](#c0)  [Vitor Torres](/user_profile?user_id=713917)   3.69 KB, application/x-zip-compressed |  | [Details](/attachment.cgi?id=9295918&action=edit) |
| --- | --- | --- |
| [Video demonstrating the behavior](/attachment.cgi?id=9295919)  [2 years ago](#c1)  [Vitor Torres](/user_profile?user_id=713917)   2.74 MB, video/mp4 |  | [Details](/attachment.cgi?id=9295919&action=edit) |
| [Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!](/attachment.cgi?id=9301996)  [2 years ago](#c20)  [Dave Townsend [:mossop]](/user_profile?user_id=91159)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9301996&action=edit) | [Review](/attachment.cgi?id=9301996) |
| [Bug 1792138: Verify that protocol permission prompts for extensions show correctly. r=pbz!](/attachment.cgi?id=9303491)  [2 years ago](#c34)  [Dave Townsend [:mossop]](/user_profile?user_id=91159)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9303491&action=edit) | [Review](/attachment.cgi?id=9303491) |
| [Bug 1792138: Show the extension's name in permission prompts for opening external links.](/attachment.cgi?id=9315845)  [2 years ago](#c57)  [Dave Townsend [:mossop]](/user_profile?user_id=91159)   48 bytes, text/x-phabricator-request | RyanVM : [approval-mozilla-esr102+](#c59 "2 years ago") | [Details](/attachment.cgi?id=9315845&action=edit) | [Review](/attachment.cgi?id=9315845) |
| [advisory.txt](/attachment.cgi?id=9317084)  [2 years ago](#c61)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   427 bytes, text/plain |  | [Details](/attachment.cgi?id=9317084&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1792138#c0)• 2 years ago |
|  | |

Attached file
[Mozilla Add-on to desmontrate the attack](attachment.cgi?id=9295918)
— [Details](attachment.cgi?id=9295918&action=edit)

VERSION

Firefox Version: 105.0 (64-bits)

Operating System: Windows 10 Pro Version 21H1 (Build 19043.2006)

VULNERABILITY DETAILS

This report covers an extension who could abuse default protocol handlers acceptance from the browser

to download any arbitrary file and tries to load with a windows default installed program.

Impact:

An extension can create an `obscured` window using the protocol print3d (default accepted by firefox), which

leads to the user downloading any type of files from an URL to the system and try to load this file using print3d software on Windows.

Here in this report, I'm covering the usage of the print3d protocol as an example but it could leave a door open for many more cases.

The extension can run things for the user anytime, from user clicks, user installed actionss and many more events, so i'm using this as example.

In this report I'm gonna use the extension to inject code on the DOM with a custom event and when this

custom event is called, the content.js file sends a message to the background.js which opens an minimal window

with the protocol handler and closes itself right after, obscuring what is causing this to download files and

the program on windows popup trying to load this file.

Impact: Downloading any type of files without the user awareness and possible load/execution of arbitrary code on users' systems or allow access to users' confidential information if the attacker goes further on the protocol to microsoft program which the Firefox accept as default and Chrome does't.

This protocol is not handled by Chrome because security issues too;

My example was just to demonstrate it can be obscured and abuse this or other cases with protocol handlers but it could be as simple as:

browser.action.onClicked.addListener(async () => {'

let window = await chrome.windows.create({url: "com.microsoft.print3d://[https://github.com/git-for-windows/git/releases/download/v2.37.3.windows.1/Git-2.37.3-64-bit.exe"}](https://github.com/git-for-windows/git/releases/download/v2.37.3.windows.1/Git-2.37.3-64-bit.exe%22%7D));

});

or

window.location.replace("com.microsoft.print3d://<https://github.com/git-for-windows/git/releases/download/v2.37.3.windows.1/Git-2.37.3-64-bit.exe>")

You can see the download file at:

Mitigation: Avoid the protocol handler com.microsoft.print3d as default accepted

REPRODUCTION CASE

1. Install the attached extension, the extension does not require any permission;

* about:debugging#/runtime/this-firefox
* Load temporary extension

2. Visit any page;
3. Once the extension reveals the new window, observe the interaction;
4. The user downloaded a file and tried to load it without consent;

Ps.: We could just not use the add-on the place on the site and use window.location.replace of something else

CREDIT INFORMATION

Reporter credit: Vitor Torres <<https://github.com/vtorres/> or vitortorresvt@gmail.com>

Flags: sec-bounty?

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1792138#c1)• 2 years ago |
|  | |

Attached video
[Video demonstrating the behavior](attachment.cgi?id=9295919)
— [Details](attachment.cgi?id=9295919&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1792138#c2)• 2 years ago |
|  | |

Moving this to a better product (it's not a website bug!), possible not quite right. I'm supposed to be on vacation so I've only given it a surface glance. If you've installed a malicious extension you're in trouble, but it is worth making sure this is indeed a capability we want extensions to have that websites don't.

I think there might be two separate streams here

1. is the `com.microsoft.print3d:` scheme one we should restrict as dangerous generally? Or is our usual web page behavior of prompting sufficient? I suspect the usual behavior is fine unless there are known exploits for this thing. What does Chrome do?
2. from the video it appears web extension code doesn't have to prompt. Is that intentional, or a bug? Although the lack of prompting is great for an extension that was designed to work with particular installed software (what would happen if a user declined it? if we did prompt how would we explain who is doing the asking?), extensions should have to declare in the manifest which external schemes they intend to use in this manner. Open question on whether that's surfaced in the install prompt or just available for review.
Group: websites-security → firefox-core-securityStatus: UNCONFIRMED → NEWType: task → defectComponent: Other → GeneralEver confirmed: trueFlags: needinfo?(rob)Flags: needinfo?(gijskruitbosch+bugs)Product: Websites → WebExtensions

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1792138#c3)• 2 years ago |
|  | |

The extension doesn't get prompted before opening the protocol handler scheme, so I would consider it a flaw/bug

If you directly open an HTML file containing something like window.location.replace("com.microsoft.print3d://<https://github.com/git-for-windows/git/releases/download/v2.37.3.windows.1/Git-2.37.3-64-bit.exe>"), both chrome and firefox will ask your permission to have it open

With the extension, you don't get prompted and the extension doesn't need any permissions configured on the manifest.json file, it's bypassing the prompt while the default behavior is prompting the user

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1792138#c4)• 2 years ago |
|  | |

And not only print3d protocol handler, but you can also test it with any schema - example calculator:

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1792138#c5)• 2 years ago |
|  | |

Extensions are not prompted before opening external schemes due to the change from [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player"). In particular, the prompt is skipped due to <https://searchfox.org/mozilla-central/rev/a26af613a476fafe6c3eba05a81bef63dff3c9f1/toolkit/mozapps/handling/ContentDispatchChooser.jsm#296-298>

Regular web pages would not hit that exception, and trigger the prompt, as noted in [comment 3](/show_bug.cgi?id=1792138#c3 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues").

PS. The PoC extension is unnecessarily complicated, and can be simplified by removing the content script that currently runs on all websites, and use a plain background script instead that calls `browser.tabs.create({ url: "com.microsoft.print3d://https://github.com/git-for-windows/git/releases/download/v2.37.3.windows.1/Git-2.37.3-64-bit.exe", active: false })`.

Flags: needinfo?(rob)See Also: → [1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player")

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1792138#c6)• 2 years ago |
|  | |

On the chrome browser, the window gets prompted if an extension opens up a window with a protocol handler scheme

Summary: Abusing default protocol handlers to download and load file without user awareness ( with or without add-on ) → Extensions are not prompted before opening external schemes, leading to security issues

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1792138#c7)• 2 years ago |
|  | |

A bit more about the surface attack with protocol handlers below:

<https://parsiya.net/blog/2021-03-17-attack-surface-analysis-part-2-custom-protocol-handlers/#privilege-escalation-via-protocol-handlers>

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1792138#c8)• 2 years ago |
|  | |

For example, this year we had the [CVE-2022-30190](https://www.cve.org/CVERecord?id=CVE-2022-30190) using the `ms-search` protocol, but it still would require to the user accept the browser prompt to open the application, without the prompt for this kind of attack surfaces would be nicer.

The attacker could even buy a niche extension from someone, adding to the code, and go crazy on the users

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1792138#c9)• 2 years ago |
|  | |

(In reply to Rob Wu [:robwu] from [comment #5](/show_bug.cgi?id=1792138#c5 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Extensions are not prompted before opening external schemes due to the change from [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player"). In particular, the prompt is skipped due to <https://searchfox.org/mozilla-central/rev/a26af613a476fafe6c3eba05a81bef63dff3c9f1/toolkit/mozapps/handling/ContentDispatchChooser.jsm#296-298>

At the time there would still be a separate prompt to pick an application for protocols that had never been opened, but that is no longer the case ([bug 1731898](/show_bug.cgi?id=1731898 "RESOLVED FIXED - Skip the application chooser dialog step when a non-standard protocol has registered handler")). Now there is only the permission prompt in tightly-coupled-protocol-to-app cases (so things like `zoommtg`, unlike mailto: or other generic protocols implemented by more than 1 app). Except for add-ons we do not show a permission prompt, so now there is no prompt at all in that case.

The comments in [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") suggest that we could not store the permission purely based on the add-on. Is that still accurate? Because it seems to me we could restore the permission prompt as long as we could reasonably make it persist if the user ticks the "always allow [addon] to open [app]" checkbox, without reintroducing the issue for which the bug got filed.

Flags: needinfo?(rob)Flags: needinfo?(pbz)Flags: needinfo?(gijskruitbosch+bugs)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1792138#c10)• 2 years ago |
|  | |

When I read [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player"), I see that the issue there was caused by the inability to find a principal for the test case.

The test case was an external protocol triggered via a content script, which has an Expanded Principal consisting of the extension and web page.

The "fix" there was to skip the logic when isAddonOrExpandedAddonPrincipal.

That is the wrong fix IMO.

For regular Content Principals that happen to be add-ons, we can just use that principal.

For expanded principals related to add-ons, we should be using the web page's principal, i.e. the first in the list of principals of ExpandedPrincipal. The first principal is the document principal and not the extension principal, because (1) we set it as the first at <https://searchfox.org/mozilla-central/rev/91ed81b76015e49ebd55a6de5df2b034456c15e8/toolkit/components/extensions/ExtensionContent.jsm#811> and currently more importantly (2) the re-sorting logic of ExpandedPrincipal does not re-order these two principals in practice. Furthermore, there is more code relying on this ordering.

An alternative is to choose the extension principal when an Expanded Principal is encountered. I am against this approach, because we're trying to get the content script behave like the web page where security decisions are made. Using the extension principal would mean that a web page could try to trick the content script into doing something with a different principal.

Flags: needinfo?(rob)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1792138#c11)• 2 years ago |
|  | |

Thanks Rob! +1 on your proposal. Just the principal ordering seems a bit brittle. Perhaps we can at least add a comment where that order is established. Alternatively, could we add a more explicit way to get to the document principal from the expanded principal?

Flags: needinfo?(pbz) → needinfo?(rob)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1792138#c12)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1792138&comment_id=16094526 "1 revision") |
|  | |

For content (addon) principals we can store a permission since they're regular content principals. The check here also supports the extension scheme: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#420>

However, running the POC from this bug, I end up with a BrowsingContext with no chrome window associated that we can use for showing the dialog in. We fail the checks here: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#338,345>

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1792138#c13)• 2 years ago |
|  | |

(In reply to Paul Zühlcke [:pbz] from [comment #11](/show_bug.cgi?id=1792138#c11 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Thanks Rob! +1 on your proposal. Just the principal ordering seems a bit brittle. Perhaps we can at least add a comment where that order is established. Alternatively, could we add a more explicit way to get to the document principal from the expanded principal?

In [comment 10](/show_bug.cgi?id=1792138#c10 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues") I already linked to the source where the order is initially set. The source where the order is preserved is in [ExpandedPrincipal::Create (ExpandedPrincipal.cpp lines 56-63)](https://searchfox.org/mozilla-central/rev/1564027eba41993868973e4a7b93bea942a16b78/caps/ExpandedPrincipal.cpp#56-63). As you can see there, there is some attempt at sorting, but in practice the `moz-extension:`-URL ends up last, after web content schemes such as http(s).

There is relevant discussion about this principal sorting behavior, in [bug 1776755](/show_bug.cgi?id=1776755 "RESOLVED FIXED - Logic depending on ExpandedPrincipal ordering in `Document::MaybeDowngradePrincipal` is broken").

(In reply to Paul Zühlcke [:pbz] from [comment #12](/show_bug.cgi?id=1792138#c12 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> For content (addon) principals we can store a permission since they're regular content principals. The check here also supports the extension scheme: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#420>
>
> However, running the POC from this bug, I end up with a BrowsingContext with no chrome window associated that we can use for showing the dialog in. We fail the checks here: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#338,345>

The PoC opens a window and closes it. Could that result in the observed behavior of the disappeared window? In [comment 5](/show_bug.cgi?id=1792138#c5 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues") I described a simpler STR. You can try it out by copying the code snippet at the end of that comment (inspect any extension with a background page at `about:debugging` and run the snippet there).

Flags: needinfo?(rob)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1792138#c14)• 2 years ago |
|  | |

The severity field is not set for this bug.

:robwu, could you have a look please?

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#workflow.2Fno_severity.py).

Flags: needinfo?(rob)

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1792138#c15)• 2 years ago |
|  | |

Please, before setting the severity here make sure to read the following

<https://parsiya.net/blog/2021-03-17-attack-surface-analysis-part-2-custom-protocol-handlers/>

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1792138#c16)• 2 years ago |
|  | |

* Follina ( [CVE-2022-30190](https://www.cve.org/CVERecord?id=CVE-2022-30190) ) and many others this year already

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1792138#c17)• 2 years ago |
|  | |

needinfo pbz: for my response in [comment 13](/show_bug.cgi?id=1792138#c13 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"), to make sure that the PoC and bug is well-understood.

Since the issue is in the ContentDispatchChooser component, I'm moving this to Firefox::File Handling. Feel free to tag me as a reviewer.

Component: General → File HandlingFlags: needinfo?(rob) → needinfo?(pbz)Product: WebExtensions → Firefox

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1792138#c18)• 2 years ago |
|  | |

Sorry for the slow updates! I'm discussing this bug with Gijs next week. I'm particularly interested finding a solution for the cases where we don't have a tab to show the prompt in.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a3312530_91159)• 2 years ago |

Assignee: nobody → dtownsend

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1792138#c19)• 2 years ago |
|  | |

Thanks for taking this bug Dave! I see you already found our notes doc.

Flags: needinfo?(pbz)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1792138#c20)• 2 years ago |
|  | |

Attached file
[Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!](attachment.cgi?id=9301996)
— [Details](attachment.cgi?id=9301996&action=edit)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1792138#c21)• 2 years ago |
|  | |

Rob and Paul would you mind taking a quick look at what I have so far to make sure I haven't misunderstood the intent before I write some tests? For content scripts it shows the permission prompt using the pages principal, for the background script it uses the extension's name. I'm not sure if only passing the content page's principal to ContentDispatchChooser is the right thing but there doesn't seem to be a way from JavaScript to get the first principal from the expanded principal so it was the simplest solution.

(In reply to Rob Wu [:robwu] from [comment #13](/show_bug.cgi?id=1792138#c13 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to Paul Zühlcke [:pbz] from [comment #12](/show_bug.cgi?id=1792138#c12 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > However, running the POC from this bug, I end up with a BrowsingContext with no chrome window associated that we can use for showing the dialog in. We fail the checks here: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#338,345>
>
> The PoC opens a window and closes it. Could that result in the observed behavior of the disappeared window? In [comment 5](/show_bug.cgi?id=1792138#c5 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues") I described a simpler STR. You can try it out by copying the code snippet at the end of that comment (inspect any extension with a background page at `about:debugging` and run the snippet there).

In my tests with the patch we do actually end up showing the prompt in the newly created window but then the extension closes the window so quickly that you just can't see it, in which case the link just isn't opened. We could attempt to move the permission prompt into its own window in the window containing it is closed but I think we're better off just leaving this as is.

Flags: needinfo?(rob)Flags: needinfo?(pbz)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1792138#c22)• 2 years ago |
|  | |

(In reply to Dave Townsend [:mossop] from [comment #21](/show_bug.cgi?id=1792138#c21 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Rob and Paul would you mind taking a quick look at what I have so far to make sure I haven't misunderstood the intent before I write some tests? For content scripts it shows the permission prompt using the pages principal, for the background script it uses the extension's name. I'm not sure if only passing the content page's principal to ContentDispatchChooser is the right thing but there doesn't seem to be a way from JavaScript to get the first principal from the expanded principal so it was the simplest solution.

Looks good to me.

> (In reply to Rob Wu [:robwu] from [comment #13](/show_bug.cgi?id=1792138#c13 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > (In reply to Paul Zühlcke [:pbz] from [comment #12](/show_bug.cgi?id=1792138#c12 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
> >
> > > However, running the POC from this bug, I end up with a BrowsingContext with no chrome window associated that we can use for showing the dialog in. We fail the checks here: <https://searchfox.org/mozilla-central/rev/19f4fa1c9253a783b0ec2664f2bd91ce963aeec0/toolkit/mozapps/handling/ContentDispatchChooser.jsm#338,345>
> >
> > The PoC opens a window and closes it. Could that result in the observed behavior of the disappeared window? In [comment 5](/show_bug.cgi?id=1792138#c5 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues") I described a simpler STR. You can try it out by copying the code snippet at the end of that comment (inspect any extension with a background page at `about:debugging` and run the snippet there).
>
> In my tests with the patch we do actually end up showing the prompt in the newly created window but then the extension closes the window so quickly that you just can't see it, in which case the link just isn't opened. We could attempt to move the permission prompt into its own window in the window containing it is closed but I think we're better off just leaving this as is.

This sounds OK to me too. We can't do much if an extension decides to close the window where we're rendering the UI.

Flags: needinfo?(rob)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1792138#c23)• 2 years ago |
|  | |

(In reply to Dave Townsend [:mossop] from [comment #21](/show_bug.cgi?id=1792138#c21 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> I'm not sure if only passing the content page's principal to ContentDispatchChooser is the right thing but there doesn't seem to be a way from JavaScript to get the first principal from the expanded principal so it was the simplest solution.

I'm a little nervous about this because e.g. in the case of [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") this means that youtube will always be able to open `potplayer` links at will (once permission is given permanently), rather than the add-on always being able to open such links. It seems safer to have this permission relate to the add-on vs. to the website, depending on what the external app does etc.? But maybe that's just me... I'm curious what Paul thinks.

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1792138#c24)• 2 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #23](/show_bug.cgi?id=1792138#c23 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to Dave Townsend [:mossop] from [comment #21](/show_bug.cgi?id=1792138#c21 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > I'm not sure if only passing the content page's principal to ContentDispatchChooser is the right thing but there doesn't seem to be a way from JavaScript to get the first principal from the expanded principal so it was the simplest solution.
>
> I'm a little nervous about this because e.g. in the case of [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") this means that youtube will always be able to open `potplayer` links at will (once permission is given permanently), rather than the add-on always being able to open such links. It seems safer to have this permission relate to the add-on vs. to the website, depending on what the external app does etc.? But maybe that's just me... I'm curious what Paul thinks.

That's a fair point, to reduce the risk of the website or other extensions using the permission.

Most DOM APIs that carry permission UI are associated with the web page where the content scripts run. This doesn't mean that we can choose a different behavior for the ContentDispatchChooser if we wish, but if we care about consistency, then this is something to keep in mind.

A potential consequence of switching to the extension ContentPrincipal instead of the page's (from the ExpandedPrincipal) is that user could be prompted again despite just having granted permissions to the web page. That could be addressed by checking all principals when querying for access, and only writing to e.g. the extension principal when persisting access.

Note: An ExpandedPrincipal does not always contain an extension principal. E.g. with [the userScripts API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/userScripts), it is possible to have an ExpandedPrincipal consisting of only the page's principal ([source](https://searchfox.org/mozilla-central/rev/47fe7cb3f99ae86a4e65a341e1f60891da4097a3/toolkit/components/extensions/ExtensionContent.jsm#727)). This is meant to have some isolation between the user script and the web page, without the user script being given all extension permissions.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1792138#c25)• 2 years ago |
|  | |

(In reply to Rob Wu [:robwu] from [comment #24](/show_bug.cgi?id=1792138#c24 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to :Gijs (he/him) from [comment #23](/show_bug.cgi?id=1792138#c23 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > (In reply to Dave Townsend [:mossop] from [comment #21](/show_bug.cgi?id=1792138#c21 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
> >
> > > I'm not sure if only passing the content page's principal to ContentDispatchChooser is the right thing but there doesn't seem to be a way from JavaScript to get the first principal from the expanded principal so it was the simplest solution.
> >
> > I'm a little nervous about this because e.g. in the case of [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") this means that youtube will always be able to open `potplayer` links at will (once permission is given permanently), rather than the add-on always being able to open such links. It seems safer to have this permission relate to the add-on vs. to the website, depending on what the external app does etc.? But maybe that's just me... I'm curious what Paul thinks.
>
> That's a fair point, to reduce the risk of the website or other extensions using the permission.
>
> Most DOM APIs that carry permission UI are associated with the web page where the content scripts run. This doesn't mean that we can choose a different behavior for the ContentDispatchChooser if we wish, but if we care about consistency, then this is something to keep in mind.
>
> A potential consequence of switching to the extension ContentPrincipal instead of the page's (from the ExpandedPrincipal) is that user could be prompted again despite just having granted permissions to the web page. That could be addressed by checking all principals when querying for access, and only writing to e.g. the extension principal when persisting access.

So sounds like what we should do is for the extension content script case check if the page has permission and if so proceed, if not check if the extension has permission and if not prompt to allow the extension to use the protocol. Does that sound right?

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1792138#c26)• 2 years ago |
|  | |

(In reply to Dave Townsend [:mossop] from [comment #25](/show_bug.cgi?id=1792138#c25 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> So sounds like what we should do is for the extension content script case check if the page has permission and if so proceed, if not check if the extension has permission and if not prompt to allow the extension to use the protocol. Does that sound right?

This sounds reasonable to me, yes.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1792138#c27)• 2 years ago |
|  | |

(In reply to :Gijs (he/him) from [comment #26](/show_bug.cgi?id=1792138#c26 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to Dave Townsend [:mossop] from [comment #25](/show_bug.cgi?id=1792138#c25 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > So sounds like what we should do is for the extension content script case check if the page has permission and if so proceed, if not check if the extension has permission and if not prompt to allow the extension to use the protocol. Does that sound right?
>
> This sounds reasonable to me, yes.

This actually turns out to be fairly straightforward as permission checks for expanded principals already check whether any of the principals allow the action: <https://searchfox.org/mozilla-central/rev/3c194fa1d6f339036d2ec9516bd310c6ad612859/extensions/permissions/PermissionManager.cpp#3753-3774>

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1792138#c28)• 2 years ago |
|  | |

(In reply to Dave Townsend [:mossop] from [comment #27](/show_bug.cgi?id=1792138#c27 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to :Gijs (he/him) from [comment #26](/show_bug.cgi?id=1792138#c26 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > (In reply to Dave Townsend [:mossop] from [comment #25](/show_bug.cgi?id=1792138#c25 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
> >
> > > So sounds like what we should do is for the extension content script case check if the page has permission and if so proceed, if not check if the extension has permission and if not prompt to allow the extension to use the protocol. Does that sound right?
> >
> > This sounds reasonable to me, yes.
>
> This actually turns out to be fairly straightforward as permission checks for expanded principals already check whether any of the principals allow the action: <https://searchfox.org/mozilla-central/rev/3c194fa1d6f339036d2ec9516bd310c6ad612859/extensions/permissions/PermissionManager.cpp#3753-3774>

Nice! Sounds like we only have to special-handle the addFromPrincipal case since expanded principals are blocked here: <https://searchfox.org/mozilla-central/rev/3c194fa1d6f339036d2ec9516bd310c6ad612859/extensions/permissions/PermissionManager.cpp#1690-1691>

Flags: needinfo?(pbz)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4001497_600971)• 2 years ago |

[Attachment #9301996](/attachment.cgi?id=9301996&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!") -
Attachment description: WIP: Bug 1792138: Show the extension's name in permission prompts for opening external links. → Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!

|  | [Vitor Torres](/user_profile?user_id=713917)  Reporter |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1792138#c29)• 2 years ago |
|  | |

Hey guys, good morning

Awesome to see your conversation and thoughts on this thread

Now that everyone has an overview of the bug, the possible attacks, and why this behavior would be yummy

I would like to know what type of severity it will be set for this report, if possible

Thank you

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1792138#c30)• 2 years ago |
|  | |

Calling this `sec-moderate`. In certain cases you could gain RCE if you know of a particularly buggy protocol, but mitigating that broad impact is it would only affect users who have installed an extension that either wants to call that protocol maliciously, or foolishly tries to load whatever URLs it finds and could be fooled into loading one found in web content.

If you've got an intentionally malicious addon you've already got bad problems.

Loading random URLs is not a common action for most addons.

Keywords: [csectype-priv-escalation](/buglist.cgi?keywords=csectype-priv-escalation&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1792138#c31)• 2 years ago |
|  | |

I want to raise a discussion point I made in the review:

> I just realized, now that external protocol handler permissions can be set for extensions, how do users revoke these permission again? afaic we can't / don't show them in the permissions panel. This permission type doesn't have any preferences dialog which lists all set permissions. Users would have to purge their entire permissions database to get rid of the permission again.
>
> For the content-script case we can consider using the site principal instead, but that still doesn't solve the case where a background script is using a tab to navigate to an external protocol. That's still a regular extension principal.

Are we OK with this permission not being explicitly revokeable? Should we consider building UI for it? I don't think we can completely get around setting permissions for extension principals...

Flags: needinfo?(gijskruitbosch+bugs)Flags: needinfo?(dtownsend)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1792138#c32)• 2 years ago |
|  | |

As per robwu's comment on Phabricator, looks like we could clear the permissions on extension uninstall at least: <https://searchfox.org/mozilla-central/rev/dd216c1307a2bf1b0d2465b9749fa86dac44303a/toolkit/components/extensions/Extension.jsm#524-567>

That might be acceptable for now.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1792138#c33)• 2 years ago |
|  | |

(In reply to Paul Zühlcke [:pbz] from [comment #31](/show_bug.cgi?id=1792138#c31 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> I want to raise a discussion point I made in the review:
>
> > I just realized, now that external protocol handler permissions can be set for extensions, how do users revoke these permission again?

Uninstall and reinstall the extension seems a not-entirely-unreasonable workaround if you don't want the extension to have a given permission (which it presumably needs to do most/all of its job - that's certainly the case for the one in [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player")). So I don't think this should cause a change in approach here. We can file a follow-up to investigate adding some UI to the add-on manager or something.

Flags: needinfo?(gijskruitbosch+bugs)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4266394_159069)• 2 years ago |

Severity: -- → S3Status: NEW → ASSIGNEDPriority: -- → P1

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4609910_91159)• 2 years ago |

[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=affected)
[status-firefox108](/buglist.cgi?f1=cf_status_firefox108&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=affected)
[status-firefox109](/buglist.cgi?f1=cf_status_firefox109&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)Flags: needinfo?(dtownsend)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1792138#c34)• 2 years ago |
|  | |

Attached file
[Bug 1792138: Verify that protocol permission prompts for extensions show correctly. r=pbz!](attachment.cgi?id=9303491) (obsolete)
— [Details](attachment.cgi?id=9303491&action=edit)

Depends on D161282

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1792138#c35)• 2 years ago |
|  | |

Comment on [attachment 9301996](/attachment.cgi?id=9301996 "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!") [[details]](/attachment.cgi?id=9301996&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!")

[Bug 1792138](/show_bug.cgi?id=1792138 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"): Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The exploit requires an external protocol present in the OS and a custom extension to be written.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Unknown
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: The existing patch applies with some minor conflicts that will be trivial to correct and introduce no risk.
* **How likely is this patch to cause regressions; how much testing does it need?**: We have automated tests and reviewers have performed some manual tests. Low risk of regression.
* **Is Android affected?**: No
[Attachment #9301996](/attachment.cgi?id=9301996&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1792138#c36)• 2 years ago |
|  | |

Comment on [attachment 9301996](/attachment.cgi?id=9301996 "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!") [[details]](/attachment.cgi?id=9301996&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!")

[Bug 1792138](/show_bug.cgi?id=1792138 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"): Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!

You don't actually need sec-approval for moderates; but lgtm!

[Attachment #9301996](/attachment.cgi?id=9301996&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links. r=ckerschb!,robwu!,gijs!") -
Flags: sec-approval?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1792138#c37)• 2 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/e14d089637861294d9cc4fe275f0ff24abd63b76>

Backed out for causing mochitest failures in browser\_protocol\_ask\_dialog\_permission.js:

<https://hg.mozilla.org/integration/autoland/rev/7be6ed2bf374e847cc23f13b88c7e80489004d4a>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&revision=e14d089637861294d9cc4fe275f0ff24abd63b76&selectedTaskRun=KwIeXOm8RiOW0mn0eiddMg.0>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=396839241&repo=autoland>

```
[task 2022-11-17T12:59:38.824Z] 12:59:38     INFO - TEST-PASS | toolkit/components/extensions/test/mochitest/test_ext_protocolHandlers.html | correct url template
[task 2022-11-17T12:59:38.824Z] 12:59:38     INFO - Buffered messages finished
[task 2022-11-17T12:59:38.825Z] 12:59:38     INFO - TEST-UNEXPECTED-FAIL | toolkit/components/extensions/test/mochitest/test_ext_protocolHandlers.html | Test timed out. -

```
Flags: needinfo?(dtownsend)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1792138#c38)• 2 years ago |
|  | |

XPCshell failures are also from this: <https://treeherder.mozilla.org/logviewer?job_id=396839196&repo=autoland>

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1792138#c39)• 2 years ago |
|  | |

I probably need some additional guidance on landing this. I know we're not supposed to land the tests until later, but in this case the patch breaks one of the existing tests. I could fix that one testcase or potentially remove that one testcase and re-add it when the full tests eventually land. What do you suggest Tom?

Flags: needinfo?(tom)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1792138#c40)• 2 years ago |
|  | |

Sheriffs took another look, the XPCshell issue is unrelated.

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1792138#c41)• 2 years ago |
|  | |

For sec-moderates you don't need to worry about landing tests separately at a later date. (Unless you think the bug is particularly worrisome or 'high' for a moderate, but I don't think this bug qualifies.)

Flags: needinfo?(tom)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4784719_600971)• 2 years ago |

[Attachment #9303491](/attachment.cgi?id=9303491&action=edit "Bug 1792138: Verify that protocol permission prompts for extensions show correctly. r=pbz!") -
Attachment is obsolete: true

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1792138#c42)• 2 years ago |
|  | |

(In reply to Tom Ritter [:tjr] from [comment #41](/show_bug.cgi?id=1792138#c41 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> For sec-moderates you don't need to worry about landing tests separately at a later date. (Unless you think the bug is particularly worrisome or 'high' for a moderate, but I don't think this bug qualifies.)

Ah ok. That is quite unclear from [the docs](https://firefox-source-docs.mozilla.org/bug-mgmt/processes/fixing-security-bugs.html#landing-your-patch-with-or-without-sec-approval) so might be worth updating those.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4784821_91159)• 2 years ago |

Flags: needinfo?(dtownsend)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1792138#c43)• 2 years ago |
|  | |

Landed: <https://hg.mozilla.org/integration/autoland/rev/02a9e51358f138c5a7a6433b780d4f004f1e1a59>

Backed out for causing mochitests failures on browser\_ext\_windows\_create\_url.js:

<https://hg.mozilla.org/integration/autoland/rev/81747a41462cbd548f2c766f653ad862595cc4ec>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&resultStatus=testfailed%2Cbusted%2Cexception%2Cretry%2Cusercancel&revision=02a9e51358f138c5a7a6433b780d4f004f1e1a59>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=396857376&repo=autoland>

> TEST-UNEXPECTED-FAIL | browser/components/extensions/test/browser/browser\_ext\_windows\_create\_url.js | Test timed out -
>
> and more tests failing after this.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a4792076_258347)• 2 years ago |

Flags: needinfo?(dtownsend)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1792138#c44)• 2 years ago |
|  | |

The test is failing because it contains an extension that registers a protocol handler from the `protocol_handlers` and now the extension doesn't have permission to load from it. The test contains two different extensions that register two different handlers and then one extension attempts to open links from both. So some questions and assumptions I want to confirm before I figure out the fix:

1. Should an extension automatically be allowed to open urls to protocols it declares in its own manifest? I assume yes since it basically controls them anyway.
2. Should an extension automatically be allowed to open urls to protocols declared by other extensions? I assume no, but that will require changing the test to accept the prompt in the right cases.
Flags: needinfo?(dtownsend) → needinfo?(rob)

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1792138#c45)• 2 years ago |
|  | |

Depends on the implementation. Do you immediately know whether a protocol is going to resolve to an extension URL?

If yes: 1. Yes. 2. Maybe. We're requiring a prompt before custom protocols are opened, out of caution. But an extension protocol handler will resolve to an extension page that's presumably already web-accessible, so other extensions can reasonably easily discover the real URL and open that directly. So I wouldn't object to allowing extensions to open extension-defined protocol handlers, whether their own or others.

If not, i.e. when we don't know for sure that a protocol maps to an extension URL, then I would expect a prompt for both cases.

Flags: needinfo?(rob)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1792138#c46)• 2 years ago |
|  | |

(In reply to Rob Wu [:robwu] from [comment #45](/show_bug.cgi?id=1792138#c45 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Depends on the implementation. Do you immediately know whether a protocol is going to resolve to an extension URL?

Well we have the protocol scheme, and that is what is defined in the extension's manifest file so I assume so. Though at the moment I haven't looked for a way to actually look that up.

> If yes: 1. Yes. 2. Maybe. We're requiring a prompt before custom protocols are opened, out of caution. But an extension protocol handler will resolve to an extension page that's presumably already web-accessible, so other extensions can reasonably easily discover the real URL and open that directly. So I wouldn't object to allowing extensions to open extension-defined protocol handlers, whether their own or others.
>
> If not, i.e. when we don't know for sure that a protocol maps to an extension URL, then I would expect a prompt for both cases.

(In reply to Rob Wu [:robwu] from [comment #45](/show_bug.cgi?id=1792138#c45 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Depends on the implementation. Do you immediately know whether a protocol is going to resolve to an extension URL?
>
> If yes: 1. Yes. 2. Maybe. We're requiring a prompt before custom protocols are opened, out of caution. But an extension protocol handler will resolve to an extension page that's presumably already web-accessible, so other extensions can reasonably easily discover the real URL and open that directly. So I wouldn't object to allowing extensions to open extension-defined protocol handlers, whether their own or others.
>
> If not, i.e. when we don't know for sure that a protocol maps to an extension URL, then I would expect a prompt for both cases.

I'm not immediately seeing a way to look up from a protocol that it is provided by an extension. There are hints (the preferred handler is an nsIWebHandlerApp and there are only specific protocols that the extension can register) but using those would be dubious. So that leaves me with three alternatives and I don't have a strong opinion either way:

1. Prompt for all extension provided protocols. I'll have to update any tests that use them to accept the prompts.
2. Allow an extension to access its own protocols, I can do this by adding the protocol permission when the extension is loaded but I will still have to update the test as it uses one extension to access a different extension's protocol handler.
3. Add a way to look up that a protocol is extension provided and allow extensions to call them. Doing this raises the question of whether websites should also be able to call extension provided protocols in the same way.
Flags: needinfo?(rob)Flags: needinfo?(pbz)

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1792138#c47)• 2 years ago |
|  | |

I'm fine with the simpler solution here, both (1) and (2) seem good. Maybe (2) is better because there is less friction for extensions. Is it clear to users that an extension manages a specific protocol? Does this get listed in the doorhanger on installation?

Flags: needinfo?(pbz)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1792138#c48)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1792138&comment_id=16174294 "1 revision") |
|  | |

(In reply to Dave Townsend [:mossop] from [comment #42](/show_bug.cgi?id=1792138#c42 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> (In reply to Tom Ritter [:tjr] from [comment #41](/show_bug.cgi?id=1792138#c41 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))
>
> > For sec-moderates you don't need to worry about landing tests separately at a later date. (Unless you think the bug is particularly worrisome or 'high' for a moderate, but I don't think this bug qualifies.)
>
> Ah ok. That is quite unclear from [the docs](https://firefox-source-docs.mozilla.org/bug-mgmt/processes/fixing-security-bugs.html#landing-your-patch-with-or-without-sec-approval) so might be worth updating those.

FWIW I think when I last updated the docs in [bug 1736003](/show_bug.cgi?id=1736003 "RESOLVED FIXED - Change guidance on non-high/crit security bug checkins to be clearer") I was kinda aiming to encourage people to always land tests separately (even for sec-moderate/sec-low). For new tests doing this isn't actually super hard and we do know that people watch our checkins etc.

I don't think that the "land tests separately" ever (even for sec-high/sec-crit, unless it literally paints a bulls-eye) extends to pre-existing tests that need updating to the degree that we disable those tests or something. I suspect we should have a conversation about what we want the policy to be/say, but it should probably be separate from this bug.

|  | [Shane Caraveo (:mixedpuppy)](/user_profile?user_id=372685) |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1792138#c49)• 2 years ago |
|  | |

I've spent a chunk of time thinking through this and looking at the related patches.

The failing test was written to ensure that web\_accessible\_resources is not required to allow access to pages defined by extension protocol\_handlers. The prompting or not doesn't really play into that (except that the test needs to be modified to work again).

Originally there was not an explicit intention that an extension accessing any external protocol handler (provided by system or by extension) would bypass the prompt. That was done in [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player").

I do not see a reason to skip the dialog for an extension making a request to one of these protocols. While it would be "nice" to not do that for an extensions own protocol, I think that is an edge case, so long as the selection is remembered correctly per the dialog option for that.

In summary, I think #1 Prompt for all extension provided protocols is the way to go, making sure [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") is not reintroduced.

Flags: needinfo?(rob)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1792138#c50)• 2 years ago |
|  | |

(In reply to Shane Caraveo (:mixedpuppy) from [comment #49](/show_bug.cgi?id=1792138#c49 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> In summary, I think #1 Prompt for all extension provided protocols is the way to go, making sure [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") is not reintroduced.

Ok I've gone ahead and updated the patch to bypass the permission prompts in `browser_ext_windows_create_url.js` and [bug 1685682](/show_bug.cgi?id=1685682 "RESOLVED FIXED - Firefox keeps asking to \"Allow this site to open potplayer link in Potplayer( 64 bit)\" every time i send a youtube video link to be opened in Potplayer video player") is tested by the new cases I had already added to `browser_protocol_ask_dialog_permission.js`.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1792138#c51)• 2 years ago |
|  | |

Landed: <https://hg.mozilla.org/mozilla-central/rev/514642d76faac1e27928ef6a94fd945228149925>

Backed out for causing mochitests failures in test\_ext\_protocolHandlers.html:

<https://hg.mozilla.org/integration/autoland/rev/1d70ddd306f3ee70202a2f1dc35b5e774a57d2f5>

Push with failures: <https://treeherder.mozilla.org/jobs?repo=autoland&group_state=expanded&selectedTaskRun=UoluZ5dCSq--InwGWyTR-Q.0&resultStatus=success%2Cpending%2Crunning%2Ctestfailed%2Cbusted%2Cexception%2Cusercancel&searchStr=mochitest&revision=514642d76faac1e27928ef6a94fd945228149925>

Failure log: <https://treeherder.mozilla.org/logviewer?job_id=399473329&repo=autoland>

```
[task 2022-12-13T12:31:34.751Z] 12:31:34     INFO - TEST-PASS | toolkit/components/extensions/test/mochitest/test_ext_protocolHandlers.html | correct url template
[task 2022-12-13T12:31:34.751Z] 12:31:34     INFO - Buffered messages finished
[task 2022-12-13T12:31:34.752Z] 12:31:34     INFO - TEST-UNEXPECTED-FAIL | toolkit/components/extensions/test/mochitest/test_ext_protocolHandlers.html | Test timed out. -

```
Flags: needinfo?(dtownsend)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1792138#c52)• 2 years ago |
|  | |

There's a r+ patch which didn't land and no activity in this bug for 2 weeks.

:mossop, could you have a look please?

If you still have some work to do, you can add an action "Plan Changes" in Phabricator.

For more information, please visit [auto\_nag documentation](https://wiki.mozilla.org/Release_Management/autonag#not_landed.py).

Flags: needinfo?(pbz)Flags: needinfo?(dtownsend)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1792138#c53)• 2 years ago |
|  | |

Back from vacation/sickness, still working on this.

Flags: needinfo?(dtownsend)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1792138#c54)• 2 years ago |
|  | |

Show the extension's name in permission prompts for opening external links. r=ckerschb,robwu,fluent-reviewers,pbz,flod

<https://hg.mozilla.org/integration/autoland/rev/a994887abcef5c2aea8c08775a705b1b74177342>

<https://hg.mozilla.org/mozilla-central/rev/a994887abcef>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox110](/buglist.cgi?f1=cf_status_firefox110&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox110&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 110 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a9359464_75935)• 2 years ago |

[status-firefox107](/buglist.cgi?f1=cf_status_firefox107&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox107&o1=equals&v1=wontfix)
[status-firefox108](/buglist.cgi?f1=cf_status_firefox108&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox108&o1=equals&v1=wontfix)
[status-firefox109](/buglist.cgi?f1=cf_status_firefox109&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox109&o1=equals&v1=wontfix)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fix-optional)Flags: needinfo?(pbz)

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a9366043_553429)• 2 years ago |

Flags: qe-verify-Whiteboard: [reporter-external] [web-bounty-form] [verif?] → [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a9466674_1689)• 2 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a9466685_428608)• 2 years ago |

See Also: → [CVE-2023-32210](/show_bug.cgi?id=1776755 "RESOLVED FIXED - Logic depending on ExpandedPrincipal ordering in `Document::MaybeDowngradePrincipal` is broken")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1792138#c55)• 2 years ago |
|  | |

Is this something we should consider for ESR backport? The new strings wouldn't necessarily be a blocker if yes as flod and I were already discussing doing a bump on ESR this cycle anyway. Looks like there's some test conflicts when testing the graft locally, but the rest appears to go cleanly.

Flags: needinfo?(dtownsend)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a11368006_75935)• 2 years ago |

Blocks: [1814251](/show_bug.cgi?id=1814251 "RESOLVED FIXED - Update l10n-changesets on ESR102")

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a11448794_75935)• 2 years ago |

No longer blocks: [1814251](/show_bug.cgi?id=1814251 "RESOLVED FIXED - Update l10n-changesets on ESR102")Depends on: [1814251](/show_bug.cgi?id=1814251 "RESOLVED FIXED - Update l10n-changesets on ESR102")

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1792138#c56)• 2 years ago |
|  | |

(In reply to Ryan VanderMeulen [:RyanVM] from [comment #55](/show_bug.cgi?id=1792138#c55 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"))

> Is this something we should consider for ESR backport? The new strings wouldn't necessarily be a blocker if yes as flod and I were already discussing doing a bump on ESR this cycle anyway. Looks like there's some test conflicts when testing the graft locally, but the rest appears to go cleanly.

Yes I think this is safe enough to backport. I have a backported patch I'm testing now.

Flags: needinfo?(dtownsend)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a11519738_91159)• 2 years ago |

Flags: needinfo?(dtownsend)

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1792138#c57)• 2 years ago |
|  | |

Attached file
[Bug 1792138: Show the extension's name in permission prompts for opening external links.](attachment.cgi?id=9315845)
— [Details](attachment.cgi?id=9315845&action=edit)

In order to handle the content script case correctly we must expose the

contentScriptAddonPolicy to JavaScript. With that we can always see what

extension is trying to perform an action and use its name rather than internal

ID in the dialog.

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a11525683_600971)• 2 years ago |

[Attachment #9315845](/attachment.cgi?id=9315845&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links.") -
Attachment description: WIP: Bug 1792138: Show the extension's name in permission prompts for opening external links. → Bug 1792138: Show the extension's name in permission prompts for opening external links.

|  | [Dave Townsend [:mossop]](/user_profile?user_id=91159)  Assignee |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1792138#c58)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1792138&comment_id=16265588 "1 revision") |
|  | |

Comment on [attachment 9315845](/attachment.cgi?id=9315845 "Bug 1792138: Show the extension's name in permission prompts for opening external links.") [[details]](/attachment.cgi?id=9315845&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links.")

[Bug 1792138](/show_bug.cgi?id=1792138 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"): Show the extension's name in permission prompts for opening external links.

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: The patch is low risk and would allow us to open up the bug publicly sooner than would otherwise be possible.
* **User impact if declined**: This security issue will still be present in ESR 102
* **Fix Landed on Version**: 110
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The patch has been in Firefox for some time now, has good automated testing coverage and (other than the tests themselves) applied cleanly to the ESR branch.

Note that this patch requires the test-only patch from [bug 1799632](/show_bug.cgi?id=1799632 "RESOLVED FIXED - Refactor `testOpenProto` to make it easier to test different cases").

Flags: needinfo?(dtownsend)
[Attachment #9315845](/attachment.cgi?id=9315845&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links.") -
Flags: approval-mozilla-esr102?

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1792138#c59)• 2 years ago |
|  | |

Comment on [attachment 9315845](/attachment.cgi?id=9315845 "Bug 1792138: Show the extension's name in permission prompts for opening external links.") [[details]](/attachment.cgi?id=9315845&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links.")

[Bug 1792138](/show_bug.cgi?id=1792138 "RESOLVED FIXED - Extensions are not prompted before opening external schemes, leading to security issues"): Show the extension's name in permission prompts for opening external links.

Discussed this with mkaply to be sure there weren't any enterprise concerns with this as it changes some extension workflows, but given that the prompting is once per extension per protocol, it seems like a reasonable trade-off for the added security benefits. Approved for 102.8esr.

[Attachment #9315845](/attachment.cgi?id=9315845&action=edit "Bug 1792138: Show the extension's name in permission prompts for opening external links.") -
Flags: approval-mozilla-esr102? → approval-mozilla-esr102+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1792138#c60)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/673f83d2eaf1>

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fix-optional) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed)
[tracking-firefox110](/buglist.cgi?f1=cf_tracking_firefox110&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox110&o1=equals&v1=%2B)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [110+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=110%2B)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1792138#c61)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9317084)
— [Details](attachment.cgi?id=9317084&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a12138299_578488)• 2 years ago |

Whiteboard: [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage] → [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage][adv-main110+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a12140118_578488)• 2 years ago |

Whiteboard: [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage][adv-main110+] → [reporter-external] [web-bounty-form] [verif?][post-critsmash-triage][adv-main110+][adv-esr102.8+]

|  | [Rob Wu [:robwu]](/user_profile?user_id=447061) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a12390705_447061)• 2 years ago |

See Also: → [1813975](/show_bug.cgi?id=1813975 "UNCONFIRMED - No prompt to choose application for custom link scheme")

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a12412578_626341)• 2 years ago |

Alias: CVE-2023-25729

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a33688673_1689)• 1 year ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1792138#a53180493_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1792138&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Vitor Torres](/user_profile?user_id=713917)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_ecd4389d_20250114_193333.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-06

## Security Vulnerabilities fixed in Firefox ESR 102.8

Announced
February 14, 2023
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 102.8

#### [#CVE-2023-25728: Content security policy leak in violation reports using iframes](#CVE-2023-25728)

Reporter
Johan Carlsson
Impact
high
##### Description

The `Content-Security-Policy-Report-Only` header could allow an attacker to leak a child iframe's unredacted URI when interaction with that iframe triggers a redirect.

##### References

* [Bug 1790345](https://bugzilla.mozilla.org/show_bug.cgi?id=1790345)

#### [#CVE-2023-25730: Screen hijack via browser fullscreen mode](#CVE-2023-25730)

Reporter
Irvan Kurniawan
Impact
high
##### Description

A background script invoking `requestFullscreen` and then blocking the main thread could force the browser into fullscreen mode indefinitely, resulting in potential user confusion or spoofing attacks.

##### References

* [Bug 1794622](https://bugzilla.mozilla.org/show_bug.cgi?id=1794622)

#### [#CVE-2023-0767: Arbitrary memory write via PKCS 12 in NSS](#CVE-2023-0767)

Reporter
Christian Holler
Impact
high
##### Description

An attacker could construct a PKCS 12 cert bundle in such a way that could allow for arbitrary memory writes via PKCS 12 Safe Bag attributes being mishandled.

##### References

* [Bug 1804640](https://bugzilla.mozilla.org/show_bug.cgi?id=1804640)

#### [#CVE-2023-25735: Potential use-after-free from compartment mismatch in SpiderMonkey](#CVE-2023-25735)

Reporter
Samuel Groß
Impact
high
##### Description

Cross-compartment wrappers wrapping a scripted proxy could have caused objects from other compartments to be stored in the main compartment resulting in a use-after-free after unwrapping the proxy.

##### References

* [Bug 1810711](https://bugzilla.mozilla.org/show_bug.cgi?id=1810711)

#### [#CVE-2023-25737: Invalid downcast in SVGUtils::SetupStrokeGeometry](#CVE-2023-25737)

Reporter
Lukas Bernhard
Impact
high
##### Description

An invalid downcast from `nsTextNode` to `SVGElement` could have lead to undefined behavior.

##### References

* [Bug 1811464](https://bugzilla.mozilla.org/show_bug.cgi?id=1811464)

#### [#CVE-2023-25738: Printing on Windows could potentially crash Firefox with some device drivers](#CVE-2023-25738)

Reporter
Mark
Impact
high
##### Description

Members of the `DEVMODEW` struct set by the printer device driver weren't being validated and could have resulted in invalid values which in turn would cause the browser to attempt out of bounds access to related variables.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1811852](https://bugzilla.mozilla.org/show_bug.cgi?id=1811852)

#### [#CVE-2023-25739: Use-after-free in mozilla::dom::ScriptLoadContext::~ScriptLoadContext](#CVE-2023-25739)

Reporter
Holger Fuhrmannek
Impact
high
##### Description

Module load requests that failed were not being checked as to whether or not they were cancelled causing a use-after-free in `ScriptLoadContext`.

##### References

* [Bug 1811939](https://bugzilla.mozilla.org/show_bug.cgi?id=1811939)

#### [#CVE-2023-25729: Extensions could have opened external schemes without user knowledge](#CVE-2023-25729)

Reporter
Vitor Torres
Impact
moderate
##### Description

Permission prompts for opening external schemes were only shown for `ContentPrincipals` resulting in extensions being able to open them without user interaction via `ExpandedPrincipals`. This could lead to further malicious actions such as downloading files or interacting with software already installed on the system.

##### References

* [Bug 1792138](https://bugzilla.mozilla.org/show_bug.cgi?id=1792138)

#### [#CVE-2023-25732: Out of bounds memory write from EncodeInputStream](#CVE-2023-25732)

Reporter
Ronald Crane
Impact
moderate
##### Description

When encoding data from an `inputStream` in `xpcom` the size of the input being encoded was not correctly calculated potentially leading to an out of bounds memory write.

##### References

* [Bug 1804564](https://bugzilla.mozilla.org/show_bug.cgi?id=1804564)

#### [#CVE-2023-25734: Opening local .url files could cause unexpected network loads](#CVE-2023-25734)

Reporter
Ameen Basha M K and Shaheen Fazim
Impact
moderate
##### Description

After downloading a Windows `.url` shortcut from the local filesystem, an attacker could supply a remote path that would lead to unexpected network requests from the operating system. This also had the potential to leak NTLM credentials to the resource.
*This bug only affects Firefox on Windows. Other operating systems are unaffected.*

##### References

* [Bug 1809923](https://bugzilla.mozilla.org/show_bug.cgi?id=1809923)
* [Bug 1784451](https://bugzilla.mozilla.org/show_bug.cgi?id=1784451)
* [Bug 1810143](https://bugzilla.mozilla.org/show_bug.cgi?id=1810143)
* [Bug 1812338](https://bugzilla.mozilla.org/show_bug.cgi?id=1812338)

#### [#CVE-2023-25742: Web Crypto ImportKey crashes tab](#CVE-2023-25742)

Reporter
Goras Francesco
Impact
low
##### Description

When importing a SPKI RSA public key as ECDSA P-256, the key would be handled incorrectly causing the tab to crash.

##### References

* [Bug 1813424](https://bugzilla.mozilla.org/show_bug.cgi?id=1813424)

#### [#CVE-2023-25744: Memory safety bugs fixed in Firefox 110 and Firefox ESR 102.8](#CVE-2023-25744)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Kershaw Chang and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 109 and Firefox ESR 102.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 110 and Firefox ESR 102.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1789449%2C1803628%2C1810536)

#### [#CVE-2023-25746: Memory safety bugs fixed in Firefox ESR 102.8](#CVE-2023-25746)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers Philipp and Gabriele Svelto reported memory safety bugs present in Firefox ESR 102.7. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox ESR 102.8](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1544127%2C1762368)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


