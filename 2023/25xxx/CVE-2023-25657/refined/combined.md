=== Content from github.com_14c58929_20250114_203538.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2Fd47f157e83b0c353bb2b697f911882c71cf90ca0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2Fd47f157e83b0c353bb2b697f911882c71cf90ca0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

## Commit

[Permalink](/nautobot/nautobot/commit/d47f157e83b0c353bb2b697f911882c71cf90ca0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Enforce sandboxed rendering for Jinja2 templates.

[Browse files](/nautobot/nautobot/tree/d47f157e83b0c353bb2b697f911882c71cf90ca0)
Browse the repository at this point in the history

```
- This forces the Jinja2 template renderer to use a `SandboxedEnvironment`
- This addresses any unsafe code execution everywhere `render_jinja2` is called.
- Test added to assert that unsafe attributes cannot be accessed and will result in a `SecurityError`.
- Documentation referencing direct use of `jinja2.Template` replaced with `render_jinja2`
```

* Loading branch information

[![@jathanism](https://avatars.githubusercontent.com/u/138052?s=40&v=4)](/jathanism)

[jathanism](/nautobot/nautobot/commits?author=jathanism "View all commits by jathanism")
committed
Jan 4, 2023

1 parent
[10a092b](/nautobot/nautobot/commit/10a092bbcc184aebdaa27d8c24cc032fe8a1cad2)

commit d47f157

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**24 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* nautobot

  + core

    - nautobot/core/settings.py
      [settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a)
  + docs/models/dcim

    - nautobot/docs/models/dcim/deviceredundancygroup.md
      [deviceredundancygroup.md](#diff-28820ffddc0e3082647608890fba0f906b978f635b2a71d07bc5c8fc5f70c748)
  + utilities/tests

    - nautobot/utilities/tests/test\_jinja\_filters.py
      [test\_jinja\_filters.py](#diff-0754149696b17ce1e1dc04dc1411f1888561d1207aaeccde3a048bf821d5e6f9)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[nautobot/core/settings.py](#diff-6c6cc147c8188d94be8fd3b11345aa4bfef52a760e0961643b6b84d0c26da43a "nautobot/core/settings.py")

Show comments

[View file](/nautobot/nautobot/blob/d47f157e83b0c353bb2b697f911882c71cf90ca0/nautobot/core/settings.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -468,6 +468,7 @@ |
|  |  | "nautobot.core.context\_processors.settings", |
|  |  | "nautobot.core.context\_processors.sso\_auth", |
|  |  | ], |
|  |  | "environment": "jinja2.sandbox.SandboxedEnvironment", |
|  |  | }, |
|  |  | }, |
|  |  | ] |
| Expand Down | |  |

8 changes: 4 additions & 4 deletions

8
[nautobot/docs/models/dcim/deviceredundancygroup.md](#diff-28820ffddc0e3082647608890fba0f906b978f635b2a71d07bc5c8fc5f70c748 "nautobot/docs/models/dcim/deviceredundancygroup.md")

Show comments

[View file](/nautobot/nautobot/blob/d47f157e83b0c353bb2b697f911882c71cf90ca0/nautobot/docs/models/dcim/deviceredundancygroup.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -142,7 +142,7 @@ The following snippet represents an example Cisco ASA failover configuration tem |
|  |  |  |
|  |  | ```python |
|  |  | # Configuration Template for Cisco ASA |
|  |  | template\_body=""" |
|  |  | template\_code = """ |
|  |  | {% set redundancy\_members = gql\_data['data']['devices'][0]['device\_redundancy\_group']['members'] %} |
|  |  | {% set failover\_device\_local = redundancy\_members[0] if redundancy\_members[0].name == device else redundancy\_members[1] %} |
|  |  | {% set failover\_device\_peer = redundancy\_members[0] if redundancy\_members[0].name != device else redundancy\_members[1] %} |
| Expand Down  Expand Up | | @@ -172,15 +172,15 @@ failover |
|  |  | Following snippet represents an example Cisco ASA Failover rendered configuration: |
|  |  |  |
|  |  | ```python |
|  |  | from jinja2 import Template |
|  |  | from nautobot.utilities.utils import render\_jinja2 |
|  |  |  |
|  |  | tm=Template(template\_body) |
|  |  |  |
|  |  | nyc\_fw\_primary\_config = tm.render( |
|  |  | context = dict( |
|  |  | device=hostname, |
|  |  | gql\_data=gql\_data, |
|  |  | priority\_mapping={50: 'secondary', 100: 'primary'} |
|  |  | ) |
|  |  | nyc\_fw\_primary\_config = render\_jinja2(template\_code=template\_code, context=context) |
|  |  |  |
|  |  | print(nyc\_fw\_primary\_config) |
|  |  | ``` |
| Expand Down | |  |

21 changes: 19 additions & 2 deletions

21
[nautobot/utilities/tests/test\_jinja\_filters.py](#diff-0754149696b17ce1e1dc04dc1411f1888561d1207aaeccde3a048bf821d5e6f9 "nautobot/utilities/tests/test_jinja_filters.py")

Show comments

[View file](/nautobot/nautobot/blob/d47f157e83b0c353bb2b697f911882c71cf90ca0/nautobot/utilities/tests/test_jinja_filters.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,9 +1,9 @@ |
|  |  | from django.test import TestCase |
|  |  | from jinja2.exceptions import TemplateAssertionError |
|  |  |  |
|  |  | from jinja2.exceptions import SecurityError, TemplateAssertionError |
|  |  | from netutils.utils import jinja2\_convenience\_function |
|  |  |  |
|  |  | from nautobot.utilities.utils import render\_jinja2 |
|  |  | from nautobot.dcim.models import Site |
|  |  |  |
|  |  |  |
|  |  | class NautobotJinjaFilterTest(TestCase): |
| Expand Down  Expand Up | | @@ -64,3 +64,20 @@ def test\_netutils\_filters\_in\_jinja(self): |
|  |  | raise |
|  |  | except Exception: |
|  |  | pass |
|  |  |  |
|  |  | def test\_sandboxed\_render(self): |
|  |  | """Assert that Jinja template rendering is sandboxed.""" |
|  |  | template\_code = "{{ ''.\_\_class\_\_.\_\_name\_\_ }}" |
|  |  | with self.assertRaises(SecurityError): |
|  |  | render\_jinja2(template\_code=template\_code, context={}) |
|  |  |  |
|  |  | def test\_safe\_render(self): |
|  |  | """Assert that safe Jinja rendering still works.""" |
|  |  | site = Site.objects.filter(region\_\_isnull=False).first() |
|  |  | template\_code = "{{ obj.region.name }}" |
|  |  | try: |
|  |  | value = render\_jinja2(template\_code=template\_code, context={"obj": site}) |
|  |  | except SecurityError: |
|  |  | self.fail("SecurityError raised on safe Jinja template render") |
|  |  | else: |
|  |  | self.assertEqual(value, site.region.name) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d47f157`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fcommit%2Fd47f157e83b0c353bb2b697f911882c71cf90ca0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from jinja.palletsprojects.com_fb9e198c_20250114_203541.html ===

### Navigation

* [index](../genindex/ "General Index")
* [modules](../py-modindex/ "Python Module Index") |
* [next](../nativetypes/ "Native Python Types") |
* [previous](../api/ "API") |
* [Jinja Documentation (3.1.x)](../) »
* Sandbox

# Sandbox[¶](#sandbox "Link to this heading")

The Jinja sandbox can be used to render untrusted templates. Access to
attributes, method calls, operators, mutating data structures, and
string formatting can be intercepted and prohibited.

```
>>> from jinja2.sandbox import SandboxedEnvironment
>>> env = SandboxedEnvironment()
>>> func = lambda: "Hello, Sandbox!"
>>> env.from_string("{{ func() }}").render(func=func)
'Hello, Sandbox!'
>>> env.from_string("{{ func.__code__.co_code }}").render(func=func)
Traceback (most recent call last):
  ...
SecurityError: access to attribute '__code__' of 'function' object is unsafe.

```

A sandboxed environment can be useful, for example, to allow users of an
internal reporting system to create custom emails. You would document
what data is available in the templates, then the user would write a
template using that information. Your code would generate the report
data and pass it to the user’s sandboxed template to render.

## Security Considerations[¶](#security-considerations "Link to this heading")

The sandbox alone is not a solution for perfect security. Keep these
things in mind when using the sandbox.

Templates can still raise errors when compiled or rendered. Your code
should attempt to catch errors instead of crashing.

It is possible to construct a relatively small template that renders to
a very large amount of output, which could correspond to a high use of
CPU or memory. You should run your application with limits on resources
such as CPU and memory to mitigate this.

Jinja only renders text, it does not understand, for example, JavaScript
code. Depending on how the rendered template will be used, you may need
to do other postprocessing to restrict the output.

Pass only the data that is relevant to the template. Avoid passing
global data, or objects with methods that have side effects. By default
the sandbox prevents private and internal attribute access. You can
override `is_safe_attribute()` to further
restrict attributes access. Decorate methods with `unsafe()` to
prevent calling them from templates when passing objects as data. Use
`ImmutableSandboxedEnvironment` to prevent modifying lists and
dictionaries.

## API[¶](#module-jinja2.sandbox "Link to this heading")

*class* jinja2.sandbox.SandboxedEnvironment([*options*])[¶](#jinja2.sandbox.SandboxedEnvironment "Link to this definition")

The sandboxed environment. It works like the regular environment but
tells the compiler to generate sandboxed code. Additionally subclasses of
this environment may override the methods that tell the runtime what
attributes or functions are safe to access.

If the template tries to access insecure code a [`SecurityError`](#jinja2.sandbox.SecurityError "jinja2.sandbox.SecurityError") is
raised. However also other exceptions may occur during the rendering so
the caller has to ensure that all exceptions are caught.

Parameters:

* **args** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **kwargs** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

default\_binop\_table*: [Dict](https://docs.python.org/3/library/typing.html#typing.Dict "(in Python v3.13)")[[str](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"), [Callable](https://docs.python.org/3/library/typing.html#typing.Callable "(in Python v3.13)")[[[Any](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"), [Any](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")], [Any](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")]]* *= {'%': <built-in function mod>, '\*': <built-in function mul>, '\*\*': <built-in function pow>, '+': <built-in function add>, '-': <built-in function sub>, '/': <built-in function truediv>, '//': <built-in function floordiv>}*[¶](#jinja2.sandbox.SandboxedEnvironment.default_binop_table "Link to this definition")

default callback table for the binary operators. A copy of this is
available on each instance of a sandboxed environment as
`binop_table`

default\_unop\_table*: [Dict](https://docs.python.org/3/library/typing.html#typing.Dict "(in Python v3.13)")[[str](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"), [Callable](https://docs.python.org/3/library/typing.html#typing.Callable "(in Python v3.13)")[[[Any](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")], [Any](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")]]* *= {'+': <built-in function pos>, '-': <built-in function neg>}*[¶](#jinja2.sandbox.SandboxedEnvironment.default_unop_table "Link to this definition")

default callback table for the unary operators. A copy of this is
available on each instance of a sandboxed environment as
`unop_table`

intercepted\_binops*: [FrozenSet](https://docs.python.org/3/library/typing.html#typing.FrozenSet "(in Python v3.13)")[[str](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")]* *= frozenset({})*[¶](#jinja2.sandbox.SandboxedEnvironment.intercepted_binops "Link to this definition")

a set of binary operators that should be intercepted. Each operator
that is added to this set (empty by default) is delegated to the
[`call_binop()`](#jinja2.sandbox.SandboxedEnvironment.call_binop "jinja2.sandbox.SandboxedEnvironment.call_binop") method that will perform the operator. The default
operator callback is specified by `binop_table`.

The following binary operators are interceptable:
`//`, `%`, `+`, `*`, `-`, `/`, and `**`

The default operation form the operator table corresponds to the
builtin function. Intercepted calls are always slower than the native
operator call, so make sure only to intercept the ones you are
interested in.

Changelog

Added in version 2.6.

intercepted\_unops*: [FrozenSet](https://docs.python.org/3/library/typing.html#typing.FrozenSet "(in Python v3.13)")[[str](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)")]* *= frozenset({})*[¶](#jinja2.sandbox.SandboxedEnvironment.intercepted_unops "Link to this definition")

a set of unary operators that should be intercepted. Each operator
that is added to this set (empty by default) is delegated to the
[`call_unop()`](#jinja2.sandbox.SandboxedEnvironment.call_unop "jinja2.sandbox.SandboxedEnvironment.call_unop") method that will perform the operator. The default
operator callback is specified by `unop_table`.

The following unary operators are interceptable: `+`, `-`

The default operation form the operator table corresponds to the
builtin function. Intercepted calls are always slower than the native
operator call, so make sure only to intercept the ones you are
interested in.

Changelog

Added in version 2.6.

is\_safe\_attribute(*obj*, *attr*, *value*)[¶](#jinja2.sandbox.SandboxedEnvironment.is_safe_attribute "Link to this definition")

The sandboxed environment will call this method to check if the
attribute of an object is safe to access. Per default all attributes
starting with an underscore are considered private as well as the
special attributes of internal python objects as returned by the
[`is_internal_attribute()`](#jinja2.sandbox.is_internal_attribute "jinja2.sandbox.is_internal_attribute") function.

Parameters:

* **obj** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **attr** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"))
* **value** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

Return type:

[bool](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")

is\_safe\_callable(*obj*)[¶](#jinja2.sandbox.SandboxedEnvironment.is_safe_callable "Link to this definition")

Check if an object is safely callable. By default callables
are considered safe unless decorated with [`unsafe()`](#jinja2.sandbox.unsafe "jinja2.sandbox.unsafe").

This also recognizes the Django convention of setting
`func.alters_data = True`.

Parameters:

**obj** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

Return type:

[bool](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")

call\_binop(*context*, *operator*, *left*, *right*)[¶](#jinja2.sandbox.SandboxedEnvironment.call_binop "Link to this definition")

For intercepted binary operator calls ([`intercepted_binops()`](#jinja2.sandbox.SandboxedEnvironment.intercepted_binops "jinja2.sandbox.SandboxedEnvironment.intercepted_binops"))
this function is executed instead of the builtin operator. This can
be used to fine tune the behavior of certain operators.

Changelog

Added in version 2.6.

Parameters:

* **context** ([*Context*](../api/#jinja2.runtime.Context "jinja2.runtime.Context"))
* **operator** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"))
* **left** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **right** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

Return type:

[*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")

call\_unop(*context*, *operator*, *arg*)[¶](#jinja2.sandbox.SandboxedEnvironment.call_unop "Link to this definition")

For intercepted unary operator calls ([`intercepted_unops()`](#jinja2.sandbox.SandboxedEnvironment.intercepted_unops "jinja2.sandbox.SandboxedEnvironment.intercepted_unops"))
this function is executed instead of the builtin operator. This can
be used to fine tune the behavior of certain operators.

Changelog

Added in version 2.6.

Parameters:

* **context** ([*Context*](../api/#jinja2.runtime.Context "jinja2.runtime.Context"))
* **operator** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"))
* **arg** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

Return type:

[*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)")

*class* jinja2.sandbox.ImmutableSandboxedEnvironment([*options*])[¶](#jinja2.sandbox.ImmutableSandboxedEnvironment "Link to this definition")

Works exactly like the regular `SandboxedEnvironment` but does not
permit modifications on the builtin mutable objects `list`, `set`, and
`dict` by using the [`modifies_known_mutable()`](#jinja2.sandbox.modifies_known_mutable "jinja2.sandbox.modifies_known_mutable") function.

Parameters:

* **args** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **kwargs** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))

*exception* jinja2.sandbox.SecurityError(*message=None*)[¶](#jinja2.sandbox.SecurityError "Link to this definition")

Raised if a template tries to do something insecure if the
sandbox is enabled.

Parameters:

**message** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)") *|* *None*)

Return type:

None

jinja2.sandbox.unsafe(*f*)[¶](#jinja2.sandbox.unsafe "Link to this definition")

Marks a function or method as unsafe.

Parameters:

**f** (*F*)

Return type:

*F*

jinja2.sandbox.is\_internal\_attribute(*obj*, *attr*)[¶](#jinja2.sandbox.is_internal_attribute "Link to this definition")

Test if the attribute given is an internal python attribute. For
example this function returns `True` for the `func_code` attribute of
python objects. This is useful if the environment method
[`is_safe_attribute()`](#jinja2.sandbox.SandboxedEnvironment.is_safe_attribute "jinja2.sandbox.SandboxedEnvironment.is_safe_attribute") is overridden.

```
>>> from jinja2.sandbox import is_internal_attribute
>>> is_internal_attribute(str, "mro")
True
>>> is_internal_attribute(str, "upper")
False

```

Parameters:

* **obj** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **attr** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"))

Return type:

[bool](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")

jinja2.sandbox.modifies\_known\_mutable(*obj*, *attr*)[¶](#jinja2.sandbox.modifies_known_mutable "Link to this definition")

This function checks if an attribute on a builtin mutable object
(list, dict, set or deque) or the corresponding ABCs would modify it
if called.

```
>>> modifies_known_mutable({}, "clear")
True
>>> modifies_known_mutable({}, "keys")
False
>>> modifies_known_mutable([], "append")
True
>>> modifies_known_mutable([], "index")
False

```

If called with an unsupported object, `False` is returned.

```
>>> modifies_known_mutable("foo", "upper")
False

```

Parameters:

* **obj** ([*Any*](https://docs.python.org/3/library/typing.html#typing.Any "(in Python v3.13)"))
* **attr** ([*str*](https://docs.python.org/3/library/stdtypes.html#str "(in Python v3.13)"))

Return type:

[bool](https://docs.python.org/3/library/functions.html#bool "(in Python v3.13)")

## Operator Intercepting[¶](#operator-intercepting "Link to this heading")

For performance, Jinja outputs operators directly when compiling. This
means it’s not possible to intercept operator behavior by overriding
`SandboxEnvironment.call` by default, because
operator special methods are handled by the Python interpreter, and
might not correspond with exactly one method depending on the operator’s
use.

The sandbox can instruct the compiler to output a function to intercept
certain operators instead. Override
[`SandboxedEnvironment.intercepted_binops`](#jinja2.sandbox.SandboxedEnvironment.intercepted_binops "jinja2.sandbox.SandboxedEnvironment.intercepted_binops") and
[`SandboxedEnvironment.intercepted_unops`](#jinja2.sandbox.SandboxedEnvironment.intercepted_unops "jinja2.sandbox.SandboxedEnvironment.intercepted_unops") with the operator symbols
you want to intercept. The compiler will replace the symbols with calls
to [`SandboxedEnvironment.call_binop()`](#jinja2.sandbox.SandboxedEnvironment.call_binop "jinja2.sandbox.SandboxedEnvironment.call_binop") and
[`SandboxedEnvironment.call_unop()`](#jinja2.sandbox.SandboxedEnvironment.call_unop "jinja2.sandbox.SandboxedEnvironment.call_unop") instead. The default
implementation of those methods will use
`SandboxedEnvironment.binop_table` and
`SandboxedEnvironment.unop_table` to translate operator symbols
into [`operator`](https://docs.python.org/3/library/operator.html#module-operator "(in Python v3.13)") functions.

For example, the power (`**`) operator can be disabled:

```
from jinja2.sandbox import SandboxedEnvironment

class MyEnvironment(SandboxedEnvironment):
    intercepted_binops = frozenset(["**"])

    def call_binop(self, context, operator, left, right):
        if operator == "**":
            return self.undefined("The power (**) operator is unavailable.")

        return super().call_binop(self, context, operator, left, right)

```

[![Logo of Jinja](../_static/jinja-logo-sidebar.png)](../)

### Contents

* Sandbox
  + [Security Considerations](#security-considerations)
  + [API](#module-jinja2.sandbox)
    - [`SandboxedEnvironment`](#jinja2.sandbox.SandboxedEnvironment)
      * [`SandboxedEnvironment.default_binop_table`](#jinja2.sandbox.SandboxedEnvironment.default_binop_table)
      * [`SandboxedEnvironment.default_unop_table`](#jinja2.sandbox.SandboxedEnvironment.default_unop_table)
      * [`SandboxedEnvironment.intercepted_binops`](#jinja2.sandbox.SandboxedEnvironment.intercepted_binops)
      * [`SandboxedEnvironment.intercepted_unops`](#jinja2.sandbox.SandboxedEnvironment.intercepted_unops)
      * [`SandboxedEnvironment.is_safe_attribute()`](#jinja2.sandbox.SandboxedEnvironment.is_safe_attribute)
      * [`SandboxedEnvironment.is_safe_callable()`](#jinja2.sandbox.SandboxedEnvironment.is_safe_callable)
      * [`SandboxedEnvironment.call_binop()`](#jinja2.sandbox.SandboxedEnvironment.call_binop)
      * [`SandboxedEnvironment.call_unop()`](#jinja2.sandbox.SandboxedEnvironment.call_unop)
    - [`ImmutableSandboxedEnvironment`](#jinja2.sandbox.ImmutableSandboxedEnvironment)
    - [`SecurityError`](#jinja2.sandbox.SecurityError)
    - [`unsafe()`](#jinja2.sandbox.unsafe)
    - [`is_internal_attribute()`](#jinja2.sandbox.is_internal_attribute)
    - [`modifies_known_mutable()`](#jinja2.sandbox.modifies_known_mutable)
  + [Operator Intercepting](#operator-intercepting)

### Navigation

* [Overview](../)
  + Previous: [API](../api/ "previous chapter")+ Next: [Native Python Types](../nativetypes/ "next chapter")

### Quick search

© Copyright 2007 Pallets.
Created using [Sphinx](https://www.sphinx-doc.org/) 8.1.3.



=== Content from github.com_09496370_20250114_203539.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-8mfq-f5wj-vw5m)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnautobot%2Fnautobot%2Fsecurity%2Fadvisories%2FGHSA-8mfq-f5wj-vw5m)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=nautobot%2Fnautobot)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nautobot](/nautobot)
/
**[nautobot](/nautobot/nautobot)**
Public

* [Notifications](/login?return_to=%2Fnautobot%2Fnautobot) You must be signed in to change notification settings
* [Fork
  298](/login?return_to=%2Fnautobot%2Fnautobot)
* [Star
   1.1k](/login?return_to=%2Fnautobot%2Fnautobot)

* [Code](/nautobot/nautobot)
* [Issues
  863](/nautobot/nautobot/issues)
* [Pull requests
  24](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects
  0](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

Additional navigation options

* [Code](/nautobot/nautobot)
* [Issues](/nautobot/nautobot/issues)
* [Pull requests](/nautobot/nautobot/pulls)
* [Discussions](/nautobot/nautobot/discussions)
* [Actions](/nautobot/nautobot/actions)
* [Projects](/nautobot/nautobot/projects)
* [Wiki](/nautobot/nautobot/wiki)
* [Security](/nautobot/nautobot/security)
* [Insights](/nautobot/nautobot/pulse)

# Remote code execution in Jinja2 template rendering

High

[jathanism](/jathanism)
published
GHSA-8mfq-f5wj-vw5m
Feb 21, 2023

## Package

pip

nautobot
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<1.5.7

## Patched versions

1.5.7

## Description

### Impact

*What kind of vulnerability is it? Who is impacted?*

All users of Nautobot versions earlier than 1.5.7 are impacted.

In Nautobot 1.5.7 we have enabled sandboxed environments for the Jinja2 template engine used internally for template rendering for the following objects:

* `extras.ComputedField`
* `extras.CustomLink`
* `extras.ExportTemplate`
* `extras.Secret`
* `extras.Webhook`

While we are not aware of any active exploits, we have made this change as a preventative measure to protect against any potential remote code execution attacks utilizing maliciously crafted template code.

This change forces the Jinja2 template engine to use a [`SandboxedEnvironment`](https://jinja.palletsprojects.com/en/3.0.x/sandbox/#sandbox) on all new installations of Nautobot.

This addresses any potential unsafe code execution everywhere the helper function `nautobot.utilities.utils.render_jinja2` is called. Additionally, our documentation that was previously suggesting the direct use of `jinja2.Template` has been revised to utilize `render_jinja2`.

### Patches

*Has the problem been patched? What versions should users upgrade to?*

Yes. Users should upgrade to Nautobot 1.5.7 or newer.

### Workarounds

*Is there a way for users to fix or remediate the vulnerability without upgrading?*

##### Enabling Sandboxed Environments

For users that are unable to upgrade to the latest release of Nautobot, you may add the following setting to your `nautobot_config.py` to apply the sandbox environment enforcement:

```
TEMPLATES[1]["OPTIONS"]["environment"] = "jinja2.sandbox.SandboxedEnvironment"
```

After applying this change, you must restart all Nautobot services, including any Celery worker processes.

**Note:** *Nautobot specifies two template engines by default, the first being “django” for the Django built-in template engine, and the second being “jinja” for the Jinja2 template engine. This recommended setting will update the second item in the list of template engines, which is the Jinja2 engine.*

##### Restricting Jinja2 using Access Controls

For users that are unable to immediately update their configuration such as if a Nautobot service restart is too disruptive to operations, access to provide custom Jinja2 template values may be mitigated using permissions to restrict “change” (write) actions to the affected object types listed in the first section.

**Note:** *This solution is intended to be stopgap until you can successfully update your `nautobot_config.py` or upgrade your Nautobot instance to apply the sandboxed environment enforcement.*

#### Updating Existing App or Job Code

For Nautobot App (formerly plugin) authors or Job authors, additionally we recommend that if you have any custom code that may for example be using `jinaj2.Template` that you no longer use that. Instead, please always use our `nautobot.utilities.utils.render_jinja2` function which will make sure that the centrally-provided Jinja2 template engine with sandboxing enforced is being utilized.

Anywhere you’ve been using this pattern:

```
from jinja2 import Template

my_template = Template(template_code)
config = my_template.render(context)
```

We recommend that you replace it with this pattern:

```
from nautobot.utilities.utils import render_jinja2

config = render_jinja2(template_code, context)
```
### References

*Are there any links users can visit to find out more?*

Please see the Nautobot 1.5.7 release notes.

<https://docs.nautobot.com/projects/core/en/stable/release-notes/version-1.5/#v157-2023-01-04>

### Credit

Credit for discovery of this vulnerability goes to [XiaoC of TT-Lab](https://twitter.com/XiaoC75068775).

### Severity

High

7.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-25657

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


