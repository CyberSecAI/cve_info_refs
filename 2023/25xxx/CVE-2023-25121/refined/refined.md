- **Root cause of vulnerability:** The `vtysh_ubus` binary uses `sprintf` with user-controlled data, leading to buffer overflows.
- **Weaknesses/vulnerabilities present:** Multiple stack-based buffer overflow vulnerabilities in the `vtysh_ubus` binary exist due to unsafe usage of `sprintf`. Specifically, the `sprintf` function is used to format strings with data derived from user-provided JSON input, without proper bounds checking.
- **Impact of exploitation:** Successful exploitation can lead to arbitrary code execution on the device.
- **Attack vectors:** An attacker with high privileges can send specially crafted HTTP POST requests to the `/cgi` endpoint to trigger these vulnerabilities. The JSON data within the request is parsed, and specific keys are used as arguments for the vulnerable `sprintf` calls.
- **Required attacker capabilities/position:** The attacker needs to have high privileges on the Milesight UR32L device to send the malicious HTTP requests.
- **Specific vulnerability details for CVE-2023-25121:** In the `set_ike_profile` function, the `secrets_local` JSON key is used to fetch its value which then is passed to a `sprintf` function. If the version is 1, `pre-shared-key %s` format string is used, and if version is 2, `pre-shared-key local %s` is used. By providing a long string for the `secrets_local` value, a buffer overflow can be triggered.