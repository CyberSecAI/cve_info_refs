=== Content from git.kernel.org_dc21b16a_20250115_082754.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pietro Borrello <borrello@diag.uniroma1.it> | 2023-02-12 19:00:00 +0000 |
| --- | --- | --- |
| committer | Benjamin Tissoires <benjamin.tissoires@redhat.com> | 2023-02-15 18:18:48 +0100 |
| commit | [27d2a2fd844ec7da70d19fabb482304fd1e0595b](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)) | |
| tree | [bea7e2485ec52fe993fa808bee0b664e1721b1d4](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b) | |
| parent | [9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b&id2=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)) | |
| download | [linux-27d2a2fd844ec7da70d19fabb482304fd1e0595b.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-27d2a2fd844ec7da70d19fabb482304fd1e0595b.tar.gz) | |

HID: bigben\_worker() remove unneeded check on report\_fieldbigben\_worker() checks report\_field to be non-NULL.
The check has been added in commit
918aa1ef104d ("HID: bigbenff: prevent null pointer dereference")
to prevent a NULL pointer crash.
However, the true root cause was a missing check for output
reports, patched in commit
c7bf714f8755 ("HID: check empty report\_list in bigben\_probe()"),
where the type-confused report list\_entry was overlapping with
a NULL pointer, which was then causing the crash.
Fixes: 918aa1ef104d ("HID: bigbenff: prevent null pointer dereference")
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>
Link: [https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-2-7860c5763c38@diag.uniroma1.it](https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-2-7860c5763c38%40diag.uniroma1.it)
Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)

| -rw-r--r-- | [drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/hid-bigbenff.c?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/hid/hid-bigbenff.c b/drivers/hid/hid-bigbenff.cindex ed3d2d7bc1dd46..b98c5f31c184bb 100644--- a/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)+++ b/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)@@ -197,7 +197,7 @@ static void bigben\_worker(struct work\_struct \*work) u32 len; unsigned long flags; - if (bigben->removed || !report\_field)+ if (bigben->removed) return;  buf = hid\_alloc\_report\_buf(bigben->report, GFP\_KERNEL); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:26:32 +0000



=== Content from idp-portal.suse.com_6b95d262_20250115_213648.html ===

## UCS

# Welcome to Univention Corporate Server

## JavaScript required

A browser with JavaScript enabled is required in order to use this service.

When using Internet Explorer, please check your security settings and add this address to your trusted sites.



=== Content from seclists.org_ca3b16e9_20250115_082757.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

[![oss-sec logo](/images/oss-sec-logo.png)](/oss-sec/)
## [oss-sec](/oss-sec/) mailing list archives

[![Previous](/images/left-icon-16x16.png)](52)
[By Date](date.html#53)
[![Next](/images/right-icon-16x16.png)](54)

[![Previous](/images/left-icon-16x16.png)](59)
[By Thread](index.html#53)
[![Next](/images/right-icon-16x16.png)](74)

![](/shared/images/nst-icons.svg#search)

# Linux Kernel: hid: Use-After-Free in bigben\_set\_led()

---

*From*: Pietro Borrello <borrello () diag uniroma1 it>

*Date*: Wed, 25 Jan 2023 23:33:09 +0100

---

```
Hi all,

I'm disclosing a Use After Free that may be triggered when plugging in a
malicious USB device, which advertises itself as a bigben device.

The device uses a worker `bigben_worker` scheduled by bigben_set_led() to
communicate with the hardware.
The work_struct is embedded in `struct bigben_device`, and at device removal,
`struct bigben_device` is freed.

However, concurrently with device removal, the LED controller bigben_set_led()
may schedule a worker whose use would result in a use-after-free.

Following the debug check triggered by freeing a work_struct in use:
```
[   37.803135][ T1170] usb 1-1: USB disconnect, device number 2
[   37.827979][ T1170] ODEBUG: free active (active state 0) object
type: work_struct hint: bigben_worker+0x0/0x860
[   37.829634][ T1170] WARNING: CPU: 0 PID: 1170 at
lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
[   37.830904][ T1170] Modules linked in:
[   37.831413][ T1170] CPU: 0 PID: 1170 Comm: kworker/0:3 Not tainted
6.1.0-rc4-dirty #43
[   37.832465][ T1170] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[   37.833751][ T1170] Workqueue: usb_hub_wq hub_event
[   37.834409][ T1170] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
[   37.835218][ T1170] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
05 4f 7c 17
[   37.837667][ T1170] RSP: 0018:ffffc900006fee60 EFLAGS: 00010246
[   37.838503][ T1170] RAX: 0d2d19ffcded3d00 RBX: 0000000000000000
RCX: ffff888117fc9b00
[   37.839519][ T1170] RDX: 0000000000000000 RSI: 0000000000000000
RDI: 0000000000000000
[   37.840570][ T1170] RBP: ffffffff86e88380 R08: ffffffff8130793b
R09: fffff520000dfd85
[   37.841618][ T1170] R10: fffff520000dfd85 R11: 0000000000000000
R12: ffffffff87095fb8
[   37.842649][ T1170] R13: ffff888117770ad8 R14: ffff888117770acc
R15: ffffffff852b7420
[   37.843728][ T1170] FS:  0000000000000000(0000)
GS:ffff8881f6600000(0000) knlGS:0000000000000000
[   37.844877][ T1170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   37.845749][ T1170] CR2: 00007f992eaab380 CR3: 000000011834b000
CR4: 00000000001006f0
[   37.846794][ T1170] Call Trace:
[   37.847245][ T1170]  <TASK>
[   37.847643][ T1170]  slab_free_freelist_hook+0x89/0x160
[   37.848409][ T1170]  ? devres_release_all+0x262/0x350
[   37.849156][ T1170]  __kmem_cache_free+0x71/0x110
[   37.849829][ T1170]  devres_release_all+0x262/0x350
[   37.850478][ T1170]  ? devres_release+0x90/0x90
[   37.851118][ T1170]  device_release_driver_internal+0x5e5/0x8a0
[   37.851944][ T1170]  bus_remove_device+0x2ea/0x400
[   37.852611][ T1170]  device_del+0x64f/0xb40
[   37.853212][ T1170]  ? kill_device+0x150/0x150
[   37.853831][ T1170]  ? print_irqtrace_events+0x1f0/0x1f0
[   37.854564][ T1170]  hid_destroy_device+0x66/0x100
[   37.855226][ T1170]  usbhid_disconnect+0x9a/0xc0
[   37.855887][ T1170]  usb_unbind_interface+0x1e1/0x890
```

And the KASAN error report:
```
[ 138.349079][  T7] usb 1-1: USB disconnect, device number 2
[ 138.381243][ T1175]
==================================================================
[ 138.382329][ T1175] BUG: KASAN: use-after-free in __list_add_valid+0x66/0x100
[ 138.383272][ T1175] Read of size 8 at addr ffff88810d62de70 by task
systemd-udevd/1175
[ 138.384238][ T1175]
[ 138.384531][ T1175] CPU: 0 PID: 1175 Comm: systemd-udevd Not tainted
6.1.0-rc4-dirty #30
[ 138.385541][ T1175] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[ 138.386725][ T1175] Call Trace:
[ 138.387145][ T1175] <TASK>
[ 138.387515][ T1175] dump_stack_lvl+0x1b1/0x28e
[ 138.388112][ T1175] ? nf_tcp_handle_invalid+0x3ff/0x3ff
[ 138.388961][ T1175] ? __wake_up_klogd+0xdb/0x110
[ 138.389756][ T1175] ? panic+0x822/0x822
[ 138.390246][ T1175] ? _printk+0xc0/0x100
[ 138.390763][ T1175] print_address_description+0x7d/0x340
[ 138.391454][ T1175] print_report+0x107/0x1f0
[ 138.391995][ T1175] ? __virt_addr_valid+0x211/0x2c0
[ 138.392625][ T1175] ? __phys_addr+0xb5/0x160
[ 138.393176][ T1175] ? __list_add_valid+0x66/0x100
[ 138.393782][ T1175] kasan_report+0xcd/0x100
[ 138.394330][ T1175] ? __list_add_valid+0x66/0x100
[ 138.394955][ T1175] __list_add_valid+0x66/0x100
[ 138.395542][ T1175] insert_work+0x10e/0x3c0
[ 138.396119][ T1175] __queue_work+0xa97/0xde0
[...]
[ 138.403915][ T1175] __sys_bind+0x210/0x2b0
[ 138.404458][ T1175] ? __ia32_sys_socketpair+0xb0/0xb0
[ 138.405097][ T1175] ? lockdep_hardirqs_on_prepare+0x428/0x790
[ 138.405833][ T1175] __x64_sys_bind+0x76/0x80
[ 138.406378][ T1175] do_syscall_64+0x3d/0x90
[ 138.406931][ T1175] entry_SYSCALL_64_after_hwframe+0x63/0xcd
[ 138.407689][ T1175] RIP: 0033:0x7fe2d052d9e7
[ 138.408241][ T1175] Code: 83 c4 08 48 3d 01 f0 ff ff 73 01 c3 48 8b
0d a8 f4 2a 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 b8 31
00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 81 f4 2a 00 f7 d8
64 89 01 48
[ 138.410572][ T1175] RSP: 002b:00007ffca13ea088 EFLAGS: 00000246
ORIG_RAX: 0000000000000031
[ 138.411571][ T1175] RAX: ffffffffffffffda RBX: 0000560b0c5b0f90 RCX:
00007fe2d052d9e7
[ 138.412542][ T1175] RDX: 000000000000000c RSI: 0000560b0c5b0fa0 RDI:
000000000000000e
[ 138.413525][ T1175] RBP: 0000000000000000 R08: 0000560b0c5960e0 R09:
0000000000000210
[ 138.414530][ T1175] R10: 000000000000000f R11: 0000000000000246 R12:
0000560b0c5a8e94
[ 138.415494][ T1175] R13: 0000000000000000 R14: 0000560b0c596010 R15:
0000560b0c596028
[ 138.416499][ T1175] </TASK>
[ 138.416905][ T1175]
[ 138.416499][ T1175] </TASK>
[ 138.416905][ T1175]
[ 138.417197][ T1175] Allocated by task 7:
[ 138.417706][ T1175] kasan_set_track+0x3d/0x60
[ 138.418271][ T1175] __kasan_kmalloc+0x7c/0x90
[ 138.418867][ T1175] __kmalloc_node_track_caller+0xad/0x1a0
[ 138.419583][ T1175] devm_kmalloc+0x77/0x1a0
[ 138.420141][ T1175] bigben_probe+0x2f/0x770
[ 138.420678][ T1175] hid_device_probe+0x251/0x3f0
[...]
[ 138.446475][ T1175]
[ 138.446775][ T1175] Freed by task 7:
[ 138.447232][ T1175] kasan_set_track+0x3d/0x60
[ 138.447798][ T1175] kasan_save_free_info+0x2e/0x50
[ 138.448410][ T1175] ____kasan_slab_free+0xb0/0x100
[ 138.449039][ T1175] slab_free_freelist_hook+0x80/0x140
[ 138.449696][ T1175] __kmem_cache_free+0x71/0x110
[ 138.450292][ T1175] devres_release_all+0x262/0x350
[ 138.450925][ T1175] device_release_driver_internal+0x5e5/0x8a0
[ 138.451667][ T1175] bus_remove_device+0x2ea/0x400
[ 138.452293][ T1175] device_del+0x64f/0xb40
[ 138.452825][ T1175] hid_destroy_device+0x66/0x100
[ 138.453424][ T1175] usbhid_disconnect+0x9a/0xc0
[...]
[ 138.462307][ T1175]
```

The proposed patch deregisters the LED controller bigben_set_led() before
freeing the device and is currently under discussion with the maintainers.

Best regards,
Pietro Borrello

```

---

[![Previous](/images/left-icon-16x16.png)](52)
[By Date](date.html#53)
[![Next](/images/right-icon-16x16.png)](54)

[![Previous](/images/left-icon-16x16.png)](59)
[By Thread](index.html#53)
[![Next](/images/right-icon-16x16.png)](74)

### Current thread:

* **Linux Kernel: hid: Use-After-Free in bigben\_set\_led()** *Pietro Borrello (Jan 25)*
  + [Re: Linux Kernel: hid: Use-After-Free in bigben\_set\_led()](74) *Thomas Leroy (Feb 02)*

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from lore.kernel.org_6c402a24_20250115_132048.html ===

```
[All of lore.kernel.org](../?t=20230131130908)
 [help](../_/text/help/) / [color](../_/text/color/) / [mirror](../_/text/mirror/) / [Atom feed](../new.atom)
```
```
From: Pietro Borrello <borrello@diag.uniroma1.it>
To: Jiri Kosina <jikos@kernel.org>,
	Benjamin Tissoires <benjamin.tissoires@redhat.com>,
	Hanno Zulla <kontakt@hanno.de>, Pavel Machek <pavel@ucw.cz>,
	Lee Jones <lee@kernel.org>,
	Roderick Colenbrander <roderick.colenbrander@sony.com>,
	Sven Eckelmann <sven@narfation.org>
Cc: [linux-leds@vger.kernel.org](../../linux-leds/?t=20230131130908),
	Cristiano Giuffrida <c.giuffrida@vu.nl>,
	"Bos, H.J." <h.j.bos@vu.nl>, Jakob Koschel <jkl820.git@gmail.com>,
	[linux-input@vger.kernel.org](../../linux-input/?t=20230131130908), [linux-kernel@vger.kernel.org](../../lkml/?t=20230131130908),
	Jiri Kosina <jkosina@suse.cz>,
	Roderick Colenbrander <roderick@gaikai.com>,
	Pietro Borrello <borrello@diag.uniroma1.it>
Subject: [[PATCH v2 0/5] HID: manually unregister leds on device removal to prevent UAFs](#r)
Date: Tue, 31 Jan 2023 13:08:45 +0000	[[thread overview]](#r)
Message-ID: <20230125-hid-unregister-leds-v2-0-689cc62fc878@diag.uniroma1.it> (<raw>)

I noticed a recurring pattern is present in multiple hid devices in the
Linux tree, where the LED controller of a device schedules a work_struct
to interact with the hardware.
The work_struct is embedded in the device structure and thus, is freed
at device removal.

The issue is that a LED worker may be scheduled by a timer concurrently
with device removal, causing the work_struct to be accessed after having
been freed.
I was able to trigger the issue in hid-bigbenff.c and hid-asus.c
where the work_structs may be scheduled by the LED controller
while the device is disconnecting, triggering use-after-frees.
I can attach the reproducer, but it's very simple USB configuration,
using the /dev/raw-gadget interface with some more USB interactions
to manage LEDs configuration and pass checks in asus_kbd_init()
and asus_kbd_get_functions() in case of hid-asus.c.
I triggered the issue by connecting a device and immediately
disconnecting it, so that the remove function runs before the LED one
which remains pending.

More drivers have the same pattern (hid-lg-g15.c, hid-playstation.c,
hid-sony.c) but I wasn't able to properly pass the right descriptors
to trigger the led configurations needed to trigger the workers.
Some other drivers manually unregister at removal (hid-corsair.c,
hid-gt683r.c, hid-lenovo.c) since they do not use the managed
interface, which is safe, to my understanding.
Also, a similar pattern is present with callbacks which schedule
a worker originating from input_ff_create_memless() (e.g.,
in hid-bigbenff.c) but in these cases, I wasn't able to trigger
the race condition with the event handling to schedule the worker
during device removal. However, I have no experience with the USB
protocol and I'm not able to say that they cannot be triggered.

I am currently wondering if this is due to some emulation of the
/dev/raw-gadget interface or if it's effectively an issue with how each
device manages resource removal.
But I wonder why syzkaller didn't find any crash while fuzzing the
interface with upstream-usb.config, as they seem pretty
straightforward to trigger.
Configuring the kernel with CONFIG_DEBUG_OBJECTS, it emits
a warning in debug_check_no_obj_freed, which makes it clear that
device removal is freeing resources in use.
KASAN detects them as use-after-free.

I am attaching multiple patches for all the drivers I suspect the bug
is present.
The proposed patches unregister the LED controllers before removing the
device itself.

I attach the (partial for brevity) ODEBUG dumps:

```hid-bigbenff.c
[   37.803135][ T1170] usb 1-1: USB disconnect, device number 2
[   37.827979][ T1170] ODEBUG: free active (active state 0) object
type: work_struct hint: bigben_worker+0x0/0x860
[   37.829634][ T1170] WARNING: CPU: 0 PID: 1170 at
lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
[   37.830904][ T1170] Modules linked in:
[   37.831413][ T1170] CPU: 0 PID: 1170 Comm: kworker/0:3 Not tainted
6.1.0-rc4-dirty #43
[   37.832465][ T1170] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[   37.833751][ T1170] Workqueue: usb_hub_wq hub_event
[   37.834409][ T1170] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
[   37.835218][ T1170] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
05 4f 7c 17
[   37.837667][ T1170] RSP: 0018:ffffc900006fee60 EFLAGS: 00010246
[   37.838503][ T1170] RAX: 0d2d19ffcded3d00 RBX: 0000000000000000
RCX: ffff888117fc9b00
[   37.839519][ T1170] RDX: 0000000000000000 RSI: 0000000000000000
RDI: 0000000000000000
[   37.840570][ T1170] RBP: ffffffff86e88380 R08: ffffffff8130793b
R09: fffff520000dfd85
[   37.841618][ T1170] R10: fffff520000dfd85 R11: 0000000000000000
R12: ffffffff87095fb8
[   37.842649][ T1170] R13: ffff888117770ad8 R14: ffff888117770acc
R15: ffffffff852b7420
[   37.843728][ T1170] FS:  0000000000000000(0000)
GS:ffff8881f6600000(0000) knlGS:0000000000000000
[   37.844877][ T1170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   37.845749][ T1170] CR2: 00007f992eaab380 CR3: 000000011834b000
CR4: 00000000001006f0
[   37.846794][ T1170] Call Trace:
[   37.847245][ T1170]  <TASK>
[   37.847643][ T1170]  slab_free_freelist_hook+0x89/0x160
[   37.848409][ T1170]  ? devres_release_all+0x262/0x350
[   37.849156][ T1170]  __kmem_cache_free+0x71/0x110
[   37.849829][ T1170]  devres_release_all+0x262/0x350
[   37.850478][ T1170]  ? devres_release+0x90/0x90
[   37.851118][ T1170]  device_release_driver_internal+0x5e5/0x8a0
[   37.851944][ T1170]  bus_remove_device+0x2ea/0x400
[   37.852611][ T1170]  device_del+0x64f/0xb40
[   37.853212][ T1170]  ? kill_device+0x150/0x150
[   37.853831][ T1170]  ? print_irqtrace_events+0x1f0/0x1f0
[   37.854564][ T1170]  hid_destroy_device+0x66/0x100
[   37.855226][ T1170]  usbhid_disconnect+0x9a/0xc0
[   37.855887][ T1170]  usb_unbind_interface+0x1e1/0x890
```

``` hid-asus.c
[   77.409878][ T1169] usb 1-1: USB disconnect, device number 2
[   77.423606][ T1169] ODEBUG: free active (active state 0) object
type: work_struct hint: asus_kbd_backlight_work+0x0/0x2c0
[   77.425222][ T1169] WARNING: CPU: 0 PID: 1169 at
lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
[   77.426599][ T1169] Modules linked in:
[   77.427322][ T1169] CPU: 0 PID: 1169 Comm: kworker/0:3 Not tainted
6.1.0-rc4-dirty #43
[   77.428404][ T1169] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[   77.429644][ T1169] Workqueue: usb_hub_wq hub_event
[   77.430296][ T1169] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
[   77.431142][ T1169] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
05 4f 7c 17
[   77.433691][ T1169] RSP: 0018:ffffc9000069ee60 EFLAGS: 00010246
[   77.434470][ T1169] RAX: b85d2b40c12d7600 RBX: 0000000000000000
RCX: ffff888117a78000
[   77.435507][ T1169] RDX: 0000000000000000 RSI: 0000000080000000
RDI: 0000000000000000
[   77.436521][ T1169] RBP: ffffffff86e88380 R08: ffffffff8130793b
R09: ffffed103ecc4ed6
[   77.437582][ T1169] R10: ffffed103ecc4ed6 R11: 0000000000000000
R12: ffffffff87095fb8
[   77.438593][ T1169] R13: ffff88810e348fe0 R14: ffff88810e348fd4
R15: ffffffff852b5780
[   77.439667][ T1169] FS:  0000000000000000(0000)
GS:ffff8881f6600000(0000) knlGS:0000000000000000
[   77.440842][ T1169] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   77.441688][ T1169] CR2: 00007ffc05495ff0 CR3: 000000010cdf0000
CR4: 00000000001006f0
[   77.442720][ T1169] Call Trace:
[   77.443167][ T1169]  <TASK>
[   77.443555][ T1169]  slab_free_freelist_hook+0x89/0x160
[   77.444302][ T1169]  ? devres_release_all+0x262/0x350
[   77.444990][ T1169]  __kmem_cache_free+0x71/0x110
[   77.445638][ T1169]  devres_release_all+0x262/0x350
[   77.446309][ T1169]  ? devres_release+0x90/0x90
[   77.446978][ T1169]  device_release_driver_internal+0x5e5/0x8a0
[   77.447748][ T1169]  bus_remove_device+0x2ea/0x400
[   77.448421][ T1169]  device_del+0x64f/0xb40
[   77.448976][ T1169]  ? kill_device+0x150/0x150
[   77.449577][ T1169]  ? print_irqtrace_events+0x1f0/0x1f0
[   77.450307][ T1169]  hid_destroy_device+0x66/0x100
[   77.450938][ T1169]  usbhid_disconnect+0x9a/0xc0
```

To: Jiri Kosina <jikos@kernel.org>
To: Benjamin Tissoires <benjamin.tissoires@redhat.com>
To: Hanno Zulla <kontakt@hanno.de>
To: Pavel Machek <pavel@ucw.cz>
To: Lee Jones <lee@kernel.org>
To: Roderick Colenbrander <roderick.colenbrander@sony.com>
To: Sven Eckelmann <sven@narfation.org>
Cc: linux-leds@vger.kernel.org
Cc: Cristiano Giuffrida <c.giuffrida@vu.nl>
Cc: "Bos, H.J." <h.j.bos@vu.nl>
Cc: Jakob Koschel <jkl820.git@gmail.com>
Cc: linux-input@vger.kernel.org
Cc: linux-kernel@vger.kernel.org
Cc: Jiri Kosina <jkosina@suse.cz>
Cc: Roderick Colenbrander <roderick@gaikai.com>
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>

---
Changes in v2:
- dualshock4: Clarify UAF
- dualsense:  Clarify UAF
- dualsense:  Unregister multicolor led controller
- Link to v1: [https://lore.kernel.org/r/20230125-hid-unregister-leds-v1-0-9a5192dcef16@diag.uniroma1.it](https://lore.kernel.org/r/20230125-hid-unregister-leds-v1-0-9a5192dcef16%40diag.uniroma1.it)

---
Pietro Borrello (5):
      HID: bigben_remove: manually unregister leds
      HID: asus_remove: manually unregister led
      HID: dualsense_remove: manually unregister leds
      HID: dualshock4_remove: manually unregister leds
      HID: sony_remove: manually unregister leds

 drivers/hid/hid-asus.c        |  1 +
 drivers/hid/hid-bigbenff.c    |  5 +++++
 drivers/hid/hid-playstation.c | 10 ++++++++++
 drivers/hid/hid-sony.c        |  8 ++++++++
 4 files changed, 24 insertions(+)
---
base-commit: 2241ab53cbb5cdb08a6b2d4688feb13971058f65
change-id: 20230125-hid-unregister-leds-4cbf67099e1d

Best regards,
--
Pietro Borrello <borrello@diag.uniroma1.it>

```

---

```
[next](../20230125-hid-unregister-leds-v2-1-689cc62fc878%40diag.uniroma1.it/)             [reply](#R)other threads:[[~2023-01-31 13:09 UTC](../?t=20230131130908)|[newest](../)]

Thread overview: 11+ messages / expand[[flat](T/#u)|[nested](t/#u)]  [mbox.gz](t.mbox.gz)  [Atom feed](t.atom)  [top](#b)
2023-01-31 13:08 [Pietro Borrello [this message]](#t)
2023-01-31 13:08 ` [[PATCH v2 1/5] HID: bigben_remove: manually unregister leds](../20230125-hid-unregister-leds-v2-1-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-02-09  8:55   ` [Benjamin Tissoires](../20230209085546.ohsonlwgqb7yd3d4%40mail.corp.redhat.com/)
2023-02-09 12:45     ` [Pietro Borrello](../CAEih1qUyxfjWo2vV4AUbwt59tKL2Lmz%3D4P6N4xm9ba99mQiUMA%40mail.gmail.com/)
2023-01-31 13:08 ` [[PATCH v2 2/5] HID: asus_remove: manually unregister led](../20230125-hid-unregister-leds-v2-2-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-01-31 13:08 ` [[PATCH v2 3/5] HID: dualsense_remove: manually unregister leds](../20230125-hid-unregister-leds-v2-3-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-02-09  8:59   ` [Benjamin Tissoires](../20230209085940.53mrapggf6nagkdh%40mail.corp.redhat.com/)
2023-02-09 12:50     ` [Pietro Borrello](../CAEih1qUU_aaHk7xFuyocgUq0pYLHemuRQiTboZDwyBTd7u2L5g%40mail.gmail.com/)
2023-01-31 13:08 ` [[PATCH v2 4/5] HID: dualshock4_remove:](../20230125-hid-unregister-leds-v2-4-689cc62fc878%40diag.uniroma1.it/) " Pietro Borrello
2023-01-31 13:08 ` [[PATCH v2 5/5] HID: sony_remove:](../20230125-hid-unregister-leds-v2-5-689cc62fc878%40diag.uniroma1.it/) " Pietro Borrello
2023-01-31 17:19 ` [[PATCH v2 0/5] HID: manually unregister leds on device removal to prevent UAFs](../Y9lNnOA87fCt0hFk%40google.com/) Lee Jones

```

---

```
Reply instructions:

You may reply publicly to [this message](#t) via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: [mbox](raw)

  Avoid top-posting and favor interleaved quoting:
  <https://en.wikipedia.org/wiki/Posting_style#Interleaved_style>

* Reply using the --to, --cc, and --in-reply-to
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20230125-hid-unregister-leds-v2-0-689cc62fc878@diag.uniroma1.it \
    --to=borrello@diag.uniroma1.it \
    --cc=benjamin.tissoires@redhat.com \
    --cc=c.giuffrida@vu.nl \
    --cc=h.j.bos@vu.nl \
    --cc=jikos@kernel.org \
    --cc=jkl820.git@gmail.com \
    --cc=jkosina@suse.cz \
    --cc=kontakt@hanno.de \
    --cc=lee@kernel.org \
    --cc=linux-input@vger.kernel.org \
    --cc=linux-kernel@vger.kernel.org \
    --cc=linux-leds@vger.kernel.org \
    --cc=pavel@ucw.cz \
    --cc=roderick.colenbrander@sony.com \
    --cc=roderick@gaikai.com \
    --cc=sven@narfation.org \
    /path/to/YOUR_REPLY

  <https://kernel.org/pub/software/scm/git/docs/git-send-email.html>

* If your mail client supports setting the In-Reply-To header
  via mailto: links, try the mailto: link

```
Be sure your reply has a **Subject:** header at the top and a blank line
before the message body.

---

```
This is an external index of several public inboxes,
see [mirroring instructions](../_/text/mirror/) on how to clone and mirror
all data and code used by this external index.
```


=== Content from git.kernel.org_6176a431_20250115_082755.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pietro Borrello <borrello@diag.uniroma1.it> | 2023-02-12 18:59:59 +0000 |
| --- | --- | --- |
| committer | Benjamin Tissoires <benjamin.tissoires@redhat.com> | 2023-02-15 18:18:48 +0100 |
| commit | [9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)) | |
| tree | [7e0e25b3a013f59510e6dbca46bafa608a86a324](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2) | |
| parent | [0b028189d1019ca352da108643b8f1503ee25a0e](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0b028189d1019ca352da108643b8f1503ee25a0e) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2&id2=0b028189d1019ca352da108643b8f1503ee25a0e)) | |
| download | [linux-9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2.tar.gz) | |

HID: bigben: use spinlock to protect concurrent accessesbigben driver has a worker that may access data concurrently.
Proct the accesses using a spinlock.
Fixes: 256a90ed9e46 ("HID: hid-bigbenff: driver for BigBen Interactive PS3OFMINIPAD gamepad")
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>
Link: [https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-1-7860c5763c38@diag.uniroma1.it](https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-1-7860c5763c38%40diag.uniroma1.it)
Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)

| -rw-r--r-- | [drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/hid-bigbenff.c?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2) | 52 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 50 insertions, 2 deletions

| diff --git a/drivers/hid/hid-bigbenff.c b/drivers/hid/hid-bigbenff.cindex e8b16665860d6b..ed3d2d7bc1dd46 100644--- a/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=0b028189d1019ca352da108643b8f1503ee25a0e)+++ b/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2)@@ -174,6 +174,7 @@ static \_\_u8 pid0902\_rdesc\_fixed[] = { struct bigben\_device { struct hid\_device \*hid; struct hid\_report \*report;+ spinlock\_t lock; bool removed; u8 led\_state; /\* LED1 = 1 .. LED4 = 8 \*/ u8 right\_motor\_on; /\* right motor off/on 0/1 \*/@@ -190,12 +191,27 @@ static void bigben\_worker(struct work\_struct \*work) struct bigben\_device \*bigben = container\_of(work, struct bigben\_device, worker); struct hid\_field \*report\_field = bigben->report->field[0];+ bool do\_work\_led = false;+ bool do\_work\_ff = false;+ u8 \*buf;+ u32 len;+ unsigned long flags;  if (bigben->removed || !report\_field) return; + buf = hid\_alloc\_report\_buf(bigben->report, GFP\_KERNEL);+ if (!buf)+ return;++ len = hid\_report\_len(bigben->report);++ /\* LED work \*/+ spin\_lock\_irqsave(&bigben->lock, flags);+ if (bigben->work\_led) { bigben->work\_led = false;+ do\_work\_led = true; report\_field->value[0] = 0x01; /\* 1 = led message \*/ report\_field->value[1] = 0x08; /\* reserved value, always 8 \*/ report\_field->value[2] = bigben->led\_state;@@ -204,11 +220,22 @@ static void bigben\_worker(struct work\_struct \*work) report\_field->value[5] = 0x00; /\* padding \*/ report\_field->value[6] = 0x00; /\* padding \*/ report\_field->value[7] = 0x00; /\* padding \*/- hid\_hw\_request(bigben->hid, bigben->report, HID\_REQ\_SET\_REPORT);+ hid\_output\_report(bigben->report, buf);+ }++ spin\_unlock\_irqrestore(&bigben->lock, flags);++ if (do\_work\_led) {+ hid\_hw\_raw\_request(bigben->hid, bigben->report->id, buf, len,+ bigben->report->type, HID\_REQ\_SET\_REPORT); } + /\* FF work \*/+ spin\_lock\_irqsave(&bigben->lock, flags);+ if (bigben->work\_ff) { bigben->work\_ff = false;+ do\_work\_ff = true; report\_field->value[0] = 0x02; /\* 2 = rumble effect message \*/ report\_field->value[1] = 0x08; /\* reserved value, always 8 \*/ report\_field->value[2] = bigben->right\_motor\_on;@@ -217,8 +244,17 @@ static void bigben\_worker(struct work\_struct \*work) report\_field->value[5] = 0x00; /\* padding \*/ report\_field->value[6] = 0x00; /\* padding \*/ report\_field->value[7] = 0x00; /\* padding \*/- hid\_hw\_request(bigben->hid, bigben->report, HID\_REQ\_SET\_REPORT);+ hid\_output\_report(bigben->report, buf);+ }++ spin\_unlock\_irqrestore(&bigben->lock, flags);++ if (do\_work\_ff) {+ hid\_hw\_raw\_request(bigben->hid, bigben->report->id, buf, len,+ bigben->report->type, HID\_REQ\_SET\_REPORT); }++ kfree(buf); }  static int hid\_bigben\_play\_effect(struct input\_dev \*dev, void \*data,@@ -228,6 +264,7 @@ static int hid\_bigben\_play\_effect(struct input\_dev \*dev, void \*data, struct bigben\_device \*bigben = hid\_get\_drvdata(hid); u8 right\_motor\_on; u8 left\_motor\_force;+ unsigned long flags;  if (!bigben) { hid\_err(hid, "no device data\n");@@ -242,9 +279,12 @@ static int hid\_bigben\_play\_effect(struct input\_dev \*dev, void \*data,  if (right\_motor\_on != bigben->right\_motor\_on || left\_motor\_force != bigben->left\_motor\_force) {+ spin\_lock\_irqsave(&bigben->lock, flags); bigben->right\_motor\_on = right\_motor\_on; bigben->left\_motor\_force = left\_motor\_force; bigben->work\_ff = true;+ spin\_unlock\_irqrestore(&bigben->lock, flags);+ schedule\_work(&bigben->worker); } @@ -259,6 +299,7 @@ static void bigben\_set\_led(struct led\_classdev \*led, struct bigben\_device \*bigben = hid\_get\_drvdata(hid); int n; bool work;+ unsigned long flags;  if (!bigben) { hid\_err(hid, "no device data\n");@@ -267,6 +308,7 @@ static void bigben\_set\_led(struct led\_classdev \*led,  for (n = 0; n < NUM\_LEDS; n++) { if (led == bigben->leds[n]) {+ spin\_lock\_irqsave(&bigben->lock, flags); if (value == LED\_OFF) { work = (bigben->led\_state & BIT(n)); bigben->led\_state &= ~BIT(n);@@ -274,6 +316,7 @@ static void bigben\_set\_led(struct led\_classdev \*led, work = !(bigben->led\_state & BIT(n)); bigben->led\_state |= BIT(n); }+ spin\_unlock\_irqrestore(&bigben->lock, flags);  if (work) { bigben->work\_led = true;@@ -307,8 +350,12 @@ static enum led\_brightness bigben\_get\_led(struct led\_classdev \*led) static void bigben\_remove(struct hid\_device \*hid) { struct bigben\_device \*bigben = hid\_get\_drvdata(hid);+ unsigned long flags; + spin\_lock\_irqsave(&bigben->lock, flags); bigben->removed = true;+ spin\_unlock\_irqrestore(&bigben->lock, flags);+ cancel\_work\_sync(&bigben->worker); hid\_hw\_stop(hid); }@@ -362,6 +409,7 @@ static int bigben\_probe(struct hid\_device \*hid, set\_bit(FF\_RUMBLE, hidinput->input->ffbit);  INIT\_WORK(&bigben->worker, bigben\_worker);+ spin\_lock\_init(&bigben->lock);  error = input\_ff\_create\_memless(hidinput->input, NULL, hid\_bigben\_play\_effect); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:26:33 +0000



=== Content from lists.debian.org_7cf02436_20250115_082755.html ===


---

[[Date Prev](msg00004.html)][[Date Next](msg00006.html)]
[[Thread Prev](msg00004.html)][[Thread Next](msg00006.html)]
[[Date Index](maillist.html#00005)]
[[Thread Index](threads.html#00005)]

# [SECURITY] [DLA 3404-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3404-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Wed, 3 May 2023 00:45:59 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/ZFGSp0DAB4J0uLNL%40decadent.org.uk)Â [ZFGSp0DAB4J0uLNL@decadent.org.uk](msg00005.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3404-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
May 3, 2023                                   <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.178-3~deb10u1
CVE ID         : CVE-2022-2196 CVE-2022-3424 CVE-2022-3707 CVE-2022-4129
                 CVE-2022-4379 CVE-2023-0045 CVE-2023-0458 CVE-2023-0459
                 CVE-2023-0461 CVE-2023-1073 CVE-2023-1074 CVE-2023-1076
                 CVE-2023-1077 CVE-2023-1078 CVE-2023-1079 CVE-2023-1118
                 CVE-2023-1281 CVE-2023-1513 CVE-2023-1611 CVE-2023-1670
                 CVE-2023-1829 CVE-2023-1855 CVE-2023-1859 CVE-2023-1872
                 CVE-2023-1989 CVE-2023-1990 CVE-2023-1998 CVE-2023-2162
                 CVE-2023-2194 CVE-2023-22998 CVE-2023-23004 CVE-2023-23559
                 CVE-2023-25012 CVE-2023-26545 CVE-2023-28328 CVE-2023-28466
                 CVE-2023-30456
Debian Bug     : 989705 993612 1022126 1031753

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service, or information
leak.

CVE-2022-2196

    A regression was discovered the KVM implementation for Intel CPUs,
    affecting Spectre v2 mitigation for nested virtualisation.  When
    KVM was used as the L0 hypervisor, an L2 guest could exploit this
    to leak sensitive information from its L1 hypervisor.

CVE-2022-3424

    Zheng Wang and Zhuorao Yang reported a flaw in the SGI GRU driver
    which could lead to a use-after-free.  On systems where this driver
    is used, a local user can explit this for denial of service (crash
    or memory corruption) or possibly for privilege escalation.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2022-3707

    Zheng Wang reported a flaw in the i915 graphics driver's
    virtualisation (GVT-g) support that could lead to a double-free.
    On systems where this feature is used, a guest can exploit this
    for denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2022-4129

    Haowei Yan reported a race condition in the L2TP protocol
    implementation which could lead to a null pointer dereference.  A
    local user could exploit this for denial of service (crash).

CVE-2022-4379

    Xingyuan Mo reported a flaw in the NFSv4.2 inter server to
    server copy implementation which could lead to a use-after-free.

    This feature is not enabled in Debian's official kernel
    configurations.

CVE-2023-0045

    Rodrigo Branco and Rafael Correa De Ysasi reported that when a
    user-space task told the kernel to enable Spectre v2 mitigation
    for it, the mitigation was not enabled until the task was next
    rescheduled.  This might be exploitable by a local or remote
    attacker to leak sensitive information from such an application.

CVE-2023-0458

    Jordy Zimmer and Alexandra Sandulescu found that getrlimit() and
    related system calls were vulnerable to speculative execution
    attacks such as Spectre v1.  A local user could explot this to
    leak sensitive information from the kernel.

CVE-2023-0459

    Jordy Zimmer and Alexandra Sandulescu found a regression in
    Spectre v1 mitigation in the user-copy functions for the amd64
    (64-bit PC) architecture.  Where the CPUs do not implement SMAP or
    it is disabled, a local user could exploit this to leak sensitive
    information from the kernel.  Other architectures may also be
    affected.

CVE-2023-0461

    "slipper" reported a flaw in the kernel's support for ULPs (Upper
    Layer Protocols) on top of TCP that can lead to a double-free when
    using kernel TLS sockets.  A local user can exploit this for
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

    Kernel TLS is not enabled in Debian's official kernel
    configurations.

CVE-2023-1073

    Pietro Borrello reported a type confusion flaw in the HID (Human
    Interface Device) subsystem.  An attacker able to insert and
    remove USB devices might be able to use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1074

    Pietro Borrello reported a type confusion flaw in the SCTP
    protocol implementation which can lead to a memory leak.  A local
    user could exploit this to cause a denial of service (resource
    exhaustion).

CVE-2023-1076

    Pietro Borrello reported a type confusion flaw in the TUN/TAP
    network driver, which results in all TUN/TAP sockets being marked
    as belonging to user ID 0 (root).  This may allow local users to
    evade local firewall rules based on user ID.

CVE-2023-1077

    Pietro Borrello reported a type confusion flaw in the task
    scheduler.  A local user might be able to exploit this to cause a
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

CVE-2023-1078

    Pietro Borrello reported a type confusion flaw in the RDS protocol
    implementation.  A local user could exploit this to cause a denial
    of service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2023-1079

    Pietro Borrello reported a race condition in the hid-asus HID
    driver which could lead to a use-after-free.  An attacker able to
    insert and remove USB devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1118

    Duoming Zhou reported a race condition in the ene_ir remote
    control driver that can lead to a use-after-free if the driver
    is unbound.  It is not clear what the security impact of this is.

CVE-2023-1281, CVE-2023-1829

    "valis" reported two flaws in the cls_tcindex network traffic
    classifier which could lead to a use-after-free.  A local user can
    exploit these for privilege escalation.  This update removes
    cls_tcindex entirely.

CVE-2023-1513

    Xingyuan Mo reported an information leak in the KVM implementation
    for the i386 (32-bit PC) architecture.  A local user could exploit
    this to leak sensitive information from the kernel.

CVE-2023-1611

    "butt3rflyh4ck" reported a race condition in the btrfs filesystem
    driver which can lead to a use-after-free.  A local user could
    exploit this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2023-1670

    Zheng Wang reported a race condition in the xirc2ps_cs network
    driver which can lead to a use-after-free.  An attacker able to
    insert and remove PCMCIA devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-1855

    Zheng Wang reported a race condition in the xgene-hwmon hardware
    monitoring driver that may lead to a use-after-free.  It is not
    clear what the security impact of this is.

CVE-2023-1859

    Zheng Wang reported a race condition in the 9pnet_xen transport
    for the 9P filesystem on Xen, which can lead to a use-after-free.
    On systems where this feature is used, a backend driver in another
    domain can use this to cause a denial of service (crash or memory
    corruption) or possibly to run arbitrary code in the vulnerable
    domain.

CVE-2023-1872

    Bing-Jhong Billy Jheng reported a race condition in the io_uring
    subsystem that can lead to a use-after-free.  A local user could
    exploit this to cause a denial of service (crash or memory
    corruption) or possibly for privilege escalation.

CVE-2023-1989

    Zheng Wang reported a race condition in the btsdio Bluetooth
    adapter driver that can lead to a use-after-free.  An attacker
    able to insert and remove SDIO devices can use this to cause a
    denial of service (crash or memory corruption) or possibly to run
    arbitrary code in the kernel.

CVE-2023-1990

    Zheng Wang reported a race condition in the st-nci NFC adapter
    driver that can lead to a use-after-free.  It is not clear what
    the security impact of this is.

    This driver is not enabled in Debian's official kernel
    configurations.

CVE-2023-1998

    JosÃ© Oliveira and Rodrigo Branco reported a regression in Spectre
    v2 mitigation for user-space on x86 CPUs supporting IBRS but not
    eIBRS.  This might be exploitable by a local or remote attacker to
    leak sensitive information from a user-space application.

CVE-2023-2162

    Mike Christie reported a race condition in the iSCSI TCP transport
    that can lead to a use-after-free.  On systems where this feature
    is used, a local user might be able to use this to cause a denial
    of service (crash or memory corruption) or possibly for privilege
    escalation.

CVE-2023-2194

    Wei Chen reported a potential heap buffer overflow in the
    i2c-xgene-slimpro IÂ²C adapter driver.  A local user with
    permission to access such a device can use this to cause a denial
    of service (crash or memory corruption) and probably for privilege
    escalation.

CVE-2023-22998

    Miaoqian Lin reported an incorrect error check in the virtio-gpu
    GPU driver.  A local user with access to such a device might be
    able to use this to cause a denial of service (crash).

CVE-2023-23004

    Miaoqian Lin reported an incorrect error check in the mali-dp GPU
    driver.  A local user with access to such a device might be able
    to use this to cause a denial of service (crash).

CVE-2023-23559

    Szymon Heidrich reported incorrect bounds checks in the rndis_wlan
    Wi-Fi driver which may lead to a heap buffer overflow or overread.
    An attacker able to insert and remove USB devices can use this to
    cause a denial of service (crash or memory corruption) or
    information leak, or possibly to run arbitrary code in the kernel.

CVE-2023-25012

    Pietro Borrello reported a race condition in the hid-bigbenff HID
    driver which could lead to a use-after-free.  An attacker able to
    insert and remove USB devices can use this to cause a denial of
    service (crash or memory corruption) or possibly to run arbitrary
    code in the kernel.

CVE-2023-26545

    Lianhui Tang reported a flaw in the MPLS protocol implementation
    that could lead to a double-free.  A local user might be able to
    exploit this to cause a denial of service (crash or memory
    corruption) or possibl for privilege escalation.

CVE-2023-28328

    Wei Chen reported a flaw in the az6927 DVB driver that can lead to
    a null pointer dereference.  A local user permitted to access an
    IÂ²C adapter device that this driver creates can use this to cause
    a denial of service (crash).

CVE-2023-28466

    Hangyu Hua reported a race condition in the kernel TLS socket
    implementation which can lead to a use-after-free or null
    pointer dereference.  A local user can exploit this for
    denial of service (crash or memory corruption) or possibly for
    privilege escalation.

    This feature is not enabled in Debian's official kernel
    configurations.

CVE-2023-30456

    Reima ISHII reported a flaw in the KVM implementation for Intel
    CPUs affecting nested virtualisation.  When KVM was used as the L0
    hypervisor, and EPT and/or unrestricted guest mode was disabled,
    it did not prevent an L2 guest from being configured with an
    architecturally invalid protection/paging mode.  A malicious guest
    could exploit this to cause a denial of service (crash).

For Debian 10 buster, these problems have been fixed in version
5.10.178-3~deb10u1.  This update additionally fixes Debian bugs
#989705, #993612, #1022126, and #1031753; and includes many more bug
fixes from stable updates 5.10.163-5.10.178 inclusive.

We recommend that you upgrade your linux-5.10 packages.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgp5s08o5uONt.pgp)**

*Description:* PGP signature

---



=== Content from bugzilla.suse.com_191ee2c9_20250115_082754.html ===


| Bugzilla â€“ BugÂ 1207560 | VUL-0: CVE-2023-25012: kernel: hid: Use-After-Free in bigben\_set\_led() | Last modified: 2024-09-10 12:47:37 UTC |
| --- | --- | --- |

|  |
| --- |

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1207560)
* |
  [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

[**BugÂ 1207560**](show_bug.cgi?id=1207560)
(CVE-2023-25012)
- VUL-0: CVE-2023-25012: kernel: hid: Use-After-Free in bigben\_set\_led()

[Summary:](page.cgi?id=glossary.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
VUL-0: CVE-2023-25012: kernel: hid: Use-After-Free in bigben\_set\_led()

| | [Status](page.cgi?id=status_resolution_matrix.html): | RESOLVED FIXED | | --- | --- | | Duplicates (1): | [1207846](show_bug.cgi?id=1207846 "RESOLVED DUPLICATE - VUL-0: CVE-2023-25012: The Linux kernel through 6.1.9 has a Use-After-Free in bigben_remove in drivers/hid/hid-bigbenff.c via a crafted USB device because the LED controllers remain regist")  ([view as bug list](buglist.cgi?bug_id=1207846)) | |  | | | [Alias:](page.cgi?id=glossary.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2023-25012 | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | SUSE Security Incidents | | [Classification:](page.cgi?id=glossary.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Novell Products | | [Component:](describecomponents.cgi?product=SUSE Security Incidents "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Incidents ([show other bugs](buglist.cgi?component=Incidents&product=SUSE%20Security%20Incidents&bug_status=__open__)) | | [Version:](page.cgi?id=glossary.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=glossary.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Other Other | |  | | | [Priority](page.cgi?id=glossary.html#priority): | P3 - Medium **Severity**: Normal | | [Target Milestone:](page.cgi?id=glossary.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=glossary.html#assigned_to "The person in charge of resolving the bug.") | Security Team bot | | [QA Contact:](page.cgi?id=glossary.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") | Security Team bot | |  | | | [URL:](page.cgi?id=glossary.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | <https://smash.suse.de/issue/355951/> | | [Whiteboard:](page.cgi?id=glossary.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=glossary.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=glossary.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2023-01-26 07:49 UTC by Thomas Leroy | | --- | --- | | Modified: | 2024-09-10 12:47 UTC ([History](show_activity.cgi?id=1207560)) | | CC List: | 7 users (show)  cathy.hu meissner rfrohl stoyan.manolov thomas.leroy tiwai vasant.karasulli | |  | | | [See Also:](page.cgi?id=glossary.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Found By:](page.cgi?id=glossary.html#cf_foundby "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Services Priority:](page.cgi?id=glossary.html#cf_nts_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Business Priority:](page.cgi?id=glossary.html#cf_biz_priority "A custom Free Text field in this installation of Bugzilla.") |  | | [Blocker:](page.cgi?id=glossary.html#cf_blocker "A custom Drop Down field in this installation of Bugzilla.") | --- | | [Marketing QA Status:](page.cgi?id=glossary.html#cf_marketing_qa_status "A custom Drop Down field in this installation of Bugzilla.") | --- | | [IT Deployment:](page.cgi?id=glossary.html#cf_it_deployment "A custom Drop Down field in this installation of Bugzilla.") | --- | |  | |  * [Clone This Bug](enter_bug.cgi?cloned_bug_id=1207560) |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [Add an attachment](attachment.cgi?bugid=1207560&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=1207560&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=1207560#c0)  Thomas Leroy   2023-01-26 07:49:15 UTC  ``` From oss-sec:  From: Pietro Borrello <borrello () diag uniroma1 it> Date: Wed, 25 Jan 2023 23:33:09 +0100 Hi all,  I'm disclosing a Use After Free that may be triggered when plugging in a malicious USB device, which advertises itself as a bigben device.  The device uses a worker `bigben_worker` scheduled by bigben_set_led() to communicate with the hardware. The work_struct is embedded in `struct bigben_device`, and at device removal, `struct bigben_device` is freed.  However, concurrently with device removal, the LED controller bigben_set_led() may schedule a worker whose use would result in a use-after-free.  Following the debug check triggered by freeing a work_struct in use: ``` [   37.803135][ T1170] usb 1-1: USB disconnect, device number 2 [   37.827979][ T1170] ODEBUG: free active (active state 0) object type: work_struct hint: bigben_worker+0x0/0x860 [   37.829634][ T1170] WARNING: CPU: 0 PID: 1170 at lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630 [   37.830904][ T1170] Modules linked in: [   37.831413][ T1170] CPU: 0 PID: 1170 Comm: kworker/0:3 Not tainted 6.1.0-rc4-dirty #43 [   37.832465][ T1170] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014 [   37.833751][ T1170] Workqueue: usb_hub_wq hub_event [   37.834409][ T1170] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630 [   37.835218][ T1170] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b 45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0 e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff 05 4f 7c 17 [   37.837667][ T1170] RSP: 0018:ffffc900006fee60 EFLAGS: 00010246 [   37.838503][ T1170] RAX: 0d2d19ffcded3d00 RBX: 0000000000000000 RCX: ffff888117fc9b00 [   37.839519][ T1170] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000000 [   37.840570][ T1170] RBP: ffffffff86e88380 R08: ffffffff8130793b R09: fffff520000dfd85 [   37.841618][ T1170] R10: fffff520000dfd85 R11: 0000000000000000 R12: ffffffff87095fb8 [   37.842649][ T1170] R13: ffff888117770ad8 R14: ffff888117770acc R15: ffffffff852b7420 [   37.843728][ T1170] FS:  0000000000000000(0000) GS:ffff8881f6600000(0000) knlGS:0000000000000000 [   37.844877][ T1170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033 [   37.845749][ T1170] CR2: 00007f992eaab380 CR3: 000000011834b000 CR4: 00000000001006f0 [   37.846794][ T1170] Call Trace: [   37.847245][ T1170]  <TASK> [   37.847643][ T1170]  slab_free_freelist_hook+0x89/0x160 [   37.848409][ T1170]  ? devres_release_all+0x262/0x350 [   37.849156][ T1170]  __kmem_cache_free+0x71/0x110 [   37.849829][ T1170]  devres_release_all+0x262/0x350 [   37.850478][ T1170]  ? devres_release+0x90/0x90 [   37.851118][ T1170]  device_release_driver_internal+0x5e5/0x8a0 [   37.851944][ T1170]  bus_remove_device+0x2ea/0x400 [   37.852611][ T1170]  device_del+0x64f/0xb40 [   37.853212][ T1170]  ? kill_device+0x150/0x150 [   37.853831][ T1170]  ? print_irqtrace_events+0x1f0/0x1f0 [   37.854564][ T1170]  hid_destroy_device+0x66/0x100 [   37.855226][ T1170]  usbhid_disconnect+0x9a/0xc0 [   37.855887][ T1170]  usb_unbind_interface+0x1e1/0x890 ```  And the KASAN error report: ``` [ 138.349079][  T7] usb 1-1: USB disconnect, device number 2 [ 138.381243][ T1175] ================================================================== [ 138.382329][ T1175] BUG: KASAN: use-after-free in __list_add_valid+0x66/0x100 [ 138.383272][ T1175] Read of size 8 at addr ffff88810d62de70 by task systemd-udevd/1175 [ 138.384238][ T1175] [ 138.384531][ T1175] CPU: 0 PID: 1175 Comm: systemd-udevd Not tainted 6.1.0-rc4-dirty #30 [ 138.385541][ T1175] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014 [ 138.386725][ T1175] Call Trace: [ 138.387145][ T1175] <TASK> [ 138.387515][ T1175] dump_stack_lvl+0x1b1/0x28e [ 138.388112][ T1175] ? nf_tcp_handle_invalid+0x3ff/0x3ff [ 138.388961][ T1175] ? __wake_up_klogd+0xdb/0x110 [ 138.389756][ T1175] ? panic+0x822/0x822 [ 138.390246][ T1175] ? _printk+0xc0/0x100 [ 138.390763][ T1175] print_address_description+0x7d/0x340 [ 138.391454][ T1175] print_report+0x107/0x1f0 [ 138.391995][ T1175] ? __virt_addr_valid+0x211/0x2c0 [ 138.392625][ T1175] ? __phys_addr+0xb5/0x160 [ 138.393176][ T1175] ? __list_add_valid+0x66/0x100 [ 138.393782][ T1175] kasan_report+0xcd/0x100 [ 138.394330][ T1175] ? __list_add_valid+0x66/0x100 [ 138.394955][ T1175] __list_add_valid+0x66/0x100 [ 138.395542][ T1175] insert_work+0x10e/0x3c0 [ 138.396119][ T1175] __queue_work+0xa97/0xde0 [...] [ 138.403915][ T1175] __sys_bind+0x210/0x2b0 [ 138.404458][ T1175] ? __ia32_sys_socketpair+0xb0/0xb0 [ 138.405097][ T1175] ? lockdep_hardirqs_on_prepare+0x428/0x790 [ 138.405833][ T1175] __x64_sys_bind+0x76/0x80 [ 138.406378][ T1175] do_syscall_64+0x3d/0x90 [ 138.406931][ T1175] entry_SYSCALL_64_after_hwframe+0x63/0xcd [ 138.407689][ T1175] RIP: 0033:0x7fe2d052d9e7 [ 138.408241][ T1175] Code: 83 c4 08 48 3d 01 f0 ff ff 73 01 c3 48 8b 0d a8 f4 2a 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 b8 31 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 81 f4 2a 00 f7 d8 64 89 01 48 [ 138.410572][ T1175] RSP: 002b:00007ffca13ea088 EFLAGS: 00000246 ORIG_RAX: 0000000000000031 [ 138.411571][ T1175] RAX: ffffffffffffffda RBX: 0000560b0c5b0f90 RCX: 00007fe2d052d9e7 [ 138.412542][ T1175] RDX: 000000000000000c RSI: 0000560b0c5b0fa0 RDI: 000000000000000e [ 138.413525][ T1175] RBP: 0000000000000000 R08: 0000560b0c5960e0 R09: 0000000000000210 [ 138.414530][ T1175] R10: 000000000000000f R11: 0000000000000246 R12: 0000560b0c5a8e94 [ 138.415494][ T1175] R13: 0000000000000000 R14: 0000560b0c596010 R15: 0000560b0c596028 [ 138.416499][ T1175] </TASK> [ 138.416905][ T1175] [ 138.416499][ T1175] </TASK> [ 138.416905][ T1175] [ 138.417197][ T1175] Allocated by task 7: [ 138.417706][ T1175] kasan_set_track+0x3d/0x60 [ 138.418271][ T1175] __kasan_kmalloc+0x7c/0x90 [ 138.418867][ T1175] __kmalloc_node_track_caller+0xad/0x1a0 [ 138.419583][ T1175] devm_kmalloc+0x77/0x1a0 [ 138.420141][ T1175] bigben_probe+0x2f/0x770 [ 138.420678][ T1175] hid_device_probe+0x251/0x3f0 [...] [ 138.446475][ T1175] [ 138.446775][ T1175] Freed by task 7: [ 138.447232][ T1175] kasan_set_track+0x3d/0x60 [ 138.447798][ T1175] kasan_save_free_info+0x2e/0x50 [ 138.448410][ T1175] ____kasan_slab_free+0xb0/0x100 [ 138.449039][ T1175] slab_free_freelist_hook+0x80/0x140 [ 138.449696][ T1175] __kmem_cache_free+0x71/0x110 [ 138.450292][ T1175] devres_release_all+0x262/0x350 [ 138.450925][ T1175] device_release_driver_internal+0x5e5/0x8a0 [ 138.451667][ T1175] bus_remove_device+0x2ea/0x400 [ 138.452293][ T1175] device_del+0x64f/0xb40 [ 138.452825][ T1175] hid_destroy_device+0x66/0x100 [ 138.453424][ T1175] usbhid_disconnect+0x9a/0xc0 [...] [ 138.462307][ T1175] ```  The proposed patch deregisters the LED controller bigben_set_led() before freeing the device and is currently under discussion with the maintainers.  Best regards, Pietro Borrello ``` [Comment 4](show_bug.cgi?id=1207560#c4)  Takashi Iwai   2023-01-27 17:04:23 UTC  ``` No CVE assginment yet? ``` [Comment 5](show_bug.cgi?id=1207560#c5)  Thomas Leroy   2023-01-30 08:04:59 UTC  ``` (In reply to Takashi Iwai from [comment #4](show_bug.cgi?id=1207560#c4)) > No CVE assginment yet?  I requested one from MITRE ``` [Comment 6](show_bug.cgi?id=1207560#c6)  Thomas Leroy   2023-02-02 07:41:26 UTC  ``` *** [Bug 1207846](show_bug.cgi?id=1207846 "RESOLVED DUPLICATE - VUL-0: CVE-2023-25012: The Linux kernel through 6.1.9 has a Use-After-Free in bigben_remove in drivers/hid/hid-bigbenff.c via a crafted USB device because the LED controllers remain regist") has been marked as a duplicate of this bug. *** ``` [Comment 7](show_bug.cgi?id=1207560#c7)  Takashi Iwai   2023-02-02 11:12:40 UTC  ``` The patch seems still under review by the upstream.  Let's wait for the upstream merge or reaction. ``` [Comment 8](show_bug.cgi?id=1207560#c8)  Takashi Iwai   2023-02-07 16:07:29 UTC  ``` The v2 patch set:   [https://lore.kernel.org/all/20230125-hid-unregister-leds-v2-0-689cc62fc878@diag.uniroma1.it/](https://lore.kernel.org/all/20230125-hid-unregister-leds-v2-0-689cc62fc878%40diag.uniroma1.it/) ``` [Comment 10](show_bug.cgi?id=1207560#c10)  Takashi Iwai   2023-03-09 13:30:25 UTC  ``` The v4 patches have been merged. The upstream commits:   76ca8da989c7d97a7f76c75d475fe95a584439d7   27d2a2fd844ec7da70d19fabb482304fd1e0595b   9fefb6201c4f8dd9f58c581b2a66e5cde2895ea2  SLE15-SP4 have already taken those fixes via git-fixes.  The patch metadata is updated. The fixes patches are backported to cve/linux-5.3 branch.  Reassigned back to security team. ``` [Comment 14](show_bug.cgi?id=1207560#c14)  Maintenance Automation   2023-03-16 08:30:13 UTC  ``` SUSE-SU-2023:0749-1: An update that solves 12 vulnerabilities and has 25 fixes can now be installed.  Category: security (important) Bug References: 1177529, 1193629, 1197534, 1198438, 1200054, 1202633, 1203331, 1204363, 1204993, 1205544, 1205846, 1206103, 1206232, 1206935, 1207051, 1207270, 1207560, 1207845, 1207846, 1208212, 1208420, 1208449, 1208534, 1208541, 1208542, 1208570, 1208607, 1208628, 1208700, 1208741, 1208759, 1208776, 1208784, 1208787, 1208816, 1208837, 1208843 CVE References: CVE-2022-3523, CVE-2022-38096, CVE-2023-0461, CVE-2023-0597, CVE-2023-1118, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23004, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545 Sources used: openSUSE Leap 15.4 (src): kernel-syms-rt-5.14.21-150400.15.14.1, kernel-source-rt-5.14.21-150400.15.14.2 SUSE Linux Enterprise Live Patching 15-SP4 (src): kernel-livepatch-SLE15-SP4-RT_Update_4-1-150400.1.3.1 SUSE Real Time Module 15-SP4 (src): kernel-syms-rt-5.14.21-150400.15.14.1, kernel-source-rt-5.14.21-150400.15.14.2  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 15](show_bug.cgi?id=1207560#c15)  Maintenance Automation   2023-03-16 20:31:52 UTC  ``` SUSE-SU-2023:0779-1: An update that solves 21 vulnerabilities and has 12 fixes can now be installed.  Category: security (important) Bug References: 1186449, 1203331, 1203332, 1203693, 1204502, 1204760, 1205149, 1206351, 1206677, 1206784, 1207034, 1207051, 1207134, 1207186, 1207237, 1207497, 1207508, 1207560, 1207773, 1207795, 1207845, 1207875, 1207878, 1208212, 1208599, 1208700, 1208741, 1208776, 1208816, 1208837, 1208845, 1208971, 1209008 CVE References: CVE-2022-3606, CVE-2022-36280, CVE-2022-38096, CVE-2022-47929, CVE-2023-0045, CVE-2023-0179, CVE-2023-0266, CVE-2023-0590, CVE-2023-0597, CVE-2023-1076, CVE-2023-1095, CVE-2023-1118, CVE-2023-1195, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23004, CVE-2023-23006, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545 Sources used: SUSE Real Time Module 15-SP3 (src): kernel-syms-rt-5.3.18-150300.121.1, kernel-source-rt-5.3.18-150300.121.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 19](show_bug.cgi?id=1207560#c19)  Maintenance Automation   2023-03-28 08:30:23 UTC  ``` SUSE-SU-2023:1609-1: An update that solves 17 vulnerabilities and has 44 fixes can now be installed.  Category: security (important) Bug References: 1177529, 1193629, 1197534, 1197617, 1198438, 1200054, 1202353, 1202633, 1203200, 1203331, 1204363, 1204993, 1205544, 1205846, 1206103, 1206232, 1206492, 1206493, 1206824, 1206935, 1207051, 1207270, 1207529, 1207560, 1207845, 1207846, 1208179, 1208212, 1208420, 1208449, 1208534, 1208541, 1208542, 1208570, 1208598, 1208599, 1208601, 1208605, 1208607, 1208628, 1208700, 1208741, 1208759, 1208776, 1208777, 1208784, 1208787, 1208816, 1208837, 1208843, 1208848, 1209008, 1209159, 1209188, 1209256, 1209258, 1209262, 1209291, 1209436, 1209457, 1209504 CVE References: CVE-2022-3523, CVE-2022-38096, CVE-2023-0461, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1078, CVE-2023-1095, CVE-2023-1118, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23004, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545, CVE-2023-28328 Sources used: openSUSE Leap 15.4 (src): kernel-source-rt-5.14.21-150400.15.18.1, kernel-syms-rt-5.14.21-150400.15.18.1 SUSE Linux Enterprise Live Patching 15-SP4 (src): kernel-livepatch-SLE15-SP4-RT_Update_5-1-150400.1.3.1 SUSE Real Time Module 15-SP4 (src): kernel-source-rt-5.14.21-150400.15.18.1, kernel-syms-rt-5.14.21-150400.15.18.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 20](show_bug.cgi?id=1207560#c20)  Maintenance Automation   2023-03-28 08:31:47 UTC  ``` SUSE-SU-2023:1608-1: An update that solves 24 vulnerabilities and has 112 fixes can now be installed.  Category: security (important) Bug References: 1166486, 1177529, 1193629, 1197534, 1197617, 1198438, 1200054, 1202353, 1202633, 1203200, 1203331, 1203332, 1204363, 1204993, 1205544, 1205846, 1206103, 1206224, 1206232, 1206459, 1206492, 1206493, 1206640, 1206824, 1206877, 1206878, 1206880, 1206881, 1206882, 1206883, 1206884, 1206886, 1206894, 1206935, 1207036, 1207050, 1207051, 1207125, 1207270, 1207328, 1207529, 1207560, 1207588, 1207590, 1207591, 1207592, 1207593, 1207594, 1207603, 1207605, 1207606, 1207608, 1207609, 1207613, 1207615, 1207617, 1207618, 1207619, 1207620, 1207621, 1207623, 1207624, 1207625, 1207626, 1207630, 1207631, 1207632, 1207634, 1207635, 1207636, 1207638, 1207639, 1207640, 1207641, 1207642, 1207643, 1207644, 1207645, 1207646, 1207647, 1207648, 1207649, 1207650, 1207651, 1207652, 1207653, 1207768, 1207770, 1207771, 1207773, 1207795, 1207845, 1207875, 1208149, 1208153, 1208179, 1208183, 1208212, 1208290, 1208420, 1208428, 1208429, 1208449, 1208534, 1208541, 1208542, 1208570, 1208598, 1208599, 1208601, 1208605, 1208607, 1208628, 1208700, 1208741, 1208759, 1208776, 1208777, 1208784, 1208787, 1208816, 1208829, 1208837, 1208843, 1208848, 1209008, 1209159, 1209188, 1209256, 1209258, 1209262, 1209291, 1209436, 1209457, 1209504, 1209572 CVE References: CVE-2022-3523, CVE-2022-36280, CVE-2022-38096, CVE-2023-0045, CVE-2023-0122, CVE-2023-0461, CVE-2023-0590, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1078, CVE-2023-1095, CVE-2023-1118, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23001, CVE-2023-23004, CVE-2023-23454, CVE-2023-23455, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545, CVE-2023-28328 Sources used: openSUSE Leap 15.4 (src): kernel-syms-azure-5.14.21-150400.14.40.1, kernel-source-azure-5.14.21-150400.14.40.1 Public Cloud Module 15-SP4 (src): kernel-syms-azure-5.14.21-150400.14.40.1, kernel-source-azure-5.14.21-150400.14.40.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 22](show_bug.cgi?id=1207560#c22)  Maintenance Automation   2023-03-31 12:30:33 UTC  ``` SUSE-SU-2023:1710-1: An update that solves 19 vulnerabilities and has 111 fixes can now be installed.  Category: security (important) Bug References: 1166486, 1177529, 1193629, 1197534, 1197617, 1198438, 1202353, 1202633, 1203200, 1203331, 1203332, 1204363, 1204993, 1205544, 1205846, 1206103, 1206224, 1206232, 1206459, 1206492, 1206493, 1206640, 1206824, 1206876, 1206877, 1206878, 1206880, 1206881, 1206882, 1206883, 1206884, 1206885, 1206886, 1206889, 1206894, 1206935, 1207051, 1207270, 1207328, 1207529, 1207560, 1207588, 1207589, 1207590, 1207591, 1207592, 1207593, 1207594, 1207603, 1207605, 1207606, 1207607, 1207608, 1207609, 1207610, 1207613, 1207615, 1207617, 1207618, 1207619, 1207620, 1207621, 1207623, 1207624, 1207625, 1207626, 1207628, 1207630, 1207631, 1207632, 1207634, 1207635, 1207636, 1207638, 1207639, 1207641, 1207642, 1207643, 1207644, 1207645, 1207646, 1207647, 1207648, 1207651, 1207653, 1207770, 1207773, 1207845, 1207875, 1208149, 1208153, 1208179, 1208183, 1208212, 1208290, 1208420, 1208428, 1208429, 1208449, 1208534, 1208541, 1208570, 1208598, 1208599, 1208601, 1208603, 1208605, 1208607, 1208628, 1208700, 1208741, 1208759, 1208776, 1208777, 1208784, 1208787, 1208816, 1208837, 1208843, 1208848, 1209008, 1209159, 1209188, 1209256, 1209258, 1209262, 1209291, 1209436, 1209457, 1209504 CVE References: CVE-2022-3523, CVE-2022-36280, CVE-2022-38096, CVE-2023-0045, CVE-2023-0461, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1078, CVE-2023-1095, CVE-2023-1118, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23004, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545, CVE-2023-28328 Sources used: openSUSE Leap Micro 5.3 (src): kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 openSUSE Leap 15.4 (src): kernel-obs-qa-5.14.21-150400.24.55.1, kernel-syms-5.14.21-150400.24.55.1, kernel-source-5.14.21-150400.24.55.2, kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7, kernel-obs-build-5.14.21-150400.24.55.3 SUSE Linux Enterprise Micro for Rancher 5.3 (src): kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 SUSE Linux Enterprise Micro 5.3 (src): kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 SUSE Linux Enterprise Micro for Rancher 5.4 (src): kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 SUSE Linux Enterprise Micro 5.4 (src): kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 Basesystem Module 15-SP4 (src): kernel-source-5.14.21-150400.24.55.2, kernel-default-base-5.14.21-150400.24.55.3.150400.24.22.7 Development Tools Module 15-SP4 (src): kernel-source-5.14.21-150400.24.55.2, kernel-syms-5.14.21-150400.24.55.1, kernel-obs-build-5.14.21-150400.24.55.3 SUSE Linux Enterprise Live Patching 15-SP4 (src): kernel-livepatch-SLE15-SP4_Update_10-1-150400.9.3.7  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 27](show_bug.cgi?id=1207560#c27)  Maintenance Automation   2023-04-10 12:30:56 UTC  ``` SUSE-SU-2023:1800-1: An update that solves 20 vulnerabilities and has seven fixes can now be installed.  Category: security (important) Bug References: 1207168, 1207185, 1207560, 1208179, 1208598, 1208599, 1208601, 1208777, 1208787, 1208843, 1209008, 1209052, 1209256, 1209288, 1209289, 1209290, 1209291, 1209366, 1209532, 1209547, 1209549, 1209634, 1209635, 1209636, 1209672, 1209683, 1209778 CVE References: CVE-2017-5753, CVE-2021-3923, CVE-2022-4744, CVE-2023-0461, CVE-2023-1075, CVE-2023-1076, CVE-2023-1078, CVE-2023-1095, CVE-2023-1281, CVE-2023-1382, CVE-2023-1390, CVE-2023-1513, CVE-2023-1582, CVE-2023-23004, CVE-2023-25012, CVE-2023-28327, CVE-2023-28328, CVE-2023-28464, CVE-2023-28466, CVE-2023-28772 Sources used: SUSE Linux Enterprise Live Patching 15-SP2 (src): kernel-livepatch-SLE15-SP2_Update_35-1-150200.5.3.1 SUSE Linux Enterprise High Performance Computing 15 SP2 LTSS 15-SP2 (src): kernel-obs-build-5.3.18-150200.24.148.1, kernel-source-5.3.18-150200.24.148.1, kernel-syms-5.3.18-150200.24.148.1, kernel-default-base-5.3.18-150200.24.148.1.150200.9.71.1 SUSE Linux Enterprise Server 15 SP2 LTSS 15-SP2 (src): kernel-obs-build-5.3.18-150200.24.148.1, kernel-source-5.3.18-150200.24.148.1, kernel-syms-5.3.18-150200.24.148.1, kernel-default-base-5.3.18-150200.24.148.1.150200.9.71.1 SUSE Linux Enterprise Server for SAP Applications 15 SP2 (src): kernel-obs-build-5.3.18-150200.24.148.1, kernel-source-5.3.18-150200.24.148.1, kernel-syms-5.3.18-150200.24.148.1, kernel-default-base-5.3.18-150200.24.148.1.150200.9.71.1 SUSE Enterprise Storage 7 (src): kernel-obs-build-5.3.18-150200.24.148.1, kernel-source-5.3.18-150200.24.148.1, kernel-syms-5.3.18-150200.24.148.1, kernel-default-base-5.3.18-150200.24.148.1.150200.9.71.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 28](show_bug.cgi?id=1207560#c28)  Maintenance Automation   2023-04-11 12:30:12 UTC  ``` SUSE-SU-2023:1811-1: An update that solves 20 vulnerabilities and has eight fixes can now be installed.  Category: security (important) Bug References: 1207168, 1207560, 1208137, 1208179, 1208598, 1208599, 1208601, 1208777, 1208787, 1208843, 1209008, 1209052, 1209256, 1209288, 1209289, 1209290, 1209291, 1209366, 1209532, 1209547, 1209549, 1209634, 1209635, 1209636, 1209672, 1209683, 1209778, 1209785 CVE References: CVE-2017-5753, CVE-2021-3923, CVE-2022-4744, CVE-2023-0461, CVE-2023-1075, CVE-2023-1076, CVE-2023-1078, CVE-2023-1095, CVE-2023-1281, CVE-2023-1382, CVE-2023-1390, CVE-2023-1513, CVE-2023-1582, CVE-2023-23004, CVE-2023-25012, CVE-2023-28327, CVE-2023-28328, CVE-2023-28464, CVE-2023-28466, CVE-2023-28772 Sources used: SUSE Linux Enterprise Live Patching 15-SP3 (src): kernel-livepatch-SLE15-SP3_Update_31-1-150300.7.3.1 SUSE Linux Enterprise High Performance Computing ESPOS 15 SP3 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Linux Enterprise High Performance Computing LTSS 15 SP3 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Linux Enterprise Real Time 15 SP3 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Linux Enterprise Server 15 SP3 LTSS 15-SP3 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Linux Enterprise Server for SAP Applications 15 SP3 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Manager Proxy 4.2 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1 SUSE Manager Retail Branch Server 4.2 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1 SUSE Manager Server 4.2 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1 SUSE Enterprise Storage 7.1 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1, kernel-source-5.3.18-150300.59.118.1, kernel-syms-5.3.18-150300.59.118.1, kernel-obs-build-5.3.18-150300.59.118.1 SUSE Linux Enterprise Micro 5.1 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1 SUSE Linux Enterprise Micro 5.2 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1 SUSE Linux Enterprise Micro for Rancher 5.2 (src): kernel-default-base-5.3.18-150300.59.118.1.150300.18.68.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 29](show_bug.cgi?id=1207560#c29)  Maintenance Automation   2023-06-06 12:30:56 UTC  ``` SUSE-SU-2023:0749-2: An update that solves 12 vulnerabilities and has 27 fixes can now be installed.  Category: security (important) Bug References: 1177529, 1193629, 1197534, 1198438, 1200054, 1202633, 1203331, 1204363, 1204993, 1205544, 1205846, 1206103, 1206232, 1206935, 1207051, 1207270, 1207560, 1207845, 1207846, 1208212, 1208420, 1208449, 1208534, 1208541, 1208542, 1208570, 1208607, 1208628, 1208700, 1208741, 1208759, 1208776, 1208784, 1208787, 1208816, 1208837, 1208843, 1209188, 1209436 CVE References: CVE-2022-3523, CVE-2022-38096, CVE-2023-0461, CVE-2023-0597, CVE-2023-1118, CVE-2023-22995, CVE-2023-22998, CVE-2023-23000, CVE-2023-23004, CVE-2023-23559, CVE-2023-25012, CVE-2023-26545 Sources used: openSUSE Leap 15.4 (src): kernel-syms-rt-5.14.21-150400.15.14.1, kernel-source-rt-5.14.21-150400.15.14.2 SUSE Linux Enterprise Live Patching 15-SP4 (src): kernel-livepatch-SLE15-SP4-RT_Update_4-1-150400.1.3.1 SUSE Real Time Module 15-SP4 (src): kernel-syms-rt-5.14.21-150400.15.14.1, kernel-source-rt-5.14.21-150400.15.14.2  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 36](show_bug.cgi?id=1207560#c36)  Maintenance Automation   2023-07-11 16:31:07 UTC  ``` SUSE-SU-2023:2809-1: An update that solves 84 vulnerabilities, contains 25 features and has 320 fixes can now be installed.  Category: security (important) Bug References: 1065729, 1109158, 1142685, 1152472, 1152489, 1155798, 1160435, 1166486, 1172073, 1174777, 1177529, 1185861, 1186449, 1189998, 1189999, 1191731, 1193629, 1194869, 1195175, 1195655, 1195921, 1196058, 1197534, 1197617, 1198101, 1198400, 1198438, 1198835, 1199304, 1199701, 1200054, 1202353, 1202633, 1203039, 1203200, 1203325, 1203331, 1203332, 1203693, 1203906, 1204356, 1204363, 1204662, 1204993, 1205153, 1205191, 1205205, 1205544, 1205650, 1205756, 1205758, 1205760, 1205762, 1205803, 1205846, 1206024, 1206036, 1206056, 1206057, 1206103, 1206224, 1206232, 1206340, 1206459, 1206492, 1206493, 1206578, 1206640, 1206649, 1206824, 1206843, 1206876, 1206877, 1206878, 1206880, 1206881, 1206882, 1206883, 1206884, 1206885, 1206886, 1206887, 1206888, 1206889, 1206890, 1206891, 1206893, 1206894, 1206935, 1206992, 1207034, 1207036, 1207050, 1207051, 1207088, 1207125, 1207149, 1207158, 1207168, 1207185, 1207270, 1207315, 1207328, 1207497, 1207500, 1207501, 1207506, 1207507, 1207521, 1207553, 1207560, 1207574, 1207588, 1207589, 1207590, 1207591, 1207592, 1207593, 1207594, 1207602, 1207603, 1207605, 1207606, 1207607, 1207608, 1207609, 1207610, 1207611, 1207612, 1207613, 1207614, 1207615, 1207616, 1207617, 1207618, 1207619, 1207620, 1207621, 1207622, 1207623, 1207624, 1207625, 1207626, 1207627, 1207628, 1207629, 1207630, 1207631, 1207632, 1207633, 1207634, 1207635, 1207636, 1207637, 1207638, 1207639, 1207640, 1207641, 1207642, 1207643, 1207644, 1207645, 1207646, 1207647, 1207648, 1207649, 1207650, 1207651, 1207652, 1207653, 1207734, 1207768, 1207769, 1207770, 1207771, 1207773, 1207795, 1207827, 1207842, 1207845, 1207875, 1207878, 1207933, 1207935, 1207948, 1208050, 1208076, 1208081, 1208105, 1208107, 1208128, 1208130, 1208149, 1208153, 1208183, 1208212, 1208219, 1208290, 1208368, 1208410, 1208420, 1208428, 1208429, 1208449, 1208534, 1208541, 1208542, 1208570, 1208588, 1208598, 1208599, 1208600, 1208601, 1208602, 1208604, 1208605, 1208607, 1208619, 1208628, 1208700, 1208741, 1208758, 1208759, 1208776, 1208777, 1208784, 1208787, 1208815, 1208816, 1208829, 1208837, 1208843, 1208845, 1208848, 1208864, 1208902, 1208948, 1208976, 1209008, 1209039, 1209052, 1209092, 1209159, 1209256, 1209258, 1209262, 1209287, 1209288, 1209290, 1209291, 1209292, 1209366, 1209367, 1209436, 1209457, 1209504, 1209532, 1209556, 1209600, 1209615, 1209635, 1209636, 1209637, 1209684, 1209687, 1209693, 1209739, 1209779, 1209780, 1209788, 1209798, 1209799, 1209804, 1209805, 1209856, 1209871, 1209927, 1209980, 1209982, 1209999, 1210034, 1210050, 1210158, 1210165, 1210202, 1210203, 1210206, 1210216, 1210230, 1210294, 1210301, 1210329, 1210336, 1210337, 1210409, 1210439, 1210449, 1210450, 1210453, 1210454, 1210469, 1210498, 1210506, 1210533, 1210551, 1210629, 1210644, 1210647, 1210725, 1210741, 1210762, 1210763, 1210764, 1210765, 1210766, 1210767, 1210768, 1210769, 1210770, 1210771, 1210775, 1210783, 1210791, 1210793, 1210806, 1210816, 1210817, 1210827, 1210940, 1210943, 1210947, 1210953, 1210986, 1211025, 1211037, 1211043, 1211044, 1211089, 1211105, 1211113, 1211131, 1211205, 1211263, 1211280, 1211281, 1211299, 1211346, 1211387, 1211400, 1211410, 1211414, 1211449, 1211465, 1211519, 1211564, 1211590, 1211592, 1211593, 1211595, 1211654, 1211686, 1211687, 1211688, 1211689, 1211690, 1211691, 1211692, 1211693, 1211714, 1211794, 1211796, 1211804, 1211807, 1211808, 1211820, 1211836, 1211847, 1211852, 1211855, 1211960, 1212129, 1212154, 1212155, 1212158, 1212350, 1212405, 1212445, 1212448, 1212494, 1212495, 1212504, 1212513, 1212540, 1212556, 1212561, 1212563, 1212564, 1212584, 1212592, 1212605, 1212606, 1212619, 1212701, 1212741 CVE References: CVE-2020-24588, CVE-2022-2196, CVE-2022-3523, CVE-2022-36280, CVE-2022-38096, CVE-2022-4269, CVE-2022-45884, CVE-2022-45885, CVE-2022-45886, CVE-2022-45887, CVE-2022-45919, CVE-2022-4744, CVE-2023-0045, CVE-2023-0122, CVE-2023-0179, CVE-2023-0386, CVE-2023-0394, CVE-2023-0461, CVE-2023-0469, CVE-2023-0590, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1077, CVE-2023-1078, CVE-2023-1079, CVE-2023-1095, CVE-2023-1118, CVE-2023-1249, CVE-2023-1382, CVE-2023-1513, CVE-2023-1582, CVE-2023-1583, CVE-2023-1611, CVE-2023-1637, CVE-2023-1652, CVE-2023-1670, CVE-2023-1838, CVE-2023-1855, CVE-2023-1989, CVE-2023-1998, CVE-2023-2002, CVE-2023-21102, CVE-2023-21106, CVE-2023-2124, CVE-2023-2156, CVE-2023-2162, CVE-2023-2176, CVE-2023-2235, CVE-2023-2269, CVE-2023-22998, CVE-2023-23000, CVE-2023-23001, CVE-2023-23004, CVE-2023-23006, CVE-2023-23454, CVE-2023-23455, CVE-2023-2483, CVE-2023-25012, CVE-2023-2513, CVE-2023-26545, CVE-2023-28327, CVE-2023-28410, CVE-2023-28464, CVE-2023-28466, CVE-2023-28866, CVE-2023-3006, CVE-2023-30456, CVE-2023-30772, CVE-2023-31084, CVE-2023-3141, CVE-2023-31436, CVE-2023-3161, CVE-2023-3220, CVE-2023-32233, CVE-2023-33288, CVE-2023-3357, CVE-2023-3358, CVE-2023-33951, CVE-2023-33952, CVE-2023-35788, CVE-2023-35823, CVE-2023-35828, CVE-2023-35829 Jira References: PED-1549, PED-3210, PED-3259, PED-3692, PED-370, PED-3750, PED-3759, PED-376, PED-3931, PED-4022, PED-835, SES-1880, SLE-18375, SLE-18377, SLE-18378, SLE-18379, SLE-18383, SLE-18384, SLE-18385, SLE-18978, SLE-18992, SLE-19001, SLE-19253, SLE-19255, SLE-19556 Sources used: openSUSE Leap 15.5 (src): kernel-livepatch-SLE15-SP5-RT_Update_1-1-150500.11.5.1, kernel-syms-rt-5.14.21-150500.13.5.1, kernel-source-rt-5.14.21-150500.13.5.1 SUSE Linux Enterprise Live Patching 15-SP5 (src): kernel-livepatch-SLE15-SP5-RT_Update_1-1-150500.11.5.1 SUSE Real Time Module 15-SP5 (src): kernel-syms-rt-5.14.21-150500.13.5.1, kernel-source-rt-5.14.21-150500.13.5.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 37](show_bug.cgi?id=1207560#c37)  Maintenance Automation   2023-07-18 16:31:34 UTC  ``` SUSE-SU-2023:2871-1: An update that solves 82 vulnerabilities, contains 25 features and has 390 fixes can now be installed.  Category: security (important) Bug References: 1065729, 1109158, 1142685, 1152472, 1152489, 1155798, 1160435, 1166486, 1172073, 1174777, 1177529, 1186449, 1187829, 1189998, 1189999, 1191731, 1193629, 1194869, 1195175, 1195655, 1195921, 1196058, 1197534, 1197617, 1198101, 1198400, 1198438, 1198835, 1199304, 1199701, 1200054, 1202353, 1202633, 1203039, 1203200, 1203325, 1203331, 1203332, 1203693, 1203906, 1204356, 1204363, 1204662, 1204993, 1205153, 1205191, 1205205, 1205544, 1205650, 1205756, 1205758, 1205760, 1205762, 1205803, 1205846, 1206024, 1206036, 1206056, 1206057, 1206103, 1206224, 1206232, 1206340, 1206459, 1206492, 1206493, 1206552, 1206578, 1206640, 1206649, 1206677, 1206824, 1206843, 1206876, 1206877, 1206878, 1206880, 1206881, 1206882, 1206883, 1206884, 1206885, 1206886, 1206887, 1206888, 1206889, 1206890, 1206891, 1206893, 1206894, 1206935, 1206992, 1207034, 1207036, 1207050, 1207051, 1207088, 1207125, 1207149, 1207158, 1207168, 1207185, 1207270, 1207315, 1207328, 1207497, 1207500, 1207501, 1207506, 1207507, 1207521, 1207553, 1207560, 1207574, 1207588, 1207589, 1207590, 1207591, 1207592, 1207593, 1207594, 1207602, 1207603, 1207605, 1207606, 1207607, 1207608, 1207609, 1207610, 1207611, 1207612, 1207613, 1207614, 1207615, 1207616, 1207617, 1207618, 1207619, 1207620, 1207621, 1207622, 1207623, 1207624, 1207625, 1207626, 1207627, 1207628, 1207629, 1207630, 1207631, 1207632, 1207633, 1207634, 1207635, 1207636, 1207637, 1207638, 1207639, 1207640, 1207641, 1207642, 1207643, 1207644, 1207645, 1207646, 1207647, 1207648, 1207649, 1207650, 1207651, 1207652, 1207653, 1207734, 1207768, 1207769, 1207770, 1207771, 1207773, 1207795, 1207827, 1207842, 1207845, 1207875, 1207878, 1207933, 1207935, 1207948, 1208050, 1208076, 1208081, 1208105, 1208107, 1208128, 1208130, 1208149, 1208153, 1208183, 1208212, 1208219, 1208290, 1208368, 1208410, 1208420, 1208428, 1208429, 1208449, 1208534, 1208541, 1208542, 1208570, 1208588, 1208598, 1208599, 1208600, 1208601, 1208602, 1208604, 1208605, 1208607, 1208619, 1208628, 1208700, 1208741, 1208758, 1208759, 1208776, 1208777, 1208784, 1208787, 1208815, 1208816, 1208829, 1208837, 1208843, 1208845, 1208848, 1208864, 1208902, 1208948, 1208976, 1209008, 1209039, 1209052, 1209092, 1209159, 1209256, 1209258, 1209262, 1209287, 1209288, 1209290, 1209291, 1209292, 1209366, 1209367, 1209436, 1209457, 1209504, 1209532, 1209556, 1209600, 1209615, 1209635, 1209636, 1209637, 1209684, 1209687, 1209693, 1209739, 1209779, 1209780, 1209788, 1209798, 1209799, 1209804, 1209805, 1209856, 1209871, 1209927, 1209980, 1209982, 1209999, 1210034, 1210050, 1210158, 1210165, 1210202, 1210203, 1210206, 1210216, 1210230, 1210294, 1210301, 1210329, 1210335, 1210336, 1210337, 1210409, 1210439, 1210449, 1210450, 1210453, 1210454, 1210498, 1210506, 1210533, 1210551, 1210565, 1210584, 1210629, 1210644, 1210647, 1210725, 1210741, 1210762, 1210763, 1210764, 1210765, 1210766, 1210767, 1210768, 1210769, 1210770, 1210771, 1210775, 1210783, 1210791, 1210793, 1210806, 1210816, 1210817, 1210827, 1210853, 1210940, 1210943, 1210947, 1210953, 1210986, 1211014, 1211025, 1211037, 1211043, 1211044, 1211089, 1211105, 1211113, 1211131, 1211205, 1211263, 1211280, 1211281, 1211299, 1211346, 1211387, 1211400, 1211410, 1211414, 1211449, 1211465, 1211519, 1211564, 1211590, 1211592, 1211593, 1211595, 1211654, 1211686, 1211687, 1211688, 1211689, 1211690, 1211691, 1211692, 1211693, 1211714, 1211794, 1211796, 1211804, 1211807, 1211808, 1211820, 1211836, 1211847, 1211852, 1211855, 1211960, 1212051, 1212129, 1212154, 1212155, 1212158, 1212265, 1212350, 1212445, 1212448, 1212456, 1212494, 1212495, 1212504, 1212513, 1212540, 1212556, 1212561, 1212563, 1212564, 1212584, 1212592, 1212603, 1212605, 1212606, 1212619, 1212685, 1212701, 1212741, 1212835, 1212838, 1212842, 1212848, 1212861, 1212869, 1212892, 1212961, 1213010, 1213011, 1213012, 1213013, 1213014, 1213015, 1213016, 1213017, 1213018, 1213019, 1213020, 1213021, 1213024, 1213025, 1213032, 1213034, 1213035, 1213036, 1213037, 1213038, 1213039, 1213040, 1213041, 1213087, 1213088, 1213089, 1213090, 1213092, 1213093, 1213094, 1213095, 1213096, 1213098, 1213099, 1213100, 1213102, 1213103, 1213104, 1213105, 1213106, 1213107, 1213108, 1213109, 1213110, 1213111, 1213112, 1213113, 1213114, 1213116, 1213134 CVE References: CVE-2022-36280, CVE-2022-38096, CVE-2022-4269, CVE-2022-45884, CVE-2022-45885, CVE-2022-45886, CVE-2022-45887, CVE-2022-45919, CVE-2022-4744, CVE-2023-0045, CVE-2023-0122, CVE-2023-0179, CVE-2023-0394, CVE-2023-0461, CVE-2023-0469, CVE-2023-0590, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1077, CVE-2023-1079, CVE-2023-1095, CVE-2023-1118, CVE-2023-1249, CVE-2023-1382, CVE-2023-1513, CVE-2023-1582, CVE-2023-1583, CVE-2023-1611, CVE-2023-1637, CVE-2023-1652, CVE-2023-1670, CVE-2023-1829, CVE-2023-1838, CVE-2023-1855, CVE-2023-1989, CVE-2023-1998, CVE-2023-2002, CVE-2023-21102, CVE-2023-21106, CVE-2023-2124, CVE-2023-2156, CVE-2023-2162, CVE-2023-2176, CVE-2023-2235, CVE-2023-2269, CVE-2023-22998, CVE-2023-23000, CVE-2023-23001, CVE-2023-23004, CVE-2023-23006, CVE-2023-2430, CVE-2023-2483, CVE-2023-25012, CVE-2023-2513, CVE-2023-26545, CVE-2023-28327, CVE-2023-28410, CVE-2023-28464, CVE-2023-28866, CVE-2023-3006, CVE-2023-30456, CVE-2023-30772, CVE-2023-3090, CVE-2023-31084, CVE-2023-3111, CVE-2023-3141, CVE-2023-31436, CVE-2023-3161, CVE-2023-3212, CVE-2023-3220, CVE-2023-32233, CVE-2023-33288, CVE-2023-3357, CVE-2023-3358, CVE-2023-3389, CVE-2023-33951, CVE-2023-33952, CVE-2023-35788, CVE-2023-35823, CVE-2023-35828, CVE-2023-35829 Jira References: PED-1549, PED-3210, PED-3259, PED-3692, PED-370, PED-3750, PED-3759, PED-376, PED-3931, PED-4022, PED-835, SES-1880, SLE-18375, SLE-18377, SLE-18378, SLE-18379, SLE-18383, SLE-18384, SLE-18385, SLE-18978, SLE-18992, SLE-19001, SLE-19253, SLE-19255, SLE-19556 Sources used: openSUSE Leap 15.5 (src): kernel-livepatch-SLE15-SP5_Update_1-1-150500.11.7.1, kernel-syms-5.14.21-150500.55.7.1, kernel-obs-qa-5.14.21-150500.55.7.1, kernel-obs-build-5.14.21-150500.55.7.1, kernel-source-5.14.21-150500.55.7.1, kernel-default-base-5.14.21-150500.55.7.1.150500.6.2.5 Basesystem Module 15-SP5 (src): kernel-source-5.14.21-150500.55.7.1, kernel-default-base-5.14.21-150500.55.7.1.150500.6.2.5 Development Tools Module 15-SP5 (src): kernel-source-5.14.21-150500.55.7.1, kernel-syms-5.14.21-150500.55.7.1, kernel-obs-build-5.14.21-150500.55.7.1 SUSE Linux Enterprise Live Patching 15-SP5 (src): kernel-livepatch-SLE15-SP5_Update_1-1-150500.11.7.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 39](show_bug.cgi?id=1207560#c39)  Maintenance Automation   2024-02-27 12:00:49 UTC  ``` SUSE-SU-2023:2646-1: An update that solves 69 vulnerabilities, contains six features and has 292 security fixes can now be installed.  Category: security (important) Bug References: 1065729, 1109158, 1142685, 1152472, 1152489, 1155798, 1160435, 1166486, 1172073, 1174777, 1177529, 1186449, 1189998, 1189999, 1191731, 1193629, 1194869, 1195175, 1195655, 1195921, 1196058, 1197534, 1197617, 1198101, 1198438, 1198835, 1199304, 1200054, 1202353, 1202633, 1203039, 1203200, 1203325, 1203331, 1203332, 1203693, 1203906, 1204356, 1204662, 1204993, 1205191, 1205205, 1205544, 1205650, 1205756, 1205758, 1205760, 1205762, 1205803, 1205846, 1206024, 1206036, 1206056, 1206057, 1206103, 1206224, 1206232, 1206340, 1206459, 1206492, 1206493, 1206552, 1206578, 1206640, 1206649, 1206677, 1206824, 1206843, 1206876, 1206877, 1206878, 1206880, 1206881, 1206882, 1206883, 1206884, 1206885, 1206886, 1206887, 1206888, 1206889, 1206890, 1206891, 1206893, 1206894, 1206935, 1206992, 1207034, 1207050, 1207088, 1207149, 1207158, 1207168, 1207185, 1207270, 1207315, 1207328, 1207497, 1207500, 1207501, 1207506, 1207507, 1207521, 1207553, 1207560, 1207574, 1207588, 1207589, 1207590, 1207591, 1207592, 1207593, 1207594, 1207602, 1207603, 1207605, 1207606, 1207607, 1207608, 1207609, 1207610, 1207611, 1207612, 1207613, 1207614, 1207615, 1207616, 1207617, 1207618, 1207619, 1207620, 1207621, 1207622, 1207623, 1207624, 1207625, 1207626, 1207627, 1207628, 1207629, 1207630, 1207631, 1207632, 1207633, 1207634, 1207635, 1207636, 1207637, 1207638, 1207639, 1207640, 1207641, 1207642, 1207643, 1207644, 1207645, 1207646, 1207647, 1207648, 1207649, 1207650, 1207651, 1207652, 1207653, 1207734, 1207768, 1207769, 1207770, 1207771, 1207773, 1207795, 1207827, 1207842, 1207845, 1207875, 1207878, 1207935, 1207948, 1208050, 1208076, 1208081, 1208105, 1208107, 1208128, 1208130, 1208149, 1208153, 1208183, 1208212, 1208219, 1208290, 1208368, 1208420, 1208428, 1208429, 1208449, 1208534, 1208541, 1208542, 1208570, 1208588, 1208598, 1208599, 1208600, 1208602, 1208604, 1208605, 1208607, 1208619, 1208628, 1208700, 1208758, 1208759, 1208776, 1208777, 1208784, 1208787, 1208815, 1208816, 1208829, 1208837, 1208843, 1208845, 1208848, 1208864, 1208902, 1208948, 1208976, 1209008, 1209052, 1209092, 1209159, 1209256, 1209258, 1209262, 1209287, 1209288, 1209290, 1209292, 1209367, 1209457, 1209504, 1209532, 1209556, 1209600, 1209635, 1209636, 1209637, 1209684, 1209687, 1209693, 1209739, 1209779, 1209788, 1209798, 1209799, 1209804, 1209805, 1209856, 1209871, 1209927, 1209980, 1209982, 1209999, 1210034, 1210050, 1210158, 1210165, 1210202, 1210203, 1210206, 1210216, 1210230, 1210294, 1210301, 1210329, 1210336, 1210409, 1210439, 1210449, 1210450, 1210469, 1210498, 1210506, 1210533, 1210551, 1210629, 1210644, 1210647, 1210725, 1210741, 1210762, 1210763, 1210764, 1210765, 1210766, 1210767, 1210768, 1210769, 1210770, 1210771, 1210775, 1210783, 1210791, 1210793, 1210806, 1210816, 1210817, 1210827, 1210940, 1210943, 1210947, 1210953, 1210986, 1211025, 1211037, 1211043, 1211044, 1211089, 1211105, 1211113, 1211131, 1211140, 1211205, 1211263, 1211280, 1211281, 1211299, 1211387, 1211414, 1211449, 1211465, 1211519, 1211564, 1211590, 1211592, 1211593, 1211595, 1211654, 1211686, 1211687, 1211688, 1211689, 1211690, 1211691, 1211692, 1211693, 1211714, 1211796, 1211804, 1211807, 1211808, 1211820, 1211836, 1211847, 1211855, 1211960, 1212129, 1212154, 1212155, 1212158 CVE References: CVE-2022-2196, CVE-2022-36280, CVE-2022-38096, CVE-2022-4269, CVE-2022-45884, CVE-2022-45885, CVE-2022-45886, CVE-2022-45887, CVE-2022-45919, CVE-2022-4744, CVE-2023-0045, CVE-2023-0122, CVE-2023-0179, CVE-2023-0394, CVE-2023-0461, CVE-2023-0469, CVE-2023-0590, CVE-2023-0597, CVE-2023-1075, CVE-2023-1076, CVE-2023-1077, CVE-2023-1079, CVE-2023-1095, CVE-2023-1118, CVE-2023-1380, CVE-2023-1382, CVE-2023-1513, CVE-2023-1582, CVE-2023-1583, CVE-2023-1611, CVE-2023-1637, CVE-2023-1652, CVE-2023-1670, CVE-2023-1838, CVE-2023-1855, CVE-2023-1989, CVE-2023-1998, CVE-2023-2002, CVE-2023-21102, CVE-2023-21106, CVE-2023-2124, CVE-2023-2156, CVE-2023-2162, CVE-2023-2176, CVE-2023-2235, CVE-2023-2269, CVE-2023-22998, CVE-2023-23000, CVE-2023-23001, CVE-2023-23004, CVE-2023-23006, CVE-2023-2483, CVE-2023-25012, CVE-2023-2513, CVE-2023-26545, CVE-2023-28327, CVE-2023-28410, CVE-2023-28464, CVE-2023-3006, CVE-2023-30456, CVE-2023-30772, CVE-2023-31084, CVE-2023-3141, CVE-2023-31436, CVE-2023-3161, CVE-2023-32233, CVE-2023-33288, CVE-2023-33951, CVE-2023-33952 Jira References: PED-3210, PED-3259, PED-3692, PED-3750, PED-3759, PED-4022 Sources used: openSUSE Leap 15.5 (src): kernel-source-azure-5.14.21-150500.33.3.1, kernel-syms-azure-5.14.21-150500.33.3.1 Public Cloud Module 15-SP5 (src): kernel-source-azure-5.14.21-150500.33.3.1, kernel-syms-azure-5.14.21-150500.33.3.1  NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination. ``` [Comment 43](show_bug.cgi?id=1207560#c43)  Robert Frohl   2024-05-03 10:42:48 UTC  ``` done, closing ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=1207560)
* -Â [XML](show_bug.cgi?ctype=xml&id=1207560)
* -Â [Clone This Bug](enter_bug.cgi?cloned_bug_id=1207560)
* -Â Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [IDP Log In](/saml2_login.cgi?idp=IDP&target=show_bug.cgi%3Fid%3D1207560)
  + |
    [Forgot Password](https://idp-portal.suse.com/univention/self-service/#page=passwordreset)

+ Legal:
+ [openSUSE](http://en.opensuse.org/Terms_of_site)
+ [SUSE](https://www.suse.com/company/legal/)



=== Content from lore.kernel.org_042ecdf5_20250115_082756.html ===

```
[All of lore.kernel.org](../?t=20230126002522)
 [help](../_/text/help/) / [color](../_/text/color/) / [mirror](../_/text/mirror/) / [Atom feed](../new.atom)
```
```
From: Pietro Borrello <borrello@diag.uniroma1.it>
To: Jiri Kosina <jikos@kernel.org>,
	Benjamin Tissoires <benjamin.tissoires@redhat.com>,
	Hanno Zulla <kontakt@hanno.de>, Carlo Caione <carlo@endlessm.com>,
	Pavel Machek <pavel@ucw.cz>, Lee Jones <lee@kernel.org>,
	Roderick Colenbrander <roderick.colenbrander@sony.com>,
	Sven Eckelmann <sven@narfation.org>
Cc: [linux-leds@vger.kernel.org](../../linux-leds/?t=20230126002522),
	Cristiano Giuffrida <c.giuffrida@vu.nl>,
	"Bos, H.J." <h.j.bos@vu.nl>, Jakob Koschel <jkl820.git@gmail.com>,
	[linux-input@vger.kernel.org](../../linux-input/?t=20230126002522), [linux-kernel@vger.kernel.org](../../lkml/?t=20230126002522),
	Jiri Kosina <jkosina@suse.cz>,
	Roderick Colenbrander <roderick@gaikai.com>,
	Pietro Borrello <borrello@diag.uniroma1.it>
Subject: [[PATCH 1/5] HID: bigben_remove: manually unregister leds](#r)
Date: Thu, 26 Jan 2023 00:24:53 +0000	[[thread overview]](#r)
Message-ID: <20230125-hid-unregister-leds-v1-1-9a5192dcef16@diag.uniroma1.it> (<raw>)
In-Reply-To: <[20230125-hid-unregister-leds-v1-0-9a5192dcef16@diag.uniroma1.it](../20230125-hid-unregister-leds-v1-0-9a5192dcef16%40diag.uniroma1.it/)>

Unregister the LED controllers before device removal, as
bigben_set_led() may schedule bigben->worker after the structure has
been freed, causing a use-after-free.

Fixes: 4eb1b01de5b9 ("HID: hid-bigbenff: fix race condition for scheduled work during removal")
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>
---
 [drivers/hid/hid-bigbenff.c](#Z31drivers:hid:hid-bigbenff.c) | 5 +++++
 1 file [changed](#related), 5 insertions(+)

[diff](#iZ31drivers:hid:hid-bigbenff.c) --git a/drivers/hid/hid-bigbenff.c b/drivers/hid/hid-bigbenff.c
index e8b16665860d..d3201b755595 100644
--- a/drivers/hid/hid-bigbenff.c
+++ b/drivers/hid/hid-bigbenff.c
@@ -306,9 +306,14 @@ static enum led_brightness bigben_get_led(struct led_classdev *led)

 static void bigben_remove(struct hid_device *hid)
 {
+	int n;
 	struct bigben_device *bigben = hid_get_drvdata(hid);

 	bigben->removed = true;
+	for (n = 0; n < NUM_LEDS; n++) {
+		if (bigben->leds[n])
+			devm_led_classdev_unregister(&hid->dev, bigben->leds[n]);
+	}
 	cancel_work_sync(&bigben->worker);
 	hid_hw_stop(hid);
 }

--
2.25.1

```

---

```
[next](../20230125-hid-unregister-leds-v1-2-9a5192dcef16%40diag.uniroma1.it/) [prev parent](../20230125-hid-unregister-leds-v1-0-9a5192dcef16%40diag.uniroma1.it/) [reply](#R)	other threads:[[~2023-01-26  0:25 UTC](../?t=20230126002522)|[newest](../)]

Thread overview: 15+ messages / expand[[flat](T/#u)|[nested](t/#u)]  [mbox.gz](t.mbox.gz)  [Atom feed](t.atom)  [top](#b)
2023-01-26  0:24 [[PATCH 0/5] HID: manually unregister leds on device removal to prevent UAFs](../20230125-hid-unregister-leds-v1-0-9a5192dcef16%40diag.uniroma1.it/) Pietro Borrello
2023-01-26  0:24 ` [Pietro Borrello [this message]](#t)
2023-01-26  0:24 ` [[PATCH 2/5] HID: asus_remove: manually unregister led](../20230125-hid-unregister-leds-v1-2-9a5192dcef16%40diag.uniroma1.it/) Pietro Borrello
2023-01-26  0:24 ` [[PATCH 3/5] HID: dualsense_remove: manually unregister leds](../20230125-hid-unregister-leds-v1-3-9a5192dcef16%40diag.uniroma1.it/) Pietro Borrello
2023-01-26  0:43   ` [Roderick Colenbrander](../CAEc3jaCEKfqEJSV4%3D6GRj1Ry97xH%2BHwVSeEOZReNwkt%3DrLNvNQ%40mail.gmail.com/)
2023-01-26  0:47     ` [Roderick Colenbrander](../CAEc3jaDRzvw4wqomWTZ4QiGT7ndm0u%2BLQuqDTOWB%3DB-6w%3D2yzg%40mail.gmail.com/)
2023-01-26 12:09       ` [[PATCH v2](../20230125-hid-unregister-leds-v2-3-514437b19297%40diag.uniroma1.it/) " Pietro Borrello
2023-01-26 12:11       ` [[PATCH v2 4/5] HID: dualshock4_remove:](../20230125-hid-unregister-leds-v2-4-514437b19297%40diag.uniroma1.it/) " Pietro Borrello
2023-01-26  1:01     ` [[PATCH 3/5] HID: dualsense_remove:](../CAEih1qUeDTmN80zSS3ixzVep%3D5EWhootnjMS8g%2Bpv%2BC-uWTRRA%40mail.gmail.com/) " Pietro Borrello
2023-01-26  0:24 ` [[PATCH 4/5] HID: dualshock4_remove:](../20230125-hid-unregister-leds-v1-4-9a5192dcef16%40diag.uniroma1.it/) " Pietro Borrello
2023-01-26  0:24 ` [[PATCH 5/5] HID: sony_remove:](../20230125-hid-unregister-leds-v1-5-9a5192dcef16%40diag.uniroma1.it/) " Pietro Borrello
2023-01-26  8:32   ` [Sven Eckelmann](../5192178.GXAFRqVoOG%40ripper/)
2023-05-10 10:12 ` [[PATCH 0/5] HID: manually unregister leds on device removal to prevent UAFs](../288ed0da-8903-7dda-eb4e-f17037031e68%40molgen.mpg.de/) Donald Buczek
2023-05-10 10:59   ` [Benjamin Tissoires](../CAO-hwJLmuB0%3DTiK6RcPKh4uFcX%2BA5bU9rivQ-K6Y7bzZKA6n4w%40mail.gmail.com/)
2023-05-10 11:41   ` [Pavel Machek](../ZFuC7VEMJzdBulg/%40duo.ucw.cz/)

```
```
find likely ancestor, descendant, or conflicting patches for [this message](#t):
( dfblob:e8b16665860 dfblob:d3201b75559 )
 OR (
bs:"[PATCH 1/5] HID: bigben_remove: manually unregister leds" )
	([help](../_/text/help/#search))
```

---

```
Reply instructions:

You may reply publicly to [this message](#t) via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: [mbox](raw)

  Avoid top-posting and favor interleaved quoting:
  <https://en.wikipedia.org/wiki/Posting_style#Interleaved_style>

* Reply using the --to, --cc, and --in-reply-to
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20230125-hid-unregister-leds-v1-1-9a5192dcef16@diag.uniroma1.it \
    --to=borrello@diag.uniroma1.it \
    --cc=benjamin.tissoires@redhat.com \
    --cc=c.giuffrida@vu.nl \
    --cc=carlo@endlessm.com \
    --cc=h.j.bos@vu.nl \
    --cc=jikos@kernel.org \
    --cc=jkl820.git@gmail.com \
    --cc=jkosina@suse.cz \
    --cc=kontakt@hanno.de \
    --cc=lee@kernel.org \
    --cc=linux-input@vger.kernel.org \
    --cc=linux-kernel@vger.kernel.org \
    --cc=linux-leds@vger.kernel.org \
    --cc=pavel@ucw.cz \
    --cc=roderick.colenbrander@sony.com \
    --cc=roderick@gaikai.com \
    --cc=sven@narfation.org \
    /path/to/YOUR_REPLY

  <https://kernel.org/pub/software/scm/git/docs/git-send-email.html>

* If your mail client supports setting the In-Reply-To header
  via mailto: links, try the mailto: link

```
Be sure your reply has a **Subject:** header at the top and a blank line
before the message body.

---

```
This is an external index of several public inboxes,
see [mirroring instructions](../_/text/mirror/) on how to clone and mirror
all data and code used by this external index.
```


=== Content from git.kernel.org_d90b59ca_20250115_082755.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pietro Borrello <borrello@diag.uniroma1.it> | 2023-02-12 19:00:01 +0000 |
| --- | --- | --- |
| committer | Benjamin Tissoires <benjamin.tissoires@redhat.com> | 2023-02-15 18:18:48 +0100 |
| commit | [76ca8da989c7d97a7f76c75d475fe95a584439d7](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)) | |
| tree | [4e31fbde4f4424f3c2bb39c3fc1225b06e9b881b](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7) | |
| parent | [27d2a2fd844ec7da70d19fabb482304fd1e0595b](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7&id2=27d2a2fd844ec7da70d19fabb482304fd1e0595b)) | |
| download | [linux-76ca8da989c7d97a7f76c75d475fe95a584439d7.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-76ca8da989c7d97a7f76c75d475fe95a584439d7.tar.gz) | |

HID: bigben: use spinlock to safely schedule workersUse spinlocks to deal with workers introducing a wrapper
bigben\_schedule\_work(), and several spinlock checks.
Otherwise, bigben\_set\_led() may schedule bigben->worker after the
structure has been freed, causing a use-after-free.
Fixes: 4eb1b01de5b9 ("HID: hid-bigbenff: fix race condition for scheduled work during removal")
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>
Link: [https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-3-7860c5763c38@diag.uniroma1.it](https://lore.kernel.org/r/20230125-hid-unregister-leds-v4-3-7860c5763c38%40diag.uniroma1.it)
Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)

| -rw-r--r-- | [drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/hid-bigbenff.c?id=76ca8da989c7d97a7f76c75d475fe95a584439d7) | 18 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 12 insertions, 6 deletions

| diff --git a/drivers/hid/hid-bigbenff.c b/drivers/hid/hid-bigbenff.cindex b98c5f31c184bb..9d6560db762b1e 100644--- a/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=27d2a2fd844ec7da70d19fabb482304fd1e0595b)+++ b/[drivers/hid/hid-bigbenff.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/hid-bigbenff.c?id=76ca8da989c7d97a7f76c75d475fe95a584439d7)@@ -185,6 +185,15 @@ struct bigben\_device { struct work\_struct worker; }; +static inline void bigben\_schedule\_work(struct bigben\_device \*bigben)+{+ unsigned long flags;++ spin\_lock\_irqsave(&bigben->lock, flags);+ if (!bigben->removed)+ schedule\_work(&bigben->worker);+ spin\_unlock\_irqrestore(&bigben->lock, flags);+}  static void bigben\_worker(struct work\_struct \*work) {@@ -197,9 +206,6 @@ static void bigben\_worker(struct work\_struct \*work) u32 len; unsigned long flags; - if (bigben->removed)- return;- buf = hid\_alloc\_report\_buf(bigben->report, GFP\_KERNEL); if (!buf) return;@@ -285,7 +291,7 @@ static int hid\_bigben\_play\_effect(struct input\_dev \*dev, void \*data, bigben->work\_ff = true; spin\_unlock\_irqrestore(&bigben->lock, flags); - schedule\_work(&bigben->worker);+ bigben\_schedule\_work(bigben); }  return 0;@@ -320,7 +326,7 @@ static void bigben\_set\_led(struct led\_classdev \*led,  if (work) { bigben->work\_led = true;- schedule\_work(&bigben->worker);+ bigben\_schedule\_work(bigben); } return; }@@ -450,7 +456,7 @@ static int bigben\_probe(struct hid\_device \*hid, bigben->left\_motor\_force = 0; bigben->work\_led = true; bigben->work\_ff = true;- schedule\_work(&bigben->worker);+ bigben\_schedule\_work(bigben);  hid\_info(hid, "LED and force feedback support for BigBen gamepad\n"); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 08:26:33 +0000



=== Content from lore.kernel.org_fd36fd06_20250115_132048.html ===

```
[All of lore.kernel.org](../?t=20230131130908)
 [help](../_/text/help/) / [color](../_/text/color/) / [mirror](../_/text/mirror/) / [Atom feed](../new.atom)
```
```
From: Pietro Borrello <borrello@diag.uniroma1.it>
To: Jiri Kosina <jikos@kernel.org>,
	Benjamin Tissoires <benjamin.tissoires@redhat.com>,
	Hanno Zulla <kontakt@hanno.de>, Pavel Machek <pavel@ucw.cz>,
	Lee Jones <lee@kernel.org>,
	Roderick Colenbrander <roderick.colenbrander@sony.com>,
	Sven Eckelmann <sven@narfation.org>
Cc: [linux-leds@vger.kernel.org](../../linux-leds/?t=20230131130908),
	Cristiano Giuffrida <c.giuffrida@vu.nl>,
	"Bos, H.J." <h.j.bos@vu.nl>, Jakob Koschel <jkl820.git@gmail.com>,
	[linux-input@vger.kernel.org](../../linux-input/?t=20230131130908), [linux-kernel@vger.kernel.org](../../lkml/?t=20230131130908),
	Jiri Kosina <jkosina@suse.cz>,
	Roderick Colenbrander <roderick@gaikai.com>,
	Pietro Borrello <borrello@diag.uniroma1.it>
Subject: [[PATCH v2 0/5] HID: manually unregister leds on device removal to prevent UAFs](#r)
Date: Tue, 31 Jan 2023 13:08:45 +0000	[[thread overview]](#r)
Message-ID: <20230125-hid-unregister-leds-v2-0-689cc62fc878@diag.uniroma1.it> (<raw>)

I noticed a recurring pattern is present in multiple hid devices in the
Linux tree, where the LED controller of a device schedules a work_struct
to interact with the hardware.
The work_struct is embedded in the device structure and thus, is freed
at device removal.

The issue is that a LED worker may be scheduled by a timer concurrently
with device removal, causing the work_struct to be accessed after having
been freed.
I was able to trigger the issue in hid-bigbenff.c and hid-asus.c
where the work_structs may be scheduled by the LED controller
while the device is disconnecting, triggering use-after-frees.
I can attach the reproducer, but it's very simple USB configuration,
using the /dev/raw-gadget interface with some more USB interactions
to manage LEDs configuration and pass checks in asus_kbd_init()
and asus_kbd_get_functions() in case of hid-asus.c.
I triggered the issue by connecting a device and immediately
disconnecting it, so that the remove function runs before the LED one
which remains pending.

More drivers have the same pattern (hid-lg-g15.c, hid-playstation.c,
hid-sony.c) but I wasn't able to properly pass the right descriptors
to trigger the led configurations needed to trigger the workers.
Some other drivers manually unregister at removal (hid-corsair.c,
hid-gt683r.c, hid-lenovo.c) since they do not use the managed
interface, which is safe, to my understanding.
Also, a similar pattern is present with callbacks which schedule
a worker originating from input_ff_create_memless() (e.g.,
in hid-bigbenff.c) but in these cases, I wasn't able to trigger
the race condition with the event handling to schedule the worker
during device removal. However, I have no experience with the USB
protocol and I'm not able to say that they cannot be triggered.

I am currently wondering if this is due to some emulation of the
/dev/raw-gadget interface or if it's effectively an issue with how each
device manages resource removal.
But I wonder why syzkaller didn't find any crash while fuzzing the
interface with upstream-usb.config, as they seem pretty
straightforward to trigger.
Configuring the kernel with CONFIG_DEBUG_OBJECTS, it emits
a warning in debug_check_no_obj_freed, which makes it clear that
device removal is freeing resources in use.
KASAN detects them as use-after-free.

I am attaching multiple patches for all the drivers I suspect the bug
is present.
The proposed patches unregister the LED controllers before removing the
device itself.

I attach the (partial for brevity) ODEBUG dumps:

```hid-bigbenff.c
[   37.803135][ T1170] usb 1-1: USB disconnect, device number 2
[   37.827979][ T1170] ODEBUG: free active (active state 0) object
type: work_struct hint: bigben_worker+0x0/0x860
[   37.829634][ T1170] WARNING: CPU: 0 PID: 1170 at
lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
[   37.830904][ T1170] Modules linked in:
[   37.831413][ T1170] CPU: 0 PID: 1170 Comm: kworker/0:3 Not tainted
6.1.0-rc4-dirty #43
[   37.832465][ T1170] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[   37.833751][ T1170] Workqueue: usb_hub_wq hub_event
[   37.834409][ T1170] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
[   37.835218][ T1170] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
05 4f 7c 17
[   37.837667][ T1170] RSP: 0018:ffffc900006fee60 EFLAGS: 00010246
[   37.838503][ T1170] RAX: 0d2d19ffcded3d00 RBX: 0000000000000000
RCX: ffff888117fc9b00
[   37.839519][ T1170] RDX: 0000000000000000 RSI: 0000000000000000
RDI: 0000000000000000
[   37.840570][ T1170] RBP: ffffffff86e88380 R08: ffffffff8130793b
R09: fffff520000dfd85
[   37.841618][ T1170] R10: fffff520000dfd85 R11: 0000000000000000
R12: ffffffff87095fb8
[   37.842649][ T1170] R13: ffff888117770ad8 R14: ffff888117770acc
R15: ffffffff852b7420
[   37.843728][ T1170] FS:  0000000000000000(0000)
GS:ffff8881f6600000(0000) knlGS:0000000000000000
[   37.844877][ T1170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   37.845749][ T1170] CR2: 00007f992eaab380 CR3: 000000011834b000
CR4: 00000000001006f0
[   37.846794][ T1170] Call Trace:
[   37.847245][ T1170]  <TASK>
[   37.847643][ T1170]  slab_free_freelist_hook+0x89/0x160
[   37.848409][ T1170]  ? devres_release_all+0x262/0x350
[   37.849156][ T1170]  __kmem_cache_free+0x71/0x110
[   37.849829][ T1170]  devres_release_all+0x262/0x350
[   37.850478][ T1170]  ? devres_release+0x90/0x90
[   37.851118][ T1170]  device_release_driver_internal+0x5e5/0x8a0
[   37.851944][ T1170]  bus_remove_device+0x2ea/0x400
[   37.852611][ T1170]  device_del+0x64f/0xb40
[   37.853212][ T1170]  ? kill_device+0x150/0x150
[   37.853831][ T1170]  ? print_irqtrace_events+0x1f0/0x1f0
[   37.854564][ T1170]  hid_destroy_device+0x66/0x100
[   37.855226][ T1170]  usbhid_disconnect+0x9a/0xc0
[   37.855887][ T1170]  usb_unbind_interface+0x1e1/0x890
```

``` hid-asus.c
[   77.409878][ T1169] usb 1-1: USB disconnect, device number 2
[   77.423606][ T1169] ODEBUG: free active (active state 0) object
type: work_struct hint: asus_kbd_backlight_work+0x0/0x2c0
[   77.425222][ T1169] WARNING: CPU: 0 PID: 1169 at
lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
[   77.426599][ T1169] Modules linked in:
[   77.427322][ T1169] CPU: 0 PID: 1169 Comm: kworker/0:3 Not tainted
6.1.0-rc4-dirty #43
[   77.428404][ T1169] Hardware name: QEMU Standard PC (i440FX + PIIX,
1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
[   77.429644][ T1169] Workqueue: usb_hub_wq hub_event
[   77.430296][ T1169] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
[   77.431142][ T1169] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
05 4f 7c 17
[   77.433691][ T1169] RSP: 0018:ffffc9000069ee60 EFLAGS: 00010246
[   77.434470][ T1169] RAX: b85d2b40c12d7600 RBX: 0000000000000000
RCX: ffff888117a78000
[   77.435507][ T1169] RDX: 0000000000000000 RSI: 0000000080000000
RDI: 0000000000000000
[   77.436521][ T1169] RBP: ffffffff86e88380 R08: ffffffff8130793b
R09: ffffed103ecc4ed6
[   77.437582][ T1169] R10: ffffed103ecc4ed6 R11: 0000000000000000
R12: ffffffff87095fb8
[   77.438593][ T1169] R13: ffff88810e348fe0 R14: ffff88810e348fd4
R15: ffffffff852b5780
[   77.439667][ T1169] FS:  0000000000000000(0000)
GS:ffff8881f6600000(0000) knlGS:0000000000000000
[   77.440842][ T1169] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[   77.441688][ T1169] CR2: 00007ffc05495ff0 CR3: 000000010cdf0000
CR4: 00000000001006f0
[   77.442720][ T1169] Call Trace:
[   77.443167][ T1169]  <TASK>
[   77.443555][ T1169]  slab_free_freelist_hook+0x89/0x160
[   77.444302][ T1169]  ? devres_release_all+0x262/0x350
[   77.444990][ T1169]  __kmem_cache_free+0x71/0x110
[   77.445638][ T1169]  devres_release_all+0x262/0x350
[   77.446309][ T1169]  ? devres_release+0x90/0x90
[   77.446978][ T1169]  device_release_driver_internal+0x5e5/0x8a0
[   77.447748][ T1169]  bus_remove_device+0x2ea/0x400
[   77.448421][ T1169]  device_del+0x64f/0xb40
[   77.448976][ T1169]  ? kill_device+0x150/0x150
[   77.449577][ T1169]  ? print_irqtrace_events+0x1f0/0x1f0
[   77.450307][ T1169]  hid_destroy_device+0x66/0x100
[   77.450938][ T1169]  usbhid_disconnect+0x9a/0xc0
```

To: Jiri Kosina <jikos@kernel.org>
To: Benjamin Tissoires <benjamin.tissoires@redhat.com>
To: Hanno Zulla <kontakt@hanno.de>
To: Pavel Machek <pavel@ucw.cz>
To: Lee Jones <lee@kernel.org>
To: Roderick Colenbrander <roderick.colenbrander@sony.com>
To: Sven Eckelmann <sven@narfation.org>
Cc: linux-leds@vger.kernel.org
Cc: Cristiano Giuffrida <c.giuffrida@vu.nl>
Cc: "Bos, H.J." <h.j.bos@vu.nl>
Cc: Jakob Koschel <jkl820.git@gmail.com>
Cc: linux-input@vger.kernel.org
Cc: linux-kernel@vger.kernel.org
Cc: Jiri Kosina <jkosina@suse.cz>
Cc: Roderick Colenbrander <roderick@gaikai.com>
Signed-off-by: Pietro Borrello <borrello@diag.uniroma1.it>

---
Changes in v2:
- dualshock4: Clarify UAF
- dualsense:  Clarify UAF
- dualsense:  Unregister multicolor led controller
- Link to v1: [https://lore.kernel.org/r/20230125-hid-unregister-leds-v1-0-9a5192dcef16@diag.uniroma1.it](https://lore.kernel.org/r/20230125-hid-unregister-leds-v1-0-9a5192dcef16%40diag.uniroma1.it)

---
Pietro Borrello (5):
      HID: bigben_remove: manually unregister leds
      HID: asus_remove: manually unregister led
      HID: dualsense_remove: manually unregister leds
      HID: dualshock4_remove: manually unregister leds
      HID: sony_remove: manually unregister leds

 drivers/hid/hid-asus.c        |  1 +
 drivers/hid/hid-bigbenff.c    |  5 +++++
 drivers/hid/hid-playstation.c | 10 ++++++++++
 drivers/hid/hid-sony.c        |  8 ++++++++
 4 files changed, 24 insertions(+)
---
base-commit: 2241ab53cbb5cdb08a6b2d4688feb13971058f65
change-id: 20230125-hid-unregister-leds-4cbf67099e1d

Best regards,
--
Pietro Borrello <borrello@diag.uniroma1.it>

```

---

```
[next](../20230125-hid-unregister-leds-v2-1-689cc62fc878%40diag.uniroma1.it/)             [reply](#R)other threads:[[~2023-01-31 13:09 UTC](../?t=20230131130908)|[newest](../)]

Thread overview: 11+ messages / expand[[flat](T/#u)|[nested](t/#u)]  [mbox.gz](t.mbox.gz)  [Atom feed](t.atom)  [top](#b)
2023-01-31 13:08 [Pietro Borrello [this message]](#t)
2023-01-31 13:08 ` [[PATCH v2 1/5] HID: bigben_remove: manually unregister leds](../20230125-hid-unregister-leds-v2-1-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-02-09  8:55   ` [Benjamin Tissoires](../20230209085546.ohsonlwgqb7yd3d4%40mail.corp.redhat.com/)
2023-02-09 12:45     ` [Pietro Borrello](../CAEih1qUyxfjWo2vV4AUbwt59tKL2Lmz%3D4P6N4xm9ba99mQiUMA%40mail.gmail.com/)
2023-01-31 13:08 ` [[PATCH v2 2/5] HID: asus_remove: manually unregister led](../20230125-hid-unregister-leds-v2-2-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-01-31 13:08 ` [[PATCH v2 3/5] HID: dualsense_remove: manually unregister leds](../20230125-hid-unregister-leds-v2-3-689cc62fc878%40diag.uniroma1.it/) Pietro Borrello
2023-02-09  8:59   ` [Benjamin Tissoires](../20230209085940.53mrapggf6nagkdh%40mail.corp.redhat.com/)
2023-02-09 12:50     ` [Pietro Borrello](../CAEih1qUU_aaHk7xFuyocgUq0pYLHemuRQiTboZDwyBTd7u2L5g%40mail.gmail.com/)
2023-01-31 13:08 ` [[PATCH v2 4/5] HID: dualshock4_remove:](../20230125-hid-unregister-leds-v2-4-689cc62fc878%40diag.uniroma1.it/) " Pietro Borrello
2023-01-31 13:08 ` [[PATCH v2 5/5] HID: sony_remove:](../20230125-hid-unregister-leds-v2-5-689cc62fc878%40diag.uniroma1.it/) " Pietro Borrello
2023-01-31 17:19 ` [[PATCH v2 0/5] HID: manually unregister leds on device removal to prevent UAFs](../Y9lNnOA87fCt0hFk%40google.com/) Lee Jones

```

---

```
Reply instructions:

You may reply publicly to [this message](#t) via plain-text email
using any one of the following methods:

* Save the following mbox file, import it into your mail client,
  and reply-to-all from there: [mbox](raw)

  Avoid top-posting and favor interleaved quoting:
  <https://en.wikipedia.org/wiki/Posting_style#Interleaved_style>

* Reply using the --to, --cc, and --in-reply-to
  switches of git-send-email(1):

  git send-email \
    --in-reply-to=20230125-hid-unregister-leds-v2-0-689cc62fc878@diag.uniroma1.it \
    --to=borrello@diag.uniroma1.it \
    --cc=benjamin.tissoires@redhat.com \
    --cc=c.giuffrida@vu.nl \
    --cc=h.j.bos@vu.nl \
    --cc=jikos@kernel.org \
    --cc=jkl820.git@gmail.com \
    --cc=jkosina@suse.cz \
    --cc=kontakt@hanno.de \
    --cc=lee@kernel.org \
    --cc=linux-input@vger.kernel.org \
    --cc=linux-kernel@vger.kernel.org \
    --cc=linux-leds@vger.kernel.org \
    --cc=pavel@ucw.cz \
    --cc=roderick.colenbrander@sony.com \
    --cc=roderick@gaikai.com \
    --cc=sven@narfation.org \
    /path/to/YOUR_REPLY

  <https://kernel.org/pub/software/scm/git/docs/git-send-email.html>

* If your mail client supports setting the In-Reply-To header
  via mailto: links, try the mailto: link

```
Be sure your reply has a **Subject:** header at the top and a blank line
before the message body.

---

```
This is an external index of several public inboxes,
see [mirroring instructions](../_/text/mirror/) on how to clone and mirror
all data and code used by this external index.
```


=== Content from www.openwall.com_0c52f3c7_20250115_082753.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2023/11/02/2) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20231105172713.GA21489@openwall.com>
Date: Sun, 5 Nov 2023 18:27:13 +0100
From: Solar Designer <solar@...nwall.com>
To: oss-security@...ts.openwall.com
Cc: Pietro Borrello <borrello@...g.uniroma1.it>
Subject: CVE-2023-1078: Linux: rds_rm_zerocopy_callback() bugs

Hi,

There was a thread on linux-distros in February, where Pietro brought up
multiple Linux kernel issues at once.  Some of these were already on
oss-security by the time (as indicated below), four others were brought
to oss-security on March 1st:

<https://www.openwall.com/lists/oss-security/2023/03/01/>

However, it looks like one CVE corresponding to two bugs was not, so I
am correcting this now.  The missed CVE was assigned as follows:

> CVE-2023-1078 - Heap OOB Write in rds_rm_zerocopy_callback()
> patch:
> <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=f753a68980cf4b59a80fe677619da2b1804f526d>
>
> CVE-2023-1078 - Resource leak (leading to memory exhaustion) in rds_rm_zerocopy_callback()
> patch:
> <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=68762148d1b011d47bc2ceed7321739b5aea1e63>

Ubuntu security advisories describe it as:

> It was discovered that the Reliable Datagram Sockets (RDS) protocol
> implementation in the Linux kernel contained a type confusion vulnerability
> in some situations. An attacker could use this to cause a denial of service
> (system crash). (CVE-2023-1078)

You can see Pietro's own more detailed descriptions of the two bugs by
searching the message below for mentions of rds_rm_zerocopy_callback().

Alexander

----- Forwarded message from Pietro Borrello <borrello@...g.uniroma1.it> -----

From: Pietro Borrello <borrello@...g.uniroma1.it>
Subject: Re: [vs-plain] CVE Request
CC: linux-distros
Date: Wed, 22 Feb 2023 20:13:29 +0100

Attached the more detailed report.

- Type Confusion in hid_validate_values()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=b12fece4c64857e5fab4290bf01b2e0317a88456>
oss-security: <https://www.openwall.com/lists/oss-security/2023/01/17/3>
attack-type: physical
impact: memory corruption -> privilege escalation
details: hid_validate_values fails to properly check the shape of USB
reports, causing type confusion if a malicious device advertises
invalid reports. On default configuration the type confusion results
in the function failing due to field alignment, but any non-default
configuration including structure layout randomization or having
different struct field layout would incur in memory corruption.

- Type Confusion in bigben_probe()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=c7bf714f875531f227f2ef1fdcc8f4d44e7c7d9d>
oss-security: <https://www.openwall.com/lists/oss-security/2023/01/17/3>
attack-type: physical
impact: memory corruption -> privilege escalation
details: bigben_probe() fails to properly check the shape of USB
reports, causing type confusion if a malicious device advertises
invalid reports. On default configuration the type confusion results
in the function failing due to field alignment, but any non-default
configuration including structure layout randomization or having
different struct field layout would incur in memory corruption.

- NULL Ptr Deref in hid_betopff_play()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=3782c0d6edf658b71354a64d60aa7a296188fc90>
oss-security: <https://www.openwall.com/lists/oss-security/2023/01/18/3>
attack-type: physical
impact: DOS/privilege escalation
details: betopff_init does not properly check the shape of USB report,
causing a NULL ptr dereference in hid_betopff_play() on default
configuration. NULL pointer dereferences may be exploited to achieve
LPE (e.g., see <https://googleprojectzero.blogspot.com/2023/01/exploiting-null-dereferences-in-linux.html>).
On non default configuration, as the NULL deref is caused by a type
confusion, a different field layout may cause further memory
corruption.

- KASLR Leak in inet_diag_msg_sctpasoc_fill()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=458e279f861d3f61796894cd158b780765a1569f>
oss-security: <https://www.openwall.com/lists/oss-security/2023/01/23/1>
attack-type: local
impact: information disclosure
details: a type confusion in inet_diag_msg_sctpasoc_fill() in
net/sctp/diag.c, uses a type confused pointer to return information to
userspace when issuing a list_entry() on
asoc->base.bind_addr.address_list.next when the list is empty.
The impact of the type confusion is a KASLR leak since the
`laddr.v6.sin6_addr` is returned from the type confused pointer, which
overlaps with `struct sctp_endpoint *ep` of the `struct
sctp_association`.

- Type Confusion in tls_is_tx_ready()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=ffe2a22562444720b05bdfeb999c03e810d84cbb>
attack-type: local
impact: information disclosure
details: tls_is_tx_ready() incorrectly checks for list emptyness,
potentially accessing a type confused entry to the list_head, leaking
the last byte of the confused field that overlaps with rec->tx_ready.

- Incorrect UID assigned to tun/tap sockets
patch (tap): <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=66b2c338adce580dfce2199591e65e2bab889cff>
patch (tun): <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=a096ccca6e503a5c575717ff8a36ace27510ab0a>
attack-type: local
impact: filtering/routing bypass for virtual sockets
details: tun/tap sockets have their socket UID hardcoded to 0 due to a
type confusion in their initialization function.
While it will be often correct, as tuntap devices require
CAP_NET_ADMIN, it may not always be the case, e.g., a non-root user
only having that capability. This would make tun/tap sockets being
incorrectly treated in filtering/routing decisions, possibly bypassing
network filters.

- Type confusion in pick_next_rt_entity()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=7c4a5b89a0b5a57a64b601775b296abf77a9fe97>
attack-type: local
impact: memory corruption -> privilege escalation
details: pick_next_rt_entity() may return a type confused entry, not
detected by the BUG_ON condition, as the confused entry will not be
NULL, but list_head.
The buggy error condition would lead to a type confused entry with the
list head, which would then be used as a type confused
sched_rt_entity, causing memory corruption.

- Heap OOB Write in rds_rm_zerocopy_callback()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=f753a68980cf4b59a80fe677619da2b1804f526d>
attack-type: local
impact: memory corruption -> privilege escalation
details: The rds_rm_zerocopy_callback() issues a list_entry() on the
actual head of a list, instead of calling list_first_entry(). This
causes a type confusion and the `struct rds_msg_zcopy_info *info`
actually points to `&q->zcookie_head`.
In rds_zcookie_add(), `info->zcookies` is used, which if type confused
overlaps with `spinlock_t lock` in `struct rds_msg_zcopy_queue`. The
function writes `cookie`, which is completely controlled by userspace,
to `ck->cookies[ncookies]`.
`ncookies` is read from `ck->num` which overlaps with the `lock`
counter, and is then incremented, also corrupting the `lock`.
This effectively results in a controlled OOB write from `struct
rds_msg_zcopy_queue` embedded at the end of `struct rds_sock`.
The value is completely controlled, while the index depends on the
`lock` state, being 1 by default, which I suspect can be controlled
too.

- Type Confusion in sctp_sock_filter()
*removed from the request as not security relevant in default configurations*

- Resource leak (leading to memory exhaustion) in rds_rm_zerocopy_callback()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=68762148d1b011d47bc2ceed7321739b5aea1e63>
attack-type: local
impact: DOS
details: rds_rm_zerocopy_callback() uses list_add_tail() with swapped
arguments. This links the list head with the new entry, losing the
references to the remaining part of the list, and causing the resource
leak of the allocated entries. Repeating the leak may cause resource
exhaustion.

- Use After Free in asus_remove()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=4ab3a086d10eeec1424f2e8a968827a6336203df>
attack-type: physical
impact: memory corruption -> privilege escalation
details: Similarly to CVE-2023-25012 , in asus devices, the
work_struct may be scheduled by the LED controller while the device is
disconnecting, triggering a use-after-free on the struct asus_kbd_leds
*led structure. A malicious USB device may exploit the issue to cause
memory corruption with controlled data.

- Heap OOB Write in bigben_worker()
patch: <https://git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/commit/?id=b94335f899542a0da5fafc38af8edcaf90195843>
attack-type: local
impact: memory corruption -> privilege escalation
details: bigben_probe() does not validate that the output report has
the needed report values in the first field. A malicious device
registering a report with one field and a single value causes an heap
OOB write in bigben_worker() when accessing report_field->value[1] to
report_field->value[7], with partially user-controlled values.

Best regards,
Pietro Borrello

----- End forwarded message -----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_38f925de_20250115_082753.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2023/02/01/5) [[next>]](2) [[<thread-prev]](../../../2023/01/25/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <759ffb00-cb84-b53d-5506-53543b015afa@suse.de>
Date: Thu, 2 Feb 2023 08:43:30 +0100
From: Thomas Leroy <tleroy@...e.de>
To: oss-security@...ts.openwall.com,
 Pietro Borrello <borrello@...g.uniroma1.it>
Subject: Re: Linux Kernel: hid: Use-After-Free in
 bigben_set_led()

MITRE assigned CVE-2023-25012 to this issue.

Best regards,
Thomas

On 1/25/23 23:33, Pietro Borrello wrote:
> Hi all,
>
> I'm disclosing a Use After Free that may be triggered when plugging in a
> malicious USB device, which advertises itself as a bigben device.
>
> The device uses a worker `bigben_worker` scheduled by bigben_set_led() to
> communicate with the hardware.
> The work_struct is embedded in `struct bigben_device`, and at device removal,
> `struct bigben_device` is freed.
>
> However, concurrently with device removal, the LED controller bigben_set_led()
> may schedule a worker whose use would result in a use-after-free.
>
> Following the debug check triggered by freeing a work_struct in use:
> ```
> [   37.803135][ T1170] usb 1-1: USB disconnect, device number 2
> [   37.827979][ T1170] ODEBUG: free active (active state 0) object
> type: work_struct hint: bigben_worker+0x0/0x860
> [   37.829634][ T1170] WARNING: CPU: 0 PID: 1170 at
> lib/debugobjects.c:505 debug_check_no_obj_freed+0x43a/0x630
> [   37.830904][ T1170] Modules linked in:
> [   37.831413][ T1170] CPU: 0 PID: 1170 Comm: kworker/0:3 Not tainted
> 6.1.0-rc4-dirty #43
> [   37.832465][ T1170] Hardware name: QEMU Standard PC (i440FX + PIIX,
> 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
> [   37.833751][ T1170] Workqueue: usb_hub_wq hub_event
> [   37.834409][ T1170] RIP: 0010:debug_check_no_obj_freed+0x43a/0x630
> [   37.835218][ T1170] Code: 48 89 ef e8 28 82 58 ff 49 8b 14 24 4c 8b
> 45 00 48 c7 c7 40 5f 09 87 48 c7 c6 60 5b 09 87 89 d9 4d 89 f9 31 c0
> e8 46 25 ef fe <0f> 0b 4c 8b 64 24 20 48 ba 00 00 00 00 00 fc ff df ff
> 05 4f 7c 17
> [   37.837667][ T1170] RSP: 0018:ffffc900006fee60 EFLAGS: 00010246
> [   37.838503][ T1170] RAX: 0d2d19ffcded3d00 RBX: 0000000000000000
> RCX: ffff888117fc9b00
> [   37.839519][ T1170] RDX: 0000000000000000 RSI: 0000000000000000
> RDI: 0000000000000000
> [   37.840570][ T1170] RBP: ffffffff86e88380 R08: ffffffff8130793b
> R09: fffff520000dfd85
> [   37.841618][ T1170] R10: fffff520000dfd85 R11: 0000000000000000
> R12: ffffffff87095fb8
> [   37.842649][ T1170] R13: ffff888117770ad8 R14: ffff888117770acc
> R15: ffffffff852b7420
> [   37.843728][ T1170] FS:  0000000000000000(0000)
> GS:ffff8881f6600000(0000) knlGS:0000000000000000
> [   37.844877][ T1170] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
> [   37.845749][ T1170] CR2: 00007f992eaab380 CR3: 000000011834b000
> CR4: 00000000001006f0
> [   37.846794][ T1170] Call Trace:
> [   37.847245][ T1170]  <TASK>
> [   37.847643][ T1170]  slab_free_freelist_hook+0x89/0x160
> [   37.848409][ T1170]  ? devres_release_all+0x262/0x350
> [   37.849156][ T1170]  __kmem_cache_free+0x71/0x110
> [   37.849829][ T1170]  devres_release_all+0x262/0x350
> [   37.850478][ T1170]  ? devres_release+0x90/0x90
> [   37.851118][ T1170]  device_release_driver_internal+0x5e5/0x8a0
> [   37.851944][ T1170]  bus_remove_device+0x2ea/0x400
> [   37.852611][ T1170]  device_del+0x64f/0xb40
> [   37.853212][ T1170]  ? kill_device+0x150/0x150
> [   37.853831][ T1170]  ? print_irqtrace_events+0x1f0/0x1f0
> [   37.854564][ T1170]  hid_destroy_device+0x66/0x100
> [   37.855226][ T1170]  usbhid_disconnect+0x9a/0xc0
> [   37.855887][ T1170]  usb_unbind_interface+0x1e1/0x890
> ```
>
> And the KASAN error report:
> ```
> [ 138.349079][  T7] usb 1-1: USB disconnect, device number 2
> [ 138.381243][ T1175]
> ==================================================================
> [ 138.382329][ T1175] BUG: KASAN: use-after-free in __list_add_valid+0x66/0x100
> [ 138.383272][ T1175] Read of size 8 at addr ffff88810d62de70 by task
> systemd-udevd/1175
> [ 138.384238][ T1175]
> [ 138.384531][ T1175] CPU: 0 PID: 1175 Comm: systemd-udevd Not tainted
> 6.1.0-rc4-dirty #30
> [ 138.385541][ T1175] Hardware name: QEMU Standard PC (i440FX + PIIX,
> 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014
> [ 138.386725][ T1175] Call Trace:
> [ 138.387145][ T1175] <TASK>
> [ 138.387515][ T1175] dump_stack_lvl+0x1b1/0x28e
> [ 138.388112][ T1175] ? nf_tcp_handle_invalid+0x3ff/0x3ff
> [ 138.388961][ T1175] ? __wake_up_klogd+0xdb/0x110
> [ 138.389756][ T1175] ? panic+0x822/0x822
> [ 138.390246][ T1175] ? _printk+0xc0/0x100
> [ 138.390763][ T1175] print_address_description+0x7d/0x340
> [ 138.391454][ T1175] print_report+0x107/0x1f0
> [ 138.391995][ T1175] ? __virt_addr_valid+0x211/0x2c0
> [ 138.392625][ T1175] ? __phys_addr+0xb5/0x160
> [ 138.393176][ T1175] ? __list_add_valid+0x66/0x100
> [ 138.393782][ T1175] kasan_report+0xcd/0x100
> [ 138.394330][ T1175] ? __list_add_valid+0x66/0x100
> [ 138.394955][ T1175] __list_add_valid+0x66/0x100
> [ 138.395542][ T1175] insert_work+0x10e/0x3c0
> [ 138.396119][ T1175] __queue_work+0xa97/0xde0
> [...]
> [ 138.403915][ T1175] __sys_bind+0x210/0x2b0
> [ 138.404458][ T1175] ? __ia32_sys_socketpair+0xb0/0xb0
> [ 138.405097][ T1175] ? lockdep_hardirqs_on_prepare+0x428/0x790
> [ 138.405833][ T1175] __x64_sys_bind+0x76/0x80
> [ 138.406378][ T1175] do_syscall_64+0x3d/0x90
> [ 138.406931][ T1175] entry_SYSCALL_64_after_hwframe+0x63/0xcd
> [ 138.407689][ T1175] RIP: 0033:0x7fe2d052d9e7
> [ 138.408241][ T1175] Code: 83 c4 08 48 3d 01 f0 ff ff 73 01 c3 48 8b
> 0d a8 f4 2a 00 f7 d8 64 89 01 48 83 c8 ff c3 66 0f 1f 44 00 00 b8 31
> 00 00 00 0f 05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d 81 f4 2a 00 f7 d8
> 64 89 01 48
> [ 138.410572][ T1175] RSP: 002b:00007ffca13ea088 EFLAGS: 00000246
> ORIG_RAX: 0000000000000031
> [ 138.411571][ T1175] RAX: ffffffffffffffda RBX: 0000560b0c5b0f90 RCX:
> 00007fe2d052d9e7
> [ 138.412542][ T1175] RDX: 000000000000000c RSI: 0000560b0c5b0fa0 RDI:
> 000000000000000e
> [ 138.413525][ T1175] RBP: 0000000000000000 R08: 0000560b0c5960e0 R09:
> 0000000000000210
> [ 138.414530][ T1175] R10: 000000000000000f R11: 0000000000000246 R12:
> 0000560b0c5a8e94
> [ 138.415494][ T1175] R13: 0000000000000000 R14: 0000560b0c596010 R15:
> 0000560b0c596028
> [ 138.416499][ T1175] </TASK>
> [ 138.416905][ T1175]
> [ 138.416499][ T1175] </TASK>
> [ 138.416905][ T1175]
> [ 138.417197][ T1175] Allocated by task 7:
> [ 138.417706][ T1175] kasan_set_track+0x3d/0x60
> [ 138.418271][ T1175] __kasan_kmalloc+0x7c/0x90
> [ 138.418867][ T1175] __kmalloc_node_track_caller+0xad/0x1a0
> [ 138.419583][ T1175] devm_kmalloc+0x77/0x1a0
> [ 138.420141][ T1175] bigben_probe+0x2f/0x770
> [ 138.420678][ T1175] hid_device_probe+0x251/0x3f0
> [...]
> [ 138.446475][ T1175]
> [ 138.446775][ T1175] Freed by task 7:
> [ 138.447232][ T1175] kasan_set_track+0x3d/0x60
> [ 138.447798][ T1175] kasan_save_free_info+0x2e/0x50
> [ 138.448410][ T1175] ____kasan_slab_free+0xb0/0x100
> [ 138.449039][ T1175] slab_free_freelist_hook+0x80/0x140
> [ 138.449696][ T1175] __kmem_cache_free+0x71/0x110
> [ 138.450292][ T1175] devres_release_all+0x262/0x350
> [ 138.450925][ T1175] device_release_driver_internal+0x5e5/0x8a0
> [ 138.451667][ T1175] bus_remove_device+0x2ea/0x400
> [ 138.452293][ T1175] device_del+0x64f/0xb40
> [ 138.452825][ T1175] hid_destroy_device+0x66/0x100
> [ 138.453424][ T1175] usbhid_disconnect+0x9a/0xc0
> [...]
> [ 138.462307][ T1175]
> ```
>
> The proposed patch deregisters the LED controller bigben_set_led() before
> freeing the device and is currently under discussion with the maintainers.
>
> Best regards,
> Pietro Borrello

--
Thomas Leroy
Security Engineer
SUSE Software Solutions

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


