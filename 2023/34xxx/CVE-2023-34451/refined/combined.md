=== Content from github.com_54dfc8a5_20250115_095752.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcometbft%2Fcometbft%2Fpull%2F890)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcometbft%2Fcometbft%2Fpull%2F890)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=cometbft%2Fcometbft)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cometbft](/cometbft)
/
**[cometbft](/cometbft/cometbft)**
Public

* [Notifications](/login?return_to=%2Fcometbft%2Fcometbft) You must be signed in to change notification settings
* [Fork
  537](/login?return_to=%2Fcometbft%2Fcometbft)
* [Star
   682](/login?return_to=%2Fcometbft%2Fcometbft)

* [Code](/cometbft/cometbft)
* [Issues
  265](/cometbft/cometbft/issues)
* [Pull requests
  37](/cometbft/cometbft/pulls)
* [Discussions](/cometbft/cometbft/discussions)
* [Actions](/cometbft/cometbft/actions)
* [Projects
  1](/cometbft/cometbft/projects)
* [Wiki](/cometbft/cometbft/wiki)
* [Security](/cometbft/cometbft/security)
* [Insights](/cometbft/cometbft/pulse)

Additional navigation options

* [Code](/cometbft/cometbft)
* [Issues](/cometbft/cometbft/issues)
* [Pull requests](/cometbft/cometbft/pulls)
* [Discussions](/cometbft/cometbft/discussions)
* [Actions](/cometbft/cometbft/actions)
* [Projects](/cometbft/cometbft/projects)
* [Wiki](/cometbft/cometbft/wiki)
* [Security](/cometbft/cometbft/security)
* [Insights](/cometbft/cometbft/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fcometbft%2Fcometbft%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fcometbft%2Fcometbft%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Prevent a transaction to appear twice in the mempool #890

 Merged

[otrack](/otrack)
merged 6 commits into
[cometbft:main](/cometbft/cometbft/tree/main "cometbft/cometbft:main")
from
[otrack:pierre/mempool-fix-cache](/otrack/cometbft/tree/pierre/mempool-fix-cache "otrack/cometbft:pierre/mempool-fix-cache")

Jun 6, 2023

 Merged

# [Prevent a transaction to appear twice in the mempool](#top) #890

[otrack](/otrack)
merged 6 commits into
[cometbft:main](/cometbft/cometbft/tree/main "cometbft/cometbft:main")
from
[otrack:pierre/mempool-fix-cache](/otrack/cometbft/tree/pierre/mempool-fix-cache "otrack/cometbft:pierre/mempool-fix-cache")

Jun 6, 2023

[Conversation
25](/cometbft/cometbft/pull/890)
[Commits
6](/cometbft/cometbft/pull/890/commits)
[Checks
0](/cometbft/cometbft/pull/890/checks)
[Files changed](/cometbft/cometbft/pull/890/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![otrack](https://avatars.githubusercontent.com/u/2862510?s=60&v=4)](/otrack)

Copy link

Contributor

### @otrack **[otrack](/otrack)** commented [May 26, 2023](#issue-1727479164) ‚Ä¢ edited Loading

**Summary**

A transaction might appear twice in the mempool, i.e., it is present more than once in `txs`, while `txsMap` only links a single of these occurrences. The bug happens when the cache overflows.

**Context**

The bug is related to issues [#3865](https://github.com/tendermint/tendermint/issues/3865) and [#5281](https://github.com/tendermint/tendermint/issues/5281) in Tendermint. Both issues are closed with this fix. One may reproduce them easily in e2e, e.g.,

```
./build/generator -m v0.37.1:1 -d networks/generated/
./build/runner -f networks/generated/gen-0003.toml setup
find networks/generated/gen-0003/ -iname "config.toml" | xargs sed -i s,"cache_size = 10000","cache_size = 100",
find networks/generated/gen-0003/ -iname "config.toml" | xargs sed -i s,"prepare_proposal_delay = 200ms","prepare_proposal_delay = 3000ms",
./build/runner -f networks/generated/gen-0003.toml start
curl -s http://localhost:5701/broadcast_tx_sync?tx=\"apple=100\"; for i in $(seq 1 1001); do curl -s http://localhost:5701/broadcast_tx_sync?tx=\"orange=${i}\"; done; curl -s http://localhost:5701/broadcast_tx_sync?tx=\"apple=100\"

```

**Remark**

The present fix works because the mempool receives *in order and sequentially* all the asynchronous ABCI callbacks. Notice that in the past, this was not the case for the grpc client, as outlined [here](https://github.com/tendermint/tendermint/pull/5520). Sidestepping such a constraint is feasible, yet presently [open](https://github.com/tendermint/tendermint/issues/5519).

---

#### PR checklist

* Tests written/updated
* Changelog entry added in `.changelog` (we use [unclog](https://github.com/informalsystems/unclog) to manage our changelog)
* Updated relevant documentation (`docs/` or `spec/`) and code comments

Sorry, something went wrong.

 üëç
3
 hvanz, sergio-mena, and thanethomson reacted with thumbs up emoji

All reactions

* üëç
  3 reactions

 [![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
requested a review
from a team
as a [code owner](/cometbft/cometbft/blob/da0e55604b075bac9e1d5866cb2e62eaae386dd9/.github/CODEOWNERS#L10)
[May 26, 2023 11:52](#event-9349935960)

 [![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
[force-pushed](/cometbft/cometbft/compare/8db87880cc402d4c858b570da23bf086499cc93c..5f4a27eadb140825b260e8ddf22b5c3fb1820007)
the
pierre/mempool-fix-cache

branch
4 times, most recently
from
[`8db8788`](/cometbft/cometbft/commit/8db87880cc402d4c858b570da23bf086499cc93c) to
[`5f4a27e`](/cometbft/cometbft/commit/5f4a27eadb140825b260e8ddf22b5c3fb1820007)  [Compare](/cometbft/cometbft/compare/8db87880cc402d4c858b570da23bf086499cc93c..5f4a27eadb140825b260e8ddf22b5c3fb1820007)
[May 26, 2023 12:24](#event-9350259543)

[![cason](https://avatars.githubusercontent.com/u/270778?s=60&v=4)](/cason)

**[cason](/cason)**
approved these changes
[May 26, 2023](#pullrequestreview-1446118754)

 [View reviewed changes](/cometbft/cometbft/pull/890/files)

Copy link

Collaborator

### @cason **[cason](/cason)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Great finding :)

We definitely need a specification for this interaction that takes into consideration these corner cases (e.g., cache eviction, out-of-order ABCI responses, etc.).

Sorry, something went wrong.

All reactions

[mempool/clist\_mempool\_test.go](/cometbft/cometbft/pull/890/files#diff-8d5a43b1b0300432d58f28e4b22f2ded3d93f713b14a0f76657c1143b2fd1425)
Outdated

Show resolved

Hide resolved

[mempool/clist\_mempool.go](/cometbft/cometbft/pull/890/files#diff-f71975385bf5bc21c04eb08f496140cc8cca405b8dbd7b628342e6d8afb61cc5)

|  |  | @@ -389,6 +389,18 @@ func (mem \*CListMempool) resCbFirstTime( | |
| --- | --- | --- | --- |
|  |  | return |
|  |  | } |
|  |  |  |
|  |  | // Check transaction not already in the mempool |

Copy link

Collaborator

### @cason **[cason](/cason)** [May 26, 2023](#discussion_r1206706352)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It would be helpful to explain why would the transaction be already in the mempool. Maybe, once we have an issue detailing the bug, add the link to the issue here.

Sorry, something went wrong.

All reactions

[mempool/clist\_mempool.go](/cometbft/cometbft/pull/890/files#diff-f71975385bf5bc21c04eb08f496140cc8cca405b8dbd7b628342e6d8afb61cc5)
Outdated

Show resolved

Hide resolved

[![hvanz](https://avatars.githubusercontent.com/u/15466498?s=60&v=4)](/hvanz)

**[hvanz](/hvanz)**
approved these changes
[May 30, 2023](#pullrequestreview-1450261656)

 [View reviewed changes](/cometbft/cometbft/pull/890/files)

Copy link

Member

### @hvanz **[hvanz](/hvanz)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM. Great catch üòÉ

Sorry, something went wrong.

All reactions

[![hvanz](https://avatars.githubusercontent.com/u/15466498?s=60&v=4)](/hvanz)

**[hvanz](/hvanz)**
reviewed
[May 30, 2023](#pullrequestreview-1450355412)

 [View reviewed changes](/cometbft/cometbft/pull/890/files)

[mempool/clist\_mempool.go](/cometbft/cometbft/pull/890/files#diff-f71975385bf5bc21c04eb08f496140cc8cca405b8dbd7b628342e6d8afb61cc5)
Outdated

Show resolved

Hide resolved

 [![@cason](https://avatars.githubusercontent.com/u/270778?s=40&u=7793aeff6c8e04aef36a626d2f66a2f83179b942&v=4)](/cason)
[cason](/cason)
requested a review
from [sergio-mena](/sergio-mena)
[May 30, 2023 09:14](#event-9375962512)

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&u=14e39ce969a7381b8934c945daa72dcf88beb3db&v=4)](/hvanz)
[hvanz](/hvanz)
assigned [otrack](/otrack)
[May 31, 2023](#event-9393403706)

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&u=14e39ce969a7381b8934c945daa72dcf88beb3db&v=4)](/hvanz)
[hvanz](/hvanz)
added
the
[mempool](/cometbft/cometbft/labels/mempool)
label
[May 31, 2023](#event-9393405512)

[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)
[sergio-mena](/sergio-mena)
added
the
[bug](/cometbft/cometbft/labels/bug)
Something isn't working
label
[Jun 1, 2023](#event-9406242573)

[![sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=60&v=4)](/sergio-mena)

**[sergio-mena](/sergio-mena)**
approved these changes
[Jun 1, 2023](#pullrequestreview-1456003784)

 [View reviewed changes](/cometbft/cometbft/pull/890/files)

Copy link

Contributor

### @sergio-mena **[sergio-mena](/sergio-mena)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Excellent find!

I guess we need to backport to all active branches. Let me know if you need assistance on that

Sorry, something went wrong.

All reactions

[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=80&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)

Copy link

Contributor

### **[sergio-mena](/sergio-mena)** commented [Jun 1, 2023](#issuecomment-1572526601) ‚Ä¢ edited Loading

| Could you please add a changelog entry? You can get inspiration from [#383](https://github.com/cometbft/cometbft/pull/383) on how to do it |
| --- |

All reactions

Sorry, something went wrong.

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=80&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)

Copy link

Contributor

Author

### **[otrack](/otrack)** commented [Jun 5, 2023](#issuecomment-1576302586)

| Could you please add a changelog entry? You can get inspiration from [#383](https://github.com/cometbft/cometbft/pull/383) on how to do it  Done. |
| --- |

All reactions

Sorry, something went wrong.

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
closed this
[Jun 5, 2023](#event-9429406289)

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
reopened this
[Jun 5, 2023](#event-9429409407)

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=80&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)

Copy link

Contributor

Author

### **[otrack](/otrack)** commented [Jun 5, 2023](#issuecomment-1576319519)

| Could you please add a changelog entry? You can get inspiration from [#383](https://github.com/cometbft/cometbft/pull/383) on how to do it  I guess so. What should the backport tagert? (e.g., v0.34.x to v0.38x) |
| --- |

All reactions

Sorry, something went wrong.

[![@cason](https://avatars.githubusercontent.com/u/270778?s=80&u=7793aeff6c8e04aef36a626d2f66a2f83179b942&v=4)](/cason)

Copy link

Collaborator

### **[cason](/cason)** commented [Jun 5, 2023](#issuecomment-1576533182)

| Could you please add a changelog entry? You can get inspiration from [#383](https://github.com/cometbft/cometbft/pull/383) on how to do it  I guess so. What should the backport tagert? (e.g., v0.34.x to v0.38x)  Yes. I am just wondering whether we can just use the bot to do so, as the organization of files has changed a lot from [v0.37.x](https://github.com/cometbft/cometbft/tree/v0.37.x/mempool) and [v0.34.x](https://github.com/cometbft/cometbft/tree/v0.34.x/mempool). |
| --- |

All reactions

Sorry, something went wrong.

[![@cason](https://avatars.githubusercontent.com/u/270778?s=80&u=7793aeff6c8e04aef36a626d2f66a2f83179b942&v=4)](/cason)

Copy link

Collaborator

### **[cason](/cason)** commented [Jun 5, 2023](#issuecomment-1576658777)

| Rebasing with main might fix the linter error. We have to that before merging, in any case. |
| --- |

All reactions

Sorry, something went wrong.

 [otrack](/otrack)
and others
added 6 commits
[June 6, 2023 09:51](#commits-pushed-37b22ab)

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)

`[the issue](/cometbft/cometbft/pull/890/commits/37b22ab6d766dd8d303052b2348734cb4cc53f47 "the issue")`

`[37b22ab](/cometbft/cometbft/pull/890/commits/37b22ab6d766dd8d303052b2348734cb4cc53f47)`

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)

`[the fix](/cometbft/cometbft/pull/890/commits/142b4c673292f055addb0463552caf3f1dabb185 "the fix")`

`[142b4c6](/cometbft/cometbft/pull/890/commits/142b4c673292f055addb0463552caf3f1dabb185)`

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack) [![@cason](https://avatars.githubusercontent.com/u/270778?s=40&v=4)](/cason)

`[Update mempool/clist_mempool.go](/cometbft/cometbft/pull/890/commits/b0ed22d811b25164a6182b2a318cd2aa0c4eb947 "Update mempool/clist_mempool.go

Better debug information.

Co-authored-by: Daniel <daniel.cason@informal.systems>")`
 ‚Ä¶

`[b0ed22d](/cometbft/cometbft/pull/890/commits/b0ed22d811b25164a6182b2a318cd2aa0c4eb947)`

```

Better debug information.

Co-authored-by: Daniel <daniel.cason@informal.systems>
```

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)

`[track sender when receiving tx twice](/cometbft/cometbft/pull/890/commits/f99edccdbc3cd46ec435b3943eb771f889b5c246 "track sender when receiving tx twice")`

`[f99edcc](/cometbft/cometbft/pull/890/commits/f99edccdbc3cd46ec435b3943eb771f889b5c246)`

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)

`[merge](/cometbft/cometbft/pull/890/commits/a96980b9fd449b7606487e519bf0003a4a0d76ce "merge")`

`[a96980b](/cometbft/cometbft/pull/890/commits/a96980b9fd449b7606487e519bf0003a4a0d76ce)`

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)

`[add changelog](/cometbft/cometbft/pull/890/commits/4206e03b5986e7e88e188783435c42129fef60e6 "add changelog")`

`[4206e03](/cometbft/cometbft/pull/890/commits/4206e03b5986e7e88e188783435c42129fef60e6)`

 [![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
[force-pushed](/cometbft/cometbft/compare/0d3bee7b081ec669873745e46f6d080ecdc51627..4206e03b5986e7e88e188783435c42129fef60e6)
the
pierre/mempool-fix-cache

branch
from
[`0d3bee7`](/cometbft/cometbft/commit/0d3bee7b081ec669873745e46f6d080ecdc51627) to
[`4206e03`](/cometbft/cometbft/commit/4206e03b5986e7e88e188783435c42129fef60e6)  [Compare](/cometbft/cometbft/compare/0d3bee7b081ec669873745e46f6d080ecdc51627..4206e03b5986e7e88e188783435c42129fef60e6)
[June 6, 2023 07:51](#event-9442778161)

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack)
[otrack](/otrack)
added
[backport-to-v0.34.x](/cometbft/cometbft/labels/backport-to-v0.34.x)
Tell Mergify to backport the PR to v0.34.x
[backport-to-v0.37.x](/cometbft/cometbft/labels/backport-to-v0.37.x)
Tell Mergify to backport the PR to v0.37.x
[backport-to-v0.38.x](/cometbft/cometbft/labels/backport-to-v0.38.x)
Tell Mergify to backport the PR to v0.38.x
labels
[Jun 6, 2023](#event-9442804657)

14 hidden items

Load more‚Ä¶

[![@gitferry](https://avatars.githubusercontent.com/u/4042775?s=40&v=4)](/gitferry)
[gitferry](/gitferry)
mentioned this pull request
[Jul 6, 2023](#ref-pullrequest-1790954532)

[chore: Bump cometbft version
babylonchain/rpc-client#42](/babylonchain/rpc-client/pull/42)
 Open

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&u=14e39ce969a7381b8934c945daa72dcf88beb3db&v=4)](/hvanz)
[hvanz](/hvanz)
mentioned this pull request
[Sep 12, 2023](#ref-pullrequest-1892354455)

[Release v0.38.0
#1337](/cometbft/cometbft/pull/1337)
 Merged

3 tasks

[sergio-mena](/sergio-mena)
added a commit
that referenced
this pull request
[Sep 12, 2023](#ref-commit-b366c0a)
[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)

`[Formatted](/cometbft/cometbft/commit/b366c0ae77cb39bfc9e8ae351985b0f09c824d4a "Formatted #890 in changelog") [#890](https://github.com/cometbft/cometbft/pull/890) [in changelog](/cometbft/cometbft/commit/b366c0ae77cb39bfc9e8ae351985b0f09c824d4a "Formatted #890 in changelog")`

`[b366c0a](/cometbft/cometbft/commit/b366c0ae77cb39bfc9e8ae351985b0f09c824d4a)`

[sergio-mena](/sergio-mena)
added a commit
that referenced
this pull request
[Sep 12, 2023](#ref-commit-66a5a9d)
[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)

`[Release v0.38.0 (](/cometbft/cometbft/commit/66a5a9da9f7a3306f382eb9142ccb9c9f7997d3f "Release v0.38.0 (#1337)

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted #890 in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo")[#1337](https://github.com/cometbft/cometbft/pull/1337)[)](/cometbft/cometbft/commit/66a5a9da9f7a3306f382eb9142ccb9c9f7997d3f "Release v0.38.0 (#1337)

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted #890 in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo")`
‚Ä¶

`[66a5a9d](/cometbft/cometbft/commit/66a5a9da9f7a3306f382eb9142ccb9c9f7997d3f)`

```
* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted [#890](https://github.com/cometbft/cometbft/pull/890) in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo
```

[sergio-mena](/sergio-mena)
added a commit
that referenced
this pull request
[Sep 12, 2023](#ref-commit-aac5f97)
[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)

`[[cherry-pick] Release v0.38.0 (](/cometbft/cometbft/commit/aac5f9703f94313f93a374f29ba4b638404dd80b "[cherry-pick] Release v0.38.0 (#1337)

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted #890 in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo")[#1337](https://github.com/cometbft/cometbft/pull/1337)[)](/cometbft/cometbft/commit/aac5f9703f94313f93a374f29ba4b638404dd80b "[cherry-pick] Release v0.38.0 (#1337)

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted #890 in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo")`
‚Ä¶

`[aac5f97](/cometbft/cometbft/commit/aac5f9703f94313f93a374f29ba4b638404dd80b)`

```
* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted [#890](https://github.com/cometbft/cometbft/pull/890) in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo
```

[github-merge-queue](/apps/github-merge-queue) bot
pushed a commit
that referenced
this pull request
[Sep 13, 2023](#ref-commit-ab93e35)
[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena)

`[Forward port changes to changelog and UPGRADING.md for release `v0.‚Ä¶](/cometbft/cometbft/commit/ab93e3508ec430c9260a3648514f12516df42f2a "Forward port changes to changelog and `UPGRADING.md` for release `v0.38.0` (#1341)

* [cherry-pick] Release v0.38.0 (#1337)

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted #890 in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo

* Fixed `UPGRADING.md`")`
‚Ä¶

`[ab93e35](/cometbft/cometbft/commit/ab93e3508ec430c9260a3648514f12516df42f2a)`

```
‚Ä¶38.0` ([#1341](https://github.com/cometbft/cometbft/pull/1341))

* [cherry-pick] Release v0.38.0 ([#1337](https://github.com/cometbft/cometbft/pull/1337))

* Prepare changelog for release

* Prepare `UPGRADING.md`

* Bump version

* Fix date format

* Remove duplicate changelog entries

* Formatted [#890](https://github.com/cometbft/cometbft/pull/890) in changelog

* Add log entry in breaking changes for RPC block events

* Fix typo

* Fixed `UPGRADING.md`
```

[![@faddat](https://avatars.githubusercontent.com/u/7142025?s=40&v=4)](/faddat)
[faddat](/faddat)
mentioned this pull request
[Jan 5, 2024](#ref-pullrequest-2067625438)

[faddat/reversions for fixed length
ComposableFi/cometbft#2](/ComposableFi/cometbft/pull/2)
 Closed

3 tasks

[![@lasarojc](https://avatars.githubusercontent.com/u/2686194?s=40&v=4)](/lasarojc)
[lasarojc](/lasarojc)
mentioned this pull request
[Mar 12, 2024](#ref-pullrequest-2181517654)

[chore(spec): merge main into `spec/consensus-gossip`
#2594](/cometbft/cometbft/pull/2594)
 Merged

[lasarojc](/lasarojc)
added a commit
that referenced
this pull request
[Mar 12, 2024](#ref-commit-e7dd0ab)
[![@lasarojc](https://avatars.githubusercontent.com/u/2686194?s=40&v=4)](/lasarojc) [![@thanethomson](https://avatars.githubusercontent.com/u/212999?s=40&u=8cdc0098f3eba5a9eb3e565b419fe22b80641307&v=4)](/thanethomson)
[![@dependabot](https://avatars.githubusercontent.com/in/29110?s=40&v=4)](/apps/dependabot) [![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes) [![@mzabaluev](https://avatars.githubusercontent.com/u/1198919?s=40&v=4)](/mzabaluev) [![@troykessler](https://avatars.githubusercontent.com/u/43882936?s=40&u=60184a020309cbf84c673d89a4ebb09025e1e2f1&v=4)](/troykessler) [![@lllleven](https://avatars.githubusercontent.com/u/112051166?s=40&u=9110425690cc87630031273a2e0e14432e736f17&v=4)](/lllleven) [![@werty144](https://avatars.githubusercontent.com/u/29121165?s=40&v=4)](/werty144) [![@adizere](https://avatars.githubusercontent.com/u/1757002?s=40&v=4)](/adizere) [![@sukey2008](https://avatars.githubusercontent.com/u/35202440?s=40&u=8a0a89f1249edb1840680c0486ca86ea115b7910&v=4)](/sukey2008) [![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&u=79f695ba12339038e7ba9e9e1172c964e722f876&v=4)](/sergio-mena) [![@jmalicevic](https://avatars.githubusercontent.com/u/7517419?s=40&u=5d76c2b674d046d00b7020427ad9718e1b1bb2ca&v=4)](/jmalicevic) [![@wieso-itzi](https://avatars.githubusercontent.com/u/85185077?s=40&u=8f04a2bcf391c62a770167b2a2d080c458d2e81c&v=4)](/wieso-itzi) [![@hoangdv2429](https://avatars.githubusercontent.com/u/63839106?s=40&u=dd379b05ccf7fc0cc194029dcb4d77bb6bdd84bc&v=4)](/hoangdv2429) [![@bodhi-crypo](https://avatars.githubusercontent.com/u/152680487?s=40&u=554351a76e53f5298967368f001249a9180c41e4&v=4)](/bodhi-crypo) [![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&u=14e39ce969a7381b8934c945daa72dcf88beb3db&v=4)](/hvanz) [![@cason](https://avatars.githubusercontent.com/u/270778?s=40&u=7793aeff6c8e04aef36a626d2f66a2f83179b942&v=4)](/cason) [![@andynog](https://avatars.githubusercontent.com/u/45477427?s=40&u=919edadcde3c9922d5c5481ba86b6d394d46e6e0&v=4)](/andynog) [![@nenadmilosevic95](https://avatars.githubusercontent.com/u/50905385?s=40&v=4)](/nenadmilosevic95) [![@faddat](https://avatars.githubusercontent.com/u/7142025?s=40&u=a94b1572dddcc995b9174ac70cee81196a2913f0&v=4)](/faddat) [![@greg-szabo](https://avatars.githubusercontent.com/u/16846635?s=40&u=9c18b22b3b0f6447ec98f070fa9821949f1f91cb&v=4)](/greg-szabo) [![@odeke-em](https://avatars.githubusercontent.com/u/4898263?s=40&u=71396c0dd79a0f55328aa0781c13ca5d940e6af3&v=4)](/odeke-em) [![@jchappelow](https://avatars.githubusercontent.com/u/140431406?s=40&v=4)](/jchappelow) [![@shuoer86](https://avatars.githubusercontent.com/u/129674997?s=40&v=4)](/shuoer86) [![@levisyin](https://avatars.githubusercontent.com/u/150114626?s=40&u=9ba0e018a112073c88ffab5ab37e3141739c0f9e&v=4)](/levisyin) [![@vuittont60](https://avatars.githubusercontent.com/u/81072379?s=40&u=052f8a9dcadce5d8915528e8ccf229f3538e0ee1&v=4)](/vuittont60) [![@Halimao](https://avatars.githubusercontent.com/u/25278203?s=40&u=7f6c26f8b0b4d64640cbbac9eb793cc1a02c3301&v=4)](/Halimao) [![@josef-widder](https://avatars.githubusercontent.com/u/44643235?s=40&u=ad032c021c999f39977fb0ee289904e95e79a08f&v=4)](/josef-widder) [![@williambanfield](https://avatars.githubusercontent.com/u/4561443?s=40&u=3038707f9c16359425bda84f89c854e9b98af483&v=4)](/williambanfield) [![@Kukovec](https://avatars.githubusercontent.com/u/23355223?s=40&v=4)](/Kukovec) [![@hattizai](https://avatars.githubusercontent.com/u/150505746?s=40&u=328e33fdace8113542e5d806a850ee89f2a5b9fd&v=4)](/hattizai) [![@IssouChancla](https://avatars.githubusercontent.com/u/35667132?s=40&u=13a8484d30cc6549490a2288fbee660ebe16c86c&v=4)](/IssouChancla) [![@cratelyn](https://avatars.githubusercontent.com/u/57912822?s=40&u=9d269b0bb2eae0768a18db38c9ca6bc0beb69f92&v=4)](/cratelyn) [![@gibson042](https://avatars.githubusercontent.com/u/1199584?s=40&v=4)](/gibson042) [![@deruelle](https://avatars.githubusercontent.com/u/54279?s=40&u=700a9c71cba97de27f782118eca74fc334a13dd9&v=4)](/deruelle) [![@glnro](https://avatars.githubusercontent.com/u/8335464?s=40&u=452d92f0eb544fd9453b2b731460f675d654321a&v=4)](/glnro) [![@k0marov](https://avatars.githubusercontent.com/u/95040709?s=40&u=203465a6843221c5a7f762c85eb904448dbd3acb&v=4)](/k0marov) [![@Pan-chao](https://avatars.githubusercontent.com/u/152830401?s=40&u=73d55d8b39612d96bebc642ea699dbc9d73a6903&v=4)](/Pan-chao) [![@hoanguyenkh](https://avatars.githubusercontent.com/u/49144992?s=40&u=296bfe609996c543b6a7d4cd8b4ba250b1682690&v=4)](/hoanguyenkh) [![@xyztoni](https://avatars.githubusercontent.com/u/143221387?s=40&u=351f01b11c9a44783b2c2c916cb67444cd2705cf&v=4)](/xyztoni) [![@dragonkid](https://avatars.githubusercontent.com/u/4601569?s=40&u=3297f3d0d53b3d5f72c2aae12b63660297d45760&v=4)](/dragonkid) [![@MattKetmo](https://avatars.githubusercontent.com/u/334996?s=40&u=2b06b452771518c77550e819cb6991bbe8866078&v=4)](/MattKetmo) [![@cosinlink](https://avatars.githubusercontent.com/u/15066232?s=40&u=b18d448683757cacf457c4d539225714f6f77023&v=4)](/cosinlink) [![@JekaMas](https://avatars.githubusercontent.com/u/3192700?s=40&v=4)](/JekaMas) [![@minhngoc274](https://avatars.githubusercontent.com/u/153509244?s=40&u=ffa0911d494df55262b4b57f3ca4d4d393e9a52b&v=4)](/minhngoc274) [![@keroro520](https://avatars.githubusercontent.com/u/1870648?s=40&u=586062441ea47a75253226370d0588e39879218f&v=4)](/keroro520)

`[chore(spec): merge main into](/cometbft/cometbft/commit/e7dd0ab89fc3783d3de30f2c5fb892f9ca072ba2 "chore(spec): merge main into `spec/consensus-gossip` (#2594)

- **Versioned protobuf files (#495)**
- **Restore rpc/grpc/v1/types.pb.go**
- **proto: restore deprecation notice on BroadcastAPI**
- **Struct `Client` exposes sensitive data (#784)**
- **Unsafe int cast in `kill` command (#783)**
- **ADR-100: Data Companion Push API (#73)**
- **rfc: incoming txs while catching up (#735)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.17.0 to 1.18.0
(#804)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.8 to 1.4.9
(#806)**
- **build(deps): Bump golang.org/x/sync from 0.1.0 to 0.2.0 (#807)**
- **build(deps): Bump google.golang.org/grpc from 1.54.0 to 1.55.0
(#813)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.0 to
1.15.1 (#810)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/prometheus/client_model from 0.3.0 to
0.4.0 (#812)**
- **build(deps): Bump github.com/prometheus/common from 0.42.0 to 0.43.0
(#811)**
- **ADR-103: Protobuf definition versioning (#772)**
- **spec/p2p: Specify the operation of a Reactor (#714)**
- **build(deps): Bump github.com/docker/distribution (#827)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.1 to 1.3.3
(#828)**
- **ADR-103: Protobuf definition versioning (#772) (#817)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.9 to 1.4.10
(#830)**
- **build(deps): Bump golang.org/x/net from 0.9.0 to 0.10.0 (#831)**
- **build(deps): Bump golang.org/x/crypto from 0.8.0 to 0.9.0 (#832)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.26.1 to 2.27.1
(#833)**
- **rpc: Remove response data from response failure logs (#829)**
- **pubsub/kvindexer:support for big numbers - v2 (#797)**
- **Extend the infrastructure provider with `StartNodes` and
`StopTestnet` (#796)**
- **grpc: Add base gRPC server with version service (#818)**
- **Digital Ocean implementation of `StartNodes` and `StopTestnet`
(#846)**
- **RFC 102: Improve forward compatibility of proto-generated Rust
(#724)**
- **mempool: Add metric to measure how many times a tx was received
(#637)**
- **`e2e` provider is extended with `Disconnect`, `Reconnect` and
`CheckUpgraded` (#852)**
- **Sort `loadtime` tool's report (#854)**
- **feat: make handshake cancelable (#857)**
- **proto: Restore snake_case JSON for `ExecTxResult` (#856)**
- **qa: 200-nodes test on v0.38 (#877)**
- **qa: rotating node test on `v0.38.x` (#883)**
- **Changes to QA related files (e.g., `method.md`) (#878)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.18.0 to 1.19.0
(#868)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.2 to 1.8.3
(#873)**
- **build(deps): Bump github.com/bufbuild/buf from 1.18.0 to 1.19.0
(#872)**
- **Adds `vote_extension_size` to manifests (#858)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.27.1 to 2.28.1
(#893)**
- **build(deps): Bump github.com/prometheus/common from 0.43.0 to 0.44.0
(#892)**
- **build(deps): Bump slackapi/slack-github-action from 1.23.0 to 1.24.0
(#869)**
- **ADR 104: State sync from local application snapshot (#801)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.6.1 to 5.7.0
(#891)**
- **mempool: slight refactor for improving readability (#894)**
- **Add Vote Extension varying size testnet (#888)**
- **fix: lint fail when golangci-lint bump from v1.52.2 to v1.53.x
(#908)**
- **build(deps): Bump github.com/bufbuild/buf from 1.19.0 to 1.20.0
(#912)**
- **build(deps): Bump github.com/golangci/golangci-lint (#917)**
- **build(deps): Bump github.com/spf13/viper from 1.15.0 to 1.16.0
(#913)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.19.0 to 1.20.0
(#910)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.1 to 2.28.2
(#914)**
- **Minor fixes to `RELEASES.md` (#923)**
- **Prevent a transaction to appear twice in the mempool (#890)**
- **New metrics to track duplicate votes and block parts (#896) (#905)**
- **e2e tests are being skipped; `INFRASTRUCTURE-*` bug; portGen
inconsistency bug (#933)**
- **build(deps): Bump github.com/bufbuild/buf from 1.20.0 to 1.21.0
(#948)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.20.0 to 1.21.0
(#946)**
- **spec/p2p: document the p2p API used by Reactors (#851)**
- **build(deps): Bump docker/login-action from 2.1.0 to 2.2.0 (#944)**
- **e2e: Generate prometheus.yaml on setup (#954)**
- **Update the type annotations in the light client spec (#955)**
- **build(deps): Bump docker/build-push-action from 4.0.0 to 4.1.0
(#947)**
- **build(deps): Bump docker/setup-buildx-action from 2.5.0 to 2.7.0
(#962)**
- **Add requirement for `CheckTx` in ABCI spec (#928)**
- **fix: avoid recursive call after rename to (*PeerState).MarshalJSON
(#865)**
- **Port upstream proto changes to cometbft package**
- **changelog: Import entries for v0.34.28, v0.34.29, v0.37.1 and
v0.37.2 to `main` (#974)**
- **test/e2e: Fix Docker image build (#984)**
- **build(deps): Bump github.com/BurntSushi/toml from 1.3.0 to 1.3.2
(#952)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.2 to 2.29.0
(#953)**
- **Remove duplicate function `deterministicExecTxResult` (#986)**
- **mempool: Fix the benchmarks (#934)**
- **Add `CMT_HOME` (or remove it?) (#983)**
- **Remove buf.yaml at the root of the source tree (#979)**
- **build(deps): Bump docker/build-push-action from 4.1.0 to 4.1.1
(#989)**
- **build(deps): Bump golang.org/x/net from 0.10.0 to 0.11.0 (#994)**
- **build(deps): Bump golang.org/x/sync from 0.2.0 to 0.3.0 (#990)**
- **build(deps): Bump google.golang.org/grpc from 1.55.0 to 1.56.0
(#992)**
- **build(deps): Bump github.com/golangci/golangci-lint from 1.53.2 to
1.53.3 (#996)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.1 to
1.16.0 (#991)**
- **spec/p2p: new structure for the p2p specification (#966)**
- **consensus: optimize vote and block part gossip with
HasProposalBlockPartMessage and random sleeps (#904)**
- **Extend ABCI `max_block_size` parameter to give extended control to
the app (#1003)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.21.0 to 1.22.0
(#1026)**
- **Bump logs on non-fatal vote validation failures to Info level
(#1022)**
- **Update codeowners to include DevRel team (#1023)**
- **deps: Manually bump github.com/vektra/mockery/v2 from 2.29.0 to
2.30.1 (#1009)**
- **Update releasing.md to sign tags (#1034)**
- **build(deps): Bump github.com/bufbuild/buf from 1.21.0 to 1.22.0
(#1027)**
- **Rename ABCI enums and values to satisfy buf guidelines (#975)**
- **build(deps): Bump google.golang.org/grpc from 1.56.0 to 1.56.1
(#1028)**
- **docs: Added double quotes to /abci_query path param (#1015)**
- **Update Docs with Finalize Block (#760)**
- **Clarifies that processProposal may be called for set of transactions
different from the one returned in the preceding prepareProposal
(#1033)**
- **Update the annotation of part_set.go (#1056)**
- **build(deps): Bump docker/setup-buildx-action from 2.7.0 to 2.8.0
(#1071)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.1 to
2.30.16 (#1064)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.22.0 to 1.23.1
(#1072)**
- **build(deps): Bump github.com/bufbuild/buf from 1.22.0 to 1.23.1
(#1066)**
- **build(deps): Bump google.golang.org/protobuf from 1.30.0 to 1.31.0
(#1065)**
- **build(deps): Bump google.golang.org/grpc from 1.56.1 to 1.56.2
(#1101)**
- **build(deps): Bump golang.org/x/crypto from 0.10.0 to 0.11.0
(#1103)**
- **build(deps): Bump docker/setup-buildx-action from 2.8.0 to 2.9.0
(#1105)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.16 to
2.31.1 (#1100)**
- **build(deps): Bump golang.org/x/net from 0.11.0 to 0.12.0 (#1102)**
- **ci: Trigger workflows on merge group (#1118)**
- **Revert \"config: add bootstrap peers (#9680)\" (#1109)**
- **node: Revert removal of public reactor accessors (#1120)**
- **ci: Disable CodeQL check in merge queues (#1123)**
- **p2p: Remove UPnP functionality (#1114)**
- **ADR 107: Rename proto versions to pre-v1 betas (#1110)**
- **RFC 104: Internal messaging using the actor model (#1092)**
- **build(deps): Bump github.com/bufbuild/buf from 1.23.1 to 1.24.0
(#1131)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.31.1 to 2.32.0
(#1132)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.0 to 2.9.1
(#1133)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.23.1 to 1.24.0
(#1134)**
- **spec: Add mempool specification in English and Quint (#997)**
- **mempool: ADR for refactoring list of senders  (#1032)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.24.0 to 1.25.0
(#1157)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.7.0 to 5.8.0
(#1159)**
- **build(deps): Bump github.com/bufbuild/buf from 1.24.0 to 1.25.0
(#1160)**
- **proxy: Rename \"unsynchronized\" to \"connection-synchronized\" local
client creator (#1145)**
- **mempool: Keep track of senders in reactor instead of implementation
(#1010)**
- **cmd: Remove `replay` and `replay-console` subcommands (#1170)**
- **build(deps): Bump google.golang.org/grpc from 1.56.2 to 1.57.0
(#1181)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.0 to 5.8.1
(#1180)**
- **ci: Remove Mergify automerge (#1182)**
- **Add gRPC block service (#1142)**
- **blocksync: export errors (#1186)**
- **Porting changes related to creating a lean docker image from
`pierre/fast-prototyping-1059` branch. (#1192)**
- **chore: Format repo (#1193)**
- **Add BlockResults gRPC service (#1168)**
- **consensus: remove logic to unlock block on +2/3 prevote for nil
(#1175)**
- **ADR 101: Add GetLatest method to block service (#1209)**
- **ADR 101: Implement pruning mechanism (#1150)**
- **config: export errors (#1190)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.0 to 2.32.3
(#1218)**
- **Add check for non-`nil` in `enterCommit` (#1208)**
- **Log proposer's address when correctly accepting a proposal (#1079)**
- **Close evidence.db OnStop (#1210)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.0 to 1.25.1
(#1213)**
- **build(deps): Bump golang.org/x/crypto from 0.11.0 to 0.12.0
(#1215)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.0 to 1.25.1
(#1216)**
- **build(deps): Bump golang.org/x/net from 0.12.0 to 0.14.0 (#1217)**
- **Forward-port: update state to prevote `nil` when proposal block does
not match locked block (#1203)**
- **mempool: Store peer ids as p2p.ID instead of uint16 (remove
mempoolIDs) (#1191)**
- **ADR-101: implement gRPC `PruningService` (#1154)**
- **consensus: Avoid process proposal when we know correct nodes
validated it (#1231)**
- **ADR-101: Metrics to monitor the pruning  (#1234)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.1 to 1.26.0
(#1241)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.1 to 1.26.1
(#1239)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1240)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.3 to 2.32.4
(#1242)**
- **abci: export errors  (#1185)**
- **consensus: export errors (#1211)**
- **ADR-101: Pruning mechanism minor fixes (#1246)**
- **chore: Bump minimum Go version on `main` to v1.21 (#1244)**
- **ADR 101: Add `Close` method to gRPC client (#1251)**
- **ADR 108: ADR for extending E2E infrastructure so that we can check
CometBFT's behaviour with respect to ABCI++ grammar. (#902)**
- **docs: Add logging guide to contributing guidelines (#1250)**
- **chore: log `app_hash` as hex (#1264)**
- **update language (#1263)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.0 to 1.26.1
(#1272)**
- **build(deps): Bump gonum.org/v1/gonum from 0.13.0 to 0.14.0 (#1275)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.10 to 1.4.11
(#1276)**
- **ADR 101: Refactor height check-related logic and tests (#1271)**
- **Fixed linter**
- **Revert \"Fixed linter\"**
- **Fixed mem aliasing in for loop (#1280)**
- **Remove genesis persistence in state db (#1017)**
- **Revert \"Remove genesis persistence in state db (#1017)\" (#1294)**
- **evidence: export errors (#1284)**
- **Re-implement removal of genesis persistence in state db (#1295)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.1 to 2.10.0
(#1298)**
- **node: verify genesis doc hash against the file contents rather than
remarshalled JSON (#1293)**
- **indexer: Implement pruning mechanism (#1176)**
- **Provide relevant block data in `ExtendVote` (#1270)**
- **node/state:bootstrap state api (#1057)**
- **build(deps): Bump actions/checkout from 3 to 4 (#1319)**
- **build(deps): Bump docker/build-push-action from 4.1.1 to 4.2.1
(#1318)**
- **Fix (#1323)**
- **state: remove genesis file from database  (#1297)**
- **Added changelog for pruning metrics (#1335)**
- **Removed begin_block_events and end_block_events from rpc doc
(#1338)**
- **consensus: test for precommit/locking corner case (#1257)**
- **TxIndexer and BlockIndexer pruning metrics (#1334)**
- **Forward port changes to changelog and `UPGRADING.md` for release
`v0.38.0` (#1341)**
- **Update Go version specified in root README on main for v0.34.x
(#1352)**
- **Add test/e2e/data to gitignore (#1349)**
- **docs: gRPC services and data companion pruning services (#1307)**
- **Add genesis_hash flag check on node startup (#1324)**
- **gRPC for Tx and Block indexer pruning (#1327)**
- **build(deps): Bump docker/build-push-action from 4.2.1 to 5.0.0
(#1371)**
- **build(deps): Bump docker/setup-buildx-action from 2.10.0 to 3.0.0
(#1370)**
- **build(deps): Bump docker/login-action from 2.2.0 to 3.0.0 (#1368)**
- **build(deps): Bump goreleaser/goreleaser-action from 4 to 5 (#1369)**
- **ADR101: Moved changelog entries (#1377)**
- **Max byte check (#1384)**
- **Update to string (#1385)**
- **mempool: Remove unused peerID constants (#1379)**
- **build(deps): Bump github.com/google/uuid from 1.3.0 to 1.3.1
(#1392)**
- **build(deps): Bump github.com/rs/cors from 1.9.0 to 1.10.0 (#1393)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.1 to 5.9.0
(#1396)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.4 to 2.34.0
(#1400)**
- **build(deps): Bump github.com/go-kit/kit from 0.12.0 to 0.13.0
(#1397)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1398)**
- **build(deps): Bump google.golang.org/grpc from 1.57.0 to 1.58.2
(#1399)**
- **doc: improve documentation of BlockParams.MaxBytes (#1405)**
- **rpc: Improve abci_query parameter documentation (#1184)**
- **Bump p2p version following introduction of
`HasProposalBlockPartMessage` (#1411)**
- **RFC: Allowing Non-Determinism in `ProcessProposal` (#1391)**
- **ADR-101: Data Companion Pull API (#82)**
- **build(deps): Bump github.com/rs/cors from 1.10.0 to 1.10.1 (#1418)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.0 to 2.34.2
(#1416)**
- **build(deps): Bump github.com/prometheus/client_golang (#1417)**
- **fix typos (#1413)**
- **Renames Tendermint to CometBFT in the RPC related test code
(#1428)**
- **Renames Tendermint to CometBFT in the RPC related test code. This
file was missing and it was not caught in the branch testing. (#1433)**
- **Reject incoming txs while node is catching up (#1119)**
- **build(deps): Bump golang.org/x/crypto from 0.13.0 to 0.14.0
(#1458)**
- **build(deps): Bump golang.org/x/sync from 0.3.0 to 0.4.0 (#1454)**
- **build(deps): Bump golang.org/x/net from 0.15.0 to 0.16.0 (#1453)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.1 to 1.27.0
(#1449)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.11.0 to
0.12.0 (#1450)**
- **build(deps): Bump github.com/prometheus/client_model (#1455)**
- **build(deps): Bump github.com/bufbuild/buf from 1.26.1 to 1.27.0
(#1459)**
- **build(deps): Bump github.com/spf13/viper from 1.16.0 to 1.17.0
(#1456)**
- **test: respect P2PConfig fuzzing configuration in MultiplexTransport
(#1414)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.2 to 2.35.3
(#1462)**
- **crypto: export errors (#1463)**
- **Do not race with pruning to validate headers and validators
(#1467)**
- **fix typos (#1487)**
- **Call observer only when retain height changes (#1490)**
- **build(deps): Bump pillow from 9.3.0 to 10.0.1 in
/scripts/qa/reporting (#1493)**
- **abci: Add relaxed local client synchronization models (#1141)**
- **docs: fix typos (#1500)**
- **Post-merge fixes for feature/proto-upgrade**
- **Make BuildLastCommitInfo and BuildExtendedCommitInfo public
(#1502)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.3 to 2.35.4
(#1497)**
- **build(deps): Bump google.golang.org/grpc from 1.58.2 to 1.58.3
(#1498)**
- **build(deps): Bump golang.org/x/net from 0.16.0 to 0.17.0 (#1499)**
- **tiny change: reorder expected and actual values (#1506)**
- **Fixed docker port alias (#1507)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.0 to 1.27.1
(#1527)**
- **Implement ADR-107: rename proto package version suffixes to v1beta*
pattern (#1510)**
- **e2e: Fix flakiness in grpc tests due to pruning (#1492)**
- **fix spelling of bandwidth (#1534)**
- **Fix linting on `main` (#1531)**
- **build(deps): Bump github.com/prometheus/common from 0.44.0 to 0.45.0
(#1524)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.0 to 1.27.1
(#1522)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1540)**
- **fix some typos (#1541)**
- **indexer-respect-height-params-on-query (#1529)**
- **Correct go_package paths in service proto files (#1538)**
- **build(deps): Bump google.golang.org/grpc from 1.58.3 to 1.59.0
(#1521)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.4 to 2.36.0
(#1523)**
- **feat(mempool): export error (#1427)**
- **Rename proto messages and services to satisfy default buf lints
(#1533)**
- **RFC 106: non-idempotent methods in data companion (#1545)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.0
(#1550)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.1 to 1.27.2
(#1551)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1552)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.1 to 1.27.2
(#1553)**
- **use assert.Greater instead of Equal for better error reporting
(#1547)**
- **rpc: Version the RPC APIs (#1412)**
- **mempool: Add metric size of pool in bytes (#1512)**
- **build(deps): Bump github.com/docker/docker (#1570)**
- **build(deps): Bump github.com/spf13/cobra from 1.7.0 to 1.8.0
(#1572)**
- **build(deps): Bump golang.org/x/sync from 0.4.0 to 0.5.0 (#1574)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.0 to 2.36.1
(#1576)**
- **build(deps): Bump github.com/gorilla/websocket from 1.5.0 to 1.5.1
(#1575)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1573)**
- **chore: consolidate changelog improvements section (#1578)**
- **Implementation of ADR-108 (#930)**
- **Reduce the default MaxBytes to 4mb and increase MaxGas to 10 million
(#1518)**
- **e2e: Allow disabling the PEX reactor on all nodes in the testnet
(#1580)**
- **Experimental - Reduce # of connections effectively used to gossip
transactions out (#1558)**
- **Update proto file references to follow renaming/versioning (#1555)**
- **Make `LoadBlock` also return block metadata (#1557)**
- **mempool: Limit gossip connections to persistent and non-persistent
peers (experimental) (#1584)**
- **fix: docs: default db provider moved from node to config (#1588)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.2 to 1.28.0
(#1598)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.2 to 1.28.0
(#1602)**
- **build(deps): Bump golang.org/x/crypto from 0.14.0 to 0.15.0
(#1599)**
- **build(deps): Bump golang.org/x/net from 0.17.0 to 0.18.0 (#1597)**
- **RFC 107: Internal signalling using event observers (#1164)**
- **ADR 110: Remote mempool (#1565)**
- **chore: aligns function descriptions with godoc standards in the
types package (#1593)**
- **docs: various improvements (#1603)**
- **chore: Merge branch main into feature/proto-upgrade (#1612)**
- **Removes wrong assertion and decreases likelyhood of block from the
future has actually been already created (#1619)**
- **Split /api off to separate go.mod (#1608)**
- **feature: Reduce Go API surface area (ADR 109) (#1605)**
- **refactor: Export func MakeHTTPDialer (#1594)**
- **First draft (#1483)**
- **pruning:do not attempt to prune state if no blocks are pruned
(#1616)**
- **Update SECURITY.md (#1626)**
- **Update changelog on `main` with new releases (#1644)**
- **proto: Update README (#1648)**
- **ADR 111: `nop` Mempool (#1585)**
- **ADR-111: Addressed Ethan's comment (#1667)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.1 to 2.37.1
(#1662)**
- **build(deps): Bump docker/build-push-action from 5.0.0 to 5.1.0
(#1664)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.0 to 1.28.1
(#1665)**
- **ci: Fix v0.34 nightly build (#1655)**
- **build(deps): Bump github.com/bufbuild/buf from 1.28.0 to 1.28.1
(#1663)**
- **feature/proto-upgrade: Fix generated mock code (#1673)**
- **Update link in README.md (#1674)**
- **Renames the semantic versioning variable to CMT (#1621)**
- **mempool: add `nop` mempool (#1643)**
- **e2e:fix-digital-ocean-ports (#1678)**
- **Revert modularization of the test infra (#1488) (#1676)**
- **docs: various small improvements (part 2) (#1683)**
- **Do not block indefinitely on the semaphore (#1654)**
- **Adds tests that check for FIFO ordering being broken by gossip
(#1628)**
- **loadtime: Add parameter for displaying results in one line (#1511)**
- **Promote latest versions of Protobuf definitions to v1 packages
(#1677)**
- **chore: Update CHANGELOG.md (#1701)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1696)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.37.1 to 2.38.0
(#1697)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.1
(#1702)**
- **proto: document the `cometbft.*` versioned protos (#1694)**
- **Clean up changelog entries and README files for versioned proto
changes (#1707)**
- **chore(proto): add missing docs (#1703)**
- **feature/proto-upgrade: Last-minute fixes (#1709)**
- **e2e: Support emulated latencies between docker images (#1560)**
- **build(deps): Bump golang.org/x/net from 0.14.0 to 0.17.0 in /api
(#1713)**
- **Prepare `main` for `v1.x` backport branch (#1714)**
- **build(deps): Bump golang.org/x/crypto from 0.15.0 to 0.16.0
(#1720)**
- **build(deps): Bump golang.org/x/net from 0.18.0 to 0.19.0 (#1719)**
- **types: validate Validator#Address field (#1715)**
- **Enable Mergify backports for `v1.x` branch (#1724)**
- **deps: Bump cometbft-db to v0.9.0 (#1725)**
- **buf improvements prior to publishing on BSR (#1726)**
- **proto: give our buf module a name (#1734)**
- **deps: Bump cometbft-db to v0.9.1 (#1737)**
- **chore: Update root docs (#1740)**
- **fix: increase abci socket message size limit to 2GB (#1730)**
- **proto: make comment in README more Markdowny (#1743)**
- **fix: Txs Validate (#1687)**
- **Add test missing in #1687 (#1712)**
- **perf(state): batch save `State` (#1735)**
- **Update CODE_OF_CONDUCT.md (#1708)**
- **[e2e] Fixes prepareProposal not to return oversized set of
transactions (#1756)**
- **perf(store): Batch save `Block` (#1755)**
- **Fix: Fix minor typos (#1780)**
- **`VerifyCommitLight` and `VerifyCommitLightTrusting` _never_ check
all signatures (#1750)**
- **Fix typo in encoding.md (#1801)**
- **chore(docs): small improvements (#1781)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.10.1 to 5.11.0
(#1797)**
- **build(deps): Bump actions/setup-go from 4 to 5 (#1794)**
- **build(deps): Bump actions/stale from 8 to 9 (#1795)**
- **build(deps): Bump github.com/spf13/viper from 1.17.0 to 1.18.1
(#1796)**
- **Chore/fix other typos (#1809)**
- **chore(spec): specify which fields must be deterministic (#1804)**
- **Small improvements in #1806 not present in #1750 (#1808)**
- **Add changelog for #1749 (#1807)**
- **e2e: Implement latency emulation for DigitalOcean (#1587)**
- **add GH workflow for linting code using codespell (#1824)**
- **chore(docs): explain the effect of `timeout_propose` (#1798)**
- **build(deps): Bump actions/upload-artifact from 3 to 4 (#1845)**
- **build(deps): Bump actions/setup-python from 2 to 5 (#1843)**
- **build(deps): Bump github/codeql-action from 2 to 3 (#1847)**
- **build(deps): Bump actions/checkout from 2 to 4 (#1846)**
- **build(deps): Bump github.com/google/uuid from 1.4.0 to 1.5.0
(#1850)**
- **build(deps): Bump google.golang.org/grpc from 1.59.0 to 1.60.0
(#1851)**
- **golangci-lint: enable all the linters by default (#1838)**
- **Updates go crypto package to v0.17.0 (#1859)**
- **Adds checks for nil keys and signatures (#1855)**
- **The store DB and the companion `BlockStore` struct are sometimes out
of sync (#1856)**
- **Allow blocksync to not verify all signatures (#1858)**
- **Fixing the ABCI grammar and updating the code for e2e tests to
account for the new grammar. (#1829)**
- **docs: Fix Discord links in README (#1874)**
- **build(deps): Bump github.com/prometheus/client_golang (#1909)**
- **build(deps): Bump github.com/btcsuite/btcd/btcutil from 1.1.3 to
1.1.5 (#1908)**
- **build(deps): Bump google.golang.org/protobuf (#1885)**
- **build(deps): Bump github.com/spf13/viper from 1.18.1 to 1.18.2
(#1884)**
- **build(deps): Bump google.golang.org/grpc from 1.60.0 to 1.60.1
(#1883)**
- **remove unused linters that produced a warning and ensure that
unparam is enabled (#1905)**
- **Fix HTTP response body not being closed after reading (#1945)**
- **Disable undesired linting code (#1959)**
- **Extend kvstore example add with with key types (#1876)**
- **Extra check in `VerifyExtension` (#1877)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.38.0 to 2.39.1
(#1882)**
- **perf(crypto/merkle, crypto/tmhash): simplify+optimize SHA256 hashing
of multiple byteslices (#1921)**
- **Update localnet-start Makefile (#1975)**
- **blocksync: wait for poolRoutine to stop in (*Reactor).OnStop
(#1879)**
- **fix TestListenerTimeoutReadWrite (#1947)**
- **docs: fix typos (#1988)**
- **this is the kindest commit I can think of. Take it that way and read
the code. (#1987)**
- **there's really no need for this anymore (#1986)**
- **feat: DefaultHttpClient support setting proxy from env (#1900)**
- **feat: lint tests (#1906)**
- **chore: fix typos (#1991)**
- **build(deps): Bump golang.org/x/sync from 0.5.0 to 0.6.0 (#1992)**
- **feat(proxy): export errors (#1899)**
- **doc:fix broken link in DOCKER/README.md (#1996)**
- **feat: custom dependencies order (#1994)**
- **PBTS: migrating to `main` the new version of the specification
(#1973)**
- **Fix paths to scripts/metricsgen in go:generate commands (#1998)**
- **chore: fix some typos (#2002)**
- **docs(light): fix broken link to spec (#2007)**
- **chore(test/loadtime): replace tm-load-test w/ cometbft-load-test
(#2009)**
- **ci: Remove unused `tests` target when compiling e2e (#2022)**
- **spec: fix typo in `encoding.md` (#2024)**
- **mempool: Fix data races in CListMempool's height and
notifiedTxsAvailable (#2021)**
- **chore(test/loadtime): cleanup go.sum and golangci.yml (#2025)**
- **build(deps): Bump github.com/prometheus/common from 0.45.0 to 0.46.0
(#2040)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.39.1 to 2.40.1
(#2038)**
- **feat(rpc): Use default port for HTTP(S) URLs when there is no
explicit port (#1903)**
- **misc(go.mod): remove unused peg dependency (#2044)**
- **config: Remove unused `max_batch_bytes` (#2050)**
- **Merge pull request from GHSA-qr8r-m495-7hc4**
- **misc(tools)!: remove `tools` package (#2046)**
- **docs(guides): add missing import (#2070)**
- **deps(localnode): bump alpine version (#2077)**
- **misc(Makefile): add `help` target to display the help msg (#2074)**
- **`e2e`: test vote extension activation via `InitChain` and
`FinalizeBlock` (#2066)**
- **scripts: metricsgen parses '// metrics:' pattern (#2090)**
- **e2e: Add `load_max_txs` option to manifest (#2094)**
- **consensus: Add `chain_size_bytes` metric (#2093)**
- **feat: conventional commits (#1995)**
- **Forward port of tendermint/tendermint#7605, tendermint/spec#393, and
tendermint/tendermint#8142 (#2018)**
- **ci: fix permissions for \"Conventional PR Title\" (#2099)**
- **PBTS: additions and fixes on migrated spec (#2013)**
- **PBTS: forward port of tendermint/tendermint#7709 (#2089)**
- **feat: use go workspace (#1924)**
- **fix: `ValidateUpdate`: allow no-change updates regardless of current
height (#2112)**
- **test(localnet): Add monitoring tools for localnet (#2108)**
- **feat: add gofumpt (#2049)**
- **feat(consensus): increase log level for corner case when prevoting a
proposal (#2042)**
- **docs: v1 - diataxis framework (#2105)**
- **feat(consensus): additional sanity checks for the size of proposed
blocks (#1408)**
- **perf(internal/blocksync): avoid double-calling
`types.BlockFromProto` (#2016)**
- **build(deps): Bump google.golang.org/grpc from 1.60.1 to 1.61.0
(#2178)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.1 to 1.29.0
(#2161)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.12.0 to
0.12.1 (#2160)**
- **build(deps): Bump slackapi/slack-github-action from 1.24.0 to 1.25.0
(#2162)**
- **build(deps): Bump github.com/google/uuid from 1.5.0 to 1.6.0
(#2176)**
- **refactor(privval): reverse conditional + more idiomatic Go code with
early returns (#2156)**
- **fix(e2e): path to latency script files in DO (#2148)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.9.1 to
0.10.0 (#2175)**
- **chore(Makefile): add `setup-pre-commit` target to init git hook
(#2123)**
- **feat: add pebbledb (https://github.com/cockroachdb/pebble) (#2132)**
- **perf(internal/blocksync): do not `ValidateBlock` twice (#2026)**
- **feat(e2e): Add new targets `fast` and `clean` to Makefile (#2192)**
- **ci: add `spec` type in conventional-pr-title (#2191)**
- **fix(privval): retry accepting a connection on errors (#2047)**
- **fix(.github/workflows): correct parameters to lint_pr_title
(#2199)**
- **docs: update QA method steps for qa-infra changes (#2198)**
- **feat!(pbts): forward port of tendermint/tendermint#7711 (#2149)**
- **docs(pbts): forward port of PBTS documentation and fixes (#2124)**
- **fix: if-return and early-return (#2215)**
- **chore: remove amazon linux Dockerfile and update
test/docker/Dockerfile (#2135)**
- **feat(ci): pre-commit framework (#2214)**
- **ci: add `merge` type for conventional-pr-title (#2219)**
- **spec(consensus/pbts): update description for introduced parameters.
(#2206)**
- **perf: optimize psql indexer (#2142)**
- **fix(go.mod): do not use `replace` for api (#2236)**
- **fix(Makefile): gofumpt no longer needed (#2235)**
- **fix(p2p/pex): gracefully shutdown `Reactor` (#2010)**
- **test(mempool): fix
TestMempoolUpdateDoesNotPanicWhenApplicationMissedTx (#2242)**
- **fix(flowrate): fix non-determinism in flowrate tests (#2147)**
- **refactor!: Implement RFC 106: remove `GetLatestBlock*` methods from
data companion API (#2240)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.3 to 1.3.7
(#2253)**
- **chore(config): update DB section in toml.go (#2249)**
- **fix(consensus): do not precommit nil if proposal block is received
(#2221)**
- **build(deps): Bump github.com/opencontainers/runc from 1.1.5 to
1.1.12 (#2261)**
- **fix(mempool/tests): Reduce tests duration (#2263)**
- **ci: run golangci-lint linters for all files (not only ones which
were modified) (#2250)**
- **refactor(examples): small changes to kvstore app (#2267)**
- **refactor(mempool): simplify parameters of resCbFirstTime and
resCbRecheck (#2272)**
- **perf(mempool/cache): clear map in Reset (#2259)**
- **test(abci): update e2e tests to check against ABCI 2.0 grammar
(#2201)**
- **docs: symbolic references to steps in the qa-infra README (#2280)**
- **chore: updated doc link (#2296)**
- **fix(consensus): prevote nil upon timeout when Proposal is missing
(#2218)**
- **build(deps): Bump pre-commit/action from 3.0.0 to 3.0.1 (#2307)**
- **build(deps): Bump golang.org/x/net from 0.20.0 to 0.21.0 (#2300)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.10.0 to
0.11.0 (#2299)**
- **docs: ADR-112 Proposer-Based Timestamps (#2223)**
- **refactor(internal/statesync): replace ticker with `time.After(X)`
(#2294)**
- **fix: simultaneous rpc test failures (#2150)**
- **chore(docs): alter the section about the effects of `timeout_commit`
(#1892)**
- **refactor(p2p)!: Refactor PeerSet to eliminate data races & improve
performance (#2246)**
- **feat(pbts): Update consensus params to include pbts enabled
(#2231)**
- **feat(storage/metrics): Metrics to measure storage (#1974)**
- **feat(e2e): Log number of sent txs (success and failed) (#2328)**
- **chore: enable gomoddirectives, unparam (#2290)**
- **docs: images not rendering properly in docs (#2331)**
- **docs: Fix references about DeliverTx (#2330)**
- **docs(qa): Add table of contents to existing QA reports (#2343)**
- **chore: enable perfsprint linter (#2291)**
- **feat(pruning): trigger explicitly compaction upon pruning (#1972)**
- **docs: explain how to skip pre-commit hook (#2358)**
- **build(deps): Bump github.com/prometheus/common from 0.46.0 to 0.47.0
(#2373)**
- **build(deps): Bump google.golang.org/grpc from 1.61.0 to 1.61.1
(#2372)**
- **feat(e2e): Option to set max block size in bytes at genesis
(#2362)**
- **build(deps): Bump github.com/prometheus/client_model from 0.5.0 to
0.6.0 (#2371)**
- **revert(pbts): revert removal of BFT Time related functions (#2205)**
- **fix(e2e): Reduce flakiness of TestGRPC_GetBlockResults (#2367)**
- **spec(consensus): update Block Time documentation in spec (#2316)**
- **spec: adaptive MSGDELAY parameter included in PBTS spec (#2318)**
- **feat(pbts): Moving VoteExtensionsEnableHeight from ABCIParams to
FeatureParams. (#2335)**
- **fix: remove TestMempoolFIFOWithParallelCheckTx (#2364)**
- **fix(docker-compose): fix subnet (#2383)**
- **feat(pbts): enable `e2e` manifest config to set `PbtsEnableHeight`
(#2284)**
- **perf(internal/state): avoid double-saving FinalizeBlockResponse
(#2017)**
- **build(deps): Bump fonttools from 4.37.4 to 4.43.0 in
/scripts/qa/reporting (#2407)**
- **build(deps): Bump pillow from 10.0.1 to 10.2.0 in
/scripts/qa/reporting (#2408)**
- **fix(node): Forward compaction config params to blockstore
constructor (#2418)**
- **refactor!: moved `MedianTime` out of `internal` folder (#2397)**
- **chore: typo fixes (#2403)**
- **chore(pbts): Removes useless code (#2420)**
- **build(deps): Bump github.com/prometheus/common from 0.47.0 to 0.48.0
(#2430)**
- **build(deps): Bump google.golang.org/grpc from 1.61.1 to 1.62.0
(#2429)**
- **test(consensus): PBTS should be enabled by default in test units
(#2329)**
- **test(consensus): test enabling PBTS at a given height (#2404)**
- **refactor(protobuf): switch from gogofaster to gocosmos generator
(#2425)**
- **docs(tutorials/install): add `From Go package` (#2414)**
- **docs(pbts): documentation for PBTS-related consensus parameters
(#2376)**
- **refactor(consensus): print err from SignAndCheckVote (#2346)**
- **feat(e2e): add parameter to set a custom output directory for
testnet files (#2433)**
- **spec(consensus): update description of consensus parameters for PBTS
(#2415)**
- **fix(localnet): Grafana dashboards for storage tests - removed
experimental metrics (#2448)**
- **fix(jsonrpc): enable HTTP basic auth in WS client (#2434)**
- **feat(pbts): Adds timestamp to the `msgInfo` written into the WAL
(#2388)**
- **fix: `Rollback`: wrong modification of
`state.LastHeightValidatorsChanged` while rollback at a special height
(#2136)**
- **docs(changelog): add missing entry for #2136 (#2459)**
- **fix(pbts): legacy `ABCIParams` values are properly translated to
`FeatureParams` values (#2462)**
- **fix(e2e): Fixing the bug in ABCI e2e tests (#2468)**
- **feat(localnet): Grafana PNG rendering for easier graph exports
(#2472)**
- **docs(README): remove Terra (#2469)**
- **docs: document PBTS adaptive delays mechanism (#2452)**
- **fix(config): Moved compact variables to the right section (#2477)**
- **feat(metrics): more buckets for ProposalTimestampDifference
(#2479)**
- **fix(metrics): more buckets for ProposalTimestampDifference (#2481)**
- **feat(pbts): Make synchrony params adaptive (#2431)**
- **ci: check metrics generation in CI checks (#2483)**
- **feat(consensus): improve logging for timely and untimely messages
(#2321)**
- **feat(types): improve Proposal and SynchronyParams validation tests
(#2489)**
- **test(consensus): refactor TestStateLock_POLSafety tests (#2492)**
- **feat(types): refactor types.AdaptiveSynchronyParams method (#2490)**
- **fix: lint errors introduced with the latest merge (#2495)**
- **build(deps): Bump docker/setup-buildx-action from 3.0.0 to 3.1.0
(#2500)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.18.0 to
1.19.0 (#2508)**
- **build(deps): Bump golang.org/x/crypto from 0.19.0 to 0.20.0
(#2507)**
- **build(deps): Bump github.com/prometheus/common from 0.48.0 to 0.49.0
(#2506)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.4 to 1.9.0
(#2505)**
- **fix(docs): include `timesync` daemon instructions (#2491)**
- **feat(privval)!: DO NOT require extension signature (#2496)**
- **refactor(privval): rename sign_extension to skip_sign_extension
(#2519)**
- **spec(abci): fixes the spec to inform about the presence of invalid
extensions in `last_commit` (#2423)**
- **fix(pbts): block Time must be Canonical (#2493)**
- **feat(e2e): Add manifest option `clock_skew` and corresponding
backend functionality (#2454)**
- **fix(mempool): converting to uint64 before additions to avoid
overflows (#2498)**
- **refactor!: Rename `skip_sign_extension` to `skip_extension_signing`
(#2522)**
- **docs(ADR): ADR-108 updated to account for the new changes in the
grammar and code. (#2528)**
- **feat(e2e): add generator support for clock skew + env variable
rename (#2488)**
- **spec(proto): add `cometbft.privval.v1beta2` proto package (#2529)**
- **chore: improving error handling in the PendingEvidence (#2550)**
- **feat(blocksync)!: set the max number of (concurrently) downloaded
blocks to {peersCount * 20} (#2467)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.29.0 to 1.30.0
(#2557)**
- **build(deps): Bump google.golang.org/protobuf from 1.32.0 to 1.33.0
(#2560)**
- **build(deps): Bump golang.org/x/net from 0.21.0 to 0.22.0 (#2562)**
- **fix(cmd/cometbft/commands/version): update the output for v1
(#2546)**
- **build(deps): Bump docker/build-push-action from 5.1.0 to 5.2.0
(#2558)**
- **build(deps): Bump github.com/prometheus/common from 0.49.0 to 0.50.0
(#2559)**
- **build(deps): Bump google.golang.org/grpc from 1.62.0 to 1.62.1
(#2563)**
- **build(deps): Bump golang.org/x/crypto from 0.20.0 to 0.21.0
(#2561)**
- **feat(blocksync): sort peers by download rate & multiple requests for
closer blocks (#2475)**
- **feat(pbts): Adjusts PBTS metrics buckets (#2578)**
- **fix(blocksync): use timer instead of time.After (#2584)**
- **fix: temporary fix for `api` dependency (#2589)**

---------

Signed-off-by: Thane Thomson <connect@thanethomson.com>
Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: Thane Thomson <connect@thanethomson.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
Co-authored-by: Mikhail Zabaluev <mikhail@informal.systems>
Co-authored-by: Troy Kessler <43882936+troykessler@users.noreply.github.com>
Co-authored-by: leven <112051166+lx-xiang@users.noreply.github.com>
Co-authored-by: werty144 <anton-paramonov2000@yandex.ru>
Co-authored-by: Adi Seredinschi <adizere@gmail.com>
Co-authored-by: Sukey <35202440+sukey2008@users.noreply.github.com>
Co-authored-by: Sergio Mena <sergio@informal.systems>
Co-authored-by: Jasmina Malicevic <jasmina.dustinac@gmail.com>
Co-authored-by: moriluka <85185077+moriluka@users.noreply.github.com>
Co-authored-by: ƒê·ªó Vi·ªát Ho√†ng <hoangdv2429@gmail.com>
Co-authored-by: alex <152680487+azukiboy@users.noreply.github.com>
Co-authored-by: Hern√°n Vanzetto <15466498+hvanz@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@informal.systems>
Co-authored-by: Andy Nogueira <me@andynogueira.dev>
Co-authored-by: nenadmilosevic95 <50905385+nenadmilosevic95@users.noreply.github.com>
Co-authored-by: nenadmilosevic95 <nenad@informal.systems>
Co-authored-by: Jacob Gadikian <jacobgadikian@gmail.com>
Co-authored-by: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Co-authored-by: Emmanuel T Odeke <emm.odeke@gmail.com>
Co-authored-by: jchappelow <140431406+jchappelow@users.noreply.github.com>
Co-authored-by: shuoer86 <129674997+shuoer86@users.noreply.github.com>
Co-authored-by: levisyin <150114626+levisyin@users.noreply.github.com>
Co-authored-by: vuittont60 <81072379+vuittont60@users.noreply.github.com>
Co-authored-by: Halimao <1065621723@qq.com>
Co-authored-by: alex <152680487+bodhi-crypo@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@usi.ch>
Co-authored-by: Josef Widder <44643235+josef-widder@users.noreply.github.com>
Co-authored-by: William Banfield <4561443+williambanfield@users.noreply.github.com>
Co-authored-by: Kukovec <jure.kukovec@gmail.com>
Co-authored-by: Daniel Cason <cason@gandria>
Co-authored-by: M. J. Fromberger <fromberger@interchain.io>
Co-authored-by: hattizai <150505746+hattizai@users.noreply.github.com>
Co-authored-by: Huulu <35667132+IssouChancla@users.noreply.github.com>
Co-authored-by: katelyn martin <me+cratelyn@katelyn.world>
Co-authored-by: Richard Gibson <richard.gibson@gmail.com>
Co-authored-by: Jean Deruelle <jean.deruelle@gmail.com>
Co-authored-by: glnro <8335464+glnro@users.noreply.github.com>
Co-authored-by: Greg Szabo <greg@philosobear.com>
Co-authored-by: Emmanuel T Odeke <emmanuel@orijtech.com>
Co-authored-by: levisyin <lilassherl@gmail.com>
Co-authored-by: k0marov <95040709+k0marov@users.noreply.github.com>
Co-authored-by: Adi Seredinschi <a@seredinschi.net>
Co-authored-by: Pan chao <152830401+Pan-chao@users.noreply.github.com>
Co-authored-by: Khanh Hoa <49144992+hoanguyenkh@users.noreply.github.com>
Co-authored-by: glnro <lauren@informal.systems>
Co-authored-by: toni <143221387+xyztoni@users.noreply.github.com>
Co-authored-by: DragonKid <idragonkid@gmail.com>
Co-authored-by: Matt Ketmo <matthieu@moquet.net>
Co-authored-by: Ethan <cosinlinker@gmail.com>
Co-authored-by: Evgeny Danilenko <6655321@bk.ru>
Co-authored-by: Duong Minh Ngoc <153509244+minhngoc274@users.noreply.github.com>
Co-authored-by: Kero <keroroxx520@gmail.com>") [spec/consensus-gossip](/cometbft/cometbft/commit/e7dd0ab89fc3783d3de30f2c5fb892f9ca072ba2 "chore(spec): merge main into `spec/consensus-gossip` (#2594)

- **Versioned protobuf files (#495)**
- **Restore rpc/grpc/v1/types.pb.go**
- **proto: restore deprecation notice on BroadcastAPI**
- **Struct `Client` exposes sensitive data (#784)**
- **Unsafe int cast in `kill` command (#783)**
- **ADR-100: Data Companion Push API (#73)**
- **rfc: incoming txs while catching up (#735)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.17.0 to 1.18.0
(#804)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.8 to 1.4.9
(#806)**
- **build(deps): Bump golang.org/x/sync from 0.1.0 to 0.2.0 (#807)**
- **build(deps): Bump google.golang.org/grpc from 1.54.0 to 1.55.0
(#813)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.0 to
1.15.1 (#810)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/prometheus/client_model from 0.3.0 to
0.4.0 (#812)**
- **build(deps): Bump github.com/prometheus/common from 0.42.0 to 0.43.0
(#811)**
- **ADR-103: Protobuf definition versioning (#772)**
- **spec/p2p: Specify the operation of a Reactor (#714)**
- **build(deps): Bump github.com/docker/distribution (#827)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.1 to 1.3.3
(#828)**
- **ADR-103: Protobuf definition versioning (#772) (#817)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.9 to 1.4.10
(#830)**
- **build(deps): Bump golang.org/x/net from 0.9.0 to 0.10.0 (#831)**
- **build(deps): Bump golang.org/x/crypto from 0.8.0 to 0.9.0 (#832)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.26.1 to 2.27.1
(#833)**
- **rpc: Remove response data from response failure logs (#829)**
- **pubsub/kvindexer:support for big numbers - v2 (#797)**
- **Extend the infrastructure provider with `StartNodes` and
`StopTestnet` (#796)**
- **grpc: Add base gRPC server with version service (#818)**
- **Digital Ocean implementation of `StartNodes` and `StopTestnet`
(#846)**
- **RFC 102: Improve forward compatibility of proto-generated Rust
(#724)**
- **mempool: Add metric to measure how many times a tx was received
(#637)**
- **`e2e` provider is extended with `Disconnect`, `Reconnect` and
`CheckUpgraded` (#852)**
- **Sort `loadtime` tool's report (#854)**
- **feat: make handshake cancelable (#857)**
- **proto: Restore snake_case JSON for `ExecTxResult` (#856)**
- **qa: 200-nodes test on v0.38 (#877)**
- **qa: rotating node test on `v0.38.x` (#883)**
- **Changes to QA related files (e.g., `method.md`) (#878)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.18.0 to 1.19.0
(#868)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.2 to 1.8.3
(#873)**
- **build(deps): Bump github.com/bufbuild/buf from 1.18.0 to 1.19.0
(#872)**
- **Adds `vote_extension_size` to manifests (#858)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.27.1 to 2.28.1
(#893)**
- **build(deps): Bump github.com/prometheus/common from 0.43.0 to 0.44.0
(#892)**
- **build(deps): Bump slackapi/slack-github-action from 1.23.0 to 1.24.0
(#869)**
- **ADR 104: State sync from local application snapshot (#801)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.6.1 to 5.7.0
(#891)**
- **mempool: slight refactor for improving readability (#894)**
- **Add Vote Extension varying size testnet (#888)**
- **fix: lint fail when golangci-lint bump from v1.52.2 to v1.53.x
(#908)**
- **build(deps): Bump github.com/bufbuild/buf from 1.19.0 to 1.20.0
(#912)**
- **build(deps): Bump github.com/golangci/golangci-lint (#917)**
- **build(deps): Bump github.com/spf13/viper from 1.15.0 to 1.16.0
(#913)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.19.0 to 1.20.0
(#910)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.1 to 2.28.2
(#914)**
- **Minor fixes to `RELEASES.md` (#923)**
- **Prevent a transaction to appear twice in the mempool (#890)**
- **New metrics to track duplicate votes and block parts (#896) (#905)**
- **e2e tests are being skipped; `INFRASTRUCTURE-*` bug; portGen
inconsistency bug (#933)**
- **build(deps): Bump github.com/bufbuild/buf from 1.20.0 to 1.21.0
(#948)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.20.0 to 1.21.0
(#946)**
- **spec/p2p: document the p2p API used by Reactors (#851)**
- **build(deps): Bump docker/login-action from 2.1.0 to 2.2.0 (#944)**
- **e2e: Generate prometheus.yaml on setup (#954)**
- **Update the type annotations in the light client spec (#955)**
- **build(deps): Bump docker/build-push-action from 4.0.0 to 4.1.0
(#947)**
- **build(deps): Bump docker/setup-buildx-action from 2.5.0 to 2.7.0
(#962)**
- **Add requirement for `CheckTx` in ABCI spec (#928)**
- **fix: avoid recursive call after rename to (*PeerState).MarshalJSON
(#865)**
- **Port upstream proto changes to cometbft package**
- **changelog: Import entries for v0.34.28, v0.34.29, v0.37.1 and
v0.37.2 to `main` (#974)**
- **test/e2e: Fix Docker image build (#984)**
- **build(deps): Bump github.com/BurntSushi/toml from 1.3.0 to 1.3.2
(#952)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.2 to 2.29.0
(#953)**
- **Remove duplicate function `deterministicExecTxResult` (#986)**
- **mempool: Fix the benchmarks (#934)**
- **Add `CMT_HOME` (or remove it?) (#983)**
- **Remove buf.yaml at the root of the source tree (#979)**
- **build(deps): Bump docker/build-push-action from 4.1.0 to 4.1.1
(#989)**
- **build(deps): Bump golang.org/x/net from 0.10.0 to 0.11.0 (#994)**
- **build(deps): Bump golang.org/x/sync from 0.2.0 to 0.3.0 (#990)**
- **build(deps): Bump google.golang.org/grpc from 1.55.0 to 1.56.0
(#992)**
- **build(deps): Bump github.com/golangci/golangci-lint from 1.53.2 to
1.53.3 (#996)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.1 to
1.16.0 (#991)**
- **spec/p2p: new structure for the p2p specification (#966)**
- **consensus: optimize vote and block part gossip with
HasProposalBlockPartMessage and random sleeps (#904)**
- **Extend ABCI `max_block_size` parameter to give extended control to
the app (#1003)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.21.0 to 1.22.0
(#1026)**
- **Bump logs on non-fatal vote validation failures to Info level
(#1022)**
- **Update codeowners to include DevRel team (#1023)**
- **deps: Manually bump github.com/vektra/mockery/v2 from 2.29.0 to
2.30.1 (#1009)**
- **Update releasing.md to sign tags (#1034)**
- **build(deps): Bump github.com/bufbuild/buf from 1.21.0 to 1.22.0
(#1027)**
- **Rename ABCI enums and values to satisfy buf guidelines (#975)**
- **build(deps): Bump google.golang.org/grpc from 1.56.0 to 1.56.1
(#1028)**
- **docs: Added double quotes to /abci_query path param (#1015)**
- **Update Docs with Finalize Block (#760)**
- **Clarifies that processProposal may be called for set of transactions
different from the one returned in the preceding prepareProposal
(#1033)**
- **Update the annotation of part_set.go (#1056)**
- **build(deps): Bump docker/setup-buildx-action from 2.7.0 to 2.8.0
(#1071)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.1 to
2.30.16 (#1064)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.22.0 to 1.23.1
(#1072)**
- **build(deps): Bump github.com/bufbuild/buf from 1.22.0 to 1.23.1
(#1066)**
- **build(deps): Bump google.golang.org/protobuf from 1.30.0 to 1.31.0
(#1065)**
- **build(deps): Bump google.golang.org/grpc from 1.56.1 to 1.56.2
(#1101)**
- **build(deps): Bump golang.org/x/crypto from 0.10.0 to 0.11.0
(#1103)**
- **build(deps): Bump docker/setup-buildx-action from 2.8.0 to 2.9.0
(#1105)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.16 to
2.31.1 (#1100)**
- **build(deps): Bump golang.org/x/net from 0.11.0 to 0.12.0 (#1102)**
- **ci: Trigger workflows on merge group (#1118)**
- **Revert \"config: add bootstrap peers (#9680)\" (#1109)**
- **node: Revert removal of public reactor accessors (#1120)**
- **ci: Disable CodeQL check in merge queues (#1123)**
- **p2p: Remove UPnP functionality (#1114)**
- **ADR 107: Rename proto versions to pre-v1 betas (#1110)**
- **RFC 104: Internal messaging using the actor model (#1092)**
- **build(deps): Bump github.com/bufbuild/buf from 1.23.1 to 1.24.0
(#1131)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.31.1 to 2.32.0
(#1132)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.0 to 2.9.1
(#1133)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.23.1 to 1.24.0
(#1134)**
- **spec: Add mempool specification in English and Quint (#997)**
- **mempool: ADR for refactoring list of senders  (#1032)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.24.0 to 1.25.0
(#1157)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.7.0 to 5.8.0
(#1159)**
- **build(deps): Bump github.com/bufbuild/buf from 1.24.0 to 1.25.0
(#1160)**
- **proxy: Rename \"unsynchronized\" to \"connection-synchronized\" local
client creator (#1145)**
- **mempool: Keep track of senders in reactor instead of implementation
(#1010)**
- **cmd: Remove `replay` and `replay-console` subcommands (#1170)**
- **build(deps): Bump google.golang.org/grpc from 1.56.2 to 1.57.0
(#1181)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.0 to 5.8.1
(#1180)**
- **ci: Remove Mergify automerge (#1182)**
- **Add gRPC block service (#1142)**
- **blocksync: export errors (#1186)**
- **Porting changes related to creating a lean docker image from
`pierre/fast-prototyping-1059` branch. (#1192)**
- **chore: Format repo (#1193)**
- **Add BlockResults gRPC service (#1168)**
- **consensus: remove logic to unlock block on +2/3 prevote for nil
(#1175)**
- **ADR 101: Add GetLatest method to block service (#1209)**
- **ADR 101: Implement pruning mechanism (#1150)**
- **config: export errors (#1190)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.0 to 2.32.3
(#1218)**
- **Add check for non-`nil` in `enterCommit` (#1208)**
- **Log proposer's address when correctly accepting a proposal (#1079)**
- **Close evidence.db OnStop (#1210)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.0 to 1.25.1
(#1213)**
- **build(deps): Bump golang.org/x/crypto from 0.11.0 to 0.12.0
(#1215)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.0 to 1.25.1
(#1216)**
- **build(deps): Bump golang.org/x/net from 0.12.0 to 0.14.0 (#1217)**
- **Forward-port: update state to prevote `nil` when proposal block does
not match locked block (#1203)**
- **mempool: Store peer ids as p2p.ID instead of uint16 (remove
mempoolIDs) (#1191)**
- **ADR-101: implement gRPC `PruningService` (#1154)**
- **consensus: Avoid process proposal when we know correct nodes
validated it (#1231)**
- **ADR-101: Metrics to monitor the pruning  (#1234)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.1 to 1.26.0
(#1241)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.1 to 1.26.1
(#1239)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1240)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.3 to 2.32.4
(#1242)**
- **abci: export errors  (#1185)**
- **consensus: export errors (#1211)**
- **ADR-101: Pruning mechanism minor fixes (#1246)**
- **chore: Bump minimum Go version on `main` to v1.21 (#1244)**
- **ADR 101: Add `Close` method to gRPC client (#1251)**
- **ADR 108: ADR for extending E2E infrastructure so that we can check
CometBFT's behaviour with respect to ABCI++ grammar. (#902)**
- **docs: Add logging guide to contributing guidelines (#1250)**
- **chore: log `app_hash` as hex (#1264)**
- **update language (#1263)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.0 to 1.26.1
(#1272)**
- **build(deps): Bump gonum.org/v1/gonum from 0.13.0 to 0.14.0 (#1275)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.10 to 1.4.11
(#1276)**
- **ADR 101: Refactor height check-related logic and tests (#1271)**
- **Fixed linter**
- **Revert \"Fixed linter\"**
- **Fixed mem aliasing in for loop (#1280)**
- **Remove genesis persistence in state db (#1017)**
- **Revert \"Remove genesis persistence in state db (#1017)\" (#1294)**
- **evidence: export errors (#1284)**
- **Re-implement removal of genesis persistence in state db (#1295)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.1 to 2.10.0
(#1298)**
- **node: verify genesis doc hash against the file contents rather than
remarshalled JSON (#1293)**
- **indexer: Implement pruning mechanism (#1176)**
- **Provide relevant block data in `ExtendVote` (#1270)**
- **node/state:bootstrap state api (#1057)**
- **build(deps): Bump actions/checkout from 3 to 4 (#1319)**
- **build(deps): Bump docker/build-push-action from 4.1.1 to 4.2.1
(#1318)**
- **Fix (#1323)**
- **state: remove genesis file from database  (#1297)**
- **Added changelog for pruning metrics (#1335)**
- **Removed begin_block_events and end_block_events from rpc doc
(#1338)**
- **consensus: test for precommit/locking corner case (#1257)**
- **TxIndexer and BlockIndexer pruning metrics (#1334)**
- **Forward port changes to changelog and `UPGRADING.md` for release
`v0.38.0` (#1341)**
- **Update Go version specified in root README on main for v0.34.x
(#1352)**
- **Add test/e2e/data to gitignore (#1349)**
- **docs: gRPC services and data companion pruning services (#1307)**
- **Add genesis_hash flag check on node startup (#1324)**
- **gRPC for Tx and Block indexer pruning (#1327)**
- **build(deps): Bump docker/build-push-action from 4.2.1 to 5.0.0
(#1371)**
- **build(deps): Bump docker/setup-buildx-action from 2.10.0 to 3.0.0
(#1370)**
- **build(deps): Bump docker/login-action from 2.2.0 to 3.0.0 (#1368)**
- **build(deps): Bump goreleaser/goreleaser-action from 4 to 5 (#1369)**
- **ADR101: Moved changelog entries (#1377)**
- **Max byte check (#1384)**
- **Update to string (#1385)**
- **mempool: Remove unused peerID constants (#1379)**
- **build(deps): Bump github.com/google/uuid from 1.3.0 to 1.3.1
(#1392)**
- **build(deps): Bump github.com/rs/cors from 1.9.0 to 1.10.0 (#1393)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.1 to 5.9.0
(#1396)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.4 to 2.34.0
(#1400)**
- **build(deps): Bump github.com/go-kit/kit from 0.12.0 to 0.13.0
(#1397)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1398)**
- **build(deps): Bump google.golang.org/grpc from 1.57.0 to 1.58.2
(#1399)**
- **doc: improve documentation of BlockParams.MaxBytes (#1405)**
- **rpc: Improve abci_query parameter documentation (#1184)**
- **Bump p2p version following introduction of
`HasProposalBlockPartMessage` (#1411)**
- **RFC: Allowing Non-Determinism in `ProcessProposal` (#1391)**
- **ADR-101: Data Companion Pull API (#82)**
- **build(deps): Bump github.com/rs/cors from 1.10.0 to 1.10.1 (#1418)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.0 to 2.34.2
(#1416)**
- **build(deps): Bump github.com/prometheus/client_golang (#1417)**
- **fix typos (#1413)**
- **Renames Tendermint to CometBFT in the RPC related test code
(#1428)**
- **Renames Tendermint to CometBFT in the RPC related test code. This
file was missing and it was not caught in the branch testing. (#1433)**
- **Reject incoming txs while node is catching up (#1119)**
- **build(deps): Bump golang.org/x/crypto from 0.13.0 to 0.14.0
(#1458)**
- **build(deps): Bump golang.org/x/sync from 0.3.0 to 0.4.0 (#1454)**
- **build(deps): Bump golang.org/x/net from 0.15.0 to 0.16.0 (#1453)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.1 to 1.27.0
(#1449)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.11.0 to
0.12.0 (#1450)**
- **build(deps): Bump github.com/prometheus/client_model (#1455)**
- **build(deps): Bump github.com/bufbuild/buf from 1.26.1 to 1.27.0
(#1459)**
- **build(deps): Bump github.com/spf13/viper from 1.16.0 to 1.17.0
(#1456)**
- **test: respect P2PConfig fuzzing configuration in MultiplexTransport
(#1414)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.2 to 2.35.3
(#1462)**
- **crypto: export errors (#1463)**
- **Do not race with pruning to validate headers and validators
(#1467)**
- **fix typos (#1487)**
- **Call observer only when retain height changes (#1490)**
- **build(deps): Bump pillow from 9.3.0 to 10.0.1 in
/scripts/qa/reporting (#1493)**
- **abci: Add relaxed local client synchronization models (#1141)**
- **docs: fix typos (#1500)**
- **Post-merge fixes for feature/proto-upgrade**
- **Make BuildLastCommitInfo and BuildExtendedCommitInfo public
(#1502)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.3 to 2.35.4
(#1497)**
- **build(deps): Bump google.golang.org/grpc from 1.58.2 to 1.58.3
(#1498)**
- **build(deps): Bump golang.org/x/net from 0.16.0 to 0.17.0 (#1499)**
- **tiny change: reorder expected and actual values (#1506)**
- **Fixed docker port alias (#1507)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.0 to 1.27.1
(#1527)**
- **Implement ADR-107: rename proto package version suffixes to v1beta*
pattern (#1510)**
- **e2e: Fix flakiness in grpc tests due to pruning (#1492)**
- **fix spelling of bandwidth (#1534)**
- **Fix linting on `main` (#1531)**
- **build(deps): Bump github.com/prometheus/common from 0.44.0 to 0.45.0
(#1524)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.0 to 1.27.1
(#1522)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1540)**
- **fix some typos (#1541)**
- **indexer-respect-height-params-on-query (#1529)**
- **Correct go_package paths in service proto files (#1538)**
- **build(deps): Bump google.golang.org/grpc from 1.58.3 to 1.59.0
(#1521)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.4 to 2.36.0
(#1523)**
- **feat(mempool): export error (#1427)**
- **Rename proto messages and services to satisfy default buf lints
(#1533)**
- **RFC 106: non-idempotent methods in data companion (#1545)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.0
(#1550)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.1 to 1.27.2
(#1551)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1552)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.1 to 1.27.2
(#1553)**
- **use assert.Greater instead of Equal for better error reporting
(#1547)**
- **rpc: Version the RPC APIs (#1412)**
- **mempool: Add metric size of pool in bytes (#1512)**
- **build(deps): Bump github.com/docker/docker (#1570)**
- **build(deps): Bump github.com/spf13/cobra from 1.7.0 to 1.8.0
(#1572)**
- **build(deps): Bump golang.org/x/sync from 0.4.0 to 0.5.0 (#1574)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.0 to 2.36.1
(#1576)**
- **build(deps): Bump github.com/gorilla/websocket from 1.5.0 to 1.5.1
(#1575)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1573)**
- **chore: consolidate changelog improvements section (#1578)**
- **Implementation of ADR-108 (#930)**
- **Reduce the default MaxBytes to 4mb and increase MaxGas to 10 million
(#1518)**
- **e2e: Allow disabling the PEX reactor on all nodes in the testnet
(#1580)**
- **Experimental - Reduce # of connections effectively used to gossip
transactions out (#1558)**
- **Update proto file references to follow renaming/versioning (#1555)**
- **Make `LoadBlock` also return block metadata (#1557)**
- **mempool: Limit gossip connections to persistent and non-persistent
peers (experimental) (#1584)**
- **fix: docs: default db provider moved from node to config (#1588)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.2 to 1.28.0
(#1598)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.2 to 1.28.0
(#1602)**
- **build(deps): Bump golang.org/x/crypto from 0.14.0 to 0.15.0
(#1599)**
- **build(deps): Bump golang.org/x/net from 0.17.0 to 0.18.0 (#1597)**
- **RFC 107: Internal signalling using event observers (#1164)**
- **ADR 110: Remote mempool (#1565)**
- **chore: aligns function descriptions with godoc standards in the
types package (#1593)**
- **docs: various improvements (#1603)**
- **chore: Merge branch main into feature/proto-upgrade (#1612)**
- **Removes wrong assertion and decreases likelyhood of block from the
future has actually been already created (#1619)**
- **Split /api off to separate go.mod (#1608)**
- **feature: Reduce Go API surface area (ADR 109) (#1605)**
- **refactor: Export func MakeHTTPDialer (#1594)**
- **First draft (#1483)**
- **pruning:do not attempt to prune state if no blocks are pruned
(#1616)**
- **Update SECURITY.md (#1626)**
- **Update changelog on `main` with new releases (#1644)**
- **proto: Update README (#1648)**
- **ADR 111: `nop` Mempool (#1585)**
- **ADR-111: Addressed Ethan's comment (#1667)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.1 to 2.37.1
(#1662)**
- **build(deps): Bump docker/build-push-action from 5.0.0 to 5.1.0
(#1664)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.0 to 1.28.1
(#1665)**
- **ci: Fix v0.34 nightly build (#1655)**
- **build(deps): Bump github.com/bufbuild/buf from 1.28.0 to 1.28.1
(#1663)**
- **feature/proto-upgrade: Fix generated mock code (#1673)**
- **Update link in README.md (#1674)**
- **Renames the semantic versioning variable to CMT (#1621)**
- **mempool: add `nop` mempool (#1643)**
- **e2e:fix-digital-ocean-ports (#1678)**
- **Revert modularization of the test infra (#1488) (#1676)**
- **docs: various small improvements (part 2) (#1683)**
- **Do not block indefinitely on the semaphore (#1654)**
- **Adds tests that check for FIFO ordering being broken by gossip
(#1628)**
- **loadtime: Add parameter for displaying results in one line (#1511)**
- **Promote latest versions of Protobuf definitions to v1 packages
(#1677)**
- **chore: Update CHANGELOG.md (#1701)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1696)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.37.1 to 2.38.0
(#1697)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.1
(#1702)**
- **proto: document the `cometbft.*` versioned protos (#1694)**
- **Clean up changelog entries and README files for versioned proto
changes (#1707)**
- **chore(proto): add missing docs (#1703)**
- **feature/proto-upgrade: Last-minute fixes (#1709)**
- **e2e: Support emulated latencies between docker images (#1560)**
- **build(deps): Bump golang.org/x/net from 0.14.0 to 0.17.0 in /api
(#1713)**
- **Prepare `main` for `v1.x` backport branch (#1714)**
- **build(deps): Bump golang.org/x/crypto from 0.15.0 to 0.16.0
(#1720)**
- **build(deps): Bump golang.org/x/net from 0.18.0 to 0.19.0 (#1719)**
- **types: validate Validator#Address field (#1715)**
- **Enable Mergify backports for `v1.x` branch (#1724)**
- **deps: Bump cometbft-db to v0.9.0 (#1725)**
- **buf improvements prior to publishing on BSR (#1726)**
- **proto: give our buf module a name (#1734)**
- **deps: Bump cometbft-db to v0.9.1 (#1737)**
- **chore: Update root docs (#1740)**
- **fix: increase abci socket message size limit to 2GB (#1730)**
- **proto: make comment in README more Markdowny (#1743)**
- **fix: Txs Validate (#1687)**
- **Add test missing in #1687 (#1712)**
- **perf(state): batch save `State` (#1735)**
- **Update CODE_OF_CONDUCT.md (#1708)**
- **[e2e] Fixes prepareProposal not to return oversized set of
transactions (#1756)**
- **perf(store): Batch save `Block` (#1755)**
- **Fix: Fix minor typos (#1780)**
- **`VerifyCommitLight` and `VerifyCommitLightTrusting` _never_ check
all signatures (#1750)**
- **Fix typo in encoding.md (#1801)**
- **chore(docs): small improvements (#1781)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.10.1 to 5.11.0
(#1797)**
- **build(deps): Bump actions/setup-go from 4 to 5 (#1794)**
- **build(deps): Bump actions/stale from 8 to 9 (#1795)**
- **build(deps): Bump github.com/spf13/viper from 1.17.0 to 1.18.1
(#1796)**
- **Chore/fix other typos (#1809)**
- **chore(spec): specify which fields must be deterministic (#1804)**
- **Small improvements in #1806 not present in #1750 (#1808)**
- **Add changelog for #1749 (#1807)**
- **e2e: Implement latency emulation for DigitalOcean (#1587)**
- **add GH workflow for linting code using codespell (#1824)**
- **chore(docs): explain the effect of `timeout_propose` (#1798)**
- **build(deps): Bump actions/upload-artifact from 3 to 4 (#1845)**
- **build(deps): Bump actions/setup-python from 2 to 5 (#1843)**
- **build(deps): Bump github/codeql-action from 2 to 3 (#1847)**
- **build(deps): Bump actions/checkout from 2 to 4 (#1846)**
- **build(deps): Bump github.com/google/uuid from 1.4.0 to 1.5.0
(#1850)**
- **build(deps): Bump google.golang.org/grpc from 1.59.0 to 1.60.0
(#1851)**
- **golangci-lint: enable all the linters by default (#1838)**
- **Updates go crypto package to v0.17.0 (#1859)**
- **Adds checks for nil keys and signatures (#1855)**
- **The store DB and the companion `BlockStore` struct are sometimes out
of sync (#1856)**
- **Allow blocksync to not verify all signatures (#1858)**
- **Fixing the ABCI grammar and updating the code for e2e tests to
account for the new grammar. (#1829)**
- **docs: Fix Discord links in README (#1874)**
- **build(deps): Bump github.com/prometheus/client_golang (#1909)**
- **build(deps): Bump github.com/btcsuite/btcd/btcutil from 1.1.3 to
1.1.5 (#1908)**
- **build(deps): Bump google.golang.org/protobuf (#1885)**
- **build(deps): Bump github.com/spf13/viper from 1.18.1 to 1.18.2
(#1884)**
- **build(deps): Bump google.golang.org/grpc from 1.60.0 to 1.60.1
(#1883)**
- **remove unused linters that produced a warning and ensure that
unparam is enabled (#1905)**
- **Fix HTTP response body not being closed after reading (#1945)**
- **Disable undesired linting code (#1959)**
- **Extend kvstore example add with with key types (#1876)**
- **Extra check in `VerifyExtension` (#1877)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.38.0 to 2.39.1
(#1882)**
- **perf(crypto/merkle, crypto/tmhash): simplify+optimize SHA256 hashing
of multiple byteslices (#1921)**
- **Update localnet-start Makefile (#1975)**
- **blocksync: wait for poolRoutine to stop in (*Reactor).OnStop
(#1879)**
- **fix TestListenerTimeoutReadWrite (#1947)**
- **docs: fix typos (#1988)**
- **this is the kindest commit I can think of. Take it that way and read
the code. (#1987)**
- **there's really no need for this anymore (#1986)**
- **feat: DefaultHttpClient support setting proxy from env (#1900)**
- **feat: lint tests (#1906)**
- **chore: fix typos (#1991)**
- **build(deps): Bump golang.org/x/sync from 0.5.0 to 0.6.0 (#1992)**
- **feat(proxy): export errors (#1899)**
- **doc:fix broken link in DOCKER/README.md (#1996)**
- **feat: custom dependencies order (#1994)**
- **PBTS: migrating to `main` the new version of the specification
(#1973)**
- **Fix paths to scripts/metricsgen in go:generate commands (#1998)**
- **chore: fix some typos (#2002)**
- **docs(light): fix broken link to spec (#2007)**
- **chore(test/loadtime): replace tm-load-test w/ cometbft-load-test
(#2009)**
- **ci: Remove unused `tests` target when compiling e2e (#2022)**
- **spec: fix typo in `encoding.md` (#2024)**
- **mempool: Fix data races in CListMempool's height and
notifiedTxsAvailable (#2021)**
- **chore(test/loadtime): cleanup go.sum and golangci.yml (#2025)**
- **build(deps): Bump github.com/prometheus/common from 0.45.0 to 0.46.0
(#2040)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.39.1 to 2.40.1
(#2038)**
- **feat(rpc): Use default port for HTTP(S) URLs when there is no
explicit port (#1903)**
- **misc(go.mod): remove unused peg dependency (#2044)**
- **config: Remove unused `max_batch_bytes` (#2050)**
- **Merge pull request from GHSA-qr8r-m495-7hc4**
- **misc(tools)!: remove `tools` package (#2046)**
- **docs(guides): add missing import (#2070)**
- **deps(localnode): bump alpine version (#2077)**
- **misc(Makefile): add `help` target to display the help msg (#2074)**
- **`e2e`: test vote extension activation via `InitChain` and
`FinalizeBlock` (#2066)**
- **scripts: metricsgen parses '// metrics:' pattern (#2090)**
- **e2e: Add `load_max_txs` option to manifest (#2094)**
- **consensus: Add `chain_size_bytes` metric (#2093)**
- **feat: conventional commits (#1995)**
- **Forward port of tendermint/tendermint#7605, tendermint/spec#393, and
tendermint/tendermint#8142 (#2018)**
- **ci: fix permissions for \"Conventional PR Title\" (#2099)**
- **PBTS: additions and fixes on migrated spec (#2013)**
- **PBTS: forward port of tendermint/tendermint#7709 (#2089)**
- **feat: use go workspace (#1924)**
- **fix: `ValidateUpdate`: allow no-change updates regardless of current
height (#2112)**
- **test(localnet): Add monitoring tools for localnet (#2108)**
- **feat: add gofumpt (#2049)**
- **feat(consensus): increase log level for corner case when prevoting a
proposal (#2042)**
- **docs: v1 - diataxis framework (#2105)**
- **feat(consensus): additional sanity checks for the size of proposed
blocks (#1408)**
- **perf(internal/blocksync): avoid double-calling
`types.BlockFromProto` (#2016)**
- **build(deps): Bump google.golang.org/grpc from 1.60.1 to 1.61.0
(#2178)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.1 to 1.29.0
(#2161)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.12.0 to
0.12.1 (#2160)**
- **build(deps): Bump slackapi/slack-github-action from 1.24.0 to 1.25.0
(#2162)**
- **build(deps): Bump github.com/google/uuid from 1.5.0 to 1.6.0
(#2176)**
- **refactor(privval): reverse conditional + more idiomatic Go code with
early returns (#2156)**
- **fix(e2e): path to latency script files in DO (#2148)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.9.1 to
0.10.0 (#2175)**
- **chore(Makefile): add `setup-pre-commit` target to init git hook
(#2123)**
- **feat: add pebbledb (https://github.com/cockroachdb/pebble) (#2132)**
- **perf(internal/blocksync): do not `ValidateBlock` twice (#2026)**
- **feat(e2e): Add new targets `fast` and `clean` to Makefile (#2192)**
- **ci: add `spec` type in conventional-pr-title (#2191)**
- **fix(privval): retry accepting a connection on errors (#2047)**
- **fix(.github/workflows): correct parameters to lint_pr_title
(#2199)**
- **docs: update QA method steps for qa-infra changes (#2198)**
- **feat!(pbts): forward port of tendermint/tendermint#7711 (#2149)**
- **docs(pbts): forward port of PBTS documentation and fixes (#2124)**
- **fix: if-return and early-return (#2215)**
- **chore: remove amazon linux Dockerfile and update
test/docker/Dockerfile (#2135)**
- **feat(ci): pre-commit framework (#2214)**
- **ci: add `merge` type for conventional-pr-title (#2219)**
- **spec(consensus/pbts): update description for introduced parameters.
(#2206)**
- **perf: optimize psql indexer (#2142)**
- **fix(go.mod): do not use `replace` for api (#2236)**
- **fix(Makefile): gofumpt no longer needed (#2235)**
- **fix(p2p/pex): gracefully shutdown `Reactor` (#2010)**
- **test(mempool): fix
TestMempoolUpdateDoesNotPanicWhenApplicationMissedTx (#2242)**
- **fix(flowrate): fix non-determinism in flowrate tests (#2147)**
- **refactor!: Implement RFC 106: remove `GetLatestBlock*` methods from
data companion API (#2240)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.3 to 1.3.7
(#2253)**
- **chore(config): update DB section in toml.go (#2249)**
- **fix(consensus): do not precommit nil if proposal block is received
(#2221)**
- **build(deps): Bump github.com/opencontainers/runc from 1.1.5 to
1.1.12 (#2261)**
- **fix(mempool/tests): Reduce tests duration (#2263)**
- **ci: run golangci-lint linters for all files (not only ones which
were modified) (#2250)**
- **refactor(examples): small changes to kvstore app (#2267)**
- **refactor(mempool): simplify parameters of resCbFirstTime and
resCbRecheck (#2272)**
- **perf(mempool/cache): clear map in Reset (#2259)**
- **test(abci): update e2e tests to check against ABCI 2.0 grammar
(#2201)**
- **docs: symbolic references to steps in the qa-infra README (#2280)**
- **chore: updated doc link (#2296)**
- **fix(consensus): prevote nil upon timeout when Proposal is missing
(#2218)**
- **build(deps): Bump pre-commit/action from 3.0.0 to 3.0.1 (#2307)**
- **build(deps): Bump golang.org/x/net from 0.20.0 to 0.21.0 (#2300)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.10.0 to
0.11.0 (#2299)**
- **docs: ADR-112 Proposer-Based Timestamps (#2223)**
- **refactor(internal/statesync): replace ticker with `time.After(X)`
(#2294)**
- **fix: simultaneous rpc test failures (#2150)**
- **chore(docs): alter the section about the effects of `timeout_commit`
(#1892)**
- **refactor(p2p)!: Refactor PeerSet to eliminate data races & improve
performance (#2246)**
- **feat(pbts): Update consensus params to include pbts enabled
(#2231)**
- **feat(storage/metrics): Metrics to measure storage (#1974)**
- **feat(e2e): Log number of sent txs (success and failed) (#2328)**
- **chore: enable gomoddirectives, unparam (#2290)**
- **docs: images not rendering properly in docs (#2331)**
- **docs: Fix references about DeliverTx (#2330)**
- **docs(qa): Add table of contents to existing QA reports (#2343)**
- **chore: enable perfsprint linter (#2291)**
- **feat(pruning): trigger explicitly compaction upon pruning (#1972)**
- **docs: explain how to skip pre-commit hook (#2358)**
- **build(deps): Bump github.com/prometheus/common from 0.46.0 to 0.47.0
(#2373)**
- **build(deps): Bump google.golang.org/grpc from 1.61.0 to 1.61.1
(#2372)**
- **feat(e2e): Option to set max block size in bytes at genesis
(#2362)**
- **build(deps): Bump github.com/prometheus/client_model from 0.5.0 to
0.6.0 (#2371)**
- **revert(pbts): revert removal of BFT Time related functions (#2205)**
- **fix(e2e): Reduce flakiness of TestGRPC_GetBlockResults (#2367)**
- **spec(consensus): update Block Time documentation in spec (#2316)**
- **spec: adaptive MSGDELAY parameter included in PBTS spec (#2318)**
- **feat(pbts): Moving VoteExtensionsEnableHeight from ABCIParams to
FeatureParams. (#2335)**
- **fix: remove TestMempoolFIFOWithParallelCheckTx (#2364)**
- **fix(docker-compose): fix subnet (#2383)**
- **feat(pbts): enable `e2e` manifest config to set `PbtsEnableHeight`
(#2284)**
- **perf(internal/state): avoid double-saving FinalizeBlockResponse
(#2017)**
- **build(deps): Bump fonttools from 4.37.4 to 4.43.0 in
/scripts/qa/reporting (#2407)**
- **build(deps): Bump pillow from 10.0.1 to 10.2.0 in
/scripts/qa/reporting (#2408)**
- **fix(node): Forward compaction config params to blockstore
constructor (#2418)**
- **refactor!: moved `MedianTime` out of `internal` folder (#2397)**
- **chore: typo fixes (#2403)**
- **chore(pbts): Removes useless code (#2420)**
- **build(deps): Bump github.com/prometheus/common from 0.47.0 to 0.48.0
(#2430)**
- **build(deps): Bump google.golang.org/grpc from 1.61.1 to 1.62.0
(#2429)**
- **test(consensus): PBTS should be enabled by default in test units
(#2329)**
- **test(consensus): test enabling PBTS at a given height (#2404)**
- **refactor(protobuf): switch from gogofaster to gocosmos generator
(#2425)**
- **docs(tutorials/install): add `From Go package` (#2414)**
- **docs(pbts): documentation for PBTS-related consensus parameters
(#2376)**
- **refactor(consensus): print err from SignAndCheckVote (#2346)**
- **feat(e2e): add parameter to set a custom output directory for
testnet files (#2433)**
- **spec(consensus): update description of consensus parameters for PBTS
(#2415)**
- **fix(localnet): Grafana dashboards for storage tests - removed
experimental metrics (#2448)**
- **fix(jsonrpc): enable HTTP basic auth in WS client (#2434)**
- **feat(pbts): Adds timestamp to the `msgInfo` written into the WAL
(#2388)**
- **fix: `Rollback`: wrong modification of
`state.LastHeightValidatorsChanged` while rollback at a special height
(#2136)**
- **docs(changelog): add missing entry for #2136 (#2459)**
- **fix(pbts): legacy `ABCIParams` values are properly translated to
`FeatureParams` values (#2462)**
- **fix(e2e): Fixing the bug in ABCI e2e tests (#2468)**
- **feat(localnet): Grafana PNG rendering for easier graph exports
(#2472)**
- **docs(README): remove Terra (#2469)**
- **docs: document PBTS adaptive delays mechanism (#2452)**
- **fix(config): Moved compact variables to the right section (#2477)**
- **feat(metrics): more buckets for ProposalTimestampDifference
(#2479)**
- **fix(metrics): more buckets for ProposalTimestampDifference (#2481)**
- **feat(pbts): Make synchrony params adaptive (#2431)**
- **ci: check metrics generation in CI checks (#2483)**
- **feat(consensus): improve logging for timely and untimely messages
(#2321)**
- **feat(types): improve Proposal and SynchronyParams validation tests
(#2489)**
- **test(consensus): refactor TestStateLock_POLSafety tests (#2492)**
- **feat(types): refactor types.AdaptiveSynchronyParams method (#2490)**
- **fix: lint errors introduced with the latest merge (#2495)**
- **build(deps): Bump docker/setup-buildx-action from 3.0.0 to 3.1.0
(#2500)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.18.0 to
1.19.0 (#2508)**
- **build(deps): Bump golang.org/x/crypto from 0.19.0 to 0.20.0
(#2507)**
- **build(deps): Bump github.com/prometheus/common from 0.48.0 to 0.49.0
(#2506)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.4 to 1.9.0
(#2505)**
- **fix(docs): include `timesync` daemon instructions (#2491)**
- **feat(privval)!: DO NOT require extension signature (#2496)**
- **refactor(privval): rename sign_extension to skip_sign_extension
(#2519)**
- **spec(abci): fixes the spec to inform about the presence of invalid
extensions in `last_commit` (#2423)**
- **fix(pbts): block Time must be Canonical (#2493)**
- **feat(e2e): Add manifest option `clock_skew` and corresponding
backend functionality (#2454)**
- **fix(mempool): converting to uint64 before additions to avoid
overflows (#2498)**
- **refactor!: Rename `skip_sign_extension` to `skip_extension_signing`
(#2522)**
- **docs(ADR): ADR-108 updated to account for the new changes in the
grammar and code. (#2528)**
- **feat(e2e): add generator support for clock skew + env variable
rename (#2488)**
- **spec(proto): add `cometbft.privval.v1beta2` proto package (#2529)**
- **chore: improving error handling in the PendingEvidence (#2550)**
- **feat(blocksync)!: set the max number of (concurrently) downloaded
blocks to {peersCount * 20} (#2467)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.29.0 to 1.30.0
(#2557)**
- **build(deps): Bump google.golang.org/protobuf from 1.32.0 to 1.33.0
(#2560)**
- **build(deps): Bump golang.org/x/net from 0.21.0 to 0.22.0 (#2562)**
- **fix(cmd/cometbft/commands/version): update the output for v1
(#2546)**
- **build(deps): Bump docker/build-push-action from 5.1.0 to 5.2.0
(#2558)**
- **build(deps): Bump github.com/prometheus/common from 0.49.0 to 0.50.0
(#2559)**
- **build(deps): Bump google.golang.org/grpc from 1.62.0 to 1.62.1
(#2563)**
- **build(deps): Bump golang.org/x/crypto from 0.20.0 to 0.21.0
(#2561)**
- **feat(blocksync): sort peers by download rate & multiple requests for
closer blocks (#2475)**
- **feat(pbts): Adjusts PBTS metrics buckets (#2578)**
- **fix(blocksync): use timer instead of time.After (#2584)**
- **fix: temporary fix for `api` dependency (#2589)**

---------

Signed-off-by: Thane Thomson <connect@thanethomson.com>
Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: Thane Thomson <connect@thanethomson.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
Co-authored-by: Mikhail Zabaluev <mikhail@informal.systems>
Co-authored-by: Troy Kessler <43882936+troykessler@users.noreply.github.com>
Co-authored-by: leven <112051166+lx-xiang@users.noreply.github.com>
Co-authored-by: werty144 <anton-paramonov2000@yandex.ru>
Co-authored-by: Adi Seredinschi <adizere@gmail.com>
Co-authored-by: Sukey <35202440+sukey2008@users.noreply.github.com>
Co-authored-by: Sergio Mena <sergio@informal.systems>
Co-authored-by: Jasmina Malicevic <jasmina.dustinac@gmail.com>
Co-authored-by: moriluka <85185077+moriluka@users.noreply.github.com>
Co-authored-by: ƒê·ªó Vi·ªát Ho√†ng <hoangdv2429@gmail.com>
Co-authored-by: alex <152680487+azukiboy@users.noreply.github.com>
Co-authored-by: Hern√°n Vanzetto <15466498+hvanz@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@informal.systems>
Co-authored-by: Andy Nogueira <me@andynogueira.dev>
Co-authored-by: nenadmilosevic95 <50905385+nenadmilosevic95@users.noreply.github.com>
Co-authored-by: nenadmilosevic95 <nenad@informal.systems>
Co-authored-by: Jacob Gadikian <jacobgadikian@gmail.com>
Co-authored-by: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Co-authored-by: Emmanuel T Odeke <emm.odeke@gmail.com>
Co-authored-by: jchappelow <140431406+jchappelow@users.noreply.github.com>
Co-authored-by: shuoer86 <129674997+shuoer86@users.noreply.github.com>
Co-authored-by: levisyin <150114626+levisyin@users.noreply.github.com>
Co-authored-by: vuittont60 <81072379+vuittont60@users.noreply.github.com>
Co-authored-by: Halimao <1065621723@qq.com>
Co-authored-by: alex <152680487+bodhi-crypo@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@usi.ch>
Co-authored-by: Josef Widder <44643235+josef-widder@users.noreply.github.com>
Co-authored-by: William Banfield <4561443+williambanfield@users.noreply.github.com>
Co-authored-by: Kukovec <jure.kukovec@gmail.com>
Co-authored-by: Daniel Cason <cason@gandria>
Co-authored-by: M. J. Fromberger <fromberger@interchain.io>
Co-authored-by: hattizai <150505746+hattizai@users.noreply.github.com>
Co-authored-by: Huulu <35667132+IssouChancla@users.noreply.github.com>
Co-authored-by: katelyn martin <me+cratelyn@katelyn.world>
Co-authored-by: Richard Gibson <richard.gibson@gmail.com>
Co-authored-by: Jean Deruelle <jean.deruelle@gmail.com>
Co-authored-by: glnro <8335464+glnro@users.noreply.github.com>
Co-authored-by: Greg Szabo <greg@philosobear.com>
Co-authored-by: Emmanuel T Odeke <emmanuel@orijtech.com>
Co-authored-by: levisyin <lilassherl@gmail.com>
Co-authored-by: k0marov <95040709+k0marov@users.noreply.github.com>
Co-authored-by: Adi Seredinschi <a@seredinschi.net>
Co-authored-by: Pan chao <152830401+Pan-chao@users.noreply.github.com>
Co-authored-by: Khanh Hoa <49144992+hoanguyenkh@users.noreply.github.com>
Co-authored-by: glnro <lauren@informal.systems>
Co-authored-by: toni <143221387+xyztoni@users.noreply.github.com>
Co-authored-by: DragonKid <idragonkid@gmail.com>
Co-authored-by: Matt Ketmo <matthieu@moquet.net>
Co-authored-by: Ethan <cosinlinker@gmail.com>
Co-authored-by: Evgeny Danilenko <6655321@bk.ru>
Co-authored-by: Duong Minh Ngoc <153509244+minhngoc274@users.noreply.github.com>
Co-authored-by: Kero <keroroxx520@gmail.com>") [(](/cometbft/cometbft/commit/e7dd0ab89fc3783d3de30f2c5fb892f9ca072ba2 "chore(spec): merge main into `spec/consensus-gossip` (#2594)

- **Versioned protobuf files (#495)**
- **Restore rpc/grpc/v1/types.pb.go**
- **proto: restore deprecation notice on BroadcastAPI**
- **Struct `Client` exposes sensitive data (#784)**
- **Unsafe int cast in `kill` command (#783)**
- **ADR-100: Data Companion Push API (#73)**
- **rfc: incoming txs while catching up (#735)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.17.0 to 1.18.0
(#804)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.8 to 1.4.9
(#806)**
- **build(deps): Bump golang.org/x/sync from 0.1.0 to 0.2.0 (#807)**
- **build(deps): Bump google.golang.org/grpc from 1.54.0 to 1.55.0
(#813)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.0 to
1.15.1 (#810)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/prometheus/client_model from 0.3.0 to
0.4.0 (#812)**
- **build(deps): Bump github.com/prometheus/common from 0.42.0 to 0.43.0
(#811)**
- **ADR-103: Protobuf definition versioning (#772)**
- **spec/p2p: Specify the operation of a Reactor (#714)**
- **build(deps): Bump github.com/docker/distribution (#827)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.1 to 1.3.3
(#828)**
- **ADR-103: Protobuf definition versioning (#772) (#817)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.9 to 1.4.10
(#830)**
- **build(deps): Bump golang.org/x/net from 0.9.0 to 0.10.0 (#831)**
- **build(deps): Bump golang.org/x/crypto from 0.8.0 to 0.9.0 (#832)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.26.1 to 2.27.1
(#833)**
- **rpc: Remove response data from response failure logs (#829)**
- **pubsub/kvindexer:support for big numbers - v2 (#797)**
- **Extend the infrastructure provider with `StartNodes` and
`StopTestnet` (#796)**
- **grpc: Add base gRPC server with version service (#818)**
- **Digital Ocean implementation of `StartNodes` and `StopTestnet`
(#846)**
- **RFC 102: Improve forward compatibility of proto-generated Rust
(#724)**
- **mempool: Add metric to measure how many times a tx was received
(#637)**
- **`e2e` provider is extended with `Disconnect`, `Reconnect` and
`CheckUpgraded` (#852)**
- **Sort `loadtime` tool's report (#854)**
- **feat: make handshake cancelable (#857)**
- **proto: Restore snake_case JSON for `ExecTxResult` (#856)**
- **qa: 200-nodes test on v0.38 (#877)**
- **qa: rotating node test on `v0.38.x` (#883)**
- **Changes to QA related files (e.g., `method.md`) (#878)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.18.0 to 1.19.0
(#868)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.2 to 1.8.3
(#873)**
- **build(deps): Bump github.com/bufbuild/buf from 1.18.0 to 1.19.0
(#872)**
- **Adds `vote_extension_size` to manifests (#858)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.27.1 to 2.28.1
(#893)**
- **build(deps): Bump github.com/prometheus/common from 0.43.0 to 0.44.0
(#892)**
- **build(deps): Bump slackapi/slack-github-action from 1.23.0 to 1.24.0
(#869)**
- **ADR 104: State sync from local application snapshot (#801)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.6.1 to 5.7.0
(#891)**
- **mempool: slight refactor for improving readability (#894)**
- **Add Vote Extension varying size testnet (#888)**
- **fix: lint fail when golangci-lint bump from v1.52.2 to v1.53.x
(#908)**
- **build(deps): Bump github.com/bufbuild/buf from 1.19.0 to 1.20.0
(#912)**
- **build(deps): Bump github.com/golangci/golangci-lint (#917)**
- **build(deps): Bump github.com/spf13/viper from 1.15.0 to 1.16.0
(#913)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.19.0 to 1.20.0
(#910)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.1 to 2.28.2
(#914)**
- **Minor fixes to `RELEASES.md` (#923)**
- **Prevent a transaction to appear twice in the mempool (#890)**
- **New metrics to track duplicate votes and block parts (#896) (#905)**
- **e2e tests are being skipped; `INFRASTRUCTURE-*` bug; portGen
inconsistency bug (#933)**
- **build(deps): Bump github.com/bufbuild/buf from 1.20.0 to 1.21.0
(#948)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.20.0 to 1.21.0
(#946)**
- **spec/p2p: document the p2p API used by Reactors (#851)**
- **build(deps): Bump docker/login-action from 2.1.0 to 2.2.0 (#944)**
- **e2e: Generate prometheus.yaml on setup (#954)**
- **Update the type annotations in the light client spec (#955)**
- **build(deps): Bump docker/build-push-action from 4.0.0 to 4.1.0
(#947)**
- **build(deps): Bump docker/setup-buildx-action from 2.5.0 to 2.7.0
(#962)**
- **Add requirement for `CheckTx` in ABCI spec (#928)**
- **fix: avoid recursive call after rename to (*PeerState).MarshalJSON
(#865)**
- **Port upstream proto changes to cometbft package**
- **changelog: Import entries for v0.34.28, v0.34.29, v0.37.1 and
v0.37.2 to `main` (#974)**
- **test/e2e: Fix Docker image build (#984)**
- **build(deps): Bump github.com/BurntSushi/toml from 1.3.0 to 1.3.2
(#952)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.2 to 2.29.0
(#953)**
- **Remove duplicate function `deterministicExecTxResult` (#986)**
- **mempool: Fix the benchmarks (#934)**
- **Add `CMT_HOME` (or remove it?) (#983)**
- **Remove buf.yaml at the root of the source tree (#979)**
- **build(deps): Bump docker/build-push-action from 4.1.0 to 4.1.1
(#989)**
- **build(deps): Bump golang.org/x/net from 0.10.0 to 0.11.0 (#994)**
- **build(deps): Bump golang.org/x/sync from 0.2.0 to 0.3.0 (#990)**
- **build(deps): Bump google.golang.org/grpc from 1.55.0 to 1.56.0
(#992)**
- **build(deps): Bump github.com/golangci/golangci-lint from 1.53.2 to
1.53.3 (#996)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.1 to
1.16.0 (#991)**
- **spec/p2p: new structure for the p2p specification (#966)**
- **consensus: optimize vote and block part gossip with
HasProposalBlockPartMessage and random sleeps (#904)**
- **Extend ABCI `max_block_size` parameter to give extended control to
the app (#1003)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.21.0 to 1.22.0
(#1026)**
- **Bump logs on non-fatal vote validation failures to Info level
(#1022)**
- **Update codeowners to include DevRel team (#1023)**
- **deps: Manually bump github.com/vektra/mockery/v2 from 2.29.0 to
2.30.1 (#1009)**
- **Update releasing.md to sign tags (#1034)**
- **build(deps): Bump github.com/bufbuild/buf from 1.21.0 to 1.22.0
(#1027)**
- **Rename ABCI enums and values to satisfy buf guidelines (#975)**
- **build(deps): Bump google.golang.org/grpc from 1.56.0 to 1.56.1
(#1028)**
- **docs: Added double quotes to /abci_query path param (#1015)**
- **Update Docs with Finalize Block (#760)**
- **Clarifies that processProposal may be called for set of transactions
different from the one returned in the preceding prepareProposal
(#1033)**
- **Update the annotation of part_set.go (#1056)**
- **build(deps): Bump docker/setup-buildx-action from 2.7.0 to 2.8.0
(#1071)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.1 to
2.30.16 (#1064)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.22.0 to 1.23.1
(#1072)**
- **build(deps): Bump github.com/bufbuild/buf from 1.22.0 to 1.23.1
(#1066)**
- **build(deps): Bump google.golang.org/protobuf from 1.30.0 to 1.31.0
(#1065)**
- **build(deps): Bump google.golang.org/grpc from 1.56.1 to 1.56.2
(#1101)**
- **build(deps): Bump golang.org/x/crypto from 0.10.0 to 0.11.0
(#1103)**
- **build(deps): Bump docker/setup-buildx-action from 2.8.0 to 2.9.0
(#1105)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.16 to
2.31.1 (#1100)**
- **build(deps): Bump golang.org/x/net from 0.11.0 to 0.12.0 (#1102)**
- **ci: Trigger workflows on merge group (#1118)**
- **Revert \"config: add bootstrap peers (#9680)\" (#1109)**
- **node: Revert removal of public reactor accessors (#1120)**
- **ci: Disable CodeQL check in merge queues (#1123)**
- **p2p: Remove UPnP functionality (#1114)**
- **ADR 107: Rename proto versions to pre-v1 betas (#1110)**
- **RFC 104: Internal messaging using the actor model (#1092)**
- **build(deps): Bump github.com/bufbuild/buf from 1.23.1 to 1.24.0
(#1131)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.31.1 to 2.32.0
(#1132)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.0 to 2.9.1
(#1133)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.23.1 to 1.24.0
(#1134)**
- **spec: Add mempool specification in English and Quint (#997)**
- **mempool: ADR for refactoring list of senders  (#1032)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.24.0 to 1.25.0
(#1157)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.7.0 to 5.8.0
(#1159)**
- **build(deps): Bump github.com/bufbuild/buf from 1.24.0 to 1.25.0
(#1160)**
- **proxy: Rename \"unsynchronized\" to \"connection-synchronized\" local
client creator (#1145)**
- **mempool: Keep track of senders in reactor instead of implementation
(#1010)**
- **cmd: Remove `replay` and `replay-console` subcommands (#1170)**
- **build(deps): Bump google.golang.org/grpc from 1.56.2 to 1.57.0
(#1181)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.0 to 5.8.1
(#1180)**
- **ci: Remove Mergify automerge (#1182)**
- **Add gRPC block service (#1142)**
- **blocksync: export errors (#1186)**
- **Porting changes related to creating a lean docker image from
`pierre/fast-prototyping-1059` branch. (#1192)**
- **chore: Format repo (#1193)**
- **Add BlockResults gRPC service (#1168)**
- **consensus: remove logic to unlock block on +2/3 prevote for nil
(#1175)**
- **ADR 101: Add GetLatest method to block service (#1209)**
- **ADR 101: Implement pruning mechanism (#1150)**
- **config: export errors (#1190)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.0 to 2.32.3
(#1218)**
- **Add check for non-`nil` in `enterCommit` (#1208)**
- **Log proposer's address when correctly accepting a proposal (#1079)**
- **Close evidence.db OnStop (#1210)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.0 to 1.25.1
(#1213)**
- **build(deps): Bump golang.org/x/crypto from 0.11.0 to 0.12.0
(#1215)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.0 to 1.25.1
(#1216)**
- **build(deps): Bump golang.org/x/net from 0.12.0 to 0.14.0 (#1217)**
- **Forward-port: update state to prevote `nil` when proposal block does
not match locked block (#1203)**
- **mempool: Store peer ids as p2p.ID instead of uint16 (remove
mempoolIDs) (#1191)**
- **ADR-101: implement gRPC `PruningService` (#1154)**
- **consensus: Avoid process proposal when we know correct nodes
validated it (#1231)**
- **ADR-101: Metrics to monitor the pruning  (#1234)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.1 to 1.26.0
(#1241)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.1 to 1.26.1
(#1239)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1240)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.3 to 2.32.4
(#1242)**
- **abci: export errors  (#1185)**
- **consensus: export errors (#1211)**
- **ADR-101: Pruning mechanism minor fixes (#1246)**
- **chore: Bump minimum Go version on `main` to v1.21 (#1244)**
- **ADR 101: Add `Close` method to gRPC client (#1251)**
- **ADR 108: ADR for extending E2E infrastructure so that we can check
CometBFT's behaviour with respect to ABCI++ grammar. (#902)**
- **docs: Add logging guide to contributing guidelines (#1250)**
- **chore: log `app_hash` as hex (#1264)**
- **update language (#1263)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.0 to 1.26.1
(#1272)**
- **build(deps): Bump gonum.org/v1/gonum from 0.13.0 to 0.14.0 (#1275)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.10 to 1.4.11
(#1276)**
- **ADR 101: Refactor height check-related logic and tests (#1271)**
- **Fixed linter**
- **Revert \"Fixed linter\"**
- **Fixed mem aliasing in for loop (#1280)**
- **Remove genesis persistence in state db (#1017)**
- **Revert \"Remove genesis persistence in state db (#1017)\" (#1294)**
- **evidence: export errors (#1284)**
- **Re-implement removal of genesis persistence in state db (#1295)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.1 to 2.10.0
(#1298)**
- **node: verify genesis doc hash against the file contents rather than
remarshalled JSON (#1293)**
- **indexer: Implement pruning mechanism (#1176)**
- **Provide relevant block data in `ExtendVote` (#1270)**
- **node/state:bootstrap state api (#1057)**
- **build(deps): Bump actions/checkout from 3 to 4 (#1319)**
- **build(deps): Bump docker/build-push-action from 4.1.1 to 4.2.1
(#1318)**
- **Fix (#1323)**
- **state: remove genesis file from database  (#1297)**
- **Added changelog for pruning metrics (#1335)**
- **Removed begin_block_events and end_block_events from rpc doc
(#1338)**
- **consensus: test for precommit/locking corner case (#1257)**
- **TxIndexer and BlockIndexer pruning metrics (#1334)**
- **Forward port changes to changelog and `UPGRADING.md` for release
`v0.38.0` (#1341)**
- **Update Go version specified in root README on main for v0.34.x
(#1352)**
- **Add test/e2e/data to gitignore (#1349)**
- **docs: gRPC services and data companion pruning services (#1307)**
- **Add genesis_hash flag check on node startup (#1324)**
- **gRPC for Tx and Block indexer pruning (#1327)**
- **build(deps): Bump docker/build-push-action from 4.2.1 to 5.0.0
(#1371)**
- **build(deps): Bump docker/setup-buildx-action from 2.10.0 to 3.0.0
(#1370)**
- **build(deps): Bump docker/login-action from 2.2.0 to 3.0.0 (#1368)**
- **build(deps): Bump goreleaser/goreleaser-action from 4 to 5 (#1369)**
- **ADR101: Moved changelog entries (#1377)**
- **Max byte check (#1384)**
- **Update to string (#1385)**
- **mempool: Remove unused peerID constants (#1379)**
- **build(deps): Bump github.com/google/uuid from 1.3.0 to 1.3.1
(#1392)**
- **build(deps): Bump github.com/rs/cors from 1.9.0 to 1.10.0 (#1393)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.1 to 5.9.0
(#1396)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.4 to 2.34.0
(#1400)**
- **build(deps): Bump github.com/go-kit/kit from 0.12.0 to 0.13.0
(#1397)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1398)**
- **build(deps): Bump google.golang.org/grpc from 1.57.0 to 1.58.2
(#1399)**
- **doc: improve documentation of BlockParams.MaxBytes (#1405)**
- **rpc: Improve abci_query parameter documentation (#1184)**
- **Bump p2p version following introduction of
`HasProposalBlockPartMessage` (#1411)**
- **RFC: Allowing Non-Determinism in `ProcessProposal` (#1391)**
- **ADR-101: Data Companion Pull API (#82)**
- **build(deps): Bump github.com/rs/cors from 1.10.0 to 1.10.1 (#1418)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.0 to 2.34.2
(#1416)**
- **build(deps): Bump github.com/prometheus/client_golang (#1417)**
- **fix typos (#1413)**
- **Renames Tendermint to CometBFT in the RPC related test code
(#1428)**
- **Renames Tendermint to CometBFT in the RPC related test code. This
file was missing and it was not caught in the branch testing. (#1433)**
- **Reject incoming txs while node is catching up (#1119)**
- **build(deps): Bump golang.org/x/crypto from 0.13.0 to 0.14.0
(#1458)**
- **build(deps): Bump golang.org/x/sync from 0.3.0 to 0.4.0 (#1454)**
- **build(deps): Bump golang.org/x/net from 0.15.0 to 0.16.0 (#1453)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.1 to 1.27.0
(#1449)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.11.0 to
0.12.0 (#1450)**
- **build(deps): Bump github.com/prometheus/client_model (#1455)**
- **build(deps): Bump github.com/bufbuild/buf from 1.26.1 to 1.27.0
(#1459)**
- **build(deps): Bump github.com/spf13/viper from 1.16.0 to 1.17.0
(#1456)**
- **test: respect P2PConfig fuzzing configuration in MultiplexTransport
(#1414)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.2 to 2.35.3
(#1462)**
- **crypto: export errors (#1463)**
- **Do not race with pruning to validate headers and validators
(#1467)**
- **fix typos (#1487)**
- **Call observer only when retain height changes (#1490)**
- **build(deps): Bump pillow from 9.3.0 to 10.0.1 in
/scripts/qa/reporting (#1493)**
- **abci: Add relaxed local client synchronization models (#1141)**
- **docs: fix typos (#1500)**
- **Post-merge fixes for feature/proto-upgrade**
- **Make BuildLastCommitInfo and BuildExtendedCommitInfo public
(#1502)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.3 to 2.35.4
(#1497)**
- **build(deps): Bump google.golang.org/grpc from 1.58.2 to 1.58.3
(#1498)**
- **build(deps): Bump golang.org/x/net from 0.16.0 to 0.17.0 (#1499)**
- **tiny change: reorder expected and actual values (#1506)**
- **Fixed docker port alias (#1507)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.0 to 1.27.1
(#1527)**
- **Implement ADR-107: rename proto package version suffixes to v1beta*
pattern (#1510)**
- **e2e: Fix flakiness in grpc tests due to pruning (#1492)**
- **fix spelling of bandwidth (#1534)**
- **Fix linting on `main` (#1531)**
- **build(deps): Bump github.com/prometheus/common from 0.44.0 to 0.45.0
(#1524)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.0 to 1.27.1
(#1522)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1540)**
- **fix some typos (#1541)**
- **indexer-respect-height-params-on-query (#1529)**
- **Correct go_package paths in service proto files (#1538)**
- **build(deps): Bump google.golang.org/grpc from 1.58.3 to 1.59.0
(#1521)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.4 to 2.36.0
(#1523)**
- **feat(mempool): export error (#1427)**
- **Rename proto messages and services to satisfy default buf lints
(#1533)**
- **RFC 106: non-idempotent methods in data companion (#1545)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.0
(#1550)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.1 to 1.27.2
(#1551)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1552)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.1 to 1.27.2
(#1553)**
- **use assert.Greater instead of Equal for better error reporting
(#1547)**
- **rpc: Version the RPC APIs (#1412)**
- **mempool: Add metric size of pool in bytes (#1512)**
- **build(deps): Bump github.com/docker/docker (#1570)**
- **build(deps): Bump github.com/spf13/cobra from 1.7.0 to 1.8.0
(#1572)**
- **build(deps): Bump golang.org/x/sync from 0.4.0 to 0.5.0 (#1574)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.0 to 2.36.1
(#1576)**
- **build(deps): Bump github.com/gorilla/websocket from 1.5.0 to 1.5.1
(#1575)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1573)**
- **chore: consolidate changelog improvements section (#1578)**
- **Implementation of ADR-108 (#930)**
- **Reduce the default MaxBytes to 4mb and increase MaxGas to 10 million
(#1518)**
- **e2e: Allow disabling the PEX reactor on all nodes in the testnet
(#1580)**
- **Experimental - Reduce # of connections effectively used to gossip
transactions out (#1558)**
- **Update proto file references to follow renaming/versioning (#1555)**
- **Make `LoadBlock` also return block metadata (#1557)**
- **mempool: Limit gossip connections to persistent and non-persistent
peers (experimental) (#1584)**
- **fix: docs: default db provider moved from node to config (#1588)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.2 to 1.28.0
(#1598)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.2 to 1.28.0
(#1602)**
- **build(deps): Bump golang.org/x/crypto from 0.14.0 to 0.15.0
(#1599)**
- **build(deps): Bump golang.org/x/net from 0.17.0 to 0.18.0 (#1597)**
- **RFC 107: Internal signalling using event observers (#1164)**
- **ADR 110: Remote mempool (#1565)**
- **chore: aligns function descriptions with godoc standards in the
types package (#1593)**
- **docs: various improvements (#1603)**
- **chore: Merge branch main into feature/proto-upgrade (#1612)**
- **Removes wrong assertion and decreases likelyhood of block from the
future has actually been already created (#1619)**
- **Split /api off to separate go.mod (#1608)**
- **feature: Reduce Go API surface area (ADR 109) (#1605)**
- **refactor: Export func MakeHTTPDialer (#1594)**
- **First draft (#1483)**
- **pruning:do not attempt to prune state if no blocks are pruned
(#1616)**
- **Update SECURITY.md (#1626)**
- **Update changelog on `main` with new releases (#1644)**
- **proto: Update README (#1648)**
- **ADR 111: `nop` Mempool (#1585)**
- **ADR-111: Addressed Ethan's comment (#1667)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.1 to 2.37.1
(#1662)**
- **build(deps): Bump docker/build-push-action from 5.0.0 to 5.1.0
(#1664)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.0 to 1.28.1
(#1665)**
- **ci: Fix v0.34 nightly build (#1655)**
- **build(deps): Bump github.com/bufbuild/buf from 1.28.0 to 1.28.1
(#1663)**
- **feature/proto-upgrade: Fix generated mock code (#1673)**
- **Update link in README.md (#1674)**
- **Renames the semantic versioning variable to CMT (#1621)**
- **mempool: add `nop` mempool (#1643)**
- **e2e:fix-digital-ocean-ports (#1678)**
- **Revert modularization of the test infra (#1488) (#1676)**
- **docs: various small improvements (part 2) (#1683)**
- **Do not block indefinitely on the semaphore (#1654)**
- **Adds tests that check for FIFO ordering being broken by gossip
(#1628)**
- **loadtime: Add parameter for displaying results in one line (#1511)**
- **Promote latest versions of Protobuf definitions to v1 packages
(#1677)**
- **chore: Update CHANGELOG.md (#1701)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1696)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.37.1 to 2.38.0
(#1697)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.1
(#1702)**
- **proto: document the `cometbft.*` versioned protos (#1694)**
- **Clean up changelog entries and README files for versioned proto
changes (#1707)**
- **chore(proto): add missing docs (#1703)**
- **feature/proto-upgrade: Last-minute fixes (#1709)**
- **e2e: Support emulated latencies between docker images (#1560)**
- **build(deps): Bump golang.org/x/net from 0.14.0 to 0.17.0 in /api
(#1713)**
- **Prepare `main` for `v1.x` backport branch (#1714)**
- **build(deps): Bump golang.org/x/crypto from 0.15.0 to 0.16.0
(#1720)**
- **build(deps): Bump golang.org/x/net from 0.18.0 to 0.19.0 (#1719)**
- **types: validate Validator#Address field (#1715)**
- **Enable Mergify backports for `v1.x` branch (#1724)**
- **deps: Bump cometbft-db to v0.9.0 (#1725)**
- **buf improvements prior to publishing on BSR (#1726)**
- **proto: give our buf module a name (#1734)**
- **deps: Bump cometbft-db to v0.9.1 (#1737)**
- **chore: Update root docs (#1740)**
- **fix: increase abci socket message size limit to 2GB (#1730)**
- **proto: make comment in README more Markdowny (#1743)**
- **fix: Txs Validate (#1687)**
- **Add test missing in #1687 (#1712)**
- **perf(state): batch save `State` (#1735)**
- **Update CODE_OF_CONDUCT.md (#1708)**
- **[e2e] Fixes prepareProposal not to return oversized set of
transactions (#1756)**
- **perf(store): Batch save `Block` (#1755)**
- **Fix: Fix minor typos (#1780)**
- **`VerifyCommitLight` and `VerifyCommitLightTrusting` _never_ check
all signatures (#1750)**
- **Fix typo in encoding.md (#1801)**
- **chore(docs): small improvements (#1781)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.10.1 to 5.11.0
(#1797)**
- **build(deps): Bump actions/setup-go from 4 to 5 (#1794)**
- **build(deps): Bump actions/stale from 8 to 9 (#1795)**
- **build(deps): Bump github.com/spf13/viper from 1.17.0 to 1.18.1
(#1796)**
- **Chore/fix other typos (#1809)**
- **chore(spec): specify which fields must be deterministic (#1804)**
- **Small improvements in #1806 not present in #1750 (#1808)**
- **Add changelog for #1749 (#1807)**
- **e2e: Implement latency emulation for DigitalOcean (#1587)**
- **add GH workflow for linting code using codespell (#1824)**
- **chore(docs): explain the effect of `timeout_propose` (#1798)**
- **build(deps): Bump actions/upload-artifact from 3 to 4 (#1845)**
- **build(deps): Bump actions/setup-python from 2 to 5 (#1843)**
- **build(deps): Bump github/codeql-action from 2 to 3 (#1847)**
- **build(deps): Bump actions/checkout from 2 to 4 (#1846)**
- **build(deps): Bump github.com/google/uuid from 1.4.0 to 1.5.0
(#1850)**
- **build(deps): Bump google.golang.org/grpc from 1.59.0 to 1.60.0
(#1851)**
- **golangci-lint: enable all the linters by default (#1838)**
- **Updates go crypto package to v0.17.0 (#1859)**
- **Adds checks for nil keys and signatures (#1855)**
- **The store DB and the companion `BlockStore` struct are sometimes out
of sync (#1856)**
- **Allow blocksync to not verify all signatures (#1858)**
- **Fixing the ABCI grammar and updating the code for e2e tests to
account for the new grammar. (#1829)**
- **docs: Fix Discord links in README (#1874)**
- **build(deps): Bump github.com/prometheus/client_golang (#1909)**
- **build(deps): Bump github.com/btcsuite/btcd/btcutil from 1.1.3 to
1.1.5 (#1908)**
- **build(deps): Bump google.golang.org/protobuf (#1885)**
- **build(deps): Bump github.com/spf13/viper from 1.18.1 to 1.18.2
(#1884)**
- **build(deps): Bump google.golang.org/grpc from 1.60.0 to 1.60.1
(#1883)**
- **remove unused linters that produced a warning and ensure that
unparam is enabled (#1905)**
- **Fix HTTP response body not being closed after reading (#1945)**
- **Disable undesired linting code (#1959)**
- **Extend kvstore example add with with key types (#1876)**
- **Extra check in `VerifyExtension` (#1877)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.38.0 to 2.39.1
(#1882)**
- **perf(crypto/merkle, crypto/tmhash): simplify+optimize SHA256 hashing
of multiple byteslices (#1921)**
- **Update localnet-start Makefile (#1975)**
- **blocksync: wait for poolRoutine to stop in (*Reactor).OnStop
(#1879)**
- **fix TestListenerTimeoutReadWrite (#1947)**
- **docs: fix typos (#1988)**
- **this is the kindest commit I can think of. Take it that way and read
the code. (#1987)**
- **there's really no need for this anymore (#1986)**
- **feat: DefaultHttpClient support setting proxy from env (#1900)**
- **feat: lint tests (#1906)**
- **chore: fix typos (#1991)**
- **build(deps): Bump golang.org/x/sync from 0.5.0 to 0.6.0 (#1992)**
- **feat(proxy): export errors (#1899)**
- **doc:fix broken link in DOCKER/README.md (#1996)**
- **feat: custom dependencies order (#1994)**
- **PBTS: migrating to `main` the new version of the specification
(#1973)**
- **Fix paths to scripts/metricsgen in go:generate commands (#1998)**
- **chore: fix some typos (#2002)**
- **docs(light): fix broken link to spec (#2007)**
- **chore(test/loadtime): replace tm-load-test w/ cometbft-load-test
(#2009)**
- **ci: Remove unused `tests` target when compiling e2e (#2022)**
- **spec: fix typo in `encoding.md` (#2024)**
- **mempool: Fix data races in CListMempool's height and
notifiedTxsAvailable (#2021)**
- **chore(test/loadtime): cleanup go.sum and golangci.yml (#2025)**
- **build(deps): Bump github.com/prometheus/common from 0.45.0 to 0.46.0
(#2040)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.39.1 to 2.40.1
(#2038)**
- **feat(rpc): Use default port for HTTP(S) URLs when there is no
explicit port (#1903)**
- **misc(go.mod): remove unused peg dependency (#2044)**
- **config: Remove unused `max_batch_bytes` (#2050)**
- **Merge pull request from GHSA-qr8r-m495-7hc4**
- **misc(tools)!: remove `tools` package (#2046)**
- **docs(guides): add missing import (#2070)**
- **deps(localnode): bump alpine version (#2077)**
- **misc(Makefile): add `help` target to display the help msg (#2074)**
- **`e2e`: test vote extension activation via `InitChain` and
`FinalizeBlock` (#2066)**
- **scripts: metricsgen parses '// metrics:' pattern (#2090)**
- **e2e: Add `load_max_txs` option to manifest (#2094)**
- **consensus: Add `chain_size_bytes` metric (#2093)**
- **feat: conventional commits (#1995)**
- **Forward port of tendermint/tendermint#7605, tendermint/spec#393, and
tendermint/tendermint#8142 (#2018)**
- **ci: fix permissions for \"Conventional PR Title\" (#2099)**
- **PBTS: additions and fixes on migrated spec (#2013)**
- **PBTS: forward port of tendermint/tendermint#7709 (#2089)**
- **feat: use go workspace (#1924)**
- **fix: `ValidateUpdate`: allow no-change updates regardless of current
height (#2112)**
- **test(localnet): Add monitoring tools for localnet (#2108)**
- **feat: add gofumpt (#2049)**
- **feat(consensus): increase log level for corner case when prevoting a
proposal (#2042)**
- **docs: v1 - diataxis framework (#2105)**
- **feat(consensus): additional sanity checks for the size of proposed
blocks (#1408)**
- **perf(internal/blocksync): avoid double-calling
`types.BlockFromProto` (#2016)**
- **build(deps): Bump google.golang.org/grpc from 1.60.1 to 1.61.0
(#2178)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.1 to 1.29.0
(#2161)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.12.0 to
0.12.1 (#2160)**
- **build(deps): Bump slackapi/slack-github-action from 1.24.0 to 1.25.0
(#2162)**
- **build(deps): Bump github.com/google/uuid from 1.5.0 to 1.6.0
(#2176)**
- **refactor(privval): reverse conditional + more idiomatic Go code with
early returns (#2156)**
- **fix(e2e): path to latency script files in DO (#2148)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.9.1 to
0.10.0 (#2175)**
- **chore(Makefile): add `setup-pre-commit` target to init git hook
(#2123)**
- **feat: add pebbledb (https://github.com/cockroachdb/pebble) (#2132)**
- **perf(internal/blocksync): do not `ValidateBlock` twice (#2026)**
- **feat(e2e): Add new targets `fast` and `clean` to Makefile (#2192)**
- **ci: add `spec` type in conventional-pr-title (#2191)**
- **fix(privval): retry accepting a connection on errors (#2047)**
- **fix(.github/workflows): correct parameters to lint_pr_title
(#2199)**
- **docs: update QA method steps for qa-infra changes (#2198)**
- **feat!(pbts): forward port of tendermint/tendermint#7711 (#2149)**
- **docs(pbts): forward port of PBTS documentation and fixes (#2124)**
- **fix: if-return and early-return (#2215)**
- **chore: remove amazon linux Dockerfile and update
test/docker/Dockerfile (#2135)**
- **feat(ci): pre-commit framework (#2214)**
- **ci: add `merge` type for conventional-pr-title (#2219)**
- **spec(consensus/pbts): update description for introduced parameters.
(#2206)**
- **perf: optimize psql indexer (#2142)**
- **fix(go.mod): do not use `replace` for api (#2236)**
- **fix(Makefile): gofumpt no longer needed (#2235)**
- **fix(p2p/pex): gracefully shutdown `Reactor` (#2010)**
- **test(mempool): fix
TestMempoolUpdateDoesNotPanicWhenApplicationMissedTx (#2242)**
- **fix(flowrate): fix non-determinism in flowrate tests (#2147)**
- **refactor!: Implement RFC 106: remove `GetLatestBlock*` methods from
data companion API (#2240)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.3 to 1.3.7
(#2253)**
- **chore(config): update DB section in toml.go (#2249)**
- **fix(consensus): do not precommit nil if proposal block is received
(#2221)**
- **build(deps): Bump github.com/opencontainers/runc from 1.1.5 to
1.1.12 (#2261)**
- **fix(mempool/tests): Reduce tests duration (#2263)**
- **ci: run golangci-lint linters for all files (not only ones which
were modified) (#2250)**
- **refactor(examples): small changes to kvstore app (#2267)**
- **refactor(mempool): simplify parameters of resCbFirstTime and
resCbRecheck (#2272)**
- **perf(mempool/cache): clear map in Reset (#2259)**
- **test(abci): update e2e tests to check against ABCI 2.0 grammar
(#2201)**
- **docs: symbolic references to steps in the qa-infra README (#2280)**
- **chore: updated doc link (#2296)**
- **fix(consensus): prevote nil upon timeout when Proposal is missing
(#2218)**
- **build(deps): Bump pre-commit/action from 3.0.0 to 3.0.1 (#2307)**
- **build(deps): Bump golang.org/x/net from 0.20.0 to 0.21.0 (#2300)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.10.0 to
0.11.0 (#2299)**
- **docs: ADR-112 Proposer-Based Timestamps (#2223)**
- **refactor(internal/statesync): replace ticker with `time.After(X)`
(#2294)**
- **fix: simultaneous rpc test failures (#2150)**
- **chore(docs): alter the section about the effects of `timeout_commit`
(#1892)**
- **refactor(p2p)!: Refactor PeerSet to eliminate data races & improve
performance (#2246)**
- **feat(pbts): Update consensus params to include pbts enabled
(#2231)**
- **feat(storage/metrics): Metrics to measure storage (#1974)**
- **feat(e2e): Log number of sent txs (success and failed) (#2328)**
- **chore: enable gomoddirectives, unparam (#2290)**
- **docs: images not rendering properly in docs (#2331)**
- **docs: Fix references about DeliverTx (#2330)**
- **docs(qa): Add table of contents to existing QA reports (#2343)**
- **chore: enable perfsprint linter (#2291)**
- **feat(pruning): trigger explicitly compaction upon pruning (#1972)**
- **docs: explain how to skip pre-commit hook (#2358)**
- **build(deps): Bump github.com/prometheus/common from 0.46.0 to 0.47.0
(#2373)**
- **build(deps): Bump google.golang.org/grpc from 1.61.0 to 1.61.1
(#2372)**
- **feat(e2e): Option to set max block size in bytes at genesis
(#2362)**
- **build(deps): Bump github.com/prometheus/client_model from 0.5.0 to
0.6.0 (#2371)**
- **revert(pbts): revert removal of BFT Time related functions (#2205)**
- **fix(e2e): Reduce flakiness of TestGRPC_GetBlockResults (#2367)**
- **spec(consensus): update Block Time documentation in spec (#2316)**
- **spec: adaptive MSGDELAY parameter included in PBTS spec (#2318)**
- **feat(pbts): Moving VoteExtensionsEnableHeight from ABCIParams to
FeatureParams. (#2335)**
- **fix: remove TestMempoolFIFOWithParallelCheckTx (#2364)**
- **fix(docker-compose): fix subnet (#2383)**
- **feat(pbts): enable `e2e` manifest config to set `PbtsEnableHeight`
(#2284)**
- **perf(internal/state): avoid double-saving FinalizeBlockResponse
(#2017)**
- **build(deps): Bump fonttools from 4.37.4 to 4.43.0 in
/scripts/qa/reporting (#2407)**
- **build(deps): Bump pillow from 10.0.1 to 10.2.0 in
/scripts/qa/reporting (#2408)**
- **fix(node): Forward compaction config params to blockstore
constructor (#2418)**
- **refactor!: moved `MedianTime` out of `internal` folder (#2397)**
- **chore: typo fixes (#2403)**
- **chore(pbts): Removes useless code (#2420)**
- **build(deps): Bump github.com/prometheus/common from 0.47.0 to 0.48.0
(#2430)**
- **build(deps): Bump google.golang.org/grpc from 1.61.1 to 1.62.0
(#2429)**
- **test(consensus): PBTS should be enabled by default in test units
(#2329)**
- **test(consensus): test enabling PBTS at a given height (#2404)**
- **refactor(protobuf): switch from gogofaster to gocosmos generator
(#2425)**
- **docs(tutorials/install): add `From Go package` (#2414)**
- **docs(pbts): documentation for PBTS-related consensus parameters
(#2376)**
- **refactor(consensus): print err from SignAndCheckVote (#2346)**
- **feat(e2e): add parameter to set a custom output directory for
testnet files (#2433)**
- **spec(consensus): update description of consensus parameters for PBTS
(#2415)**
- **fix(localnet): Grafana dashboards for storage tests - removed
experimental metrics (#2448)**
- **fix(jsonrpc): enable HTTP basic auth in WS client (#2434)**
- **feat(pbts): Adds timestamp to the `msgInfo` written into the WAL
(#2388)**
- **fix: `Rollback`: wrong modification of
`state.LastHeightValidatorsChanged` while rollback at a special height
(#2136)**
- **docs(changelog): add missing entry for #2136 (#2459)**
- **fix(pbts): legacy `ABCIParams` values are properly translated to
`FeatureParams` values (#2462)**
- **fix(e2e): Fixing the bug in ABCI e2e tests (#2468)**
- **feat(localnet): Grafana PNG rendering for easier graph exports
(#2472)**
- **docs(README): remove Terra (#2469)**
- **docs: document PBTS adaptive delays mechanism (#2452)**
- **fix(config): Moved compact variables to the right section (#2477)**
- **feat(metrics): more buckets for ProposalTimestampDifference
(#2479)**
- **fix(metrics): more buckets for ProposalTimestampDifference (#2481)**
- **feat(pbts): Make synchrony params adaptive (#2431)**
- **ci: check metrics generation in CI checks (#2483)**
- **feat(consensus): improve logging for timely and untimely messages
(#2321)**
- **feat(types): improve Proposal and SynchronyParams validation tests
(#2489)**
- **test(consensus): refactor TestStateLock_POLSafety tests (#2492)**
- **feat(types): refactor types.AdaptiveSynchronyParams method (#2490)**
- **fix: lint errors introduced with the latest merge (#2495)**
- **build(deps): Bump docker/setup-buildx-action from 3.0.0 to 3.1.0
(#2500)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.18.0 to
1.19.0 (#2508)**
- **build(deps): Bump golang.org/x/crypto from 0.19.0 to 0.20.0
(#2507)**
- **build(deps): Bump github.com/prometheus/common from 0.48.0 to 0.49.0
(#2506)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.4 to 1.9.0
(#2505)**
- **fix(docs): include `timesync` daemon instructions (#2491)**
- **feat(privval)!: DO NOT require extension signature (#2496)**
- **refactor(privval): rename sign_extension to skip_sign_extension
(#2519)**
- **spec(abci): fixes the spec to inform about the presence of invalid
extensions in `last_commit` (#2423)**
- **fix(pbts): block Time must be Canonical (#2493)**
- **feat(e2e): Add manifest option `clock_skew` and corresponding
backend functionality (#2454)**
- **fix(mempool): converting to uint64 before additions to avoid
overflows (#2498)**
- **refactor!: Rename `skip_sign_extension` to `skip_extension_signing`
(#2522)**
- **docs(ADR): ADR-108 updated to account for the new changes in the
grammar and code. (#2528)**
- **feat(e2e): add generator support for clock skew + env variable
rename (#2488)**
- **spec(proto): add `cometbft.privval.v1beta2` proto package (#2529)**
- **chore: improving error handling in the PendingEvidence (#2550)**
- **feat(blocksync)!: set the max number of (concurrently) downloaded
blocks to {peersCount * 20} (#2467)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.29.0 to 1.30.0
(#2557)**
- **build(deps): Bump google.golang.org/protobuf from 1.32.0 to 1.33.0
(#2560)**
- **build(deps): Bump golang.org/x/net from 0.21.0 to 0.22.0 (#2562)**
- **fix(cmd/cometbft/commands/version): update the output for v1
(#2546)**
- **build(deps): Bump docker/build-push-action from 5.1.0 to 5.2.0
(#2558)**
- **build(deps): Bump github.com/prometheus/common from 0.49.0 to 0.50.0
(#2559)**
- **build(deps): Bump google.golang.org/grpc from 1.62.0 to 1.62.1
(#2563)**
- **build(deps): Bump golang.org/x/crypto from 0.20.0 to 0.21.0
(#2561)**
- **feat(blocksync): sort peers by download rate & multiple requests for
closer blocks (#2475)**
- **feat(pbts): Adjusts PBTS metrics buckets (#2578)**
- **fix(blocksync): use timer instead of time.After (#2584)**
- **fix: temporary fix for `api` dependency (#2589)**

---------

Signed-off-by: Thane Thomson <connect@thanethomson.com>
Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: Thane Thomson <connect@thanethomson.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
Co-authored-by: Mikhail Zabaluev <mikhail@informal.systems>
Co-authored-by: Troy Kessler <43882936+troykessler@users.noreply.github.com>
Co-authored-by: leven <112051166+lx-xiang@users.noreply.github.com>
Co-authored-by: werty144 <anton-paramonov2000@yandex.ru>
Co-authored-by: Adi Seredinschi <adizere@gmail.com>
Co-authored-by: Sukey <35202440+sukey2008@users.noreply.github.com>
Co-authored-by: Sergio Mena <sergio@informal.systems>
Co-authored-by: Jasmina Malicevic <jasmina.dustinac@gmail.com>
Co-authored-by: moriluka <85185077+moriluka@users.noreply.github.com>
Co-authored-by: ƒê·ªó Vi·ªát Ho√†ng <hoangdv2429@gmail.com>
Co-authored-by: alex <152680487+azukiboy@users.noreply.github.com>
Co-authored-by: Hern√°n Vanzetto <15466498+hvanz@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@informal.systems>
Co-authored-by: Andy Nogueira <me@andynogueira.dev>
Co-authored-by: nenadmilosevic95 <50905385+nenadmilosevic95@users.noreply.github.com>
Co-authored-by: nenadmilosevic95 <nenad@informal.systems>
Co-authored-by: Jacob Gadikian <jacobgadikian@gmail.com>
Co-authored-by: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Co-authored-by: Emmanuel T Odeke <emm.odeke@gmail.com>
Co-authored-by: jchappelow <140431406+jchappelow@users.noreply.github.com>
Co-authored-by: shuoer86 <129674997+shuoer86@users.noreply.github.com>
Co-authored-by: levisyin <150114626+levisyin@users.noreply.github.com>
Co-authored-by: vuittont60 <81072379+vuittont60@users.noreply.github.com>
Co-authored-by: Halimao <1065621723@qq.com>
Co-authored-by: alex <152680487+bodhi-crypo@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@usi.ch>
Co-authored-by: Josef Widder <44643235+josef-widder@users.noreply.github.com>
Co-authored-by: William Banfield <4561443+williambanfield@users.noreply.github.com>
Co-authored-by: Kukovec <jure.kukovec@gmail.com>
Co-authored-by: Daniel Cason <cason@gandria>
Co-authored-by: M. J. Fromberger <fromberger@interchain.io>
Co-authored-by: hattizai <150505746+hattizai@users.noreply.github.com>
Co-authored-by: Huulu <35667132+IssouChancla@users.noreply.github.com>
Co-authored-by: katelyn martin <me+cratelyn@katelyn.world>
Co-authored-by: Richard Gibson <richard.gibson@gmail.com>
Co-authored-by: Jean Deruelle <jean.deruelle@gmail.com>
Co-authored-by: glnro <8335464+glnro@users.noreply.github.com>
Co-authored-by: Greg Szabo <greg@philosobear.com>
Co-authored-by: Emmanuel T Odeke <emmanuel@orijtech.com>
Co-authored-by: levisyin <lilassherl@gmail.com>
Co-authored-by: k0marov <95040709+k0marov@users.noreply.github.com>
Co-authored-by: Adi Seredinschi <a@seredinschi.net>
Co-authored-by: Pan chao <152830401+Pan-chao@users.noreply.github.com>
Co-authored-by: Khanh Hoa <49144992+hoanguyenkh@users.noreply.github.com>
Co-authored-by: glnro <lauren@informal.systems>
Co-authored-by: toni <143221387+xyztoni@users.noreply.github.com>
Co-authored-by: DragonKid <idragonkid@gmail.com>
Co-authored-by: Matt Ketmo <matthieu@moquet.net>
Co-authored-by: Ethan <cosinlinker@gmail.com>
Co-authored-by: Evgeny Danilenko <6655321@bk.ru>
Co-authored-by: Duong Minh Ngoc <153509244+minhngoc274@users.noreply.github.com>
Co-authored-by: Kero <keroroxx520@gmail.com>")[#2594](https://github.com/cometbft/cometbft/pull/2594)[)](/cometbft/cometbft/commit/e7dd0ab89fc3783d3de30f2c5fb892f9ca072ba2 "chore(spec): merge main into `spec/consensus-gossip` (#2594)

- **Versioned protobuf files (#495)**
- **Restore rpc/grpc/v1/types.pb.go**
- **proto: restore deprecation notice on BroadcastAPI**
- **Struct `Client` exposes sensitive data (#784)**
- **Unsafe int cast in `kill` command (#783)**
- **ADR-100: Data Companion Push API (#73)**
- **rfc: incoming txs while catching up (#735)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.17.0 to 1.18.0
(#804)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.8 to 1.4.9
(#806)**
- **build(deps): Bump golang.org/x/sync from 0.1.0 to 0.2.0 (#807)**
- **build(deps): Bump google.golang.org/grpc from 1.54.0 to 1.55.0
(#813)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.0 to
1.15.1 (#810)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
(#809)**
- **build(deps): Bump github.com/prometheus/client_model from 0.3.0 to
0.4.0 (#812)**
- **build(deps): Bump github.com/prometheus/common from 0.42.0 to 0.43.0
(#811)**
- **ADR-103: Protobuf definition versioning (#772)**
- **spec/p2p: Specify the operation of a Reactor (#714)**
- **build(deps): Bump github.com/docker/distribution (#827)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.1 to 1.3.3
(#828)**
- **ADR-103: Protobuf definition versioning (#772) (#817)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.9 to 1.4.10
(#830)**
- **build(deps): Bump golang.org/x/net from 0.9.0 to 0.10.0 (#831)**
- **build(deps): Bump golang.org/x/crypto from 0.8.0 to 0.9.0 (#832)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.26.1 to 2.27.1
(#833)**
- **rpc: Remove response data from response failure logs (#829)**
- **pubsub/kvindexer:support for big numbers - v2 (#797)**
- **Extend the infrastructure provider with `StartNodes` and
`StopTestnet` (#796)**
- **grpc: Add base gRPC server with version service (#818)**
- **Digital Ocean implementation of `StartNodes` and `StopTestnet`
(#846)**
- **RFC 102: Improve forward compatibility of proto-generated Rust
(#724)**
- **mempool: Add metric to measure how many times a tx was received
(#637)**
- **`e2e` provider is extended with `Disconnect`, `Reconnect` and
`CheckUpgraded` (#852)**
- **Sort `loadtime` tool's report (#854)**
- **feat: make handshake cancelable (#857)**
- **proto: Restore snake_case JSON for `ExecTxResult` (#856)**
- **qa: 200-nodes test on v0.38 (#877)**
- **qa: rotating node test on `v0.38.x` (#883)**
- **Changes to QA related files (e.g., `method.md`) (#878)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.18.0 to 1.19.0
(#868)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.2 to 1.8.3
(#873)**
- **build(deps): Bump github.com/bufbuild/buf from 1.18.0 to 1.19.0
(#872)**
- **Adds `vote_extension_size` to manifests (#858)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.27.1 to 2.28.1
(#893)**
- **build(deps): Bump github.com/prometheus/common from 0.43.0 to 0.44.0
(#892)**
- **build(deps): Bump slackapi/slack-github-action from 1.23.0 to 1.24.0
(#869)**
- **ADR 104: State sync from local application snapshot (#801)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.6.1 to 5.7.0
(#891)**
- **mempool: slight refactor for improving readability (#894)**
- **Add Vote Extension varying size testnet (#888)**
- **fix: lint fail when golangci-lint bump from v1.52.2 to v1.53.x
(#908)**
- **build(deps): Bump github.com/bufbuild/buf from 1.19.0 to 1.20.0
(#912)**
- **build(deps): Bump github.com/golangci/golangci-lint (#917)**
- **build(deps): Bump github.com/spf13/viper from 1.15.0 to 1.16.0
(#913)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.19.0 to 1.20.0
(#910)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.1 to 2.28.2
(#914)**
- **Minor fixes to `RELEASES.md` (#923)**
- **Prevent a transaction to appear twice in the mempool (#890)**
- **New metrics to track duplicate votes and block parts (#896) (#905)**
- **e2e tests are being skipped; `INFRASTRUCTURE-*` bug; portGen
inconsistency bug (#933)**
- **build(deps): Bump github.com/bufbuild/buf from 1.20.0 to 1.21.0
(#948)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.20.0 to 1.21.0
(#946)**
- **spec/p2p: document the p2p API used by Reactors (#851)**
- **build(deps): Bump docker/login-action from 2.1.0 to 2.2.0 (#944)**
- **e2e: Generate prometheus.yaml on setup (#954)**
- **Update the type annotations in the light client spec (#955)**
- **build(deps): Bump docker/build-push-action from 4.0.0 to 4.1.0
(#947)**
- **build(deps): Bump docker/setup-buildx-action from 2.5.0 to 2.7.0
(#962)**
- **Add requirement for `CheckTx` in ABCI spec (#928)**
- **fix: avoid recursive call after rename to (*PeerState).MarshalJSON
(#865)**
- **Port upstream proto changes to cometbft package**
- **changelog: Import entries for v0.34.28, v0.34.29, v0.37.1 and
v0.37.2 to `main` (#974)**
- **test/e2e: Fix Docker image build (#984)**
- **build(deps): Bump github.com/BurntSushi/toml from 1.3.0 to 1.3.2
(#952)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.2 to 2.29.0
(#953)**
- **Remove duplicate function `deterministicExecTxResult` (#986)**
- **mempool: Fix the benchmarks (#934)**
- **Add `CMT_HOME` (or remove it?) (#983)**
- **Remove buf.yaml at the root of the source tree (#979)**
- **build(deps): Bump docker/build-push-action from 4.1.0 to 4.1.1
(#989)**
- **build(deps): Bump golang.org/x/net from 0.10.0 to 0.11.0 (#994)**
- **build(deps): Bump golang.org/x/sync from 0.2.0 to 0.3.0 (#990)**
- **build(deps): Bump google.golang.org/grpc from 1.55.0 to 1.56.0
(#992)**
- **build(deps): Bump github.com/golangci/golangci-lint from 1.53.2 to
1.53.3 (#996)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.1 to
1.16.0 (#991)**
- **spec/p2p: new structure for the p2p specification (#966)**
- **consensus: optimize vote and block part gossip with
HasProposalBlockPartMessage and random sleeps (#904)**
- **Extend ABCI `max_block_size` parameter to give extended control to
the app (#1003)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.21.0 to 1.22.0
(#1026)**
- **Bump logs on non-fatal vote validation failures to Info level
(#1022)**
- **Update codeowners to include DevRel team (#1023)**
- **deps: Manually bump github.com/vektra/mockery/v2 from 2.29.0 to
2.30.1 (#1009)**
- **Update releasing.md to sign tags (#1034)**
- **build(deps): Bump github.com/bufbuild/buf from 1.21.0 to 1.22.0
(#1027)**
- **Rename ABCI enums and values to satisfy buf guidelines (#975)**
- **build(deps): Bump google.golang.org/grpc from 1.56.0 to 1.56.1
(#1028)**
- **docs: Added double quotes to /abci_query path param (#1015)**
- **Update Docs with Finalize Block (#760)**
- **Clarifies that processProposal may be called for set of transactions
different from the one returned in the preceding prepareProposal
(#1033)**
- **Update the annotation of part_set.go (#1056)**
- **build(deps): Bump docker/setup-buildx-action from 2.7.0 to 2.8.0
(#1071)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.1 to
2.30.16 (#1064)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.22.0 to 1.23.1
(#1072)**
- **build(deps): Bump github.com/bufbuild/buf from 1.22.0 to 1.23.1
(#1066)**
- **build(deps): Bump google.golang.org/protobuf from 1.30.0 to 1.31.0
(#1065)**
- **build(deps): Bump google.golang.org/grpc from 1.56.1 to 1.56.2
(#1101)**
- **build(deps): Bump golang.org/x/crypto from 0.10.0 to 0.11.0
(#1103)**
- **build(deps): Bump docker/setup-buildx-action from 2.8.0 to 2.9.0
(#1105)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.16 to
2.31.1 (#1100)**
- **build(deps): Bump golang.org/x/net from 0.11.0 to 0.12.0 (#1102)**
- **ci: Trigger workflows on merge group (#1118)**
- **Revert \"config: add bootstrap peers (#9680)\" (#1109)**
- **node: Revert removal of public reactor accessors (#1120)**
- **ci: Disable CodeQL check in merge queues (#1123)**
- **p2p: Remove UPnP functionality (#1114)**
- **ADR 107: Rename proto versions to pre-v1 betas (#1110)**
- **RFC 104: Internal messaging using the actor model (#1092)**
- **build(deps): Bump github.com/bufbuild/buf from 1.23.1 to 1.24.0
(#1131)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.31.1 to 2.32.0
(#1132)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.0 to 2.9.1
(#1133)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.23.1 to 1.24.0
(#1134)**
- **spec: Add mempool specification in English and Quint (#997)**
- **mempool: ADR for refactoring list of senders  (#1032)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.24.0 to 1.25.0
(#1157)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.7.0 to 5.8.0
(#1159)**
- **build(deps): Bump github.com/bufbuild/buf from 1.24.0 to 1.25.0
(#1160)**
- **proxy: Rename \"unsynchronized\" to \"connection-synchronized\" local
client creator (#1145)**
- **mempool: Keep track of senders in reactor instead of implementation
(#1010)**
- **cmd: Remove `replay` and `replay-console` subcommands (#1170)**
- **build(deps): Bump google.golang.org/grpc from 1.56.2 to 1.57.0
(#1181)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.0 to 5.8.1
(#1180)**
- **ci: Remove Mergify automerge (#1182)**
- **Add gRPC block service (#1142)**
- **blocksync: export errors (#1186)**
- **Porting changes related to creating a lean docker image from
`pierre/fast-prototyping-1059` branch. (#1192)**
- **chore: Format repo (#1193)**
- **Add BlockResults gRPC service (#1168)**
- **consensus: remove logic to unlock block on +2/3 prevote for nil
(#1175)**
- **ADR 101: Add GetLatest method to block service (#1209)**
- **ADR 101: Implement pruning mechanism (#1150)**
- **config: export errors (#1190)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.0 to 2.32.3
(#1218)**
- **Add check for non-`nil` in `enterCommit` (#1208)**
- **Log proposer's address when correctly accepting a proposal (#1079)**
- **Close evidence.db OnStop (#1210)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.0 to 1.25.1
(#1213)**
- **build(deps): Bump golang.org/x/crypto from 0.11.0 to 0.12.0
(#1215)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.0 to 1.25.1
(#1216)**
- **build(deps): Bump golang.org/x/net from 0.12.0 to 0.14.0 (#1217)**
- **Forward-port: update state to prevote `nil` when proposal block does
not match locked block (#1203)**
- **mempool: Store peer ids as p2p.ID instead of uint16 (remove
mempoolIDs) (#1191)**
- **ADR-101: implement gRPC `PruningService` (#1154)**
- **consensus: Avoid process proposal when we know correct nodes
validated it (#1231)**
- **ADR-101: Metrics to monitor the pruning  (#1234)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.1 to 1.26.0
(#1241)**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.1 to 1.26.1
(#1239)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1240)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.3 to 2.32.4
(#1242)**
- **abci: export errors  (#1185)**
- **consensus: export errors (#1211)**
- **ADR-101: Pruning mechanism minor fixes (#1246)**
- **chore: Bump minimum Go version on `main` to v1.21 (#1244)**
- **ADR 101: Add `Close` method to gRPC client (#1251)**
- **ADR 108: ADR for extending E2E infrastructure so that we can check
CometBFT's behaviour with respect to ABCI++ grammar. (#902)**
- **docs: Add logging guide to contributing guidelines (#1250)**
- **chore: log `app_hash` as hex (#1264)**
- **update language (#1263)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.0 to 1.26.1
(#1272)**
- **build(deps): Bump gonum.org/v1/gonum from 0.13.0 to 0.14.0 (#1275)**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.10 to 1.4.11
(#1276)**
- **ADR 101: Refactor height check-related logic and tests (#1271)**
- **Fixed linter**
- **Revert \"Fixed linter\"**
- **Fixed mem aliasing in for loop (#1280)**
- **Remove genesis persistence in state db (#1017)**
- **Revert \"Remove genesis persistence in state db (#1017)\" (#1294)**
- **evidence: export errors (#1284)**
- **Re-implement removal of genesis persistence in state db (#1295)**
- **build(deps): Bump docker/setup-buildx-action from 2.9.1 to 2.10.0
(#1298)**
- **node: verify genesis doc hash against the file contents rather than
remarshalled JSON (#1293)**
- **indexer: Implement pruning mechanism (#1176)**
- **Provide relevant block data in `ExtendVote` (#1270)**
- **node/state:bootstrap state api (#1057)**
- **build(deps): Bump actions/checkout from 3 to 4 (#1319)**
- **build(deps): Bump docker/build-push-action from 4.1.1 to 4.2.1
(#1318)**
- **Fix (#1323)**
- **state: remove genesis file from database  (#1297)**
- **Added changelog for pruning metrics (#1335)**
- **Removed begin_block_events and end_block_events from rpc doc
(#1338)**
- **consensus: test for precommit/locking corner case (#1257)**
- **TxIndexer and BlockIndexer pruning metrics (#1334)**
- **Forward port changes to changelog and `UPGRADING.md` for release
`v0.38.0` (#1341)**
- **Update Go version specified in root README on main for v0.34.x
(#1352)**
- **Add test/e2e/data to gitignore (#1349)**
- **docs: gRPC services and data companion pruning services (#1307)**
- **Add genesis_hash flag check on node startup (#1324)**
- **gRPC for Tx and Block indexer pruning (#1327)**
- **build(deps): Bump docker/build-push-action from 4.2.1 to 5.0.0
(#1371)**
- **build(deps): Bump docker/setup-buildx-action from 2.10.0 to 3.0.0
(#1370)**
- **build(deps): Bump docker/login-action from 2.2.0 to 3.0.0 (#1368)**
- **build(deps): Bump goreleaser/goreleaser-action from 4 to 5 (#1369)**
- **ADR101: Moved changelog entries (#1377)**
- **Max byte check (#1384)**
- **Update to string (#1385)**
- **mempool: Remove unused peerID constants (#1379)**
- **build(deps): Bump github.com/google/uuid from 1.3.0 to 1.3.1
(#1392)**
- **build(deps): Bump github.com/rs/cors from 1.9.0 to 1.10.0 (#1393)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.1 to 5.9.0
(#1396)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.4 to 2.34.0
(#1400)**
- **build(deps): Bump github.com/go-kit/kit from 0.12.0 to 0.13.0
(#1397)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1398)**
- **build(deps): Bump google.golang.org/grpc from 1.57.0 to 1.58.2
(#1399)**
- **doc: improve documentation of BlockParams.MaxBytes (#1405)**
- **rpc: Improve abci_query parameter documentation (#1184)**
- **Bump p2p version following introduction of
`HasProposalBlockPartMessage` (#1411)**
- **RFC: Allowing Non-Determinism in `ProcessProposal` (#1391)**
- **ADR-101: Data Companion Pull API (#82)**
- **build(deps): Bump github.com/rs/cors from 1.10.0 to 1.10.1 (#1418)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.0 to 2.34.2
(#1416)**
- **build(deps): Bump github.com/prometheus/client_golang (#1417)**
- **fix typos (#1413)**
- **Renames Tendermint to CometBFT in the RPC related test code
(#1428)**
- **Renames Tendermint to CometBFT in the RPC related test code. This
file was missing and it was not caught in the branch testing. (#1433)**
- **Reject incoming txs while node is catching up (#1119)**
- **build(deps): Bump golang.org/x/crypto from 0.13.0 to 0.14.0
(#1458)**
- **build(deps): Bump golang.org/x/sync from 0.3.0 to 0.4.0 (#1454)**
- **build(deps): Bump golang.org/x/net from 0.15.0 to 0.16.0 (#1453)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.1 to 1.27.0
(#1449)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.11.0 to
0.12.0 (#1450)**
- **build(deps): Bump github.com/prometheus/client_model (#1455)**
- **build(deps): Bump github.com/bufbuild/buf from 1.26.1 to 1.27.0
(#1459)**
- **build(deps): Bump github.com/spf13/viper from 1.16.0 to 1.17.0
(#1456)**
- **test: respect P2PConfig fuzzing configuration in MultiplexTransport
(#1414)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.2 to 2.35.3
(#1462)**
- **crypto: export errors (#1463)**
- **Do not race with pruning to validate headers and validators
(#1467)**
- **fix typos (#1487)**
- **Call observer only when retain height changes (#1490)**
- **build(deps): Bump pillow from 9.3.0 to 10.0.1 in
/scripts/qa/reporting (#1493)**
- **abci: Add relaxed local client synchronization models (#1141)**
- **docs: fix typos (#1500)**
- **Post-merge fixes for feature/proto-upgrade**
- **Make BuildLastCommitInfo and BuildExtendedCommitInfo public
(#1502)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.3 to 2.35.4
(#1497)**
- **build(deps): Bump google.golang.org/grpc from 1.58.2 to 1.58.3
(#1498)**
- **build(deps): Bump golang.org/x/net from 0.16.0 to 0.17.0 (#1499)**
- **tiny change: reorder expected and actual values (#1506)**
- **Fixed docker port alias (#1507)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.0 to 1.27.1
(#1527)**
- **Implement ADR-107: rename proto package version suffixes to v1beta*
pattern (#1510)**
- **e2e: Fix flakiness in grpc tests due to pruning (#1492)**
- **fix spelling of bandwidth (#1534)**
- **Fix linting on `main` (#1531)**
- **build(deps): Bump github.com/prometheus/common from 0.44.0 to 0.45.0
(#1524)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.0 to 1.27.1
(#1522)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1540)**
- **fix some typos (#1541)**
- **indexer-respect-height-params-on-query (#1529)**
- **Correct go_package paths in service proto files (#1538)**
- **build(deps): Bump google.golang.org/grpc from 1.58.3 to 1.59.0
(#1521)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.4 to 2.36.0
(#1523)**
- **feat(mempool): export error (#1427)**
- **Rename proto messages and services to satisfy default buf lints
(#1533)**
- **RFC 106: non-idempotent methods in data companion (#1545)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.0
(#1550)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.1 to 1.27.2
(#1551)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1552)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.1 to 1.27.2
(#1553)**
- **use assert.Greater instead of Equal for better error reporting
(#1547)**
- **rpc: Version the RPC APIs (#1412)**
- **mempool: Add metric size of pool in bytes (#1512)**
- **build(deps): Bump github.com/docker/docker (#1570)**
- **build(deps): Bump github.com/spf13/cobra from 1.7.0 to 1.8.0
(#1572)**
- **build(deps): Bump golang.org/x/sync from 0.4.0 to 0.5.0 (#1574)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.0 to 2.36.1
(#1576)**
- **build(deps): Bump github.com/gorilla/websocket from 1.5.0 to 1.5.1
(#1575)**
- **build(deps): Bump github.com/golangci/golangci-lint (#1573)**
- **chore: consolidate changelog improvements section (#1578)**
- **Implementation of ADR-108 (#930)**
- **Reduce the default MaxBytes to 4mb and increase MaxGas to 10 million
(#1518)**
- **e2e: Allow disabling the PEX reactor on all nodes in the testnet
(#1580)**
- **Experimental - Reduce # of connections effectively used to gossip
transactions out (#1558)**
- **Update proto file references to follow renaming/versioning (#1555)**
- **Make `LoadBlock` also return block metadata (#1557)**
- **mempool: Limit gossip connections to persistent and non-persistent
peers (experimental) (#1584)**
- **fix: docs: default db provider moved from node to config (#1588)**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.2 to 1.28.0
(#1598)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.2 to 1.28.0
(#1602)**
- **build(deps): Bump golang.org/x/crypto from 0.14.0 to 0.15.0
(#1599)**
- **build(deps): Bump golang.org/x/net from 0.17.0 to 0.18.0 (#1597)**
- **RFC 107: Internal signalling using event observers (#1164)**
- **ADR 110: Remote mempool (#1565)**
- **chore: aligns function descriptions with godoc standards in the
types package (#1593)**
- **docs: various improvements (#1603)**
- **chore: Merge branch main into feature/proto-upgrade (#1612)**
- **Removes wrong assertion and decreases likelyhood of block from the
future has actually been already created (#1619)**
- **Split /api off to separate go.mod (#1608)**
- **feature: Reduce Go API surface area (ADR 109) (#1605)**
- **refactor: Export func MakeHTTPDialer (#1594)**
- **First draft (#1483)**
- **pruning:do not attempt to prune state if no blocks are pruned
(#1616)**
- **Update SECURITY.md (#1626)**
- **Update changelog on `main` with new releases (#1644)**
- **proto: Update README (#1648)**
- **ADR 111: `nop` Mempool (#1585)**
- **ADR-111: Addressed Ethan's comment (#1667)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.1 to 2.37.1
(#1662)**
- **build(deps): Bump docker/build-push-action from 5.0.0 to 5.1.0
(#1664)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.0 to 1.28.1
(#1665)**
- **ci: Fix v0.34 nightly build (#1655)**
- **build(deps): Bump github.com/bufbuild/buf from 1.28.0 to 1.28.1
(#1663)**
- **feature/proto-upgrade: Fix generated mock code (#1673)**
- **Update link in README.md (#1674)**
- **Renames the semantic versioning variable to CMT (#1621)**
- **mempool: add `nop` mempool (#1643)**
- **e2e:fix-digital-ocean-ports (#1678)**
- **Revert modularization of the test infra (#1488) (#1676)**
- **docs: various small improvements (part 2) (#1683)**
- **Do not block indefinitely on the semaphore (#1654)**
- **Adds tests that check for FIFO ordering being broken by gossip
(#1628)**
- **loadtime: Add parameter for displaying results in one line (#1511)**
- **Promote latest versions of Protobuf definitions to v1 packages
(#1677)**
- **chore: Update CHANGELOG.md (#1701)**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
(#1696)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.37.1 to 2.38.0
(#1697)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.1
(#1702)**
- **proto: document the `cometbft.*` versioned protos (#1694)**
- **Clean up changelog entries and README files for versioned proto
changes (#1707)**
- **chore(proto): add missing docs (#1703)**
- **feature/proto-upgrade: Last-minute fixes (#1709)**
- **e2e: Support emulated latencies between docker images (#1560)**
- **build(deps): Bump golang.org/x/net from 0.14.0 to 0.17.0 in /api
(#1713)**
- **Prepare `main` for `v1.x` backport branch (#1714)**
- **build(deps): Bump golang.org/x/crypto from 0.15.0 to 0.16.0
(#1720)**
- **build(deps): Bump golang.org/x/net from 0.18.0 to 0.19.0 (#1719)**
- **types: validate Validator#Address field (#1715)**
- **Enable Mergify backports for `v1.x` branch (#1724)**
- **deps: Bump cometbft-db to v0.9.0 (#1725)**
- **buf improvements prior to publishing on BSR (#1726)**
- **proto: give our buf module a name (#1734)**
- **deps: Bump cometbft-db to v0.9.1 (#1737)**
- **chore: Update root docs (#1740)**
- **fix: increase abci socket message size limit to 2GB (#1730)**
- **proto: make comment in README more Markdowny (#1743)**
- **fix: Txs Validate (#1687)**
- **Add test missing in #1687 (#1712)**
- **perf(state): batch save `State` (#1735)**
- **Update CODE_OF_CONDUCT.md (#1708)**
- **[e2e] Fixes prepareProposal not to return oversized set of
transactions (#1756)**
- **perf(store): Batch save `Block` (#1755)**
- **Fix: Fix minor typos (#1780)**
- **`VerifyCommitLight` and `VerifyCommitLightTrusting` _never_ check
all signatures (#1750)**
- **Fix typo in encoding.md (#1801)**
- **chore(docs): small improvements (#1781)**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.10.1 to 5.11.0
(#1797)**
- **build(deps): Bump actions/setup-go from 4 to 5 (#1794)**
- **build(deps): Bump actions/stale from 8 to 9 (#1795)**
- **build(deps): Bump github.com/spf13/viper from 1.17.0 to 1.18.1
(#1796)**
- **Chore/fix other typos (#1809)**
- **chore(spec): specify which fields must be deterministic (#1804)**
- **Small improvements in #1806 not present in #1750 (#1808)**
- **Add changelog for #1749 (#1807)**
- **e2e: Implement latency emulation for DigitalOcean (#1587)**
- **add GH workflow for linting code using codespell (#1824)**
- **chore(docs): explain the effect of `timeout_propose` (#1798)**
- **build(deps): Bump actions/upload-artifact from 3 to 4 (#1845)**
- **build(deps): Bump actions/setup-python from 2 to 5 (#1843)**
- **build(deps): Bump github/codeql-action from 2 to 3 (#1847)**
- **build(deps): Bump actions/checkout from 2 to 4 (#1846)**
- **build(deps): Bump github.com/google/uuid from 1.4.0 to 1.5.0
(#1850)**
- **build(deps): Bump google.golang.org/grpc from 1.59.0 to 1.60.0
(#1851)**
- **golangci-lint: enable all the linters by default (#1838)**
- **Updates go crypto package to v0.17.0 (#1859)**
- **Adds checks for nil keys and signatures (#1855)**
- **The store DB and the companion `BlockStore` struct are sometimes out
of sync (#1856)**
- **Allow blocksync to not verify all signatures (#1858)**
- **Fixing the ABCI grammar and updating the code for e2e tests to
account for the new grammar. (#1829)**
- **docs: Fix Discord links in README (#1874)**
- **build(deps): Bump github.com/prometheus/client_golang (#1909)**
- **build(deps): Bump github.com/btcsuite/btcd/btcutil from 1.1.3 to
1.1.5 (#1908)**
- **build(deps): Bump google.golang.org/protobuf (#1885)**
- **build(deps): Bump github.com/spf13/viper from 1.18.1 to 1.18.2
(#1884)**
- **build(deps): Bump google.golang.org/grpc from 1.60.0 to 1.60.1
(#1883)**
- **remove unused linters that produced a warning and ensure that
unparam is enabled (#1905)**
- **Fix HTTP response body not being closed after reading (#1945)**
- **Disable undesired linting code (#1959)**
- **Extend kvstore example add with with key types (#1876)**
- **Extra check in `VerifyExtension` (#1877)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.38.0 to 2.39.1
(#1882)**
- **perf(crypto/merkle, crypto/tmhash): simplify+optimize SHA256 hashing
of multiple byteslices (#1921)**
- **Update localnet-start Makefile (#1975)**
- **blocksync: wait for poolRoutine to stop in (*Reactor).OnStop
(#1879)**
- **fix TestListenerTimeoutReadWrite (#1947)**
- **docs: fix typos (#1988)**
- **this is the kindest commit I can think of. Take it that way and read
the code. (#1987)**
- **there's really no need for this anymore (#1986)**
- **feat: DefaultHttpClient support setting proxy from env (#1900)**
- **feat: lint tests (#1906)**
- **chore: fix typos (#1991)**
- **build(deps): Bump golang.org/x/sync from 0.5.0 to 0.6.0 (#1992)**
- **feat(proxy): export errors (#1899)**
- **doc:fix broken link in DOCKER/README.md (#1996)**
- **feat: custom dependencies order (#1994)**
- **PBTS: migrating to `main` the new version of the specification
(#1973)**
- **Fix paths to scripts/metricsgen in go:generate commands (#1998)**
- **chore: fix some typos (#2002)**
- **docs(light): fix broken link to spec (#2007)**
- **chore(test/loadtime): replace tm-load-test w/ cometbft-load-test
(#2009)**
- **ci: Remove unused `tests` target when compiling e2e (#2022)**
- **spec: fix typo in `encoding.md` (#2024)**
- **mempool: Fix data races in CListMempool's height and
notifiedTxsAvailable (#2021)**
- **chore(test/loadtime): cleanup go.sum and golangci.yml (#2025)**
- **build(deps): Bump github.com/prometheus/common from 0.45.0 to 0.46.0
(#2040)**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.39.1 to 2.40.1
(#2038)**
- **feat(rpc): Use default port for HTTP(S) URLs when there is no
explicit port (#1903)**
- **misc(go.mod): remove unused peg dependency (#2044)**
- **config: Remove unused `max_batch_bytes` (#2050)**
- **Merge pull request from GHSA-qr8r-m495-7hc4**
- **misc(tools)!: remove `tools` package (#2046)**
- **docs(guides): add missing import (#2070)**
- **deps(localnode): bump alpine version (#2077)**
- **misc(Makefile): add `help` target to display the help msg (#2074)**
- **`e2e`: test vote extension activation via `InitChain` and
`FinalizeBlock` (#2066)**
- **scripts: metricsgen parses '// metrics:' pattern (#2090)**
- **e2e: Add `load_max_txs` option to manifest (#2094)**
- **consensus: Add `chain_size_bytes` metric (#2093)**
- **feat: conventional commits (#1995)**
- **Forward port of tendermint/tendermint#7605, tendermint/spec#393, and
tendermint/tendermint#8142 (#2018)**
- **ci: fix permissions for \"Conventional PR Title\" (#2099)**
- **PBTS: additions and fixes on migrated spec (#2013)**
- **PBTS: forward port of tendermint/tendermint#7709 (#2089)**
- **feat: use go workspace (#1924)**
- **fix: `ValidateUpdate`: allow no-change updates regardless of current
height (#2112)**
- **test(localnet): Add monitoring tools for localnet (#2108)**
- **feat: add gofumpt (#2049)**
- **feat(consensus): increase log level for corner case when prevoting a
proposal (#2042)**
- **docs: v1 - diataxis framework (#2105)**
- **feat(consensus): additional sanity checks for the size of proposed
blocks (#1408)**
- **perf(internal/blocksync): avoid double-calling
`types.BlockFromProto` (#2016)**
- **build(deps): Bump google.golang.org/grpc from 1.60.1 to 1.61.0
(#2178)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.1 to 1.29.0
(#2161)**
- **build(deps): Bump styfle/cancel-workflow-action from 0.12.0 to
0.12.1 (#2160)**
- **build(deps): Bump slackapi/slack-github-action from 1.24.0 to 1.25.0
(#2162)**
- **build(deps): Bump github.com/google/uuid from 1.5.0 to 1.6.0
(#2176)**
- **refactor(privval): reverse conditional + more idiomatic Go code with
early returns (#2156)**
- **fix(e2e): path to latency script files in DO (#2148)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.9.1 to
0.10.0 (#2175)**
- **chore(Makefile): add `setup-pre-commit` target to init git hook
(#2123)**
- **feat: add pebbledb (https://github.com/cockroachdb/pebble) (#2132)**
- **perf(internal/blocksync): do not `ValidateBlock` twice (#2026)**
- **feat(e2e): Add new targets `fast` and `clean` to Makefile (#2192)**
- **ci: add `spec` type in conventional-pr-title (#2191)**
- **fix(privval): retry accepting a connection on errors (#2047)**
- **fix(.github/workflows): correct parameters to lint_pr_title
(#2199)**
- **docs: update QA method steps for qa-infra changes (#2198)**
- **feat!(pbts): forward port of tendermint/tendermint#7711 (#2149)**
- **docs(pbts): forward port of PBTS documentation and fixes (#2124)**
- **fix: if-return and early-return (#2215)**
- **chore: remove amazon linux Dockerfile and update
test/docker/Dockerfile (#2135)**
- **feat(ci): pre-commit framework (#2214)**
- **ci: add `merge` type for conventional-pr-title (#2219)**
- **spec(consensus/pbts): update description for introduced parameters.
(#2206)**
- **perf: optimize psql indexer (#2142)**
- **fix(go.mod): do not use `replace` for api (#2236)**
- **fix(Makefile): gofumpt no longer needed (#2235)**
- **fix(p2p/pex): gracefully shutdown `Reactor` (#2010)**
- **test(mempool): fix
TestMempoolUpdateDoesNotPanicWhenApplicationMissedTx (#2242)**
- **fix(flowrate): fix non-determinism in flowrate tests (#2147)**
- **refactor!: Implement RFC 106: remove `GetLatestBlock*` methods from
data companion API (#2240)**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.3 to 1.3.7
(#2253)**
- **chore(config): update DB section in toml.go (#2249)**
- **fix(consensus): do not precommit nil if proposal block is received
(#2221)**
- **build(deps): Bump github.com/opencontainers/runc from 1.1.5 to
1.1.12 (#2261)**
- **fix(mempool/tests): Reduce tests duration (#2263)**
- **ci: run golangci-lint linters for all files (not only ones which
were modified) (#2250)**
- **refactor(examples): small changes to kvstore app (#2267)**
- **refactor(mempool): simplify parameters of resCbFirstTime and
resCbRecheck (#2272)**
- **perf(mempool/cache): clear map in Reset (#2259)**
- **test(abci): update e2e tests to check against ABCI 2.0 grammar
(#2201)**
- **docs: symbolic references to steps in the qa-infra README (#2280)**
- **chore: updated doc link (#2296)**
- **fix(consensus): prevote nil upon timeout when Proposal is missing
(#2218)**
- **build(deps): Bump pre-commit/action from 3.0.0 to 3.0.1 (#2307)**
- **build(deps): Bump golang.org/x/net from 0.20.0 to 0.21.0 (#2300)**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.10.0 to
0.11.0 (#2299)**
- **docs: ADR-112 Proposer-Based Timestamps (#2223)**
- **refactor(internal/statesync): replace ticker with `time.After(X)`
(#2294)**
- **fix: simultaneous rpc test failures (#2150)**
- **chore(docs): alter the section about the effects of `timeout_commit`
(#1892)**
- **refactor(p2p)!: Refactor PeerSet to eliminate data races & improve
performance (#2246)**
- **feat(pbts): Update consensus params to include pbts enabled
(#2231)**
- **feat(storage/metrics): Metrics to measure storage (#1974)**
- **feat(e2e): Log number of sent txs (success and failed) (#2328)**
- **chore: enable gomoddirectives, unparam (#2290)**
- **docs: images not rendering properly in docs (#2331)**
- **docs: Fix references about DeliverTx (#2330)**
- **docs(qa): Add table of contents to existing QA reports (#2343)**
- **chore: enable perfsprint linter (#2291)**
- **feat(pruning): trigger explicitly compaction upon pruning (#1972)**
- **docs: explain how to skip pre-commit hook (#2358)**
- **build(deps): Bump github.com/prometheus/common from 0.46.0 to 0.47.0
(#2373)**
- **build(deps): Bump google.golang.org/grpc from 1.61.0 to 1.61.1
(#2372)**
- **feat(e2e): Option to set max block size in bytes at genesis
(#2362)**
- **build(deps): Bump github.com/prometheus/client_model from 0.5.0 to
0.6.0 (#2371)**
- **revert(pbts): revert removal of BFT Time related functions (#2205)**
- **fix(e2e): Reduce flakiness of TestGRPC_GetBlockResults (#2367)**
- **spec(consensus): update Block Time documentation in spec (#2316)**
- **spec: adaptive MSGDELAY parameter included in PBTS spec (#2318)**
- **feat(pbts): Moving VoteExtensionsEnableHeight from ABCIParams to
FeatureParams. (#2335)**
- **fix: remove TestMempoolFIFOWithParallelCheckTx (#2364)**
- **fix(docker-compose): fix subnet (#2383)**
- **feat(pbts): enable `e2e` manifest config to set `PbtsEnableHeight`
(#2284)**
- **perf(internal/state): avoid double-saving FinalizeBlockResponse
(#2017)**
- **build(deps): Bump fonttools from 4.37.4 to 4.43.0 in
/scripts/qa/reporting (#2407)**
- **build(deps): Bump pillow from 10.0.1 to 10.2.0 in
/scripts/qa/reporting (#2408)**
- **fix(node): Forward compaction config params to blockstore
constructor (#2418)**
- **refactor!: moved `MedianTime` out of `internal` folder (#2397)**
- **chore: typo fixes (#2403)**
- **chore(pbts): Removes useless code (#2420)**
- **build(deps): Bump github.com/prometheus/common from 0.47.0 to 0.48.0
(#2430)**
- **build(deps): Bump google.golang.org/grpc from 1.61.1 to 1.62.0
(#2429)**
- **test(consensus): PBTS should be enabled by default in test units
(#2329)**
- **test(consensus): test enabling PBTS at a given height (#2404)**
- **refactor(protobuf): switch from gogofaster to gocosmos generator
(#2425)**
- **docs(tutorials/install): add `From Go package` (#2414)**
- **docs(pbts): documentation for PBTS-related consensus parameters
(#2376)**
- **refactor(consensus): print err from SignAndCheckVote (#2346)**
- **feat(e2e): add parameter to set a custom output directory for
testnet files (#2433)**
- **spec(consensus): update description of consensus parameters for PBTS
(#2415)**
- **fix(localnet): Grafana dashboards for storage tests - removed
experimental metrics (#2448)**
- **fix(jsonrpc): enable HTTP basic auth in WS client (#2434)**
- **feat(pbts): Adds timestamp to the `msgInfo` written into the WAL
(#2388)**
- **fix: `Rollback`: wrong modification of
`state.LastHeightValidatorsChanged` while rollback at a special height
(#2136)**
- **docs(changelog): add missing entry for #2136 (#2459)**
- **fix(pbts): legacy `ABCIParams` values are properly translated to
`FeatureParams` values (#2462)**
- **fix(e2e): Fixing the bug in ABCI e2e tests (#2468)**
- **feat(localnet): Grafana PNG rendering for easier graph exports
(#2472)**
- **docs(README): remove Terra (#2469)**
- **docs: document PBTS adaptive delays mechanism (#2452)**
- **fix(config): Moved compact variables to the right section (#2477)**
- **feat(metrics): more buckets for ProposalTimestampDifference
(#2479)**
- **fix(metrics): more buckets for ProposalTimestampDifference (#2481)**
- **feat(pbts): Make synchrony params adaptive (#2431)**
- **ci: check metrics generation in CI checks (#2483)**
- **feat(consensus): improve logging for timely and untimely messages
(#2321)**
- **feat(types): improve Proposal and SynchronyParams validation tests
(#2489)**
- **test(consensus): refactor TestStateLock_POLSafety tests (#2492)**
- **feat(types): refactor types.AdaptiveSynchronyParams method (#2490)**
- **fix: lint errors introduced with the latest merge (#2495)**
- **build(deps): Bump docker/setup-buildx-action from 3.0.0 to 3.1.0
(#2500)**
- **build(deps): Bump github.com/prometheus/client_golang from 1.18.0 to
1.19.0 (#2508)**
- **build(deps): Bump golang.org/x/crypto from 0.19.0 to 0.20.0
(#2507)**
- **build(deps): Bump github.com/prometheus/common from 0.48.0 to 0.49.0
(#2506)**
- **build(deps): Bump github.com/stretchr/testify from 1.8.4 to 1.9.0
(#2505)**
- **fix(docs): include `timesync` daemon instructions (#2491)**
- **feat(privval)!: DO NOT require extension signature (#2496)**
- **refactor(privval): rename sign_extension to skip_sign_extension
(#2519)**
- **spec(abci): fixes the spec to inform about the presence of invalid
extensions in `last_commit` (#2423)**
- **fix(pbts): block Time must be Canonical (#2493)**
- **feat(e2e): Add manifest option `clock_skew` and corresponding
backend functionality (#2454)**
- **fix(mempool): converting to uint64 before additions to avoid
overflows (#2498)**
- **refactor!: Rename `skip_sign_extension` to `skip_extension_signing`
(#2522)**
- **docs(ADR): ADR-108 updated to account for the new changes in the
grammar and code. (#2528)**
- **feat(e2e): add generator support for clock skew + env variable
rename (#2488)**
- **spec(proto): add `cometbft.privval.v1beta2` proto package (#2529)**
- **chore: improving error handling in the PendingEvidence (#2550)**
- **feat(blocksync)!: set the max number of (concurrently) downloaded
blocks to {peersCount * 20} (#2467)**
- **build(deps): Bump bufbuild/buf-setup-action from 1.29.0 to 1.30.0
(#2557)**
- **build(deps): Bump google.golang.org/protobuf from 1.32.0 to 1.33.0
(#2560)**
- **build(deps): Bump golang.org/x/net from 0.21.0 to 0.22.0 (#2562)**
- **fix(cmd/cometbft/commands/version): update the output for v1
(#2546)**
- **build(deps): Bump docker/build-push-action from 5.1.0 to 5.2.0
(#2558)**
- **build(deps): Bump github.com/prometheus/common from 0.49.0 to 0.50.0
(#2559)**
- **build(deps): Bump google.golang.org/grpc from 1.62.0 to 1.62.1
(#2563)**
- **build(deps): Bump golang.org/x/crypto from 0.20.0 to 0.21.0
(#2561)**
- **feat(blocksync): sort peers by download rate & multiple requests for
closer blocks (#2475)**
- **feat(pbts): Adjusts PBTS metrics buckets (#2578)**
- **fix(blocksync): use timer instead of time.After (#2584)**
- **fix: temporary fix for `api` dependency (#2589)**

---------

Signed-off-by: Thane Thomson <connect@thanethomson.com>
Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: Thane Thomson <connect@thanethomson.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
Co-authored-by: Mikhail Zabaluev <mikhail@informal.systems>
Co-authored-by: Troy Kessler <43882936+troykessler@users.noreply.github.com>
Co-authored-by: leven <112051166+lx-xiang@users.noreply.github.com>
Co-authored-by: werty144 <anton-paramonov2000@yandex.ru>
Co-authored-by: Adi Seredinschi <adizere@gmail.com>
Co-authored-by: Sukey <35202440+sukey2008@users.noreply.github.com>
Co-authored-by: Sergio Mena <sergio@informal.systems>
Co-authored-by: Jasmina Malicevic <jasmina.dustinac@gmail.com>
Co-authored-by: moriluka <85185077+moriluka@users.noreply.github.com>
Co-authored-by: ƒê·ªó Vi·ªát Ho√†ng <hoangdv2429@gmail.com>
Co-authored-by: alex <152680487+azukiboy@users.noreply.github.com>
Co-authored-by: Hern√°n Vanzetto <15466498+hvanz@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@informal.systems>
Co-authored-by: Andy Nogueira <me@andynogueira.dev>
Co-authored-by: nenadmilosevic95 <50905385+nenadmilosevic95@users.noreply.github.com>
Co-authored-by: nenadmilosevic95 <nenad@informal.systems>
Co-authored-by: Jacob Gadikian <jacobgadikian@gmail.com>
Co-authored-by: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Co-authored-by: Emmanuel T Odeke <emm.odeke@gmail.com>
Co-authored-by: jchappelow <140431406+jchappelow@users.noreply.github.com>
Co-authored-by: shuoer86 <129674997+shuoer86@users.noreply.github.com>
Co-authored-by: levisyin <150114626+levisyin@users.noreply.github.com>
Co-authored-by: vuittont60 <81072379+vuittont60@users.noreply.github.com>
Co-authored-by: Halimao <1065621723@qq.com>
Co-authored-by: alex <152680487+bodhi-crypo@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@usi.ch>
Co-authored-by: Josef Widder <44643235+josef-widder@users.noreply.github.com>
Co-authored-by: William Banfield <4561443+williambanfield@users.noreply.github.com>
Co-authored-by: Kukovec <jure.kukovec@gmail.com>
Co-authored-by: Daniel Cason <cason@gandria>
Co-authored-by: M. J. Fromberger <fromberger@interchain.io>
Co-authored-by: hattizai <150505746+hattizai@users.noreply.github.com>
Co-authored-by: Huulu <35667132+IssouChancla@users.noreply.github.com>
Co-authored-by: katelyn martin <me+cratelyn@katelyn.world>
Co-authored-by: Richard Gibson <richard.gibson@gmail.com>
Co-authored-by: Jean Deruelle <jean.deruelle@gmail.com>
Co-authored-by: glnro <8335464+glnro@users.noreply.github.com>
Co-authored-by: Greg Szabo <greg@philosobear.com>
Co-authored-by: Emmanuel T Odeke <emmanuel@orijtech.com>
Co-authored-by: levisyin <lilassherl@gmail.com>
Co-authored-by: k0marov <95040709+k0marov@users.noreply.github.com>
Co-authored-by: Adi Seredinschi <a@seredinschi.net>
Co-authored-by: Pan chao <152830401+Pan-chao@users.noreply.github.com>
Co-authored-by: Khanh Hoa <49144992+hoanguyenkh@users.noreply.github.com>
Co-authored-by: glnro <lauren@informal.systems>
Co-authored-by: toni <143221387+xyztoni@users.noreply.github.com>
Co-authored-by: DragonKid <idragonkid@gmail.com>
Co-authored-by: Matt Ketmo <matthieu@moquet.net>
Co-authored-by: Ethan <cosinlinker@gmail.com>
Co-authored-by: Evgeny Danilenko <6655321@bk.ru>
Co-authored-by: Duong Minh Ngoc <153509244+minhngoc274@users.noreply.github.com>
Co-authored-by: Kero <keroroxx520@gmail.com>")`
‚Ä¶

`[e7dd0ab](/cometbft/cometbft/commit/e7dd0ab89fc3783d3de30f2c5fb892f9ca072ba2)`

```
- **Versioned protobuf files ([#495](https://github.com/cometbft/cometbft/pull/495))**
- **Restore rpc/grpc/v1/types.pb.go**
- **proto: restore deprecation notice on BroadcastAPI**
- **Struct `Client` exposes sensitive data ([#784](https://github.com/cometbft/cometbft/pull/784))**
- **Unsafe int cast in `kill` command ([#783](https://github.com/cometbft/cometbft/pull/783))**
- **ADR-100: Data Companion Push API ([#73](https://github.com/cometbft/cometbft/pull/73))**
- **rfc: incoming txs while catching up ([#735](https://github.com/cometbft/cometbft/pull/735))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.17.0 to 1.18.0
([#804](https://github.com/cometbft/cometbft/pull/804))**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.8 to 1.4.9
([#806](https://github.com/cometbft/cometbft/pull/806))**
- **build(deps): Bump golang.org/x/sync from 0.1.0 to 0.2.0 ([#807](https://github.com/cometbft/cometbft/pull/807))**
- **build(deps): Bump google.golang.org/grpc from 1.54.0 to 1.55.0
([#813](https://github.com/cometbft/cometbft/pull/813))**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.0 to
1.15.1 ([#810](https://github.com/cometbft/cometbft/pull/810))**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
([#809](https://github.com/cometbft/cometbft/pull/809))**
- **build(deps): Bump github.com/bufbuild/buf from 1.17.0 to 1.18.0
([#809](https://github.com/cometbft/cometbft/pull/809))**
- **build(deps): Bump github.com/prometheus/client_model from 0.3.0 to
0.4.0 ([#812](https://github.com/cometbft/cometbft/pull/812))**
- **build(deps): Bump github.com/prometheus/common from 0.42.0 to 0.43.0
([#811](https://github.com/cometbft/cometbft/pull/811))**
- **ADR-103: Protobuf definition versioning ([#772](https://github.com/cometbft/cometbft/pull/772))**
- **spec/p2p: Specify the operation of a Reactor ([#714](https://github.com/cometbft/cometbft/pull/714))**
- **build(deps): Bump github.com/docker/distribution ([#827](https://github.com/cometbft/cometbft/pull/827))**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.1 to 1.3.3
([#828](https://github.com/cometbft/cometbft/pull/828))**
- **ADR-103: Protobuf definition versioning ([#772](https://github.com/cometbft/cometbft/pull/772)) ([#817](https://github.com/cometbft/cometbft/pull/817))**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.9 to 1.4.10
([#830](https://github.com/cometbft/cometbft/pull/830))**
- **build(deps): Bump golang.org/x/net from 0.9.0 to 0.10.0 ([#831](https://github.com/cometbft/cometbft/pull/831))**
- **build(deps): Bump golang.org/x/crypto from 0.8.0 to 0.9.0 ([#832](https://github.com/cometbft/cometbft/pull/832))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.26.1 to 2.27.1
([#833](https://github.com/cometbft/cometbft/pull/833))**
- **rpc: Remove response data from response failure logs ([#829](https://github.com/cometbft/cometbft/pull/829))**
- **pubsub/kvindexer:support for big numbers - v2 ([#797](https://github.com/cometbft/cometbft/pull/797))**
- **Extend the infrastructure provider with `StartNodes` and
`StopTestnet` ([#796](https://github.com/cometbft/cometbft/pull/796))**
- **grpc: Add base gRPC server with version service ([#818](https://github.com/cometbft/cometbft/pull/818))**
- **Digital Ocean implementation of `StartNodes` and `StopTestnet`
([#846](https://github.com/cometbft/cometbft/pull/846))**
- **RFC 102: Improve forward compatibility of proto-generated Rust
([#724](https://github.com/cometbft/cometbft/pull/724))**
- **mempool: Add metric to measure how many times a tx was received
([#637](https://github.com/cometbft/cometbft/pull/637))**
- **`e2e` provider is extended with `Disconnect`, `Reconnect` and
`CheckUpgraded` ([#852](https://github.com/cometbft/cometbft/pull/852))**
- **Sort `loadtime` tool's report ([#854](https://github.com/cometbft/cometbft/pull/854))**
- **feat: make handshake cancelable ([#857](https://github.com/cometbft/cometbft/pull/857))**
- **proto: Restore snake_case JSON for `ExecTxResult` ([#856](https://github.com/cometbft/cometbft/pull/856))**
- **qa: 200-nodes test on v0.38 ([#877](https://github.com/cometbft/cometbft/pull/877))**
- **qa: rotating node test on `v0.38.x` ([#883](https://github.com/cometbft/cometbft/pull/883))**
- **Changes to QA related files (e.g., `method.md`) ([#878](https://github.com/cometbft/cometbft/pull/878))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.18.0 to 1.19.0
([#868](https://github.com/cometbft/cometbft/pull/868))**
- **build(deps): Bump github.com/stretchr/testify from 1.8.2 to 1.8.3
([#873](https://github.com/cometbft/cometbft/pull/873))**
- **build(deps): Bump github.com/bufbuild/buf from 1.18.0 to 1.19.0
([#872](https://github.com/cometbft/cometbft/pull/872))**
- **Adds `vote_extension_size` to manifests ([#858](https://github.com/cometbft/cometbft/pull/858))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.27.1 to 2.28.1
([#893](https://github.com/cometbft/cometbft/pull/893))**
- **build(deps): Bump github.com/prometheus/common from 0.43.0 to 0.44.0
([#892](https://github.com/cometbft/cometbft/pull/892))**
- **build(deps): Bump slackapi/slack-github-action from 1.23.0 to 1.24.0
([#869](https://github.com/cometbft/cometbft/pull/869))**
- **ADR 104: State sync from local application snapshot ([#801](https://github.com/cometbft/cometbft/pull/801))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.6.1 to 5.7.0
([#891](https://github.com/cometbft/cometbft/pull/891))**
- **mempool: slight refactor for improving readability ([#894](https://github.com/cometbft/cometbft/pull/894))**
- **Add Vote Extension varying size testnet ([#888](https://github.com/cometbft/cometbft/pull/888))**
- **fix: lint fail when golangci-lint bump from v1.52.2 to v1.53.x
([#908](https://github.com/cometbft/cometbft/pull/908))**
- **build(deps): Bump github.com/bufbuild/buf from 1.19.0 to 1.20.0
([#912](https://github.com/cometbft/cometbft/pull/912))**
- **build(deps): Bump github.com/golangci/golangci-lint ([#917](https://github.com/cometbft/cometbft/pull/917))**
- **build(deps): Bump github.com/spf13/viper from 1.15.0 to 1.16.0
([#913](https://github.com/cometbft/cometbft/pull/913))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.19.0 to 1.20.0
([#910](https://github.com/cometbft/cometbft/pull/910))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.1 to 2.28.2
([#914](https://github.com/cometbft/cometbft/pull/914))**
- **Minor fixes to `RELEASES.md` ([#923](https://github.com/cometbft/cometbft/pull/923))**
- **Prevent a transaction to appear twice in the mempool ([#890](https://github.com/cometbft/cometbft/pull/890))**
- **New metrics to track duplicate votes and block parts ([#896](https://github.com/cometbft/cometbft/pull/896)) ([#905](https://github.com/cometbft/cometbft/pull/905))**
- **e2e tests are being skipped; `INFRASTRUCTURE-*` bug; portGen
inconsistency bug ([#933](https://github.com/cometbft/cometbft/pull/933))**
- **build(deps): Bump github.com/bufbuild/buf from 1.20.0 to 1.21.0
([#948](https://github.com/cometbft/cometbft/pull/948))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.20.0 to 1.21.0
([#946](https://github.com/cometbft/cometbft/pull/946))**
- **spec/p2p: document the p2p API used by Reactors ([#851](https://github.com/cometbft/cometbft/pull/851))**
- **build(deps): Bump docker/login-action from 2.1.0 to 2.2.0 ([#944](https://github.com/cometbft/cometbft/pull/944))**
- **e2e: Generate prometheus.yaml on setup ([#954](https://github.com/cometbft/cometbft/pull/954))**
- **Update the type annotations in the light client spec ([#955](https://github.com/cometbft/cometbft/pull/955))**
- **build(deps): Bump docker/build-push-action from 4.0.0 to 4.1.0
([#947](https://github.com/cometbft/cometbft/pull/947))**
- **build(deps): Bump docker/setup-buildx-action from 2.5.0 to 2.7.0
([#962](https://github.com/cometbft/cometbft/pull/962))**
- **Add requirement for `CheckTx` in ABCI spec ([#928](https://github.com/cometbft/cometbft/pull/928))**
- **fix: avoid recursive call after rename to (*PeerState).MarshalJSON
([#865](https://github.com/cometbft/cometbft/pull/865))**
- **Port upstream proto changes to cometbft package**
- **changelog: Import entries for v0.34.28, v0.34.29, v0.37.1 and
v0.37.2 to `main` ([#974](https://github.com/cometbft/cometbft/pull/974))**
- **test/e2e: Fix Docker image build ([#984](https://github.com/cometbft/cometbft/pull/984))**
- **build(deps): Bump github.com/BurntSushi/toml from 1.3.0 to 1.3.2
([#952](https://github.com/cometbft/cometbft/pull/952))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.28.2 to 2.29.0
([#953](https://github.com/cometbft/cometbft/pull/953))**
- **Remove duplicate function `deterministicExecTxResult` ([#986](https://github.com/cometbft/cometbft/pull/986))**
- **mempool: Fix the benchmarks ([#934](https://github.com/cometbft/cometbft/pull/934))**
- **Add `CMT_HOME` (or remove it?) ([#983](https://github.com/cometbft/cometbft/pull/983))**
- **Remove buf.yaml at the root of the source tree ([#979](https://github.com/cometbft/cometbft/pull/979))**
- **build(deps): Bump docker/build-push-action from 4.1.0 to 4.1.1
([#989](https://github.com/cometbft/cometbft/pull/989))**
- **build(deps): Bump golang.org/x/net from 0.10.0 to 0.11.0 ([#994](https://github.com/cometbft/cometbft/pull/994))**
- **build(deps): Bump golang.org/x/sync from 0.2.0 to 0.3.0 ([#990](https://github.com/cometbft/cometbft/pull/990))**
- **build(deps): Bump google.golang.org/grpc from 1.55.0 to 1.56.0
([#992](https://github.com/cometbft/cometbft/pull/992))**
- **build(deps): Bump github.com/golangci/golangci-lint from 1.53.2 to
1.53.3 ([#996](https://github.com/cometbft/cometbft/pull/996))**
- **build(deps): Bump github.com/prometheus/client_golang from 1.15.1 to
1.16.0 ([#991](https://github.com/cometbft/cometbft/pull/991))**
- **spec/p2p: new structure for the p2p specification ([#966](https://github.com/cometbft/cometbft/pull/966))**
- **consensus: optimize vote and block part gossip with
HasProposalBlockPartMessage and random sleeps ([#904](https://github.com/cometbft/cometbft/pull/904))**
- **Extend ABCI `max_block_size` parameter to give extended control to
the app ([#1003](https://github.com/cometbft/cometbft/pull/1003))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.21.0 to 1.22.0
([#1026](https://github.com/cometbft/cometbft/pull/1026))**
- **Bump logs on non-fatal vote validation failures to Info level
([#1022](https://github.com/cometbft/cometbft/pull/1022))**
- **Update codeowners to include DevRel team ([#1023](https://github.com/cometbft/cometbft/pull/1023))**
- **deps: Manually bump github.com/vektra/mockery/v2 from 2.29.0 to
2.30.1 ([#1009](https://github.com/cometbft/cometbft/pull/1009))**
- **Update releasing.md to sign tags ([#1034](https://github.com/cometbft/cometbft/pull/1034))**
- **build(deps): Bump github.com/bufbuild/buf from 1.21.0 to 1.22.0
([#1027](https://github.com/cometbft/cometbft/pull/1027))**
- **Rename ABCI enums and values to satisfy buf guidelines ([#975](https://github.com/cometbft/cometbft/pull/975))**
- **build(deps): Bump google.golang.org/grpc from 1.56.0 to 1.56.1
([#1028](https://github.com/cometbft/cometbft/pull/1028))**
- **docs: Added double quotes to /abci_query path param ([#1015](https://github.com/cometbft/cometbft/pull/1015))**
- **Update Docs with Finalize Block ([#760](https://github.com/cometbft/cometbft/pull/760))**
- **Clarifies that processProposal may be called for set of transactions
different from the one returned in the preceding prepareProposal
([#1033](https://github.com/cometbft/cometbft/pull/1033))**
- **Update the annotation of part_set.go ([#1056](https://github.com/cometbft/cometbft/pull/1056))**
- **build(deps): Bump docker/setup-buildx-action from 2.7.0 to 2.8.0
([#1071](https://github.com/cometbft/cometbft/pull/1071))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.1 to
2.30.16 ([#1064](https://github.com/cometbft/cometbft/pull/1064))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.22.0 to 1.23.1
([#1072](https://github.com/cometbft/cometbft/pull/1072))**
- **build(deps): Bump github.com/bufbuild/buf from 1.22.0 to 1.23.1
([#1066](https://github.com/cometbft/cometbft/pull/1066))**
- **build(deps): Bump google.golang.org/protobuf from 1.30.0 to 1.31.0
([#1065](https://github.com/cometbft/cometbft/pull/1065))**
- **build(deps): Bump google.golang.org/grpc from 1.56.1 to 1.56.2
([#1101](https://github.com/cometbft/cometbft/pull/1101))**
- **build(deps): Bump golang.org/x/crypto from 0.10.0 to 0.11.0
([#1103](https://github.com/cometbft/cometbft/pull/1103))**
- **build(deps): Bump docker/setup-buildx-action from 2.8.0 to 2.9.0
([#1105](https://github.com/cometbft/cometbft/pull/1105))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.30.16 to
2.31.1 ([#1100](https://github.com/cometbft/cometbft/pull/1100))**
- **build(deps): Bump golang.org/x/net from 0.11.0 to 0.12.0 ([#1102](https://github.com/cometbft/cometbft/pull/1102))**
- **ci: Trigger workflows on merge group ([#1118](https://github.com/cometbft/cometbft/pull/1118))**
- **Revert "config: add bootstrap peers (#9680)" ([#1109](https://github.com/cometbft/cometbft/pull/1109))**
- **node: Revert removal of public reactor accessors ([#1120](https://github.com/cometbft/cometbft/pull/1120))**
- **ci: Disable CodeQL check in merge queues ([#1123](https://github.com/cometbft/cometbft/pull/1123))**
- **p2p: Remove UPnP functionality ([#1114](https://github.com/cometbft/cometbft/pull/1114))**
- **ADR 107: Rename proto versions to pre-v1 betas ([#1110](https://github.com/cometbft/cometbft/pull/1110))**
- **RFC 104: Internal messaging using the actor model ([#1092](https://github.com/cometbft/cometbft/pull/1092))**
- **build(deps): Bump github.com/bufbuild/buf from 1.23.1 to 1.24.0
([#1131](https://github.com/cometbft/cometbft/pull/1131))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.31.1 to 2.32.0
([#1132](https://github.com/cometbft/cometbft/pull/1132))**
- **build(deps): Bump docker/setup-buildx-action from 2.9.0 to 2.9.1
([#1133](https://github.com/cometbft/cometbft/pull/1133))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.23.1 to 1.24.0
([#1134](https://github.com/cometbft/cometbft/pull/1134))**
- **spec: Add mempool specification in English and Quint ([#997](https://github.com/cometbft/cometbft/pull/997))**
- **mempool: ADR for refactoring list of senders  ([#1032](https://github.com/cometbft/cometbft/pull/1032))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.24.0 to 1.25.0
([#1157](https://github.com/cometbft/cometbft/pull/1157))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.7.0 to 5.8.0
([#1159](https://github.com/cometbft/cometbft/pull/1159))**
- **build(deps): Bump github.com/bufbuild/buf from 1.24.0 to 1.25.0
([#1160](https://github.com/cometbft/cometbft/pull/1160))**
- **proxy: Rename "unsynchronized" to "connection-synchronized" local
client creator ([#1145](https://github.com/cometbft/cometbft/pull/1145))**
- **mempool: Keep track of senders in reactor instead of implementation
([#1010](https://github.com/cometbft/cometbft/pull/1010))**
- **cmd: Remove `replay` and `replay-console` subcommands ([#1170](https://github.com/cometbft/cometbft/pull/1170))**
- **build(deps): Bump google.golang.org/grpc from 1.56.2 to 1.57.0
([#1181](https://github.com/cometbft/cometbft/pull/1181))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.0 to 5.8.1
([#1180](https://github.com/cometbft/cometbft/pull/1180))**
- **ci: Remove Mergify automerge ([#1182](https://github.com/cometbft/cometbft/pull/1182))**
- **Add gRPC block service ([#1142](https://github.com/cometbft/cometbft/pull/1142))**
- **blocksync: export errors ([#1186](https://github.com/cometbft/cometbft/pull/1186))**
- **Porting changes related to creating a lean docker image from
`pierre/fast-prototyping-1059` branch. ([#1192](https://github.com/cometbft/cometbft/pull/1192))**
- **chore: Format repo ([#1193](https://github.com/cometbft/cometbft/pull/1193))**
- **Add BlockResults gRPC service ([#1168](https://github.com/cometbft/cometbft/pull/1168))**
- **consensus: remove logic to unlock block on +2/3 prevote for nil
([#1175](https://github.com/cometbft/cometbft/pull/1175))**
- **ADR 101: Add GetLatest method to block service ([#1209](https://github.com/cometbft/cometbft/pull/1209))**
- **ADR 101: Implement pruning mechanism ([#1150](https://github.com/cometbft/cometbft/pull/1150))**
- **config: export errors ([#1190](https://github.com/cometbft/cometbft/pull/1190))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.0 to 2.32.3
([#1218](https://github.com/cometbft/cometbft/pull/1218))**
- **Add check for non-`nil` in `enterCommit` ([#1208](https://github.com/cometbft/cometbft/pull/1208))**
- **Log proposer's address when correctly accepting a proposal ([#1079](https://github.com/cometbft/cometbft/pull/1079))**
- **Close evidence.db OnStop ([#1210](https://github.com/cometbft/cometbft/pull/1210))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.0 to 1.25.1
([#1213](https://github.com/cometbft/cometbft/pull/1213))**
- **build(deps): Bump golang.org/x/crypto from 0.11.0 to 0.12.0
([#1215](https://github.com/cometbft/cometbft/pull/1215))**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.0 to 1.25.1
([#1216](https://github.com/cometbft/cometbft/pull/1216))**
- **build(deps): Bump golang.org/x/net from 0.12.0 to 0.14.0 ([#1217](https://github.com/cometbft/cometbft/pull/1217))**
- **Forward-port: update state to prevote `nil` when proposal block does
not match locked block ([#1203](https://github.com/cometbft/cometbft/pull/1203))**
- **mempool: Store peer ids as p2p.ID instead of uint16 (remove
mempoolIDs) ([#1191](https://github.com/cometbft/cometbft/pull/1191))**
- **ADR-101: implement gRPC `PruningService` ([#1154](https://github.com/cometbft/cometbft/pull/1154))**
- **consensus: Avoid process proposal when we know correct nodes
validated it ([#1231](https://github.com/cometbft/cometbft/pull/1231))**
- **ADR-101: Metrics to monitor the pruning  ([#1234](https://github.com/cometbft/cometbft/pull/1234))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.25.1 to 1.26.0
([#1241](https://github.com/cometbft/cometbft/pull/1241))**
- **build(deps): Bump github.com/bufbuild/buf from 1.25.1 to 1.26.1
([#1239](https://github.com/cometbft/cometbft/pull/1239))**
- **build(deps): Bump github.com/golangci/golangci-lint ([#1240](https://github.com/cometbft/cometbft/pull/1240))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.3 to 2.32.4
([#1242](https://github.com/cometbft/cometbft/pull/1242))**
- **abci: export errors  ([#1185](https://github.com/cometbft/cometbft/pull/1185))**
- **consensus: export errors ([#1211](https://github.com/cometbft/cometbft/pull/1211))**
- **ADR-101: Pruning mechanism minor fixes ([#1246](https://github.com/cometbft/cometbft/pull/1246))**
- **chore: Bump minimum Go version on `main` to v1.21 ([#1244](https://github.com/cometbft/cometbft/pull/1244))**
- **ADR 101: Add `Close` method to gRPC client ([#1251](https://github.com/cometbft/cometbft/pull/1251))**
- **ADR 108: ADR for extending E2E infrastructure so that we can check
CometBFT's behaviour with respect to ABCI++ grammar. ([#902](https://github.com/cometbft/cometbft/pull/902))**
- **docs: Add logging guide to contributing guidelines ([#1250](https://github.com/cometbft/cometbft/pull/1250))**
- **chore: log `app_hash` as hex ([#1264](https://github.com/cometbft/cometbft/pull/1264))**
- **update language ([#1263](https://github.com/cometbft/cometbft/pull/1263))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.0 to 1.26.1
([#1272](https://github.com/cometbft/cometbft/pull/1272))**
- **build(deps): Bump gonum.org/v1/gonum from 0.13.0 to 0.14.0 ([#1275](https://github.com/cometbft/cometbft/pull/1275))**
- **build(deps): Bump github.com/cosmos/gogoproto from 1.4.10 to 1.4.11
([#1276](https://github.com/cometbft/cometbft/pull/1276))**
- **ADR 101: Refactor height check-related logic and tests ([#1271](https://github.com/cometbft/cometbft/pull/1271))**
- **Fixed linter**
- **Revert "Fixed linter"**
- **Fixed mem aliasing in for loop ([#1280](https://github.com/cometbft/cometbft/pull/1280))**
- **Remove genesis persistence in state db ([#1017](https://github.com/cometbft/cometbft/pull/1017))**
- **Revert "Remove genesis persistence in state db ([#1017](https://github.com/cometbft/cometbft/pull/1017))" ([#1294](https://github.com/cometbft/cometbft/pull/1294))**
- **evidence: export errors ([#1284](https://github.com/cometbft/cometbft/pull/1284))**
- **Re-implement removal of genesis persistence in state db ([#1295](https://github.com/cometbft/cometbft/pull/1295))**
- **build(deps): Bump docker/setup-buildx-action from 2.9.1 to 2.10.0
([#1298](https://github.com/cometbft/cometbft/pull/1298))**
- **node: verify genesis doc hash against the file contents rather than
remarshalled JSON ([#1293](https://github.com/cometbft/cometbft/pull/1293))**
- **indexer: Implement pruning mechanism ([#1176](https://github.com/cometbft/cometbft/pull/1176))**
- **Provide relevant block data in `ExtendVote` ([#1270](https://github.com/cometbft/cometbft/pull/1270))**
- **node/state:bootstrap state api ([#1057](https://github.com/cometbft/cometbft/pull/1057))**
- **build(deps): Bump actions/checkout from 3 to 4 ([#1319](https://github.com/cometbft/cometbft/pull/1319))**
- **build(deps): Bump docker/build-push-action from 4.1.1 to 4.2.1
([#1318](https://github.com/cometbft/cometbft/pull/1318))**
- **Fix ([#1323](https://github.com/cometbft/cometbft/pull/1323))**
- **state: remove genesis file from database  ([#1297](https://github.com/cometbft/cometbft/pull/1297))**
- **Added changelog for pruning metrics ([#1335](https://github.com/cometbft/cometbft/pull/1335))**
- **Removed begin_block_events and end_block_events from rpc doc
([#1338](https://github.com/cometbft/cometbft/pull/1338))**
- **consensus: test for precommit/locking corner case ([#1257](https://github.com/cometbft/cometbft/pull/1257))**
- **TxIndexer and BlockIndexer pruning metrics ([#1334](https://github.com/cometbft/cometbft/pull/1334))**
- **Forward port changes to changelog and `UPGRADING.md` for release
`v0.38.0` ([#1341](https://github.com/cometbft/cometbft/pull/1341))**
- **Update Go version specified in root README on main for v0.34.x
([#1352](https://github.com/cometbft/cometbft/pull/1352))**
- **Add test/e2e/data to gitignore ([#1349](https://github.com/cometbft/cometbft/pull/1349))**
- **docs: gRPC services and data companion pruning services ([#1307](https://github.com/cometbft/cometbft/pull/1307))**
- **Add genesis_hash flag check on node startup ([#1324](https://github.com/cometbft/cometbft/pull/1324))**
- **gRPC for Tx and Block indexer pruning ([#1327](https://github.com/cometbft/cometbft/pull/1327))**
- **build(deps): Bump docker/build-push-action from 4.2.1 to 5.0.0
([#1371](https://github.com/cometbft/cometbft/pull/1371))**
- **build(deps): Bump docker/setup-buildx-action from 2.10.0 to 3.0.0
([#1370](https://github.com/cometbft/cometbft/pull/1370))**
- **build(deps): Bump docker/login-action from 2.2.0 to 3.0.0 ([#1368](https://github.com/cometbft/cometbft/pull/1368))**
- **build(deps): Bump goreleaser/goreleaser-action from 4 to 5 ([#1369](https://github.com/cometbft/cometbft/pull/1369))**
- **ADR101: Moved changelog entries ([#1377](https://github.com/cometbft/cometbft/pull/1377))**
- **Max byte check ([#1384](https://github.com/cometbft/cometbft/pull/1384))**
- **Update to string ([#1385](https://github.com/cometbft/cometbft/pull/1385))**
- **mempool: Remove unused peerID constants ([#1379](https://github.com/cometbft/cometbft/pull/1379))**
- **build(deps): Bump github.com/google/uuid from 1.3.0 to 1.3.1
([#1392](https://github.com/cometbft/cometbft/pull/1392))**
- **build(deps): Bump github.com/rs/cors from 1.9.0 to 1.10.0 ([#1393](https://github.com/cometbft/cometbft/pull/1393))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.8.1 to 5.9.0
([#1396](https://github.com/cometbft/cometbft/pull/1396))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.32.4 to 2.34.0
([#1400](https://github.com/cometbft/cometbft/pull/1400))**
- **build(deps): Bump github.com/go-kit/kit from 0.12.0 to 0.13.0
([#1397](https://github.com/cometbft/cometbft/pull/1397))**
- **build(deps): Bump github.com/golangci/golangci-lint ([#1398](https://github.com/cometbft/cometbft/pull/1398))**
- **build(deps): Bump google.golang.org/grpc from 1.57.0 to 1.58.2
([#1399](https://github.com/cometbft/cometbft/pull/1399))**
- **doc: improve documentation of BlockParams.MaxBytes ([#1405](https://github.com/cometbft/cometbft/pull/1405))**
- **rpc: Improve abci_query parameter documentation ([#1184](https://github.com/cometbft/cometbft/pull/1184))**
- **Bump p2p version following introduction of
`HasProposalBlockPartMessage` ([#1411](https://github.com/cometbft/cometbft/pull/1411))**
- **RFC: Allowing Non-Determinism in `ProcessProposal` ([#1391](https://github.com/cometbft/cometbft/pull/1391))**
- **ADR-101: Data Companion Pull API ([#82](https://github.com/cometbft/cometbft/pull/82))**
- **build(deps): Bump github.com/rs/cors from 1.10.0 to 1.10.1 ([#1418](https://github.com/cometbft/cometbft/pull/1418))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.0 to 2.34.2
([#1416](https://github.com/cometbft/cometbft/pull/1416))**
- **build(deps): Bump github.com/prometheus/client_golang ([#1417](https://github.com/cometbft/cometbft/pull/1417))**
- **fix typos ([#1413](https://github.com/cometbft/cometbft/pull/1413))**
- **Renames Tendermint to CometBFT in the RPC related test code
([#1428](https://github.com/cometbft/cometbft/pull/1428))**
- **Renames Tendermint to CometBFT in the RPC related test code. This
file was missing and it was not caught in the branch testing. ([#1433](https://github.com/cometbft/cometbft/pull/1433))**
- **Reject incoming txs while node is catching up ([#1119](https://github.com/cometbft/cometbft/pull/1119))**
- **build(deps): Bump golang.org/x/crypto from 0.13.0 to 0.14.0
([#1458](https://github.com/cometbft/cometbft/pull/1458))**
- **build(deps): Bump golang.org/x/sync from 0.3.0 to 0.4.0 ([#1454](https://github.com/cometbft/cometbft/pull/1454))**
- **build(deps): Bump golang.org/x/net from 0.15.0 to 0.16.0 ([#1453](https://github.com/cometbft/cometbft/pull/1453))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.26.1 to 1.27.0
([#1449](https://github.com/cometbft/cometbft/pull/1449))**
- **build(deps): Bump styfle/cancel-workflow-action from 0.11.0 to
0.12.0 ([#1450](https://github.com/cometbft/cometbft/pull/1450))**
- **build(deps): Bump github.com/prometheus/client_model ([#1455](https://github.com/cometbft/cometbft/pull/1455))**
- **build(deps): Bump github.com/bufbuild/buf from 1.26.1 to 1.27.0
([#1459](https://github.com/cometbft/cometbft/pull/1459))**
- **build(deps): Bump github.com/spf13/viper from 1.16.0 to 1.17.0
([#1456](https://github.com/cometbft/cometbft/pull/1456))**
- **test: respect P2PConfig fuzzing configuration in MultiplexTransport
([#1414](https://github.com/cometbft/cometbft/pull/1414))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.34.2 to 2.35.3
([#1462](https://github.com/cometbft/cometbft/pull/1462))**
- **crypto: export errors ([#1463](https://github.com/cometbft/cometbft/pull/1463))**
- **Do not race with pruning to validate headers and validators
([#1467](https://github.com/cometbft/cometbft/pull/1467))**
- **fix typos ([#1487](https://github.com/cometbft/cometbft/pull/1487))**
- **Call observer only when retain height changes ([#1490](https://github.com/cometbft/cometbft/pull/1490))**
- **build(deps): Bump pillow from 9.3.0 to 10.0.1 in
/scripts/qa/reporting ([#1493](https://github.com/cometbft/cometbft/pull/1493))**
- **abci: Add relaxed local client synchronization models ([#1141](https://github.com/cometbft/cometbft/pull/1141))**
- **docs: fix typos ([#1500](https://github.com/cometbft/cometbft/pull/1500))**
- **Post-merge fixes for feature/proto-upgrade**
- **Make BuildLastCommitInfo and BuildExtendedCommitInfo public
([#1502](https://github.com/cometbft/cometbft/pull/1502))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.3 to 2.35.4
([#1497](https://github.com/cometbft/cometbft/pull/1497))**
- **build(deps): Bump google.golang.org/grpc from 1.58.2 to 1.58.3
([#1498](https://github.com/cometbft/cometbft/pull/1498))**
- **build(deps): Bump golang.org/x/net from 0.16.0 to 0.17.0 ([#1499](https://github.com/cometbft/cometbft/pull/1499))**
- **tiny change: reorder expected and actual values ([#1506](https://github.com/cometbft/cometbft/pull/1506))**
- **Fixed docker port alias ([#1507](https://github.com/cometbft/cometbft/pull/1507))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.0 to 1.27.1
([#1527](https://github.com/cometbft/cometbft/pull/1527))**
- **Implement ADR-107: rename proto package version suffixes to v1beta*
pattern ([#1510](https://github.com/cometbft/cometbft/pull/1510))**
- **e2e: Fix flakiness in grpc tests due to pruning ([#1492](https://github.com/cometbft/cometbft/pull/1492))**
- **fix spelling of bandwidth ([#1534](https://github.com/cometbft/cometbft/pull/1534))**
- **Fix linting on `main` ([#1531](https://github.com/cometbft/cometbft/pull/1531))**
- **build(deps): Bump github.com/prometheus/common from 0.44.0 to 0.45.0
([#1524](https://github.com/cometbft/cometbft/pull/1524))**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.0 to 1.27.1
([#1522](https://github.com/cometbft/cometbft/pull/1522))**
- **build(deps): Bump github.com/golangci/golangci-lint ([#1540](https://github.com/cometbft/cometbft/pull/1540))**
- **fix some typos ([#1541](https://github.com/cometbft/cometbft/pull/1541))**
- **indexer-respect-height-params-on-query ([#1529](https://github.com/cometbft/cometbft/pull/1529))**
- **Correct go_package paths in service proto files ([#1538](https://github.com/cometbft/cometbft/pull/1538))**
- **build(deps): Bump google.golang.org/grpc from 1.58.3 to 1.59.0
([#1521](https://github.com/cometbft/cometbft/pull/1521))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.35.4 to 2.36.0
([#1523](https://github.com/cometbft/cometbft/pull/1523))**
- **feat(mempool): export error ([#1427](https://github.com/cometbft/cometbft/pull/1427))**
- **Rename proto messages and services to satisfy default buf lints
([#1533](https://github.com/cometbft/cometbft/pull/1533))**
- **RFC 106: non-idempotent methods in data companion ([#1545](https://github.com/cometbft/cometbft/pull/1545))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.0
([#1550](https://github.com/cometbft/cometbft/pull/1550))**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.1 to 1.27.2
([#1551](https://github.com/cometbft/cometbft/pull/1551))**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
([#1552](https://github.com/cometbft/cometbft/pull/1552))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.1 to 1.27.2
([#1553](https://github.com/cometbft/cometbft/pull/1553))**
- **use assert.Greater instead of Equal for better error reporting
([#1547](https://github.com/cometbft/cometbft/pull/1547))**
- **rpc: Version the RPC APIs ([#1412](https://github.com/cometbft/cometbft/pull/1412))**
- **mempool: Add metric size of pool in bytes ([#1512](https://github.com/cometbft/cometbft/pull/1512))**
- **build(deps): Bump github.com/docker/docker ([#1570](https://github.com/cometbft/cometbft/pull/1570))**
- **build(deps): Bump github.com/spf13/cobra from 1.7.0 to 1.8.0
([#1572](https://github.com/cometbft/cometbft/pull/1572))**
- **build(deps): Bump golang.org/x/sync from 0.4.0 to 0.5.0 ([#1574](https://github.com/cometbft/cometbft/pull/1574))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.0 to 2.36.1
([#1576](https://github.com/cometbft/cometbft/pull/1576))**
- **build(deps): Bump github.com/gorilla/websocket from 1.5.0 to 1.5.1
([#1575](https://github.com/cometbft/cometbft/pull/1575))**
- **build(deps): Bump github.com/golangci/golangci-lint ([#1573](https://github.com/cometbft/cometbft/pull/1573))**
- **chore: consolidate changelog improvements section ([#1578](https://github.com/cometbft/cometbft/pull/1578))**
- **Implementation of ADR-108 ([#930](https://github.com/cometbft/cometbft/pull/930))**
- **Reduce the default MaxBytes to 4mb and increase MaxGas to 10 million
([#1518](https://github.com/cometbft/cometbft/pull/1518))**
- **e2e: Allow disabling the PEX reactor on all nodes in the testnet
([#1580](https://github.com/cometbft/cometbft/pull/1580))**
- **Experimental - Reduce # of connections effectively used to gossip
transactions out ([#1558](https://github.com/cometbft/cometbft/pull/1558))**
- **Update proto file references to follow renaming/versioning ([#1555](https://github.com/cometbft/cometbft/pull/1555))**
- **Make `LoadBlock` also return block metadata ([#1557](https://github.com/cometbft/cometbft/pull/1557))**
- **mempool: Limit gossip connections to persistent and non-persistent
peers (experimental) ([#1584](https://github.com/cometbft/cometbft/pull/1584))**
- **fix: docs: default db provider moved from node to config ([#1588](https://github.com/cometbft/cometbft/pull/1588))**
- **build(deps): Bump github.com/bufbuild/buf from 1.27.2 to 1.28.0
([#1598](https://github.com/cometbft/cometbft/pull/1598))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.27.2 to 1.28.0
([#1602](https://github.com/cometbft/cometbft/pull/1602))**
- **build(deps): Bump golang.org/x/crypto from 0.14.0 to 0.15.0
([#1599](https://github.com/cometbft/cometbft/pull/1599))**
- **build(deps): Bump golang.org/x/net from 0.17.0 to 0.18.0 ([#1597](https://github.com/cometbft/cometbft/pull/1597))**
- **RFC 107: Internal signalling using event observers ([#1164](https://github.com/cometbft/cometbft/pull/1164))**
- **ADR 110: Remote mempool ([#1565](https://github.com/cometbft/cometbft/pull/1565))**
- **chore: aligns function descriptions with godoc standards in the
types package ([#1593](https://github.com/cometbft/cometbft/pull/1593))**
- **docs: various improvements ([#1603](https://github.com/cometbft/cometbft/pull/1603))**
- **chore: Merge branch main into feature/proto-upgrade ([#1612](https://github.com/cometbft/cometbft/pull/1612))**
- **Removes wrong assertion and decreases likelyhood of block from the
future has actually been already created ([#1619](https://github.com/cometbft/cometbft/pull/1619))**
- **Split /api off to separate go.mod ([#1608](https://github.com/cometbft/cometbft/pull/1608))**
- **feature: Reduce Go API surface area (ADR 109) ([#1605](https://github.com/cometbft/cometbft/pull/1605))**
- **refactor: Export func MakeHTTPDialer ([#1594](https://github.com/cometbft/cometbft/pull/1594))**
- **First draft ([#1483](https://github.com/cometbft/cometbft/pull/1483))**
- **pruning:do not attempt to prune state if no blocks are pruned
([#1616](https://github.com/cometbft/cometbft/pull/1616))**
- **Update SECURITY.md ([#1626](https://github.com/cometbft/cometbft/pull/1626))**
- **Update changelog on `main` with new releases ([#1644](https://github.com/cometbft/cometbft/pull/1644))**
- **proto: Update README ([#1648](https://github.com/cometbft/cometbft/pull/1648))**
- **ADR 111: `nop` Mempool ([#1585](https://github.com/cometbft/cometbft/pull/1585))**
- **ADR-111: Addressed Ethan's comment ([#1667](https://github.com/cometbft/cometbft/pull/1667))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.36.1 to 2.37.1
([#1662](https://github.com/cometbft/cometbft/pull/1662))**
- **build(deps): Bump docker/build-push-action from 5.0.0 to 5.1.0
([#1664](https://github.com/cometbft/cometbft/pull/1664))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.0 to 1.28.1
([#1665](https://github.com/cometbft/cometbft/pull/1665))**
- **ci: Fix v0.34 nightly build ([#1655](https://github.com/cometbft/cometbft/pull/1655))**
- **build(deps): Bump github.com/bufbuild/buf from 1.28.0 to 1.28.1
([#1663](https://github.com/cometbft/cometbft/pull/1663))**
- **feature/proto-upgrade: Fix generated mock code ([#1673](https://github.com/cometbft/cometbft/pull/1673))**
- **Update link in README.md ([#1674](https://github.com/cometbft/cometbft/pull/1674))**
- **Renames the semantic versioning variable to CMT ([#1621](https://github.com/cometbft/cometbft/pull/1621))**
- **mempool: add `nop` mempool ([#1643](https://github.com/cometbft/cometbft/pull/1643))**
- **e2e:fix-digital-ocean-ports ([#1678](https://github.com/cometbft/cometbft/pull/1678))**
- **Revert modularization of the test infra ([#1488](https://github.com/cometbft/cometbft/pull/1488)) ([#1676](https://github.com/cometbft/cometbft/pull/1676))**
- **docs: various small improvements (part 2) ([#1683](https://github.com/cometbft/cometbft/pull/1683))**
- **Do not block indefinitely on the semaphore ([#1654](https://github.com/cometbft/cometbft/pull/1654))**
- **Adds tests that check for FIFO ordering being broken by gossip
([#1628](https://github.com/cometbft/cometbft/pull/1628))**
- **loadtime: Add parameter for displaying results in one line ([#1511](https://github.com/cometbft/cometbft/pull/1511))**
- **Promote latest versions of Protobuf definitions to v1 packages
([#1677](https://github.com/cometbft/cometbft/pull/1677))**
- **chore: Update CHANGELOG.md ([#1701](https://github.com/cometbft/cometbft/pull/1701))**
- **build(deps): Bump github.com/google/uuid from 1.3.1 to 1.4.0
([#1696](https://github.com/cometbft/cometbft/pull/1696))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.37.1 to 2.38.0
([#1697](https://github.com/cometbft/cometbft/pull/1697))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.9.0 to 5.10.1
([#1702](https://github.com/cometbft/cometbft/pull/1702))**
- **proto: document the `cometbft.*` versioned protos ([#1694](https://github.com/cometbft/cometbft/pull/1694))**
- **Clean up changelog entries and README files for versioned proto
changes ([#1707](https://github.com/cometbft/cometbft/pull/1707))**
- **chore(proto): add missing docs ([#1703](https://github.com/cometbft/cometbft/pull/1703))**
- **feature/proto-upgrade: Last-minute fixes ([#1709](https://github.com/cometbft/cometbft/pull/1709))**
- **e2e: Support emulated latencies between docker images ([#1560](https://github.com/cometbft/cometbft/pull/1560))**
- **build(deps): Bump golang.org/x/net from 0.14.0 to 0.17.0 in /api
([#1713](https://github.com/cometbft/cometbft/pull/1713))**
- **Prepare `main` for `v1.x` backport branch ([#1714](https://github.com/cometbft/cometbft/pull/1714))**
- **build(deps): Bump golang.org/x/crypto from 0.15.0 to 0.16.0
([#1720](https://github.com/cometbft/cometbft/pull/1720))**
- **build(deps): Bump golang.org/x/net from 0.18.0 to 0.19.0 ([#1719](https://github.com/cometbft/cometbft/pull/1719))**
- **types: validate Validator#Address field ([#1715](https://github.com/cometbft/cometbft/pull/1715))**
- **Enable Mergify backports for `v1.x` branch ([#1724](https://github.com/cometbft/cometbft/pull/1724))**
- **deps: Bump cometbft-db to v0.9.0 ([#1725](https://github.com/cometbft/cometbft/pull/1725))**
- **buf improvements prior to publishing on BSR ([#1726](https://github.com/cometbft/cometbft/pull/1726))**
- **proto: give our buf module a name ([#1734](https://github.com/cometbft/cometbft/pull/1734))**
- **deps: Bump cometbft-db to v0.9.1 ([#1737](https://github.com/cometbft/cometbft/pull/1737))**
- **chore: Update root docs ([#1740](https://github.com/cometbft/cometbft/pull/1740))**
- **fix: increase abci socket message size limit to 2GB ([#1730](https://github.com/cometbft/cometbft/pull/1730))**
- **proto: make comment in README more Markdowny ([#1743](https://github.com/cometbft/cometbft/pull/1743))**
- **fix: Txs Validate ([#1687](https://github.com/cometbft/cometbft/pull/1687))**
- **Add test missing in [#1687](https://github.com/cometbft/cometbft/pull/1687) ([#1712](https://github.com/cometbft/cometbft/pull/1712))**
- **perf(state): batch save `State` ([#1735](https://github.com/cometbft/cometbft/pull/1735))**
- **Update CODE_OF_CONDUCT.md ([#1708](https://github.com/cometbft/cometbft/pull/1708))**
- **[e2e] Fixes prepareProposal not to return oversized set of
transactions ([#1756](https://github.com/cometbft/cometbft/pull/1756))**
- **perf(store): Batch save `Block` ([#1755](https://github.com/cometbft/cometbft/pull/1755))**
- **Fix: Fix minor typos ([#1780](https://github.com/cometbft/cometbft/pull/1780))**
- **`VerifyCommitLight` and `VerifyCommitLightTrusting` _never_ check
all signatures ([#1750](https://github.com/cometbft/cometbft/pull/1750))**
- **Fix typo in encoding.md ([#1801](https://github.com/cometbft/cometbft/pull/1801))**
- **chore(docs): small improvements ([#1781](https://github.com/cometbft/cometbft/pull/1781))**
- **build(deps): Bump github.com/go-git/go-git/v5 from 5.10.1 to 5.11.0
([#1797](https://github.com/cometbft/cometbft/pull/1797))**
- **build(deps): Bump actions/setup-go from 4 to 5 ([#1794](https://github.com/cometbft/cometbft/pull/1794))**
- **build(deps): Bump actions/stale from 8 to 9 ([#1795](https://github.com/cometbft/cometbft/pull/1795))**
- **build(deps): Bump github.com/spf13/viper from 1.17.0 to 1.18.1
([#1796](https://github.com/cometbft/cometbft/pull/1796))**
- **Chore/fix other typos ([#1809](https://github.com/cometbft/cometbft/pull/1809))**
- **chore(spec): specify which fields must be deterministic ([#1804](https://github.com/cometbft/cometbft/pull/1804))**
- **Small improvements in [#1806](https://github.com/cometbft/cometbft/pull/1806) not present in [#1750](https://github.com/cometbft/cometbft/pull/1750) ([#1808](https://github.com/cometbft/cometbft/pull/1808))**
- **Add changelog for [#1749](https://github.com/cometbft/cometbft/issues/1749) ([#1807](https://github.com/cometbft/cometbft/pull/1807))**
- **e2e: Implement latency emulation for DigitalOcean ([#1587](https://github.com/cometbft/cometbft/pull/1587))**
- **add GH workflow for linting code using codespell ([#1824](https://github.com/cometbft/cometbft/pull/1824))**
- **chore(docs): explain the effect of `timeout_propose` ([#1798](https://github.com/cometbft/cometbft/pull/1798))**
- **build(deps): Bump actions/upload-artifact from 3 to 4 ([#1845](https://github.com/cometbft/cometbft/pull/1845))**
- **build(deps): Bump actions/setup-python from 2 to 5 ([#1843](https://github.com/cometbft/cometbft/pull/1843))**
- **build(deps): Bump github/codeql-action from 2 to 3 ([#1847](https://github.com/cometbft/cometbft/pull/1847))**
- **build(deps): Bump actions/checkout from 2 to 4 ([#1846](https://github.com/cometbft/cometbft/pull/1846))**
- **build(deps): Bump github.com/google/uuid from 1.4.0 to 1.5.0
([#1850](https://github.com/cometbft/cometbft/pull/1850))**
- **build(deps): Bump google.golang.org/grpc from 1.59.0 to 1.60.0
([#1851](https://github.com/cometbft/cometbft/pull/1851))**
- **golangci-lint: enable all the linters by default ([#1838](https://github.com/cometbft/cometbft/pull/1838))**
- **Updates go crypto package to v0.17.0 ([#1859](https://github.com/cometbft/cometbft/pull/1859))**
- **Adds checks for nil keys and signatures ([#1855](https://github.com/cometbft/cometbft/pull/1855))**
- **The store DB and the companion `BlockStore` struct are sometimes out
of sync ([#1856](https://github.com/cometbft/cometbft/pull/1856))**
- **Allow blocksync to not verify all signatures ([#1858](https://github.com/cometbft/cometbft/pull/1858))**
- **Fixing the ABCI grammar and updating the code for e2e tests to
account for the new grammar. ([#1829](https://github.com/cometbft/cometbft/pull/1829))**
- **docs: Fix Discord links in README ([#1874](https://github.com/cometbft/cometbft/pull/1874))**
- **build(deps): Bump github.com/prometheus/client_golang ([#1909](https://github.com/cometbft/cometbft/pull/1909))**
- **build(deps): Bump github.com/btcsuite/btcd/btcutil from 1.1.3 to
1.1.5 ([#1908](https://github.com/cometbft/cometbft/pull/1908))**
- **build(deps): Bump google.golang.org/protobuf ([#1885](https://github.com/cometbft/cometbft/pull/1885))**
- **build(deps): Bump github.com/spf13/viper from 1.18.1 to 1.18.2
([#1884](https://github.com/cometbft/cometbft/pull/1884))**
- **build(deps): Bump google.golang.org/grpc from 1.60.0 to 1.60.1
([#1883](https://github.com/cometbft/cometbft/pull/1883))**
- **remove unused linters that produced a warning and ensure that
unparam is enabled ([#1905](https://github.com/cometbft/cometbft/pull/1905))**
- **Fix HTTP response body not being closed after reading ([#1945](https://github.com/cometbft/cometbft/pull/1945))**
- **Disable undesired linting code ([#1959](https://github.com/cometbft/cometbft/pull/1959))**
- **Extend kvstore example add with with key types ([#1876](https://github.com/cometbft/cometbft/pull/1876))**
- **Extra check in `VerifyExtension` ([#1877](https://github.com/cometbft/cometbft/pull/1877))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.38.0 to 2.39.1
([#1882](https://github.com/cometbft/cometbft/pull/1882))**
- **perf(crypto/merkle, crypto/tmhash): simplify+optimize SHA256 hashing
of multiple byteslices ([#1921](https://github.com/cometbft/cometbft/pull/1921))**
- **Update localnet-start Makefile ([#1975](https://github.com/cometbft/cometbft/pull/1975))**
- **blocksync: wait for poolRoutine to stop in (*Reactor).OnStop
([#1879](https://github.com/cometbft/cometbft/pull/1879))**
- **fix TestListenerTimeoutReadWrite ([#1947](https://github.com/cometbft/cometbft/pull/1947))**
- **docs: fix typos ([#1988](https://github.com/cometbft/cometbft/pull/1988))**
- **this is the kindest commit I can think of. Take it that way and read
the code. ([#1987](https://github.com/cometbft/cometbft/pull/1987))**
- **there's really no need for this anymore ([#1986](https://github.com/cometbft/cometbft/pull/1986))**
- **feat: DefaultHttpClient support setting proxy from env ([#1900](https://github.com/cometbft/cometbft/pull/1900))**
- **feat: lint tests ([#1906](https://github.com/cometbft/cometbft/pull/1906))**
- **chore: fix typos ([#1991](https://github.com/cometbft/cometbft/pull/1991))**
- **build(deps): Bump golang.org/x/sync from 0.5.0 to 0.6.0 ([#1992](https://github.com/cometbft/cometbft/pull/1992))**
- **feat(proxy): export errors ([#1899](https://github.com/cometbft/cometbft/pull/1899))**
- **doc:fix broken link in DOCKER/README.md ([#1996](https://github.com/cometbft/cometbft/pull/1996))**
- **feat: custom dependencies order ([#1994](https://github.com/cometbft/cometbft/pull/1994))**
- **PBTS: migrating to `main` the new version of the specification
([#1973](https://github.com/cometbft/cometbft/pull/1973))**
- **Fix paths to scripts/metricsgen in go:generate commands ([#1998](https://github.com/cometbft/cometbft/pull/1998))**
- **chore: fix some typos ([#2002](https://github.com/cometbft/cometbft/pull/2002))**
- **docs(light): fix broken link to spec ([#2007](https://github.com/cometbft/cometbft/pull/2007))**
- **chore(test/loadtime): replace tm-load-test w/ cometbft-load-test
([#2009](https://github.com/cometbft/cometbft/pull/2009))**
- **ci: Remove unused `tests` target when compiling e2e ([#2022](https://github.com/cometbft/cometbft/pull/2022))**
- **spec: fix typo in `encoding.md` ([#2024](https://github.com/cometbft/cometbft/pull/2024))**
- **mempool: Fix data races in CListMempool's height and
notifiedTxsAvailable ([#2021](https://github.com/cometbft/cometbft/pull/2021))**
- **chore(test/loadtime): cleanup go.sum and golangci.yml ([#2025](https://github.com/cometbft/cometbft/pull/2025))**
- **build(deps): Bump github.com/prometheus/common from 0.45.0 to 0.46.0
([#2040](https://github.com/cometbft/cometbft/pull/2040))**
- **build(deps): Bump github.com/vektra/mockery/v2 from 2.39.1 to 2.40.1
([#2038](https://github.com/cometbft/cometbft/pull/2038))**
- **feat(rpc): Use default port for HTTP(S) URLs when there is no
explicit port ([#1903](https://github.com/cometbft/cometbft/pull/1903))**
- **misc(go.mod): remove unused peg dependency ([#2044](https://github.com/cometbft/cometbft/pull/2044))**
- **config: Remove unused `max_batch_bytes` ([#2050](https://github.com/cometbft/cometbft/pull/2050))**
- **Merge pull request from [GHSA-qr8r-m495-7hc4](https://github.com/advisories/GHSA-qr8r-m495-7hc4 "GHSA-qr8r-m495-7hc4")**
- **misc(tools)!: remove `tools` package ([#2046](https://github.com/cometbft/cometbft/pull/2046))**
- **docs(guides): add missing import ([#2070](https://github.com/cometbft/cometbft/pull/2070))**
- **deps(localnode): bump alpine version ([#2077](https://github.com/cometbft/cometbft/pull/2077))**
- **misc(Makefile): add `help` target to display the help msg ([#2074](https://github.com/cometbft/cometbft/pull/2074))**
- **`e2e`: test vote extension activation via `InitChain` and
`FinalizeBlock` ([#2066](https://github.com/cometbft/cometbft/pull/2066))**
- **scripts: metricsgen parses '// metrics:' pattern ([#2090](https://github.com/cometbft/cometbft/pull/2090))**
- **e2e: Add `load_max_txs` option to manifest ([#2094](https://github.com/cometbft/cometbft/pull/2094))**
- **consensus: Add `chain_size_bytes` metric ([#2093](https://github.com/cometbft/cometbft/pull/2093))**
- **feat: conventional commits ([#1995](https://github.com/cometbft/cometbft/pull/1995))**
- **Forward port of [tendermint/tendermint#7605](https://github.com/tendermint/tendermint/pull/7605), [tendermint/spec#393](https://github.com/tendermint/spec/pull/393), and
[tendermint/tendermint#8142](https://github.com/tendermint/tendermint/pull/8142) ([#2018](https://github.com/cometbft/cometbft/pull/2018))**
- **ci: fix permissions for "Conventional PR Title" ([#2099](https://github.com/cometbft/cometbft/pull/2099))**
- **PBTS: additions and fixes on migrated spec ([#2013](https://github.com/cometbft/cometbft/pull/2013))**
- **PBTS: forward port of [tendermint/tendermint#7709](https://github.com/tendermint/tendermint/pull/7709) ([#2089](https://github.com/cometbft/cometbft/pull/2089))**
- **feat: use go workspace ([#1924](https://github.com/cometbft/cometbft/pull/1924))**
- **fix: `ValidateUpdate`: allow no-change updates regardless of current
height ([#2112](https://github.com/cometbft/cometbft/pull/2112))**
- **test(localnet): Add monitoring tools for localnet ([#2108](https://github.com/cometbft/cometbft/pull/2108))**
- **feat: add gofumpt ([#2049](https://github.com/cometbft/cometbft/pull/2049))**
- **feat(consensus): increase log level for corner case when prevoting a
proposal ([#2042](https://github.com/cometbft/cometbft/pull/2042))**
- **docs: v1 - diataxis framework ([#2105](https://github.com/cometbft/cometbft/pull/2105))**
- **feat(consensus): additional sanity checks for the size of proposed
blocks ([#1408](https://github.com/cometbft/cometbft/pull/1408))**
- **perf(internal/blocksync): avoid double-calling
`types.BlockFromProto` ([#2016](https://github.com/cometbft/cometbft/pull/2016))**
- **build(deps): Bump google.golang.org/grpc from 1.60.1 to 1.61.0
([#2178](https://github.com/cometbft/cometbft/pull/2178))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.28.1 to 1.29.0
([#2161](https://github.com/cometbft/cometbft/pull/2161))**
- **build(deps): Bump styfle/cancel-workflow-action from 0.12.0 to
0.12.1 ([#2160](https://github.com/cometbft/cometbft/pull/2160))**
- **build(deps): Bump slackapi/slack-github-action from 1.24.0 to 1.25.0
([#2162](https://github.com/cometbft/cometbft/pull/2162))**
- **build(deps): Bump github.com/google/uuid from 1.5.0 to 1.6.0
([#2176](https://github.com/cometbft/cometbft/pull/2176))**
- **refactor(privval): reverse conditional + more idiomatic Go code with
early returns ([#2156](https://github.com/cometbft/cometbft/pull/2156))**
- **fix(e2e): path to latency script files in DO ([#2148](https://github.com/cometbft/cometbft/pull/2148))**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.9.1 to
0.10.0 ([#2175](https://github.com/cometbft/cometbft/pull/2175))**
- **chore(Makefile): add `setup-pre-commit` target to init git hook
([#2123](https://github.com/cometbft/cometbft/pull/2123))**
- **feat: add pebbledb (<https://github.com/cockroachdb/pebble>) ([#2132](https://github.com/cometbft/cometbft/pull/2132))**
- **perf(internal/blocksync): do not `ValidateBlock` twice ([#2026](https://github.com/cometbft/cometbft/pull/2026))**
- **feat(e2e): Add new targets `fast` and `clean` to Makefile ([#2192](https://github.com/cometbft/cometbft/pull/2192))**
- **ci: add `spec` type in conventional-pr-title ([#2191](https://github.com/cometbft/cometbft/pull/2191))**
- **fix(privval): retry accepting a connection on errors ([#2047](https://github.com/cometbft/cometbft/pull/2047))**
- **fix(.github/workflows): correct parameters to lint_pr_title
([#2199](https://github.com/cometbft/cometbft/pull/2199))**
- **docs: update QA method steps for qa-infra changes ([#2198](https://github.com/cometbft/cometbft/pull/2198))**
- **feat!(pbts): forward port of [tendermint/tendermint#7711](https://github.com/tendermint/tendermint/pull/7711) ([#2149](https://github.com/cometbft/cometbft/pull/2149))**
- **docs(pbts): forward port of PBTS documentation and fixes ([#2124](https://github.com/cometbft/cometbft/pull/2124))**
- **fix: if-return and early-return ([#2215](https://github.com/cometbft/cometbft/pull/2215))**
- **chore: remove amazon linux Dockerfile and update
test/docker/Dockerfile ([#2135](https://github.com/cometbft/cometbft/pull/2135))**
- **feat(ci): pre-commit framework ([#2214](https://github.com/cometbft/cometbft/pull/2214))**
- **ci: add `merge` type for conventional-pr-title ([#2219](https://github.com/cometbft/cometbft/pull/2219))**
- **spec(consensus/pbts): update description for introduced parameters.
([#2206](https://github.com/cometbft/cometbft/pull/2206))**
- **perf: optimize psql indexer ([#2142](https://github.com/cometbft/cometbft/pull/2142))**
- **fix(go.mod): do not use `replace` for api ([#2236](https://github.com/cometbft/cometbft/pull/2236))**
- **fix(Makefile): gofumpt no longer needed ([#2235](https://github.com/cometbft/cometbft/pull/2235))**
- **fix(p2p/pex): gracefully shutdown `Reactor` ([#2010](https://github.com/cometbft/cometbft/pull/2010))**
- **test(mempool): fix
TestMempoolUpdateDoesNotPanicWhenApplicationMissedTx ([#2242](https://github.com/cometbft/cometbft/pull/2242))**
- **fix(flowrate): fix non-determinism in flowrate tests ([#2147](https://github.com/cometbft/cometbft/pull/2147))**
- **refactor!: Implement RFC 106: remove `GetLatestBlock*` methods from
data companion API ([#2240](https://github.com/cometbft/cometbft/pull/2240))**
- **build(deps): Bump github.com/cloudflare/circl from 1.3.3 to 1.3.7
([#2253](https://github.com/cometbft/cometbft/pull/2253))**
- **chore(config): update DB section in toml.go ([#2249](https://github.com/cometbft/cometbft/pull/2249))**
- **fix(consensus): do not precommit nil if proposal block is received
([#2221](https://github.com/cometbft/cometbft/pull/2221))**
- **build(deps): Bump github.com/opencontainers/runc from 1.1.5 to
1.1.12 ([#2261](https://github.com/cometbft/cometbft/pull/2261))**
- **fix(mempool/tests): Reduce tests duration ([#2263](https://github.com/cometbft/cometbft/pull/2263))**
- **ci: run golangci-lint linters for all files (not only ones which
were modified) ([#2250](https://github.com/cometbft/cometbft/pull/2250))**
- **refactor(examples): small changes to kvstore app ([#2267](https://github.com/cometbft/cometbft/pull/2267))**
- **refactor(mempool): simplify parameters of resCbFirstTime and
resCbRecheck ([#2272](https://github.com/cometbft/cometbft/pull/2272))**
- **perf(mempool/cache): clear map in Reset ([#2259](https://github.com/cometbft/cometbft/pull/2259))**
- **test(abci): update e2e tests to check against ABCI 2.0 grammar
([#2201](https://github.com/cometbft/cometbft/pull/2201))**
- **docs: symbolic references to steps in the qa-infra README ([#2280](https://github.com/cometbft/cometbft/pull/2280))**
- **chore: updated doc link ([#2296](https://github.com/cometbft/cometbft/pull/2296))**
- **fix(consensus): prevote nil upon timeout when Proposal is missing
([#2218](https://github.com/cometbft/cometbft/pull/2218))**
- **build(deps): Bump pre-commit/action from 3.0.0 to 3.0.1 ([#2307](https://github.com/cometbft/cometbft/pull/2307))**
- **build(deps): Bump golang.org/x/net from 0.20.0 to 0.21.0 ([#2300](https://github.com/cometbft/cometbft/pull/2300))**
- **build(deps): Bump github.com/cometbft/cometbft-db from 0.10.0 to
0.11.0 ([#2299](https://github.com/cometbft/cometbft/pull/2299))**
- **docs: ADR-112 Proposer-Based Timestamps ([#2223](https://github.com/cometbft/cometbft/pull/2223))**
- **refactor(internal/statesync): replace ticker with `time.After(X)`
([#2294](https://github.com/cometbft/cometbft/pull/2294))**
- **fix: simultaneous rpc test failures ([#2150](https://github.com/cometbft/cometbft/pull/2150))**
- **chore(docs): alter the section about the effects of `timeout_commit`
([#1892](https://github.com/cometbft/cometbft/pull/1892))**
- **refactor(p2p)!: Refactor PeerSet to eliminate data races & improve
performance ([#2246](https://github.com/cometbft/cometbft/pull/2246))**
- **feat(pbts): Update consensus params to include pbts enabled
([#2231](https://github.com/cometbft/cometbft/pull/2231))**
- **feat(storage/metrics): Metrics to measure storage ([#1974](https://github.com/cometbft/cometbft/pull/1974))**
- **feat(e2e): Log number of sent txs (success and failed) ([#2328](https://github.com/cometbft/cometbft/pull/2328))**
- **chore: enable gomoddirectives, unparam ([#2290](https://github.com/cometbft/cometbft/pull/2290))**
- **docs: images not rendering properly in docs ([#2331](https://github.com/cometbft/cometbft/pull/2331))**
- **docs: Fix references about DeliverTx ([#2330](https://github.com/cometbft/cometbft/pull/2330))**
- **docs(qa): Add table of contents to existing QA reports ([#2343](https://github.com/cometbft/cometbft/pull/2343))**
- **chore: enable perfsprint linter ([#2291](https://github.com/cometbft/cometbft/pull/2291))**
- **feat(pruning): trigger explicitly compaction upon pruning ([#1972](https://github.com/cometbft/cometbft/pull/1972))**
- **docs: explain how to skip pre-commit hook ([#2358](https://github.com/cometbft/cometbft/pull/2358))**
- **build(deps): Bump github.com/prometheus/common from 0.46.0 to 0.47.0
([#2373](https://github.com/cometbft/cometbft/pull/2373))**
- **build(deps): Bump google.golang.org/grpc from 1.61.0 to 1.61.1
([#2372](https://github.com/cometbft/cometbft/pull/2372))**
- **feat(e2e): Option to set max block size in bytes at genesis
([#2362](https://github.com/cometbft/cometbft/pull/2362))**
- **build(deps): Bump github.com/prometheus/client_model from 0.5.0 to
0.6.0 ([#2371](https://github.com/cometbft/cometbft/pull/2371))**
- **revert(pbts): revert removal of BFT Time related functions ([#2205](https://github.com/cometbft/cometbft/pull/2205))**
- **fix(e2e): Reduce flakiness of TestGRPC_GetBlockResults ([#2367](https://github.com/cometbft/cometbft/pull/2367))**
- **spec(consensus): update Block Time documentation in spec ([#2316](https://github.com/cometbft/cometbft/pull/2316))**
- **spec: adaptive MSGDELAY parameter included in PBTS spec ([#2318](https://github.com/cometbft/cometbft/pull/2318))**
- **feat(pbts): Moving VoteExtensionsEnableHeight from ABCIParams to
FeatureParams. ([#2335](https://github.com/cometbft/cometbft/pull/2335))**
- **fix: remove TestMempoolFIFOWithParallelCheckTx ([#2364](https://github.com/cometbft/cometbft/pull/2364))**
- **fix(docker-compose): fix subnet ([#2383](https://github.com/cometbft/cometbft/pull/2383))**
- **feat(pbts): enable `e2e` manifest config to set `PbtsEnableHeight`
([#2284](https://github.com/cometbft/cometbft/pull/2284))**
- **perf(internal/state): avoid double-saving FinalizeBlockResponse
([#2017](https://github.com/cometbft/cometbft/pull/2017))**
- **build(deps): Bump fonttools from 4.37.4 to 4.43.0 in
/scripts/qa/reporting ([#2407](https://github.com/cometbft/cometbft/pull/2407))**
- **build(deps): Bump pillow from 10.0.1 to 10.2.0 in
/scripts/qa/reporting ([#2408](https://github.com/cometbft/cometbft/pull/2408))**
- **fix(node): Forward compaction config params to blockstore
constructor ([#2418](https://github.com/cometbft/cometbft/pull/2418))**
- **refactor!: moved `MedianTime` out of `internal` folder ([#2397](https://github.com/cometbft/cometbft/pull/2397))**
- **chore: typo fixes ([#2403](https://github.com/cometbft/cometbft/pull/2403))**
- **chore(pbts): Removes useless code ([#2420](https://github.com/cometbft/cometbft/pull/2420))**
- **build(deps): Bump github.com/prometheus/common from 0.47.0 to 0.48.0
([#2430](https://github.com/cometbft/cometbft/pull/2430))**
- **build(deps): Bump google.golang.org/grpc from 1.61.1 to 1.62.0
([#2429](https://github.com/cometbft/cometbft/pull/2429))**
- **test(consensus): PBTS should be enabled by default in test units
([#2329](https://github.com/cometbft/cometbft/pull/2329))**
- **test(consensus): test enabling PBTS at a given height ([#2404](https://github.com/cometbft/cometbft/pull/2404))**
- **refactor(protobuf): switch from gogofaster to gocosmos generator
([#2425](https://github.com/cometbft/cometbft/pull/2425))**
- **docs(tutorials/install): add `From Go package` ([#2414](https://github.com/cometbft/cometbft/pull/2414))**
- **docs(pbts): documentation for PBTS-related consensus parameters
([#2376](https://github.com/cometbft/cometbft/pull/2376))**
- **refactor(consensus): print err from SignAndCheckVote ([#2346](https://github.com/cometbft/cometbft/pull/2346))**
- **feat(e2e): add parameter to set a custom output directory for
testnet files ([#2433](https://github.com/cometbft/cometbft/pull/2433))**
- **spec(consensus): update description of consensus parameters for PBTS
([#2415](https://github.com/cometbft/cometbft/pull/2415))**
- **fix(localnet): Grafana dashboards for storage tests - removed
experimental metrics ([#2448](https://github.com/cometbft/cometbft/pull/2448))**
- **fix(jsonrpc): enable HTTP basic auth in WS client ([#2434](https://github.com/cometbft/cometbft/pull/2434))**
- **feat(pbts): Adds timestamp to the `msgInfo` written into the WAL
([#2388](https://github.com/cometbft/cometbft/pull/2388))**
- **fix: `Rollback`: wrong modification of
`state.LastHeightValidatorsChanged` while rollback at a special height
([#2136](https://github.com/cometbft/cometbft/pull/2136))**
- **docs(changelog): add missing entry for [#2136](https://github.com/cometbft/cometbft/pull/2136) ([#2459](https://github.com/cometbft/cometbft/pull/2459))**
- **fix(pbts): legacy `ABCIParams` values are properly translated to
`FeatureParams` values ([#2462](https://github.com/cometbft/cometbft/pull/2462))**
- **fix(e2e): Fixing the bug in ABCI e2e tests ([#2468](https://github.com/cometbft/cometbft/pull/2468))**
- **feat(localnet): Grafana PNG rendering for easier graph exports
([#2472](https://github.com/cometbft/cometbft/pull/2472))**
- **docs(README): remove Terra ([#2469](https://github.com/cometbft/cometbft/pull/2469))**
- **docs: document PBTS adaptive delays mechanism ([#2452](https://github.com/cometbft/cometbft/pull/2452))**
- **fix(config): Moved compact variables to the right section ([#2477](https://github.com/cometbft/cometbft/pull/2477))**
- **feat(metrics): more buckets for ProposalTimestampDifference
([#2479](https://github.com/cometbft/cometbft/pull/2479))**
- **fix(metrics): more buckets for ProposalTimestampDifference ([#2481](https://github.com/cometbft/cometbft/pull/2481))**
- **feat(pbts): Make synchrony params adaptive ([#2431](https://github.com/cometbft/cometbft/pull/2431))**
- **ci: check metrics generation in CI checks ([#2483](https://github.com/cometbft/cometbft/pull/2483))**
- **feat(consensus): improve logging for timely and untimely messages
([#2321](https://github.com/cometbft/cometbft/pull/2321))**
- **feat(types): improve Proposal and SynchronyParams validation tests
([#2489](https://github.com/cometbft/cometbft/pull/2489))**
- **test(consensus): refactor TestStateLock_POLSafety tests ([#2492](https://github.com/cometbft/cometbft/pull/2492))**
- **feat(types): refactor types.AdaptiveSynchronyParams method ([#2490](https://github.com/cometbft/cometbft/pull/2490))**
- **fix: lint errors introduced with the latest merge ([#2495](https://github.com/cometbft/cometbft/pull/2495))**
- **build(deps): Bump docker/setup-buildx-action from 3.0.0 to 3.1.0
([#2500](https://github.com/cometbft/cometbft/pull/2500))**
- **build(deps): Bump github.com/prometheus/client_golang from 1.18.0 to
1.19.0 ([#2508](https://github.com/cometbft/cometbft/pull/2508))**
- **build(deps): Bump golang.org/x/crypto from 0.19.0 to 0.20.0
([#2507](https://github.com/cometbft/cometbft/pull/2507))**
- **build(deps): Bump github.com/prometheus/common from 0.48.0 to 0.49.0
([#2506](https://github.com/cometbft/cometbft/pull/2506))**
- **build(deps): Bump github.com/stretchr/testify from 1.8.4 to 1.9.0
([#2505](https://github.com/cometbft/cometbft/pull/2505))**
- **fix(docs): include `timesync` daemon instructions ([#2491](https://github.com/cometbft/cometbft/pull/2491))**
- **feat(privval)!: DO NOT require extension signature ([#2496](https://github.com/cometbft/cometbft/pull/2496))**
- **refactor(privval): rename sign_extension to skip_sign_extension
([#2519](https://github.com/cometbft/cometbft/pull/2519))**
- **spec(abci): fixes the spec to inform about the presence of invalid
extensions in `last_commit` ([#2423](https://github.com/cometbft/cometbft/pull/2423))**
- **fix(pbts): block Time must be Canonical ([#2493](https://github.com/cometbft/cometbft/pull/2493))**
- **feat(e2e): Add manifest option `clock_skew` and corresponding
backend functionality ([#2454](https://github.com/cometbft/cometbft/pull/2454))**
- **fix(mempool): converting to uint64 before additions to avoid
overflows ([#2498](https://github.com/cometbft/cometbft/pull/2498))**
- **refactor!: Rename `skip_sign_extension` to `skip_extension_signing`
([#2522](https://github.com/cometbft/cometbft/pull/2522))**
- **docs(ADR): ADR-108 updated to account for the new changes in the
grammar and code. ([#2528](https://github.com/cometbft/cometbft/pull/2528))**
- **feat(e2e): add generator support for clock skew + env variable
rename ([#2488](https://github.com/cometbft/cometbft/pull/2488))**
- **spec(proto): add `cometbft.privval.v1beta2` proto package ([#2529](https://github.com/cometbft/cometbft/pull/2529))**
- **chore: improving error handling in the PendingEvidence ([#2550](https://github.com/cometbft/cometbft/pull/2550))**
- **feat(blocksync)!: set the max number of (concurrently) downloaded
blocks to {peersCount * 20} ([#2467](https://github.com/cometbft/cometbft/pull/2467))**
- **build(deps): Bump bufbuild/buf-setup-action from 1.29.0 to 1.30.0
([#2557](https://github.com/cometbft/cometbft/pull/2557))**
- **build(deps): Bump google.golang.org/protobuf from 1.32.0 to 1.33.0
([#2560](https://github.com/cometbft/cometbft/pull/2560))**
- **build(deps): Bump golang.org/x/net from 0.21.0 to 0.22.0 ([#2562](https://github.com/cometbft/cometbft/pull/2562))**
- **fix(cmd/cometbft/commands/version): update the output for v1
([#2546](https://github.com/cometbft/cometbft/pull/2546))**
- **build(deps): Bump docker/build-push-action from 5.1.0 to 5.2.0
([#2558](https://github.com/cometbft/cometbft/pull/2558))**
- **build(deps): Bump github.com/prometheus/common from 0.49.0 to 0.50.0
([#2559](https://github.com/cometbft/cometbft/pull/2559))**
- **build(deps): Bump google.golang.org/grpc from 1.62.0 to 1.62.1
([#2563](https://github.com/cometbft/cometbft/pull/2563))**
- **build(deps): Bump golang.org/x/crypto from 0.20.0 to 0.21.0
([#2561](https://github.com/cometbft/cometbft/pull/2561))**
- **feat(blocksync): sort peers by download rate & multiple requests for
closer blocks ([#2475](https://github.com/cometbft/cometbft/pull/2475))**
- **feat(pbts): Adjusts PBTS metrics buckets ([#2578](https://github.com/cometbft/cometbft/pull/2578))**
- **fix(blocksync): use timer instead of time.After ([#2584](https://github.com/cometbft/cometbft/pull/2584))**
- **fix: temporary fix for `api` dependency ([#2589](https://github.com/cometbft/cometbft/pull/2589))**

---------

Signed-off-by: Thane Thomson <connect@thanethomson.com>
Signed-off-by: dependabot[bot] <support@github.com>
Co-authored-by: Thane Thomson <connect@thanethomson.com>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
Co-authored-by: Mikhail Zabaluev <mikhail@informal.systems>
Co-authored-by: Troy Kessler <43882936+troykessler@users.noreply.github.com>
Co-authored-by: leven <112051166+lx-xiang@users.noreply.github.com>
Co-authored-by: werty144 <anton-paramonov2000@yandex.ru>
Co-authored-by: Adi Seredinschi <adizere@gmail.com>
Co-authored-by: Sukey <35202440+sukey2008@users.noreply.github.com>
Co-authored-by: Sergio Mena <sergio@informal.systems>
Co-authored-by: Jasmina Malicevic <jasmina.dustinac@gmail.com>
Co-authored-by: moriluka <85185077+moriluka@users.noreply.github.com>
Co-authored-by: ƒê·ªó Vi·ªát Ho√†ng <hoangdv2429@gmail.com>
Co-authored-by: alex <152680487+azukiboy@users.noreply.github.com>
Co-authored-by: Hern√°n Vanzetto <15466498+hvanz@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@informal.systems>
Co-authored-by: Andy Nogueira <me@andynogueira.dev>
Co-authored-by: nenadmilosevic95 <50905385+nenadmilosevic95@users.noreply.github.com>
Co-authored-by: nenadmilosevic95 <nenad@informal.systems>
Co-authored-by: Jacob Gadikian <jacobgadikian@gmail.com>
Co-authored-by: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Co-authored-by: Emmanuel T Odeke <emm.odeke@gmail.com>
Co-authored-by: jchappelow <140431406+jchappelow@users.noreply.github.com>
Co-authored-by: shuoer86 <129674997+shuoer86@users.noreply.github.com>
Co-authored-by: levisyin <150114626+levisyin@users.noreply.github.com>
Co-authored-by: vuittont60 <81072379+vuittont60@users.noreply.github.com>
Co-authored-by: Halimao <1065621723@qq.com>
Co-authored-by: alex <152680487+bodhi-crypo@users.noreply.github.com>
Co-authored-by: Daniel <daniel.cason@usi.ch>
Co-authored-by: Josef Widder <44643235+josef-widder@users.noreply.github.com>
Co-authored-by: William Banfield <4561443+williambanfield@users.noreply.github.com>
Co-authored-by: Kukovec <jure.kukovec@gmail.com>
Co-authored-by: Daniel Cason <cason@gandria>
Co-authored-by: M. J. Fromberger <fromberger@interchain.io>
Co-authored-by: hattizai <150505746+hattizai@users.noreply.github.com>
Co-authored-by: Huulu <35667132+IssouChancla@users.noreply.github.com>
Co-authored-by: katelyn martin <me+cratelyn@katelyn.world>
Co-authored-by: Richard Gibson <richard.gibson@gmail.com>
Co-authored-by: Jean Deruelle <jean.deruelle@gmail.com>
Co-authored-by: glnro <8335464+glnro@users.noreply.github.com>
Co-authored-by: Greg Szabo <greg@philosobear.com>
Co-authored-by: Emmanuel T Odeke <emmanuel@orijtech.com>
Co-authored-by: levisyin <lilassherl@gmail.com>
Co-authored-by: k0marov <95040709+k0marov@users.noreply.github.com>
Co-authored-by: Adi Seredinschi <a@seredinschi.net>
Co-authored-by: Pan chao <152830401+Pan-chao@users.noreply.github.com>
Co-authored-by: Khanh Hoa <49144992+hoanguyenkh@users.noreply.github.com>
Co-authored-by: glnro <lauren@informal.systems>
Co-authored-by: toni <143221387+xyztoni@users.noreply.github.com>
Co-authored-by: DragonKid <idragonkid@gmail.com>
Co-authored-by: Matt Ketmo <matthieu@moquet.net>
Co-authored-by: Ethan <cosinlinker@gmail.com>
Co-authored-by: Evgeny Danilenko <6655321@bk.ru>
Co-authored-by: Duong Minh Ngoc <153509244+minhngoc274@users.noreply.github.com>
Co-authored-by: Kero <keroroxx520@gmail.com>
```

[DongLieu](/DongLieu)
pushed a commit
to DongCoNY/cometbft
that referenced
this pull request
[May 13, 2024](#ref-commit-495dceb)
[![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/marketplace/mergify) [![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&u=f7884ca3eb329dbe0c672b224f72ff7fb81cdb33&v=4)](/otrack) [![@DongLieu](https://avatars.githubusercontent.com/u/93205232?s=40&v=4)](/DongLieu)

`[v0.37.x: Prevent a transaction to appear twice in the mempool (backport](/DongCoNY/cometbft/commit/495dceba0ffcd40744f5523576b21bc941dbad03 "v0.37.x: Prevent a transaction to appear twice in the mempool (backport #890) (#926)

* add a test to trigger the issue
* add a fix (in particular, we track the sender when receiving a tx twice)
* add a changelog

---------

Co-authored-by: Daniel <daniel.cason@informal.systems>
(cherry picked from commit a09f5d33ecd8846369b93cae9063291eb8abc3a0)

* update fix and test wrt. v0.37.x

---------

Co-authored-by: Pierre Sutra <0track@gmail.com>")`
‚Ä¶

`[495dceb](/DongCoNY/cometbft/commit/495dceba0ffcd40744f5523576b21bc941dbad03)`

```
[cometbft#890](https://github.com/cometbft/cometbft/pull/890)) ([cometbft#926](https://github.com/cometbft/cometbft/pull/926))

* add a test to trigger the issue
* add a fix (in particular, we track the sender when receiving a tx twice)
* add a changelog

---------

Co-authored-by: Daniel <daniel.cason@informal.systems>
(cherry picked from commit [a09f5d3](https://github.com/DongCoNY/cometbft/commit/a09f5d33ecd8846369b93cae9063291eb8abc3a0))

* update fix and test wrt. v0.37.x

---------

Co-authored-by: Pierre Sutra <0track@gmail.com>
```

[![@faddat](https://avatars.githubusercontent.com/u/7142025?s=40&v=4)](/faddat)
[faddat](/faddat)
mentioned this pull request
[Oct 15, 2024](#ref-pullrequest-2587916584)

[chore: use latest cometbft-db in v0.38.x
#4296](/cometbft/cometbft/pull/4296)
 Closed

3 tasks

This was referenced Oct 18, 2024

[Missing validation of priorities in validateset in Header and Many Other Known Security Issues are Unsolved
sei-protocol/sei-tendermint#246](/sei-protocol/sei-tendermint/issues/246)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Issues are Unsolved
polynetwork/poly#136](/polynetwork/poly/issues/136)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Issues are Unsolved
pokt-network/tendermint#79](/pokt-network/tendermint/issues/79)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
bnb-chain/greenfield-cometbft#78](/bnb-chain/greenfield-cometbft/issues/78)

Closed

[Missing Validation of Priorities in Validateset in Header and Many Other Known Issues in Cometbft are Unsolved
gnolang/gno#2977](/gnolang/gno/issues/2977)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Issues in Cometbft are Unsolved
DeAI-Artist/Linkis#1](/DeAI-Artist/Linkis/issues/1)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Issues in Cometbft are Unsolved
okx/okbchain#219](/okx/okbchain/issues/219)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
kardiachain/go-kardia#259](/kardiachain/go-kardia/issues/259)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
okx/exchain#3330](/okx/exchain/issues/3330)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
Finschia/ostracon#777](/Finschia/ostracon/issues/777)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
maticnetwork/heimdall#1197](/maticnetwork/heimdall/issues/1197)

Closed

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
bttcprotocol/delivery#100](/bttcprotocol/delivery/issues/100)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
dydxprotocol/cometbft#35](/dydxprotocol/cometbft/issues/35)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
zkMeLabs/mechain-cometbft#21](/zkMeLabs/mechain-cometbft/issues/21)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
reapchain/reapchain-core#31](/reapchain/reapchain-core/issues/31)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
arcology-network/consensus-engine#130](/arcology-network/consensus-engine/issues/130)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
MetisProtocol/themis#1](/MetisProtocol/themis/issues/1)

Open

[Missing Validation of Priorities in Validateset in Header and Many Other Known Security Issues in Cometbft are Unsolved
FiboChain/fbc#1](/FiboChain/fbc/issues/1)

Open

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&u=14e39ce969a7381b8934c945daa72dcf88beb3db&v=4)](/hvanz)
[hvanz](/hvanz)
mentioned this pull request
[Nov 12, 2024](#ref-issue-2651476992)

[mempool's `addSender` error message may be too verbose
#4474](/cometbft/cometbft/issues/4474)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fcometbft%2Fcometbft%2Fpull%2F890)

Reviewers

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&v=4)](/hvanz) [hvanz](/hvanz)

hvanz approved these changes

[![@jmalicevic](https://avatars.githubusercontent.com/u/7517419?s=40&v=4)](/jmalicevic) [jmalicevic](/jmalicevic)

jmalicevic left review comments

[![@cason](https://avatars.githubusercontent.com/u/270778?s=40&v=4)](/cason) [cason](/cason)

cason approved these changes

[![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=40&v=4)](/sergio-mena) [sergio-mena](/sergio-mena)

sergio-mena approved these changes

Assignees

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack) [otrack](/otrack)

Labels

[backport-to-v0.34.x](/cometbft/cometbft/labels/backport-to-v0.34.x)
Tell Mergify to backport the PR to v0.34.x
[backport-to-v0.37.x](/cometbft/cometbft/labels/backport-to-v0.37.x)
Tell Mergify to backport the PR to v0.37.x
[backport-to-v0.38.x](/cometbft/cometbft/labels/backport-to-v0.38.x)
Tell Mergify to backport the PR to v0.38.x
[bug](/cometbft/cometbft/labels/bug)
Something isn't working
[mempool](/cometbft/cometbft/labels/mempool)

Projects

No open projects
1 closed project

[CometBFT 2023](/orgs/cometbft/projects/1)

Status: Done

 +8 more

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@otrack](https://avatars.githubusercontent.com/u/2862510?s=52&v=4)](/otrack) [![@sergio-mena](https://avatars.githubusercontent.com/u/15381133?s=52&v=4)](/sergio-mena) [![@cason](https://avatars.githubusercontent.com/u/270778?s=52&v=4)](/cason) [![@jmalicevic](https://avatars.githubusercontent.com/u/7517419?s=52&v=4)](/jmalicevic) [![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=52&v=4)](/hvanz)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_49fb674b_20250115_095752.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcometbft%2Fcometbft%2Fsecurity%2Fadvisories%2FGHSA-w24w-wp77-qffm)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcometbft%2Fcometbft%2Fsecurity%2Fadvisories%2FGHSA-w24w-wp77-qffm)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=cometbft%2Fcometbft)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[cometbft](/cometbft)
/
**[cometbft](/cometbft/cometbft)**
Public

* [Notifications](/login?return_to=%2Fcometbft%2Fcometbft) You must be signed in to change notification settings
* [Fork
  537](/login?return_to=%2Fcometbft%2Fcometbft)
* [Star
   682](/login?return_to=%2Fcometbft%2Fcometbft)

* [Code](/cometbft/cometbft)
* [Issues
  265](/cometbft/cometbft/issues)
* [Pull requests
  37](/cometbft/cometbft/pulls)
* [Discussions](/cometbft/cometbft/discussions)
* [Actions](/cometbft/cometbft/actions)
* [Projects
  1](/cometbft/cometbft/projects)
* [Wiki](/cometbft/cometbft/wiki)
* [Security](/cometbft/cometbft/security)
* [Insights](/cometbft/cometbft/pulse)

Additional navigation options

* [Code](/cometbft/cometbft)
* [Issues](/cometbft/cometbft/issues)
* [Pull requests](/cometbft/cometbft/pulls)
* [Discussions](/cometbft/cometbft/discussions)
* [Actions](/cometbft/cometbft/actions)
* [Projects](/cometbft/cometbft/projects)
* [Wiki](/cometbft/cometbft/wiki)
* [Security](/cometbft/cometbft/security)
* [Insights](/cometbft/cometbft/pulse)

# Duplicate transactions in the mempool's data structures

Low

[sergio-mena](/sergio-mena)
published
GHSA-w24w-wp77-qffm
Jul 3, 2023

## Package

gomod

cometbft
([Go](/advisories?query=ecosystem%3Ago))

## Affected versions

v0.37.0, v0.37.1, < v0.34.28

## Patched versions

v0.34.29, v0.37.2

## Description

### Impact

The mempool maintains two data structures to keep track of outstanding transactions: a list and a map.

These two data structures are supposed to be in sync all the time in the sense that the map tracks the index (if any) of the transaction in the list.

Unfortunately, it is possible to have them out of sync. When this happens, the list may contain several copies of the same transaction.

Because the map tracks a single index, it is then no longer possible to remove all the copies of the transaction from the list.

This happens even if the duplicated transaction is later committed in a block.

The only way to remove the transaction is by restarting the node.

These are the steps to cause the above duplication problem. Everything should happen within one height, that is no `FinalizeBlock` or `BeginBlock` ABCI calls should happen while these steps are reproduced:

1. send transaction tx1 to the target full node via RPC
2. send N more different transactions to the target full node, where N should be higher than the node's configured value for `cache_size` in `config.toml`
3. send transaction tx1 again to the target full node

One of the copies of tx1 is now *stuck* in the mempool's data structures. Effectively causing a memory leak, and having that node gossiping that transaction to its peers forever.

The above problem can be repeated on and on until a sizable number of transactions are stuck in the mempool, in order to try to bring down the target node.

This problem is present in releases: `v0.37.0`, and `v0.37.1`, as well as in `v0.34.28`, and all previous releases of the CometBFT repo. It will be fixed in releases `v0.34.29` and `v0.37.2`.

### Patches

The PR containing the fix is [here](https://github.com/cometbft/cometbft/pull/890).

### Workarounds

* Increasing the value of `cache_size` in `config.toml` makes it very difficult to effectively attack a full node.
* Not exposing the transaction submission RPC's would mitigate the probability of a successful attack, as the attacker would then have to create a modified (byzantine) full node to be able to perform the attack via p2p.

### References

* [PR](https://github.com/tendermint/tendermint/pull/2778) that introduced the map to track transactions in the mempool.
* [PR](https://github.com/cometbft/cometbft/pull/890) containing the fix.

### Severity

Low

### CVE ID

CVE-2023-34451

### Weaknesses

No CWEs

### Credits

* [![@otrack](https://avatars.githubusercontent.com/u/2862510?s=40&v=4)](/otrack)
  [otrack](/otrack)
  Finder

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_8082e624_20250115_095758.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftendermint%2Ftendermint%2Fpull%2F2778)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftendermint%2Ftendermint%2Fpull%2F2778)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=tendermint%2Ftendermint)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[tendermint](/tendermint)
/
**[tendermint](/tendermint/tendermint)**
Public

* [Notifications](/login?return_to=%2Ftendermint%2Ftendermint) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Ftendermint%2Ftendermint)
* [Star
   5.7k](/login?return_to=%2Ftendermint%2Ftendermint)

* [Code](/tendermint/tendermint)
* [Issues
  0](/tendermint/tendermint/issues)
* [Pull requests
  20](/tendermint/tendermint/pulls)
* [Discussions](/tendermint/tendermint/discussions)
* [Actions](/tendermint/tendermint/actions)
* [Projects
  1](/tendermint/tendermint/projects)
* [Wiki](/tendermint/tendermint/wiki)
* [Security](/tendermint/tendermint/security)
* [Insights](/tendermint/tendermint/pulse)

Additional navigation options

* [Code](/tendermint/tendermint)
* [Issues](/tendermint/tendermint/issues)
* [Pull requests](/tendermint/tendermint/pulls)
* [Discussions](/tendermint/tendermint/discussions)
* [Actions](/tendermint/tendermint/actions)
* [Projects](/tendermint/tendermint/projects)
* [Wiki](/tendermint/tendermint/wiki)
* [Security](/tendermint/tendermint/security)
* [Insights](/tendermint/tendermint/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Ftendermint%2Ftendermint%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Ftendermint%2Ftendermint%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# mempool no gossip back #2778

 Merged

[melekes](/melekes)
merged 41 commits into
[develop](/tendermint/tendermint/tree/develop "tendermint/tendermint:develop")
from
[dev/mempool\_no\_gossip\_back](/tendermint/tendermint/tree/dev/mempool_no_gossip_back "tendermint/tendermint:dev/mempool_no_gossip_back")

Mar 26, 2019

 Merged

# [mempool no gossip back](#top) #2778

[melekes](/melekes)
merged 41 commits into
[develop](/tendermint/tendermint/tree/develop "tendermint/tendermint:develop")
from
[dev/mempool\_no\_gossip\_back](/tendermint/tendermint/tree/dev/mempool_no_gossip_back "tendermint/tendermint:dev/mempool_no_gossip_back")

Mar 26, 2019

[Conversation
125](/tendermint/tendermint/pull/2778)
[Commits
41](/tendermint/tendermint/pull/2778/commits)
[Checks
0](/tendermint/tendermint/pull/2778/checks)
[Files changed](/tendermint/tendermint/pull/2778/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=60&v=4)](/ValarDragon)

Copy link

Contributor

### @ValarDragon **[ValarDragon](/ValarDragon)** commented [Nov 7, 2018](#issue-378431235) ‚Ä¢ edited by melekes Loading

Closes [#1798](https://github.com/tendermint/tendermint/issues/1798)

This is done by making every mempool tx maintain a list of peers who its received the tx from. Instead of using the 20byte peer ID, it instead uses a local map from peerID to uint16 counter, so every peer adds 2 bytes. (Word aligned to probably make it 8 bytes)

This also required resetting the callback function on every CheckTx. This likely has performance ramifications for instruction caching. The actual setting operation isn't costly with the removal of defers in this PR.

* Updated all relevant documentation in docs
* Updated all code comments where relevant
* Wrote tests
* Updated CHANGELOG\_PENDING.md

Sorry, something went wrong.

All reactions

 [ValarDragon](/ValarDragon)
added 2 commits
[November 7, 2018 10:44](#commits-pushed-06d5ffd)

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Make the mempool not gossip txs back to peers its received it from](/tendermint/tendermint/pull/2778/commits/06d5ffda9c5d021b9a053d01a9d19c5ee11cbcd2 "Make the mempool not gossip txs back to peers its received it from")`

`[06d5ffd](/tendermint/tendermint/pull/2778/commits/06d5ffda9c5d021b9a053d01a9d19c5ee11cbcd2)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Fix adversarial memleak](/tendermint/tendermint/pull/2778/commits/3904e8187eca17568f0ece1885a8daaffa28e538 "Fix adversarial memleak")`

`[3904e81](/tendermint/tendermint/pull/2778/commits/3904e8187eca17568f0ece1885a8daaffa28e538)`

 [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&u=048687cb334593258de0189c96c9c8e48a61de67&v=4)](/ValarDragon)
[ValarDragon](/ValarDragon)
requested review from
[ebuchman](/ebuchman),
[melekes](/melekes),
[xla](/xla) and
[zramsay](/zramsay)
as [code owners](/tendermint/tendermint/blob/6e9aee546061423864fef3f9fa332ef37c3dca96/.github/CODEOWNERS#L4)
[November 7, 2018 19:17](#event-1952505826)

 [ValarDragon](/ValarDragon)
and others
added 5 commits
[November 7, 2018 11:52](#commits-pushed-7842608)

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Don't break interface](/tendermint/tendermint/pull/2778/commits/7842608c61871dcfff8ce9dac78765f2b83ca5ad "Don't break interface")`

`[7842608](/tendermint/tendermint/pull/2778/commits/7842608c61871dcfff8ce9dac78765f2b83ca5ad)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Update changelog](/tendermint/tendermint/pull/2778/commits/167b7200787deaa995df95d7874f97a3c536a395 "Update changelog")`

`[167b720](/tendermint/tendermint/pull/2778/commits/167b7200787deaa995df95d7874f97a3c536a395)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Merge branch 'develop' into dev/mempool_no_gossip_back](/tendermint/tendermint/pull/2778/commits/fcc1a2b9ba1dfad55a06a1a2c381bcd7f7ce31e5 "Merge branch 'develop' into dev/mempool_no_gossip_back")`

`[fcc1a2b](/tendermint/tendermint/pull/2778/commits/fcc1a2b9ba1dfad55a06a1a2c381bcd7f7ce31e5)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Forgot to add a mtx](/tendermint/tendermint/pull/2778/commits/aba2c938a09ad428cef145bfeb0e4ccfd000a914 "Forgot to add a mtx")`

`[aba2c93](/tendermint/tendermint/pull/2778/commits/aba2c938a09ad428cef145bfeb0e4ccfd000a914)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Merge branch 'dev/mempool_no_gossip_back' of github.com:tendermint/te‚Ä¶](/tendermint/tendermint/pull/2778/commits/6da7a91e661402f4d6df2c428399edad001329b5 "Merge branch 'dev/mempool_no_gossip_back' of github.com:tendermint/tendermint into dev/mempool_no_gossip_back")`
 ‚Ä¶

`[6da7a91](/tendermint/tendermint/pull/2778/commits/6da7a91e661402f4d6df2c428399edad001329b5)`

```
‚Ä¶ndermint into dev/mempool_no_gossip_back
```

 [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&u=048687cb334593258de0189c96c9c8e48a61de67&v=4)](/ValarDragon)
[ValarDragon](/ValarDragon)
[force-pushed](/tendermint/tendermint/compare/c9f4a7e2d1fcc4a5ceb32014f816102f999fcadf..6da7a91e661402f4d6df2c428399edad001329b5)
the
dev/mempool\_no\_gossip\_back

branch
from
[`c9f4a7e`](/tendermint/tendermint/commit/c9f4a7e2d1fcc4a5ceb32014f816102f999fcadf) to
[`6da7a91`](/tendermint/tendermint/commit/6da7a91e661402f4d6df2c428399edad001329b5)  [Compare](/tendermint/tendermint/compare/c9f4a7e2d1fcc4a5ceb32014f816102f999fcadf..6da7a91e661402f4d6df2c428399edad001329b5)
[November 7, 2018 21:07](#event-1952739501)

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[forgot a mutex](/tendermint/tendermint/pull/2778/commits/3b10fe6d11b4231e921f1f7d00dc65057a2e2834 "forgot a mutex")`

`[3b10fe6](/tendermint/tendermint/pull/2778/commits/3b10fe6d11b4231e921f1f7d00dc65057a2e2834)`

[![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=80&u=4694f03b321aa2287d9fe05155adcddb23272e81&v=4)](/codecov-io)

Copy link

### **[codecov-io](/codecov-io)** commented [Nov 7, 2018](#issuecomment-436781885) ‚Ä¢ edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/tendermint/tendermint/pull/2778?src=pr&el=h1) Report Merging [#2778](https://codecov.io/gh/tendermint/tendermint/pull/2778?src=pr&el=desc) into [develop](https://codecov.io/gh/tendermint/tendermint/commit/25a3c8b1724c9611d6edc175b1b0d079f5ee28c1?src=pr&el=desc) will **decrease** coverage by `0.04%`. The diff coverage is `80.21%`.  ``` @@             Coverage Diff             @@ ##           develop    #2778      +/-   ## =========================================== - Coverage    64.31%   64.26%   -0.05%      ===========================================   Files          213      213                 Lines        17398    17506     +108      =========================================== + Hits         11189    11251      +62      - Misses        5281     5315      +34      - Partials       928      940      +12 ```  | [Impacted Files](https://codecov.io/gh/tendermint/tendermint/pull/2778?src=pr&el=tree) | Coverage Œî |  | | --- | --- | --- | | [state/services.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-c3RhdGUvc2VydmljZXMuZ28=) | `33.33% <25%> (-6.67%)` | ‚¨áÔ∏è | | [mempool/reactor.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-bWVtcG9vbC9yZWFjdG9yLmdv) | `78.07% <85.36%> (+9.71%)` | ‚¨ÜÔ∏è | | [mempool/mempool.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-bWVtcG9vbC9tZW1wb29sLmdv) | `79.28% <85.71%> (-0.08%)` | ‚¨áÔ∏è | | [privval/signer\_validator\_endpoint.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-cHJpdnZhbC9zaWduZXJfdmFsaWRhdG9yX2VuZHBvaW50Lmdv) | `75.55% <0%> (-10%)` | ‚¨áÔ∏è | | [privval/socket\_listeners.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-cHJpdnZhbC9zb2NrZXRfbGlzdGVuZXJzLmdv) | `86.2% <0%> (-3.45%)` | ‚¨áÔ∏è | | [consensus/replay.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-Y29uc2Vuc3VzL3JlcGxheS5nbw==) | `68.42% <0%> (-2.06%)` | ‚¨áÔ∏è | | [privval/signer\_remote.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-cHJpdnZhbC9zaWduZXJfcmVtb3RlLmdv) | `80% <0%> (-2%)` | ‚¨áÔ∏è | | [p2p/netaddress.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-cDJwL25ldGFkZHJlc3MuZ28=) | `68.32% <0%> (-1.22%)` | ‚¨áÔ∏è | | [consensus/reactor.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-Y29uc2Vuc3VzL3JlYWN0b3IuZ28=) | `71.54% <0%> (-0.48%)` | ‚¨áÔ∏è | | [consensus/state.go](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree#diff-Y29uc2Vuc3VzL3N0YXRlLmdv) | `79.05% <0%> (-0.12%)` | ‚¨áÔ∏è | | ... and [4 more](https://codecov.io/gh/tendermint/tendermint/pull/2778/diff?src=pr&el=tree-more) |  |  | |

All reactions

Sorry, something went wrong.

[![ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=60&v=4)](/ValarDragon)

**[ValarDragon](/ValarDragon)**
commented
[Nov 7, 2018](#pullrequestreview-172705235)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834)

[mempool/bench\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-d3b70a6baa3800a39bf49d513d413d934a8be04f59b8042480ec04a762d7c334)

Show resolved

Hide resolved

[![melekes](https://avatars.githubusercontent.com/u/1282182?s=60&v=4)](/melekes)

**[melekes](/melekes)**
reviewed
[Nov 9, 2018](#pullrequestreview-173346574)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834)

Copy link

Contributor

### @melekes **[melekes](/melekes)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Great start ‚≠êÔ∏è I have a few comments about the interface and uint16 overflow due to peers reconnecting

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/bench\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-d3b70a6baa3800a39bf49d513d413d934a8be04f59b8042480ec04a762d7c334)
Outdated

Show resolved

Hide resolved

[mempool/bench\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-d3b70a6baa3800a39bf49d513d413d934a8be04f59b8042480ec04a762d7c334)
Outdated

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[![melekes](https://avatars.githubusercontent.com/u/1282182?s=60&v=4)](/melekes)

**[melekes](/melekes)**
reviewed
[Nov 9, 2018](#pullrequestreview-173356455)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834)

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

1 hidden conversation

Load more‚Ä¶

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

[mempool/mempool\_test.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-47c418d0e77321fe0c35bc7d94b6ce0c4628a546f8bbd421ffe692bf93024d5a)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

 [melekes](/melekes)
and others
added 2 commits
[November 9, 2018 16:26](#commits-pushed-ca68847)

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes) [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Update mempool/reactor.go](/tendermint/tendermint/pull/2778/commits/ca688476b148671ee6a8b494b7578974f0cfaa54 "Update mempool/reactor.go

Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>")`
 ‚Ä¶

`[ca68847](/tendermint/tendermint/pull/2778/commits/ca688476b148671ee6a8b494b7578974f0cfaa54)`

```
Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>
```

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes) [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Update mempool/mempool.go](/tendermint/tendermint/pull/2778/commits/4fbed56d3348760f1334911080cc8600b5b59957 "Update mempool/mempool.go

Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>")`
 ‚Ä¶

`[4fbed56](/tendermint/tendermint/pull/2778/commits/4fbed56d3348760f1334911080cc8600b5b59957)`

```
Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>
```

[![ebuchman](https://avatars.githubusercontent.com/u/2300911?s=60&v=4)](/ebuchman)

**[ebuchman](/ebuchman)**
reviewed
[Nov 11, 2018](#pullrequestreview-173703013)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/4fbed56d3348760f1334911080cc8600b5b59957)

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Cool to see this come together. Think we need to address the id->uint16 issue and a few other small things but otherwise looking good.

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/4fbed56d3348760f1334911080cc8600b5b59957#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/3b10fe6d11b4231e921f1f7d00dc65057a2e2834#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/4fbed56d3348760f1334911080cc8600b5b59957#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)
Outdated

Show resolved

Hide resolved

 [ebuchman](/ebuchman)
and others
added 6 commits
[November 11, 2018 12:55](#commits-pushed-cb1fca6)

[![@ebuchman](https://avatars.githubusercontent.com/u/2300911?s=40&v=4)](/ebuchman)

`[Merge branch 'develop' into dev/mempool_no_gossip_back](/tendermint/tendermint/pull/2778/commits/cb1fca6d6eb331cbc1c17e75a1c8bba892a047b9 "Merge branch 'develop' into dev/mempool_no_gossip_back")`

`[cb1fca6](/tendermint/tendermint/pull/2778/commits/cb1fca6d6eb331cbc1c17e75a1c8bba892a047b9)`

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes) [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Use unknown peer ID](/tendermint/tendermint/pull/2778/commits/6933dd1223f7485da4d4b8ea055414a770c86466 "Use unknown peer ID

Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>")`
 ‚Ä¶

`[6933dd1](/tendermint/tendermint/pull/2778/commits/6933dd1223f7485da4d4b8ea055414a770c86466)`

```
Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>
```

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[fix compilation](/tendermint/tendermint/pull/2778/commits/30d32dd825f5370a6ab1f8a785d9a29f0239b7f7 "fix compilation")`

`[30d32dd](/tendermint/tendermint/pull/2778/commits/30d32dd825f5370a6ab1f8a785d9a29f0239b7f7)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Merge branch 'develop' into dev/mempool_no_gossip_back](/tendermint/tendermint/pull/2778/commits/ef34f138b4def65e2850786cb5fdc78fe2398e27 "Merge branch 'develop' into dev/mempool_no_gossip_back")`

`[ef34f13](/tendermint/tendermint/pull/2778/commits/ef34f138b4def65e2850786cb5fdc78fe2398e27)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[use next wait chan logic when skipping](/tendermint/tendermint/pull/2778/commits/7d5415dd4e1b566cd0f106d2e8653889245fb92c "use next wait chan logic when skipping")`

`[7d5415d](/tendermint/tendermint/pull/2778/commits/7d5415dd4e1b566cd0f106d2e8653889245fb92c)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Minor fixes](/tendermint/tendermint/pull/2778/commits/5a296ebd7e7a9a0fd34b71e770aaceaeb6e58918 "Minor fixes")`

`[5a296eb](/tendermint/tendermint/pull/2778/commits/5a296ebd7e7a9a0fd34b71e770aaceaeb6e58918)`

 [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&u=048687cb334593258de0189c96c9c8e48a61de67&v=4)](/ValarDragon)
[ValarDragon](/ValarDragon)
[force-pushed](/tendermint/tendermint/compare/3333fac57cc282f675bb88746ab36a5814a6a4e5..5a296ebd7e7a9a0fd34b71e770aaceaeb6e58918)
the
dev/mempool\_no\_gossip\_back

branch
from
[`3333fac`](/tendermint/tendermint/commit/3333fac57cc282f675bb88746ab36a5814a6a4e5) to
[`5a296eb`](/tendermint/tendermint/commit/5a296ebd7e7a9a0fd34b71e770aaceaeb6e58918)  [Compare](/tendermint/tendermint/compare/3333fac57cc282f675bb88746ab36a5814a6a4e5..5a296ebd7e7a9a0fd34b71e770aaceaeb6e58918)
[November 14, 2018 07:03](#event-1965056479)

 [ValarDragon](/ValarDragon)
added 2 commits
[November 20, 2018 17:43](#commits-pushed-5174032)

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Add TxInfo](/tendermint/tendermint/pull/2778/commits/5174032ad8021c886fd08a1902485ef10f211dbd "Add TxInfo")`

`[5174032](/tendermint/tendermint/pull/2778/commits/5174032ad8021c886fd08a1902485ef10f211dbd)`

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&v=4)](/ValarDragon)

`[Add reverse map](/tendermint/tendermint/pull/2778/commits/e086a3a8f7e2b7de65b70930e7695a94c9a52cef "Add reverse map")`

`[e086a3a](/tendermint/tendermint/pull/2778/commits/e086a3a8f7e2b7de65b70930e7695a94c9a52cef)`

 [![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=40&u=048687cb334593258de0189c96c9c8e48a61de67&v=4)](/ValarDragon)
[ValarDragon](/ValarDragon)
[force-pushed](/tendermint/tendermint/compare/68b1e31254561e9c1e500f9c88ef0228d33a6c2a..e086a3a8f7e2b7de65b70930e7695a94c9a52cef)
the
dev/mempool\_no\_gossip\_back

branch
from
[`68b1e31`](/tendermint/tendermint/commit/68b1e31254561e9c1e500f9c88ef0228d33a6c2a) to
[`e086a3a`](/tendermint/tendermint/commit/e086a3a8f7e2b7de65b70930e7695a94c9a52cef)  [Compare](/tendermint/tendermint/compare/68b1e31254561e9c1e500f9c88ef0228d33a6c2a..e086a3a8f7e2b7de65b70930e7695a94c9a52cef)
[November 21, 2018 01:39](#event-1978901042)

50 hidden items

Load more‚Ä¶

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
reviewed
[Mar 18, 2019](#pullrequestreview-215707960)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833)

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

Show resolved

Hide resolved

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
mentioned this pull request
[Mar 19, 2019](#ref-issue-422584760)

[mempool: punish peers for sending duplicate txs
#3445](/tendermint/tendermint/issues/3445)

Closed

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
self-assigned this
[Mar 25, 2019](#event-2226144550)

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
reviewed
[Mar 25, 2019](#pullrequestreview-218402491)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833)

[mempool/cache\_test.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-55f7c572522eef51b622afac28601d1a66a3fa26ac9f75a990bc1a473c898297)

|  |  | require.NotEqual(t, len(tc.txsInCache), counter, |
| --- | --- | --- |
|  |  | "cache larger than expected on testcase %d", tcIndex) |
|  |  |  |
|  |  | nodeVal := node.Value.([sha256.Size]byte) |

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** [Mar 25, 2019](#discussion_r268699775)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Now that we launched: [#2187](https://github.com/tendermint/tendermint/issues/2187) üöÄ

Sorry, something went wrong.

All reactions

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
reviewed
[Mar 25, 2019](#pullrequestreview-218404913)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833)

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

Show resolved

Hide resolved

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
reviewed
[Mar 25, 2019](#pullrequestreview-218405431)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833)

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

Show resolved

Hide resolved

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
reviewed
[Mar 25, 2019](#pullrequestreview-218410383)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833)

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** left a comment ‚Ä¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

A few comments while pair-reviewing with [@melekes](https://github.com/melekes)

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

Show resolved

Hide resolved

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)
Outdated

|  |  | mem.metrics.TxSizeBytes.Observe(float64(len(memTx.tx))) |
| --- | --- | --- |
|  |  | } |
|  |  |  |
|  |  | func (mem \*Mempool) resCbNormal(tx []byte, peerID uint16, res \*abci.Response) { |

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** [Mar 25, 2019](#discussion_r268709433)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

maybe rename the sthsthCb methods?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 25, 2019](#discussion_r268758605)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`resCbFirstTime`?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** [Mar 25, 2019](#discussion_r268764054)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Yes, I think that would be a bit better. I think it's OK to merge without renaming even (as these methods are not exported).

Sorry, something went wrong.

All reactions

[mempool/reactor\_test.go](/tendermint/tendermint/pull/2778/files/6e6cbb0690b45852349a0c9b0692eed289450833#diff-88df7742c7c0f4a1ee089bab702a09eaede0ea64f4f4fd529a0264980ed8197d)
Outdated

Show resolved

Hide resolved

 [melekes](/melekes)
added 2 commits
[March 25, 2019 18:09](#commits-pushed-c414f54)

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes)

`[Merge branch 'develop' into dev/mempool_no_gossip_back](/tendermint/tendermint/pull/2778/commits/c414f540d23071eac372d31e2cc80dc7017654bf "Merge branch 'develop' into dev/mempool_no_gossip_back")`

`[c414f54](/tendermint/tendermint/pull/2778/commits/c414f540d23071eac372d31e2cc80dc7017654bf)`

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes)

`[fixes after Ismail's review](/tendermint/tendermint/pull/2778/commits/e3f376d6ab0321b588b5d16a305da5619ee41491 "fixes after Ismail's review")`

`[e3f376d](/tendermint/tendermint/pull/2778/commits/e3f376d6ab0321b588b5d16a305da5619ee41491)`

[![liamsi](https://avatars.githubusercontent.com/u/7441766?s=60&v=4)](/liamsi)

**[liamsi](/liamsi)**
approved these changes
[Mar 25, 2019](#pullrequestreview-218476824)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/e3f376d6ab0321b588b5d16a305da5619ee41491)

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks [@ValarDragon](https://github.com/ValarDragon) and [@melekes](https://github.com/melekes)! LGTM üëç

Sorry, something went wrong.

All reactions

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes)

`[rename resCbNormal to resCbFirstTime](/tendermint/tendermint/pull/2778/commits/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974 "rename resCbNormal to resCbFirstTime")`

`[58d0cf7](/tendermint/tendermint/pull/2778/commits/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974)`

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=80&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)

Copy link

Contributor

### **[melekes](/melekes)** commented [Mar 25, 2019](#issuecomment-476417036)

| 250bytes txs for 120 sec. at 500 txs/sec. rate, so total 15MB  total bytes received from 1st node in 4 node localnet  before: 42793967 (43MB) after: 30003256 (30MB)  total bytes sent to 1st node in 4 node localnet  before: 30569339 (30MB) after: 19304964 (19MB)  AFTER -> BEFORE [Screenshot 2019-03-25 at 20 47 56](https://user-images.githubusercontent.com/1282182/54949576-b5044280-4f3f-11e9-9100-b6b300b9475a.png) [Screenshot 2019-03-25 at 20 48 06](https://user-images.githubusercontent.com/1282182/54949577-b5044280-4f3f-11e9-8396-787e0630f716.png) |
| --- |

 üöÄ
1
 liamsi reacted with rocket emoji

All reactions

* üöÄ
  1 reaction

Sorry, something went wrong.

 [![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
dismissed
[milosevic](/milosevic)‚Äôs [stale review](#pullrequestreview-197600944)
[March 26, 2019 08:26](#event-2228875706)

requested changes were addressed

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
merged commit [`6de7eff`](/tendermint/tendermint/commit/6de7effb05581f9bea2e8af06e4e74a85c34bc5f)
into
develop

[Mar 26, 2019](https://github.com/tendermint/tendermint/pull/2778#event-2228878620)

 [![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
deleted the
dev/mempool\_no\_gossip\_back

branch
[March 26, 2019 08:27](#event-2228878742)

[![ebuchman](https://avatars.githubusercontent.com/u/2300911?s=60&v=4)](/ebuchman)

**[ebuchman](/ebuchman)**
reviewed
[Mar 26, 2019](#pullrequestreview-218520484)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974)

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Still reviewing the core changes but here are some thoughts on the periphery

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

|  |  | // record the sender |
| --- | --- | --- |
|  |  | e, ok := mem.txsMap[sha256.Sum256(tx)] |
|  |  | if ok { // tx may be in cache, but not in the mempool |
|  |  | memTx := e.Value.(\*mempoolTx) |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268799230)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Is this guaranteed to be non nil ?

Also how does the tx end up in the txsMap but not the mempool?

We shouldn't call this the `cache` in the comment, since `mem.cache` is something else ...

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 26, 2019](#discussion_r269176755)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I guess the comment is confusing... if `ok` here means tx resides in the mempool (txsMap and txs hold transactions). But tx can be only in the cache and not present in the mempool (txsMap and txs). When we've committed a block, txs are removed from the mempool, but not from cache.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 26, 2019](#discussion_r269177161)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

> Is this guaranteed to be non nil ?

yes

Sorry, something went wrong.

All reactions

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/43bfa6af8e369c450f96f643df6f19f81a36ff2a#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)

Show resolved

Hide resolved

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)

|  |  | type mempoolIDs struct { |
| --- | --- | --- |
|  |  | mtx sync.RWMutex |
|  |  | peerMap map[p2p.ID]uint16 |
|  |  | nextID uint16 // assumes that a node will never have over 65536 active peers |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268806931)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We should probably make this assumption more prevalent somewhere in the MempoolReactor godoc

Sorry, something went wrong.

 üëç
1
 melekes reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)

|  |  | // This assumes that ids's mutex is already locked. |
| --- | --- | --- |
|  |  | func (ids \*mempoolIDs) nextPeerID() uint16 { |
|  |  | \_, idExists := ids.activeIDs[ids.nextID] |
|  |  | for idExists { |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268808121)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should we add a sanity check so this loop panics if it runs more than 2^16 times?

Sorry, something went wrong.

 üëç
1
 melekes reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)

|  |  | } |
| --- | --- | --- |
|  |  |  |
|  |  | // Reserve searches for the next unused ID and assignes it to the peer. |
|  |  | func (ids \*mempoolIDs) ReserveForPeer(peer p2p.Peer) { |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268809558)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Why not simplify naming to Add/Remove/Get ?

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 26, 2019](#discussion_r269177819)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

More expressive?

Sorry, something went wrong.

All reactions

[mempool/reactor\_test.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-88df7742c7c0f4a1ee089bab702a09eaede0ea64f4f4fd529a0264980ed8197d)

|  |  | @@ -124,10 +128,26 @@ func TestReactorBroadcastTxMessage(t \*testing.T) { | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | // send a bunch of txs to the first reactor's mempool |
|  |  | // and wait for them all to be received in the others |
|  |  | txs := checkTxs(t, reactors[0].Mempool, NUM\_TXS) |
|  |  | txs := checkTxs(t, reactors[0].Mempool, NUM\_TXS, UnknownPeerID) |
|  |  | waitForTxs(t, txs, reactors) |
|  |  | } |
|  |  |  |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268811057)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

We should add tests for the mempoolIDs methods

Sorry, something went wrong.

 üëç
1
 melekes reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

|  |  | @@ -357,6 +380,17 @@ func (mem \*Mempool) CheckTx(tx types.Tx, cb func(\*abci.Response)) (err error) { | |
| --- | --- | --- | --- |
|  |  |  |
|  |  | // CACHE |
|  |  | if !mem.cache.Push(tx) { |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 25, 2019](#discussion_r268812468)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should we skip this cache check stuff entirely if the sender is the RPC, ie ID=0 ? Ref [#3414 (comment)](https://github.com/tendermint/tendermint/issues/3414#issuecomment-476098920)

Sorry, something went wrong.

 üëé
2
 melekes and ValarDragon reacted with thumbs down emoji

All reactions

* üëé
  2 reactions

[![melekes](https://avatars.githubusercontent.com/u/1282182?s=60&v=4)](/melekes)

**[melekes](/melekes)**
reviewed
[Mar 27, 2019](#pullrequestreview-219408007)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974)

[mempool/reactor.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-3e6afafe7994a696d508a5a5b093343bdb5d1ff2ff00bab0318d2c87547e74e5)

|  |  | } |
| --- | --- | --- |
|  |  |  |
|  |  | // Reclaim returns the ID reserved for the peer back to unused pool. |
|  |  | func (ids \*mempoolIDs) Reclaim(peer p2p.Peer) { |

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 27, 2019](#discussion_r269518776)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

we should also remove removedID from all the transactions in the mempool!!!

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 27, 2019](#discussion_r269538421)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

ok, because nextID is always increasing until it overflows the chance of that is very low. can be ignored for now

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 27, 2019](#discussion_r269625079)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

```
        // XXX (melekes): commented out for performance reasons
	//
	// Remove the sender if present to avoid a new node joining and not receiving
	// a tx because we think it already has it. For that two things should happen:
	//   1) node has to connect to over 65536 peers during its lifetime
	//   2) tx must reside in the mempool for the above duration
	//
	// for e := memR.Mempool.txs.Front(); e != nil; e = e.Next() {
	// 	memTx := e.Value.(*mempoolTx)
	// 	memTx.senders.Delete(id)
	// }
```

Sorry, something went wrong.

 üëÄ
1
 liamsi reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

Copy link

Contributor

### @liamsi **[liamsi](/liamsi)** [Mar 27, 2019](#discussion_r269684799)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Some context: The above code could become necessary once 1) and 2) show to happen. It is unclear if this will ever be the case or not.

Sorry, something went wrong.

All reactions

[melekes](/melekes)
added a commit
that referenced
this pull request
[Mar 27, 2019](#ref-commit-c9b37f7)
[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)

`[mempool: add a safety check, write tests for mempoolIDs](/tendermint/tendermint/commit/c9b37f73a5cb572e68204629d5cdd90a0d76bf65 "mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to https://github.com/tendermint/tendermint/pull/2778")`
‚Ä¶

`[c9b37f7](/tendermint/tendermint/commit/c9b37f73a5cb572e68204629d5cdd90a0d76bf65)`

```
and document 65536 limit in the mempool reactor spec

follow-up to [#2778](https://github.com/tendermint/tendermint/pull/2778)
```

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)
[melekes](/melekes)
mentioned this pull request
[Mar 27, 2019](#ref-pullrequest-426011764)

[mempool: add a safety check, write tests for mempoolIDs
#3487](/tendermint/tendermint/pull/3487)
 Merged

4 tasks

[melekes](/melekes)
added a commit
that referenced
this pull request
[Mar 27, 2019](#ref-commit-5fa540b)
[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)

`[mempool: add a safety check, write tests for mempoolIDs (](/tendermint/tendermint/commit/5fa540bdc9eac01cc3df6de01119550d1122114b "mempool: add a safety check, write tests for mempoolIDs (#3487)

* mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to https://github.com/tendermint/tendermint/pull/2778

* rename the test

* fixes after Ismail's review")[#3487](https://github.com/tendermint/tendermint/pull/3487)[)](/tendermint/tendermint/commit/5fa540bdc9eac01cc3df6de01119550d1122114b "mempool: add a safety check, write tests for mempoolIDs (#3487)

* mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to https://github.com/tendermint/tendermint/pull/2778

* rename the test

* fixes after Ismail's review")`
‚Ä¶

`[5fa540b](/tendermint/tendermint/commit/5fa540bdc9eac01cc3df6de01119550d1122114b)`

```
* mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to [#2778](https://github.com/tendermint/tendermint/pull/2778)

* rename the test

* fixes after Ismail's review
```

[liamsi](/liamsi)
added a commit
that referenced
this pull request
[Mar 27, 2019](#ref-commit-3c7bb6b)
[![@liamsi](https://avatars.githubusercontent.com/u/7441766?s=40&u=48d8dd5d37b5545455c90055d49c84199a0b16f2&v=4)](/liamsi)

`[Add some numbers for](/tendermint/tendermint/commit/3c7bb6b571ac47e050a47013e22dbdfd68f02745 "Add some numbers for #2778") [#2778](https://github.com/tendermint/tendermint/pull/2778)`

`[3c7bb6b](/tendermint/tendermint/commit/3c7bb6b571ac47e050a47013e22dbdfd68f02745)`

[![ebuchman](https://avatars.githubusercontent.com/u/2300911?s=60&v=4)](/ebuchman)

**[ebuchman](/ebuchman)**
reviewed
[Mar 30, 2019](#pullrequestreview-220830058)

 [View reviewed changes](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974)

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Addressing in [#3512](https://github.com/tendermint/tendermint/pull/3512)

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

|  |  | // Used in CheckTxWithInfo to record PeerID who sent us the tx. |
| --- | --- | --- |
|  |  | func (mem \*Mempool) reqResCb(tx []byte, peerID uint16) func(res \*abci.Response) { |
|  |  | return func(res \*abci.Response) { |
|  |  | if mem.recheckCursor != nil { |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 30, 2019](#discussion_r270634666)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Is this possible? Seems like it shouldn't be, and if it is, like it'd be a race condition

Sorry, something went wrong.

All reactions

[mempool/mempool.go](/tendermint/tendermint/pull/2778/files/58d0cf7bc1463f285e9a7ce67c3ed951fa72c974#diff-37e0f6f3ccf82f3fcc49edc58fdace00678d70956ff412c13c64b764dc58a6f4)

|  |  | @@ -650,7 +730,7 @@ func (mem \*Mempool) recheckTxs(txs []types.Tx) { | |
| --- | --- | --- | --- |
|  |  | mem.recheckEnd = mem.txs.Back() |
|  |  |  |
|  |  | // Push txs to proxyAppConn |
|  |  | // NOTE: resCb() may be called concurrently. |
|  |  | // NOTE: reqResCb may be called concurrently. |

Copy link

Contributor

### @ebuchman **[ebuchman](/ebuchman)** [Mar 30, 2019](#discussion_r270634891)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

`resCb` is the global callback, which might be called concurrently with this for loop because all of these CheckTxAsync calls will trigger it.

`reqResCb` is the request specific callback and is not called for any of these CheckTxAsync (because we're rechecking here). And because this is being called from Update, which is supposed to be called within the mempool lock (though that lock is managed by Consensus :o ), it should not be possible for the reqResCb to run concurrently with these, because that would mean new CheckTxs are coming in, which would mess with ordering.

So I think the comment actually should be that `resCb` may be called concurrently here.

Sorry, something went wrong.

 üëç
1
 melekes reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Copy link

Contributor

### @melekes **[melekes](/melekes)** [Mar 30, 2019](#discussion_r270640175)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for clarification üëç

Sorry, something went wrong.

All reactions

[pinkiebell](/pinkiebell)
added a commit
to leapdao/tendermint
that referenced
this pull request
[Apr 14, 2019](#ref-commit-209f5ec)
[![@pinkiebell](https://avatars.githubusercontent.com/u/40266861?s=40&u=f8b9d3b7a89ded9632eeaabb4e9c3fb70144f440&v=4)](/pinkiebell)

`[Squashed commit of the following:](/leapdao/tendermint/commit/209f5ec6c22fe271b7266633221c4a0925cb8704 "Squashed commit of the following:

commit 4695414393a3e0bc3836fb1cece7f1f3768d3311
Merge: 6cc3f4d8 def5c8cf
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Fri Apr 12 10:56:03 2019 -0400

    Merge pull request #3548 from tendermint/release/v0.31.4

    Release/v0.31.4

commit def5c8cf124ff58cc9c4a61ea017808a0c81c722
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Apr 12 16:48:34 2019 +0200

    address review comments: (#3550)

    - mention ADR in release summary
     - remove [p2p] api changes
     - amend v0.31.3 log to contain note about breaking change

commit b6da8880c22202a7061ae2093ef01819438a136e
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Apr 12 14:24:51 2019 +0200

    prepare v0.31.4 release:

     - prep changelog
     - add missing changelog entries
     - fix minor glitch in existing changelog (v0.31.2)
     - bump versions

commit a453628c4e43c67c747d5078704479aa73716182
Author: Martin Dyring-Andersen <martin@dyring-andersen.dk>
Date:   Fri Apr 12 13:25:14 2019 +0200

    Fix a couple of typos (#3547)

    Fix some typos in p2p/transport.go

commit 4e4224213f3eaa89abeac6686efe4ac970ad63d0
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Fri Apr 12 12:32:00 2019 +0200

    adr: Peer Behaviour (#3539)

    * [adr] ADR 037: Peer Behaviour inital draft
    * Update docs/architecture/adr-037-peer-behaviour.md

    Co-Authored-By: brapse <brapse@gmail.com>

    * Update docs/architecture/adr-037-peer-behaviour.md
    Co-Authored-By: brapse <brapse@gmail.com>

    * [docs] adr-037 Better footnote styling
    * [ADR] ADR-037 adjust Footnotes for github markdown
    * [ADR] ADR-037 fix numbered list

commit b5b3b85697a9c29adaab0e1ab5d1380459e2c5eb
Author: Alexander Simmerl <a.simmerl@gmail.com>
Date:   Fri Apr 12 12:31:02 2019 +0200

    Bring back NodeInfo NetAddress form the dead (#3545)

    A prior change to address accidental DNS lookups introduced the
    SocketAddr on peer, which was then used to add it to the addressbook.
    Which in turn swallowed the self reported port of the peer, which is
    important on a reconnect. This change revives the NetAddress on NodeInfo
    which the Peer carries, but now returns an error to avoid nil
    dereferencing another issue observed in the past. Additionally we could
    potentially address #3532, yet the original problem statemenf of that
    issue stands.

    As a drive-by optimisation `MarkAsGood` now takes only a `p2p.ID` which
    makes it interface a bit stricter and leaner.

commit 18d2c45c334d9f22621ea0af0686e2e54937fb40
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Apr 12 10:46:07 2019 +0200

    rpc: Fix response time grow over time (#3537)

    * rpc: store validator info periodly

    * increase ValidatorSetStoreInterval

    also

    - unexpose it
    - add a comment
    - refactor code
    - add a benchmark, which shows that 100000 results in ~ 100ms to get 100
    validators

    * make the change non-breaking

    * expand comment

    * rename valSetStoreInterval to valSetCheckpointInterval

    * change the panic msg

    * add a test and changelog entry

    * update changelog entry

    * update changelog entry

    * add a link to PR

    * fix test

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * update comment

    * use MaxInt64 func

commit c3df21fe827aad0447bb59a9546c32db8406a5fd
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Apr 11 18:59:14 2019 +0300

    add missing changelog entry (#3544)

    * add missing changelog entry

commit bcec8be035a89b5d08ee00b8cc7115017a58c7e0
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Apr 11 15:32:16 2019 +0200

    p2p: do not log err if peer is private (#3474)

    * add actionable advice for ErrAddrBookNonRoutable err

    Should replace https://github.com/tendermint/tendermint/pull/3463

    * reorder checks in addrbook#addAddress so

    ErrAddrBookPrivate is returned first

    and do not log error in DialPeersAsync if the address is private
    because it's not an error

commit 9a415b057238d118c1edf23d673ebf9ce4f8d2ae
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Apr 9 18:21:35 2019 +0200

    docs: abci#Commit: better explain the possible deadlock (#3536)

commit 40da355234bda9d510dca370e94b646450673879
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Apr 3 14:56:51 2019 +0200

    docs: fix block.Header.Time description (#3529)

    It's not proposer local time anymore, but a weighted median

    Fixes #3514

commit f965a4db15796dfca4e504d93eaa83760ced4af2
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Apr 3 11:22:52 2019 +0200

    p2p: seed mode refactoring (#3011)

    ListOfKnownAddresses is removed
    panic if addrbook size is less than zero
    CrawlPeers does not attempt to connect to existing or peers we're currently dialing
    various perf. fixes
    improved tests (though not complete)
    move IsDialingOrExistingAddress check into DialPeerWithAddress (Fixes #2716)

    * addrbook: preallocate memory when saving addrbook to file

    * addrbook: remove oldestFirst struct and check for ID

    * oldestFirst replaced with sort.Slice
    * ID is now mandatory, so no need to check

    * addrbook: remove ListOfKnownAddresses

    GetSelection is used instead in seed mode.

    * addrbook: panic if size is less than 0

    * rewrite addrbook#saveToFile to not use a counter

    * test AttemptDisconnects func

    * move IsDialingOrExistingAddress check into DialPeerWithAddress

    * save and cleanup crawl peer data

    * get rid of DefaultSeedDisconnectWaitPeriod

    * make linter happy

    * fix TestPEXReactorSeedMode

    * fix comment

    * add a changelog entry

    * Apply suggestions from code review

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * rename ErrDialingOrExistingAddress to ErrCurrentlyDialingOrExistingAddress

    * lowercase errors

    * do not persist seed data

    pros:
    - no extra files
    - less IO

    cons:
    - if the node crashes, seed might crawl a peer too soon

    * fixes after Ethan's review

    * add a changelog entry

    * we should only consult Switch about peers

    checking addrbook size does not make sense since only PEX reactor uses
    it for dialing peers!

    https://github.com/tendermint/tendermint/pull/3011#discussion_r270948875

commit 086d6cbe8c4432a1a03d7924ae8352c42dc9cc4f
Merge: e4a03f24 6cc3f4d8
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 16:49:44 2019 -0400

    Merge pull request #3527 from tendermint/v0.31

    Merge V0.31.3 back to develop

commit 6cc3f4d87cae6589aef0ac2b4707f1ebc8a669b2
Merge: 79e9f205 3cfd9757
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 16:45:04 2019 -0400

    Merge pull request #3525 from tendermint/release/v0.31.3

    Release/v0.31.3

commit 3cfd9757a78fc2398c6853aace2541338be8eaef
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 09:14:33 2019 -0400

    changelog and version v0.31.3

commit 882622ec10ba3fdc9f360da65bfb2bbbd13193ed
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 19:59:57 2019 -0400

    Fixes tendermint/tendermint#3522

    * OriginalAddr -> SocketAddr

    OriginalAddr records the originally dialed address for outbound peers,
    rather than the peer's self reported address. For inbound peers, it was
    nil. Here, we rename it to SocketAddr and for inbound peers, set it to
    the RemoteAddr of the connection.

    * use SocketAddr

    Numerous places in the code call peer.NodeInfo().NetAddress().
    However, this call to NetAddress() may perform a DNS lookup if the
    reported NodeInfo.ListenAddr includes a name. Failure of this lookup
    returns a nil address, which can lead to panics in the code.

    Instead, call peer.SocketAddr() to return the static address of the
    connection.

    * remove nodeInfo.NetAddress()

    Expose `transport.NetAddress()`, a static result determined
    when the transport is created. Removing NetAddress() from the nodeInfo
    prevents accidental DNS lookups.

    * fixes from review

    * linter

    * fixes from review

commit 1ecf8148385692da971a46e14091270b23c6dff3
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 19:45:57 2019 -0400

    Fixes tendermint/tendermint#3439

    * make sure we create valid private keys:

     - genPrivKey samples and rejects invalid fieldelems (like libsecp256k1)
     - GenPrivKeySecp256k1 uses `(sha(secret) mod (n ‚àí 1)) + 1`
     - fix typo, rename test file: s/secpk256k1/secp256k1/

    * Update crypto/secp256k1/secp256k1.go

commit e4a03f249dcb7d2e833fc20add382b2a5e7f167e
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Mon Apr 1 14:18:18 2019 -0400

    Release message changelog link fix (#3519)

commit 56d8aa42b3ca628c6544cab1f902f8289738c97a
Merge: 0ae41cc6 79e9f205
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 14:17:58 2019 -0400

    Merge pull request #3520 from tendermint/v0.31

    Merge v0.31.2 release back to develop

commit 79e9f205782f1adb94b4150561e414280115cf4e
Merge: a0234aff ab24925c
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Apr 1 17:58:28 2019 +0200

    Merge pull request #3518 from tendermint/prepare-release-v0.31.2

    Release v0.31.2

commit ab24925c9432e9eff06b34445b1760217436f87d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Apr 1 12:32:37 2019 +0200

    prepare changelog and bump versions to v0.31.2

commit 0ae41cc663014454184c2d31328b53dd45dd34d1
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Mon Apr 1 11:47:00 2019 -0400

    Fix for wrong version tag (#3517)

    * Fix for wrong version tag (tag on the release branch instead of master)

commit 422d04c8bae80e103474d37bd5a5afd0061e8d72
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Sun Mar 31 07:14:18 2019 -0400

    Bucky/mempool txsmap (#3512)

    * mempool: resCb -> globalCb

    * reqResCb takes an externalCb

    * failing test for #3509

    * txsMap is sync.Map

    * update changelog

commit 2233dd45bd774905b1ba545eeadea5ebe49d1e31
Author: zjubfd <baifudong@lancai.cn>
Date:   Sat Mar 30 01:47:53 2019 +0800

    libs: remove useless code in group (#3504)

    * lib: remove useless code in group
    * update change log
    * Update CHANGELOG_PENDING.md

    Co-Authored-By: guagualvcha <baifudong@lancai.cn>

commit 9199f3f6132ff24500b538068450eae7d11bef64
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Fri Mar 29 07:57:16 2019 -0400

    Release management using CircleCI (#3498)

    * Release management using CircleCI

    * Changelog updated

commit 6c1a4b513747fed5be06edffd16db4a1c8749041
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 28 17:39:09 2019 +0100

    blockchain: comment out logger in test code that causes a race condition (#3500)

commit c7bb9984979b72e81a569b4540a2da1e73c1c470
Merge: d586945d 7b72436c
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 08:07:59 2019 -0400

    Merge pull request #3502 from tendermint/bucky/merge-master

    Bucky/merge master

commit 7b72436c751587141d8de605ccbcec3514dbea77
Merge: d586945d a0234aff
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 08:12:05 2019 -0400

    Merge branch 'master' into bucky/merge-master

commit a0234affb6959a0aec285eebf3a3963251d2d186
Merge: 0d985ede 9390a810
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 07:57:42 2019 -0400

    Merge pull request #3489 from tendermint/release/v0.31.1

    Release/v0.31.1

commit 9390a810ebda0b1aebd90f6e8b8688562bdf7958
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Mar 27 21:03:28 2019 -0400

    minor changelog updates (#3499)

commit a49d80b89c9df3cb2497adb8175915c654479708
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 19:12:01 2019 +0100

    catch up with develop and rebase on current release to include #3482

commit ccfe75ec4a701ad7dcaf1f26df772b0881ab1184
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Wed Mar 27 18:51:57 2019 +0100

    docs: Fix broken links (#3482) (#3488)

    * docs: fix broken links (#3482)

    A bunch of links were broken in the documentation s they included the
    `docs` prefix.

    * Update CHANGELOG_PENDING

    * docs: switch to relative links for github compatitibility (#3482)

commit d586945d6981262759e0e681e7bc92a74637185d
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Wed Mar 27 18:51:57 2019 +0100

    docs: Fix broken links (#3482) (#3488)

    * docs: fix broken links (#3482)

    A bunch of links were broken in the documentation s they included the
    `docs` prefix.

    * Update CHANGELOG_PENDING

    * docs: switch to relative links for github compatitibility (#3482)

commit ae88965ff6ddf174607a02eee83cfc5ed11c6cbb
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 17:46:29 2019 +0100

    changelog: add summary & fix link & add external contributor (#3490)

commit 233813483642c2ac370110dd42c3291556c26039
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:52:19 2019 +0100

    bump versions

commit 1b33a50e6d07e48f2377db64ce944a435f9f2ec4
Merge: 3c7bb6b5 5fa540bd
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:50:59 2019 +0100

    Merge remote-tracking branch 'remotes/origin/develop' into release/v0.31.1

commit 3c7bb6b571ac47e050a47013e22dbdfd68f02745
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:48:00 2019 +0100

    Add some numbers for #2778

commit 5fa540bdc9eac01cc3df6de01119550d1122114b
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 27 16:45:34 2019 +0100

    mempool: add a safety check, write tests for mempoolIDs (#3487)

    * mempool: add a safety check, write tests for mempoolIDs

    and document 65536 limit in the mempool reactor spec

    follow-up to https://github.com/tendermint/tendermint/pull/2778

    * rename the test

    * fixes after Ismail's review

commit 52727863e187e85901e7f2e7285920a701d2a8e6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:07:03 2019 +0100

    add external contributors

commit e3f840e6a6f81406c44e760e578e48fcd3fedf12
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:04:43 2019 +0100

    reset CHANGELOG_PENDING.md

commit ed63e1f378eaf465b714084fa1edd6ac4761782f
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:03:25 2019 +0100

    Add more entries to the Changelog, fix formatting, linkify

commit 55b7118c981e93b920cead4616b91ec58130e316
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 15:35:32 2019 +0100

    Prep changelog: copy from pending & update version

commit 5a25b75b1d586c6d9c3fdfc940057f7b85089a90
Author: zjubfd <baifudong@lancai.cn>
Date:   Wed Mar 27 00:13:14 2019 +0800

    p2p: refactor GetSelectionWithBias for addressbook (#3475)

    Why submit this pr:

        we have suffered from infinite loop in addrbook bug which takes us a long time to find out why process become a zombie peer. It have been fixed in #3232. But the ADDRS_LOOP is still there, risk of infinite loop is still exist.
        The algorithm that to random pick a bucket is not stable, which means the peer may unluckily always choose the wrong bucket for a long time, the time and cpu cost is meaningless.

    A simple improvement:
    shuffle bucketsNew and bucketsOld, and pick necessary number of address from them. A stable
    algorithm.

commit a4d9539544ba4377f16e797fea01090bc974e1b5
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 26 09:44:49 2019 +0100

    rpc/client: include NetworkClient interface into Client interface (#3473)

    I think it's nice when the Client interface has all the methods. If someone does not need a particular method/set of methods, she can use individual interfaces (e.g. NetworkClient, MempoolClient) or write her own interface.

    technically breaking

    Fixes #3458

commit 1bb8e02a962a1ffd7ce4e7355f648b644105f649
Author: HaoyangLiu <lhy.0318@163.com>
Date:   Tue Mar 26 16:29:06 2019 +0800

    mempool: fix broadcastTxRoutine leak (#3478)

    Refs #3306, irisnet@fdbb676

    I ran an irishub validator. After the validator node ran several days, I dump the whole goroutine stack. I found that there were hundreds of broadcastTxRoutine. However, the connected peer quantity was less than 30. So I belive that there must be broadcastTxRoutine leakage issue.

    According to my analysis, I think the root cause of this issue locate in below code:

    		select {
    		case <-next.NextWaitChan():
    			// see the start of the for loop for nil check
    			next = next.Next()
    		case <-peer.Quit():
    			return
    		case <-memR.Quit():
    			return
    		}

    As we know, if multiple paths are avaliable in the same time, then a random path will be selected. Suppose that next.NextWaitChan() and peer.Quit() are both avaliable, and next.NextWaitChan() is chosen.

                    // send memTx
    		msg := &TxMessage{Tx: memTx.tx}
    		success := peer.Send(MempoolChannel, cdc.MustMarshalBinaryBare(msg))
    		if !success {
    			time.Sleep(peerCatchupSleepIntervalMS * time.Millisecond)
    			continue
    		}

    Then next will be non-empty and the peer send operation won't be success. As a result, this go routine will be track into infinite loop and won't be released.

    My proposal is to check peer.Quit() and memR.Quit() in every loop no matter whether next is nil.

commit 6de7effb05581f9bea2e8af06e4e74a85c34bc5f
Author: Dev Ojha <ValarDragon@users.noreply.github.com>
Date:   Tue Mar 26 01:27:29 2019 -0700

    mempool no gossip back (#2778)

    Closes #1798

    This is done by making every mempool tx maintain a list of peers who its received the tx from. Instead of using the 20byte peer ID, it instead uses a local map from peerID to uint16 counter, so every peer adds 2 bytes. (Word aligned to probably make it 8 bytes)

    This also required resetting the callback function on every CheckTx. This likely has performance ramifications for instruction caching. The actual setting operation isn't costly with the removal of defers in this PR.

    * Make the mempool not gossip txs back to peers its received it from

    * Fix adversarial memleak

    * Don't break interface

    * Update changelog

    * Forgot to add a mtx

    * forgot a mutex

    * Update mempool/reactor.go

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Update mempool/mempool.go

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Use unknown peer ID

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * fix compilation

    * use next wait chan logic when skipping

    * Minor fixes

    * Add TxInfo

    * Add reverse map

    * Make activeID's auto-reserve 0

    * 0 -> UnknownPeerID

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Switch to making the normal case set a callback on the reqres object

    The recheck case is still done via the global callback, and stats
    are also set via global callback

    * fix merge conflict

    * Addres comments

    * Add cache tests

    * add cache tests

    * minor fixes

    * update metrics in reqResCb and reformat code

    * goimport -w mempool/reactor.go

    * mempool: update memTx senders

    I had to introduce txsMap for quick mempoolTx lookups.

    * change senders type from []uint16 to sync.Map

    Fixes DATA RACE:

    ```
    Read at 0x00c0013fcd3a by goroutine 183:
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).broadcastTxRoutine()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:195 +0x3c7

    Previous write at 0x00c0013fcd3a by D[2019-02-27|10:10:49.058] Read PacketMsg                               switch=3 peer=35bc1e3558c182927b31987eeff3feb3d58a0fc5@127.0.0.1
    :46552 conn=MConn{pipe} packet=\"PacketMsg{30:2B06579D0A143EB78F3D3299DE8213A51D4E11FB05ACE4D6A14F T:1}\"
    goroutine 190:
      github.com/tendermint/tendermint/mempool.(*Mempool).CheckTxWithInfo()
          /go/src/github.com/tendermint/tendermint/mempool/mempool.go:387 +0xdc1
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).Receive()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:134 +0xb04
      github.com/tendermint/tendermint/p2p.createMConnection.func1()
          /go/src/github.com/tendermint/tendermint/p2p/peer.go:374 +0x25b
      github.com/tendermint/tendermint/p2p/conn.(*MConnection).recvRoutine()
          /go/src/github.com/tendermint/tendermint/p2p/conn/connection.go:599 +0xcce

    Goroutine 183 (running) created at:
    D[2019-02-27|10:10:49.058] Send                                         switch=2 peer=1efafad5443abeea4b7a8155218e4369525d987e@127.0.0.1:46193 channel=48 conn=MConn{pipe} m
    sgBytes=2B06579D0A146194480ADAE00C2836ED7125FEE65C1D9DD51049
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).AddPeer()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:105 +0x1b1
      github.com/tendermint/tendermint/p2p.(*Switch).startInitPeer()
          /go/src/github.com/tendermint/tendermint/p2p/switch.go:683 +0x13b
      github.com/tendermint/tendermint/p2p.(*Switch).addPeer()
          /go/src/github.com/tendermint/tendermint/p2p/switch.go:650 +0x585
      github.com/tendermint/tendermint/p2p.(*Switch).addPeerWithConnection()
          /go/src/github.com/tendermint/tendermint/p2p/test_util.go:145 +0x939
      github.com/tendermint/tendermint/p2p.Connect2Switches.func2()
          /go/src/github.com/tendermint/tendermint/p2p/test_util.go:109 +0x50

    I[2019-02-27|10:10:49.058] Added good transaction                       validator=0 tx=43B4D1F0F03460BD262835C4AA560DB860CFBBE85BD02386D83DAC38C67B3AD7 res=\"&{CheckTx:gas_w
    anted:1 }\" height=0 total=375
    Goroutine 190 (running) created at:
      github.com/tendermint/tendermint/p2p/conn.(*MConnection).OnStart()
          /go/src/github.com/tendermint/tendermint/p2p/conn/connection.go:210 +0x313
      github.com/tendermint/tendermint/libs/common.(*BaseService).Start()
          /go/src/github.com/tendermint/tendermint/libs/common/service.go:139 +0x4df
      github.com/tendermint/tendermint/p2p.(*peer).OnStart()
          /go/src/github.com/tendermint/tendermint/p2p/peer.go:179 +0x56
      github.com/tendermint/tendermint/libs/common.(*BaseService).Start()
          /go/src/github.com/tendermint/tendermint/libs/common/service.go:139 +0x4df
      github.com/tendermint/tendermint/p2p.(*peer).Start()
          <autogenerated>:1 +0x43
      github.com/tendermint/tendermint/p2p.(*Switch).startInitPeer()
    ```

    * explain the choice of a map DS for senders

    * extract ids pool/mapper to a separate struct

    * fix literal copies lock value from senders: sync.Map contains sync.Mutex

    * use sync.Map#LoadOrStore instead of Load

    * fixes after Ismail's review

    * rename resCbNormal to resCbFirstTime

commit 25a3c8b1724c9611d6edc175b1b0d079f5ee28c1
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 24 01:08:15 2019 +0800

    rpc: support tls rpc (#3469)

    Refs #3419

commit 85be2a554e7e7752bed0b9409ab153bf04e05e7b
Author: Thane Thomson <connect@thanethomson.com>
Date:   Fri Mar 22 09:16:38 2019 -0400

     tools/tm-signer-harness: update height and round for test harness (#3466)

    In order to re-enable the test harness for the KMS (see
    tendermint/kms#227), we need some marginally more realistic proposals
    and votes. This is because the KMS does some additional sanity checks
    now to ensure the height and round are increasing over time.

commit 1d4afb179b9660bf13705c67b01e20838a4506eb
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 21 11:05:39 2019 +0100

    replace PB2TM.ConsensusParams with a call to params#Update (#3448)

    Fixes #3444

commit 660bd4a53e0dd7642a473689c8686c3f83e3a0ca
Author: tracebundy <745403419@qq.com>
Date:   Wed Mar 20 20:30:49 2019 +0800

    fix comment (#3454)

commit 81b9bdf40010c6a4e336133ec53fe6e4e6089911
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Mar 20 08:29:40 2019 -0400

    comments on validator ordering (#3452)

    * comments on validator ordering

    * NextValidatorsHash

commit 926127c774a2c9110c4284938411818918ffecac
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 20 03:59:33 2019 +0300

    blockchain: update the maxHeight when a peer is removed (#3350)

    * blockchain: update the maxHeight when a peer is removed

    Refs #2699

    * add a changelog entry

    * make linter pass

commit 03085c2da23b179c4a51f59a03cb40aa4e85a613
Author: zjubfd <baifudong@lancai.cn>
Date:   Wed Mar 20 08:18:18 2019 +0800

    rpc: client disable compression (#3430)

commit 7af4b5086af9268f7cc8b41f5a174ade675d8ab4
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 20 03:10:54 2019 +0300

    Remove RepeatTimer and refactor Switch#Broadcast (#3429)

    * p2p: refactor Switch#Broadcast func

    - call wg.Add only once
    - do not call peers.List twice!
      * bad for perfomance
      * peers list can change in between calls!

    Refs #3306

    * p2p: use time.Ticker instead of RepeatTimer

    no need in RepeatTimer since we don't Reset them

    Refs #3306

    * libs/common: remove RepeatTimer (also TimerMaker and Ticker interface)

    \"ancient code that‚Äôs caused no end of trouble\" Ethan

    I believe there's much simplier way to write a ticker than can be reset
    https://medium.com/@arpith/resetting-a-ticker-in-go-63858a2c17ec

commit 60b2ae5f5a3e16625af1342e012462448d565394
Author: needkane <604476380@qq.com>
Date:   Wed Mar 20 08:00:53 2019 +0800

    crypto: delete unused code (#3426)

commit a6349f50633a45755041b8230a0f7eb990383cfd
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Wed Mar 20 01:56:13 2019 +0200

    Formalize proposer election algorithm properties  (#3140)

    * Update proposer-selection.md

    * Fixed typos

    * fixed typos

    * Attempt to address some comments

    * Update proposer-selection.md

    * Update proposer-selection.md

    * Update proposer-selection.md

    Added the normalization step.

    * Addressed review comments

    * New example for normalization section

    Added a new example to better show the need for normalization
    Added requirement for changing validator set
    Addressed review comments

    * Fixed problem with R2

    * fixed the math for new validator

    * test

    * more small updates

    * Moved the centering above the round-robin election

    - the centering is now done before the actual round-robin block
    - updated examples
    - cleanup

    * change to reflect new implementation for new validator

commit 22bcfca87a987dc43ad111a226b072ce09bbeb8d
Merge: 4162ebe8 0d985ede
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:54:09 2019 -0400

    Merge pull request #3450 from tendermint/master

    Merge master back to develop

commit 0d985ede28bd6937fa9d3613618e42cab6fc871c
Merge: 97681953 1e346978
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:53:37 2019 -0400

    Merge pull request #3417 from tendermint/release/v0.31.0

    Release/v0.31.0

commit 1e3469789dce5a034a21b6e48288f1809a102595
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 20 00:45:51 2019 +0100

    Ensure WriteTimeout > TimeoutBroadcastTxCommit (#3443)

    * Make sure config.TimeoutBroadcastTxCommit < rpcserver.WriteTimeout()

    * remove redundant comment

    * libs/rpc/http_server: move Read/WriteTimeout into Config

    * increase defaults for read/write timeouts

    Based on this article
    https://www.digitalocean.com/community/tutorials/how-to-optimize-nginx-configuration

    * WriteTimeout should be larger than TimeoutBroadcastTxCommit

    * set a deadline for subscribing to txs

    * extract duration into const

    * add two changelog entries

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * 12 -> 10

    * changelog

    * changelog

commit 5f68fbae37e11b01f4d2e5c33b182401a7283e4a
Merge: 551b6322 e276f35f
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:25:26 2019 -0400

    Merge pull request #3449 from tendermint/ismail/merge_develop_into_release/0.31.0

    Merge develop into release/0.31.0

commit e276f35f86b3980e088a95aa70c96dbddcdf658b
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 14:36:42 2019 +0100

    remove 3421 from changelog

commit 8e62a3d62a5b04a5a7126d00d75925c990aec9c6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 12:19:02 2019 +0100

    Add #3421 to changelog and reorder alphabetically

commit 48aaccab8f3cc17032220a01a6d58acde695bbde
Merge: 551b6322 4162ebe8
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 12:09:26 2019 +0100

    Merge in develop and update CHANGELOG.md

commit 4162ebe8b586deccc0e7476d8abafb75138bfe58
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 19 11:38:32 2019 +0400

    types: refactor PB2TM.ConsensusParams to take BlockTimeIota as an arg (#3442)

    See https://github.com/tendermint/tendermint/pull/3403/files#r266208947

    In #3403 we unexposed BlockTimeIota from the ABCI, but it's still part
    of the ConsensusParams struct, so we have to remember to add it back
    after calling PB2TM.ConsensusParams. Instead, PB2TM.ConsensusParams
    should take it as an argument

    Fixes #3432

commit 551b6322f5a74f578a8487001e805e4e1da6394d
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Sat Mar 16 19:24:12 2019 -0400

    Update v0.31.0 release notes (#3434)

    * changelog: fix formatting

    * update release notes

    * update changelog

    * linkify

    * update UPGRADING

commit 52c4e15eb25e8a3d6e77f90239710de3655d4ec6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 14 16:07:06 2019 +0100

    changelog: more review fixes/release/v0.31.0 (#3427)

    * Update release summary

    * Add pubsub config changes

    * Add link to issue for pubsub changes

commit 5483ac6b0a2a75bc140487e8405392533a3f1687
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 14 12:17:49 2019 +0100

    minor changes / fixes to release 0.31.0 (#3422)

    * bump ABCIVersion due to renaming BlockSizeParams -> BlockParams
    (https://github.com/tendermint/tendermint/pull/3417#discussion_r264974791)

    * Move changelog on consensus params entry to breaking

    * Add @melekes' suggestion for breaking change in pubsub into upgrading.md

    * Add changelog entry for #3351

    * Add changelog entry for #3358 & #3359

    * Add changelog entry for #3397

    * remove changelog entry for #3397 (was already released in 0.30.2)

    * move 3351 to improvements

    * Update changelog comment

commit 745713330736c5c751450245d88b8037cbee3aa6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 14 15:00:58 2019 +0400

    grpcdb: close Iterator/ReverseIterator after use (#3424)

    Fixes #3402

commit a59930a327065f2d091840586da6c35b6fd07472
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 13 16:09:05 2019 +0400

    localnet: fix $LOG variable (#3423)

    Fixes #3421

    Before: it was creating a file named ${LOG:-tendermint.log} in .build/nodeX
    After: it creates a file named tendermint.log

commit 85c023db88a8517587f0e8499b1e89f0eea1112d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 12 20:07:26 2019 +0100

    Prep release v0.31.0:
     - update changelog, reset pending
     - bump versions
     - add external contributors (partly manually)

commit 4cbd36f341c8fee55a4ea386aee42a2c7fe9c67d
Merge: e42f833f 97681953
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 12 21:22:03 2019 +0400

    Merge pull request #3415 from tendermint/master

    Merge master back to develop (do not squash)

commit e42f833fd4ce6cb886dbf594dcb2f3af61918325
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 12 16:20:59 2019 +0400

    Merge master back to develop (#3412)

    * libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

    * update changelog and bump version to 0.30.2

commit ad3e990c6a424d939b181a2a7c911eb4592c0c79
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 23:59:00 2019 +0400

    fix GO_VERSION in installation scripts (#3411)

    there is no such file https://storage.googleapis.com/golang/go1.12.0.linux-amd64.tar.gz

    Fixes #3405

commit 676212fa8fdd1ddf29e9c352129c97da3c113769
Author: srmo <srm@schakalacka.org>
Date:   Mon Mar 11 20:06:03 2019 +0100

    cmd: make sure to have 'testnet' create the data directory for nonvals (#3409)

    Fixes #3408

commit 303557203402f0a1b6db4a55cb2c6562765058b1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:52:09 2019 +0400

    cs: comment out log.Error to avoid TestReactorValidatorSetChanges timing out (#3401)

commit d741c7b4785c36cef4b0912900b6193db21d00e6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:45:58 2019 +0400

    limit number of /subscribe clients and queries per client (#3269)

    * limit number of /subscribe clients and queries per client

    Add the following config variables (under [rpc] section):
      * max_subscription_clients
      * max_subscriptions_per_client
      * timeout_broadcast_tx_commit

    Fixes #2826

    new HTTPClient interface for subscriptions

    finalize HTTPClient events interface

    remove EventSubscriber

    fix data race

    ```
    WARNING: DATA RACE
    Read at 0x00c000a36060 by goroutine 129:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:168 +0x1f0

    Previous write at 0x00c000a36060 by goroutine 132:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:191 +0x4e0
      github.com/tendermint/tendermint/rpc/client.WaitForOneEvent()
          /go/src/github.com/tendermint/tendermint/rpc/client/helpers.go:64 +0x178
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:139 +0x298
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Goroutine 129 (running) created at:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:164 +0x4b7
      github.com/tendermint/tendermint/rpc/client.WaitForOneEvent()
          /go/src/github.com/tendermint/tendermint/rpc/client/helpers.go:64 +0x178
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:139 +0x298
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Goroutine 132 (running) created at:
      testing.(*T).Run()
          /usr/local/go/src/testing/testing.go:878 +0x659
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:119 +0x186
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
    ==================
    ```

    lite client works (tested manually)

    godoc comments

    httpclient: do not close the out channel

    use TimeoutBroadcastTxCommit

    no timeout for unsubscribe

    but 1s Local (5s HTTP) timeout for resubscribe

    format code

    change Subscribe#out cap to 1

    and replace config vars with RPCConfig

    TimeoutBroadcastTxCommit can't be greater than rpcserver.WriteTimeout

    rpc: Context as first parameter to all functions

    reformat code

    fixes after my own review

    fixes after Ethan's review

    add test stubs

    fix config.toml

    * fixes after manual testing

    - rpc: do not recommend to use BroadcastTxCommit because it's slow and wastes
    Tendermint resources (pubsub)
    - rpc: better error in Subscribe and BroadcastTxCommit
    - HTTPClient: do not resubscribe if err = ErrAlreadySubscribed

    * fixes after Ismail's review

    * Update rpc/grpc/grpc_test.go

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 15f621141dce76d992f6c8dcfbd4c522878b6108
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:21:17 2019 +0400

    remove TimeIotaMs from ABCI consensus params (#3403)

    Also

    - init substructures to avoid panic in pb2tm.ConsensusParams
    Before: if csp.Block is nil and we later try to access/write to it,
    we'll panic.
    After: if csp.Block is nil and we later try to access/write to it,
    there'll be no panic.

commit dc359bd3a51c52803a6af820a36ee41796284e87
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Mon Mar 11 16:17:25 2019 +0200

    types: remove check for priority order of existing validators (#3407)

    When scaling and averaging is invoked, it is possible to have validators
    with close priorities ending up with same priority. With the current code,
    this  makes it impossible to verify the priority orders before and after updates.

    Fixes #3383

commit 976819537d199aa43c6ad55ec4e8958323322bb0
Merge: e0f89364 f996b10f
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Mar 11 08:17:14 2019 -0400

    Merge pull request #3399 from tendermint/release/v0.30.2

    Release/v0.30.2

commit 100ff08de93ff1907bf810f584ec5bdc7a2a5260
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 15:31:53 2019 +0400

    p2p: do not panic when filter times out (#3384)

    Fixes #3369

commit f996b10f479d7c9a6d81cca5a02c47b29a52b3f3
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sun Mar 10 13:06:34 2019 +0400

    update changelog and bump version to 0.30.2

commit 36d7180ca216f0d7ff62851fa441de2b0371d699
Author: Yumin Xia <stumblecra@gmail.com>
Date:   Sun Mar 10 00:46:32 2019 -0800

    libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

commit b021f1e505482fb34f8a8e57cd86b171e4a57344
Author: Yumin Xia <stumblecra@gmail.com>
Date:   Sun Mar 10 00:46:32 2019 -0800

    libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

commit 90794260bcd23989e4bd8530d596e39d9509e7ca
Author: mircea-c <mircea@tendermint.com>
Date:   Sat Mar 9 10:13:36 2019 -0500

    circleci: removed complexity from docs deployment job  (#3396)

commit b6a510a3e7cefca56af4bdb009413e3950c6d59e
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Mar 8 09:46:09 2019 +0400

    make ineffassign linter pass (#3386)

    Refs #3262

    This fixes two small bugs:

    1) lite/dbprovider: return `ok` instead of true in parse* functions. It's weird that we're ignoring `ok` value before.
    2) consensus/state: previously because of the shadowing we almost never output \"Error with msg\". Now we declare both `added` and `err` in the beginning of the function, so there's no shadowing.

commit e415c326f93e5fa473d83a0ea6fa495ad0ea87f3
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Mar 8 06:40:59 2019 +0100

    update golang.org/x/crypto (#3392)

    Update Gopkg.lock via dep ensure --update golang.org/x/crypto

    see #3391 (comment) (nothing to review here really).

commit 28e9e9e7145b357cbd7078f4c83dcf66c13d4f7d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 7 17:03:57 2019 +0100

    update levigo to 1.0.0 (#3389)

    Although the version we were pinning to is from Nov. 2016 there were no substantial changes:

        jmhodges/levigo@2b8c778 added go-modules support (no code changes)
        jmhodges/levigo@853d788 added a badge to the readme

    closes #3381

commit 3ebfa99f2c2403c17348e41190406892abf21d2a
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 7 19:35:04 2019 +0400

    do not pin repos without releases to exact revisions (#3382)

    We're pinning repos without releases because it's very easy to upgrade all the dependencies by executing dep ensure --upgrade. Instead, we should just never run this command directly, only dep ensure --upgrade <some repo>. And we can defend that in PRs.

    Refs #3374

    The problem with pinning to exact revisions: people who import Tendermint as a library (e.g. abci/types) are stuck with these revisions even though the code they import may not even use them.

commit 91b488f9a541f5dd69f0bb2db4249356733a2ed3
Author: YOSHIDA Masanori <masanori.yoshida@gmail.com>
Date:   Thu Mar 7 22:02:13 2019 +0900

    docs: fix the reverse of meaning in spec (#3387)

    https://tools.ietf.org/html/rfc6962#section-2.1
    \"The largest power of two less than the number of items\" is actually correct!

        For n > 1, let k be the largest power of two smaller than n (i.e.,
        k < n <= 2k).

commit f25d727035f4615cbb4b43452191fd83218fc1e1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 7 09:10:34 2019 +0400

    make dupl linter pass (#3385)

    Refs #3262

commit 411bc5e49fcc3dda866ae799ba2ceda0084f80d4
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Wed Mar 6 09:54:49 2019 +0100

    types: followup after validator set changes (#3301)

    * fix failure in TestProposerFrequency

    * Add test to check priority order after updates

    * Changed applyRemovals() and removed Remove()

    Changed applyRemovals() similar to applyUpdates()
    Removed function Remove()
    Updated comments

    * review comments

    * simplify applyRemovals and add more comments

    * small correction in comment

    * Fix check in test

    * Fix priority check for centering, address review comments

    * fix assert for priority centering

    * review comments

    * review comments

    * cleanup and review comments

    added upper limit check for validator voting power
    moved check for empty validator set earlier
    moved panic on potential negative set length in verifyRemovals
    added more tests

    * review comments

commit 858875fbb8b94debc4973fdf5923ced6564d3c39
Author: Silas Davis <silas@monax.io>
Date:   Wed Mar 6 08:22:35 2019 +0000

    Copy secp256k1 code from go-ethereum to avoid GPL vendoring issues in (#3371)

    downstream

    Signed-off-by: Silas Davis <silas@monax.io>

commit 1eaa42cd25f2355f4b30440bddae435d056d1f44
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 5 08:08:52 2019 +0100

    golang 1.12.0 (#3376)

     - update docker image on circleci
     - remove GOCACHE=off from Makefile (see:
     https://tip.golang.org/doc/go1.12#gocache)
     - update badge in readme
     - update in scripts/install
     - update Vagrantfile
     - update in networks/remote/integration.sh
     - tools/build/Makefile

commit 8c9df30e28a3b95efe537afe9930de2150999441
Author: Jack Zampolin <jack.zampolin@gmail.com>
Date:   Mon Mar 4 22:56:46 2019 -0800

    libs/db: Add cleveldb.Stats() (#3379)

    Fixes: #3378

    * Add stats to cleveldb implementation

    * update changelog

    * remote TODO

    also
    - sort keys
    - preallocate memory

    * fix const initializer []string literal is not a constant

    * add test

commit 52771e1287eb44eabae99e6d2781a57c577821bb
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 13:24:44 2019 +0400

    make BlockTimeIota a consensus parameter, not a locally configurable ‚Ä¶ (#3048)

    * make BlockTimeIota a consensus parameter, not a locally configurable option

    Refs #2920

    * make TimeIota int64 ms

    Refs #2920

    * update Gopkg.toml

    * fixes after Ethan's review

    * fix TestRemoteSignerProposalSigningFailed

    * update changelog

commit f39138aa2e543438548a150bdad45304ccc3296b
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 12:18:32 2019 +0400

    remove RoundState from EventDataRoundState (#3354)

    Before we're using it to get a round state in tests. Now it can be done
    by calling csX.GetRoundState. We will need to rewrite
    TestStateSlashingPrevotes and TestStateSlashingPrecommits, which are
    commented right now, to not rely on EventDataRoundState#RoundState
    field.

    Refs #1527

commit 8a962ffc4639eed95501114e0436ccffc52f8ef1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 12:17:38 2019 +0400

    deps: update gogo/protobuf from 1.1.1 to 1.2.1 and golang/protobuf from 1.1.0 to 1.3.0 (#3357)

    * deps: update gogo/proto from 1.1.1 to 1.2.1

    - verified changes manually
      git diff 636bf030~ ba06b47c --stat -- ':!*.pb.go' ':!test'

    * deps: update golang/protobuf from 1.1.0 to 1.3.0

    - verified changes manually
      git diff b4deda0~ c823c79 -- ':!*.pb.go' ':!test'

commit 3421e4dcd7c6937e9ae8f72af17b38840840a781
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 05:36:52 2019 +0800

    make lightd availbe (#3364)

    1.\"abci_query\": rpcserver.NewRPCFunc(c.ABCIQuery, \"path,data,prove\")
    \"validators\": rpcserver.NewRPCFunc(c.Validators, \"height\"),
    the parameters and function do not match, cause index out of range error.
    2. the prove of query is forced to be true, while default option is false.
    3. fix the wrong key of merkle

commit 976b1c2ef73e557a702ef17600e1eeaf4865f292
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 04:21:21 2019 +0800

    fix pool timer leak bug, resolve#3353 (#3358)

    When remove peer, block pool simple remove bpPeer,
    but do not stop timer, that cause stopError for recorrected
    peers. Stop timer when remove from pool.

commit d95894152beb3b25423cdb109af006340f0ac80b
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 04:17:37 2019 +0800

    fix dirty data in peerset,resolve #3304 (#3359)

    * fix dirty data in peerset

    startInitPeer before PeerSet add the peer,
    once mconnection start and Receive of one
    Reactor faild, will try to remove it from PeerSet
    while PeerSet still not contain the peer. Fix
    this by change the order.

    * fix test FilterDuplicate

    * fix start/stop race

    * fix err

commit 37a548414bbb5dc8dce9fe452ba5f933fad29684
Author: Sven-Hendrik Haase <svenstaro@gmail.com>
Date:   Sat Mar 2 07:06:57 2019 +0100

    docs: fix typo (#3373)

commit 853dd34d31bee6de593be94df87cbb508688249e
Author: Juan Leni <juan.leni@zondax.ch>
Date:   Thu Feb 28 08:48:20 2019 +0100

    privval: improve Remote Signer implementation (#3351)

    This issue is related to #3107
    This is a first renaming/refactoring step before reworking and removing heartbeats.
    As discussed with @Liamsi , we preferred to go for a couple of independent and separate PRs to simplify review work.

    The changes:

        Help to clarify the relation between the validator and remote signer endpoints
        Differentiate between timeouts and deadlines
        Prepare to encapsulate networking related code behind RemoteSigner in the next PR

    My intention is to separate and encapsulate the \"network related\" code from the actual signer.

    SignerRemote ---(uses/contains)--> SignerValidatorEndpoint <--(connects to)--> SignerServiceEndpoint ---> SignerService (future.. not here yet but would like to decouple too)

    All reconnection/heartbeat/whatever code goes in the endpoints. Signer[Remote/Service] do not need to know about that.

    I agree Endpoint may not be the perfect name. I tried to find something \"Go-ish\" enough. It is a common name in go-kit, kubernetes, etc.

    Right now:
    SignerValidatorEndpoint:

        handles the listener
        contains SignerRemote
        Implements the PrivValidator interface
        connects and sets a connection object in a contained SignerRemote
        delegates PrivValidator some calls to SignerRemote which in turn uses the conn object that was set externally

    SignerRemote:

        Implements the PrivValidator interface
        read/writes from a connection object directly
        handles heartbeats

    SignerServiceEndpoint:

        Does most things in a single place
        delegates to a PrivValidator IIRC.

    * cleanup

    * Refactoring step 1

    * Refactoring step 2

    * move messages to another file

    * mark for future work / next steps

    * mark deprecated classes in docs

    * Fix linter problems

    * additional linter fixes

commit d6e2fb453d20841828cfbe1f6a7e8ca593c1b564
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Feb 28 11:31:59 2019 +0400

    update docs (#3349)

    * docs: explain create_empty_blocks configurations

    Closes #3307

    * Vagrantfile: install nodejs for docs

    * update docs instructions

    npm install does not make sense since there's no packages.json file

    * explain broadcast_tx_* tx format

    Closes #536

    * docs: explain how transaction ordering works

    Closes #2904

    * bring in consensus parameters explained

    * example for create_empty_blocks_interval

    * bring in explanation from https://github.com/tendermint/tendermint/issues/2487#issuecomment-424899799

    * link to formatting instead of duplicating info

commit ec9bff52346d9629f690147674326a41fcefd20f
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 25 09:11:07 2019 +0400

    rename WAL#Flush to WAL#FlushAndSync (#3345)

    * rename WAL#Flush to WAL#FlushAndSync

    - rename auto#Flush to auto#FlushAndSync
    - cleanup WAL interface to not leak implementation details!
      * remove Group()
      * add WALReader interface and return it in SearchForEndHeight()
    - add interface assertions

    Refs #3337

    * replace WALReader with io.ReadCloser

commit 6797d8585167a9dc1e51843420ae4ab7eaf848a0
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Feb 25 06:06:21 2019 +0100

    p2p: fix comment in secret connection (#3348)

    Just a minor followup on the review if #3347: Fixes a comment. [#3347 (comment)](https://github.com/tendermint/tendermint/pull/3347#discussion_r259582330)

commit cdf3a74f4899b3c716703b932e682307752cd6b6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 19:48:28 2019 +0400

    Unclean shutdown on SIGINT / SIGTERM (#3308)

    * libs/common: TrapSignal accepts logger as a first parameter

     and does not block anymore
    * previously it was dumping \"captured ...\" msg to os.Stdout
    * TrapSignal should not be responsible for blocking thread of execution

    Refs #3238

    * exit with zero (0) code upon receiving SIGTERM/SIGINT

    Refs #3238

    * fix formatting in docs/app-dev/abci-cli.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * fix formatting in docs/app-dev/abci-cli.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 41f91318e9e253a1b59cc1cc128ad412941b8e2a
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 19:32:31 2019 +0400

    bound mempool memory usage (#3248)

    * bound mempool memory usage

    Closes #3079

    * rename SizeBytes to TxsTotalBytes

    and other small fixes after Zarko's review

    * rename MaxBytes to MaxTxsTotalBytes

    * make ErrMempoolIsFull more informative

    * expose mempool's txs_total_bytes via RPC

    * test full response

    * fixes after Ethan's review

    * config: rename mempool.size to mempool.max_txs

    https://github.com/tendermint/tendermint/pull/3248#discussion_r254034004

    * test more cases

    https://github.com/tendermint/tendermint/pull/3248#discussion_r254036532

    * simplify test

    * Revert \"config: rename mempool.size to mempool.max_txs\"

    This reverts commit 39bfa3696177aa46195000b90655419a975d6ff7.

    * rename count back to n_txs

    to make a change non-breaking

    * rename max_txs_total_bytes to max_txs_bytes

    * format code

    * fix TestWALPeriodicSync

    The test was sometimes failing due to processFlushTicks being called too
    early. The solution is to call wal#Start later in the test.

    * Apply suggestions from code review

commit e0adc5e807c8c2ea4ac03f8eeeb006b1a154d453
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Sat Feb 23 16:25:57 2019 +0100

    secret connection check all zeroes (#3347)

    * reject the shared secret if is all zeros in case the blacklist was not
    sufficient

    * Add test that verifies lower order pub-keys are rejected at the DH step

    * Update changelog

    * fix typo in test-comment

commit 2137ecc130874118cc23995befed370958c34448
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 08:11:27 2019 +0400

    pubsub 2.0 (#3227)

    * green pubsub tests :OK:

    * get rid of clientToQueryMap

    * Subscribe and SubscribeUnbuffered

    * start adapting other pkgs to new pubsub

    * nope

    * rename MsgAndTags to Message

    * remove TagMap

    it does not bring any additional benefits

    * bring back EventSubscriber

    * fix test

    * fix data race in TestStartNextHeightCorrectly

    ```
    Write at 0x00c0001c7418 by goroutine 796:
      github.com/tendermint/tendermint/consensus.TestStartNextHeightCorrectly()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:1296 +0xad
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Previous read at 0x00c0001c7418 by goroutine 858:
      github.com/tendermint/tendermint/consensus.(*ConsensusState).addVote()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:1631 +0x1366
      github.com/tendermint/tendermint/consensus.(*ConsensusState).tryAddVote()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:1476 +0x8f
      github.com/tendermint/tendermint/consensus.(*ConsensusState).handleMsg()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:667 +0xa1e
      github.com/tendermint/tendermint/consensus.(*ConsensusState).receiveRoutine()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:628 +0x794

    Goroutine 796 (running) created at:
      testing.(*T).Run()
          /usr/local/go/src/testing/testing.go:878 +0x659
      testing.runTests.func1()
          /usr/local/go/src/testing/testing.go:1119 +0xa8
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
      testing.runTests()
          /usr/local/go/src/testing/testing.go:1117 +0x4ee
      testing.(*M).Run()
          /usr/local/go/src/testing/testing.go:1034 +0x2ee
      main.main()
          _testmain.go:214 +0x332

    Goroutine 858 (running) created at:
      github.com/tendermint/tendermint/consensus.(*ConsensusState).startRoutines()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:334 +0x221
      github.com/tendermint/tendermint/consensus.startTestRound()
          /go/src/github.com/tendermint/tendermint/consensus/common_test.go:122 +0x63
      github.com/tendermint/tendermint/consensus.TestStateFullRound1()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:255 +0x397
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
    ```

    * fixes after my own review

    * fix formatting

    * wait 100ms before kicking a subscriber out

    + a test for indexer_service

    * fixes after my second review

    * no timeout

    * add changelog entries

    * fix merge conflicts

    * fix typos after Thane's review

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * reformat code

    * rewrite indexer service in the attempt to fix failing test

    https://github.com/tendermint/tendermint/pull/3227/#issuecomment-462316527

    * Revert \"rewrite indexer service in the attempt to fix failing test\"

    This reverts commit 0d9107a098230de7138abb1c201877c246e89ed1.

    * another attempt to fix indexer

    * fixes after Ethan's review

    * use unbuffered channel when indexing transactions

    Refs https://github.com/tendermint/tendermint/pull/3227#discussion_r258786716

    * add a comment for EventBus#SubscribeUnbuffered

    * format code

commit 67fd42835448172d08616589f1473e7153cc0902
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Feb 22 11:49:08 2019 +0400

    fix TestWALPeriodicSync (#3342)

    The test was sometimes failing due to processFlushTicks being called too
    early. The solution is to call wal#Start later in the test.

commit f22ada442a249597dff765a59197bc57a8eae349
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Feb 22 11:48:40 2019 +0400

    refactor decideProposal in common_test (#3343)

commit ed1de135486608d8b4869760960e3eb35ade2c6d
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Feb 21 18:28:02 2019 +0400

    cs: update wal comments (#3334)

    * cs: update wal comments

    Follow-up to https://github.com/tendermint/tendermint/pull/3300

    * Update consensus/wal.go

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 4f83eec78251b9228f0edb76f261e3e387d21c12
Merge: db5d7602 e0f89364
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:11:33 2019 -0500

    Merge pull request #3339 from tendermint/master

    Merge master back to develop

commit e0f8936455029a40287a69d5b0e7baa4d5864da1
Merge: 28d75ec8 f2351dc7
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:10:49 2019 -0500

    Merge pull request #3326 from tendermint/release/v0.30.1

    Release/v0.30.1

commit f2351dc758e5c8cf6bc6c5c32931daa8ae6e49a9
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:05:57 2019 -0500

    update changelog

commit db5d7602fea6a3418d4ae83511c1a35cf9e1c9ca
Author: Daniil Lashin <danil-lashin@yandex.ru>
Date:   Wed Feb 20 14:34:52 2019 +0300

    docs: fix rpc Tx() method docs (#3331)

commit dff3deb2a95474ee1a10fc6aa7fd0a0a9a6aee94
Author: Thane Thomson <connect@thanethomson.com>
Date:   Wed Feb 20 07:45:18 2019 +0200

    cs: sync WAL more frequently (#3300)

    As per #3043, this adds a ticker to sync the WAL every 2s while the WAL is running.

    * Flush WAL every 2s

    This adds a ticker that flushes the WAL every 2s while the WAL is
    running. This is related to #3043.

    * Fix spelling

    * Increase timeout to 2mins for slower build environments

    * Make WAL sync interval configurable

    * Add TODO to replace testChan with more comprehensive testBus

    * Remove extraneous debug statement

    * Remove testChan in favour of using system time

    As per
    https://github.com/tendermint/tendermint/pull/3300#discussion_r255886586,
    this removes the `testChan` WAL member and replaces the approach with a
    system time-oriented one. In this new approach, we keep track of the
    system time at which each flush and periodic flush successfully
    occurred.

    The naming of the various functions is also updated here to be more
    consistent with \"flushing\" as opposed to \"sync'ing\".

    * Update naming convention and ensure lock for timestamp update

    * Add Flush method as part of WAL interface

    Adds a `Flush` method as part of the WAL interface to enforce the idea
    that we can manually trigger a WAL flush from outside of the WAL. This
    is employed in the consensus state management to flush the WAL prior to
    signing votes/proposals, as per https://github.com/tendermint/tendermint/issues/3043#issuecomment-453853630

    * Update CHANGELOG_PENDING

    * Remove mutex approach and replace with DI

    The dependency injection approach to dealing with testing concerns could
    allow similar effects to some kind of \"testing bus\"-based approach. This
    commit introduces an example of this, where instead of relying on
    (potentially fragile) timing of things between the code and the test, we
    inject code into the function under test that can signal the test
    through a channel.

    This allows us to avoid the `time.Sleep()`-based approach previously
    employed.

    * Update comment on WAL flushing during vote signing

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Simplify flush interval definition

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Expand commentary on WAL disk flushing

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Add broken test to illustrate WAL sync test problem

    Removes test-related state (dependency injection code) from the WAL data
    structure and adds test code to illustrate the problem with using
    `WALGenerateNBlocks` and `wal.SearchForEndHeight` to test periodic
    sync'ing.

    * Fix test error messages

    * Use WAL group buffer size to check for flush

    A function is added to `libs/autofile/group.go#Group` in order to return
    the size of the buffered data (i.e. data that has not yet been flushed
    to disk). The test now checks that, prior to a `time.Sleep`, the group
    buffer has data in it. After the `time.Sleep` (during which time the
    periodic flush should have been called), the buffer should be empty.

    * Remove config root dir removal from #3291

    * Add godoc for NewWAL mentioning periodic sync

commit 9d4f59b8366ad393410051e09672b76578545d9e
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 18 15:27:07 2019 +0400

    update changelog and bump version

commit d2c7f8dbcf238ccc3a2469e350523c7ed28be154
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Feb 18 11:08:22 2019 +0100

    p2p: check secret conn id matches dialed id (#3321)

    ref: [#3010 (comment)](https://github.com/tendermint/tendermint/issues/3010#issuecomment-464287627)

    > I tried searching for code where we authenticate a peer against its NetAddress.ID and couldn't find it. I don't see a reason to switch to Noise, but a need to ensure that the node's ID is authenticated e.g. after dialing from the address book.

    * p2p: check secret conn id matches dialed id

    * Fix all p2p tests & make code compile

    * add simple test for dialing with wrong ID

    * update changelog

    * address review comments

    * yet another place where to use IDAddressString and fix
    testSetupMultiplexTransport

commit 8283ca7ddb5b56090aaa15e005b40782fa618ae7
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 18 13:23:40 2019 +0400

    3291 follow-up (#3323)

    * changelog: use issue number instead of PR number

    * follow up to #3291

    - rpc/test/helpers.go add StopTendermint(node) func
    - remove ensureDir(filepath.Dir(walFile), 0700)
    - mempool/mempool_test.go add type cleanupFunc func()

    * cmd/show_validator: wrap err to make it more clear

commit 59cc6d36c944012cd4ae39fbee698e8cf353005a
Author: Alessio Treglia <quadrispro@ubuntu.com>
Date:   Mon Feb 18 08:45:27 2019 +0100

    improve ResetTestRootWithChainID() concurrency safety (#3291)

    * improve ResetTestRootWithChainID() concurrency safety

    Rely on ioutil.TempDir() to create test root directories and ensure
    multiple same-chain id test cases can run in parallel.

    * Update config/toml.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * clean up test directories after completion

    Closes: #1034

    * Remove redundant EnsureDir call

    * s/PanicSafety()/panic()/s

    * Put create dir functionality back in ResetTestRootWithChainID

    * Place test directories in OS's tempdir

    In modern UNIX and UNIX-like systems /tmp is very often
    mounted as tmpfs. This might speed test execution a bit.

    * Set 0700 to a const

    * rootsDirs -> configRootDirs

    * Don't double remove directories

    * Avoid global variables

    * Fix consensus tests

    * Reduce defer stack

    * Address review comments

    * Try to fix tests

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * Update consensus/common_test.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * Update consensus/common_test.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

commit af8793c01a168f0f15d3147673c572c0f8bf7863
Author: Zarko Milosevic <zarko@interchain.io>
Date:   Mon Feb 18 08:29:41 2019 +0100

    cs: reset triggered timeout precommit (#3310)

    * Reset TriggeredTimeoutPrecommit as part of updateToState

    * Add failing test and fix

    * fix DATA RACE in TestResetTimeoutPrecommitUponNewHeight

    ```
    WARNING: DATA RACE
    Read at 0x00c001691d28 by goroutine 691:
      github.com/tendermint/tendermint/consensus.decideProposal()
          /go/src/github.com/tendermint/tendermint/consensus/common_test.go:133 +0x121
      github.com/tendermint/tendermint/consensus.TestResetTimeoutPrecommitUponNewHeight()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:1389 +0x958
      testing.tRunner()
       ‚Ä¶")`
‚Ä¶

`[209f5ec](/leapdao/tendermint/commit/209f5ec6c22fe271b7266633221c4a0925cb8704)`

```
commit 4695414393a3e0bc3836fb1cece7f1f3768d3311
Merge: 6cc3f4d8 def5c8cf
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Fri Apr 12 10:56:03 2019 -0400

    Merge pull request #3548 from tendermint/release/v0.31.4

    Release/v0.31.4

commit def5c8cf124ff58cc9c4a61ea017808a0c81c722
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Apr 12 16:48:34 2019 +0200

    address review comments: (#3550)

    - mention ADR in release summary
     - remove [p2p] api changes
     - amend v0.31.3 log to contain note about breaking change

commit b6da8880c22202a7061ae2093ef01819438a136e
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Apr 12 14:24:51 2019 +0200

    prepare v0.31.4 release:

     - prep changelog
     - add missing changelog entries
     - fix minor glitch in existing changelog (v0.31.2)
     - bump versions

commit a453628c4e43c67c747d5078704479aa73716182
Author: Martin Dyring-Andersen <martin@dyring-andersen.dk>
Date:   Fri Apr 12 13:25:14 2019 +0200

    Fix a couple of typos (#3547)

    Fix some typos in p2p/transport.go

commit 4e4224213f3eaa89abeac6686efe4ac970ad63d0
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Fri Apr 12 12:32:00 2019 +0200

    adr: Peer Behaviour (#3539)

    * [adr] ADR 037: Peer Behaviour inital draft
    * Update docs/architecture/adr-037-peer-behaviour.md

    Co-Authored-By: brapse <brapse@gmail.com>

    * Update docs/architecture/adr-037-peer-behaviour.md
    Co-Authored-By: brapse <brapse@gmail.com>

    * [docs] adr-037 Better footnote styling
    * [ADR] ADR-037 adjust Footnotes for github markdown
    * [ADR] ADR-037 fix numbered list

commit b5b3b85697a9c29adaab0e1ab5d1380459e2c5eb
Author: Alexander Simmerl <a.simmerl@gmail.com>
Date:   Fri Apr 12 12:31:02 2019 +0200

    Bring back NodeInfo NetAddress form the dead (#3545)

    A prior change to address accidental DNS lookups introduced the
    SocketAddr on peer, which was then used to add it to the addressbook.
    Which in turn swallowed the self reported port of the peer, which is
    important on a reconnect. This change revives the NetAddress on NodeInfo
    which the Peer carries, but now returns an error to avoid nil
    dereferencing another issue observed in the past. Additionally we could
    potentially address #3532, yet the original problem statemenf of that
    issue stands.

    As a drive-by optimisation `MarkAsGood` now takes only a `p2p.ID` which
    makes it interface a bit stricter and leaner.

commit 18d2c45c334d9f22621ea0af0686e2e54937fb40
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Apr 12 10:46:07 2019 +0200

    rpc: Fix response time grow over time (#3537)

    * rpc: store validator info periodly

    * increase ValidatorSetStoreInterval

    also

    - unexpose it
    - add a comment
    - refactor code
    - add a benchmark, which shows that 100000 results in ~ 100ms to get 100
    validators

    * make the change non-breaking

    * expand comment

    * rename valSetStoreInterval to valSetCheckpointInterval

    * change the panic msg

    * add a test and changelog entry

    * update changelog entry

    * update changelog entry

    * add a link to PR

    * fix test

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * update comment

    * use MaxInt64 func

commit c3df21fe827aad0447bb59a9546c32db8406a5fd
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Apr 11 18:59:14 2019 +0300

    add missing changelog entry (#3544)

    * add missing changelog entry

commit bcec8be035a89b5d08ee00b8cc7115017a58c7e0
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Apr 11 15:32:16 2019 +0200

    p2p: do not log err if peer is private (#3474)

    * add actionable advice for ErrAddrBookNonRoutable err

    Should replace https://github.com/tendermint/tendermint/pull/3463

    * reorder checks in addrbook#addAddress so

    ErrAddrBookPrivate is returned first

    and do not log error in DialPeersAsync if the address is private
    because it's not an error

commit 9a415b057238d118c1edf23d673ebf9ce4f8d2ae
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Apr 9 18:21:35 2019 +0200

    docs: abci#Commit: better explain the possible deadlock (#3536)

commit 40da355234bda9d510dca370e94b646450673879
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Apr 3 14:56:51 2019 +0200

    docs: fix block.Header.Time description (#3529)

    It's not proposer local time anymore, but a weighted median

    Fixes #3514

commit f965a4db15796dfca4e504d93eaa83760ced4af2
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Apr 3 11:22:52 2019 +0200

    p2p: seed mode refactoring (#3011)

    ListOfKnownAddresses is removed
    panic if addrbook size is less than zero
    CrawlPeers does not attempt to connect to existing or peers we're currently dialing
    various perf. fixes
    improved tests (though not complete)
    move IsDialingOrExistingAddress check into DialPeerWithAddress (Fixes #2716)

    * addrbook: preallocate memory when saving addrbook to file

    * addrbook: remove oldestFirst struct and check for ID

    * oldestFirst replaced with sort.Slice
    * ID is now mandatory, so no need to check

    * addrbook: remove ListOfKnownAddresses

    GetSelection is used instead in seed mode.

    * addrbook: panic if size is less than 0

    * rewrite addrbook#saveToFile to not use a counter

    * test AttemptDisconnects func

    * move IsDialingOrExistingAddress check into DialPeerWithAddress

    * save and cleanup crawl peer data

    * get rid of DefaultSeedDisconnectWaitPeriod

    * make linter happy

    * fix TestPEXReactorSeedMode

    * fix comment

    * add a changelog entry

    * Apply suggestions from code review

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * rename ErrDialingOrExistingAddress to ErrCurrentlyDialingOrExistingAddress

    * lowercase errors

    * do not persist seed data

    pros:
    - no extra files
    - less IO

    cons:
    - if the node crashes, seed might crawl a peer too soon

    * fixes after Ethan's review

    * add a changelog entry

    * we should only consult Switch about peers

    checking addrbook size does not make sense since only PEX reactor uses
    it for dialing peers!

    https://github.com/tendermint/tendermint/pull/3011#discussion_r270948875

commit 086d6cbe8c4432a1a03d7924ae8352c42dc9cc4f
Merge: e4a03f24 6cc3f4d8
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 16:49:44 2019 -0400

    Merge pull request #3527 from tendermint/v0.31

    Merge V0.31.3 back to develop

commit 6cc3f4d87cae6589aef0ac2b4707f1ebc8a669b2
Merge: 79e9f205 3cfd9757
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 16:45:04 2019 -0400

    Merge pull request #3525 from tendermint/release/v0.31.3

    Release/v0.31.3

commit 3cfd9757a78fc2398c6853aace2541338be8eaef
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Apr 2 09:14:33 2019 -0400

    changelog and version v0.31.3

commit 882622ec10ba3fdc9f360da65bfb2bbbd13193ed
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 19:59:57 2019 -0400

    Fixes tendermint/tendermint#3522

    * OriginalAddr -> SocketAddr

    OriginalAddr records the originally dialed address for outbound peers,
    rather than the peer's self reported address. For inbound peers, it was
    nil. Here, we rename it to SocketAddr and for inbound peers, set it to
    the RemoteAddr of the connection.

    * use SocketAddr

    Numerous places in the code call peer.NodeInfo().NetAddress().
    However, this call to NetAddress() may perform a DNS lookup if the
    reported NodeInfo.ListenAddr includes a name. Failure of this lookup
    returns a nil address, which can lead to panics in the code.

    Instead, call peer.SocketAddr() to return the static address of the
    connection.

    * remove nodeInfo.NetAddress()

    Expose `transport.NetAddress()`, a static result determined
    when the transport is created. Removing NetAddress() from the nodeInfo
    prevents accidental DNS lookups.

    * fixes from review

    * linter

    * fixes from review

commit 1ecf8148385692da971a46e14091270b23c6dff3
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 19:45:57 2019 -0400

    Fixes tendermint/tendermint#3439

    * make sure we create valid private keys:

     - genPrivKey samples and rejects invalid fieldelems (like libsecp256k1)
     - GenPrivKeySecp256k1 uses `(sha(secret) mod (n ‚àí 1)) + 1`
     - fix typo, rename test file: s/secpk256k1/secp256k1/

    * Update crypto/secp256k1/secp256k1.go

commit e4a03f249dcb7d2e833fc20add382b2a5e7f167e
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Mon Apr 1 14:18:18 2019 -0400

    Release message changelog link fix (#3519)

commit 56d8aa42b3ca628c6544cab1f902f8289738c97a
Merge: 0ae41cc6 79e9f205
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Apr 1 14:17:58 2019 -0400

    Merge pull request #3520 from tendermint/v0.31

    Merge v0.31.2 release back to develop

commit 79e9f205782f1adb94b4150561e414280115cf4e
Merge: a0234aff ab24925c
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Apr 1 17:58:28 2019 +0200

    Merge pull request #3518 from tendermint/prepare-release-v0.31.2

    Release v0.31.2

commit ab24925c9432e9eff06b34445b1760217436f87d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Apr 1 12:32:37 2019 +0200

    prepare changelog and bump versions to v0.31.2

commit 0ae41cc663014454184c2d31328b53dd45dd34d1
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Mon Apr 1 11:47:00 2019 -0400

    Fix for wrong version tag (#3517)

    * Fix for wrong version tag (tag on the release branch instead of master)

commit 422d04c8bae80e103474d37bd5a5afd0061e8d72
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Sun Mar 31 07:14:18 2019 -0400

    Bucky/mempool txsmap (#3512)

    * mempool: resCb -> globalCb

    * reqResCb takes an externalCb

    * failing test for #3509

    * txsMap is sync.Map

    * update changelog

commit 2233dd45bd774905b1ba545eeadea5ebe49d1e31
Author: zjubfd <baifudong@lancai.cn>
Date:   Sat Mar 30 01:47:53 2019 +0800

    libs: remove useless code in group (#3504)

    * lib: remove useless code in group
    * update change log
    * Update CHANGELOG_PENDING.md

    Co-Authored-By: guagualvcha <baifudong@lancai.cn>

commit 9199f3f6132ff24500b538068450eae7d11bef64
Author: Greg Szabo <16846635+greg-szabo@users.noreply.github.com>
Date:   Fri Mar 29 07:57:16 2019 -0400

    Release management using CircleCI (#3498)

    * Release management using CircleCI

    * Changelog updated

commit 6c1a4b513747fed5be06edffd16db4a1c8749041
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 28 17:39:09 2019 +0100

    blockchain: comment out logger in test code that causes a race condition (#3500)

commit c7bb9984979b72e81a569b4540a2da1e73c1c470
Merge: d586945d 7b72436c
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 08:07:59 2019 -0400

    Merge pull request #3502 from tendermint/bucky/merge-master

    Bucky/merge master

commit 7b72436c751587141d8de605ccbcec3514dbea77
Merge: d586945d a0234aff
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 08:12:05 2019 -0400

    Merge branch 'master' into bucky/merge-master

commit a0234affb6959a0aec285eebf3a3963251d2d186
Merge: 0d985ede 9390a810
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Thu Mar 28 07:57:42 2019 -0400

    Merge pull request #3489 from tendermint/release/v0.31.1

    Release/v0.31.1

commit 9390a810ebda0b1aebd90f6e8b8688562bdf7958
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Mar 27 21:03:28 2019 -0400

    minor changelog updates (#3499)

commit a49d80b89c9df3cb2497adb8175915c654479708
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 19:12:01 2019 +0100

    catch up with develop and rebase on current release to include #3482

commit ccfe75ec4a701ad7dcaf1f26df772b0881ab1184
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Wed Mar 27 18:51:57 2019 +0100

    docs: Fix broken links (#3482) (#3488)

    * docs: fix broken links (#3482)

    A bunch of links were broken in the documentation s they included the
    `docs` prefix.

    * Update CHANGELOG_PENDING

    * docs: switch to relative links for github compatitibility (#3482)

commit d586945d6981262759e0e681e7bc92a74637185d
Author: Sean Braithwaite <brapse@gmail.com>
Date:   Wed Mar 27 18:51:57 2019 +0100

    docs: Fix broken links (#3482) (#3488)

    * docs: fix broken links (#3482)

    A bunch of links were broken in the documentation s they included the
    `docs` prefix.

    * Update CHANGELOG_PENDING

    * docs: switch to relative links for github compatitibility (#3482)

commit ae88965ff6ddf174607a02eee83cfc5ed11c6cbb
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 17:46:29 2019 +0100

    changelog: add summary & fix link & add external contributor (#3490)

commit 233813483642c2ac370110dd42c3291556c26039
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:52:19 2019 +0100

    bump versions

commit 1b33a50e6d07e48f2377db64ce944a435f9f2ec4
Merge: 3c7bb6b5 5fa540bd
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:50:59 2019 +0100

    Merge remote-tracking branch 'remotes/origin/develop' into release/v0.31.1

commit 3c7bb6b571ac47e050a47013e22dbdfd68f02745
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:48:00 2019 +0100

    Add some numbers for #2778

commit 5fa540bdc9eac01cc3df6de01119550d1122114b
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 27 16:45:34 2019 +0100

    mempool: add a safety check, write tests for mempoolIDs (#3487)

    * mempool: add a safety check, write tests for mempoolIDs

    and document 65536 limit in the mempool reactor spec

    follow-up to https://github.com/tendermint/tendermint/pull/2778

    * rename the test

    * fixes after Ismail's review

commit 52727863e187e85901e7f2e7285920a701d2a8e6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:07:03 2019 +0100

    add external contributors

commit e3f840e6a6f81406c44e760e578e48fcd3fedf12
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:04:43 2019 +0100

    reset CHANGELOG_PENDING.md

commit ed63e1f378eaf465b714084fa1edd6ac4761782f
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 16:03:25 2019 +0100

    Add more entries to the Changelog, fix formatting, linkify

commit 55b7118c981e93b920cead4616b91ec58130e316
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 27 15:35:32 2019 +0100

    Prep changelog: copy from pending & update version

commit 5a25b75b1d586c6d9c3fdfc940057f7b85089a90
Author: zjubfd <baifudong@lancai.cn>
Date:   Wed Mar 27 00:13:14 2019 +0800

    p2p: refactor GetSelectionWithBias for addressbook (#3475)

    Why submit this pr:

        we have suffered from infinite loop in addrbook bug which takes us a long time to find out why process become a zombie peer. It have been fixed in #3232. But the ADDRS_LOOP is still there, risk of infinite loop is still exist.
        The algorithm that to random pick a bucket is not stable, which means the peer may unluckily always choose the wrong bucket for a long time, the time and cpu cost is meaningless.

    A simple improvement:
    shuffle bucketsNew and bucketsOld, and pick necessary number of address from them. A stable
    algorithm.

commit a4d9539544ba4377f16e797fea01090bc974e1b5
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 26 09:44:49 2019 +0100

    rpc/client: include NetworkClient interface into Client interface (#3473)

    I think it's nice when the Client interface has all the methods. If someone does not need a particular method/set of methods, she can use individual interfaces (e.g. NetworkClient, MempoolClient) or write her own interface.

    technically breaking

    Fixes #3458

commit 1bb8e02a962a1ffd7ce4e7355f648b644105f649
Author: HaoyangLiu <lhy.0318@163.com>
Date:   Tue Mar 26 16:29:06 2019 +0800

    mempool: fix broadcastTxRoutine leak (#3478)

    Refs #3306, irisnet@fdbb676

    I ran an irishub validator. After the validator node ran several days, I dump the whole goroutine stack. I found that there were hundreds of broadcastTxRoutine. However, the connected peer quantity was less than 30. So I belive that there must be broadcastTxRoutine leakage issue.

    According to my analysis, I think the root cause of this issue locate in below code:

    		select {
    		case <-next.NextWaitChan():
    			// see the start of the for loop for nil check
    			next = next.Next()
    		case <-peer.Quit():
    			return
    		case <-memR.Quit():
    			return
    		}

    As we know, if multiple paths are avaliable in the same time, then a random path will be selected. Suppose that next.NextWaitChan() and peer.Quit() are both avaliable, and next.NextWaitChan() is chosen.

                    // send memTx
    		msg := &TxMessage{Tx: memTx.tx}
    		success := peer.Send(MempoolChannel, cdc.MustMarshalBinaryBare(msg))
    		if !success {
    			time.Sleep(peerCatchupSleepIntervalMS * time.Millisecond)
    			continue
    		}

    Then next will be non-empty and the peer send operation won't be success. As a result, this go routine will be track into infinite loop and won't be released.

    My proposal is to check peer.Quit() and memR.Quit() in every loop no matter whether next is nil.

commit 6de7effb05581f9bea2e8af06e4e74a85c34bc5f
Author: Dev Ojha <ValarDragon@users.noreply.github.com>
Date:   Tue Mar 26 01:27:29 2019 -0700

    mempool no gossip back (#2778)

    Closes #1798

    This is done by making every mempool tx maintain a list of peers who its received the tx from. Instead of using the 20byte peer ID, it instead uses a local map from peerID to uint16 counter, so every peer adds 2 bytes. (Word aligned to probably make it 8 bytes)

    This also required resetting the callback function on every CheckTx. This likely has performance ramifications for instruction caching. The actual setting operation isn't costly with the removal of defers in this PR.

    * Make the mempool not gossip txs back to peers its received it from

    * Fix adversarial memleak

    * Don't break interface

    * Update changelog

    * Forgot to add a mtx

    * forgot a mutex

    * Update mempool/reactor.go

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Update mempool/mempool.go

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Use unknown peer ID

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * fix compilation

    * use next wait chan logic when skipping

    * Minor fixes

    * Add TxInfo

    * Add reverse map

    * Make activeID's auto-reserve 0

    * 0 -> UnknownPeerID

    Co-Authored-By: ValarDragon <ValarDragon@users.noreply.github.com>

    * Switch to making the normal case set a callback on the reqres object

    The recheck case is still done via the global callback, and stats
    are also set via global callback

    * fix merge conflict

    * Addres comments

    * Add cache tests

    * add cache tests

    * minor fixes

    * update metrics in reqResCb and reformat code

    * goimport -w mempool/reactor.go

    * mempool: update memTx senders

    I had to introduce txsMap for quick mempoolTx lookups.

    * change senders type from []uint16 to sync.Map

    Fixes DATA RACE:

    ```
    Read at 0x00c0013fcd3a by goroutine 183:
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).broadcastTxRoutine()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:195 +0x3c7

    Previous write at 0x00c0013fcd3a by D[2019-02-27|10:10:49.058] Read PacketMsg                               switch=3 peer=35bc1e3558c182927b31987eeff3feb3d58a0fc5@127.0.0.1
    :46552 conn=MConn{pipe} packet="PacketMsg{30:2B06579D0A143EB78F3D3299DE8213A51D4E11FB05ACE4D6A14F T:1}"
    goroutine 190:
      github.com/tendermint/tendermint/mempool.(*Mempool).CheckTxWithInfo()
          /go/src/github.com/tendermint/tendermint/mempool/mempool.go:387 +0xdc1
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).Receive()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:134 +0xb04
      github.com/tendermint/tendermint/p2p.createMConnection.func1()
          /go/src/github.com/tendermint/tendermint/p2p/peer.go:374 +0x25b
      github.com/tendermint/tendermint/p2p/conn.(*MConnection).recvRoutine()
          /go/src/github.com/tendermint/tendermint/p2p/conn/connection.go:599 +0xcce

    Goroutine 183 (running) created at:
    D[2019-02-27|10:10:49.058] Send                                         switch=2 peer=1efafad5443abeea4b7a8155218e4369525d987e@127.0.0.1:46193 channel=48 conn=MConn{pipe} m
    sgBytes=2B06579D0A146194480ADAE00C2836ED7125FEE65C1D9DD51049
      github.com/tendermint/tendermint/mempool.(*MempoolReactor).AddPeer()
          /go/src/github.com/tendermint/tendermint/mempool/reactor.go:105 +0x1b1
      github.com/tendermint/tendermint/p2p.(*Switch).startInitPeer()
          /go/src/github.com/tendermint/tendermint/p2p/switch.go:683 +0x13b
      github.com/tendermint/tendermint/p2p.(*Switch).addPeer()
          /go/src/github.com/tendermint/tendermint/p2p/switch.go:650 +0x585
      github.com/tendermint/tendermint/p2p.(*Switch).addPeerWithConnection()
          /go/src/github.com/tendermint/tendermint/p2p/test_util.go:145 +0x939
      github.com/tendermint/tendermint/p2p.Connect2Switches.func2()
          /go/src/github.com/tendermint/tendermint/p2p/test_util.go:109 +0x50

    I[2019-02-27|10:10:49.058] Added good transaction                       validator=0 tx=43B4D1F0F03460BD262835C4AA560DB860CFBBE85BD02386D83DAC38C67B3AD7 res="&{CheckTx:gas_w
    anted:1 }" height=0 total=375
    Goroutine 190 (running) created at:
      github.com/tendermint/tendermint/p2p/conn.(*MConnection).OnStart()
          /go/src/github.com/tendermint/tendermint/p2p/conn/connection.go:210 +0x313
      github.com/tendermint/tendermint/libs/common.(*BaseService).Start()
          /go/src/github.com/tendermint/tendermint/libs/common/service.go:139 +0x4df
      github.com/tendermint/tendermint/p2p.(*peer).OnStart()
          /go/src/github.com/tendermint/tendermint/p2p/peer.go:179 +0x56
      github.com/tendermint/tendermint/libs/common.(*BaseService).Start()
          /go/src/github.com/tendermint/tendermint/libs/common/service.go:139 +0x4df
      github.com/tendermint/tendermint/p2p.(*peer).Start()
          <autogenerated>:1 +0x43
      github.com/tendermint/tendermint/p2p.(*Switch).startInitPeer()
    ```

    * explain the choice of a map DS for senders

    * extract ids pool/mapper to a separate struct

    * fix literal copies lock value from senders: sync.Map contains sync.Mutex

    * use sync.Map#LoadOrStore instead of Load

    * fixes after Ismail's review

    * rename resCbNormal to resCbFirstTime

commit 25a3c8b1724c9611d6edc175b1b0d079f5ee28c1
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 24 01:08:15 2019 +0800

    rpc: support tls rpc (#3469)

    Refs #3419

commit 85be2a554e7e7752bed0b9409ab153bf04e05e7b
Author: Thane Thomson <connect@thanethomson.com>
Date:   Fri Mar 22 09:16:38 2019 -0400

     tools/tm-signer-harness: update height and round for test harness (#3466)

    In order to re-enable the test harness for the KMS (see
    tendermint/kms#227), we need some marginally more realistic proposals
    and votes. This is because the KMS does some additional sanity checks
    now to ensure the height and round are increasing over time.

commit 1d4afb179b9660bf13705c67b01e20838a4506eb
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 21 11:05:39 2019 +0100

    replace PB2TM.ConsensusParams with a call to params#Update (#3448)

    Fixes #3444

commit 660bd4a53e0dd7642a473689c8686c3f83e3a0ca
Author: tracebundy <745403419@qq.com>
Date:   Wed Mar 20 20:30:49 2019 +0800

    fix comment (#3454)

commit 81b9bdf40010c6a4e336133ec53fe6e4e6089911
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Mar 20 08:29:40 2019 -0400

    comments on validator ordering (#3452)

    * comments on validator ordering

    * NextValidatorsHash

commit 926127c774a2c9110c4284938411818918ffecac
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 20 03:59:33 2019 +0300

    blockchain: update the maxHeight when a peer is removed (#3350)

    * blockchain: update the maxHeight when a peer is removed

    Refs #2699

    * add a changelog entry

    * make linter pass

commit 03085c2da23b179c4a51f59a03cb40aa4e85a613
Author: zjubfd <baifudong@lancai.cn>
Date:   Wed Mar 20 08:18:18 2019 +0800

    rpc: client disable compression (#3430)

commit 7af4b5086af9268f7cc8b41f5a174ade675d8ab4
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 20 03:10:54 2019 +0300

    Remove RepeatTimer and refactor Switch#Broadcast (#3429)

    * p2p: refactor Switch#Broadcast func

    - call wg.Add only once
    - do not call peers.List twice!
      * bad for perfomance
      * peers list can change in between calls!

    Refs #3306

    * p2p: use time.Ticker instead of RepeatTimer

    no need in RepeatTimer since we don't Reset them

    Refs #3306

    * libs/common: remove RepeatTimer (also TimerMaker and Ticker interface)

    "ancient code that‚Äôs caused no end of trouble" Ethan

    I believe there's much simplier way to write a ticker than can be reset
    https://medium.com/@arpith/resetting-a-ticker-in-go-63858a2c17ec

commit 60b2ae5f5a3e16625af1342e012462448d565394
Author: needkane <604476380@qq.com>
Date:   Wed Mar 20 08:00:53 2019 +0800

    crypto: delete unused code (#3426)

commit a6349f50633a45755041b8230a0f7eb990383cfd
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Wed Mar 20 01:56:13 2019 +0200

    Formalize proposer election algorithm properties  (#3140)

    * Update proposer-selection.md

    * Fixed typos

    * fixed typos

    * Attempt to address some comments

    * Update proposer-selection.md

    * Update proposer-selection.md

    * Update proposer-selection.md

    Added the normalization step.

    * Addressed review comments

    * New example for normalization section

    Added a new example to better show the need for normalization
    Added requirement for changing validator set
    Addressed review comments

    * Fixed problem with R2

    * fixed the math for new validator

    * test

    * more small updates

    * Moved the centering above the round-robin election

    - the centering is now done before the actual round-robin block
    - updated examples
    - cleanup

    * change to reflect new implementation for new validator

commit 22bcfca87a987dc43ad111a226b072ce09bbeb8d
Merge: 4162ebe8 0d985ede
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:54:09 2019 -0400

    Merge pull request #3450 from tendermint/master

    Merge master back to develop

commit 0d985ede28bd6937fa9d3613618e42cab6fc871c
Merge: 97681953 1e346978
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:53:37 2019 -0400

    Merge pull request #3417 from tendermint/release/v0.31.0

    Release/v0.31.0

commit 1e3469789dce5a034a21b6e48288f1809a102595
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Wed Mar 20 00:45:51 2019 +0100

    Ensure WriteTimeout > TimeoutBroadcastTxCommit (#3443)

    * Make sure config.TimeoutBroadcastTxCommit < rpcserver.WriteTimeout()

    * remove redundant comment

    * libs/rpc/http_server: move Read/WriteTimeout into Config

    * increase defaults for read/write timeouts

    Based on this article
    https://www.digitalocean.com/community/tutorials/how-to-optimize-nginx-configuration

    * WriteTimeout should be larger than TimeoutBroadcastTxCommit

    * set a deadline for subscribing to txs

    * extract duration into const

    * add two changelog entries

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * 12 -> 10

    * changelog

    * changelog

commit 5f68fbae37e11b01f4d2e5c33b182401a7283e4a
Merge: 551b6322 e276f35f
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Tue Mar 19 19:25:26 2019 -0400

    Merge pull request #3449 from tendermint/ismail/merge_develop_into_release/0.31.0

    Merge develop into release/0.31.0

commit e276f35f86b3980e088a95aa70c96dbddcdf658b
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 14:36:42 2019 +0100

    remove 3421 from changelog

commit 8e62a3d62a5b04a5a7126d00d75925c990aec9c6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 12:19:02 2019 +0100

    Add #3421 to changelog and reorder alphabetically

commit 48aaccab8f3cc17032220a01a6d58acde695bbde
Merge: 551b6322 4162ebe8
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 19 12:09:26 2019 +0100

    Merge in develop and update CHANGELOG.md

commit 4162ebe8b586deccc0e7476d8abafb75138bfe58
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 19 11:38:32 2019 +0400

    types: refactor PB2TM.ConsensusParams to take BlockTimeIota as an arg (#3442)

    See https://github.com/tendermint/tendermint/pull/3403/files#r266208947

    In #3403 we unexposed BlockTimeIota from the ABCI, but it's still part
    of the ConsensusParams struct, so we have to remember to add it back
    after calling PB2TM.ConsensusParams. Instead, PB2TM.ConsensusParams
    should take it as an argument

    Fixes #3432

commit 551b6322f5a74f578a8487001e805e4e1da6394d
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Sat Mar 16 19:24:12 2019 -0400

    Update v0.31.0 release notes (#3434)

    * changelog: fix formatting

    * update release notes

    * update changelog

    * linkify

    * update UPGRADING

commit 52c4e15eb25e8a3d6e77f90239710de3655d4ec6
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 14 16:07:06 2019 +0100

    changelog: more review fixes/release/v0.31.0 (#3427)

    * Update release summary

    * Add pubsub config changes

    * Add link to issue for pubsub changes

commit 5483ac6b0a2a75bc140487e8405392533a3f1687
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 14 12:17:49 2019 +0100

    minor changes / fixes to release 0.31.0 (#3422)

    * bump ABCIVersion due to renaming BlockSizeParams -> BlockParams
    (https://github.com/tendermint/tendermint/pull/3417#discussion_r264974791)

    * Move changelog on consensus params entry to breaking

    * Add @melekes' suggestion for breaking change in pubsub into upgrading.md

    * Add changelog entry for #3351

    * Add changelog entry for #3358 & #3359

    * Add changelog entry for #3397

    * remove changelog entry for #3397 (was already released in 0.30.2)

    * move 3351 to improvements

    * Update changelog comment

commit 745713330736c5c751450245d88b8037cbee3aa6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 14 15:00:58 2019 +0400

    grpcdb: close Iterator/ReverseIterator after use (#3424)

    Fixes #3402

commit a59930a327065f2d091840586da6c35b6fd07472
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Wed Mar 13 16:09:05 2019 +0400

    localnet: fix $LOG variable (#3423)

    Fixes #3421

    Before: it was creating a file named ${LOG:-tendermint.log} in .build/nodeX
    After: it creates a file named tendermint.log

commit 85c023db88a8517587f0e8499b1e89f0eea1112d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 12 20:07:26 2019 +0100

    Prep release v0.31.0:
     - update changelog, reset pending
     - bump versions
     - add external contributors (partly manually)

commit 4cbd36f341c8fee55a4ea386aee42a2c7fe9c67d
Merge: e42f833f 97681953
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 12 21:22:03 2019 +0400

    Merge pull request #3415 from tendermint/master

    Merge master back to develop (do not squash)

commit e42f833fd4ce6cb886dbf594dcb2f3af61918325
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Tue Mar 12 16:20:59 2019 +0400

    Merge master back to develop (#3412)

    * libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

    * update changelog and bump version to 0.30.2

commit ad3e990c6a424d939b181a2a7c911eb4592c0c79
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 23:59:00 2019 +0400

    fix GO_VERSION in installation scripts (#3411)

    there is no such file https://storage.googleapis.com/golang/go1.12.0.linux-amd64.tar.gz

    Fixes #3405

commit 676212fa8fdd1ddf29e9c352129c97da3c113769
Author: srmo <srm@schakalacka.org>
Date:   Mon Mar 11 20:06:03 2019 +0100

    cmd: make sure to have 'testnet' create the data directory for nonvals (#3409)

    Fixes #3408

commit 303557203402f0a1b6db4a55cb2c6562765058b1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:52:09 2019 +0400

    cs: comment out log.Error to avoid TestReactorValidatorSetChanges timing out (#3401)

commit d741c7b4785c36cef4b0912900b6193db21d00e6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:45:58 2019 +0400

    limit number of /subscribe clients and queries per client (#3269)

    * limit number of /subscribe clients and queries per client

    Add the following config variables (under [rpc] section):
      * max_subscription_clients
      * max_subscriptions_per_client
      * timeout_broadcast_tx_commit

    Fixes #2826

    new HTTPClient interface for subscriptions

    finalize HTTPClient events interface

    remove EventSubscriber

    fix data race

    ```
    WARNING: DATA RACE
    Read at 0x00c000a36060 by goroutine 129:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:168 +0x1f0

    Previous write at 0x00c000a36060 by goroutine 132:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:191 +0x4e0
      github.com/tendermint/tendermint/rpc/client.WaitForOneEvent()
          /go/src/github.com/tendermint/tendermint/rpc/client/helpers.go:64 +0x178
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:139 +0x298
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Goroutine 129 (running) created at:
      github.com/tendermint/tendermint/rpc/client.(*Local).Subscribe()
          /go/src/github.com/tendermint/tendermint/rpc/client/localclient.go:164 +0x4b7
      github.com/tendermint/tendermint/rpc/client.WaitForOneEvent()
          /go/src/github.com/tendermint/tendermint/rpc/client/helpers.go:64 +0x178
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync.func1()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:139 +0x298
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Goroutine 132 (running) created at:
      testing.(*T).Run()
          /usr/local/go/src/testing/testing.go:878 +0x659
      github.com/tendermint/tendermint/rpc/client_test.TestTxEventsSentWithBroadcastTxSync()
          /go/src/github.com/tendermint/tendermint/rpc/client/event_test.go:119 +0x186
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
    ==================
    ```

    lite client works (tested manually)

    godoc comments

    httpclient: do not close the out channel

    use TimeoutBroadcastTxCommit

    no timeout for unsubscribe

    but 1s Local (5s HTTP) timeout for resubscribe

    format code

    change Subscribe#out cap to 1

    and replace config vars with RPCConfig

    TimeoutBroadcastTxCommit can't be greater than rpcserver.WriteTimeout

    rpc: Context as first parameter to all functions

    reformat code

    fixes after my own review

    fixes after Ethan's review

    add test stubs

    fix config.toml

    * fixes after manual testing

    - rpc: do not recommend to use BroadcastTxCommit because it's slow and wastes
    Tendermint resources (pubsub)
    - rpc: better error in Subscribe and BroadcastTxCommit
    - HTTPClient: do not resubscribe if err = ErrAlreadySubscribed

    * fixes after Ismail's review

    * Update rpc/grpc/grpc_test.go

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 15f621141dce76d992f6c8dcfbd4c522878b6108
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 22:21:17 2019 +0400

    remove TimeIotaMs from ABCI consensus params (#3403)

    Also

    - init substructures to avoid panic in pb2tm.ConsensusParams
    Before: if csp.Block is nil and we later try to access/write to it,
    we'll panic.
    After: if csp.Block is nil and we later try to access/write to it,
    there'll be no panic.

commit dc359bd3a51c52803a6af820a36ee41796284e87
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Mon Mar 11 16:17:25 2019 +0200

    types: remove check for priority order of existing validators (#3407)

    When scaling and averaging is invoked, it is possible to have validators
    with close priorities ending up with same priority. With the current code,
    this  makes it impossible to verify the priority orders before and after updates.

    Fixes #3383

commit 976819537d199aa43c6ad55ec4e8958323322bb0
Merge: e0f89364 f996b10f
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Mon Mar 11 08:17:14 2019 -0400

    Merge pull request #3399 from tendermint/release/v0.30.2

    Release/v0.30.2

commit 100ff08de93ff1907bf810f584ec5bdc7a2a5260
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 11 15:31:53 2019 +0400

    p2p: do not panic when filter times out (#3384)

    Fixes #3369

commit f996b10f479d7c9a6d81cca5a02c47b29a52b3f3
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sun Mar 10 13:06:34 2019 +0400

    update changelog and bump version to 0.30.2

commit 36d7180ca216f0d7ff62851fa441de2b0371d699
Author: Yumin Xia <stumblecra@gmail.com>
Date:   Sun Mar 10 00:46:32 2019 -0800

    libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

commit b021f1e505482fb34f8a8e57cd86b171e4a57344
Author: Yumin Xia <stumblecra@gmail.com>
Date:   Sun Mar 10 00:46:32 2019 -0800

    libs/db: close batch (#3397)

    ClevelDB requires closing when WriteBatch is no longer needed, https://godoc.org/github.com/jmhodges/levigo#WriteBatch.Close

    Fixes the memory leak in https://github.com/cosmos/cosmos-sdk/issues/3842

commit 90794260bcd23989e4bd8530d596e39d9509e7ca
Author: mircea-c <mircea@tendermint.com>
Date:   Sat Mar 9 10:13:36 2019 -0500

    circleci: removed complexity from docs deployment job  (#3396)

commit b6a510a3e7cefca56af4bdb009413e3950c6d59e
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Mar 8 09:46:09 2019 +0400

    make ineffassign linter pass (#3386)

    Refs #3262

    This fixes two small bugs:

    1) lite/dbprovider: return `ok` instead of true in parse* functions. It's weird that we're ignoring `ok` value before.
    2) consensus/state: previously because of the shadowing we almost never output "Error with msg". Now we declare both `added` and `err` in the beginning of the function, so there's no shadowing.

commit e415c326f93e5fa473d83a0ea6fa495ad0ea87f3
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Fri Mar 8 06:40:59 2019 +0100

    update golang.org/x/crypto (#3392)

    Update Gopkg.lock via dep ensure --update golang.org/x/crypto

    see #3391 (comment) (nothing to review here really).

commit 28e9e9e7145b357cbd7078f4c83dcf66c13d4f7d
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Thu Mar 7 17:03:57 2019 +0100

    update levigo to 1.0.0 (#3389)

    Although the version we were pinning to is from Nov. 2016 there were no substantial changes:

        jmhodges/levigo@2b8c778 added go-modules support (no code changes)
        jmhodges/levigo@853d788 added a badge to the readme

    closes #3381

commit 3ebfa99f2c2403c17348e41190406892abf21d2a
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 7 19:35:04 2019 +0400

    do not pin repos without releases to exact revisions (#3382)

    We're pinning repos without releases because it's very easy to upgrade all the dependencies by executing dep ensure --upgrade. Instead, we should just never run this command directly, only dep ensure --upgrade <some repo>. And we can defend that in PRs.

    Refs #3374

    The problem with pinning to exact revisions: people who import Tendermint as a library (e.g. abci/types) are stuck with these revisions even though the code they import may not even use them.

commit 91b488f9a541f5dd69f0bb2db4249356733a2ed3
Author: YOSHIDA Masanori <masanori.yoshida@gmail.com>
Date:   Thu Mar 7 22:02:13 2019 +0900

    docs: fix the reverse of meaning in spec (#3387)

    https://tools.ietf.org/html/rfc6962#section-2.1
    "The largest power of two less than the number of items" is actually correct!

        For n > 1, let k be the largest power of two smaller than n (i.e.,
        k < n <= 2k).

commit f25d727035f4615cbb4b43452191fd83218fc1e1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Mar 7 09:10:34 2019 +0400

    make dupl linter pass (#3385)

    Refs #3262

commit 411bc5e49fcc3dda866ae799ba2ceda0084f80d4
Author: Anca Zamfir <ancazamfir@users.noreply.github.com>
Date:   Wed Mar 6 09:54:49 2019 +0100

    types: followup after validator set changes (#3301)

    * fix failure in TestProposerFrequency

    * Add test to check priority order after updates

    * Changed applyRemovals() and removed Remove()

    Changed applyRemovals() similar to applyUpdates()
    Removed function Remove()
    Updated comments

    * review comments

    * simplify applyRemovals and add more comments

    * small correction in comment

    * Fix check in test

    * Fix priority check for centering, address review comments

    * fix assert for priority centering

    * review comments

    * review comments

    * cleanup and review comments

    added upper limit check for validator voting power
    moved check for empty validator set earlier
    moved panic on potential negative set length in verifyRemovals
    added more tests

    * review comments

commit 858875fbb8b94debc4973fdf5923ced6564d3c39
Author: Silas Davis <silas@monax.io>
Date:   Wed Mar 6 08:22:35 2019 +0000

    Copy secp256k1 code from go-ethereum to avoid GPL vendoring issues in (#3371)

    downstream

    Signed-off-by: Silas Davis <silas@monax.io>

commit 1eaa42cd25f2355f4b30440bddae435d056d1f44
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Tue Mar 5 08:08:52 2019 +0100

    golang 1.12.0 (#3376)

     - update docker image on circleci
     - remove GOCACHE=off from Makefile (see:
     https://tip.golang.org/doc/go1.12#gocache)
     - update badge in readme
     - update in scripts/install
     - update Vagrantfile
     - update in networks/remote/integration.sh
     - tools/build/Makefile

commit 8c9df30e28a3b95efe537afe9930de2150999441
Author: Jack Zampolin <jack.zampolin@gmail.com>
Date:   Mon Mar 4 22:56:46 2019 -0800

    libs/db: Add cleveldb.Stats() (#3379)

    Fixes: #3378

    * Add stats to cleveldb implementation

    * update changelog

    * remote TODO

    also
    - sort keys
    - preallocate memory

    * fix const initializer []string literal is not a constant

    * add test

commit 52771e1287eb44eabae99e6d2781a57c577821bb
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 13:24:44 2019 +0400

    make BlockTimeIota a consensus parameter, not a locally configurable ‚Ä¶ (#3048)

    * make BlockTimeIota a consensus parameter, not a locally configurable option

    Refs #2920

    * make TimeIota int64 ms

    Refs #2920

    * update Gopkg.toml

    * fixes after Ethan's review

    * fix TestRemoteSignerProposalSigningFailed

    * update changelog

commit f39138aa2e543438548a150bdad45304ccc3296b
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 12:18:32 2019 +0400

    remove RoundState from EventDataRoundState (#3354)

    Before we're using it to get a round state in tests. Now it can be done
    by calling csX.GetRoundState. We will need to rewrite
    TestStateSlashingPrevotes and TestStateSlashingPrecommits, which are
    commented right now, to not rely on EventDataRoundState#RoundState
    field.

    Refs #1527

commit 8a962ffc4639eed95501114e0436ccffc52f8ef1
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Mar 4 12:17:38 2019 +0400

    deps: update gogo/protobuf from 1.1.1 to 1.2.1 and golang/protobuf from 1.1.0 to 1.3.0 (#3357)

    * deps: update gogo/proto from 1.1.1 to 1.2.1

    - verified changes manually
      git diff 636bf030~ ba06b47c --stat -- ':!*.pb.go' ':!test'

    * deps: update golang/protobuf from 1.1.0 to 1.3.0

    - verified changes manually
      git diff b4deda0~ c823c79 -- ':!*.pb.go' ':!test'

commit 3421e4dcd7c6937e9ae8f72af17b38840840a781
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 05:36:52 2019 +0800

    make lightd availbe (#3364)

    1."abci_query": rpcserver.NewRPCFunc(c.ABCIQuery, "path,data,prove")
    "validators": rpcserver.NewRPCFunc(c.Validators, "height"),
    the parameters and function do not match, cause index out of range error.
    2. the prove of query is forced to be true, while default option is false.
    3. fix the wrong key of merkle

commit 976b1c2ef73e557a702ef17600e1eeaf4865f292
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 04:21:21 2019 +0800

    fix pool timer leak bug, resolve#3353 (#3358)

    When remove peer, block pool simple remove bpPeer,
    but do not stop timer, that cause stopError for recorrected
    peers. Stop timer when remove from pool.

commit d95894152beb3b25423cdb109af006340f0ac80b
Author: zjubfd <baifudong@lancai.cn>
Date:   Sun Mar 3 04:17:37 2019 +0800

    fix dirty data in peerset,resolve #3304 (#3359)

    * fix dirty data in peerset

    startInitPeer before PeerSet add the peer,
    once mconnection start and Receive of one
    Reactor faild, will try to remove it from PeerSet
    while PeerSet still not contain the peer. Fix
    this by change the order.

    * fix test FilterDuplicate

    * fix start/stop race

    * fix err

commit 37a548414bbb5dc8dce9fe452ba5f933fad29684
Author: Sven-Hendrik Haase <svenstaro@gmail.com>
Date:   Sat Mar 2 07:06:57 2019 +0100

    docs: fix typo (#3373)

commit 853dd34d31bee6de593be94df87cbb508688249e
Author: Juan Leni <juan.leni@zondax.ch>
Date:   Thu Feb 28 08:48:20 2019 +0100

    privval: improve Remote Signer implementation (#3351)

    This issue is related to #3107
    This is a first renaming/refactoring step before reworking and removing heartbeats.
    As discussed with @Liamsi , we preferred to go for a couple of independent and separate PRs to simplify review work.

    The changes:

        Help to clarify the relation between the validator and remote signer endpoints
        Differentiate between timeouts and deadlines
        Prepare to encapsulate networking related code behind RemoteSigner in the next PR

    My intention is to separate and encapsulate the "network related" code from the actual signer.

    SignerRemote ---(uses/contains)--> SignerValidatorEndpoint <--(connects to)--> SignerServiceEndpoint ---> SignerService (future.. not here yet but would like to decouple too)

    All reconnection/heartbeat/whatever code goes in the endpoints. Signer[Remote/Service] do not need to know about that.

    I agree Endpoint may not be the perfect name. I tried to find something "Go-ish" enough. It is a common name in go-kit, kubernetes, etc.

    Right now:
    SignerValidatorEndpoint:

        handles the listener
        contains SignerRemote
        Implements the PrivValidator interface
        connects and sets a connection object in a contained SignerRemote
        delegates PrivValidator some calls to SignerRemote which in turn uses the conn object that was set externally

    SignerRemote:

        Implements the PrivValidator interface
        read/writes from a connection object directly
        handles heartbeats

    SignerServiceEndpoint:

        Does most things in a single place
        delegates to a PrivValidator IIRC.

    * cleanup

    * Refactoring step 1

    * Refactoring step 2

    * move messages to another file

    * mark for future work / next steps

    * mark deprecated classes in docs

    * Fix linter problems

    * additional linter fixes

commit d6e2fb453d20841828cfbe1f6a7e8ca593c1b564
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Feb 28 11:31:59 2019 +0400

    update docs (#3349)

    * docs: explain create_empty_blocks configurations

    Closes #3307

    * Vagrantfile: install nodejs for docs

    * update docs instructions

    npm install does not make sense since there's no packages.json file

    * explain broadcast_tx_* tx format

    Closes #536

    * docs: explain how transaction ordering works

    Closes #2904

    * bring in consensus parameters explained

    * example for create_empty_blocks_interval

    * bring in explanation from https://github.com/tendermint/tendermint/issues/2487#issuecomment-424899799

    * link to formatting instead of duplicating info

commit ec9bff52346d9629f690147674326a41fcefd20f
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 25 09:11:07 2019 +0400

    rename WAL#Flush to WAL#FlushAndSync (#3345)

    * rename WAL#Flush to WAL#FlushAndSync

    - rename auto#Flush to auto#FlushAndSync
    - cleanup WAL interface to not leak implementation details!
      * remove Group()
      * add WALReader interface and return it in SearchForEndHeight()
    - add interface assertions

    Refs #3337

    * replace WALReader with io.ReadCloser

commit 6797d8585167a9dc1e51843420ae4ab7eaf848a0
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Feb 25 06:06:21 2019 +0100

    p2p: fix comment in secret connection (#3348)

    Just a minor followup on the review if #3347: Fixes a comment. [#3347 (comment)](https://github.com/tendermint/tendermint/pull/3347#discussion_r259582330)

commit cdf3a74f4899b3c716703b932e682307752cd6b6
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 19:48:28 2019 +0400

    Unclean shutdown on SIGINT / SIGTERM (#3308)

    * libs/common: TrapSignal accepts logger as a first parameter

     and does not block anymore
    * previously it was dumping "captured ..." msg to os.Stdout
    * TrapSignal should not be responsible for blocking thread of execution

    Refs #3238

    * exit with zero (0) code upon receiving SIGTERM/SIGINT

    Refs #3238

    * fix formatting in docs/app-dev/abci-cli.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * fix formatting in docs/app-dev/abci-cli.md

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 41f91318e9e253a1b59cc1cc128ad412941b8e2a
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 19:32:31 2019 +0400

    bound mempool memory usage (#3248)

    * bound mempool memory usage

    Closes #3079

    * rename SizeBytes to TxsTotalBytes

    and other small fixes after Zarko's review

    * rename MaxBytes to MaxTxsTotalBytes

    * make ErrMempoolIsFull more informative

    * expose mempool's txs_total_bytes via RPC

    * test full response

    * fixes after Ethan's review

    * config: rename mempool.size to mempool.max_txs

    https://github.com/tendermint/tendermint/pull/3248#discussion_r254034004

    * test more cases

    https://github.com/tendermint/tendermint/pull/3248#discussion_r254036532

    * simplify test

    * Revert "config: rename mempool.size to mempool.max_txs"

    This reverts commit 39bfa3696177aa46195000b90655419a975d6ff7.

    * rename count back to n_txs

    to make a change non-breaking

    * rename max_txs_total_bytes to max_txs_bytes

    * format code

    * fix TestWALPeriodicSync

    The test was sometimes failing due to processFlushTicks being called too
    early. The solution is to call wal#Start later in the test.

    * Apply suggestions from code review

commit e0adc5e807c8c2ea4ac03f8eeeb006b1a154d453
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Sat Feb 23 16:25:57 2019 +0100

    secret connection check all zeroes (#3347)

    * reject the shared secret if is all zeros in case the blacklist was not
    sufficient

    * Add test that verifies lower order pub-keys are rejected at the DH step

    * Update changelog

    * fix typo in test-comment

commit 2137ecc130874118cc23995befed370958c34448
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Sat Feb 23 08:11:27 2019 +0400

    pubsub 2.0 (#3227)

    * green pubsub tests :OK:

    * get rid of clientToQueryMap

    * Subscribe and SubscribeUnbuffered

    * start adapting other pkgs to new pubsub

    * nope

    * rename MsgAndTags to Message

    * remove TagMap

    it does not bring any additional benefits

    * bring back EventSubscriber

    * fix test

    * fix data race in TestStartNextHeightCorrectly

    ```
    Write at 0x00c0001c7418 by goroutine 796:
      github.com/tendermint/tendermint/consensus.TestStartNextHeightCorrectly()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:1296 +0xad
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162

    Previous read at 0x00c0001c7418 by goroutine 858:
      github.com/tendermint/tendermint/consensus.(*ConsensusState).addVote()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:1631 +0x1366
      github.com/tendermint/tendermint/consensus.(*ConsensusState).tryAddVote()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:1476 +0x8f
      github.com/tendermint/tendermint/consensus.(*ConsensusState).handleMsg()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:667 +0xa1e
      github.com/tendermint/tendermint/consensus.(*ConsensusState).receiveRoutine()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:628 +0x794

    Goroutine 796 (running) created at:
      testing.(*T).Run()
          /usr/local/go/src/testing/testing.go:878 +0x659
      testing.runTests.func1()
          /usr/local/go/src/testing/testing.go:1119 +0xa8
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
      testing.runTests()
          /usr/local/go/src/testing/testing.go:1117 +0x4ee
      testing.(*M).Run()
          /usr/local/go/src/testing/testing.go:1034 +0x2ee
      main.main()
          _testmain.go:214 +0x332

    Goroutine 858 (running) created at:
      github.com/tendermint/tendermint/consensus.(*ConsensusState).startRoutines()
          /go/src/github.com/tendermint/tendermint/consensus/state.go:334 +0x221
      github.com/tendermint/tendermint/consensus.startTestRound()
          /go/src/github.com/tendermint/tendermint/consensus/common_test.go:122 +0x63
      github.com/tendermint/tendermint/consensus.TestStateFullRound1()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:255 +0x397
      testing.tRunner()
          /usr/local/go/src/testing/testing.go:827 +0x162
    ```

    * fixes after my own review

    * fix formatting

    * wait 100ms before kicking a subscriber out

    + a test for indexer_service

    * fixes after my second review

    * no timeout

    * add changelog entries

    * fix merge conflicts

    * fix typos after Thane's review

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

    * reformat code

    * rewrite indexer service in the attempt to fix failing test

    https://github.com/tendermint/tendermint/pull/3227/#issuecomment-462316527

    * Revert "rewrite indexer service in the attempt to fix failing test"

    This reverts commit 0d9107a098230de7138abb1c201877c246e89ed1.

    * another attempt to fix indexer

    * fixes after Ethan's review

    * use unbuffered channel when indexing transactions

    Refs https://github.com/tendermint/tendermint/pull/3227#discussion_r258786716

    * add a comment for EventBus#SubscribeUnbuffered

    * format code

commit 67fd42835448172d08616589f1473e7153cc0902
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Feb 22 11:49:08 2019 +0400

    fix TestWALPeriodicSync (#3342)

    The test was sometimes failing due to processFlushTicks being called too
    early. The solution is to call wal#Start later in the test.

commit f22ada442a249597dff765a59197bc57a8eae349
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Fri Feb 22 11:48:40 2019 +0400

    refactor decideProposal in common_test (#3343)

commit ed1de135486608d8b4869760960e3eb35ade2c6d
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Thu Feb 21 18:28:02 2019 +0400

    cs: update wal comments (#3334)

    * cs: update wal comments

    Follow-up to https://github.com/tendermint/tendermint/pull/3300

    * Update consensus/wal.go

    Co-Authored-By: melekes <anton.kalyaev@gmail.com>

commit 4f83eec78251b9228f0edb76f261e3e387d21c12
Merge: db5d7602 e0f89364
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:11:33 2019 -0500

    Merge pull request #3339 from tendermint/master

    Merge master back to develop

commit e0f8936455029a40287a69d5b0e7baa4d5864da1
Merge: 28d75ec8 f2351dc7
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:10:49 2019 -0500

    Merge pull request #3326 from tendermint/release/v0.30.1

    Release/v0.30.1

commit f2351dc758e5c8cf6bc6c5c32931daa8ae6e49a9
Author: Ethan Buchman <ethan@coinculture.info>
Date:   Wed Feb 20 10:05:57 2019 -0500

    update changelog

commit db5d7602fea6a3418d4ae83511c1a35cf9e1c9ca
Author: Daniil Lashin <danil-lashin@yandex.ru>
Date:   Wed Feb 20 14:34:52 2019 +0300

    docs: fix rpc Tx() method docs (#3331)

commit dff3deb2a95474ee1a10fc6aa7fd0a0a9a6aee94
Author: Thane Thomson <connect@thanethomson.com>
Date:   Wed Feb 20 07:45:18 2019 +0200

    cs: sync WAL more frequently (#3300)

    As per #3043, this adds a ticker to sync the WAL every 2s while the WAL is running.

    * Flush WAL every 2s

    This adds a ticker that flushes the WAL every 2s while the WAL is
    running. This is related to #3043.

    * Fix spelling

    * Increase timeout to 2mins for slower build environments

    * Make WAL sync interval configurable

    * Add TODO to replace testChan with more comprehensive testBus

    * Remove extraneous debug statement

    * Remove testChan in favour of using system time

    As per
    https://github.com/tendermint/tendermint/pull/3300#discussion_r255886586,
    this removes the `testChan` WAL member and replaces the approach with a
    system time-oriented one. In this new approach, we keep track of the
    system time at which each flush and periodic flush successfully
    occurred.

    The naming of the various functions is also updated here to be more
    consistent with "flushing" as opposed to "sync'ing".

    * Update naming convention and ensure lock for timestamp update

    * Add Flush method as part of WAL interface

    Adds a `Flush` method as part of the WAL interface to enforce the idea
    that we can manually trigger a WAL flush from outside of the WAL. This
    is employed in the consensus state management to flush the WAL prior to
    signing votes/proposals, as per https://github.com/tendermint/tendermint/issues/3043#issuecomment-453853630

    * Update CHANGELOG_PENDING

    * Remove mutex approach and replace with DI

    The dependency injection approach to dealing with testing concerns could
    allow similar effects to some kind of "testing bus"-based approach. This
    commit introduces an example of this, where instead of relying on
    (potentially fragile) timing of things between the code and the test, we
    inject code into the function under test that can signal the test
    through a channel.

    This allows us to avoid the `time.Sleep()`-based approach previously
    employed.

    * Update comment on WAL flushing during vote signing

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Simplify flush interval definition

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Expand commentary on WAL disk flushing

    Co-Authored-By: thanethomson <connect@thanethomson.com>

    * Add broken test to illustrate WAL sync test problem

    Removes test-related state (dependency injection code) from the WAL data
    structure and adds test code to illustrate the problem with using
    `WALGenerateNBlocks` and `wal.SearchForEndHeight` to test periodic
    sync'ing.

    * Fix test error messages

    * Use WAL group buffer size to check for flush

    A function is added to `libs/autofile/group.go#Group` in order to return
    the size of the buffered data (i.e. data that has not yet been flushed
    to disk). The test now checks that, prior to a `time.Sleep`, the group
    buffer has data in it. After the `time.Sleep` (during which time the
    periodic flush should have been called), the buffer should be empty.

    * Remove config root dir removal from #3291

    * Add godoc for NewWAL mentioning periodic sync

commit 9d4f59b8366ad393410051e09672b76578545d9e
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 18 15:27:07 2019 +0400

    update changelog and bump version

commit d2c7f8dbcf238ccc3a2469e350523c7ed28be154
Author: Ismail Khoffi <Ismail.Khoffi@gmail.com>
Date:   Mon Feb 18 11:08:22 2019 +0100

    p2p: check secret conn id matches dialed id (#3321)

    ref: [#3010 (comment)](https://github.com/tendermint/tendermint/issues/3010#issuecomment-464287627)

    > I tried searching for code where we authenticate a peer against its NetAddress.ID and couldn't find it. I don't see a reason to switch to Noise, but a need to ensure that the node's ID is authenticated e.g. after dialing from the address book.

    * p2p: check secret conn id matches dialed id

    * Fix all p2p tests & make code compile

    * add simple test for dialing with wrong ID

    * update changelog

    * address review comments

    * yet another place where to use IDAddressString and fix
    testSetupMultiplexTransport

commit 8283ca7ddb5b56090aaa15e005b40782fa618ae7
Author: Anton Kaliaev <anton.kalyaev@gmail.com>
Date:   Mon Feb 18 13:23:40 2019 +0400

    3291 follow-up (#3323)

    * changelog: use issue number instead of PR number

    * follow up to #3291

    - rpc/test/helpers.go add StopTendermint(node) func
    - remove ensureDir(filepath.Dir(walFile), 0700)
    - mempool/mempool_test.go add type cleanupFunc func()

    * cmd/show_validator: wrap err to make it more clear

commit 59cc6d36c944012cd4ae39fbee698e8cf353005a
Author: Alessio Treglia <quadrispro@ubuntu.com>
Date:   Mon Feb 18 08:45:27 2019 +0100

    improve ResetTestRootWithChainID() concurrency safety (#3291)

    * improve ResetTestRootWithChainID() concurrency safety

    Rely on ioutil.TempDir() to create test root directories and ensure
    multiple same-chain id test cases can run in parallel.

    * Update config/toml.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * clean up test directories after completion

    Closes: #1034

    * Remove redundant EnsureDir call

    * s/PanicSafety()/panic()/s

    * Put create dir functionality back in ResetTestRootWithChainID

    * Place test directories in OS's tempdir

    In modern UNIX and UNIX-like systems /tmp is very often
    mounted as tmpfs. This might speed test execution a bit.

    * Set 0700 to a const

    * rootsDirs -> configRootDirs

    * Don't double remove directories

    * Avoid global variables

    * Fix consensus tests

    * Reduce defer stack

    * Address review comments

    * Try to fix tests

    * Update CHANGELOG_PENDING.md

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * Update consensus/common_test.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

    * Update consensus/common_test.go

    Co-Authored-By: alessio <quadrispro@ubuntu.com>

commit af8793c01a168f0f15d3147673c572c0f8bf7863
Author: Zarko Milosevic <zarko@interchain.io>
Date:   Mon Feb 18 08:29:41 2019 +0100

    cs: reset triggered timeout precommit (#3310)

    * Reset TriggeredTimeoutPrecommit as part of updateToState

    * Add failing test and fix

    * fix DATA RACE in TestResetTimeoutPrecommitUponNewHeight

    ```
    WARNING: DATA RACE
    Read at 0x00c001691d28 by goroutine 691:
      github.com/tendermint/tendermint/consensus.decideProposal()
          /go/src/github.com/tendermint/tendermint/consensus/common_test.go:133 +0x121
      github.com/tendermint/tendermint/consensus.TestResetTimeoutPrecommitUponNewHeight()
          /go/src/github.com/tendermint/tendermint/consensus/state_test.go:1389 +0x958
      testing.tRunner()
       ‚Ä¶
```

[brapse](/brapse)
pushed a commit
to brapse/tendermint
that referenced
this pull request
[Jun 5, 2019](#ref-commit-3f5e652)
[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes) [![@brapse](https://avatars.githubusercontent.com/u/246?s=40&v=4)](/brapse)

`[mempool: add a safety check, write tests for mempoolIDs (](/brapse/tendermint/commit/3f5e652ef79c00fc6da13bfc3b3637d6f7c1a566 "mempool: add a safety check, write tests for mempoolIDs (#3487)

* mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to https://github.com/tendermint/tendermint/pull/2778

* rename the test

* fixes after Ismail's review")[tendermint#3487](https://github.com/tendermint/tendermint/pull/3487)`
‚Ä¶

`[3f5e652](/brapse/tendermint/commit/3f5e652ef79c00fc6da13bfc3b3637d6f7c1a566)`

```
)

* mempool: add a safety check, write tests for mempoolIDs

and document 65536 limit in the mempool reactor spec

follow-up to [tendermint#2778](https://github.com/tendermint/tendermint/pull/2778)

* rename the test

* fixes after Ismail's review
```

[brapse](/brapse)
pushed a commit
to brapse/tendermint
that referenced
this pull request
[Jun 5, 2019](#ref-commit-fb4ecfc)
[![@liamsi](https://avatars.githubusercontent.com/u/7441766?s=40&u=48d8dd5d37b5545455c90055d49c84199a0b16f2&v=4)](/liamsi) [![@brapse](https://avatars.githubusercontent.com/u/246?s=40&v=4)](/brapse)

`[Add some numbers for](/brapse/tendermint/commit/fb4ecfc73a3b342e42840bc5358ff4994cab8e30 "Add some numbers for #2778") [tendermint#2778](https://github.com/tendermint/tendermint/pull/2778)`

`[fb4ecfc](/brapse/tendermint/commit/fb4ecfc73a3b342e42840bc5358ff4994cab8e30)`

[![@chengwenxi](https://avatars.githubusercontent.com/u/22697326?s=40&v=4)](/chengwenxi)
[chengwenxi](/chengwenxi)
mentioned this pull request
[Jul 1, 2019](#ref-issue-462610344)

[mempool no gossip back
irisnet/irishub#1703](/irisnet/irishub/issues/1703)

Closed

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[Jul 3, 2023](#ref-issue-1786605118)

[x/vulndb: potential Go vuln in github.com/cometbft/cometbft: CVE-2023-34451
golang/vulndb#1883](/golang/vulndb/issues/1883)

Closed

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&v=4)](/hvanz)
[hvanz](/hvanz)
mentioned this pull request
[Jul 4, 2023](#ref-pullrequest-1778503578)

[mempool: Separate reactor from implementation
cometbft/cometbft#1043](/cometbft/cometbft/pull/1043)
 Closed

3 tasks

[![@hvanz](https://avatars.githubusercontent.com/u/15466498?s=40&v=4)](/hvanz)
[hvanz](/hvanz)
mentioned this pull request
[Jul 19, 2023](#ref-issue-1812243365)

[mempool: Remove list of peer ids in reactor
cometbft/cometbft#1146](/cometbft/cometbft/issues/1146)

Closed

[iKapitonau](/iKapitonau)
pushed a commit
to scrtlabs/tendermint
that referenced
this pull request
[Jul 10, 2024](#ref-commit-575b889)
[![@mergify](https://avatars.githubusercontent.com/in/10562?s=40&v=4)](/marketplace/mergify) [![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&u=4cbacd31a79dc8ada3988c674668cd3023f1ee40&v=4)](/melekes)

`[fix(bits): prevent BitArray.UnmarshalJSON from crashing on 0 bits in ‚Ä¶](/scrtlabs/tendermint/commit/575b889ab82b8750f072a887e84b30a1bcd615f2 "fix(bits): prevent BitArray.UnmarshalJSON from crashing on 0 bits in the JSON (backport #2774) (#2778)

This change fixes a bug in which BitArray.UnmarshalJSON hadn't accounted
for the fact that invoking NewBitArray(<=0) returns nil and hence when
dereferenced would crash with a runtime nil pointer dereference. This
bug was found by my security analysis and fuzzing too.

Author: @odeke-em

Fixes https://github.com/cometbft/cometbft/issues/2658

---

#### PR checklist

- [x] Tests written/updated
- [x] Changelog entry added in `.changelog` (we use
[unclog](https://github.com/informalsystems/unclog) to manage our
changelog)
- [ ] ~~Updated relevant documentation (`docs/` or `spec/`) and code
comments~~
- [x] Title follows the [Conventional
Commits](https://www.conventionalcommits.org/en/v1.0.0/) spec
<hr>This is an automatic backport of pull request #2774 done by
[Mergify](https://mergify.com).

---------

Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>")`
‚Ä¶

`[575b889](/scrtlabs/tendermint/commit/575b889ab82b8750f072a887e84b30a1bcd615f2)`

```
‚Ä¶the JSON (backport [tendermint#2774](https://github.com/tendermint/tendermint/pull/2774)) ([tendermint#2778](https://github.com/tendermint/tendermint/pull/2778))

This change fixes a bug in which BitArray.UnmarshalJSON hadn't accounted
for the fact that invoking NewBitArray(<=0) returns nil and hence when
dereferenced would crash with a runtime nil pointer dereference. This
bug was found by my security analysis and fuzzing too.

Author: [@odeke-em](https://github.com/odeke-em)

Fixes [cometbft/cometbft#2658](https://github.com/cometbft/cometbft/issues/2658)

---

#### PR checklist

- [x] Tests written/updated
- [x] Changelog entry added in `.changelog` (we use
[unclog](<https://github.com/informalsystems/unclog>) to manage our
changelog)
- [ ] ~~Updated relevant documentation (`docs/` or `spec/`) and code
comments~~
- [x] Title follows the [Conventional
Commits](<https://www.conventionalcommits.org/en/v1.0.0/>) spec
<hr>This is an automatic backport of pull request [tendermint#2774](https://github.com/tendermint/tendermint/pull/2774) done by
[Mergify](<https://mergify.com>).

---------

Co-authored-by: Anton Kaliaev <anton.kalyaev@gmail.com>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Ftendermint%2Ftendermint%2Fpull%2F2778)

Reviewers

[![@srmo](https://avatars.githubusercontent.com/u/7474512?s=40&v=4)](/srmo) [srmo](/srmo)

srmo left review comments

[![@liamsi](https://avatars.githubusercontent.com/u/7441766?s=40&v=4)](/liamsi) [liamsi](/liamsi)

liamsi approved these changes

[![@ebuchman](https://avatars.githubusercontent.com/u/2300911?s=40&v=4)](/ebuchman) [ebuchman](/ebuchman)

ebuchman left review comments

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes) [melekes](/melekes)

melekes approved these changes

[![@ancazamfir](https://avatars.githubusercontent.com/u/6361427?s=40&v=4)](/ancazamfir) [ancazamfir](/ancazamfir)

 Awaiting requested review from ancazamfir

[![@thanethomson](https://avatars.githubusercontent.com/u/212999?s=40&v=4)](/thanethomson) [thanethomson](/thanethomson)

 Awaiting requested review from thanethomson

[![@milosevic](https://avatars.githubusercontent.com/u/1465543?s=40&v=4)](/milosevic) [milosevic](/milosevic)

 Awaiting requested review from milosevic

Assignees

[![@melekes](https://avatars.githubusercontent.com/u/1282182?s=40&v=4)](/melekes) [melekes](/melekes)

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@ValarDragon](https://avatars.githubusercontent.com/u/6440154?s=52&v=4)](/ValarDragon) [![@codecov-io](https://avatars.githubusercontent.com/u/8655789?s=52&v=4)](/codecov-io) [![@melekes](https://avatars.githubusercontent.com/u/1282182?s=52&v=4)](/melekes) [![@milosevic](https://avatars.githubusercontent.com/u/1465543?s=52&v=4)](/milosevic) [![@ebuchman](https://avatars.githubusercontent.com/u/2300911?s=52&v=4)](/ebuchman) [![@liamsi](https://avatars.githubusercontent.com/u/7441766?s=52&v=4)](/liamsi) [![@srmo](https://avatars.githubusercontent.com/u/7474512?s=52&v=4)](/srmo)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


