=== Content from github.com_aec92b5d_20250115_085530.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2Fd0042551e4a3509a725038eb9b2ad1f683674d94)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2Fd0042551e4a3509a725038eb9b2ad1f683674d94)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Commit

[Permalink](/xerial/snappy-java/commit/d0042551e4a3509a725038eb9b2ad1f683674d94)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-fjpj-2g6w-x25r](https://github.com/advisories/GHSA-fjpj-2g6w-x25r "GHSA-fjpj-2g6w-x25r")

[Browse files](/xerial/snappy-java/tree/d0042551e4a3509a725038eb9b2ad1f683674d94)
Browse the repository at this point in the history

```
* Fixed integer overflow by checking if bytesize is bigger than input length, then throwing exception

* Fixed integer overflow by checking if bytesize is bigger than input length, then throwing exception

* Fixed integer overflow by checking if bytesize is bigger than input length, then throwing exception

* improved error messages by adding new error enum INPUT_TOO_LARGE in SnappyErrorCode.java, and added happy and sad cases in SnappyTest.java

* fixed mispelling: validArrayInputLength --> isInvalidArrayInputLength

* switched SnappyError into ILLEGAL_ARGUMENT in SnappyErrorCode.java and Snappy.java and fixed a typo in error comment

* Fix buffer size boundary tests

* Remove negative array size tests

* updated comments for unit test

---------

Co-authored-by: Taro L. Saito <leo@xerial.org>
```

* Loading branch information

[![@aidancch](https://avatars.githubusercontent.com/u/108113174?s=40&v=4)](/aidancch) [![@xerial](https://avatars.githubusercontent.com/u/57538?s=40&v=4)](/xerial)

[aidancch](/xerial/snappy-java/commits?author=aidancch "View all commits by aidancch")
and
[xerial](/xerial/snappy-java/commits?author=xerial "View all commits by xerial")
authored
Jun 14, 2023

1 parent
[3bf6785](/xerial/snappy-java/commit/3bf67857fcf70d9eea56eed4af7c925671e8eaea)

commit d004255

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**94 additions**
and
**8 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/xerial/snappy

    - src/main/java/org/xerial/snappy/Snappy.java
      [Snappy.java](#diff-aef5e968c300153b6b74254a693ed9ed0cdaf8fffe2f51fcffdefec89dee0683)
  + test/java/org/xerial/snappy

    - src/test/java/org/xerial/snappy/SnappyTest.java
      [SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5)

## There are no files selected for viewing

36 changes: 30 additions & 6 deletions

36
[src/main/java/org/xerial/snappy/Snappy.java](#diff-aef5e968c300153b6b74254a693ed9ed0cdaf8fffe2f51fcffdefec89dee0683 "src/main/java/org/xerial/snappy/Snappy.java")

Show comments

[View file](/xerial/snappy-java/blob/d0042551e4a3509a725038eb9b2ad1f683674d94/src/main/java/org/xerial/snappy/Snappy.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -169,7 +169,11 @@ public static int compress(ByteBuffer uncompressed, ByteBuffer compressed) |
|  |  | public static byte[] compress(char[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 2); // char uses 2 bytes |
|  |  | int byteSize = input.length \* 2; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // char uses 2 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -181,7 +185,11 @@ public static byte[] compress(char[] input) |
|  |  | public static byte[] compress(double[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 8); // double uses 8 bytes |
|  |  | int byteSize = input.length \* 8; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // double uses 8 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -193,7 +201,11 @@ public static byte[] compress(double[] input) |
|  |  | public static byte[] compress(float[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 4); // float uses 4 bytes |
|  |  | int byteSize = input.length \* 4; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // float uses 4 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -205,7 +217,11 @@ public static byte[] compress(float[] input) |
|  |  | public static byte[] compress(int[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 4); // int uses 4 bytes |
|  |  | int byteSize = input.length \* 4; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // int uses 4 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -217,7 +233,11 @@ public static byte[] compress(int[] input) |
|  |  | public static byte[] compress(long[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 8); // long uses 8 bytes |
|  |  | int byteSize = input.length \* 8; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // long uses 8 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand All | | @@ -229,7 +249,11 @@ public static byte[] compress(long[] input) |
|  |  | public static byte[] compress(short[] input) |
|  |  | throws IOException |
|  |  | { |
|  |  | return rawCompress(input, input.length \* 2); // short uses 2 bytes |
|  |  | int byteSize = input.length \* 2; |
|  |  | if (byteSize < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | return rawCompress(input, byteSize); // short uses 2 bytes |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down | |  |

66 changes: 64 additions & 2 deletions

66
[src/test/java/org/xerial/snappy/SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5 "src/test/java/org/xerial/snappy/SnappyTest.java")

Show comments

[View file](/xerial/snappy-java/blob/d0042551e4a3509a725038eb9b2ad1f683674d94/src/test/java/org/xerial/snappy/SnappyTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,7 +19,7 @@ |
|  |  | // SnappyTest.java |
|  |  | // Since: 2011/03/30 |
|  |  | // |
|  |  | // $URL$ |
|  |  | // $URL$ |
|  |  | // $Author$ |
|  |  | //-------------------------------------- |
|  |  | package org.xerial.snappy; |
| Expand Down  Expand Up | | @@ -331,8 +331,8 @@ public void isValidCompressedData() |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  |  |
|  |  | /\* |
|  |  | Tests happy cases for SnappyInputStream.read method |
|  |  | - {0} |
|  |  | \*/ |
| Expand Down  Expand Up | | @@ -385,6 +385,67 @@ public void isInvalidChunkLengthForSnappyInputStreamOutOfMemory() |
|  |  | - int: 0, 10 |
|  |  | - long: 0, 10 |
|  |  | - short: 0, 10 |
|  |  | \*/ |
|  |  | @Test |
|  |  | public void isValidArrayInputLength() |
|  |  | throws Exception { |
|  |  | byte[] a = Snappy.compress(new char[0]); |
|  |  | byte[] b = Snappy.compress(new double[0]); |
|  |  | byte[] c = Snappy.compress(new float[0]); |
|  |  | byte[] d = Snappy.compress(new int[0]); |
|  |  | byte[] e = Snappy.compress(new long[0]); |
|  |  | byte[] f = Snappy.compress(new short[0]); |
|  |  | byte[] g = Snappy.compress(new char[10]); |
|  |  | byte[] h = Snappy.compress(new double[10]); |
|  |  | byte[] i = Snappy.compress(new float[10]); |
|  |  | byte[] j = Snappy.compress(new int[10]); |
|  |  | byte[] k = Snappy.compress(new long[10]); |
|  |  | byte[] l = Snappy.compress(new short[10]); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests sad cases for Snappy.compress |
|  |  | - Allocate a buffer whose byte size will be a bit larger than Integer.MAX\_VALUE |
|  |  | - char |
|  |  | - double |
|  |  | - float |
|  |  | - int |
|  |  | - long |
|  |  | - short |
|  |  | \*/ |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeDoubleArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new double[Integer.MAX\_VALUE / 8 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeCharArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new char[Integer.MAX\_VALUE / 2 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeFloatArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new float[Integer.MAX\_VALUE / 4 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeIntArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new int[Integer.MAX\_VALUE / 4 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeLongArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new long[Integer.MAX\_VALUE / 8 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeShortArrayInputLength() throws Exception { |
|  |  | Snappy.compress(new short[Integer.MAX\_VALUE / 2 + 1]); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests happy cases for Snappy.compress |
|  |  | - char: 0, 10 |
|  |  | \*/ |
|  |  | @Test |
|  |  | public void isValidArrayInputLengthForBitShuffleShuffle() |
| Expand Down  Expand Up | | @@ -435,5 +496,6 @@ public void isTooLargeLongArrayInputLengthForBitShuffleShuffle() throws Exceptio |
|  |  | public void isTooLargeShortArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new short[Integer.MAX\_VALUE / 2 + 1]); |
|  |  |  |
|  |  |  |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d004255`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2Fd0042551e4a3509a725038eb9b2ad1f683674d94) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_17badf6f_20250115_085532.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-fjpj-2g6w-x25r)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-fjpj-2g6w-x25r)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

# Integer overflow in compress leads to DoS

Moderate

[xerial](/xerial)
published
GHSA-fjpj-2g6w-x25r
Jun 14, 2023

## Package

maven

snappy-java
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

<= 1.1.10.0

## Patched versions

1.1.10.1

## Description

## Summary

Due to unchecked multiplications, an integer overflow may occur, causing an unrecoverable fatal error.

## Impact

Denial of Service

## Description

The function [compress(char[] input)](https://github.com/xerial/snappy-java/blob/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java#L169) in the file [Snappy.java](https://github.com/xerial/snappy-java/blob/master/src/main/java/org/xerial/snappy/Snappy.java) receives an array of characters and compresses it. It does so by multiplying the length by 2 and passing it to the [rawCompress](https://github.com/xerial/snappy-java/blob/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java#L422) function.

```
public static byte[] compress(char[] input)
            throws IOException
    {
        return rawCompress(input, input.length * 2); // char uses 2 bytes
    }
```

Since the length is not tested, the multiplication by two can cause an integer overflow and become negative. The rawCompress function then uses the received length and passes it to the natively compiled maxCompressedLength function, using the returned value to allocate a byte array.

```
    public static byte[] rawCompress(Object data, int byteSize)
            throws IOException
    {
        byte[] buf = new byte[Snappy.maxCompressedLength(byteSize)];
        int compressedByteSize = impl.rawCompress(data, 0, byteSize, buf, 0);
        byte[] result = new byte[compressedByteSize];
        System.arraycopy(buf, 0, result, 0, compressedByteSize);
        return result;
    }
```

Since the maxCompressedLength function treats the length as an unsigned integer, it doesn’t care that it is negative, and it returns a valid value, which is casted to a signed integer by the Java engine. If the result is negative, a “java.lang.NegativeArraySizeException” exception will be raised while trying to allocate the array “buf”. On the other side, if the result is positive, the “buf” array will successfully be allocated, but its size might be too small to use for the compression, causing a fatal Access Violation error.

The same issue exists also when using the “compress” functions that receive double, float, int, long and short, each using a different multiplier that may cause the same issue. The issue most likely won’t occur when using a byte array, since creating a byte array of size 0x80000000 (or any other negative value) is impossible in the first place.

## Steps To Reproduce

Compile and run the following code:

```
package org.example;
import org.xerial.snappy.Snappy;

import java.io.*;

public class Main {

    public static void main(String[] args) throws IOException {
        char[] uncompressed = new char[0x40000000];
        byte[] compressed = Snappy.compress(uncompressed);
    }
}
```

The program will crash, creating crashdumps and showing the following error (or similar):

```
#
# A fatal error has been detected by the Java Runtime Environment:
#
#  EXCEPTION_ACCESS_VIOLATION (0xc0000005) at pc=0x0000000063a01c20, pid=21164, tid=508
#
.......

```

Alternatively - compile and run the following code:

```
package org.example;
import org.xerial.snappy.Snappy;

import java.io.*;

public class Main {

    public static void main(String[] args) throws IOException {
        char[] uncompressed = new char[0x3fffffff];
        byte[] compressed = Snappy.compress(uncompressed);
    }
}
```

The program will crash with the following error (or similar), since the maxCompressedLength returns a value that is interpreted as negative by java:

```
Exception in thread "main" java.lang.NegativeArraySizeException: -1789569677
	at org.xerial.snappy.Snappy.rawCompress(Snappy.java:425)
	at org.xerial.snappy.Snappy.compress(Snappy.java:172)
	at org.example.Main.main(Main.java:10)

```
## Credit

The vulnerability was discovered by Ori Hollander of the JFrog Security Research Team

### Severity

Moderate

5.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-34454

### Weaknesses

[CWE-190](/advisories?query=cwe%3A190)

### Credits

* [![@srmish-jfrog](https://avatars.githubusercontent.com/u/92059693?s=40&v=4)](/srmish-jfrog)
  [srmish-jfrog](/srmish-jfrog)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_9902044e_20250115_085517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Files

 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# Snappy.java

Copy path Blame  Blame
## Latest commit

## History

[History](/xerial/snappy-java/commits/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java)executable file·928 lines (862 loc) · 29.4 KB 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# Snappy.java

Top
## File metadata and controls

* Code
* Blame

executable file·928 lines (862 loc) · 29.4 KB[Raw](https://github.com/xerial/snappy-java/raw/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928/\*-------------------------------------------------------------------------- \* Copyright 2011 Taro L. Saito \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*--------------------------------------------------------------------------\*///--------------------------------------// snappy-java Project//// Snappy.java// Since: 2011/03/29//// $URL$// $Author$//--------------------------------------package org.xerial.snappy;
import java.io.IOException;import java.io.InputStream;import java.io.UnsupportedEncodingException;import java.net.URL;import java.nio.Buffer;import java.nio.ByteBuffer;import java.nio.charset.Charset;import java.util.Properties;
/\*\* \* Snappy API for data compression/decompression \* <p/> \* Note: if the native libraries cannot be loaded, an ExceptionInInitializerError \* will be thrown at first use of this class. \* \* @author Taro L. Saito \*/public class Snappy{ static { init(); }
 /\*\* \* An instance of SnappyNative \*/ private static SnappyApi impl;
 /\*\* \* Clean up a temporary file (native lib) generated by snappy-java. \* General users do not need to call this method, since the native library extracted in snappy-java \* is deleted upon JVM termination (vie deleteOnExit()). \* This method is useful when using a J2EE container, which will restart servlet containers multiple times without \* restarting JVM. \*/ public static void cleanUp() { SnappyLoader.cleanUpExtractedNativeLib(); SnappyLoader.setSnappyApi(null); }
 static void init() { try { impl = SnappyLoader.loadSnappyApi(); } catch (Exception e) { throw new ExceptionInInitializerError(e); } }
 /\*\* \* Copy bytes from source to destination \* \* @param src pointer to the source array \* @param offset byte offset in the source array \* @param byteLength the number of bytes to copy \* @param dest pointer to the destination array \* @param dest\_offset byte offset in the destination array \* @throws IOException \*/ public static void arrayCopy(Object src, int offset, int byteLength, Object dest, int dest\_offset) throws IOException { impl.arrayCopy(src, offset, byteLength, dest, dest\_offset); }
 /\*\* \* High-level API for compressing the input byte array. This method performs \* array copy to generate the result. If you want to reduce the memory copy \* cost, use {@link #compress(byte[], int, int, byte[], int)} or \* {@link #compress(ByteBuffer, ByteBuffer)}. \* \* @param input the input data \* @return the compressed byte array \* @throws IOException \*/ public static byte[] compress(byte[] input) throws IOException { return rawCompress(input, input.length); }
 /\*\* \* Compress the input buffer content in [inputOffset, \* ...inputOffset+inputLength) then output to the specified output buffer. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return byte size of the compressed data \* @throws IOException when failed to access the input/output buffer \*/ public static int compress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawCompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Compress the content in the given input buffer. After the compression, \* you can retrieve the compressed data from the output buffer [pos() ... \* limit()) (compressed data size = limit() - pos() = remaining()) \* \* @param uncompressed buffer[pos() ... limit()) containing the input data \* @param compressed output of the compressed data. Uses range [pos()..]. \* @return byte size of the compressed data. \* @throws SnappyError when the input is not a direct buffer \*/ public static int compress(ByteBuffer uncompressed, ByteBuffer compressed) throws IOException {
 if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: uncompressed[pos(), limit()) // output: compressed int uPos = uncompressed.position(); int uLen = uncompressed.remaining(); int cPos = compressed.position(); int compressedSize = impl.rawCompress(uncompressed, uPos, uLen, compressed, cPos);
 // pos limit // [ ......BBBBBBB.........] ((Buffer) compressed).limit(cPos + compressedSize);
 return compressedSize; }
 /\*\* \* Compress the input char array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(char[] input) throws IOException { return rawCompress(input, input.length \* 2); // char uses 2 bytes }
 /\*\* \* Compress the input double array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(double[] input) throws IOException { return rawCompress(input, input.length \* 8); // double uses 8 bytes }
 /\*\* \* Compress the input float array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(float[] input) throws IOException { return rawCompress(input, input.length \* 4); // float uses 4 bytes }
 /\*\* \* Compress the input int array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(int[] input) throws IOException { return rawCompress(input, input.length \* 4); // int uses 4 bytes }
 /\*\* \* Compress the input long array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(long[] input) throws IOException { return rawCompress(input, input.length \* 8); // long uses 8 bytes }
 /\*\* \* Compress the input short array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(short[] input) throws IOException { return rawCompress(input, input.length \* 2); // short uses 2 bytes }
 /\*\* \* Compress the input String \* \* @param s \* @return the compressed data \* @throws IOException \*/ public static byte[] compress(String s) throws IOException { try { return compress(s, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 encoder is not found"); } }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, String encoding) throws UnsupportedEncodingException, IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, Charset encoding) throws IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Get the native library version of the snappy \* \* @return native library version \*/ public static String getNativeLibraryVersion() { URL versionFile = SnappyLoader.class.getResource("/org/xerial/snappy/VERSION");
 String version = "unknown"; try { if (versionFile != null) { InputStream in = null; try { Properties versionData = new Properties(); in = versionFile.openStream(); versionData.load(in); version = versionData.getProperty("version", version); if (version.equals("unknown")) { version = versionData.getProperty("SNAPPY\_VERSION", version); } version = version.trim().replaceAll("[^0-9\\.]", ""); } finally { if(in != null) { in.close(); } } } } catch (IOException e) { e.printStackTrace(); } return version; }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); } return impl.isValidCompressedBuffer(input, offset, length); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input) throws IOException { return isValidCompressedBuffer(input, 0, input.length); }
 /\*\* \* Returns true iff the contents of compressed buffer [pos() ... limit()) \* can be uncompressed successfully. Does not return the uncompressed data. \* Takes time proportional to the input length, but is usually at least a \* factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(ByteBuffer compressed) throws IOException { return impl.isValidCompressedBuffer(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(long inputAddr, long offset, long length) throws IOException { return impl.isValidCompressedBuffer(inputAddr, offset, length); }
 /\*\* \* Get the maximum byte size needed for compressing data of the given byte \* size. \* \* @param byteSize byte size of the data to compress \* @return maximum byte size of the compressed data \*/ public static int maxCompressedLength(int byteSize) { return impl.maxCompressedLength(byteSize); }
 /\*\* \* Zero-copy compress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the compressed data \* @return the compressed data size \* @throws IOException \*/ public static long rawCompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawCompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Zero-copy decompress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the uncompressed data \* @return the uncompressed data size \* @throws IOException \*/ public static long rawUncompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawUncompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Compress the input data and produce a byte array of the uncompressed data \* \* @param data input array. The input MUST be an array type \* @param byteSize the input byte size \* @return compressed data \*/ public static byte[] rawCompress(Object data, int byteSize) throws IOException { byte[] buf = new byte[Snappy.maxCompressedLength(byteSize)]; int compressedByteSize = impl.rawCompress(data, 0, byteSize, buf, 0); byte[] result = new byte[compressedByteSize]; System.arraycopy(buf, 0, result, 0, compressedByteSize); return result; }
 /\*\* \* Compress the input buffer [offset,... ,offset+length) contents, then \* write the compressed data to the output buffer[offset, ...) \* \* @param input input array. This MUST be a primitive array type \* @param inputOffset byte offset at the output array \* @param inputLength byte length of the input data \* @param output output array. This MUST be a primitive array type \* @param outputOffset byte offset at the output array \* @return byte size of the compressed data \* @throws IOException \*/ public static int rawCompress(Object input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); }
 int compressedSize = impl .rawCompress(input, inputOffset, inputLength, output, outputOffset); return compressedSize; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input input byte array \* @param inputOffset byte offset in the input byte array \* @param inputLength byte length of the input data \* @param output output buffer, MUST be a primitive type array \* @param outputOffset byte offset in the output buffer \* @return the byte size of the uncompressed data \* @throws IOException when failed to uncompress the input data \*/ public static int rawUncompress(byte[] input, int inputOffset, int inputLength, Object output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); } return impl.rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* High-level API for uncompressing the input byte array. \* \* @param input \* @return the uncompressed byte array \* @throws IOException \*/ public static byte[] uncompress(byte[] input) throws IOException { byte[] result = new byte[Snappy.uncompressedLength(input)]; Snappy.uncompress(input, 0, input.length, result, 0); return result; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return the byte size of the uncompressed data \* @throws IOException \*/ public static int uncompress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Uncompress the content in the input buffer. The result is dumped to the \* specified output buffer. \* <p/> \* Note that if you pass the wrong data or the range [pos(), limit()) that \* cannot be uncompressed, your JVM might crash due to the access violation \* exception issued in the native code written in C++. To avoid this type of \* crash, use {@link #isValidCompressedBuffer(ByteBuffer)} first. \* \* @param compressed buffer[pos() ... limit()) containing the input data \* @param uncompressed output of the the uncompressed data. It uses buffer[pos()..] \* @return uncompressed data size \* @throws IOException when failed to uncompress the given input \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompress(ByteBuffer compressed, ByteBuffer uncompressed) throws IOException {
 if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 int cPos = compressed.position(); int cLen = compressed.remaining(); int uPos = uncompressed.position();
 // pos limit // [ ......UUUUUU.........] int decompressedSize = impl.rawUncompress(compressed, cPos, cLen, uncompressed, uPos); uncompressed.limit(uPos + decompressedSize);
 return decompressedSize; }
 /\*\* \* Uncompress the input data as char array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input) throws IOException { return uncompressCharArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, .., offset+length) as a char array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); char[] result = new char[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input) throws IOException { return uncompressDoubleArray(input, 0, input.length); }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); double[] result = new double[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input) throws IOException { return impl.uncompressedLength(input, 0, input.length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @param offset \* @param length \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); }
 return impl.uncompressedLength(input, offset, length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param compressed input data [pos() ... limit()) \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompressedLength(ByteBuffer compressed) throws IOException { if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); }
 return impl.uncompressedLength(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This operation takes O(1) time. \* \* @param inputAddr compressed data address \* @param len byte length of the input \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static long uncompressedLength(long inputAddr, long len) throws IOException { return impl.uncompressedLength(inputAddr, len); }
 /\*\* \* Uncompress the input as a float array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input) throws IOException { return uncompressFloatArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a float array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); float[] result = new float[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as an int array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input) throws IOException { return uncompressIntArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as an int array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); int[] result = new int[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as a long array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input) throws IOException { return uncompressLongArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a long array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); long[] result = new long[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a short array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input) throws IOException { return uncompressShortArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a short array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); short[] result = new short[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a String \* \* @param input \* @return the uncompressed dasta \* @throws IOException \*/ public static String uncompressString(byte[] input) throws IOException { try { return uncompressString(input, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length) throws IOException { try { return uncompressString(input, offset, length, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \* @throws UnsupportedEncodingException \*/ public static String uncompressString(byte[] input, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_8bd81e5f_20250115_085526.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2Fmaster%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2Fmaster%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Files

 master
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/master)
2. /[src](/xerial/snappy-java/tree/master/src)
3. /[main](/xerial/snappy-java/tree/master/src/main)
4. /[java](/xerial/snappy-java/tree/master/src/main/java)
5. /[org](/xerial/snappy-java/tree/master/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/master/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/master/src/main/java/org/xerial/snappy)
/
# Snappy.java

Copy path Blame  Blame
## Latest commit

## History

[History](/xerial/snappy-java/commits/master/src/main/java/org/xerial/snappy/Snappy.java)executable file·952 lines (886 loc) · 30.6 KB master
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/master)
2. /[src](/xerial/snappy-java/tree/master/src)
3. /[main](/xerial/snappy-java/tree/master/src/main)
4. /[java](/xerial/snappy-java/tree/master/src/main/java)
5. /[org](/xerial/snappy-java/tree/master/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/master/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/master/src/main/java/org/xerial/snappy)
/
# Snappy.java

Top
## File metadata and controls

* Code
* Blame

executable file·952 lines (886 loc) · 30.6 KB[Raw](https://github.com/xerial/snappy-java/raw/refs/heads/master/src/main/java/org/xerial/snappy/Snappy.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928929930931932933934935936937938939940941942943944945946947948949950951952/\*-------------------------------------------------------------------------- \* Copyright 2011 Taro L. Saito \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*--------------------------------------------------------------------------\*///--------------------------------------// snappy-java Project//// Snappy.java// Since: 2011/03/29//// $URL$// $Author$//--------------------------------------package org.xerial.snappy;
import java.io.IOException;import java.io.InputStream;import java.io.UnsupportedEncodingException;import java.net.URL;import java.nio.Buffer;import java.nio.ByteBuffer;import java.nio.charset.Charset;import java.util.Properties;
/\*\* \* Snappy API for data compression/decompression \* <p/> \* Note: if the native libraries cannot be loaded, an ExceptionInInitializerError \* will be thrown at first use of this class. \* \* @author Taro L. Saito \*/public class Snappy{ static { init(); }
 /\*\* \* An instance of SnappyNative \*/ private static SnappyApi impl;
 /\*\* \* Clean up a temporary file (native lib) generated by snappy-java. \* General users do not need to call this method, since the native library extracted in snappy-java \* is deleted upon JVM termination (vie deleteOnExit()). \* This method is useful when using a J2EE container, which will restart servlet containers multiple times without \* restarting JVM. \*/ public static void cleanUp() { SnappyLoader.cleanUpExtractedNativeLib(); SnappyLoader.setSnappyApi(null); }
 static void init() { try { impl = SnappyLoader.loadSnappyApi(); } catch (Exception e) { throw new ExceptionInInitializerError(e); } }
 /\*\* \* Copy bytes from source to destination \* \* @param src pointer to the source array \* @param offset byte offset in the source array \* @param byteLength the number of bytes to copy \* @param dest pointer to the destination array \* @param dest\_offset byte offset in the destination array \* @throws IOException \*/ public static void arrayCopy(Object src, int offset, int byteLength, Object dest, int dest\_offset) throws IOException { impl.arrayCopy(src, offset, byteLength, dest, dest\_offset); }
 /\*\* \* High-level API for compressing the input byte array. This method performs \* array copy to generate the result. If you want to reduce the memory copy \* cost, use {@link #compress(byte[], int, int, byte[], int)} or \* {@link #compress(ByteBuffer, ByteBuffer)}. \* \* @param input the input data \* @return the compressed byte array \* @throws IOException \*/ public static byte[] compress(byte[] input) throws IOException { return rawCompress(input, input.length); }
 /\*\* \* Compress the input buffer content in [inputOffset, \* ...inputOffset+inputLength) then output to the specified output buffer. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return byte size of the compressed data \* @throws IOException when failed to access the input/output buffer \*/ public static int compress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawCompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Compress the content in the given input buffer. After the compression, \* you can retrieve the compressed data from the output buffer [pos() ... \* limit()) (compressed data size = limit() - pos() = remaining()) \* \* @param uncompressed buffer[pos() ... limit()) containing the input data \* @param compressed output of the compressed data. Uses range [pos()..]. \* @return byte size of the compressed data. \* @throws SnappyError when the input is not a direct buffer \*/ public static int compress(ByteBuffer uncompressed, ByteBuffer compressed) throws IOException {
 if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: uncompressed[pos(), limit()) // output: compressed int uPos = uncompressed.position(); int uLen = uncompressed.remaining(); int cPos = compressed.position(); int compressedSize = impl.rawCompress(uncompressed, uPos, uLen, compressed, cPos);
 // pos limit // [ ......BBBBBBB.........] ((Buffer) compressed).limit(cPos + compressedSize);
 return compressedSize; }
 /\*\* \* Compress the input char array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(char[] input) throws IOException { int byteSize = input.length \* 2; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // char uses 2 bytes }
 /\*\* \* Compress the input double array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(double[] input) throws IOException { int byteSize = input.length \* 8; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // double uses 8 bytes }
 /\*\* \* Compress the input float array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(float[] input) throws IOException { int byteSize = input.length \* 4; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // float uses 4 bytes }
 /\*\* \* Compress the input int array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(int[] input) throws IOException { int byteSize = input.length \* 4; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // int uses 4 bytes }
 /\*\* \* Compress the input long array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(long[] input) throws IOException { int byteSize = input.length \* 8; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // long uses 8 bytes }
 /\*\* \* Compress the input short array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(short[] input) throws IOException { int byteSize = input.length \* 2; if (byteSize < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } return rawCompress(input, byteSize); // short uses 2 bytes }
 /\*\* \* Compress the input String \* \* @param s \* @return the compressed data \* @throws IOException \*/ public static byte[] compress(String s) throws IOException { try { return compress(s, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 encoder is not found"); } }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, String encoding) throws UnsupportedEncodingException, IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, Charset encoding) throws IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Get the native library version of the snappy \* \* @return native library version \*/ public static String getNativeLibraryVersion() { URL versionFile = SnappyLoader.class.getResource("/org/xerial/snappy/VERSION");
 String version = "unknown"; try { if (versionFile != null) { InputStream in = null; try { Properties versionData = new Properties(); in = versionFile.openStream(); versionData.load(in); version = versionData.getProperty("version", version); if (version.equals("unknown")) { version = versionData.getProperty("SNAPPY\_VERSION", version); } version = version.trim().replaceAll("[^0-9\\.]", ""); } finally { if(in != null) { in.close(); } } } } catch (IOException e) { e.printStackTrace(); } return version; }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); } return impl.isValidCompressedBuffer(input, offset, length); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input) throws IOException { return isValidCompressedBuffer(input, 0, input.length); }
 /\*\* \* Returns true iff the contents of compressed buffer [pos() ... limit()) \* can be uncompressed successfully. Does not return the uncompressed data. \* Takes time proportional to the input length, but is usually at least a \* factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(ByteBuffer compressed) throws IOException { return impl.isValidCompressedBuffer(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(long inputAddr, long offset, long length) throws IOException { return impl.isValidCompressedBuffer(inputAddr, offset, length); }
 /\*\* \* Get the maximum byte size needed for compressing data of the given byte \* size. \* \* @param byteSize byte size of the data to compress \* @return maximum byte size of the compressed data \*/ public static int maxCompressedLength(int byteSize) { return impl.maxCompressedLength(byteSize); }
 /\*\* \* Zero-copy compress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the compressed data \* @return the compressed data size \* @throws IOException \*/ public static long rawCompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawCompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Zero-copy decompress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the uncompressed data \* @return the uncompressed data size \* @throws IOException \*/ public static long rawUncompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawUncompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Compress the input data and produce a byte array of the uncompressed data \* \* @param data input array. The input MUST be an array type \* @param byteSize the input byte size \* @return compressed data \*/ public static byte[] rawCompress(Object data, int byteSize) throws IOException { byte[] buf = new byte[Snappy.maxCompressedLength(byteSize)]; int compressedByteSize = impl.rawCompress(data, 0, byteSize, buf, 0); byte[] result = new byte[compressedByteSize]; System.arraycopy(buf, 0, result, 0, compressedByteSize); return result; }
 /\*\* \* Compress the input buffer [offset,... ,offset+length) contents, then \* write the compressed data to the output buffer[offset, ...) \* \* @param input input array. This MUST be a primitive array type \* @param inputOffset byte offset at the output array \* @param inputLength byte length of the input data \* @param output output array. This MUST be a primitive array type \* @param outputOffset byte offset at the output array \* @return byte size of the compressed data \* @throws IOException \*/ public static int rawCompress(Object input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); }
 int compressedSize = impl .rawCompress(input, inputOffset, inputLength, output, outputOffset); return compressedSize; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input input byte array \* @param inputOffset byte offset in the input byte array \* @param inputLength byte length of the input data \* @param output output buffer, MUST be a primitive type array \* @param outputOffset byte offset in the output buffer \* @return the byte size of the uncompressed data \* @throws IOException when failed to uncompress the input data \*/ public static int rawUncompress(byte[] input, int inputOffset, int inputLength, Object output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); } return impl.rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* High-level API for uncompressing the input byte array. \* \* @param input \* @return the uncompressed byte array \* @throws IOException \*/ public static byte[] uncompress(byte[] input) throws IOException { byte[] result = new byte[Snappy.uncompressedLength(input)]; Snappy.uncompress(input, 0, input.length, result, 0); return result; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return the byte size of the uncompressed data \* @throws IOException \*/ public static int uncompress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Uncompress the content in the input buffer. The result is dumped to the \* specified output buffer. \* <p/> \* Note that if you pass the wrong data or the range [pos(), limit()) that \* cannot be uncompressed, your JVM might crash due to the access violation \* exception issued in the native code written in C++. To avoid this type of \* crash, use {@link #isValidCompressedBuffer(ByteBuffer)} first. \* \* @param compressed buffer[pos() ... limit()) containing the input data \* @param uncompressed output of the the uncompressed data. It uses buffer[pos()..] \* @return uncompressed data size \* @throws IOException when failed to uncompress the given input \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompress(ByteBuffer compressed, ByteBuffer uncompressed) throws IOException {
 if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 int cPos = compressed.position(); int cLen = compressed.remaining(); int uPos = uncompressed.position();
 // pos limit // [ ......UUUUUU.........] int decompressedSize = impl.rawUncompress(compressed, cPos, cLen, uncompressed, uPos); uncompressed.limit(uPos + decompressedSize);
 return decompressedSize; }
 /\*\* \* Uncompress the input data as char array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input) throws IOException { return uncompressCharArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, .., offset+length) as a char array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); char[] result = new char[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input) throws IOException { return uncompressDoubleArray(input, 0, input.length); }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); double[] result = new double[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input) throws IOException { return impl.uncompressedLength(input, 0, input.length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @param offset \* @param length \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); }
 return impl.uncompressedLength(input, offset, length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param compressed input data [pos() ... limit()) \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompressedLength(ByteBuffer compressed) throws IOException { if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); }
 return impl.uncompressedLength(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This operation takes O(1) time. \* \* @param inputAddr compressed data address \* @param len byte length of the input \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static long uncompressedLength(long inputAddr, long len) throws IOException { return impl.uncompressedLength(inputAddr, len); }
 /\*\* \* Uncompress the input as a float array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input) throws IOException { return uncompressFloatArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a float array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); float[] result = new float[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as an int array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input) throws IOException { return uncompressIntArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as an int array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); int[] result = new int[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as a long array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input) throws IOException { return uncompressLongArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a long array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); long[] result = new long[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a short array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input) throws IOException { return uncompressShortArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a short array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); short[] result = new short[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a String \* \* @param input \* @return the uncompressed dasta \* @throws IOException \*/ public static String uncompressString(byte[] input) throws IOException { try { return uncompressString(input, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length) throws IOException { try { return uncompressString(input, offset, length, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \* @throws UnsupportedEncodingException \*/ public static String uncompressString(byte[] input, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_cda8397d_20250115_085520.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FSnappy.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Files

 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# Snappy.java

Copy path Blame  Blame
## Latest commit

## History

[History](/xerial/snappy-java/commits/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java)executable file·928 lines (862 loc) · 29.4 KB 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# Snappy.java

Top
## File metadata and controls

* Code
* Blame

executable file·928 lines (862 loc) · 29.4 KB[Raw](https://github.com/xerial/snappy-java/raw/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/Snappy.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754755756757758759760761762763764765766767768769770771772773774775776777778779780781782783784785786787788789790791792793794795796797798799800801802803804805806807808809810811812813814815816817818819820821822823824825826827828829830831832833834835836837838839840841842843844845846847848849850851852853854855856857858859860861862863864865866867868869870871872873874875876877878879880881882883884885886887888889890891892893894895896897898899900901902903904905906907908909910911912913914915916917918919920921922923924925926927928/\*-------------------------------------------------------------------------- \* Copyright 2011 Taro L. Saito \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*--------------------------------------------------------------------------\*///--------------------------------------// snappy-java Project//// Snappy.java// Since: 2011/03/29//// $URL$// $Author$//--------------------------------------package org.xerial.snappy;
import java.io.IOException;import java.io.InputStream;import java.io.UnsupportedEncodingException;import java.net.URL;import java.nio.Buffer;import java.nio.ByteBuffer;import java.nio.charset.Charset;import java.util.Properties;
/\*\* \* Snappy API for data compression/decompression \* <p/> \* Note: if the native libraries cannot be loaded, an ExceptionInInitializerError \* will be thrown at first use of this class. \* \* @author Taro L. Saito \*/public class Snappy{ static { init(); }
 /\*\* \* An instance of SnappyNative \*/ private static SnappyApi impl;
 /\*\* \* Clean up a temporary file (native lib) generated by snappy-java. \* General users do not need to call this method, since the native library extracted in snappy-java \* is deleted upon JVM termination (vie deleteOnExit()). \* This method is useful when using a J2EE container, which will restart servlet containers multiple times without \* restarting JVM. \*/ public static void cleanUp() { SnappyLoader.cleanUpExtractedNativeLib(); SnappyLoader.setSnappyApi(null); }
 static void init() { try { impl = SnappyLoader.loadSnappyApi(); } catch (Exception e) { throw new ExceptionInInitializerError(e); } }
 /\*\* \* Copy bytes from source to destination \* \* @param src pointer to the source array \* @param offset byte offset in the source array \* @param byteLength the number of bytes to copy \* @param dest pointer to the destination array \* @param dest\_offset byte offset in the destination array \* @throws IOException \*/ public static void arrayCopy(Object src, int offset, int byteLength, Object dest, int dest\_offset) throws IOException { impl.arrayCopy(src, offset, byteLength, dest, dest\_offset); }
 /\*\* \* High-level API for compressing the input byte array. This method performs \* array copy to generate the result. If you want to reduce the memory copy \* cost, use {@link #compress(byte[], int, int, byte[], int)} or \* {@link #compress(ByteBuffer, ByteBuffer)}. \* \* @param input the input data \* @return the compressed byte array \* @throws IOException \*/ public static byte[] compress(byte[] input) throws IOException { return rawCompress(input, input.length); }
 /\*\* \* Compress the input buffer content in [inputOffset, \* ...inputOffset+inputLength) then output to the specified output buffer. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return byte size of the compressed data \* @throws IOException when failed to access the input/output buffer \*/ public static int compress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawCompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Compress the content in the given input buffer. After the compression, \* you can retrieve the compressed data from the output buffer [pos() ... \* limit()) (compressed data size = limit() - pos() = remaining()) \* \* @param uncompressed buffer[pos() ... limit()) containing the input data \* @param compressed output of the compressed data. Uses range [pos()..]. \* @return byte size of the compressed data. \* @throws SnappyError when the input is not a direct buffer \*/ public static int compress(ByteBuffer uncompressed, ByteBuffer compressed) throws IOException {
 if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: uncompressed[pos(), limit()) // output: compressed int uPos = uncompressed.position(); int uLen = uncompressed.remaining(); int cPos = compressed.position(); int compressedSize = impl.rawCompress(uncompressed, uPos, uLen, compressed, cPos);
 // pos limit // [ ......BBBBBBB.........] ((Buffer) compressed).limit(cPos + compressedSize);
 return compressedSize; }
 /\*\* \* Compress the input char array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(char[] input) throws IOException { return rawCompress(input, input.length \* 2); // char uses 2 bytes }
 /\*\* \* Compress the input double array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(double[] input) throws IOException { return rawCompress(input, input.length \* 8); // double uses 8 bytes }
 /\*\* \* Compress the input float array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(float[] input) throws IOException { return rawCompress(input, input.length \* 4); // float uses 4 bytes }
 /\*\* \* Compress the input int array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(int[] input) throws IOException { return rawCompress(input, input.length \* 4); // int uses 4 bytes }
 /\*\* \* Compress the input long array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(long[] input) throws IOException { return rawCompress(input, input.length \* 8); // long uses 8 bytes }
 /\*\* \* Compress the input short array \* \* @param input \* @return the compressed data \*/ public static byte[] compress(short[] input) throws IOException { return rawCompress(input, input.length \* 2); // short uses 2 bytes }
 /\*\* \* Compress the input String \* \* @param s \* @return the compressed data \* @throws IOException \*/ public static byte[] compress(String s) throws IOException { try { return compress(s, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 encoder is not found"); } }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, String encoding) throws UnsupportedEncodingException, IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Compress the input string using the given encoding \* \* @param s \* @param encoding \* @return the compressed data \* @throws UnsupportedEncodingException \* @throws IOException \*/ public static byte[] compress(String s, Charset encoding) throws IOException { byte[] data = s.getBytes(encoding); return compress(data); }
 /\*\* \* Get the native library version of the snappy \* \* @return native library version \*/ public static String getNativeLibraryVersion() { URL versionFile = SnappyLoader.class.getResource("/org/xerial/snappy/VERSION");
 String version = "unknown"; try { if (versionFile != null) { InputStream in = null; try { Properties versionData = new Properties(); in = versionFile.openStream(); versionData.load(in); version = versionData.getProperty("version", version); if (version.equals("unknown")) { version = versionData.getProperty("SNAPPY\_VERSION", version); } version = version.trim().replaceAll("[^0-9\\.]", ""); } finally { if(in != null) { in.close(); } } } } catch (IOException e) { e.printStackTrace(); } return version; }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); } return impl.isValidCompressedBuffer(input, offset, length); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(byte[] input) throws IOException { return isValidCompressedBuffer(input, 0, input.length); }
 /\*\* \* Returns true iff the contents of compressed buffer [pos() ... limit()) \* can be uncompressed successfully. Does not return the uncompressed data. \* Takes time proportional to the input length, but is usually at least a \* factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(ByteBuffer compressed) throws IOException { return impl.isValidCompressedBuffer(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Returns true iff the contents of compressed buffer [offset, \* offset+length) can be uncompressed successfully. Does not return the \* uncompressed data. Takes time proportional to the input length, but is \* usually at least a factor of four faster than actual decompression. \*/ public static boolean isValidCompressedBuffer(long inputAddr, long offset, long length) throws IOException { return impl.isValidCompressedBuffer(inputAddr, offset, length); }
 /\*\* \* Get the maximum byte size needed for compressing data of the given byte \* size. \* \* @param byteSize byte size of the data to compress \* @return maximum byte size of the compressed data \*/ public static int maxCompressedLength(int byteSize) { return impl.maxCompressedLength(byteSize); }
 /\*\* \* Zero-copy compress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the compressed data \* @return the compressed data size \* @throws IOException \*/ public static long rawCompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawCompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Zero-copy decompress using memory addresses. \* \* @param inputAddr input memory address \* @param inputSize input byte size \* @param destAddr destination address of the uncompressed data \* @return the uncompressed data size \* @throws IOException \*/ public static long rawUncompress(long inputAddr, long inputSize, long destAddr) throws IOException { return impl.rawUncompress(inputAddr, inputSize, destAddr); }
 /\*\* \* Compress the input data and produce a byte array of the uncompressed data \* \* @param data input array. The input MUST be an array type \* @param byteSize the input byte size \* @return compressed data \*/ public static byte[] rawCompress(Object data, int byteSize) throws IOException { byte[] buf = new byte[Snappy.maxCompressedLength(byteSize)]; int compressedByteSize = impl.rawCompress(data, 0, byteSize, buf, 0); byte[] result = new byte[compressedByteSize]; System.arraycopy(buf, 0, result, 0, compressedByteSize); return result; }
 /\*\* \* Compress the input buffer [offset,... ,offset+length) contents, then \* write the compressed data to the output buffer[offset, ...) \* \* @param input input array. This MUST be a primitive array type \* @param inputOffset byte offset at the output array \* @param inputLength byte length of the input data \* @param output output array. This MUST be a primitive array type \* @param outputOffset byte offset at the output array \* @return byte size of the compressed data \* @throws IOException \*/ public static int rawCompress(Object input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); }
 int compressedSize = impl .rawCompress(input, inputOffset, inputLength, output, outputOffset); return compressedSize; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input input byte array \* @param inputOffset byte offset in the input byte array \* @param inputLength byte length of the input data \* @param output output buffer, MUST be a primitive type array \* @param outputOffset byte offset in the output buffer \* @return the byte size of the uncompressed data \* @throws IOException when failed to uncompress the input data \*/ public static int rawUncompress(byte[] input, int inputOffset, int inputLength, Object output, int outputOffset) throws IOException { if (input == null || output == null) { throw new NullPointerException("input or output is null"); } return impl.rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* High-level API for uncompressing the input byte array. \* \* @param input \* @return the uncompressed byte array \* @throws IOException \*/ public static byte[] uncompress(byte[] input) throws IOException { byte[] result = new byte[Snappy.uncompressedLength(input)]; Snappy.uncompress(input, 0, input.length, result, 0); return result; }
 /\*\* \* Uncompress the content in the input buffer. The uncompressed data is \* written to the output buffer. \* <p/> \* Note that if you pass the wrong data or the range [inputOffset, \* inputOffset + inputLength) that cannot be uncompressed, your JVM might \* crash due to the access violation exception issued in the native code \* written in C++. To avoid this type of crash, use \* {@link #isValidCompressedBuffer(byte[], int, int)} first. \* \* @param input \* @param inputOffset \* @param inputLength \* @param output \* @param outputOffset \* @return the byte size of the uncompressed data \* @throws IOException \*/ public static int uncompress(byte[] input, int inputOffset, int inputLength, byte[] output, int outputOffset) throws IOException { return rawUncompress(input, inputOffset, inputLength, output, outputOffset); }
 /\*\* \* Uncompress the content in the input buffer. The result is dumped to the \* specified output buffer. \* <p/> \* Note that if you pass the wrong data or the range [pos(), limit()) that \* cannot be uncompressed, your JVM might crash due to the access violation \* exception issued in the native code written in C++. To avoid this type of \* crash, use {@link #isValidCompressedBuffer(ByteBuffer)} first. \* \* @param compressed buffer[pos() ... limit()) containing the input data \* @param uncompressed output of the the uncompressed data. It uses buffer[pos()..] \* @return uncompressed data size \* @throws IOException when failed to uncompress the given input \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompress(ByteBuffer compressed, ByteBuffer uncompressed) throws IOException {
 if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!uncompressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 int cPos = compressed.position(); int cLen = compressed.remaining(); int uPos = uncompressed.position();
 // pos limit // [ ......UUUUUU.........] int decompressedSize = impl.rawUncompress(compressed, cPos, cLen, uncompressed, uPos); uncompressed.limit(uPos + decompressedSize);
 return decompressedSize; }
 /\*\* \* Uncompress the input data as char array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input) throws IOException { return uncompressCharArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, .., offset+length) as a char array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static char[] uncompressCharArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); char[] result = new char[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input) throws IOException { return uncompressDoubleArray(input, 0, input.length); }
 /\*\* \* Uncompress the input as a double array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static double[] uncompressDoubleArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); double[] result = new double[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input) throws IOException { return impl.uncompressedLength(input, 0, input.length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param input \* @param offset \* @param length \* @return uncompressed byte size of the the given input data \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static int uncompressedLength(byte[] input, int offset, int length) throws IOException { if (input == null) { throw new NullPointerException("input is null"); }
 return impl.uncompressedLength(input, offset, length); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This \* operation takes O(1) time. \* \* @param compressed input data [pos() ... limit()) \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \* @throws SnappyError when the input is not a direct buffer \*/ public static int uncompressedLength(ByteBuffer compressed) throws IOException { if (!compressed.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); }
 return impl.uncompressedLength(compressed, compressed.position(), compressed.remaining()); }
 /\*\* \* Get the uncompressed byte size of the given compressed input. This operation takes O(1) time. \* \* @param inputAddr compressed data address \* @param len byte length of the input \* @return uncompressed byte length of the given input \* @throws IOException when failed to uncompress the given input. The error code is \* {@link SnappyErrorCode#PARSING\_ERROR} \*/ public static long uncompressedLength(long inputAddr, long len) throws IOException { return impl.uncompressedLength(inputAddr, len); }
 /\*\* \* Uncompress the input as a float array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input) throws IOException { return uncompressFloatArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a float array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static float[] uncompressFloatArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); float[] result = new float[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as an int array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input) throws IOException { return uncompressIntArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as an int array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static int[] uncompressIntArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); int[] result = new int[uncompressedLength / 4]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input data as a long array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input) throws IOException { return uncompressLongArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a long array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static long[] uncompressLongArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); long[] result = new long[uncompressedLength / 8]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a short array \* \* @param input \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input) throws IOException { return uncompressShortArray(input, 0, input.length); }
 /\*\* \* Uncompress the input[offset, offset+length) as a short array \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static short[] uncompressShortArray(byte[] input, int offset, int length) throws IOException { int uncompressedLength = Snappy.uncompressedLength(input, offset, length); short[] result = new short[uncompressedLength / 2]; impl.rawUncompress(input, offset, length, result, 0); return result; }
 /\*\* \* Uncompress the input as a String \* \* @param input \* @return the uncompressed dasta \* @throws IOException \*/ public static String uncompressString(byte[] input) throws IOException { try { return uncompressString(input, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String \* \* @param input \* @param offset \* @param length \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length) throws IOException { try { return uncompressString(input, offset, length, "UTF-8"); } catch (UnsupportedEncodingException e) { throw new IllegalStateException("UTF-8 decoder is not found"); } }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input[offset, offset+length) as a String of the given \* encoding \* \* @param input \* @param offset \* @param length \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, int offset, int length, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = new byte[uncompressedLength(input, offset, length)]; uncompress(input, offset, length, uncompressed, 0); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \* @throws UnsupportedEncodingException \*/ public static String uncompressString(byte[] input, String encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }
 /\*\* \* Uncompress the input as a String of the given encoding \* \* @param input \* @param encoding \* @return the uncompressed data \* @throws IOException \*/ public static String uncompressString(byte[] input, Charset encoding) throws IOException, UnsupportedEncodingException { byte[] uncompressed = uncompress(input); return new String(uncompressed, encoding); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


