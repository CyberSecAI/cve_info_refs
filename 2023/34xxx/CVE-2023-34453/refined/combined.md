=== Content from github.com_40d8b6bc_20250115_102123.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F820e2e074c58748b41dbd547f4edba9e108ad905)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F820e2e074c58748b41dbd547f4edba9e108ad905)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Commit

[Permalink](/xerial/snappy-java/commit/820e2e074c58748b41dbd547f4edba9e108ad905)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-pqr6-cmr2-h8hf](https://github.com/advisories/GHSA-pqr6-cmr2-h8hf "GHSA-pqr6-cmr2-h8hf")

[Browse files](/xerial/snappy-java/tree/820e2e074c58748b41dbd547f4edba9e108ad905)
Browse the repository at this point in the history

```
* Fixed integer overflow by checking if multiplication result is smaller than original value

* Fixed integer overflow by checking if multiplication result is smaller than original value

* Fixed integer overflow by checking if multiplication result is smaller than original value

* imporved error messages and added happy and sad cases for unit test in SnappyTest.java

* switched SnappyError into ILLEGAL_ARGUMENT in SnappyErrorCode.java and Snappy.java

* wrote new and updated unit test methods

* updated comments in SnappyTest.java

* Fixed and updated unit tests in SnappyTest.java
```

* Loading branch information

[![@aidancch](https://avatars.githubusercontent.com/u/108113174?s=40&v=4)](/aidancch)

[aidancch](/xerial/snappy-java/commits?author=aidancch "View all commits by aidancch")
authored
Jun 14, 2023

1 parent
[27e2ce0](/xerial/snappy-java/commit/27e2ce0fb09c92d2f8948626e32a0655b2b4ddc0)

commit 820e2e0

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**75 additions**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + main/java/org/xerial/snappy

    - src/main/java/org/xerial/snappy/BitShuffle.java
      [BitShuffle.java](#diff-7640342f59106adbc414c05870bf2a4fe27689161022e2897a6e2c1df899594a)
    - src/main/java/org/xerial/snappy/SnappyErrorCode.java
      [SnappyErrorCode.java](#diff-3217b9dd076da6e7b55a0e5f7023111615aae8e2d640f0c6cd8a62e2f5d43461)
  + test/java/org/xerial/snappy

    - src/test/java/org/xerial/snappy/SnappyTest.java
      [SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5)

## There are no files selected for viewing

15 changes: 15 additions & 0 deletions

15
[src/main/java/org/xerial/snappy/BitShuffle.java](#diff-7640342f59106adbc414c05870bf2a4fe27689161022e2897a6e2c1df899594a "src/main/java/org/xerial/snappy/BitShuffle.java")

Show comments

[View file](/xerial/snappy-java/blob/820e2e074c58748b41dbd547f4edba9e108ad905/src/main/java/org/xerial/snappy/BitShuffle.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -91,6 +91,9 @@ public static int shuffle(ByteBuffer input, BitShuffleType type, ByteBuffer shuf |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public static byte[] shuffle(short[] input) throws IOException { |
|  |  | if (input.length \* 2 < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | byte[] output = new byte[input.length \* 2]; |
|  |  | int numProcessed = impl.shuffle(input, 0, 2, input.length \* 2, output, 0); |
|  |  | assert(numProcessed == input.length \* 2); |
| Expand All | | @@ -105,6 +108,9 @@ public static byte[] shuffle(short[] input) throws IOException { |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public static byte[] shuffle(int[] input) throws IOException { |
|  |  | if (input.length \* 4 < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | byte[] output = new byte[input.length \* 4]; |
|  |  | int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); |
|  |  | assert(numProcessed == input.length \* 4); |
| Expand All | | @@ -119,6 +125,9 @@ public static byte[] shuffle(int[] input) throws IOException { |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public static byte[] shuffle(long[] input) throws IOException { |
|  |  | if (input.length \* 8 < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | byte[] output = new byte[input.length \* 8]; |
|  |  | int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); |
|  |  | assert(numProcessed == input.length \* 8); |
| Expand All | | @@ -133,6 +142,9 @@ public static byte[] shuffle(long[] input) throws IOException { |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public static byte[] shuffle(float[] input) throws IOException { |
|  |  | if (input.length \* 4 < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | byte[] output = new byte[input.length \* 4]; |
|  |  | int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); |
|  |  | assert(numProcessed == input.length \* 4); |
| Expand All | | @@ -147,6 +159,9 @@ public static byte[] shuffle(float[] input) throws IOException { |
|  |  | \* @throws IOException |
|  |  | \*/ |
|  |  | public static byte[] shuffle(double[] input) throws IOException { |
|  |  | if (input.length \* 8 < input.length) { |
|  |  | throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); |
|  |  | } |
|  |  | byte[] output = new byte[input.length \* 8]; |
|  |  | int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); |
|  |  | assert(numProcessed == input.length \* 8); |
| Expand Down | |  |

3 changes: 2 additions & 1 deletion

3
[src/main/java/org/xerial/snappy/SnappyErrorCode.java](#diff-3217b9dd076da6e7b55a0e5f7023111615aae8e2d640f0c6cd8a62e2f5d43461 "src/main/java/org/xerial/snappy/SnappyErrorCode.java")

Show comments

[View file](/xerial/snappy-java/blob/820e2e074c58748b41dbd547f4edba9e108ad905/src/main/java/org/xerial/snappy/SnappyErrorCode.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -42,7 +42,8 @@ public enum SnappyErrorCode |
|  |  | EMPTY\_INPUT(6), |
|  |  | INCOMPATIBLE\_VERSION(7), |
|  |  | INVALID\_CHUNK\_SIZE(8), |
|  |  | UNSUPPORTED\_PLATFORM(9); |
|  |  | UNSUPPORTED\_PLATFORM(9), |
|  |  | TOO\_LARGE\_INPUT(10); |
|  |  |  |
|  |  | public final int id; |
|  |  |  |
| Expand Down | |  |

58 changes: 58 additions & 0 deletions

58
[src/test/java/org/xerial/snappy/SnappyTest.java](#diff-f82b2093a98cc73850ae6c42eb512c8affda0141c6b4e4523a55ae3660ae74f5 "src/test/java/org/xerial/snappy/SnappyTest.java")

Show comments

[View file](/xerial/snappy-java/blob/820e2e074c58748b41dbd547f4edba9e108ad905/src/test/java/org/xerial/snappy/SnappyTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -329,4 +329,62 @@ public void isValidCompressedData() |
|  |  | \_logger.debug(e); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests happy cases for BitShuffle.shuffle method |
|  |  | - double: 0, 10 |
|  |  | - float: 0, 10 |
|  |  | - int: 0, 10 |
|  |  | - long: 0, 10 |
|  |  | - short: 0, 10 |
|  |  | \*/ |
|  |  | @Test |
|  |  | public void isValidArrayInputLengthForBitShuffleShuffle() |
|  |  | throws Exception |
|  |  | { |
|  |  | byte[] b = BitShuffle.shuffle(new double[0]); |
|  |  | byte[] c = BitShuffle.shuffle(new float[0]); |
|  |  | byte[] d = BitShuffle.shuffle(new int[0]); |
|  |  | byte[] e = BitShuffle.shuffle(new long[0]); |
|  |  | byte[] f = BitShuffle.shuffle(new short[0]); |
|  |  | byte[] n = BitShuffle.shuffle(new double[10]); |
|  |  | byte[] o = BitShuffle.shuffle(new float[10]); |
|  |  | byte[] p = BitShuffle.shuffle(new int[10]); |
|  |  | byte[] q = BitShuffle.shuffle(new long[10]); |
|  |  | byte[] r = BitShuffle.shuffle(new short[10]); |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | Tests sad cases for BitShuffle.shuffle method |
|  |  | - Allocate a buffer whose byte size will be a bit larger than Integer.MAX\_VALUE |
|  |  | - double: 8 |
|  |  | - float: 4 |
|  |  | - int: 4 |
|  |  | - long: 8 |
|  |  | - short: 2 |
|  |  | \*/ |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeDoubleArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new double[Integer.MAX\_VALUE / 8 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeFloatArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new float[Integer.MAX\_VALUE / 4 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeIntArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new float[Integer.MAX\_VALUE / 4 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeLongArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new long[Integer.MAX\_VALUE / 8 + 1]); |
|  |  | } |
|  |  |  |
|  |  | @Test(expected = SnappyError.class) |
|  |  | public void isTooLargeShortArrayInputLengthForBitShuffleShuffle() throws Exception { |
|  |  | BitShuffle.shuffle(new short[Integer.MAX\_VALUE / 2 + 1]); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `820e2e0`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fcommit%2F820e2e074c58748b41dbd547f4edba9e108ad905) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_80e2621f_20250115_102124.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-pqr6-cmr2-h8hf)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fsecurity%2Fadvisories%2FGHSA-pqr6-cmr2-h8hf)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

# Integer overflow in shuffle leads to DoS

Moderate

[xerial](/xerial)
published
GHSA-pqr6-cmr2-h8hf
Jun 14, 2023

## Package

maven

snappy-java
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

<= 1.1.10.0

## Patched versions

1.1.10.1

## Description

## Summary

Due to unchecked multiplications, an integer overflow may occur, causing a fatal error.

## Impact

Denial of Service

## Description

The function [shuffle(int[] input)](https://github.com/xerial/snappy-java/blob/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/BitShuffle.java#L107) in the file [BitShuffle.java](https://github.com/xerial/snappy-java/blob/master/src/main/java/org/xerial/snappy/BitShuffle.java) receives an array of integers and applies a bit shuffle on it. It does so by multiplying the length by 4 and passing it to the natively compiled shuffle function.

```
public static byte[] shuffle(int[] input) throws IOException {
        byte[] output = new byte[input.length * 4];
        int numProcessed = impl.shuffle(input, 0, 4, input.length * 4, output, 0);
        assert(numProcessed == input.length * 4);
        return output;
    }
```

Since the length is not tested, the multiplication by four can cause an integer overflow and become a smaller value than the true size, or even zero or negative. In the case of a negative value, a “java.lang.NegativeArraySizeException” exception will raise, which can crash the program. In a case of a value that is zero or too small, the code that afterwards references the shuffled array will assume a bigger size of the array, which might cause exceptions such as “java.lang.ArrayIndexOutOfBoundsException”.

The same issue exists also when using the “shuffle” functions that receive a double, float, long and short, each using a different multiplier that may cause the same issue.

## Steps To Reproduce

Compile and run the following code:

```
package org.example;
import org.xerial.snappy.BitShuffle;

import java.io.*;

public class Main {

    public static void main(String[] args) throws IOException {
        int[] original = new int[0x40000000];
        byte[] shuffled = BitShuffle.shuffle(original);
        System.out.println(shuffled[0]);
    }
}
```

The program will crash, showing the following error (or similar):

```
Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0
	at org.example.Main.main(Main.java:12)

Process finished with exit code 1

```

Alternatively - compile and run the following code:

```
package org.example;
import org.xerial.snappy.BitShuffle;

import java.io.*;

public class Main {

    public static void main(String[] args) throws IOException {
        int[] original = new int[0x20000000];
        byte[] shuffled = BitShuffle.shuffle(original);
    }
}
```

The program will crash with the following error (or similar):

```
Exception in thread "main" java.lang.NegativeArraySizeException: -2147483648
	at org.xerial.snappy.BitShuffle.shuffle(BitShuffle.java:108)
	at org.example.Main.main(Main.java:11)

```
## Credit

The vulnerability was discovered by Ori Hollander of the JFrog Security Research Team

### Severity

Moderate

5.9

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-34453

### Weaknesses

[CWE-190](/advisories?query=cwe%3A190)

### Credits

* [![@srmish-jfrog](https://avatars.githubusercontent.com/u/92059693?s=40&v=4)](/srmish-jfrog)
  [srmish-jfrog](/srmish-jfrog)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f86e520e_20250115_102120.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FBitShuffle.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2F05c39b2ca9b5b7b39611529cc302d3d796329611%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FBitShuffle.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Files

 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# BitShuffle.java

Copy path Blame  Blame
## Latest commit

## History

[History](/xerial/snappy-java/commits/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/BitShuffle.java)265 lines (246 loc) · 9.53 KB 05c39b2
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611)
2. /[src](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src)
3. /[main](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main)
4. /[java](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java)
5. /[org](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy)
/
# BitShuffle.java

Top
## File metadata and controls

* Code
* Blame

265 lines (246 loc) · 9.53 KB[Raw](https://github.com/xerial/snappy-java/raw/05c39b2ca9b5b7b39611529cc302d3d796329611/src/main/java/org/xerial/snappy/BitShuffle.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265/\*-------------------------------------------------------------------------- \* Copyright 2011 Taro L. Saito \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*--------------------------------------------------------------------------\*///--------------------------------------// snappy-java Project//// BitShuffle.java// Since: 2016/03/31//// $URL$// $Author$//--------------------------------------package org.xerial.snappy;
import java.io.IOException;import java.nio.ByteBuffer;
public class BitShuffle{ static { try { impl = SnappyLoader.loadBitShuffleApi(); } catch (Exception e) { throw new ExceptionInInitializerError(e); } }
 /\*\* \* An instance of BitShuffleNative \*/ private static BitShuffleNative impl;
 /\*\* \* Apply a bit-shuffling filter into the content in the given input buffer. After bit-shuffling, \* you can retrieve the shuffled data from the output buffer [pos() ...limit()) \* (shuffled data size = limit() - pos() = remaining()). \* \* @param input buffer[pos() ... limit()) containing the input data \* @param type element type of the input data \* @param shuffled output of the shuffled data. Uses range [pos()..]. \* @return byte size of the shuffled data. \* @throws SnappyError when the input is not a direct buffer \* @throws IllegalArgumentException when the input length is not a multiple of the given type size \*/ public static int shuffle(ByteBuffer input, BitShuffleType type, ByteBuffer shuffled) throws IOException { if (!input.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!shuffled.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: input[pos(), limit()) // output: shuffled int uPos = input.position(); int uLen = input.remaining(); int typeSize = type.getTypeSize(); if (uLen % typeSize != 0) { throw new IllegalArgumentException("input length must be a multiple of the given type size: " + typeSize); } if (shuffled.remaining() < uLen) { throw new IllegalArgumentException("not enough space for output"); } int numProcessed = impl.shuffleDirectBuffer(input, uPos, typeSize, uLen, shuffled, shuffled.position()); assert(numProcessed == uLen);
 // pos limit // [ ......BBBBBBB.........] shuffled.limit(shuffled.position() + numProcessed); return numProcessed; }
 /\*\* \* Apply a bit-shuffling filter into the input short array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(short[] input) throws IOException { byte[] output = new byte[input.length \* 2]; int numProcessed = impl.shuffle(input, 0, 2, input.length \* 2, output, 0); assert(numProcessed == input.length \* 2); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input int array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(int[] input) throws IOException { byte[] output = new byte[input.length \* 4]; int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); assert(numProcessed == input.length \* 4); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input long array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(long[] input) throws IOException { byte[] output = new byte[input.length \* 8]; int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); assert(numProcessed == input.length \* 8); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input float array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(float[] input) throws IOException { byte[] output = new byte[input.length \* 4]; int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); assert(numProcessed == input.length \* 4); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input double array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(double[] input) throws IOException { byte[] output = new byte[input.length \* 8]; int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); assert(numProcessed == input.length \* 8); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original array. The result is dumped \* to the specified output buffer. \* \* @param shuffled buffer[pos() ... limit()) containing the input shuffled data \* @param type element type of the input data \* @param output output of the the original data. It uses buffer[pos()..] \* @return byte size of the unshuffled data. \* @throws IOException when failed to unshuffle the given input \* @throws SnappyError when the input is not a direct buffer \* @throws IllegalArgumentException when the length of input shuffled data is not a multiple of the given type size \*/ public static int unshuffle(ByteBuffer shuffled, BitShuffleType type, ByteBuffer output) throws IOException { if (!shuffled.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!output.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: input[pos(), limit()) // output: shuffled int uPos = shuffled.position(); int uLen = shuffled.remaining(); int typeSize = type.getTypeSize(); if (uLen % typeSize != 0) { throw new IllegalArgumentException("length of input shuffled data must be a multiple of the given type size: " + typeSize); } if (output.remaining() < uLen) { throw new IllegalArgumentException("not enough space for output"); } int numProcessed = impl.unshuffleDirectBuffer(shuffled, uPos, typeSize, uLen, output, shuffled.position()); assert(numProcessed == uLen);
 // pos limit // [ ......BBBBBBB.........] shuffled.limit(shuffled.position() + numProcessed); return numProcessed; }
 /\*\* \* Convert the input bit-shuffled byte array into an original short array. \* \* @param input \* @return a short array \* @throws IOException \*/ public static short[] unshuffleShortArray(byte[] input) throws IOException { short[] output = new short[input.length / 2]; int numProcessed = impl.unshuffle(input, 0, 2, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original int array. \* \* @param input \* @return an int array \* @throws IOException \*/ public static int[] unshuffleIntArray(byte[] input) throws IOException { int[] output = new int[input.length / 4]; int numProcessed = impl.unshuffle(input, 0, 4, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original long array. \* \* @param input \* @return a long array \* @throws IOException \*/ public static long[] unshuffleLongArray(byte[] input) throws IOException { long[] output = new long[input.length / 8]; int numProcessed = impl.unshuffle(input, 0, 8, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original float array. \* \* @param input \* @return an float array \* @throws IOException \*/ public static float[] unshuffleFloatArray(byte[] input) throws IOException { float[] output = new float[input.length / 4]; int numProcessed = impl.unshuffle(input, 0, 4, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original double array. \* \* @param input \* @return a double array \* @throws IOException \*/ public static double[] unshuffleDoubleArray(byte[] input) throws IOException { double[] output = new double[input.length / 8]; int numProcessed = impl.unshuffle(input, 0, 8, input.length, output, 0); assert(numProcessed == input.length); return output; }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_64aac092_20250115_102122.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2Fmaster%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FBitShuffle.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxerial%2Fsnappy-java%2Fblob%2Fmaster%2Fsrc%2Fmain%2Fjava%2Forg%2Fxerial%2Fsnappy%2FBitShuffle.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=xerial%2Fsnappy-java)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xerial](/xerial)
/
**[snappy-java](/xerial/snappy-java)**
Public

* [Notifications](/login?return_to=%2Fxerial%2Fsnappy-java) You must be signed in to change notification settings
* [Fork
  234](/login?return_to=%2Fxerial%2Fsnappy-java)
* [Star
   1k](/login?return_to=%2Fxerial%2Fsnappy-java)

* [Code](/xerial/snappy-java)
* [Issues
  47](/xerial/snappy-java/issues)
* [Pull requests
  8](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects
  0](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

Additional navigation options

* [Code](/xerial/snappy-java)
* [Issues](/xerial/snappy-java/issues)
* [Pull requests](/xerial/snappy-java/pulls)
* [Discussions](/xerial/snappy-java/discussions)
* [Actions](/xerial/snappy-java/actions)
* [Projects](/xerial/snappy-java/projects)
* [Wiki](/xerial/snappy-java/wiki)
* [Security](/xerial/snappy-java/security)
* [Insights](/xerial/snappy-java/pulse)

## Files

 master
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/master)
2. /[src](/xerial/snappy-java/tree/master/src)
3. /[main](/xerial/snappy-java/tree/master/src/main)
4. /[java](/xerial/snappy-java/tree/master/src/main/java)
5. /[org](/xerial/snappy-java/tree/master/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/master/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/master/src/main/java/org/xerial/snappy)
/
# BitShuffle.java

Copy path Blame  Blame
## Latest commit

## History

[History](/xerial/snappy-java/commits/master/src/main/java/org/xerial/snappy/BitShuffle.java)280 lines (261 loc) · 10.4 KB master
## Breadcrumbs

1. [snappy-java](/xerial/snappy-java/tree/master)
2. /[src](/xerial/snappy-java/tree/master/src)
3. /[main](/xerial/snappy-java/tree/master/src/main)
4. /[java](/xerial/snappy-java/tree/master/src/main/java)
5. /[org](/xerial/snappy-java/tree/master/src/main/java/org)
6. /[xerial](/xerial/snappy-java/tree/master/src/main/java/org/xerial)
7. /[snappy](/xerial/snappy-java/tree/master/src/main/java/org/xerial/snappy)
/
# BitShuffle.java

Top
## File metadata and controls

* Code
* Blame

280 lines (261 loc) · 10.4 KB[Raw](https://github.com/xerial/snappy-java/raw/refs/heads/master/src/main/java/org/xerial/snappy/BitShuffle.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280/\*-------------------------------------------------------------------------- \* Copyright 2011 Taro L. Saito \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* http://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*--------------------------------------------------------------------------\*///--------------------------------------// snappy-java Project//// BitShuffle.java// Since: 2016/03/31//// $URL$// $Author$//--------------------------------------package org.xerial.snappy;
import java.io.IOException;import java.nio.ByteBuffer;
public class BitShuffle{ static { try { impl = SnappyLoader.loadBitShuffleApi(); } catch (Exception e) { throw new ExceptionInInitializerError(e); } }
 /\*\* \* An instance of BitShuffleNative \*/ private static BitShuffleNative impl;
 /\*\* \* Apply a bit-shuffling filter into the content in the given input buffer. After bit-shuffling, \* you can retrieve the shuffled data from the output buffer [pos() ...limit()) \* (shuffled data size = limit() - pos() = remaining()). \* \* @param input buffer[pos() ... limit()) containing the input data \* @param type element type of the input data \* @param shuffled output of the shuffled data. Uses range [pos()..]. \* @return byte size of the shuffled data. \* @throws SnappyError when the input is not a direct buffer \* @throws IllegalArgumentException when the input length is not a multiple of the given type size \*/ public static int shuffle(ByteBuffer input, BitShuffleType type, ByteBuffer shuffled) throws IOException { if (!input.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!shuffled.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: input[pos(), limit()) // output: shuffled int uPos = input.position(); int uLen = input.remaining(); int typeSize = type.getTypeSize(); if (uLen % typeSize != 0) { throw new IllegalArgumentException("input length must be a multiple of the given type size: " + typeSize); } if (shuffled.remaining() < uLen) { throw new IllegalArgumentException("not enough space for output"); } int numProcessed = impl.shuffleDirectBuffer(input, uPos, typeSize, uLen, shuffled, shuffled.position()); assert(numProcessed == uLen);
 // pos limit // [ ......BBBBBBB.........] shuffled.limit(shuffled.position() + numProcessed); return numProcessed; }
 /\*\* \* Apply a bit-shuffling filter into the input short array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(short[] input) throws IOException { if (input.length \* 2 < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } byte[] output = new byte[input.length \* 2]; int numProcessed = impl.shuffle(input, 0, 2, input.length \* 2, output, 0); assert(numProcessed == input.length \* 2); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input int array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(int[] input) throws IOException { if (input.length \* 4 < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } byte[] output = new byte[input.length \* 4]; int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); assert(numProcessed == input.length \* 4); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input long array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(long[] input) throws IOException { if (input.length \* 8 < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } byte[] output = new byte[input.length \* 8]; int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); assert(numProcessed == input.length \* 8); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input float array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(float[] input) throws IOException { if (input.length \* 4 < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } byte[] output = new byte[input.length \* 4]; int numProcessed = impl.shuffle(input, 0, 4, input.length \* 4, output, 0); assert(numProcessed == input.length \* 4); return output; }
 /\*\* \* Apply a bit-shuffling filter into the input double array. \* \* @param input \* @return bit-shuffled byte array \* @throws IOException \*/ public static byte[] shuffle(double[] input) throws IOException { if (input.length \* 8 < input.length) { throw new SnappyError(SnappyErrorCode.TOO\_LARGE\_INPUT, "input array size is too large: " + input.length); } byte[] output = new byte[input.length \* 8]; int numProcessed = impl.shuffle(input, 0, 8, input.length \* 8, output, 0); assert(numProcessed == input.length \* 8); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original array. The result is dumped \* to the specified output buffer. \* \* @param shuffled buffer[pos() ... limit()) containing the input shuffled data \* @param type element type of the input data \* @param output output of the the original data. It uses buffer[pos()..] \* @return byte size of the unshuffled data. \* @throws IOException when failed to unshuffle the given input \* @throws SnappyError when the input is not a direct buffer \* @throws IllegalArgumentException when the length of input shuffled data is not a multiple of the given type size \*/ public static int unshuffle(ByteBuffer shuffled, BitShuffleType type, ByteBuffer output) throws IOException { if (!shuffled.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "input is not a direct buffer"); } if (!output.isDirect()) { throw new SnappyError(SnappyErrorCode.NOT\_A\_DIRECT\_BUFFER, "destination is not a direct buffer"); }
 // input: input[pos(), limit()) // output: shuffled int uPos = shuffled.position(); int uLen = shuffled.remaining(); int typeSize = type.getTypeSize(); if (uLen % typeSize != 0) { throw new IllegalArgumentException("length of input shuffled data must be a multiple of the given type size: " + typeSize); } if (output.remaining() < uLen) { throw new IllegalArgumentException("not enough space for output"); } int numProcessed = impl.unshuffleDirectBuffer(shuffled, uPos, typeSize, uLen, output, shuffled.position()); assert(numProcessed == uLen);
 // pos limit // [ ......BBBBBBB.........] shuffled.limit(shuffled.position() + numProcessed); return numProcessed; }
 /\*\* \* Convert the input bit-shuffled byte array into an original short array. \* \* @param input \* @return a short array \* @throws IOException \*/ public static short[] unshuffleShortArray(byte[] input) throws IOException { short[] output = new short[input.length / 2]; int numProcessed = impl.unshuffle(input, 0, 2, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original int array. \* \* @param input \* @return an int array \* @throws IOException \*/ public static int[] unshuffleIntArray(byte[] input) throws IOException { int[] output = new int[input.length / 4]; int numProcessed = impl.unshuffle(input, 0, 4, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original long array. \* \* @param input \* @return a long array \* @throws IOException \*/ public static long[] unshuffleLongArray(byte[] input) throws IOException { long[] output = new long[input.length / 8]; int numProcessed = impl.unshuffle(input, 0, 8, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original float array. \* \* @param input \* @return an float array \* @throws IOException \*/ public static float[] unshuffleFloatArray(byte[] input) throws IOException { float[] output = new float[input.length / 4]; int numProcessed = impl.unshuffle(input, 0, 4, input.length, output, 0); assert(numProcessed == input.length); return output; }
 /\*\* \* Convert the input bit-shuffled byte array into an original double array. \* \* @param input \* @return a double array \* @throws IOException \*/ public static double[] unshuffleDoubleArray(byte[] input) throws IOException { double[] output = new double[input.length / 8]; int numProcessed = impl.unshuffle(input, 0, 8, input.length, output, 0); assert(numProcessed == input.length); return output; }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


