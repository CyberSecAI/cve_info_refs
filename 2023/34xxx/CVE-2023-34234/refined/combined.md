=== Content from github.com_f36b3225_20250114_221242.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-5h3x-9wvq-w4m2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fsecurity%2Fadvisories%2FGHSA-5h3x-9wvq-w4m2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

# Governor proposal creation may be blocked by frontrunning

Moderate

[frangio](/frangio)
published
GHSA-5h3x-9wvq-w4m2
Jun 7, 2023

## Package

npm

@openzeppelin/contracts
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

>=4.3.0 <4.9.1

## Patched versions

4.9.1

npm

@openzeppelin/contracts-upgradeable
([npm](/advisories?query=ecosystem%3Anpm))

>=4.3.0 <4.9.1

4.9.1

## Description

### Impact

By frontrunning the creation of a proposal, an attacker can become the proposer and gain the ability to cancel it. The attacker can do this repeatedly to try to prevent a proposal from being proposed at all.

This impacts the `Governor` contract in v4.9.0 only, and the `GovernorCompatibilityBravo` contract since v4.3.0.

### Patches

The problem has been patched in 4.9.1 by introducing opt-in frontrunning protection.

### Workarounds

Submit the proposal creation transaction to an endpoint with frontrunning protection.

### Credit

Reported by Lior Abadi and Joaquin Pereyra from Coinspect.

### References

<https://www.coinspect.com/openzeppelin-governor-dos/>

### Severity

Moderate

### CVE ID

CVE-2023-34234

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4ae447ee_20250114_221241.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2Fd9474327a492f9f310f31bc53f38dbea56ed9a57)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2Fd9474327a492f9f310f31bc53f38dbea56ed9a57)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenZeppelin%2Fopenzeppelin-contracts)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenZeppelin](/OpenZeppelin)
/
**[openzeppelin-contracts](/OpenZeppelin/openzeppelin-contracts)**
Public

* [Notifications](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts) You must be signed in to change notification settings
* [Fork
  11.9k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)
* [Star
   25.2k](/login?return_to=%2FOpenZeppelin%2Fopenzeppelin-contracts)

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues
  216](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests
  74](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

Additional navigation options

* [Code](/OpenZeppelin/openzeppelin-contracts)
* [Issues](/OpenZeppelin/openzeppelin-contracts/issues)
* [Pull requests](/OpenZeppelin/openzeppelin-contracts/pulls)
* [Actions](/OpenZeppelin/openzeppelin-contracts/actions)
* [Security](/OpenZeppelin/openzeppelin-contracts/security)
* [Insights](/OpenZeppelin/openzeppelin-contracts/pulse)

## Commit

[Permalink](/OpenZeppelin/openzeppelin-contracts/commit/d9474327a492f9f310f31bc53f38dbea56ed9a57)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-5h3x-9wvq-w4m2](https://github.com/advisories/GHSA-5h3x-9wvq-w4m2 "GHSA-5h3x-9wvq-w4m2")

[Browse files](/OpenZeppelin/openzeppelin-contracts/tree/d9474327a492f9f310f31bc53f38dbea56ed9a57)
Browse the repository at this point in the history

```
Co-authored-by: Francisco <fg@frang.io>
Co-authored-by: Ernesto García <ernestognw@gmail.com>
```

* Loading branch information

[![@Amxx](https://avatars.githubusercontent.com/u/2432299?s=40&v=4)](/Amxx) [![@frangio](https://avatars.githubusercontent.com/u/481465?s=40&v=4)](/frangio) [![@ernestognw](https://avatars.githubusercontent.com/u/33379285?s=40&v=4)](/ernestognw)

3 people

authored
Jun 7, 2023

1 parent
[df2778f](/OpenZeppelin/openzeppelin-contracts/commit/df2778f38ecf196d6ecab6df9b958fb5169d3463)

commit d947432

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**231 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .changeset

  + .changeset/swift-bags-divide.md
    [swift-bags-divide.md](#diff-8e073585f57fcb58007e268548444f002bb66577c31a61234899a140c1d4abb2)
* contracts/governance

  + contracts/governance/Governor.sol
    [Governor.sol](#diff-66653f6d39b7c3e38c356d782e05f4871f34553eda930c07a6286344eb44d2e1)
* test/governance

  + test/governance/Governor.t.sol
    [Governor.t.sol](#diff-fc3c0a27b8dfd70fdd4298b591fb4f9b55336e8f8fb208682995697bc68a7801)
  + test/governance/Governor.test.js
    [Governor.test.js](#diff-d9d8e135b7a6328dfc30cf059ce8e65870c704da4fdc5b48cfbbc8bd7e0772df)

## There are no files selected for viewing

5 changes: 5 additions & 0 deletions

5
[.changeset/swift-bags-divide.md](#diff-8e073585f57fcb58007e268548444f002bb66577c31a61234899a140c1d4abb2 ".changeset/swift-bags-divide.md")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/d9474327a492f9f310f31bc53f38dbea56ed9a57/.changeset/swift-bags-divide.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,5 @@ |
|  |  | --- |
|  |  | 'openzeppelin-solidity': patch |
|  |  | --- |
|  |  |  |
|  |  | `Governor`: Add a mechanism to restrict the address of the proposer using a suffix in the description. |

90 changes: 88 additions & 2 deletions

90
[contracts/governance/Governor.sol](#diff-66653f6d39b7c3e38c356d782e05f4871f34553eda930c07a6286344eb44d2e1 "contracts/governance/Governor.sol")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/d9474327a492f9f310f31bc53f38dbea56ed9a57/contracts/governance/Governor.sol)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -263,7 +263,7 @@ abstract contract Governor is Context, ERC165, EIP712, IGovernor, IERC721Receive |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dev See {IGovernor-propose}. |
|  |  | \* @dev See {IGovernor-propose}. This function has opt-in frontrunning protection, described in {\_isValidDescriptionForProposer}. |
|  |  | \*/ |
|  |  | function propose( |
|  |  | address[] memory targets, |
| Expand All | | @@ -272,8 +272,9 @@ abstract contract Governor is Context, ERC165, EIP712, IGovernor, IERC721Receive |
|  |  | string memory description |
|  |  | ) public virtual override returns (uint256) { |
|  |  | address proposer = \_msgSender(); |
|  |  | uint256 currentTimepoint = clock(); |
|  |  | require(\_isValidDescriptionForProposer(proposer, description), "Governor: proposer restricted"); |
|  |  |  |
|  |  | uint256 currentTimepoint = clock(); |
|  |  | require( |
|  |  | getVotes(proposer, currentTimepoint - 1) >= proposalThreshold(), |
|  |  | "Governor: proposer votes below proposal threshold" |
| Expand Down  Expand Up | | @@ -628,4 +629,89 @@ abstract contract Governor is Context, ERC165, EIP712, IGovernor, IERC721Receive |
|  |  | ) public virtual returns (bytes4) { |
|  |  | return this.onERC1155BatchReceived.selector; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dev Check if the proposer is authorized to submit a proposal with the given description. |
|  |  | \* |
|  |  | \* If the proposal description ends with `#proposer=0x???`, where `0x???` is an address written as a hex string |
|  |  | \* (case insensitive), then the submission of this proposal will only be authorized to said address. |
|  |  | \* |
|  |  | \* This is used for frontrunning protection. By adding this pattern at the end of their proposal, one can ensure |
|  |  | \* that no other address can submit the same proposal. An attacker would have to either remove or change that part, |
|  |  | \* which would result in a different proposal id. |
|  |  | \* |
|  |  | \* If the description does not match this pattern, it is unrestricted and anyone can submit it. This includes: |
|  |  | \* - If the `0x???` part is not a valid hex string. |
|  |  | \* - If the `0x???` part is a valid hex string, but does not contain exactly 40 hex digits. |
|  |  | \* - If it ends with the expected suffix followed by newlines or other whitespace. |
|  |  | \* - If it ends with some other similar suffix, e.g. `#other=abc`. |
|  |  | \* - If it does not end with any such suffix. |
|  |  | \*/ |
|  |  | function \_isValidDescriptionForProposer( |
|  |  | address proposer, |
|  |  | string memory description |
|  |  | ) internal view virtual returns (bool) { |
|  |  | uint256 len = bytes(description).length; |
|  |  |  |
|  |  | // Length is too short to contain a valid proposer suffix |
|  |  | if (len < 52) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // Extract what would be the `#proposer=0x` marker beginning the suffix |
|  |  | bytes12 marker; |
|  |  | assembly { |
|  |  | // - Start of the string contents in memory = description + 32 |
|  |  | // - First character of the marker = len - 52 |
|  |  | // - Length of "#proposer=0x0000000000000000000000000000000000000000" = 52 |
|  |  | // - We read the memory word starting at the first character of the marker: |
|  |  | // - (description + 32) + (len - 52) = description + (len - 20) |
|  |  | // - Note: Solidity will ignore anything past the first 12 bytes |
|  |  | marker := mload(add(description, sub(len, 20))) |
|  |  | } |
|  |  |  |
|  |  | // If the marker is not found, there is no proposer suffix to check |
|  |  | if (marker != bytes12("#proposer=0x")) { |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // Parse the 40 characters following the marker as uint160 |
|  |  | uint160 recovered = 0; |
|  |  | for (uint256 i = len - 40; i < len; ++i) { |
|  |  | (bool isHex, uint8 value) = \_tryHexToUint(bytes(description)[i]); |
|  |  | // If any of the characters is not a hex digit, ignore the suffix entirely |
|  |  | if (!isHex) { |
|  |  | return true; |
|  |  | } |
|  |  | recovered = (recovered << 4) | value; |
|  |  | } |
|  |  |  |
|  |  | return recovered == uint160(proposer); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* @dev Try to parse a character from a string as a hex value. Returns `(true, value)` if the char is in |
|  |  | \* `[0-9a-fA-F]` and `(false, 0)` otherwise. Value is guaranteed to be in the range `0 <= value < 16` |
|  |  | \*/ |
|  |  | function \_tryHexToUint(bytes1 char) private pure returns (bool, uint8) { |
|  |  | uint8 c = uint8(char); |
|  |  | unchecked { |
|  |  | // Case 0-9 |
|  |  | if (47 < c && c < 58) { |
|  |  | return (true, c - 48); |
|  |  | } |
|  |  | // Case A-F |
|  |  | else if (64 < c && c < 71) { |
|  |  | return (true, c - 55); |
|  |  | } |
|  |  | // Case a-f |
|  |  | else if (96 < c && c < 103) { |
|  |  | return (true, c - 87); |
|  |  | } |
|  |  | // Else: not a hex char |
|  |  | else { |
|  |  | return (false, 0); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  | } |

55 changes: 55 additions & 0 deletions

55
[test/governance/Governor.t.sol](#diff-fc3c0a27b8dfd70fdd4298b591fb4f9b55336e8f8fb208682995697bc68a7801 "test/governance/Governor.t.sol")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/d9474327a492f9f310f31bc53f38dbea56ed9a57/test/governance/Governor.t.sol)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,55 @@ |
|  |  | // SPDX-License-Identifier: MIT |
|  |  |  |
|  |  | pragma solidity ^0.8.19; |
|  |  |  |
|  |  | import "forge-std/Test.sol"; |
|  |  | import "../../contracts/utils/Strings.sol"; |
|  |  | import "../../contracts/governance/Governor.sol"; |
|  |  |  |
|  |  | contract GovernorInternalTest is Test, Governor { |
|  |  | constructor() Governor("") {} |
|  |  |  |
|  |  | function testValidDescriptionForProposer(string memory description, address proposer, bool includeProposer) public { |
|  |  | if (includeProposer) { |
|  |  | description = string.concat(description, "#proposer=", Strings.toHexString(proposer)); |
|  |  | } |
|  |  | assertTrue(\_isValidDescriptionForProposer(proposer, description)); |
|  |  | } |
|  |  |  |
|  |  | function testInvalidDescriptionForProposer( |
|  |  | string memory description, |
|  |  | address commitProposer, |
|  |  | address actualProposer |
|  |  | ) public { |
|  |  | vm.assume(commitProposer != actualProposer); |
|  |  | description = string.concat(description, "#proposer=", Strings.toHexString(commitProposer)); |
|  |  | assertFalse(\_isValidDescriptionForProposer(actualProposer, description)); |
|  |  | } |
|  |  |  |
|  |  | // We don't need to truly implement implement the missing functions because we are just testing |
|  |  | // internal helpers. |
|  |  |  |
|  |  | function clock() public pure override returns (uint48) {} |
|  |  |  |
|  |  | // solhint-disable-next-line func-name-mixedcase |
|  |  | function CLOCK\_MODE() public pure override returns (string memory) {} |
|  |  |  |
|  |  | // solhint-disable-next-line func-name-mixedcase |
|  |  | function COUNTING\_MODE() public pure virtual override returns (string memory) {} |
|  |  |  |
|  |  | function votingDelay() public pure virtual override returns (uint256) {} |
|  |  |  |
|  |  | function votingPeriod() public pure virtual override returns (uint256) {} |
|  |  |  |
|  |  | function quorum(uint256) public pure virtual override returns (uint256) {} |
|  |  |  |
|  |  | function hasVoted(uint256, address) public pure virtual override returns (bool) {} |
|  |  |  |
|  |  | function \_quorumReached(uint256) internal pure virtual override returns (bool) {} |
|  |  |  |
|  |  | function \_voteSucceeded(uint256) internal pure virtual override returns (bool) {} |
|  |  |  |
|  |  | function \_getVotes(address, uint256, bytes memory) internal pure virtual override returns (uint256) {} |
|  |  |  |
|  |  | function \_countVote(uint256, address, uint8, uint256, bytes memory) internal virtual override {} |
|  |  | } |

83 changes: 83 additions & 0 deletions

83
[test/governance/Governor.test.js](#diff-d9d8e135b7a6328dfc30cf059ce8e65870c704da4fdc5b48cfbbc8bd7e0772df "test/governance/Governor.test.js")

Show comments

[View file](/OpenZeppelin/openzeppelin-contracts/blob/d9474327a492f9f310f31bc53f38dbea56ed9a57/test/governance/Governor.test.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -551,6 +551,89 @@ contract('Governor', function (accounts) { |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('frontrun protection using description suffix', function () { |
|  |  | describe('without protection', function () { |
|  |  | describe('without suffix', function () { |
|  |  | it('proposer can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: proposer }), 'ProposalCreated'); |
|  |  | }); |
|  |  |  |
|  |  | it('someone else can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: voter1 }), 'ProposalCreated'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('with different suffix', function () { |
|  |  | beforeEach(async function () { |
|  |  | this.proposal = this.helper.setProposal( |
|  |  | [ |
|  |  | { |
|  |  | target: this.receiver.address, |
|  |  | data: this.receiver.contract.methods.mockFunction().encodeABI(), |
|  |  | value, |
|  |  | }, |
|  |  | ], |
|  |  | `<proposal description>#wrong-suffix=${proposer}`, |
|  |  | ); |
|  |  | }); |
|  |  |  |
|  |  | it('proposer can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: proposer }), 'ProposalCreated'); |
|  |  | }); |
|  |  |  |
|  |  | it('someone else can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: voter1 }), 'ProposalCreated'); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('with proposer suffix but bad address part', function () { |
|  |  | beforeEach(async function () { |
|  |  | this.proposal = this.helper.setProposal( |
|  |  | [ |
|  |  | { |
|  |  | target: this.receiver.address, |
|  |  | data: this.receiver.contract.methods.mockFunction().encodeABI(), |
|  |  | value, |
|  |  | }, |
|  |  | ], |
|  |  | `<proposal description>#proposer=0x3C44CdDdB6a900fa2b585dd299e03d12FA429XYZ`, // XYZ are not a valid hex char |
|  |  | ); |
|  |  | }); |
|  |  |  |
|  |  | it('propose can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: proposer }), 'ProposalCreated'); |
|  |  | }); |
|  |  |  |
|  |  | it('someone else can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: voter1 }), 'ProposalCreated'); |
|  |  | }); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('with protection via proposer suffix', function () { |
|  |  | beforeEach(async function () { |
|  |  | this.proposal = this.helper.setProposal( |
|  |  | [ |
|  |  | { |
|  |  | target: this.receiver.address, |
|  |  | data: this.receiver.contract.methods.mockFunction().encodeABI(), |
|  |  | value, |
|  |  | }, |
|  |  | ], |
|  |  | `<proposal description>#proposer=${proposer}`, |
|  |  | ); |
|  |  | }); |
|  |  |  |
|  |  | it('proposer can propose', async function () { |
|  |  | expectEvent(await this.helper.propose({ from: proposer }), 'ProposalCreated'); |
|  |  | }); |
|  |  |  |
|  |  | it('someone else cannot propose', async function () { |
|  |  | await expectRevert(this.helper.propose({ from: voter1 }), 'Governor: proposer restricted'); |
|  |  | }); |
|  |  | }); |
|  |  | }); |
|  |  |  |
|  |  | describe('onlyGovernance updates', function () { |
|  |  | it('setVotingDelay is protected', async function () { |
|  |  | await expectRevert(this.mock.setVotingDelay('0'), 'Governor: onlyGovernance'); |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d947432`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenZeppelin%2Fopenzeppelin-contracts%2Fcommit%2Fd9474327a492f9f310f31bc53f38dbea56ed9a57) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


