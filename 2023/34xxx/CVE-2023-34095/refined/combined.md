=== Content from www.openwall.com_a176491c_20250114_214352.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <b20ad75f-a368-b528-f471-aa3065483581@gmail.com>
Date: Wed, 14 Jun 2023 18:53:40 +0200
From: Till Kamppeter <till.kamppeter@...il.com>
To: oss-security@...ts.openwall.com
Subject: CVE-2023-34095: cpdb-libs: Buffer overflows via scanf

Following bug got reported to OpenPrinting's GitHub, repo cpdb-libs, as
a private (security) issue report, which is now published:

<https://github.com/OpenPrinting/cpdb-libs/security/advisories/GHSA-25j7-9gfc-f46x>

Summary

There's multiple instances of buffer overflows in this package via
improper use of scanf(3).

Details

cpdb-libs/tools/cpdb-text-frontend.c

Line 362 in 85555fb

   else if (strcmp(buf, "print-file") == 0)

              char printer_id[BUFSIZE], backend_name[BUFSIZE],
file_path[BUFSIZE];
              scanf("%s%s%s", file_path, printer_id, backend_name);

cpdb-libs/tools/cpdb-text-frontend.c

Line 453 in 85555fb

   else if (strcmp(buf, "get-all-translations") == 0)

              char printer_id[BUFSIZE];
              char backend_name[BUFSIZE];
              scanf("%s%s", printer_id, backend_name);

cpdb-libs/cpdb/cpdb-frontend.c

Line 372 in 85555fb

   PrintBackend *cpdbCreateBackendFromFile(GDBusConnection *connection,

      char obj_path[CPDB_BSIZE];
      /* ... */
      if ((file = fopen(path, "r")) == NULL)
      /* ... */
      if (fscanf(file, "%s", obj_path) == 0)

%s does not place bounds on the allowed input sizes.

All scanf() or fscanf() calls in the cpdb-libs package which take
strings via %s format conversion directive read these strings into
buffers of 1024 characters of length (BUFSIZE). So one can easily
replace all occurences of %s by %1023s (accept a maximum of 1023
characters to leave space for terminating zero byte) in all lines
containing scanf or fscanf, easily automated by running four times the
command

perl -p -i -e 's/(scanf\(.*?".*?)%s/\1%1023s/' cpdb/cpdb-frontend.c
tools/cpdb-text-frontend.c

and checking with

grep scanf */*.c

Quick test/reproducer:

Run

cpdb-text-frontend

and enter a command line (no valid command required, only arbitrary
characters) of more than 1024 characters. without the fix you will get a
segfault, with the fix no segfault and the overlength of the input gets
truncated.

To test the fix in the libraries (not in cpdb-text-backend) you would
need to create a file named /tmp/org.openprinting.Backend.CUPS with its
first line having more than 1024 characters. Then run

CPDB_DEBUG_LOGFILE=log.txt CPDB_DEBUG_LEVEL=debug
CPDB_BACKEND_INFO_DIR=/tmp cpdb-text-frontend

With the original libcpdb-frontend.so.2.0.0 you will get a segmentation
fault, with the fix you will reach the command prompt of the text
frontend (but without printer list).

The report got assigned CVE-2023-34095

The fix is committed to the GIT repository of cpdb-libs:

<https://github.com/OpenPrinting/cpdb-libs/commit/f181bd1f1>

Package maintainers/security teams of the operating system
distributions, please apply the fix by then.

The fix will be included in the upcoming releases.

    Till

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_99586ecf_20250114_214356.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Fcpdb%2Fcpdb-frontend.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Fcpdb%2Fcpdb-frontend.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcpdb-libs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cpdb-libs](/OpenPrinting/cpdb-libs)**
Public

forked from [NilanjanaLodh/OpenPrinting\_CPD\_Libraries](/NilanjanaLodh/OpenPrinting_CPD_Libraries)

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcpdb-libs) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)
* [Star
   5](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)

* [Code](/OpenPrinting/cpdb-libs)
* [Issues
  0](/OpenPrinting/cpdb-libs/issues)
* [Pull requests
  0](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects
  0](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

Additional navigation options

* [Code](/OpenPrinting/cpdb-libs)
* [Issues](/OpenPrinting/cpdb-libs/issues)
* [Pull requests](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

## Files

 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[cpdb](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb)
/
# cpdb-frontend.c

Copy path Blame  Blame
## Latest commit

## History

[History](/OpenPrinting/cpdb-libs/commits/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb/cpdb-frontend.c)2113 lines (1831 loc) · 67.8 KB 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[cpdb](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb)
/
# cpdb-frontend.c

Top
## File metadata and controls

* Code
* Blame

2113 lines (1831 loc) · 67.8 KB[Raw](https://github.com/OpenPrinting/cpdb-libs/raw/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb/cpdb-frontend.c)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000#include "cpdb-frontend.h"
static void on\_printer\_added (GDBusConnection \* connection, const gchar \* sender\_name, const gchar \* object\_path, const gchar \* interface\_name, const gchar \* signal\_name, GVariant \* parameters, gpointer user\_data);static void on\_printer\_removed (GDBusConnection \* connection, const gchar \* sender\_name, const gchar \* object\_path, const gchar \* interface\_name, const gchar \* signal\_name, GVariant \* parameters, gpointer user\_data);static void on\_printer\_state\_changed (GDBusConnection \* connection, const gchar \* sender\_name, const gchar \* object\_path, const gchar \* interface\_name, const gchar \* signal\_name, GVariant \* parameters, gpointer user\_data);
static void on\_name\_acquired (GDBusConnection \* connection, const gchar \* name, gpointer user\_data);static void on\_name\_lost (GDBusConnection \* connection, const gchar \* name, gpointer user\_data);
static void fetchPrinterListFromBackend (cpdb\_frontend\_obj\_t \* frontend\_obj, const char \* backend); static void cpdbActivateBackends (cpdb\_frontend\_obj\_t \* frontend\_obj);
static GList \* cpdbLoadDefaultPrinters (const char \* path);
static int cpdbSetDefaultPrinter (const char \* path, cpdb\_printer\_obj\_t \* printer\_obj);
static void cpdbFillBasicOptions (cpdb\_printer\_obj\_t \* printer\_obj, GVariant \* variant);
static void cpdbDeleteTranslations (cpdb\_printer\_obj\_t \* printer\_obj);
static void cpdbUnpackOptions (int num\_options, GVariant \* var, int num\_media, GVariant \* media\_var, cpdb\_options\_t \* options);static void cpdbUnpackJobArray (GVariant \* var, int num\_jobs, cpdb\_job\_t \* jobs, char \* backend\_name);static GHashTable \* cpdbUnpackTranslations (GVariant \* translations);
/\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ cpdb\_frontend\_obj\_t \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
\*\*/
cpdb\_frontend\_obj\_t \*cpdbGetNewFrontendObj(const char \*instance\_name, cpdb\_printer\_callback printer\_cb){ cpdb\_frontend\_obj\_t \*f = g\_new0(cpdb\_frontend\_obj\_t, 1);  f->skeleton = print\_frontend\_skeleton\_new(); f->connection = NULL; f->own\_id = 0; f->name\_done = FALSE; if (instance\_name == NULL) f->bus\_name = cpdbGetStringCopy(CPDB\_DIALOG\_BUS\_NAME); else f->bus\_name = cpdbConcat(CPDB\_DIALOG\_BUS\_NAME, instance\_name); f->printer\_cb = printer\_cb; f->num\_backends = 0; f->backend = g\_hash\_table\_new\_full(g\_str\_hash, g\_str\_equal, free, g\_object\_unref); f->num\_printers = 0; f->printer = g\_hash\_table\_new\_full(g\_str\_hash, g\_str\_equal, free, NULL); f->last\_saved\_settings = cpdbReadSettingsFromDisk(); return f;}
void cpdbDeleteFrontendObj(cpdb\_frontend\_obj\_t \*f){ if (f == NULL) return; logdebug("Deleting frontend obj %s\n", f->bus\_name);
 cpdbDisconnectFromDBus(f);
 if (f->skeleton) g\_object\_unref(f->skeleton); if (f->bus\_name) free(f->bus\_name); if (f->backend) g\_hash\_table\_destroy(f->backend); if (f->printer) g\_hash\_table\_destroy(f->printer); if (f->last\_saved\_settings) cpdbDeleteSettings(f->last\_saved\_settings);  free(f);}
static void on\_printer\_added(GDBusConnection \*connection, const gchar \*sender\_name, const gchar \*object\_path, const gchar \*interface\_name, const gchar \*signal\_name, GVariant \*parameters, gpointer user\_data){ cpdb\_frontend\_obj\_t \*f = (cpdb\_frontend\_obj\_t \*)user\_data; cpdb\_printer\_obj\_t \*p = cpdbGetNewPrinterObj();  /\* If some previously saved settings were retrieved,  \* use them in this new cpdb\_printer\_obj\_t \*/ if (f->last\_saved\_settings != NULL) { cpdbCopySettings(f->last\_saved\_settings, p->settings); } cpdbFillBasicOptions(p, parameters); cpdbAddPrinter(f, p); f->printer\_cb(f, p, CPDB\_CHANGE\_PRINTER\_ADDED);}
static void on\_printer\_removed(GDBusConnection \*connection, const gchar \*sender\_name, const gchar \*object\_path, const gchar \*interface\_name, const gchar \*signal\_name, GVariant \*parameters, gpointer user\_data){ cpdb\_frontend\_obj\_t \*f = (cpdb\_frontend\_obj\_t \*)user\_data; char \*printer\_id; char \*backend\_name;  g\_variant\_get(parameters, "(ss)", &printer\_id, &backend\_name); cpdb\_printer\_obj\_t \*p = cpdbRemovePrinter(f, printer\_id, backend\_name); f->printer\_cb(f, p, CPDB\_CHANGE\_PRINTER\_REMOVED);}
static void on\_printer\_state\_changed(GDBusConnection \*connection, const gchar \*sender\_name, const gchar \*object\_path, const gchar \*interface\_name, const gchar \*signal\_name, GVariant \*parameters, gpointer user\_data){ cpdb\_frontend\_obj\_t \*f = (cpdb\_frontend\_obj\_t \*) user\_data; gboolean printer\_is\_accepting\_jobs; char \*printer\_id, \*printer\_state, \*backend\_name;
 g\_variant\_get(parameters, "(ssbs)", &printer\_id, &printer\_state, &printer\_is\_accepting\_jobs, &backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (p->state) free(p->state); p->state = cpdbGetStringCopy(printer\_state); p->accepting\_jobs = printer\_is\_accepting\_jobs; f->printer\_cb(f, p, CPDB\_CHANGE\_PRINTER\_STATE\_CHANGED);}
static void on\_name\_acquired(GDBusConnection \*connection, const gchar \*name, gpointer user\_data){ GError \*error = NULL; cpdb\_frontend\_obj\_t \*f = user\_data;
 logdebug("Acquired bus name %s\n", name);  g\_dbus\_connection\_signal\_subscribe(connection, NULL, //Sender name "org.openprinting.PrintBackend", //Sender interface CPDB\_SIGNAL\_PRINTER\_ADDED, //Signal name NULL, /\*\*match on all object paths\*\*/ NULL, /\*\*match on all arguments\*\*/ 0, //Flags on\_printer\_added, //callback user\_data, //user\_data NULL);
 g\_dbus\_connection\_signal\_subscribe(connection, NULL, //Sender name "org.openprinting.PrintBackend", //Sender interface CPDB\_SIGNAL\_PRINTER\_REMOVED, //Signal name NULL, /\*\*match on all object paths\*\*/ NULL, /\*\*match on all arguments\*\*/ 0, //Flags on\_printer\_removed, //callback user\_data, //user\_data NULL); g\_dbus\_connection\_signal\_subscribe(connection, NULL, //Sender name "org.openprinting.PrintBackend", //Sender interface CPDB\_SIGNAL\_PRINTER\_STATE\_CHANGED, //Signal name NULL, /\*\*match on all object paths\*\*/ NULL, /\*\*match on all arguments\*\*/ 0, //Flags on\_printer\_state\_changed, //callback user\_data, //user\_data NULL);
 g\_dbus\_interface\_skeleton\_export(G\_DBUS\_INTERFACE\_SKELETON(f->skeleton), connection,  CPDB\_DIALOG\_OBJ\_PATH, &error); if (error) { logerror("Error exporting frontend interface : %s\n", error->message); return; }  cpdbActivateBackends(f); f->name\_done = TRUE;}
static void on\_name\_lost(GDBusConnection \*connection, const gchar \*name, gpointer user\_data){ logdebug("Lost bus name %s\n", name); cpdb\_frontend\_obj\_t \*f = user\_data; f->name\_done = TRUE;}
static GDBusConnection \*get\_dbus\_connection(){ gchar \*bus\_addr; GError \*error = NULL; GDBusConnection \*connection;  bus\_addr = g\_dbus\_address\_get\_for\_bus\_sync(G\_BUS\_TYPE\_SESSION, NULL, &error);  connection = g\_dbus\_connection\_new\_for\_address\_sync(bus\_addr, G\_DBUS\_CONNECTION\_FLAGS\_AUTHENTICATION\_CLIENT | G\_DBUS\_CONNECTION\_FLAGS\_MESSAGE\_BUS\_CONNECTION, NULL, NULL, &error); if (error) { logerror("Error acquiring bus connection : %s\n", error->message); return NULL; } logdebug("Acquired bus connection\n"); return connection;}
void cpdbConnectToDBus(cpdb\_frontend\_obj\_t \*f){ GMainContext \*context;
 if ((f->connection = get\_dbus\_connection()) == NULL) { loginfo("Couldn't connect to DBus\n"); return; }  f->own\_id = g\_bus\_own\_name\_on\_connection(f->connection, f->bus\_name, 0, on\_name\_acquired, on\_name\_lost, f, NULL);
 // Wait till either of name acquired/lost callbacks finish context = g\_main\_context\_get\_thread\_default(); while (!f->name\_done) { g\_main\_context\_iteration(context, TRUE); }}
void cpdbDisconnectFromDBus(cpdb\_frontend\_obj\_t \*f){ if (f->connection == NULL || g\_dbus\_connection\_is\_closed(f->connection)) { logwarn("Already disconnected from DBus\n"); return; }  print\_frontend\_emit\_stop\_listing(f->skeleton); g\_dbus\_connection\_flush\_sync(f->connection, NULL, NULL);  g\_bus\_unown\_name(f->own\_id); g\_dbus\_connection\_close\_sync(f->connection, NULL, NULL);}
static void fetchPrinterListFromBackend(cpdb\_frontend\_obj\_t \*f, const char \*backend){ int num\_printers; GVariantIter iter; GVariant \*printers, \*printer; PrintBackend \*proxy; GError \*error = NULL; cpdb\_printer\_obj\_t \*p;
 if ((proxy = g\_hash\_table\_lookup(f->backend, backend)) == NULL) { logerror("Couldn't get %s proxy object\n", backend); return; } print\_backend\_call\_get\_printer\_list\_sync (proxy, &num\_printers, &printers, NULL, &error); if (error) { logerror("Error getting %s printer list : %s\n", backend, error->message); return; } logdebug("Fetched %d printers from backend %s\n", num\_printers, backend); g\_variant\_iter\_init(&iter, printers); while (g\_variant\_iter\_loop(&iter, "(v)", &printer)) { p = cpdbGetNewPrinterObj(); cpdbFillBasicOptions(p, printer); if (f->last\_saved\_settings != NULL) cpdbCopySettings(f->last\_saved\_settings, p->settings); cpdbAddPrinter(f, p); }}
static void cpdbActivateBackends(cpdb\_frontend\_obj\_t \*f){ DIR \*d; int len; const char \*info\_dir\_name; struct dirent \*dir; PrintBackend \*proxy; char \*backend\_suffix;
 logdebug("Activating backends\n"); if ((info\_dir\_name = getenv("CPDB\_BACKEND\_INFO\_DIR")) == NULL) info\_dir\_name = CPDB\_BACKEND\_INFO\_DIR; if ((d = opendir(info\_dir\_name)) == NULL) { logerror("Couldn't open backend info directory : %s\n", info\_dir\_name); return; } len = strlen(CPDB\_BACKEND\_PREFIX);
 while ((dir = readdir (d)) != NULL) { if (strncmp(CPDB\_BACKEND\_PREFIX, dir->d\_name, len) == 0) { backend\_suffix = cpdbGetStringCopy((dir->d\_name) + len); loginfo("Found backend %s\n", backend\_suffix); proxy = cpdbCreateBackendFromFile(f->connection, dir->d\_name); g\_hash\_table\_insert(f->backend, backend\_suffix, proxy); f->num\_backends++; fetchPrinterListFromBackend(f, backend\_suffix); } } closedir(d);}
PrintBackend \*cpdbCreateBackendFromFile(GDBusConnection \*connection, const char \*backend\_file\_name){ FILE \*file = NULL; PrintBackend \*proxy; GError \*error = NULL; char \*path, \*backend\_name; const char \*info\_dir\_name; char obj\_path[CPDB\_BSIZE];  backend\_name = cpdbGetStringCopy(backend\_file\_name); if ((info\_dir\_name = getenv("CPDB\_BACKEND\_INFO\_DIR")) == NULL) info\_dir\_name = CPDB\_BACKEND\_INFO\_DIR; path = cpdbConcatPath(info\_dir\_name, backend\_file\_name);  if ((file = fopen(path, "r")) == NULL) { logerror("Error creating backend %s : Couldn't open %s for reading\n", backend\_name, path); free(path); return NULL; } if (fscanf(file, "%s", obj\_path) == 0) { logerror("Error creating backend %s : Couldn't parse %s\n", backend\_name, path); free(path); fclose(file); return NULL; } free(path); fclose(file);  proxy = print\_backend\_proxy\_new\_sync(connection, 0, backend\_name, obj\_path, NULL, &error); if (error) { logerror("Error creating backend proxy for %s : %s\n", backend\_name, error->message); return NULL; }  return proxy;}
void cpdbIgnoreLastSavedSettings(cpdb\_frontend\_obj\_t \*f){ loginfo("Ignoring previous settings\n"); cpdbDeleteSettings(f->last\_saved\_settings); f->last\_saved\_settings = NULL;}
gboolean cpdbAddPrinter(cpdb\_frontend\_obj\_t \*f,  cpdb\_printer\_obj\_t \*p){ p->backend\_proxy = g\_hash\_table\_lookup(f->backend, p->backend\_name); if (p->backend\_proxy == NULL) { logerror("Couldn't add printer %s : Backend doesn't exist %s\n", p->id, p->backend\_name); return FALSE; } g\_object\_ref(p->backend\_proxy);
 loginfo("Adding printer %s %s\n", p->id, p->backend\_name); cpdbDebugPrinter(p); g\_hash\_table\_insert(f->printer, cpdbConcatSep(p->id, p->backend\_name), p); f->num\_printers++;
 return TRUE;}
cpdb\_printer\_obj\_t \*cpdbRemovePrinter(cpdb\_frontend\_obj\_t \*f, const char \*printer\_id, const char \*backend\_name){ char \*key; cpdb\_printer\_obj\_t \*p = NULL;
 loginfo("Removing printer %s %s\n", printer\_id, backend\_name); key = cpdbConcatSep(printer\_id, backend\_name); if (g\_hash\_table\_contains(f->printer, key)) { p = cpdbFindPrinterObj(f, printer\_id, backend\_name); g\_hash\_table\_remove(f->printer, key); f->num\_printers--; } else { logwarn("Printer %s %s not found\n", printer\_id, backend\_name); }  free(key); return p;}
void cpdbHideRemotePrinters(cpdb\_frontend\_obj\_t \*f){ loginfo("Hiding remote printers\n"); print\_frontend\_emit\_hide\_remote\_printers(f->skeleton);}
void cpdbUnhideRemotePrinters(cpdb\_frontend\_obj\_t \*f){ loginfo("Unhiding remote printers\n"); print\_frontend\_emit\_unhide\_remote\_printers(f->skeleton);}
void cpdbHideTemporaryPrinters(cpdb\_frontend\_obj\_t \*f){ loginfo("Hiding temporary printers\n"); print\_frontend\_emit\_hide\_temporary\_printers(f->skeleton);}
void cpdbUnhideTemporaryPrinters(cpdb\_frontend\_obj\_t \*f){ loginfo("Unhiding temporary printers\n"); print\_frontend\_emit\_unhide\_temporary\_printers(f->skeleton);}
cpdb\_printer\_obj\_t \*cpdbFindPrinterObj(cpdb\_frontend\_obj\_t \*f, const char \*printer\_id, const char \*backend\_name){ char \*hashtable\_key; cpdb\_printer\_obj\_t \*p;
 if (printer\_id == NULL || backend\_name == NULL) { logwarn("Invalid parameters: cpdbFindPrinterObj()\n"); return NULL; }
 hashtable\_key = cpdbConcatSep(printer\_id, backend\_name); p = g\_hash\_table\_lookup(f->printer, hashtable\_key); if (p == NULL) { logwarn("Couldn't find printer %s %s : Doesn't exist\n", printer\_id, backend\_name); }
 free(hashtable\_key); return p;}
cpdb\_printer\_obj\_t \*cpdbGetDefaultPrinterForBackend(cpdb\_frontend\_obj\_t \*f, const char \*backend\_name){ char \*def; GError \*error = NULL; PrintBackend \*proxy; cpdb\_printer\_obj\_t \*p = NULL;  proxy = g\_hash\_table\_lookup(f->backend, backend\_name); if (proxy == NULL) { logwarn("Couldn't find backend proxy for %s\n", backend\_name); proxy = cpdbCreateBackendFromFile(f->connection, backend\_name); if (proxy == NULL) { logerror("Error getting default printer for backend : Couldn't get backend proxy\n"); return NULL; } }
 print\_backend\_call\_get\_default\_printer\_sync(proxy, &def, NULL, &error); if (error) { logerror("Error getting default printer for backend : %s\n", error->message); return NULL; }  p = cpdbFindPrinterObj(f, def, backend\_name); if (p) logdebug("Obtained default printer %s for backend %s\n", p->id, backend\_name); return p;}
GList \*cpdbLoadDefaultPrinters(const char \*path){ FILE \*fp; char buf[CPDB\_BSIZE]; GList \*printers = NULL;
 if ((fp = fopen(path, "r")) == NULL) { logwarn("Error loading default printers : Couldn't open %s for reading\n", path); return NULL; }
 while (fgets(buf, sizeof(buf), fp) != NULL) { buf[strcspn(buf, "\r\n")] = 0; printers = g\_list\_prepend(printers, cpdbGetStringCopy(buf)); } printers = g\_list\_reverse(printers); logdebug("Loaded default printers from %s\n", path);
 fclose(fp); return printers;}
cpdb\_printer\_obj\_t \*cpdbGetDefaultPrinter(cpdb\_frontend\_obj\_t \*f){  gpointer key, value; GHashTableIter iter; char \*conf\_dir, \*path, \*printer\_id, \*backend\_name; cpdb\_printer\_obj\_t \*default\_printer = NULL; GList \*printer, \*user\_printers, \*system\_printers, \*printers = NULL;
 if (f->num\_printers == 0 || f->num\_backends == 0) { logwarn("Couldn't get default printer : No printers found\n"); return NULL; }  /\*\* Find a default printer from user config first, \* before trying system wide config \*\*/ conf\_dir = cpdbGetUserConfDir(); if (conf\_dir) { path = cpdbConcatPath(conf\_dir, CPDB\_DEFAULT\_PRINTERS\_FILE); printers = g\_list\_concat(printers, cpdbLoadDefaultPrinters(path)); free(path); free(conf\_dir); } conf\_dir = cpdbGetSysConfDir(); if (conf\_dir) { path = cpdbConcatPath(conf\_dir, CPDB\_DEFAULT\_PRINTERS\_FILE); printers = g\_list\_concat(printers, cpdbLoadDefaultPrinters(path)); free(path); free(conf\_dir); }  for (printer = printers; printer != NULL; printer = printer->next) { printer\_id = strtok(printer->data, "#");  backend\_name = strtok(NULL, "\n");
 default\_printer = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (default\_printer) { g\_list\_free\_full(printers, free); goto found; } } if (printers) g\_list\_free\_full(printers, free);
 logdebug("Couldn't find a valid default printer from config files\n");
 /\*\* Fallback to default CUPS printer if CUPS backend exists \*\*/ default\_printer = cpdbGetDefaultPrinterForBackend(f, "CUPS"); if (default\_printer) goto found; logdebug("Couldn't find a valid default CUPS printer\n");  /\*\* Fallback to default FILE printer if FILE backend exists \*\*/ default\_printer = cpdbGetDefaultPrinterForBackend(f, "FILE"); if (default\_printer) goto found; logdebug("Couldn't find a valid default FILE printer\n");  /\*\* Fallback to the default printer of first backend found \*\*/ g\_hash\_table\_iter\_init(&iter, f->backend); g\_hash\_table\_iter\_next(&iter, &key, &value);
 backend\_name = (char \*) key; default\_printer = cpdbGetDefaultPrinterForBackend(f, backend\_name); if (default\_printer) goto found; logdebug("Couldn't find a valid default %s printer\n", backend\_name);  /\*\* Fallback to first printer found \*\*/ g\_hash\_table\_iter\_init(&iter, f->printer); g\_hash\_table\_iter\_next(&iter, &key, &value); default\_printer = (cpdb\_printer\_obj\_t \*) value; if (!default\_printer) { logerror("Couldn't find a valid printer\n"); return NULL; }
found: logdebug("Found default printer %s %s\n", default\_printer->id, default\_printer->backend\_name); return default\_printer;}
int cpdbSetDefaultPrinter(const char \*path, cpdb\_printer\_obj\_t \*p){ FILE \*fp; char \*printer\_data; GList \*printer, \*next, \*printers;  printers = cpdbLoadDefaultPrinters(path); printer\_data = cpdbConcatSep(p->id, p->backend\_name);  if ((fp = fopen(path, "w")) == NULL) { logerror("Error setting default printer : Couldn't open %s for writing\n", path); return 0; }
 /\* Delete duplicate entries \*/ printer = printers; while (printer != NULL) { next = printer->next; if (strcmp(printer->data, printer\_data) == 0) { free(printer->data); printers = g\_list\_delete\_link(printers, printer); }
 printer = next; }
 printers = g\_list\_prepend(printers, printer\_data); for (printer = printers; printer != NULL; printer = printer->next) { fprintf(fp, "%s\n", (char \*)printer->data); } g\_list\_free\_full(printers, free); loginfo("Saved default printers to %s", path);
 fclose(fp); return 1;}
int cpdbSetUserDefaultPrinter(cpdb\_printer\_obj\_t \*p){ int ret; char \*conf\_dir, \*path;
 if ((conf\_dir = cpdbGetUserConfDir()) == NULL) { logerror("Error setting default printer : Couldn't get system config dir\n"); return 0; } path = cpdbConcatPath(conf\_dir, CPDB\_DEFAULT\_PRINTERS\_FILE); ret = cpdbSetDefaultPrinter(path, p);
 free(path); free(conf\_dir); return ret;}
int cpdbSetSystemDefaultPrinter(cpdb\_printer\_obj\_t \*p){ int ret; char \*conf\_dir, \*path;
 if ((conf\_dir = cpdbGetSysConfDir()) == NULL) { logerror("Error setting default printer : Couldn't get system config dir\n"); return 0; } path = cpdbConcatPath(conf\_dir, CPDB\_DEFAULT\_PRINTERS\_FILE); ret = cpdbSetDefaultPrinter(path, p);
 free(path); free(conf\_dir); return ret;}
int cpdbGetAllJobs(cpdb\_frontend\_obj\_t \*f, cpdb\_job\_t \*\*j, gboolean active\_only){  /\*\*inititalizing the arrays required for each of the backends \*\*/  /\*\* num\_jobs[] stores the number of jobs for each of the backends\*\*/ int \*num\_jobs = g\_new(int, f->num\_backends);  /\*\*backend\_names[] stores the name for each of the backends\*\*/ char \*\*backend\_names = g\_new0(char \*, f->num\_backends);  /\*\*retval[] stores the gvariant returned by the respective backend \*\*/ GVariant \*\*retval = g\_new(GVariant \*, f->num\_backends);  GError \*error = NULL; gpointer key, value; GHashTableIter iter; int i = 0, total\_jobs = 0;  /\*\* Iterating over all the backends and getting each's active jobs\*\*/ g\_hash\_table\_iter\_init(&iter, f->backend); while (g\_hash\_table\_iter\_next(&iter, &key, &value)) { PrintBackend \*proxy = (PrintBackend \*)value;  backend\_names[i] = (char \*)key; print\_backend\_call\_get\_all\_jobs\_sync(proxy, active\_only, &(num\_jobs[i]), &(retval[i]), NULL, &error);  if(error) { logerror("Error gettings jobs for backend %s : %s\n", backend\_names[i], error->message); num\_jobs[i] = 0;  } else { logdebug("Obtained %d jobs for backend %s\n", num\_jobs[i], backend\_names[i]); }  total\_jobs += num\_jobs[i]; i++; /\*\* off to the next backend \*\*/ }  int n = 0; cpdb\_job\_t \*jobs = g\_new(cpdb\_job\_t, total\_jobs); for (i = 0; i < f->num\_backends; i++) { if(num\_jobs[i]) { cpdbUnpackJobArray(retval[i], num\_jobs[i], jobs + n, backend\_names[i]); } n += num\_jobs[i]; } \*j = jobs;
 free(num\_jobs); return total\_jobs;}
/\*\*\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_ cpdb\_printer\_obj\_t \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\*\*/
cpdb\_printer\_obj\_t \*cpdbGetNewPrinterObj(){ cpdb\_printer\_obj\_t \*p = g\_new0 (cpdb\_printer\_obj\_t, 1); p->options = NULL; p->settings = cpdbGetNewSettings(); return p;}
static void cpdbDeleteTranslations(cpdb\_printer\_obj\_t \*p){ g\_free(p->locale); if (p->translations) g\_hash\_table\_destroy(p->translations);
 p->locale = NULL; p->translations = NULL;}
void cpdbDeletePrinterObj(cpdb\_printer\_obj\_t \*p){ if (p == NULL) return;  logdebug("Deleting printer object %s\n", p->id); if (p->backend\_name) free(p->backend\_name); if (p->backend\_proxy) g\_object\_unref(p->backend\_proxy); if (p->options) cpdbDeleteOptions(p->options); if (p->settings) cpdbDeleteSettings(p->settings); cpdbDeleteTranslations(p);  free(p);}
void cpdbFillBasicOptions(cpdb\_printer\_obj\_t \*p, GVariant \*gv){ g\_variant\_get(gv, CPDB\_PRINTER\_ADDED\_ARGS, &(p->id), &(p->name), &(p->info), &(p->location), &(p->make\_and\_model), &(p->accepting\_jobs), &(p->state), &(p->backend\_name));}
void cpdbDebugPrinter(const cpdb\_printer\_obj\_t \*p){ logdebug("-------------------------\n"); logdebug("Printer %s\n", p->id); logdebug("name: %s\n", p->name); logdebug("location: %s\n", p->location); logdebug("info: %s\n", p->info); logdebug("make and model: %s\n", p->make\_and\_model); logdebug("accepting jobs? %s\n", (p->accepting\_jobs ? "yes" : "no")); logdebug("state: %s\n", p->state); logdebug("backend: %s\n", p->backend\_name); logdebug("-------------------------\n\n");}
gboolean cpdbIsAcceptingJobs(cpdb\_printer\_obj\_t \*p){ GError \*error = NULL;  print\_backend\_call\_is\_accepting\_jobs\_sync(p->backend\_proxy, p->id, &p->accepting\_jobs, NULL, &error); if (error) { logerror("Error getting accepting\_jobs status for %s %s : %s\n", p->id, p->backend\_name, error->message); return FALSE; }
 logdebug("Obtained accepting\_jobs=%d; for %s %s\n",  p->accepting\_jobs, p->id, p->backend\_name); return p->accepting\_jobs;}
char \*cpdbGetState(cpdb\_printer\_obj\_t \*p){ GError \*error = NULL;  print\_backend\_call\_get\_printer\_state\_sync(p->backend\_proxy, p->id, &p->state, NULL, &error); if (error) { logerror("Error getting printer state for %s %s : %s\n", p->id, p->backend\_name, error->message); return NULL; }
 logdebug("Obtained state=%s; for %s %s\n",  p->state, p->id, p->backend\_name); return p->state;}
cpdb\_options\_t \*cpdbGetAllOptions(cpdb\_printer\_obj\_t \*p){ if (p == NULL)  { logwarn("Invalid params: cpdbGetAllOptions()\n"); return NULL; }
 /\*\*  \* If the options were previously queried,  \* return them, instead of querying again. \*/ if (p->options) return p->options;
 GError \*error = NULL; int num\_options, num\_media; GVariant \*var, \*media\_var; print\_backend\_call\_get\_all\_options\_sync(p->backend\_proxy, p->id, &num\_options, &var, &num\_media, &media\_var, NULL, &error); if (error) { logerror("Error getting printer options for %s %s : %s\n", p->id, p->backend\_name, error->message); return NULL; }
 loginfo("Obtained %d options and %d media for %s %s\n", num\_options, num\_media, p->id, p->backend\_name); p->options = cpdbGetNewOptions(); cpdbUnpackOptions(num\_options, var, num\_media, media\_var, p->options); return p->options;}
cpdb\_option\_t \*cpdbGetOption(cpdb\_printer\_obj\_t \*p, const char \*name){ if (p == NULL || name == NULL)  { logwarn("Invalid params: cpdbGetOption()\n"); return NULL; }
 cpdbGetAllOptions(p); return (cpdb\_option\_t \*)(g\_hash\_table\_lookup(p->options->table, name));}
char \*cpdbGetDefault(cpdb\_printer\_obj\_t \*p, const char \*name){ if (p == NULL || name == NULL) { logwarn("Invalid params: cpdbGetDefault()\n"); return NULL; }
 cpdb\_option\_t \*o = cpdbGetOption(p, name); if (!o) return NULL; return o->default\_value;}
char \*cpdbGetSetting(cpdb\_printer\_obj\_t \*p, const char \*name){ if (p == NULL || name == NULL) {[View remainder of file in raw view](https://github.com/OpenPrinting/cpdb-libs/raw/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb/cpdb-frontend.c)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_32d15cbb_20250114_214359.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Ftools%2Fcpdb-text-frontend.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Ftools%2Fcpdb-text-frontend.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcpdb-libs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cpdb-libs](/OpenPrinting/cpdb-libs)**
Public

forked from [NilanjanaLodh/OpenPrinting\_CPD\_Libraries](/NilanjanaLodh/OpenPrinting_CPD_Libraries)

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcpdb-libs) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)
* [Star
   5](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)

* [Code](/OpenPrinting/cpdb-libs)
* [Issues
  0](/OpenPrinting/cpdb-libs/issues)
* [Pull requests
  0](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects
  0](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

Additional navigation options

* [Code](/OpenPrinting/cpdb-libs)
* [Issues](/OpenPrinting/cpdb-libs/issues)
* [Pull requests](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

## Files

 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[tools](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/tools)
/
# cpdb-text-frontend.c

Copy path Blame  Blame
## Latest commit

## History

[History](/OpenPrinting/cpdb-libs/commits/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c)550 lines (510 loc) · 20.7 KB 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[tools](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/tools)
/
# cpdb-text-frontend.c

Top
## File metadata and controls

* Code
* Blame

550 lines (510 loc) · 20.7 KB[Raw](https://github.com/OpenPrinting/cpdb-libs/raw/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550#include <stdio.h>#include <stdlib.h>#include <string.h>#include <locale.h>
#include <glib.h>#include <libintl.h>
#include <cpdb/frontend.h>
#define BUFSIZE 1024
void display\_help();gpointer parse\_commands(gpointer user\_data);cpdb\_frontend\_obj\_t \*f;static const char \*locale;
static void printBasicOptions(const cpdb\_printer\_obj\_t \*p){ printf("-------------------------\n"); printf("Printer %s\n", p->id); printf("name: %s\n", p->name); printf("location: %s\n", p->location); printf("info: %s\n", p->info); printf("make and model: %s\n", p->make\_and\_model); printf("accepting jobs? %s\n", (p->accepting\_jobs ? "yes" : "no")); printf("state: %s\n", p->state); printf("backend: %s\n", p->backend\_name); printf("-------------------------\n\n");}
static void printMedia(const cpdb\_media\_t \*media){ printf("[+] Media: %s\n", media->name); printf(" \* width = %d\n", media->width); printf(" \* length = %d\n", media->length); printf(" --> Supported margins: %d\n", media->num\_margins); printf(" left, right, top, bottom\n"); for (int i = 0; i < media->num\_margins; i++) { printf(" \* %d, %d, %d, %d,\n", media->margins[i].left, media->margins[i].right, media->margins[i].top, media->margins[i].bottom); } printf("\n");}
static void printOption(const cpdb\_option\_t \*opt){ int i;  printf("[+] %s\n", opt->option\_name); printf(" --> GROUP: %s\n", opt->group\_name); for (i = 0; i < opt->num\_supported; i++) { printf(" \* %s\n", opt->supported\_values[i]); } printf(" --> DEFAULT: %s\n\n", opt->default\_value);}
static void printTranslations(cpdb\_printer\_obj\_t \*p){ GHashTableIter iter; gpointer key, value;
 if (p->locale == NULL || p->translations == NULL) { printf("No translations found\n"); return; }
 g\_hash\_table\_iter\_init(&iter, p->translations); while (g\_hash\_table\_iter\_next(&iter, &key, &value)) { printf("'%s' : '%s'\n", (char \*)key, (char \*)value); }}
static void displayAllPrinters(cpdb\_frontend\_obj\_t \*f){ GHashTableIter iter; gpointer key, value;
 g\_hash\_table\_iter\_init(&iter, f->printer); while (g\_hash\_table\_iter\_next(&iter, &key, &value)) { const cpdb\_printer\_obj\_t \*p = value; printBasicOptions(p); }}
static void printer\_callback(cpdb\_frontend\_obj\_t \*f, cpdb\_printer\_obj\_t \*p, cpdb\_printer\_update\_t change){ switch(change) { case CPDB\_CHANGE\_PRINTER\_ADDED: g\_message("Added printer %s : %s!\n", p->name, p->backend\_name); printBasicOptions(p); break;
 case CPDB\_CHANGE\_PRINTER\_REMOVED: g\_message("Removed printer %s : %s!\n", p->name, p->backend\_name); cpdbDeletePrinterObj(p); break;  case CPDB\_CHANGE\_PRINTER\_STATE\_CHANGED: g\_message("Printer state changed for %s : %s to \"%s\"", p->name, p->backend\_name, p->state); break; }}
static void acquire\_details\_callback(cpdb\_printer\_obj\_t \*p, int success, void \*user\_data){ if (success) g\_message("Details acquired for %s : %s\n", p->name, p->backend\_name); else g\_message("Could not acquire printer details for %s : %s\n", p->name, p->backend\_name);}
static void acquire\_translations\_callback(cpdb\_printer\_obj\_t \*p, int success, void \*user\_data){ if (!success) g\_message("Could not acquire printer translations for %s : %s\n", p->name, p->backend\_name); g\_message("Translations acquired for %s : %s\n", p->name, p->backend\_name); printTranslations(p);}
int main(int argc, char \*\*argv){ cpdb\_printer\_callback printer\_cb = (cpdb\_printer\_callback)printer\_callback;
 setlocale (LC\_ALL, ""); cpdbInit();
 locale = getenv("LANGUAGE");
 char \*dialog\_bus\_name = malloc(300); if (argc > 1) //this is for creating multiple instances of a dialog simultaneously f = cpdbGetNewFrontendObj(argv[1], printer\_cb); else f = cpdbGetNewFrontendObj(NULL, printer\_cb);
 /\*\* Uncomment the line below if you don't want to use the previously saved settings\*\*/ cpdbIgnoreLastSavedSettings(f); g\_thread\_new("parse\_commands\_thread", parse\_commands, NULL); cpdbConnectToDBus(f); displayAllPrinters(f); GMainLoop \*loop = g\_main\_loop\_new(NULL, FALSE); g\_main\_loop\_run(loop);}
gpointer parse\_commands(gpointer user\_data){ fflush(stdout); char buf[BUFSIZE]; while (1) { printf("> "); fflush(stdout); scanf("%s", buf); if (strcmp(buf, "stop") == 0) { cpdbDeleteFrontendObj(f); g\_message("Stopping front end..\n"); exit(0); } else if (strcmp(buf, "restart") == 0) { cpdbDisconnectFromDBus(f); cpdbConnectToDBus(f); } else if (strcmp(buf, "hide-remote") == 0) { cpdbHideRemotePrinters(f); g\_message("Hiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "unhide-remote") == 0) { cpdbUnhideRemotePrinters(f); g\_message("Unhiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "hide-temporary") == 0) { cpdbHideTemporaryPrinters(f); g\_message("Hiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "unhide-temporary") == 0) { cpdbUnhideTemporaryPrinters(f); g\_message("Unhiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "get-all-options") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); g\_message("Getting all attributes ..\n"); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(p == NULL) continue;
 cpdb\_options\_t \*opts = cpdbGetAllOptions(p);
 printf("Retrieved %d options.\n", opts->count); GHashTableIter iter; gpointer value;
 g\_hash\_table\_iter\_init(&iter, opts->table); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { printOption(value); } } else if (strcmp(buf, "get-all-media") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); g\_message("Getting all attributes ..\n"); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(p == NULL) continue;
 cpdb\_options\_t \*opts = cpdbGetAllOptions(p);
 printf("Retrieved %d medias.\n", opts->media\_count); GHashTableIter iter; gpointer value;
 g\_hash\_table\_iter\_init(&iter, opts->media); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { printMedia(value); } } else if (strcmp(buf, "get-default") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetDefault(p, option\_name); if (!ans) printf("cpdb\_option\_t %s doesn't exist.", option\_name); else printf("Default : %s\n", ans); } else if (strcmp(buf, "get-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], setting\_name[BUFSIZE]; scanf("%s%s%s", setting\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetSetting(p, setting\_name); if (!ans) printf("Setting %s doesn't exist.\n", setting\_name); else printf("Setting value : %s\n", ans); } else if (strcmp(buf, "get-current") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetCurrent(p, option\_name); if (!ans) printf("cpdb\_option\_t %s doesn't exist.", option\_name); else printf("Current value : %s\n", ans); } else if (strcmp(buf, "add-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE], option\_val[BUFSIZE]; scanf("%s %s %s %s", option\_name, option\_val, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s : %s\n", option\_name, option\_val); cpdbAddSettingToPrinter(p, cpdbGetStringCopy(option\_name), cpdbGetStringCopy(option\_val)); } else if (strcmp(buf, "clear-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbClearSettingFromPrinter(p, option\_name); } else if (strcmp(buf, "get-state") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetState(p)); } else if (strcmp(buf, "is-accepting-jobs") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("Accepting jobs ? : %d \n", cpdbIsAcceptingJobs(p)); } else if (strcmp(buf, "help") == 0) { display\_help(); } else if (strcmp(buf, "ping") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); print\_backend\_call\_ping\_sync(p->backend\_proxy, p->id, NULL, NULL); } else if (strcmp(buf, "get-default-printer") == 0) { cpdb\_printer\_obj\_t \*p = cpdbGetDefaultPrinter(f); if (p) printf("%s#%s\n", p->name, p->backend\_name); else printf("No default printer found\n"); } else if (strcmp(buf, "get-default-printer-for-backend") == 0) { char backend\_name[BUFSIZE]; scanf("%s", backend\_name); /\*\* \* Backend name = The last part of the backend dbus service \* Eg. "CUPS" or "GCP" \*/ cpdb\_printer\_obj\_t \*p = cpdbGetDefaultPrinterForBackend(f, backend\_name); printf("%s\n", p->name); } else if (strcmp(buf, "set-user-default-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (p) { if (cpdbSetUserDefaultPrinter(p)) printf("Set printer as user default\n"); else printf("Couldn't set printer as user default\n"); } } else if (strcmp(buf, "set-system-default-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (p) { if (cpdbSetSystemDefaultPrinter(p)) printf("Set printer as system default\n"); else printf("Couldn't set printer as system default\n"); } } else if (strcmp(buf, "print-file") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], file\_path[BUFSIZE]; scanf("%s%s%s", file\_path, printer\_id, backend\_name); /\*\* \* Try adding some settings here .. change them and experiment \*/ cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(strcmp(backend\_name, "FILE") == 0) { char final\_file\_path[BUFSIZE]; printf("Please give the final file path: "); scanf("%s", final\_file\_path); cpdbPrintFilePath(p, file\_path, final\_file\_path); continue; }
 cpdbAddSettingToPrinter(p, "copies", "3"); cpdbPrintFile(p, file\_path); } else if (strcmp(buf, "get-active-jobs-count") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%d jobs currently active.\n", cpdbGetActiveJobsCount(p)); } else if (strcmp(buf, "get-all-jobs") == 0) { int active\_only; scanf("%d", &active\_only); cpdb\_job\_t \*j; int x = cpdbGetAllJobs(f, &j, active\_only); printf("Total %d jobs\n", x); int i; for (i = 0; i < x; i++) { printf("%s .. %s .. %s .. %s .. %s\n", j[i].job\_id, j[i].title, j[i].printer\_id, j[i].state, j[i].submitted\_at); } } else if (strcmp(buf, "cancel-job") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char job\_id[BUFSIZE]; scanf("%s%s%s", job\_id, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (cpdbCancelJob(p, job\_id)) printf("cpdb\_job\_t %s has been cancelled.\n", job\_id); else printf("Unable to cancel job %s\n", job\_id); } else if (strcmp(buf, "pickle-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char job\_id[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbPicklePrinterToFile(p, "/tmp/.printer-pickle", f); } else if (strcmp(buf, "get-option-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetOptionTranslation(p, option\_name, locale)); } else if (strcmp(buf, "get-choice-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char option\_name[BUFSIZE]; char choice\_name[BUFSIZE]; scanf("%s%s%s%s", option\_name, choice\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetChoiceTranslation(p, option\_name, choice\_name, locale)); } else if (strcmp(buf, "get-group-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char group\_name[BUFSIZE]; scanf("%s%s%s", group\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetGroupTranslation(p, group\_name, locale)); } else if (strcmp(buf, "get-all-translations") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbGetAllTranslations(p, locale); printTranslations(p); } else if (strcmp(buf, "get-media-size") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char media[BUFSIZE]; int width, length; scanf("%s%s%s", media, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); int ok = cpdbGetMediaSize(p, media, &width, &length); if (ok) printf("%dx%d\n", width, length); } else if (strcmp(buf, "get-media-margins") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char media[BUFSIZE]; scanf("%s%s%s", media, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 cpdb\_margin\_t \*margins; int num\_margins = cpdbGetMediaMargins(p, media, &margins); for (int i = 0; i < num\_margins; i++) printf("%d %d %d %d\n", margins[i].left, margins[i].right, margins[i].top, margins[i].bottom); } else if (strcmp(buf, "acquire-details") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name);  cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if(p == NULL) continue;
 g\_message("Acquiring printer details asynchronously...\n"); cpdbAcquireDetails(p, acquire\_details\_callback, NULL); } else if (strcmp(buf, "acquire-translations") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name);  cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if(p == NULL) continue;
 g\_message("Acquiring printer translations asynchronously...\n"); cpdbAcquireTranslations(p, locale, acquire\_translations\_callback, NULL); } }}
void display\_help(){ g\_message("Available commands .. "); printf("%s\n", "stop"); printf("%s\n", "hide-remote"); printf("%s\n", "unhide-remote"); printf("%s\n", "hide-temporary"); printf("%s\n", "unhide-temporary"); //printf("%s\n", "ping <printer id> "); printf("%s\n", "get-default-printer"); printf("%s\n", "get-default-printer-for-backend <backend name>"); printf("%s\n", "set-user-default-printer <printer id> <backend name>"); printf("%s\n", "set-system-default-printer <printer id> <backend name>"); printf("%s\n", "print-file <file path> <printer\_id> <backend\_name>"); printf("%s\n", "get-active-jobs-count <printer-name> <backend-name>"); printf("%s\n", "get-all-jobs <0 for all jobs; 1 for only active>"); printf("%s\n", "get-state <printer id> <backend name>"); printf("%s\n", "is-accepting-jobs <printer id> <backend name(like \"CUPS\")>"); printf("%s\n", "cancel-job <job-id> <printer id> <backend name>"); printf("%s\n", "acquire-details <printer id> <backend name>"); printf("%s\n", "acquire-translations <printer id> <backend name>"); printf("%s\n", "get-all-options <printer-name> <backend-name>"); printf("%s\n", "get-default <option name> <printer id> <backend name>"); printf("%s\n", "get-setting <option name> <printer id> <backend name>"); printf("%s\n", "get-current <option name> <printer id> <backend name>"); printf("%s\n", "add-setting <option name> <option value> <printer id> <backend name>"); printf("%s\n", "clear-setting <option name> <printer id> <backend name>"); printf("%s\n", "get-media-size <media> <printer id> <backend name>"); printf("%s\n", "get-media-margins <media> <printer id> <backend name>"); printf("%s\n", "get-option-translation <option> <printer id> <backend name>"); printf("%s\n", "get-choice-translation <option> <choice> <printer id> <backend name>"); printf("%s\n", "get-group-translation <group> <printer id> <backend name>"); printf("%s\n", "get-all-translations <printer id> <backend name>"); printf("%s\n", "pickle-printer <printer id> <backend name>\n");}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3cee6399_20250114_214405.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fsecurity%2Fadvisories%2FGHSA-25j7-9gfc-f46x)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fsecurity%2Fadvisories%2FGHSA-25j7-9gfc-f46x)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcpdb-libs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cpdb-libs](/OpenPrinting/cpdb-libs)**
Public

forked from [NilanjanaLodh/OpenPrinting\_CPD\_Libraries](/NilanjanaLodh/OpenPrinting_CPD_Libraries)

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcpdb-libs) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)
* [Star
   5](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)

* [Code](/OpenPrinting/cpdb-libs)
* [Issues
  0](/OpenPrinting/cpdb-libs/issues)
* [Pull requests
  0](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects
  0](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

Additional navigation options

* [Code](/OpenPrinting/cpdb-libs)
* [Issues](/OpenPrinting/cpdb-libs/issues)
* [Pull requests](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

# buffer overflows via scanf

High

[tillkamppeter](/tillkamppeter)
published
GHSA-25j7-9gfc-f46x
Jun 14, 2023

## Package

cpdb-libs

## Affected versions

All 1.x 2.x

## Patched versions

2.0b6

## Description

### Summary

There's multiple instances of buffer overflows in this package via improper use of `scanf(3)`.

### Details

[cpdb-libs/tools/cpdb-text-frontend.c](https://github.com/OpenPrinting/cpdb-libs/blob/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c#L362)

Line 362
in
[85555fb](/OpenPrinting/cpdb-libs/commit/85555fba64d34f53a2fce099b0488904cc48ed35)

|  | else if (strcmp(buf, "print-file") == 0) |
| --- | --- |

```
            char printer_id[BUFSIZE], backend_name[BUFSIZE], file_path[BUFSIZE];
            scanf("%s%s%s", file_path, printer_id, backend_name);

```

[cpdb-libs/tools/cpdb-text-frontend.c](https://github.com/OpenPrinting/cpdb-libs/blob/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c#L453)

Line 453
in
[85555fb](/OpenPrinting/cpdb-libs/commit/85555fba64d34f53a2fce099b0488904cc48ed35)

|  | else if (strcmp(buf, "get-all-translations") == 0) |
| --- | --- |

```
            char printer_id[BUFSIZE];
            char backend_name[BUFSIZE];
            scanf("%s%s", printer_id, backend_name);

```

[cpdb-libs/cpdb/cpdb-frontend.c](https://github.com/OpenPrinting/cpdb-libs/blob/85555fba64d34f53a2fce099b0488904cc48ed35/cpdb/cpdb-frontend.c#L372)

Line 372
in
[85555fb](/OpenPrinting/cpdb-libs/commit/85555fba64d34f53a2fce099b0488904cc48ed35)

|  | PrintBackend \*cpdbCreateBackendFromFile(GDBusConnection \*connection, |
| --- | --- |

```
    char obj_path[CPDB_BSIZE];
    /* ... */
    if ((file = fopen(path, "r")) == NULL)
    /* ... */
    if (fscanf(file, "%s", obj_path) == 0)

```

`%s` does not place bounds on the allowed input sizes.

### Severity

High

### CVE ID

CVE-2023-34095

### Weaknesses

[CWE-121](/advisories?query=cwe%3A121)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b76e8873_20250114_214403.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Ftools%2Fcpdb-text-frontend.c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fblob%2F85555fba64d34f53a2fce099b0488904cc48ed35%2Ftools%2Fcpdb-text-frontend.c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=OpenPrinting%2Fcpdb-libs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cpdb-libs](/OpenPrinting/cpdb-libs)**
Public

forked from [NilanjanaLodh/OpenPrinting\_CPD\_Libraries](/NilanjanaLodh/OpenPrinting_CPD_Libraries)

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcpdb-libs) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)
* [Star
   5](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)

* [Code](/OpenPrinting/cpdb-libs)
* [Issues
  0](/OpenPrinting/cpdb-libs/issues)
* [Pull requests
  0](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects
  0](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

Additional navigation options

* [Code](/OpenPrinting/cpdb-libs)
* [Issues](/OpenPrinting/cpdb-libs/issues)
* [Pull requests](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

## Files

 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[tools](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/tools)
/
# cpdb-text-frontend.c

Copy path Blame  Blame
## Latest commit

## History

[History](/OpenPrinting/cpdb-libs/commits/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c)550 lines (510 loc) · 20.7 KB 85555fb
## Breadcrumbs

1. [cpdb-libs](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35)
2. /[tools](/OpenPrinting/cpdb-libs/tree/85555fba64d34f53a2fce099b0488904cc48ed35/tools)
/
# cpdb-text-frontend.c

Top
## File metadata and controls

* Code
* Blame

550 lines (510 loc) · 20.7 KB[Raw](https://github.com/OpenPrinting/cpdb-libs/raw/85555fba64d34f53a2fce099b0488904cc48ed35/tools/cpdb-text-frontend.c)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550#include <stdio.h>#include <stdlib.h>#include <string.h>#include <locale.h>
#include <glib.h>#include <libintl.h>
#include <cpdb/frontend.h>
#define BUFSIZE 1024
void display\_help();gpointer parse\_commands(gpointer user\_data);cpdb\_frontend\_obj\_t \*f;static const char \*locale;
static void printBasicOptions(const cpdb\_printer\_obj\_t \*p){ printf("-------------------------\n"); printf("Printer %s\n", p->id); printf("name: %s\n", p->name); printf("location: %s\n", p->location); printf("info: %s\n", p->info); printf("make and model: %s\n", p->make\_and\_model); printf("accepting jobs? %s\n", (p->accepting\_jobs ? "yes" : "no")); printf("state: %s\n", p->state); printf("backend: %s\n", p->backend\_name); printf("-------------------------\n\n");}
static void printMedia(const cpdb\_media\_t \*media){ printf("[+] Media: %s\n", media->name); printf(" \* width = %d\n", media->width); printf(" \* length = %d\n", media->length); printf(" --> Supported margins: %d\n", media->num\_margins); printf(" left, right, top, bottom\n"); for (int i = 0; i < media->num\_margins; i++) { printf(" \* %d, %d, %d, %d,\n", media->margins[i].left, media->margins[i].right, media->margins[i].top, media->margins[i].bottom); } printf("\n");}
static void printOption(const cpdb\_option\_t \*opt){ int i;  printf("[+] %s\n", opt->option\_name); printf(" --> GROUP: %s\n", opt->group\_name); for (i = 0; i < opt->num\_supported; i++) { printf(" \* %s\n", opt->supported\_values[i]); } printf(" --> DEFAULT: %s\n\n", opt->default\_value);}
static void printTranslations(cpdb\_printer\_obj\_t \*p){ GHashTableIter iter; gpointer key, value;
 if (p->locale == NULL || p->translations == NULL) { printf("No translations found\n"); return; }
 g\_hash\_table\_iter\_init(&iter, p->translations); while (g\_hash\_table\_iter\_next(&iter, &key, &value)) { printf("'%s' : '%s'\n", (char \*)key, (char \*)value); }}
static void displayAllPrinters(cpdb\_frontend\_obj\_t \*f){ GHashTableIter iter; gpointer key, value;
 g\_hash\_table\_iter\_init(&iter, f->printer); while (g\_hash\_table\_iter\_next(&iter, &key, &value)) { const cpdb\_printer\_obj\_t \*p = value; printBasicOptions(p); }}
static void printer\_callback(cpdb\_frontend\_obj\_t \*f, cpdb\_printer\_obj\_t \*p, cpdb\_printer\_update\_t change){ switch(change) { case CPDB\_CHANGE\_PRINTER\_ADDED: g\_message("Added printer %s : %s!\n", p->name, p->backend\_name); printBasicOptions(p); break;
 case CPDB\_CHANGE\_PRINTER\_REMOVED: g\_message("Removed printer %s : %s!\n", p->name, p->backend\_name); cpdbDeletePrinterObj(p); break;  case CPDB\_CHANGE\_PRINTER\_STATE\_CHANGED: g\_message("Printer state changed for %s : %s to \"%s\"", p->name, p->backend\_name, p->state); break; }}
static void acquire\_details\_callback(cpdb\_printer\_obj\_t \*p, int success, void \*user\_data){ if (success) g\_message("Details acquired for %s : %s\n", p->name, p->backend\_name); else g\_message("Could not acquire printer details for %s : %s\n", p->name, p->backend\_name);}
static void acquire\_translations\_callback(cpdb\_printer\_obj\_t \*p, int success, void \*user\_data){ if (!success) g\_message("Could not acquire printer translations for %s : %s\n", p->name, p->backend\_name); g\_message("Translations acquired for %s : %s\n", p->name, p->backend\_name); printTranslations(p);}
int main(int argc, char \*\*argv){ cpdb\_printer\_callback printer\_cb = (cpdb\_printer\_callback)printer\_callback;
 setlocale (LC\_ALL, ""); cpdbInit();
 locale = getenv("LANGUAGE");
 char \*dialog\_bus\_name = malloc(300); if (argc > 1) //this is for creating multiple instances of a dialog simultaneously f = cpdbGetNewFrontendObj(argv[1], printer\_cb); else f = cpdbGetNewFrontendObj(NULL, printer\_cb);
 /\*\* Uncomment the line below if you don't want to use the previously saved settings\*\*/ cpdbIgnoreLastSavedSettings(f); g\_thread\_new("parse\_commands\_thread", parse\_commands, NULL); cpdbConnectToDBus(f); displayAllPrinters(f); GMainLoop \*loop = g\_main\_loop\_new(NULL, FALSE); g\_main\_loop\_run(loop);}
gpointer parse\_commands(gpointer user\_data){ fflush(stdout); char buf[BUFSIZE]; while (1) { printf("> "); fflush(stdout); scanf("%s", buf); if (strcmp(buf, "stop") == 0) { cpdbDeleteFrontendObj(f); g\_message("Stopping front end..\n"); exit(0); } else if (strcmp(buf, "restart") == 0) { cpdbDisconnectFromDBus(f); cpdbConnectToDBus(f); } else if (strcmp(buf, "hide-remote") == 0) { cpdbHideRemotePrinters(f); g\_message("Hiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "unhide-remote") == 0) { cpdbUnhideRemotePrinters(f); g\_message("Unhiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "hide-temporary") == 0) { cpdbHideTemporaryPrinters(f); g\_message("Hiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "unhide-temporary") == 0) { cpdbUnhideTemporaryPrinters(f); g\_message("Unhiding remote printers discovered by the backend..\n"); } else if (strcmp(buf, "get-all-options") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); g\_message("Getting all attributes ..\n"); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(p == NULL) continue;
 cpdb\_options\_t \*opts = cpdbGetAllOptions(p);
 printf("Retrieved %d options.\n", opts->count); GHashTableIter iter; gpointer value;
 g\_hash\_table\_iter\_init(&iter, opts->table); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { printOption(value); } } else if (strcmp(buf, "get-all-media") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); g\_message("Getting all attributes ..\n"); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(p == NULL) continue;
 cpdb\_options\_t \*opts = cpdbGetAllOptions(p);
 printf("Retrieved %d medias.\n", opts->media\_count); GHashTableIter iter; gpointer value;
 g\_hash\_table\_iter\_init(&iter, opts->media); while (g\_hash\_table\_iter\_next(&iter, NULL, &value)) { printMedia(value); } } else if (strcmp(buf, "get-default") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetDefault(p, option\_name); if (!ans) printf("cpdb\_option\_t %s doesn't exist.", option\_name); else printf("Default : %s\n", ans); } else if (strcmp(buf, "get-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], setting\_name[BUFSIZE]; scanf("%s%s%s", setting\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetSetting(p, setting\_name); if (!ans) printf("Setting %s doesn't exist.\n", setting\_name); else printf("Setting value : %s\n", ans); } else if (strcmp(buf, "get-current") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); char \*ans = cpdbGetCurrent(p, option\_name); if (!ans) printf("cpdb\_option\_t %s doesn't exist.", option\_name); else printf("Current value : %s\n", ans); } else if (strcmp(buf, "add-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE], option\_val[BUFSIZE]; scanf("%s %s %s %s", option\_name, option\_val, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s : %s\n", option\_name, option\_val); cpdbAddSettingToPrinter(p, cpdbGetStringCopy(option\_name), cpdbGetStringCopy(option\_val)); } else if (strcmp(buf, "clear-setting") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbClearSettingFromPrinter(p, option\_name); } else if (strcmp(buf, "get-state") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetState(p)); } else if (strcmp(buf, "is-accepting-jobs") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("Accepting jobs ? : %d \n", cpdbIsAcceptingJobs(p)); } else if (strcmp(buf, "help") == 0) { display\_help(); } else if (strcmp(buf, "ping") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); print\_backend\_call\_ping\_sync(p->backend\_proxy, p->id, NULL, NULL); } else if (strcmp(buf, "get-default-printer") == 0) { cpdb\_printer\_obj\_t \*p = cpdbGetDefaultPrinter(f); if (p) printf("%s#%s\n", p->name, p->backend\_name); else printf("No default printer found\n"); } else if (strcmp(buf, "get-default-printer-for-backend") == 0) { char backend\_name[BUFSIZE]; scanf("%s", backend\_name); /\*\* \* Backend name = The last part of the backend dbus service \* Eg. "CUPS" or "GCP" \*/ cpdb\_printer\_obj\_t \*p = cpdbGetDefaultPrinterForBackend(f, backend\_name); printf("%s\n", p->name); } else if (strcmp(buf, "set-user-default-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (p) { if (cpdbSetUserDefaultPrinter(p)) printf("Set printer as user default\n"); else printf("Couldn't set printer as user default\n"); } } else if (strcmp(buf, "set-system-default-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (p) { if (cpdbSetSystemDefaultPrinter(p)) printf("Set printer as system default\n"); else printf("Couldn't set printer as system default\n"); } } else if (strcmp(buf, "print-file") == 0) { char printer\_id[BUFSIZE], backend\_name[BUFSIZE], file\_path[BUFSIZE]; scanf("%s%s%s", file\_path, printer\_id, backend\_name); /\*\* \* Try adding some settings here .. change them and experiment \*/ cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 if(strcmp(backend\_name, "FILE") == 0) { char final\_file\_path[BUFSIZE]; printf("Please give the final file path: "); scanf("%s", final\_file\_path); cpdbPrintFilePath(p, file\_path, final\_file\_path); continue; }
 cpdbAddSettingToPrinter(p, "copies", "3"); cpdbPrintFile(p, file\_path); } else if (strcmp(buf, "get-active-jobs-count") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%d jobs currently active.\n", cpdbGetActiveJobsCount(p)); } else if (strcmp(buf, "get-all-jobs") == 0) { int active\_only; scanf("%d", &active\_only); cpdb\_job\_t \*j; int x = cpdbGetAllJobs(f, &j, active\_only); printf("Total %d jobs\n", x); int i; for (i = 0; i < x; i++) { printf("%s .. %s .. %s .. %s .. %s\n", j[i].job\_id, j[i].title, j[i].printer\_id, j[i].state, j[i].submitted\_at); } } else if (strcmp(buf, "cancel-job") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char job\_id[BUFSIZE]; scanf("%s%s%s", job\_id, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if (cpdbCancelJob(p, job\_id)) printf("cpdb\_job\_t %s has been cancelled.\n", job\_id); else printf("Unable to cancel job %s\n", job\_id); } else if (strcmp(buf, "pickle-printer") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char job\_id[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbPicklePrinterToFile(p, "/tmp/.printer-pickle", f); } else if (strcmp(buf, "get-option-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char option\_name[BUFSIZE]; scanf("%s%s%s", option\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetOptionTranslation(p, option\_name, locale)); } else if (strcmp(buf, "get-choice-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char option\_name[BUFSIZE]; char choice\_name[BUFSIZE]; scanf("%s%s%s%s", option\_name, choice\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetChoiceTranslation(p, option\_name, choice\_name, locale)); } else if (strcmp(buf, "get-group-translation") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char group\_name[BUFSIZE]; scanf("%s%s%s", group\_name, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); printf("%s\n", cpdbGetGroupTranslation(p, group\_name, locale)); } else if (strcmp(buf, "get-all-translations") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); cpdbGetAllTranslations(p, locale); printTranslations(p); } else if (strcmp(buf, "get-media-size") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char media[BUFSIZE]; int width, length; scanf("%s%s%s", media, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); int ok = cpdbGetMediaSize(p, media, &width, &length); if (ok) printf("%dx%d\n", width, length); } else if (strcmp(buf, "get-media-margins") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; char media[BUFSIZE]; scanf("%s%s%s", media, printer\_id, backend\_name); cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name);
 cpdb\_margin\_t \*margins; int num\_margins = cpdbGetMediaMargins(p, media, &margins); for (int i = 0; i < num\_margins; i++) printf("%d %d %d %d\n", margins[i].left, margins[i].right, margins[i].top, margins[i].bottom); } else if (strcmp(buf, "acquire-details") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name);  cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if(p == NULL) continue;
 g\_message("Acquiring printer details asynchronously...\n"); cpdbAcquireDetails(p, acquire\_details\_callback, NULL); } else if (strcmp(buf, "acquire-translations") == 0) { char printer\_id[BUFSIZE]; char backend\_name[BUFSIZE]; scanf("%s%s", printer\_id, backend\_name);  cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); if(p == NULL) continue;
 g\_message("Acquiring printer translations asynchronously...\n"); cpdbAcquireTranslations(p, locale, acquire\_translations\_callback, NULL); } }}
void display\_help(){ g\_message("Available commands .. "); printf("%s\n", "stop"); printf("%s\n", "hide-remote"); printf("%s\n", "unhide-remote"); printf("%s\n", "hide-temporary"); printf("%s\n", "unhide-temporary"); //printf("%s\n", "ping <printer id> "); printf("%s\n", "get-default-printer"); printf("%s\n", "get-default-printer-for-backend <backend name>"); printf("%s\n", "set-user-default-printer <printer id> <backend name>"); printf("%s\n", "set-system-default-printer <printer id> <backend name>"); printf("%s\n", "print-file <file path> <printer\_id> <backend\_name>"); printf("%s\n", "get-active-jobs-count <printer-name> <backend-name>"); printf("%s\n", "get-all-jobs <0 for all jobs; 1 for only active>"); printf("%s\n", "get-state <printer id> <backend name>"); printf("%s\n", "is-accepting-jobs <printer id> <backend name(like \"CUPS\")>"); printf("%s\n", "cancel-job <job-id> <printer id> <backend name>"); printf("%s\n", "acquire-details <printer id> <backend name>"); printf("%s\n", "acquire-translations <printer id> <backend name>"); printf("%s\n", "get-all-options <printer-name> <backend-name>"); printf("%s\n", "get-default <option name> <printer id> <backend name>"); printf("%s\n", "get-setting <option name> <printer id> <backend name>"); printf("%s\n", "get-current <option name> <printer id> <backend name>"); printf("%s\n", "add-setting <option name> <option value> <printer id> <backend name>"); printf("%s\n", "clear-setting <option name> <printer id> <backend name>"); printf("%s\n", "get-media-size <media> <printer id> <backend name>"); printf("%s\n", "get-media-margins <media> <printer id> <backend name>"); printf("%s\n", "get-option-translation <option> <printer id> <backend name>"); printf("%s\n", "get-choice-translation <option> <choice> <printer id> <backend name>"); printf("%s\n", "get-group-translation <group> <printer id> <backend name>"); printf("%s\n", "get-all-translations <printer id> <backend name>"); printf("%s\n", "pickle-printer <printer id> <backend name>\n");}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1a24d179_20250114_214405.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fcommit%2Ff181bd1f14757c2ae0f17cc76dc20421a40f30b7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fcommit%2Ff181bd1f14757c2ae0f17cc76dc20421a40f30b7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenPrinting%2Fcpdb-libs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenPrinting](/OpenPrinting)
/
**[cpdb-libs](/OpenPrinting/cpdb-libs)**
Public

forked from [NilanjanaLodh/OpenPrinting\_CPD\_Libraries](/NilanjanaLodh/OpenPrinting_CPD_Libraries)

* [Notifications](/login?return_to=%2FOpenPrinting%2Fcpdb-libs) You must be signed in to change notification settings
* [Fork
  9](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)
* [Star
   5](/login?return_to=%2FOpenPrinting%2Fcpdb-libs)

* [Code](/OpenPrinting/cpdb-libs)
* [Issues
  0](/OpenPrinting/cpdb-libs/issues)
* [Pull requests
  0](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects
  0](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

Additional navigation options

* [Code](/OpenPrinting/cpdb-libs)
* [Issues](/OpenPrinting/cpdb-libs/issues)
* [Pull requests](/OpenPrinting/cpdb-libs/pulls)
* [Discussions](/OpenPrinting/cpdb-libs/discussions)
* [Actions](/OpenPrinting/cpdb-libs/actions)
* [Projects](/OpenPrinting/cpdb-libs/projects)
* [Wiki](/OpenPrinting/cpdb-libs/wiki)
* [Security](/OpenPrinting/cpdb-libs/security)
* [Insights](/OpenPrinting/cpdb-libs/pulse)

## Commit

[Permalink](/OpenPrinting/cpdb-libs/commit/f181bd1f14757c2ae0f17cc76dc20421a40f30b7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-25j7-9gfc-f46x](https://github.com/OpenPrinting/cpdb-libs/security/advisories/GHSA-25j7-9gfc-f46x "GHSA-25j7-9gfc-f46x")

[Browse files](/OpenPrinting/cpdb-libs/tree/f181bd1f14757c2ae0f17cc76dc20421a40f30b7)
Browse the repository at this point in the history

```
cpdb-libs uses the fscanf() and scanf() functions to parse command
lines and configuration files, dropping the read string components
into fixed-length buffers, but does not limit the length of the
strings to be read by fscanf() and scanf() causing buffer overflows
when a string is longer than 1023 characters.

As all buffers have a length of 1024 characters we limit the maximum string
length to be read to 1023 by replaceing all occurences of "%s" by "%1023s"
in all calls of the fscanf() and scanf() functions.

Simply done by

perl -p -i -e 's/(scanf\(.*?".*?)%s/\1%1023s/' cpdb/cpdb-frontend.c tools/cpdb-text-frontend.c

and verifying with

grep scanf */*.c
```

* Loading branch information

[![@tillkamppeter](https://avatars.githubusercontent.com/u/1244825?s=40&v=4)](/tillkamppeter)

[tillkamppeter](/OpenPrinting/cpdb-libs/commits?author=tillkamppeter "View all commits by tillkamppeter")
authored
Jun 14, 2023

1 parent
[85555fb](/OpenPrinting/cpdb-libs/commit/85555fba64d34f53a2fce099b0488904cc48ed35)

commit f181bd1

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**28 additions**
and
**28 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* cpdb

  + cpdb/cpdb-frontend.c
    [cpdb-frontend.c](#diff-3b15b8e0f7e83f73d4a2f4ed485b27472d8e09c19de80ede5c95ea7ef1b91836)
* tools

  + tools/cpdb-text-frontend.c
    [cpdb-text-frontend.c](#diff-12ca989df4a4db67ed3ee2064c9b0ed6e049958518d34a7fac9d78abcf2a5366)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[cpdb/cpdb-frontend.c](#diff-3b15b8e0f7e83f73d4a2f4ed485b27472d8e09c19de80ede5c95ea7ef1b91836 "cpdb/cpdb-frontend.c")

Show comments

[View file](/OpenPrinting/cpdb-libs/blob/f181bd1f14757c2ae0f17cc76dc20421a40f30b7/cpdb/cpdb-frontend.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -391,7 +391,7 @@ PrintBackend \*cpdbCreateBackendFromFile(GDBusConnection \*connection, |
|  |  | free(path); |
|  |  | return NULL; |
|  |  | } |
|  |  | if (fscanf(file, "%s", obj\_path) == 0) |
|  |  | if (fscanf(file, "%1023s", obj\_path) == 0) |
|  |  | { |
|  |  | logerror("Error creating backend %s : Couldn't parse %s\n", |
|  |  | backend\_name, path); |
| Expand Down | |  |

54 changes: 27 additions & 27 deletions

54
[tools/cpdb-text-frontend.c](#diff-12ca989df4a4db67ed3ee2064c9b0ed6e049958518d34a7fac9d78abcf2a5366 "tools/cpdb-text-frontend.c")

Show comments

[View file](/OpenPrinting/cpdb-libs/blob/f181bd1f14757c2ae0f17cc76dc20421a40f30b7/tools/cpdb-text-frontend.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -159,7 +159,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | printf("> "); |
|  |  | fflush(stdout); |
|  |  | scanf("%s", buf); |
|  |  | scanf("%1023s", buf); |
|  |  | if (strcmp(buf, "stop") == 0) |
|  |  | { |
|  |  | cpdbDeleteFrontendObj(f); |
| Expand Down  Expand Up | | @@ -195,7 +195,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | g\_message("Getting all attributes ..\n"); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  |  |
| Expand All | | @@ -218,7 +218,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | g\_message("Getting all attributes ..\n"); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  |  |
| Expand All | | @@ -240,7 +240,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "get-default") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", option\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", option\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | char \*ans = cpdbGetDefault(p, option\_name); |
|  |  | if (!ans) |
| Expand All | | @@ -251,7 +251,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "get-setting") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], setting\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", setting\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", setting\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | char \*ans = cpdbGetSetting(p, setting\_name); |
|  |  | if (!ans) |
| Expand All | | @@ -262,7 +262,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "get-current") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", option\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", option\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | char \*ans = cpdbGetCurrent(p, option\_name); |
|  |  | if (!ans) |
| Expand All | | @@ -273,31 +273,31 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "add-setting") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE], option\_val[BUFSIZE]; |
|  |  | scanf("%s %s %s %s", option\_name, option\_val, printer\_id, backend\_name); |
|  |  | scanf("%1023s %1023s %1023s %1023s", option\_name, option\_val, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%s : %s\n", option\_name, option\_val); |
|  |  | cpdbAddSettingToPrinter(p, cpdbGetStringCopy(option\_name), cpdbGetStringCopy(option\_val)); |
|  |  | } |
|  |  | else if (strcmp(buf, "clear-setting") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], option\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", option\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", option\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | cpdbClearSettingFromPrinter(p, option\_name); |
|  |  | } |
|  |  | else if (strcmp(buf, "get-state") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%s\n", cpdbGetState(p)); |
|  |  | } |
|  |  | else if (strcmp(buf, "is-accepting-jobs") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("Accepting jobs ? : %d \n", cpdbIsAcceptingJobs(p)); |
|  |  | } |
| Expand All | | @@ -308,7 +308,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "ping") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | print\_backend\_call\_ping\_sync(p->backend\_proxy, p->id, NULL, NULL); |
|  |  | } |
| Expand All | | @@ -323,7 +323,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "get-default-printer-for-backend") == 0) |
|  |  | { |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s", backend\_name); |
|  |  | scanf("%1023s", backend\_name); |
|  |  | /\*\* |
|  |  | \* Backend name = The last part of the backend dbus service |
|  |  | \* Eg. "CUPS" or "GCP" |
| Expand All | | @@ -335,7 +335,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | if (p) |
|  |  | { |
| Expand All | | @@ -349,7 +349,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | if (p) |
|  |  | { |
| Expand All | | @@ -362,7 +362,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | else if (strcmp(buf, "print-file") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE], backend\_name[BUFSIZE], file\_path[BUFSIZE]; |
|  |  | scanf("%s%s%s", file\_path, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", file\_path, printer\_id, backend\_name); |
|  |  | /\*\* |
|  |  | \* Try adding some settings here .. change them and experiment |
|  |  | \*/ |
| Expand All | | @@ -372,7 +372,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char final\_file\_path[BUFSIZE]; |
|  |  | printf("Please give the final file path: "); |
|  |  | scanf("%s", final\_file\_path); |
|  |  | scanf("%1023s", final\_file\_path); |
|  |  | cpdbPrintFilePath(p, file\_path, final\_file\_path); |
|  |  | continue; |
|  |  | } |
| Expand All | | @@ -384,7 +384,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%d jobs currently active.\n", cpdbGetActiveJobsCount(p)); |
|  |  | } |
| Expand All | | @@ -406,7 +406,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char job\_id[BUFSIZE]; |
|  |  | scanf("%s%s%s", job\_id, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", job\_id, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | if (cpdbCancelJob(p, job\_id)) |
|  |  | printf("cpdb\_job\_t %s has been cancelled.\n", job\_id); |
| Expand All | | @@ -418,7 +418,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char job\_id[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | cpdbPicklePrinterToFile(p, "/tmp/.printer-pickle", f); |
|  |  | } |
| Expand All | | @@ -427,7 +427,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char option\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", option\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", option\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%s\n", cpdbGetOptionTranslation(p, option\_name, locale)); |
|  |  | } |
| Expand All | | @@ -437,7 +437,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char option\_name[BUFSIZE]; |
|  |  | char choice\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s%s", option\_name, choice\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s%1023s", option\_name, choice\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%s\n", cpdbGetChoiceTranslation(p, option\_name, choice\_name, locale)); |
|  |  | } |
| Expand All | | @@ -446,15 +446,15 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char group\_name[BUFSIZE]; |
|  |  | scanf("%s%s%s", group\_name, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", group\_name, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | printf("%s\n", cpdbGetGroupTranslation(p, group\_name, locale)); |
|  |  | } |
|  |  | else if (strcmp(buf, "get-all-translations") == 0) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | cpdbGetAllTranslations(p, locale); |
|  |  | printTranslations(p); |
| Expand All | | @@ -465,7 +465,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char media[BUFSIZE]; |
|  |  | int width, length; |
|  |  | scanf("%s%s%s", media, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", media, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | int ok = cpdbGetMediaSize(p, media, &width, &length); |
|  |  | if (ok) |
| Expand All | | @@ -476,7 +476,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | char media[BUFSIZE]; |
|  |  | scanf("%s%s%s", media, printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s%1023s", media, printer\_id, backend\_name); |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  |  |
|  |  | cpdb\_margin\_t \*margins; |
| Expand All | | @@ -488,7 +488,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  |  |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | if(p == NULL) |
| Expand All | | @@ -501,7 +501,7 @@ gpointer parse\_commands(gpointer user\_data) |
|  |  | { |
|  |  | char printer\_id[BUFSIZE]; |
|  |  | char backend\_name[BUFSIZE]; |
|  |  | scanf("%s%s", printer\_id, backend\_name); |
|  |  | scanf("%1023s%1023s", printer\_id, backend\_name); |
|  |  |  |
|  |  | cpdb\_printer\_obj\_t \*p = cpdbFindPrinterObj(f, printer\_id, backend\_name); |
|  |  | if(p == NULL) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `f181bd1`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenPrinting%2Fcpdb-libs%2Fcommit%2Ff181bd1f14757c2ae0f17cc76dc20421a40f30b7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


