=== Content from plugins.trac.wordpress.org_8435fc4a_20250114_182520.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ffoogallery%2Ftags%2F2.4.9%2Fincludes%2Ffunctions.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/foogallery/tags/2.4.9/includes/functions.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/foogallery/tags/2.4.9/includes/functions.php)

---

# [source:](/browser?order=name "Go to repository root") [foogallery](/browser/foogallery?order=name "View foogallery")/[tags](/browser/foogallery/tags?order=name "View tags")/[2.4.9](/browser/foogallery/tags/2.4.9?order=name "View 2.4.9")/[includes](/browser/foogallery/tags/2.4.9/includes?order=name "View includes")/[functions.php](/browser/foogallery/tags/2.4.9/includes/functions.php?order=name "View functions.php")

View diff against:

View revision:

| [Last change](/changeset/3027668/foogallery/tags/2.4.9/includes/functions.php "View differences") on this file was [3027668](/changeset/3027668/ "View changeset 3027668"), checked in by bradvin, [12 months ago](/timeline?from=2024-01-27T16%3A28%3A59Z&precision=second "See timeline at 01/27/2024 04:28:59 PM") |
| --- |
| added tag 2.4.9 |
| **File size:** 73.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* FooGallery global functions |
| [5](#L5) | \* |
| [6](#L6) | \* @package   FooGallery |
| [7](#L7) | \* @author    Brad Vincent <brad@fooplugins.com> |
| [8](#L8) | \* @license   GPL-2.0+ |
| [9](#L9) | \* @link      https://github.com/fooplugins/foogallery |
| [10](#L10) | \* @copyright 2014 FooPlugins LLC |
| [11](#L11) | \*/ |
| [12](#L12) | /\*\* |
| [13](#L13) | \* Returns the name of the plugin. (Allows the name to be overridden from extensions or functions.php) |
| [14](#L14) | \* @return string |
| [15](#L15) | \*/ |
| [16](#L16) | function foogallery\_plugin\_name() |
| [17](#L17) | { |
| [18](#L18) | return apply\_filters( 'foogallery\_plugin\_name', 'FooGallery' ); |
| [19](#L19) | } |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* Return all the gallery templates used within FooGallery |
| [23](#L23) | \* |
| [24](#L24) | \* @return array |
| [25](#L25) | \*/ |
| [26](#L26) | function foogallery\_gallery\_templates() |
| [27](#L27) | { |
| [28](#L28) | return apply\_filters( 'foogallery\_gallery\_templates', array() ); |
| [29](#L29) | } |
| [30](#L30) |  |
| [31](#L31) | /\*\* |
| [32](#L32) | \* Return a specific gallery template based on the slug |
| [33](#L33) | \* @param $slug |
| [34](#L34) | \* |
| [35](#L35) | \* @return bool|array |
| [36](#L36) | \*/ |
| [37](#L37) | function foogallery\_get\_gallery\_template( $slug ) |
| [38](#L38) | { |
| [39](#L39) | foreach ( foogallery\_gallery\_templates() as $template ) { |
| [40](#L40) | if ( $slug == $template['slug'] ) { |
| [41](#L41) | return $template; |
| [42](#L42) | } |
| [43](#L43) | } |
| [44](#L44) | return false; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Return the FooGallery extension API class |
| [49](#L49) | \* |
| [50](#L50) | \* @return FooGallery\_Extensions\_API |
| [51](#L51) | \*/ |
| [52](#L52) | function foogallery\_extensions\_api() |
| [53](#L53) | { |
| [54](#L54) | return new FooGallery\_Extensions\_API(); |
| [55](#L55) | } |
| [56](#L56) |  |
| [57](#L57) | /\*\* |
| [58](#L58) | \* Returns the default gallery template |
| [59](#L59) | \* |
| [60](#L60) | \* @return string |
| [61](#L61) | \*/ |
| [62](#L62) | function foogallery\_default\_gallery\_template() |
| [63](#L63) | { |
| [64](#L64) | return foogallery\_get\_setting( 'gallery\_template' ); |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | /\*\* |
| [68](#L68) | \* Returns if gallery permalinks are enabled |
| [69](#L69) | \* |
| [70](#L70) | \* @return bool |
| [71](#L71) | \*/ |
| [72](#L72) | function foogallery\_permalinks\_enabled() |
| [73](#L73) | { |
| [74](#L74) | return foogallery\_get\_setting( 'gallery\_permalinks\_enabled' ); |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* Returns the gallery permalink |
| [79](#L79) | \* |
| [80](#L80) | \* @return string |
| [81](#L81) | \*/ |
| [82](#L82) | function foogallery\_permalink() |
| [83](#L83) | { |
| [84](#L84) | return foogallery\_get\_setting( 'gallery\_permalink' ); |
| [85](#L85) | } |
| [86](#L86) |  |
| [87](#L87) | /\*\* |
| [88](#L88) | \* Return the FooGallery saved setting, or a default value |
| [89](#L89) | \* |
| [90](#L90) | \* @param string $key The key for the setting |
| [91](#L91) | \* |
| [92](#L92) | \* @param bool $default The default if no value is saved or found |
| [93](#L93) | \* |
| [94](#L94) | \* @return mixed |
| [95](#L95) | \*/ |
| [96](#L96) | function foogallery\_get\_setting( $key, $default = false ) |
| [97](#L97) | { |
| [98](#L98) | $foogallery = FooGallery\_Plugin::get\_instance(); |
| [99](#L99) | return $foogallery->options()->get( $key, foogallery\_get\_default( $key, $default ) ); |
| [100](#L100) | } |
| [101](#L101) |  |
| [102](#L102) | /\*\* |
| [103](#L103) | \* Sets a specific option based on a key |
| [104](#L104) | \* |
| [105](#L105) | \* @param $key |
| [106](#L106) | \* @param $value |
| [107](#L107) | \* |
| [108](#L108) | \* @return mixed |
| [109](#L109) | \*/ |
| [110](#L110) | function foogallery\_set\_setting( $key, $value ) |
| [111](#L111) | { |
| [112](#L112) | $foogallery = FooGallery\_Plugin::get\_instance(); |
| [113](#L113) | return $foogallery->options()->save( $key, $value ); |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | /\*\* |
| [117](#L117) | \* Builds up a FooGallery gallery shortcode |
| [118](#L118) | \* |
| [119](#L119) | \* @param $gallery\_id |
| [120](#L120) | \* |
| [121](#L121) | \* @return string |
| [122](#L122) | \*/ |
| [123](#L123) | function foogallery\_build\_gallery\_shortcode( $gallery\_id ) |
| [124](#L124) | { |
| [125](#L125) | return '[' . foogallery\_gallery\_shortcode\_tag() . ' id="' . $gallery\_id . '"]'; |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | /\*\* |
| [129](#L129) | \* Returns the gallery shortcode tag |
| [130](#L130) | \* |
| [131](#L131) | \* @return string |
| [132](#L132) | \*/ |
| [133](#L133) | function foogallery\_gallery\_shortcode\_tag() |
| [134](#L134) | { |
| [135](#L135) | return apply\_filters( 'foogallery\_gallery\_shortcode\_tag', FOOGALLERY\_CPT\_GALLERY ); |
| [136](#L136) | } |
| [137](#L137) |  |
| [138](#L138) | /\*\* |
| [139](#L139) | \* Helper method for getting default settings |
| [140](#L140) | \* |
| [141](#L141) | \* @param string $key The default config key to retrieve. |
| [142](#L142) | \* |
| [143](#L143) | \* @param bool $default The default if no default is set or found |
| [144](#L144) | \* |
| [145](#L145) | \* @return string Key value on success, false on failure. |
| [146](#L146) | \*/ |
| [147](#L147) | function foogallery\_get\_default( $key, $default = false ) |
| [148](#L148) | { |
| [149](#L149) | $defaults = array( |
| [150](#L150) | 'gallery\_template'           => 'default', |
| [151](#L151) | 'gallery\_permalinks\_enabled' => false, |
| [152](#L152) | 'gallery\_permalink'          => 'gallery', |
| [153](#L153) | 'lightbox'                   => 'foogallery', |
| [154](#L154) | 'thumb\_jpeg\_quality'         => '90', |
| [155](#L155) | 'gallery\_sorting'            => '', |
| [156](#L156) | 'datasource'                 => 'media\_library', |
| [157](#L157) | ); |
| [158](#L158) | // A handy filter to override the defaults. |
| [159](#L159) | $defaults = apply\_filters( 'foogallery\_defaults', $defaults ); |
| [160](#L160) | // Return the key specified. |
| [161](#L161) | return ( isset( $defaults[$key] ) ? $defaults[$key] : $default ); |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | /\*\* |
| [165](#L165) | \* Returns the FooGallery Galleries Url within the admin |
| [166](#L166) | \* |
| [167](#L167) | \* @return string The Url to the FooGallery Gallery listing page in admin |
| [168](#L168) | \*/ |
| [169](#L169) | function foogallery\_admin\_gallery\_listing\_url() |
| [170](#L170) | { |
| [171](#L171) | return admin\_url( 'edit.php?post\_type=' . FOOGALLERY\_CPT\_GALLERY ); |
| [172](#L172) | } |
| [173](#L173) |  |
| [174](#L174) | /\*\* |
| [175](#L175) | \* Returns the FooGallery Add Gallery Url within the admin |
| [176](#L176) | \* |
| [177](#L177) | \* @return string The Url to the FooGallery Add Gallery page in admin |
| [178](#L178) | \*/ |
| [179](#L179) | function foogallery\_admin\_add\_gallery\_url() |
| [180](#L180) | { |
| [181](#L181) | return admin\_url( 'post-new.php?post\_type=' . FOOGALLERY\_CPT\_GALLERY ); |
| [182](#L182) | } |
| [183](#L183) |  |
| [184](#L184) | /\*\* |
| [185](#L185) | \* Returns the FooGallery help page Url within the admin |
| [186](#L186) | \* |
| [187](#L187) | \* @return string The Url to the FooGallery help page in admin |
| [188](#L188) | \*/ |
| [189](#L189) | function foogallery\_admin\_help\_url() |
| [190](#L190) | { |
| [191](#L191) | return admin\_url( add\_query\_arg( array( |
| [192](#L192) | 'page' => FOOGALLERY\_ADMIN\_MENU\_HELP\_SLUG, |
| [193](#L193) | ), foogallery\_admin\_menu\_parent\_slug() ) ); |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | /\*\* |
| [197](#L197) | \* Returns the FooGallery settings page Url within the admin |
| [198](#L198) | \* |
| [199](#L199) | \* @return string The Url to the FooGallery settings page in admin |
| [200](#L200) | \*/ |
| [201](#L201) | function foogallery\_admin\_settings\_url() |
| [202](#L202) | { |
| [203](#L203) | return admin\_url( add\_query\_arg( array( |
| [204](#L204) | 'page' => FOOGALLERY\_ADMIN\_MENU\_SETTINGS\_SLUG, |
| [205](#L205) | ), foogallery\_admin\_menu\_parent\_slug() ) ); |
| [206](#L206) | } |
| [207](#L207) |  |
| [208](#L208) | /\*\* |
| [209](#L209) | \* DEPRECATED! |
| [210](#L210) | \* |
| [211](#L211) | \* @return string The Url to the FooGallery extensions page in admin |
| [212](#L212) | \*/ |
| [213](#L213) | function foogallery\_admin\_extensions\_url() |
| [214](#L214) | { |
| [215](#L215) | return foogallery\_admin\_extensions\_url(); |
| [216](#L216) | } |
| [217](#L217) |  |
| [218](#L218) | /\*\* |
| [219](#L219) | \* Returns the FooGallery features page Url within the admin |
| [220](#L220) | \* |
| [221](#L221) | \* @return string The Url to the FooGallery extensions page in admin |
| [222](#L222) | \*/ |
| [223](#L223) | function foogallery\_admin\_features\_url() |
| [224](#L224) | { |
| [225](#L225) | return admin\_url( add\_query\_arg( array( |
| [226](#L226) | 'page' => FOOGALLERY\_ADMIN\_MENU\_FEATURES\_SLUG, |
| [227](#L227) | ), foogallery\_admin\_menu\_parent\_slug() ) ); |
| [228](#L228) | } |
| [229](#L229) |  |
| [230](#L230) | /\*\* |
| [231](#L231) | \* Returns the FooGallery system info page Url within the admin |
| [232](#L232) | \* |
| [233](#L233) | \* @return string The Url to the FooGallery system info page in admin |
| [234](#L234) | \*/ |
| [235](#L235) | function foogallery\_admin\_systeminfo\_url() |
| [236](#L236) | { |
| [237](#L237) | return admin\_url( add\_query\_arg( array( |
| [238](#L238) | 'page' => FOOGALLERY\_ADMIN\_MENU\_SYSTEMINFO\_SLUG, |
| [239](#L239) | ), foogallery\_admin\_menu\_parent\_slug() ) ); |
| [240](#L240) | } |
| [241](#L241) |  |
| [242](#L242) | /\*\* |
| [243](#L243) | \* Returns the FooGallery pricing page Url within the admin |
| [244](#L244) | \* |
| [245](#L245) | \* @return string The Url to the FooGallery pricing page in admin |
| [246](#L246) | \*/ |
| [247](#L247) | function foogallery\_admin\_pricing\_url() |
| [248](#L248) | { |
| [249](#L249) | return admin\_url( add\_query\_arg( array( |
| [250](#L250) | 'page' => FOOGALLERY\_ADMIN\_MENU\_PRICING\_SLUG, |
| [251](#L251) | ), foogallery\_admin\_menu\_parent\_slug() ) ); |
| [252](#L252) | } |
| [253](#L253) |  |
| [254](#L254) | /\*\* |
| [255](#L255) | \* Returns the FooGallery free trial pricing page Url within the admin |
| [256](#L256) | \* |
| [257](#L257) | \* @return string The Url to the FooGallery free trial page in admin |
| [258](#L258) | \*/ |
| [259](#L259) | function foogallery\_admin\_freetrial\_url() |
| [260](#L260) | { |
| [261](#L261) | return add\_query\_arg( 'trial', 'true', foogallery\_admin\_pricing\_url() ); |
| [262](#L262) | } |
| [263](#L263) |  |
| [264](#L264) | /\*\* |
| [265](#L265) | \* Get a foogallery template setting for the current foogallery that is being output to the frontend |
| [266](#L266) | \* @param string        $key |
| [267](#L267) | \* @param string        $default |
| [268](#L268) | \* |
| [269](#L269) | \* @return mixed |
| [270](#L270) | \*/ |
| [271](#L271) | function foogallery\_gallery\_template\_setting( $key, $default = '' ) |
| [272](#L272) | { |
| [273](#L273) | global  $current\_foogallery ; |
| [274](#L274) | global  $current\_foogallery\_arguments ; |
| [275](#L275) | global  $current\_foogallery\_template ; |
| [276](#L276) | $settings\_key = "{$current\_foogallery\_template}\_{$key}"; |
| [277](#L277) |  |
| [278](#L278) | if ( $current\_foogallery\_arguments && array\_key\_exists( $key, $current\_foogallery\_arguments ) ) { |
| [279](#L279) | //try to get the value from the arguments |
| [280](#L280) | $value = $current\_foogallery\_arguments[$key]; |
| [281](#L281) | } else { |
| [282](#L282) |  |
| [283](#L283) | if ( !empty($current\_foogallery) && $current\_foogallery->settings && array\_key\_exists( $settings\_key, $current\_foogallery->settings ) ) { |
| [284](#L284) | //then get the value out of the saved gallery settings |
| [285](#L285) | $value = $current\_foogallery->settings[$settings\_key]; |
| [286](#L286) | } else { |
| [287](#L287) | //otherwise set it to the default |
| [288](#L288) | $value = $default; |
| [289](#L289) | } |
| [290](#L290) |  |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | $value = apply\_filters( 'foogallery\_gallery\_template\_setting-' . $key, $value ); |
| [294](#L294) | return $value; |
| [295](#L295) | } |
| [296](#L296) |  |
| [297](#L297) | /\*\* |
| [298](#L298) | \* Returns the gallery template setting for lightbox |
| [299](#L299) | \* |
| [300](#L300) | \* @return string |
| [301](#L301) | \*/ |
| [302](#L302) | function foogallery\_gallery\_template\_setting\_lightbox() |
| [303](#L303) | { |
| [304](#L304) | return foogallery\_gallery\_template\_setting( 'lightbox', 'foogallery' ); |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | /\*\* |
| [308](#L308) | \* Get the admin menu parent slug |
| [309](#L309) | \* @return string |
| [310](#L310) | \*/ |
| [311](#L311) | function foogallery\_admin\_menu\_parent\_slug() |
| [312](#L312) | { |
| [313](#L313) | return apply\_filters( 'foogallery\_admin\_menu\_parent\_slug', FOOGALLERY\_ADMIN\_MENU\_PARENT\_SLUG ); |
| [314](#L314) | } |
| [315](#L315) |  |
| [316](#L316) | /\*\* |
| [317](#L317) | \* Helper function to build up the admin menu Url |
| [318](#L318) | \* @param array $extra\_args |
| [319](#L319) | \* |
| [320](#L320) | \* @return string|void |
| [321](#L321) | \*/ |
| [322](#L322) | function foogallery\_build\_admin\_menu\_url( $extra\_args = array() ) |
| [323](#L323) | { |
| [324](#L324) | $url = admin\_url( foogallery\_admin\_menu\_parent\_slug() ); |
| [325](#L325) | if ( !empty($extra\_args) ) { |
| [326](#L326) | $url = add\_query\_arg( $extra\_args, $url ); |
| [327](#L327) | } |
| [328](#L328) | return $url; |
| [329](#L329) | } |
| [330](#L330) |  |
| [331](#L331) | /\*\* |
| [332](#L332) | \* Helper function for adding a foogallery sub menu |
| [333](#L333) | \* |
| [334](#L334) | \* @param $menu\_title |
| [335](#L335) | \* @param string $capability |
| [336](#L336) | \* @param string $menu\_slug |
| [337](#L337) | \* @param $function |
| [338](#L338) | \*/ |
| [339](#L339) | function foogallery\_add\_submenu\_page( |
| [340](#L340) | $menu\_title, |
| [341](#L341) | $capability, |
| [342](#L342) | $menu\_slug, |
| [343](#L343) | $function |
| [344](#L344) | ) |
| [345](#L345) | { |
| [346](#L346) | add\_submenu\_page( |
| [347](#L347) | foogallery\_admin\_menu\_parent\_slug(), |
| [348](#L348) | $menu\_title, |
| [349](#L349) | $menu\_title, |
| [350](#L350) | apply\_filters( 'foogallery\_admin\_menu\_capability', $capability ), |
| [351](#L351) | $menu\_slug, |
| [352](#L352) | $function |
| [353](#L353) | ); |
| [354](#L354) | } |
| [355](#L355) |  |
| [356](#L356) | /\*\* |
| [357](#L357) | \* Returns all FooGallery galleries |
| [358](#L358) | \* |
| [359](#L359) | \* @return FooGallery[] array of FooGallery galleries |
| [360](#L360) | \*/ |
| [361](#L361) | function foogallery\_get\_all\_galleries( $excludes = false, $extra\_args = false ) |
| [362](#L362) | { |
| [363](#L363) | $args = array( |
| [364](#L364) | 'post\_type'     => FOOGALLERY\_CPT\_GALLERY, |
| [365](#L365) | 'post\_status'   => array( 'publish', 'draft' ), |
| [366](#L366) | 'cache\_results' => false, |
| [367](#L367) | 'nopaging'      => true, |
| [368](#L368) | ); |
| [369](#L369) | if ( is\_array( $excludes ) ) { |
| [370](#L370) | $args['post\_\_not\_in'] = $excludes; |
| [371](#L371) | } |
| [372](#L372) | if ( is\_array( $extra\_args ) ) { |
| [373](#L373) | $args = array\_merge( $args, $extra\_args ); |
| [374](#L374) | } |
| [375](#L375) | $gallery\_posts = get\_posts( $args ); |
| [376](#L376) | if ( empty($gallery\_posts) ) { |
| [377](#L377) | return array(); |
| [378](#L378) | } |
| [379](#L379) | $galleries = array(); |
| [380](#L380) | foreach ( $gallery\_posts as $post ) { |
| [381](#L381) | $galleries[] = FooGallery::get( $post ); |
| [382](#L382) | } |
| [383](#L383) | return $galleries; |
| [384](#L384) | } |
| [385](#L385) |  |
| [386](#L386) | /\*\* |
| [387](#L387) | \* Parse some content and return an array of all gallery shortcodes that are used inside it |
| [388](#L388) | \* |
| [389](#L389) | \* @param $content The content to search for gallery shortcodes |
| [390](#L390) | \* |
| [391](#L391) | \* @return array An array of all the foogallery shortcodes found in the content |
| [392](#L392) | \*/ |
| [393](#L393) | function foogallery\_extract\_gallery\_shortcodes( $content ) |
| [394](#L394) | { |
| [395](#L395) | $shortcodes = array(); |
| [396](#L396) | $regex\_pattern = foogallery\_gallery\_shortcode\_regex(); |
| [397](#L397) | if ( preg\_match\_all( '/' . $regex\_pattern . '/s', $content, $matches ) ) { |
| [398](#L398) | for ( $i = 0 ;  $i < count( $matches[0] ) ;  ++$i ) { |
| [399](#L399) | $shortcode = $matches[0][$i]; |
| [400](#L400) | $args = $matches[3][$i]; |
| [401](#L401) | $attribure\_string = str\_replace( ' ', '&', trim( $args ) ); |
| [402](#L402) | $attribure\_string = str\_replace( '"', '', $attribure\_string ); |
| [403](#L403) | $attributes = wp\_parse\_args( $attribure\_string ); |
| [404](#L404) |  |
| [405](#L405) | if ( array\_key\_exists( 'id', $attributes ) ) { |
| [406](#L406) | $id = intval( $attributes['id'] ); |
| [407](#L407) | $shortcodes[$id] = $shortcode; |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | } |
| [411](#L411) | } |
| [412](#L412) | return $shortcodes; |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | /\*\* |
| [416](#L416) | \* Build up the FooGallery shortcode regex |
| [417](#L417) | \* |
| [418](#L418) | \* @return string |
| [419](#L419) | \*/ |
| [420](#L420) | function foogallery\_gallery\_shortcode\_regex() |
| [421](#L421) | { |
| [422](#L422) | $tag = foogallery\_gallery\_shortcode\_tag(); |
| [423](#L423) | return '\\[' . '(\\[?)' . "({$tag})" . '(?![\\w-])' . '(' . '[^\\]\\/]\*' . '(?:' . '\\/(?!\\])' . '[^\\]\\/]\*' . ')\*?' . ')' . '(?:' . '(\\/)' . '\\]' . '|' . '\\]' . '(?:' . '(' . '[^\\[]\*+' . '(?:' . '\\[(?!\\/\\2\\])' . '[^\\[]\*+' . ')\*+' . ')' . '\\[\\/\\2\\]' . ')?' . ')' . '(\\]?)'; |
| [424](#L424) | // 6: Optional second closing bracket for escaping shortcodes: [[tag]] |
| [425](#L425) | } |
| [426](#L426) |  |
| [427](#L427) | /\*\* |
| [428](#L428) | \* Builds up a class attribute that can be used in a gallery template |
| [429](#L429) | \* @param $gallery FooGallery |
| [430](#L430) | \* |
| [431](#L431) | \* @return string the classname based on the gallery and any extra attributes |
| [432](#L432) | \*/ |
| [433](#L433) | function foogallery\_build\_class\_attribute( $gallery ) |
| [434](#L434) | { |
| [435](#L435) | $classes[] = 'foogallery'; |
| [436](#L436) | $classes[] = 'foogallery-container'; |
| [437](#L437) | $classes[] = "foogallery-{$gallery->gallery\_template}"; |
| [438](#L438) | $num\_args = func\_num\_args(); |
| [439](#L439) |  |
| [440](#L440) | if ( $num\_args > 1 ) { |
| [441](#L441) | $arg\_list = func\_get\_args(); |
| [442](#L442) | for ( $i = 1 ;  $i < $num\_args ;  $i++ ) { |
| [443](#L443) | $classes[] = $arg\_list[$i]; |
| [444](#L444) | } |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | $classes = apply\_filters( 'foogallery\_build\_class\_attribute', $classes, $gallery ); |
| [448](#L448) | //extract any classes from the gallery arguments |
| [449](#L449) | global  $current\_foogallery\_arguments ; |
| [450](#L450) |  |
| [451](#L451) | if ( isset( $current\_foogallery\_arguments ) && is\_array( $current\_foogallery\_arguments ) ) { |
| [452](#L452) | if ( array\_key\_exists( 'classname', $current\_foogallery\_arguments ) ) { |
| [453](#L453) | $classes[] = $current\_foogallery\_arguments['classname']; |
| [454](#L454) | } |
| [455](#L455) | if ( array\_key\_exists( 'classes', $current\_foogallery\_arguments ) ) { |
| [456](#L456) | $classes[] = $current\_foogallery\_arguments['classes']; |
| [457](#L457) | } |
| [458](#L458) | } |
| [459](#L459) |  |
| [460](#L460) | $classes = array\_filter( $classes, 'strlen' ); |
| [461](#L461) | return implode( ' ', $classes ); |
| [462](#L462) | } |
| [463](#L463) |  |
| [464](#L464) | /\*\* |
| [465](#L465) | \* Builds up a SAFE class attribute that can be used in a gallery template |
| [466](#L466) | \* @param $gallery FooGallery |
| [467](#L467) | \* |
| [468](#L468) | \* @return string the classname based on the gallery and any extra attributes |
| [469](#L469) | \*/ |
| [470](#L470) | function foogallery\_build\_class\_attribute\_safe( $gallery ) |
| [471](#L471) | { |
| [472](#L472) | $args = func\_get\_args(); |
| [473](#L473) | $result = call\_user\_func\_array( "foogallery\_build\_class\_attribute", $args ); |
| [474](#L474) | return esc\_attr( $result ); |
| [475](#L475) | } |
| [476](#L476) |  |
| [477](#L477) | /\*\* |
| [478](#L478) | \* Renders an escaped class attribute that can be used directly by gallery templates |
| [479](#L479) | \* |
| [480](#L480) | \* @param $gallery FooGallery |
| [481](#L481) | \*/ |
| [482](#L482) | function foogallery\_build\_class\_attribute\_render\_safe( $gallery ) |
| [483](#L483) | { |
| [484](#L484) | $args = func\_get\_args(); |
| [485](#L485) | $result = call\_user\_func\_array( "foogallery\_build\_class\_attribute\_safe", $args ); |
| [486](#L486) | echo  $result ; |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | /\*\* |
| [490](#L490) | \* Builds up the attributes that are appended to a gallery template container |
| [491](#L491) | \* |
| [492](#L492) | \* @param $gallery    FooGallery |
| [493](#L493) | \* @param $attributes array |
| [494](#L494) | \* |
| [495](#L495) | \* @return string |
| [496](#L496) | \*/ |
| [497](#L497) | function foogallery\_build\_container\_attributes\_safe( $gallery, $attributes ) |
| [498](#L498) | { |
| [499](#L499) | //add the default gallery id |
| [500](#L500) | $attributes['id'] = $gallery->container\_id(); |
| [501](#L501) | //add the standard data-foogallery attribute so that the JS initializes correctly |
| [502](#L502) | $attributes['data-foogallery'] = foogallery\_build\_container\_data\_options( $gallery, $attributes ); |
| [503](#L503) | //allow others to add their own attributes globally |
| [504](#L504) | $attributes = apply\_filters( 'foogallery\_build\_container\_attributes', $attributes, $gallery ); |
| [505](#L505) | //allow others to add their own attributes for a specific gallery template |
| [506](#L506) | $attributes = apply\_filters( 'foogallery\_build\_container\_attributes-' . $gallery->gallery\_template, $attributes, $gallery ); |
| [507](#L507) | //clean up the attributes to make them safe for output |
| [508](#L508) | $html = ''; |
| [509](#L509) | foreach ( $attributes as $key => $value ) { |
| [510](#L510) | $safe\_value = esc\_attr( $value ); |
| [511](#L511) | $html .= "{$key}=\"{$safe\_value}\" "; |
| [512](#L512) | } |
| [513](#L513) | return apply\_filters( |
| [514](#L514) | 'foogallery\_build\_container\_attributes\_html', |
| [515](#L515) | $html, |
| [516](#L516) | $attributes, |
| [517](#L517) | $gallery |
| [518](#L518) | ); |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Builds up the data-foogallery attribute options that is used by the core javascript |
| [523](#L523) | \* |
| [524](#L524) | \* @param $gallery |
| [525](#L525) | \* @param $attributes |
| [526](#L526) | \* |
| [527](#L527) | \* @return string |
| [528](#L528) | \*/ |
| [529](#L529) | function foogallery\_build\_container\_data\_options( $gallery, $attributes ) |
| [530](#L530) | { |
| [531](#L531) | $options = apply\_filters( |
| [532](#L532) | 'foogallery\_build\_container\_data\_options', |
| [533](#L533) | array(), |
| [534](#L534) | $gallery, |
| [535](#L535) | $attributes |
| [536](#L536) | ); |
| [537](#L537) | $options = apply\_filters( |
| [538](#L538) | 'foogallery\_build\_container\_data\_options-' . $gallery->gallery\_template, |
| [539](#L539) | $options, |
| [540](#L540) | $gallery, |
| [541](#L541) | $attributes |
| [542](#L542) | ); |
| [543](#L543) | return foogallery\_json\_encode( $options ); |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | /\*\* |
| [547](#L547) | \* Render a foogallery |
| [548](#L548) | \* |
| [549](#L549) | \* @param       $gallery\_id int The id of the foogallery you want to render |
| [550](#L550) | \* @param array $args |
| [551](#L551) | \*/ |
| [552](#L552) | function foogallery\_render\_gallery( $gallery\_id, $args = array() ) |
| [553](#L553) | { |
| [554](#L554) | //create new instance of template engine |
| [555](#L555) | $engine = new FooGallery\_Template\_Loader(); |
| [556](#L556) | $shortcode\_args = wp\_parse\_args( $args, array( |
| [557](#L557) | 'id' => $gallery\_id, |
| [558](#L558) | ) ); |
| [559](#L559) | $engine->render\_template( $shortcode\_args ); |
| [560](#L560) | } |
| [561](#L561) |  |
| [562](#L562) | /\*\* |
| [563](#L563) | \* Returns the available sorting options that can be chosen for galleries and albums |
| [564](#L564) | \*/ |
| [565](#L565) | function foogallery\_sorting\_options() |
| [566](#L566) | { |
| [567](#L567) | return apply\_filters( 'foogallery\_sorting\_options', array( |
| [568](#L568) | ''              => \_\_( 'Default', 'foogallery' ), |
| [569](#L569) | 'date\_desc'     => \_\_( 'Date created - newest first', 'foogallery' ), |
| [570](#L570) | 'date\_asc'      => \_\_( 'Date created - oldest first', 'foogallery' ), |
| [571](#L571) | 'modified\_desc' => \_\_( 'Date modified - most recent first', 'foogallery' ), |
| [572](#L572) | 'modified\_asc'  => \_\_( 'Date modified - most recent last', 'foogallery' ), |
| [573](#L573) | 'title\_asc'     => \_\_( 'Title - alphabetically', 'foogallery' ), |
| [574](#L574) | 'title\_desc'    => \_\_( 'Title - reverse', 'foogallery' ), |
| [575](#L575) | 'rand'          => \_\_( 'Random', 'foogallery' ), |
| [576](#L576) | ) ); |
| [577](#L577) | } |
| [578](#L578) |  |
| [579](#L579) | function foogallery\_sorting\_get\_posts\_orderby\_arg( $sorting\_option ) |
| [580](#L580) | { |
| [581](#L581) | $orderby\_arg = 'post\_\_in'; |
| [582](#L582) | switch ( $sorting\_option ) { |
| [583](#L583) | case 'date\_desc': |
| [584](#L584) | case 'date\_asc': |
| [585](#L585) | $orderby\_arg = 'date'; |
| [586](#L586) | break; |
| [587](#L587) | case 'modified\_desc': |
| [588](#L588) | case 'modified\_asc': |
| [589](#L589) | $orderby\_arg = 'modified'; |
| [590](#L590) | break; |
| [591](#L591) | case 'title\_asc': |
| [592](#L592) | case 'title\_desc': |
| [593](#L593) | $orderby\_arg = 'title'; |
| [594](#L594) | break; |
| [595](#L595) | case 'rand': |
| [596](#L596) | $orderby\_arg = 'rand'; |
| [597](#L597) | break; |
| [598](#L598) | } |
| [599](#L599) | return apply\_filters( 'foogallery\_sorting\_get\_posts\_orderby\_arg', $orderby\_arg, $sorting\_option ); |
| [600](#L600) | } |
| [601](#L601) |  |
| [602](#L602) | function foogallery\_sorting\_get\_posts\_order\_arg( $sorting\_option ) |
| [603](#L603) | { |
| [604](#L604) | $order\_arg = 'DESC'; |
| [605](#L605) | switch ( $sorting\_option ) { |
| [606](#L606) | case 'date\_asc': |
| [607](#L607) | case 'modified\_asc': |
| [608](#L608) | case 'title\_asc': |
| [609](#L609) | $order\_arg = 'ASC'; |
| [610](#L610) | break; |
| [611](#L611) | } |
| [612](#L612) | return apply\_filters( 'foogallery\_sorting\_get\_posts\_order\_arg', $order\_arg, $sorting\_option ); |
| [613](#L613) | } |
| [614](#L614) |  |
| [615](#L615) | /\*\* |
| [616](#L616) | \* @deprecated 1.4.7 Default templates loaded by default and no longer activated via extension |
| [617](#L617) | \* |
| [618](#L618) | \* Activate the default templates extension when there are no gallery templates loaded |
| [619](#L619) | \*/ |
| [620](#L620) | function foogallery\_activate\_default\_templates\_extension() |
| [621](#L621) | { |
| [622](#L622) | //no longer needed but left in case any 3rd party extensions call this function |
| [623](#L623) | \_deprecated\_function( \_\_FUNCTION\_\_, '1.4.7' ); |
| [624](#L624) | } |
| [625](#L625) |  |
| [626](#L626) | /\*\* |
| [627](#L627) | \* Allow FooGallery to enqueue stylesheet and allow them to be enqueued in the head on the next page load |
| [628](#L628) | \* |
| [629](#L629) | \* @param $handle string |
| [630](#L630) | \* @param $src string |
| [631](#L631) | \* @param array $deps |
| [632](#L632) | \* @param bool $ver |
| [633](#L633) | \* @param string $media |
| [634](#L634) | \*/ |
| [635](#L635) | function foogallery\_enqueue\_style( |
| [636](#L636) | $handle, |
| [637](#L637) | $src, |
| [638](#L638) | $deps = array(), |
| [639](#L639) | $ver = false, |
| [640](#L640) | $media = 'all' |
| [641](#L641) | ) |
| [642](#L642) | { |
| [643](#L643) | $src = apply\_filters( 'foogallery\_enqueue\_style\_src', $src, $handle ); |
| [644](#L644) | wp\_enqueue\_style( |
| [645](#L645) | $handle, |
| [646](#L646) | $src, |
| [647](#L647) | $deps, |
| [648](#L648) | $ver, |
| [649](#L649) | $media |
| [650](#L650) | ); |
| [651](#L651) | do\_action( |
| [652](#L652) | 'foogallery\_enqueue\_style', |
| [653](#L653) | $handle, |
| [654](#L654) | $src, |
| [655](#L655) | $deps, |
| [656](#L656) | $ver, |
| [657](#L657) | $media |
| [658](#L658) | ); |
| [659](#L659) | } |
| [660](#L660) |  |
| [661](#L661) | /\*\* |
| [662](#L662) | \* Returns all foogallery post objects that are attached to the post |
| [663](#L663) | \* |
| [664](#L664) | \* @param $post\_id int The ID of the post |
| [665](#L665) | \* |
| [666](#L666) | \* @return array List of foogallery posts. |
| [667](#L667) | \*/ |
| [668](#L668) | function foogallery\_get\_galleries\_attached\_to\_post( $post\_id ) |
| [669](#L669) | { |
| [670](#L670) | $gallery\_ids = get\_post\_meta( $post\_id, FOOGALLERY\_META\_POST\_USAGE, false ); |
| [671](#L671) | if ( !empty($gallery\_ids) ) { |
| [672](#L672) | return get\_posts( array( |
| [673](#L673) | 'post\_type'      => array( FOOGALLERY\_CPT\_GALLERY ), |
| [674](#L674) | 'post\_status'    => array( 'draft', 'publish' ), |
| [675](#L675) | 'posts\_per\_page' => -1, |
| [676](#L676) | 'include'        => $gallery\_ids, |
| [677](#L677) | ) ); |
| [678](#L678) | } |
| [679](#L679) | return array(); |
| [680](#L680) | } |
| [681](#L681) |  |
| [682](#L682) | /\*\* |
| [683](#L683) | \* Clears all css load optimization post meta |
| [684](#L684) | \*/ |
| [685](#L685) | function foogallery\_clear\_all\_css\_load\_optimizations() |
| [686](#L686) | { |
| [687](#L687) | delete\_post\_meta\_by\_key( FOOGALLERY\_META\_POST\_USAGE\_CSS ); |
| [688](#L688) | } |
| [689](#L689) |  |
| [690](#L690) | /\*\* |
| [691](#L691) | \* Performs a check to see if the plugin has been updated, and perform any housekeeping if necessary |
| [692](#L692) | \*/ |
| [693](#L693) | function foogallery\_perform\_version\_check() |
| [694](#L694) | { |
| [695](#L695) | $checker = new FooGallery\_Version\_Check(); |
| [696](#L696) | $checker->perform\_check(); |
| [697](#L697) | } |
| [698](#L698) |  |
| [699](#L699) | /\*\* |
| [700](#L700) | \* Returns the JPEG quality used when generating thumbnails |
| [701](#L701) | \* |
| [702](#L702) | \* @return int The quality value stored in settings |
| [703](#L703) | \*/ |
| [704](#L704) | function foogallery\_thumbnail\_jpeg\_quality() |
| [705](#L705) | { |
| [706](#L706) | $quality = intval( foogallery\_get\_setting( 'thumb\_jpeg\_quality' ) ); |
| [707](#L707) | //check if we get an invalid value for whatever reason and if so return a default of 80 |
| [708](#L708) | if ( $quality <= 0 ) { |
| [709](#L709) | $quality = 80; |
| [710](#L710) | } |
| [711](#L711) | return $quality; |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Returns the caption title source setting |
| [716](#L716) | \* |
| [717](#L717) | \* @return string |
| [718](#L718) | \*/ |
| [719](#L719) | function foogallery\_caption\_title\_source() |
| [720](#L720) | { |
| [721](#L721) | $source = foogallery\_get\_setting( 'caption\_title\_source', 'caption' ); |
| [722](#L722) | if ( empty($source) ) { |
| [723](#L723) | $source = 'caption'; |
| [724](#L724) | } |
| [725](#L725) | return $source; |
| [726](#L726) | } |
| [727](#L727) |  |
| [728](#L728) | /\*\* |
| [729](#L729) | \* Returns the attachment caption title based on the caption\_title\_source setting |
| [730](#L730) | \* |
| [731](#L731) | \* @param WP\_Post $attachment\_post |
| [732](#L732) | \* @param bool $source |
| [733](#L733) | \* |
| [734](#L734) | \* @return string |
| [735](#L735) | \*/ |
| [736](#L736) | function foogallery\_get\_caption\_title\_for\_attachment( $attachment\_post, $source = false ) |
| [737](#L737) | { |
| [738](#L738) |  |
| [739](#L739) | if ( false === $source ) { |
| [740](#L740) | $source = foogallery\_gallery\_template\_setting( 'caption\_title\_source', false ); |
| [741](#L741) | if ( empty($source) || "none" === $source ) { |
| [742](#L742) | $source = foogallery\_caption\_title\_source(); |
| [743](#L743) | } |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) | switch ( $source ) { |
| [747](#L747) | case 'title': |
| [748](#L748) | $caption = trim( $attachment\_post->post\_title ); |
| [749](#L749) | break; |
| [750](#L750) | case 'desc': |
| [751](#L751) | $caption = trim( $attachment\_post->post\_content ); |
| [752](#L752) | break; |
| [753](#L753) | case 'alt': |
| [754](#L754) | $caption = trim( get\_post\_meta( $attachment\_post->ID, '\_wp\_attachment\_image\_alt', true ) ); |
| [755](#L755) | break; |
| [756](#L756) | default: |
| [757](#L757) | $caption = trim( $attachment\_post->post\_excerpt ); |
| [758](#L758) | } |
| [759](#L759) | return apply\_filters( 'foogallery\_get\_caption\_title\_for\_attachment', $caption, $attachment\_post ); |
| [760](#L760) | } |
| [761](#L761) |  |
| [762](#L762) | /\*\* |
| [763](#L763) | \* Returns the attachment caption title based on the caption\_title\_source setting |
| [764](#L764) | \* |
| [765](#L765) | \* @param FooGalleryAttachment $attachment |
| [766](#L766) | \* @param string $source |
| [767](#L767) | \* @param string $caption\_type The type of caption (title or desc) |
| [768](#L768) | \* |
| [769](#L769) | \* @return string |
| [770](#L770) | \*/ |
| [771](#L771) | function foogallery\_get\_caption\_by\_source( $attachment, $source, $caption\_type ) |
| [772](#L772) | { |
| [773](#L773) |  |
| [774](#L774) | if ( false === $source ) { |
| [775](#L775) | $source = foogallery\_gallery\_template\_setting( 'caption\_' . $caption\_type . '\_source', false ); |
| [776](#L776) | if ( empty($source) || "none" === $source ) { |
| [777](#L777) |  |
| [778](#L778) | if ( 'title' === $caption\_type ) { |
| [779](#L779) | $source = 'caption'; |
| [780](#L780) | //bad legacy naming! |
| [781](#L781) | } else { |
| [782](#L782) | $source = $caption\_type; |
| [783](#L783) | } |
| [784](#L784) |  |
| [785](#L785) | } |
| [786](#L786) | } |
| [787](#L787) |  |
| [788](#L788) | switch ( $source ) { |
| [789](#L789) | case 'title': |
| [790](#L790) | $caption = trim( $attachment->title ); |
| [791](#L791) | break; |
| [792](#L792) | case 'desc': |
| [793](#L793) | $caption = trim( $attachment->description ); |
| [794](#L794) | break; |
| [795](#L795) | case 'alt': |
| [796](#L796) | $caption = trim( $attachment->alt ); |
| [797](#L797) | break; |
| [798](#L798) | case 'caption': |
| [799](#L799) | default: |
| [800](#L800) | $caption = trim( $attachment->caption ); |
| [801](#L801) | } |
| [802](#L802) | return apply\_filters( |
| [803](#L803) | 'foogallery\_get\_caption\_by\_source', |
| [804](#L804) | $caption, |
| [805](#L805) | $attachment, |
| [806](#L806) | $source, |
| [807](#L807) | $caption\_type |
| [808](#L808) | ); |
| [809](#L809) | } |
| [810](#L810) |  |
| [811](#L811) | /\*\* |
| [812](#L812) | \* Returns the caption description source setting |
| [813](#L813) | \* |
| [814](#L814) | \* @return string |
| [815](#L815) | \*/ |
| [816](#L816) | function foogallery\_caption\_desc\_source() |
| [817](#L817) | { |
| [818](#L818) | $source = foogallery\_get\_setting( 'caption\_desc\_source', 'desc' ); |
| [819](#L819) | if ( empty($source) ) { |
| [820](#L820) | $source = 'desc'; |
| [821](#L821) | } |
| [822](#L822) | return $source; |
| [823](#L823) | } |
| [824](#L824) |  |
| [825](#L825) | /\*\* |
| [826](#L826) | \* Returns the attachment caption description based on the caption\_desc\_source setting |
| [827](#L827) | \* |
| [828](#L828) | \* @param WP\_Post $attachment\_post |
| [829](#L829) | \* @param bool $source |
| [830](#L830) | \* |
| [831](#L831) | \* @return string |
| [832](#L832) | \*/ |
| [833](#L833) | function foogallery\_get\_caption\_desc\_for\_attachment( $attachment\_post, $source = false ) |
| [834](#L834) | { |
| [835](#L835) |  |
| [836](#L836) | if ( false === $source ) { |
| [837](#L837) | $source = foogallery\_gallery\_template\_setting( 'caption\_desc\_source', false ); |
| [838](#L838) | if ( empty($source) || "none" === $source ) { |
| [839](#L839) | $source = foogallery\_caption\_desc\_source(); |
| [840](#L840) | } |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | switch ( $source ) { |
| [844](#L844) | case 'title': |
| [845](#L845) | $caption = trim( $attachment\_post->post\_title ); |
| [846](#L846) | break; |
| [847](#L847) | case 'caption': |
| [848](#L848) | $caption = trim( $attachment\_post->post\_excerpt ); |
| [849](#L849) | break; |
| [850](#L850) | case 'alt': |
| [851](#L851) | $caption = trim( get\_post\_meta( $attachment\_post->ID, '\_wp\_attachment\_image\_alt', true ) ); |
| [852](#L852) | break; |
| [853](#L853) | default: |
| [854](#L854) | $caption = trim( $attachment\_post->post\_content ); |
| [855](#L855) | } |
| [856](#L856) | return apply\_filters( 'foogallery\_get\_caption\_desc\_for\_attachment', $caption, $attachment\_post ); |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | /\*\* |
| [860](#L860) | \* Runs thumbnail tests and outputs results in a table format |
| [861](#L861) | \*/ |
| [862](#L862) | function foogallery\_output\_thumbnail\_generation\_results() |
| [863](#L863) | { |
| [864](#L864) | $thumbs = new FooGallery\_Thumbnails(); |
| [865](#L865) | try { |
| [866](#L866) | $results = $thumbs->run\_thumbnail\_generation\_tests(); |
| [867](#L867) |  |
| [868](#L868) | if ( $results['success'] ) { |
| [869](#L869) | echo  '<span style="color:#0c0">' . \_\_( 'Thumbnail generation test ran successfully.', 'foogallery' ) . '</span>' ; |
| [870](#L870) | } else { |
| [871](#L871) | echo  '<span style="color:#c00">' . \_\_( 'Thumbnail generation test failed!', 'foogallery' ) . '</span>' ; |
| [872](#L872) | var\_dump( $results['error'] ); |
| [873](#L873) | var\_dump( $results['file\_info'] ); |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | } catch ( Exception $e ) { |
| [877](#L877) | echo  'Exception: ' . $e->getMessage() ; |
| [878](#L878) | } |
| [879](#L879) | } |
| [880](#L880) |  |
| [881](#L881) | /\*\* |
| [882](#L882) | \* Returns the URL to the test image |
| [883](#L883) | \* |
| [884](#L884) | \* @return string |
| [885](#L885) | \*/ |
| [886](#L886) | function foogallery\_test\_thumb\_url() |
| [887](#L887) | { |
| [888](#L888) | return apply\_filters( 'foogallery\_test\_thumb\_url', FOOGALLERY\_URL . 'assets/logo.png' ); |
| [889](#L889) | } |
| [890](#L890) |  |
| [891](#L891) | /\*\* |
| [892](#L892) | \* Return all the gallery datasources used within FooGallery |
| [893](#L893) | \* |
| [894](#L894) | \* @return array |
| [895](#L895) | \*/ |
| [896](#L896) | function foogallery\_gallery\_datasources() |
| [897](#L897) | { |
| [898](#L898) | $default\_datasource = foogallery\_default\_datasource(); |
| [899](#L899) | $datasources[$default\_datasource] = array( |
| [900](#L900) | 'id'     => $default\_datasource, |
| [901](#L901) | 'name'   => \_\_( 'Media Library', 'foogalery' ), |
| [902](#L902) | 'label'  => \_\_( 'From Media Library', 'foogallery' ), |
| [903](#L903) | 'public' => false, |
| [904](#L904) | ); |
| [905](#L905) | return apply\_filters( 'foogallery\_gallery\_datasources', $datasources ); |
| [906](#L906) | } |
| [907](#L907) |  |
| [908](#L908) | /\*\* |
| [909](#L909) | \* Returns the default gallery datasource |
| [910](#L910) | \* |
| [911](#L911) | \* @return string |
| [912](#L912) | \*/ |
| [913](#L913) | function foogallery\_default\_datasource() |
| [914](#L914) | { |
| [915](#L915) | return foogallery\_get\_default( 'datasource', 'media\_library' ); |
| [916](#L916) | } |
| [917](#L917) |  |
| [918](#L918) | /\*\* |
| [919](#L919) | \* Returns the src to the built-in image placeholder |
| [920](#L920) | \* @return string |
| [921](#L921) | \*/ |
| [922](#L922) | function foogallery\_image\_placeholder\_src() |
| [923](#L923) | { |
| [924](#L924) | return apply\_filters( 'foogallery\_image\_placeholder\_src', FOOGALLERY\_URL . 'assets/image-placeholder.png' ); |
| [925](#L925) | } |
| [926](#L926) |  |
| [927](#L927) | /\*\* |
| [928](#L928) | \* Returns the image html for the built-in image placeholder |
| [929](#L929) | \* |
| [930](#L930) | \* @param array $args |
| [931](#L931) | \* |
| [932](#L932) | \* @return string |
| [933](#L933) | \*/ |
| [934](#L934) | function foogallery\_image\_placeholder\_html( $args ) |
| [935](#L935) | { |
| [936](#L936) | if ( !isset( $args ) ) { |
| [937](#L937) | $args = array( |
| [938](#L938) | 'width'  => 150, |
| [939](#L939) | 'height' => 150, |
| [940](#L940) | ); |
| [941](#L941) | } |
| [942](#L942) | $args['src'] = foogallery\_image\_placeholder\_src(); |
| [943](#L943) | $args = array\_map( 'esc\_attr', $args ); |
| [944](#L944) | $html = '<img '; |
| [945](#L945) | foreach ( $args as $name => $value ) { |
| [946](#L946) | $html .= " {$name}=" . '"' . $value . '"'; |
| [947](#L947) | } |
| [948](#L948) | $html .= ' />'; |
| [949](#L949) | return apply\_filters( 'foogallery\_image\_placeholder\_html', $html, $args ); |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | /\*\* |
| [953](#L953) | \* Returns the thumbnail html for the featured attachment for a gallery. |
| [954](#L954) | \* If no featured attachment can be found, then a placeholder image src is returned instead |
| [955](#L955) | \* |
| [956](#L956) | \* @param FooGallery $gallery |
| [957](#L957) | \* @param array $args |
| [958](#L958) | \* |
| [959](#L959) | \* @return string |
| [960](#L960) | \*/ |
| [961](#L961) | function foogallery\_find\_featured\_attachment\_thumbnail\_html( $gallery, $args = null ) |
| [962](#L962) | { |
| [963](#L963) | if ( !isset( $gallery ) || false === $gallery ) { |
| [964](#L964) | return ''; |
| [965](#L965) | } |
| [966](#L966) | if ( !isset( $args ) ) { |
| [967](#L967) | $args = array( |
| [968](#L968) | 'width'  => 150, |
| [969](#L969) | 'height' => 150, |
| [970](#L970) | ); |
| [971](#L971) | } |
| [972](#L972) | $featuredAttachment = $gallery->featured\_attachment(); |
| [973](#L973) |  |
| [974](#L974) | if ( $featuredAttachment ) { |
| [975](#L975) | return $featuredAttachment->html\_img( $args ); |
| [976](#L976) | } else { |
| [977](#L977) | //if we have no featured attachment, then use the built-in image placeholder |
| [978](#L978) | return foogallery\_image\_placeholder\_html( $args ); |
| [979](#L979) | } |
| [980](#L980) |  |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | /\*\* |
| [984](#L984) | \* Returns the thumbnail src for the featured attachment for a gallery. |
| [985](#L985) | \* If no featured attachment can be found, then a placeholder image src is returned instead |
| [986](#L986) | \* |
| [987](#L987) | \* @param FooGallery $gallery |
| [988](#L988) | \* @param array $args |
| [989](#L989) | \* |
| [990](#L990) | \* @return string |
| [991](#L991) | \*/ |
| [992](#L992) | function foogallery\_find\_featured\_attachment\_thumbnail\_src( $gallery, $args = null ) |
| [993](#L993) | { |
| [994](#L994) | if ( !isset( $gallery ) || false === $gallery ) { |
| [995](#L995) | return ''; |
| [996](#L996) | } |
| [997](#L997) | if ( !isset( $args ) ) { |
| [998](#L998) | $args = array( |
| [999](#L999) | 'width'  => 150, |
| [1000](#L1000) | 'height' => 150, |
| [1001](#L1001) | ); |
| [1002](#L1002) | } |
| [1003](#L1003) | $featuredAttachment = $gallery->featured\_attachment(); |
| [1004](#L1004) |  |
| [1005](#L1005) | if ( $featuredAttachment ) { |
| [1006](#L1006) | return $featuredAttachment->html\_img\_src( $args ); |
| [1007](#L1007) | } else { |
| [1008](#L1008) | //if we have no featured attachment, then use the built-in image placeholder |
| [1009](#L1009) | return foogallery\_image\_placeholder\_src(); |
| [1010](#L1010) | } |
| [1011](#L1011) |  |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) | /\*\* |
| [1015](#L1015) | \* Returns the available retina options that can be chosen |
| [1016](#L1016) | \*/ |
| [1017](#L1017) | function foogallery\_retina\_options() |
| [1018](#L1018) | { |
| [1019](#L1019) | return apply\_filters( 'foogallery\_retina\_options', array( |
| [1020](#L1020) | '2x' => \_\_( '2x', 'foogallery' ), |
| [1021](#L1021) | '3x' => \_\_( '3x', 'foogallery' ), |
| [1022](#L1022) | '4x' => \_\_( '4x', 'foogallery' ), |
| [1023](#L1023) | ) ); |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) | /\*\* |
| [1027](#L1027) | \* Does a full uninstall of the plugin including all data and settings! |
| [1028](#L1028) | \*/ |
| [1029](#L1029) | function foogallery\_uninstall() |
| [1030](#L1030) | { |
| [1031](#L1031) | if ( !current\_user\_can( 'install\_plugins' ) ) { |
| [1032](#L1032) | exit; |
| [1033](#L1033) | } |
| [1034](#L1034) | //delete all gallery posts first |
| [1035](#L1035) | global  $wpdb ; |
| [1036](#L1036) | $query = "SELECT p.ID FROM {$wpdb->posts} AS p WHERE p.post\_type IN (%s)"; |
| [1037](#L1037) | $gallery\_post\_ids = $wpdb->get\_col( $wpdb->prepare( $query, FOOGALLERY\_CPT\_GALLERY ) ); |
| [1038](#L1038) |  |
| [1039](#L1039) | if ( !empty($gallery\_post\_ids) ) { |
| [1040](#L1040) | $deleted = 0; |
| [1041](#L1041) | foreach ( $gallery\_post\_ids as $post\_id ) { |
| [1042](#L1042) | $del = wp\_delete\_post( $post\_id ); |
| [1043](#L1043) | if ( false !== $del ) { |
| [1044](#L1044) | ++$deleted; |
| [1045](#L1045) | } |
| [1046](#L1046) | } |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | //delete all options |
| [1050](#L1050) |  |
| [1051](#L1051) | if ( is\_network\_admin() ) { |
| [1052](#L1052) | delete\_site\_option( FOOGALLERY\_SLUG ); |
| [1053](#L1053) | } else { |
| [1054](#L1054) | delete\_option( FOOGALLERY\_SLUG ); |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | delete\_option( FOOGALLERY\_OPTION\_VERSION ); |
| [1058](#L1058) | delete\_option( FOOGALLERY\_OPTION\_THUMB\_TEST ); |
| [1059](#L1059) | delete\_option( FOOGALLERY\_EXTENSIONS\_ACTIVATED\_OPTIONS\_KEY ); |
| [1060](#L1060) | delete\_option( FOOGALLERY\_EXTENSIONS\_ERRORS\_OPTIONS\_KEY ); |
| [1061](#L1061) | //let any extensions clean up after themselves |
| [1062](#L1062) | do\_action( 'foogallery\_uninstall' ); |
| [1063](#L1063) | } |
| [1064](#L1064) |  |
| [1065](#L1065) | /\*\* |
| [1066](#L1066) | \* Returns an attachment field friendly name, based on a field name that is passed in |
| [1067](#L1067) | \* |
| [1068](#L1068) | \* @param $field |
| [1069](#L1069) | \* |
| [1070](#L1070) | \* @return string |
| [1071](#L1071) | \*/ |
| [1072](#L1072) | function foogallery\_get\_attachment\_field\_friendly\_name( $field ) |
| [1073](#L1073) | { |
| [1074](#L1074) | switch ( $field ) { |
| [1075](#L1075) | case 'title': |
| [1076](#L1076) | return \_\_( 'Attachment Title', 'foogallery' ); |
| [1077](#L1077) | case 'caption': |
| [1078](#L1078) | return \_\_( 'Attachment Caption', 'foogallery' ); |
| [1079](#L1079) | case 'desc': |
| [1080](#L1080) | return \_\_( 'Attachment Description', 'foogallery' ); |
| [1081](#L1081) | case 'alt': |
| [1082](#L1082) | return \_\_( 'Attachment Alt', 'foogallery' ); |
| [1083](#L1083) | } |
| [1084](#L1084) | } |
| [1085](#L1085) |  |
| [1086](#L1086) | /\*\* |
| [1087](#L1087) | \* Returns the fields for a specific gallery template |
| [1088](#L1088) | \* |
| [1089](#L1089) | \* @param $template mixed |
| [1090](#L1090) | \* @return mixed |
| [1091](#L1091) | \*/ |
| [1092](#L1092) | function foogallery\_get\_fields\_for\_template( $template ) |
| [1093](#L1093) | { |
| [1094](#L1094) | if ( is\_string( $template ) ) { |
| [1095](#L1095) | $template = foogallery\_get\_gallery\_template( $template ); |
| [1096](#L1096) | } |
| [1097](#L1097) | $fields = $template['fields']; |
| [1098](#L1098) | // Allow for extensions to override fields for every gallery template. |
| [1099](#L1099) | // Also passes the $template along so you can inspect and conditionally alter fields based on the template properties |
| [1100](#L1100) | $fields = apply\_filters( 'foogallery\_override\_gallery\_template\_fields', $fields, $template ); |
| [1101](#L1101) | // Allow for extensions to override fields for a specific gallery template. |
| [1102](#L1102) | // Also passes the $template along so you can inspect and conditionally alter fields based on the template properties |
| [1103](#L1103) | $fields = apply\_filters( "foogallery\_override\_gallery\_template\_fields-{$template['slug']}", $fields, $template ); |
| [1104](#L1104) | // Easily remove fields. |
| [1105](#L1105) | $fields\_to\_remove = apply\_filters( 'foogallery\_override\_gallery\_template\_fields\_remove', array(), $template ); |
| [1106](#L1106) | $fields\_to\_remove = apply\_filters( "foogallery\_override\_gallery\_template\_fields\_remove-{$template['slug']}", $fields\_to\_remove ); |
| [1107](#L1107) | // Easily set defaults for fields. |
| [1108](#L1108) | $override\_fields\_defaults = apply\_filters( 'foogallery\_override\_gallery\_template\_fields\_defaults', array(), $template ); |
| [1109](#L1109) | $override\_fields\_defaults = apply\_filters( "foogallery\_override\_gallery\_template\_fields\_defaults-{$template['slug']}", $override\_fields\_defaults ); |
| [1110](#L1110) | // Easily hide certain fields. |
| [1111](#L1111) | $fields\_to\_hide = apply\_filters( 'foogallery\_override\_gallery\_template\_fields\_hidden', array(), $template ); |
| [1112](#L1112) | $fields\_to\_hide = apply\_filters( "foogallery\_override\_gallery\_template\_fields\_hidden-{$template['slug']}", $fields\_to\_hide ); |
| [1113](#L1113) | $indexes\_to\_remove = array(); |
| [1114](#L1114) | foreach ( $fields as $key => &$field ) { |
| [1115](#L1115) | // Allow for the field to be altered by extensions. Also used by the build-in fields, e.g. lightbox. |
| [1116](#L1116) | $field = apply\_filters( 'foogallery\_alter\_gallery\_template\_field', $field, $template['slug'] ); |
| [1117](#L1117) |  |
| [1118](#L1118) | if ( in\_array( $field['id'], $fields\_to\_remove ) ) { |
| [1119](#L1119) | $indexes\_to\_remove[] = $key; |
| [1120](#L1120) | } else { |
| [1121](#L1121) | // Last time to set field defaults. |
| [1122](#L1122) | if ( array\_key\_exists( $field['id'], $override\_fields\_defaults ) ) { |
| [1123](#L1123) | $field['default'] = $override\_fields\_defaults[$field['id']]; |
| [1124](#L1124) | } |
| [1125](#L1125) | // Make fields invisible. |
| [1126](#L1126) |  |
| [1127](#L1127) | if ( in\_array( $field['id'], $fields\_to\_hide ) ) { |
| [1128](#L1128) | // Make sure the field is not visible. |
| [1129](#L1129) | $field['row\_data']['data-foogallery-invisible'] = true; |
| [1130](#L1130) | // Force the field to not be hidden, which means it's values can be used in previews. |
| [1131](#L1131) | if ( isset( $field['row\_data']['data-foogallery-hidden'] ) ) { |
| [1132](#L1132) | unset( $field['row\_data']['data-foogallery-hidden'] ); |
| [1133](#L1133) | } |
| [1134](#L1134) | // Remove the conditionals to FORCE the field to never be shown. |
| [1135](#L1135) | if ( isset( $field['row\_data']['data-foogallery-show-when-field'] ) ) { |
| [1136](#L1136) | unset( $field['row\_data']['data-foogallery-show-when-field'] ); |
| [1137](#L1137) | } |
| [1138](#L1138) | if ( isset( $field['row\_data']['data-foogallery-show-when-field-value'] ) ) { |
| [1139](#L1139) | unset( $field['row\_data']['data-foogallery-show-when-field-value'] ); |
| [1140](#L1140) | } |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) | } |
| [1144](#L1144) |  |
| [1145](#L1145) | } |
| [1146](#L1146) | // remove the fields that were marked for removal. |
| [1147](#L1147) | foreach ( $indexes\_to\_remove as $index ) { |
| [1148](#L1148) | unset( $fields[$index] ); |
| [1149](#L1149) | } |
| [1150](#L1150) | // Finally, sort the fields. |
| [1151](#L1151) | uasort( $fields, 'foogallery\_sort\_template\_fields' ); |
| [1152](#L1152) | return $fields; |
| [1153](#L1153) | } |
| [1154](#L1154) |  |
| [1155](#L1155) | /\*\* |
| [1156](#L1156) | \* Used to sort gallery template fields |
| [1157](#L1157) | \* |
| [1158](#L1158) | \* @param mixed $a |
| [1159](#L1159) | \* @param mixed $b |
| [1160](#L1160) | \* |
| [1161](#L1161) | \* @return int |
| [1162](#L1162) | \*/ |
| [1163](#L1163) | function foogallery\_sort\_template\_fields( $a, $b ) |
| [1164](#L1164) | { |
| [1165](#L1165) |  |
| [1166](#L1166) | if ( isset( $a['order'] ) && isset( $b['order'] ) ) { |
| [1167](#L1167) | if ( $a['order'] === $b['order'] ) { |
| [1168](#L1168) | return 0; |
| [1169](#L1169) | } |
| [1170](#L1170) | return ( $a['order'] < $b['order'] ? -1 : 1 ); |
| [1171](#L1171) | } |
| [1172](#L1172) |  |
| [1173](#L1173) | return 0; |
| [1174](#L1174) | } |
| [1175](#L1175) |  |
| [1176](#L1176) | /\*\* |
| [1177](#L1177) | \* Builds default settings for the supplied gallery template |
| [1178](#L1178) | \* |
| [1179](#L1179) | \* @param $template\_name |
| [1180](#L1180) | \* @return array |
| [1181](#L1181) | \*/ |
| [1182](#L1182) | function foogallery\_build\_default\_settings\_for\_gallery\_template( $template\_name ) |
| [1183](#L1183) | { |
| [1184](#L1184) | $fields = foogallery\_get\_fields\_for\_template( $template\_name ); |
| [1185](#L1185) | $settings = array(); |
| [1186](#L1186) | //loop through the fields and build up an array of keys and default values |
| [1187](#L1187) | foreach ( $fields as $field ) { |
| [1188](#L1188) | $default = ( array\_key\_exists( 'default', $field ) ? $field['default'] : false ); |
| [1189](#L1189) | if ( !empty($default) ) { |
| [1190](#L1190) | $settings["{$template\_name}\_{$field['id']}"] = $default; |
| [1191](#L1191) | } |
| [1192](#L1192) | } |
| [1193](#L1193) | return $settings; |
| [1194](#L1194) | } |
| [1195](#L1195) |  |
| [1196](#L1196) | /\*\* |
| [1197](#L1197) | \* Returns the choices used for the thumb link field type |
| [1198](#L1198) | \* @return array |
| [1199](#L1199) | \*/ |
| [1200](#L1200) | function foogallery\_gallery\_template\_field\_thumb\_link\_choices() |
| [1201](#L1201) | { |
| [1202](#L1202) | return apply\_filters( 'foogallery\_gallery\_template\_field\_thumb\_links', array( |
| [1203](#L1203) | 'image'  => \_\_( 'Full Size Image', 'foogallery' ), |
| [1204](#L1204) | 'page'   => \_\_( 'Image Attachment Page', 'foogallery' ), |
| [1205](#L1205) | 'custom' => \_\_( 'Custom URL', 'foogallery' ), |
| [1206](#L1206) | 'none'   => \_\_( 'Not linked', 'foogallery' ), |
| [1207](#L1207) | ) ); |
| [1208](#L1208) | } |
| [1209](#L1209) |  |
| [1210](#L1210) | /\*\* |
| [1211](#L1211) | \* Returns the choices used for the lightbox field type |
| [1212](#L1212) | \* @return array |
| [1213](#L1213) | \*/ |
| [1214](#L1214) | function foogallery\_gallery\_template\_field\_lightbox\_choices() |
| [1215](#L1215) | { |
| [1216](#L1216) | $lightboxes = apply\_filters( 'foogallery\_gallery\_template\_field\_lightboxes', array() ); |
| [1217](#L1217) | $lightboxes['none'] = \_\_( 'None', 'foogallery' ); |
| [1218](#L1218) | return $lightboxes; |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | if ( !function\_exists( 'wp\_get\_raw\_referer' ) ) { |
| [1222](#L1222) | /\*\* |
| [1223](#L1223) | \* Retrieves unvalidated referer from '\_wp\_http\_referer' or HTTP referer. |
| [1224](#L1224) | \* |
| [1225](#L1225) | \* Do not use for redirects, use {@see wp\_get\_referer()} instead. |
| [1226](#L1226) | \* |
| [1227](#L1227) | \* @since 1.4.9 |
| [1228](#L1228) | \* @return string|false Referer URL on success, false on failure. |
| [1229](#L1229) | \*/ |
| [1230](#L1230) | function wp\_get\_raw\_referer() |
| [1231](#L1231) | { |
| [1232](#L1232) |  |
| [1233](#L1233) | if ( !empty($\_REQUEST['\_wp\_http\_referer']) ) { |
| [1234](#L1234) | return wp\_unslash( $\_REQUEST['\_wp\_http\_referer'] ); |
| [1235](#L1235) | } else { |
| [1236](#L1236) | if ( !empty($\_SERVER['HTTP\_REFERER']) ) { |
| [1237](#L1237) | return wp\_unslash( $\_SERVER['HTTP\_REFERER'] ); |
| [1238](#L1238) | } |
| [1239](#L1239) | } |
| [1240](#L1240) |  |
| [1241](#L1241) | return false; |
| [1242](#L1242) | } |
| [1243](#L1243) |  |
| [1244](#L1244) | } |
| [1245](#L1245) | /\*\* |
| [1246](#L1246) | \* Return the attachments for the currently displayed gallery |
| [1247](#L1247) | \* |
| [1248](#L1248) | \* @return array |
| [1249](#L1249) | \*/ |
| [1250](#L1250) | function foogallery\_current\_gallery\_attachments\_for\_rendering() |
| [1251](#L1251) | { |
| [1252](#L1252) | global  $current\_foogallery ; |
| [1253](#L1253) | $attachments = apply\_filters( 'foogallery\_gallery\_attachments\_override\_for\_rendering', false, $current\_foogallery ); |
| [1254](#L1254) | if ( $attachments !== false ) { |
| [1255](#L1255) | return $attachments; |
| [1256](#L1256) | } |
| [1257](#L1257) | // by default, return all attachments. |
| [1258](#L1258) | return $current\_foogallery->attachments(); |
| [1259](#L1259) | } |
| [1260](#L1260) |  |
| [1261](#L1261) | /\*\* |
| [1262](#L1262) | \* Return attachment ID from a URL |
| [1263](#L1263) | \* |
| [1264](#L1264) | \* @param $url String URL to the image we are checking |
| [1265](#L1265) | \* |
| [1266](#L1266) | \* @return null or attachment ID |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | function foogallery\_get\_attachment\_id\_by\_url( $url ) |
| [1269](#L1269) | { |
| [1270](#L1270) | global  $wpdb ; |
| [1271](#L1271) | $query = "SELECT ID FROM {$wpdb->posts} WHERE guid=%s"; |
| [1272](#L1272) | $attachment = $wpdb->get\_col( $wpdb->prepare( $query, $url ) ); |
| [1273](#L1273) | if ( count( $attachment ) > 0 ) { |
| [1274](#L1274) | return $attachment[0]; |
| [1275](#L1275) | } |
| [1276](#L1276) | return null; |
| [1277](#L1277) | } |
| [1278](#L1278) |  |
| [1279](#L1279) | /\*\* |
| [1280](#L1280) | \* Safer escaping for HTML attributes. |
| [1281](#L1281) | \* |
| [1282](#L1282) | \* @since 1.4.31 |
| [1283](#L1283) | \* |
| [1284](#L1284) | \* @param string $text |
| [1285](#L1285) | \* @return string |
| [1286](#L1286) | \*/ |
| [1287](#L1287) | function foogallery\_esc\_attr( $text ) |
| [1288](#L1288) | { |
| [1289](#L1289) | $safe\_text = wp\_check\_invalid\_utf8( $text ); |
| [1290](#L1290) | $safe\_text = \_wp\_specialchars( |
| [1291](#L1291) | $safe\_text, |
| [1292](#L1292) | ENT\_QUOTES, |
| [1293](#L1293) | false, |
| [1294](#L1294) | true |
| [1295](#L1295) | ); |
| [1296](#L1296) | return $safe\_text; |
| [1297](#L1297) | } |
| [1298](#L1298) |  |
| [1299](#L1299) | /\*\* |
| [1300](#L1300) | \* Create a FooGallery and return the ID |
| [1301](#L1301) | \* |
| [1302](#L1302) | \* @param $template |
| [1303](#L1303) | \* @param $attachment\_ids |
| [1304](#L1304) | \* |
| [1305](#L1305) | \* @return int |
| [1306](#L1306) | \*/ |
| [1307](#L1307) | function foogallery\_create\_gallery( $template, $attachment\_ids ) |
| [1308](#L1308) | { |
| [1309](#L1309) | if ( empty($template) ) { |
| [1310](#L1310) | $template = foogallery\_default\_gallery\_template(); |
| [1311](#L1311) | } |
| [1312](#L1312) | //create an empty foogallery |
| [1313](#L1313) | $foogallery\_args = array( |
| [1314](#L1314) | 'post\_title'  => 'Demo Gallery', |
| [1315](#L1315) | 'post\_type'   => FOOGALLERY\_CPT\_GALLERY, |
| [1316](#L1316) | 'post\_status' => 'publish', |
| [1317](#L1317) | ); |
| [1318](#L1318) | $gallery\_id = wp\_insert\_post( $foogallery\_args ); |
| [1319](#L1319) | //set a gallery template |
| [1320](#L1320) | add\_post\_meta( |
| [1321](#L1321) | $gallery\_id, |
| [1322](#L1322) | FOOGALLERY\_META\_TEMPLATE, |
| [1323](#L1323) | $template, |
| [1324](#L1324) | true |
| [1325](#L1325) | ); |
| [1326](#L1326) | $settings = array(); |
| [1327](#L1327) | //set default settings if there are any, and also if the template is the same as the default |
| [1328](#L1328) |  |
| [1329](#L1329) | if ( foogallery\_default\_gallery\_template() === $template ) { |
| [1330](#L1330) | $default\_gallery\_id = foogallery\_get\_setting( 'default\_gallery\_settings' ); |
| [1331](#L1331) |  |
| [1332](#L1332) | if ( $default\_gallery\_id ) { |
| [1333](#L1333) | $settings = get\_post\_meta( $default\_gallery\_id, FOOGALLERY\_META\_SETTINGS, true ); |
| [1334](#L1334) | add\_post\_meta( |
| [1335](#L1335) | $gallery\_id, |
| [1336](#L1336) | FOOGALLERY\_META\_SETTINGS, |
| [1337](#L1337) | $settings, |
| [1338](#L1338) | true |
| [1339](#L1339) | ); |
| [1340](#L1340) | } |
| [1341](#L1341) |  |
| [1342](#L1342) | } |
| [1343](#L1343) |  |
| [1344](#L1344) | if ( empty($settings) ) { |
| [1345](#L1345) | switch ( $template ) { |
| [1346](#L1346) | case 'masonry': |
| [1347](#L1347) | $settings = array( |
| [1348](#L1348) | 'foogallery\_items\_view'                   => 'preview', |
| [1349](#L1349) | 'masonry\_alignment'                       => 'fg-center', |
| [1350](#L1350) | 'masonry\_border\_size'                     => 'fg-border-thin', |
| [1351](#L1351) | 'masonry\_caption\_desc\_source'             => '', |
| [1352](#L1352) | 'masonry\_caption\_title\_source'            => '', |
| [1353](#L1353) | 'masonry\_captions\_limit\_length'           => '', |
| [1354](#L1354) | 'masonry\_custom\_settings'                 => '', |
| [1355](#L1355) | 'masonry\_drop\_shadow'                     => 'fg-shadow-outline', |
| [1356](#L1356) | 'masonry\_filtering\_type'                  => '', |
| [1357](#L1357) | 'masonry\_gutter\_width'                    => '10', |
| [1358](#L1358) | 'masonry\_hover\_effect\_caption\_visibility' => 'fg-captions-bottom', |
| [1359](#L1359) | 'masonry\_hover\_effect\_color'              => '', |
| [1360](#L1360) | 'masonry\_hover\_effect\_icon'               => 'fg-hover-zoom', |
| [1361](#L1361) | 'masonry\_hover\_effect\_preset'             => 'fg-custom', |
| [1362](#L1362) | 'masonry\_hover\_effect\_scale'              => '', |
| [1363](#L1363) | 'masonry\_hover\_effect\_transition'         => 'fg-hover-fade', |
| [1364](#L1364) | 'masonry\_inner\_shadow'                    => '', |
| [1365](#L1365) | 'masonry\_layout'                          => 'fixed', |
| [1366](#L1366) | 'masonry\_lazyload'                        => '', |
| [1367](#L1367) | 'masonry\_lightbox'                        => 'foobox', |
| [1368](#L1368) | 'masonry\_loaded\_effect'                   => 'fg-loaded-fade-in', |
| [1369](#L1369) | 'masonry\_loading\_icon'                    => 'fg-loading-default', |
| [1370](#L1370) | 'masonry\_paging\_type'                     => '', |
| [1371](#L1371) | 'masonry\_rounded\_corners'                 => '', |
| [1372](#L1372) | 'masonry\_state'                           => 'no', |
| [1373](#L1373) | 'masonry\_theme'                           => 'fg-dark', |
| [1374](#L1374) | 'masonry\_thumbnail\_link'                  => 'image', |
| [1375](#L1375) | 'masonry\_thumbnail\_width'                 => '250', |
| [1376](#L1376) | 'masonry\_video\_autoplay'                  => 'yes', |
| [1377](#L1377) | 'masonry\_video\_hover\_icon'                => 'fg-video-default', |
| [1378](#L1378) | 'masonry\_video\_size'                      => '640x360', |
| [1379](#L1379) | 'masonry\_video\_sticky\_icon'               => '', |
| [1380](#L1380) | ); |
| [1381](#L1381) | } |
| [1382](#L1382) | } |
| [1383](#L1383) | add\_post\_meta( |
| [1384](#L1384) | $gallery\_id, |
| [1385](#L1385) | FOOGALLERY\_META\_SETTINGS, |
| [1386](#L1386) | $settings, |
| [1387](#L1387) | true |
| [1388](#L1388) | ); |
| [1389](#L1389) | $attachments = explode( ',', $attachment\_ids ); |
| [1390](#L1390) | update\_post\_meta( $gallery\_id, FOOGALLERY\_META\_ATTACHMENTS, $attachments ); |
| [1391](#L1391) | return $gallery\_id; |
| [1392](#L1392) | } |
| [1393](#L1393) |  |
| [1394](#L1394) | /\*\* |
| [1395](#L1395) | \* Returns an array of marketing demos |
| [1396](#L1396) | \* @return array |
| [1397](#L1397) | \*/ |
| [1398](#L1398) | function foogallery\_marketing\_demos() |
| [1399](#L1399) | { |
| [1400](#L1400) | $demos = array(); |
| [1401](#L1401) | $demos[] = array( |
| [1402](#L1402) | 'demo'    => \_\_( 'Responsive Image Gallery', 'foogallery' ), |
| [1403](#L1403) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1404](#L1404) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/responsive-image-gallery/', |
| [1405](#L1405) | ); |
| [1406](#L1406) | $demos[] = array( |
| [1407](#L1407) | 'demo'    => \_\_( 'Masonry Image Gallery', 'foogallery' ), |
| [1408](#L1408) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1409](#L1409) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/masonry-gallery/', |
| [1410](#L1410) | ); |
| [1411](#L1411) | $demos[] = array( |
| [1412](#L1412) | 'demo'    => \_\_( 'Justified Gallery', 'foogallery' ), |
| [1413](#L1413) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1414](#L1414) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/justified-gallery/', |
| [1415](#L1415) | ); |
| [1416](#L1416) | $demos[] = array( |
| [1417](#L1417) | 'demo'    => \_\_( 'Image Viewer Gallery', 'foogallery' ), |
| [1418](#L1418) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1419](#L1419) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/image-viewer-gallery/', |
| [1420](#L1420) | ); |
| [1421](#L1421) | $demos[] = array( |
| [1422](#L1422) | 'demo'    => \_\_( 'Simple Portfolio Gallery', 'foogallery' ), |
| [1423](#L1423) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1424](#L1424) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/wordpress-portfolio-gallery/', |
| [1425](#L1425) | ); |
| [1426](#L1426) | $demos[] = array( |
| [1427](#L1427) | 'demo'    => \_\_( 'Single Thumbnail Gallery', 'foogallery' ), |
| [1428](#L1428) | 'section' => \_\_( 'Standard Gallery Demos', 'foogallery' ), |
| [1429](#L1429) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/single-thumbnail-gallery/', |
| [1430](#L1430) | ); |
| [1431](#L1431) | $demos[] = array( |
| [1432](#L1432) | 'demo'    => \_\_( 'Grid PRO Gallery', 'foogallery' ), |
| [1433](#L1433) | 'section' => \_\_( 'PRO Gallery Demos', 'foogallery' ), |
| [1434](#L1434) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/grid-gallery/', |
| [1435](#L1435) | ); |
| [1436](#L1436) | $demos[] = array( |
| [1437](#L1437) | 'demo'    => \_\_( 'Polaroid PRO Gallery', 'foogallery' ), |
| [1438](#L1438) | 'section' => \_\_( 'PRO Gallery Demos', 'foogallery' ), |
| [1439](#L1439) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/polaroid-gallery/', |
| [1440](#L1440) | ); |
| [1441](#L1441) | $demos[] = array( |
| [1442](#L1442) | 'demo'    => \_\_( 'Slider PRO Gallery', 'foogallery' ), |
| [1443](#L1443) | 'section' => \_\_( 'PRO Gallery Demos', 'foogallery' ), |
| [1444](#L1444) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/slider-gallery/', |
| [1445](#L1445) | ); |
| [1446](#L1446) | $demos[] = array( |
| [1447](#L1447) | 'demo'    => \_\_( 'Hover Presets Demo', 'foogallery' ), |
| [1448](#L1448) | 'section' => \_\_( 'PRO Features', 'foogallery' ), |
| [1449](#L1449) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/hover-presets/', |
| [1450](#L1450) | ); |
| [1451](#L1451) | $demos[] = array( |
| [1452](#L1452) | 'demo'    => \_\_( 'Filtering Demos', 'foogallery' ), |
| [1453](#L1453) | 'section' => \_\_( 'PRO Features', 'foogallery' ), |
| [1454](#L1454) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/filtering/', |
| [1455](#L1455) | ); |
| [1456](#L1456) | $demos[] = array( |
| [1457](#L1457) | 'demo'    => \_\_( 'Pagination Types Demo', 'foogallery' ), |
| [1458](#L1458) | 'section' => \_\_( 'PRO Features', 'foogallery' ), |
| [1459](#L1459) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/pagination/', |
| [1460](#L1460) | ); |
| [1461](#L1461) | $demos[] = array( |
| [1462](#L1462) | 'demo'    => \_\_( 'Video Gallery Demos', 'foogallery' ), |
| [1463](#L1463) | 'section' => \_\_( 'PRO Features', 'foogallery' ), |
| [1464](#L1464) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/video-gallery/', |
| [1465](#L1465) | ); |
| [1466](#L1466) | $demos[] = array( |
| [1467](#L1467) | 'demo'    => \_\_( 'Bulk Copy (admin)', 'foogallery' ), |
| [1468](#L1468) | 'section' => \_\_( 'PRO Features', 'foogallery' ), |
| [1469](#L1469) | 'href'    => 'https://fooplugins.com/bulk-copy-foogallery-pro/', |
| [1470](#L1470) | ); |
| [1471](#L1471) | $demos[] = array( |
| [1472](#L1472) | 'demo'    => \_\_( 'Albums', 'foogallery' ), |
| [1473](#L1473) | 'section' => \_\_( 'Album Demos', 'foogallery' ), |
| [1474](#L1474) | 'href'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/wordpress-album-gallery/', |
| [1475](#L1475) | ); |
| [1476](#L1476) | return $demos; |
| [1477](#L1477) | } |
| [1478](#L1478) |  |
| [1479](#L1479) | /\*\* |
| [1480](#L1480) | \* Returns an array of the PRO features |
| [1481](#L1481) | \* @return array |
| [1482](#L1482) | \*/ |
| [1483](#L1483) | function foogallery\_marketing\_pro\_features() |
| [1484](#L1484) | { |
| [1485](#L1485) | $features[] = array( |
| [1486](#L1486) | 'feature' => \_\_( 'Video Galleries', 'foogallery' ), |
| [1487](#L1487) | 'desc'    => \_\_( 'Create beautiful video galleries from YouTube, Vimeo, Facebook, Wistia and more!', 'foogallery' ), |
| [1488](#L1488) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/video-gallery/', |
| [1489](#L1489) | ); |
| [1490](#L1490) | $features[] = array( |
| [1491](#L1491) | 'feature' => \_\_( 'Media Tags + Filtering', 'foogallery' ), |
| [1492](#L1492) | 'desc'    => \_\_( 'Assign tags to your media, which allows visitors to filter the galleries by tag.', 'foogallery' ), |
| [1493](#L1493) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/filtering/', |
| [1494](#L1494) | ); |
| [1495](#L1495) | $features[] = array( |
| [1496](#L1496) | 'feature' => \_\_( 'More Gallery Templates', 'foogallery' ), |
| [1497](#L1497) | 'desc'    => \_\_( '3 more awesome gallery templates, including Slider, Grid and Polaroid.', 'foogallery' ), |
| [1498](#L1498) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/slider-gallery/', |
| [1499](#L1499) | ); |
| [1500](#L1500) | $features[] = array( |
| [1501](#L1501) | 'feature' => \_\_( 'Preset Hover Effects', 'foogallery' ), |
| [1502](#L1502) | 'desc'    => \_\_( 'Choose from 11 beautifully designed preset hover effects.', 'foogallery' ), |
| [1503](#L1503) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/hover-presets/', |
| [1504](#L1504) | ); |
| [1505](#L1505) | $features[] = array( |
| [1506](#L1506) | 'feature' => \_\_( 'Advanced Pagination + Infinite Scroll', 'foogallery' ), |
| [1507](#L1507) | 'desc'    => \_\_( 'Choose from more paging types like numbered, load more or infinite scroll.', 'foogallery' ), |
| [1508](#L1508) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/pagination/', |
| [1509](#L1509) | ); |
| [1510](#L1510) | $features[] = array( |
| [1511](#L1511) | 'feature' => \_\_( 'Animated Loading Effects', 'foogallery' ), |
| [1512](#L1512) | 'desc'    => \_\_( 'Choose from 9 awesome animation effects to display as your galleries load.', 'foogallery' ), |
| [1513](#L1513) | 'demo'    => 'https://fooplugins.com/foogallery-wordpress-gallery-plugin/animated-loaded-effects/', |
| [1514](#L1514) | ); |
| [1515](#L1515) | $features[] = array( |
| [1516](#L1516) | 'feature' => \_\_( 'Bulk Copy Settings', 'foogallery' ), |
| [1517](#L1517) | 'desc'    => \_\_( 'Bulk copy your gallery settings to other galleries in a flash.', 'foogallery' ), |
| [1518](#L1518) | 'demo'    => 'https://fooplugins.com/bulk-copy-foogallery-pro/', |
| [1519](#L1519) | ); |
| [1520](#L1520) | return $features; |
| [1521](#L1521) | } |
| [1522](#L1522) |  |
| [1523](#L1523) | /\*\* |
| [1524](#L1524) | \* Returns the allowed post types that galleries can be attached to |
| [1525](#L1525) | \* @return array |
| [1526](#L1526) | \*/ |
| [1527](#L1527) | function foogallery\_allowed\_post\_types\_for\_usage() |
| [1528](#L1528) | { |
| [1529](#L1529) | $allowed\_post\_types = apply\_filters( 'foogallery\_allowed\_post\_types\_for\_attachment', array( 'post', 'page' ) ); |
| [1530](#L1530) | // Use foogallery\_get\_setting to retrieve the selected custom post types. |
| [1531](#L1531) | $selected\_custom\_post\_types = foogallery\_get\_setting( 'allowed\_custom\_post\_types', array() ); |
| [1532](#L1532) | if ( !is\_array( $selected\_custom\_post\_types ) ) { |
| [1533](#L1533) | $selected\_custom\_post\_types = array(); |
| [1534](#L1534) | } |
| [1535](#L1535) | // Merge the selected custom post types with the default allowed post types. |
| [1536](#L1536) | $allowed\_post\_types = array\_merge( $allowed\_post\_types, $selected\_custom\_post\_types ); |
| [1537](#L1537) | return $allowed\_post\_types; |
| [1538](#L1538) | } |
| [1539](#L1539) |  |
| [1540](#L1540) | /\*\* |
| [1541](#L1541) | \* Returns true if FooGallery is in debug mode |
| [1542](#L1542) | \* @return bool |
| [1543](#L1543) | \*/ |
| [1544](#L1544) | function foogallery\_is\_debug() |
| [1545](#L1545) | { |
| [1546](#L1546) | return foogallery\_get\_setting( 'enable\_debugging', false ); |
| [1547](#L1547) | } |
| [1548](#L1548) |  |
| [1549](#L1549) | /\*\* |
| [1550](#L1550) | \* Get the current gallery in the admin |
| [1551](#L1551) | \* @param $post\_gallery |
| [1552](#L1552) | \* |
| [1553](#L1553) | \* @return FooGallery|null |
| [1554](#L1554) | \*/ |
| [1555](#L1555) | function foogallery\_admin\_get\_current\_gallery( $post\_gallery ) |
| [1556](#L1556) | { |
| [1557](#L1557) | global  $post ; |
| [1558](#L1558) | global  $current\_foogallery\_admin ; |
| [1559](#L1559) |  |
| [1560](#L1560) | if ( is\_admin() && isset( $post ) ) { |
| [1561](#L1561) | if ( !isset( $current\_foogallery\_admin ) || $post\_gallery->ID !== $post->ID ) { |
| [1562](#L1562) | $current\_foogallery\_admin = FooGallery::get( $post\_gallery ); |
| [1563](#L1563) | } |
| [1564](#L1564) | return $current\_foogallery\_admin; |
| [1565](#L1565) | } |
| [1566](#L1566) |  |
| [1567](#L1567) | return null; |
| [1568](#L1568) | } |
| [1569](#L1569) |  |
| [1570](#L1570) | /\*\* |
| [1571](#L1571) | \* Takes an RGB string and returns an array of the colors |
| [1572](#L1572) | \* @param string $rgba RBG color string in the format rgb(0,0,0) |
| [1573](#L1573) | \* |
| [1574](#L1574) | \* @return array|int[] |
| [1575](#L1575) | \*/ |
| [1576](#L1576) | function foogallery\_rgb\_to\_color\_array( $rgba ) |
| [1577](#L1577) | { |
| [1578](#L1578) | if ( empty($rgba) ) { |
| [1579](#L1579) | return array( 0, 0, 0 ); |
| [1580](#L1580) | } |
| [1581](#L1581) | preg\_match( '/^rgba?[\\s+]?\\([\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?,[\\s+]?(\\d+)[\\s+]?/i', $rgba, $by\_color ); |
| [1582](#L1582) | if ( count( $by\_color ) >= 3 ) { |
| [1583](#L1583) | return array( $by\_color[1], $by\_color[2], $by\_color[3] ); |
| [1584](#L1584) | } |
| [1585](#L1585) | //return black if there was a problem getting the color |
| [1586](#L1586) | return array( 0, 0, 0 ); |
| [1587](#L1587) | } |
| [1588](#L1588) |  |
| [1589](#L1589) | /\*\* |
| [1590](#L1590) | \* Sanitize HTML to make it safe to output. Used to sanitize potentially harmful HTML used for captions |
| [1591](#L1591) | \* |
| [1592](#L1592) | \* @since 1.9.23 |
| [1593](#L1593) | \* |
| [1594](#L1594) | \* @param string $text |
| [1595](#L1595) | \* @return string |
| [1596](#L1596) | \*/ |
| [1597](#L1597) | function foogallery\_sanitize\_html( $text ) |
| [1598](#L1598) | { |
| [1599](#L1599) | $safe\_text = wp\_kses\_post( $text ); |
| [1600](#L1600) | return $safe\_text; |
| [1601](#L1601) | } |
| [1602](#L1602) |  |
| [1603](#L1603) | /\*\* |
| [1604](#L1604) | \* Filter out JavaScript-related keywords from an input string |
| [1605](#L1605) | \* |
| [1606](#L1606) | \* @param string $input |
| [1607](#L1607) | \* @return string |
| [1608](#L1608) | \*/ |
| [1609](#L1609) | function foogallery\_sanitize\_javascript( $input ) |
| [1610](#L1610) | { |
| [1611](#L1611) | // list of JavaScript-related attributes to filter out |
| [1612](#L1612) | $javascript\_attributes = array( |
| [1613](#L1613) | 'innerHTML', |
| [1614](#L1614) | 'document\\.write', |
| [1615](#L1615) | 'eval', |
| [1616](#L1616) | 'Function\\(', |
| [1617](#L1617) | 'setTimeout', |
| [1618](#L1618) | 'setInterval', |
| [1619](#L1619) | 'new Function\\(', |
| [1620](#L1620) | 'onmouseover', |
| [1621](#L1621) | 'onmouseout', |
| [1622](#L1622) | 'onclick', |
| [1623](#L1623) | 'onload', |
| [1624](#L1624) | 'onchange', |
| [1625](#L1625) | '<script>', |
| [1626](#L1626) | 'encodeURIComponent', |
| [1627](#L1627) | 'decodeURIComponent', |
| [1628](#L1628) | 'JSON\\.parse', |
| [1629](#L1629) | 'outerHTML', |
| [1630](#L1630) | 'innerHTML', |
| [1631](#L1631) | 'XMLHttpRequest', |
| [1632](#L1632) | 'createElement', |
| [1633](#L1633) | 'appendChild', |
| [1634](#L1634) | 'RegExp', |
| [1635](#L1635) | 'String\\.fromCharCode', |
| [1636](#L1636) | 'encodeURI', |
| [1637](#L1637) | 'decodeURI', |
| [1638](#L1638) | 'javascript:' |
| [1639](#L1639) | ); |
| [1640](#L1640) | $pattern = '/' . implode( '|', $javascript\_attributes ) . '/i'; |
| [1641](#L1641) | // Use regex to replace potentially dangerous strings with an empty string |
| [1642](#L1642) | $input = preg\_replace( $pattern, '', $input ); |
| [1643](#L1643) | return $input; |
| [1644](#L1644) | } |
| [1645](#L1645) |  |
| [1646](#L1646) | /\*\* |
| [1647](#L1647) | \* Returns true if PRO is in use |
| [1648](#L1648) | \* @return bool |
| [1649](#L1649) | \*/ |
| [1650](#L1650) | function foogallery\_is\_pro() |
| [1651](#L1651) | { |
| [1652](#L1652) | $pro = false; |
| [1653](#L1653) | return $pro; |
| [1654](#L1654) | } |
| [1655](#L1655) |  |
| [1656](#L1656) | /\*\* |
| [1657](#L1657) | \* Safe function for encoding objects to json |
| [1658](#L1658) | \* |
| [1659](#L1659) | \* @param $value |
| [1660](#L1660) | \* |
| [1661](#L1661) | \* @return false|string |
| [1662](#L1662) | \*/ |
| [1663](#L1663) | function foogallery\_json\_encode( $value ) |
| [1664](#L1664) | { |
| [1665](#L1665) | $flags = JSON\_UNESCAPED\_SLASHES; |
| [1666](#L1666) | if ( defined( 'JSON\_UNESCAPED\_UNICODE' ) ) { |
| [1667](#L1667) | $flags = JSON\_UNESCAPED\_UNICODE | $flags; |
| [1668](#L1668) | } |
| [1669](#L1669) | $flags = apply\_filters( 'foogallery\_json\_encode\_flags', $flags ); |
| [1670](#L1670) | return json\_encode( $value, $flags ); |
| [1671](#L1671) | } |
| [1672](#L1672) |  |
| [1673](#L1673) | /\*\* |
| [1674](#L1674) | \* Get a language array entry which gets a value from settings |
| [1675](#L1675) | \* @param $setting\_key |
| [1676](#L1676) | \* @param $default |
| [1677](#L1677) | \* |
| [1678](#L1678) | \* @return string|false |
| [1679](#L1679) | \*/ |
| [1680](#L1680) | function foogallery\_get\_language\_array\_value( $setting\_key, $default ) |
| [1681](#L1681) | { |
| [1682](#L1682) | $setting\_value = foogallery\_get\_setting( $setting\_key, $default ); |
| [1683](#L1683) | if ( empty($setting\_value) ) { |
| [1684](#L1684) | $setting\_value = $default; |
| [1685](#L1685) | } |
| [1686](#L1686) | if ( $default !== $setting\_value ) { |
| [1687](#L1687) | return $setting\_value; |
| [1688](#L1688) | } |
| [1689](#L1689) | return false; |
| [1690](#L1690) | } |
| [1691](#L1691) |  |
| [1692](#L1692) | /\*\* |
| [1693](#L1693) | \* Safely returns the WP Filesystem instance for use in FooGallery |
| [1694](#L1694) | \* |
| [1695](#L1695) | \* @return WP\_Filesystem\_Base |
| [1696](#L1696) | \*/ |
| [1697](#L1697) | function foogallery\_wp\_filesystem() |
| [1698](#L1698) | { |
| [1699](#L1699) | global  $wp\_filesystem ; |
| [1700](#L1700) | if ( !function\_exists( 'WP\_Filesystem' ) ) { |
| [1701](#L1701) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [1702](#L1702) | } |
| [1703](#L1703) | if ( !WP\_Filesystem( true ) ) { |
| [1704](#L1704) | return false; |
| [1705](#L1705) | } |
| [1706](#L1706) | return $wp\_filesystem; |
| [1707](#L1707) | } |
| [1708](#L1708) |  |
| [1709](#L1709) | /\*\* |
| [1710](#L1710) | \* Returns a formatted date |
| [1711](#L1711) | \* |
| [1712](#L1712) | \* @param        $timestamp |
| [1713](#L1713) | \* @param string $format |
| [1714](#L1714) | \* |
| [1715](#L1715) | \* @return string |
| [1716](#L1716) | \*/ |
| [1717](#L1717) | function foogallery\_format\_date( $timestamp, $format = null ) |
| [1718](#L1718) | { |
| [1719](#L1719) | if ( !$format ) { |
| [1720](#L1720) | $format = get\_option( 'date\_format' ); |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | if ( function\_exists( 'wp\_date' ) ) { |
| [1724](#L1724) | return wp\_date( $format, $timestamp ); |
| [1725](#L1725) | } else { |
| [1726](#L1726) | $datetime = date\_create( '@' . $timestamp ); |
| [1727](#L1727) | $timezone = wp\_timezone(); |
| [1728](#L1728) | $datetime->setTimezone( $timezone ); |
| [1729](#L1729) | return $datetime->format( $format ); |
| [1730](#L1730) | } |
| [1731](#L1731) |  |
| [1732](#L1732) | } |
| [1733](#L1733) |  |
| [1734](#L1734) | /\*\* |
| [1735](#L1735) | \* Shortcut method to safely check if the current gallery template supports a specific feature |
| [1736](#L1736) | \* |
| [1737](#L1737) | \* e.g. panel\_support, preview\_support, common\_fields\_support, lazyload\_support, paging\_support, filtering\_support |
| [1738](#L1738) | \* |
| [1739](#L1739) | \* @param      $feature\_to\_check |
| [1740](#L1740) | \* @param bool $value\_to\_check |
| [1741](#L1741) | \* |
| [1742](#L1742) | \* @return bool |
| [1743](#L1743) | \*/ |
| [1744](#L1744) | function foogallery\_current\_gallery\_check\_template\_has\_supported\_feature( $feature\_to\_check, $value\_to\_check = true ) |
| [1745](#L1745) | { |
| [1746](#L1746) | global  $current\_foogallery ; |
| [1747](#L1747) | //get out early if there is no current gallery |
| [1748](#L1748) | if ( !isset( $current\_foogallery ) ) { |
| [1749](#L1749) | return false; |
| [1750](#L1750) | } |
| [1751](#L1751) | //check if we have previously checked before recently |
| [1752](#L1752) |  |
| [1753](#L1753) | if ( isset( $current\_foogallery->supports ) && is\_array( $current\_foogallery->supports ) && array\_key\_exists( $feature\_to\_check, $current\_foogallery->supports ) ) { |
| [1754](#L1754) | return $current\_foogallery->supports[$feature\_to\_check] === $value\_to\_check; |
| [1755](#L1755) | } else { |
| [1756](#L1756) | //check if we need to init the array |
| [1757](#L1757) | if ( !isset( $current\_foogallery->supports ) || !is\_array( $current\_foogallery->supports ) ) { |
| [1758](#L1758) | $current\_foogallery->supports = array(); |
| [1759](#L1759) | } |
| [1760](#L1760) |  |
| [1761](#L1761) | if ( !array\_key\_exists( $feature\_to\_check, $current\_foogallery->supports ) ) { |
| [1762](#L1762) | $template\_object = foogallery\_get\_gallery\_template( $current\_foogallery->gallery\_template ); |
| [1763](#L1763) |  |
| [1764](#L1764) | if ( $template\_object && is\_array( $template\_object ) && array\_key\_exists( $feature\_to\_check, $template\_object ) ) { |
| [1765](#L1765) | $current\_foogallery->supports[$feature\_to\_check] = $template\_object[$feature\_to\_check]; |
| [1766](#L1766) | } else { |
| [1767](#L1767) | //this is not stored against the template config, so assume it does not have the feature support |
| [1768](#L1768) | $current\_foogallery->supports[$feature\_to\_check] = false; |
| [1769](#L1769) | } |
| [1770](#L1770) |  |
| [1771](#L1771) | } |
| [1772](#L1772) |  |
| [1773](#L1773) | return $current\_foogallery->supports[$feature\_to\_check] === $value\_to\_check; |
| [1774](#L1774) | } |
| [1775](#L1775) |  |
| [1776](#L1776) | } |
| [1777](#L1777) |  |
| [1778](#L1778) | /\*\* |
| [1779](#L1779) | \* Checks to see if we have a cached value stored against the current gallery |
| [1780](#L1780) | \* Certain values are cached against the gallery if they have to be done multiple times, for example for each item in the gallery |
| [1781](#L1781) | \* |
| [1782](#L1782) | \* @param $cache\_key |
| [1783](#L1783) | \* |
| [1784](#L1784) | \* @return bool |
| [1785](#L1785) | \*/ |
| [1786](#L1786) | function foogallery\_current\_gallery\_has\_cached\_value( $cache\_key ) |
| [1787](#L1787) | { |
| [1788](#L1788) | global  $current\_foogallery ; |
| [1789](#L1789) | //get out early if there is no current gallery |
| [1790](#L1790) |  |
| [1791](#L1791) | if ( !isset( $current\_foogallery ) ) { |
| [1792](#L1792) | return true; |
| [1793](#L1793) | //this is to ensure we short-circuit having to calculate the cached value later |
| [1794](#L1794) | } |
| [1795](#L1795) |  |
| [1796](#L1796) | return isset( $current\_foogallery->cached\_values ) && is\_array( $current\_foogallery->cached\_values ) && array\_key\_exists( $cache\_key, $current\_foogallery->cached\_values ); |
| [1797](#L1797) | } |
| [1798](#L1798) |  |
| [1799](#L1799) | /\*\* |
| [1800](#L1800) | \* Stores a value against the current gallery |
| [1801](#L1801) | \* |
| [1802](#L1802) | \* @param $cache\_key |
| [1803](#L1803) | \* @param $cache\_value |
| [1804](#L1804) | \*/ |
| [1805](#L1805) | function foogallery\_current\_gallery\_set\_cached\_value( $cache\_key, $cache\_value ) |
| [1806](#L1806) | { |
| [1807](#L1807) | global  $current\_foogallery ; |
| [1808](#L1808) | //get out early if there is no current gallery |
| [1809](#L1809) | if ( !isset( $current\_foogallery ) ) { |
| [1810](#L1810) | return; |
| [1811](#L1811) | } |
| [1812](#L1812) | //check if we need to init the array |
| [1813](#L1813) | if ( !isset( $current\_foogallery->cached\_values ) || !is\_array( $current\_foogallery->cached\_values ) ) { |
| [1814](#L1814) | $current\_foogallery->cached\_values = array(); |
| [1815](#L1815) | } |
| [1816](#L1816) | //store the value for later use |
| [1817](#L1817) | $current\_foogallery->cached\_values[$cache\_key] = $cache\_value; |
| [1818](#L1818) | } |
| [1819](#L1819) |  |
| [1820](#L1820) | /\*\* |
| [1821](#L1821) | \* Set the value of a cached value for the current gallery |
| [1822](#L1822) | \* |
| [1823](#L1823) | \* @param $cache\_value |
| [1824](#L1824) | \* |
| [1825](#L1825) | \* @return mixed |
| [1826](#L1826) | \*/ |
| [1827](#L1827) | function foogallery\_current\_gallery\_get\_cached\_value( $cache\_value ) |
| [1828](#L1828) | { |
| [1829](#L1829) | global  $current\_foogallery ; |
| [1830](#L1830) | //get out early if there is no current gallery |
| [1831](#L1831) | if ( !isset( $current\_foogallery ) ) { |
| [1832](#L1832) | return false; |
| [1833](#L1833) | } |
| [1834](#L1834) | if ( isset( $current\_foogallery->cached\_values ) && is\_array( $current\_foogallery->cached\_values ) && array\_key\_exists( $cache\_value, $current\_foogallery->cached\_values ) ) { |
| [1835](#L1835) | return $current\_foogallery->cached\_values[$cache\_value]; |
| [1836](#L1836) | } |
| [1837](#L1837) | return false; |
| [1838](#L1838) | } |
| [1839](#L1839) |  |
| [1840](#L1840) | /\*\* |
| [1841](#L1841) | \* functions related to thumbnail generation within FooGallery |
| [1842](#L1842) | \*/ |
| [1843](#L1843) | /\*\* |
| [1844](#L1844) | \* Returns the array of available engines |
| [1845](#L1845) | \* |
| [1846](#L1846) | \* @return array |
| [1847](#L1847) | \*/ |
| [1848](#L1848) | function foogallery\_thumb\_available\_engines() |
| [1849](#L1849) | { |
| [1850](#L1850) | $shortpixel\_link = '<a href="https://shortpixel.com/otp/af/foowww" target="\_blank">' . \_\_( 'ShortPixel Adaptive Images', 'foogallery' ) . '</a>'; |
| [1851](#L1851) | $engines = array( |
| [1852](#L1852) | 'default'    => array( |
| [1853](#L1853) | 'label'       => \_\_( 'Default', 'foogallery' ), |
| [1854](#L1854) | 'description' => \_\_( 'The default engine used to generate locally cached thumbnails.', 'foogallery' ), |
| [1855](#L1855) | 'class'       => 'FooGallery\_Thumb\_Engine\_Default', |
| [1856](#L1856) | ), |
| [1857](#L1857) | 'shortpixel' => array( |
| [1858](#L1858) | 'label'       => \_\_( 'ShortPixel', 'foogallery' ), |
| [1859](#L1859) | 'description' => sprintf( \_\_( 'Uses %s to generate all your gallery thumbnails. They will be optimized and offloaded to the ShortPixel global CDN!', 'foogallery' ), $shortpixel\_link ), |
| [1860](#L1860) | 'class'       => 'FooGallery\_Thumb\_Engine\_Shortpixel', |
| [1861](#L1861) | ), |
| [1862](#L1862) | ); |
| [1863](#L1863) | if ( foogallery\_is\_debug() ) { |
| [1864](#L1864) | $engines['dummy'] = array( |
| [1865](#L1865) | 'label'       => \_\_( 'Dummy', 'foogallery' ), |
| [1866](#L1866) | 'description' => \_\_( 'A dummy thumbnail engine that can be used for testing. (uses dummyimage.com)', 'foogallery' ), |
| [1867](#L1867) | 'class'       => 'FooGallery\_Thumb\_Engine\_Dummy', |
| [1868](#L1868) | ); |
| [1869](#L1869) | } |
| [1870](#L1870) | return apply\_filters( 'foogallery\_thumb\_available\_engines', $engines ); |
| [1871](#L1871) | } |
| [1872](#L1872) |  |
| [1873](#L1873) | /\*\* |
| [1874](#L1874) | \* Returns the active thumb engine, based on settings |
| [1875](#L1875) | \* |
| [1876](#L1876) | \* @return FooGallery\_Thumb\_Engine |
| [1877](#L1877) | \*/ |
| [1878](#L1878) | function foogallery\_thumb\_active\_engine() |
| [1879](#L1879) | { |
| [1880](#L1880) | global  $foogallery\_thumb\_engine ; |
| [1881](#L1881) | //if we already have an engine, return it early |
| [1882](#L1882) | if ( isset( $foogallery\_thumb\_engine ) && is\_a( $foogallery\_thumb\_engine, 'FooGallery\_Thumb\_Engine' ) ) { |
| [1883](#L1883) | return $foogallery\_thumb\_engine; |
| [1884](#L1884) | } |
| [1885](#L1885) | $engine = foogallery\_get\_setting( 'thumb\_engine', 'default' ); |
| [1886](#L1886) | $engines = foogallery\_thumb\_available\_engines(); |
| [1887](#L1887) |  |
| [1888](#L1888) | if ( array\_key\_exists( $engine, $engines ) ) { |
| [1889](#L1889) | $active\_engine = $engines[$engine]; |
| [1890](#L1890) | $foogallery\_thumb\_engine = new $active\_engine['class'](); |
| [1891](#L1891) | } else { |
| [1892](#L1892) | $foogallery\_thumb\_engine = new FooGallery\_Thumb\_Engine\_Default(); |
| [1893](#L1893) | } |
| [1894](#L1894) |  |
| [1895](#L1895) | return $foogallery\_thumb\_engine; |
| [1896](#L1896) | } |
| [1897](#L1897) |  |
| [1898](#L1898) | /\*\* |
| [1899](#L1899) | \* Resizes a given image using the active thumb engine. |
| [1900](#L1900) | \* |
| [1901](#L1901) | \* @param       $url |
| [1902](#L1902) | \* @param array $args |
| [1903](#L1903) | \* |
| [1904](#L1904) | \* @return string|void (string) url to the image |
| [1905](#L1905) | \*/ |
| [1906](#L1906) | function foogallery\_thumb( $url, $args = array() ) |
| [1907](#L1907) | { |
| [1908](#L1908) | $engine = foogallery\_thumb\_active\_engine(); |
| [1909](#L1909) | return $engine->generate( $url, $args ); |
| [1910](#L1910) | } |
| [1911](#L1911) |  |
| [1912](#L1912) | /\*\* |
| [1913](#L1913) | \* @param $url string |
| [1914](#L1914) | \* |
| [1915](#L1915) | \* @return string |
| [1916](#L1916) | \*/ |
| [1917](#L1917) | function foogallery\_process\_image\_url( $url ) |
| [1918](#L1918) | { |
| [1919](#L1919) | return apply\_filters( 'foogallery\_process\_image\_url', $url ); |
| [1920](#L1920) | } |
| [1921](#L1921) |  |
| [1922](#L1922) | /\*\* |
| [1923](#L1923) | \* Build up a link to be used in the admin with the correct utm parameters |
| [1924](#L1924) | \* |
| [1925](#L1925) | \* @param      $url             string The original full URL |
| [1926](#L1926) | \* @param      $utm\_campaign    string The campaign or page that the link is on |
| [1927](#L1927) | \* @param null $utm\_medium      string The medium, so in this case we want to differentiate btw free and pro |
| [1928](#L1928) | \* @param null $utm\_content     string Optional extra data that can be used to differentiate between links in the same campaign |
| [1929](#L1929) | \* @param      $utm\_source      string The platform where the traffic originates. Should probably always be wp\_plugin |
| [1930](#L1930) | \* |
| [1931](#L1931) | \* @return string |
| [1932](#L1932) | \*/ |
| [1933](#L1933) | function foogallery\_admin\_url( |
| [1934](#L1934) | $url, |
| [1935](#L1935) | $utm\_campaign, |
| [1936](#L1936) | $utm\_content = null, |
| [1937](#L1937) | $utm\_medium = null, |
| [1938](#L1938) | $utm\_source = 'wp\_plugin' |
| [1939](#L1939) | ) |
| [1940](#L1940) | { |
| [1941](#L1941) | if ( is\_null( $utm\_source ) ) { |
| [1942](#L1942) | $utm\_source = 'wp\_plugin'; |
| [1943](#L1943) | } |
| [1944](#L1944) | if ( is\_null( $utm\_medium ) ) { |
| [1945](#L1945) |  |
| [1946](#L1946) | if ( foogallery\_is\_pro() ) { |
| [1947](#L1947) | $utm\_medium = 'foogallery\_pro'; |
| [1948](#L1948) | } else { |
| [1949](#L1949) | $utm\_medium = 'foogallery\_free'; |
| [1950](#L1950) | } |
| [1951](#L1951) |  |
| [1952](#L1952) | } |
| [1953](#L1953) | $params = array( |
| [1954](#L1954) | 'utm\_source'   => $utm\_source, |
| [1955](#L1955) | 'utm\_medium'   => $utm\_medium, |
| [1956](#L1956) | 'utm\_campaign' => $utm\_campaign, |
| [1957](#L1957) | ); |
| [1958](#L1958) | if ( !is\_null( $utm\_content ) ) { |
| [1959](#L1959) | $params['utm\_content'] = $utm\_content; |
| [1960](#L1960) | } |
| [1961](#L1961) | return add\_query\_arg( $params, $url ); |
| [1962](#L1962) | } |
| [1963](#L1963) |  |
| [1964](#L1964) | /\*\* |
| [1965](#L1965) | \* Returns true if on the plugin activation page |
| [1966](#L1966) | \* |
| [1967](#L1967) | \* @return bool |
| [1968](#L1968) | \*/ |
| [1969](#L1969) | function foogallery\_is\_activation\_page() |
| [1970](#L1970) | { |
| [1971](#L1971) | $fs = foogallery\_fs(); |
| [1972](#L1972) | return $fs->is\_activation\_page(); |
| [1973](#L1973) | } |
| [1974](#L1974) |  |
| [1975](#L1975) | /\*\* |
| [1976](#L1976) | \* Render an array of debug info |
| [1977](#L1977) | \* |
| [1978](#L1978) | \* @param array $array an array of data to render. |
| [1979](#L1979) | \*/ |
| [1980](#L1980) | function foogallery\_render\_debug\_array( $array, $level = 0 ) |
| [1981](#L1981) | { |
| [1982](#L1982) | foreach ( $array as $key => $value ) { |
| [1983](#L1983) |  |
| [1984](#L1984) | if ( !empty($value) ) { |
| [1985](#L1985) | if ( $level > 0 ) { |
| [1986](#L1986) | echo  esc\_html( str\_repeat( '   ', $level ) ) ; |
| [1987](#L1987) | } |
| [1988](#L1988) | echo  esc\_html( $key ) . ' => ' ; |
| [1989](#L1989) |  |
| [1990](#L1990) | if ( is\_array( $value ) ) { |
| [1991](#L1991) | echo  "\r\n" ; |
| [1992](#L1992) | foogallery\_render\_debug\_array( $value, $level + 1 ); |
| [1993](#L1993) | } else { |
| [1994](#L1994) | echo  esc\_html( $value ) ; |
| [1995](#L1995) | echo  "\r\n" ; |
| [1996](#L1996) | } |
| [1997](#L1997) |  |
| [1998](#L1998) | } |
| [1999](#L1999) |  |
| [2000](#L2000) | } |
| [2001](#L2001) | } |
| [2002](#L2002) |  |
| [2003](#L2003) | /\*\* |
| [2004](#L2004) | \* Insert a new attachment from a URL. |
| [2005](#L2005) | \* |
| [2006](#L2006) | \* @param array $attachment\_data The image attachment data. |
| [2007](#L2007) | \* |
| [2008](#L2008) | \* @return false|int|WP\_Error |
| [2009](#L2009) | \*/ |
| [2010](#L2010) | function foogallery\_import\_attachment( $attachment\_data ) |
| [2011](#L2011) | { |
| [2012](#L2012) | // Include image.php so we can call wp\_generate\_attachment\_metadata(). |
| [2013](#L2013) | require\_once ABSPATH . 'wp-admin/includes/image.php'; |
| [2014](#L2014) | // Get the contents of the picture. |
| [2015](#L2015) | $response = wp\_remote\_get( $attachment\_data['url'] ); |
| [2016](#L2016) | if ( is\_wp\_error( $response ) ) { |
| [2017](#L2017) | return $response; |
| [2018](#L2018) | } |
| [2019](#L2019) | $contents = wp\_remote\_retrieve\_body( $response ); |
| [2020](#L2020) | // Upload and get file data. |
| [2021](#L2021) | $upload = wp\_upload\_bits( basename( $attachment\_data['url'] ), null, $contents ); |
| [2022](#L2022) | if ( array\_key\_exists( 'error', $upload ) && false !== $upload['error'] ) { |
| [2023](#L2023) | return new WP\_Error( 'foogallery\_import\_attachment\_upload\_fail', $upload['error'] ); |
| [2024](#L2024) | } |
| [2025](#L2025) | $guid = $upload['url']; |
| [2026](#L2026) | $file = $upload['file']; |
| [2027](#L2027) | $file\_type = wp\_check\_filetype( basename( $file ), null ); |
| [2028](#L2028) | // Create attachment. |
| [2029](#L2029) | $attachment\_args = array( |
| [2030](#L2030) | 'ID'             => 0, |
| [2031](#L2031) | 'guid'           => $guid, |
| [2032](#L2032) | 'post\_title'     => $attachment\_data['title'], |
| [2033](#L2033) | 'post\_excerpt'   => $attachment\_data['caption'], |
| [2034](#L2034) | 'post\_content'   => ( isset( $attachment\_data['description'] ) ? $attachment\_data['description'] : '' ), |
| [2035](#L2035) | 'post\_date'      => '', |
| [2036](#L2036) | 'post\_mime\_type' => ( isset( $attachment\_data['mime\_type'] ) ? $attachment\_data['mime\_type'] : $file\_type['type'] ), |
| [2037](#L2037) | ); |
| [2038](#L2038) | $attachment\_args['meta\_input'] = array(); |
| [2039](#L2039) | if ( isset( $attachment\_data['alt'] ) && !empty($attachment\_data['alt']) ) { |
| [2040](#L2040) | $attachment\_args['meta\_input']['\_wp\_attachment\_image\_alt'] = $attachment\_data['alt']; |
| [2041](#L2041) | } |
| [2042](#L2042) | if ( isset( $attachment\_data['custom\_url'] ) && !empty($attachment\_data['custom\_url']) ) { |
| [2043](#L2043) | $attachment\_args['meta\_input']['\_foogallery\_custom\_url'] = $attachment\_data['custom\_url']; |
| [2044](#L2044) | } |
| [2045](#L2045) | if ( isset( $attachment\_data['custom\_target'] ) && !empty($attachment\_data['custom\_target']) ) { |
| [2046](#L2046) | $attachment\_args['meta\_input']['\_foogallery\_custom\_target'] = $attachment\_data['custom\_target']; |
| [2047](#L2047) | } |
| [2048](#L2048) | // Save the original URL, so that we do not import it again! |
| [2049](#L2049) | $attachment\_args['meta\_input']['\_foogallery\_imported\_from'] = $attachment\_data['url']; |
| [2050](#L2050) | // Insert the attachment. |
| [2051](#L2051) | $attachment\_id = wp\_insert\_attachment( |
| [2052](#L2052) | $attachment\_args, |
| [2053](#L2053) | $file, |
| [2054](#L2054) | 0, |
| [2055](#L2055) | true |
| [2056](#L2056) | ); |
| [2057](#L2057) | if ( is\_wp\_error( $attachment\_id ) ) { |
| [2058](#L2058) | return $attachment\_id; |
| [2059](#L2059) | } |
| [2060](#L2060) | $attachment\_meta = wp\_generate\_attachment\_metadata( $attachment\_id, $file ); |
| [2061](#L2061) | wp\_update\_attachment\_metadata( $attachment\_id, $attachment\_meta ); |
| [2062](#L2062) | if ( isset( $attachment\_data['tags'] ) && is\_array( $attachment\_data['tags'] ) && count( $attachment\_data['tags'] ) > 0 ) { |
| [2063](#L2063) | if ( taxonomy\_exists( FOOGALLERY\_ATTACHMENT\_TAXONOMY\_TAG ) ) { |
| [2064](#L2064) | // Save tags. |
| [2065](#L2065) | wp\_set\_object\_terms( |
| [2066](#L2066) | $attachment\_id, |
| [2067](#L2067) | $attachment\_data['tags'], |
| [2068](#L2068) | FOOGALLERY\_ATTACHMENT\_TAXONOMY\_TAG, |
| [2069](#L2069) | false |
| [2070](#L2070) | ); |
| [2071](#L2071) | } |
| [2072](#L2072) | } |
| [2073](#L2073) | if ( isset( $attachment\_data['categories'] ) && is\_array( $attachment\_data['categories'] ) && count( $attachment\_data['categories'] ) > 0 ) { |
| [2074](#L2074) | if ( taxonomy\_exists( FOOGALLERY\_ATTACHMENT\_TAXONOMY\_CATEGORY ) ) { |
| [2075](#L2075) | // Save categories. |
| [2076](#L2076) | wp\_set\_object\_terms( |
| [2077](#L2077) | $attachment\_id, |
| [2078](#L2078) | $attachment\_data['categories'], |
| [2079](#L2079) | FOOGALLERY\_ATTACHMENT\_TAXONOMY\_CATEGORY, |
| [2080](#L2080) | false |
| [2081](#L2081) | ); |
| [2082](#L2082) | } |
| [2083](#L2083) | } |
| [2084](#L2084) | return $attachment\_id; |
| [2085](#L2085) | } |
| [2086](#L2086) |  |
| [2087](#L2087) | /\*\* |
| [2088](#L2088) | \* Returns an array of data associated with the attachment, including full size image URL, full size width and height. |
| [2089](#L2089) | \* |
| [2090](#L2090) | \* @param int $attachment\_id The attachment ID. |
| [2091](#L2091) | \* |
| [2092](#L2092) | \* @return array|false |
| [2093](#L2093) | \*/ |
| [2094](#L2094) | function foogallery\_get\_full\_size\_image\_data( $attachment\_id ) |
| [2095](#L2095) | { |
| [2096](#L2096) | // Get the URL to the full size image. |
| [2097](#L2097) | $src = wp\_get\_attachment\_url( $attachment\_id ); |
| [2098](#L2098) | // If we cannot get an attachment URL, then get out early. |
| [2099](#L2099) | if ( false === $src ) { |
| [2100](#L2100) | return false; |
| [2101](#L2101) | } |
| [2102](#L2102) | // First try to get the image metadata. |
| [2103](#L2103) | $image\_data = wp\_get\_attachment\_metadata( $attachment\_id ); |
| [2104](#L2104) | $width = $height = 0; |
| [2105](#L2105) |  |
| [2106](#L2106) | if ( is\_array( $image\_data ) ) { |
| [2107](#L2107) | if ( array\_key\_exists( 'width', $image\_data ) ) { |
| [2108](#L2108) | $width = $image\_data['width']; |
| [2109](#L2109) | } |
| [2110](#L2110) | if ( array\_key\_exists( 'height', $image\_data ) ) { |
| [2111](#L2111) | $height = $image\_data['height']; |
| [2112](#L2112) | } |
| [2113](#L2113) | } else { |
| [2114](#L2114) | $image\_data = wp\_get\_attachment\_image\_src( $attachment\_id, 'full' ); |
| [2115](#L2115) | $width = $image\_data[1]; |
| [2116](#L2116) | $height = $image\_data[2]; |
| [2117](#L2117) | } |
| [2118](#L2118) |  |
| [2119](#L2119) | // Do a last check for the height and width. |
| [2120](#L2120) | if ( $width === $height && 0 === $height ) { |
| [2121](#L2121) | // If nothing is stored in meta, then get the size from the physical file. Not ideal, but might be needed in some cases. |
| [2122](#L2122) | list( $width, $height ) = wp\_getimagesize( $src ); |
| [2123](#L2123) | } |
| [2124](#L2124) | return array( $src, $width, $height ); |
| [2125](#L2125) | } |
| [2126](#L2126) |  |
| [2127](#L2127) | /\*\* |
| [2128](#L2128) | \* Generate an SVG image placeholder |
| [2129](#L2129) | \* |
| [2130](#L2130) | \* @param $w |
| [2131](#L2131) | \* @param $h |
| [2132](#L2132) | \* |
| [2133](#L2133) | \* @return string |
| [2134](#L2134) | \*/ |
| [2135](#L2135) | function foogallery\_get\_svg\_placeholder\_image( $w, $h ) |
| [2136](#L2136) | { |
| [2137](#L2137) | return 'data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22' . $w . '%22%20height%3D%22' . $h . '%22%20viewBox%3D%220%200%20' . $w . '%20' . $h . '%22%3E%3C%2Fsvg%3E'; |
| [2138](#L2138) | } |
| [2139](#L2139) |  |
| [2140](#L2140) | /\*\* |
| [2141](#L2141) | \* Extracts the gallery ID from a full gallery ID |
| [2142](#L2142) | \* |
| [2143](#L2143) | \* @param $full\_gallery\_id |
| [2144](#L2144) | \* |
| [2145](#L2145) | \* @return int |
| [2146](#L2146) | \*/ |
| [2147](#L2147) | function foogallery\_extract\_gallery\_id( $full\_gallery\_id ) |
| [2148](#L2148) | { |
| [2149](#L2149) | preg\_match\_all( '/^.\*?(\\d+?)(?:\_|$)/', $full\_gallery\_id, $matches ); |
| [2150](#L2150) | if ( is\_array( $matches ) ) { |
| [2151](#L2151) | return intval( $matches[1][0] ); |
| [2152](#L2152) | } |
| [2153](#L2153) | return 0; |
| [2154](#L2154) | } |
| [2155](#L2155) |  |
| [2156](#L2156) | /\*\* |
| [2157](#L2157) | \* Return the index of a specific section with the gallery template fields array |
| [2158](#L2158) | \* |
| [2159](#L2159) | \* @param $fields |
| [2160](#L2160) | \* @param $section |
| [2161](#L2161) | \* |
| [2162](#L2162) | \* @return int |
| [2163](#L2163) | \*/ |
| [2164](#L2164) | function foogallery\_admin\_fields\_find\_index\_of\_section( $fields, $section ) |
| [2165](#L2165) | { |
| [2166](#L2166) | $index = 0; |
| [2167](#L2167) | foreach ( $fields as $field ) { |
| [2168](#L2168) | if ( isset( $field['section'] ) && $section === $field['section'] ) { |
| [2169](#L2169) | return $index; |
| [2170](#L2170) | } |
| [2171](#L2171) | $index++; |
| [2172](#L2172) | } |
| [2173](#L2173) | return $index; |
| [2174](#L2174) | } |
| [2175](#L2175) |  |
| [2176](#L2176) | /\*\* |
| [2177](#L2177) | \* Return the index of a specific field within the gallery template fields array |
| [2178](#L2178) | \* |
| [2179](#L2179) | \* @param $fields |
| [2180](#L2180) | \* @param $field\_id |
| [2181](#L2181) | \* |
| [2182](#L2182) | \* @return int |
| [2183](#L2183) | \*/ |
| [2184](#L2184) | function foogallery\_admin\_fields\_find\_index\_of\_field( $fields, $field\_id ) |
| [2185](#L2185) | { |
| [2186](#L2186) | $index = 0; |
| [2187](#L2187) | foreach ( $fields as $field ) { |
| [2188](#L2188) | if ( isset( $field['id'] ) && $field\_id === $field['id'] ) { |
| [2189](#L2189) | return $index; |
| [2190](#L2190) | } |
| [2191](#L2191) | $index++; |
| [2192](#L2192) | } |
| [2193](#L2193) | return $index; |
| [2194](#L2194) | } |
| [2195](#L2195) |  |
| [2196](#L2196) | /\*\* |
| [2197](#L2197) | \* Returns true if the field exists in the array |
| [2198](#L2198) | \* |
| [2199](#L2199) | \* @param $fields |
| [2200](#L2200) | \* @param $field\_id |
| [2201](#L2201) | \* @return bool |
| [2202](#L2202) | \*/ |
| [2203](#L2203) | function foogallery\_admin\_fields\_has\_field( $fields, $field\_id ) |
| [2204](#L2204) | { |
| [2205](#L2205) | foreach ( $fields as $field ) { |
| [2206](#L2206) | if ( isset( $field['id'] ) && $field\_id === $field['id'] ) { |
| [2207](#L2207) | return true; |
| [2208](#L2208) | } |
| [2209](#L2209) | } |
| [2210](#L2210) | return false; |
| [2211](#L2211) | } |
| [2212](#L2212) |  |
| [2213](#L2213) | /\*\* |
| [2214](#L2214) | \* Returns the path of the URL |
| [2215](#L2215) | \* |
| [2216](#L2216) | \* @param $url |
| [2217](#L2217) | \* |
| [2218](#L2218) | \* @return false|string |
| [2219](#L2219) | \*/ |
| [2220](#L2220) | function foogallery\_local\_url\_to\_path( $url ) |
| [2221](#L2221) | { |
| [2222](#L2222) | return FooGallery\_Thumb\_Generator::get\_file\_path( $url ); |
| [2223](#L2223) | } |
| [2224](#L2224) |  |
| [2225](#L2225) | /\*\* |
| [2226](#L2226) | \* Sanitizes a code field for saving to the database. |
| [2227](#L2227) | \* |
| [2228](#L2228) | \* @param string $text |
| [2229](#L2229) | \* |
| [2230](#L2230) | \* @return false|string |
| [2231](#L2231) | \*/ |
| [2232](#L2232) | function foogallery\_sanitize\_code( $text ) |
| [2233](#L2233) | { |
| [2234](#L2234) |  |
| [2235](#L2235) | if ( !empty($text) ) { |
| [2236](#L2236) | $text = wp\_check\_invalid\_utf8( $text, true ); |
| [2237](#L2237) | $text = htmlentities( $text ); |
| [2238](#L2238) | return apply\_filters( 'foogallery\_sanitize\_code', $text ); |
| [2239](#L2239) | } |
| [2240](#L2240) |  |
| [2241](#L2241) | return false; |
| [2242](#L2242) | } |
| [2243](#L2243) |  |
| [2244](#L2244) | /\*\* |
| [2245](#L2245) | \* Prepares a code field for use after it has been sanitized. |
| [2246](#L2246) | \* |
| [2247](#L2247) | \* @param string $text |
| [2248](#L2248) | \* |
| [2249](#L2249) | \* @return false|string |
| [2250](#L2250) | \*/ |
| [2251](#L2251) | function foogallery\_prepare\_code( $text ) |
| [2252](#L2252) | { |
| [2253](#L2253) |  |
| [2254](#L2254) | if ( !empty($text) ) { |
| [2255](#L2255) | $text = html\_entity\_decode( $text ); |
| [2256](#L2256) | return apply\_filters( 'foogallery\_prepare\_code', $text ); |
| [2257](#L2257) | } |
| [2258](#L2258) |  |
| [2259](#L2259) | return false; |
| [2260](#L2260) | } |
| [2261](#L2261) |  |
| [2262](#L2262) | /\*\* |
| [2263](#L2263) | \* Returns true if the feature is enabled. |
| [2264](#L2264) | \* |
| [2265](#L2265) | \* @param $feature |
| [2266](#L2266) | \* @return bool |
| [2267](#L2267) | \*/ |
| [2268](#L2268) | function foogallery\_feature\_enabled( $feature ) |
| [2269](#L2269) | { |
| [2270](#L2270) | global  $foogallery\_features ; |
| [2271](#L2271) |  |
| [2272](#L2272) | if ( empty($foogallery\_features) ) { |
| [2273](#L2273) | $api = new FooGallery\_Extensions\_API(); |
| [2274](#L2274) | $foogallery\_features = $api->get\_all\_for\_view(); |
| [2275](#L2275) | } |
| [2276](#L2276) |  |
| [2277](#L2277) | return array\_key\_exists( $feature, $foogallery\_features ) && $foogallery\_features[$feature]['is\_active']; |
| [2278](#L2278) | } |
| [2279](#L2279) |  |
| [2280](#L2280) | /\*\* |
| [2281](#L2281) | \* Returns an array of the pro features available in FooGallery. |
| [2282](#L2282) | \* |
| [2283](#L2283) | \* @return array |
| [2284](#L2284) | \*/ |
| [2285](#L2285) | function foogallery\_pro\_features() |
| [2286](#L2286) | { |
| [2287](#L2287) | global  $foogallery\_pro\_features ; |
| [2288](#L2288) | if ( !isset( $foogallery\_pro\_features ) ) { |
| [2289](#L2289) | $foogallery\_pro\_features = (include FOOGALLERY\_PATH . 'includes/admin/pro-features.php'); |
| [2290](#L2290) | } |
| [2291](#L2291) | return $foogallery\_pro\_features; |
| [2292](#L2292) | } |
| [2293](#L2293) |  |
| [2294](#L2294) | /\*\* |
| [2295](#L2295) | \* Retrieves the target options for FooGallery attachments. |
| [2296](#L2296) | \* |
| [2297](#L2297) | \* The function retrieves an array of target options that can be used for customizing |
| [2298](#L2298) | \* the behavior of attachment links within the FooGallery plugin. |
| [2299](#L2299) | \* |
| [2300](#L2300) | \* @return array An associative array of target options with keys like '\_blank', '\_self', etc. |
| [2301](#L2301) | \* |
| [2302](#L2302) | \* @since 1.0.0 |
| [2303](#L2303) | \*/ |
| [2304](#L2304) | function foogallery\_get\_target\_options() |
| [2305](#L2305) | { |
| [2306](#L2306) | /\*\* |
| [2307](#L2307) | \* Filter the target options for FooGallery attachments. |
| [2308](#L2308) | \* |
| [2309](#L2309) | \* @param array $target\_options An associative array of target options. |
| [2310](#L2310) | \*/ |
| [2311](#L2311) | $target\_options = apply\_filters( 'foogallery\_attachment\_field\_custom\_target\_options', array( |
| [2312](#L2312) | 'default' => \_\_( 'Default', 'foogallery' ), |
| [2313](#L2313) | '\_blank'  => \_\_( 'New tab (\_blank)', 'foogallery' ), |
| [2314](#L2314) | '\_self'   => \_\_( 'Same tab (\_self)', 'foogallery' ), |
| [2315](#L2315) | 'foobox'  => \_\_( 'FooBox', 'foogallery' ), |
| [2316](#L2316) | ) ); |
| [2317](#L2317) | return $target\_options; |
| [2318](#L2318) | } |
| [2319](#L2319) |  |
| [2320](#L2320) | /\*\* |
| [2321](#L2321) | \* If the user can, then create some FooGallery demo content! |
| [2322](#L2322) | \* |
| [2323](#L2323) | \* @return false|int[] |
| [2324](#L2324) | \*/ |
| [2325](#L2325) | function foogallery\_create\_demo\_content() |
| [2326](#L2326) | { |
| [2327](#L2327) |  |
| [2328](#L2328) | if ( is\_admin() && is\_user\_logged\_in() && current\_user\_can( 'manage\_options' ) ) { |
| [2329](#L2329) | $importer = new FooGallery\_Admin\_Demo\_Content(); |
| [2330](#L2330) | $results = $importer->import\_demo\_content(); |
| [2331](#L2331) | foogallery\_set\_setting( 'demo\_content', 'on' ); |
| [2332](#L2332) | return $results; |
| [2333](#L2333) | } |
| [2334](#L2334) |  |
| [2335](#L2335) | return false; |
| [2336](#L2336) | } |
| [2337](#L2337) |  |
| [2338](#L2338) | /\*\* |
| [2339](#L2339) | \* Returns if Freemius is in anonymous mode. |
| [2340](#L2340) | \* |
| [2341](#L2341) | \* @return false |
| [2342](#L2342) | \*/ |
| [2343](#L2343) | function foogallery\_freemius\_is\_anonymous() |
| [2344](#L2344) | { |
| [2345](#L2345) | if ( defined( 'FOOPLUGINS\_FREEMIUS\_ANONYMOUS' ) ) { |
| [2346](#L2346) | return FOOPLUGINS\_FREEMIUS\_ANONYMOUS; |
| [2347](#L2347) | } |
| [2348](#L2348) | return false; |
| [2349](#L2349) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/foogallery/tags/2.4.9/includes/functions.php?format=txt)
* [Original Format](/export/3222434/foogallery/tags/2.4.9/includes/functions.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_6455b88c_20250114_182522.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# FooGallery Premium <= 2.3.3 - Authenticated (Contributor+) Stored Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   FooGallery Premium <= 2.3.3 - Authenticated (Contributor+) Stored Cross-Site Scripting

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2023-6747](https://www.cve.org/CVERecord?id=CVE-2023-6747) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | January 2, 2024 |
| Last Updated | January 30, 2024 |
| Researchers | [Webbernaut](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/webbernaut)  [Debangshu Kundu](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/debangshu-kundu)  [Arpeet Rathi](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/arpeet-rathi)  [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Best WordPress Gallery Plugin – FooGallery plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the custom attributes in all versions up to, and including, 2.3.3 due to insufficient input sanitization and output escaping. This makes it possible for contributors and above to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [fooplugins.com](https://fooplugins.com/foogallery-wordpress-gallery-plugin/pricing/)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/foogallery/tags/2.4.9/includes/functions.php#L1609)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php?rev=3027668#L149)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Ffoogallery-premium-233-authenticated-contributor-stored-cross-site-scripting&t=FooGallery%20Premium%20%3C%3D%202.3.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Ffoogallery-premium-233-authenticated-contributor-stored-cross-site-scripting&text=FooGallery%20Premium%20%3C%3D%202.3.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fdetail%2Ffoogallery-premium-233-authenticated-contributor-stored-cross-site-scripting "LinkedIn")
Email

## 2 affected software packages

#### [FooGallery – Responsive Photo Gallery, Image Viewer, Justified, Masonry & Carousel](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/foogallery)

| Software Type | Plugin |
| --- | --- |
| Software Slug | foogallery [(view on wordpress.org)](https://wordpress.org/plugins/foogallery) |
| Patched? | Yes |
| Remediation | Update to version 2.4.9, or a newer patched version |
| Affected Version | * <= 2.4.8 |
| Patched Version | * 2.4.9 |

#### [FooGallery Premium](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/foogallery-premium)

| Software Type | Plugin |
| --- | --- |
| Software Slug | foogallery-premium |
| Patched? | Yes |
| Remediation | Update to version 2.4.6, or a newer patched version |
| Affected Version | * <= 2.3.3 |
| Patched Version | * 2.4.6 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from fooplugins.com_2aa88c4b_20250114_182458.html ===


* [Home](https://fooplugins.com/ "Go Home")
  + Go Back
  + [FooGallery](https://fooplugins.com/foogallery-wordpress-gallery-plugin/)
  + [FooBox](https://fooplugins.com/foobox/)
  + [FooBar](https://fooplugins.com/foobar-wordpress-notification-bars/)
* [Features](https://fooplugins.com/foogallery/#features)
  + Go Back
  + [Beautiful Gallery Templates](https://fooplugins.com/foogallery-wordpress-gallery-plugin/gallery-templates/)
  + [FooGallery Lightbox](https://fooplugins.com/foogallery-wordpress-gallery-plugin/lightbox/)
  + [Animated Hover Presets](https://fooplugins.com/foogallery-wordpress-gallery-plugin/hover-presets/)
  + [Thumbnail Filter Effects](https://fooplugins.com/foogallery-wordpress-gallery-plugin/filter-effects/)
  + [Videos](https://fooplugins.com/foogallery-wordpress-gallery-plugin/video-gallery/)
  + [Dynamic Galleries](https://fooplugins.com/load-galleries-from-other-sources/)
  + [Filtered Gallery](https://fooplugins.com/foogallery-wordpress-gallery-plugin/filtering/)
  + [WordPress Photo Gallery Search](https://fooplugins.com/foogallery-wordpress-gallery-plugin/gallery-search/)
  + [Advanced Pagination](https://fooplugins.com/foogallery-wordpress-gallery-plugin/pagination/)
  + [Custom Captions](https://fooplugins.com/foogallery-wordpress-gallery-plugin/custom-captions/)
  + [EXIF Metadata](https://fooplugins.com/foogallery-wordpress-gallery-plugin/exif-data/)
  + [Bulk Copy Settings](https://fooplugins.com/bulk-copy-foogallery-pro/)
  + [WooCommerce Integration](https://fooplugins.com/foogallery-wordpress-gallery-plugin/woocommerce-integration/)
  + [Watermarking](https://fooplugins.com/foogallery-wordpress-gallery-plugin/photo-watermark/)
* [Compare Plans](https://fooplugins.com/foogallery-wordpress-gallery-plugin/pricing/#compare)
* [Demos](https://fooplugins.com/foogallery-wordpress-gallery-plugin/demos/)
* [User Uploads](https://fooplugins.com/foogallery-wordpress-gallery-plugin/user-uploads/)
* [Ecommerce Course](https://fooplugins.com/foogallery-wordpress-gallery-plugin/photography-ecommerce-course/)
* [Documentation](https://fooplugins.com/documentation/foogallery/)
* [Buy Now!](https://fooplugins.com/foogallery-wordpress-gallery-plugin/#pricing)

# FooGallery Pricing

[FooGallery](https://fooplugins.com/foogallery/) comes with a free version, and three premium plans, each designed to suit your needs and your budget. Our PRO Plans can be purchased on a monthly, annual or lifetime basis, for 1, 5 or 25 sites. So you’re sure to find the plan that works for you!

#### Here’s a quick breakdown or your options:

##### PRO Commerce

Go professional and generate a revenue through your galleries.

##### PRO Expert

Take you galleries to the next level with advanced customizations and tons of features.

##### PRO Starter

Get started with professional looking galleries for less.

Take a look at our pricing options below…

## FooGallery PRO Pricing

Monthly
Yearly
Lifetime

1 Site
5 Sites
25 Sites

## PRO Commerce

 $99.99  $199.99  $299.99
per year
 $12.99  $19.99  $99.99
per month
 $259.99  $499.99  $999.99
once off

* PRO Commerce Features
* Priority Support
* Software Updates

**Best For:** photographers and entrepreneurs who want to make money online

[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/1/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/5/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/25/?billing_cycle=monthly)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/1/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/5/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/25/)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/1/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/5/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/25/?billing_cycle=lifetime)

## PRO Expert

 $69.99  $119.99  $199.99
per year
 $8.99  $14.99  $35.99
per month
 $199.99  $329.99  $599.99
once off

* PRO Expert Features
* Priority Support
* Software Updates

**Best For:** photographers who want complete control over their galleries

[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/1/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/5/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/25/?billing_cycle=monthly)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/1/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/5/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/25/)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/1/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/5/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/25/?billing_cycle=lifetime)

## PRO Starter

 $33.99  $69.99  $149.99
per year
 $6.99  $10.99  $29.99
per month
 $99.99  $199.99  $499.99
once off

* PRO Starter Features
* Priority Support
* Software Updates

**Best For:** site owners looking for more customization and gallery layouts

[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/1/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/5/?billing_cycle=monthly)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/25/?billing_cycle=monthly)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/1/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/5/)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/25/)
[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/1/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/5/?billing_cycle=lifetime)[Buy Now](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/25/?billing_cycle=lifetime)

## FooGallery PRO Plans

To help you decide which plan is the right fit for you, here are some of our top features!

|  | **PRO Commerce** | **PRO Expert** | **PRO Starter** |
| --- | --- | --- | --- |
|  | Starting from $99.99 | Starting from $69.99 | Starting from $33.99 |
| Unlimited Galleries |  |  |  |
| PRO Gallery Layouts |  |  |  |
| Dynamic Galleries |  |  |  |
| Video |  |  |  |
| Filtering & Multi-level Filtering |  |  |  |
| WooCommerce Integration |  |  |  |
| Watermarking |  |  |  |

Want to know more? We’ve put together a detailed comparison of all the features available in our plans. Take a look below, to get an idea of which features are included in each of our plans.

|  | **PRO Commerce** | **PRO Expert** | **PRO Starter** |
| --- | --- | --- | --- |
| Unlimited Galleries |  |  |  |
| [Stunning Gallery Templates](https://fooplugins.com/foogallery-wordpress-gallery-plugin/demos/) |  |  |  |
| Uses built-in Media Library to manage images |  |  |  |
| [Advanced Attachment Modal](https://fooplugins.com/documentation/foogallery/getting-started-foogallery/advanced-attachment-modal/) |  |  |  |
| Instant Gallery Previews in Admin |  |  |  |
| [Password Protection](https://fooplugins.com/documentation/foogallery/appearance-foogallery/password-protection/) for Galleries & Albums |  |  |  |
| [Import/Export](https://fooplugins.com/documentation/foogallery/getting-started-foogallery/import-export/) |  |  |  |
| FooGallery block in Gutenberg editor |  |  |  |
| Copy to clipboard shortcodes |  |  |  |
| Drag n Drop reordering of images and galleries |  |  |  |
| Lazy Loading |  |  |  |
| [Simple Pagination](https://fooplugins.com/documentation/foogallery/appearance-foogallery/paging-settings/) (dots) |  |  |  |
| [Retina Thumbnail Support](https://fooplugins.com/documentation/foogallery/getting-started-foogallery/retina-ready-images/) |  |  |  |
| Custom CSS for both galleries and albums |  |  |  |
| Page usage metabox with one-click gallery page creation |  |  |  |
| Improved CLS Performance |  |  |  |
| Custom JS and CSS |  |  |  |
| [NextGen importer](https://fooplugins.com/documentation/foogallery/getting-started-foogallery/nextgen-importer-tool/) tool (for albums and galleries) |  |  |  |
| [Albums](https://fooplugins.com/documentation/foogallery/getting-started-foogallery/adding-albums/) Built-in |  |  |  |
| [Hover Effects](https://fooplugins.com/documentation/foogallery/appearance-foogallery/hover-effects-settings/) |  |  |  |
| Customizations |  |  |  |
| [Slider PRO](https://fooplugins.com/foogallery-wordpress-gallery-plugin/slider-gallery/) Template |  |  |  |
| [Grid PRO](https://fooplugins.com/foogallery-wordpress-gallery-plugin/grid-gallery/) Template |  |  |  |
| [Polaroid PRO](https://fooplugins.com/foogallery-wordpress-gallery-plugin/polaroid-gallery/) Template |  |  |  |
| Built-in [PRO Lightbox](https://fooplugins.com/foogallery-wordpress-gallery-plugin/pro-lightbox/) |  |  |  |
| PRO Hover Effects ([Hover Presets](https://fooplugins.com/documentation/foogallery/pro-starter/hover-effect-presets/)) |  |  |  |
| PRO Customizations ([Thumb Filters](https://fooplugins.com/documentation/foogallery/pro-starter/adding-thumbnail-filters/)) |  |  |  |
| [Deeplinking](https://fooplugins.com/documentation/foogallery/pro-expert/linking-to-gallery-filters/) |  |  |  |
| [Video Galleries](https://fooplugins.com/documentation/foogallery/pro-expert/foogallery-pro-video/) + Import |  |  |  |
| Media Tags & [Filtering](https://fooplugins.com/documentation/foogallery/pro-expert/filtering-settings/) |  |  |  |
| [Multi-Level Filtering](https://fooplugins.com/documentation/foogallery/pro-expert/multi-level-filters/) |  |  |  |
| [Dynamic Galleries](https://fooplugins.com/load-galleries-from-other-sources/) (Datasources) |  |  |  |
| [Bulk Copy](https://fooplugins.com/bulk-copy-foogallery-pro/) Settings |  |  |  |
| Advanced [Pagination](https://fooplugins.com/foogallery-wordpress-gallery-plugin/pagination/) |  |  |  |
| Advanced [Custom Captions](https://fooplugins.com/documentation/foogallery/pro-expert/using-custom-captions/) |  |  |  |
| [EXIF Data](https://fooplugins.com/documentation/foogallery/pro-expert/adding-exif-data/) |  |  |  |
| Gallery [Search](https://fooplugins.com/documentation/foogallery/pro-expert/adding-search/) |  |  |  |
| [Product Gallery](https://fooplugins.com/foogallery-wordpress-gallery-plugin/woocommerce-integration/#product-gallery) Template |  |  |  |
| [WooCommerce Integration](https://fooplugins.com/foogallery-wordpress-gallery-plugin/woocommerce-integration/) |  |  |  |
| [Dynamic WooCommerce Gallery](https://fooplugins.com/documentation/foogallery/pro-commerce/loading-images-from-woocommerce/) |  |  |  |
| Product Variation Support |  |  |  |
| [Master Product ID](https://fooplugins.com/documentation/foogallery/pro-commerce/sell-your-gallery-images-using-a-single-master-product/) |  |  |  |
| [CTA Buttons](https://fooplugins.com/documentation/foogallery/pro-commerce/add-to-cart-buttons/) |  |  |  |
| [Sale Ribbons](https://fooplugins.com/documentation/foogallery/pro-commerce/sale-ribbons/) |  |  |  |
| [White Labeling](https://fooplugins.com/documentation/foogallery/pro-commerce/white-labeling/) |  |  |  |
| Photo [Watermarking](https://fooplugins.com/documentation/foogallery/pro-commerce/watermark-gallery-images/) |  |  |  |
| [Right-click Image Protection](https://fooplugins.com/documentation/foogallery/pro-commerce/right-click-image-protection/) |  |  |  |
| [Master Gallery](https://fooplugins.com/documentation/foogallery/pro-commerce/use-master-gallery/) Template |  |  |  |

[Back to Pricing](#pricing)

## Still Undecided? Start a 7 day FREE Trial

If you are unsure about any of the plans, you are more than welcome to start a free trial for each of the PRO plans. A free trial gives you 7 days to fully test out the pro features, and you are not required to give any payment details up front.

[PRO Starter Free Trial](https://checkout.freemius.com/mode/page/plugin/843/plan/13794/licenses/1/?trial=true)

[PRO Expert Free Trial](https://checkout.freemius.com/mode/page/plugin/843/plan/2090/licenses/1/?trial=true)

[PRO Commerce Free Trial](https://checkout.freemius.com/mode/page/plugin/843/plan/14086/licenses/1/?trial=true)

## FooGallery Pricing FAQs

#### Do I lose my PRO features after my license expires?

You will not lose the PRO features of the plugin if you purchase a PRO annual or lifetime license. However, monthly licenses will lose the PRO features once the license expires.

If your license expires then you will no longer be eligible for pro support, and you will no longer get plugin updates.

#### Do you offer a Free Trial?

Yes, we have a 7-day free trial. It is a no-obligation trial and it does not require you to enter your credit card details. You can try out our PRO plugins for the week. The Free Trial can be used on any website, once.

If you want to continue using Pro at the end of that time, you can place your order then. If you want to go back to using the free version, then no action is required from you – your plugin will simply revert to free at the end of the 7 days.

For detailed instructions on how to start your Free Trial, go [here.](https://fooplugins.com/documentation/general/faq/start-free-trial/)

#### What Support do I get with the Pro plugins?

FooPlugins offers dedicated support for the PRO versions of our plugins. If you have a query, all you have to do is log a support ticket [here.](https://fooplugins.com/support/)

#### What is your Billing Cycle?

Your purchase of FooGallery Pro is done on a monthly or annual basis. In other words, you are billed when you first make your purchase and then again once a month, or once a year, while you continue to use the premium version of the plugin. Your license will be renewed automatically at the end of this period.

Please note that licenses are set to renew automatically, however, you can change this to a [manual renewal](https://fooplugins.com/documentation/general/accounts-licensing/disabling-auto-renew/) if you prefer.

We do offer a **Lifetime license** on any of our plans. This gives you lifetime access to FooGallery PRO – including updates and support – for a once-off payment. To select the Lifetime option, click on the Buy Now button and then change the plan to Lifetime.

#### Do you offer lifetime licenses?

Yes absolutely! All our plugins have lifetime plans available. This gives you lifetime access to the pro plugins – including updates and support – for a once-off payment. To select the Lifetime option, click on the Buy Now button and then change the plan to Lifetime.

#### What is your Refund Policy?

If you are uncertain about buying the pro version, we recommend that you go for the Free Trial first. This will give you a week to try out all of the features, and will save you the hassle of requesting a refund should the plugin not meet all your criteria.

We do, however, offer a [30-day refund policy](https://fooplugins.com/refund-policy/) for annual and lifetime licenses. (We do not offer a refund for monthly licenses.) If you are unsatisfied after using the plugin for a month, then please [contact us](https://fooplugins.com/support/) about your refund. While you are under no obligation to tell us what the problem is, we do ask that you kindly share any feedback with us. This can help us improve our plugins and create better WordPress solutions.

Please note that if you request a refund for a new license (that is, your initial purchase of the license), your license will be canceled and you will not have access to premium features.

## FooPlugins Info

* [News and Articles](https://fooplugins.com/blog/)
* [Account](https://fooplugins.com/account/)
* [Pricing](https://fooplugins.com/pricing/)
* [Privacy Policy](https://fooplugins.com/privacy-policy/)
* [Licensing](https://fooplugins.com/licensing/)
* [Terms and Conditions](https://fooplugins.com/terms-and-conditions/)
## Get Support

* [Documentation](https://fooplugins.com/documentation/)
* [Premium Support](https://fooplugins.com/support/)
* [FooGallery Free Support](https://wordpress.org/support/plugin/foogallery/)
* [FooBox Free Support](https://wordpress.org/support/plugin/foobox-image-lightbox/)
* [FooBar Free Support](https://wordpress.org/support/plugin/foobar-notifications-lite/)
* [FooPlugins Refund Policy](https://fooplugins.com/refund-policy/)
## Stay in Touch

* [Facebook](https://facebook.com/fooplugins)
* [Twitter](https://twitter.com/fooplugins)
* [LinkedIn](https://www.linkedin.com/company/fooplugins/)
* [Contact Us](https://fooplugins.com/contact-us/)
* Email
[![WPBeginner Verified](https://fooplugins.com/wp-content/uploads/2024/01/wpbeginner-badge-light.png)](https://www.wpbeginner.com/solutions/foogallery/)
![Freemius](https://fooplugins.com/wp-content/uploads/2021/08/icon-footer-freemius-rainbow.svg)

© 2025 FooPlugins



=== Content from plugins.trac.wordpress.org_e0149f44_20250114_182507.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ffoogallery%2Ftags%2F2.4.9%2Fincludes%2Fclass-gallery-advanced-settings.php%3Frev%3D3027668)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← Previous Revision
* [Latest Revision](/browser/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php)
* Next Revision →
* [Blame](/browser/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php?annotate=blame&rev=3027668 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php?rev=3027668)

---

# [source:](/browser?rev=3027668&order=name "Go to repository root") [foogallery](/browser/foogallery?rev=3027668&order=name "View foogallery")/[tags](/browser/foogallery/tags?rev=3027668&order=name "View tags")/[2.4.9](/browser/foogallery/tags/2.4.9?rev=3027668&order=name "View 2.4.9")/[includes](/browser/foogallery/tags/2.4.9/includes?rev=3027668&order=name "View includes")/[class-gallery-advanced-settings.php](/browser/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php?rev=3027668&order=name "View class-gallery-advanced-settings.php") @ [3027668](/changeset/3027668/ "View changeset 3027668")

View diff against:

View revision:

| [Last change](/changeset/3027668/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php "View differences") on this file since 3027668 was [3027668](/changeset/3027668/ "View changeset 3027668"), checked in by bradvin, [12 months ago](/timeline?from=2024-01-27T16%3A28%3A59Z&precision=second "See timeline at 01/27/2024 04:28:59 PM") |
| --- |
| added tag 2.4.9 |
| **File size:** 5.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Class for adding advanced settings to all gallery templates |
| [4](#L4) | \*/ |
| [5](#L5) | if ( ! class\_exists( 'FooGallery\_Advanced\_Gallery\_Settings' ) ) { |
| [6](#L6) |  |
| [7](#L7) | class FooGallery\_Advanced\_Gallery\_Settings { |
| [8](#L8) |  |
| [9](#L9) | function \_\_construct() { |
| [10](#L10) | //add fields to all templates |
| [11](#L11) | add\_filter( 'foogallery\_override\_gallery\_template\_fields', array( $this, 'add\_advanced\_fields' ), 20, 2 ); |
| [12](#L12) |  |
| [13](#L13) | //add data options |
| [14](#L14) | add\_filter( 'foogallery\_build\_container\_data\_options', array( $this, 'add\_data\_options' ), 30, 3 ); |
| [15](#L15) |  |
| [16](#L16) | //add custom attributes |
| [17](#L17) | add\_filter( 'foogallery\_build\_container\_attributes\_html', array( $this, 'add\_container\_attributes' ), 10, 3 ); |
| [18](#L18) |  |
| [19](#L19) | //add custom class to container |
| [20](#L20) | add\_filter( 'foogallery\_build\_class\_attribute', array( $this, 'add\_custom\_class' ), 10, 2 ); |
| [21](#L21) |  |
| [22](#L22) | //remove the title attribute from the image |
| [23](#L23) | add\_filter('foogallery\_attachment\_html\_image\_attributes', array($this, 'remove\_title\_attribute'), 99, 3); |
| [24](#L24) | } |
| [25](#L25) |  |
| [26](#L26) | /\*\* |
| [27](#L27) | \* @param array $attr |
| [28](#L28) | \* @param array $args |
| [29](#L29) | \* @param FooGalleryAttachment $attachment |
| [30](#L30) | \* @return mixed |
| [31](#L31) | \*/ |
| [32](#L32) | function remove\_title\_attribute($attr, $args, $attachment) { |
| [33](#L33) | //make sure we use a cached value |
| [34](#L34) | if ( !foogallery\_current\_gallery\_has\_cached\_value( 'include\_title') ) { |
| [35](#L35) | foogallery\_current\_gallery\_set\_cached\_value( 'include\_title', foogallery\_gallery\_template\_setting( 'include\_title', '' ) ); |
| [36](#L36) | } |
| [37](#L37) |  |
| [38](#L38) | if ( 'disabled' === foogallery\_current\_gallery\_get\_cached\_value( 'include\_title' ) ) { |
| [39](#L39) | if ( array\_key\_exists( 'title', $attr ) ) { |
| [40](#L40) | unset( $attr['title'] ); |
| [41](#L41) | } |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | return $attr; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Add fields to the gallery template |
| [49](#L49) | \* |
| [50](#L50) | \* @param $fields |
| [51](#L51) | \* @param $template |
| [52](#L52) | \* |
| [53](#L53) | \* @return array |
| [54](#L54) | \*/ |
| [55](#L55) | function add\_advanced\_fields( $fields, $template ) { |
| [56](#L56) | $fields[] = array( |
| [57](#L57) | 'id'       => 'custom\_settings', |
| [58](#L58) | 'title'    => \_\_( 'Custom Settings', 'foogallery' ), |
| [59](#L59) | 'desc'     => \_\_( 'Add any custom settings to the gallery which will be merged with existing settings. To be used by developers only!', 'foogallery' ), |
| [60](#L60) | 'section'  => \_\_( 'Advanced', 'foogallery' ), |
| [61](#L61) | 'type'     => 'textarea', |
| [62](#L62) | 'default'  => '', |
| [63](#L63) | ); |
| [64](#L64) |  |
| [65](#L65) | $fields[] = array( |
| [66](#L66) | 'id'       => 'custom\_attributes', |
| [67](#L67) | 'title'    => \_\_( 'Custom Attributes', 'foogallery' ), |
| [68](#L68) | 'desc'     => \_\_( 'Add any custom attributes to the gallery container. To be used by developers only!', 'foogallery' ), |
| [69](#L69) | 'section'  => \_\_( 'Advanced', 'foogallery' ), |
| [70](#L70) | 'type'     => 'textarea', |
| [71](#L71) | 'default'  => '', |
| [72](#L72) | ); |
| [73](#L73) |  |
| [74](#L74) | $fields[] = array( |
| [75](#L75) | 'id'       => 'custom\_class', |
| [76](#L76) | 'title'    => \_\_( 'Custom Gallery Class', 'foogallery' ), |
| [77](#L77) | 'desc'     => \_\_( 'Add a custom class to the gallery container.', 'foogallery' ), |
| [78](#L78) | 'section'  => \_\_( 'Advanced', 'foogallery' ), |
| [79](#L79) | 'type'     => 'text', |
| [80](#L80) | 'default'  => '', |
| [81](#L81) | ); |
| [82](#L82) |  |
| [83](#L83) | $fields[] = array( |
| [84](#L84) | 'id'      => 'include\_title', |
| [85](#L85) | 'title'   => \_\_( 'Image Title Attribute', 'foogallery' ), |
| [86](#L86) | 'desc'    => \_\_( 'You can choose to include a title attribute on the thumbnail image or not.', 'foogallery' ), |
| [87](#L87) | 'section' => \_\_( 'Advanced', 'foogallery' ), |
| [88](#L88) | 'type'     => 'radio', |
| [89](#L89) | 'spacer'   => '<span class="spacer"></span>', |
| [90](#L90) | 'default'  => '', |
| [91](#L91) | 'choices'  => array( |
| [92](#L92) | '' => \_\_( 'Enabled', 'foogallery' ), |
| [93](#L93) | 'disabled' => \_\_( 'Disabled', 'foogallery' ), |
| [94](#L94) | ), |
| [95](#L95) | 'row\_data' => array( |
| [96](#L96) | 'data-foogallery-change-selector' => 'input:radio', |
| [97](#L97) | 'data-foogallery-preview' => 'shortcode' |
| [98](#L98) | ) |
| [99](#L99) | ); |
| [100](#L100) |  |
| [101](#L101) | return $fields; |
| [102](#L102) | } |
| [103](#L103) |  |
| [104](#L104) | /\*\* |
| [105](#L105) | \* Add the required data options |
| [106](#L106) | \* |
| [107](#L107) | \* @param $options |
| [108](#L108) | \* @param $gallery    FooGallery |
| [109](#L109) | \* |
| [110](#L110) | \* @param $attributes array |
| [111](#L111) | \* |
| [112](#L112) | \* @return array |
| [113](#L113) | \*/ |
| [114](#L114) | function add\_data\_options($options, $gallery, $attributes) { |
| [115](#L115) | $custom\_settings = foogallery\_gallery\_template\_setting( 'custom\_settings', '' ); |
| [116](#L116) |  |
| [117](#L117) | if ( !empty( $custom\_settings ) ) { |
| [118](#L118) | $settings\_array = @json\_decode($custom\_settings, true); |
| [119](#L119) |  |
| [120](#L120) | if ( isset( $settings\_array ) ) { |
| [121](#L121) | $options = array\_replace\_recursive( $options, $settings\_array ); |
| [122](#L122) | } |
| [123](#L123) | } |
| [124](#L124) |  |
| [125](#L125) | return $options; |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) | /\*\* |
| [129](#L129) | \* Adds any custom attributes added to the gallery container attributes html |
| [130](#L130) | \* |
| [131](#L131) | \* @param $html |
| [132](#L132) | \* @param $attributes |
| [133](#L133) | \* @param $gallery |
| [134](#L134) | \* |
| [135](#L135) | \* @return mixed |
| [136](#L136) | \*/ |
| [137](#L137) | function add\_container\_attributes( $html, $attributes, $gallery ) { |
| [138](#L138) | global $current\_foogallery; |
| [139](#L139) |  |
| [140](#L140) | if ( $current\_foogallery === $gallery ) { |
| [141](#L141) | $custom\_attributes = foogallery\_gallery\_template\_setting( 'custom\_attributes', '' ); |
| [142](#L142) |  |
| [143](#L143) | // The stripping process is not quick, so only do this when necessary. |
| [144](#L144) | if ( ! empty( $custom\_attributes ) ) { |
| [145](#L145) | // Sanitize the custom attributes |
| [146](#L146) | $custom\_attributes = foogallery\_sanitize\_html($custom\_attributes); |
| [147](#L147) |  |
| [148](#L148) | // Filter out specific JavaScript-related attributes |
| [149](#L149) | $custom\_attributes = foogallery\_sanitize\_javascript($custom\_attributes); |
| [150](#L150) |  |
| [151](#L151) | if ( !empty( $custom\_attributes ) ) { |
| [152](#L152) | // Append the sanitized and filtered custom attributes to the gallery container |
| [153](#L153) | $html .= ' ' . $custom\_attributes; |
| [154](#L154) | } |
| [155](#L155) | } |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | return $html; |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) |  |
| [162](#L162) | /\*\* |
| [163](#L163) | \* Add the custom class to the array of classes |
| [164](#L164) | \* |
| [165](#L165) | \* @param $classes |
| [166](#L166) | \* @param $gallery |
| [167](#L167) | \* |
| [168](#L168) | \* @return array |
| [169](#L169) | \*/ |
| [170](#L170) | function add\_custom\_class( $classes, $gallery ) { |
| [171](#L171) | global $current\_foogallery; |
| [172](#L172) |  |
| [173](#L173) | if ( $current\_foogallery === $gallery ) { |
| [174](#L174) | $custom\_class = sanitize\_title( foogallery\_gallery\_template\_setting( 'custom\_class', '' ) ); |
| [175](#L175) |  |
| [176](#L176) | if ( !empty( $custom\_class ) ) { |
| [177](#L177) | $classes[] = $custom\_class; |
| [178](#L178) | } |
| [179](#L179) | } |
| [180](#L180) |  |
| [181](#L181) | return $classes; |
| [182](#L182) | } |
| [183](#L183) | } |
| [184](#L184) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php?rev=3027668&format=txt)
* [Original Format](/export/3027668/foogallery/tags/2.4.9/includes/class-gallery-advanced-settings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


