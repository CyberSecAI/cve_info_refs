=== Content from github.com_f4f10e29_20250114_185107.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-g6qc-fhcq-vhf9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgoogle%2Fsecurity-research%2Fsecurity%2Fadvisories%2FGHSA-g6qc-fhcq-vhf9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=google%2Fsecurity-research)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[google](/google)
/
**[security-research](/google/security-research)**
Public

* [Notifications](/login?return_to=%2Fgoogle%2Fsecurity-research) You must be signed in to change notification settings
* [Fork
  424](/login?return_to=%2Fgoogle%2Fsecurity-research)
* [Star
   3.5k](/login?return_to=%2Fgoogle%2Fsecurity-research)

* [Code](/google/security-research)
* [Issues
  8](/google/security-research/issues)
* [Pull requests
  15](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

Additional navigation options

* [Code](/google/security-research)
* [Issues](/google/security-research/issues)
* [Pull requests](/google/security-research/pulls)
* [Actions](/google/security-research/actions)
* [Security](/google/security-research/security)
* [Insights](/google/security-research/pulse)

# Kakadu: JPX fragmented list vulnerability

High

[rcorrea35](/rcorrea35)
published
GHSA-g6qc-fhcq-vhf9
Dec 15, 2023

## Package

JPEG 2000, JPX
(Kakadu SDK)

## Affected versions

4.4 - 8.4

## Patched versions

None

## Description

### Summary

Rec. ITU-T T.801 | ISO/IEC 15444-2 specifies the JPX file format, which can store images encoded using a variety of image codecs. The Fragment List (flst) box is optional feature of JPX that allows image data and metadata to be fragmented within the same file, across multiple files, or across multiple URLs on the internet. This feature, as currently described in the specification, is inherently vulnerable.

This feature becomes dangerous when a server accepts JPEG 2000 images from untrusted users and displays processed images back to them. In such cases, an attacker can exfiltrate local and remote files reachable by the server processing the image.

In this report, we provide multiple Proof-of-Concepts for exfiltrating local files.

[![unnamed](https://user-images.githubusercontent.com/108009481/290308094-0d899a07-2ad3-41ea-8e51-a44d10283c6b.png)](https://user-images.githubusercontent.com/108009481/290308094-0d899a07-2ad3-41ea-8e51-a44d10283c6b.png)

This image contains parts of the contents of /proc/self/exe. We used Kakadu's kdu\_expand binary to generate this image.

### Severity

High - allows an attacker to exfiltrate local and remote files reachable by a server if the server allows the attacker to upload a specially-crafted the image that is displayed back to the attacker.

### Proof of Concept

This proof-of-concept is based on Fragment Table boxes and uses the Kakadu's kdu\_expand program, which decodes JPX files containing JPEG 2000 images as specified in Rec. ITU-T T.800 | ISO/IEC 15444-1. Other implementations of the JPX file format using other image codecs might be vulnerable.

#### Dimension-Based File-Read

The size of the image (height, width and number of colors) is provided by the SIZ Segment Marker. The marker also determines the height and width of the tiles. Its layout is shown below:

[![Screenshot 2023-12-13 at 10 55 30 AM](https://user-images.githubusercontent.com/108009481/290250290-27c0cc32-98c6-41cd-8b49-44b2aefa4a03.png)](https://user-images.githubusercontent.com/108009481/290250290-27c0cc32-98c6-41cd-8b49-44b2aefa4a03.png)

The most important fields are:

* Xsiz: Width of the decompressed image as a 4-byte field
* Ysiz: Height of the decompressed image as a 4-byte field
* XTsiz: Width of one tile as a 4-byte field
* YTsiz: Height of one tile as a 4-byte field

We decided to inject bytes from a local ﬁle into the SIZ segment marker, since we assume a setup where an attacker can see the image’s output dimensions.

Since neither the width or the height of an image can be zero, and they are 32-bit unsigned integers, we encoded each as (0x00, 0x00, 0x01, ), thus each would end up being 0x100 + the value of the respective read byte, giving us a range from 0x100 to 0x1FF.

represents the injected byte. We can inject this byte both into the Xsiz and Ysiz ﬁeld, where Xsiz contains the ﬁrst byte and Ysiz the second byte to leak. This allows an attacker to leak 2 bytes of a local ﬁle with a single image.

Since an attacker can control the offset of the bytes within the local ﬁle, they can repeatedly upload the ﬁle with increasing offsets to leak the full ﬁle contents.

#### Dynamic Tile Read

To leak more data in a single image, we needed to either ﬁnd a single segment marker with a large array of data that could be reliably decoded from the output image OR ﬁnd a segment marker that could be repeated in the image to have some noticeable effect.

One tempting target is the tile data itself. What if we created an image with a single large tile, and then used a large number of leaked bytes in the compressed pixel data within this tile.

Unfortunately, the compression applied to tiles made this impossible. The tile data is encoded using a variable length encoding technique, and does not permit the 0xFF byte in the stream. Additionally, the compression used in JPEG 2000 is incredibly complex, using wavelet transforms with dynamic coeﬃcients. The length of the tile and meaning of the tile changed based on the data that we leaked, and changed in such a way that almost guaranteed parsing errors.

We set out looking for a segment marker that could be repeated with a useful effect and settled on the Comment (COM) marker. The COM marker includes an arbitrary number of bytes of unstructured data. However, the COM marker was not saved to the output image, otherwise we could have easily leaked data in the Ccomi bytes. In spite of this, the COM marker was valid in any part of the codestream and had variable length, which made it quite useful for us.

The COM marker has the following ﬁelds:

[![Screenshot 2023-12-13 at 10 57 50 AM](https://user-images.githubusercontent.com/108009481/290250990-d13690ad-f2e9-48a5-8472-f5516e8167b1.png)](https://user-images.githubusercontent.com/108009481/290250990-d13690ad-f2e9-48a5-8472-f5516e8167b1.png)

We devised a mechanism to leak a single byte per tile with a jump table based on leaked bytes. We used three types of codestream marker to craft this primitive: Start-of-tile (SOT), Comment (COM), and Start-of-Data (SOD).

For each tile, we included a COM marker with variable length depending on a leaked byte (di). We then included a table of 256 entries, each with tile data and another COM marker. In each entry, we included tile data encoding a different pixel color. Each of these entries was exactly 256 bytes long, meaning depending on the value of the leaked byte, a different entry would be "chosen". An example of this encoding is shown below:

[![Screenshot 2023-12-13 at 10 58 51 AM](https://user-images.githubusercontent.com/108009481/290251332-7e77194e-01d5-465e-818c-b74341607580.png)](https://user-images.githubusercontent.com/108009481/290251332-7e77194e-01d5-465e-818c-b74341607580.png)

Using this mechanism, we managed to leak 20KB of data in a single image. The following screenshot shows the output image of an image converted using Kakadu:

### Further Analysis

Please download the attached Proof-of-Concept file: <https://github.com/google/security-research/blob/master/pocs/kakadu/passwd.jp2.zip>

Then, take a JPEG 2000 decoder of your choosing that supports fragmentation and decode the image so that it can be viewed, e.g. by converting it to a JPG or PNG. This file reads the contents of /etc/passwd. You can also verify this by observing the process and which files are opened via strace, e.g.:

strace -f PROGRAM /tmp/passwd.jp2 2>&1 | grep '/etc/passwd'

In theory, any image decoder that implements this part of the standard is vulnerable, but if you are running into issues reproducing this, please note that we used kdu\_expand from Kakadu to convert this image to a bmp file.

#### Mitigation

JPX readers should, by default, prevent accessing URLs found in a Fragment List box that are external to the JPX file.

### Timeline

**Date reported**: 10/24/2023

**Date fixed**: 11/13/2023

**Date disclosed**: 12/15/2023

### Severity

High

### CVE ID

CVE-2023-6562

### Weaknesses

No CWEs

### Credits

* [![@scannells](https://avatars.githubusercontent.com/u/21333136?s=40&v=4)](/scannells)
  [scannells](/scannells)
  Finder
* [![@ezequielpereira](https://avatars.githubusercontent.com/u/3056586?s=40&v=4)](/ezequielpereira)
  [ezequielpereira](/ezequielpereira)
  Finder
* [![@amlweems](https://avatars.githubusercontent.com/u/117625?s=40&v=4)](/amlweems)
  [amlweems](/amlweems)
  Finder
* [![@thatjiaozi](https://avatars.githubusercontent.com/u/8826664?s=40&v=4)](/thatjiaozi)
  [thatjiaozi](/thatjiaozi)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


