=== Content from plugins.trac.wordpress.org_9b2021fc_20250114_181615.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fgreenshift-animation-and-page-builder-blocks%2Ftrunk%2Fsettings.php%3Frev%3D3006373)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=2991369 "Revision 2991369")
* [Latest Revision](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php)
* [Next Revision](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3009030 "Revision 3009030") →
* [Blame](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?annotate=blame&rev=3006373 "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3006373)

---

# [source:](/browser?rev=3006373&order=name "Go to repository root") [greenshift-animation-and-page-builder-blocks](/browser/greenshift-animation-and-page-builder-blocks?rev=3006373&order=name "View greenshift-animation-and-page-builder-blocks")/[trunk](/browser/greenshift-animation-and-page-builder-blocks/trunk?rev=3006373&order=name "View trunk")/[settings.php](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3006373&order=name "View settings.php") @ [3006373](/changeset/3006373/ "View changeset 3006373")

View diff against:

View revision:

| [Last change](/changeset/2998344/greenshift-animation-and-page-builder-blocks/trunk/settings.php "View differences") on this file since 3006373 was [2998344](/changeset/2998344/ "View changeset 2998344"), checked in by wpsoul, [14 months ago](/timeline?from=2023-11-19T14%3A48%3A23Z&precision=second "See timeline at 11/19/2023 02:48:23 PM") |
| --- |
| update |
| **File size:** 54.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | // Exit if accessed directly |
| [3](#L3) | if (!defined('ABSPATH')) { |
| [4](#L4) | exit; |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | if (!class\_exists('GSPB\_GreenShift\_Settings')) { |
| [8](#L8) |  |
| [9](#L9) | class GSPB\_GreenShift\_Settings |
| [10](#L10) | { |
| [11](#L11) | private $allowed\_font\_ext = [ |
| [12](#L12) | 'woff2', |
| [13](#L13) | 'woff', |
| [14](#L14) | 'tiff', |
| [15](#L15) | 'ttf', |
| [16](#L16) | ]; |
| [17](#L17) |  |
| [18](#L18) | public function \_\_construct() |
| [19](#L19) | { |
| [20](#L20) | add\_action('admin\_menu', array($this, 'greenshift\_admin\_page')); |
| [21](#L21) | add\_action('wp\_footer', array($this, 'greenshift\_additional\_\_footer\_elements')); |
| [22](#L22) | add\_action('wp\_head', array($this, 'greenshift\_additional\_\_header\_elements')); |
| [23](#L23) | add\_action('wp\_ajax\_gspb\_generate\_stylebook', array($this, 'gspb\_generate\_stylebook')); |
| [24](#L24) | add\_action('admin\_init', array($this, 'gspb\_stylebook\_redirect')); |
| [25](#L25) | if (!defined('REHUB\_ADMIN\_DIR')) { |
| [26](#L26) | //Show Reusable blocks column |
| [27](#L27) | add\_action('registered\_post\_type', array($this, 'gspb\_template\_menu\_display'), 10, 2); |
| [28](#L28) | add\_filter('manage\_wp\_block\_posts\_columns', array($this, 'gspb\_template\_screen\_add\_column')); |
| [29](#L29) | add\_action('manage\_wp\_block\_posts\_custom\_column', array($this, 'gspb\_template\_screen\_fill\_column'), 1000, 2); |
| [30](#L30) | // Force Block editor for Reusable Blocks even when Classic editor plugin is activated |
| [31](#L31) | add\_filter('use\_block\_editor\_for\_post', array($this, 'gspb\_template\_gutenberg\_post'), 1000, 2); |
| [32](#L32) | add\_filter('use\_block\_editor\_for\_post\_type', array($this, 'gspb\_template\_gutenberg\_post\_type'), 1000, 2); |
| [33](#L33) | //Shortcode output for reusable blocks |
| [34](#L34) | add\_shortcode('wp\_reusable\_render', array($this, 'gspb\_template\_shortcode\_function')); |
| [35](#L35) | //Ajax render action |
| [36](#L36) | add\_action('wp\_ajax\_gspb\_el\_reusable\_load', array($this, 'gspb\_el\_reusable\_load')); |
| [37](#L37) | add\_action('wp\_ajax\_nopriv\_gspb\_el\_reusable\_load', array($this, 'gspb\_el\_reusable\_load')); |
| [38](#L38) | //settings fonts actions |
| [39](#L39) | add\_action('wp\_ajax\_gspb\_settings\_add\_font', array($this, 'gspb\_settings\_add\_font')); |
| [40](#L40) | } |
| [41](#L41) | } |
| [42](#L42) |  |
| [43](#L43) | public function greenshift\_admin\_page() |
| [44](#L44) | { |
| [45](#L45) |  |
| [46](#L46) | $parent\_slug = 'greenshift\_dashboard'; |
| [47](#L47) |  |
| [48](#L48) | add\_menu\_page( |
| [49](#L49) | 'GreenShift', |
| [50](#L50) | 'GreenShift', |
| [51](#L51) | 'manage\_options', |
| [52](#L52) | $parent\_slug, |
| [53](#L53) | array($this, 'welcome\_page'), |
| [54](#L54) | plugin\_dir\_url(\_\_FILE\_\_) . 'libs/gspbLogo.svg', |
| [55](#L55) | 70 |
| [56](#L56) | ); |
| [57](#L57) |  |
| [58](#L58) | add\_submenu\_page( |
| [59](#L59) | $parent\_slug, |
| [60](#L60) | esc\_html\_\_('Settings', 'greenshift-animation-and-page-builder-blocks'), |
| [61](#L61) | esc\_html\_\_('Settings', 'greenshift-animation-and-page-builder-blocks'), |
| [62](#L62) | 'manage\_options', |
| [63](#L63) | 'greenshift', |
| [64](#L64) | array($this, 'settings\_page') |
| [65](#L65) | ); |
| [66](#L66) |  |
| [67](#L67) | add\_submenu\_page( |
| [68](#L68) | $parent\_slug, |
| [69](#L69) | esc\_html\_\_('Addons', 'greenshift-animation-and-page-builder-blocks'), |
| [70](#L70) | esc\_html\_\_('Addons', 'greenshift-animation-and-page-builder-blocks'), |
| [71](#L71) | 'manage\_options', |
| [72](#L72) | 'greenshift\_dashboard-addons', |
| [73](#L73) | array($this, 'addons\_page') |
| [74](#L74) | ); |
| [75](#L75) |  |
| [76](#L76) | add\_submenu\_page( |
| [77](#L77) | $parent\_slug, |
| [78](#L78) | esc\_html\_\_('Upgrade', 'greenshift-animation-and-page-builder-blocks'), |
| [79](#L79) | esc\_html\_\_('Upgrade', 'greenshift-animation-and-page-builder-blocks'), |
| [80](#L80) | 'manage\_options', |
| [81](#L81) | 'greenshift\_upgrade', |
| [82](#L82) | array($this, 'upgrade\_page') |
| [83](#L83) | ); |
| [84](#L84) |  |
| [85](#L85) | add\_submenu\_page( |
| [86](#L86) | $parent\_slug, |
| [87](#L87) | esc\_html\_\_('Contact Us', 'greenshift-animation-and-page-builder-blocks'), |
| [88](#L88) | esc\_html\_\_('Contact Us', 'greenshift-animation-and-page-builder-blocks'), |
| [89](#L89) | 'manage\_options', |
| [90](#L90) | 'greenshift\_contact', |
| [91](#L91) | array($this, 'contact\_page') |
| [92](#L92) | ); |
| [93](#L93) | add\_submenu\_page( |
| [94](#L94) | $parent\_slug, |
| [95](#L95) | esc\_html\_\_('Import/Export', 'greenshift-animation-and-page-builder-blocks'), |
| [96](#L96) | esc\_html\_\_('Import/Export', 'greenshift-animation-and-page-builder-blocks'), |
| [97](#L97) | 'manage\_options', |
| [98](#L98) | 'greenshift\_import', |
| [99](#L99) | array($this, 'import\_page') |
| [100](#L100) | ); |
| [101](#L101) | add\_submenu\_page( |
| [102](#L102) | $parent\_slug, |
| [103](#L103) | esc\_html\_\_('Demo Import', 'greenshift-animation-and-page-builder-blocks'), |
| [104](#L104) | esc\_html\_\_('Demo Import', 'greenshift-animation-and-page-builder-blocks'), |
| [105](#L105) | 'manage\_options', |
| [106](#L106) | 'greenshift\_demo', |
| [107](#L107) | array($this, 'import\_demo') |
| [108](#L108) | ); |
| [109](#L109) |  |
| [110](#L110) | $stylebook\_post\_id = get\_option('gspb\_stylebook\_id'); |
| [111](#L111) |  |
| [112](#L112) | if ($stylebook\_post\_id) { |
| [113](#L113) |  |
| [114](#L114) | $editposturl = get\_edit\_post\_link($stylebook\_post\_id); |
| [115](#L115) |  |
| [116](#L116) | add\_submenu\_page( |
| [117](#L117) | $parent\_slug, |
| [118](#L118) | esc\_html\_\_('Stylebook', 'greenshift-animation-and-page-builder-blocks'), |
| [119](#L119) | esc\_html\_\_('Stylebook', 'greenshift-animation-and-page-builder-blocks'), |
| [120](#L120) | 'manage\_options', |
| [121](#L121) | $editposturl |
| [122](#L122) | ); |
| [123](#L123) | } else { |
| [124](#L124) |  |
| [125](#L125) | add\_submenu\_page( |
| [126](#L126) | $parent\_slug, |
| [127](#L127) | esc\_html\_\_('Stylebook', 'greenshift-animation-and-page-builder-blocks'), |
| [128](#L128) | esc\_html\_\_('Stylebook', 'greenshift-animation-and-page-builder-blocks'), |
| [129](#L129) | 'manage\_options', |
| [130](#L130) | 'greenshift\_stylebook', |
| [131](#L131) | array($this, 'stylebook\_page\_callback') |
| [132](#L132) | ); |
| [133](#L133) | } |
| [134](#L134) | } |
| [135](#L135) |  |
| [136](#L136) | public function welcome\_page() |
| [137](#L137) | { |
| [138](#L138) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/welcome-page.php'; |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | public function contact\_page() |
| [142](#L142) | { |
| [143](#L143) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/contact-page.php'; |
| [144](#L144) | } |
| [145](#L145) |  |
| [146](#L146) | public function import\_page() |
| [147](#L147) | { |
| [148](#L148) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/import-page.php'; |
| [149](#L149) | } |
| [150](#L150) |  |
| [151](#L151) | public function import\_demo() |
| [152](#L152) | { |
| [153](#L153) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/import-demo.php'; |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | public function addons\_page() |
| [157](#L157) | { |
| [158](#L158) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/addon-page.php'; |
| [159](#L159) | } |
| [160](#L160) |  |
| [161](#L161) | public function upgrade\_page() |
| [162](#L162) | { |
| [163](#L163) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/upgrade-page.php'; |
| [164](#L164) | } |
| [165](#L165) |  |
| [166](#L166) | public function stylebook\_page\_callback() |
| [167](#L167) | { |
| [168](#L168) | ?> |
| [169](#L169) | <style> |
| [170](#L170) | #greenshift\_stylebook\_btn { |
| [171](#L171) | margin-top: 30px; |
| [172](#L172) | width: 220px; |
| [173](#L173) | height: 40px; |
| [174](#L174) | font-size: 1rem; |
| [175](#L175) | line-height: 1rem; |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | .stylbook\_btn\_wrapper { |
| [179](#L179) | position: relative; |
| [180](#L180) | display: flex; |
| [181](#L181) | align-items: center; |
| [182](#L182) | } |
| [183](#L183) | </style> |
| [184](#L184) | <script> |
| [185](#L185) | jQuery(document).ready(function($) { |
| [186](#L186) | // Stylebook ajax request |
| [187](#L187) | $("#stylebook\_generation").submit(function(e) { |
| [188](#L188) | e.preventDefault(); |
| [189](#L189) |  |
| [190](#L190) | $('#ajax-response').html(''); |
| [191](#L191) |  |
| [192](#L192) | const targetForm = e.target; |
| [193](#L193) | const payload = new FormData(targetForm); |
| [194](#L194) | payload.append("action", "gspb\_generate\_stylebook") |
| [195](#L195) | $.ajax({ |
| [196](#L196) | method: "POST", |
| [197](#L197) | url: ajaxurl, |
| [198](#L198) | processData: false, |
| [199](#L199) | contentType: false, |
| [200](#L200) | data: payload, |
| [201](#L201) | beforeSend: function(response) { |
| [202](#L202) | $(".spinner").addClass("is-active"); |
| [203](#L203) | } |
| [204](#L204) | }) |
| [205](#L205) | .success(function(response) { |
| [206](#L206) | $(".spinner").removeClass("is-active"); |
| [207](#L207) | if (response.data.status == "success") { |
| [208](#L208) | const post\_link = response?.data?.post\_link; |
| [209](#L209) | if (post\_link) { |
| [210](#L210) | const postEditLink = post\_link.replace(/&amp;/g, '&'); |
| [211](#L211) | window.location.href = postEditLink; |
| [212](#L212) | } |
| [213](#L213) | } |
| [214](#L214) | if (response.data.status == "error") { |
| [215](#L215) | $('#ajax-response').append('<div class="notice notice-error"><p>' + response.data.msg + '</p></div>'); |
| [216](#L216) | } |
| [217](#L217) | }) |
| [218](#L218) | .error(function(response) { |
| [219](#L219) | $(".spinner").removeClass("is-active"); |
| [220](#L220) | $('#ajax-response').append('<div class="notice notice-error"><p>Something went wrong.</p></div>'); |
| [221](#L221) | }); |
| [222](#L222) |  |
| [223](#L223) | }); |
| [224](#L224) | }); |
| [225](#L225) | </script> |
| [226](#L226) | <div class="stylebook\_form\_wrap"> |
| [227](#L227) | <h1><?php \_e('GreenShift Stylebook', 'greenshift-animation-and-page-builder-blocks'); ?></h1> |
| [228](#L228) | <div id="ajax-response"> </div> |
| [229](#L229) | <form id="stylebook\_generation" method="post" class="stylbook\_btn\_wrapper"> |
| [230](#L230) | <?php wp\_nonce\_field('gspb\_generate\_stylebook', 'gspb\_stylebook'); ?> |
| [231](#L231) | <div class="stylbook\_btn\_wrapper"> |
| [232](#L232) | <input type="submit" id="greenshift\_stylebook\_btn" name="greenshift\_stylebook\_btn" value=<?php \_e('Create Stylebook', 'greenshift-animation-and-page-builder-blocks'); ?> class="button button-primary button-large"> |
| [233](#L233) | <span class="spinner"></span> |
| [234](#L234) | </div> |
| [235](#L235) | </form> |
| [236](#L236) | </div> |
| [237](#L237) | <?php |
| [238](#L238) | } |
| [239](#L239) |  |
| [240](#L240) | public function gspb\_stylebook\_redirect() |
| [241](#L241) | { |
| [242](#L242) | if (isset($\_GET['post\_type']) && $\_GET['post\_type'] === 'gspbstylebook') { |
| [243](#L243) | wp\_safe\_redirect(admin\_url('?page=greenshift\_dashboard')); |
| [244](#L244) | exit; |
| [245](#L245) | } |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | public function gspb\_generate\_stylebook() |
| [249](#L249) | { |
| [250](#L250) |  |
| [251](#L251) | $response = array(); |
| [252](#L252) |  |
| [253](#L253) | if (!isset($\_POST['gspb\_stylebook'])  || !wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_stylebook'])), 'gspb\_generate\_stylebook')) { |
| [254](#L254) |  |
| [255](#L255) | $response =  array( |
| [256](#L256) | 'status' => 'error', |
| [257](#L257) | 'msg' => 'User Security not varified.' |
| [258](#L258) | ); |
| [259](#L259) | } else { |
| [260](#L260) | $stylebook\_post\_id = get\_option('gspb\_stylebook\_id'); |
| [261](#L261) |  |
| [262](#L262) | if (!$stylebook\_post\_id || !get\_edit\_post\_link($stylebook\_post\_id)) { |
| [263](#L263) |  |
| [264](#L264) | // Create post object |
| [265](#L265) | $stylebook\_post = array( |
| [266](#L266) | 'post\_title'    => 'Greenshift Stylebook', |
| [267](#L267) | 'post\_type'             => 'gspbstylebook', |
| [268](#L268) | 'post\_name'             =>      'greenshift-stylebook', |
| [269](#L269) | 'post\_content'  =>      '<!-- wp:greenshift-blocks/stylebook /-->', |
| [270](#L270) | 'post\_status'   => 'publish', |
| [271](#L271) | ); |
| [272](#L272) |  |
| [273](#L273) | // Insert the post into the database |
| [274](#L274) | $stylebook\_post\_id = wp\_insert\_post($stylebook\_post); |
| [275](#L275) |  |
| [276](#L276) | if (!is\_wp\_error($stylebook\_post\_id)) { |
| [277](#L277) |  |
| [278](#L278) | $response =  array( |
| [279](#L279) | 'status' => 'success', |
| [280](#L280) | 'post\_link' => get\_edit\_post\_link($stylebook\_post\_id) |
| [281](#L281) | ); |
| [282](#L282) |  |
| [283](#L283) | update\_option('gspb\_stylebook\_id', $stylebook\_post\_id); |
| [284](#L284) |  |
| [285](#L285) | // we need to flush this because post is created programatically. |
| [286](#L286) | flush\_rewrite\_rules(); |
| [287](#L287) | } else { |
| [288](#L288) |  |
| [289](#L289) | $response =  array( |
| [290](#L290) | 'status' => 'error', |
| [291](#L291) | 'msg' => $stylebook\_post\_id->get\_error\_message() |
| [292](#L292) | ); |
| [293](#L293) |  |
| [294](#L294) | return $response; |
| [295](#L295) | } |
| [296](#L296) | } else { |
| [297](#L297) |  |
| [298](#L298) | $response =  array( |
| [299](#L299) | 'status' => 'success', |
| [300](#L300) | 'post\_link' => get\_edit\_post\_link($stylebook\_post\_id) |
| [301](#L301) | ); |
| [302](#L302) | } |
| [303](#L303) | } |
| [304](#L304) |  |
| [305](#L305) | wp\_send\_json\_success($response); |
| [306](#L306) | } |
| [307](#L307) |  |
| [308](#L308) | public function settings\_page() |
| [309](#L309) | { |
| [310](#L310) |  |
| [311](#L311) | if (!current\_user\_can('manage\_options')) { |
| [312](#L312) | wp\_die('Unauthorized user'); |
| [313](#L313) | } |
| [314](#L314) |  |
| [315](#L315) | // Get the active tab from the $\_GET param |
| [316](#L316) | $default\_tab = null; |
| [317](#L317) | $tab  = isset($\_GET['tab']) ? sanitize\_text\_field($\_GET['tab']) : $default\_tab; |
| [318](#L318) |  |
| [319](#L319) | ?> |
| [320](#L320) | <?php wp\_enqueue\_style('greenShift-admin-css'); ?> |
| [321](#L321) | <div class="wp-block-greenshift-blocks-container alignfull gspb\_container gspb\_container-gsbp-ead11204-4841" id="gspb\_container-id-gsbp-ead11204-4841"> |
| [322](#L322) | <div class="wp-block-greenshift-blocks-container gspb\_container gspb\_container-gsbp-cbc3fa8c-bb26" id="gspb\_container-id-gsbp-cbc3fa8c-bb26"> |
| [323](#L323) |  |
| [324](#L324) | <?php $activetab = 'settings'; ?> |
| [325](#L325) | <?php include(GREENSHIFT\_DIR\_PATH . 'templates/admin/navleft.php'); ?> |
| [326](#L326) |  |
| [327](#L327) | <div class="wp-block-greenshift-blocks-container gspb\_container gspb\_container-gsbp-89d45563-1559" id="gspb\_container-id-gsbp-89d45563-1559"> |
| [328](#L328) |  |
| [329](#L329) | <div class="wp-block-greenshift-blocks-container gspb\_container gspb\_container-gsbp-efb64efe-d083" id="gspb\_container-id-gsbp-efb64efe-d083"> |
| [330](#L330) | <h2 id="gspb\_heading-id-gsbp-ca0b0ada-6561" class="gspb\_heading gspb\_heading-id-gsbp-ca0b0ada-6561 "><?php esc\_html\_e("Settings", 'greenshift-animation-and-page-builder-blocks'); ?></h2> |
| [331](#L331) | </div> |
| [332](#L332) |  |
| [333](#L333) | <div class="class-tabs-gs wp-block-greenshift-blocks-container gspb\_container gspb\_container-gsbp-01099b45-f36b" id="gspb\_container-id-gsbp-01099b45-f36b"> |
| [334](#L334) | <a href="?page=greenshift" id="gspb\_text-id-gsbp-2c96ad79-8324" class="gspb\_text gspb\_text-id-gsbp-2c96ad79-8324 <?php if ($tab === null) : ?>gs-tab-active<?php endif; ?>"><?php esc\_html\_e("Font Options", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [335](#L335) | <a href="?page=greenshift&tab=breakpoints" id="gspb\_text-id-gsbp-557ed921-38fe" class="gspb\_text gspb\_text-id-gsbp-557ed921-38fe <?php if ($tab === 'breakpoints') : ?>gs-tab-active<?php endif; ?>"><?php esc\_html\_e("Breakpoints", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [336](#L336) | <a href="?page=greenshift&tab=save\_css" id="gspb\_text-id-gsbp-94bd1cf0-c77b" class="gspb\_text gspb\_text-id-gsbp-94bd1cf0-c77b <?php if ($tab === 'save\_css') : ?>gs-tab-active<?php endif; ?> "><?php esc\_html\_e("CSS Options", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [337](#L337) | <a href="?page=greenshift&tab=scripts" id="gspb\_text-id-gsbp-f27becf0-4d87" class="gspb\_text gspb\_text-id-gsbp-f27becf0-4d87   <?php if ($tab === 'scripts') : ?>gs-tab-active<?php endif; ?>"><?php esc\_html\_e("Script Options", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [338](#L338) | <a href="?page=greenshift&tab=header" id="gspb\_text-id-gsbp-f27becf0-4d87" class="gspb\_text gspb\_text-id-gsbp-f27becf0-4d87   <?php if ($tab === 'header') : ?>gs-tab-active<?php endif; ?>"><?php esc\_html\_e("Header/Footer code", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [339](#L339) | <a href="?page=greenshift&tab=keys" id="gspb\_text-id-gsbp-f27becf0-4d87" class="gspb\_text gspb\_text-id-gsbp-f27becf0-4d87   <?php if ($tab === 'keys') : ?>gs-tab-active<?php endif; ?>"><?php esc\_html\_e("API Keys", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [340](#L340) | </div> |
| [341](#L341) |  |
| [342](#L342) |  |
| [343](#L343) | <div class="wp-block-greenshift-blocks-container gspb\_container gspb\_container-gsbp-7b4f8e8f-1a69" id="gspb\_container-id-gsbp-7b4f8e8f-1a69"> |
| [344](#L344) | <div class="greenshift\_form"> |
| [345](#L345) | <?php |
| [346](#L346) | switch ($tab): |
| [347](#L347) | case 'save\_css': |
| [348](#L348) |  |
| [349](#L349) | if (isset($\_POST['gspb\_save\_settings'])) { |
| [350](#L350) | if (!wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { |
| [351](#L351) | esc\_html\_e("Sorry, your nonce did not verify.", 'greenshift-animation-and-page-builder-blocks'); |
| [352](#L352) | return; |
| [353](#L353) | } |
| [354](#L354) | update\_option('gspb\_css\_save', sanitize\_text\_field($\_POST['gspb\_settings\_option'])); |
| [355](#L355) |  |
| [356](#L356) | $default\_settings = get\_option('gspb\_global\_settings'); |
| [357](#L357) |  |
| [358](#L358) | $sanitised = array(); |
| [359](#L359) | if (!empty($\_POST['reusablestyles'])) { |
| [360](#L360) | foreach ($\_POST['reusablestyles'] as $key => $value) { |
| [361](#L361) | $sanitised['reusablestyles'][$key] = array( |
| [362](#L362) | "style" => sanitize\_textarea\_field($value['style']), |
| [363](#L363) | "blockname" =>  sanitize\_text\_field($value['blockname']), |
| [364](#L364) | ); |
| [365](#L365) | } |
| [366](#L366) | $newargs = wp\_parse\_args($sanitised, $default\_settings); |
| [367](#L367) | update\_option('gspb\_global\_settings', $newargs); |
| [368](#L368) | } |
| [369](#L369) | if (isset($\_POST['cf\_utility\_on'])) { |
| [370](#L370) | $newargs = wp\_parse\_args(array('cf\_utility\_on' => true), $default\_settings); |
| [371](#L371) | update\_option('gspb\_global\_settings', $newargs); |
| [372](#L372) | } else { |
| [373](#L373) | $newargs = wp\_parse\_args(array('cf\_utility\_on' => false), $default\_settings); |
| [374](#L374) | update\_option('gspb\_global\_settings', $newargs); |
| [375](#L375) | } |
| [376](#L376) | } |
| [377](#L377) |  |
| [378](#L378) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [379](#L379) | $css\_tsyle\_option = get\_option('gspb\_css\_save'); |
| [380](#L380) | $cf\_utility\_on = !empty($global\_settings['cf\_utility\_on']) ? $global\_settings['cf\_utility\_on'] : ''; |
| [381](#L381) | ?> |
| [382](#L382) | <div class="gspb\_settings\_form"> |
| [383](#L383) | <form method="POST"> |
| [384](#L384) | <div class="greenshift\_form"> |
| [385](#L385) | <?php wp\_nonce\_field('gspb\_settings\_page\_action', 'gspb\_settings\_field'); ?> |
| [386](#L386) | <div class="wp-block-greenshift-blocks-infobox gspb\_infoBox gspb\_infoBox-id-gsbp-158b5f3e-b35c" id="gspb\_infoBox-id-gsbp-158b5f3e-b35c"> |
| [387](#L387) | <div class="gs-box notice\_type icon\_type"> |
| [388](#L388) | <div class="gs-box-icon"><svg class="" style="display:inline-block;vertical-align:middle" width="32" height="32" viewBox="0 0 704 1024" xmlns="http://www.w3.org/2000/svg"> |
| [389](#L389) | <path style="fill:#565D66" d="M352 160c-105.88 0-192 86.12-192 192 0 17.68 14.32 32 32 32s32-14.32 32-32c0-70.6 57.44-128 128-128 17.68 0 32-14.32 32-32s-14.32-32-32-32zM192.12 918.34c0 6.3 1.86 12.44 5.36 17.68l49.020 73.68c5.94 8.92 15.94 14.28 26.64 14.28h157.7c10.72 0 20.72-5.36 26.64-14.28l49.020-73.68c3.48-5.24 5.34-11.4 5.36-17.68l0.1-86.36h-319.92l0.080 86.36zM352 0c-204.56 0-352 165.94-352 352 0 88.74 32.9 169.7 87.12 231.56 33.28 37.98 85.48 117.6 104.84 184.32v0.12h96v-0.24c-0.020-9.54-1.44-19.020-4.3-28.14-11.18-35.62-45.64-129.54-124.34-219.34-41.080-46.86-63.040-106.3-63.22-168.28-0.4-147.28 119.34-256 255.9-256 141.16 0 256 114.84 256 256 0 61.94-22.48 121.7-63.3 168.28-78.22 89.22-112.84 182.94-124.2 218.92-2.805 8.545-4.428 18.381-4.44 28.594l-0 0.006v0.2h96v-0.1c19.36-66.74 71.56-146.36 104.84-184.32 54.2-61.88 87.1-142.84 87.1-231.58 0-194.4-157.6-352-352-352z"></path> |
| [390](#L390) | </svg></div> |
| [391](#L391) | <div class="gs-box-text"> |
| [392](#L392) | <?php esc\_html\_e("Use Inline in block only if you have some issues with not updating styles of blocks or cache. Once saved as inline in block, styles can be overwritten only when you update post with blocks", 'greenshift-animation-and-page-builder-blocks'); ?> |
| [393](#L393) | </div> |
| [394](#L394) | </div> |
| [395](#L395) | </div> |
| [396](#L396) | <table class="form-table"> |
| [397](#L397) | <tr> |
| [398](#L398) | <td> <label for="css\_system"><?php esc\_html\_e("Css location", 'greenshift-animation-and-page-builder-blocks'); ?></label> </td> |
| [399](#L399) | <td> |
| [400](#L400) | <select name="gspb\_settings\_option"> |
| [401](#L401) | <option value="inline" <?php selected($css\_tsyle\_option, 'inline'); ?>><?php esc\_html\_e("Inline in Head", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [402](#L402) | <option value="inlineblock" <?php selected($css\_tsyle\_option, 'inlineblock'); ?>> <?php esc\_html\_e("Inline in block", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [403](#L403) | </select> |
| [404](#L404) | </td> |
| [405](#L405) | </tr> |
| [406](#L406) | <tr> |
| [407](#L407) | <td> <label for="css\_system\_cf"><?php esc\_html\_e("Support for Core Framework Utility classes", 'greenshift-animation-and-page-builder-blocks'); ?></label> </td> |
| [408](#L408) | <td> |
| [409](#L409) | <input type="checkbox" name="cf\_utility\_on" id="cf\_utility\_on" <?php echo $cf\_utility\_on == true ? 'checked' : ''; ?> /> |
| [410](#L410) | </td> |
| [411](#L411) | </tr> |
| [412](#L412) | </table> |
| [413](#L413) |  |
| [414](#L414) | <input type="submit" name="gspb\_save\_settings" value="<?php esc\_html\_e("Save settings"); ?>" class="button button-primary button-large"> |
| [415](#L415) | </div> |
| [416](#L416) |  |
| [417](#L417) | <h2 style="margin-top:40px"><?php esc\_html\_e("Global Reusable CSS", 'greenshift-animation-and-page-builder-blocks'); ?></h2> |
| [418](#L418) |  |
| [419](#L419) | <div class="greenshift\_form"> |
| [420](#L420) | <?php |
| [421](#L421) | $gs\_reusable\_css = (!empty($global\_settings['reusablestyles'])) ? $global\_settings['reusablestyles'] : ''; |
| [422](#L422) | if ($gs\_reusable\_css) { |
| [423](#L423) | foreach ($gs\_reusable\_css as $key => $value) { |
| [424](#L424) | echo '<div style="margin-bottom:5px;    color: #999;">'; |
| [425](#L425) | esc\_html\_e("Class: ", 'greenshift-animation-and-page-builder-blocks'); |
| [426](#L426) | echo esc\_attr($key); |
| [427](#L427) | echo ', '; |
| [428](#L428) | esc\_html\_e("Block Type: ", 'greenshift-animation-and-page-builder-blocks'); |
| [429](#L429) | echo esc\_attr($value['blockname']); |
| [430](#L430) | echo '</div>'; |
| [431](#L431) | echo '<textarea style="width:100%; border-color:#ddd" rows="5" name="reusablestyles[' . $key . '][style]" id="key\_' . $key . '">' . $value['style'] . '</textarea>'; |
| [432](#L432) | echo '<input type="hidden" name="reusablestyles[' . $key . '][blockname]" value="' . $value['blockname'] . '" /><br/><br/>'; |
| [433](#L433) | } |
| [434](#L434) | echo '<input type="submit" name="gspb\_save\_settings" value="' . esc\_html\_\_("Save settings") . '" class="button button-primary button-large">'; |
| [435](#L435) | } |
| [436](#L436) |  |
| [437](#L437) | ?> |
| [438](#L438) | </div> |
| [439](#L439) |  |
| [440](#L440) | </form> |
| [441](#L441) | </div> |
| [442](#L442) | <?php |
| [443](#L443) | break; |
| [444](#L444) | case 'breakpoints': |
| [445](#L445) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [446](#L446) | $gsbp\_breakpoints = apply\_filters('greenshift\_responsive\_breakpoints', array( |
| [447](#L447) | 'mobile'        => 576, |
| [448](#L448) | 'tablet'        => 768, |
| [449](#L449) | 'desktop' =>  992 |
| [450](#L450) | )); |
| [451](#L451) |  |
| [452](#L452) | if (isset($\_POST['gspb\_save\_settings']) && isset($\_POST['gspb\_settings\_field']) && wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { |
| [453](#L453) | $breakpoints = array( |
| [454](#L454) | "mobile" =>  sanitize\_text\_field($\_POST['mobile']), |
| [455](#L455) | "tablet" =>  sanitize\_text\_field($\_POST['tablet']), |
| [456](#L456) | "desktop" =>  sanitize\_text\_field($\_POST['desktop']), |
| [457](#L457) | "row" =>  sanitize\_text\_field($\_POST['row']), |
| [458](#L458) | ); |
| [459](#L459) | $global\_settings['breakpoints'] = $breakpoints; |
| [460](#L460) | update\_option('gspb\_global\_settings', $global\_settings); |
| [461](#L461) | } |
| [462](#L462) | ?> |
| [463](#L463) | <form method="POST" class="greenshift\_form"> |
| [464](#L464) | <?php wp\_nonce\_field('gspb\_settings\_page\_action', 'gspb\_settings\_field'); ?> |
| [465](#L465) | <table class="form-table"> |
| [466](#L466) |  |
| [467](#L467) | <tr> |
| [468](#L468) | <td> <?php esc\_html\_e("Mobile", 'greenshift-animation-and-page-builder-blocks'); ?> </td> |
| [469](#L469) | <td> |
| [470](#L470) | <input name="mobile" type="text" value="<?php if (isset($global\_settings['breakpoints']['mobile'])) { |
| [471](#L471) | echo esc\_attr($global\_settings['breakpoints']['mobile']); |
| [472](#L472) | }  ?>" placeholder="<?php echo (int)$gsbp\_breakpoints['mobile']; ?>" /> |
| [473](#L473) | </td> |
| [474](#L474) | </tr> |
| [475](#L475) | <tr> |
| [476](#L476) | <td> <?php esc\_html\_e("Tablet", 'greenshift-animation-and-page-builder-blocks'); ?> </td> |
| [477](#L477) | <td> |
| [478](#L478) | <input name="tablet" type="text" value="<?php if (isset($global\_settings['breakpoints']['tablet'])) { |
| [479](#L479) | echo esc\_attr($global\_settings['breakpoints']['tablet']); |
| [480](#L480) | } ?>" placeholder="<?php echo (int)$gsbp\_breakpoints['tablet']; ?>" /> |
| [481](#L481) | </td> |
| [482](#L482) | </tr> |
| [483](#L483) | <tr> |
| [484](#L484) | <td> <?php esc\_html\_e("Desktop", 'greenshift-animation-and-page-builder-blocks'); ?> </td> |
| [485](#L485) | <td> |
| [486](#L486) | <input name="desktop" type="text" value="<?php if (isset($global\_settings['breakpoints']['desktop'])) { |
| [487](#L487) | echo esc\_attr($global\_settings['breakpoints']['desktop']); |
| [488](#L488) | } ?>" placeholder="<?php echo (int)$gsbp\_breakpoints['desktop']; ?>" /> |
| [489](#L489) | </td> |
| [490](#L490) | </tr> |
| [491](#L491) | <tr> |
| [492](#L492) | <td> <?php esc\_html\_e("Default Row Content Width", 'greenshift-animation-and-page-builder-blocks'); ?> </td> |
| [493](#L493) | <td> |
| [494](#L494) | <input name="row" type="text" value="<?php if (isset($global\_settings['breakpoints']['row'])) { |
| [495](#L495) | echo esc\_attr($global\_settings['breakpoints']['row']); |
| [496](#L496) | } ?>" placeholder="<?php echo apply\_filters('gspb\_default\_row\_width\_px', 1200); ?>" /> |
| [497](#L497) | </td> |
| [498](#L498) | </tr> |
| [499](#L499) | </table> |
| [500](#L500) | <input type="submit" name="gspb\_save\_settings" value="Save" class="button button-primary button-large"> |
| [501](#L501) | </form> |
| [502](#L502) | <?php |
| [503](#L503) | break; |
| [504](#L504) | case 'scripts': |
| [505](#L505) | wp\_enqueue\_style('gsadminsettings'); |
| [506](#L506) | wp\_enqueue\_script('gsadminsettings'); |
| [507](#L507) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [508](#L508) | if (isset($\_POST['gspb\_save\_settings'])) { // Delay script saving |
| [509](#L509) | if (!wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { |
| [510](#L510) | esc\_html\_e("Sorry, your nonce did not verify.", 'greenshift-animation-and-page-builder-blocks'); |
| [511](#L511) | return; |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | $is\_dealyjson = isset($\_POST['delay\_js\_on']) && $\_POST['delay\_js\_on'] == "on" ? 1 : 0; |
| [515](#L515) | $jsdelay = array( |
| [516](#L516) | "delay\_js\_on" => $is\_dealyjson, |
| [517](#L517) | "delay\_js\_page\_on" =>  sanitize\_text\_field($\_POST['delay\_js\_page\_on']), |
| [518](#L518) | "delay\_js\_page\_list" =>  sanitize\_text\_field($\_POST['delay\_js\_page\_list']), |
| [519](#L519) | ); |
| [520](#L520) | $global\_settings['jsdelay'] = $jsdelay; |
| [521](#L521) |  |
| [522](#L522) | update\_option('gspb\_global\_settings', $global\_settings); |
| [523](#L523) | } |
| [524](#L524) | //Form for delay script saving |
| [525](#L525) | $delay\_js\_on = !empty($global\_settings['jsdelay']['delay\_js\_on']) ? $global\_settings['jsdelay']['delay\_js\_on'] : ''; |
| [526](#L526) | $delay\_js\_page\_on = !empty($global\_settings['jsdelay']['delay\_js\_page\_on']) ? $global\_settings['jsdelay']['delay\_js\_page\_on'] : ''; |
| [527](#L527) | $delay\_js\_page\_list = !empty($global\_settings['jsdelay']['delay\_js\_page\_list']) ? $global\_settings['jsdelay']['delay\_js\_page\_list'] : ''; |
| [528](#L528) |  |
| [529](#L529) | $show\_page\_option = $delay\_js\_on && ($delay\_js\_page\_on == "includefor" || $delay\_js\_page\_on  == "excludefor") ? true : false; |
| [530](#L530) |  |
| [531](#L531) | ?> |
| [532](#L532) | <div class="gspb\_settings\_form"> |
| [533](#L533) | <form method="POST"> |
| [534](#L534) | <h2><?php esc\_html\_e("Javascript Files Delay", 'greenshift-animation-and-page-builder-blocks'); ?></h2> |
| [535](#L535) | <div class="greenshift\_form"> |
| [536](#L536) | <div class="wp-block-greenshift-blocks-infobox gspb\_infoBox gspb\_infoBox-id-gsbp-158b5f3e-b35c" id="gspb\_infoBox-id-gsbp-158b5f3e-b35c"> |
| [537](#L537) | <div class="gs-box notice\_type icon\_type"> |
| [538](#L538) | <div class="gs-box-icon"><svg class="" style="display:inline-block;vertical-align:middle" width="32" height="32" viewBox="0 0 704 1024" xmlns="http://www.w3.org/2000/svg"> |
| [539](#L539) | <path style="fill:#565D66" d="M352 160c-105.88 0-192 86.12-192 192 0 17.68 14.32 32 32 32s32-14.32 32-32c0-70.6 57.44-128 128-128 17.68 0 32-14.32 32-32s-14.32-32-32-32zM192.12 918.34c0 6.3 1.86 12.44 5.36 17.68l49.020 73.68c5.94 8.92 15.94 14.28 26.64 14.28h157.7c10.72 0 20.72-5.36 26.64-14.28l49.020-73.68c3.48-5.24 5.34-11.4 5.36-17.68l0.1-86.36h-319.92l0.080 86.36zM352 0c-204.56 0-352 165.94-352 352 0 88.74 32.9 169.7 87.12 231.56 33.28 37.98 85.48 117.6 104.84 184.32v0.12h96v-0.24c-0.020-9.54-1.44-19.020-4.3-28.14-11.18-35.62-45.64-129.54-124.34-219.34-41.080-46.86-63.040-106.3-63.22-168.28-0.4-147.28 119.34-256 255.9-256 141.16 0 256 114.84 256 256 0 61.94-22.48 121.7-63.3 168.28-78.22 89.22-112.84 182.94-124.2 218.92-2.805 8.545-4.428 18.381-4.44 28.594l-0 0.006v0.2h96v-0.1c19.36-66.74 71.56-146.36 104.84-184.32 54.2-61.88 87.1-142.84 87.1-231.58 0-194.4-157.6-352-352-352z"></path> |
| [540](#L540) | </svg></div> |
| [541](#L541) | <div class="gs-box-text"> |
| [542](#L542) | <div><?php esc\_html\_e("Attention! This is experimental feature", "greenshift-animation-and-page-builder-blocks"); ?></div> |
| [543](#L543) | </div> |
| [544](#L544) | </div> |
| [545](#L545) | </div> |
| [546](#L546) |  |
| [547](#L547) | <?php wp\_nonce\_field('gspb\_settings\_page\_action', 'gspb\_settings\_field'); ?> |
| [548](#L548) | <table class="form-table"> |
| [549](#L549) | <tr> |
| [550](#L550) | <td colspan="2"> |
| [551](#L551) | <input type="checkbox" name="delay\_js\_on" id="delay\_js\_on" <?php echo $delay\_js\_on == true ? 'checked' : ''; ?> /> |
| [552](#L552) | <label for="delay\_js\_on"><?php esc\_html\_e("Enable script delay for Greenshift's scripts", 'greenshift-animation-and-page-builder-blocks'); ?></label> |
| [553](#L553) | </td> |
| [554](#L554) | </tr> |
| [555](#L555) | <tr class="delay\_js\_optionsrow" <?php echo $delay\_js\_on == true ? 'style="display: table-row;"' : ''; ?>> |
| [556](#L556) | <td> <label for="css\_system"><?php esc\_html\_e("Javascript delay options", 'greenshift-animation-and-page-builder-blocks'); ?></label> </td> |
| [557](#L557) | <td> |
| [558](#L558) | <select id="delay\_js\_page\_on" name="delay\_js\_page\_on"> |
| [559](#L559) | <option value="all" <?php selected($delay\_js\_page\_on, 'all'); ?>><?php esc\_html\_e("Enable on whole site", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [560](#L560) | <option value="includefor" <?php selected($delay\_js\_page\_on, 'includefor'); ?>> <?php esc\_html\_e("Enable only on selected pages", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [561](#L561) | <option value="excludefor" <?php selected($delay\_js\_page\_on, 'excludefor'); ?>> <?php esc\_html\_e("Enable on whole site except selected pages", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [562](#L562) | </select> |
| [563](#L563) | </td> |
| [564](#L564) | </tr> |
| [565](#L565) | <tr class="delay\_js\_pagerow" <?php echo $show\_page\_option == true ? 'style="display: table-row;"' : ''; ?>> |
| [566](#L566) | <td> |
| [567](#L567) | <label for="delay\_js\_page\_list"><?php esc\_html\_e("Page Urls (one per line).", 'greenshift-animation-and-page-builder-blocks'); ?></label> |
| [568](#L568) | </td> |
| [569](#L569) | <td> |
| [570](#L570) | <textarea style="width:100%; min-height:100px;" id="delay\_js\_page\_list" name="delay\_js\_page\_list"><?php echo esc\_html($delay\_js\_page\_list); ?></textarea> |
| [571](#L571) | <div style="margin-bottom:15px"><?php esc\_html\_e("Specify URLs of pages (one per line).", 'greenshift-animation-and-page-builder-blocks'); ?></div> |
| [572](#L572) | </td> |
| [573](#L573) | </tr> |
| [574](#L574) | </table> |
| [575](#L575) |  |
| [576](#L576) |  |
| [577](#L577) | <input type="submit" name="gspb\_save\_settings" value="<?php esc\_html\_e("Save settings"); ?>" class="button button-primary button-large javascript\_delay\_submit"> |
| [578](#L578) | </div> |
| [579](#L579) | </form> |
| [580](#L580) | </div> |
| [581](#L581) | <?php |
| [582](#L582) | //End Form for delay script saving |
| [583](#L583) | break; |
| [584](#L584) |  |
| [585](#L585) | case 'keys': |
| [586](#L586) |  |
| [587](#L587) | if (isset($\_POST['gspb\_save\_settings'])) { // Delay script saving |
| [588](#L588) | if (!wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { |
| [589](#L589) | esc\_html\_e("Sorry, your nonce did not verify.", 'greenshift-animation-and-page-builder-blocks'); |
| [590](#L590) | return; |
| [591](#L591) | } |
| [592](#L592) | $sanitised = array(); |
| [593](#L593) |  |
| [594](#L594) | if (isset($\_POST['googleapi']) || isset($\_POST['openaiapi']) || isset($\_POST['openaiapimodel'])) { |
| [595](#L595) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [596](#L596) | if (isset($\_POST['googleapi'])) { |
| [597](#L597) | $sanitised['googleapi'] = sanitize\_text\_field($\_POST['googleapi']); |
| [598](#L598) | } |
| [599](#L599) | if (isset($\_POST['openaiapi'])) { |
| [600](#L600) | $sanitised['openaiapi'] = sanitize\_text\_field($\_POST['openaiapi']); |
| [601](#L601) | } |
| [602](#L602) | if (isset($\_POST['openaiapimodel'])) { |
| [603](#L603) | $sanitised['openaiapimodel'] = sanitize\_text\_field($\_POST['openaiapimodel']); |
| [604](#L604) | } |
| [605](#L605) | $newargs = wp\_parse\_args($sanitised, $global\_settings); |
| [606](#L606) | update\_option('gspb\_global\_settings', $newargs); |
| [607](#L607) | } |
| [608](#L608) | } |
| [609](#L609) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [610](#L610) | //Form for delay script saving |
| [611](#L611) | $googleapi = !empty($global\_settings['googleapi']) ? $global\_settings['googleapi'] : ''; |
| [612](#L612) | $openaiapi = !empty($global\_settings['openaiapi']) ? $global\_settings['openaiapi'] : ''; |
| [613](#L613) | $openaiapimodel = !empty($global\_settings['openaiapimodel']) ? $global\_settings['openaiapimodel'] : ''; |
| [614](#L614) |  |
| [615](#L615) | ?> |
| [616](#L616) | <div class="gspb\_settings\_form"> |
| [617](#L617) | <form method="POST"> |
| [618](#L618) | <div class="greenshift\_form"> |
| [619](#L619) | <?php wp\_nonce\_field('gspb\_settings\_page\_action', 'gspb\_settings\_field'); ?> |
| [620](#L620) | <table class="form-table"> |
| [621](#L621) | <tbody> |
| [622](#L622) | <tr class="googleapikey"> |
| [623](#L623) | <td> |
| [624](#L624) | <label for="googleapi"><?php esc\_html\_e("Google API Key", 'greenshift-animation-and-page-builder-blocks'); ?></label> |
| [625](#L625) | </td> |
| [626](#L626) | <td> |
| [627](#L627) | <textarea style="width:100%; min-height:50px;border-color:#ddd" id="googleapi" name="googleapi"><?php echo esc\_html($googleapi); ?></textarea> |
| [628](#L628) | <div style="margin-bottom:15px"><a href="https://developers.google.com/maps/documentation/javascript/get-api-key"><?php esc\_html\_e("Get an API Key", 'greenshift-animation-and-page-builder-blocks'); ?></a></div> |
| [629](#L629) | </td> |
| [630](#L630) | </tr> |
| [631](#L631) | <tr class="openaiapikey"> |
| [632](#L632) | <td> |
| [633](#L633) | <label for="openaiapi"><?php esc\_html\_e("Open AI API Key", 'greenshift-animation-and-page-builder-blocks'); ?></label> |
| [634](#L634) | </td> |
| [635](#L635) | <td> |
| [636](#L636) | <textarea style="width:100%; min-height:50px;border-color:#ddd" id="openaiapi" name="openaiapi"><?php echo esc\_html($openaiapi); ?></textarea> |
| [637](#L637) | <div style="margin-bottom:15px"><a href="https://platform.openai.com/account/api-keys"><?php esc\_html\_e("Get an API Key", 'greenshift-animation-and-page-builder-blocks'); ?></a></div> |
| [638](#L638) | </td> |
| [639](#L639) | </tr> |
| [640](#L640) | <tr class="openaiapimodel"> |
| [641](#L641) | <td> |
| [642](#L642) | <label for="openaiapimodel"><?php esc\_html\_e("Open AI Model", 'greenshift-animation-and-page-builder-blocks'); ?></label> |
| [643](#L643) | </td> |
| [644](#L644) | <td> |
| [645](#L645) | <select name="openaiapimodel"> |
| [646](#L646) | <option value="gpt-3.5-turbo" <?php selected($openaiapimodel, 'gpt-3.5-turbo'); ?>><?php esc\_html\_e("gpt-3.5-turbo", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [647](#L647) | <option value="gpt-4" <?php selected($openaiapimodel, 'gpt-4'); ?>> <?php esc\_html\_e("gpt-4", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [648](#L648) | <option value="gpt-4-32k" <?php selected($openaiapimodel, 'gpt-4-32k'); ?>> <?php esc\_html\_e("gpt-4-32k", 'greenshift-animation-and-page-builder-blocks'); ?> </option> |
| [649](#L649) | </select> |
| [650](#L650) | </td> |
| [651](#L651) | </tr> |
| [652](#L652) | </tbody> |
| [653](#L653) | </table> |
| [654](#L654) |  |
| [655](#L655) |  |
| [656](#L656) | <input type="submit" name="gspb\_save\_settings" value="<?php esc\_html\_e("Save settings"); ?>" class="button button-primary button-large"> |
| [657](#L657) | </div> |
| [658](#L658) | </form> |
| [659](#L659) | </div> |
| [660](#L660) | <?php |
| [661](#L661) | //End Form for delay script saving |
| [662](#L662) | break; |
| [663](#L663) | case 'header': |
| [664](#L664) | $theme\_settings = get\_option('greenshift\_theme\_options'); |
| [665](#L665) |  |
| [666](#L666) | if (isset($\_POST['gspb\_save\_settings\_header'])) { // Delay script saving |
| [667](#L667) | if (!wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { |
| [668](#L668) | esc\_html\_e("Sorry, your nonce did not verify.", 'greenshift-animation-and-page-builder-blocks'); |
| [669](#L669) | return; |
| [670](#L670) | } |
| [671](#L671) | $sanitised = array(); |
| [672](#L672) |  |
| [673](#L673) | if (isset($\_POST['custom\_code\_in\_head'])) { |
| [674](#L674) | $theme\_settings['custom\_code\_in\_head'] = wp\_kses(wp\_unslash($\_POST['custom\_code\_in\_head']), [ |
| [675](#L675) | 'meta' => [ |
| [676](#L676) | 'charset' => [], |
| [677](#L677) | 'content' => [], |
| [678](#L678) | 'http-equiv' => [], |
| [679](#L679) | 'name' => [], |
| [680](#L680) | 'property' => [] |
| [681](#L681) | ], |
| [682](#L682) | 'style' => [ |
| [683](#L683) | 'media' => [], |
| [684](#L684) | 'type' => [] |
| [685](#L685) | ], |
| [686](#L686) | 'script' => [ |
| [687](#L687) | 'async' => [], |
| [688](#L688) | 'charset' => [], |
| [689](#L689) | 'defer' => [], |
| [690](#L690) | 'src' => [], |
| [691](#L691) | 'type' => [] |
| [692](#L692) | ], |
| [693](#L693) | 'link' => [ |
| [694](#L694) | 'href' => [], |
| [695](#L695) | 'rel' => [], |
| [696](#L696) | 'type' => [] |
| [697](#L697) | ] |
| [698](#L698) | ]); |
| [699](#L699) | } |
| [700](#L700) | if (isset($\_POST['custom\_code\_before\_closed\_body'])) { |
| [701](#L701) | $theme\_settings['custom\_code\_before\_closed\_body'] = wp\_kses(wp\_unslash($\_POST['custom\_code\_before\_closed\_body']), [ |
| [702](#L702) | 'meta' => [ |
| [703](#L703) | 'charset' => [], |
| [704](#L704) | 'content' => [], |
| [705](#L705) | 'http-equiv' => [], |
| [706](#L706) | 'name' => [], |
| [707](#L707) | 'property' => [] |
| [708](#L708) | ], |
| [709](#L709) | 'style' => [ |
| [710](#L710) | 'media' => [], |
| [711](#L711) | 'type' => [] |
| [712](#L712) | ], |
| [713](#L713) | 'script' => [ |
| [714](#L714) | 'async' => [], |
| [715](#L715) | 'charset' => [], |
| [716](#L716) | 'defer' => [], |
| [717](#L717) | 'src' => [], |
| [718](#L718) | 'type' => [] |
| [719](#L719) | ], |
| [720](#L720) | 'link' => [ |
| [721](#L721) | 'href' => [], |
| [722](#L722) | 'rel' => [], |
| [723](#L723) | 'type' => [] |
| [724](#L724) | ] |
| [725](#L725) | ]); |
| [726](#L726) | } |
| [727](#L727) | if (isset($\_POST['custom\_code\_in\_head']) || isset($\_POST['custom\_code\_before\_closed\_body'])) { |
| [728](#L728) | update\_option('greenshift\_theme\_options', $theme\_settings); |
| [729](#L729) | } |
| [730](#L730) | } |
| [731](#L731) | ?> |
| [732](#L732) | <h2><?php esc\_html\_e("Footer and Head Hooks", 'greenshift-animation-and-page-builder-blocks'); ?></h2> |
| [733](#L733) | <div class="greenshift\_form"> |
| [734](#L734) | <?php |
| [735](#L735) | $custom\_code\_in\_head = !empty($theme\_settings['custom\_code\_in\_head']) ? wp\_unslash($theme\_settings['custom\_code\_in\_head']) : ''; |
| [736](#L736) | $custom\_code\_before\_closed\_body = !empty($theme\_settings['custom\_code\_before\_closed\_body']) ? wp\_unslash($theme\_settings['custom\_code\_before\_closed\_body']) : ''; |
| [737](#L737) | ?> |
| [738](#L738) | <form method="POST"> |
| [739](#L739) | <?php wp\_nonce\_field('gspb\_settings\_page\_action', 'gspb\_settings\_field'); ?> |
| [740](#L740) | <table class="form-table"> |
| [741](#L741) | <tr> |
| [742](#L742) | <th> <label for="custom\_code\_in\_head"><?php esc\_html\_e("Custom code in head section", 'greenshift'); ?></label> </th> |
| [743](#L743) | <td> |
| [744](#L744) | <textarea name="custom\_code\_in\_head" id="" cols="30" rows="10" style="width: 100%"><?php echo $custom\_code\_in\_head ?></textarea> |
| [745](#L745) | </td> |
| [746](#L746) | </tr> |
| [747](#L747) | <tr> |
| [748](#L748) | <th> <label for="custom\_code\_before\_closed\_body"><?php esc\_html\_e("Custom code before closed Body", 'greenshift'); ?></label> </th> |
| [749](#L749) | <td> |
| [750](#L750) | <textarea name="custom\_code\_before\_closed\_body" id="" cols="30" rows="10" style="width: 100%"><?php echo $custom\_code\_before\_closed\_body ?></textarea> |
| [751](#L751) | </td> |
| [752](#L752) | </tr> |
| [753](#L753) | </table> |
| [754](#L754) | <input type="submit" name="gspb\_save\_settings\_header" value="<?php esc\_html\_e('Save', 'greenshift-animation-and-page-builder-blocks') ?>" class="button button-primary button-large"> |
| [755](#L755) | </form> |
| [756](#L756) | </div> |
| [757](#L757) | <?php |
| [758](#L758) | //End Form for delay script saving |
| [759](#L759) | break; |
| [760](#L760) | default: |
| [761](#L761) | wp\_enqueue\_style('gsadminsettings'); |
| [762](#L762) | wp\_enqueue\_script('gsadminsettings'); |
| [763](#L763) | if (isset($\_POST['gspb\_save\_settings\_general']) && isset($\_POST['gspb\_settings\_field']) && wp\_verify\_nonce(sanitize\_text\_field( wp\_unslash($\_POST['gspb\_settings\_field'])), 'gspb\_settings\_page\_action')) { // local font saving |
| [764](#L764) | $this->gspb\_save\_general\_form($\_POST, $\_FILES); |
| [765](#L765) | } |
| [766](#L766) |  |
| [767](#L767) | ?> |
| [768](#L768) | <div class="wp-block-greenshift-blocks-infobox gspb\_infoBox gspb\_infoBox-id-gsbp-158b5f3e-b35c" id="gspb\_infoBox-id-gsbp-158b5f3e-b35c"> |
| [769](#L769) | <div class="gs-box notice\_type icon\_type"> |
| [770](#L770) | <div class="gs-box-icon"><svg class="" style="display:inline-block;vertical-align:middle" width="32" height="32" viewBox="0 0 704 1024" xmlns="http://www.w3.org/2000/svg"> |
| [771](#L771) | <path style="fill:#565D66" d="M352 160c-105.88 0-192 86.12-192 192 0 17.68 14.32 32 32 32s32-14.32 32-32c0-70.6 57.44-128 128-128 17.68 0 32-14.32 32-32s-14.32-32-32-32zM192.12 918.34c0 6.3 1.86 12.44 5.36 17.68l49.020 73.68c5.94 8.92 15.94 14.28 26.64 14.28h157.7c10.72 0 20.72-5.36 26.64-14.28l49.020-73.68c3.48-5.24 5.34-11.4 5.36-17.68l0.1-86.36h-319.92l0.080 86.36zM352 0c-204.56 0-352 165.94-352 352 0 88.74 32.9 169.7 87.12 231.56 33.28 37.98 85.48 117.6 104.84 184.32v0.12h96v-0.24c-0.020-9.54-1.44-19.020-4.3-28.14-11.18-35.62-45.64-129.54-124.34-219.34-41.080-46.86-63.040-106.3-63.22-168.28-0.4-147.28 119.34-256 255.9-256 141.16 0 256 114.84 256 256 0 61.94-22.48 121.7-63.3 168.28-78.22 89.22-112.84 182.94-124.2 218.92-2.805 8.545-4.428 18.381-4.44 28.594l-0 0.006v0.2h96v-0.1c19.36-66.74 71.56-146.36 104.84-184.32 54.2-61.88 87.1-142.84 87.1-231.58 0-194.4-157.6-352-352-352z"></path> |
| [772](#L772) | </svg></div> |
| [773](#L773) | <div class="gs-box-text"> |
| [774](#L774) | <?php esc\_html\_e("Attention! Local font is global option and it can reduce performance in some cases. Do not use more than 2 global fonts. Please, check", 'greenshift-animation-and-page-builder-blocks'); ?> <a href="https://greenshiftwp.com/how-to-use-local-fonts-in-greenshift-for-gdpr/" target="\_blank"><?php esc\_html\_e("Documentation", 'greenshift-animation-and-page-builder-blocks'); ?></a> |
| [775](#L775) | </div> |
| [776](#L776) | </div> |
| [777](#L777) | </div> |
| [778](#L778) | <?php |
| [779](#L779) | $allowed\_font\_ext = $this->allowed\_font\_ext; |
| [780](#L780) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/settings\_general\_form.php'; ?> |
| [781](#L781) | <?php |
| [782](#L782) | break; |
| [783](#L783) | endswitch; |
| [784](#L784) | ?> |
| [785](#L785) | </div> |
| [786](#L786) | </div> |
| [787](#L787) | </div> |
| [788](#L788) | </div> |
| [789](#L789) | </div> |
| [790](#L790) | <?php |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | // settings fonts |
| [794](#L794) | public function gspb\_settings\_add\_font() |
| [795](#L795) | { |
| [796](#L796) | $i = $\_POST['i']; |
| [797](#L797) | $allowed\_font\_ext = $this->allowed\_font\_ext; |
| [798](#L798) | ob\_start(); |
| [799](#L799) | require\_once GREENSHIFT\_DIR\_PATH . 'templates/admin/settings\_general\_font\_item.php'; |
| [800](#L800) | $html = ob\_get\_contents(); |
| [801](#L801) | ob\_get\_clean(); |
| [802](#L802) | wp\_send\_json(['html' => $html]); |
| [803](#L803) | } |
| [804](#L804) |  |
| [805](#L805) | public function gspb\_save\_general\_form($data, $files) |
| [806](#L806) | { |
| [807](#L807) | $global\_settings = get\_option('gspb\_global\_settings'); |
| [808](#L808) |  |
| [809](#L809) | $fonts\_urls = $this->gspb\_save\_files($files); |
| [810](#L810) | $arr = []; |
| [811](#L811) | for ($i = 0; (int)$data['fonts\_count'] > $i; $i++) { |
| [812](#L812) | //$item\_arr = ['label' => sanitize\_text\_field($data['font\_specific\_style\_name'][$i])]; |
| [813](#L813) | foreach ($this->allowed\_font\_ext as $ext) { |
| [814](#L814) | $item\_arr[$ext] = !empty($fonts\_urls[$i][$ext]) ? $fonts\_urls[$i][$ext] : sanitize\_text\_field($data[$ext][$i]); |
| [815](#L815) | } |
| [816](#L816) | $item\_arr['preloaded'] = !empty($data['font\_family\_preload'][$i]) ? sanitize\_text\_field($data['font\_family\_preload'][$i]) : ''; |
| [817](#L817) | $arr[sanitize\_text\_field($data['font\_family\_name'][$i])] = $item\_arr; |
| [818](#L818) | } |
| [819](#L819) | $new\_localfont = json\_encode($arr); |
| [820](#L820) | $global\_settings['localfont'] = $new\_localfont; |
| [821](#L821) |  |
| [822](#L822) | $localfontcss = ''; |
| [823](#L823) | if (!empty($arr)) { |
| [824](#L824) | foreach ($arr as $i => $value) { |
| [825](#L825) | $localfontcss .= '@font-face {'; |
| [826](#L826) | $localfontcss .= 'font-family: "' . $i . '";'; |
| [827](#L827) | $localfontcss .= 'src: '; |
| [828](#L828) | if (!empty($value['woff2'])) { |
| [829](#L829) | $localfontcss .= 'url(' . $value["woff2"] . ') format("woff2"), '; |
| [830](#L830) | } |
| [831](#L831) | if (!empty($value['woff'])) { |
| [832](#L832) | $localfontcss .= 'url(' . $value["woff"] . ') format("woff"), '; |
| [833](#L833) | } |
| [834](#L834) | if (!empty($value['ttf'])) { |
| [835](#L835) | $localfontcss .= 'url(' . $value["ttf"] . ') format("truetype"), '; |
| [836](#L836) | } |
| [837](#L837) | if (!empty($value['tiff'])) { |
| [838](#L838) | $localfontcss .= 'url(' . $value["tiff"] . ') format("tiff"), '; |
| [839](#L839) | } |
| [840](#L840) | $localfontcss .= ';'; |
| [841](#L841) | $localfontcss .= 'font-display: swap;}'; |
| [842](#L842) | } |
| [843](#L843) | $localfontcss = str\_replace(', ;', ';', $localfontcss); |
| [844](#L844) | $global\_settings['localfontcss'] = $localfontcss; |
| [845](#L845) |  |
| [846](#L846) | $upload\_dir = wp\_upload\_dir(); |
| [847](#L847) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [848](#L848) | global $wp\_filesystem; |
| [849](#L849) | $dir = trailingslashit($upload\_dir['basedir']) . 'GreenShift/'; // Set storage directory path |
| [850](#L850) |  |
| [851](#L851) | WP\_Filesystem(); // WP file system |
| [852](#L852) |  |
| [853](#L853) | if (!$wp\_filesystem->is\_dir($dir)) { |
| [854](#L854) | $wp\_filesystem->mkdir($dir); |
| [855](#L855) | } |
| [856](#L856) |  |
| [857](#L857) | $gspb\_json\_filename = 'settings\_backup.json'; |
| [858](#L858) | $gspb\_backup\_data = json\_encode($global\_settings, JSON\_PRETTY\_PRINT); |
| [859](#L859) |  |
| [860](#L860) | if (!$wp\_filesystem->put\_contents($dir . $gspb\_json\_filename, $gspb\_backup\_data)) { |
| [861](#L861) | throw new Exception(esc\_html\_\_('JSON is not saved due the permission!!!', 'greenshift-animation-and-page-builder-blocks')); |
| [862](#L862) | } |
| [863](#L863) | } |
| [864](#L864) | update\_option('gspb\_global\_settings', $global\_settings); |
| [865](#L865) | } |
| [866](#L866) |  |
| [867](#L867) | public function gspb\_save\_files($files) |
| [868](#L868) | { |
| [869](#L869) | $result = []; |
| [870](#L870) | $upload = wp\_upload\_dir(); |
| [871](#L871) | $upload\_dir = $upload['basedir'] . '/GreenShift/fonts'; |
| [872](#L872) | $upload\_url = $upload['baseurl'] . '/GreenShift/fonts'; |
| [873](#L873) |  |
| [874](#L874) | foreach (array\_keys($files) as $filename) { |
| [875](#L875) | foreach ($files[$filename]["error"] as $key => $error) { |
| [876](#L876) | if ($error == UPLOAD\_ERR\_OK) { |
| [877](#L877) | $tmp\_name = $files[$filename]["tmp\_name"][$key]; |
| [878](#L878) | $name = basename($files[$filename]["name"][$key]); |
| [879](#L879) | $ext = pathinfo($name, PATHINFO\_EXTENSION); |
| [880](#L880) | $font\_dir = $upload\_dir . '/font\_' . ($key + 1) . '/' . $ext; |
| [881](#L881) |  |
| [882](#L882) | $this->gspb\_rm\_rec($font\_dir); //clean up dir before download |
| [883](#L883) |  |
| [884](#L884) | if (!wp\_mkdir\_p($font\_dir)) { |
| [885](#L885) | return false; |
| [886](#L886) | } |
| [887](#L887) |  |
| [888](#L888) | if (move\_uploaded\_file($tmp\_name, "$font\_dir/$name")) { |
| [889](#L889) | $result[$key][$ext] = $upload\_url . '/font\_' . ($key + 1) . '/' . $ext . '/' . $name; |
| [890](#L890) | } |
| [891](#L891) | } |
| [892](#L892) | } |
| [893](#L893) | } |
| [894](#L894) |  |
| [895](#L895) | return $result; |
| [896](#L896) | } |
| [897](#L897) |  |
| [898](#L898) | public function gspb\_rm\_rec($path) |
| [899](#L899) | { |
| [900](#L900) | if (is\_file($path)) return unlink($path); |
| [901](#L901) | if (is\_dir($path)) { |
| [902](#L902) | foreach (scandir($path) as $p) if (($p != '.') && ($p != '..')) |
| [903](#L903) | $this->gspb\_rm\_rec($path . '/' . $p); |
| [904](#L904) | return rmdir($path); |
| [905](#L905) | } |
| [906](#L906) | return false; |
| [907](#L907) | } |
| [908](#L908) |  |
| [909](#L909) | //Function to display Reusable section in menu |
| [910](#L910) | function gspb\_template\_menu\_display($type, $args) |
| [911](#L911) | { |
| [912](#L912) | if ('wp\_block' !== $type) { |
| [913](#L913) | return; |
| [914](#L914) | } |
| [915](#L915) | $args->show\_in\_menu = true; |
| [916](#L916) | $args->\_builtin = false; |
| [917](#L917) | $args->labels->name = esc\_html\_\_('Block template', 'greenshift-animation-and-page-builder-blocks'); |
| [918](#L918) | $args->labels->menu\_name = esc\_html\_\_('Reusable templates', 'greenshift-animation-and-page-builder-blocks'); |
| [919](#L919) | $args->menu\_icon = 'dashicons-screenoptions'; |
| [920](#L920) | $args->menu\_position = 71; |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) | //Columns in Reusable section |
| [924](#L924) | function gspb\_template\_screen\_add\_column($columns) |
| [925](#L925) | { |
| [926](#L926) | $newcols = array( |
| [927](#L927) | 'cb' => '<input type="checkbox" />', |
| [928](#L928) | 'title' => esc\_html\_\_('Block title', 'greenshift-animation-and-page-builder-blocks'), |
| [929](#L929) | 'gs-reusable-preview' => esc\_html\_\_('Usage', 'greenshift-animation-and-page-builder-blocks'), |
| [930](#L930) | ); |
| [931](#L931) | return apply\_filters('greenshift\_reusable\_blocks\_list', array\_merge($columns, $newcols)); |
| [932](#L932) | } |
| [933](#L933) |  |
| [934](#L934) | //Render function for Columns in Reusable Sections |
| [935](#L935) | function gspb\_template\_screen\_fill\_column($column, $ID) |
| [936](#L936) | { |
| [937](#L937) | global $post; |
| [938](#L938) | switch ($column) { |
| [939](#L939) |  |
| [940](#L940) | case 'gs-reusable-preview': |
| [941](#L941) |  |
| [942](#L942) | echo '<p><input type="text" style="width:350px" value="[wp\_reusable\_render id=\'' . $ID . '\']" readonly=""></p>'; |
| [943](#L943) | echo '<p>' . esc\_html\_\_('If you use template inside other dynamic ajax blocks', 'greenshift-animation-and-page-builder-blocks') . '<br><input type="text" style="width:350px" value="[wp\_reusable\_render inlinestyle=1 id=\'' . $ID . '\']" readonly="">'; |
| [944](#L944) | echo '<p>' . esc\_html\_\_('Shortcode for Ajax render:', 'greenshift-animation-and-page-builder-blocks') . '<br><input type="text" style="width:350px" value="[wp\_reusable\_render ajax=1 height=100px id=\'' . $ID . '\']" readonly="">'; |
| [945](#L945) | echo '<p>' . esc\_html\_\_('Hover trigger:', 'greenshift-animation-and-page-builder-blocks') . ' <code>gs-el-onhover load-block-' . $ID . '</code>'; |
| [946](#L946) | echo '<p>' . esc\_html\_\_('Click trigger:', 'greenshift-animation-and-page-builder-blocks') . ' <code>gs-el-onclick load-block-' . $ID . '</code>'; |
| [947](#L947) | echo '<p>' . esc\_html\_\_('On view trigger:', 'greenshift-animation-and-page-builder-blocks') . ' <code>gs-el-onview load-block-' . $ID . '</code>'; |
| [948](#L948) | break; |
| [949](#L949) |  |
| [950](#L950) | default: |
| [951](#L951) | break; |
| [952](#L952) | } |
| [953](#L953) | } |
| [954](#L954) |  |
| [955](#L955) | //Render shortcode function |
| [956](#L956) | function gspb\_template\_shortcode\_function($atts) |
| [957](#L957) | { |
| [958](#L958) | extract(shortcode\_atts( |
| [959](#L959) | array( |
| [960](#L960) | 'id' => '', |
| [961](#L961) | 'ajax' => '', |
| [962](#L962) | 'height' => '', |
| [963](#L963) | 'inlinestyle' => '' |
| [964](#L964) | ), |
| [965](#L965) | $atts |
| [966](#L966) | )); |
| [967](#L967) | if (!isset($id) || empty($id)) { |
| [968](#L968) | return ''; |
| [969](#L969) | } |
| [970](#L970) | if (!is\_numeric($id)) { |
| [971](#L971) | $postget = get\_page\_by\_path($id, OBJECT, array('wp\_block')); |
| [972](#L972) | if (is\_object($postget)) { |
| [973](#L973) | $id = $postget->ID; |
| [974](#L974) | } else { |
| [975](#L975) | return; |
| [976](#L976) | } |
| [977](#L977) | } |
| [978](#L978) | if (!empty($ajax)) { |
| [979](#L979) | wp\_enqueue\_style('wp-block-library'); |
| [980](#L980) | wp\_enqueue\_style('gspreloadercss'); |
| [981](#L981) | wp\_enqueue\_script('gselajaxloader'); |
| [982](#L982) | $scriptvars = array( |
| [983](#L983) | 'reusablenonce' => wp\_create\_nonce('gsreusable'), |
| [984](#L984) | 'ajax\_url' => admin\_url('admin-ajax.php', 'relative'), |
| [985](#L985) | ); |
| [986](#L986) | wp\_localize\_script('gselajaxloader', 'gsreusablevars', $scriptvars); |
| [987](#L987) | $content = '<div class="gs-ajax-load-block gs-ajax-load-block-' . (int)$id . '"></div>'; |
| [988](#L988) |  |
| [989](#L989) | $content\_post = get\_post($id); |
| [990](#L990) | if (!is\_object($content\_post)) return false; |
| [991](#L991) | $contentpost = $content\_post->post\_content; |
| [992](#L992) | $style = ''; |
| [993](#L993) | if (has\_blocks($contentpost)) { |
| [994](#L994) | $blocks = parse\_blocks($contentpost); |
| [995](#L995) | $style .= '<style scoped>'; |
| [996](#L996) | $style .= gspb\_get\_inline\_styles\_blocks($blocks); |
| [997](#L997) | $style .= '</style>'; |
| [998](#L998) | } |
| [999](#L999) | if (!empty($height)) { |
| [1000](#L1000) | $content = '<div style="min-height:' . esc\_attr($height) . '">' . $content . $style . '</div>'; |
| [1001](#L1001) | } else { |
| [1002](#L1002) | $content = '<div>' . $content . $style . '</div>'; |
| [1003](#L1003) | } |
| [1004](#L1004) | } else { |
| [1005](#L1005) | $content\_post = get\_post($id); |
| [1006](#L1006) | if (!is\_object($content\_post)) return false; |
| [1007](#L1007) | $content = $content\_post->post\_content; |
| [1008](#L1008) | $style = ''; |
| [1009](#L1009) | if ($inlinestyle) { |
| [1010](#L1010) | if (has\_blocks($content)) { |
| [1011](#L1011) | $blocks = parse\_blocks($content); |
| [1012](#L1012) | $style .= '<style scoped>'; |
| [1013](#L1013) | $style .= gspb\_get\_inline\_styles\_blocks($blocks); |
| [1014](#L1014) | $style .= '</style>'; |
| [1015](#L1015) | } |
| [1016](#L1016) | } |
| [1017](#L1017) | $content = do\_blocks($content); |
| [1018](#L1018) | $content = do\_shortcode($content); |
| [1019](#L1019) | $content = preg\_replace('%<p>&nbsp;\s\*</p>%', '', $content); |
| [1020](#L1020) | $content = preg\_replace('/^(?:<br\s\*\/?>\s\*)+/', '', $content); |
| [1021](#L1021) | $content = $content . $style; |
| [1022](#L1022) | } |
| [1023](#L1023) | return $content; |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) | //Load reusable Ajax function |
| [1027](#L1027) | function gspb\_el\_reusable\_load() |
| [1028](#L1028) | { |
| [1029](#L1029) | check\_ajax\_referer('gsreusable', 'security'); |
| [1030](#L1030) | $post\_id = intval($\_POST['post\_id']); |
| [1031](#L1031) | $content\_post = get\_post($post\_id); |
| [1032](#L1032) | $content = ''; |
| [1033](#L1033) | if(is\_object($content\_post)){ |
| [1034](#L1034) | $content = $content\_post->post\_content; |
| [1035](#L1035) | $content = apply\_filters('the\_content', $content); |
| [1036](#L1036) | $content = str\_replace('strokewidth', 'stroke-width', $content); |
| [1037](#L1037) | $content = str\_replace('strokedasharray', 'stroke-dasharray', $content); |
| [1038](#L1038) | $content = str\_replace('stopcolor', 'stop-color', $content); |
| [1039](#L1039) | $content = str\_replace('loading="lazy"', '', $content); |
| [1040](#L1040) | } |
| [1041](#L1041) | if ($content) { |
| [1042](#L1042) | wp\_send\_json\_success($content); |
| [1043](#L1043) | } else { |
| [1044](#L1044) | wp\_send\_json\_success('fail'); |
| [1045](#L1045) | } |
| [1046](#L1046) | wp\_die(); |
| [1047](#L1047) | } |
| [1048](#L1048) |  |
| [1049](#L1049) | //Show gutenberg editor on reusable section even if Classic editor plugins enabled |
| [1050](#L1050) | function gspb\_template\_gutenberg\_post($use\_block\_editor, $post) |
| [1051](#L1051) | { |
| [1052](#L1052) | if (empty($post->ID)) return $use\_block\_editor; |
| [1053](#L1053) | if ('wp\_block' === get\_post\_type($post->ID)) return true; |
| [1054](#L1054) | return $use\_block\_editor; |
| [1055](#L1055) | } |
| [1056](#L1056) | function gspb\_template\_gutenberg\_post\_type($use\_block\_editor, $post\_type) |
| [1057](#L1057) | { |
| [1058](#L1058) | if ('wp\_block' === $post\_type) return true; |
| [1059](#L1059) | return $use\_block\_editor; |
| [1060](#L1060) | } |
| [1061](#L1061) |  |
| [1062](#L1062) | function greenshift\_additional\_\_header\_elements() |
| [1063](#L1063) | { |
| [1064](#L1064) | $theme\_settings = get\_option('greenshift\_theme\_options'); |
| [1065](#L1065) | if (!empty($theme\_settings['custom\_code\_in\_head'])) { |
| [1066](#L1066) | echo wp\_kses(wp\_unslash($theme\_settings['custom\_code\_in\_head']), [ |
| [1067](#L1067) | 'meta' => [ |
| [1068](#L1068) | 'charset' => [], |
| [1069](#L1069) | 'content' => [], |
| [1070](#L1070) | 'http-equiv' => [], |
| [1071](#L1071) | 'name' => [], |
| [1072](#L1072) | 'property' => [] |
| [1073](#L1073) | ], |
| [1074](#L1074) | 'style' => [ |
| [1075](#L1075) | 'media' => [], |
| [1076](#L1076) | 'type' => [] |
| [1077](#L1077) | ], |
| [1078](#L1078) | 'script' => [ |
| [1079](#L1079) | 'async' => [], |
| [1080](#L1080) | 'charset' => [], |
| [1081](#L1081) | 'defer' => [], |
| [1082](#L1082) | 'src' => [], |
| [1083](#L1083) | 'type' => [] |
| [1084](#L1084) | ], |
| [1085](#L1085) | 'link' => [ |
| [1086](#L1086) | 'href' => [], |
| [1087](#L1087) | 'rel' => [], |
| [1088](#L1088) | 'type' => [] |
| [1089](#L1089) | ] |
| [1090](#L1090) | ]); |
| [1091](#L1091) | } |
| [1092](#L1092) | $sitesettings = get\_option('gspb\_global\_settings'); |
| [1093](#L1093) | $localfonts = (!empty($sitesettings['localfont'])) ? $sitesettings['localfont'] : ''; |
| [1094](#L1094) | if ($localfonts) { |
| [1095](#L1095) | $localfonts = json\_decode($localfonts, true); |
| [1096](#L1096) | if (is\_array($localfonts)) { |
| [1097](#L1097) | foreach ($localfonts as $localfont) { |
| [1098](#L1098) | if (!empty($localfont['preloaded'])) { |
| [1099](#L1099) | $allowed\_font\_ext = $this->allowed\_font\_ext; |
| [1100](#L1100) | foreach ($allowed\_font\_ext as $ext) { |
| [1101](#L1101) | if (!empty($localfont[$ext])) { |
| [1102](#L1102) | echo '<link rel="preload" href="' . $localfont[$ext] . '" as="font" type="font/' . $ext . '" crossorigin>'; |
| [1103](#L1103) | } |
| [1104](#L1104) | } |
| [1105](#L1105) | } |
| [1106](#L1106) | } |
| [1107](#L1107) | } |
| [1108](#L1108) | } |
| [1109](#L1109) | } |
| [1110](#L1110) |  |
| [1111](#L1111) | function greenshift\_additional\_\_footer\_elements() |
| [1112](#L1112) | { |
| [1113](#L1113) | if (defined('GREENSHIFTGSAP\_DIR\_URL')) { |
| [1114](#L1114) | $sitesettings = get\_option('gspb\_global\_settings'); |
| [1115](#L1115) | if (!empty($sitesettings['sitesettings']['mousefollow'])) { |
| [1116](#L1116) | $color = !empty($sitesettings['sitesettings']['mousecolor']) ? $sitesettings['sitesettings']['mousecolor'] : '#2184f9'; |
| [1117](#L1117) | echo '<div class="gsmouseball"></div><div class="gsmouseballsmall"></div><style scoped>.gsmouseball{width:33px;height:33px;position:fixed;top:0;left:0;z-index:99999;border:1px solid ' . esc\_attr($color) . ';border-radius:50%;pointer-events:none;opacity:0}.gsmouseballsmall{width:4px;height:4px;position:fixed;top:0;left:0;background:' . esc\_attr($color) . ';border-radius:50%;pointer-events:none;opacity:0; z-index:99999}</style>'; |
| [1118](#L1118) | wp\_enqueue\_script('gsap-mousefollow-init'); |
| [1119](#L1119) | } |
| [1120](#L1120) | } |
| [1121](#L1121) | $theme\_settings = get\_option('greenshift\_theme\_options'); |
| [1122](#L1122) | if (!empty($theme\_settings['custom\_code\_before\_closed\_body'])) { |
| [1123](#L1123) | echo wp\_kses(wp\_unslash($theme\_settings['custom\_code\_before\_closed\_body']), [ |
| [1124](#L1124) | 'meta' => [ |
| [1125](#L1125) | 'charset' => [], |
| [1126](#L1126) | 'content' => [], |
| [1127](#L1127) | 'http-equiv' => [], |
| [1128](#L1128) | 'name' => [], |
| [1129](#L1129) | 'property' => [] |
| [1130](#L1130) | ], |
| [1131](#L1131) | 'style' => [ |
| [1132](#L1132) | 'media' => [], |
| [1133](#L1133) | 'type' => [] |
| [1134](#L1134) | ], |
| [1135](#L1135) | 'script' => [ |
| [1136](#L1136) | 'async' => [], |
| [1137](#L1137) | 'charset' => [], |
| [1138](#L1138) | 'defer' => [], |
| [1139](#L1139) | 'src' => [], |
| [1140](#L1140) | 'type' => [] |
| [1141](#L1141) | ], |
| [1142](#L1142) | 'link' => [ |
| [1143](#L1143) | 'href' => [], |
| [1144](#L1144) | 'rel' => [], |
| [1145](#L1145) | 'type' => [] |
| [1146](#L1146) | ] |
| [1147](#L1147) | ]); |
| [1148](#L1148) | } |
| [1149](#L1149) | } |
| [1150](#L1150) | } |
| [1151](#L1151) | } |
| [1152](#L1152) |  |
| [1153](#L1153) | add\_filter('block\_editor\_settings\_all', 'gspb\_generate\_anchor\_headings', 10, 2); |
| [1154](#L1154) |  |
| [1155](#L1155) | function gspb\_generate\_anchor\_headings($settings, $block\_editor\_context) |
| [1156](#L1156) | { |
| [1157](#L1157) | $settings['generateAnchors'] = true; |
| [1158](#L1158) | return $settings; |
| [1159](#L1159) | } |
| [1160](#L1160) |  |
| [1161](#L1161) | function gspb\_get\_inline\_styles\_blocks($blocks) |
| [1162](#L1162) | { |
| [1163](#L1163) | $inlinestyle = ''; |
| [1164](#L1164) | foreach ($blocks as $block) { |
| [1165](#L1165) | if (!empty($block['attrs']['inlineCssStyles'])) { |
| [1166](#L1166) | $dynamic\_style = $block['attrs']['inlineCssStyles']; |
| [1167](#L1167) | $dynamic\_style = gspb\_get\_final\_css($dynamic\_style); |
| [1168](#L1168) | $dynamic\_style = gspb\_quick\_minify\_css($dynamic\_style); |
| [1169](#L1169) | $dynamic\_style = htmlspecialchars\_decode($dynamic\_style); |
| [1170](#L1170) | $inlinestyle .= $dynamic\_style; |
| [1171](#L1171) | } |
| [1172](#L1172) | gspb\_greenShift\_block\_script\_assets('', $block); |
| [1173](#L1173) | if (function\_exists('greenShiftGsap\_block\_script\_assets')) { |
| [1174](#L1174) | greenShiftGsap\_block\_script\_assets('', $block); |
| [1175](#L1175) | } |
| [1176](#L1176) | if (!empty($block['innerBlocks'])) { |
| [1177](#L1177) | $blocks = $block['innerBlocks']; |
| [1178](#L1178) | $inlinestyle .= gspb\_get\_inline\_styles\_blocks($blocks); |
| [1179](#L1179) | } |
| [1180](#L1180) | } |
| [1181](#L1181) | return $inlinestyle; |
| [1182](#L1182) | } |
| [1183](#L1183) |  |
| [1184](#L1184) | ////////////////////////////////////////////////////////////////// |
| [1185](#L1185) | // File Manager |
| [1186](#L1186) | ////////////////////////////////////////////////////////////////// |
| [1187](#L1187) |  |
| [1188](#L1188) | if (!function\_exists('greenshift\_download\_file\_localy')) { |
| [1189](#L1189) | function greenshift\_download\_file\_localy($file\_uri, $save\_dir, $file\_name, $file\_ext = null, $check\_type = '') |
| [1190](#L1190) | { |
| [1191](#L1191) | $file\_path = trailingslashit($save\_dir) . $file\_name; |
| [1192](#L1192) | if (file\_exists($file\_path)) { |
| [1193](#L1193) | return $file\_name; |
| [1194](#L1194) | } |
| [1195](#L1195) | $args = array( |
| [1196](#L1196) | 'timeout' => 30, |
| [1197](#L1197) | 'httpversion' => '1.1', |
| [1198](#L1198) | 'user-agent'  => 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.101 Safari/537.36', |
| [1199](#L1199) | 'sslverify'   => true, |
| [1200](#L1200) | ); |
| [1201](#L1201) |  |
| [1202](#L1202) | $response = wp\_remote\_get($file\_uri, $args); |
| [1203](#L1203) |  |
| [1204](#L1204) | if (is\_wp\_error($response) || (int) wp\_remote\_retrieve\_response\_code($response) !== 200) { |
| [1205](#L1205) | return false; |
| [1206](#L1206) | } |
| [1207](#L1207) |  |
| [1208](#L1208) | if ($file\_ext === null) { |
| [1209](#L1209) | $headers = wp\_remote\_retrieve\_headers($response); |
| [1210](#L1210) | if (empty($headers['content-type'])) return false; |
| [1211](#L1211) |  |
| [1212](#L1212) | $types = array\_search($headers['content-type'], wp\_get\_mime\_types()); |
| [1213](#L1213) |  |
| [1214](#L1214) | if (!$types) return false; |
| [1215](#L1215) |  |
| [1216](#L1216) | $exts = explode('|', $types); |
| [1217](#L1217) | $file\_ext = $exts[0]; |
| [1218](#L1218) | $file\_name .= '.' . $file\_ext; |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | $file\_name = wp\_unique\_filename($save\_dir, $file\_name); |
| [1222](#L1222) | if ($check\_type) { |
| [1223](#L1223) | $filetype = wp\_check\_filetype($file\_name); |
| [1224](#L1224) | if ($filetype['type'] != $check\_type) |
| [1225](#L1225) | return false; |
| [1226](#L1226) | } |
| [1227](#L1227) |  |
| [1228](#L1228) | $image\_string = wp\_remote\_retrieve\_body($response); |
| [1229](#L1229) | if (!file\_put\_contents($file\_path, $image\_string)) |
| [1230](#L1230) | return false; |
| [1231](#L1231) |  |
| [1232](#L1232) | return $file\_name; |
| [1233](#L1233) | } |
| [1234](#L1234) | } |
| [1235](#L1235) |  |
| [1236](#L1236) | if (!function\_exists('greenshift\_save\_file\_localy')) { |
| [1237](#L1237) | function greenshift\_save\_file\_localy($file\_uri, $img\_title = '', $check\_type = '') |
| [1238](#L1238) | { |
| [1239](#L1239) | $newfilename = basename($file\_uri); |
| [1240](#L1240) | $ext = pathinfo(basename($file\_uri), PATHINFO\_EXTENSION); |
| [1241](#L1241) |  |
| [1242](#L1242) | $ext = ($ext) ? $ext : null; |
| [1243](#L1243) |  |
| [1244](#L1244) | if (empty($newfilename)) { |
| [1245](#L1245) | $newfilename = preg\_replace('/[^a-zA-Z0-9\-]/', '', $newfilename); |
| [1246](#L1246) | $newfilename = strtolower($newfilename); |
| [1247](#L1247) | } |
| [1248](#L1248) |  |
| [1249](#L1249) | $uploads = wp\_upload\_dir(); |
| [1250](#L1250) |  |
| [1251](#L1251) | if ($newfilename = greenshift\_download\_file\_localy($file\_uri, $uploads['path'], $newfilename, $ext, $check\_type)) { |
| [1252](#L1252) | return $newfilename; |
| [1253](#L1253) | } else { |
| [1254](#L1254) | return false; |
| [1255](#L1255) | } |
| [1256](#L1256) | } |
| [1257](#L1257) | } |
| [1258](#L1258) |  |
| [1259](#L1259) | if (!function\_exists('greenshift\_replace\_ext\_images')) { |
| [1260](#L1260) | function greenshift\_replace\_ext\_images($content, $format = 'json') |
| [1261](#L1261) | { |
| [1262](#L1262) | $pattern = '#https?://[^/\s]+/\S+\.(jpg|png|gif|webp|svg|jpeg|json)#'; |
| [1263](#L1263) | if ($format == 'json') { |
| [1264](#L1264) | $content = json\_decode($content, true); |
| [1265](#L1265) | } |
| [1266](#L1266) | $result = preg\_replace\_callback($pattern, function ($match) { |
| [1267](#L1267) | if (is\_array($match)) { |
| [1268](#L1268) | $url = $match[0]; |
| [1269](#L1269) | if (strpos($url, get\_bloginfo('url')) !== 0) { |
| [1270](#L1270) | $urlnew = greenshift\_save\_file\_localy($url); |
| [1271](#L1271) | $uploads = wp\_upload\_dir(); |
| [1272](#L1272) | $image = trailingslashit($uploads['url']) . $urlnew; |
| [1273](#L1273) | return $image; |
| [1274](#L1274) | } else { |
| [1275](#L1275) | return $url; |
| [1276](#L1276) | } |
| [1277](#L1277) | } |
| [1278](#L1278) | }, $content); |
| [1279](#L1279) | if ($format == 'json') { |
| [1280](#L1280) | $result = json\_encode($result); |
| [1281](#L1281) | } |
| [1282](#L1282) | return $result; |
| [1283](#L1283) | } |
| [1284](#L1284) | } |
| [1285](#L1285) |  |
| [1286](#L1286) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3006373&format=txt)
* [Original Format](/export/3006373/greenshift-animation-and-page-builder-blocks/trunk/settings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_e161bead_20250114_181618.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Greenshift – animation and page builder blocks <= 7.6.2 - Authenticated (Administrator+) Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Greenshift – animation and page builder blocks <= 7.6.2 - Authenticated (Administrator+) Arbitrary File Upload

7.2

**Unrestricted Upload of File with Dangerous Type**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-6636](https://www.cve.org/CVERecord?id=CVE-2023-6636) |
| --- | --- |
| CVSS | 7.2 (High) |
| Publicly Published | December 12, 2023 |
| Last Updated | January 11, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The Greenshift – animation and page builder blocks plugin for WordPress is vulnerable to arbitrary file uploads due to missing file type validation on the 'gspb\_save\_files' function in versions up to, and including, 7.6.2. This makes it possible for authenticated attackers with administrator-level capabilities or above, to upload arbitrary files on the affected site's server which may make remote code execution possible.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3006373#L867)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3009030/greenshift-animation-and-page-builder-blocks/trunk/settings.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fgreenshift-animation-and-page-builder-blocks%2Fgreenshift-animation-and-page-builder-blocks-762-authenticated-administrator-arbitrary-file-upload&t=Greenshift%20%E2%80%93%20animation%20and%20page%20builder%20blocks%20%3C%3D%207.6.2%20-%20Authenticated%20%28Administrator%2B%29%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fgreenshift-animation-and-page-builder-blocks%2Fgreenshift-animation-and-page-builder-blocks-762-authenticated-administrator-arbitrary-file-upload&text=Greenshift%20%E2%80%93%20animation%20and%20page%20builder%20blocks%20%3C%3D%207.6.2%20-%20Authenticated%20%28Administrator%2B%29%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fgreenshift-animation-and-page-builder-blocks%2Fgreenshift-animation-and-page-builder-blocks-762-authenticated-administrator-arbitrary-file-upload "LinkedIn")
Email

## Vulnerability Details for Greenshift – animation and page builder blocks

#### [Greenshift – animation and page builder blocks](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/greenshift-animation-and-page-builder-blocks)

| Software Type | Plugin |
| --- | --- |
| Software Slug | greenshift-animation-and-page-builder-blocks [(view on wordpress.org)](https://wordpress.org/plugins/greenshift-animation-and-page-builder-blocks) |
| Patched? | Yes |
| Remediation | Update to version 7.6.3, or a newer patched version |
| Affected Version | * <= 7.6.2 |
| Patched Version | * 7.6.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_516675d9_20250114_181616.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3009030%2Fgreenshift-animation-and-page-builder-blocks%2Ftrunk%2Fsettings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2998344/greenshift-animation-and-page-builder-blocks/trunk/settings.php "Changeset 2998344 for greenshift-animation-and-page-builder-blocks/trunk/settings.php")
* [Next Change](/changeset/3011179/greenshift-animation-and-page-builder-blocks/trunk/settings.php "Changeset 3011179 for greenshift-animation-and-page-builder-blocks/trunk/settings.php") →

---

# Changeset [3009030](/changeset/3009030 "Show full changeset") for [greenshift-animation-and-page-builder-blocks/trunk/settings.php](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3009030 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
12/12/2023 07:22:52 PM
([13 months](/timeline?from=2023-12-12T19%3A22%3A52Z&precision=second "See timeline at 12/12/2023 07:22:52 PM") ago)

Author:
wpsoul
Message:

update fix

File:

1 edited

* [greenshift-animation-and-page-builder-blocks/trunk/settings.php](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3009030 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [greenshift-animation-and-page-builder-blocks/trunk/settings.php](/changeset/3009030/greenshift-animation-and-page-builder-blocks/trunk/settings.php "Show the changeset 3009030 restricted to greenshift-animation-and-page-builder-blocks/trunk/settings.php")

  | [r2998344](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=2998344#L886 "Show revision 2998344 of this file in browser") | [r3009030](/browser/greenshift-animation-and-page-builder-blocks/trunk/settings.php?rev=3009030#L886 "Show revision 3009030 of this file in browser") |  |
  | --- | --- | --- |
  | 886 | 886 | } |
  | 887 | 887 |  |
  |  | 888 | if(!in\_array($ext, $this->allowed\_font\_ext)) continue; |
  |  | 889 |  |
  | 888 | 890 | if (move\_uploaded\_file($tmp\_name, "$font\_dir/$name")) { |
  | 889 | 891 | $result[$key][$ext] = $upload\_url . '/font\_' . ($key + 1) . '/' . $ext . '/' . $name; |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3009030)
* [Zip Archive](?format=zip&new=3009030)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


