=== Content from advisory.splunk.com_b0b817d7_20250115_100942.html ===
 [![ ](/assets/img/logo.svg)](https://www.splunk.com/)

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)

 Toggle menu

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)
# Remote Code Execution via Serialized Session Payload

**Advisory ID:** SVD-2023-0804

**CVE ID:** [CVE-2023-40595](https://www.cve.org/CVERecord?id=CVE-2023-40595)

**Published:** 2023-08-30

**Last Update:** 2023-10-18

**CVSSv3.1 Score:** 8.8, High

**CVSSv3.1 Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

**CWE:** [CWE-502](https://cwe.mitre.org/data/definitions/502.html)

**Bug ID:** PRODSECOPS-25334

## Description

In Splunk Enterprise versions lower than 8.2.12, 9.0.6, and 9.1.1, an attacker can execute a specially crafted query that they can then use to serialize untrusted data. The attacker can use the query to execute arbitrary code.

The exploit requires the use of the `collect` SPL command which writes a file within the Splunk Enterprise installation. The attacker can then use this file to submit a serialized payload that can result in execution of code within the payload.

## Solution

Upgrade Splunk Enterprise to versions 8.2.12, 9.0.6, or 9.1.1.

For Splunk Cloud Platform, Splunk is actively monitoring and patching affected instances.

## Product Status

| Product | Version | Component | Affected Version | Fix Version |
| --- | --- | --- | --- | --- |
| Splunk Enterprise | 8.2 | Splunk Web | 8.2.0 to 8.2.11 | 8.2.12 |
| Splunk Enterprise | 9.0 | Splunk Web | 9.0.0 to 9.0.5 | 9.0.6 |
| Splunk Enterprise | 9.1 | Splunk Web | 9.1.0 | 9.1.1 |
| Splunk Cloud | - | Splunk Web | 9.0.2305.100 and below | 9.0.2305.200 |

## Mitigations and Workarounds

If users do not log in to Splunk Web on indexers in a distributed environment, disable Splunk Web on those indexers. See [Disable unnecessary Splunk Enterprise components](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) and the [web.conf configuration specification](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Webconf) file in the Splunk documentation for more information on disabling Splunk Web.

## Detections

* [Splunk RCE via Serialized Session Payload](https://research.splunk.com/application/d1d8fda6-874a-400f-82cf-dcbb59d8e4db/)

## Severity

Splunk rated the vulnerability as High, 8.8, with a CVSSv3.1 vector of CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H.

If the Splunk Enterprise instance does not run Splunk Web, there is no impact and the severity is Informational.

## Acknowledgments

Danylo Dmytriiev (DDV\_UA)

* Email
* [RSS Feed](/feed.xml)
* [Support](https://login.splunk.com/page/sso_redirect?type=portal)
© 2005 - 2025 Splunk Inc. All rights reserved.[Legal](https://www.splunk.com/en_us/legal.html)     [Privacy     [Website Terms of Use](https://www.splunk.com/en_us/legal/terms/terms-of-use.html)](https://www.splunk.com/en_us/legal/privacy/privacy-policy.html)

=== Content from research.splunk.com_8de99ef1_20250115_100943.html ===

[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk RCE via Serialized Session Payload

Updated Date: 2024-10-17
ID: d1d8fda6-874a-400f-82cf-dcbb59d8e4db
Author: Chase Franklin, Rod Soto, Eric McGinnis, Splunk
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic detects the execution of a specially crafted query using the 'collect' SPL command in Splunk Enterprise versions lower than 8.2.12, 9.0.6, and 9.1.1. It leverages audit logs to identify searches containing both 'makeresults' and 'collect' commands. This activity is significant because it can indicate an attempt to serialize untrusted data, potentially leading to arbitrary code execution. If confirmed malicious, this could allow an attacker to execute code within the Splunk environment, leading to unauthorized access and control over the system.

### Search

```
1`audit_searches` file=* (search="*makeresults*" AND search="*collect*")
2| stats count min(_time) as firstTime max(_time) as lastTime by action file user splunk_server search
3| `security_content_ctime(firstTime)`
4| `security_content_ctime(lastTime)`
5| `splunk_rce_via_serialized_session_payload_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [audit\_searches](https://github.com/splunk/security_content/blob/develop/macros/audit_searches.yml) | `index=_audit sourcetype=audittrail action=search` |
| splunk\_rce\_via\_serialized\_session\_payload\_filter | `search *` |

`splunk_rce_via_serialized_session_payload_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1190](https://attack.mitre.org/techniques/T1190/) | Exploit Public-Facing Application | Initial Access |

KillChainPhase.DELIVERY

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT28
APT29
APT39
APT41
APT5
Agrius
Axiom
BackdoorDiplomacy
BlackTech
Blue Mockingbird
Cinnamon Tempest
Dragonfly
Earth Lusca
Ember Bear
FIN13
FIN7
Fox Kitten
GALLIUM
GOLD SOUTHFIELD
HAFNIUM
INC Ransom
Ke3chang
Kimsuky
Magic Hound
Moses Staff
MuddyWater
Play
Rocke
Sandworm Team
Threat Group-3390
ToddyCat
Volatile Cedar
Volt Typhoon
Winter Vivern
menuPass

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

Requires access to the \_audit index.

### Known False Positives

There are numerous many uses of the 'makeresults' and 'collect' SPL commands. Please evaluate the results of this search for potential abuse.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Potential abuse of the 'collect' SPL command against $splunk\_server$ by detected by $user$ | 25 | 50 | 50 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://www.splunk.com/en_us/product-security.html>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1190/splunk/splunk_rce_via_serialized_session_payload_audittrail.log) | `audittrail` | `audittrail` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1190/splunk/splunk_rce_via_serialized_session_payload_audittrail.log) | `audittrail` | `audittrail` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_rce_via_serialized_session_payload.yml) |
Version: **3**

[Detection: Splunk RCE via External Lookup Copybuckets](https://research.splunk.com/application/8598f9de-bba8-42a4-8ef0-12e1adda4131/ "Detection: Splunk RCE via External Lookup Copybuckets")

[Detection: Splunk RCE via Splunk Secure Gateway Splunk Mobile alerts feature](https://research.splunk.com/application/baa41f09-df48-4375-8991-520beea161be/ "Detection: Splunk RCE via Splunk Secure Gateway  Splunk Mobile alerts feature")

Â© 2005 - 2024 Splunk LLC All rights reserved.


