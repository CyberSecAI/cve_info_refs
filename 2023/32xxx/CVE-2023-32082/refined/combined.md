=== Content from github.com_fbc0ec3c_20250114_192907.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fblob%2Fmain%2FCHANGELOG%2FCHANGELOG-3.4.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fblob%2Fmain%2FCHANGELOG%2FCHANGELOG-3.4.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=etcd-io%2Fetcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[etcd-io](/etcd-io)
/
**[etcd](/etcd-io/etcd)**
Public

* [Notifications](/login?return_to=%2Fetcd-io%2Fetcd) You must be signed in to change notification settings
* [Fork
  9.8k](/login?return_to=%2Fetcd-io%2Fetcd)
* [Star
   48.2k](/login?return_to=%2Fetcd-io%2Fetcd)

* [Code](/etcd-io/etcd)
* [Issues
  289](/etcd-io/etcd/issues)
* [Pull requests
  134](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

Additional navigation options

* [Code](/etcd-io/etcd)
* [Issues](/etcd-io/etcd/issues)
* [Pull requests](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

## Files

 main
## Breadcrumbs

1. [etcd](/etcd-io/etcd/tree/main)
2. /[CHANGELOG](/etcd-io/etcd/tree/main/CHANGELOG)
/
# CHANGELOG-3.4.md

Copy path Blame  Blame
## Latest commit

## History

[History](/etcd-io/etcd/commits/main/CHANGELOG/CHANGELOG-3.4.md)1394 lines (1014 loc) · 108 KB main
## Breadcrumbs

1. [etcd](/etcd-io/etcd/tree/main)
2. /[CHANGELOG](/etcd-io/etcd/tree/main/CHANGELOG)
/
# CHANGELOG-3.4.md

Top
## File metadata and controls

* Preview
* Code
* Blame

1394 lines (1014 loc) · 108 KB[Raw](https://github.com/etcd-io/etcd/raw/refs/heads/main/CHANGELOG/CHANGELOG-3.4.md)

Previous change logs can be found at [CHANGELOG-3.3](https://github.com/etcd-io/etcd/blob/main/CHANGELOG/CHANGELOG-3.3.md).

---

## v3.4.36 (TBC)

### etcd server

* [Avoid deadlock in etcd.Close when stopping during bootstrapping](https://github.com/etcd-io/etcd/pull/19166)

### Package `clientv3`

* Fix [runtime panic that occurs when KeepAlive is called with a Context implemented by an uncomparable type](https://github.com/etcd-io/etcd/pull/18936)

### Dependencies

* Compile binaries using [go 1.22.10](https://github.com/etcd-io/etcd/pull/19005)

---

## v3.4.35 (2024-11-12)

### etcd server

* Fix [watchserver related goroutine leakage](https://github.com/etcd-io/etcd/pull/18785)
* Fix [panicking occurred due to improper error handling during defragmentation](https://github.com/etcd-io/etcd/pull/18843)
* Fix [close temp file(s) in case an error happens during defragmentation](https://github.com/etcd-io/etcd/pull/18855)

### Dependencies

* Compile binaries using [go 1.22.9](https://github.com/etcd-io/etcd/pull/18850).

---

## v3.4.34 (2024-09-11)

### etcd server

* Fix [performance regression issue caused by the `ensureLeadership` in lease renew](https://github.com/etcd-io/etcd/pull/18440).
* [Keep the tombstone during compaction if it happens to be the compaction revision](https://github.com/etcd-io/etcd/pull/18475)

### Package clientv3

* [Print gRPC metadata in guaranteed order using the official go fmt pkg](https://github.com/etcd-io/etcd/pull/18311).

### Dependencies

* Compile binaries using [go 1.22.7](https://github.com/etcd-io/etcd/pull/18549).
* Upgrade [bbolt to 1.3.11](https://github.com/etcd-io/etcd/pull/18488).

---

## v3.4.33 (2024-06-13)

### etcd grpc-proxy

* Fix [Memberlist results not updated when proxy node down](https://github.com/etcd-io/etcd/pull/17896).

### Dependencies

* Compile binaries using go [1.21.11](https://github.com/etcd-io/etcd/pull/18130).
* Upgrade [bbolt to 1.3.10](https://github.com/etcd-io/etcd/pull/17945).

---

## v3.4.32 (2024-04-25)

### etcd server

* Fix [LeaseTimeToLive returns error if leader changed](https://github.com/etcd-io/etcd/pull/17705).
* Fix [ignore raft messages if member id mismatch](https://github.com/etcd-io/etcd/pull/17814).
* Update [the compaction log when bootstrap](https://github.com/etcd-io/etcd/pull/17831).
* [Allow new server to join 3.5 cluster if `next-cluster-version-compatible=true`](https://github.com/etcd-io/etcd/pull/17665)
* [Allow updating the cluster version when downgrading from 3.5](https://github.com/etcd-io/etcd/pull/17821).
* Fix [Revision decreasing after panic during compaction](https://github.com/etcd-io/etcd/pull/17864)

### Package `clientv3`

* Add [requests retry when receiving ErrGPRCNotSupportedForLearner and endpoints > 1](https://github.com/etcd-io/etcd/pull/17692).
* Fix [initialization for epMu in client context](https://github.com/etcd-io/etcd/pull/17714).

### Dependencies

* Compile binaries using [go 1.21.9](https://github.com/etcd-io/etcd/pull/17709).

---

## v3.4.31 (2024-03-21)

### etcd server

* Add [mvcc: print backend database size and size in use in compaction logs](https://github.com/etcd-io/etcd/pull/17436).
* Fix leases wrongly revoked by the leader by [ignoring old leader's leases revoking request](https://github.com/etcd-io/etcd/pull/17465).
* Fix [no progress notification being sent for watch that doesn't get any events](https://github.com/etcd-io/etcd/pull/17567).
* Fix [watch event loss after compaction](https://github.com/etcd-io/etcd/pull/17610).
* Add `next-cluster-version-compatible` flag to [allow downgrade from 3.5](https://github.com/etcd-io/etcd/pull/17330).

### Package `clientv3`

* Add [client backoff and retry config options](https://github.com/etcd-io/etcd/pull/17369).

### Dependencies

* Upgrade [bbolt to 1.3.9](https://github.com/etcd-io/etcd/pull/17484).
* Compile binaries using [go 1.21.8](https://github.com/etcd-io/etcd/pull/17538).
* Upgrade [google.golang.org/protobuf to v1.33.0 to address CVE-2024-24786](https://github.com/etcd-io/etcd/pull/17554).
* Upgrade github.com/sirupsen/logrus to v1.9.3 to address [PRISMA-2023-0056](https://github.com/etcd-io/etcd/pull/17580).

### Others

* [Make CGO\_ENABLED configurable](https://github.com/etcd-io/etcd/pull/17422).

---

## v3.4.30 (2024-01-31)

### etcd server

* Fix [nil pointer panicking due to using the wrong log library](https://github.com/etcd-io/etcd/pull/17270)

### Dependencies

* Compile binaries using go [1.20.13](https://github.com/etcd-io/etcd/pull/17276).
* Upgrade [golang.org/x/crypto to v0.17+ to address CVE-2023-48795](https://github.com/etcd-io/etcd/pull/17347).

---

## v3.4.29 (2024-01-09)

### etcd server

* [Disable following HTTP redirects in peer communication](https://github.com/etcd-io/etcd/pull/17112)
* [Add livez/readyz HTTP endpoints](https://github.com/etcd-io/etcd/pull/17128)
* Fix [Check if be is nil to avoid panic when be is overriden with nil](https://github.com/etcd-io/etcd/pull/17154)
* Fix [Add missing experimental-enable-lease-checkpoint-persist flag in etcd help](https://github.com/etcd-io/etcd/pull/17189)
* Fix [Don't flock snapshot files](https://github.com/etcd-io/etcd/pull/17208)

### Dependencies

* Compile binaries using go [1.20.12](https://github.com/etcd-io/etcd/pull/17076).

---

## v3.4.28 (2023-11-23)

### etcd server

* Improve [Skip getting authInfo from incoming context when auth is disabled](https://github.com/etcd-io/etcd/pull/16240)
* Use [the default write scheduler](https://github.com/etcd-io/etcd/pull/16782) since golang.org/x/net@v0.11.0 started using round-robin scheduler.
* Add [cluster ID check during data corruption detection to prevent false alarm](https://github.com/etcd-io/etcd/issues/15548).
* Add [Learner support Snapshot RPC](https://github.com/etcd-io/etcd/pull/16990/).

### Package `clientv3`

* Fix [Reset auth token when failing to authenticate due to auth being disabled](https://github.com/etcd-io/etcd/pull/16240).
* [Simplify grpc dialer usage](https://github.com/etcd-io/etcd/issues/11519).
* [Replace balancer with upstream grpc solution](https://github.com/etcd-io/etcd/pull/16844).
* Fix [race condition when accessing cfg.Endpoints in dial()](https://github.com/etcd-io/etcd/pull/16857).
* Fix [invalid authority header issue in single endpoint scenario](https://github.com/etcd-io/etcd/pull/16988).

### Dependencies

* Compile binaries using [go 1.20.11](https://github.com/etcd-io/etcd/pull/16916).
* Upgrade [bbolt to 1.3.8](https://github.com/etcd-io/etcd/pull/16834).
* Upgrade gRPC to 1.58.3 in [#16997](https://github.com/etcd-io/etcd/pull/16997) and [#16999](https://github.com/etcd-io/etcd/pull/16999). Note that gRPC server will reject requests with connection header (refer to [grpc/grpc-go#4803](https://github.com/grpc/grpc-go/pull/4803)).

---

## v3.4.27 (2023-07-11)

### etcd server

* Fix [corruption check may get a `ErrCompacted` error when server has just been compacted](https://github.com/etcd-io/etcd/pull/16047)
* Improve [Lease put performance for the case that auth is disabled or the user is admin](https://github.com/etcd-io/etcd/pull/16020)
* Fix [embed: nil pointer dereference when stopServer](https://github.com/etcd-io/etcd/pull/16195)

### etcdctl v3

* Add [optional --bump-revision and --mark-compacted flag to etcdctl snapshot restore operation](https://github.com/etcd-io/etcd/pull/16193).

### Dependencies

* Compile binaries using [go 1.19.10](https://github.com/etcd-io/etcd/pull/16038).

---

## v3.4.26 (2023-05-12)

### etcd server

* Fix [LeaseTimeToLive API may return keys to clients which have no read permission on the keys](https://github.com/etcd-io/etcd/pull/15814).

### Dependencies

* Compile binaries using [go 1.19.9](https://github.com/etcd-io/etcd/pull/15823)

---

## v3.4.25 (2023-04-14)

### etcd server

* Add [`etcd --tls-min-version --tls-max-version`](https://github.com/etcd-io/etcd/pull/15486) to enable support for TLS 1.3.
* Add [`etcd --listen-client-http-urls`](https://github.com/etcd-io/etcd/pull/15620) flag to support separating http server from grpc one, thus giving full immunity to [watch stream starvation under high read load](https://github.com/etcd-io/etcd/issues/15402).
* Change [http2 frame scheduler to random algorithm](https://github.com/etcd-io/etcd/pull/15478)
* Fix [server/embed: fix data race when starting both secure & insecure gRPC servers on the same address](https://github.com/etcd-io/etcd/pull/15518)
* Fix [server/auth: disallow creating empty permission ranges](https://github.com/etcd-io/etcd/pull/15621)
* Fix [wsproxy did not print log in JSON format](https://github.com/etcd-io/etcd/pull/15662).
* Fix [CVE-2021-28235](https://nvd.nist.gov/vuln/detail/CVE-2021-28235) by [clearing password after authenticating the user](https://github.com/etcd-io/etcd/pull/15655).
* Fix [etcdserver may panic when parsing a JWT token without username or revision](https://github.com/etcd-io/etcd/pull/15677).
* Fix [Watch response traveling back in time when reconnecting member downloads snapshot from the leader](https://github.com/etcd-io/etcd/pull/15520).
* Fix [Requested watcher progress notifications are not synchronised with stream](https://github.com/etcd-io/etcd/pull/15697).

### Package `clientv3`

* Reverted the fix to [auth invalid token and old revision errors in watch](https://github.com/etcd-io/etcd/pull/15542).

### Dependencies

* Recommend [Go 1.19+](https://github.com/etcd-io/etcd/pull/15337).
* Compile binaries using [Go 1.19.8](https://github.com/etcd-io/etcd/pull/15652).
* Upgrade [golang.org/x/net to v0.7.0](https://github.com/etcd-io/etcd/pull/15333).

### Docker image

* Fix [etcd docker images all tagged with amd64 architecture](https://github.com/etcd-io/etcd/pull/15681)

---

## v3.4.24 (2023-02-16)

### etcd server

* Fix [etcdserver might promote a non-started learner](https://github.com/etcd-io/etcd/pull/15097).
* Improve [mvcc: reduce count-only range overhead](https://github.com/etcd-io/etcd/pull/15099)
* Improve [mvcc: push down RangeOptions.limit argv into index tree to reduce memory overhead](https://github.com/etcd-io/etcd/pull/15137)
* Improve [server: set multiple concurrentReadTx instances share one txReadBuffer](https://github.com/etcd-io/etcd/pull/15195)
* Fix [aligning zap log timestamp resolution to microseconds](https://github.com/etcd-io/etcd/pull/15241). Etcd now uses zap timestamp format: `2006-01-02T15:04:05.999999Z0700` (microsecond instead of milliseconds precision).
* Fix [consistently format IPv6 addresses for comparison](https://github.com/etcd-io/etcd/pull/15188)

### Package `clientv3`

* Fix [etcd might send duplicated events to watch clients](https://github.com/etcd-io/etcd/pull/15275).

### Dependencies

* Upgrade [bbolt to v1.3.7](https://github.com/etcd-io/etcd/pull/15223).
* Upgrade [github.com/grpc-ecosystem/grpc-gateway](https://github.com/grpc-ecosystem/grpc-gateway/releases) from [v1.9.5](https://github.com/grpc-ecosystem/grpc-gateway/releases/tag/v1.9.5) to [v1.11.0](https://github.com/grpc-ecosystem/grpc-gateway/releases/tag/v1.11.0).

### Docker image

* Updated [base image from base-debian11 to static-debian11 and removed dependency on busybox](https://github.com/etcd-io/etcd/pull/15038).

---

## v3.4.23 (2022-12-21)

### etcd server

* Fix [Remove memberID from data corrupt alarm](https://github.com/etcd-io/etcd/pull/14853).
* Fix [nil pointer panic for readonly txn due to nil response](https://github.com/etcd-io/etcd/pull/14900).
* Bumped [some dependencies](https://github.com/etcd-io/etcd/pull/15019) to address some HIGH Vulnerabilities.

### Package `clientv3`

* Fix [Refreshing token on CommonName based authentication causes segmentation violation in client](https://github.com/etcd-io/etcd/pull/14792).

### Dependencies

* Recommend [Go 1.17+](https://github.com/etcd-io/etcd/pull/15019).
* Compile binaries using [Go 1.17.13](https://github.com/etcd-io/etcd/pull/15019).

### Docker image

* Use [distroless base image](https://github.com/etcd-io/etcd/pull/15017) to address critical Vulnerabilities.

---

## v3.4.22 (2022-11-02)

### etcd server

* Fix [memberID equals zero in corruption alarm](https://github.com/etcd-io/etcd/pull/14530)
* Fix [auth invalid token and old revision errors in watch](https://github.com/etcd-io/etcd/pull/14548)
* Fix [avoid closing a watch with ID 0 incorrectly](https://github.com/etcd-io/etcd/pull/14562)
* Fix [auth: fix data consistency issue caused by recovery from snapshot](https://github.com/etcd-io/etcd/pull/14649)

### Package `netutil`

* Fix [netutil: add url comparison without resolver to URLStringsEqual](https://github.com/etcd-io/etcd/pull/14577)

### Package `clientv3`

* Fix [Add backoff before retry when watch stream returns unavailable](https://github.com/etcd-io/etcd/pull/14581).

### etcd grpc-proxy

* Add [`etcd grpc-proxy start --listen-cipher-suites`](https://github.com/etcd-io/etcd/pull/14601) flag to support adding configurable cipher list.

---

## v3.4.21 (2022-09-15)

### etcd server

* Fix [Durability API guarantee broken in single node cluster](https://github.com/etcd-io/etcd/pull/14423)
* Fix [Panic due to nil log object](https://github.com/etcd-io/etcd/pull/14420)
* Fix [authentication data not loaded on member startup](https://github.com/etcd-io/etcd/pull/14410)

### etcdctl v3

* Fix [etcdctl move-leader may fail for multiple endpoints](https://github.com/etcd-io/etcd/pull/14441)

---

## v3.4.20 (2022-08-06)

### Package `clientv3`

* Fix [filter learners members during autosync](https://github.com/etcd-io/etcd/pull/14236).

### etcd server

* Add [`etcd --max-concurrent-streams`](https://github.com/etcd-io/etcd/pull/14251) flag to configure the max concurrent streams each client can open at a time, and defaults to math.MaxUint32.
* Add [`etcd --experimental-enable-lease-checkpoint-persist`](https://github.com/etcd-io/etcd/pull/14253) flag to enable checkpoint persisting.
* Fix [Lease checkpoints don't prevent to reset ttl on leader change](https://github.com/etcd-io/etcd/pull/14253), requires enabling checkpoint persisting.
* Fix [Protect rangePermCache with a RW lock correctly](https://github.com/etcd-io/etcd/pull/14230)
* Fix [raft: postpone MsgReadIndex until first commit in the term](https://github.com/etcd-io/etcd/pull/14258)
* Fix [etcdserver: resend ReadIndex request on empty apply request](https://github.com/etcd-io/etcd/pull/14269)
* Fix [remove temp files in snap dir when etcdserver starting](https://github.com/etcd-io/etcd/pull/14246)
* Fix [Etcdserver is still in progress of processing LeaseGrantRequest when it receives a LeaseKeepAliveRequest on the same leaseID](https://github.com/etcd-io/etcd/pull/14177)
* Fix [Grant lease with negative ID can possibly cause db out of sync](https://github.com/etcd-io/etcd/pull/14239)
* Fix [Allow non mutating requests pass through quotaKVServer when NOSPACE](https://github.com/etcd-io/etcd/pull/14254)

---

## v3.4.19 (2022-07-12)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.18...v3.4.19) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Fix [exclude the same alarm type activated by multiple peers](https://github.com/etcd-io/etcd/pull/13475).
* Fix [Defrag unsets backend options](https://github.com/etcd-io/etcd/pull/13713).
* Fix [lease leak issue due to tokenProvider isn't enabled when restoring auth store from a snapshot](https://github.com/etcd-io/etcd/pull/13206).
* Fix [the race condition between goroutine and channel on the same leases to be revoked](https://github.com/etcd-io/etcd/pull/14150).
* Fix [lessor may continue to schedule checkpoint after stepping down leader role](https://github.com/etcd-io/etcd/pull/14150).

### Package `clientv3`

* Fix [a bug of not refreshing expired tokens](https://github.com/etcd-io/etcd/pull/13999).

### Dependency

* Upgrade [go.etcd.io/bbolt](https://github.com/etcd-io/bbolt/releases) from [v1.3.3](https://github.com/etcd-io/bbolt/releases/tag/v1.3.3) to [v1.3.6](https://github.com/etcd-io/bbolt/releases/tag/v1.3.6).

### Security

* Upgrade [golang.org/x/crypto](https://github.com/etcd-io/etcd/pull/14179) to v0.0.0-20220411220226-7b82a4e95df4 to address [CVE-2022-27191](https://github.com/advisories/GHSA-8c26-wmh5-6g9v) .
* Upgrade [gopkg.in/yaml.v2](https://github.com/etcd-io/etcd/pull/14192) to v2.4.0 to address [CVE-2019-11254](https://github.com/advisories/GHSA-wxc4-f4m6-wwqv).

### Go

* Require [Go 1.16+](https://github.com/etcd-io/etcd/pull/14136).
* Compile with [Go 1.16+](https://go.dev/doc/devel/release#go1.16).
* etcd uses [go modules](https://github.com/etcd-io/etcd/pull/14136) (instead of vendor dir) to track dependencies.

---

## v3.4.18 (2021-10-15)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.17...v3.4.18) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

* Add [`etcd_disk_defrag_inflight`](https://github.com/etcd-io/etcd/pull/13397).

### Other

* Updated [base image](https://github.com/etcd-io/etcd/pull/13386) from `debian:buster-v1.4.0` to `debian:bullseye-20210927` to fix the following critical CVEs:
  + [CVE-2021-3711](https://nvd.nist.gov/vuln/detail/CVE-2021-3711): miscalculation of a buffer size in openssl's SM2 decryption
  + [CVE-2021-35942](https://nvd.nist.gov/vuln/detail/CVE-2021-35942): integer overflow flaw in glibc
  + [CVE-2019-9893](https://nvd.nist.gov/vuln/detail/CVE-2019-9893): incorrect syscall argument generation in libseccomp
  + [CVE-2021-36159](https://nvd.nist.gov/vuln/detail/CVE-2021-36159): libfetch in apk-tools mishandles numeric strings in FTP and HTTP protocols to allow out of bound reads.

---

## v3.4.17 (2021-10-03)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.16...v3.4.17) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### `etcdctl`

* Fix [etcdctl check datascale command](https://github.com/etcd-io/etcd/pull/11896) to work with https endpoints.

### gRPC gateway

* Add [`MaxCallRecvMsgSize`](https://github.com/etcd-io/etcd/pull/13077) support for http client.

### Dependency

* Replace [`github.com/dgrijalva/jwt-go with github.com/golang-jwt/jwt'](https://github.com/etcd-io/etcd/pull/13378).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## v3.4.16 (2021-05-11)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.15...v3.4.16) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Add [`--experimental-warning-apply-duration`](https://github.com/etcd-io/etcd/pull/12448) flag which allows apply duration threshold to be configurable.
* Fix [`--unsafe-no-fsync`](https://github.com/etcd-io/etcd/pull/12751) to still write-out data avoiding corruption (most of the time).
* Reduce [around 30% memory allocation by logging range response size without marshal](https://github.com/etcd-io/etcd/pull/12871).
* Add [exclude alarms from health check conditionally](https://github.com/etcd-io/etcd/pull/12880).

### Metrics

* Fix [incorrect metrics generated when clients cancel watches](https://github.com/etcd-io/etcd/pull/12803) back-ported from ([#12196](https://github.com/etcd-io/etcd/pull/12196)).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.15](https://github.com/etcd-io/etcd/releases/tag/v3.4.15) (2021-02-26)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.14...v3.4.15) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Log [successful etcd server-side health check in debug level](https://github.com/etcd-io/etcd/pull/12677).
* Fix [64 KB websocket notification message limit](https://github.com/etcd-io/etcd/pull/12402).

### Package `fileutil`

* Fix [`F_OFD_` constants](https://github.com/etcd-io/etcd/pull/12444).

### Dependency

* Bump up [`gorilla/websocket` to v1.4.2](https://github.com/etcd-io/etcd/pull/12645).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.14](https://github.com/etcd-io/etcd/releases/tag/v3.4.14) (2020-11-25)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.13...v3.4.14) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Package `clientv3`

* Fix [auth token invalid after watch reconnects](https://github.com/etcd-io/etcd/pull/12264). Get AuthToken automatically when clientConn is ready.

### etcd server

* [Fix server panic](https://github.com/etcd-io/etcd/pull/12288) when force-new-cluster flag is enabled in a cluster which had learner node.

### Package `netutil`

* Remove [`netutil.DropPort/RecoverPort/SetLatency/RemoveLatency`](https://github.com/etcd-io/etcd/pull/12491).
  + These are not used anymore. They were only used for older versions of functional testing.
  + Removed to adhere to best security practices, minimize arbitrary shell invocation.

### `tools/etcd-dump-metrics`

* Implement [input validation to prevent arbitrary shell invocation](https://github.com/etcd-io/etcd/pull/12491).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.13](https://github.com/etcd-io/etcd/releases/tag/v3.4.13) (2020-8-24)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.12...v3.4.13) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Security

* A [log warning](https://github.com/etcd-io/etcd/pull/12242) is added when etcd use any existing directory that has a permission different than 700 on Linux and 777 on Windows.

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.12](https://github.com/etcd-io/etcd/releases/tag/v3.4.12) (2020-08-19)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.11...v3.4.12) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Fix [server panic in slow writes warnings](https://github.com/etcd-io/etcd/issues/12197).
  + Fixed via [PR#12238](https://github.com/etcd-io/etcd/pull/12238).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.11](https://github.com/etcd-io/etcd/releases/tag/v3.4.11) (2020-08-18)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.10...v3.4.11) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Improve [`runtime.FDUsage` call pattern to reduce objects malloc of Memory Usage and CPU Usage](https://github.com/etcd-io/etcd/pull/11986).
* Add [`etcd --experimental-watch-progress-notify-interval`](https://github.com/etcd-io/etcd/pull/12216) flag to make watch progress notify interval configurable.

### Package `clientv3`

* Remove [excessive watch cancel logging messages](https://github.com/etcd-io/etcd/pull/12187).
  + See [kubernetes/kubernetes#93450](https://github.com/kubernetes/kubernetes/issues/93450).

### Package `runtime`

* Optimize [`runtime.FDUsage` by removing unnecessary sorting](https://github.com/etcd-io/etcd/pull/12214).

### Metrics, Monitoring

* Add [`os_fd_used` and `os_fd_limit` to monitor current OS file descriptors](https://github.com/etcd-io/etcd/pull/12214).
* Add [`etcd_disk_defrag_inflight`](https://github.com/etcd-io/etcd/pull/13397).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.10](https://github.com/etcd-io/etcd/releases/tag/v3.4.10) (2020-07-16)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.9...v3.4.10) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Package `etcd server`

* Add [`--unsafe-no-fsync`](https://github.com/etcd-io/etcd/pull/11946) flag.
  + Setting the flag disables all uses of fsync, which is unsafe and will cause data loss. This flag makes it possible to run an etcd node for testing and development without placing lots of load on the file system.
* Add [etcd --auth-token-ttl](https://github.com/etcd-io/etcd/pull/11980) flag to customize `simpleTokenTTL` settings.
* Improve [runtime.FDUsage objects malloc of Memory Usage and CPU Usage](https://github.com/etcd-io/etcd/pull/11986).
* Improve [mvcc.watchResponse channel Memory Usage](https://github.com/etcd-io/etcd/pull/11987).
* Fix [`int64` convert panic in raft logger](https://github.com/etcd-io/etcd/pull/12106).
  + Fix [kubernetes/kubernetes#91937](https://github.com/kubernetes/kubernetes/issues/91937).

### Breaking Changes

* Changed behavior on [existing dir permission](https://github.com/etcd-io/etcd/pull/11798).
  + Previously, the permission was not checked on existing data directory and the directory used for automatically generating self-signed certificates for TLS connections with clients. Now a check is added to make sure those directories, if already exist, has a desired permission of 700 on Linux and 777 on Windows.

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.9](https://github.com/etcd-io/etcd/releases/tag/v3.4.9) (2020-05-20)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.8...v3.4.9) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Package `wal`

* Add [missing CRC checksum check in WAL validate method otherwise causes panic](https://github.com/etcd-io/etcd/pull/11924).
  + See [#11918](https://github.com/etcd-io/etcd/issues/11918).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.8](https://github.com/etcd-io/etcd/releases/tag/v3.4.8) (2020-05-18)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.7...v3.4.8) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### `etcdctl`

* Make sure [save snapshot downloads checksum for integrity checks](https://github.com/etcd-io/etcd/pull/11896).

### Package `clientv3`

* Make sure [save snapshot downloads checksum for integrity checks](https://github.com/etcd-io/etcd/pull/11896).

### etcd server

* Improve logging around snapshot send and receive.
* [Add log when etcdserver failed to apply command](https://github.com/etcd-io/etcd/pull/11670).
* [Fix deadlock bug in mvcc](https://github.com/etcd-io/etcd/pull/11817).
* Fix [inconsistency between WAL and server snapshot](https://github.com/etcd-io/etcd/pull/11888).
  + Previously, server restore fails if it had crashed after persisting raft hard state but before saving snapshot.
  + See [#10219](https://github.com/etcd-io/etcd/issues/10219) for more.

### Package Auth

* [Fix a data corruption bug by saving consistent index](https://github.com/etcd-io/etcd/pull/11652).

### Metrics, Monitoring

* Add [`etcd_debugging_auth_revision`](https://github.com/etcd-io/etcd/commit/f14d2a087f7b0fd6f7980b95b5e0b945109c95f3).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.7](https://github.com/etcd-io/etcd/releases/tag/v3.4.7) (2020-04-01)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.6...v3.4.7) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### etcd server

* Improve [compaction performance when latest index is greater than 1-million](https://github.com/etcd-io/etcd/pull/11734).

### Package `wal`

* Add [`etcd_wal_write_bytes_total`](https://github.com/etcd-io/etcd/pull/11738).

### Metrics, Monitoring

* Add [`etcd_wal_write_bytes_total`](https://github.com/etcd-io/etcd/pull/11738).

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.6](https://github.com/etcd-io/etcd/releases/tag/v3.4.6) (2020-03-29)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.5...v3.4.6) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

### Package `lease`

* Fix [memory leak in follower nodes](https://github.com/etcd-io/etcd/pull/11731).
  + [#11495](https://github.com/etcd-io/etcd/issues/11495)
  + [#11730](https://github.com/etcd-io/etcd/issues/11730)

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.5](https://github.com/etcd-io/etcd/releases/tag/v3.4.5) (2020-03-18)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.4...v3.4.5) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### etcd server

* Log [`[CLIENT-PORT]/health` check in server side](https://github.com/etcd-io/etcd/pull/11704).

### client v3

* Fix [`"hasleader"` metadata embedding](https://github.com/etcd-io/etcd/pull/11687).
  + Previously, `clientv3.WithRequireLeader(ctx)` was overwriting existing context keys.

### etcdctl v3

* Fix [`etcdctl member add`](https://github.com/etcd-io/etcd/pull/11638) command to prevent potential timeout.

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

* Add [`etcd_server_client_requests_total` with `"type"` and `"client_api_version"` labels](https://github.com/etcd-io/etcd/pull/11687).

### gRPC Proxy

* Fix [`panic on error`](https://github.com/etcd-io/etcd/pull/11694) for metrics handler.

### Go

* Compile with [*Go 1.12.17*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.4](https://github.com/etcd-io/etcd/releases/tag/v3.4.4) (2020-02-24)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.3...v3.4.4) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### etcd server

* Fix [`wait purge file loop during shutdown`](https://github.com/etcd-io/etcd/pull/11308).
  + Previously, during shutdown etcd could accidentally remove needed wal files, resulting in catastrophic error `etcdserver: open wal error: wal: file not found.` during startup.
  + Now, etcd makes sure the purge file loop exits before server signals stop of the raft node.
* [Fix corruption bug in defrag](https://github.com/etcd-io/etcd/pull/11613).
* Fix [quorum protection logic when promoting a learner](https://github.com/etcd-io/etcd/pull/11640).
* Improve [peer corruption checker](https://github.com/etcd-io/etcd/pull/11621) to work when peer mTLS is enabled.

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

Note that any `etcd_debugging_*` metrics are experimental and subject to change.

* Add [`etcd_debugging_mvcc_total_put_size_in_bytes`](https://github.com/etcd-io/etcd/pull/11374) Prometheus metric.
* Fix bug where [etcd\_debugging\_mvcc\_db\_compaction\_keys\_total is always 0](https://github.com/etcd-io/etcd/pull/11400).

### Auth

* Fix [NoPassword check when adding user through GRPC gateway](https://github.com/etcd-io/etcd/pull/11418) ([issue#11414](https://github.com/etcd-io/etcd/issues/11414))
* Fix bug where [some auth related messages are logged at wrong level](https://github.com/etcd-io/etcd/pull/11586)

---

## [v3.4.3](https://github.com/etcd-io/etcd/releases/tag/v3.4.3) (2019-10-24)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.2...v3.4.3) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

Note that any `etcd_debugging_*` metrics are experimental and subject to change.

* Change [`etcd_cluster_version`](https://github.com/etcd-io/etcd/pull/11254) Prometheus metrics to include only major and minor version.

### Go

* Compile with [*Go 1.12.12*](https://golang.org/doc/devel/release.html#go1.12).

---

## [v3.4.2](https://github.com/etcd-io/etcd/releases/tag/v3.4.2) (2019-10-11)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.1...v3.4.2) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### etcdctl v3

* Fix [`etcdctl member add`](https://github.com/etcd-io/etcd/pull/11194) command to prevent potential timeout.

### etcdserver

* Add [`tracing`](https://github.com/etcd-io/etcd/pull/11179) to range, put and compact requests in etcdserver.

### Go

* Compile with [*Go 1.12.9*](https://golang.org/doc/devel/release.html#go1.12) including [*Go 1.12.8*](https://groups.google.com/d/msg/golang-announce/65QixT3tcmg/DrFiG6vvCwAJ) security fixes.

### client v3

* Fix [client balancer failover against multiple endpoints](https://github.com/etcd-io/etcd/pull/11184).
  + Fix ["kube-apiserver: failover on multi-member etcd cluster fails certificate check on DNS mismatch" (kubernetes#83028)](https://github.com/kubernetes/kubernetes/issues/83028).
* Fix [IPv6 endpoint parsing in client](https://github.com/etcd-io/etcd/pull/11211).
  + Fix ["1.16: etcd client does not parse IPv6 addresses correctly when members are joining" (kubernetes#83550)](https://github.com/kubernetes/kubernetes/issues/83550).

---

## [v3.4.1](https://github.com/etcd-io/etcd/releases/tag/v3.4.1) (2019-09-17)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0...v3.4.1) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

Note that any `etcd_debugging_*` metrics are experimental and subject to change.

* Add [`etcd_debugging_mvcc_current_revision`](https://github.com/etcd-io/etcd/pull/11126) Prometheus metric.
* Add [`etcd_debugging_mvcc_compact_revision`](https://github.com/etcd-io/etcd/pull/11126) Prometheus metric.

### etcd server

* Fix [secure server logging message](https://github.com/etcd-io/etcd/commit/8b053b0f44c14ac0d9f39b9b78c17c57d47966eb).
* Remove [redundant `%` characters in file descriptor warning message](https://github.com/etcd-io/etcd/commit/d5f79adc9cea9ec8c93669526464b0aa19ed417b).

### Package `embed`

* Add [`embed.Config.ZapLoggerBuilder`](https://github.com/etcd-io/etcd/pull/11148) to allow creating a custom zap logger.

### Dependency

* Upgrade [`google.golang.org/grpc`](https://github.com/grpc/grpc-go/releases) from [**`v1.23.0`**](https://github.com/grpc/grpc-go/releases/tag/v1.23.0) to [**`v1.23.1`**](https://github.com/grpc/grpc-go/releases/tag/v1.23.1).

### Go

* Compile with [*Go 1.12.9*](https://golang.org/doc/devel/release.html#go1.12) including [*Go 1.12.8*](https://groups.google.com/d/msg/golang-announce/65QixT3tcmg/DrFiG6vvCwAJ) security fixes.

---

## v3.4.0 (2019-08-30)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.3.0...v3.4.0) and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/) for any breaking changes.

* [v3.4.0](https://github.com/etcd-io/etcd/releases/tag/v3.4.0) (2019-08-30), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0-rc.4...v3.4.0).
* [v3.4.0-rc.4](https://github.com/etcd-io/etcd/releases/tag/v3.4.0-rc.4) (2019-08-29), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0-rc.3...v3.4.0-rc.4).
* [v3.4.0-rc.3](https://github.com/etcd-io/etcd/releases/tag/v3.4.0-rc.3) (2019-08-27), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0-rc.2...v3.4.0-rc.3).
* [v3.4.0-rc.2](https://github.com/etcd-io/etcd/releases/tag/v3.4.0-rc.2) (2019-08-23), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0-rc.1...v3.4.0-rc.2).
* [v3.4.0-rc.1](https://github.com/etcd-io/etcd/releases/tag/v3.4.0-rc.1) (2019-08-15), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0-rc.0...v3.4.0-rc.1).
* [v3.4.0-rc.0](https://github.com/etcd-io/etcd/releases/tag/v3.4.0-rc.0) (2019-08-12), see [code changes](https://github.com/etcd-io/etcd/compare/v3.3.0...v3.4.0-rc.0).

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.4 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_4/).**

### Documentation

* etcd now has a new website! Please visit <https://etcd.io>.

### Improved

* Add Raft learner: [etcd#10725](https://github.com/etcd-io/etcd/pull/10725), [etcd#10727](https://github.com/etcd-io/etcd/pull/10727), [etcd#10730](https://github.com/etcd-io/etcd/pull/10730).
  + User guide: [runtime-configuration document](https://etcd.io/docs/latest/op-guide/runtime-configuration/#add-a-new-member-as-learner).
  + API change: [API reference document](https://etcd.io/docs/latest/dev-guide/api_reference_v3/).
  + More details on implementation: [learner design document](https://etcd.io/docs/latest/learning/design-learner/) and [implementation task list](https://github.com/etcd-io/etcd/issues/10537).
* Rewrite [client balancer](https://github.com/etcd-io/etcd/pull/9860) with [new gRPC balancer interface](https://github.com/etcd-io/etcd/issues/9106).
  + Upgrade [gRPC to v1.23.0](https://github.com/etcd-io/etcd/pull/10911).
  + Improve [client balancer failover against secure endpoints](https://github.com/etcd-io/etcd/pull/10911).
    - Fix ["kube-apiserver 1.13.x refuses to work when first etcd-server is not available" (kubernetes#72102)](https://github.com/kubernetes/kubernetes/issues/72102).
  + Fix [gRPC panic "send on closed channel](https://github.com/etcd-io/etcd/issues/9956).
  + [The new client balancer](https://etcd.io/docs/latest/learning/design-client/) uses an asynchronous resolver to pass endpoints to the gRPC dial function. To block until the underlying connection is up, pass `grpc.WithBlock()` to `clientv3.Config.DialOptions`.
* Add [backoff on watch retries on transient errors](https://github.com/etcd-io/etcd/pull/9840).
* Add [jitter to watch progress notify](https://github.com/etcd-io/etcd/pull/9278) to prevent [spikes in `etcd_network_client_grpc_sent_bytes_total`](https://github.com/etcd-io/etcd/issues/9246).
* Improve [read index wait timeout warning log](https://github.com/etcd-io/etcd/pull/10026), which indicates that local node might have slow network.
* Improve [slow request apply warning log](https://github.com/etcd-io/etcd/pull/9288).
  + e.g. `read-only range request "key:\"/a\" range_end:\"/b\" " with result "range_response_count:3 size:96" took too long (97.966µs) to execute`.
  + Redact [request value field](https://github.com/etcd-io/etcd/pull/9822).
  + Provide [response size](https://github.com/etcd-io/etcd/pull/9826).
* Improve ["became inactive" warning log](https://github.com/etcd-io/etcd/pull/10024), which indicates message send to a peer failed.
* Improve [TLS setup error logging](https://github.com/etcd-io/etcd/pull/9518) to help debug [TLS-enabled cluster configuring issues](https://github.com/etcd-io/etcd/issues/9400).
* Improve [long-running concurrent read transactions under light write workloads](https://github.com/etcd-io/etcd/pull/9296).
  + Previously, periodic commit on pending writes blocks incoming read transactions, even if there is no pending write.
  + Now, periodic commit operation does not block concurrent read transactions, thus improves long-running read transaction performance.
* Make [backend read transactions fully concurrent](https://github.com/etcd-io/etcd/pull/10523).
  + Previously, ongoing long-running read transactions block writes and future reads.
  + With this change, write throughput is increased by 70% and P99 write latency is reduced by 90% in the presence of long-running reads.
* Improve [Raft Read Index timeout warning messages](https://github.com/etcd-io/etcd/pull/9897).
* Adjust [election timeout on server restart](https://github.com/etcd-io/etcd/pull/9415) to reduce [disruptive rejoining servers](https://github.com/etcd-io/etcd/issues/9333).
  + Previously, etcd fast-forwards election ticks on server start, with only one tick left for leader election. This is to speed up start phase, without having to wait until all election ticks elapse. Advancing election ticks is useful for cross datacenter deployments with larger election timeouts. However, it was affecting cluster availability if the last tick elapses before leader contacts the restarted node.
  + Now, when etcd restarts, it adjusts election ticks with more than one tick left, thus more time for leader to prevent disruptive restart.
* Add [Raft Pre-Vote feature](https://github.com/etcd-io/etcd/pull/9352) to reduce [disruptive rejoining servers](https://github.com/etcd-io/etcd/issues/9333).
  + For instance, a flaky(or rejoining) member may drop in and out, and start campaign. This member will end up with a higher term, and ignore all incoming messages with lower term. In this case, a new leader eventually need to get elected, thus disruptive to cluster availability. Raft implements Pre-Vote phase to prevent this kind of disruptions. If enabled, Raft runs an additional phase of election to check if pre-candidate can get enough votes to win an election.
* Adjust [periodic compaction retention window](https://github.com/etcd-io/etcd/pull/9485).
  + e.g. `etcd --auto-compaction-mode=revision --auto-compaction-retention=1000` automatically `Compact` on `"latest revision" - 1000` every 5-minute (when latest revision is 30000, compact on revision 29000).
  + e.g. Previously, `etcd --auto-compaction-mode=periodic --auto-compaction-retention=24h` automatically `Compact` with 24-hour retention windown for every 2.4-hour. Now, `Compact` happens for every 1-hour.
  + e.g. Previously, `etcd --auto-compaction-mode=periodic --auto-compaction-retention=30m` automatically `Compact` with 30-minute retention windown for every 3-minute. Now, `Compact` happens for every 30-minute.
  + Periodic compactor keeps recording latest revisions for every compaction period when given period is less than 1-hour, or for every 1-hour when given compaction period is greater than 1-hour (e.g. 1-hour when `etcd --auto-compaction-mode=periodic --auto-compaction-retention=24h`).
  + For every compaction period or 1-hour, compactor uses the last revision that was fetched before compaction period, to discard historical data.
  + The retention window of compaction period moves for every given compaction period or hour.
  + For instance, when hourly writes are 100 and `etcd --auto-compaction-mode=periodic --auto-compaction-retention=24h`, `v3.2.x`, `v3.3.0`, `v3.3.1`, and `v3.3.2` compact revision 2400, 2640, and 2880 for every 2.4-hour, while `v3.3.3` *or later* compacts revision 2400, 2500, 2600 for every 1-hour.
  + Furthermore, when `etcd --auto-compaction-mode=periodic --auto-compaction-retention=30m` and writes per minute are about 1000, `v3.3.0`, `v3.3.1`, and `v3.3.2` compact revision 30000, 33000, and 36000, for every 3-minute, while `v3.3.3` *or later* compacts revision 30000, 60000, and 90000, for every 30-minute.
* Improve [lease expire/revoke operation performance](https://github.com/etcd-io/etcd/pull/9418), address [lease scalability issue](https://github.com/etcd-io/etcd/issues/9496).
* Make [Lease `Lookup` non-blocking with concurrent `Grant`/`Revoke`](https://github.com/etcd-io/etcd/pull/9229).
* Make etcd server return `raft.ErrProposalDropped` on internal Raft proposal drop in [v3 applier](https://github.com/etcd-io/etcd/pull/9549) and [v2 applier](https://github.com/etcd-io/etcd/pull/9558).
  + e.g. a node is removed from cluster, or [`raftpb.MsgProp` arrives at current leader while there is an ongoing leadership transfer](https://github.com/etcd-io/etcd/issues/8975).
* Add [`snapshot`](https://github.com/etcd-io/etcd/pull/9118) package for easier snapshot workflow (see [`godoc.org/github.com/etcd/clientv3/snapshot`](https://godoc.org/github.com/etcd-io/etcd/clientv3/snapshot) for more).
* Improve [functional tester](https://github.com/etcd-io/etcd/tree/main/functional) coverage: [proxy layer to run network fault tests in CI](https://github.com/etcd-io/etcd/pull/9081), [TLS is enabled both for server and client](https://github.com/etcd-io/etcd/pull/9534), [liveness mode](https://github.com/etcd-io/etcd/issues/9230), [shuffle test sequence](https://github.com/etcd-io/etcd/issues/9381), [membership reconfiguration failure cases](https://github.com/etcd-io/etcd/pull/9564), [disastrous quorum loss and snapshot recover from a seed member](https://github.com/etcd-io/etcd/pull/9565), [embedded etcd](https://github.com/etcd-io/etcd/pull/9572).
* Improve [index compaction blocking](https://github.com/etcd-io/etcd/pull/9511) by using a copy on write clone to avoid holding the lock for the traversal of the entire index.
* Update [JWT methods](https://github.com/etcd-io/etcd/pull/9883) to allow for use of any supported signature method/algorithm.
* Add [Lease checkpointing](https://github.com/etcd-io/etcd/pull/9924) to persist remaining TTLs to the consensus log periodically so that long lived leases progress toward expiry in the presence of leader elections and server restarts.
  + Enabled by experimental flag "--experimental-enable-lease-checkpoint".
* Add [gRPC interceptor for debugging logs](https://github.com/etcd-io/etcd/pull/9990); enable `etcd --debug` flag to see per-request debug information.
* Add [consistency check in snapshot status](https://github.com/etcd-io/etcd/pull/10109). If consistency check on snapshot file fails, `snapshot status` returns `"snapshot file integrity check failed..."` error.
* Add [`Verify` function to perform corruption check on WAL contents](https://github.com/etcd-io/etcd/pull/10603).
* Improve [heartbeat send failure logging](https://github.com/etcd-io/etcd/pull/10663).
* Support [users with no password](https://github.com/etcd-io/etcd/pull/9817) for reducing security risk introduced by leaked password. The users can only be authenticated with `CommonName` based auth.
* Add `etcd --experimental-peer-skip-client-san-verification` to [skip verification of peer client address](https://github.com/etcd-io/etcd/pull/10524).
* Add `etcd --experimental-compaction-batch-limit` to [sets the maximum revisions deleted in each compaction batch](https://github.com/etcd-io/etcd/pull/11034).
* Reduced default compaction batch size from 10k revisions to 1k revisions to improve p99 latency during compactions and reduced wait between compactions from 100ms to 10ms.

### Breaking Changes

* Rewrite [client balancer](https://github.com/etcd-io/etcd/pull/9860) with [new gRPC balancer interface](https://github.com/etcd-io/etcd/issues/9106).
  + Upgrade [gRPC to v1.23.0](https://github.com/etcd-io/etcd/pull/10911).
  + Improve [client balancer failover against secure endpoints](https://github.com/etcd-io/etcd/pull/10911).
    - Fix ["kube-apiserver 1.13.x refuses to work when first etcd-server is not available" (kubernetes#72102)](https://github.com/kubernetes/kubernetes/issues/72102).
  + Fix [gRPC panic "send on closed channel](https://github.com/etcd-io/etcd/issues/9956).
  + [The new client balancer](https://etcd.io/docs/latest/learning/design-client/) uses an asynchronous resolver to pass endpoints to the gRPC dial function. To block until the underlying connection is up, pass `grpc.WithBlock()` to `clientv3.Config.DialOptions`.
* Require [*Go 1.12+*](https://github.com/etcd-io/etcd/pull/10045).
  + Compile with [*Go 1.12.9*](https://golang.org/doc/devel/release.html#go1.12) including [*Go 1.12.8*](https://groups.google.com/d/msg/golang-announce/65QixT3tcmg/DrFiG6vvCwAJ) security fixes.
* Migrate dependency management tool from `glide` to [Go module](https://github.com/etcd-io/etcd/pull/10063).
  + <= 3.3 puts `vendor` directory under `cmd/vendor` directory to [prevent conflicting transitive dependencies](https://github.com/etcd-io/etcd/issues/4913).
  + 3.4 moves `cmd/vendor` directory to `vendor` at repository root.
  + Remove recursive symlinks in `cmd` directory.
  + Now `go get/install/build` on `etcd` packages (e.g. `clientv3`, `tools/benchmark`) enforce builds with etcd `vendor` directory.
* Deprecated `latest` [release container](https://console.cloud.google.com/gcr/images/etcd-development/GLOBAL/etcd) tag.
  + **`docker pull gcr.io/etcd-development/etcd:latest` would not be up-to-date**.
* Deprecated [minor](https://semver.org/) version [release container](https://console.cloud.google.com/gcr/images/etcd-development/GLOBAL/etcd) tags.
  + `docker pull gcr.io/etcd-development/etcd:v3.3` would still work.
  + **`docker pull gcr.io/etcd-development/etcd:v3.4` would not work**.
  + Use **`docker pull gcr.io/etcd-development/etcd:v3.4.x`** instead, with the exact patch version.
* Deprecated [ACIs from official release](https://github.com/etcd-io/etcd/pull/9059).
  + [AppC was officially suspended](https://github.com/appc/spec#-disclaimer-), as of late 2016.
  + [`acbuild`](https://github.com/containers/build#this-project-is-currently-unmaintained) is not maintained anymore.
  + `*.aci` files are not available from `v3.4` release.
* Move [`"github.com/coreos/etcd"`](https://github.com/etcd-io/etcd/issues/9965) to [`"github.com/etcd-io/etcd"`](https://github.com/etcd-io/etcd/issues/9965).
  + Change import path to `"go.etcd.io/etcd"`.
  + e.g. `import "go.etcd.io/etcd/raft"`.
* Make [`ETCDCTL_API=3 etcdctl` default](https://github.com/etcd-io/etcd/issues/9600).
  + Now, `etcdctl set foo bar` must be `ETCDCTL_API=2 etcdctl set foo bar`.
  + Now, `ETCDCTL_API=3 etcdctl put foo bar` could be just `etcdctl put foo bar`.
* Make [`etcd --enable-v2=false` default](https://github.com/etcd-io/etcd/pull/10935).
* Make [`embed.DefaultEnableV2` `false` default](https://github.com/etcd-io/etcd/pull/10935).
* **Deprecated `etcd --ca-file` flag**. Use [`etcd --trusted-ca-file`](https://github.com/etcd-io/etcd/pull/9470) instead (`etcd --ca-file` flag has been marked deprecated since v2.1).
* **Deprecated `etcd --peer-ca-file` flag**. Use [`etcd --peer-trusted-ca-file`](https://github.com/etcd-io/etcd/pull/9470) instead (`etcd --peer-ca-file` flag has been marked deprecated since v2.1).
* **Deprecated `pkg/transport.TLSInfo.CAFile` field**. Use [`pkg/transport.TLSInfo.TrustedCAFile`](https://github.com/etcd-io/etcd/pull/9470) instead (`CAFile` field has been marked deprecated since v2.1).
* Exit on [empty hosts in advertise URLs](https://github.com/etcd-io/etcd/pull/8786).
  + Address [advertise client URLs accepts empty hosts](https://github.com/etcd-io/etcd/issues/8379).
  + e.g. exit with error on `--advertise-client-urls=http://:2379`.
  + e.g. exit with error on `--initial-advertise-peer-urls=http://:2380`.
* Exit on [shadowed environment variables](https://github.com/etcd-io/etcd/pull/9382).
  + Address [error on shadowed environment variables](https://github.com/etcd-io/etcd/issues/8380).
  + e.g. exit with error on `ETCD_NAME=abc etcd --name=def`.
  + e.g. exit with error on `ETCD_INITIAL_CLUSTER_TOKEN=abc etcd --initial-cluster-token=def`.
  + e.g. exit with error on `ETCDCTL_ENDPOINTS=abc.com ETCDCTL_API=3 etcdctl endpoint health --endpoints=def.com`.
* Change [`etcdserverpb.AuthRoleRevokePermissionRequest/key,range_end` fields type from `string` to `bytes`](https://github.com/etcd-io/etcd/pull/9433).
* Deprecating `etcd_debugging_mvcc_db_total_size_in_bytes` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_db_total_size_in_bytes`](https://github.com/etcd-io/etcd/pull/9819) instead.
* Deprecating `etcd_debugging_mvcc_put_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_put_total`](https://github.com/etcd-io/etcd/pull/10962) instead.
* Deprecating `etcd_debugging_mvcc_delete_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_delete_total`](https://github.com/etcd-io/etcd/pull/10962) instead.
* Deprecating `etcd_debugging_mvcc_range_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_range_total`](https://github.com/etcd-io/etcd/pull/10968) instead.
* Deprecating `etcd_debugging_mvcc_txn_total`Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_txn_total`](https://github.com/etcd-io/etcd/pull/10968) instead.
* Rename `etcdserver.ServerConfig.SnapCount` field to `etcdserver.ServerConfig.SnapshotCount`, to be consistent with the flag name `etcd --snapshot-count`.
* Rename `embed.Config.SnapCount` field to [`embed.Config.SnapshotCount`](https://github.com/etcd-io/etcd/pull/9745), to be consistent with the flag name `etcd --snapshot-count`.
* Change [`embed.Config.CorsInfo` in `*cors.CORSInfo` type to `embed.Config.CORS` in `map[string]struct{}` type](https://github.com/etcd-io/etcd/pull/9490).
* Deprecated [`embed.Config.SetupLogging`](https://github.com/etcd-io/etcd/pull/9572).
  + Now logger is set up automatically based on [`embed.Config.Logger`, `embed.Config.LogOutputs`, `embed.Config.Debug` fields](https://github.com/etcd-io/etcd/pull/9572).
* Rename [`etcd --log-output` to `etcd --log-outputs`](https://github.com/etcd-io/etcd/pull/9624) to support multiple log outputs.
  + **`etcd --log-output`** will be deprecated in v3.5.
* Rename [**`embed.Config.LogOutput`** to **`embed.Config.LogOutputs`**](https://github.com/etcd-io/etcd/pull/9624) to support multiple log outputs.
* Change [**`embed.Config.LogOutputs`** type from `string` to `[]string`](https://github.com/etcd-io/etcd/pull/9579) to support multiple log outputs.
  + Now that `etcd --log-outputs` accepts multiple writers, etcd configuration YAML file `log-outputs` field must be changed to `[]string` type.
  + Previously, `etcd --config-file etcd.config.yaml` can have `log-outputs: default` field, now must be `log-outputs: [default]`.
* Deprecating [`etcd --debug`](https://github.com/etcd-io/etcd/pull/10947) flag. Use `etcd --log-level=debug` flag instead.
  + v3.5 will deprecate `etcd --debug` flag in favor of `etcd --log-level=debug`.
* Change v3 `etcdctl snapshot` exit codes with [`snapshot` package](https://github.com/etcd-io/etcd/pull/9118/commits/df689f4280e1cce4b9d61300be13ca604d41670a).
  + Exit on error with exit code 1 (no more exit code 5 or 6 on `snapshot save/restore` commands).
* Deprecated [`grpc.ErrClientConnClosing`](https://github.com/etcd-io/etcd/pull/10981).
  + `clientv3` and `proxy/grpcproxy` now does not return `grpc.ErrClientConnClosing`.
  + `grpc.ErrClientConnClosing` has been [deprecated in gRPC >= 1.10](https://github.com/grpc/grpc-go/pull/1854).
  + Use `clientv3.IsConnCanceled(error)` or `google.golang.org/grpc/status.FromError(error)` instead.
* Deprecated [gRPC gateway](https://github.com/grpc-ecosystem/grpc-gateway) endpoint `/v3beta` with [`/v3`](https://github.com/etcd-io/etcd/pull/9298).
  + Deprecated [`/v3alpha`](https://github.com/etcd-io/etcd/pull/9298).
  + To deprecate [`/v3beta`](https://github.com/etcd-io/etcd/issues/9189) in v3.5.
  + In v3.4, `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` still works as a fallback to `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'`, but `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` won't work in v3.5. Use `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` instead.
* Change [`wal` package function signatures](https://github.com/etcd-io/etcd/pull/9572) to support [structured logger and logging to file](https://github.com/etcd-io/etcd/issues/9438) in server-side.
  + Previously, `Open(dirpath string, snap walpb.Snapshot) (*WAL, error)`, now `Open(lg *zap.Logger, dirpath string, snap walpb.Snapshot) (*WAL, error)`.
  + Previously, `OpenForRead(dirpath string, snap walpb.Snapshot) (*WAL, error)`, now `OpenForRead(lg *zap.Logger, dirpath string, snap walpb.Snapshot) (*WAL, error)`.
  + Previously, `Repair(dirpath string) bool`, now `Repair(lg *zap.Logger, dirpath string) bool`.
  + Previously, `Create(dirpath string, metadata []byte) (*WAL, error)`, now `Create(lg *zap.Logger, dirpath string, metadata []byte) (*WAL, error)`.
* Remove [`pkg/cors` package](https://github.com/etcd-io/etcd/pull/9490).
* Move internal packages to `etcdserver`.
  + `"github.com/coreos/etcd/alarm"` to `"go.etcd.io/etcd/etcdserver/api/v3alarm"`.
  + `"github.com/coreos/etcd/compactor"` to `"go.etcd.io/etcd/etcdserver/api/v3compactor"`.
  + `"github.com/coreos/etcd/discovery"` to `"go.etcd.io/etcd/etcdserver/api/v2discovery"`.
  + `"github.com/coreos/etcd/etcdserver/auth"` to `"go.etcd.io/etcd/etcdserver/api/v2auth"`.
  + `"github.com/coreos/etcd/etcdserver/membership"` to `"go.etcd.io/etcd/etcdserver/api/membership"`.
  + `"github.com/coreos/etcd/etcdserver/stats"` to `"go.etcd.io/etcd/etcdserver/api/v2stats"`.
  + `"github.com/coreos/etcd/error"` to `"go.etcd.io/etcd/etcdserver/api/v2error"`.
  + `"github.com/coreos/etcd/rafthttp"` to `"go.etcd.io/etcd/etcdserver/api/rafthttp"`.
  + `"github.com/coreos/etcd/snap"` to `"go.etcd.io/etcd/etcdserver/api/snap"`.
  + `"github.com/coreos/etcd/store"` to `"go.etcd.io/etcd/etcdserver/api/v2store"`.
* Change [snapshot file permissions](https://github.com/etcd-io/etcd/pull/9977): On Linux, the snapshot file changes from readable by all (mode 0644) to readable by the user only (mode 0600).
* Change [`pkg/adt.IntervalTree` from `struct` to `interface`](https://github.com/etcd-io/etcd/pull/10959).
  + See [`pkg/adt` README](https://github.com/etcd-io/etcd/tree/main/pkg/adt) and [`pkg/adt` godoc](https://godoc.org/go.etcd.io/etcd/pkg/adt).
* Release branch `/version` defines version `3.4.x-pre`, instead of `3.4.y+git`.
  + Use `3.4.5-pre`, instead of `3.4.4+git`.

### Dependency

* Upgrade [`github.com/coreos/bbolt`](https://github.com/etcd-io/bbolt/releases) from [**`v1.3.1-coreos.6`**](https://github.com/etcd-io/bbolt/releases/tag/v1.3.1-coreos.6) to [`go.etcd.io/bbolt`](https://github.com/etcd-io/bbolt/releases) [**`v1.3.3`**](https://github.com/etcd-io/bbolt/releases/tag/v1.3.3).
* Upgrade [`google.golang.org/grpc`](https://github.com/grpc/grpc-go/releases) from [**`v1.7.5`**](https://github.com/grpc/grpc-go/releases/tag/v1.7.5) to [**`v1.23.0`**](https://github.com/grpc/grpc-go/releases/tag/v1.23.0).
* Migrate [`github.com/ugorji/go/codec`](https://github.com/ugorji/go/releases) to [**`github.com/json-iterator/go`**](https://github.com/json-iterator/go), to [regenerate v2 `client`](https://github.com/etcd-io/etcd/pull/9494) (See [#10667](https://github.com/etcd-io/etcd/pull/10667) for more).
* Migrate [`github.com/ghodss/yaml`](https://github.com/ghodss/yaml/releases) to [**`sigs.k8s.io/yaml`**](https://github.com/kubernetes-sigs/yaml) (See [#10687](https://github.com/etcd-io/etcd/pull/10687) for more).
* Upgrade [`golang.org/x/crypto`](https://github.com/golang/crypto) from [**`crypto@9419663f5`**](https://github.com/golang/crypto/commit/9419663f5a44be8b34ca85f08abc5fe1be11f8a3) to [**`crypto@0709b304e793`**](https://github.com/golang/crypto/commit/0709b304e793a5edb4a2c0145f281ecdc20838a4).
* Upgrade [`golang.org/x/net`](https://github.com/golang/net) from [**`net@66aacef3d`**](https://github.com/golang/net/commit/66aacef3dd8a676686c7ae3716979581e8b03c47) to [**`net@adae6a3d119a`**](https://github.com/golang/net/commit/adae6a3d119ae4890b46832a2e88a95adc62b8e7).
* Upgrade [`golang.org/x/sys`](https://github.com/golang/sys) from [**`sys@ebfc5b463`**](https://github.com/golang/sys/commit/ebfc5b4631820b793c9010c87fd8fef0f39eb082) to [**`sys@c7b8b68b1456`**](https://github.com/golang/sys/commit/c7b8b68b14567162c6602a7c5659ee0f26417c18).
* Upgrade [`golang.org/x/text`](https://github.com/golang/text) from [**`text@b19bf474d`**](https://github.com/golang/text/commit/b19bf474d317b857955b12035d2c5acb57ce8b01) to [**`v0.3.0`**](https://github.com/golang/text/releases/tag/v0.3.0).
* Upgrade [`golang.org/x/time`](https://github.com/golang/time) from [**`time@c06e80d93`**](https://github.com/golang/time/commit/c06e80d9300e4443158a03817b8a8cb37d230320) to [**`time@fbb02b229`**](https://github.com/golang/time/commit/fbb02b2291d28baffd63558aa44b4b56f178d650).
* Upgrade [`github.com/golang/protobuf`](https://github.com/golang/protobuf/releases) from [**`golang/protobuf@1e59b77b5`**](https://github.com/golang/protobuf/commit/1e59b77b52bf8e4b449a57e6f79f21226d571845) to [**`v1.3.2`**](https://github.com/golang/protobuf/releases/tag/v1.3.2).
* Upgrade [`gopkg.in/yaml.v2`](https://github.com/go-yaml/yaml/releases) from [**`yaml@cd8b52f82`**](https://github.com/go-yaml/yaml/commit/cd8b52f8269e0feb286dfeef29f8fe4d5b397e0b) to [**`yaml@5420a8b67`**](https://github.com/go-yaml/yaml/commit/5420a8b6744d3b0345ab293f6fcba19c978f1183).
* Upgrade [`github.com/dgrijalva/jwt-go`](https://github.com/dgrijalva/jwt-go/releases) from [**`v3.0.0`**](https://github.com/dgrijalva/jwt-go/releases/tag/v3.0.0) to [**`v3.2.0`**](https://github.com/dgrijalva/jwt-go/releases/tag/v3.2.0).
* Upgrade [`github.com/soheilhy/cmux`](https://github.com/soheilhy/cmux/releases) from [**`v0.1.3`**](https://github.com/soheilhy/cmux/releases/tag/v0.1.3) to [**`v0.1.4`**](https://github.com/soheilhy/cmux/releases/tag/v0.1.4).
* Upgrade [`github.com/google/btree`](https://github.com/google/btree/releases) from [**`google/btree@925471ac9`**](https://github.com/google/btree/commit/925471ac9e2131377a91e1595defec898166fe49) to [**`v1.0.0`**](https://github.com/google/btree/releases/tag/v1.0.0).
* Upgrade [`github.com/spf13/cobra`](https://github.com/spf13/cobra/releases) from [**`spf13/cobra@1c44ec8d3`**](https://github.com/spf13/cobra/commit/1c44ec8d3f1552cac48999f9306da23c4d8a288b) to [**`v0.0.3`**](https://github.com/spf13/cobra/releases/tag/v0.0.3).
* Upgrade [`github.com/spf13/pflag`](https://github.com/spf13/pflag/releases) from [**`v1.0.0`**](https://github.com/spf13/pflag/releases/tag/v1.0.0) to [**`spf13/pflag@1ce0cc6db`**](https://github.com/spf13/pflag/commit/1ce0cc6db4029d97571db82f85092fccedb572ce).
* Upgrade [`github.com/coreos/go-systemd`](https://github.com/coreos/go-systemd/releases) from [**`v15`**](https://github.com/coreos/go-systemd/releases/tag/v15) to [**`v17`**](https://github.com/coreos/go-systemd/releases/tag/v17).
* Upgrade [`github.com/prometheus/client_golang`](https://github.com/prometheus/client_golang/releases) from [**`prometheus/client_golang@5cec1d042`**](https://github.com/prometheus/client_golang/commit/5cec1d0429b02e4323e042eb04dafdb079ddf568) to [**`v1.0.0`**](https://github.com/prometheus/client_golang/releases/tag/v1.0.0).
* Upgrade [`github.com/grpc-ecosystem/go-grpc-prometheus`](https://github.com/grpc-ecosystem/go-grpc-prometheus/releases) from [**`grpc-ecosystem/go-grpc-prometheus@0dafe0d49`**](https://github.com/grpc-ecosystem/go-grpc-prometheus/commit/0dafe0d496ea71181bf2dd039e7e3f44b6bd11a7) to [**`v1.2.0`**](https://github.com/grpc-ecosystem/go-grpc-prometheus/releases/tag/v1.2.0).
* Upgrade [`github.com/grpc-ecosystem/grpc-gateway`](https://github.com/grpc-ecosystem/grpc-gateway/releases) from [**`v1.3.1`**](https://github.com/grpc-ecosystem/grpc-gateway/releases/tag/v1.3.1) to [**`v1.4.1`**](https://github.com/grpc-ecosystem/grpc-gateway/releases/tag/v1.4.1).
* Migrate [`github.com/kr/pty`](https://github.com/kr/pty/releases) to [**`github.com/creack/pty`**](https://github.com/creack/pty/releases/tag/v1.1.7), as the later has replaced the original module.
* Upgrade [`github.com/gogo/protobuf`](https://github.com/gogo/protobuf/releases) from [**`v1.0.0`**](https://github.com/gogo/protobuf/releases/tag/v1.0.0) to [**`v1.2.1`**](https://github.com/gogo/protobuf/releases/tag/v1.2.1).

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

Note that any `etcd_debugging_*` metrics are experimental and subject to change.

* Add [`etcd_snap_db_fsync_duration_seconds_count`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_snap_db_save_total_duration_seconds_bucket`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_send_success`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_send_failures`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_send_total_duration_seconds`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_receive_success`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_receive_failures`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_snapshot_receive_total_duration_seconds`](https://github.com/etcd-io/etcd/pull/9997) Prometheus metric.
* Add [`etcd_network_active_peers`](https://github.com/etcd-io/etcd/pull/9762) Prometheus metric.
  + Let's say `"7339c4e5e833c029"` server `/metrics` returns `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="729934363faa4a24"} 1` and `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="b548c2511513015"} 1`. This indicates that the local node `"7339c4e5e833c029"` currently has two active remote peers `"729934363faa4a24"` and `"b548c2511513015"` in a 3-node cluster. If the node `"b548c2511513015"` is down, the local node `"7339c4e5e833c029"` will show `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="729934363faa4a24"} 1` and `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="b548c2511513015"} 0`.
* Add [`etcd_network_disconnected_peers_total`](https://github.com/etcd-io/etcd/pull/9762) Prometheus metric.
  + If a remote peer `"b548c2511513015"` is down, the local node `"7339c4e5e833c029"` server `/metrics` would return `etcd_network_disconnected_peers_total{Local="7339c4e5e833c029",Remote="b548c2511513015"} 1`, while active peer metrics will show `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="729934363faa4a24"} 1` and `etcd_network_active_peers{Local="7339c4e5e833c029",Remote="b548c2511513015"} 0`.
* Add [`etcd_network_server_stream_failures_total`](https://github.com/etcd-io/etcd/pull/9760) Prometheus metric.
  + e.g. `etcd_network_server_stream_failures_total{API="lease-keepalive",Type="receive"} 1`
  + e.g. `etcd_network_server_stream_failures_total{API="watch",Type="receive"} 1`
* Improve [`etcd_network_peer_round_trip_time_seconds`](https://github.com/etcd-io/etcd/pull/10155) Prometheus metric to track leader heartbeats.
  + Previously, it only samples the TCP connection for snapshot messages.
* Increase [`etcd_network_peer_round_trip_time_seconds`](https://github.com/etcd-io/etcd/pull/9762) Prometheus metric histogram upper-bound.
  + Previously, highest bucket only collects requests taking 0.8192 seconds or more.
  + Now, highest buckets collect 0.8192 seconds, 1.6384 seconds, and 3.2768 seconds or more.
* Add [`etcd_server_is_leader`](https://github.com/etcd-io/etcd/pull/9587) Prometheus metric.
* Add [`etcd_server_id`](https://github.com/etcd-io/etcd/pull/9998) Prometheus metric.
* Add [`etcd_cluster_version`](https://github.com/etcd-io/etcd/pull/10257) Prometheus metric.
* Add [`etcd_server_version`](https://github.com/etcd-io/etcd/pull/8960) Prometheus metric.
  + To replace [Kubernetes `etcd-version-monitor`](https://github.com/etcd-io/etcd/issues/8948).
* Add [`etcd_server_go_version`](https://github.com/etcd-io/etcd/pull/9957) Prometheus metric.
* Add [`etcd_server_health_success`](https://github.com/etcd-io/etcd/pull/10156) Prometheus metric.
* Add [`etcd_server_health_failures`](https://github.com/etcd-io/etcd/pull/10156) Prometheus metric.
* Add [`etcd_server_read_indexes_failed_total`](https://github.com/etcd-io/etcd/pull/10094) Prometheus metric.
* Add [`etcd_server_heartbeat_send_failures_total`](https://github.com/etcd-io/etcd/pull/9761) Prometheus metric.
* Add [`etcd_server_slow_apply_total`](https://github.com/etcd-io/etcd/pull/9761) Prometheus metric.
* Add [`etcd_server_slow_read_indexes_total`](https://github.com/etcd-io/etcd/pull/9897) Prometheus metric.
* Add [`etcd_server_quota_backend_bytes`](https://github.com/etcd-io/etcd/pull/9820) Prometheus metric.
  + Use it with `etcd_mvcc_db_total_size_in_bytes` and `etcd_mvcc_db_total_size_in_use_in_bytes`.
  + `etcd_server_quota_backend_bytes 2.147483648e+09` means current quota size is 2 GB.
  + `etcd_mvcc_db_total_size_in_bytes 20480` means current physically allocated DB size is 20 KB.
  + `etcd_mvcc_db_total_size_in_use_in_bytes 16384` means future DB size if defragment operation is complete.
  + `etcd_mvcc_db_total_size_in_bytes - etcd_mvcc_db_total_size_in_use_in_bytes` is the number of bytes that can be saved on disk with defragment operation.
* Add [`etcd_mvcc_db_total_size_in_use_in_bytes`](https://github.com/etcd-io/etcd/pull/9256) Prometheus metric.
  + Use it with `etcd_mvcc_db_total_size_in_bytes` and `etcd_mvcc_db_total_size_in_use_in_bytes`.
  + `etcd_server_quota_backend_bytes 2.147483648e+09` means current quota size is 2 GB.
  + `etcd_mvcc_db_total_size_in_bytes 20480` means current physically allocated DB size is 20 KB.
  + `etcd_mvcc_db_total_size_in_use_in_bytes 16384` means future DB size if defragment operation is complete.
  + `etcd_mvcc_db_total_size_in_bytes - etcd_mvcc_db_total_size_in_use_in_bytes` is the number of bytes that can be saved on disk with defragment operation.
* Add [`etcd_mvcc_db_open_read_transactions`](https://github.com/etcd-io/etcd/pull/10523/commits/ad80752715aaed449629369687c5fd30eb1bda76) Prometheus metric.
* Add [`etcd_snap_fsync_duration_seconds`](https://github.com/etcd-io/etcd/pull/9762) Prometheus metric.
* Add [`etcd_disk_backend_defrag_duration_seconds`](https://github.com/etcd-io/etcd/pull/9761) Prometheus metric.
* Add [`etcd_mvcc_hash_duration_seconds`](https://github.com/etcd-io/etcd/pull/9761) Prometheus metric.
* Add [`etcd_mvcc_hash_rev_duration_seconds`](https://github.com/etcd-io/etcd/pull/9761) Prometheus metric.
* Add [`etcd_debugging_disk_backend_commit_rebalance_duration_seconds`](https://github.com/etcd-io/etcd/pull/9834) Prometheus metric.
* Add [`etcd_debugging_disk_backend_commit_spill_duration_seconds`](https://github.com/etcd-io/etcd/pull/9834) Prometheus metric.
* Add [`etcd_debugging_disk_backend_commit_write_duration_seconds`](https://github.com/etcd-io/etcd/pull/9834) Prometheus metric.
* Add [`etcd_debugging_lease_granted_total`](https://github.com/etcd-io/etcd/pull/9778) Prometheus metric.
* Add [`etcd_debugging_lease_revoked_total`](https://github.com/etcd-io/etcd/pull/9778) Prometheus metric.
* Add [`etcd_debugging_lease_renewed_total`](https://github.com/etcd-io/etcd/pull/9778) Prometheus metric.
* Add [`etcd_debugging_lease_ttl_total`](https://github.com/etcd-io/etcd/pull/9778) Prometheus metric.
* Add [`etcd_network_snapshot_send_inflights_total`](https://github.com/etcd-io/etcd/pull/11009) Prometheus metric.
* Add [`etcd_network_snapshot_receive_inflights_total`](https://github.com/etcd-io/etcd/pull/11009) Prometheus metric.
* Add [`etcd_server_snapshot_apply_in_progress_total`](https://github.com/etcd-io/etcd/pull/11009) Prometheus metric.
* Add [`etcd_server_is_learner`](https://github.com/etcd-io/etcd/pull/10731) Prometheus metric.
* Add [`etcd_server_learner_promote_failures`](https://github.com/etcd-io/etcd/pull/10731) Prometheus metric.
* Add [`etcd_server_learner_promote_successes`](https://github.com/etcd-io/etcd/pull/10731) Prometheus metric.
* Increase [`etcd_debugging_mvcc_index_compaction_pause_duration_milliseconds`](https://github.com/etcd-io/etcd/pull/9762) Prometheus metric histogram upper-bound.
  + Previously, highest bucket only collects requests taking 1.024 seconds or more.
  + Now, highest buckets collect 1.024 seconds, 2.048 seconds, and 4.096 seconds or more.
* Fix missing [`etcd_network_peer_sent_failures_total`](https://github.com/etcd-io/etcd/pull/9437) Prometheus metric count.
* Fix [`etcd_debugging_server_lease_expired_total`](https://github.com/etcd-io/etcd/pull/9557) Prometheus metric.
* Fix [race conditions in v2 server stat collecting](https://github.com/etcd-io/etcd/pull/9562).
* Change [gRPC proxy to expose etcd server endpoint /metrics](https://github.com/etcd-io/etcd/pull/10618).
  + The metrics that were exposed via the proxy were not etcd server members but instead the proxy itself.
* Fix bug where [db\_compaction\_total\_duration\_milliseconds metric incorrectly measured duration as 0](https://github.com/etcd-io/etcd/pull/10646).
* Deprecating `etcd_debugging_mvcc_db_total_size_in_bytes` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_db_total_size_in_bytes`](https://github.com/etcd-io/etcd/pull/9819) instead.
* Deprecating `etcd_debugging_mvcc_put_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_put_total`](https://github.com/etcd-io/etcd/pull/10962) instead.
* Deprecating `etcd_debugging_mvcc_delete_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_delete_total`](https://github.com/etcd-io/etcd/pull/10962) instead.
* Deprecating `etcd_debugging_mvcc_range_total` Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_range_total`](https://github.com/etcd-io/etcd/pull/10968) instead.
* Deprecating `etcd_debugging_mvcc_txn_total`Prometheus metric (to be removed in v3.5). Use [`etcd_mvcc_txn_total`](https://github.com/etcd-io/etcd/pull/10968) instead.

### Security, Authentication

See [security doc](https://etcd.io/docs/latest/op-guide/security/) for more details.

* Support TLS cipher suite whitelisting.
  + To block [weak cipher suites](https://github.com/etcd-io/etcd/issues/8320).
  + TLS handshake fails when client hello is requested with invalid cipher suites.
  + Add [`etcd --cipher-suites`](https://github.com/etcd-io/etcd/pull/9801) flag.
  + If empty, Go auto-populates the list.
* Add [`etcd --host-whitelist`](https://github.com/etcd-io/etcd/pull/9372) flag, [`etcdserver.Config.HostWhitelist`](https://github.com/etcd-io/etcd/pull/9372), and [`embed.Config.HostWhitelist`](https://github.com/etcd-io/etcd/pull/9372), to prevent ["DNS Rebinding"](https://en.wikipedia.org/wiki/DNS_rebinding) attack.
  + Any website can simply create an authorized DNS name, and direct DNS to `"localhost"` (or any other address). Then, all HTTP endpoints of etcd server listening on `"localhost"` becomes accessible, thus vulnerable to [DNS rebinding attacks (CVE-2018-5702)](https://bugs.chromium.org/p/project-zero/issues/detail?id=1447#c2).
  + Client origin enforce policy works as follow:
    - If client connection is secure via HTTPS, allow any hostnames..
    - If client connection is not secure and `"HostWhitelist"` is not empty, only allow HTTP requests whose Host field is listed in whitelist.
  + By default, `"HostWhitelist"` is `"*"`, which means insecure server allows all client HTTP requests.
  + Note that the client origin policy is enforced whether authentication is enabled or not, for tighter controls.
  + When specifying hostnames, loopback addresses are not added automatically. To allow loopback interfaces, add them to whitelist manually (e.g. `"localhost"`, `"127.0.0.1"`, etc.).
  + e.g. `etcd --host-whitelist example.com`, then the server will reject all HTTP requests whose Host field is not `example.com` (also rejects requests to `"localhost"`).
* Support [`etcd --cors`](https://github.com/etcd-io/etcd/pull/9490) in v3 HTTP requests (gRPC gateway).
* Support [`ttl` field for `etcd` Authentication JWT token](https://github.com/etcd-io/etcd/pull/8302).
  + e.g. `etcd --auth-token jwt,pub-key=<pub key path>,priv-key=<priv key path>,sign-method=<sign method>,ttl=5m`.
* Allow empty token provider in [`etcdserver.ServerConfig.AuthToken`](https://github.com/etcd-io/etcd/pull/9369).
* Fix [TLS reload](https://github.com/etcd-io/etcd/pull/9570) when [certificate SAN field only includes IP addresses but no domain names](https://github.com/etcd-io/etcd/issues/9541).
  + In Go, server calls `(*tls.Config).GetCertificate` for TLS reload if and only if server's `(*tls.Config).Certificates` field is not empty, or `(*tls.ClientHelloInfo).ServerName` is not empty with a valid SNI from the client. Previously, etcd always populates `(*tls.Config).Certificates` on the initial client TLS handshake, as non-empty. Thus, client was always expected to supply a matching SNI in order to pass the TLS verification and to trigger `(*tls.Config).GetCertificate` to reload TLS assets.
  + However, a certificate whose SAN field does [not include any domain names but only IP addresses](https://github.com/etcd-io/etcd/issues/9541) would request `*tls.ClientHelloInfo` with an empty `ServerName` field, thus failing to trigger the TLS reload on initial TLS handshake; this becomes a problem when expired certificates need to be replaced online.
  + Now, `(*tls.Config).Certificates` is created empty on initial TLS client handshake, first to trigger `(*tls.Config).GetCertificate`, and then to populate rest of the certificates on every new TLS connection, even when client SNI is empty (e.g. cert only includes IPs).

### etcd server

* Add [`rpctypes.ErrLeaderChanged`](https://github.com/etcd-io/etcd/pull/10094).
  + Now linearizable requests with read index would fail fast when there is a leadership change, instead of waiting until context timeout.
* Add [`etcd --initial-election-tick-advance`](https://github.com/etcd-io/etcd/pull/9591) flag to configure initial election tick fast-forward.
  + By default, `etcd --initial-election-tick-advance=true`, then local member fast-forwards election ticks to speed up "initial" leader election trigger.
  + This benefits the case of larger election ticks. For instance, cross datacenter deployment may require longer election timeout of 10-second. If true, local node does not need wait up to 10-second. Instead, forwards its election ticks to 8-second, and have only 2-second left before leader election.
  + Major assumptions are that: cluster has no active leader thus advancing ticks enables faster leader election. Or cluster already has an established leader, and rejoining follower is likely to receive heartbeats from the leader after tick advance and before election timeout.
  + However, when network from leader to rejoining follower is congested, and the follower does not receive leader heartbeat within left election ticks, disruptive election has to happen thus affecting cluster availabilities.
  + Now, this can be disabled by setting `etcd --initial-election-tick-advance=false`.
  + Disabling this would slow down initial bootstrap process for cross datacenter deployments. Make tradeoffs by configuring `etcd --initial-election-tick-advance` at the cost of slow initial bootstrap.
  + If single-node, it advances ticks regardless.
  + Address [disruptive rejoining follower node](https://github.com/etcd-io/etcd/issues/9333).
* Add [`etcd --pre-vote`](https://github.com/etcd-io/etcd/pull/9352) flag to enable to run an additional Raft election phase.
  + For instance, a flaky(or rejoining) member may drop in and out, and start campaign. This member will end up with a higher term, and ignore all incoming messages with lower term. In this case, a new leader eventually need to get elected, thus disruptive to cluster availability. Raft implements Pre-Vote phase to prevent this kind of disruptions. If enabled, Raft runs an additional phase of election to check if pre-candidate can get enough votes to win an election.
  + `etcd --pre-vote=false` by default.
  + v3.5 will enable `etcd --pre-vote=true` by default.
* Add `etcd --experimental-compaction-batch-limit` to [sets the maximum revisions deleted in each compaction batch](https://github.com/etcd-io/etcd/pull/11034).
* Reduced default compaction batch size from 10k revisions to 1k revisions to improve p99 latency during compactions and reduced wait between compactions from 100ms to 10ms.
* Add [`etcd --discovery-srv-name`](https://github.com/etcd-io/etcd/pull/8690) flag to support custom DNS SRV name with discovery.
  + If not given, etcd queries `_etcd-server-ssl._tcp.[YOUR_HOST]` and `_etcd-server._tcp.[YOUR_HOST]`.
  + If `etcd --discovery-srv-name="foo"`, then query `_etcd-server-ssl-foo._tcp.[YOUR_HOST]` and `_etcd-server-foo._tcp.[YOUR_HOST]`.
  + Useful for operating multiple etcd clusters under the same domain.
* Support TLS cipher suite whitelisting.
  + To block [weak cipher suites](https://github.com/etcd-io/etcd/issues/8320).
  + TLS handshake fails when client hello is requested with invalid cipher suites.
  + Add [`etcd --cipher-suites`](https://github.com/etcd-io/etcd/pull/9801) flag.
  + If empty, Go auto-populates the list.
* Support [`etcd --cors`](https://github.com/etcd-io/etcd/pull/9490) in v3 HTTP requests (gRPC gateway).
* Rename [`etcd --log-output` to `etcd --log-outputs`](https://github.com/etcd-io/etcd/pull/9624) to support multiple log outputs.
  + **`etcd --log-output` will be deprecated in v3.5**.
* Add [`etcd --logger`](https://github.com/etcd-io/etcd/pull/9572) flag to support [structured logger and multiple log outputs](https://github.com/etcd-io/etcd/issues/9438) in server-side.
  + **`etcd --logger=capnslog` will be deprecated in v3.5**.
  + Main motivation is to promote automated etcd monitoring, rather than looking back server logs when it starts breaking. Future development will make etcd log as few as possible, and make etcd easier to monitor with metrics and alerts.
  + `etcd --logger=capnslog --log-outputs=default` is the default setting and same as previous etcd server logging format.
  + `etcd --logger=zap --log-outputs=default` is not supported when `etcd --logger=zap`.
    - Use `etcd --logger=zap --log-outputs=stderr` instead.
    - Or, use `etcd --logger=zap --log-outputs=systemd/journal` to send logs to the local systemd journal.
    - Previously, if etcd parent process ID (PPID) is 1 (e.g. run with systemd), `etcd --logger=capnslog --log-outputs=default` redirects server logs to local systemd journal. And if write to journald fails, it writes to `os.Stderr` as a fallback.
    - However, even with PPID 1, it can fail to dial systemd journal (e.g. run embedded etcd with Docker container). Then, [every single log write will fail](https://github.com/etcd-io/etcd/pull/9729) and fall back to `os.Stderr`, which is inefficient.
    - To avoid this problem, systemd journal logging must be configured manually.
  + `etcd --logger=zap --log-outputs=stderr` will log server operations in [JSON-encoded format](https://godoc.org/go.uber.org/zap#NewProductionEncoderConfig) and writes logs to `os.Stderr`. Use this to override journald log redirects.
  + `etcd --logger=zap --log-outputs=stdout` will log server operations in [JSON-encoded format](https://godoc.org/go.uber.org/zap#NewProductionEncoderConfig) and writes logs to `os.Stdout` Use this to override journald log redirects.
  + `etcd --logger=zap --log-outputs=a.log` will log server operations in [JSON-encoded format](https://godoc.org/go.uber.org/zap#NewProductionEncoderConfig) and writes logs to the specified file `a.log`.
  + `etcd --logger=zap --log-outputs=a.log,b.log,c.log,stdout` [writes server logs to multiple files `a.log`, `b.log` and `c.log` at the same time](https://github.com/etcd-io/etcd/pull/9579) and outputs to `os.Stderr`, in [JSON-encoded format](https://godoc.org/go.uber.org/zap#NewProductionEncoderConfig).
  + `etcd --logger=zap --log-outputs=/dev/null` will discard all server logs.
* Add [`etcd --log-level`](https://github.com/etcd-io/etcd/pull/10947) flag to support log level.
  + v3.5 will deprecate `etcd --debug` flag in favor of `etcd --log-level=debug`.
* Add [`etcd --backend-batch-limit`](https://github.com/etcd-io/etcd/pull/10283) flag.
* Add [`etcd --backend-batch-interval`](https://github.com/etcd-io/etcd/pull/10283) flag.
* Fix [`mvcc` "unsynced" watcher restore operation](https://github.com/etcd-io/etcd/pull/9281).
  + "unsynced" watcher is watcher that needs to be in sync with events that have happened.
  + That is, "unsynced" watcher is the slow watcher that was requested on old revision.
  + "unsynced" watcher restore operation was not correctly populating its underlying watcher group.
  + Which possibly causes [missing events from "unsynced" watchers](https://github.com/etcd-io/etcd/issues/9086).
  + A node gets network partitioned with a watcher on a future revision, and falls behind receiving a leader snapshot after partition gets removed. When applying this snapshot, etcd watch storage moves current synced watchers to unsynced since sync watchers might have become stale during network partition. And reset synced watcher group to restart watcher routines. Previously, there was a bug when moving from synced watcher group to unsynced, thus client would miss events when the watcher was requested to the network-partitioned node.
* Fix [`mvcc` server panic from restore operation](https://github.com/etcd-io/etcd/pull/9775).
  + Let's assume that a watcher had been requested with a future revision X and sent to node A that became network-partitioned thereafter. Meanwhile, cluster makes progress. Then when the partition gets removed, the leader sends a snapshot to node A. Previously if the snapshot's latest revision is still lower than the watch revision X, **etcd server panicked** during snapshot restore operation.
  + Now, this server-side panic has been fixed.
* Fix [server panic on invalid Election Proclaim/Resign HTTP(S) requests](https://github.com/etcd-io/etcd/pull/9379).
  + Previously, wrong-formatted HTTP requests to Election API could trigger panic in etcd server.
  + e.g. `curl -L http://localhost:2379/v3/election/proclaim -X POST -d '{"value":""}'`, `curl -L http://localhost:2379/v3/election/resign -X POST -d '{"value":""}'`.
* Fix [revision-based compaction retention parsing](https://github.com/etcd-io/etcd/pull/9339).
  + Previously, `etcd --auto-compaction-mode revision --auto-compaction-retention 1` was [translated to revision retention 3600000000000](https://github.com/etcd-io/etcd/issues/9337).
  + Now, `etcd --auto-compaction-mode revision --auto-compaction-retention 1` is correctly parsed as revision retention 1.
* Prevent [overflow by large `TTL` values for `Lease` `Grant`](https://github.com/etcd-io/etcd/pull/9399).
  + `TTL` parameter to `Grant` request is unit of second.
  + Leases with too large `TTL` values exceeding `math.MaxInt64` [expire in unexpected ways](https://github.com/etcd-io/etcd/issues/9374).
  + Server now returns `rpctypes.ErrLeaseTTLTooLarge` to client, when the requested `TTL` is larger than *9,000,000,000 seconds* (which is >285 years).
  + Again, etcd `Lease` is meant for short-periodic keepalives or sessions, in the range of seconds or minutes. Not for hours or days!
* Fix [expired lease revoke](https://github.com/etcd-io/etcd/pull/10693).
  + Fix ["the key is not deleted when the bound lease expires"](https://github.com/etcd-io/etcd/issues/10686).
* Enable etcd server [`raft.Config.CheckQuorum` when starting with `ForceNewCluster`](https://github.com/etcd-io/etcd/pull/9347).
* Allow [non-WAL files in `etcd --wal-dir` directory](https://github.com/etcd-io/etcd/pull/9743).
  + Previously, existing files such as [`lost+found`](https://github.com/etcd-io/etcd/issues/7287) in WAL directory prevent etcd server boot.
  + Now, WAL directory that contains only `lost+found` or a file that's not suffixed with `.wal` is considered non-initialized.
* Fix [`ETCD_CONFIG_FILE` env variable parsing in `etcd`](https://github.com/etcd-io/etcd/pull/10762).
* Fix [race condition in `rafthttp` transport pause/resume](https://github.com/etcd-io/etcd/pull/10826).
* Fix [server crash from creating an empty role](https://github.com/etcd-io/etcd/pull/10907).
  + Previously, creating a role with an empty name crashed etcd server with an error code `Unavailable`.
  + Now, creating a role with an empty name is not allowed with an error code `InvalidArgument`.

### API

* Add `isLearner` field to `etcdserverpb.Member`, `etcdserverpb.MemberAddRequest` and `etcdserverpb.StatusResponse` as part of [raft learner implementation](https://github.com/etcd-io/etcd/pull/10725).
* Add `MemberPromote` rpc to `etcdserverpb.Cluster` interface and the corresponding `MemberPromoteRequest` and `MemberPromoteResponse` as part of [raft learner implementation](https://github.com/etcd-io/etcd/pull/10725).
* Add [`snapshot`](https://github.com/etcd-io/etcd/pull/9118) package for snapshot restore/save operations (see [`godoc.org/github.com/etcd/clientv3/snapshot`](https://godoc.org/github.com/coreos/etcd/clientv3/snapshot) for more).
* Add [`watch_id` field to `etcdserverpb.WatchCreateRequest`](https://github.com/etcd-io/etcd/pull/9065) to allow user-provided watch ID to `mvcc`.
  + Corresponding `watch_id` is returned via `etcdserverpb.WatchResponse`, if any.
* Add [`fragment` field to `etcdserverpb.WatchCreateRequest`](https://github.com/etcd-io/etcd/pull/9291) to request etcd server to [split watch events](https://github.com/etcd-io/etcd/issues/9294) when the total size of events exceeds `etcd --max-request-bytes` flag value plus gRPC-overhead 512 bytes.
  + The default server-side request bytes limit is `embed.DefaultMaxRequestBytes` which is 1.5 MiB plus gRPC-overhead 512 bytes.
  + If watch response events exceed this server-side request limit and watch request is created with `fragment` field `true`, the server will split watch events into a set of chunks, each of which is a subset of watch events below server-side request limit.
  + Useful when client-side has limited bandwidths.
  + For example, watch response contains 10 events, where each event is 1 MiB. And server `etcd --max-request-bytes` flag value is 1 MiB. Then, server will send 10 separate fragmented events to the client.
  + For example, watch response contains 5 events, where each event is 2 MiB. And server `etcd --max-recv-bytes` flag value is 1 MiB and `clientv3.Config.MaxCallRecvMsgSize` is 1 MiB. Then, server will try to send 5 separate fragmented events to the client, and the client will error with `"code = ResourceExhausted desc = grpc: received message larger than max (...)"`.
  + Client must implement fragmented watch event merge (which `clientv3` does in etcd v3.4).
* Add [`raftAppliedIndex` field to `etcdserverpb.StatusResponse`](https://github.com/etcd-io/etcd/pull/9176) for current Raft applied index.
* Add [`errors` field to `etcdserverpb.StatusResponse`](https://github.com/etcd-io/etcd/pull/9206) for server-side error.
  + e.g. `"etcdserver: no leader", "NOSPACE", "CORRUPT"`
* Add [`dbSizeInUse` field to `etcdserverpb.StatusResponse`](https://github.com/etcd-io/etcd/pull/9256) for actual DB size after compaction.
* Add [`WatchRequest.WatchProgressRequest`](https://github.com/etcd-io/etcd/pull/9869).
  + To manually trigger broadcasting watch progress event (empty watch response with latest header) to all associated watch streams.
  + Think of it as `WithProgressNotify` that can be triggered manually.

Note: **v3.5 will deprecate `etcd --log-package-levels` flag for `capnslog`**; `etcd --logger=zap --log-outputs=stderr` will the default. **v3.5 will deprecate `[CLIENT-URL]/config/local/log` endpoint.**

### Package `embed`

* Add [`embed.Config.CipherSuites`](https://github.com/etcd-io/etcd/pull/9801) to specify a list of supported cipher suites for TLS handshake between client/server and peers.
  + If empty, Go auto-populates the list.
  + Both `embed.Config.ClientTLSInfo.CipherSuites` and `embed.Config.CipherSuites` cannot be non-empty at the same time.
  + If not empty, specify either `embed.Config.ClientTLSInfo.CipherSuites` or `embed.Config.CipherSuites`.
* Add [`embed.Config.InitialElectionTickAdvance`](https://github.com/etcd-io/etcd/pull/9591) to enable/disable initial election tick fast-forward.
  + `embed.NewConfig()` would return `*embed.Config` with `InitialElectionTickAdvance` as true by default.
* Define [`embed.CompactorModePeriodic`](https://godoc.org/github.com/etcd-io/etcd/embed#pkg-variables) for `compactor.ModePeriodic`.
* Define [`embed.CompactorModeRevision`](https://godoc.org/github.com/etcd-io/etcd/embed#pkg-variables) for `compactor.ModeRevision`.
* Change [`embed.Config.CorsInfo` in `*cors.CORSInfo` type to `embed.Config.CORS` in `map[string]struct{}` type](https://github.com/etcd-io/etcd/pull/9490).
* Remove [`embed.Config.SetupLogging`](https://github.com/etcd-io/etcd/pull/9572).
  + Now logger is set up automatically based on [`embed.Config.Logger`, `embed.Config.LogOutputs`, `embed.Config.Debug` fields](https://github.com/etcd-io/etcd/pull/9572).
* Add [`embed.Config.Logger`](https://github.com/etcd-io/etcd/pull/9518) to support [structured logger `zap`](https://github.com/uber-go/zap) in server-side.
* Add [`embed.Config.LogLevel`](https://github.com/etcd-io/etcd/pull/10947).
* Rename `embed.Config.SnapCount` field to [`embed.Config.SnapshotCount`](https://github.com/etcd-io/etcd/pull/9745), to be consistent with the flag name `etcd --snapshot-count`.
* Rename [**`embed.Config.LogOutput`** to **`embed.Config.LogOutputs`**](https://github.com/etcd-io/etcd/pull/9624) to support multiple log outputs.
* Change [**`embed.Config.LogOutputs`** type from `string` to `[]string`](https://github.com/etcd-io/etcd/pull/9579) to support multiple log outputs.
* Add [`embed.Config.BackendBatchLimit`](https://github.com/etcd-io/etcd/pull/10283) field.
* Add [`embed.Config.BackendBatchInterval`](https://github.com/etcd-io/etcd/pull/10283) field.
* Make [`embed.DefaultEnableV2` `false` default](https://github.com/etcd-io/etcd/pull/10935).

### Package `pkg/adt`

* Change [`pkg/adt.IntervalTree` from `struct` to `interface`](https://github.com/etcd-io/etcd/pull/10959).
  + See [`pkg/adt` README](https://github.com/etcd-io/etcd/tree/main/pkg/adt) and [`pkg/adt` godoc](https://godoc.org/go.etcd.io/etcd/pkg/adt).
* Improve [`pkg/adt.IntervalTree` test coverage](https://github.com/etcd-io/etcd/pull/10959).
  + See [`pkg/adt` README](https://github.com/etcd-io/etcd/tree/main/pkg/adt) and [`pkg/adt` godoc](https://godoc.org/go.etcd.io/etcd/pkg/adt).
* Fix [Red-Black tree to maintain black-height property](https://github.com/etcd-io/etcd/pull/10978).
  + Previously, delete operation violates [black-height property](https://github.com/etcd-io/etcd/issues/10965).

### Package `integration`

* Add [`CLUSTER_DEBUG` to enable test cluster logging](https://github.com/etcd-io/etcd/pull/9678).
  + Deprecated `capnslog` in integration tests.

### client v3

* Add [`MemberAddAsLearner`](https://github.com/etcd-io/etcd/pull/10725) to `Clientv3.Cluster` interface. This API is used to add a learner member to etcd cluster.
* Add [`MemberPromote`](https://github.com/etcd-io/etcd/pull/10727) to `Clientv3.Cluster` interface. This API is used to promote a learner member in etcd cluster.
* Client may receive [`rpctypes.ErrLeaderChanged`](https://github.com/etcd-io/etcd/pull/10094) from server.
  + Now linearizable requests with read index would fail fast when there is a leadership change, instead of waiting until context timeout.
* Add [`WithFragment` `OpOption`](https://github.com/etcd-io/etcd/pull/9291) to support [watch events fragmentation](https://github.com/etcd-io/etcd/issues/9294) when the total size of events exceeds `etcd --max-request-bytes` flag value plus gRPC-overhead 512 bytes.
  + Watch fragmentation is disabled by default.
  + The default server-side request bytes limit is `embed.DefaultMaxRequestBytes` which is 1.5 MiB plus gRPC-overhead 512 bytes.
  + If watch response events exceed this server-side request limit and watch request is created with `fragment` field `true`, the server will split watch events into a set of chunks, each of which is a subset of watch events below server-side request limit.
  + Useful when client-side has limited bandwidths.
  + For example, watch response contains 10 events, where each event is 1 MiB. And server `etcd --max-request-bytes` flag value is 1 MiB. Then, server will send 10 separate fragmented events to the client.
  + For example, watch response contains 5 events, where each event is 2 MiB. And server `etcd --max-request-bytes` flag value is 1 MiB and `clientv3.Config.MaxCallRecvMsgSize` is 1 MiB. Then, server will try to send 5 separate fragmented events to the client, and the client will error with `"code = ResourceExhausted desc = grpc: received message larger than max (...)"`.
* Add [`Watcher.RequestProgress` method](https://github.com/etcd-io/etcd/pull/9869).
  + To manually trigger broadcasting watch progress event (empty watch response with latest header) to all associated watch streams.
  + Think of it as `WithProgressNotify` that can be triggered manually.
* Fix [lease keepalive interval updates when response queue is full](https://github.com/etcd-io/etcd/pull/9952).
  + If `<-chan *clientv3LeaseKeepAliveResponse` from `clientv3.Lease.KeepAlive` was never consumed or channel is full, client was [sending keepalive request every 500ms](https://github.com/etcd-io/etcd/issues/9911) instead of expected rate of every "TTL / 3" duration.
* Change [snapshot file permissions](https://github.com/etcd-io/etcd/pull/9977): On Linux, the snapshot file changes from readable by all (mode 0644) to readable by the user only (mode 0600).
* Client may choose to send keepalive pings to server using [`PermitWithoutStream`](https://github.com/etcd-io/etcd/pull/10146).
  + By setting `PermitWithoutStream` to true, client can send keepalive pings to server without any active streams(RPCs). In other words, it allows sending keepalive pings with unary or simple RPC calls.
  + `PermitWithoutStream` is set to false by default.
* Fix logic on [release lock key if cancelled](https://github.com/etcd-io/etcd/pull/10153) in `clientv3/concurrency` package.
* Fix [`(*Client).Endpoints()` method race condition](https://github.com/etcd-io/etcd/pull/10595).
* Deprecated [`grpc.ErrClientConnClosing`](https://github.com/etcd-io/etcd/pull/10981).
  + `clientv3` and `proxy/grpcproxy` now does not return `grpc.ErrClientConnClosing`.
  + `grpc.ErrClientConnClosing` has been [deprecated in gRPC >= 1.10](https://github.com/grpc/grpc-go/pull/1854).
  + Use `clientv3.IsConnCanceled(error)` or `google.golang.org/grpc/status.FromError(error)` instead.

### etcdctl v3

* Make [`ETCDCTL_API=3 etcdctl` default](https://github.com/etcd-io/etcd/issues/9600).
  + Now, `etcdctl set foo bar` must be `ETCDCTL_API=2 etcdctl set foo bar`.
  + Now, `ETCDCTL_API=3 etcdctl put foo bar` could be just `etcdctl put foo bar`.
* Add [`etcdctl member add --learner` and `etcdctl member promote`](https://github.com/etcd-io/etcd/pull/10725) to add and promote raft learner member in etcd cluster.
* Add [`etcdctl --password`](https://github.com/etcd-io/etcd/pull/9730) flag.
  + To support [`:` character in user name](https://github.com/etcd-io/etcd/issues/9691).
  + e.g. `etcdctl --user user --password password get foo`
* Add [`etcdctl user add --new-user-password`](https://github.com/etcd-io/etcd/pull/9730) flag.
* Add [`etcdctl check datascale`](https://github.com/etcd-io/etcd/pull/9185) command.
* Add [`etcdctl check datascale --auto-compact, --auto-defrag`](https://github.com/etcd-io/etcd/pull/9351) flags.
* Add [`etcdctl check perf --auto-compact, --auto-defrag`](https://github.com/etcd-io/etcd/pull/9330) flags.
* Add [`etcdctl defrag --cluster`](https://github.com/etcd-io/etcd/pull/9390) flag.
* Add ["raft applied index" field to `endpoint status`](https://github.com/etcd-io/etcd/pull/9176).
* Add ["errors" field to `endpoint status`](https://github.com/etcd-io/etcd/pull/9206).
* Add [`etcdctl endpoint health --write-out` support](https://github.com/etcd-io/etcd/pull/9540).
  + Previously, [`etcdctl endpoint health --write-out json` did not work](https://github.com/etcd-io/etcd/issues/9532).
* Add [missing newline in `etcdctl endpoint health`](https://github.com/etcd-io/etcd/pull/10793).
* Fix [`etcdctl watch [key] [range_end] -- [exec-command…]`](https://github.com/etcd-io/etcd/pull/9688) parsing.
  + Previously, `ETCDCTL_API=3 etcdctl watch foo -- echo watch event received` panicked.
* Fix [`etcdctl move-leader` command for TLS-enabled endpoints](https://github.com/etcd-io/etcd/pull/9807).
* Add [`progress` command to `etcdctl watch --interactive`](https://github.com/etcd-io/etcd/pull/9869).
  + To manually trigger broadcasting watch progress event (empty watch response with latest header) to all associated watch streams.
  + Think of it as `WithProgressNotify` that can be triggered manually.
* Add [timeout](https://github.com/etcd-io/etcd/pull/10301) to `etcdctl snapshot save`.
  + User can specify timeout of `etcdctl snapshot save` command using flag `--command-timeout`.
  + Fix etcdctl to [strip out insecure endpoints from DNS SRV records when using discovery](https://github.com/etcd-io/etcd/pull/10443)

### gRPC proxy

* Fix [etcd server panic from restore operation](https://github.com/etcd-io/etcd/pull/9775).
  + Let's assume that a watcher had been requested with a future revision X and sent to node A that became network-partitioned thereafter. Meanwhile, cluster makes progress. Then when the partition gets removed, the leader sends a snapshot to node A. Previously if the snapshot's latest revision is still lower than the watch revision X, **etcd server panicked** during snapshot restore operation.
  + Especially, gRPC proxy was affected, since it detects a leader loss with a key `"proxy-namespace__lostleader"` and a watch revision `"int64(math.MaxInt64 - 2)"`.
  + Now, this server-side panic has been fixed.
* Fix [memory leak in cache layer](https://github.com/etcd-io/etcd/pull/10327).
* Change [gRPC proxy to expose etcd server endpoint /metrics](https://github.com/etcd-io/etcd/pull/10618).
  + The metrics that were exposed via the proxy were not etcd server members but instead the proxy itself.

### gRPC gateway

* Replace [gRPC gateway](https://github.com/grpc-ecosystem/grpc-gateway) endpoint `/v3beta` with [`/v3`](https://github.com/etcd-io/etcd/pull/9298).
  + Deprecated [`/v3alpha`](https://github.com/etcd-io/etcd/pull/9298).
  + To deprecate [`/v3beta`](https://github.com/etcd-io/etcd/issues/9189) in v3.5.
  + In v3.4, `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` still works as a fallback to `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'`, but `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` won't work in v3.5. Use `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` instead.
* Add API endpoints [`/{v3beta,v3}/lease/leases, /{v3beta,v3}/lease/revoke, /{v3beta,v3}/lease/timetolive`](https://github.com/etcd-io/etcd/pull/9450).
  + To deprecate [`/{v3beta,v3}/kv/lease/leases, /{v3beta,v3}/kv/lease/revoke, /{v3beta,v3}/kv/lease/timetolive`](https://github.com/etcd-io/etcd/issues/9430) in v3.5.
* Support [`etcd --cors`](https://github.com/etcd-io/etcd/pull/9490) in v3 HTTP requests (gRPC gateway).

### Package `raft`

* Fix [deadlock during PreVote migration process](https://github.com/etcd-io/etcd/pull/8525).
* Add [`raft.ErrProposalDropped`](https://github.com/etcd-io/etcd/pull/9067).
  + Now [`(r *raft) Step` returns `raft.ErrProposalDropped`](https://github.com/etcd-io/etcd/pull/9137) if a proposal has been ignored.
  + e.g. a node is removed from cluster, or [`raftpb.MsgProp` arrives at current leader while there is an ongoing leadership transfer](https://github.com/etcd-io/etcd/issues/8975).
* Improve [Raft `becomeLeader` and `stepLeader`](https://github.com/etcd-io/etcd/pull/9073) by keeping track of latest `pb.EntryConfChange` index.
  + Previously record `pendingConf` boolean field scanning the entire tail of the log, which can delay heartbeat send.
* Fix [missing learner nodes on `(n *node) ApplyConfChange`](https://github.com/etcd-io/etcd/pull/9116).
* Add [`raft.Config.MaxUncommittedEntriesSize`](https://github.com/etcd-io/etcd/pull/10167) to limit the total size of the uncommitted entries in bytes.
  + Once exceeded, raft returns `raft.ErrProposalDropped` error.
  + Prevent [unbounded Raft log growth](https://github.com/cockroachdb/cockroach/issues/27772).
  + There was a bug in [PR#10167](https://github.com/etcd-io/etcd/pull/10167) but fixed via [PR#10199](https://github.com/etcd-io/etcd/pull/10199).
* Add [`raft.Ready.CommittedEntries` pagination using `raft.Config.MaxSizePerMsg`](https://github.com/etcd-io/etcd/pull/9982).
  + This prevents out-of-memory errors if the raft log has become very large and commits all at once.
  + Fix [correctness bug in CommittedEntries pagination](https://github.com/etcd-io/etcd/pull/10063).
* Optimize [message send flow control](https://github.com/etcd-io/etcd/pull/9985).
  + Leader now sends more append entries if it has more non-empty entries to send after updating flow control information.
  + Now, Raft allows multiple in-flight append messages.
* Optimize [memory allocation when boxing slice in `maybeCommit`](https://github.com/etcd-io/etcd/pull/10679).
  + By boxing a heap-allocated slice header instead of the slice header on the stack, we can avoid an allocation when passing through the sort.Interface interface.
* Avoid [memory allocation in Raft entry `String` method](https://github.com/etcd-io/etcd/pull/10680).
* Avoid [multiple memory allocations when merging stable and unstable log](https://github.com/etcd-io/etcd/pull/10684).
* Extract [progress tracking into own component](https://github.com/etcd-io/etcd/pull/10683).
  + Add [package `raft/tracker`](https://github.com/etcd-io/etcd/pull/10807).
  + Optimize [string representation of `Progress`](https://github.com/etcd-io/etcd/pull/10882).
* Make [relationship between `node` and `RawNode` explicit](https://github.com/etcd-io/etcd/pull/10803).
* Prevent [learners from becoming leader](https://github.com/etcd-io/etcd/pull/10822).
* Add [package `raft/quorum` to reason about committed indexes as well as vote outcomes for both majority and joint quorums](https://github.com/etcd-io/etcd/pull/10779).
  + Bundle [Voters and Learner into `raft/tracker.Config` struct](https://github.com/etcd-io/etcd/pull/10865).
* Use [membership sets in progress tracking](https://github.com/etcd-io/etcd/pull/10779).
* Implement [joint quorum computation](https://github.com/etcd-io/etcd/pull/10779).
* Refactor [`raft/node.go` to centralize configuration change application](https://github.com/etcd-io/etcd/pull/10865).
* Allow [voter to become learner through snapshot](https://github.com/etcd-io/etcd/pull/10864).
* Add [package `raft/confchange` to internally support joint consensus](https://github.com/etcd-io/etcd/pull/10779).
* Use [`RawNode` for node's event loop](https://github.com/etcd-io/etcd/pull/10892).
* Add [`RawNode.Bootstrap` method](https://github.com/etcd-io/etcd/pull/10892).
* Add [`raftpb.ConfChangeV2` to use joint quorums](https://github.com/etcd-io/etcd/pull/10914).
  + `raftpb.ConfChange` continues to work as today: it allows carrying out a single configuration change. A `pb.ConfChange` proposal gets added to the Raft log as such and is thus also observed by the app during Ready handling, and fed back to ApplyConfChange.
  + `raftpb.ConfChangeV2` allows joint configuration changes but will continue to carry out configuration changes in "one phase" (i.e. without ever entering a joint config) when this is possible.
  + `raftpb.ConfChangeV2` messages initiate configuration changes. They support both the simple "one at a time" membership change protocol and full Joint Consensus allowing for arbitrary changes in membership.
* Change [`raftpb.ConfState.Nodes` to `raftpb.ConfState.Voters`](https://github.com/etcd-io/etcd/pull/10914).
* Allow [learners to vote, but still learners do not count in quorum](https://github.com/etcd-io/etcd/pull/10998).
  + necessary in the situation in which a learner has been promoted (i.e. is now a voter) but has not learned about this yet.
* Fix [restoring joint consensus](https://github.com/etcd-io/etcd/pull/11003).
* Visit [`Progress` in stable order](https://github.com/etcd-io/etcd/pull/11004).
* Proactively [probe newly added followers](https://github.com/etcd-io/etcd/pull/11037).
  + The general expectation in `tracker.Progress.Next == c.LastIndex` is that the follower has no log at all (and will thus likely need a snapshot), though the app may have applied a snapshot out of band before adding the replica (thus making the first index the better choice).
  + Previously, when the leader applied a new configuration that added voters, it would not immediately probe these voters, delaying when they would be caught up.

### Package `wal`

* Add [`Verify` function to perform corruption check on WAL contents](https://github.com/etcd-io/etcd/pull/10603).
* Fix [`wal` directory cleanup on creation failures](https://github.com/etcd-io/etcd/pull/10689).

### Tooling

* Add [`etcd-dump-logs --entry-type`](https://github.com/etcd-io/etcd/pull/9628) flag to support WAL log filtering by entry type.
* Add [`etcd-dump-logs --stream-decoder`](https://github.com/etcd-io/etcd/pull/9790) flag to support custom decoder.
* Add [`SHA256SUMS`](https://github.com/etcd-io/etcd/pull/11087) file to release assets.
  + etcd maintainers are a distributed team, this change allows for releases to be cut and validation provided without requiring a signing key.

### Go

* Require [*Go 1.12+*](https://github.com/etcd-io/etcd/pull/10045).
* Compile with [*Go 1.12.9*](https://golang.org/doc/devel/release.html#go1.12) including [*Go 1.12.8*](https://groups.google.com/d/msg/golang-announce/65QixT3tcmg/DrFiG6vvCwAJ) security fixes.

### Dockerfile

* [Rebase etcd image from Alpine to Debian](https://github.com/etcd-io/etcd/pull/10805) to improve security and maintenance effort for etcd release.

---

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f69eb258_20250114_192915.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fpull%2F15656)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fpull%2F15656)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=etcd-io%2Fetcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[etcd-io](/etcd-io)
/
**[etcd](/etcd-io/etcd)**
Public

* [Notifications](/login?return_to=%2Fetcd-io%2Fetcd) You must be signed in to change notification settings
* [Fork
  9.8k](/login?return_to=%2Fetcd-io%2Fetcd)
* [Star
   48.2k](/login?return_to=%2Fetcd-io%2Fetcd)

* [Code](/etcd-io/etcd)
* [Issues
  289](/etcd-io/etcd/issues)
* [Pull requests
  134](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

Additional navigation options

* [Code](/etcd-io/etcd)
* [Issues](/etcd-io/etcd/issues)
* [Pull requests](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fetcd-io%2Fetcd%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fetcd-io%2Fetcd%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# protect LeaseTimeToLive with RBAC #15656

 Merged

[mitake](/mitake)
merged 2 commits into
[etcd-io:main](/etcd-io/etcd/tree/main "etcd-io/etcd:main")
from
[mitake:lease-timetolive-auth](/mitake/etcd/tree/lease-timetolive-auth "mitake/etcd:lease-timetolive-auth")

May 2, 2023

 Merged

# [protect LeaseTimeToLive with RBAC](#top) #15656

[mitake](/mitake)
merged 2 commits into
[etcd-io:main](/etcd-io/etcd/tree/main "etcd-io/etcd:main")
from
[mitake:lease-timetolive-auth](/mitake/etcd/tree/lease-timetolive-auth "mitake/etcd:lease-timetolive-auth")

May 2, 2023

[Conversation
15](/etcd-io/etcd/pull/15656)
[Commits
2](/etcd-io/etcd/pull/15656/commits)
[Checks
0](/etcd-io/etcd/pull/15656/checks)
[Files changed](/etcd-io/etcd/pull/15656/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![mitake](https://avatars.githubusercontent.com/u/1173955?s=60&v=4)](/mitake)

Copy link

Contributor

### @mitake **[mitake](/mitake)** commented [Apr 6, 2023](#issue-1657505519)

Please read <https://github.com/etcd-io/etcd/blob/main/CONTRIBUTING.md#contribution-flow>.

Currently, `LeaseTimeToLive()` API or `etcdctl lease timetolive` command don't require RBAC permission. However, their responses can have key names attached to the target lease. Value of the keys cannot be accessed through the API, but protecting the key name is better. So this PR let the API require read permission of keys attached to a lease (if a lease isn't attached to specific keys, behavior won't be changed).

cc [@ahrtr](https://github.com/ahrtr) [@serathius](https://github.com/serathius) [@spzala](https://github.com/spzala) [@ptabor](https://github.com/ptabor)

Sorry, something went wrong.

All reactions

 [![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
[force-pushed](/etcd-io/etcd/compare/5e6f889cb998df43c0c96a23f5f3e85e8c286946..092566fd5001154aee7db4baab87035107257b87)
the
lease-timetolive-auth

branch
from
[`5e6f889`](/etcd-io/etcd/commit/5e6f889cb998df43c0c96a23f5f3e85e8c286946) to
[`092566f`](/etcd-io/etcd/commit/092566fd5001154aee7db4baab87035107257b87)  [Compare](/etcd-io/etcd/compare/5e6f889cb998df43c0c96a23f5f3e85e8c286946..092566fd5001154aee7db4baab87035107257b87)
[April 6, 2023 14:13](#event-8946474967)

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
changed the title
~~protect LeaseTimeToLive with RBAC~~
WIP: protect LeaseTimeToLive with RBAC
[Apr 6, 2023](#event-8946547420)

 [![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
[force-pushed](/etcd-io/etcd/compare/67ba6632d7de2e697f3ab9fb3537270331efd227..009ba5d648bdb7ae816ac4845a8fb0db323325b2)
the
lease-timetolive-auth

branch
3 times, most recently
from
[`67ba663`](/etcd-io/etcd/commit/67ba6632d7de2e697f3ab9fb3537270331efd227) to
[`009ba5d`](/etcd-io/etcd/commit/009ba5d648bdb7ae816ac4845a8fb0db323325b2)  [Compare](/etcd-io/etcd/compare/67ba6632d7de2e697f3ab9fb3537270331efd227..009ba5d648bdb7ae816ac4845a8fb0db323325b2)
[April 6, 2023 23:36](#event-8950430964)

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
changed the title
~~WIP: protect LeaseTimeToLive with RBAC~~
protect LeaseTimeToLive with RBAC
[Apr 6, 2023](#event-8950488641)

[![ahrtr](https://avatars.githubusercontent.com/u/30739825?s=60&v=4)](/ahrtr)

**[ahrtr](/ahrtr)**
reviewed
[Apr 7, 2023](#pullrequestreview-1375738048)

 [View reviewed changes](/etcd-io/etcd/pull/15656/files)

[server/etcdserver/v3\_server.go](/etcd-io/etcd/pull/15656/files#diff-3f2585420cb847722e50fe1e3add0c1b6ad6dfe11e452ad3659a87c61345c898)
Outdated

Show resolved

Hide resolved

[![ahrtr](https://avatars.githubusercontent.com/u/30739825?s=60&v=4)](/ahrtr)

**[ahrtr](/ahrtr)**
reviewed
[Apr 7, 2023](#pullrequestreview-1375753338)

 [View reviewed changes](/etcd-io/etcd/pull/15656/files)

[tests/e2e/ctl\_v3\_auth\_test.go](/etcd-io/etcd/pull/15656/files#diff-7dd79c779998c2710d84e3a5375e5c7d7aae959ac2c6be8bd3d65d8d3d2c13b6)
Outdated

Show resolved

Hide resolved

 [![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
[force-pushed](/etcd-io/etcd/compare/ce757b1549154032fe3eca7b635ed53f834bf30e..f18d2578de199c3648e987e97ff4bbf941ff0f46)
the
lease-timetolive-auth

branch
4 times, most recently
from
[`ce757b1`](/etcd-io/etcd/commit/ce757b1549154032fe3eca7b635ed53f834bf30e) to
[`f18d257`](/etcd-io/etcd/commit/f18d2578de199c3648e987e97ff4bbf941ff0f46)  [Compare](/etcd-io/etcd/compare/ce757b1549154032fe3eca7b635ed53f834bf30e..f18d2578de199c3648e987e97ff4bbf941ff0f46)
[April 7, 2023 11:28](#event-8953293073)

[![@ahrtr](https://avatars.githubusercontent.com/u/30739825?s=80&u=7103d2d37664ace643337a0f648788c72132ae28&v=4)](/ahrtr)

Copy link

Member

### **[ahrtr](/ahrtr)** commented [Apr 23, 2023](#issuecomment-1519177607)

| [@mitake](https://github.com/mitake) Overall looks good to me, and sorry for the late response. Could you rebase this PR although there is no conflict? |
| --- |

All reactions

Sorry, something went wrong.

 [![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
[force-pushed](/etcd-io/etcd/compare/f18d2578de199c3648e987e97ff4bbf941ff0f46..bed84ca621d6006ef7e5dbce94d6a6e6304908e6)
the
lease-timetolive-auth

branch
from
[`f18d257`](/etcd-io/etcd/commit/f18d2578de199c3648e987e97ff4bbf941ff0f46) to
[`bed84ca`](/etcd-io/etcd/commit/bed84ca621d6006ef7e5dbce94d6a6e6304908e6)  [Compare](/etcd-io/etcd/compare/f18d2578de199c3648e987e97ff4bbf941ff0f46..bed84ca621d6006ef7e5dbce94d6a6e6304908e6)
[April 24, 2023 13:58](#event-9081800562)

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=80&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)

Copy link

Contributor

Author

### **[mitake](/mitake)** commented [Apr 24, 2023](#issuecomment-1520212950)

| [@ahrtr](https://github.com/ahrtr) thanks, rebased on the latest main, could you check? |
| --- |

All reactions

Sorry, something went wrong.

[![@serathius](https://avatars.githubusercontent.com/u/5873433?s=80&u=db75a9ad7956b6116229c5b05d20c74a5a3e1cab&v=4)](/serathius)

Copy link

Member

### **[serathius](/serathius)** commented [Apr 24, 2023](#issuecomment-1520353167)

| Can we measure the performance impact when someone has enabled auth?  I think that all other etcd methods authorization check can be done in constant time. Here we have linear to number of keys under lease. Would be good to find impact for higher number of leases. For example K8s (doesn't use auth, but just an example) has up to 1000 keys per lease. |
| --- |

All reactions

Sorry, something went wrong.

[![ahrtr](https://avatars.githubusercontent.com/u/30739825?s=60&v=4)](/ahrtr)

**[ahrtr](/ahrtr)**
reviewed
[Apr 25, 2023](#pullrequestreview-1399064461)

 [View reviewed changes](/etcd-io/etcd/pull/15656/files)

[server/etcdserver/v3\_server.go](/etcd-io/etcd/pull/15656/files#diff-3f2585420cb847722e50fe1e3add0c1b6ad6dfe11e452ad3659a87c61345c898)

Comment on lines
+333
 to
+340

|  |  | l := s.lessor.Lookup(leaseID) |
| --- | --- | --- |
|  |  | if l != nil { |
|  |  | for \_, key := range l.Keys() { |
|  |  | if err := s.AuthStore().IsRangePermitted(authInfo, []byte(key), []byte{}); err != nil { |
|  |  | return err, 0 |
|  |  | } |
|  |  | } |
|  |  | } |

Copy link

Member

### @ahrtr **[ahrtr](/ahrtr)** [Apr 25, 2023](#discussion_r1175959600)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Before iterating over all the keys, I think we also need to check [LeaseTimeToLiveRequest.Keys](https://github.com/etcd-io/etcd/blob/8c5e9ad455e05a9435dad4a1a1e52733b538e3ba/api/etcdserverpb/rpc.pb.go#L2805); if it's `false`, it means users don't want to query al the keys at all, then no need to check the permission either on the server side.

We also need to add test to cover such case, such as the client has no range permission on a key, but it intentionally set `LeaseTimeToLiveRequest.Keys` to `false`, then it should not get an error response.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @mitake **[mitake](/mitake)** [Apr 25, 2023](#discussion_r1176656505)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for your comment, I'll update tomorrow.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @mitake **[mitake](/mitake)** [Apr 26, 2023](#discussion_r1177748704)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Updated, could you check [@ahrtr](https://github.com/ahrtr) ?

Sorry, something went wrong.

All reactions

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=80&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)

Copy link

Contributor

Author

### **[mitake](/mitake)** commented [Apr 25, 2023](#issuecomment-1521948858)

| [@serathius](https://github.com/serathius) I measured overhead with [this simple benchmark](https://gist.github.com/mitake/1ec92b27655f703012ffd636b890e220) which emulates 1000 keys/lease on my local laptop (just for comparing the difference w/ and w/o the checking overhead). Result was like below (unit is microsecond):  auth enabled:   * 1st run: min: 50.000000, median: 116.000000, 99 percentile: 539.000000 * 2nd run: min: 52.000000, median: 117.000000, 99 percentile: 617.000000 * 3rd run: min: 48.000000, median: 115.000000, 99 percentile: 686.000000   auth disabled:   * 1st run: min: 49.000000, median: 111.500000, 99 percentile: 700.000000 * 2nd run: min: 47.000000, median: 112.000000, 99 percentile: 642.000000 * 3rd run: min: 48.000000, median: 111.000000, 99 percentile: 666.000000   It's a noisy environment so 99 percentile wouldn't be so informative. The workload is quite artificial (e.g. cache hit rate should be quite high) but I think overhead is low enough. What do you think? |
| --- |

All reactions

Sorry, something went wrong.

[![@serathius](https://avatars.githubusercontent.com/u/5873433?s=80&u=db75a9ad7956b6116229c5b05d20c74a5a3e1cab&v=4)](/serathius)

Copy link

Member

### **[serathius](/serathius)** commented [Apr 26, 2023](#issuecomment-1522953060)

| Looks good, for the next time I recommend looking into benchmarking <https://about.sourcegraph.com/blog/go/gophercon-2019-optimizing-go-code-without-a-blindfold> and using <https://pkg.go.dev/golang.org/x/perf/cmd/benchstat> to eliminate noisy environment and confirming that results are statistically significant. |
| --- |

All reactions

Sorry, something went wrong.

[![@serathius](https://avatars.githubusercontent.com/u/5873433?s=80&u=db75a9ad7956b6116229c5b05d20c74a5a3e1cab&v=4)](/serathius)

Copy link

Member

### **[serathius](/serathius)** commented [Apr 26, 2023](#issuecomment-1522955133)

| auth enabled:   * 1st run: min: 50.000000, median: 116.000000, 99 percentile: 539.000000 * 2nd run: min: 52.000000, median: 117.000000, 99 percentile: 617.000000 * 3rd run: min: 48.000000, median: 115.000000, 99 percentile: 686.000000   auth disabled:   * 1st run: min: 49.000000, median: 111.500000, 99 percentile: 700.000000 * 2nd run: min: 47.000000, median: 112.000000, 99 percentile: 642.000000 * 3rd run: min: 48.000000, median: 111.000000, 99 percentile: 666.000000  One observation, shouldn't we expect auth enabled take more as it one that does checks of keys? |
| --- |

All reactions

Sorry, something went wrong.

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=80&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)

Copy link

Contributor

Author

### **[mitake](/mitake)** commented [Apr 26, 2023](#issuecomment-1523238652)

| [@serathius](https://github.com/serathius) Sorry I noticed that the benchmark isn't attaching lease correctly :( I did it again and could observe overhead correctly:  auth enabled:   * 1st run: min: 583.000000, median: 705.000000, 99 percentile: 3411.000000 * 2nd run: min: 592.000000, median: 703.000000, 99 percentile: 3535.000000 * 3rd run: min: 594.000000, median: 707.000000, 99 percentile: 3659.000000   auth disabled:   * 1st run: min: 53.000000, median: 118.000000, 99 percentile: 708.000000 * 2nd run: min: 53.000000, median: 119.000000, 99 percentile: 693.000000 * 3rd run: min: 52.000000, median: 118.000000, 99 percentile: 631.000000   (checking 1000 permission in a few microseconds is clearly impossible even for high cache hit condition...)  What do you think?  Looks good, for the next time I recommend looking into benchmarking <https://about.sourcegraph.com/blog/go/gophercon-2019-optimizing-go-code-without-a-blindfold> and using <https://pkg.go.dev/golang.org/x/perf/cmd/benchstat> to eliminate noisy environment and confirming that results are statistically significant.  Thanks for sharing, I'll check these materials. |
| --- |

All reactions

Sorry, something went wrong.

 [mitake](/mitake)
and others
added 2 commits
[April 26, 2023 20:35](#commits-pushed-975854f)

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&v=4)](/mitake) [![@ahrtr](https://avatars.githubusercontent.com/u/30739825?s=40&v=4)](/ahrtr)

`[etcdserver: protect lease timetilive with auth](/etcd-io/etcd/pull/15656/commits/975854f07fba840a78f22bb80e99b2335ef5fc04 "etcdserver: protect lease timetilive with auth

Signed-off-by: Hitoshi Mitake <h.mitake@gmail.com>
Co-authored-by: Benjamin Wang <wachao@vmware.com>")`
 …

`[975854f](/etcd-io/etcd/pull/15656/commits/975854f07fba840a78f22bb80e99b2335ef5fc04)`

```
Signed-off-by: Hitoshi Mitake <h.mitake@gmail.com>
Co-authored-by: Benjamin Wang <wachao@vmware.com>
```

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&v=4)](/mitake) [![@ahrtr](https://avatars.githubusercontent.com/u/30739825?s=40&v=4)](/ahrtr)

`[tests: e2e and integration test for timetolive](/etcd-io/etcd/pull/15656/commits/c9b368119e4f807c7239f40cdd2434acd39d246d "tests: e2e and integration test for timetolive

Signed-off-by: Hitoshi Mitake <h.mitake@gmail.com>
Co-authored-by: Benjamin Wang <wachao@vmware.com>")`
 …

`[c9b3681](/etcd-io/etcd/pull/15656/commits/c9b368119e4f807c7239f40cdd2434acd39d246d)`

```
Signed-off-by: Hitoshi Mitake <h.mitake@gmail.com>
Co-authored-by: Benjamin Wang <wachao@vmware.com>
```

 [![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
[force-pushed](/etcd-io/etcd/compare/bed84ca621d6006ef7e5dbce94d6a6e6304908e6..c9b368119e4f807c7239f40cdd2434acd39d246d)
the
lease-timetolive-auth

branch
from
[`bed84ca`](/etcd-io/etcd/commit/bed84ca621d6006ef7e5dbce94d6a6e6304908e6) to
[`c9b3681`](/etcd-io/etcd/commit/c9b368119e4f807c7239f40cdd2434acd39d246d)  [Compare](/etcd-io/etcd/compare/bed84ca621d6006ef7e5dbce94d6a6e6304908e6..c9b368119e4f807c7239f40cdd2434acd39d246d)
[April 26, 2023 11:36](#event-9102515860)

[![ahrtr](https://avatars.githubusercontent.com/u/30739825?s=60&v=4)](/ahrtr)

**[ahrtr](/ahrtr)**
approved these changes
[Apr 27, 2023](#pullrequestreview-1403083937)

 [View reviewed changes](/etcd-io/etcd/pull/15656/files/c9b368119e4f807c7239f40cdd2434acd39d246d)

Copy link

Member

### @ahrtr **[ahrtr](/ahrtr)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

LGTM

Thanks [@mitake](https://github.com/mitake)

Sorry, something went wrong.

All reactions

[![spzala](https://avatars.githubusercontent.com/u/6462877?s=60&v=4)](/spzala)

**[spzala](/spzala)**
approved these changes
[Apr 30, 2023](#pullrequestreview-1407140931)

 [View reviewed changes](/etcd-io/etcd/pull/15656/files/c9b368119e4f807c7239f40cdd2434acd39d246d)

Copy link

Member

### @spzala **[spzala](/spzala)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks [@mitake](https://github.com/mitake)

Sorry, something went wrong.

All reactions

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=40&u=3a5a6b67ccee8adf2e401a76e87e5a36373663d6&v=4)](/mitake)
[mitake](/mitake)
merged commit [`49b59cc`](/etcd-io/etcd/commit/49b59cc8e5c838bdc5e661de6388a0e348b3985c)
into
etcd-io:main

[May 2, 2023](https://github.com/etcd-io/etcd/pull/15656#event-9146124251)

This was referenced May 2, 2023

[Backport 15656 to release-3.4
#15814](/etcd-io/etcd/pull/15814)
 Merged

[Backport 15656 to release-3.5
#15815](/etcd-io/etcd/pull/15815)
 Merged

[server/etcdserver: swap order of return types
#15844](/etcd-io/etcd/pull/15844)
 Merged

[![@chaochn47](https://avatars.githubusercontent.com/u/54131596?s=40&v=4)](/chaochn47)
[chaochn47](/chaochn47)
mentioned this pull request
[May 10, 2023](#ref-pullrequest-1703148590)

[migrate e2e auth tests to common #8
#15867](/etcd-io/etcd/pull/15867)
 Merged

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this pull request
[May 11, 2023](#ref-issue-1706551067)

[x/vulndb: potential Go vuln in github.com/etcd-io/etcd: CVE-2023-32082
golang/vulndb#1771](/golang/vulndb/issues/1771)

Closed

[![@apcxtest](https://avatars.githubusercontent.com/u/95427904?s=40&v=4)](/apcxtest)
[apcxtest](/apcxtest)
mentioned this pull request
[Aug 17, 2023](#ref-issue-1855700506)

[CVE-2023-32082 @ Go-go.etcd.io/etcd/server/v3-v3.5.0
apcxtest/test-repo-pub#119](/apcxtest/test-repo-pub/issues/119)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fpull%2F15656)

Reviewers

[![@ahrtr](https://avatars.githubusercontent.com/u/30739825?s=40&v=4)](/ahrtr) [ahrtr](/ahrtr)

ahrtr approved these changes

[![@spzala](https://avatars.githubusercontent.com/u/6462877?s=40&v=4)](/spzala) [spzala](/spzala)

spzala approved these changes

Assignees

No one assigned

Labels

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@mitake](https://avatars.githubusercontent.com/u/1173955?s=52&v=4)](/mitake) [![@ahrtr](https://avatars.githubusercontent.com/u/30739825?s=52&v=4)](/ahrtr) [![@serathius](https://avatars.githubusercontent.com/u/5873433?s=52&v=4)](/serathius) [![@spzala](https://avatars.githubusercontent.com/u/6462877?s=52&v=4)](/spzala)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d64d70f0_20250114_192916.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fsecurity%2Fadvisories%2FGHSA-3p4g-rcw5-8298)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fsecurity%2Fadvisories%2FGHSA-3p4g-rcw5-8298)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=etcd-io%2Fetcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[etcd-io](/etcd-io)
/
**[etcd](/etcd-io/etcd)**
Public

* [Notifications](/login?return_to=%2Fetcd-io%2Fetcd) You must be signed in to change notification settings
* [Fork
  9.8k](/login?return_to=%2Fetcd-io%2Fetcd)
* [Star
   48.2k](/login?return_to=%2Fetcd-io%2Fetcd)

* [Code](/etcd-io/etcd)
* [Issues
  289](/etcd-io/etcd/issues)
* [Pull requests
  134](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

Additional navigation options

* [Code](/etcd-io/etcd)
* [Issues](/etcd-io/etcd/issues)
* [Pull requests](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

# Key name can be accessed via LeaseTimeToLive API

Low

[mitake](/mitake)
published
GHSA-3p4g-rcw5-8298
May 11, 2023

## Package

No package listed

## Affected versions

< v3.4.26 and < v3.5.9

## Patched versions

v3.4.26 and v3.5.9

## Description

### Impact

LeaseTimeToLive API allows access to key names (not value) associated to a lease when `Keys` parameter is true, even a user doesn't have read permission to the keys. The impact is limited to a cluster which enables auth (RBAC).

### Patches

< v3.4.26 and < v3.5.9 are affected.

### Workarounds

No.

### Reporter

Yoni Rozenshein

### Severity

Low

### CVE ID

CVE-2023-32082

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dc0ae1ee_20250114_192911.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fblob%2Fmain%2FCHANGELOG%2FCHANGELOG-3.5.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fetcd-io%2Fetcd%2Fblob%2Fmain%2FCHANGELOG%2FCHANGELOG-3.5.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=etcd-io%2Fetcd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[etcd-io](/etcd-io)
/
**[etcd](/etcd-io/etcd)**
Public

* [Notifications](/login?return_to=%2Fetcd-io%2Fetcd) You must be signed in to change notification settings
* [Fork
  9.8k](/login?return_to=%2Fetcd-io%2Fetcd)
* [Star
   48.2k](/login?return_to=%2Fetcd-io%2Fetcd)

* [Code](/etcd-io/etcd)
* [Issues
  289](/etcd-io/etcd/issues)
* [Pull requests
  134](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

Additional navigation options

* [Code](/etcd-io/etcd)
* [Issues](/etcd-io/etcd/issues)
* [Pull requests](/etcd-io/etcd/pulls)
* [Discussions](/etcd-io/etcd/discussions)
* [Actions](/etcd-io/etcd/actions)
* [Security](/etcd-io/etcd/security)
* [Insights](/etcd-io/etcd/pulse)

## Files

 main
## Breadcrumbs

1. [etcd](/etcd-io/etcd/tree/main)
2. /[CHANGELOG](/etcd-io/etcd/tree/main/CHANGELOG)
/
# CHANGELOG-3.5.md

Copy path Blame  Blame
## Latest commit

## History

[History](/etcd-io/etcd/commits/main/CHANGELOG/CHANGELOG-3.5.md)669 lines (509 loc) · 48.5 KB main
## Breadcrumbs

1. [etcd](/etcd-io/etcd/tree/main)
2. /[CHANGELOG](/etcd-io/etcd/tree/main/CHANGELOG)
/
# CHANGELOG-3.5.md

Top
## File metadata and controls

* Preview
* Code
* Blame

669 lines (509 loc) · 48.5 KB[Raw](https://github.com/etcd-io/etcd/raw/refs/heads/main/CHANGELOG/CHANGELOG-3.5.md)

Previous change logs can be found at [CHANGELOG-3.4](https://github.com/etcd-io/etcd/blob/main/CHANGELOG/CHANGELOG-3.4.md).

---

## v3.5.18 (TBC)

### etcd server

* [Avoid deadlock in etcd.Close when stopping during bootstrapping](https://github.com/etcd-io/etcd/pull/19167)
* [Print warning messages if any of the deprecated v2store related flags is set](https://github.com/etcd-io/etcd/pull/18999)

### Package `clientv3`

* Fix [runtime panic that occurs when KeepAlive is called with a Context implemented by an uncomparable type](https://github.com/etcd-io/etcd/pull/18937)

### etcdutl v3

* Add [command `etcdutl check v2store` to offline check whether v2store contains custom content](https://github.com/etcd-io/etcd/pull/19113)

### etcd grpc-proxy

* Add [`tls min/max version to grpc proxy`](https://github.com/etcd-io/etcd/pull/18829) to support setting TLS min and max version.

### Dependencies

* Bump [golang-jwt/jwt to 4.5.1 to address GO-2024-3250](https://github.com/etcd-io/etcd/pull/18899).
* Compile binaries using [go 1.22.10](https://github.com/etcd-io/etcd/pull/19004).

---

## v3.5.17 (2024-11-12)

### etcd server

* Fix [watchserver related goroutine leakage](https://github.com/etcd-io/etcd/pull/18784)
* Fix [risk of a partial write txn being applied](https://github.com/etcd-io/etcd/pull/18799)
* Fix [panicking occurred due to improper error handling during defragmentation](https://github.com/etcd-io/etcd/pull/18842)
* Fix [close temp file(s) in case an error happens during defragmentation](https://github.com/etcd-io/etcd/pull/18854)

### Dependencies

* Compile binaries using [go 1.22.9](https://github.com/etcd-io/etcd/pull/18849).

---

## v3.5.16 (2024-09-10)

### etcd server

* Fix [performance regression issue caused by the `ensureLeadership` in lease renew](https://github.com/etcd-io/etcd/pull/18439).
* [Keep the tombstone during compaction if it happens to be the compaction revision](https://github.com/etcd-io/etcd/pull/18474)
* Add [`etcd --experimental-compaction-sleep-interval`](https://github.com/etcd-io/etcd/pull/18514) flag to control the sleep interval between each compaction batch.

### Dependencies

* Compile binaries using [go 1.22.7](https://github.com/etcd-io/etcd/pull/18550).
* Upgrade [bbolt to v1.3.11](https://github.com/etcd-io/etcd/pull/18489).

---

## v3.5.15 (2024-07-19)

### etcd server

* Fix [add prometheus metric registration for metric `etcd_disk_wal_write_duration_seconds`](https://github.com/etcd-io/etcd/pull/18174).
* Add [Support multiple values for allowed client and peer TLS identities](https://github.com/etcd-io/etcd/pull/18160)
* Fix [noisy logs from simple auth token expiration by reducing log level to debug](https://github.com/etcd-io/etcd/pull/18245)
* [Differentiate the warning message for rejected client and peer connections](https://github.com/etcd-io/etcd/pull/18319)

### Package clientv3

* [Print gRPC metadata in guaranteed order using the official go fmt pkg](https://github.com/etcd-io/etcd/pull/18312).

### Dependencies

* Compile binaries using [go 1.21.12](https://github.com/etcd-io/etcd/pull/18271).
* [Fully address CVE-2023-45288 and fix govulncheck CI check](https://github.com/etcd-io/etcd/pull/18170)

## v3.5.14 (2024-05-29)

### etcd server

* Fix [LeaseTimeToLive returns error if leader changed](https://github.com/etcd-io/etcd/pull/17704).
* Add [metrics `etcd_disk_wal_write_duration_seconds`](https://github.com/etcd-io/etcd/pull/17616).
* Fix [ignore raft messages if member id mismatch](https://github.com/etcd-io/etcd/pull/17813).
* Update [the compaction log when bootstrap](https://github.com/etcd-io/etcd/pull/17830).
* Fix [Revision decreasing after panic during compaction](https://github.com/etcd-io/etcd/pull/17865)
* Add [`etcd --experimental-stop-grpc-service-on-defrag`](https://github.com/etcd-io/etcd/pull/17914) to enable client failover on defrag.
* Add [support for `AllowedCN` and `AllowedHostname` through config file](https://github.com/etcd-io/etcd/pull/18063)

### etcdutl v3

* Add [`--initial-memory-map-size` to `snapshot restore` to avoid memory allocation issues](https://github.com/etcd-io/etcd/pull/17977)

### Package `clientv3`

* Add [requests retry when receiving ErrGPRCNotSupportedForLearner and endpoints > 1](https://github.com/etcd-io/etcd/pull/17641).
* Fix [initialization for mu in client context](https://github.com/etcd-io/etcd/pull/17699).

### Dependencies

* Compile binaries using [go 1.21.10](https://github.com/etcd-io/etcd/pull/17980).
* Upgrade [bbolt to v1.3.10](https://github.com/etcd-io/etcd/pull/17943).

---

## v3.5.13 (2024-03-29)

### etcd server

* Fix leases wrongly revoked by the leader by [ignoring old leader's leases revoking request](https://github.com/etcd-io/etcd/pull/17425).
* Fix [no progress notification being sent for watch that doesn't get any events](https://github.com/etcd-io/etcd/pull/17566).
* Fix [watch event loss after compaction](https://github.com/etcd-io/etcd/pull/17612).

### Package `clientv3`

* Add [client backoff and retry config options](https://github.com/etcd-io/etcd/pull/17363).
* [Ignore SetKeepAlivePeriod errors on OpenBSD](https://github.com/etcd-io/etcd/pull/17387).
* [Support unix/unixs socket in client or peer URLs](https://github.com/etcd-io/etcd/pull/15940)

### gRPC Proxy

* Add [three flags (see below) for grpc-proxy](https://github.com/etcd-io/etcd/pull/17447)
  + `--dial-keepalive-time`
  + `--dial-keepalive-timeout`
  + `--permit-without-stream`

### Dependencies

* Upgrade [bbolt to v1.3.9](https://github.com/etcd-io/etcd/pull/17483).
* Compile binaries using [go 1.21.8](https://github.com/etcd-io/etcd/pull/17537).
* Upgrade [google.golang.org/protobuf to v1.33.0 to address CVE-2024-24786](https://github.com/etcd-io/etcd/pull/17553).
* Upgrade github.com/sirupsen/logrus to v1.9.3 to address [PRISMA-2023-0056](https://github.com/etcd-io/etcd/pull/17482).

### Others

* [Make CGO\_ENABLED configurable](https://github.com/etcd-io/etcd/pull/17421).

---

## v3.5.12 (2024-01-31)

### etcd server

* Fix [not validating database consistent index, and panicking on nil backend](https://github.com/etcd-io/etcd/pull/17151)
* Document [`experimental-enable-lease-checkpoint-persist` flag in etcd help](https://github.com/etcd-io/etcd/pull/17190)
* Fix [needlessly flocking snapshot files when deleting](https://github.com/etcd-io/etcd/pull/17206)
* Add [digest for etcd base image](https://github.com/etcd-io/etcd/pull/17205)
* Fix [delete inconsistencies in read buffer](https://github.com/etcd-io/etcd/pull/17230)
* Add [mvcc: print backend database size and size in use in compaction logs](https://github.com/etcd-io/etcd/pull/17291)

### Dependencies

* Compile binaries using [go 1.20.13](https://github.com/etcd-io/etcd/pull/17275)
* Upgrade [golang.org/x/crypto to v0.17+ to address CVE-2023-48795](https://github.com/etcd-io/etcd/pull/17346)

## v3.5.11 (2023-12-07)

### etcd server

* Fix distributed tracing by ensuring `--experimental-distributed-tracing-sampling-rate` configuration option is available to [set tracing sample rate](https://github.com/etcd-io/etcd/pull/16951).
* Fix [url redirects while checking peer urls during new member addition](https://github.com/etcd-io/etcd/pull/16986)
* Add [livez/readyz HTTP endpoints](https://github.com/etcd-io/etcd/pull/17039)

### Dependencies

* Compile binaries using [go 1.20.12](https://github.com/etcd-io/etcd/pull/17077)
* Fix [CVE-2023-47108](https://github.com/advisories/GHSA-8pgv-569h-w5rw) by [bumping go.opentelemetry.io/otel to 1.20.0 and go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc to 0.46.0](https://github.com/etcd-io/etcd/pull/16946).

---

## v3.5.10 (2023-10-27)

### etcd server

* Fix [`--socket-reuse-port` and `--socket-reuse-address` not able to be set in configuration file](https://github.com/etcd-io/etcd/pull/16435).
* Fix [corruption check may get a `ErrCompacted` error when server has just been compacted](https://github.com/etcd-io/etcd/pull/16048)
* Improve [Lease put performance for the case that auth is disabled or the user is admin](https://github.com/etcd-io/etcd/pull/16019)
* Improve [Skip getting authInfo from incoming context when auth is disabled](https://github.com/etcd-io/etcd/pull/16241)
* Fix [Hash and HashKV have duplicated RESTful API](https://github.com/etcd-io/etcd/pull/16490)

### etcdutl v3

* Add [optional --bump-revision and --mark-compacted flag to etcdutl snapshot restore operation](https://github.com/etcd-io/etcd/pull/16165).

### etcdctl v3

* Add [optional --bump-revision and --mark-compacted flag to etcdctl snapshot restore operation](https://github.com/etcd-io/etcd/pull/16165).

### etcd grpc-proxy

* Fix [Memberlist results not updated when proxy node down](https://github.com/etcd-io/etcd/pull/15907).

### Package `clientv3`

* Fix [Multiple endpoints with same prefix got mixed up](https://github.com/etcd-io/etcd/pull/15939)
* Fix [Unexpected blocking when barrier waits on a nonexistent key](https://github.com/etcd-io/etcd/pull/16188)
* Fix [Reset auth token when failing to authenticate due to auth being disabled](https://github.com/etcd-io/etcd/pull/16241)
* Fix [panic in etcd validate secure endpoints](https://github.com/etcd-io/etcd/pull/16565)

### Dependencies

* Compile binaries using [go 1.20.10](https://github.com/etcd-io/etcd/pull/16745).
* Upgrade gRPC to 1.58.3 in [#16625](https://github.com/etcd-io/etcd/pull/16625), [#16781](https://github.com/etcd-io/etcd/pull/16781) and [#16790](https://github.com/etcd-io/etcd/pull/16790). Note that gRPC server will reject requests with connection header (refer to [grpc/grpc-go#4803](https://github.com/grpc/grpc-go/pull/4803)).
* Upgrade [bbolt to v1.3.8](https://github.com/etcd-io/etcd/pull/16833)

---

## v3.5.9 (2023-05-11)

### etcd server

* Fix [LeaseTimeToLive API may return keys to clients which have no read permission on the keys](https://github.com/etcd-io/etcd/pull/15815).

### Dependencies

* Compile binaries using [go 1.19.9](https://github.com/etcd-io/etcd/pull/15822).

---

## v3.5.8 (2023-04-13)

### etcd server

* Add [`etcd --tls-min-version --tls-max-version`](https://github.com/etcd-io/etcd/pull/15483) to enable support for TLS 1.3.
* Add [`etcd --listen-client-http-urls`](https://github.com/etcd-io/etcd/pull/15589) flag to support separating http server from grpc one, thus giving full immunity to [watch stream starvation under high read load](https://github.com/etcd-io/etcd/issues/15402).
* Change [http2 frame scheduler to random algorithm](https://github.com/etcd-io/etcd/pull/15452)
* Fix [Watch response traveling back in time when reconnecting member downloads snapshot from the leader](https://github.com/etcd-io/etcd/pull/15515)
* Fix [race when starting both secure & insecure gRPC servers on the same address](https://github.com/etcd-io/etcd/pull/15517)
* Fix [server/auth: disallow creating empty permission ranges](https://github.com/etcd-io/etcd/pull/15619)
* Fix [aligning zap log timestamp resolution to microseconds](https://github.com/etcd-io/etcd/pull/15240). Etcd now uses zap timestamp format: `2006-01-02T15:04:05.999999Z0700` (microsecond instead of milliseconds precision).
* Fix [wsproxy did not print log in JSON format](https://github.com/etcd-io/etcd/pull/15661).
* Fix [CVE-2021-28235](https://nvd.nist.gov/vuln/detail/CVE-2021-28235) by [clearing password after authenticating the user](https://github.com/etcd-io/etcd/pull/15653).
* Fix [etcdserver may panic when parsing a JWT token without username or revision](https://github.com/etcd-io/etcd/pull/15676).
* Fix [Requested watcher progress notifications are not synchronised with stream](https://github.com/etcd-io/etcd/pull/15695).

### Package `netutil`

* Fix [consistently format IPv6 addresses for comparison](https://github.com/etcd-io/etcd/pull/15187).

### Package `clientv3`

* Fix [etcd might send duplicated events to watch clients](https://github.com/etcd-io/etcd/pull/15274).

### Dependencies

* Recommend [Go 1.19+](https://github.com/etcd-io/etcd/pull/15337).
* Compile binaries using [go to 1.19.8](https://github.com/etcd-io/etcd/pull/15651)
* Upgrade [golang.org/x/net to v0.7.0](https://github.com/etcd-io/etcd/pull/15337)
* Upgrade [bbolt to v1.3.7](https://github.com/etcd-io/etcd/pull/15222).

### Docker image

* [Remove nsswitch.conf from docker image](https://github.com/etcd-io/etcd/pull/15161)
* Fix [etcd docker images all tagged with amd64 architecture](https://github.com/etcd-io/etcd/pull/15612)

---

## v3.5.7 (2023-01-20)

### etcd server

* Fix [Remove memberID from data corrupt alarm](https://github.com/etcd-io/etcd/pull/14852).
* Fix [Allow non mutating requests pass through quotaKVServer when NOSPACE](https://github.com/etcd-io/etcd/pull/14884).
* Fix [nil pointer panic for readonly txn due to nil response](https://github.com/etcd-io/etcd/pull/14899).
* Fix [The last record which was partially synced to disk isn't automatically repaired](https://github.com/etcd-io/etcd/pull/15069).
* Fix [etcdserver might promote a non-started learner](https://github.com/etcd-io/etcd/pull/15096).

### Package `clientv3`

* Reverted the fix to [auth invalid token and old revision errors in watch](https://github.com/etcd-io/etcd/pull/14995).

### Dependencies

* Recommend [Go 1.17+](https://github.com/etcd-io/etcd/pull/15019).
* Compile binaries using [Go 1.17.13](https://github.com/etcd-io/etcd/pull/15019)
* Bumped [some dependencies](https://github.com/etcd-io/etcd/pull/15018) to address some HIGH Vulnerabilities.

### Docker image

* Use [distroless base image](https://github.com/etcd-io/etcd/pull/15016) to address critical Vulnerabilities.
* Updated [base image from base-debian11 to static-debian11 and removed dependency on busybox](https://github.com/etcd-io/etcd/pull/15037).

---

## v3.5.6 (2022-11-21)

### etcd server

* Fix [auth invalid token and old revision errors in watch](https://github.com/etcd-io/etcd/pull/14547)
* Fix [avoid closing a watch with ID 0 incorrectly](https://github.com/etcd-io/etcd/pull/14563)
* Fix [auth: fix data consistency issue caused by recovery from snapshot](https://github.com/etcd-io/etcd/pull/14648)
* Fix [revision might be inconsistency between members when etcd crashes during processing defragmentation operation](https://github.com/etcd-io/etcd/pull/14733)
* Fix [timestamp in inconsistent format](https://github.com/etcd-io/etcd/pull/14799)
* Fix [Failed resolving host due to lost DNS record](https://github.com/etcd-io/etcd/pull/14573)

### Package `clientv3`

* Fix [Add backoff before retry when watch stream returns unavailable](https://github.com/etcd-io/etcd/pull/14582).
* Fix [stack overflow error in double barrier](https://github.com/etcd-io/etcd/pull/14658)
* Fix [Refreshing token on CommonName based authentication causes segmentation violation in client](https://github.com/etcd-io/etcd/pull/14790).

### etcd grpc-proxy

* Add [`etcd grpc-proxy start --listen-cipher-suites`](https://github.com/etcd-io/etcd/pull/14500) flag to support adding configurable cipher list.

---

## v3.5.5 (2022-09-15)

### Deprecations

* Deprecated [SetKeepAlive and SetKeepAlivePeriod in limitListenerConn](https://github.com/etcd-io/etcd/pull/14366).

### Package `clientv3`

* Fix [do not overwrite authTokenBundle on dial](https://github.com/etcd-io/etcd/pull/14132).
* Fix [IsOptsWithPrefix returns false even if WithPrefix() is included](https://github.com/etcd-io/etcd/pull/14187).

### etcd server

* [Build official darwin/arm64 artifacts](https://github.com/etcd-io/etcd/pull/14436).
* Add [`etcd --max-concurrent-streams`](https://github.com/etcd-io/etcd/pull/14219) flag to configure the max concurrent streams each client can open at a time, and defaults to math.MaxUint32.
* Add [`etcd --experimental-compact-hash-check-enabled --experimental-compact-hash-check-time`](https://github.com/etcd-io/etcd/issues/14039) flags to support enabling reliable corruption detection on compacted revisions.
* Fix [unexpected error during txn](https://github.com/etcd-io/etcd/issues/14110).
* Fix [lease leak issue due to tokenProvider isn't enabled when restoring auth store from a snapshot](https://github.com/etcd-io/etcd/pull/13205).
* Fix [the race condition between goroutine and channel on the same leases to be revoked](https://github.com/etcd-io/etcd/pull/14087).
* Fix [lessor may continue to schedule checkpoint after stepping down leader role](https://github.com/etcd-io/etcd/pull/14087).
* Fix [Restrict the max size of each WAL entry to the remaining size of the WAL file](https://github.com/etcd-io/etcd/pull/14127).
* Fix [Protect rangePermCache with a RW lock correctly](https://github.com/etcd-io/etcd/pull/14227)
* Fix [memberID equals zero in corruption alarm](https://github.com/etcd-io/etcd/pull/14272)
* Fix [Durability API guarantee broken in single node cluster](https://github.com/etcd-io/etcd/pull/14424)
* Fix [etcd fails to start after performing alarm list operation and then power off/on](https://github.com/etcd-io/etcd/pull/14429)
* Fix [authentication data not loaded on member startup](https://github.com/etcd-io/etcd/pull/14409)

### etcdctl v3

* Fix [etcdctl move-leader may fail for multiple endpoints](https://github.com/etcd-io/etcd/pull/14434)

### Other

* [Bump golang.org/x/crypto to latest version](https://github.com/etcd-io/etcd/pull/13996) to address [CVE-2022-27191](https://github.com/advisories/GHSA-8c26-wmh5-6g9v).
* [Bump OpenTelemetry to 1.0.1 and gRPC to 1.41.0](https://github.com/etcd-io/etcd/pull/14312).

---

## v3.5.4 (2022-04-24)

### etcd server

* Fix [etcd panic on startup (auth enabled)](https://github.com/etcd-io/etcd/pull/13946)

### package `client/pkg/v3`

* [Revert the change of trimming the trailing dot from SRV.Target](https://github.com/etcd-io/etcd/pull/13950) returned by DNS lookup

---

## v3.5.3 (2022-04-13)

### etcd server

* Fix [Provide a better liveness probe for when etcd runs as a Kubernetes pod](https://github.com/etcd-io/etcd/pull/13706)
* Fix [inconsistent log format](https://github.com/etcd-io/etcd/pull/13864)
* Fix [Inconsistent revision and data occurs](https://github.com/etcd-io/etcd/pull/13908)
* Fix [Etcdserver is still in progress of processing LeaseGrantRequest when it receives a LeaseKeepAliveRequest on the same leaseID](https://github.com/etcd-io/etcd/pull/13932)
* Fix [consistent\_index coming from snapshot is overwritten by the old local value](https://github.com/etcd-io/etcd/pull/13933)
* [Update container base image snapshot](https://github.com/etcd-io/etcd/pull/13862)
* Fix [Defrag unsets backend options](https://github.com/etcd-io/etcd/pull/13701).

### package `client/pkg/v3`

* [Trim the suffix dot from the target](https://github.com/etcd-io/etcd/pull/13714) in SRV records returned by DNS lookup

### etcdctl v3

* [Always print the raft\_term in decimal](https://github.com/etcd-io/etcd/pull/13727) when displaying member list in json.

---

## [v3.5.2](https://github.com/etcd-io/etcd/releases/tag/v3.5.2) (2022-02-01)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.5.1...v3.5.2) and [v3.5 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_5/) for any breaking changes.

### etcd server

* Fix [exclude the same alarm type activated by multiple peers](https://github.com/etcd-io/etcd/pull/13476).
* Add [`etcd --experimental-enable-lease-checkpoint-persist`](https://github.com/etcd-io/etcd/pull/13508) flag to enable checkpoint persisting.
* Fix [Lease checkpoints don't prevent to reset ttl on leader change](https://github.com/etcd-io/etcd/pull/13508), requires enabling checkpoint persisting.
* Fix [assertion failed due to tx closed when recovering v3 backend from a snapshot db](https://github.com/etcd-io/etcd/pull/13501)
* Fix [segmentation violation(SIGSEGV) error due to premature unlocking of watchableStore](https://github.com/etcd-io/etcd/pull/13541)

---

## [v3.5.1](https://github.com/etcd-io/etcd/releases/tag/v3.5.1) (2021-10-15)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0...v3.5.1) and [v3.5 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_5/) for any breaking changes.

### etcd server

* Fix [self-signed-cert-validity parameter cannot be specified in the config file](https://github.com/etcd-io/etcd/pull/13237).
* Fix [ensure that cluster members stored in v2store and backend are in sync](https://github.com/etcd-io/etcd/pull/13348)

### etcd client

* [Fix etcd client sends invalid :authority header](https://github.com/etcd-io/etcd/issues/13192)

### package clientv3

* Endpoints self identify now as `etcd-endpoints://{id}/{authority}` where authority is based on first endpoint passed, for example `etcd-endpoints://0xc0009d8540/localhost:2079`

### Other

* Updated [base image](https://github.com/etcd-io/etcd/pull/13386) from `debian:buster-v1.4.0` to `debian:bullseye-20210927` to fix the following critical CVEs:
  + [CVE-2021-3711](https://nvd.nist.gov/vuln/detail/CVE-2021-3711): miscalculation of a buffer size in openssl's SM2 decryption
  + [CVE-2021-35942](https://nvd.nist.gov/vuln/detail/CVE-2021-35942): integer overflow flaw in glibc
  + [CVE-2019-9893](https://nvd.nist.gov/vuln/detail/CVE-2019-9893): incorrect syscall argument generation in libseccomp
  + [CVE-2021-36159](https://nvd.nist.gov/vuln/detail/CVE-2021-36159): libfetch in apk-tools mishandles numeric strings in FTP and HTTP protocols to allow out of bound reads.

---

## v3.5.0 (2021-06)

See [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0...v3.5.0) and [v3.5 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_5/) for any breaking changes.

* [v3.5.0](https://github.com/etcd-io/etcd/releases/tag/v3.5.0) (2021 TBD), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-rc.1...v3.5.0).
* [v3.5.0-rc.1](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-rc.1) (2021-06-10), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-rc.0...v3.5.0-rc.1).
* [v3.5.0-rc.0](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-rc.0) (2021-06-04), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-beta.4...v3.5.0-rc.0).
* [v3.5.0-beta.4](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-beta.4) (2021-05-26), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-beta.3...v3.5.0-beta.4).
* [v3.5.0-beta.3](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-beta.3) (2021-05-18), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-beta.2...v3.5.0-beta.3).
* [v3.5.0-beta.2](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-beta.2) (2021-05-18), see [code changes](https://github.com/etcd-io/etcd/compare/v3.5.0-beta.1...v3.5.0-beta.2).
* [v3.5.0-beta.1](https://github.com/etcd-io/etcd/releases/tag/v3.5.0-beta.1) (2021-05-18), see [code changes](https://github.com/etcd-io/etcd/compare/v3.4.0...v3.5.0-beta.1).

**Again, before running upgrades from any previous release, please make sure to read change logs below and [v3.5 upgrade guide](https://etcd.io/docs/latest/upgrades/upgrade_3_5/).**

### Breaking Changes

* `go.etcd.io/etcd` Go packages have moved to `go.etcd.io/etcd/{api,pkg,raft,client,etcdctl,server,raft,tests}/v3` to follow the [Go modules](https://github.com/golang/go/wiki/Modules) conventions
* `go.etcd.io/clientv3/snapshot` SnapshotManager class have moved to `go.etcd.io/clientv3/etcdctl`.
  The method `snapshot.Save` to download a snapshot from the remote server was preserved in 'go.etcd.io/clientv3/snapshot`.
* `go.etcd.io/client' package got migrated to 'go.etcd.io/client/v2'.
* Changed behavior of clientv3 API [MemberList](https://github.com/etcd-io/etcd/pull/11639).
  + Previously, it is directly served with server's local data, which could be stale.
  + Now, it is served with linearizable guarantee. If the server is disconnected from quorum, `MemberList` call will fail.
* [gRPC gateway](https://github.com/grpc-ecosystem/grpc-gateway) only supports [`/v3`](/etcd-io/etcd/blob/main/CHANGELOG/TODO) endpoint.
  + Deprecated [`/v3beta`](https://github.com/etcd-io/etcd/pull/9298).
  + `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` doesn't work in v3.5. Use `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` instead.
* **`etcd --experimental-enable-v2v3` flag remains experimental and to be deprecated.**
  + v2 storage emulation feature will be deprecated in the next release.
  + etcd 3.5 is the last version that supports V2 API. Flags `--enable-v2` and `--experimental-enable-v2v3` [are now deprecated](https://github.com/etcd-io/etcd/pull/12940) and will be removed in etcd v3.6 release.
* **`etcd --experimental-backend-bbolt-freelist-type` flag has been deprecated.** Use **`etcd --backend-bbolt-freelist-type`** instead. The default type is hashmap and it is stable now.
* **`etcd --debug` flag has been deprecated.** Use **`etcd --log-level=debug`** instead.
* Remove [`embed.Config.Debug`](https://github.com/etcd-io/etcd/pull/10947).
* **`etcd --log-output` flag has been deprecated.** Use **`etcd --log-outputs`** instead.
* **`etcd --logger=zap --log-outputs=stderr`** is now the default.
* **`etcd --logger=capnslog` flag value has been deprecated.**
* **`etcd --logger=zap --log-outputs=default` flag value is not supported.**.
  + Use `etcd --logger=zap --log-outputs=stderr`.
  + Or, use `etcd --logger=zap --log-outputs=systemd/journal` to send logs to the local systemd journal.
  + Previously, if etcd parent process ID (PPID) is 1 (e.g. run with systemd), `etcd --logger=capnslog --log-outputs=default` redirects server logs to local systemd journal. And if write to journald fails, it writes to `os.Stderr` as a fallback.
  + However, even with PPID 1, it can fail to dial systemd journal (e.g. run embedded etcd with Docker container). Then, [every single log write will fail](https://github.com/etcd-io/etcd/pull/9729) and fall back to `os.Stderr`, which is inefficient.
  + To avoid this problem, systemd journal logging must be configured manually.
* **`etcd --log-outputs=stderr`** is now the default.
* **`etcd --log-package-levels` flag for `capnslog` has been deprecated.** Now, **`etcd --logger=zap --log-outputs=stderr`** is the default.
* **`[CLIENT-URL]/config/local/log` endpoint has been deprecated, as is `etcd --log-package-levels` flag.**
  + `curl http://127.0.0.1:2379/config/local/log -XPUT -d '{"Level":"DEBUG"}'` won't work.
  + Please use `etcd --logger=zap --log-outputs=stderr` instead.
* Deprecated `etcd_debugging_mvcc_db_total_size_in_bytes` Prometheus metric. Use `etcd_mvcc_db_total_size_in_bytes` instead.
* Deprecated `etcd_debugging_mvcc_put_total` Prometheus metric. Use `etcd_mvcc_put_total` instead.
* Deprecated `etcd_debugging_mvcc_delete_total` Prometheus metric. Use `etcd_mvcc_delete_total` instead.
* Deprecated `etcd_debugging_mvcc_txn_total` Prometheus metric. Use `etcd_mvcc_txn_total` instead.
* Deprecated `etcd_debugging_mvcc_range_total` Prometheus metric. Use `etcd_mvcc_range_total` instead.
* Main branch `/version` outputs `3.5.0-pre`, instead of `3.4.0+git`.
* Changed `proxy` package function signature to [support structured logger](https://github.com/etcd-io/etcd/pull/11614).
  + Previously, `NewClusterProxy(c *clientv3.Client, advaddr string, prefix string) (pb.ClusterServer, <-chan struct{})`, now `NewClusterProxy(lg *zap.Logger, c *clientv3.Client, advaddr string, prefix string) (pb.ClusterServer, <-chan struct{})`.
  + Previously, `Register(c *clientv3.Client, prefix string, addr string, ttl int)`, now `Register(lg *zap.Logger, c *clientv3.Client, prefix string, addr string, ttl int) <-chan struct{}`.
  + Previously, `NewHandler(t *http.Transport, urlsFunc GetProxyURLs, failureWait time.Duration, refreshInterval time.Duration) http.Handler`, now `NewHandler(lg *zap.Logger, t *http.Transport, urlsFunc GetProxyURLs, failureWait time.Duration, refreshInterval time.Duration) http.Handler`.
* Changed `pkg/flags` function signature to [support structured logger](https://github.com/etcd-io/etcd/pull/11616).
  + Previously, `SetFlagsFromEnv(prefix string, fs *flag.FlagSet) error`, now `SetFlagsFromEnv(lg *zap.Logger, prefix string, fs *flag.FlagSet) error`.
  + Previously, `SetPflagsFromEnv(prefix string, fs *pflag.FlagSet) error`, now `SetPflagsFromEnv(lg *zap.Logger, prefix string, fs *pflag.FlagSet) error`.
* ClientV3 supports [grpc resolver API](https://github.com/etcd-io/etcd/blob/main/client/v3/naming/resolver/resolver.go).
  + Endpoints can be managed using [endpoints.Manager](https://github.com/etcd-io/etcd/blob/main/client/v3/naming/endpoints/endpoints.go)
  + Previously supported [GRPCResolver was decomissioned](https://github.com/etcd-io/etcd/pull/12675). Use [resolver](https://github.com/etcd-io/etcd/blob/main/client/v3/naming/resolver/resolver.go) instead.
* Turned on [--pre-vote by default](https://github.com/etcd-io/etcd/pull/12770). Should prevent disrupting RAFT leader by an individual member.
* [ETCD\_CLIENT\_DEBUG env](https://github.com/etcd-io/etcd/pull/12786): Now supports log levels (debug, info, warn, error, dpanic, panic, fatal). Only when set, overrides application-wide grpc logging settings.
* [Embed Etcd.Close()](https://github.com/etcd-io/etcd/pull/12828) needs to called exactly once and closes Etcd.Err() stream.
* [Embed Etcd does not override global/grpc logger](https://github.com/etcd-io/etcd/pull/12861) be default any longer. If desired, please call `embed.Config::SetupGlobalLoggers()` explicitly.
* [Embed Etcd custom logger should be configured using simpler builder `NewZapLoggerBuilder`](https://github.com/etcd-io/etcd/pull/12973).
* Client errors of `context cancelled` or `context deadline exceeded` are exposed as `codes.Canceled` and `codes.DeadlineExceeded`, instead of `codes.Unknown`.

### Storage format changes

* [WAL log's snapshots persists raftpb.ConfState](https://github.com/etcd-io/etcd/pull/12735)
* [Backend persists raftpb.ConfState](https://github.com/etcd-io/etcd/pull/12962) in the `meta` bucket `confState` key.
* [Backend persists applied term](https://github.com/etcd-io/etcd/pull/) in the `meta` bucket.
* Backend persists `downgrade` in the `cluster` bucket

### Security

* Add [`TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256` and `TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256` to `etcd --cipher-suites`](https://github.com/etcd-io/etcd/pull/11864).
* Changed [the format of WAL entries related to auth for not keeping password as a plain text](https://github.com/etcd-io/etcd/pull/11943).
* Add third party [Security Audit Report](https://github.com/etcd-io/etcd/pull/12201).
* A [log warning](https://github.com/etcd-io/etcd/pull/12242) is added when etcd uses any existing directory that has a permission different than 700 on Linux and 777 on Windows.
* Add optional [`ClientCertFile` and `ClientKeyFile`](https://github.com/etcd-io/etcd/pull/12705) options for peer and client tls configuration when split certificates are used.

### Metrics, Monitoring

See [List of metrics](https://etcd.io/docs/latest/metrics/) for all metrics per release.

Note that any `etcd_debugging_*` metrics are experimental and subject to change.

* Deprecated `etcd_debugging_mvcc_db_total_size_in_bytes` Prometheus metric. Use `etcd_mvcc_db_total_size_in_bytes` instead.
* Deprecated `etcd_debugging_mvcc_put_total` Prometheus metric. Use `etcd_mvcc_put_total` instead.
* Deprecated `etcd_debugging_mvcc_delete_total` Prometheus metric. Use `etcd_mvcc_delete_total` instead.
* Deprecated `etcd_debugging_mvcc_txn_total` Prometheus metric. Use `etcd_mvcc_txn_total` instead.
* Deprecated `etcd_debugging_mvcc_range_total` Prometheus metric. Use `etcd_mvcc_range_total` instead.
* Add [`etcd_debugging_mvcc_current_revision`](https://github.com/etcd-io/etcd/pull/11126) Prometheus metric.
* Add [`etcd_debugging_mvcc_compact_revision`](https://github.com/etcd-io/etcd/pull/11126) Prometheus metric.
* Change [`etcd_cluster_version`](https://github.com/etcd-io/etcd/pull/11254) Prometheus metrics to include only major and minor version.
* Add [`etcd_debugging_mvcc_total_put_size_in_bytes`](https://github.com/etcd-io/etcd/pull/11374) Prometheus metric.
* Add [`etcd_server_client_requests_total` with `"type"` and `"client_api_version"` labels](https://github.com/etcd-io/etcd/pull/11687).
* Add [`etcd_wal_write_bytes_total`](https://github.com/etcd-io/etcd/pull/11738).
* Add [`etcd_debugging_auth_revision`](https://github.com/etcd-io/etcd/commit/f14d2a087f7b0fd6f7980b95b5e0b945109c95f3).
* Add [`os_fd_used` and `os_fd_limit` to monitor current OS file descriptors](https://github.com/etcd-io/etcd/pull/12214).
* Add [`etcd_disk_defrag_inflight`](https://github.com/etcd-io/etcd/pull/13395).

### etcd server

* Add [don't attempt to grant nil permission to a role](https://github.com/etcd-io/etcd/pull/13086).
* Add [don't activate alarms w/missing AlarmType](https://github.com/etcd-io/etcd/pull/13084).
* Add [`TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256` and `TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256` to `etcd --cipher-suites`](https://github.com/etcd-io/etcd/pull/11864).
* Automatically [create parent directory if it does not exist](https://github.com/etcd-io/etcd/pull/9626) (fix [issue#9609](https://github.com/etcd-io/etcd/issues/9609)).
* v4.0 will configure `etcd --enable-v2=true --enable-v2v3=/aaa` to enable v2 API server that is backed by **v3 storage**.
* [`etcd --backend-bbolt-freelist-type`] flag is now stable.
  + `etcd --experimental-backend-bbolt-freelist-type` has been deprecated.
* Support [downgrade API](https://github.com/etcd-io/etcd/pull/11715).
* Deprecate v2 apply on cluster version. [Use v3 request to set cluster version and recover cluster version from v3 backend](https://github.com/etcd-io/etcd/pull/11427).
* [Use v2 api to update cluster version to support mixed version cluster during upgrade](https://github.com/etcd-io/etcd/pull/12988).
* [Fix corruption bug in defrag](https://github.com/etcd-io/etcd/pull/11613).
* Fix [quorum protection logic when promoting a learner](https://github.com/etcd-io/etcd/pull/11640).
* Improve [peer corruption checker](https://github.com/etcd-io/etcd/pull/11621) to work when peer mTLS is enabled.
* Log [`[CLIENT-PORT]/health` check in server side](https://github.com/etcd-io/etcd/pull/11704).
* Log [successful etcd server-side health check in debug level](https://github.com/etcd-io/etcd/pull/12677).
* Improve [compaction performance when latest index is greater than 1-million](https://github.com/etcd-io/etcd/pull/11734).
* [Refactor consistentindex](https://github.com/etcd-io/etcd/pull/11699).
* [Add log when etcdserver failed to apply command](https://github.com/etcd-io/etcd/pull/11670).
* Improve [count-only range performance](https://github.com/etcd-io/etcd/pull/11771).
* Remove [redundant storage restore operation to shorten the startup time](https://github.com/etcd-io/etcd/pull/11779).
  + With 40 million key test data,it can shorten the startup time from 5 min to 2.5 min.
* [Fix deadlock bug in mvcc](https://github.com/etcd-io/etcd/pull/11817).
* Fix [inconsistency between WAL and server snapshot](https://github.com/etcd-io/etcd/pull/11888).
  + Previously, server restore fails if it had crashed after persisting raft hard state but before saving snapshot.
  + See [#10219](https://github.com/etcd-io/etcd/issues/10219) for more.
  + Add [missing CRC checksum check in WAL validate method otherwise causes panic](https://github.com/etcd-io/etcd/pull/11924).
  + See [#11918](https://github.com/etcd-io/etcd/issues/11918).
* Improve logging around snapshot send and receive.
* [Push down RangeOptions.limit argv into index tree to reduce memory overhead](https://github.com/etcd-io/etcd/pull/11990).
* Add [reason field for /health response](https://github.com/etcd-io/etcd/pull/11983).
* Add [exclude alarms from health check conditionally](https://github.com/etcd-io/etcd/pull/12880).
* Add [`etcd --unsafe-no-fsync`](https://github.com/etcd-io/etcd/pull/11946) flag.
  + Setting the flag disables all uses of fsync, which is unsafe and will cause data loss. This flag makes it possible to run an etcd node for testing and development without placing lots of load on the file system.
* Add [`etcd --auth-token-ttl`](https://github.com/etcd-io/etcd/pull/11980) flag to customize `simpleTokenTTL` settings.
* Improve [`runtime.FDUsage` call pattern to reduce objects malloc of Memory Usage and CPU Usage](https://github.com/etcd-io/etcd/pull/11986).
* Improve [mvcc.watchResponse channel Memory Usage](https://github.com/etcd-io/etcd/pull/11987).
* Log [expensive request info in UnaryInterceptor](https://github.com/etcd-io/etcd/pull/12086).
* [Fix invalid Go type in etcdserverpb](https://github.com/etcd-io/etcd/pull/12000).
* [Improve healthcheck by using v3 range request and its corresponding timeout](https://github.com/etcd-io/etcd/pull/12195).
* Add [`etcd --experimental-watch-progress-notify-interval`](https://github.com/etcd-io/etcd/pull/12216) flag to make watch progress notify interval configurable.
* Fix [server panic in slow writes warnings](https://github.com/etcd-io/etcd/issues/12197).
  + Fixed via [PR#12238](https://github.com/etcd-io/etcd/pull/12238).
* [Fix server panic](https://github.com/etcd-io/etcd/pull/12288) when force-new-cluster flag is enabled in a cluster which had learner node.
* Add [`etcd --self-signed-cert-validity`](https://github.com/etcd-io/etcd/pull/12429) flag to support setting certificate expiration time.
  + Notice, certificates generated by etcd are valid for 1 year by default when specifying the auto-tls or peer-auto-tls option.
* Add [`etcd --experimental-warning-apply-duration`](https://github.com/etcd-io/etcd/pull/12448) flag which allows apply duration threshold to be configurable.
* Add [`etcd --experimental-memory-mlock`](https://github.com/etcd-io/etcd/pull/TODO) flag which prevents etcd memory pages to be swapped out.
* Add [`etcd --socket-reuse-port`](https://github.com/etcd-io/etcd/pull/12702) flag
  + Setting this flag enables `SO_REUSEPORT` which allows rebind of a port already in use. User should take caution when using this flag to ensure flock is properly enforced.
* Add [`etcd --socket-reuse-address`](https://github.com/etcd-io/etcd/pull/12702) flag
  + Setting this flag enables `SO_REUSEADDR` which allows binding to an address in `TIME_WAIT` state, improving etcd restart time.
* Reduce [around 30% memory allocation by logging range response size without marshal](https://github.com/etcd-io/etcd/pull/12871).
* `ETCD_VERIFY="all"` environment triggers [additional verification of consistency](https://github.com/etcd-io/etcd/pull/12901) of etcd data-dir files.
* Add [`etcd --enable-log-rotation`](https://github.com/etcd-io/etcd/pull/12774) boolean flag which enables log rotation if true.
* Add [`etcd --log-rotation-config-json`](https://github.com/etcd-io/etcd/pull/12774) flag which allows passthrough of JSON config to configure log rotation for a file output target.
* Add experimental distributed tracing boolean flag [`--experimental-enable-distributed-tracing`](https://github.com/etcd-io/etcd/pull/12919) which enables tracing.
* Add [`etcd --experimental-distributed-tracing-address`](https://github.com/etcd-io/etcd/pull/12919) string flag which allows configuring the OpenTelemetry collector address.
* Add [`etcd --experimental-distributed-tracing-service-name`](https://github.com/etcd-io/etcd/pull/12919) string flag which allows changing the default "etcd" service name.
* Add [`etcd --experimental-distributed-tracing-instance-id`](https://github.com/etcd-io/etcd/pull/12919) string flag which configures an instance ID, which must be unique per etcd instance.
* Add [`--experimental-bootstrap-defrag-threshold-megabytes`](https://github.com/etcd-io/etcd/pull/12941) which configures a threshold for the unused db size and etcdserver will automatically perform defragmentation on bootstrap when it exceeds this value. The functionality is disabled if the value is 0.

### Package `runtime`

* Optimize [`runtime.FDUsage` by removing unnecessary sorting](https://github.com/etcd-io/etcd/pull/12214).

### Package `embed`

* Remove [`embed.Config.Debug`](https://github.com/etcd-io/etcd/pull/10947).
  + Use `embed.Config.LogLevel` instead.
* Add [`embed.Config.ZapLoggerBuilder`](https://github.com/etcd-io/etcd/pull/11147) to allow creating a custom zap logger.
* Replace [global `*zap.Logger` with etcd server logger object](https://github.com/etcd-io/etcd/pull/12212).
* Add [`embed.Config.EnableLogRotation`](https://github.com/etcd-io/etcd/pull/12774) which enables log rotation if true.
* Add [`embed.Config.LogRotationConfigJSON`](https://github.com/etcd-io/etcd/pull/12774) to allow passthrough of JSON config to configure log rotation for a file output target.
* Add [`embed.Config.ExperimentalEnableDistributedTracing`](https://github.com/etcd-io/etcd/pull/12919) which enables experimental distributed tracing if true.
* Add [`embed.Config.ExperimentalDistributedTracingAddress`](https://github.com/etcd-io/etcd/pull/12919) which allows overriding default collector address.
* Add [`embed.Config.ExperimentalDistributedTracingServiceName`](https://github.com/etcd-io/etcd/pull/12919) which allows overriding default "etcd" service name.
* Add [`embed.Config.ExperimentalDistributedTracingServiceInstanceID`](https://github.com/etcd-io/etcd/pull/12919) which allows configuring an instance ID, which must be uniquer per etcd instance.

### Package `clientv3`

* Remove [excessive watch cancel logging messages](https://github.com/etcd-io/etcd/pull/12187).
  + See [kubernetes/kubernetes#93450](https://github.com/kubernetes/kubernetes/issues/93450).
* Add [`TryLock`](https://github.com/etcd-io/etcd/pull/11104) method to `clientv3/concurrency/Mutex`. A non-blocking method on `Mutex` which does not wait to get lock on the Mutex, returns immediately if Mutex is locked by another session.
* Fix [client balancer failover against multiple endpoints](https://github.com/etcd-io/etcd/pull/11184).
  + Fix [`"kube-apiserver: failover on multi-member etcd cluster fails certificate check on DNS mismatch"`](https://github.com/kubernetes/kubernetes/issues/83028).
* Fix [IPv6 endpoint parsing in client](https://github.com/etcd-io/etcd/pull/11211).
  + Fix ["1.16: etcd client does not parse IPv6 addresses correctly when members are joining" (kubernetes#83550)](https://github.com/kubernetes/kubernetes/issues/83550).
* Fix [errors caused by grpc changing balancer/resolver API](https://github.com/etcd-io/etcd/pull/11564). This change is compatible with grpc >= [v1.26.0](https://github.com/grpc/grpc-go/releases/tag/v1.26.0), but is not compatible with < v1.26.0 version.
* Use [ServerName as the authority](https://github.com/etcd-io/etcd/pull/11574) after bumping to grpc v1.26.0. Remove workaround in [#11184](https://github.com/etcd-io/etcd/pull/11184).
* Fix [`"hasleader"` metadata embedding](https://github.com/etcd-io/etcd/pull/11687).
  + Previously, `clientv3.WithRequireLeader(ctx)` was overwriting existing context keys.
* Fix [watch leak caused by lazy cancellation](https://github.com/etcd-io/etcd/pull/11850). When clients cancel their watches, a cancel request will now be immediately sent to the server instead of waiting for the next watch event.
* Make sure [save snapshot downloads checksum for integrity checks](https://github.com/etcd-io/etcd/pull/11896).
* Fix [auth token invalid after watch reconnects](https://github.com/etcd-io/etcd/pull/12264). Get AuthToken automatically when clientConn is ready.
* Improve [clientv3:get AuthToken gracefully without extra connection](https://github.com/etcd-io/etcd/pull/12165).
* Changed [clientv3 dialing code](https://github.com/etcd-io/etcd/pull/12671) to use grpc resolver API instead of custom balancer.
  + Endpoints self identify now as `etcd-endpoints://{id}/#initially={list of endpoints}` e.g. `etcd-endpoints://0xc0009d8540/#initially=[localhost:2079]`
* Make sure [save snapshot downloads checksum for integrity checks](https://github.com/etcd-io/etcd/pull/11896).

### Package `lease`

* Fix [memory leak in follower nodes](https://github.com/etcd-io/etcd/pull/11731).
  + [#11495](https://github.com/etcd-io/etcd/issues/11495)
  + [#11730](https://github.com/etcd-io/etcd/issues/11730)
* Make sure [grant/revoke won't be applied repeatedly after restarting etcd](https://github.com/etcd-io/etcd/pull/11935).

### Package `wal`

* Add [`etcd_wal_write_bytes_total`](https://github.com/etcd-io/etcd/pull/11738).
* Handle [out-of-range slice bound in `ReadAll` and entry limit in `decodeRecord`](https://github.com/etcd-io/etcd/pull/11793).

### etcdctl v3

* Fix `etcdctl member add` command to prevent potential timeout. ([PR#11194](https://github.com/etcd-io/etcd/pull/11194) and [PR#11638](https://github.com/etcd-io/etcd/pull/11638))
* Add [`etcdctl watch --progress-notify`](https://github.com/etcd-io/etcd/pull/11462) flag.
* Add [`etcdctl auth status`](https://github.com/etcd-io/etcd/pull/11536) command to check if authentication is enabled
* Add [`etcdctl get --count-only`](https://github.com/etcd-io/etcd/pull/11743) flag for output type `fields`.
* Add [`etcdctl member list -w=json --hex`](https://github.com/etcd-io/etcd/pull/11812) flag to print memberListResponse in hex format json.
* Changed [`etcdctl lock <lockname> exec-command`](https://github.com/etcd-io/etcd/pull/12829) to return exit code of exec-command.
* [New tool: `etcdutl`](https://github.com/etcd-io/etcd/pull/12971) incorporated functionality of: `etcdctl snapshot status|restore`, `etcdctl backup`, `etcdctl defrag --data-dir ...`.
* [ETCDCTL\_API=3 `etcdctl migrate`](https://github.com/etcd-io/etcd/pull/12971) has been decommissioned. Use etcd <=v3.4 to restore v2 storage.

### gRPC gateway

* [gRPC gateway](https://github.com/grpc-ecosystem/grpc-gateway) only supports [`/v3`](/etcd-io/etcd/blob/main/CHANGELOG/TODO) endpoint.
  + Deprecated [`/v3beta`](https://github.com/etcd-io/etcd/pull/9298).
  + `curl -L http://localhost:2379/v3beta/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` does work in v3.5. Use `curl -L http://localhost:2379/v3/kv/put -X POST -d '{"key": "Zm9v", "value": "YmFy"}'` instead.
* Set [`enable-grpc-gateway`](https://github.com/etcd-io/etcd/pull/12297) flag to true when using a config file to keep the defaults the same as the command line configuration.

### gRPC Proxy

* Fix [`panic on error`](https://github.com/etcd-io/etcd/pull/11694) for metrics handler.
* Add [gRPC keepalive related flags](https://github.com/etcd-io/etcd/pull/11711) `grpc-keepalive-min-time`, `grpc-keepalive-interval` and `grpc-keepalive-timeout`.
* [Fix grpc watch proxy hangs when failed to cancel a watcher](https://github.com/etcd-io/etcd/pull/12030) .
* Add [metrics handler for grpcproxy self](https://github.com/etcd-io/etcd/pull/12107).
* Add [health handler for grpcproxy self](https://github.com/etcd-io/etcd/pull/12114).

### Auth

* Fix [NoPassword check when adding user through GRPC gateway](https://github.com/etcd-io/etcd/pull/11418) ([issue#11414](https://github.com/etcd-io/etcd/issues/11414))
* Fix bug where [some auth related messages are logged at wrong level](https://github.com/etcd-io/etcd/pull/11586)
* [Fix a data corruption bug by saving consistent index](https://github.com/etcd-io/etcd/pull/11652).
* [Improve checkPassword performance](https://github.com/etcd-io/etcd/pull/11735).
* [Add authRevision field in AuthStatus](https://github.com/etcd-io/etcd/pull/11659).
* Fix [a bug of not refreshing expired tokens](https://github.com/etcd-io/etcd/pull/13308).

### API

* Add [`/v3/auth/status`](https://github.com/etcd-io/etcd/pull/11536) endpoint to check if authentication is enabled
* [Add `Linearizable` field to `etcdserverpb.MemberListRequest`](https://github.com/etcd-io/etcd/pull/11639).
* [Learner support Snapshot RPC](https://github.com/etcd-io/etcd/pull/12890/).

### Package `netutil`

* Remove [`netutil.DropPort/RecoverPort/SetLatency/RemoveLatency`](https://github.com/etcd-io/etcd/pull/12491).
  + These are not used anymore. They were only used for older versions of functional testing.
  + Removed to adhere to best security practices, minimize arbitrary shell invocation.

### `tools/etcd-dump-metrics`

* Implement [input validation to prevent arbitrary shell invocation](https://github.com/etcd-io/etcd/pull/12491).

### Dependency

* Upgrade [`google.golang.org/grpc`](https://github.com/grpc/grpc-go/releases) from [**`v1.23.0`**](https://github.com/grpc/grpc-go/releases/tag/v1.23.0) to [**`v1.37.0`**](https://github.com/grpc/grpc-go/releases/tag/v1.37.0).
* Upgrade [`go.uber.org/zap`](https://github.com/uber-go/zap/releases) from [**`v1.14.1`**](https://github.com/uber-go/zap/releases/tag/v1.14.1) to [**`v1.16.0`**](https://github.com/uber-go/zap/releases/tag/v1.16.0).

### Platforms

* etcd now [officially supports `arm64`](https://github.com/etcd-io/etcd/pull/12929).
  + See [#12928](https://github.com/etcd-io/etcd/pull/12928) for adding automated tests with `arm64` EC2 instances (Graviton 2).
  + See [etcd-io/website#273](https://github.com/etcd-io/website/pull/273) for new platform support tier policies.

### Release

* Add s390x build support ([PR#11548](https://github.com/etcd-io/etcd/pull/11548) and [PR#11358](https://github.com/etcd-io/etcd/pull/11358))

### Go

* Require [*Go 1.16+*](https://github.com/etcd-io/etcd/pull/11110).
* Compile with [*Go 1.16+*](https://golang.org/doc/devel/release.html#go1.16)
* etcd uses [go modules](https://github.com/etcd-io/etcd/pull/12279) (instead of vendor dir) to track dependencies.

### Project Governance

* The etcd team has added, a well defined and openly discussed, project [governance](https://github.com/etcd-io/etcd/pull/11175).

---

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


