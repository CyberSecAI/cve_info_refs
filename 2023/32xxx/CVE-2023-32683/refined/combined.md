=== Content from github.com_a7dcbee3_20250115_115517.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-98px-6486-j7qc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-98px-6486-j7qc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# URL deny list bypass via oEmbed and image URLs when generating previews

Low

[erikjohnston](/erikjohnston)
published
GHSA-98px-6486-j7qc
Jun 6, 2023

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.85.0

## Patched versions

1.85.0

## Description

### Impact

A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs) and by the limited information returned to the client:

* For discovered oEmbed URLs, any non-JSON response or a JSON response which includes non-oEmbed information is discarded.
* For discovered image URLs, any non-image response is discarded.

Systems which have URL preview disabled (via the `url_preview_enabled` setting) or have not configured a `url_preview_url_blacklist` are not affected.

Because of the uncommon configuration required, the limited information a malicious user, and the amount of guesses/time the attack would need; the severity is rated as low.

### Patches

The issue is fixed by [#15601](https://github.com/matrix-org/synapse/pull/15601).

### Workarounds

The default configuration of the `url_preview_ip_range_blacklist` should protect against requests being made to internal infrastructure, URL previews of public URLs is expected.

Alternately URL previews could be disabled using the `url_preview_enabled` setting.

### Severity

Low

### CVE ID

CVE-2023-32683

### Weaknesses

[CWE-918](/advisories?query=cwe%3A918)

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_6edcc8e9_20250114_200028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F15601)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F15601)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Apply url\_preview\_url\_blacklist to oEmbed and pre-cached images #15601

 Merged

[clokep](/clokep)
merged 8 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/url-preview-oembed](/matrix-org/synapse/tree/clokep/url-preview-oembed "matrix-org/synapse:clokep/url-preview-oembed")

May 16, 2023

 Merged

# [Apply url\_preview\_url\_blacklist to oEmbed and pre-cached images](#top) #15601

[clokep](/clokep)
merged 8 commits into
[develop](/matrix-org/synapse/tree/develop "matrix-org/synapse:develop")
from
[clokep/url-preview-oembed](/matrix-org/synapse/tree/clokep/url-preview-oembed "matrix-org/synapse:clokep/url-preview-oembed")

May 16, 2023

[Conversation
10](/matrix-org/synapse/pull/15601)
[Commits
8](/matrix-org/synapse/pull/15601/commits)
[Checks
0](/matrix-org/synapse/pull/15601/checks)
[Files changed](/matrix-org/synapse/pull/15601/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![clokep](https://avatars.githubusercontent.com/u/517124?s=60&v=4)](/clokep)

Copy link

Member

### @clokep **[clokep](/clokep)** commented [May 15, 2023](#issue-1710740725) â€¢ edited Loading

* If an oEmbed URL was substituted for one in the original URL it was not properly checked against `url_preview_url_blacklist` (this is a bit odd since they're both configured by the admin).
* If an oEmbed or image URL is discovered in the HTML, the resulting URLs were not checked against `url_preview_url_blacklist`.

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 5 commits
[May 15, 2023 15:20](#commits-pushed-d86daae)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Separate URL checker out to a separate method.](/matrix-org/synapse/pull/15601/commits/d86daaeee7a453e3a4005a79d344c4a1f6d05901 "Separate URL checker out to a separate method.")`

`[d86daae](/matrix-org/synapse/pull/15601/commits/d86daaeee7a453e3a4005a79d344c4a1f6d05901)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Check more URLs against the deny list.](/matrix-org/synapse/pull/15601/commits/03ac76acd466f1cd5c2fb9d5cb524a37c169da3a "Check more URLs against the deny list.")`

`[03ac76a](/matrix-org/synapse/pull/15601/commits/03ac76acd466f1cd5c2fb9d5cb524a37c169da3a)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Add comments / minor refactoring.](/matrix-org/synapse/pull/15601/commits/18e2b3bd9a84a0258535a222347fe60d073d1b76 "Add comments / minor refactoring.")`

`[18e2b3b](/matrix-org/synapse/pull/15601/commits/18e2b3bd9a84a0258535a222347fe60d073d1b76)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Documentation updates.](/matrix-org/synapse/pull/15601/commits/66c3a531f1ca1295bbef6ebeb7e51505653a1728 "Documentation updates.")`

`[66c3a53](/matrix-org/synapse/pull/15601/commits/66c3a531f1ca1295bbef6ebeb7e51505653a1728)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Newsfragment](/matrix-org/synapse/pull/15601/commits/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf "Newsfragment")`

`[bf5dfd8](/matrix-org/synapse/pull/15601/commits/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
marked this pull request as ready for review
[May 15, 2023 20:33](#event-9250861877)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested a review
from a team
as a [code owner](/matrix-org/synapse/blob/ba572647b291e593e70a30e45c234c9766472ff3/.github/CODEOWNERS#L2)
[May 15, 2023 20:33](#event-9250861925)

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[May 16, 2023](#pullrequestreview-1427602051)

 [View reviewed changes](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf)

[synapse/media/url\_previewer.py](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf#diff-dc68124c0d84680270eed920da015583f050a41c7bb2fdc19631676ea616a319)
Outdated

Show resolved

Hide resolved

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[May 16, 2023](#pullrequestreview-1427603292)

 [View reviewed changes](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf)

[synapse/media/url\_previewer.py](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf#diff-dc68124c0d84680270eed920da015583f050a41c7bb2fdc19631676ea616a319)

Show resolved

Hide resolved

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[May 16, 2023](#pullrequestreview-1427604943)

 [View reviewed changes](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf)

[tests/media/test\_url\_previewer.py](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf#diff-8faecbe399a86293eb7c883b5c6bcdcf61a9c49d16a25441f94b3c7fef71c4ac)
Outdated

Show resolved

Hide resolved

 [![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=40&v=4)](/MadLittleMods)
[MadLittleMods](/MadLittleMods)
requested a review
from a team
[May 16, 2023 02:28](#event-9252677044)

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
reviewed
[May 16, 2023](#pullrequestreview-1427607220)

 [View reviewed changes](/matrix-org/synapse/pull/15601/files/bf5dfd8e140e03471e9e382b0fdb3bbbf64afcdf)

Copy link

Contributor

### @MadLittleMods **[MadLittleMods](/MadLittleMods)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

(commented on a couple things but not a exhaustive review)

Sorry, something went wrong.

All reactions

 [clokep](/clokep)
added 3 commits
[May 16, 2023 07:17](#commits-pushed-f09f3cc)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Run the URL check on the absolute image URL.](/matrix-org/synapse/pull/15601/commits/f09f3cc2ddd0ed5f7178665e04ba3dd52e0e63cf "Run the URL check on the absolute image URL.")`

`[f09f3cc](/matrix-org/synapse/pull/15601/commits/f09f3cc2ddd0ed5f7178665e04ba3dd52e0e63cf)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Remove unused test code.](/matrix-org/synapse/pull/15601/commits/6161a3d80c5d2d605308da3ddc7d5fb57d0256b8 "Remove unused test code.")`

`[6161a3d](/matrix-org/synapse/pull/15601/commits/6161a3d80c5d2d605308da3ddc7d5fb57d0256b8)`

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&v=4)](/clokep)

`[Move logic into _handle_url.](/matrix-org/synapse/pull/15601/commits/8a073a2cd0007c9391008147965cdafa2e80a2b2 "Move logic into _handle_url.")`

`[8a073a2](/matrix-org/synapse/pull/15601/commits/8a073a2cd0007c9391008147965cdafa2e80a2b2)`

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
requested review from
[MadLittleMods](/MadLittleMods) and
a team
[May 16, 2023 11:33](#event-9256961799)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=80&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)

Copy link

Member

Author

### **[clokep](/clokep)** commented [May 16, 2023](#issuecomment-1549490434)

| (commented on a couple things but not a exhaustive review)  I took this to mean you'd like someone else to take a look at it? Shout if that was the wrong interpretation! |
| --- |

 ðŸ‘
1
 MadLittleMods reacted with thumbs up emoji

All reactions

* ðŸ‘
  1 reaction

Sorry, something went wrong.

[![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=80&v=4)](/MadLittleMods)

Copy link

Contributor

### **[MadLittleMods](/MadLittleMods)** commented [May 16, 2023](#issuecomment-1550178989)

| I took this to mean you'd like someone else to take a look at it? Shout if that was the wrong interpretation!  Yes, exactly! I assigned back to the review queue when I said that but looks like I got the order of operations wrong and the comment reset the state after I tried to give context why I put it back in the queue. Sorry for losing a cycle for you there. |
| --- |

 ðŸ‘
1
 clokep reacted with thumbs up emoji

All reactions

* ðŸ‘
  1 reaction

Sorry, something went wrong.

[![MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=60&v=4)](/MadLittleMods)

**[MadLittleMods](/MadLittleMods)**
approved these changes
[May 16, 2023](#pullrequestreview-1429206577)

 [View reviewed changes](/matrix-org/synapse/pull/15601/files/8a073a2cd0007c9391008147965cdafa2e80a2b2)

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
merged commit [`4ee82c0`](/matrix-org/synapse/commit/4ee82c0576baed6358e3818e8c22e01bde6afd02)
into
develop

[May 16, 2023](https://github.com/matrix-org/synapse/pull/15601#event-9262228562)

 [![@clokep](https://avatars.githubusercontent.com/u/517124?s=40&u=794f0e1fb2bba9a17208cd1b64823f86d55bb7e0&v=4)](/clokep)
[clokep](/clokep)
deleted the
clokep/url-preview-oembed

branch
[May 16, 2023 20:25](#event-9262228680)

[yingziwu](/yingziwu)
added a commit
to yingziwu/synapse
that referenced
this pull request
[Jun 6, 2023](#ref-commit-05c8839)
[![@yingziwu](https://avatars.githubusercontent.com/u/22741471?s=40&u=0b64cb873a93b925b25eaac11b6127f15c938754&v=4)](/yingziwu)

`[Merge tag 'v1.85.0' into develop](/yingziwu/synapse/commit/05c8839f9f781f2eae7cb162d7440ee31b79f186 "Merge tag 'v1.85.0' into develop

Synapse 1.85.0 (2023-06-06)
===========================

No significant changes since 1.85.0rc2.

The following issues are fixed in 1.85.0 (and RCs).

- [GHSA-26c5-ppr8-f33p](https://github.com/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p) / [CVE-2023-32682](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683) â€” Low Severity

  It may be possible for a deactivated user to login when using uncommon configurations.

- [GHSA-98px-6486-j7qc](https://github.com/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc) / [CVE-2023-32683](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683) â€” Low Severity

  A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs).

See the advisories for more details. If you have any questions, email security@matrix.org.

Synapse 1.85.0rc2 (2023-06-01)
==============================

Bugfixes
--------

- Fix a performance issue introduced in Synapse v1.83.0 which meant that purging rooms was very slow and database-intensive. ([\#15693](https://github.com/matrix-org/synapse/issues/15693))

Deprecations and Removals
-------------------------

- Deprecate calling the `/register` endpoint with an unspecced `user` property for application services. ([\#15703](https://github.com/matrix-org/synapse/issues/15703))

Internal Changes
----------------

- Speed up background jobs `populate_full_user_id_user_filters` and `populate_full_user_id_profiles`. ([\#15700](https://github.com/matrix-org/synapse/issues/15700))

Synapse 1.85.0rc1 (2023-05-30)
==============================

Features
--------

- Improve performance of backfill requests by performing backfill of previously failed requests in the background. ([\#15585](https://github.com/matrix-org/synapse/issues/15585))
- Add a new [admin API](https://matrix-org.github.io/synapse/v1.85/usage/administration/admin_api/index.html) to [create a new device for a user](https://matrix-org.github.io/synapse/v1.85/admin_api/user_admin_api.html#create-a-device). ([\#15611](https://github.com/matrix-org/synapse/issues/15611))
- Add Unix socket support for Redis connections. Contributed by Jason Little. ([\#15644](https://github.com/matrix-org/synapse/issues/15644))

Bugfixes
--------

- Fix a long-standing bug where setting the read marker could fail when using message retention. Contributed by Nick @ Beeper (@fizzadar). ([\#15464](https://github.com/matrix-org/synapse/issues/15464))
- Fix a long-standing bug where the `url_preview_url_blacklist` configuration setting was not applied to oEmbed or image URLs found while previewing a URL. ([\#15601](https://github.com/matrix-org/synapse/issues/15601))
- Fix a long-standing bug where filters with multiple backslashes were rejected. ([\#15607](https://github.com/matrix-org/synapse/issues/15607))
- Fix a bug introduced in Synapse 1.82.0 where the error message displayed when validation of the `app_service_config_files` config option fails would be incorrectly formatted. ([\#15614](https://github.com/matrix-org/synapse/issues/15614))
- Fix a long-standing bug where deactivated users were still able to login using the custom `org.matrix.login.jwt` login type (if enabled). ([\#15624](https://github.com/matrix-org/synapse/issues/15624))
- Fix a long-standing bug where deactivated users were able to login in uncommon situations. ([\#15634](https://github.com/matrix-org/synapse/issues/15634))

Improved Documentation
----------------------

- Warn users that at least 3.75GB of space is needed for the nix Synapse development environment. ([\#15613](https://github.com/matrix-org/synapse/issues/15613))
- Remove outdated comment from the generated and sample homeserver log configs. ([\#15648](https://github.com/matrix-org/synapse/issues/15648))
- Improve contributor docs to make it more clear that Rust is a necessary prerequisite. Contributed by @grantm. ([\#15668](https://github.com/matrix-org/synapse/issues/15668))

Deprecations and Removals
-------------------------

- Remove the old version of the R30 (30-day retained users) phone-home metric. ([\#10428](https://github.com/matrix-org/synapse/issues/10428))

Internal Changes
----------------

- Create dependabot changelogs at release time. ([\#15481](https://github.com/matrix-org/synapse/issues/15481))
- Add not null constraint to column `full_user_id` of tables `profiles` and `user_filters`. ([\#15537](https://github.com/matrix-org/synapse/issues/15537))
- Allow connecting to HTTP Replication Endpoints by using `worker_name` when constructing the request. ([\#15578](https://github.com/matrix-org/synapse/issues/15578))
- Make the `thread_id` column on `event_push_actions`, `event_push_actions_staging`, and `event_push_summary` non-null. ([\#15597](https://github.com/matrix-org/synapse/issues/15597))
- Run mypy type checking with the minimum supported Python version to catch new usage that isn't backwards-compatible. ([\#15602](https://github.com/matrix-org/synapse/issues/15602))
- Fix subscriptable type usage in Python <3.9. ([\#15604](https://github.com/matrix-org/synapse/issues/15604))
- Update internal terminology. ([\#15606](https://github.com/matrix-org/synapse/issues/15606), [\#15620](https://github.com/matrix-org/synapse/issues/15620))
- Instrument `state` and `state_group` storage-related operations to better picture what's happening when tracing. ([\#15610](https://github.com/matrix-org/synapse/issues/15610), [\#15647](https://github.com/matrix-org/synapse/issues/15647))
- Trace how many new events from the backfill response we need to process. ([\#15633](https://github.com/matrix-org/synapse/issues/15633))
- Re-type config paths in `ConfigError`s to be `StrSequence`s instead of `Iterable[str]`s. ([\#15615](https://github.com/matrix-org/synapse/issues/15615))
- Update Mutual Rooms ([MSC2666](https://github.com/matrix-org/matrix-spec-proposals/pull/2666)) implementation to match new proposal text. ([\#15621](https://github.com/matrix-org/synapse/issues/15621))
- Remove the unstable identifiers from faster joins ([MSC3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)). ([\#15625](https://github.com/matrix-org/synapse/issues/15625))
- Fix the olddeps CI. ([\#15626](https://github.com/matrix-org/synapse/issues/15626))
- Remove duplicate timestamp from test logs (`_trial_temp/test.log`). ([\#15636](https://github.com/matrix-org/synapse/issues/15636))
- Fix two memory leaks in `trial` test runs. ([\#15630](https://github.com/matrix-org/synapse/issues/15630))
- Limit the size of the `HomeServerConfig` cache in trial test runs. ([\#15646](https://github.com/matrix-org/synapse/issues/15646))
- Improve type hints. ([\#15658](https://github.com/matrix-org/synapse/issues/15658), [\#15659](https://github.com/matrix-org/synapse/issues/15659))
- Add requesting user id parameter to key claim methods in `TransportLayerClient`. ([\#15663](https://github.com/matrix-org/synapse/issues/15663))
- Speed up rebuilding of the user directory for local users. ([\#15665](https://github.com/matrix-org/synapse/issues/15665))
- Implement \"option 2\" for [MSC3820](https://github.com/matrix-org/matrix-spec-proposals/pull/3820): Room version 11. ([\#15666](https://github.com/matrix-org/synapse/issues/15666), [\#15678](https://github.com/matrix-org/synapse/issues/15678))

* Bump furo from 2023.3.27 to 2023.5.20. ([\#15642](https://github.com/matrix-org/synapse/issues/15642))
* Bump log from 0.4.17 to 0.4.18. ([\#15681](https://github.com/matrix-org/synapse/issues/15681))
* Bump prometheus-client from 0.16.0 to 0.17.0. ([\#15682](https://github.com/matrix-org/synapse/issues/15682))
* Bump pydantic from 1.10.7 to 1.10.8. ([\#15685](https://github.com/matrix-org/synapse/issues/15685))
* Bump pygithub from 1.58.1 to 1.58.2. ([\#15643](https://github.com/matrix-org/synapse/issues/15643))
* Bump requests from 2.28.2 to 2.31.0. ([\#15651](https://github.com/matrix-org/synapse/issues/15651))
* Bump sphinx from 6.1.3 to 6.2.1. ([\#15641](https://github.com/matrix-org/synapse/issues/15641))
* Bump types-bleach from 6.0.0.1 to 6.0.0.3. ([\#15686](https://github.com/matrix-org/synapse/issues/15686))
* Bump types-pillow from 9.5.0.2 to 9.5.0.4. ([\#15640](https://github.com/matrix-org/synapse/issues/15640))
* Bump types-pyyaml from 6.0.12.9 to 6.0.12.10. ([\#15683](https://github.com/matrix-org/synapse/issues/15683))
* Bump types-requests from 2.30.0.0 to 2.31.0.0. ([\#15684](https://github.com/matrix-org/synapse/issues/15684))
* Bump types-setuptools from 67.7.0.2 to 67.8.0.0. ([\#15639](https://github.com/matrix-org/synapse/issues/15639))")`
â€¦

`[05c8839](/yingziwu/synapse/commit/05c8839f9f781f2eae7cb162d7440ee31b79f186)`

```
Synapse 1.85.0 (2023-06-06)
===========================

No significant changes since 1.85.0rc2.

The following issues are fixed in 1.85.0 (and RCs).

- [[GHSA-26c5-ppr8-f33p](https://github.com/advisories/GHSA-26c5-ppr8-f33p "GHSA-26c5-ppr8-f33p")]([GHSA-26c5-ppr8-f33p](https://github.com/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p "GHSA-26c5-ppr8-f33p")) / [[CVE-2023-32682](https://github.com/advisories/GHSA-26c5-ppr8-f33p "CVE-2023-32682")](<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683>) â€” Low Severity

  It may be possible for a deactivated user to login when using uncommon configurations.

- [[GHSA-98px-6486-j7qc](https://github.com/advisories/GHSA-98px-6486-j7qc "GHSA-98px-6486-j7qc")]([GHSA-98px-6486-j7qc](https://github.com/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc "GHSA-98px-6486-j7qc")) / [[CVE-2023-32683](https://github.com/advisories/GHSA-98px-6486-j7qc "CVE-2023-32683")](<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683>) â€” Low Severity

  A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs).

See the advisories for more details. If you have any questions, email security@matrix.org.

Synapse 1.85.0rc2 (2023-06-01)
==============================

Bugfixes
--------

- Fix a performance issue introduced in Synapse v1.83.0 which meant that purging rooms was very slow and database-intensive. ([\[matrix-org#15693](https://github.com/matrix-org/synapse/pull/15693)]([matrix-org#15693](https://github.com/matrix-org/synapse/pull/15693)))

Deprecations and Removals
-------------------------

- Deprecate calling the `/register` endpoint with an unspecced `user` property for application services. ([\[matrix-org#15703](https://github.com/matrix-org/synapse/pull/15703)]([matrix-org#15703](https://github.com/matrix-org/synapse/pull/15703)))

Internal Changes
----------------

- Speed up background jobs `populate_full_user_id_user_filters` and `populate_full_user_id_profiles`. ([\[matrix-org#15700](https://github.com/matrix-org/synapse/pull/15700)]([matrix-org#15700](https://github.com/matrix-org/synapse/pull/15700)))

Synapse 1.85.0rc1 (2023-05-30)
==============================

Features
--------

- Improve performance of backfill requests by performing backfill of previously failed requests in the background. ([\[matrix-org#15585](https://github.com/matrix-org/synapse/pull/15585)]([matrix-org#15585](https://github.com/matrix-org/synapse/pull/15585)))
- Add a new [admin API](<https://matrix-org.github.io/synapse/v1.85/usage/administration/admin_api/index.html>) to [create a new device for a user](<https://matrix-org.github.io/synapse/v1.85/admin_api/user_admin_api.html#create-a-device>). ([\[matrix-org#15611](https://github.com/matrix-org/synapse/pull/15611)]([matrix-org#15611](https://github.com/matrix-org/synapse/pull/15611)))
- Add Unix socket support for Redis connections. Contributed by Jason Little. ([\[matrix-org#15644](https://github.com/matrix-org/synapse/pull/15644)]([matrix-org#15644](https://github.com/matrix-org/synapse/pull/15644)))

Bugfixes
--------

- Fix a long-standing bug where setting the read marker could fail when using message retention. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\[matrix-org#15464](https://github.com/matrix-org/synapse/pull/15464)]([matrix-org#15464](https://github.com/matrix-org/synapse/pull/15464)))
- Fix a long-standing bug where the `url_preview_url_blacklist` configuration setting was not applied to oEmbed or image URLs found while previewing a URL. ([\[matrix-org#15601](https://github.com/matrix-org/synapse/pull/15601)]([matrix-org#15601](https://github.com/matrix-org/synapse/pull/15601)))
- Fix a long-standing bug where filters with multiple backslashes were rejected. ([\[matrix-org#15607](https://github.com/matrix-org/synapse/pull/15607)]([matrix-org#15607](https://github.com/matrix-org/synapse/pull/15607)))
- Fix a bug introduced in Synapse 1.82.0 where the error message displayed when validation of the `app_service_config_files` config option fails would be incorrectly formatted. ([\[matrix-org#15614](https://github.com/matrix-org/synapse/pull/15614)]([matrix-org#15614](https://github.com/matrix-org/synapse/pull/15614)))
- Fix a long-standing bug where deactivated users were still able to login using the custom `org.matrix.login.jwt` login type (if enabled). ([\[matrix-org#15624](https://github.com/matrix-org/synapse/pull/15624)]([matrix-org#15624](https://github.com/matrix-org/synapse/pull/15624)))
- Fix a long-standing bug where deactivated users were able to login in uncommon situations. ([\[matrix-org#15634](https://github.com/matrix-org/synapse/pull/15634)]([matrix-org#15634](https://github.com/matrix-org/synapse/pull/15634)))

Improved Documentation
----------------------

- Warn users that at least 3.75GB of space is needed for the nix Synapse development environment. ([\[matrix-org#15613](https://github.com/matrix-org/synapse/pull/15613)]([matrix-org#15613](https://github.com/matrix-org/synapse/pull/15613)))
- Remove outdated comment from the generated and sample homeserver log configs. ([\[matrix-org#15648](https://github.com/matrix-org/synapse/pull/15648)]([matrix-org#15648](https://github.com/matrix-org/synapse/pull/15648)))
- Improve contributor docs to make it more clear that Rust is a necessary prerequisite. Contributed by [@grantm](https://github.com/grantm). ([\[matrix-org#15668](https://github.com/matrix-org/synapse/pull/15668)]([matrix-org#15668](https://github.com/matrix-org/synapse/pull/15668)))

Deprecations and Removals
-------------------------

- Remove the old version of the R30 (30-day retained users) phone-home metric. ([\[matrix-org#10428](https://github.com/matrix-org/synapse/pull/10428)]([matrix-org#10428](https://github.com/matrix-org/synapse/pull/10428)))

Internal Changes
----------------

- Create dependabot changelogs at release time. ([\[matrix-org#15481](https://github.com/matrix-org/synapse/pull/15481)]([matrix-org#15481](https://github.com/matrix-org/synapse/pull/15481)))
- Add not null constraint to column `full_user_id` of tables `profiles` and `user_filters`. ([\[matrix-org#15537](https://github.com/matrix-org/synapse/pull/15537)]([matrix-org#15537](https://github.com/matrix-org/synapse/pull/15537)))
- Allow connecting to HTTP Replication Endpoints by using `worker_name` when constructing the request. ([\[matrix-org#15578](https://github.com/matrix-org/synapse/pull/15578)]([matrix-org#15578](https://github.com/matrix-org/synapse/pull/15578)))
- Make the `thread_id` column on `event_push_actions`, `event_push_actions_staging`, and `event_push_summary` non-null. ([\[matrix-org#15597](https://github.com/matrix-org/synapse/pull/15597)]([matrix-org#15597](https://github.com/matrix-org/synapse/pull/15597)))
- Run mypy type checking with the minimum supported Python version to catch new usage that isn't backwards-compatible. ([\[matrix-org#15602](https://github.com/matrix-org/synapse/pull/15602)]([matrix-org#15602](https://github.com/matrix-org/synapse/pull/15602)))
- Fix subscriptable type usage in Python <3.9. ([\[matrix-org#15604](https://github.com/matrix-org/synapse/pull/15604)]([matrix-org#15604](https://github.com/matrix-org/synapse/pull/15604)))
- Update internal terminology. ([\[matrix-org#15606](https://github.com/matrix-org/synapse/pull/15606)]([matrix-org#15606](https://github.com/matrix-org/synapse/pull/15606)), [\[matrix-org#15620](https://github.com/matrix-org/synapse/pull/15620)]([matrix-org#15620](https://github.com/matrix-org/synapse/pull/15620)))
- Instrument `state` and `state_group` storage-related operations to better picture what's happening when tracing. ([\[matrix-org#15610](https://github.com/matrix-org/synapse/pull/15610)]([matrix-org#15610](https://github.com/matrix-org/synapse/pull/15610)), [\[matrix-org#15647](https://github.com/matrix-org/synapse/pull/15647)]([matrix-org#15647](https://github.com/matrix-org/synapse/pull/15647)))
- Trace how many new events from the backfill response we need to process. ([\[matrix-org#15633](https://github.com/matrix-org/synapse/pull/15633)]([matrix-org#15633](https://github.com/matrix-org/synapse/pull/15633)))
- Re-type config paths in `ConfigError`s to be `StrSequence`s instead of `Iterable[str]`s. ([\[matrix-org#15615](https://github.com/matrix-org/synapse/pull/15615)]([matrix-org#15615](https://github.com/matrix-org/synapse/pull/15615)))
- Update Mutual Rooms ([MSC2666]([matrix-org/matrix-spec-proposals#2666](https://github.com/matrix-org/matrix-spec-proposals/pull/2666))) implementation to match new proposal text. ([\[matrix-org#15621](https://github.com/matrix-org/synapse/pull/15621)]([matrix-org#15621](https://github.com/matrix-org/synapse/pull/15621)))
- Remove the unstable identifiers from faster joins ([MSC3706]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706))). ([\[matrix-org#15625](https://github.com/matrix-org/synapse/pull/15625)]([matrix-org#15625](https://github.com/matrix-org/synapse/pull/15625)))
- Fix the olddeps CI. ([\[matrix-org#15626](https://github.com/matrix-org/synapse/pull/15626)]([matrix-org#15626](https://github.com/matrix-org/synapse/pull/15626)))
- Remove duplicate timestamp from test logs (`_trial_temp/test.log`). ([\[matrix-org#15636](https://github.com/matrix-org/synapse/pull/15636)]([matrix-org#15636](https://github.com/matrix-org/synapse/pull/15636)))
- Fix two memory leaks in `trial` test runs. ([\[matrix-org#15630](https://github.com/matrix-org/synapse/pull/15630)]([matrix-org#15630](https://github.com/matrix-org/synapse/pull/15630)))
- Limit the size of the `HomeServerConfig` cache in trial test runs. ([\[matrix-org#15646](https://github.com/matrix-org/synapse/pull/15646)]([matrix-org#15646](https://github.com/matrix-org/synapse/pull/15646)))
- Improve type hints. ([\[matrix-org#15658](https://github.com/matrix-org/synapse/pull/15658)]([matrix-org#15658](https://github.com/matrix-org/synapse/pull/15658)), [\[matrix-org#15659](https://github.com/matrix-org/synapse/pull/15659)]([matrix-org#15659](https://github.com/matrix-org/synapse/pull/15659)))
- Add requesting user id parameter to key claim methods in `TransportLayerClient`. ([\[matrix-org#15663](https://github.com/matrix-org/synapse/pull/15663)]([matrix-org#15663](https://github.com/matrix-org/synapse/pull/15663)))
- Speed up rebuilding of the user directory for local users. ([\[matrix-org#15665](https://github.com/matrix-org/synapse/pull/15665)]([matrix-org#15665](https://github.com/matrix-org/synapse/pull/15665)))
- Implement "option 2" for [MSC3820]([matrix-org/matrix-spec-proposals#3820](https://github.com/matrix-org/matrix-spec-proposals/pull/3820)): Room version 11. ([\[matrix-org#15666](https://github.com/matrix-org/synapse/pull/15666)]([matrix-org#15666](https://github.com/matrix-org/synapse/pull/15666)), [\[matrix-org#15678](https://github.com/matrix-org/synapse/pull/15678)]([matrix-org#15678](https://github.com/matrix-org/synapse/pull/15678)))

* Bump furo from 2023.3.27 to 2023.5.20. ([\[matrix-org#15642](https://github.com/matrix-org/synapse/pull/15642)]([matrix-org#15642](https://github.com/matrix-org/synapse/pull/15642)))
* Bump log from 0.4.17 to 0.4.18. ([\[matrix-org#15681](https://github.com/matrix-org/synapse/pull/15681)]([matrix-org#15681](https://github.com/matrix-org/synapse/pull/15681)))
* Bump prometheus-client from 0.16.0 to 0.17.0. ([\[matrix-org#15682](https://github.com/matrix-org/synapse/pull/15682)]([matrix-org#15682](https://github.com/matrix-org/synapse/pull/15682)))
* Bump pydantic from 1.10.7 to 1.10.8. ([\[matrix-org#15685](https://github.com/matrix-org/synapse/pull/15685)]([matrix-org#15685](https://github.com/matrix-org/synapse/pull/15685)))
* Bump pygithub from 1.58.1 to 1.58.2. ([\[matrix-org#15643](https://github.com/matrix-org/synapse/pull/15643)]([matrix-org#15643](https://github.com/matrix-org/synapse/pull/15643)))
* Bump requests from 2.28.2 to 2.31.0. ([\[matrix-org#15651](https://github.com/matrix-org/synapse/pull/15651)]([matrix-org#15651](https://github.com/matrix-org/synapse/pull/15651)))
* Bump sphinx from 6.1.3 to 6.2.1. ([\[matrix-org#15641](https://github.com/matrix-org/synapse/pull/15641)]([matrix-org#15641](https://github.com/matrix-org/synapse/pull/15641)))
* Bump types-bleach from 6.0.0.1 to 6.0.0.3. ([\[matrix-org#15686](https://github.com/matrix-org/synapse/pull/15686)]([matrix-org#15686](https://github.com/matrix-org/synapse/pull/15686)))
* Bump types-pillow from 9.5.0.2 to 9.5.0.4. ([\[matrix-org#15640](https://github.com/matrix-org/synapse/pull/15640)]([matrix-org#15640](https://github.com/matrix-org/synapse/pull/15640)))
* Bump types-pyyaml from 6.0.12.9 to 6.0.12.10. ([\[matrix-org#15683](https://github.com/matrix-org/synapse/pull/15683)]([matrix-org#15683](https://github.com/matrix-org/synapse/pull/15683)))
* Bump types-requests from 2.30.0.0 to 2.31.0.0. ([\[matrix-org#15684](https://github.com/matrix-org/synapse/pull/15684)]([matrix-org#15684](https://github.com/matrix-org/synapse/pull/15684)))
* Bump types-setuptools from 67.7.0.2 to 67.8.0.0. ([\[matrix-org#15639](https://github.com/matrix-org/synapse/pull/15639)]([matrix-org#15639](https://github.com/matrix-org/synapse/pull/15639)))
```

[netbsd-srcmastr](/netbsd-srcmastr)
pushed a commit
to NetBSD/pkgsrc
that referenced
this pull request
[Jun 26, 2023](#ref-commit-724fbbb)
[![@Midar](https://avatars.githubusercontent.com/u/752237?s=40&u=81dfb9be718247c7664693c556bf3fdfb6715545&v=4)](/Midar)

`[Update chat/matrix-synapse to 1.86.0](/NetBSD/pkgsrc/commit/724fbbb1aaa04d9e93ff4b6d91be2fdc7bbf7191 "Update chat/matrix-synapse to 1.86.0

Synapse 1.86.0 (2023-06-20)
===========================

No significant changes since 1.86.0rc2.

Synapse 1.86.0rc2 (2023-06-14)
==============================

Bugfixes
--------

- Fix an error when having workers of different versions running. ([\#15774](https://github.com/matrix-org/synapse/issues/15774))

Synapse 1.86.0rc1 (2023-06-13)
==============================

This version was tagged but never released.

Features
--------

- Stable support for [MSC3882](https://github.com/matrix-org/matrix-spec-proposals/pull/3882) to allow an existing device/session to generate a login token for use on a new device/session. ([\#15388](https://github.com/matrix-org/synapse/issues/15388))
- Support resolving a room's [canonical alias](https://spec.matrix.org/v1.7/client-server-api/#mroomcanonical_alias) via the module API. ([\#15450](https://github.com/matrix-org/synapse/issues/15450))
- Enable support for [MSC3952](https://github.com/matrix-org/matrix-spec-proposals/pull/3952): intentional mentions. ([\#15520](https://github.com/matrix-org/synapse/issues/15520))
- Experimental [MSC3861](https://github.com/matrix-org/matrix-spec-proposals/pull/3861) support: delegate auth to an OIDC provider. ([\#15582](https://github.com/matrix-org/synapse/issues/15582))
- Add Synapse version deploy annotations to Grafana dashboard which enables easy correlation between behavior changes witnessed in a graph to a certain Synapse version and nail down regressions. ([\#15674](https://github.com/matrix-org/synapse/issues/15674))
- Add a catch-all * to the supported relation types when redacting an event and its related events. This is an update to [MSC3912](https://github.com/matrix-org/matrix-spec-proposals/pull/3861) implementation. ([\#15705](https://github.com/matrix-org/synapse/issues/15705))
- Speed up `/messages` by backfilling in the background when there are no backward extremities where we are directly paginating. ([\#15710](https://github.com/matrix-org/synapse/issues/15710))
- Expose a metric reporting the database background update status. ([\#15740](https://github.com/matrix-org/synapse/issues/15740))

Bugfixes
--------

- Correctly clear caches when we delete a room. ([\#15609](https://github.com/matrix-org/synapse/issues/15609))
- Check permissions for enabling encryption earlier during room creation to avoid creating broken rooms. ([\#15695](https://github.com/matrix-org/synapse/issues/15695))

Improved Documentation
----------------------

- Simplify query to find participating servers in a room. ([\#15732](https://github.com/matrix-org/synapse/issues/15732))

Internal Changes
----------------

- Log when events are (maybe unexpectedly) filtered out of responses in tests. ([\#14213](https://github.com/matrix-org/synapse/issues/14213))
- Read from column `full_user_id` rather than `user_id` of tables `profiles` and `user_filters`. ([\#15649](https://github.com/matrix-org/synapse/issues/15649))
- Add support for tracing functions which return `Awaitable`s. ([\#15650](https://github.com/matrix-org/synapse/issues/15650))
- Cache requests for user's devices over federation. ([\#15675](https://github.com/matrix-org/synapse/issues/15675))
- Add fully qualified docker image names to Dockerfiles. ([\#15689](https://github.com/matrix-org/synapse/issues/15689))
- Remove some unused code. ([\#15690](https://github.com/matrix-org/synapse/issues/15690))
- Improve type hints. ([\#15694](https://github.com/matrix-org/synapse/issues/15694), [\#15697](https://github.com/matrix-org/synapse/issues/15697))
- Update docstring and traces on `maybe_backfill()` functions. ([\#15709](https://github.com/matrix-org/synapse/issues/15709))
- Add context for when/why to use the `long_retries` option when sending Federation requests. ([\#15721](https://github.com/matrix-org/synapse/issues/15721))
- Removed some unused fields. ([\#15723](https://github.com/matrix-org/synapse/issues/15723))
- Update federation error to more plainly explain we can only authorize our own membership events. ([\#15725](https://github.com/matrix-org/synapse/issues/15725))
- Prevent the `latest_deps` and `twisted_trunk` daily GitHub Actions workflows from running on forks of the codebase. ([\#15726](https://github.com/matrix-org/synapse/issues/15726))
- Improve performance of user directory search. ([\#15729](https://github.com/matrix-org/synapse/issues/15729))
- Remove redundant table join with `room_memberships` when doing a `is_host_joined()`/`is_host_invited()` call (`membership` is already part of the `current_state_events`). ([\#15731](https://github.com/matrix-org/synapse/issues/15731))
- Remove superfluous `room_memberships` join from background update. ([\#15733](https://github.com/matrix-org/synapse/issues/15733))
- Speed up typechecking CI. ([\#15752](https://github.com/matrix-org/synapse/issues/15752))
- Bump minimum supported Rust version to 1.60.0. ([\#15768](https://github.com/matrix-org/synapse/issues/15768))

### Updates to locked dependencies

* Bump importlib-metadata from 6.1.0 to 6.6.0. ([\#15711](https://github.com/matrix-org/synapse/issues/15711))
* Bump library/redis from 6-bullseye to 7-bullseye in /docker. ([\#15712](https://github.com/matrix-org/synapse/issues/15712))
* Bump log from 0.4.18 to 0.4.19. ([\#15761](https://github.com/matrix-org/synapse/issues/15761))
* Bump phonenumbers from 8.13.11 to 8.13.13. ([\#15763](https://github.com/matrix-org/synapse/issues/15763))
* Bump pyasn1 from 0.4.8 to 0.5.0. ([\#15713](https://github.com/matrix-org/synapse/issues/15713))
* Bump pydantic from 1.10.8 to 1.10.9. ([\#15762](https://github.com/matrix-org/synapse/issues/15762))
* Bump pyo3-log from 0.8.1 to 0.8.2. ([\#15759](https://github.com/matrix-org/synapse/issues/15759))
* Bump pyopenssl from 23.1.1 to 23.2.0. ([\#15765](https://github.com/matrix-org/synapse/issues/15765))
* Bump regex from 1.7.3 to 1.8.4. ([\#15769](https://github.com/matrix-org/synapse/issues/15769))
* Bump sentry-sdk from 1.22.1 to 1.25.0. ([\#15714](https://github.com/matrix-org/synapse/issues/15714))
* Bump sentry-sdk from 1.25.0 to 1.25.1. ([\#15764](https://github.com/matrix-org/synapse/issues/15764))
* Bump serde from 1.0.163 to 1.0.164. ([\#15760](https://github.com/matrix-org/synapse/issues/15760))
* Bump types-jsonschema from 4.17.0.7 to 4.17.0.8. ([\#15716](https://github.com/matrix-org/synapse/issues/15716))
* Bump types-pyopenssl from 23.1.0.2 to 23.2.0.0. ([\#15766](https://github.com/matrix-org/synapse/issues/15766))
* Bump types-requests from 2.31.0.0 to 2.31.0.1. ([\#15715](https://github.com/matrix-org/synapse/issues/15715))

Synapse 1.85.2 (2023-06-08)
===========================

Bugfixes
--------

- Fix regression where using TLS for HTTP replication between workers did not work. Introduced in v1.85.0. ([\#15746](https://github.com/matrix-org/synapse/issues/15746))

Synapse 1.85.1 (2023-06-07)
===========================

Note: this release only fixes a bug that stopped some deployments from upgrading to v1.85.0. There is no need to upgrade to v1.85.1 if successfully running v1.85.0.

Bugfixes
--------

- Fix bug in schema delta that broke upgrades for some deployments. Introduced in v1.85.0. ([\#15738](https://github.com/matrix-org/synapse/issues/15738), [\#15739](https://github.com/matrix-org/synapse/issues/15739))

Synapse 1.85.0 (2023-06-06)
===========================

No significant changes since 1.85.0rc2.

## Security advisory

The following issues are fixed in 1.85.0 (and RCs).

- [GHSA-26c5-ppr8-f33p](https://github.com/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p) / [CVE-2023-32682](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32682) â€” Low Severity

  It may be possible for a deactivated user to login when using uncommon configurations.

- [GHSA-98px-6486-j7qc](https://github.com/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc) / [CVE-2023-32683](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683) â€” Low Severity

  A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs).

See the advisories for more details. If you have any questions, email security@matrix.org.

Synapse 1.85.0rc2 (2023-06-01)
==============================

Bugfixes
--------

- Fix a performance issue introduced in Synapse v1.83.0 which meant that purging rooms was very slow and database-intensive. ([\#15693](https://github.com/matrix-org/synapse/issues/15693))

Deprecations and Removals
-------------------------

- Deprecate calling the `/register` endpoint with an unspecced `user` property for application services. ([\#15703](https://github.com/matrix-org/synapse/issues/15703))

Internal Changes
----------------

- Speed up background jobs `populate_full_user_id_user_filters` and `populate_full_user_id_profiles`. ([\#15700](https://github.com/matrix-org/synapse/issues/15700))

Synapse 1.85.0rc1 (2023-05-30)
==============================

Features
--------

- Improve performance of backfill requests by performing backfill of previously failed requests in the background. ([\#15585](https://github.com/matrix-org/synapse/issues/15585))
- Add a new [admin API](https://matrix-org.github.io/synapse/v1.85/usage/administration/admin_api/index.html) to [create a new device for a user](https://matrix-org.github.io/synapse/v1.85/admin_api/user_admin_api.html#create-a-device). ([\#15611](https://github.com/matrix-org/synapse/issues/15611))
- Add Unix socket support for Redis connections. Contributed by Jason Little. ([\#15644](https://github.com/matrix-org/synapse/issues/15644))

Bugfixes
--------

- Fix a long-standing bug where setting the read marker could fail when using message retention. Contributed by Nick @ Beeper (@fizzadar). ([\#15464](https://github.com/matrix-org/synapse/issues/15464))
- Fix a long-standing bug where the `url_preview_url_blacklist` configuration setting was not applied to oEmbed or image URLs found while previewing a URL. ([\#15601](https://github.com/matrix-org/synapse/issues/15601))
- Fix a long-standing bug where filters with multiple backslashes were rejected. ([\#15607](https://github.com/matrix-org/synapse/issues/15607))
- Fix a bug introduced in Synapse 1.82.0 where the error message displayed when validation of the `app_service_config_files` config option fails would be incorrectly formatted. ([\#15614](https://github.com/matrix-org/synapse/issues/15614))
- Fix a long-standing bug where deactivated users were still able to login using the custom `org.matrix.login.jwt` login type (if enabled). ([\#15624](https://github.com/matrix-org/synapse/issues/15624))
- Fix a long-standing bug where deactivated users were able to login in uncommon situations. ([\#15634](https://github.com/matrix-org/synapse/issues/15634))

Improved Documentation
----------------------

- Warn users that at least 3.75GB of space is needed for the nix Synapse development environment. ([\#15613](https://github.com/matrix-org/synapse/issues/15613))
- Remove outdated comment from the generated and sample homeserver log configs. ([\#15648](https://github.com/matrix-org/synapse/issues/15648))
- Improve contributor docs to make it more clear that Rust is a necessary prerequisite. Contributed by @grantm. ([\#15668](https://github.com/matrix-org/synapse/issues/15668))

Deprecations and Removals
-------------------------

- Remove the old version of the R30 (30-day retained users) phone-home metric. ([\#10428](https://github.com/matrix-org/synapse/issues/10428))

Internal Changes
----------------

- Create dependabot changelogs at release time. ([\#15481](https://github.com/matrix-org/synapse/issues/15481))
- Add not null constraint to column `full_user_id` of tables `profiles` and `user_filters`. ([\#15537](https://github.com/matrix-org/synapse/issues/15537))
- Allow connecting to HTTP Replication Endpoints by using `worker_name` when constructing the request. ([\#15578](https://github.com/matrix-org/synapse/issues/15578))
- Make the `thread_id` column on `event_push_actions`, `event_push_actions_staging`, and `event_push_summary` non-null. ([\#15597](https://github.com/matrix-org/synapse/issues/15597))
- Run mypy type checking with the minimum supported Python version to catch new usage that isn't backwards-compatible. ([\#15602](https://github.com/matrix-org/synapse/issues/15602))
- Fix subscriptable type usage in Python <3.9. ([\#15604](https://github.com/matrix-org/synapse/issues/15604))
- Update internal terminology. ([\#15606](https://github.com/matrix-org/synapse/issues/15606), [\#15620](https://github.com/matrix-org/synapse/issues/15620))
- Instrument `state` and `state_group` storage-related operations to better picture what's happening when tracing. ([\#15610](https://github.com/matrix-org/synapse/issues/15610), [\#15647](https://github.com/matrix-org/synapse/issues/15647))
- Trace how many new events from the backfill response we need to process. ([\#15633](https://github.com/matrix-org/synapse/issues/15633))
- Re-type config paths in `ConfigError`s to be `StrSequence`s instead of `Iterable[str]`s. ([\#15615](https://github.com/matrix-org/synapse/issues/15615))
- Update Mutual Rooms ([MSC2666](https://github.com/matrix-org/matrix-spec-proposals/pull/2666)) implementation to match new proposal text. ([\#15621](https://github.com/matrix-org/synapse/issues/15621))
- Remove the unstable identifiers from faster joins ([MSC3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706)). ([\#15625](https://github.com/matrix-org/synapse/issues/15625))
- Fix the olddeps CI. ([\#15626](https://github.com/matrix-org/synapse/issues/15626))
- Remove duplicate timestamp from test logs (`_trial_temp/test.log`). ([\#15636](https://github.com/matrix-org/synapse/issues/15636))
- Fix two memory leaks in `trial` test runs. ([\#15630](https://github.com/matrix-org/synapse/issues/15630))
- Limit the size of the `HomeServerConfig` cache in trial test runs. ([\#15646](https://github.com/matrix-org/synapse/issues/15646))
- Improve type hints. ([\#15658](https://github.com/matrix-org/synapse/issues/15658), [\#15659](https://github.com/matrix-org/synapse/issues/15659))
- Add requesting user id parameter to key claim methods in `TransportLayerClient`. ([\#15663](https://github.com/matrix-org/synapse/issues/15663))
- Speed up rebuilding of the user directory for local users. ([\#15665](https://github.com/matrix-org/synapse/issues/15665))
- Implement \"option 2\" for [MSC3820](https://github.com/matrix-org/matrix-spec-proposals/pull/3820): Room version 11. ([\#15666](https://github.com/matrix-org/synapse/issues/15666), [\#15678](https://github.com/matrix-org/synapse/issues/15678))

### Updates to locked dependencies

* Bump furo from 2023.3.27 to 2023.5.20. ([\#15642](https://github.com/matrix-org/synapse/issues/15642))
* Bump log from 0.4.17 to 0.4.18. ([\#15681](https://github.com/matrix-org/synapse/issues/15681))
* Bump prometheus-client from 0.16.0 to 0.17.0. ([\#15682](https://github.com/matrix-org/synapse/issues/15682))
* Bump pydantic from 1.10.7 to 1.10.8. ([\#15685](https://github.com/matrix-org/synapse/issues/15685))
* Bump pygithub from 1.58.1 to 1.58.2. ([\#15643](https://github.com/matrix-org/synapse/issues/15643))
* Bump requests from 2.28.2 to 2.31.0. ([\#15651](https://github.com/matrix-org/synapse/issues/15651))
* Bump sphinx from 6.1.3 to 6.2.1. ([\#15641](https://github.com/matrix-org/synapse/issues/15641))
* Bump types-bleach from 6.0.0.1 to 6.0.0.3. ([\#15686](https://github.com/matrix-org/synapse/issues/15686))
* Bump types-pillow from 9.5.0.2 to 9.5.0.4. ([\#15640](https://github.com/matrix-org/synapse/issues/15640))
* Bump types-pyyaml from 6.0.12.9 to 6.0.12.10. ([\#15683](https://github.com/matrix-org/synapse/issues/15683))
* Bump types-requests from 2.30.0.0 to 2.31.0.0. ([\#15684](https://github.com/matrix-org/synapse/issues/15684))
* Bump types-setuptools from 67.7.0.2 to 67.8.0.0. ([\#15639](https://github.com/matrix-org/synapse/issues/15639))

Synapse 1.84.1 (2023-05-26)
===========================

This patch release fixes a major issue with homeservers that do not have an `instance_map` defined but which do use workers.
If you have already upgraded to Synapse 1.84.0 and your homeserver is working normally, then there is no need to update to this patch release.

Bugfixes
--------

- Fix a bug introduced in Synapse v1.84.0 where workers do not start up when no `instance_map` was provided. ([\#15672](https://github.com/matrix-org/synapse/issues/15672))

Internal Changes
----------------

- Add `dch` and `notify-send` to the development Nix flake so that the release script can be used. ([\#15673](https://github.com/matrix-org/synapse/issues/15673))

Synapse 1.84.0 (2023-05-23)
===========================

The `worker_replication_*` configuration settings have been deprecated in favour of configuring the main process consistently with other instances in the `instance_map`. The deprecated settings will be removed in Synapse v1.88.0, but changing your configuration in advance is recommended. See the [upgrade notes](https://github.com/matrix-org/synapse/blob/release-v1.84/docs/upgrade.md#upgrading-to-v1840) for more information.

Bugfixes
--------

- Fix a bug introduced in Synapse 1.84.0rc1 where errors during startup were not reported correctly on Python < 3.10. ([\#15599](https://github.com/matrix-org/synapse/issues/15599))

Synapse 1.84.0rc1 (2023-05-16)
==============================

Features
--------

- Add an option to prevent media downloads from configured domains. ([\#15197](https://github.com/matrix-org/synapse/issues/15197))
- Add `forget_rooms_on_leave` config option to automatically forget rooms when users leave them or are removed from them. ([\#15224](https://github.com/matrix-org/synapse/issues/15224))
- Add redis TLS configuration options. ([\#15312](https://github.com/matrix-org/synapse/issues/15312))
- Add a config option to delay push notifications by a random amount, to discourage time-based profiling. ([\#15516](https://github.com/matrix-org/synapse/issues/15516))
- Stabilize support for [MSC2659](https://github.com/matrix-org/matrix-spec-proposals/pull/2659): application service ping endpoint. Contributed by Tulir @ Beeper. ([\#15528](https://github.com/matrix-org/synapse/issues/15528))
- Implement [MSC4009](https://github.com/matrix-org/matrix-spec-proposals/pull/4009) to expand the supported characters in Matrix IDs. ([\#15536](https://github.com/matrix-org/synapse/issues/15536))
- Advertise support for Matrix 1.6 on `/_matrix/client/versions`. ([\#15559](https://github.com/matrix-org/synapse/issues/15559))
- Print full error and stack-trace of any exception that occurs during startup/initialization. ([\#15569](https://github.com/matrix-org/synapse/issues/15569))

Bugfixes
--------

- Don't fail on federation over TOR where SRV queries are not supported. Contributed by Zdzichu. ([\#15523](https://github.com/matrix-org/synapse/issues/15523))
- Experimental support for [MSC4010](https://github.com/matrix-org/matrix-spec-proposals/pull/4010) which rejects setting the `\"m.push_rules\"` via account data. ([\#15554](https://github.com/matrix-org/synapse/issues/15554), [\#15555](https://github.com/matrix-org/synapse/issues/15555))
- Fix a long-standing bug where an invalid membership event could cause an internal server error. ([\#15564](https://github.com/matrix-org/synapse/issues/15564))
- Require at least poetry-core v1.1.0. ([\#15566](https://github.com/matrix-org/synapse/issues/15566), [\#15571](https://github.com/matrix-org/synapse/issues/15571))

Deprecations and Removals
-------------------------

- Remove need for `worker_replication_*` based settings in worker configuration yaml by placing this data directly on the `instance_map` instead. ([\#15491](https://github.com/matrix-org/synapse/issues/15491))

Updates to the Docker image
---------------------------

- Add pkg-config package to Stage 0 to be able to build Dockerfile on ppc64le architecture. ([\#15567](https://github.com/matrix-org/synapse/issues/15567))

Improved Documentation
----------------------

- Clarify documentation of the \"Create or modify account\" Admin API. ([\#15544](https://github.com/matrix-org/synapse/issues/15544))
- Fix path to the `statistics/database/rooms` admin API in documentation. ([\#15560](https://github.com/matrix-org/synapse/issues/15560))
- Update and improve Mastodon Single Sign-On documentation. ([\#15587](https://github.com/matrix-org/synapse/issues/15587))

Internal Changes
----------------

- Use oEmbed to generate URL previews for YouTube Shorts. ([\#15025](https://github.com/matrix-org/synapse/issues/15025))
- Create new `Client` for use with HTTP Replication between workers. Contributed by Jason Little. ([\#15470](https://github.com/matrix-org/synapse/issues/15470))
- Bump pyicu from 2.10.2 to 2.11. ([\#15509](https://github.com/matrix-org/synapse/issues/15509))
- Remove references to supporting per-user flag for [MSC2654](https://github.com/matrix-org/matrix-spec-proposals/pull/2654). ([\#15522](https://github.com/matrix-org/synapse/issues/15522))
- Don't use a trusted key server when running the demo scripts. ([\#15527](https://github.com/matrix-org/synapse/issues/15527))
- Speed up rebuilding of the user directory for local users. ([\#15529](https://github.com/matrix-org/synapse/issues/15529))
- Speed up deleting of old rows in `event_push_actions`. ([\#15531](https://github.com/matrix-org/synapse/issues/15531))
- Install the `xmlsec` and `mdbook` packages and switch back to the upstream [cachix/devenv](https://github.com/cachix/devenv) repo in the nix development environment. ([\#15532](https://github.com/matrix-org/synapse/issues/15532), [\#15533](https://github.com/matrix-org/synapse/issues/15533), [\#15545](https://github.com/matrix-org/synapse/issues/15545))
- Implement [MSC3987](https://github.com/matrix-org/matrix-spec-proposals/pull/3987) by removing `\"dont_notify\"` from the list of actions in default push rules. ([\#15534](https://github.com/matrix-org/synapse/issues/15534))
- Move various module API callback registration methods to a dedicated class. ([\#15535](https://github.com/matrix-org/synapse/issues/15535))
- Proxy `/user/devices` federation queries to application services for [MSC3984](https://github.com/matrix-org/matrix-spec-proposals/pull/3984). ([\#15539](https://github.com/matrix-org/synapse/issues/15539))
- Factor out an `is_mine_server_name` method. ([\#15542](https://github.com/matrix-org/synapse/issues/15542))
- Allow running Complement tests using [podman](https://podman.io/) by adding a `PODMAN` environment variable to `scripts-dev/complement.sh`. ([\#15543](https://github.com/matrix-org/synapse/issues/15543))
- Bump serde from 1.0.160 to 1.0.162. ([\#15548](https://github.com/matrix-org/synapse/issues/15548))
- Bump types-setuptools from 67.6.0.5 to 67.7.0.1. ([\#15549](https://github.com/matrix-org/synapse/issues/15549))
- Bump sentry-sdk from 1.19.1 to 1.22.1. ([\#15550](https://github.com/matrix-org/synapse/issues/15550))
- Bump ruff from 0.0.259 to 0.0.265. ([\#15551](https://github.com/matrix-org/synapse/issues/15551))
- Bump hiredis from 2.2.2 to 2.2.3. ([\#15552](https://github.com/matrix-org/synapse/issues/15552))
- Bump types-requests from 2.29.0.0 to 2.30.0.0. ([\#15553](https://github.com/matrix-org/synapse/issues/15553))
- Add `org.matrix.msc3981` info to `/_matrix/client/versions`. ([\#15558](https://github.com/matrix-org/synapse/issues/15558))
- Declare unstable support for [MSC3391](https://github.com/matrix-org/matrix-spec-proposals/pull/3391) under `/_matrix/client/versions` if the experimental implementation is enabled. ([\#15562](https://github.com/matrix-org/synapse/issues/15562))
- Implement [MSC3821](https://github.com/matrix-org/matrix-spec-proposals/pull/3821) to update the redaction rules. ([\#15563](https://github.com/matrix-org/synapse/issues/15563))
- Implement updated redaction rules from [MSC3389](https://github.com/matrix-org/matrix-spec-proposals/pull/3389). ([\#15565](https://github.com/matrix-org/synapse/issues/15565))
- Allow `pip install` to use setuptools_rust 1.6.0 when building Synapse. ([\#15570](https://github.com/matrix-org/synapse/issues/15570))
- Deal with upcoming Github Actions deprecations. ([\#15576](https://github.com/matrix-org/synapse/issues/15576))
- Export `run_as_background_process` from the module API. ([\#15577](https://github.com/matrix-org/synapse/issues/15577))
- Update build system requirements to allow building with poetry-core==1.6.0. ([\#15588](https://github.com/matrix-org/synapse/issues/15588))
- Bump serde from 1.0.162 to 1.0.163. ([\#15589](https://github.com/matrix-org/synapse/issues/15589))
- Bump phonenumbers from 8.13.7 to 8.13.11. ([\#15590](https://github.com/matrix-org/synapse/issues/15590))
- Bump types-psycopg2 from 2.9.21.9 to 2.9.21.10. ([\#15591](https://github.com/matrix-org/synapse/issues/15591))
- Bump types-commonmark from 0.9.2.2 to 0.9.2.3. ([\#15592](https://github.com/matrix-org/synapse/issues/15592))
- Bump types-setuptools from 67.7.0.1 to 67.7.0.2. ([\#15594](https://github.com/matrix-org/synapse/issues/15594))

Synapse 1.83.0 (2023-05-09)
===========================

No significant changes since 1.83.0rc1.

Synapse 1.83.0rc1 (2023-05-02)
==============================

Features
--------

- Experimental support to recursively provide relations per [MSC3981](https://github.com/matrix-org/matrix-spec-proposals/pull/3981). ([\#15315](https://github.com/matrix-org/synapse/issues/15315))
- Experimental support for [MSC3970](https://github.com/matrix-org/matrix-spec-proposals/pull/3970): Scope transaction IDs to devices. ([\#15318](https://github.com/matrix-org/synapse/issues/15318))
- Add an [admin API endpoint](https://matrix-org.github.io/synapse/v1.83/admin_api/experimental_features.html) to support per-user feature flags. ([\#15344](https://github.com/matrix-org/synapse/issues/15344))
- Add a module API to send an HTTP push notification. ([\#15387](https://github.com/matrix-org/synapse/issues/15387))
- Add an [admin API endpoint](https://matrix-org.github.io/synapse/v1.83/admin_api/statistics.html#get-largest-rooms-by-size-in-database) to query the largest rooms by disk space used in the database. ([\#15482](https://github.com/matrix-org/synapse/issues/15482))

Bugfixes
--------

- Disable push rule evaluation for rooms excluded from sync. ([\#15361](https://github.com/matrix-org/synapse/issues/15361))
- Fix a long-standing bug where cached server key results which were directly fetched would not be properly re-used. ([\#15417](https://github.com/matrix-org/synapse/issues/15417))
- Fix a bug introduced in Synapse 1.73.0 where some experimental push rules were returned by default. ([\#15494](https://github.com/matrix-org/synapse/issues/15494))

Improved Documentation
----------------------

- Add Nginx loadbalancing example with sticky mxid for workers. ([\#15411](https://github.com/matrix-org/synapse/issues/15411))
- Update outdated development docs that mention restrictions in versions of SQLite that we no longer support. ([\#15498](https://github.com/matrix-org/synapse/issues/15498))

Internal Changes
----------------

- Speedup tests by caching HomeServerConfig instances. ([\#15284](https://github.com/matrix-org/synapse/issues/15284))
- Add denormalised event stream ordering column to membership state tables for future use. Contributed by Nick @ Beeper (@fizzadar). ([\#15356](https://github.com/matrix-org/synapse/issues/15356))
- Always use multi-user device resync replication endpoints. ([\#15418](https://github.com/matrix-org/synapse/issues/15418))
- Add column `full_user_id` to tables `profiles` and `user_filters`. ([\#15458](https://github.com/matrix-org/synapse/issues/15458))
- Update support for [MSC3983](https://github.com/matrix-org/matrix-spec-proposals/pull/3983) to allow always returning fallback-keys in a `/keys/claim` request. ([\#15462](https://github.com/matrix-org/synapse/issues/15462))
- Improve type hints. ([\#15465](https://github.com/matrix-org/synapse/issues/15465), [\#15496](https://github.com/matrix-org/synapse/issues/15496), [\#15497](https://github.com/matrix-org/synapse/issues/15497))
- Support claiming more than one OTK at a time. ([\#15468](https://github.com/matrix-org/synapse/issues/15468))
- Bump types-pyyaml from 6.0.12.8 to 6.0.12.9. ([\#15471](https://github.com/matrix-org/synapse/issues/15471))
- Bump pyasn1-modules from 0.2.8 to 0.3.0. ([\#15473](https://github.com/matrix-org/synapse/issues/15473))
- Bump cryptography from 40.0.1 to 40.0.2. ([\#15474](https://github.com/matrix-org/synapse/issues/15474))
- Bump types-netaddr from 0.8.0.7 to 0.8.0.8. ([\#15475](https://github.com/matrix-org/synapse/issues/15475))
- Bump types-jsonschema from 4.17.0.6 to 4.17.0.7. ([\#15476](https://github.com/matrix-org/synapse/issues/15476))
- Ask bug reporters to provide logs as text. ([\#15479](https://github.com/matrix-org/synapse/issues/15479))
- Add a Nix flake for use as a development environment. ([\#15495](https://github.com/matrix-org/synapse/issues/15495))
- Bump anyhow from 1.0.70 to 1.0.71. ([\#15507](https://github.com/matrix-org/synapse/issues/15507))
- Bump types-pillow from 9.4.0.19 to 9.5.0.2. ([\#15508](https://github.com/matrix-org/synapse/issues/15508))
- Bump packaging from 23.0 to 23.1. ([\#15510](https://github.com/matrix-org/synapse/issues/15510))
- Bump types-requests from 2.28.11.16 to 2.29.0.0. ([\#15511](https://github.com/matrix-org/synapse/issues/15511))
- Bump setuptools-rust from 1.5.2 to 1.6.0. ([\#15512](https://github.com/matrix-org/synapse/issues/15512))
- Update the check_schema_delta script to account for when the schema version has been bumped locally. ([\#15466](https://github.com/matrix-org/synapse/issues/15466))

Synapse 1.82.0 (2023-04-25)
===========================

No significant changes since 1.82.0rc1.

Synapse 1.82.0rc1 (2023-04-18)
==============================

Features
--------

- Allow loading the `/directory/room/{roomAlias}` endpoint on workers. ([\#15333](https://github.com/matrix-org/synapse/issues/15333))
- Add some validation to `instance_map` configuration loading. ([\#15431](https://github.com/matrix-org/synapse/issues/15431))
- Allow loading the `/capabilities` endpoint on workers. ([\#15436](https://github.com/matrix-org/synapse/issues/15436))

Bugfixes
--------

- Delete server-side backup keys when deactivating an account. ([\#15181](https://github.com/matrix-org/synapse/issues/15181))
- Fix and document untold assumption that `on_logged_out` module hooks will be called before the deletion of pushers. ([\#15410](https://github.com/matrix-org/synapse/issues/15410))
- Improve robustness when handling a perspective key response by deduplicating received server keys. ([\#15423](https://github.com/matrix-org/synapse/issues/15423))
- Synapse now correctly fails to start if the config option `app_service_config_files` is not a list. ([\#15425](https://github.com/matrix-org/synapse/issues/15425))
- Disable loading `RefreshTokenServlet` (`/_matrix/client/(r0|v3|unstable)/refresh`) on workers. ([\#15428](https://github.com/matrix-org/synapse/issues/15428))

Improved Documentation
----------------------

- Note that the `delete_stale_devices_after` background job always runs on the main process. ([\#15452](https://github.com/matrix-org/synapse/issues/15452))

Deprecations and Removals
-------------------------

- Remove the broken, unspecced registration fallback. Note that the *login* fallback is unaffected by this change. ([\#15405](https://github.com/matrix-org/synapse/issues/15405))

Internal Changes
----------------

- Bump black from 23.1.0 to 23.3.0. ([\#15372](https://github.com/matrix-org/synapse/issues/15372))
- Bump pyopenssl from 23.1.0 to 23.1.1. ([\#15373](https://github.com/matrix-org/synapse/issues/15373))
- Bump types-psycopg2 from 2.9.21.8 to 2.9.21.9. ([\#15374](https://github.com/matrix-org/synapse/issues/15374))
- Bump types-netaddr from 0.8.0.6 to 0.8.0.7. ([\#15375](https://github.com/matrix-org/synapse/issues/15375))
- Bump types-opentracing from 2.4.10.3 to 2.4.10.4. ([\#15376](https://github.com/matrix-org/synapse/issues/15376))
- Bump dawidd6/action-download-artifact from 2.26.0 to 2.26.1. ([\#15404](https://github.com/matrix-org/synapse/issues/15404))
- Bump parameterized from 0.8.1 to 0.9.0. ([\#15412](https://github.com/matrix-org/synapse/issues/15412))
- Bump types-pillow from 9.4.0.17 to 9.4.0.19. ([\#15413](https://github.com/matrix-org/synapse/issues/15413))
- Bump sentry-sdk from 1.17.0 to 1.19.1. ([\#15414](https://github.com/matrix-org/synapse/issues/15414))
- Bump immutabledict from 2.2.3 to 2.2.4. ([\#15415](https://github.com/matrix-org/synapse/issues/15415))
- Bump dawidd6/action-download-artifact from 2.26.1 to 2.27.0. ([\#15441](https://github.com/matrix-org/synapse/issues/15441))
- Bump serde_json from 1.0.95 to 1.0.96. ([\#15442](https://github.com/matrix-org/synapse/issues/15442))
- Bump serde from 1.0.159 to 1.0.160. ([\#15443](https://github.com/matrix-org/synapse/issues/15443))
- Bump pillow from 9.4.0 to 9.5.0. ([\#15444](https://github.com/matrix-org/synapse/issues/15444))
- Bump furo from 2023.3.23 to 2023.3.27. ([\#15445](https://github.com/matrix-org/synapse/issues/15445))
- Bump types-pyopenssl from 23.1.0.0 to 23.1.0.2. ([\#15446](https://github.com/matrix-org/synapse/issues/15446))
- Bump mypy from 1.0.0 to 1.0.1. ([\#15447](https://github.com/matrix-org/synapse/issues/15447))
- Bump psycopg2 from 2.9.5 to 2.9.6. ([\#15448](https://github.com/matrix-org/synapse/issues/15448))
- Improve DB performance of clearing out old data from `stream_ordering_to_exterm`. ([\#15382](https://github.com/matrix-org/synapse/issues/15382), [\#15429](https://github.com/matrix-org/synapse/issues/15429))
- Implement [MSC3989](https://github.com/matrix-org/matrix-spec-proposals/pull/3989) redaction algorithm. ([\#15393](https://github.com/matrix-org/synapse/issues/15393))
- Implement [MSC2175](https://github.com/matrix-org/matrix-doc/pull/2175) to stop adding `creator` to create events. ([\#15394](https://github.com/matrix-org/synapse/issues/15394))
- Implement [MSC2174](https://github.com/matrix-org/matrix-spec-proposals/pull/2174) to move the `redacts` key to a `content` property. ([\#15395](https://github.com/matrix-org/synapse/issues/15395))
- Trust dtonlay/rust-toolchain in CI. ([\#15406](https://github.com/matrix-org/synapse/issues/15406))
- Explicitly install Synapse during typechecking in CI. ([\#15409](https://github.com/matrix-org/synapse/issues/15409))
- Only load the SSO redirect servlet if SSO is enabled. ([\#15421](https://github.com/matrix-org/synapse/issues/15421))
- Refactor `SimpleHttpClient` to pull out a base class. ([\#15427](https://github.com/matrix-org/synapse/issues/15427))
- Improve type hints. ([\#15432](https://github.com/matrix-org/synapse/issues/15432))
- Convert async to normal tests in `TestSSOHandler`. ([\#15433](https://github.com/matrix-org/synapse/issues/15433))
- Speed up the user directory background update. ([\#15435](https://github.com/matrix-org/synapse/issues/15435))
- Disable directory listing for static resources in `/_matrix/static/`. ([\#15438](https://github.com/matrix-org/synapse/issues/15438))
- Move various module API callback registration methods to a dedicated class. ([\#15453](https://github.com/matrix-org/synapse/issues/15453))

Synapse 1.81.0 (2023-04-11)
===========================

Synapse now attempts the versioned appservice paths before falling back to the
[legacy paths](https://spec.matrix.org/v1.6/application-service-api/#legacy-routes).
Usage of the legacy routes should be considered deprecated.

Additionally, Synapse has supported sending the application service access token
via [the `Authorization` header](https://spec.matrix.org/v1.6/application-service-api/#authorization)
since v1.70.0. For backwards compatibility it is *also* sent as the `access_token`
query parameter. This is insecure and should be considered deprecated.

A future version of Synapse (v1.88.0 or later) will remove support for legacy
application service routes and query parameter authorization.

No significant changes since 1.81.0rc2.

Synapse 1.81.0rc2 (2023-04-06)
==============================

Bugfixes
--------

- Fix the `set_device_id_for_pushers_txn` background update crash. ([\#15391](https://github.com/matrix-org/synapse/issues/15391))

Internal Changes
----------------

- Update CI to run complement under the latest stable go version. ([\#15403](https://github.com/matrix-org/synapse/issues/15403))

Synapse 1.81.0rc1 (2023-04-04)
==============================

Features
--------

- Add the ability to enable/disable registrations when in the OIDC flow. ([\#14978](https://github.com/matrix-org/synapse/issues/14978))
- Add a primitive helper script for listing worker endpoints. ([\#15243](https://github.com/matrix-org/synapse/issues/15243))
- Experimental support for passing One Time Key and device key requests to application services ([MSC3983](https://github.com/matrix-org/matrix-spec-proposals/pull/3983) and [MSC3984](https://github.com/matrix-org/matrix-spec-proposals/pull/3984)). ([\#15314](https://github.com/matrix-org/synapse/issues/15314), [\#15321](https://github.com/matrix-org/synapse/issues/15321))
- Allow loading `/password_policy` endpoint on workers. ([\#15331](https://github.com/matrix-org/synapse/issues/15331))
- Add experimental support for Unix sockets. Contributed by Jason Little. ([\#15353](https://github.com/matrix-org/synapse/issues/15353))
- Build Debian packages for Ubuntu 23.04 (Lunar Lobster). ([\#15381](https://github.com/matrix-org/synapse/issues/15381))

Bugfixes
--------

- Fix a long-standing bug where edits of non-`m.room.message` events would not be correctly bundled. ([\#15295](https://github.com/matrix-org/synapse/issues/15295))
- Fix a bug introduced in Synapse v1.55.0 which could delay remote homeservers being able to decrypt encrypted messages sent by local users. ([\#15297](https://github.com/matrix-org/synapse/issues/15297))
- Add a check to [SQLite port_db script](https://matrix-org.github.io/synapse/latest/postgres.html#porting-from-sqlite)
  to ensure that the sqlite database passed to the script exists before trying to port from it. ([\#15306](https://github.com/matrix-org/synapse/issues/15306))
- Fix a bug introduced in Synapse 1.76.0 where responses from worker deployments could include an internal `_INT_STREAM_POS` key. ([\#15309](https://github.com/matrix-org/synapse/issues/15309))
- Fix a long-standing bug that Synpase only used the [legacy appservice routes](https://spec.matrix.org/v1.6/application-service-api/#legacy-routes). ([\#15317](https://github.com/matrix-org/synapse/issues/15317))
- Fix a long-standing bug preventing users from rejoining rooms after being banned and unbanned over federation. Contributed by Nico. ([\#15323](https://github.com/matrix-org/synapse/issues/15323))
- Fix bug in worker mode where on a rolling restart of workers the \"typing\" worker would consume 100% CPU until it got restarted. ([\#15332](https://github.com/matrix-org/synapse/issues/15332))
- Fix a long-standing bug where some to_device messages could be dropped when using workers. ([\#15349](https://github.com/matrix-org/synapse/issues/15349))
- Fix a bug introduced in Synapse 1.70.0 where the background sync from a faster join could spin for hours when one of the events involved had been marked for backoff. ([\#15351](https://github.com/matrix-org/synapse/issues/15351))
- Fix missing app variable in mail subject for password resets. Contributed by Cyberes. ([\#15352](https://github.com/matrix-org/synapse/issues/15352))
- Fix a rare bug introduced in Synapse 1.66.0 where initial syncs would fail when the user had been kicked from a faster joined room that had not finished syncing. ([\#15383](https://github.com/matrix-org/synapse/issues/15383))

Improved Documentation
----------------------

- Fix a typo in login requests ratelimit defaults. ([\#15341](https://github.com/matrix-org/synapse/issues/15341))
- Add some clarification to the doc/comments regarding TCP replication. ([\#15354](https://github.com/matrix-org/synapse/issues/15354))
- Note that Synapse 1.74 queued a rebuild of the user directory tables. ([\#15386](https://github.com/matrix-org/synapse/issues/15386))

Internal Changes
----------------

- Use `immutabledict` instead of `frozendict`. ([\#15113](https://github.com/matrix-org/synapse/issues/15113))
- Add developer documentation for the Federation Sender and add a documentation mechanism using Sphinx. ([\#15265](https://github.com/matrix-org/synapse/issues/15265), [\#15336](https://github.com/matrix-org/synapse/issues/15336))
- Make the pushers rely on the `device_id` instead of the `access_token_id` for various operations. ([\#15280](https://github.com/matrix-org/synapse/issues/15280))
- Bump sentry-sdk from 1.15.0 to 1.17.0. ([\#15285](https://github.com/matrix-org/synapse/issues/15285))
- Allow running the Twisted trunk job against other branches. ([\#15302](https://github.com/matrix-org/synapse/issues/15302))
- Remind the releaser to ask for changelog feedback in [#synapse-dev](https://matrix.to/#/#synapse-dev:matrix.org). ([\#15303](https://github.com/matrix-org/synapse/issues/15303))
- Bump dtolnay/rust-toolchain from e12eda571dc9a5ee5d58eecf4738ec291c66f295 to fc3253060d0c959bea12a59f10f8391454a0b02d. ([\#15304](https://github.com/matrix-org/synapse/issues/15304))
- Reject events with an invalid \"mentions\" property per [MSC3952](https://github.com/matrix-org/matrix-spec-proposals/pull/3952). ([\#15311](https://github.com/matrix-org/synapse/issues/15311))
- As an optimisation, use `TRUNCATE` on Postgres when clearing the user directory tables. ([\#15316](https://github.com/matrix-org/synapse/issues/15316))
- Fix `.gitignore` rule for the Complement source tarball downloaded automatically by `complement.sh`. ([\#15319](https://github.com/matrix-org/synapse/issues/15319))
- Bump serde from 1.0.157 to 1.0.158. ([\#15324](https://github.com/matrix-org/synapse/issues/15324))
- Bump regex from 1.7.1 to 1.7.3. ([\#15325](https://github.com/matrix-org/synapse/issues/15325))
- Bump types-pyopenssl from 23.0.0.4 to 23.1.0.0. ([\#15326](https://github.com/matrix-org/synapse/issues/15326))
- Bump furo from 2022.12.7 to 2023.3.23. ([\#15327](https://github.com/matrix-org/synapse/issues/15327))
- Bump ruff from 0.0.252 to 0.0.259. ([\#15328](https://github.com/matrix-org/synapse/issues/15328))
- Bump cryptography from 40.0.0 to 40.0.1. ([\#15329](https://github.com/matrix-org/synapse/issues/15329))
- Bump mypy-zope from 0.9.0 to 0.9.1. ([\#15330](https://github.com/matrix-org/synapse/issues/15330))
- Speed up unit tests when using SQLite3. ([\#15334](https://github.com/matrix-org/synapse/issues/15334))
- Speed up pydantic CI job. ([\#15339](https://github.com/matrix-org/synapse/issues/15339))
- Speed up sample config CI job. ([\#15340](https://github.com/matrix-org/synapse/issues/15340))
- Fix copyright year in SSO footer template. ([\#15358](https://github.com/matrix-org/synapse/issues/15358))
- Bump peaceiris/actions-gh-pages from 3.9.2 to 3.9.3. ([\#15369](https://github.com/matrix-org/synapse/issues/15369))
- Bump serde from 1.0.158 to 1.0.159. ([\#15370](https://github.com/matrix-org/synapse/issues/15370))
- Bump serde_json from 1.0.94 to 1.0.95. ([\#15371](https://github.com/matrix-org/synapse/issues/15371))
- Speed up membership queries for users with forgotten rooms. ([\#15385](https://github.com/matrix-org/synapse/issues/15385))")`
â€¦

`[724fbbb](/NetBSD/pkgsrc/commit/724fbbb1aaa04d9e93ff4b6d91be2fdc7bbf7191)`

```
Synapse 1.86.0 (2023-06-20)
===========================

No significant changes since 1.86.0rc2.

Synapse 1.86.0rc2 (2023-06-14)
==============================

Bugfixes
--------

- Fix an error when having workers of different versions running. ([\#15774]([matrix-org/synapse#15774](https://github.com/matrix-org/synapse/pull/15774)))

Synapse 1.86.0rc1 (2023-06-13)
==============================

This version was tagged but never released.

Features
--------

- Stable support for [MSC3882]([matrix-org/matrix-spec-proposals#3882](https://github.com/matrix-org/matrix-spec-proposals/pull/3882)) to allow an existing device/session to generate a login token for use on a new device/session. ([\#15388]([matrix-org/synapse#15388](https://github.com/matrix-org/synapse/pull/15388)))
- Support resolving a room's [canonical alias](<https://spec.matrix.org/v1.7/client-server-api/#mroomcanonical_alias>) via the module API. ([\#15450]([matrix-org/synapse#15450](https://github.com/matrix-org/synapse/pull/15450)))
- Enable support for [MSC3952]([matrix-org/matrix-spec-proposals#3952](https://github.com/matrix-org/matrix-spec-proposals/pull/3952)): intentional mentions. ([\#15520]([matrix-org/synapse#15520](https://github.com/matrix-org/synapse/pull/15520)))
- Experimental [MSC3861]([matrix-org/matrix-spec-proposals#3861](https://github.com/matrix-org/matrix-spec-proposals/pull/3861)) support: delegate auth to an OIDC provider. ([\#15582]([matrix-org/synapse#15582](https://github.com/matrix-org/synapse/pull/15582)))
- Add Synapse version deploy annotations to Grafana dashboard which enables easy correlation between behavior changes witnessed in a graph to a certain Synapse version and nail down regressions. ([\#15674]([matrix-org/synapse#15674](https://github.com/matrix-org/synapse/pull/15674)))
- Add a catch-all * to the supported relation types when redacting an event and its related events. This is an update to [MSC3912]([matrix-org/matrix-spec-proposals#3861](https://github.com/matrix-org/matrix-spec-proposals/pull/3861)) implementation. ([\#15705]([matrix-org/synapse#15705](https://github.com/matrix-org/synapse/pull/15705)))
- Speed up `/messages` by backfilling in the background when there are no backward extremities where we are directly paginating. ([\#15710]([matrix-org/synapse#15710](https://github.com/matrix-org/synapse/pull/15710)))
- Expose a metric reporting the database background update status. ([\#15740]([matrix-org/synapse#15740](https://github.com/matrix-org/synapse/pull/15740)))

Bugfixes
--------

- Correctly clear caches when we delete a room. ([\#15609]([matrix-org/synapse#15609](https://github.com/matrix-org/synapse/pull/15609)))
- Check permissions for enabling encryption earlier during room creation to avoid creating broken rooms. ([\#15695]([matrix-org/synapse#15695](https://github.com/matrix-org/synapse/pull/15695)))

Improved Documentation
----------------------

- Simplify query to find participating servers in a room. ([\#15732]([matrix-org/synapse#15732](https://github.com/matrix-org/synapse/pull/15732)))

Internal Changes
----------------

- Log when events are (maybe unexpectedly) filtered out of responses in tests. ([\#14213]([matrix-org/synapse#14213](https://github.com/matrix-org/synapse/pull/14213)))
- Read from column `full_user_id` rather than `user_id` of tables `profiles` and `user_filters`. ([\#15649]([matrix-org/synapse#15649](https://github.com/matrix-org/synapse/pull/15649)))
- Add support for tracing functions which return `Awaitable`s. ([\#15650]([matrix-org/synapse#15650](https://github.com/matrix-org/synapse/pull/15650)))
- Cache requests for user's devices over federation. ([\#15675]([matrix-org/synapse#15675](https://github.com/matrix-org/synapse/pull/15675)))
- Add fully qualified docker image names to Dockerfiles. ([\#15689]([matrix-org/synapse#15689](https://github.com/matrix-org/synapse/pull/15689)))
- Remove some unused code. ([\#15690]([matrix-org/synapse#15690](https://github.com/matrix-org/synapse/pull/15690)))
- Improve type hints. ([\#15694]([matrix-org/synapse#15694](https://github.com/matrix-org/synapse/pull/15694)), [\#15697]([matrix-org/synapse#15697](https://github.com/matrix-org/synapse/pull/15697)))
- Update docstring and traces on `maybe_backfill()` functions. ([\#15709]([matrix-org/synapse#15709](https://github.com/matrix-org/synapse/pull/15709)))
- Add context for when/why to use the `long_retries` option when sending Federation requests. ([\#15721]([matrix-org/synapse#15721](https://github.com/matrix-org/synapse/pull/15721)))
- Removed some unused fields. ([\#15723]([matrix-org/synapse#15723](https://github.com/matrix-org/synapse/pull/15723)))
- Update federation error to more plainly explain we can only authorize our own membership events. ([\#15725]([matrix-org/synapse#15725](https://github.com/matrix-org/synapse/pull/15725)))
- Prevent the `latest_deps` and `twisted_trunk` daily GitHub Actions workflows from running on forks of the codebase. ([\#15726]([matrix-org/synapse#15726](https://github.com/matrix-org/synapse/pull/15726)))
- Improve performance of user directory search. ([\#15729]([matrix-org/synapse#15729](https://github.com/matrix-org/synapse/pull/15729)))
- Remove redundant table join with `room_memberships` when doing a `is_host_joined()`/`is_host_invited()` call (`membership` is already part of the `current_state_events`). ([\#15731]([matrix-org/synapse#15731](https://github.com/matrix-org/synapse/pull/15731)))
- Remove superfluous `room_memberships` join from background update. ([\#15733]([matrix-org/synapse#15733](https://github.com/matrix-org/synapse/pull/15733)))
- Speed up typechecking CI. ([\#15752]([matrix-org/synapse#15752](https://github.com/matrix-org/synapse/pull/15752)))
- Bump minimum supported Rust version to 1.60.0. ([\#15768]([matrix-org/synapse#15768](https://github.com/matrix-org/synapse/pull/15768)))

### Updates to locked dependencies

* Bump importlib-metadata from 6.1.0 to 6.6.0. ([\#15711]([matrix-org/synapse#15711](https://github.com/matrix-org/synapse/pull/15711)))
* Bump library/redis from 6-bullseye to 7-bullseye in /docker. ([\#15712]([matrix-org/synapse#15712](https://github.com/matrix-org/synapse/pull/15712)))
* Bump log from 0.4.18 to 0.4.19. ([\#15761]([matrix-org/synapse#15761](https://github.com/matrix-org/synapse/pull/15761)))
* Bump phonenumbers from 8.13.11 to 8.13.13. ([\#15763]([matrix-org/synapse#15763](https://github.com/matrix-org/synapse/pull/15763)))
* Bump pyasn1 from 0.4.8 to 0.5.0. ([\#15713]([matrix-org/synapse#15713](https://github.com/matrix-org/synapse/pull/15713)))
* Bump pydantic from 1.10.8 to 1.10.9. ([\#15762]([matrix-org/synapse#15762](https://github.com/matrix-org/synapse/pull/15762)))
* Bump pyo3-log from 0.8.1 to 0.8.2. ([\#15759]([matrix-org/synapse#15759](https://github.com/matrix-org/synapse/pull/15759)))
* Bump pyopenssl from 23.1.1 to 23.2.0. ([\#15765]([matrix-org/synapse#15765](https://github.com/matrix-org/synapse/pull/15765)))
* Bump regex from 1.7.3 to 1.8.4. ([\#15769]([matrix-org/synapse#15769](https://github.com/matrix-org/synapse/pull/15769)))
* Bump sentry-sdk from 1.22.1 to 1.25.0. ([\#15714]([matrix-org/synapse#15714](https://github.com/matrix-org/synapse/pull/15714)))
* Bump sentry-sdk from 1.25.0 to 1.25.1. ([\#15764]([matrix-org/synapse#15764](https://github.com/matrix-org/synapse/pull/15764)))
* Bump serde from 1.0.163 to 1.0.164. ([\#15760]([matrix-org/synapse#15760](https://github.com/matrix-org/synapse/pull/15760)))
* Bump types-jsonschema from 4.17.0.7 to 4.17.0.8. ([\#15716]([matrix-org/synapse#15716](https://github.com/matrix-org/synapse/pull/15716)))
* Bump types-pyopenssl from 23.1.0.2 to 23.2.0.0. ([\#15766]([matrix-org/synapse#15766](https://github.com/matrix-org/synapse/pull/15766)))
* Bump types-requests from 2.31.0.0 to 2.31.0.1. ([\#15715]([matrix-org/synapse#15715](https://github.com/matrix-org/synapse/pull/15715)))

Synapse 1.85.2 (2023-06-08)
===========================

Bugfixes
--------

- Fix regression where using TLS for HTTP replication between workers did not work. Introduced in v1.85.0. ([\#15746]([matrix-org/synapse#15746](https://github.com/matrix-org/synapse/pull/15746)))

Synapse 1.85.1 (2023-06-07)
===========================

Note: this release only fixes a bug that stopped some deployments from upgrading to v1.85.0. There is no need to upgrade to v1.85.1 if successfully running v1.85.0.

Bugfixes
--------

- Fix bug in schema delta that broke upgrades for some deployments. Introduced in v1.85.0. ([\#15738]([matrix-org/synapse#15738](https://github.com/matrix-org/synapse/pull/15738)), [\#15739]([matrix-org/synapse#15739](https://github.com/matrix-org/synapse/pull/15739)))

Synapse 1.85.0 (2023-06-06)
===========================

No significant changes since 1.85.0rc2.

## Security advisory

The following issues are fixed in 1.85.0 (and RCs).

- [[GHSA-26c5-ppr8-f33p](https://github.com/advisories/GHSA-26c5-ppr8-f33p "GHSA-26c5-ppr8-f33p")]([GHSA-26c5-ppr8-f33p](https://github.com/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p "GHSA-26c5-ppr8-f33p")) / [[CVE-2023-32682](https://github.com/advisories/GHSA-26c5-ppr8-f33p "CVE-2023-32682")](<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32682>) â€” Low Severity

  It may be possible for a deactivated user to login when using uncommon configurations.

- [[GHSA-98px-6486-j7qc](https://github.com/advisories/GHSA-98px-6486-j7qc "GHSA-98px-6486-j7qc")]([GHSA-98px-6486-j7qc](https://github.com/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc "GHSA-98px-6486-j7qc")) / [[CVE-2023-32683](https://github.com/advisories/GHSA-98px-6486-j7qc "CVE-2023-32683")](<https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-32683>) â€” Low Severity

  A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs).

See the advisories for more details. If you have any questions, email security@matrix.org.

Synapse 1.85.0rc2 (2023-06-01)
==============================

Bugfixes
--------

- Fix a performance issue introduced in Synapse v1.83.0 which meant that purging rooms was very slow and database-intensive. ([\#15693]([matrix-org/synapse#15693](https://github.com/matrix-org/synapse/pull/15693)))

Deprecations and Removals
-------------------------

- Deprecate calling the `/register` endpoint with an unspecced `user` property for application services. ([\#15703]([matrix-org/synapse#15703](https://github.com/matrix-org/synapse/pull/15703)))

Internal Changes
----------------

- Speed up background jobs `populate_full_user_id_user_filters` and `populate_full_user_id_profiles`. ([\#15700]([matrix-org/synapse#15700](https://github.com/matrix-org/synapse/pull/15700)))

Synapse 1.85.0rc1 (2023-05-30)
==============================

Features
--------

- Improve performance of backfill requests by performing backfill of previously failed requests in the background. ([\#15585]([matrix-org/synapse#15585](https://github.com/matrix-org/synapse/pull/15585)))
- Add a new [admin API](<https://matrix-org.github.io/synapse/v1.85/usage/administration/admin_api/index.html>) to [create a new device for a user](<https://matrix-org.github.io/synapse/v1.85/admin_api/user_admin_api.html#create-a-device>). ([\#15611]([matrix-org/synapse#15611](https://github.com/matrix-org/synapse/pull/15611)))
- Add Unix socket support for Redis connections. Contributed by Jason Little. ([\#15644]([matrix-org/synapse#15644](https://github.com/matrix-org/synapse/pull/15644)))

Bugfixes
--------

- Fix a long-standing bug where setting the read marker could fail when using message retention. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\#15464]([matrix-org/synapse#15464](https://github.com/matrix-org/synapse/pull/15464)))
- Fix a long-standing bug where the `url_preview_url_blacklist` configuration setting was not applied to oEmbed or image URLs found while previewing a URL. ([\#15601]([matrix-org/synapse#15601](https://github.com/matrix-org/synapse/pull/15601)))
- Fix a long-standing bug where filters with multiple backslashes were rejected. ([\#15607]([matrix-org/synapse#15607](https://github.com/matrix-org/synapse/pull/15607)))
- Fix a bug introduced in Synapse 1.82.0 where the error message displayed when validation of the `app_service_config_files` config option fails would be incorrectly formatted. ([\#15614]([matrix-org/synapse#15614](https://github.com/matrix-org/synapse/pull/15614)))
- Fix a long-standing bug where deactivated users were still able to login using the custom `org.matrix.login.jwt` login type (if enabled). ([\#15624]([matrix-org/synapse#15624](https://github.com/matrix-org/synapse/pull/15624)))
- Fix a long-standing bug where deactivated users were able to login in uncommon situations. ([\#15634]([matrix-org/synapse#15634](https://github.com/matrix-org/synapse/pull/15634)))

Improved Documentation
----------------------

- Warn users that at least 3.75GB of space is needed for the nix Synapse development environment. ([\#15613]([matrix-org/synapse#15613](https://github.com/matrix-org/synapse/pull/15613)))
- Remove outdated comment from the generated and sample homeserver log configs. ([\#15648]([matrix-org/synapse#15648](https://github.com/matrix-org/synapse/pull/15648)))
- Improve contributor docs to make it more clear that Rust is a necessary prerequisite. Contributed by [@grantm](https://github.com/grantm). ([\#15668]([matrix-org/synapse#15668](https://github.com/matrix-org/synapse/pull/15668)))

Deprecations and Removals
-------------------------

- Remove the old version of the R30 (30-day retained users) phone-home metric. ([\#10428]([matrix-org/synapse#10428](https://github.com/matrix-org/synapse/pull/10428)))

Internal Changes
----------------

- Create dependabot changelogs at release time. ([\#15481]([matrix-org/synapse#15481](https://github.com/matrix-org/synapse/pull/15481)))
- Add not null constraint to column `full_user_id` of tables `profiles` and `user_filters`. ([\#15537]([matrix-org/synapse#15537](https://github.com/matrix-org/synapse/pull/15537)))
- Allow connecting to HTTP Replication Endpoints by using `worker_name` when constructing the request. ([\#15578]([matrix-org/synapse#15578](https://github.com/matrix-org/synapse/pull/15578)))
- Make the `thread_id` column on `event_push_actions`, `event_push_actions_staging`, and `event_push_summary` non-null. ([\#15597]([matrix-org/synapse#15597](https://github.com/matrix-org/synapse/pull/15597)))
- Run mypy type checking with the minimum supported Python version to catch new usage that isn't backwards-compatible. ([\#15602]([matrix-org/synapse#15602](https://github.com/matrix-org/synapse/pull/15602)))
- Fix subscriptable type usage in Python <3.9. ([\#15604]([matrix-org/synapse#15604](https://github.com/matrix-org/synapse/pull/15604)))
- Update internal terminology. ([\#15606]([matrix-org/synapse#15606](https://github.com/matrix-org/synapse/pull/15606)), [\#15620]([matrix-org/synapse#15620](https://github.com/matrix-org/synapse/pull/15620)))
- Instrument `state` and `state_group` storage-related operations to better picture what's happening when tracing. ([\#15610]([matrix-org/synapse#15610](https://github.com/matrix-org/synapse/pull/15610)), [\#15647]([matrix-org/synapse#15647](https://github.com/matrix-org/synapse/pull/15647)))
- Trace how many new events from the backfill response we need to process. ([\#15633]([matrix-org/synapse#15633](https://github.com/matrix-org/synapse/pull/15633)))
- Re-type config paths in `ConfigError`s to be `StrSequence`s instead of `Iterable[str]`s. ([\#15615]([matrix-org/synapse#15615](https://github.com/matrix-org/synapse/pull/15615)))
- Update Mutual Rooms ([MSC2666]([matrix-org/matrix-spec-proposals#2666](https://github.com/matrix-org/matrix-spec-proposals/pull/2666))) implementation to match new proposal text. ([\#15621]([matrix-org/synapse#15621](https://github.com/matrix-org/synapse/pull/15621)))
- Remove the unstable identifiers from faster joins ([MSC3706]([matrix-org/matrix-spec-proposals#3706](https://github.com/matrix-org/matrix-spec-proposals/pull/3706))). ([\#15625]([matrix-org/synapse#15625](https://github.com/matrix-org/synapse/pull/15625)))
- Fix the olddeps CI. ([\#15626]([matrix-org/synapse#15626](https://github.com/matrix-org/synapse/pull/15626)))
- Remove duplicate timestamp from test logs (`_trial_temp/test.log`). ([\#15636]([matrix-org/synapse#15636](https://github.com/matrix-org/synapse/pull/15636)))
- Fix two memory leaks in `trial` test runs. ([\#15630]([matrix-org/synapse#15630](https://github.com/matrix-org/synapse/pull/15630)))
- Limit the size of the `HomeServerConfig` cache in trial test runs. ([\#15646]([matrix-org/synapse#15646](https://github.com/matrix-org/synapse/pull/15646)))
- Improve type hints. ([\#15658]([matrix-org/synapse#15658](https://github.com/matrix-org/synapse/pull/15658)), [\#15659]([matrix-org/synapse#15659](https://github.com/matrix-org/synapse/pull/15659)))
- Add requesting user id parameter to key claim methods in `TransportLayerClient`. ([\#15663]([matrix-org/synapse#15663](https://github.com/matrix-org/synapse/pull/15663)))
- Speed up rebuilding of the user directory for local users. ([\#15665]([matrix-org/synapse#15665](https://github.com/matrix-org/synapse/pull/15665)))
- Implement "option 2" for [MSC3820]([matrix-org/matrix-spec-proposals#3820](https://github.com/matrix-org/matrix-spec-proposals/pull/3820)): Room version 11. ([\#15666]([matrix-org/synapse#15666](https://github.com/matrix-org/synapse/pull/15666)), [\#15678]([matrix-org/synapse#15678](https://github.com/matrix-org/synapse/pull/15678)))

### Updates to locked dependencies

* Bump furo from 2023.3.27 to 2023.5.20. ([\#15642]([matrix-org/synapse#15642](https://github.com/matrix-org/synapse/pull/15642)))
* Bump log from 0.4.17 to 0.4.18. ([\#15681]([matrix-org/synapse#15681](https://github.com/matrix-org/synapse/pull/15681)))
* Bump prometheus-client from 0.16.0 to 0.17.0. ([\#15682]([matrix-org/synapse#15682](https://github.com/matrix-org/synapse/pull/15682)))
* Bump pydantic from 1.10.7 to 1.10.8. ([\#15685]([matrix-org/synapse#15685](https://github.com/matrix-org/synapse/pull/15685)))
* Bump pygithub from 1.58.1 to 1.58.2. ([\#15643]([matrix-org/synapse#15643](https://github.com/matrix-org/synapse/pull/15643)))
* Bump requests from 2.28.2 to 2.31.0. ([\#15651]([matrix-org/synapse#15651](https://github.com/matrix-org/synapse/pull/15651)))
* Bump sphinx from 6.1.3 to 6.2.1. ([\#15641]([matrix-org/synapse#15641](https://github.com/matrix-org/synapse/pull/15641)))
* Bump types-bleach from 6.0.0.1 to 6.0.0.3. ([\#15686]([matrix-org/synapse#15686](https://github.com/matrix-org/synapse/pull/15686)))
* Bump types-pillow from 9.5.0.2 to 9.5.0.4. ([\#15640]([matrix-org/synapse#15640](https://github.com/matrix-org/synapse/pull/15640)))
* Bump types-pyyaml from 6.0.12.9 to 6.0.12.10. ([\#15683]([matrix-org/synapse#15683](https://github.com/matrix-org/synapse/pull/15683)))
* Bump types-requests from 2.30.0.0 to 2.31.0.0. ([\#15684]([matrix-org/synapse#15684](https://github.com/matrix-org/synapse/pull/15684)))
* Bump types-setuptools from 67.7.0.2 to 67.8.0.0. ([\#15639]([matrix-org/synapse#15639](https://github.com/matrix-org/synapse/pull/15639)))

Synapse 1.84.1 (2023-05-26)
===========================

This patch release fixes a major issue with homeservers that do not have an `instance_map` defined but which do use workers.
If you have already upgraded to Synapse 1.84.0 and your homeserver is working normally, then there is no need to update to this patch release.

Bugfixes
--------

- Fix a bug introduced in Synapse v1.84.0 where workers do not start up when no `instance_map` was provided. ([\#15672]([matrix-org/synapse#15672](https://github.com/matrix-org/synapse/pull/15672)))

Internal Changes
----------------

- Add `dch` and `notify-send` to the development Nix flake so that the release script can be used. ([\#15673]([matrix-org/synapse#15673](https://github.com/matrix-org/synapse/pull/15673)))

Synapse 1.84.0 (2023-05-23)
===========================

The `worker_replication_*` configuration settings have been deprecated in favour of configuring the main process consistently with other instances in the `instance_map`. The deprecated settings will be removed in Synapse v1.88.0, but changing your configuration in advance is recommended. See the [upgrade notes](<https://github.com/matrix-org/synapse/blob/release-v1.84/docs/upgrade.md#upgrading-to-v1840>) for more information.

Bugfixes
--------

- Fix a bug introduced in Synapse 1.84.0rc1 where errors during startup were not reported correctly on Python < 3.10. ([\#15599]([matrix-org/synapse#15599](https://github.com/matrix-org/synapse/pull/15599)))

Synapse 1.84.0rc1 (2023-05-16)
==============================

Features
--------

- Add an option to prevent media downloads from configured domains. ([\#15197]([matrix-org/synapse#15197](https://github.com/matrix-org/synapse/pull/15197)))
- Add `forget_rooms_on_leave` config option to automatically forget rooms when users leave them or are removed from them. ([\#15224]([matrix-org/synapse#15224](https://github.com/matrix-org/synapse/pull/15224)))
- Add redis TLS configuration options. ([\#15312]([matrix-org/synapse#15312](https://github.com/matrix-org/synapse/pull/15312)))
- Add a config option to delay push notifications by a random amount, to discourage time-based profiling. ([\#15516]([matrix-org/synapse#15516](https://github.com/matrix-org/synapse/pull/15516)))
- Stabilize support for [MSC2659]([matrix-org/matrix-spec-proposals#2659](https://github.com/matrix-org/matrix-spec-proposals/pull/2659)): application service ping endpoint. Contributed by Tulir @ Beeper. ([\#15528]([matrix-org/synapse#15528](https://github.com/matrix-org/synapse/pull/15528)))
- Implement [MSC4009]([matrix-org/matrix-spec-proposals#4009](https://github.com/matrix-org/matrix-spec-proposals/pull/4009)) to expand the supported characters in Matrix IDs. ([\#15536]([matrix-org/synapse#15536](https://github.com/matrix-org/synapse/pull/15536)))
- Advertise support for Matrix 1.6 on `/_matrix/client/versions`. ([\#15559]([matrix-org/synapse#15559](https://github.com/matrix-org/synapse/pull/15559)))
- Print full error and stack-trace of any exception that occurs during startup/initialization. ([\#15569]([matrix-org/synapse#15569](https://github.com/matrix-org/synapse/pull/15569)))

Bugfixes
--------

- Don't fail on federation over TOR where SRV queries are not supported. Contributed by Zdzichu. ([\#15523]([matrix-org/synapse#15523](https://github.com/matrix-org/synapse/pull/15523)))
- Experimental support for [MSC4010]([matrix-org/matrix-spec-proposals#4010](https://github.com/matrix-org/matrix-spec-proposals/pull/4010)) which rejects setting the `"m.push_rules"` via account data. ([\#15554]([matrix-org/synapse#15554](https://github.com/matrix-org/synapse/pull/15554)), [\#15555]([matrix-org/synapse#15555](https://github.com/matrix-org/synapse/pull/15555)))
- Fix a long-standing bug where an invalid membership event could cause an internal server error. ([\#15564]([matrix-org/synapse#15564](https://github.com/matrix-org/synapse/pull/15564)))
- Require at least poetry-core v1.1.0. ([\#15566]([matrix-org/synapse#15566](https://github.com/matrix-org/synapse/pull/15566)), [\#15571]([matrix-org/synapse#15571](https://github.com/matrix-org/synapse/pull/15571)))

Deprecations and Removals
-------------------------

- Remove need for `worker_replication_*` based settings in worker configuration yaml by placing this data directly on the `instance_map` instead. ([\#15491]([matrix-org/synapse#15491](https://github.com/matrix-org/synapse/pull/15491)))

Updates to the Docker image
---------------------------

- Add pkg-config package to Stage 0 to be able to build Dockerfile on ppc64le architecture. ([\#15567]([matrix-org/synapse#15567](https://github.com/matrix-org/synapse/pull/15567)))

Improved Documentation
----------------------

- Clarify documentation of the "Create or modify account" Admin API. ([\#15544]([matrix-org/synapse#15544](https://github.com/matrix-org/synapse/pull/15544)))
- Fix path to the `statistics/database/rooms` admin API in documentation. ([\#15560]([matrix-org/synapse#15560](https://github.com/matrix-org/synapse/pull/15560)))
- Update and improve Mastodon Single Sign-On documentation. ([\#15587]([matrix-org/synapse#15587](https://github.com/matrix-org/synapse/pull/15587)))

Internal Changes
----------------

- Use oEmbed to generate URL previews for YouTube Shorts. ([\#15025]([matrix-org/synapse#15025](https://github.com/matrix-org/synapse/pull/15025)))
- Create new `Client` for use with HTTP Replication between workers. Contributed by Jason Little. ([\#15470]([matrix-org/synapse#15470](https://github.com/matrix-org/synapse/pull/15470)))
- Bump pyicu from 2.10.2 to 2.11. ([\#15509]([matrix-org/synapse#15509](https://github.com/matrix-org/synapse/pull/15509)))
- Remove references to supporting per-user flag for [MSC2654]([matrix-org/matrix-spec-proposals#2654](https://github.com/matrix-org/matrix-spec-proposals/pull/2654)). ([\#15522]([matrix-org/synapse#15522](https://github.com/matrix-org/synapse/pull/15522)))
- Don't use a trusted key server when running the demo scripts. ([\#15527]([matrix-org/synapse#15527](https://github.com/matrix-org/synapse/pull/15527)))
- Speed up rebuilding of the user directory for local users. ([\#15529]([matrix-org/synapse#15529](https://github.com/matrix-org/synapse/pull/15529)))
- Speed up deleting of old rows in `event_push_actions`. ([\#15531]([matrix-org/synapse#15531](https://github.com/matrix-org/synapse/pull/15531)))
- Install the `xmlsec` and `mdbook` packages and switch back to the upstream [cachix/devenv](<https://github.com/cachix/devenv>) repo in the nix development environment. ([\#15532]([matrix-org/synapse#15532](https://github.com/matrix-org/synapse/pull/15532)), [\#15533]([matrix-org/synapse#15533](https://github.com/matrix-org/synapse/pull/15533)), [\#15545]([matrix-org/synapse#15545](https://github.com/matrix-org/synapse/pull/15545)))
- Implement [MSC3987]([matrix-org/matrix-spec-proposals#3987](https://github.com/matrix-org/matrix-spec-proposals/pull/3987)) by removing `"dont_notify"` from the list of actions in default push rules. ([\#15534]([matrix-org/synapse#15534](https://github.com/matrix-org/synapse/pull/15534)))
- Move various module API callback registration methods to a dedicated class. ([\#15535]([matrix-org/synapse#15535](https://github.com/matrix-org/synapse/pull/15535)))
- Proxy `/user/devices` federation queries to application services for [MSC3984]([matrix-org/matrix-spec-proposals#3984](https://github.com/matrix-org/matrix-spec-proposals/pull/3984)). ([\#15539]([matrix-org/synapse#15539](https://github.com/matrix-org/synapse/pull/15539)))
- Factor out an `is_mine_server_name` method. ([\#15542]([matrix-org/synapse#15542](https://github.com/matrix-org/synapse/pull/15542)))
- Allow running Complement tests using [podman](<https://podman.io/>) by adding a `PODMAN` environment variable to `scripts-dev/complement.sh`. ([\#15543]([matrix-org/synapse#15543](https://github.com/matrix-org/synapse/pull/15543)))
- Bump serde from 1.0.160 to 1.0.162. ([\#15548]([matrix-org/synapse#15548](https://github.com/matrix-org/synapse/pull/15548)))
- Bump types-setuptools from 67.6.0.5 to 67.7.0.1. ([\#15549]([matrix-org/synapse#15549](https://github.com/matrix-org/synapse/pull/15549)))
- Bump sentry-sdk from 1.19.1 to 1.22.1. ([\#15550]([matrix-org/synapse#15550](https://github.com/matrix-org/synapse/pull/15550)))
- Bump ruff from 0.0.259 to 0.0.265. ([\#15551]([matrix-org/synapse#15551](https://github.com/matrix-org/synapse/pull/15551)))
- Bump hiredis from 2.2.2 to 2.2.3. ([\#15552]([matrix-org/synapse#15552](https://github.com/matrix-org/synapse/pull/15552)))
- Bump types-requests from 2.29.0.0 to 2.30.0.0. ([\#15553]([matrix-org/synapse#15553](https://github.com/matrix-org/synapse/pull/15553)))
- Add `org.matrix.msc3981` info to `/_matrix/client/versions`. ([\#15558]([matrix-org/synapse#15558](https://github.com/matrix-org/synapse/pull/15558)))
- Declare unstable support for [MSC3391]([matrix-org/matrix-spec-proposals#3391](https://github.com/matrix-org/matrix-spec-proposals/pull/3391)) under `/_matrix/client/versions` if the experimental implementation is enabled. ([\#15562]([matrix-org/synapse#15562](https://github.com/matrix-org/synapse/pull/15562)))
- Implement [MSC3821]([matrix-org/matrix-spec-proposals#3821](https://github.com/matrix-org/matrix-spec-proposals/pull/3821)) to update the redaction rules. ([\#15563]([matrix-org/synapse#15563](https://github.com/matrix-org/synapse/pull/15563)))
- Implement updated redaction rules from [MSC3389]([matrix-org/matrix-spec-proposals#3389](https://github.com/matrix-org/matrix-spec-proposals/pull/3389)). ([\#15565]([matrix-org/synapse#15565](https://github.com/matrix-org/synapse/pull/15565)))
- Allow `pip install` to use setuptools_rust 1.6.0 when building Synapse. ([\#15570]([matrix-org/synapse#15570](https://github.com/matrix-org/synapse/pull/15570)))
- Deal with upcoming Github Actions deprecations. ([\#15576]([matrix-org/synapse#15576](https://github.com/matrix-org/synapse/pull/15576)))
- Export `run_as_background_process` from the module API. ([\#15577]([matrix-org/synapse#15577](https://github.com/matrix-org/synapse/pull/15577)))
- Update build system requirements to allow building with poetry-core==1.6.0. ([\#15588]([matrix-org/synapse#15588](https://github.com/matrix-org/synapse/pull/15588)))
- Bump serde from 1.0.162 to 1.0.163. ([\#15589]([matrix-org/synapse#15589](https://github.com/matrix-org/synapse/pull/15589)))
- Bump phonenumbers from 8.13.7 to 8.13.11. ([\#15590]([matrix-org/synapse#15590](https://github.com/matrix-org/synapse/pull/15590)))
- Bump types-psycopg2 from 2.9.21.9 to 2.9.21.10. ([\#15591]([matrix-org/synapse#15591](https://github.com/matrix-org/synapse/pull/15591)))
- Bump types-commonmark from 0.9.2.2 to 0.9.2.3. ([\#15592]([matrix-org/synapse#15592](https://github.com/matrix-org/synapse/pull/15592)))
- Bump types-setuptools from 67.7.0.1 to 67.7.0.2. ([\#15594]([matrix-org/synapse#15594](https://github.com/matrix-org/synapse/pull/15594)))

Synapse 1.83.0 (2023-05-09)
===========================

No significant changes since 1.83.0rc1.

Synapse 1.83.0rc1 (2023-05-02)
==============================

Features
--------

- Experimental support to recursively provide relations per [MSC3981]([matrix-org/matrix-spec-proposals#3981](https://github.com/matrix-org/matrix-spec-proposals/pull/3981)). ([\#15315]([matrix-org/synapse#15315](https://github.com/matrix-org/synapse/pull/15315)))
- Experimental support for [MSC3970]([matrix-org/matrix-spec-proposals#3970](https://github.com/matrix-org/matrix-spec-proposals/pull/3970)): Scope transaction IDs to devices. ([\#15318]([matrix-org/synapse#15318](https://github.com/matrix-org/synapse/pull/15318)))
- Add an [admin API endpoint](<https://matrix-org.github.io/synapse/v1.83/admin_api/experimental_features.html>) to support per-user feature flags. ([\#15344]([matrix-org/synapse#15344](https://github.com/matrix-org/synapse/pull/15344)))
- Add a module API to send an HTTP push notification. ([\#15387]([matrix-org/synapse#15387](https://github.com/matrix-org/synapse/pull/15387)))
- Add an [admin API endpoint](<https://matrix-org.github.io/synapse/v1.83/admin_api/statistics.html#get-largest-rooms-by-size-in-database>) to query the largest rooms by disk space used in the database. ([\#15482]([matrix-org/synapse#15482](https://github.com/matrix-org/synapse/pull/15482)))

Bugfixes
--------

- Disable push rule evaluation for rooms excluded from sync. ([\#15361]([matrix-org/synapse#15361](https://github.com/matrix-org/synapse/pull/15361)))
- Fix a long-standing bug where cached server key results which were directly fetched would not be properly re-used. ([\#15417]([matrix-org/synapse#15417](https://github.com/matrix-org/synapse/pull/15417)))
- Fix a bug introduced in Synapse 1.73.0 where some experimental push rules were returned by default. ([\#15494]([matrix-org/synapse#15494](https://github.com/matrix-org/synapse/pull/15494)))

Improved Documentation
----------------------

- Add Nginx loadbalancing example with sticky mxid for workers. ([\#15411]([matrix-org/synapse#15411](https://github.com/matrix-org/synapse/pull/15411)))
- Update outdated development docs that mention restrictions in versions of SQLite that we no longer support. ([\#15498]([matrix-org/synapse#15498](https://github.com/matrix-org/synapse/pull/15498)))

Internal Changes
----------------

- Speedup tests by caching HomeServerConfig instances. ([\#15284]([matrix-org/synapse#15284](https://github.com/matrix-org/synapse/pull/15284)))
- Add denormalised event stream ordering column to membership state tables for future use. Contributed by Nick @ Beeper ([@Fizzadar](https://github.com/Fizzadar)). ([\#15356]([matrix-org/synapse#15356](https://github.com/matrix-org/synapse/pull/15356)))
- Always use multi-user device resync replication endpoints. ([\#15418]([matrix-org/synapse#15418](https://github.com/matrix-org/synapse/pull/15418)))
- Add column `full_user_id` to tables `profiles` and `user_filters`. ([\#15458]([matrix-org/synapse#15458](https://github.com/matrix-org/synapse/pull/15458)))
- Update support for [MSC3983]([matrix-org/matrix-spec-proposals#3983](https://github.com/matrix-org/matrix-spec-proposals/pull/3983)) to allow always returning fallback-keys in a `/keys/claim` request. ([\#15462]([matrix-org/synapse#15462](https://github.com/matrix-org/synapse/pull/15462)))
- Improve type hints. ([\#15465]([matrix-org/synapse#15465](https://github.com/matrix-org/synapse/pull/15465)), [\#15496]([matrix-org/synapse#15496](https://github.com/matrix-org/synapse/pull/15496)), [\#15497]([matrix-org/synapse#15497](https://github.com/matrix-org/synapse/pull/15497)))
- Support claiming more than one OTK at a time. ([\#15468]([matrix-org/synapse#15468](https://github.com/matrix-org/synapse/pull/15468)))
- Bump types-pyyaml from 6.0.12.8 to 6.0.12.9. ([\#15471]([matrix-org/synapse#15471](https://github.com/matrix-org/synapse/pull/15471)))
- Bump pyasn1-modules from 0.2.8 to 0.3.0. ([\#15473]([matrix-org/synapse#15473](https://github.com/matrix-org/synapse/pull/15473)))
- Bump cryptography from 40.0.1 to 40.0.2. ([\#15474]([matrix-org/synapse#15474](https://github.com/matrix-org/synapse/pull/15474)))
- Bump types-netaddr from 0.8.0.7 to 0.8.0.8. ([\#15475]([matrix-org/synapse#15475](https://github.com/matrix-org/synapse/pull/15475)))
- Bump types-jsonschema from 4.17.0.6 to 4.17.0.7. ([\#15476]([matrix-org/synapse#15476](https://github.com/matrix-org/synapse/pull/15476)))
- Ask bug reporters to provide logs as text. ([\#15479]([matrix-org/synapse#15479](https://github.com/matrix-org/synapse/pull/15479)))
- Add a Nix flake for use as a development environment. ([\#15495]([matrix-org/synapse#15495](https://github.com/matrix-org/synapse/pull/15495)))
- Bump anyhow from 1.0.70 to 1.0.71. ([\#15507]([matrix-org/synapse#15507](https://github.com/matrix-org/synapse/pull/15507)))
- Bump types-pillow from 9.4.0.19 to 9.5.0.2. ([\#15508]([matrix-org/synapse#15508](https://github.com/matrix-org/synapse/pull/15508)))
- Bump packaging from 23.0 to 23.1. ([\#15510]([matrix-org/synapse#15510](https://github.com/matrix-org/synapse/pull/15510)))
- Bump types-requests from 2.28.11.16 to 2.29.0.0. ([\#15511]([matrix-org/synapse#15511](https://github.com/matrix-org/synapse/pull/15511)))
- Bump setuptools-rust from 1.5.2 to 1.6.0. ([\#15512]([matrix-org/synapse#15512](https://github.com/matrix-org/synapse/pull/15512)))
- Update the check_schema_delta script to account for when the schema version has been bumped locally. ([\#15466]([matrix-org/synapse#15466](https://github.com/matrix-org/synapse/pull/15466)))

Synapse 1.82.0 (2023-04-25)
===========================

No significant changes since 1.82.0rc1.

Synapse 1.82.0rc1 (2023-04-18)
==============================

Features
--------

- Allow loading the `/directory/room/{roomAlias}` endpoint on workers. ([\#15333]([matrix-org/synapse#15333](https://github.com/matrix-org/synapse/pull/15333)))
- Add some validation to `instance_map` configuration loading. ([\#15431]([matrix-org/synapse#15431](https://github.com/matrix-org/synapse/pull/15431)))
- Allow loading the `/capabilities` endpoint on workers. ([\#15436]([matrix-org/synapse#15436](https://github.com/matrix-org/synapse/pull/15436)))

Bugfixes
--------

- Delete server-side backup keys when deactivating an account. ([\#15181]([matrix-org/synapse#15181](https://github.com/matrix-org/synapse/pull/15181)))
- Fix and document untold assumption that `on_logged_out` module hooks will be called before the deletion of pushers. ([\#15410]([matrix-org/synapse#15410](https://github.com/matrix-org/synapse/pull/15410)))
- Improve robustness when handling a perspective key response by deduplicating received server keys. ([\#15423]([matrix-org/synapse#15423](https://github.com/matrix-org/synapse/pull/15423)))
- Synapse now correctly fails to start if the config option `app_service_config_files` is not a list. ([\#15425]([matrix-org/synapse#15425](https://github.com/matrix-org/synapse/pull/15425)))
- Disable loading `RefreshTokenServlet` (`/_matrix/client/(r0|v3|unstable)/refresh`) on workers. ([\#15428]([matrix-org/synapse#15428](https://github.com/matrix-org/synapse/pull/15428)))

Improved Documentation
----------------------

- Note that the `delete_stale_devices_after` background job always runs on the main process. ([\#15452]([matrix-org/synapse#15452](https://github.com/matrix-org/synapse/pull/15452)))

Deprecations and Removals
-------------------------

- Remove the broken, unspecced registration fallback. Note that the *login* fallback is unaffected by this change. ([\#15405]([matrix-org/synapse#15405](https://github.com/matrix-org/synapse/pull/15405)))

Internal Changes
----------------

- Bump black from 23.1.0 to 23.3.0. ([\#15372]([matrix-org/synapse#15372](https://github.com/matrix-org/synapse/pull/15372)))
- Bump pyopenssl from 23.1.0 to 23.1.1. ([\#15373]([matrix-org/synapse#15373](https://github.com/matrix-org/synapse/pull/15373)))
- Bump types-psycopg2 from 2.9.21.8 to 2.9.21.9. ([\#15374]([matrix-org/synapse#15374](https://github.com/matrix-org/synapse/pull/15374)))
- Bump types-netaddr from 0.8.0.6 to 0.8.0.7. ([\#15375]([matrix-org/synapse#15375](https://github.com/matrix-org/synapse/pull/15375)))
- Bump types-opentracing from 2.4.10.3 to 2.4.10.4. ([\#15376]([matrix-org/synapse#15376](https://github.com/matrix-org/synapse/pull/15376)))
- Bump dawidd6/action-download-artifact from 2.26.0 to 2.26.1. ([\#15404]([matrix-org/synapse#15404](https://github.com/matrix-org/synapse/pull/15404)))
- Bump parameterized from 0.8.1 to 0.9.0. ([\#15412]([matrix-org/synapse#15412](https://github.com/matrix-org/synapse/pull/15412)))
- Bump types-pillow from 9.4.0.17 to 9.4.0.19. ([\#15413]([matrix-org/synapse#15413](https://github.com/matrix-org/synapse/pull/15413)))
- Bump sentry-sdk from 1.17.0 to 1.19.1. ([\#15414]([matrix-org/synapse#15414](https://github.com/matrix-org/synapse/pull/15414)))
- Bump immutabledict from 2.2.3 to 2.2.4. ([\#15415]([matrix-org/synapse#15415](https://github.com/matrix-org/synapse/pull/15415)))
- Bump dawidd6/action-download-artifact from 2.26.1 to 2.27.0. ([\#15441]([matrix-org/synapse#15441](https://github.com/matrix-org/synapse/pull/15441)))
- Bump serde_json from 1.0.95 to 1.0.96. ([\#15442]([matrix-org/synapse#15442](https://github.com/matrix-org/synapse/pull/15442)))
- Bump serde from 1.0.159 to 1.0.160. ([\#15443]([matrix-org/synapse#15443](https://github.com/matrix-org/synapse/pull/15443)))
- Bump pillow from 9.4.0 to 9.5.0. ([\#15444]([matrix-org/synapse#15444](https://github.com/matrix-org/synapse/pull/15444)))
- Bump furo from 2023.3.23 to 2023.3.27. ([\#15445]([matrix-org/synapse#15445](https://github.com/matrix-org/synapse/pull/15445)))
- Bump types-pyopenssl from 23.1.0.0 to 23.1.0.2. ([\#15446]([matrix-org/synapse#15446](https://github.com/matrix-org/synapse/pull/15446)))
- Bump mypy from 1.0.0 to 1.0.1. ([\#15447]([matrix-org/synapse#15447](https://github.com/matrix-org/synapse/pull/15447)))
- Bump psycopg2 from 2.9.5 to 2.9.6. ([\#15448]([matrix-org/synapse#15448](https://github.com/matrix-org/synapse/pull/15448)))
- Improve DB performance of clearing out old data from `stream_ordering_to_exterm`. ([\#15382]([matrix-org/synapse#15382](https://github.com/matrix-org/synapse/pull/15382)), [\#15429]([matrix-org/synapse#15429](https://github.com/matrix-org/synapse/pull/15429)))
- Implement [MSC3989]([matrix-org/matrix-spec-proposals#3989](https://github.com/matrix-org/matrix-spec-proposals/pull/3989)) redaction algorithm. ([\#15393]([matrix-org/synapse#15393](https://github.com/matrix-org/synapse/pull/15393)))
- Implement [MSC2175]([matrix-org/matrix-spec-proposals#2175](https://github.com/matrix-org/matrix-spec-proposals/pull/2175)) to stop adding `creator` to create events. ([\#15394]([matrix-org/synapse#15394](https://github.com/matrix-org/synapse/pull/15394)))
- Implement [MSC2174]([matrix-org/matrix-spec-proposals#2174](https://github.com/matrix-org/matrix-spec-proposals/pull/2174)) to move the `redacts` key to a `content` property. ([\#15395]([matrix-org/synapse#15395](https://github.com/matrix-org/synapse/pull/15395)))
- Trust dtonlay/rust-toolchain in CI. ([\#15406]([matrix-org/synapse#15406](https://github.com/matrix-org/synapse/pull/15406)))
- Explicitly install Synapse during typechecking in CI. ([\#15409]([matrix-org/synapse#15409](https://github.com/matrix-org/synapse/pull/15409)))
- Only load the SSO redirect servlet if SSO is enabled. ([\#15421]([matrix-org/synapse#15421](https://github.com/matrix-org/synapse/pull/15421)))
- Refactor `SimpleHttpClient` to pull out a base class. ([\#15427]([matrix-org/synapse#15427](https://github.com/matrix-org/synapse/pull/15427)))
- Improve type hints. ([\#15432]([matrix-org/synapse#15432](https://github.com/matrix-org/synapse/pull/15432)))
- Convert async to normal tests in `TestSSOHandler`. ([\#15433]([matrix-org/synapse#15433](https://github.com/matrix-org/synapse/pull/15433)))
- Speed up the user directory background update. ([\#15435]([matrix-org/synapse#15435](https://github.com/matrix-org/synapse/pull/15435)))
- Disable directory listing for static resources in `/_matrix/static/`. ([\#15438]([matrix-org/synapse#15438](https://github.com/matrix-org/synapse/pull/15438)))
- Move various module API callback registration methods to a dedicated class. ([\#15453]([matrix-org/synapse#15453](https://github.com/matrix-org/synapse/pull/15453)))

Synapse 1.81.0 (2023-04-11)
===========================

Synapse now attempts the versioned appservice paths before falling back to the
[legacy paths](<https://spec.matrix.org/v1.6/application-service-api/#legacy-routes>).
Usage of the legacy routes should be considered deprecated.

Additionally, Synapse has supported sending the application service access token
via [the `Authorization` header](<https://spec.matrix.org/v1.6/application-service-api/#authorization>)
since v1.70.0. For backwards compatibility it is *also* sent as the `access_token`
query parameter. This is insecure and should be considered deprecated.

A future version of Synapse (v1.88.0 or later) will remove support for legacy
application service routes and query parameter authorization.

No significant changes since 1.81.0rc2.

Synapse 1.81.0rc2 (2023-04-06)
==============================

Bugfixes
--------

- Fix the `set_device_id_for_pushers_txn` background update crash. ([\#15391]([matrix-org/synapse#15391](https://github.com/matrix-org/synapse/pull/15391)))

Internal Changes
----------------

- Update CI to run complement under the latest stable go version. ([\#15403]([matrix-org/synapse#15403](https://github.com/matrix-org/synapse/pull/15403)))

Synapse 1.81.0rc1 (2023-04-04)
==============================

Features
--------

- Add the ability to enable/disable registrations when in the OIDC flow. ([\#14978]([matrix-org/synapse#14978](https://github.com/matrix-org/synapse/pull/14978)))
- Add a primitive helper script for listing worker endpoints. ([\#15243]([matrix-org/synapse#15243](https://github.com/matrix-org/synapse/pull/15243)))
- Experimental support for passing One Time Key and device key requests to application services ([MSC3983]([matrix-org/matrix-spec-proposals#3983](https://github.com/matrix-org/matrix-spec-proposals/pull/3983)) and [MSC3984]([matrix-org/matrix-spec-proposals#3984](https://github.com/matrix-org/matrix-spec-proposals/pull/3984))). ([\#15314]([matrix-org/synapse#15314](https://github.com/matrix-org/synapse/pull/15314)), [\#15321]([matrix-org/synapse#15321](https://github.com/matrix-org/synapse/pull/15321)))
- Allow loading `/password_policy` endpoint on workers. ([\#15331]([matrix-org/synapse#15331](https://github.com/matrix-org/synapse/pull/15331)))
- Add experimental support for Unix sockets. Contributed by Jason Little. ([\#15353]([matrix-org/synapse#15353](https://github.com/matrix-org/synapse/pull/15353)))
- Build Debian packages for Ubuntu 23.04 (Lunar Lobster). ([\#15381]([matrix-org/synapse#15381](https://github.com/matrix-org/synapse/pull/15381)))

Bugfixes
--------

- Fix a long-standing bug where edits of non-`m.room.message` events would not be correctly bundled. ([\#15295]([matrix-org/synapse#15295](https://github.com/matrix-org/synapse/pull/15295)))
- Fix a bug introduced in Synapse v1.55.0 which could delay remote homeservers being able to decrypt encrypted messages sent by local users. ([\#15297]([matrix-org/synapse#15297](https://github.com/matrix-org/synapse/pull/15297)))
- Add a check to [SQLite port_db script](<https://matrix-org.github.io/synapse/latest/postgres.html#porting-from-sqlite>)
  to ensure that the sqlite database passed to the script exists before trying to port from it. ([\#15306]([matrix-org/synapse#15306](https://github.com/matrix-org/synapse/pull/15306)))
- Fix a bug introduced in Synapse 1.76.0 where responses from worker deployments could include an internal `_INT_STREAM_POS` key. ([\#15309]([matrix-org/synapse#15309](https://github.com/matrix-org/synapse/pull/15309)))
- Fix a long-standing bug that Synpase only used the [legacy appservice routes](<https://spec.matrix.org/v1.6/application-service-api/#legacy-routes>). ([\#15317]([matrix-org/synapse#15317](https://github.com/matrix-org/synapse/pull/15317)))
- Fix a long-standing bug preventing users from rejoining rooms after being banned and unbanned over federation. Contributed by Nico. ([\#15323]([matrix-org/synapse#15323](https://github.com/matrix-org/synapse/pull/15323)))
- Fix bug in worker mode where on a rolling restart of workers the "typing" worker would consume 100% CPU until it got restarted. ([\#15332]([matrix-org/synapse#15332](https://github.com/matrix-org/synapse/pull/15332)))
- Fix a long-standing bug where some to_device messages could be dropped when using workers. ([\#15349]([matrix-org/synapse#15349](https://github.com/matrix-org/synapse/pull/15349)))
- Fix a bug introduced in Synapse 1.70.0 where the background sync from a faster join could spin for hours when one of the events involved had been marked for backoff. ([\#15351]([matrix-org/synapse#15351](https://github.com/matrix-org/synapse/pull/15351)))
- Fix missing app variable in mail subject for password resets. Contributed by Cyberes. ([\#15352]([matrix-org/synapse#15352](https://github.com/matrix-org/synapse/pull/15352)))
- Fix a rare bug introduced in Synapse 1.66.0 where initial syncs would fail when the user had been kicked from a faster joined room that had not finished syncing. ([\#15383]([matrix-org/synapse#15383](https://github.com/matrix-org/synapse/pull/15383)))

Improved Documentation
----------------------

- Fix a typo in login requests ratelimit defaults. ([\#15341]([matrix-org/synapse#15341](https://github.com/matrix-org/synapse/pull/15341)))
- Add some clarification to the doc/comments regarding TCP replication. ([\#15354]([matrix-org/synapse#15354](https://github.com/matrix-org/synapse/pull/15354)))
- Note that Synapse 1.74 queued a rebuild of the user directory tables. ([\#15386]([matrix-org/synapse#15386](https://github.com/matrix-org/synapse/pull/15386)))

Internal Changes
----------------

- Use `immutabledict` instead of `frozendict`. ([\#15113]([matrix-org/synapse#15113](https://github.com/matrix-org/synapse/pull/15113)))
- Add developer documentation for the Federation Sender and add a documentation mechanism using Sphinx. ([\#15265]([matrix-org/synapse#15265](https://github.com/matrix-org/synapse/pull/15265)), [\#15336]([matrix-org/synapse#15336](https://github.com/matrix-org/synapse/pull/15336)))
- Make the pushers rely on the `device_id` instead of the `access_token_id` for various operations. ([\#15280]([matrix-org/synapse#15280](https://github.com/matrix-org/synapse/pull/15280)))
- Bump sentry-sdk from 1.15.0 to 1.17.0. ([\#15285]([matrix-org/synapse#15285](https://github.com/matrix-org/synapse/pull/15285)))
- Allow running the Twisted trunk job against other branches. ([\#15302]([matrix-org/synapse#15302](https://github.com/matrix-org/synapse/pull/15302)))
- Remind the releaser to ask for changelog feedback in [#synapse-dev](<https://matrix.to/#/#synapse-dev:matrix.org>). ([\#15303]([matrix-org/synapse#15303](https://github.com/matrix-org/synapse/pull/15303)))
- Bump dtolnay/rust-toolchain from e12eda571dc9a5ee5d58eecf4738ec291c66f295 to fc3253060d0c959bea12a59f10f8391454a0b02d. ([\#15304]([matrix-org/synapse#15304](https://github.com/matrix-org/synapse/pull/15304)))
- Reject events with an invalid "mentions" property per [MSC3952]([matrix-org/matrix-spec-proposals#3952](https://github.com/matrix-org/matrix-spec-proposals/pull/3952)). ([\#15311]([matrix-org/synapse#15311](https://github.com/matrix-org/synapse/pull/15311)))
- As an optimisation, use `TRUNCATE` on Postgres when clearing the user directory tables. ([\#15316]([matrix-org/synapse#15316](https://github.com/matrix-org/synapse/pull/15316)))
- Fix `.gitignore` rule for the Complement source tarball downloaded automatically by `complement.sh`. ([\#15319]([matrix-org/synapse#15319](https://github.com/matrix-org/synapse/pull/15319)))
- Bump serde from 1.0.157 to 1.0.158. ([\#15324]([matrix-org/synapse#15324](https://github.com/matrix-org/synapse/pull/15324)))
- Bump regex from 1.7.1 to 1.7.3. ([\#15325]([matrix-org/synapse#15325](https://github.com/matrix-org/synapse/pull/15325)))
- Bump types-pyopenssl from 23.0.0.4 to 23.1.0.0. ([\#15326]([matrix-org/synapse#15326](https://github.com/matrix-org/synapse/pull/15326)))
- Bump furo from 2022.12.7 to 2023.3.23. ([\#15327]([matrix-org/synapse#15327](https://github.com/matrix-org/synapse/pull/15327)))
- Bump ruff from 0.0.252 to 0.0.259. ([\#15328]([matrix-org/synapse#15328](https://github.com/matrix-org/synapse/pull/15328)))
- Bump cryptography from 40.0.0 to 40.0.1. ([\#15329]([matrix-org/synapse#15329](https://github.com/matrix-org/synapse/pull/15329)))
- Bump mypy-zope from 0.9.0 to 0.9.1. ([\#15330]([matrix-org/synapse#15330](https://github.com/matrix-org/synapse/pull/15330)))
- Speed up unit tests when using SQLite3. ([\#15334]([matrix-org/synapse#15334](https://github.com/matrix-org/synapse/pull/15334)))
- Speed up pydantic CI job. ([\#15339]([matrix-org/synapse#15339](https://github.com/matrix-org/synapse/pull/15339)))
- Speed up sample config CI job. ([\#15340]([matrix-org/synapse#15340](https://github.com/matrix-org/synapse/pull/15340)))
- Fix copyright year in SSO footer template. ([\#15358]([matrix-org/synapse#15358](https://github.com/matrix-org/synapse/pull/15358)))
- Bump peaceiris/actions-gh-pages from 3.9.2 to 3.9.3. ([\#15369]([matrix-org/synapse#15369](https://github.com/matrix-org/synapse/pull/15369)))
- Bump serde from 1.0.158 to 1.0.159. ([\#15370]([matrix-org/synapse#15370](https://github.com/matrix-org/synapse/pull/15370)))
- Bump serde_json from 1.0.94 to 1.0.95. ([\#15371]([matrix-org/synapse#15371](https://github.com/matrix-org/synapse/pull/15371)))
- Speed up membership queries for users with forgotten rooms. ([\#15385]([matrix-org/synapse#15385](https://github.com/matrix-org/synapse/pull/15385)))
```

[Sign up for free](/join?source=comment-repo)
**to subscribe to this conversation on GitHub**.
Already have an account?
[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fpull%2F15601).

Reviewers

[![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=40&v=4)](/MadLittleMods) [MadLittleMods](/MadLittleMods)

MadLittleMods approved these changes

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@clokep](https://avatars.githubusercontent.com/u/517124?s=52&v=4)](/clokep) [![@MadLittleMods](https://avatars.githubusercontent.com/u/558581?s=52&v=4)](/MadLittleMods)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_26da4390_20250115_115516.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-26c5-ppr8-f33p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmatrix-org%2Fsynapse%2Fsecurity%2Fadvisories%2FGHSA-26c5-ppr8-f33p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=matrix-org%2Fsynapse)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

This repository has been archived by the owner on Apr 26, 2024. It is now read-only.

[matrix-org](/matrix-org)
/
**[synapse](/matrix-org/synapse)**
Public archive

* [Notifications](/login?return_to=%2Fmatrix-org%2Fsynapse) You must be signed in to change notification settings
* [Fork
  2.1k](/login?return_to=%2Fmatrix-org%2Fsynapse)
* [Star
   11.9k](/login?return_to=%2Fmatrix-org%2Fsynapse)

* [Code](/matrix-org/synapse)
* [Issues
  1.5k](/matrix-org/synapse/issues)
* [Pull requests
  64](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects
  0](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

Additional navigation options

* [Code](/matrix-org/synapse)
* [Issues](/matrix-org/synapse/issues)
* [Pull requests](/matrix-org/synapse/pulls)
* [Actions](/matrix-org/synapse/actions)
* [Projects](/matrix-org/synapse/projects)
* [Wiki](/matrix-org/synapse/wiki)
* [Security](/matrix-org/synapse/security)
* [Insights](/matrix-org/synapse/pulse)

# Improper checks for deactivated users during login

Low

[erikjohnston](/erikjohnston)
published
GHSA-26c5-ppr8-f33p
Jun 6, 2023

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.85.0

## Patched versions

1.85.0

## Description

### Impact

It may be possible for a deactivated user to login when using uncommon configurations.

This only applies if any of the following are true:

* [JSON Web Tokens are enabled for login](https://matrix-org.github.io/synapse/latest/jwt.html) via the `jwt_config.enabled` configuration setting
* The [local password database is enabled](https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html#password_config) via the `password_config.enabled` and `password_config.localdb_enabled` configuration settings *and* a user's password is [updated via an admin API](https://matrix-org.github.io/synapse/latest/admin_api/user_admin_api.html#create-or-modify-account) after a user is deactivated.

**Note that the local password database is enabled by default**, but it is uncommon to set a user's password after they've been deactivated.

Installations that are configured to only allow login via Single Sign-On (SSO) via CAS, SAML or OpenID Connect (OIDC); or via an external password provider (e.g. LDAP) are not affected.

### Patches

* If using JSON Web Token logins: [#15624](https://github.com/matrix-org/synapse/pull/15624)
* For other users: [#15634](https://github.com/matrix-org/synapse/pull/15634)

### Workarounds

If not using JSON Web Tokens, ensure that deactivated users do not have a password set. This list of users can be queried from PostgreSQL:

```
SELECT name FROM users WHERE password_hash IS NOT NULL AND deactivated = 1;
```

### Severity

Low

### CVE ID

CVE-2023-32682

### Weaknesses

No CWEs

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_2b05ae0b_20250115_115515.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-26c5-ppr8-f33p)

**CVE-2023-32682**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-26c5-ppr8-f33p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2023-32682](/advisories/GHSA-26c5-ppr8-f33p)

## Synapse has improper checks for deactivated users during login

Moderate severity

GitHub Reviewed

Published
Jun 6, 2023
in
[matrix-org/synapse](/matrix-org/synapse)
â€¢
Updated Sep 24, 2024

[Vulnerability details](/advisories/GHSA-26c5-ppr8-f33p)
[Dependabot alerts
0](/advisories/GHSA-26c5-ppr8-f33p/dependabot)

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.85.0

## Patched versions

1.85.0

## Description

### Impact

It may be possible for a deactivated user to login when using uncommon configurations.

This only applies if any of the following are true:

* [JSON Web Tokens are enabled for login](https://matrix-org.github.io/synapse/latest/jwt.html) via the `jwt_config.enabled` configuration setting
* The [local password database is enabled](https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html#password_config) via the `password_config.enabled` and `password_config.localdb_enabled` configuration settings *and* a user's password is [updated via an admin API](https://matrix-org.github.io/synapse/latest/admin_api/user_admin_api.html#create-or-modify-account) after a user is deactivated.

**Note that the local password database is enabled by default**, but it is uncommon to set a user's password after they've been deactivated.

Installations that are configured to only allow login via Single Sign-On (SSO) via CAS, SAML or OpenID Connect (OIDC); or via an external password provider (e.g. LDAP) are not affected.

### Patches

* If using JSON Web Token logins: #15624
* For other users: #15634

### Workarounds

If not using JSON Web Tokens, ensure that deactivated users do not have a password set. This list of users can be queried from PostgreSQL:

```
SELECT name FROM users WHERE password_hash IS NOT NULL AND deactivated = 1;
```
### References

* [GHSA-26c5-ppr8-f33p](https://github.com/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p "GHSA-26c5-ppr8-f33p")
* [matrix-org/synapse#12274](https://github.com/matrix-org/synapse/issues/12274)
* [matrix-org/synapse#15624](https://github.com/matrix-org/synapse/pull/15624)
* [matrix-org/synapse#15634](https://github.com/matrix-org/synapse/pull/15634)
* <https://github.com/matrix-org/synapse/releases/tag/v1.85.0>
* <https://nvd.nist.gov/vuln/detail/CVE-2023-32682>
* <https://matrix-org.github.io/synapse/latest/admin_api/user_admin_api.html#create-or-modify-account>
* <https://matrix-org.github.io/synapse/latest/jwt.html>
* <https://matrix-org.github.io/synapse/latest/usage/configuration/config_documentation.html#password_config>
* <https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2023-84.yaml>
* [https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2](https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
published to
[matrix-org/synapse](/matrix-org/synapse/security/advisories/GHSA-26c5-ppr8-f33p)
Jun 6, 2023

Published to the GitHub Advisory Database
Jun 6, 2023

Reviewed
Jun 6, 2023

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-32682)
Jun 6, 2023

Last updated
Sep 24, 2024

### Severity

Moderate

5.3

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
Low

User interaction
None
##### Vulnerable System Impact Metrics

Confidentiality
Low

Integrity
Low

Availability
None
##### Subsequent System Impact Metrics

Confidentiality
None

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:L/VI:L/VA:N/SC:N/SI:N/SA:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.135%
 (49th percentile)

### Weaknesses

[CWE-287](/advisories?query=cwe%3A287)

### CVE ID

CVE-2023-32682

### GHSA ID

GHSA-26c5-ppr8-f33p

### Source code

[matrix-org/synapse](https://github.com/matrix-org/synapse)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-26c5-ppr8-f33p/improve).

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_ad7ff143_20250115_115515.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-98px-6486-j7qc)

**CVE-2023-32683**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-98px-6486-j7qc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2023-32683](/advisories/GHSA-98px-6486-j7qc)

## Synapse has URL deny list bypass via oEmbed and image URLs when generating previews

Moderate severity

GitHub Reviewed

Published
Jun 6, 2023
in
[matrix-org/synapse](/matrix-org/synapse)
â€¢
Updated Sep 30, 2024

[Vulnerability details](/advisories/GHSA-98px-6486-j7qc)
[Dependabot alerts
0](/advisories/GHSA-98px-6486-j7qc/dependabot)

## Package

pip

matrix-synapse
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

< 1.85.0

## Patched versions

1.85.0

## Description

### Impact

A discovered oEmbed or image URL can bypass the `url_preview_url_blacklist` setting potentially allowing server side request forgery or bypassing network policies. Impact is limited to IP addresses allowed by the `url_preview_ip_range_blacklist` setting (by default this only allows public IPs) and by the limited information returned to the client:

* For discovered oEmbed URLs, any non-JSON response or a JSON response which includes non-oEmbed information is discarded.
* For discovered image URLs, any non-image response is discarded.

Systems which have URL preview disabled (via the `url_preview_enabled` setting) or have not configured a `url_preview_url_blacklist` are not affected.

Because of the uncommon configuration required, the limited information a malicious user, and the amount of guesses/time the attack would need; the severity is rated as low.

### Patches

The issue is fixed by #15601.

### Workarounds

The default configuration of the `url_preview_ip_range_blacklist` should protect against requests being made to internal infrastructure, URL previews of public URLs is expected.

Alternately URL previews could be disabled using the `url_preview_enabled` setting.

### References

* [GHSA-98px-6486-j7qc](https://github.com/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc "GHSA-98px-6486-j7qc")
* [matrix-org/synapse#15601](https://github.com/matrix-org/synapse/pull/15601)
* <https://github.com/matrix-org/synapse/releases/tag/v1.85.0>
* <https://nvd.nist.gov/vuln/detail/CVE-2023-32683>
* <https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2023-85.yaml>
* [https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2](https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2)

[![@erikjohnston](https://avatars.githubusercontent.com/u/8428120?s=40&v=4)](/erikjohnston)
[erikjohnston](/erikjohnston)
published to
[matrix-org/synapse](/matrix-org/synapse/security/advisories/GHSA-98px-6486-j7qc)
Jun 6, 2023

Published to the GitHub Advisory Database
Jun 6, 2023

Reviewed
Jun 6, 2023

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-32683)
Jun 6, 2023

Last updated
Sep 30, 2024

### Severity

Moderate

5.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
Low

User interaction
Passive
##### Vulnerable System Impact Metrics

Confidentiality
None

Integrity
Low

Availability
None
##### Subsequent System Impact Metrics

Confidentiality
None

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:P/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.071%
 (33rd percentile)

### Weaknesses

[CWE-863](/advisories?query=cwe%3A863) [CWE-918](/advisories?query=cwe%3A918)

### CVE ID

CVE-2023-32683

### GHSA ID

GHSA-98px-6486-j7qc

### Source code

[matrix-org/synapse](https://github.com/matrix-org/synapse)

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-98px-6486-j7qc/improve).

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from lists.fedoraproject.org_52048b59_20250114_200031.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)

Ã—
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2.mbox.gz?message=X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2 "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/#X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2)

# [SECURITY] Fedora 38 Update: matrix-synapse-1.85.2-1.fc38

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesï¼ fedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesï¼ fedoraproject.org")

17 Jun
2023

17 Jun
'23

2:24 a.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2023-56760afca8
2023-06-17 01:21:56.476578
--------------------------------------------------------------------------------

Name : matrix-synapse
Product : Fedora 38
Version : 1.85.2
Release : 1.fc38
URL : <https://github.com/matrix-org/synapse>
Summary : A Matrix reference homeserver written in Python using Twisted
Description :
Matrix is an ambitious new ecosystem for open federated Instant Messaging and
VoIP. Synapse is a reference "homeserver" implementation of Matrix from the
core development team at matrix.org, written in Python/Twisted. It is intended
to showcase the concept of Matrix and let folks see the spec in the context of
a coded base and let you run your own homeserver and generally help bootstrap
the ecosystem.

--------------------------------------------------------------------------------
Update Information:

Update to v1.85.2 ---- Update to v1.85.1 ---- Update to v1.85.0 Fixes
CVE-2023-32682, CVE-2023-32683 ---- Update to v1.84.1
--------------------------------------------------------------------------------
ChangeLog:

\* Thu Jun 8 2023 Kai A. Hiller V02460@gmail.com - 1.85.2-1
- Update to v1.85.2
\* Wed Jun 7 2023 Kai A. Hiller V02460@gmail.com - 1.85.1-1
- Update to v1.85.1
\* Tue Jun 6 2023 Kai A. Hiller V02460@gmail.com - 1.85.0-1
- Update to v1.85.0
\* Sat Jun 3 2023 Kai A. Hiller V02460@gmail.com - 1.84.1-1
- Update to v1.84.1
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2213002 - CVE-2023-32683 matrix-synapse: URL deny list bypass via oEmbed and image URLs when generating previews [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=2213002>
[ 2 ] Bug #2213003 - CVE-2023-32682 matrix-synapse: Improper checks for deactivated users during login [fedora-all]
<https://bugzilla.redhat.com/show_bug.cgi?id=2213003>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2023-56760afca8' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2/#X6DH5A5YEB5LRIPP32OUW25FCGZFCZU2)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.


