=== Content from bugs.launchpad.net_781c1b4a_20250114_205151.html ===

[Log in / Register](https://bugs.launchpad.net/landscape/%2Bbug/1929034/%2Blogin)

[![](https://launchpadlibrarian.net/600872337/Landscape-logo-square-64x64.png)](https://launchpad.net/landscape)

## [Landscape Server](https://launchpad.net/landscape)

* [Overview](https://launchpad.net/landscape)
* [Code](https://code.launchpad.net/landscape)
* [Bugs](https://bugs.launchpad.net/landscape)
* [Blueprints](https://blueprints.launchpad.net/landscape)
* [Translations](https://translations.launchpad.net/landscape)
* [Answers](https://answers.launchpad.net/landscape)

# Landscape insecure tokens generation

Bug #1929034 reported by
[Anton](https://launchpad.net/~ivanovant)
on 2021-05-20

[260](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [Landscape Server](https://bugs.launchpad.net/landscape) | Fix Released | Critical | [Simon Poirier](https://launchpad.net/~simpoir) | [Landscape Server 19.10.5](https://launchpad.net/landscape/%2Bmilestone/19.10.5) |

### Bug Description

Hi team!

Landscape API Access and Secret keys are generated using python random.choice() function:

/opt/canonical/landscape/canonical/lib/credentials.py

import random

import string

\_\_all\_\_ = ["create\_access\_key", "create\_secret\_key"]

def create\_access\_key():

    """Create a randomly generated 20 character access key."""

    key\_choice = string.uppercase + string.digits

    key = []

    for i in xrange(20):

        key.append(random.choice(key\_choice))

    return "".join(key)

def create\_secret\_key():

    """Create a randomly generated 40 character access secret."""

    secret\_choice = (

        string.uppercase + string.lowercase + string.digits + "+/")

    secret = []

    for i in xrange(40):

        secret.append(random.choice(secret\_choice))

    return "".join(secret)

Python random module uses the Mersenne Twister as the core generator. As it is a pseudo-random numbers generator it is not suitable for generating secrets.

From <https://docs.python.org/2/library/random.html>:

Warning The pseudo-random generators of this module should not be used for security purposes. Use os.urandom() or SystemRandom if you require a cryptographically secure pseudo-random number generator.

The same function (random.choice()) used to generate password recovery token:

/opt/canonical/landscape/canonical/lib/text.py

...

import string

import random

...

def make\_secure\_id(length=64):

    choices = string.digits + string.letters

    return "".join(random.choice(choices) for \_ in xrange(length))

...

In theory, it is possible to collect as much data as needed to obtain the state of the Mersenne Twister matrix and, afterwards, predict the next values of the generator. A related technique is described on <https://github.com/tna0y/Python-random-module-cracker>. It can be used to obtain the password reset token of the admin account or try to retrieve API tokens.

To get generated password reset tokens attacker can register a new account using '/new-standalone-user' endpoint using the email address he controls (no rights needed) and then use reset password functionality on '/forgot-my-passphrase' endpoint.

Impact

Compromising admin account or obtaining secret API keys which can be used to RCE on multiple hosts registered in organisation.

Mitigation

Use os.urandom() or SystemRandom functions to generate secret tokens.

## CVE References

* [2023-32549](/bugs/cve/2023-32549 "Landscape cryptographic keys were ins...")

[Simon Poirier (simpoir)](https://launchpad.net/~simpoir)
on 2021-06-14

| Changed in landscape: | |
| --- | --- |
| **status**: | New → Triaged |
| **importance**: | Undecided → Critical |
| **assignee**: | nobody → Simon Poirier (simpoir) |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Anton (ivanovant)](https://launchpad.net/~ivanovant) wrote on 2021-06-15: |  |  | [#1](/landscape/%2Bbug/1929034/comments/1) |
| --- | --- | --- | --- |

Hello!

Thank for the update. Will you assign CVE for this bug?

Hello!
Thank for the update. Will you assign CVE for this bug?

[Simon Poirier (simpoir)](https://launchpad.net/~simpoir)
on 2021-06-18

| Changed in landscape: | |
| --- | --- |
| **status**: | Triaged → In Progress |

[Simon Poirier (simpoir)](https://launchpad.net/~simpoir)
on 2021-06-29

| Changed in landscape: | |
| --- | --- |
| **status**: | In Progress → Fix Committed |
| **milestone**: | none → 19.10.5 |

[Simon Poirier (simpoir)](https://launchpad.net/~simpoir)
on 2021-08-11

| Changed in landscape: | |
| --- | --- |
| **status**: | Fix Committed → Fix Released |

[Anton (ivanovant)](https://launchpad.net/~ivanovant)
on 2023-05-07

| **information type**: | Private Security → Public |
| --- | --- |

[Alex Murray (alexmurray)](https://launchpad.net/~alexmurray)
on 2023-05-08

| **information type**: | Public → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2023-05-09: |  |  | [#3](/landscape/%2Bbug/1929034/comments/3) |
| --- | --- | --- | --- |

Thank you for reporting this vulnerability Anton.

Please refer to this vulnerability as CVE-2023-32549.

Thank you for reporting this vulnerability Anton.
Please refer to this vulnerability as CVE-2023-32549.

[See full activity log](https://bugs.launchpad.net/landscape/%2Bbug/1929034/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/landscape/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/landscape/%2Bbug/1929034/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/landscape/%2Bbug/1929034/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/landscape/%2Bbug/1929034/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))


