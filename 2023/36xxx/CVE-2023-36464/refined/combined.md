=== Content from github.com_0f376f25_20250114_191445.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fsecurity%2Fadvisories%2FGHSA-4vvm-4w3v-6mr8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fsecurity%2Fadvisories%2FGHSA-4vvm-4w3v-6mr8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  22](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

# Possible Infinite Loop when a comment isn't followed by a character

Moderate

[MartinThoma](/MartinThoma)
published
GHSA-4vvm-4w3v-6mr8
Jun 27, 2023

## Package

pip

PyPDF2
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>=2.2.0

## Patched versions

None

pip

pypdf
([pip](/advisories?query=ecosystem%3Apip))

<= 3.8.1

>=3.9.0

## Description

### Impact

An attacker who uses this vulnerability can craft a PDF which leads to an infinite loop if `__parse_content_stream` is executed. This infinite loop blocks the current process and can utilize a single core of the CPU by 100%. It does not affect memory usage. That is, for example, the case if the user extracted text from such a PDF.

Example Code and a PDF that causes the issue:

```
from pypdf import PdfReader

# https://objects.githubusercontent.com/github-production-repository-file-5c1aeb/3119517/11367871?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20230627%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20230627T201018Z&X-Amz-Expires=300&X-Amz-Signature=d71c8fd9181c4875f0c04d563b6d32f1d4da6e7b2e6be2f14479ce4ecdc9c8b2&X-Amz-SignedHeaders=host&actor_id=1658117&key_id=0&repo_id=3119517&response-content-disposition=attachment%3Bfilename%3DMiFO_LFO_FEIS_NOA_Published.3.pdf&response-content-type=application%2Fpdf
reader = PdfReader("MiFO_LFO_FEIS_NOA_Published.3.pdf")
page = reader.pages[0]
page.extract_text()
```

The issue was introduced with [#969](https://github.com/py-pdf/pypdf/pull/969)

### Patches

The issue was fixed with [#1828](https://github.com/py-pdf/pypdf/pull/1828)

### Workarounds

It is recommended to upgrade to `pypdf>=3.9.0`. PyPDF2 users should migrate to pypdf.

If you cannot update your version of pypdf, you should modify `pypdf/generic/_data_structures.py`:

```
OLD: while peek not in (b"\r", b"\n"):
NEW: while peek not in (b"\r", b"\n", b""):

```

### Severity

Moderate

6.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
None

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H

### CVE ID

CVE-2023-36464

### Weaknesses

No CWEs

### Credits

* [![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&v=4)](/exiledkingcc)
  [exiledkingcc](/exiledkingcc)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f996ab5a_20250114_191440.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F1828)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F1828)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  22](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# BUG: Prevent infinite loop when no character follows after a comment #1828

 Merged

[MartinThoma](/MartinThoma)
merged 2 commits into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[exiledkingcc:fix-1825](/exiledkingcc/pypdf/tree/fix-1825 "exiledkingcc/pypdf:fix-1825")

May 21, 2023

 Merged

# [BUG: Prevent infinite loop when no character follows after a comment](#top) #1828

[MartinThoma](/MartinThoma)
merged 2 commits into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[exiledkingcc:fix-1825](/exiledkingcc/pypdf/tree/fix-1825 "exiledkingcc/pypdf:fix-1825")

May 21, 2023

[Conversation
9](/py-pdf/pypdf/pull/1828)
[Commits
2](/py-pdf/pypdf/pull/1828/commits)
[Checks
0](/py-pdf/pypdf/pull/1828/checks)
[Files changed](/py-pdf/pypdf/pull/1828/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=60&v=4)](/exiledkingcc)

Copy link

Contributor

### @exiledkingcc **[exiledkingcc](/exiledkingcc)** commented [May 3, 2023](#issue-1693377090) • edited by MartinThoma Loading

Fixes [#1825](https://github.com/py-pdf/pypdf/issues/1825)

Sorry, something went wrong.

All reactions

[![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&v=4)](/exiledkingcc)

`[BUG:](/py-pdf/pypdf/pull/1828/commits/f815a683cc4a3b3223d7debe7c69ca2495ec8786 "BUG: fix #1825 no object follows the comment") [fix](/py-pdf/pypdf/pull/1828/commits/f815a683cc4a3b3223d7debe7c69ca2495ec8786 "BUG: fix #1825 no object follows the comment") [py-pdf#1825](https://github.com/py-pdf/pypdf/issues/1825) [no object follows the comment](/py-pdf/pypdf/pull/1828/commits/f815a683cc4a3b3223d7debe7c69ca2495ec8786 "BUG: fix #1825 no object follows the comment")`

`[f815a68](/py-pdf/pypdf/pull/1828/commits/f815a683cc4a3b3223d7debe7c69ca2495ec8786)`

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [May 3, 2023](#issuecomment-1532434412) • edited Loading

|  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://app.codecov.io/gh/py-pdf/pypdf/pull/1828?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) Report Patch coverage: **`100.00`**% and no project coverage change.  Comparison is base [(`dde4c79`)](https://app.codecov.io/gh/py-pdf/pypdf/commit/dde4c79b98ee67cda54e6356fcf841223d5dea80?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) 93.40% compared to head [(`d932a5f`)](https://app.codecov.io/gh/py-pdf/pypdf/pull/1828?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) 93.40%. Additional details and impacted files ``` @@           Coverage Diff           @@ ##             main    #1828   +/-   ## =======================================   Coverage   93.40%   93.40%            =======================================   Files          34       34              Lines        6627     6627              Branches     1299     1299            =======================================   Hits         6190     6190              Misses        285      285              Partials      152      152            ```  | [Impacted Files](https://app.codecov.io/gh/py-pdf/pypdf/pull/1828?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) | Coverage Δ |  | | --- | --- | --- | | [pypdf/generic/\_data\_structures.py](https://app.codecov.io/gh/py-pdf/pypdf/pull/1828?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-cHlwZGYvZ2VuZXJpYy9fZGF0YV9zdHJ1Y3R1cmVzLnB5) | `90.13% <100.00%> (ø)` |  |    [☔ View full report in Codecov by Sentry](https://app.codecov.io/gh/py-pdf/pypdf/pull/1828?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). 📢 Do you have feedback about the report comment? [Let us know in this issue](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). |

All reactions

Sorry, something went wrong.

[![pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=60&v=4)](/pubpub-zz)

**[pubpub-zz](/pubpub-zz)**
approved these changes
[May 3, 2023](#pullrequestreview-1410322957)

 [View reviewed changes](/py-pdf/pypdf/pull/1828/files/f815a683cc4a3b3223d7debe7c69ca2495ec8786)

Copy link

Collaborator

### @pubpub-zz **[pubpub-zz](/pubpub-zz)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Can you add the test refering the pdf refered in [#1825](https://github.com/py-pdf/pypdf/issues/1825)

Sorry, something went wrong.

 👍
1
 pubpub-zz reacted with thumbs up emoji
 ❤️
1
 pubpub-zz reacted with heart emoji

All reactions

* 👍
  1 reaction
* ❤️
  1 reaction

 [![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&u=84a71049dd3f4ce6b4c4fea71b83de18a6fab766&v=4)](/exiledkingcc)
[exiledkingcc](/exiledkingcc)
[force-pushed](/py-pdf/pypdf/compare/d4d818b5e2d84588b2619fe3eddf4771df81f994..faed05c0be3992f5aab4c82c4a0f31744142d272)
the
fix-1825

branch
2 times, most recently
from
[`d4d818b`](/py-pdf/pypdf/commit/d4d818b5e2d84588b2619fe3eddf4771df81f994) to
[`faed05c`](/py-pdf/pypdf/commit/faed05c0be3992f5aab4c82c4a0f31744142d272)  [Compare](/py-pdf/pypdf/compare/d4d818b5e2d84588b2619fe3eddf4771df81f994..faed05c0be3992f5aab4c82c4a0f31744142d272)
[May 8, 2023 06:49](#event-9186959820)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

### **[pubpub-zz](/pubpub-zz)** commented [May 8, 2023](#issuecomment-1538048971)

| great. Just be aware that test running on the server may be slow/long. Maybe you should increase the time-out value to be sure to not trigger it for nothing |
| --- |

All reactions

Sorry, something went wrong.

[![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=80&u=84a71049dd3f4ce6b4c4fea71b83de18a6fab766&v=4)](/exiledkingcc)

Copy link

Contributor

Author

### **[exiledkingcc](/exiledkingcc)** commented [May 8, 2023](#issuecomment-1538063667)

| great. Just be aware that test running on the server may be slow/long. Maybe you should increase the time-out value to be sure to not trigger it for nothing  ok, i will increase timeout to 30, though 10s may be enough. |
| --- |

All reactions

Sorry, something went wrong.

[![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&v=4)](/exiledkingcc)

`[TST: add test for](/py-pdf/pypdf/pull/1828/commits/d932a5f14f5d7df36acbc6da69d923d20c4f4bef "TST: add test for #1825") [py-pdf#1825](https://github.com/py-pdf/pypdf/issues/1825)`

`[d932a5f](/py-pdf/pypdf/pull/1828/commits/d932a5f14f5d7df36acbc6da69d923d20c4f4bef)`

 [![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&u=84a71049dd3f4ce6b4c4fea71b83de18a6fab766&v=4)](/exiledkingcc)
[exiledkingcc](/exiledkingcc)
[force-pushed](/py-pdf/pypdf/compare/faed05c0be3992f5aab4c82c4a0f31744142d272..d932a5f14f5d7df36acbc6da69d923d20c4f4bef)
the
fix-1825

branch
from
[`faed05c`](/py-pdf/pypdf/commit/faed05c0be3992f5aab4c82c4a0f31744142d272) to
[`d932a5f`](/py-pdf/pypdf/commit/d932a5f14f5d7df36acbc6da69d923d20c4f4bef)  [Compare](/py-pdf/pypdf/compare/faed05c0be3992f5aab4c82c4a0f31744142d272..d932a5f14f5d7df36acbc6da69d923d20c4f4bef)
[May 8, 2023 09:39](#event-9188455426)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

### **[pubpub-zz](/pubpub-zz)** commented [May 20, 2023](#issuecomment-1555927114)

| [@MartinThoma](https://github.com/MartinThoma) this PR is all yours |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
changed the title
~~BUG: fix #1825 no object follows the comment~~
BUG: Prevent infinite loop when no character follows after a comment
[May 21, 2023](#event-9296113517)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
merged commit [`b0e5c68`](/py-pdf/pypdf/commit/b0e5c689df689ab173df84dacd77b6fc3c161932)
into
py-pdf:main

[May 21, 2023](https://github.com/py-pdf/pypdf/pull/1828#event-9296114720)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [May 21, 2023](#issuecomment-1556198188)

| Very nice work [@exiledkingcc](https://github.com/exiledkingcc) 👏 Thank you 🙏 |
| --- |

All reactions

Sorry, something went wrong.

[MartinThoma](/MartinThoma)
added a commit
that referenced
this pull request
[May 21, 2023](#ref-commit-0096c99)
[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

`[REL: 3.9.0](/py-pdf/pypdf/commit/0096c99031955b15bd30834e5566076d9528f59d "REL: 3.9.0

New Features (ENH)
-  Simplify metadata input (Document Information Dictionary) (#1851)
-  Extend cmap compatibilty to GBK_EUC_H/V (#1812)

Bug Fixes (BUG)
-  Prevent infinite loop when no character follows after a comment (#1828)
-  get_contents does not return ContentStream (#1847)
-  Accept XYZ destination with zoom missing (default to zoom=0.0) (#1844)
-  Cope with 1 Bit images (#1815)

Robustness (ROB)
-  Handle missing /Type entry in Page tree (#1845)

Documentation (DOC)
-  Expand file size explanations (#1835)
-  Add comparison with pdfplumber (#1837)
-  Clarify that PyPDF2 is dead (#1827)
-  Add Hunter King as Contributor for #1806

Maintenance (MAINT)
-  Refactor internal Encryption class (#1821)
-  Add R parameter to generate_values (#1820)
-  Make encryption_key parameter of write_to_stream optional (#1819)
-  Prepare for adding AES enryption support (#1818)

Code Style (STY):
-  Iterate directly over the list instead of using range (#1839)
-  Minor refactorings in _encryption.py (#1822)

[Full Changelog](https://github.com/py-pdf/pypdf/compare/3.8.1...3.9.0)")`
…

`[0096c99](/py-pdf/pypdf/commit/0096c99031955b15bd30834e5566076d9528f59d)`

```
New Features (ENH)
-  Simplify metadata input (Document Information Dictionary) ([#1851](https://github.com/py-pdf/pypdf/pull/1851))
-  Extend cmap compatibilty to GBK_EUC_H/V ([#1812](https://github.com/py-pdf/pypdf/pull/1812))

Bug Fixes (BUG)
-  Prevent infinite loop when no character follows after a comment ([#1828](https://github.com/py-pdf/pypdf/pull/1828))
-  get_contents does not return ContentStream ([#1847](https://github.com/py-pdf/pypdf/pull/1847))
-  Accept XYZ destination with zoom missing (default to zoom=0.0) ([#1844](https://github.com/py-pdf/pypdf/pull/1844))
-  Cope with 1 Bit images ([#1815](https://github.com/py-pdf/pypdf/pull/1815))

Robustness (ROB)
-  Handle missing /Type entry in Page tree ([#1845](https://github.com/py-pdf/pypdf/pull/1845))

Documentation (DOC)
-  Expand file size explanations ([#1835](https://github.com/py-pdf/pypdf/pull/1835))
-  Add comparison with pdfplumber ([#1837](https://github.com/py-pdf/pypdf/pull/1837))
-  Clarify that PyPDF2 is dead ([#1827](https://github.com/py-pdf/pypdf/pull/1827))
-  Add Hunter King as Contributor for [#1806](https://github.com/py-pdf/pypdf/pull/1806)

Maintenance (MAINT)
-  Refactor internal Encryption class ([#1821](https://github.com/py-pdf/pypdf/pull/1821))
-  Add R parameter to generate_values ([#1820](https://github.com/py-pdf/pypdf/pull/1820))
-  Make encryption_key parameter of write_to_stream optional ([#1819](https://github.com/py-pdf/pypdf/pull/1819))
-  Prepare for adding AES enryption support ([#1818](https://github.com/py-pdf/pypdf/pull/1818))

Code Style (STY):
-  Iterate directly over the list instead of using range ([#1839](https://github.com/py-pdf/pypdf/pull/1839))
-  Minor refactorings in _encryption.py ([#1822](https://github.com/py-pdf/pypdf/pull/1822))

[Full Changelog]([3.8.1...3.9.0](https://github.com/py-pdf/pypdf/compare/3.8.1...3.9.0))
```

 [![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=40&u=84a71049dd3f4ce6b4c4fea71b83de18a6fab766&v=4)](/exiledkingcc)
[exiledkingcc](/exiledkingcc)
deleted the
fix-1825

branch
[May 22, 2023 15:09](#event-9303977078)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 27, 2023](#issuecomment-1610183277)

| I've just created a security advisory for this: [GHSA-4vvm-4w3v-6mr8](https://github.com/py-pdf/pypdf/security/advisories/GHSA-4vvm-4w3v-6mr8 "GHSA-4vvm-4w3v-6mr8") |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
added
the
[nf-security](/py-pdf/pypdf/labels/nf-security)
Non-functional change: Security
label
[Jun 29, 2023](#event-9681344830)

[![@ThiefMaster](https://avatars.githubusercontent.com/u/179599?s=80&v=4)](/ThiefMaster)

Copy link

### **[ThiefMaster](/ThiefMaster)** commented [Jul 7, 2023](#issuecomment-1625571233)

| A release with the fix would be great, considering that Dependabot is now bothering users about this :) |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jul 7, 2023](#issuecomment-1625702138) • edited Loading

| It is fixed in `pypdf>=3.9.0` (as stated above + in the advisory).  PyPDF2 users should migrate to pypdf. |
| --- |

 👍
2
 ThiefMaster and Ludy87 reacted with thumbs up emoji

All reactions

* 👍
  2 reactions

Sorry, something went wrong.

[linusjf](/linusjf)
added a commit
to linusjf/LearnPython3
that referenced
this pull request
[Jul 25, 2023](#ref-commit-5d360aa)
[![@linusjf](https://avatars.githubusercontent.com/u/24714685?s=40&v=4)](/linusjf)

`[fix: fix for security violations based on](/linusjf/LearnPython3/commit/5d360aac538ef4760e0d8004ca08a0df319dac0d "fix: fix for security violations based on https://github.com/py-pdf/pypdf/pull/1828") [py-pdf/pypdf#1828](https://github.com/py-pdf/pypdf/pull/1828)`

`[5d360aa](/linusjf/LearnPython3/commit/5d360aac538ef4760e0d8004ca08a0df319dac0d)`

[linusjf](/linusjf)
added a commit
to linusjf/LearnPython3
that referenced
this pull request
[Jul 25, 2023](#ref-commit-c9cc73f)
[![@linusjf](https://avatars.githubusercontent.com/u/24714685?s=40&v=4)](/linusjf)

`[fix: fix for security violations based on](/linusjf/LearnPython3/commit/c9cc73f8cc0f1ac22a5d928336f796fbee17c014 "fix: fix for security violations based on https://github.com/py-pdf/pypdf/pull/1828") [py-pdf/pypdf#1828](https://github.com/py-pdf/pypdf/pull/1828)`

`[c9cc73f](/linusjf/LearnPython3/commit/c9cc73f8cc0f1ac22a5d928336f796fbee17c014)`

[![@geo-ghci-test](https://avatars.githubusercontent.com/in/849645?s=40&v=4)](/apps/geo-ghci-test)
[geo-ghci-test](/apps/geo-ghci-test)
bot
mentioned this pull request
[Apr 12, 2024](#ref-issue-2236621767)

[Geo GHCI test Dashboard
sbrunner/scan-to-paperless#1314](/sbrunner/scan-to-paperless/issues/1314)

Closed

3 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F1828)

Reviewers

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz) [pubpub-zz](/pubpub-zz)

pubpub-zz approved these changes

Assignees

No one assigned

Labels

[nf-security](/py-pdf/pypdf/labels/nf-security)
Non-functional change: Security

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [pypdf hangs on one specific PDF - cannot catch error with try/except](https://github.com/py-pdf/pypdf/issues/1825)

4 participants

[![@exiledkingcc](https://avatars.githubusercontent.com/u/8359368?s=52&v=4)](/exiledkingcc) [![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=52&v=4)](/pubpub-zz) [![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=52&v=4)](/MartinThoma) [![@ThiefMaster](https://avatars.githubusercontent.com/u/179599?s=52&v=4)](/ThiefMaster)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e02c538a_20250114_191445.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F969)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F969)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=py-pdf%2Fpypdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[py-pdf](/py-pdf)
/
**[pypdf](/py-pdf/pypdf)**
Public

* [Notifications](/login?return_to=%2Fpy-pdf%2Fpypdf) You must be signed in to change notification settings
* [Fork
  1.4k](/login?return_to=%2Fpy-pdf%2Fpypdf)
* [Star
   8.6k](/login?return_to=%2Fpy-pdf%2Fpypdf)

* [Code](/py-pdf/pypdf)
* [Issues
  75](/py-pdf/pypdf/issues)
* [Pull requests
  22](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

Additional navigation options

* [Code](/py-pdf/pypdf)
* [Issues](/py-pdf/pypdf/issues)
* [Pull requests](/py-pdf/pypdf/pulls)
* [Discussions](/py-pdf/pypdf/discussions)
* [Actions](/py-pdf/pypdf/actions)
* [Security](/py-pdf/pypdf/security)
* [Insights](/py-pdf/pypdf/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpy-pdf%2Fpypdf%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# improved ExtractText(3) #969

 Merged

[MartinThoma](/MartinThoma)
merged 45 commits into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[pubpub-zz:ExtractText](/pubpub-zz/pypdf/tree/ExtractText "pubpub-zz/pypdf:ExtractText")

Jun 13, 2022

 Merged

# [improved ExtractText(3)](#top) #969

[MartinThoma](/MartinThoma)
merged 45 commits into
[py-pdf:main](/py-pdf/pypdf/tree/main "py-pdf/pypdf:main")
from
[pubpub-zz:ExtractText](/pubpub-zz/pypdf/tree/ExtractText "pubpub-zz/pypdf:ExtractText")

Jun 13, 2022

[Conversation
81](/py-pdf/pypdf/pull/969)
[Commits
45](/py-pdf/pypdf/pull/969/commits)
[Checks
0](/py-pdf/pypdf/pull/969/checks)
[Files changed](/py-pdf/pypdf/pull/969/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=60&v=4)](/pubpub-zz)

Copy link

Collaborator

### @pubpub-zz **[pubpub-zz](/pubpub-zz)** commented [Jun 10, 2022](#issue-1268005067) • edited Loading

New corrections for `extract_text()`

fixes extraction in cmap

[#953](https://github.com/py-pdf/pypdf/issues/953)

[#431](https://github.com/py-pdf/pypdf/issues/431)

[#242](https://github.com/py-pdf/pypdf/issues/242)

[#591](https://github.com/py-pdf/pypdf/issues/591) /[#954](https://github.com/py-pdf/pypdf/pull/954) should be good but doubts on arabic

Sorry, something went wrong.

 ❤️
1
 MartinThoma reacted with heart emoji

All reactions

* ❤️
  1 reaction

 [pubpub-zz](/pubpub-zz)
added 9 commits
[June 10, 2022 22:14](#commits-pushed-48421df)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[Relative import](/py-pdf/pypdf/pull/969/commits/48421df9027bc7b6db6dee715c224c85e1b8101d "Relative import")`

`[48421df](/py-pdf/pypdf/pull/969/commits/48421df9027bc7b6db6dee715c224c85e1b8101d)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[improve TextExtraction](/py-pdf/pypdf/pull/969/commits/c7829d8757fb53f9114dd262e0a3cb5c1d2ef26f "improve TextExtraction

TODO : add some encodings missing")`
 …

`[c7829d8](/py-pdf/pypdf/pull/969/commits/c7829d8757fb53f9114dd262e0a3cb5c1d2ef26f)`

```
TODO : add some encodings missing
```

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[Extend testing](/py-pdf/pypdf/pull/969/commits/7a9c22ca61db80933996214e7c090d67a10ea643 "Extend testing")`

`[7a9c22c](/py-pdf/pypdf/pull/969/commits/7a9c22ca61db80933996214e7c090d67a10ea643)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[improve readability of BooleanObjects](/py-pdf/pypdf/pull/969/commits/b0a7736cc9f39cff8182cbaa41c21976cb51a8e3 "improve readability of BooleanObjects")`

`[b0a7736](/py-pdf/pypdf/pull/969/commits/b0a7736cc9f39cff8182cbaa41c21976cb51a8e3)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[Apply Black](/py-pdf/pypdf/pull/969/commits/d7f84d07158bee13e32e22ab697898eeab0ec53d "Apply Black")`

`[d7f84d0](/py-pdf/pypdf/pull/969/commits/d7f84d07158bee13e32e22ab697898eeab0ec53d)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[fix early mypy](/py-pdf/pypdf/pull/969/commits/59504ec3b0b922fa8512f02a5a713bc2c5f136ca "fix early mypy")`

`[59504ec](/py-pdf/pypdf/pull/969/commits/59504ec3b0b922fa8512f02a5a713bc2c5f136ca)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[fix mypy2](/py-pdf/pypdf/pull/969/commits/58bd0e56e7956c4dab7db14a24dd5cc97b7e9e8d "fix mypy2")`

`[58bd0e5](/py-pdf/pypdf/pull/969/commits/58bd0e56e7956c4dab7db14a24dd5cc97b7e9e8d)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[attempt fix iss with test_utils](/py-pdf/pypdf/pull/969/commits/941461a885e5237e89b6cbd718e4d645b3f58b02 "attempt fix iss with test_utils")`

`[941461a](/py-pdf/pypdf/pull/969/commits/941461a885e5237e89b6cbd718e4d645b3f58b02)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[Merge branch 'main' into ExtractText](/py-pdf/pypdf/pull/969/commits/e4c37cb593ce098adf3596cd2f28dace5ae3e2e0 "Merge branch 'main' into ExtractText")`

`[e4c37cb](/py-pdf/pypdf/pull/969/commits/e4c37cb593ce098adf3596cd2f28dace5ae3e2e0)`

[![MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=60&v=4)](/MartinThoma)

**[MartinThoma](/MartinThoma)**
reviewed
[Jun 10, 2022](#pullrequestreview-1003325952)

 [View reviewed changes](/py-pdf/pypdf/pull/969/files/e4c37cb593ce098adf3596cd2f28dace5ae3e2e0)

[PyPDF2/\_cmap.py](/py-pdf/pypdf/pull/969/files/e4c37cb593ce098adf3596cd2f28dace5ae3e2e0#diff-9d5a15e41bb26e4dbe48d91e03a27fe84ffdc3f83f72e9759751a6f66510de72)
Outdated

Show resolved

Hide resolved

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 10, 2022](#issuecomment-1152739185)

| There are two minor Flake8 issues:  ``` ./tests/test_utils.py:7:1: F401 'PyPDF2._utils.read_block_backwards' imported but unused ./tests/test_utils.py:7:1: F401 'PyPDF2._utils.read_previous_line' imported but unused  ```  Do you prefer to fix them yourself or should I do it? (also as a general question) |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 10, 2022](#issuecomment-1152740483)

| [@MartinThoma](https://github.com/MartinThoma), I need your help !! 😥 I have an issue in test\_utils.py : My changes on tag 2.1.0 works but I get regressions on main.  Can you have a look please |
| --- |

 👍
1
 MartinThoma reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

 [MartinThoma](/MartinThoma)
added 2 commits
[June 10, 2022 23:21](#commits-pushed-39e94f9)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[Minor flake8 fix](/py-pdf/pypdf/pull/969/commits/39e94f9e8b122ac8d17d0e0a3021aa78a637d590 "Minor flake8 fix")`

`[39e94f9](/py-pdf/pypdf/pull/969/commits/39e94f9e8b122ac8d17d0e0a3021aa78a637d590)`

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[Adjust mypy types](/py-pdf/pypdf/pull/969/commits/9763868118cba3342ad02875286a75332759617a "Adjust mypy types")`

`[9763868](/py-pdf/pypdf/pull/969/commits/9763868118cba3342ad02875286a75332759617a)`

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 10, 2022](#issuecomment-1152751177)

| [@pubpub-zz](https://github.com/pubpub-zz) I might be sleepy-dumb, but I don't see what you mean. I think you only have to minor stylistic / mypy adjustments you need to make: [#971](https://github.com/py-pdf/pypdf/pull/971) |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 10, 2022](#issuecomment-1152751427)

| I'll have a more detailed look tomorrow at all the goodness you're bringing to PyPDF2 this time :-) |
| --- |

 🎉
1
 Butterfly reacted with hooray emoji

All reactions

* 🎉
  1 reaction

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 10, 2022](#issuecomment-1152752541) • edited Loading

| Oh, if you worry about the code coverage: That's not so bad. It's especially not a blocker from getting your improvements merged.  I will run various tests (especially <https://github.com/py-pdf/benchmarks> ) to check things are improved. I can live if coverage drops a bit (and I will have a more detailed look at the places which are not covered) |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 10, 2022](#issuecomment-1152755394)

| [@MartinThoma](https://github.com/MartinThoma) If you look at the changed files I had to drastically revert in test\_utils.py as I had major issues with it. give me 5 min and I will confirm/infirm my issue |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[Merge branch 'pubpub-zz-ExtractText' into origin/ExtractText](/py-pdf/pypdf/pull/969/commits/53294f2fd7d970112e19af07bd9f1c636641dd19 "Merge branch 'pubpub-zz-ExtractText' into origin/ExtractText")`

`[53294f2](/py-pdf/pypdf/pull/969/commits/53294f2fd7d970112e19af07bd9f1c636641dd19)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 10, 2022](#issuecomment-1152757503)

| [@MartinThoma](https://github.com/MartinThoma) my problems are this section of code  ```  @pytest.mark.parametrize(     ("dat", "pos", "expected", "expected_pos"),     [         (b"abc", 1, b"a", 0),         (b"abc", 2, b"ab", 0),         (b"abc", 3, b"abc", 0),         (b"abc\n", 3, b"abc", 0),         (b"abc\n", 4, b"", 3),         (b"abc\n\r", 4, b"", 3),         (b"abc\nd", 5, b"d", 3),         # Skip over multiple CR/LF bytes         (b"abc\n\r\ndef", 9, b"def", 3),         # Include a block full of newlines...         (             b"abc" + b"\n" * (2 * io.DEFAULT_BUFFER_SIZE) + b"d",             2 * io.DEFAULT_BUFFER_SIZE + 4,             b"d",             3,         ),         # Include a block full of non-newline characters         (             b"abc\n" + b"d" * (2 * io.DEFAULT_BUFFER_SIZE),             2 * io.DEFAULT_BUFFER_SIZE + 4,             b"d" * (2 * io.DEFAULT_BUFFER_SIZE),             3,         ),         # Both         (             b"abcxyz"             + b"\n" * (2 * io.DEFAULT_BUFFER_SIZE)             + b"d" * (2 * io.DEFAULT_BUFFER_SIZE),             4 * io.DEFAULT_BUFFER_SIZE + 6,             b"d" * (2 * io.DEFAULT_BUFFER_SIZE),             6,         ),     ], ) def test_read_previous_line(dat, pos, expected, expected_pos):     s = io.BytesIO(dat)     s.seek(pos)     assert read_previous_line(s) == expected     assert s.tell() == expected_pos  ``` |
| --- |

All reactions

Sorry, something went wrong.

 [pubpub-zz](/pubpub-zz)
added 2 commits
[June 10, 2022 23:43](#commits-pushed-744464f)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[revert in test_utils](/py-pdf/pypdf/pull/969/commits/744464fe9a5ad131a04b2be1b72f7a1bbf8cbd33 "revert in test_utils")`

`[744464f](/py-pdf/pypdf/pull/969/commits/744464fe9a5ad131a04b2be1b72f7a1bbf8cbd33)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[paste error](/py-pdf/pypdf/pull/969/commits/0ed4d9ab1cd85cc6b82c334df0fbef79a8d2e018 "paste error")`

`[0ed4d9a](/py-pdf/pypdf/pull/969/commits/0ed4d9ab1cd85cc6b82c334df0fbef79a8d2e018)`

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 10, 2022](#issuecomment-1152760165)

| Oh damn. That sounds as if it's related to [#646](https://github.com/py-pdf/pypdf/pull/646)  I'll have a closer look tomorrow |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 10, 2022](#issuecomment-1152761897)

| I still have some work to fix text extraction with the "paper rotated" Chinese / russian/ .... are working I have some doubts about arabic as the text is written right to left. |
| --- |

All reactions

Sorry, something went wrong.

 [pubpub-zz](/pubpub-zz)
added 2 commits
[June 10, 2022 23:53](#commits-pushed-5b96216)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[flake 8](/py-pdf/pypdf/pull/969/commits/5b96216cab65dc2835c03d0a5fd3f568537a973d "flake 8")`

`[5b96216](/py-pdf/pypdf/pull/969/commits/5b96216cab65dc2835c03d0a5fd3f568537a973d)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[flake8](/py-pdf/pypdf/pull/969/commits/b2830e9a3bb7c54d9b8bf92ab28092f917530d25 "flake8")`

`[b2830e9](/py-pdf/pypdf/pull/969/commits/b2830e9a3bb7c54d9b8bf92ab28092f917530d25)`

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Jun 10, 2022](#issuecomment-1152768068) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) Report Merging [#969](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) ([2aea3e9](https://github.com/py-pdf/pypdf/commit/2aea3e97b89c4c7f4845b888a2dc1fc647db7576)) into [main](https://codecov.io/gh/py-pdf/PyPDF2/commit/9c4e7f52fb3c53ed6391d4a96e227116a9473acf?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) ([9c4e7f5](https://github.com/py-pdf/pypdf/commit/9c4e7f52fb3c53ed6391d4a96e227116a9473acf)) will **increase** coverage by `0.16%`. The diff coverage is `86.43%`.  ``` @@            Coverage Diff             @@ ##             main     #969      +/-   ## ========================================== + Coverage   84.25%   84.42%   +0.16%      ==========================================   Files          18       18                 Lines        4115     4179      +64        Branches      868      887      +19      ========================================== + Hits         3467     3528      +61      - Misses        465      468       +3        Partials      183      183               ```  | [Impacted Files](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) | Coverage Δ |  | | --- | --- | --- | | [PyPDF2/\_page.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL19wYWdlLnB5) | `82.65% <ø> (+1.10%)` | ⬆️ | | [PyPDF2/\_cmap.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL19jbWFwLnB5) | `76.43% <76.43%> (+3.70%)` | ⬆️ | | [PyPDF2/generic.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL2dlbmVyaWMucHk=) | `89.70% <81.81%> (-0.13%)` | ⬇️ | | [PyPDF2/\_utils.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL191dGlscy5weQ==) | `98.03% <98.03%> (ø)` |  | | [PyPDF2/\_\_init\_\_.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL19faW5pdF9fLnB5) | `100.00% <100.00%> (ø)` |  | | [PyPDF2/filters.py](https://codecov.io/gh/py-pdf/PyPDF2/pull/969/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf#diff-UHlQREYyL2ZpbHRlcnMucHk=) | `81.81% <0.00%> (+0.64%)` | ⬆️ |   ---   [Continue to review full report at Codecov](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf).  **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf) `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data` Powered by [Codecov](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). Last update [9c4e7f5...2aea3e9](https://codecov.io/gh/py-pdf/PyPDF2/pull/969?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=py-pdf). |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[Add 'test_previous_line' back](/py-pdf/pypdf/pull/969/commits/1223d75c0d865f4164a3b4c8ca32247a620b1a54 "Add 'test_previous_line' back")`

`[1223d75](/py-pdf/pypdf/pull/969/commits/1223d75c0d865f4164a3b4c8ca32247a620b1a54)`

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 11, 2022](#issuecomment-1152864899)

| [@pubpub-zz](https://github.com/pubpub-zz) I've added the test back, without any adjustment. It works: [#971](https://github.com/py-pdf/pypdf/pull/971) Did you maybe solve the issue in between? |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
mentioned this pull request
[Jun 11, 2022](#ref-pullrequest-1268036157)

[Pubpub zz extract text
#971](/py-pdf/pypdf/pull/971)
 Closed

64 hidden items

Load more…

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 12, 2022](#issuecomment-1153122889)

| [@pubpub-zz](https://github.com/pubpub-zz) I cannot answer that. It would be ok for me to have the behavior as in the specs, which also means that `crazyones.txt` needs to get adjusted.  I just re-ran the benchmark and the results look very similar. |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 12, 2022](#issuecomment-1153168840)

| [@pubpub-zz](https://github.com/pubpub-zz) I cannot answer that. It would be ok for me to have the behavior as in the specs, which also means that `crazyones.txt` needs to get adjusted.  I just re-ran the benchmark and the results look very similar.  [@MartinThoma](https://github.com/MartinThoma), I did more research and I think I've got the solution. should be available by diner |
| --- |

 ❤️
1
 MartinThoma reacted with heart emoji

All reactions

* ❤️
  1 reaction

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 12, 2022](#issuecomment-1153173895)

| [@pubpub-zz](https://github.com/pubpub-zz) I love how committed you are to improve PyPDF2, but please don't feel pressured because I said that I wanted to make a release today. It's unpaid so it should be fun. If it doesn't work today or even for some weeks, it would be fine 🤗 |
| --- |

All reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[fix Encoding / ToUnicode at the same time](/py-pdf/pypdf/pull/969/commits/534a8bb1e95e91320135e510851f610fcfcc0e07 "fix Encoding / ToUnicode at the same time")`

`[534a8bb](/py-pdf/pypdf/pull/969/commits/534a8bb1e95e91320135e510851f610fcfcc0e07)`

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 12, 2022](#issuecomment-1153243023)

| Devlivered just before diner and I've mowed the lawn 😁 |
| --- |

 👍
1
 MartinThoma reacted with thumbs up emoji
 😄
1
 MartinThoma reacted with laugh emoji
 🚀
1
 MartinThoma reacted with rocket emoji

All reactions

* 👍
  1 reaction
* 😄
  1 reaction
* 🚀
  1 reaction

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 12, 2022](#issuecomment-1153244264) • edited Loading

| [@MartinThoma](https://github.com/MartinThoma) , can you have a look I do not understand : there is an error on test\_utils but it did not changed it. and it's working fine locally |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 12, 2022](#issuecomment-1153269628)

| That is a merge with main which got wrong. You need to adjust the "ids" parameter to match the number of tests. I think there is currently an "11" but it should be "8" (in the range function) |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 12, 2022](#issuecomment-1153269787)

| I've set the ids because the auto-generated I'd takes just all of the parameters which was extremely long |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 12, 2022](#issuecomment-1153270220)

| Devlivered just before diner and I've mowed the lawn  Good job 😁👍 I was just making burgers for my girlfriend and we will now have an relaxed evening 😊 |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[Merge branch 'main' into ExtractText](/py-pdf/pypdf/pull/969/commits/d92597a62591eb4f0ac73828e0f887e065ca9c09 "Merge branch 'main' into ExtractText")`

`[d92597a](/py-pdf/pypdf/pull/969/commits/d92597a62591eb4f0ac73828e0f887e065ca9c09)`

[![MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=60&v=4)](/MartinThoma)

**[MartinThoma](/MartinThoma)**
reviewed
[Jun 13, 2022](#pullrequestreview-1004151585)

 [View reviewed changes](/py-pdf/pypdf/pull/969/files/d92597a62591eb4f0ac73828e0f887e065ca9c09)

[tests/test\_utils.py](/py-pdf/pypdf/pull/969/files/d92597a62591eb4f0ac73828e0f887e065ca9c09#diff-33c13e0b177bacd2f02e29bcb8aea5b49e7ce34901fd8f41fefb65defba1bd33)
Outdated

Show resolved

Hide resolved

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[Apply suggestions from code review](/py-pdf/pypdf/pull/969/commits/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0 "Apply suggestions from code review")`

`[0ba91aa](/py-pdf/pypdf/pull/969/commits/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0)`

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 13, 2022](#issuecomment-1153789983)

| [@pubpub-zz](https://github.com/pubpub-zz) I've updated the PR so that the tests run. It was weird that they didn't succeed ... apparently, the tests ran on code as if it was already having the automatic merge. The automatic merge didn't adjust the ids range: [0ba91aa](https://github.com/py-pdf/pypdf/commit/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0)  I try to go through the PR today evening / night :-) |
| --- |

All reactions

Sorry, something went wrong.

[![MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=60&v=4)](/MartinThoma)

**[MartinThoma](/MartinThoma)**
reviewed
[Jun 13, 2022](#pullrequestreview-1004594389)

 [View reviewed changes](/py-pdf/pypdf/pull/969/files/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0)

[PyPDF2/\_cmap.py](/py-pdf/pypdf/pull/969/files/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0#diff-9d5a15e41bb26e4dbe48d91e03a27fe84ffdc3f83f72e9759751a6f66510de72)
Outdated

Show resolved

Hide resolved

[![MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=60&v=4)](/MartinThoma)

**[MartinThoma](/MartinThoma)**
reviewed
[Jun 13, 2022](#pullrequestreview-1004596376)

 [View reviewed changes](/py-pdf/pypdf/pull/969/files/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0)

[PyPDF2/\_cmap.py](/py-pdf/pypdf/pull/969/files/0ba91aa6ac810ac6a7efbd677c2e573b8ca982e0#diff-9d5a15e41bb26e4dbe48d91e03a27fe84ffdc3f83f72e9759751a6f66510de72)
Outdated

Show resolved

Hide resolved

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 13, 2022](#issuecomment-1154131526)

| [@pubpub-zz](https://github.com/pubpub-zz) Looks good to me! I would squash-commit with the following text:  ``` ENH: Text Extraction improvements  - Improvements around /Encoding / /ToUnicode - Extraction of CMaps improved - Fallback for font def missing - Support for /Identity-H and /Identity-V: utf-16-be - Support for /GB-EUC-H / /GB-EUC-V: gbk - Support for /GBpc-EUC-H / /GBpc-EUC-V : gb2312 - Store default font space width for 18 commonly used fonts to improve   whitespace extraction  ```  Does that represent the changes well to users? |
| --- |

All reactions

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=80&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

Copy link

Member

### **[MartinThoma](/MartinThoma)** commented [Jun 13, 2022](#issuecomment-1154132049)

| Besides the two typos I've just commented, there is one robustness-change I would do: The `.decode("utf-16-be")` fails 167x for 22847 PDF files (0.7% of my dataset, so not too wild) with:  ```     return self._extract_text(self, self.pdf, space_width, PG.CONTENTS)   File "/home/moose/Github/py-pdf/PyPDF2/PyPDF2/_page.py", line 1125, in _extract_text     cmaps[f] = build_char_map(f, space_width, obj)   File "/home/moose/Github/py-pdf/PyPDF2/PyPDF2/_cmap.py", line 21, in build_char_map     map_dict, space_code, int_entry = parse_to_unicode(ft, space_code)   File "/home/moose/Github/py-pdf/PyPDF2/PyPDF2/_cmap.py", line 221, in parse_to_unicode     ] = unhexlify(sq).decode("utf-16-be")   File "/home/moose/.pyenv/versions/3.10.2/lib/python3.10/encodings/utf_16_be.py", line 16, in decode     return codecs.utf_16_be_decode(input, errors, True) UnicodeDecodeError: 'utf-16-be' codec can't decode bytes in position 0-1: unexpected end of data  ```  I would just wrap it in a try-except `UnicodeDecodeError`:  ``` import logging logger = logging.getLogger(__name__)  ...                  while a <= b:                     sq = fmt2 % c                     key = unhexlify(fmt % a).decode(                                 "charmap" if map_dict[-1] == 1 else "utf-16-be"                             )                     unhexlified = unhexlify(sq)                     try:                          decoded = unhexlified.decode("utf-16-be")                     except UnicodeDecodeError as exc:                         logger.warning("UnicodeDecodeError when parsing cmap")                         a += 1                         c += 1                         continue                     map_dict[key] = decoded                     int_entry.append(a)                     a += 1                     c += 1 ``` |
| --- |

All reactions

Sorry, something went wrong.

 [pubpub-zz](/pubpub-zz)
and others
added 2 commits
[June 13, 2022 18:35](#commits-pushed-88f1298)

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz) [![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[typo](/py-pdf/pypdf/pull/969/commits/88f129804eb2b833ec2ebee0ed18c94e3b94db44 "typo

Co-authored-by: Martin Thoma <info@martin-thoma.de>")`
 …

`[88f1298](/py-pdf/pypdf/pull/969/commits/88f129804eb2b833ec2ebee0ed18c94e3b94db44)`

```
Co-authored-by: Martin Thoma <info@martin-thoma.de>
```

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz) [![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma)

`[typoUpdate PyPDF2/_cmap.py](/py-pdf/pypdf/pull/969/commits/de7ddc0d834e30c8916825de228478277671d893 "typoUpdate PyPDF2/_cmap.py

Co-authored-by: Martin Thoma <info@martin-thoma.de>")`
 …

`[de7ddc0](/py-pdf/pypdf/pull/969/commits/de7ddc0d834e30c8916825de228478277671d893)`

```
Co-authored-by: Martin Thoma <info@martin-thoma.de>
```

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 13, 2022](#issuecomment-1154157632)

| under analysis |
| --- |

 ❤️
2
 MartinThoma and S1SYPHOS reacted with heart emoji

All reactions

* ❤️
  2 reactions

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 13, 2022](#issuecomment-1154160681) • edited Loading

| ENH: Text Extraction improvements   * Improvements around /Encoding / /ToUnicode * Extraction of CMaps improved * Fallback for font def missing * Support for /Identity-H and /Identity-V: utf-16-be   * Support for /GB-EUC-H / /GB-EUC-V / GBp/c-EUC-H / /GBpc-EUC-V (beta release for evaluation) * Arabic (for evaluation) * whitespace extraction improvement |
| --- |

 👍
1
 MartinThoma reacted with thumbs up emoji
 ❤️
1
 MartinThoma reacted with heart emoji
 🚀
1
 MartinThoma reacted with rocket emoji

All reactions

* 👍
  1 reaction
* ❤️
  1 reaction
* 🚀
  1 reaction

Sorry, something went wrong.

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)

`[fix 'utf-16-be' codec can't decode bytes in position 0-1: unexpected …](/py-pdf/pypdf/pull/969/commits/2aea3e97b89c4c7f4845b888a2dc1fc647db7576 "fix  'utf-16-be' codec can't decode bytes in position 0-1: unexpected end of data

use surrogatepass  in _cmap and _page")`
 …

`[2aea3e9](/py-pdf/pypdf/pull/969/commits/2aea3e97b89c4c7f4845b888a2dc1fc647db7576)`

```
…end of data

use surrogatepass  in _cmap and _page
```

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=80&v=4)](/pubpub-zz)

Copy link

Collaborator

Author

### **[pubpub-zz](/pubpub-zz)** commented [Jun 13, 2022](#issuecomment-1154339480) • edited Loading

| [@MartinThoma](https://github.com/MartinThoma) This latest mod fixed the `'utf-16-be' codec can't decode bytes in position 0-1: unexpected end of data` This should close the issue on the .7% remaining |
| --- |

 ❤️
1
 MartinThoma reacted with heart emoji
 🚀
1
 MartinThoma reacted with rocket emoji

All reactions

* ❤️
  1 reaction
* 🚀
  1 reaction

Sorry, something went wrong.

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
merged commit [`72fcaae`](/py-pdf/pypdf/commit/72fcaae50e9676ca16346a556c29b688ae2714f8)
into
py-pdf:main

[Jun 13, 2022](https://github.com/py-pdf/pypdf/pull/969#event-6798757050)

[MartinThoma](/MartinThoma)
added a commit
that referenced
this pull request
[Jun 13, 2022](#ref-commit-f0cd829)
[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)

`[REL: 2.2.0](/py-pdf/pypdf/commit/f0cd8292da2dfe020d4042e16b42b24aa2378dd3 "REL: 2.2.0

The 2.2.0 release improves text extraction again via (#969):

* Improvements around /Encoding / /ToUnicode
* Extraction of CMaps improved
* Fallback for font def missing
* Support for /Identity-H and /Identity-V: utf-16-be
* Support for /GB-EUC-H / /GB-EUC-V / GBp/c-EUC-H / /GBpc-EUC-V (beta release for evaluation)
* Arabic (for evaluation)
* Whitespace extraction improvements

Those changes should mainly improve the text extraction for non-ASCII alphabets,
e.g. Russian / Chinese / Japanese / Korean / Arabic.

Full Changelog: https://github.com/py-pdf/PyPDF2/compare/2.1.1...2.2.0")`
…

`[f0cd829](/py-pdf/pypdf/commit/f0cd8292da2dfe020d4042e16b42b24aa2378dd3)`

```
The 2.2.0 release improves text extraction again via ([#969](https://github.com/py-pdf/pypdf/pull/969)):

* Improvements around /Encoding / /ToUnicode
* Extraction of CMaps improved
* Fallback for font def missing
* Support for /Identity-H and /Identity-V: utf-16-be
* Support for /GB-EUC-H / /GB-EUC-V / GBp/c-EUC-H / /GBpc-EUC-V (beta release for evaluation)
* Arabic (for evaluation)
* Whitespace extraction improvements

Those changes should mainly improve the text extraction for non-ASCII alphabets,
e.g. Russian / Chinese / Japanese / Korean / Arabic.

Full Changelog: [2.1.1...2.2.0](https://github.com/py-pdf/pypdf/compare/2.1.1...2.2.0)
```

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)
[pubpub-zz](/pubpub-zz)
mentioned this pull request
[Jun 13, 2022](#ref-issue-1266538399)

[File causes loop method call between functions `extract_xform_text` and `_extract_text`
#966](/py-pdf/pypdf/issues/966)

Closed

 [![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=40&v=4)](/pubpub-zz)
[pubpub-zz](/pubpub-zz)
deleted the
ExtractText

branch
[June 14, 2022 18:04](#event-6806621315)

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&u=4266f1a009b6ecbb840bbafd57b8cc530ca4fcce&v=4)](/MartinThoma)
[MartinThoma](/MartinThoma)
mentioned this pull request
[Jun 16, 2022](#ref-issue-1261773584)

[process\_operation raises "TypeError: a bytes-like object is required, not 'dict'"
#953](/py-pdf/pypdf/issues/953)

Closed

[![@DL6ER](https://avatars.githubusercontent.com/u/16748619?s=40&v=4)](/DL6ER)
[DL6ER](/DL6ER)
mentioned this pull request
[Aug 28, 2022](#ref-issue-1353356128)

[UnicodeDecodeError: 'utf-16-be' codec can't decode byte 0x45 in position 0: truncated data
#1293](/py-pdf/pypdf/issues/1293)

Closed

[![@geo-ghci-test](https://avatars.githubusercontent.com/in/849645?s=40&v=4)](/apps/geo-ghci-test)
[geo-ghci-test](/apps/geo-ghci-test)
bot
mentioned this pull request
[Apr 12, 2024](#ref-issue-2236621767)

[Geo GHCI test Dashboard
sbrunner/scan-to-paperless#1314](/sbrunner/scan-to-paperless/issues/1314)

Closed

3 tasks

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpy-pdf%2Fpypdf%2Fpull%2F969)

Reviewers

[![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=40&v=4)](/MartinThoma) [MartinThoma](/MartinThoma)

MartinThoma left review comments

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@pubpub-zz](https://avatars.githubusercontent.com/u/4083478?s=52&v=4)](/pubpub-zz) [![@MartinThoma](https://avatars.githubusercontent.com/u/1658117?s=52&v=4)](/MartinThoma)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


