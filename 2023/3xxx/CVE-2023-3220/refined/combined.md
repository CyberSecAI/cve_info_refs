=== Content from git.kernel.org_a2d73653_20250114_191925.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiasheng Jiang <jiasheng@iscas.ac.cn> | 2022-12-06 16:02:36 +0800 |
| --- | --- | --- |
| committer | Dmitry Baryshkov <dmitry.baryshkov@linaro.org> | 2023-01-24 10:24:41 +0200 |
| commit | [93340e10b9c5fc86730d149636e0aa8b47bb5a34](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)) | |
| tree | [e09e553d8176dee31b58c9af56222b8e57e8edc5](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34) | |
| parent | [c96988b7d99327bb08bd9efd29a203b22cd88ace](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=c96988b7d99327bb08bd9efd29a203b22cd88ace) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34&id2=c96988b7d99327bb08bd9efd29a203b22cd88ace)) | |
| download | [linux-93340e10b9c5fc86730d149636e0aa8b47bb5a34.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-93340e10b9c5fc86730d149636e0aa8b47bb5a34.tar.gz) | |

drm/msm/dpu: Add check for pstatesAs kzalloc may fail and return NULL pointer,
it should be better to check pstates
in order to avoid the NULL pointer dereference.
Fixes: 25fdd5933e4c ("drm/msm: Add SDM845 DPU support")
Signed-off-by: Jiasheng Jiang <jiasheng@iscas.ac.cn>
Reviewed-by: Abhinav Kumar <quic\_abhinavk@quicinc.com>
Patchwork: https://patchwork.freedesktop.org/patch/514160/
Link: [https://lore.kernel.org/r/20221206080236.43687-1-jiasheng@iscas.ac.cn](https://lore.kernel.org/r/20221206080236.43687-1-jiasheng%40iscas.ac.cn)
Signed-off-by: Dmitry Baryshkov <dmitry.baryshkov@linaro.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)

| -rw-r--r-- | [drivers/gpu/drm/msm/disp/dpu1/dpu\_crtc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/gpu/drm/msm/disp/dpu1/dpu_crtc.c?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/msm/disp/dpu1/dpu\_crtc.c b/drivers/gpu/drm/msm/disp/dpu1/dpu\_crtc.cindex 175d2557e43cf5..f29a339a370506 100644--- a/[drivers/gpu/drm/msm/disp/dpu1/dpu\_crtc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/gpu/drm/msm/disp/dpu1/dpu_crtc.c?id=c96988b7d99327bb08bd9efd29a203b22cd88ace)+++ b/[drivers/gpu/drm/msm/disp/dpu1/dpu\_crtc.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/gpu/drm/msm/disp/dpu1/dpu_crtc.c?id=93340e10b9c5fc86730d149636e0aa8b47bb5a34)@@ -1153,6 +1153,8 @@ static int dpu\_crtc\_atomic\_check(struct drm\_crtc \*crtc, bool needs\_dirtyfb = dpu\_crtc\_needs\_dirtyfb(crtc\_state);  pstates = kzalloc(sizeof(\*pstates) \* DPU\_STAGE\_MAX \* 4, GFP\_KERNEL);+ if (!pstates)+ return -ENOMEM;  if (!crtc\_state->enable || !crtc\_state->active) { DRM\_DEBUG\_ATOMIC("crtc%d -> enable %d, active %d, skip atomic\_check\n", |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:05 +0000


