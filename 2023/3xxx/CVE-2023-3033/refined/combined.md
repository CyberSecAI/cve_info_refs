=== Content from borelenzo.github.io_b8c5c254_20250114_205331.html ===

## Skip links

* [Skip to primary navigation](#site-nav)
* [Skip to content](#main)
* [Skip to footer](#footer)

[![](/assets/res/avatar.png)](/)
[Testeur de stylos](/)

* [Research](/stuff.html)
* [Mutants](/mutant.html)
* [Malwares](/malwares.html)
* [Android Accessibility Service](/android.html)
* [Attacking mobile browsers with extensions](/thesis.html)

Toggle menu

###

Follow

# CVE-2023-3033

This walkthrough presents another vulnerability discovered on the Mobatime web application (see [CVE-2023-3032](/stuff/2023/06/01/cve-2023-3032.html), same version 06.7.2022 affected). This vulnerability allows an authenticated user to impersonate another one, possibly having more privileges.

## Authorisation mechanism

This application is essentially a single page, and the pieces of information are retrieved through AJAX calls. To get adequate pieces of information, the requests carry the user identifier, in order to fetch data related to them. The issue is that this identifier is controlled by the user, and the request body is not protected. It is therefore possible to change this identifier, and impersonate someone else.

A typical AJAX call is as follows:

```
POST /Webengine/api/ajax_api.aspx HTTP/1.1 Accept: */*
Accept-Encoding: gzip, deflate, br
... snipped ...
Sec-GPC: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)
AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0
Safari/537.36 X-Requested-With: XMLHttpRequest

@64eyJhcnJheV9pbnQiOltdLCJmdW5jdGlvbiI6NTA3LCJpcGFyYW0xIjoxNTQsImlwYX
JhbTEwIjowLCJpcGFyYW0xMSI6MCwiaXBhcmFtMTIiOjAsImlwYXJhbTEzIjowLCJpcGF
yYW0xNCI6MCwiaXBhcmFtMTUiOjAsImlwYXJhbTIiOjg0MTUsImlwYXJhbTMiOjAsImlw
YXJhbTQiOjAsImlwYXJhbTUiOjAsImlwYXJhbTYiOjAsImlwYXJhbTciOjAsImlwYXJhb
TgiOjAsImlwYXJhbTkiOjAsImxwYXJhbTEiOjAsInBhcmFtMSI6IiIsInBhcmFtMiI6Ii
IsInBhcmFtMyI6IiIsInBhcmFtNCI6IiIsInBhcmFtNSI6IiIsInRva2VuIjowfQ==

```

One can recognise here a base64-encoded JSON (prefix `eyJ`), which gives us, once decoded:

```
{
    "array_int":[],
    "function":507,
    "iparam1":154,
    "iparam10":0,
    "iparam11":0,
    "iparam12":0,
    "iparam13":0,
    "iparam14":0,
    "iparam15":0,
    "iparam2":8415,
    "iparam3":0,
    "iparam4":0,
    "iparam5":0,
    "iparam6":0,
    "iparam7":0,
    "iparam8":0,
    "iparam9":0,
    "lparam1":0,
    "param1":"",
    "param2":"","
    param3":"",
    "param4":"",
    "param5":"",
    "token":0
}

```

Now, let’s assume that our ID is 154, and that we want to impersonate 155. Keen eye may see that the payload is not signed, hence forgeable. Since the application is a single page, it was likely that this value 154 was carried by a JS variable, and that we could change it at a single place. All subsequent AJAX calls would probably embed the modified ID, and make us act as 155.

## Hunting the identifier

Analysing the traffic reveals that the AJAX requests originate from a call to the routine `Get` in the file `MobaBridge3.js`. One can suppose here that this routine probably deals with the JSON payload so as to authenticated the request:

![trace.png](/assets/res/stuff/trace.png)

![debug.png](/assets/res/stuff/debug.png)

A breakpoint was therefore put at line 1’316, before the function end. Refreshing the page reveals that the attribute `this._param` holds the value 154. It comes from the second argument (`param`). Since the value 154 was already known there, one can step over `LaunchThread` to get back to the calling routine (`$ctor1`).

![dataapi.png](/assets/res/stuff/dataapi.png)

In this routine, a call to `Get` is indeed performed, and the second argument containing the identifier is referred to as `s`. The variable `s` is obtained thanks to a call to `JsonConvert.SerializeObject`, hence was likely to be built based on the variable `function` (line 17). The latter is passed as argument (line 13), and to analyse it, one should once again climb up the calling stack.

![dataapi1.png](/assets/res/stuff/dataapi1.png)

The caller lies in the class `MensualView.cs`, where the `func` variable is initialised (passed as `function` in the callee). It is worth noting that one of the attributes of `func` is named `iparam1`, just like the attribute carrying the identifier in the JSON stream. Its value is held by the attribute `Workflow.pid`. By looking where such variable is set thanks to a regular expression, only two results are returned. One of them lies on the class `LoginLinkWorkflow.cs`

![loginlinkworkflow.cs.png](/assets/res/stuff/loginlinkworkflow.cs.png)

By putting a breakpoint at line 139 and refreshing the page, the breakpoint is hit. The value of the variable `PId` could be turned into 155, and letting the execution flow continue normally, and the page would be rendered as if we were 155.

## Conclusion

Since only the advertised identifier seems to be used to verify the authorisations, a malicious user could trick the application into thinking that they are someone else by changing their ID on the client side. Since the server trusts this ID, they would serve inappropriate content. The server should use server-side variables to store the ID of a user, based on a session identifier. An alternative could make use of signed JWTs to make them inalterable.

* [**2024** 4](#2024)
* [**2023** 13](#2023)
* [**2020** 12](#2020)

## 2024

## [Exploiting CVE-2024-37148](/stuff/2024/06/07/exploit-CVE-2024-37148.html)

3 minute read

Intro
When it comes to input sanitisation, who is responsible, the function or the caller ? Or both ? And if no one does, hoping that the other one will do t...

## [Exploiting CVE-2024-29889 and CVE-2024-31456](/stuff/2024/05/09/exploit-CVE-2024-29889-31456.html)

6 minute read

Intro
After being tasked with auditing GLPI 10.0.12, for which I uncovered two unknown vulnerabilities (CVE-2024-27930 and CVE-2024-27937), I became really i...

## [Exploiting CVE-2024-27096](/stuff/2024/03/24/exploit-CVE-2024-27096.html)

7 minute read

Intro
A few weeks ago, I discovered during an intrusion test two vulnerabilities affecting GLPI 10.0.12, that was the latest public version at this time. The...

## [CVE-2024-27937 - CVE-2024-27930 - Walkthrough](/stuff/2024/02/29/glpi-pwned.html)

8 minute read

I was recently tasked with auditing the application GLPI, a few days after its latest release (10.0.12 at the time of writing). The latter stands for Gestion...

[Back to Top ↑](#page-title)

## 2023

## [From SSRF to authentication bypass](/stuff/2023/12/28/jwt_iss.html)

4 minute read

I won’t insult you by explaining once again what JSON Web Tokens (JWTs) are, and how to attack them. A plethora of awesome articles exists on the Web, descri...

## [Hidden in plain sight - Part 2](/stuff/2023/11/05/hidden-in-plain-sight-2.html)

10 minute read

A few days ago, I published a blog post about PHP webshells, ending with a discussion about filters evasion by getting rid of the pattern $\_. The latter is c...

## [Hidden in plain sight](/stuff/2023/10/31/hidden-in-plain-sight.html)

12 minute read

A few thoughts about PHP webshells …

## [Tiny File Manager - There’s no place like home](/stuff/2023/09/27/tfm_localhost_bypass.html)

1 minute read

I remember this carpet, at the entrance of the Computer Science faculty, with this message There’s no place like 127.0.0.1/8. A joke that would create two ca...

## [I want to talk to your managed code](/mutant/2023/08/06/mixed-code.html)

12 minute read

TL;DR
A few experiments about mixed managed/unmanaged assemblies. To begin with, we start by presenting a C# programme that hides a part of its payload in an...

## [Qakbot JScript dropper analysis](/malware/2023/07/09/qakbot-dropper.html)

11 minute read

It was a sunny and warm summer afternoon, and while normal people would rush to the beach, I decided to devote myself to one of my favourite activities: suff...

## [CVE-2023-3064, CVE-2023-3065, and CVE-2023-3066](/stuff/2023/06/02/cve-2023-3064_65_66.html)

3 minute read

The reader should first take a look at the articles related to CVE-2023-3032 and CVE-2023-3033 that I published a few days ago to get more context.

## [CVE-2023-3033](/stuff/2023/06/01/cve-2023-3033.html)

3 minute read

This walkthrough presents another vulnerability discovered on the Mobatime web application (see CVE-2023-3032, same version 06.7.2022 affected). This vulnera...

## [CVE-2023-3032](/stuff/2023/06/01/cve-2023-3032.html)

less than 1 minute read

Mobatime offers various time-related products, such as check-in solutions. In versions up to 06.7.2022, an arbitrary file upload allowed an authenticated use...

## [CVE-2023-3031](/stuff/2023/06/01/cve-2023-3031.html)

less than 1 minute read

King-Avis is a Prestashop module developed by Webbax. In versions older than 17.3.15, the latter suffers from an authenticated path traversal, leading to loc...

## [FuckFastCGI made simpler](/stuff/2023/02/05/php-ffcgi.html)

3 minute read

Let’s render unto Caesar the things that are Caesar’s, the exploit FuckFastCGI is not mine and is a brilliant one, bypassing open\_basedir and disable\_functio...

## [PHP .user.ini risks](/stuff/2023/02/01/php-ini.html)

7 minute read

I have to admit, PHP is not my favourite, but such powerful language sometimes really amazes me. Two days ago, I found a bypass of the directive open\_basedir...

## [PHP open\_basedir bypass](/stuff/2023/01/30/php-bug.html)

3 minute read

PHP is a really powerful language, and as a wise man once said, with great power comes great responsibilities. There is nothing more frustrating than obtaini...

[Back to Top ↑](#page-title)

## 2020

## [Self modifying C program - Polymorphic](/mutant/2020/05/05/polymorphic1.html)

17 minute read

A few weeks ago, a good friend of mine asked me if it was possible to create such a program, as it could modify itself. After some thoughts, I answered that ...

## [Self modifying C program - Metamorphic (Basic)](/mutant/2020/05/05/metamorphic1.html)

16 minute read

In the previous article, I described how I wrote a simple polymorphic program. “Polymorphic” means that the program (the binary) changes its appearance every...

## [Diving into Viking Horde - Android malware analysis](/malware/2020/05/05/viking-horde.html)

4 minute read

The malware presented in this blog post appeared on Google Play in 2016. I heard about it thanks to this article published on checkpoint.com.
The malicious a...

## [Diving into SLocker - Android malware analysis](/malware/2020/05/05/slocker.html)

7 minute read

Ransomwares are really interesting malwares because of their very specific purpose. Indeed, a ransomware will not necessarily try to be stealth or persistent...

## [Diving into Sberbank Android banker - Android malware analysis](/malware/2020/05/05/sberbank.html)

5 minute read

A few days ago, I found this article about a malware targeting Sberbank,
a big Russian bank. The app disguises itself as a web application, stealing in backg...

## [Diving into ruMMS - Android malware analysis](/malware/2020/05/05/rumms.html)

6 minute read

RuMMS is a malware targetting Russian users, distributed via websites as a file named mms.apk [1]. This article is inspired by this analysis made by FireEye
...

## [Diving into dsencrypt - Android malware analysis](/malware/2020/05/05/dsencrypt.html)

10 minute read

Could a 5-classes Android app be so harmful ? dsencrypt says “yes”…

## [Attacking Android Accessibility Service (AAS) - Part IV](/android/2020/05/05/android4.html)

3 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part4.txt

## [Attacking Android Accessibility Service (AAS) - Part III](/android/2020/05/05/android3.html)

3 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part3.txt

## [Attacking Android Accessibility Service (AAS) - Part II](/android/2020/05/05/android2.html)

5 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges\_Part2.txt

## [Attacking Android Accessibility Service (AAS) - Part I](/android/2020/05/05/android1.html)

5 minute read

~$ cat How\_an\_Android\_app\_could\_escalate\_its\_privileges.txt

## [Practical attacks against mobile browsers using extensions](/thesis/2020/05/01/thesis1.html)

17 minute read

Even if the thesis introduces the extensions internals, and analyses the difference between mobile and desktop browsers in terms of likelihood, efficiency an...

[Back to Top ↑](#page-title)

* [Feed](/feed.xml)

© 2024 Borel Enzo. Powered by [Jekyll](https://jekyllrb.com) & [Minimal Mistakes](https://mademistakes.com/work/minimal-mistakes-jekyll-theme/).


