=== Content from git.kernel.org_18e5503e_20250114_185044.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiasheng Jiang <jiasheng@iscas.ac.cn> | 2022-12-20 10:49:21 +0800 |
| --- | --- | --- |
| committer | Benjamin Tissoires <benjamin.tissoires@redhat.com> | 2022-12-20 09:45:53 +0100 |
| commit | [53ffa6a9f83b2170c60591da1ead8791d5a42e81](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)) | |
| tree | [3b9ea9d3fd8b673d3ec11020d4090ad84e5dc664](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81) | |
| parent | [0ee29814c6be17a924761d3712eb8ad63cfe13ac](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=0ee29814c6be17a924761d3712eb8ad63cfe13ac) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81&id2=0ee29814c6be17a924761d3712eb8ad63cfe13ac)) | |
| download | [linux-53ffa6a9f83b2170c60591da1ead8791d5a42e81.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-53ffa6a9f83b2170c60591da1ead8791d5a42e81.tar.gz) | |

HID: amd\_sfh: Add missing check for dma\_alloc\_coherentAdd check for the return value of the dma\_alloc\_coherent since
it may return NULL pointer if allocation fails.
Fixes: 4b2c53d93a4b ("SFH:Transport Driver to add support of AMD Sensor Fusion Hub (SFH)")
Signed-off-by: Jiasheng Jiang <jiasheng@iscas.ac.cn>
Acked-by: Basavaraj Natikar <Basavaraj.Natikar@amd.com>
Signed-off-by: Benjamin Tissoires <benjamin.tissoires@redhat.com>
Link: [https://lore.kernel.org/r/20221220024921.21992-1-jiasheng@iscas.ac.cn](https://lore.kernel.org/r/20221220024921.21992-1-jiasheng%40iscas.ac.cn)
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)

| -rw-r--r-- | [drivers/hid/amd-sfh-hid/amd\_sfh\_client.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/amd-sfh-hid/amd_sfh_client.c?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/drivers/hid/amd-sfh-hid/amd\_sfh\_client.c b/drivers/hid/amd-sfh-hid/amd\_sfh\_client.cindex 8275bba6361190..ab125f79408f25 100644--- a/[drivers/hid/amd-sfh-hid/amd\_sfh\_client.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/amd-sfh-hid/amd_sfh_client.c?id=0ee29814c6be17a924761d3712eb8ad63cfe13ac)+++ b/[drivers/hid/amd-sfh-hid/amd\_sfh\_client.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/amd-sfh-hid/amd_sfh_client.c?id=53ffa6a9f83b2170c60591da1ead8791d5a42e81)@@ -237,6 +237,10 @@ int amd\_sfh\_hid\_client\_init(struct amd\_mp2\_dev \*privdata) in\_data->sensor\_virt\_addr[i] = dma\_alloc\_coherent(dev, sizeof(int) \* 8, &cl\_data->sensor\_dma\_addr[i], GFP\_KERNEL);+ if (!in\_data->sensor\_virt\_addr[i]) {+ rc = -ENOMEM;+ goto cleanup;+ } cl\_data->sensor\_sts[i] = SENSOR\_DISABLED; cl\_data->sensor\_requested\_cnt[i] = 0; cl\_data->cur\_hid\_dev = i; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:49:21 +0000


