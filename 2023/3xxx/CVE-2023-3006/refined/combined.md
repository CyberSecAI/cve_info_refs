=== Content from git.kernel.org_71ee4d55_20250114_190611.html ===


| [cgit logo](/) | [index](/) : [kernel/git/arm64/linux.git](/pub/scm/linux/kernel/git/arm64/linux.git/) | for-kernelci for-next/cca for-next/core for-next/cpufeature for-next/docs for-next/fixes for-next/misc for-next/mm for-next/perf staging/ilp32-5.1 |
| --- | --- | --- |
| AArch64 Linux kernel port | ARM64 group |

| [about](/pub/scm/linux/kernel/git/arm64/linux.git/about/)[summary](/pub/scm/linux/kernel/git/arm64/linux.git/)[refs](/pub/scm/linux/kernel/git/arm64/linux.git/refs/?id=0e5d5ae837c8)[log](/pub/scm/linux/kernel/git/arm64/linux.git/log/)[tree](/pub/scm/linux/kernel/git/arm64/linux.git/tree/?id=0e5d5ae837c8)[commit](/pub/scm/linux/kernel/git/arm64/linux.git/commit/?id=0e5d5ae837c8)[diff](/pub/scm/linux/kernel/git/arm64/linux.git/diff/?id=0e5d5ae837c8)[stats](/pub/scm/linux/kernel/git/arm64/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | D Scott Phillips <scott@os.amperecomputing.com> | 2022-10-10 19:21:40 -0700 |
| --- | --- | --- |
| committer | Catalin Marinas <catalin.marinas@arm.com> | 2022-10-12 17:36:06 +0100 |
| commit | [0e5d5ae837c8ce04d2ddb874ec5f920118bd9d31](/pub/scm/linux/kernel/git/arm64/linux.git/commit/?id=0e5d5ae837c8ce04d2ddb874ec5f920118bd9d31) ([patch](/pub/scm/linux/kernel/git/arm64/linux.git/patch/?id=0e5d5ae837c8ce04d2ddb874ec5f920118bd9d31)) | |
| tree | [9551dd36a66919bbadd41c4f07deb1c59de5168e](/pub/scm/linux/kernel/git/arm64/linux.git/tree/?id=0e5d5ae837c8) | |
| parent | [a8e5e5146ad08d794c58252bab00b261045ef16d](/pub/scm/linux/kernel/git/arm64/linux.git/commit/?id=a8e5e5146ad08d794c58252bab00b261045ef16d) ([diff](/pub/scm/linux/kernel/git/arm64/linux.git/diff/?id=0e5d5ae837c8&id2=a8e5e5146ad08d794c58252bab00b261045ef16d)) | |
| download | [linux-0e5d5ae837c8.tar.gz](/pub/scm/linux/kernel/git/arm64/linux.git/snapshot/linux-0e5d5ae837c8.tar.gz) | |

arm64: Add AMPERE1 to the Spectre-BHB affected listPer AmpereOne erratum AC03\_CPU\_12, "Branch history may allow control of
speculative execution across software contexts," the AMPERE1 core needs the
bhb clearing loop to mitigate Spectre-BHB, with a loop iteration count of
11.
Signed-off-by: D Scott Phillips <scott@os.amperecomputing.com>
Link: [https://lore.kernel.org/r/20221011022140.432370-1-scott@os.amperecomputing.com](https://lore.kernel.org/r/20221011022140.432370-1-scott%40os.amperecomputing.com)
Reviewed-by: James Morse <james.morse@arm.com>
Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
[Diffstat](/pub/scm/linux/kernel/git/arm64/linux.git/diff/?id=0e5d5ae837c8)

| -rw-r--r-- | [arch/arm64/include/asm/cputype.h](/pub/scm/linux/kernel/git/arm64/linux.git/diff/arch/arm64/include/asm/cputype.h?id=0e5d5ae837c8) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/arm64/kernel/proton-pack.c](/pub/scm/linux/kernel/git/arm64/linux.git/diff/arch/arm64/kernel/proton-pack.c?id=0e5d5ae837c8) | 6 | |  |  |  | | --- | --- | --- | |

2 files changed, 10 insertions, 0 deletions

| diff --git a/arch/arm64/include/asm/cputype.h b/arch/arm64/include/asm/cputype.hindex 8aa0d276a63628..abc418650fec04 100644--- a/[arch/arm64/include/asm/cputype.h](/pub/scm/linux/kernel/git/arm64/linux.git/tree/arch/arm64/include/asm/cputype.h?id=a8e5e5146ad08d794c58252bab00b261045ef16d)+++ b/[arch/arm64/include/asm/cputype.h](/pub/scm/linux/kernel/git/arm64/linux.git/tree/arch/arm64/include/asm/cputype.h?id=0e5d5ae837c8ce04d2ddb874ec5f920118bd9d31)@@ -60,6 +60,7 @@ #define ARM\_CPU\_IMP\_FUJITSU 0x46 #define ARM\_CPU\_IMP\_HISI 0x48 #define ARM\_CPU\_IMP\_APPLE 0x61+#define ARM\_CPU\_IMP\_AMPERE 0xC0  #define ARM\_CPU\_PART\_AEM\_V8 0xD0F #define ARM\_CPU\_PART\_FOUNDATION 0xD00@@ -123,6 +124,8 @@ #define APPLE\_CPU\_PART\_M1\_ICESTORM\_MAX 0x028 #define APPLE\_CPU\_PART\_M1\_FIRESTORM\_MAX 0x029 +#define AMPERE\_CPU\_PART\_AMPERE1 0xAC3+ #define MIDR\_CORTEX\_A53 MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_ARM, ARM\_CPU\_PART\_CORTEX\_A53) #define MIDR\_CORTEX\_A57 MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_ARM, ARM\_CPU\_PART\_CORTEX\_A57) #define MIDR\_CORTEX\_A72 MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_ARM, ARM\_CPU\_PART\_CORTEX\_A72)@@ -172,6 +175,7 @@ #define MIDR\_APPLE\_M1\_FIRESTORM\_PRO MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_APPLE, APPLE\_CPU\_PART\_M1\_FIRESTORM\_PRO) #define MIDR\_APPLE\_M1\_ICESTORM\_MAX MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_APPLE, APPLE\_CPU\_PART\_M1\_ICESTORM\_MAX) #define MIDR\_APPLE\_M1\_FIRESTORM\_MAX MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_APPLE, APPLE\_CPU\_PART\_M1\_FIRESTORM\_MAX)+#define MIDR\_AMPERE1 MIDR\_CPU\_MODEL(ARM\_CPU\_IMP\_AMPERE, AMPERE\_CPU\_PART\_AMPERE1)  /\* Fujitsu Erratum 010001 affects A64FX 1.0 and 1.1, (v0r0 and v1r0) \*/ #define MIDR\_FUJITSU\_ERRATUM\_010001 MIDR\_FUJITSU\_A64FXdiff --git a/arch/arm64/kernel/proton-pack.c b/arch/arm64/kernel/proton-pack.cindex a8ea1637b13798..bfce41c2a53b3a 100644--- a/[arch/arm64/kernel/proton-pack.c](/pub/scm/linux/kernel/git/arm64/linux.git/tree/arch/arm64/kernel/proton-pack.c?id=a8e5e5146ad08d794c58252bab00b261045ef16d)+++ b/[arch/arm64/kernel/proton-pack.c](/pub/scm/linux/kernel/git/arm64/linux.git/tree/arch/arm64/kernel/proton-pack.c?id=0e5d5ae837c8ce04d2ddb874ec5f920118bd9d31)@@ -868,6 +868,10 @@ u8 spectre\_bhb\_loop\_affected(int scope) MIDR\_ALL\_VERSIONS(MIDR\_NEOVERSE\_N1), {}, };+ static const struct midr\_range spectre\_bhb\_k11\_list[] = {+ MIDR\_ALL\_VERSIONS(MIDR\_AMPERE1),+ {},+ }; static const struct midr\_range spectre\_bhb\_k8\_list[] = { MIDR\_ALL\_VERSIONS(MIDR\_CORTEX\_A72), MIDR\_ALL\_VERSIONS(MIDR\_CORTEX\_A57),@@ -878,6 +882,8 @@ u8 spectre\_bhb\_loop\_affected(int scope) k = 32; else if (is\_midr\_in\_range\_list(read\_cpuid\_id(), spectre\_bhb\_k24\_list)) k = 24;+ else if (is\_midr\_in\_range\_list(read\_cpuid\_id(), spectre\_bhb\_k11\_list))+ k = 11; else if (is\_midr\_in\_range\_list(read\_cpuid\_id(), spectre\_bhb\_k8\_list)) k = 8; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-14 18:58:16 +0000


