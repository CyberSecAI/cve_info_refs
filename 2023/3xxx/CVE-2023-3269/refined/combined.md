=== Content from git.kernel.org_7300c51d_20250115_114218.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Linus Torvalds <torvalds@linux-foundation.org> | 2023-06-28 20:35:21 -0700 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2023-06-28 20:35:21 -0700 |
| commit | [9471f1f2f50282b9e8f59198ec6bb738b4ccc009](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)) | |
| tree | [3eb773fe01321d315cf96832dbf8d8d71d929a25](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | |
| parent | [3a8a670eeeaa40d87bd38a587438952741980c18](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=3a8a670eeeaa40d87bd38a587438952741980c18) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009&id2=3a8a670eeeaa40d87bd38a587438952741980c18)) | |
| parent | [a425ac5365f6cb3cc47bf83e6bff0213c10445f7](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a425ac5365f6cb3cc47bf83e6bff0213c10445f7) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009&id2=a425ac5365f6cb3cc47bf83e6bff0213c10445f7)) | |
| download | [linux-9471f1f2f50282b9e8f59198ec6bb738b4ccc009.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-9471f1f2f50282b9e8f59198ec6bb738b4ccc009.tar.gz) | |

Merge branch 'expand-stack'This modifies our user mode stack expansion code to always take the
mmap\_lock for writing before modifying the VM layout.
It's actually something we always technically should have done, but
because we didn't strictly need it, we were being lazy ("opportunistic"
sounds so much better, doesn't it?) about things, and had this hack in
place where we would extend the stack vma in-place without doing the
proper locking.
And it worked fine. We just needed to change vm\_start (or, in the case
of grow-up stacks, vm\_end) and together with some special ad-hoc locking
using the anon\_vma lock and the mm->page\_table\_lock, it all was fairly
straightforward.
That is, it was all fine until Ruihan Li pointed out that now that the
vma layout uses the maple tree code, we \*really\* don't just change
vm\_start and vm\_end any more, and the locking really is broken. Oops.
It's not actually all \_that\_ horrible to fix this once and for all, and
do proper locking, but it's a bit painful. We have basically three
different cases of stack expansion, and they all work just a bit
differently:
- the common and obvious case is the page fault handling. It's actually
fairly simple and straightforward, except for the fact that we have
something like 24 different versions of it, and you end up in a maze
of twisty little passages, all alike.
- the simplest case is the execve() code that creates a new stack.
There are no real locking concerns because it's all in a private new
VM that hasn't been exposed to anybody, but lockdep still can end up
unhappy if you get it wrong.
- and finally, we have GUP and page pinning, which shouldn't really be
expanding the stack in the first place, but in addition to execve()
we also use it for ptrace(). And debuggers do want to possibly access
memory under the stack pointer and thus need to be able to expand the
stack as a special case.
None of these cases are exactly complicated, but the page fault case in
particular is just repeated slightly differently many many times. And
ia64 in particular has a fairly complicated situation where you can have
both a regular grow-down stack \_and\_ a special grow-up stack for the
register backing store.
So to make this slightly more manageable, the bulk of this series is to
first create a helper function for the most common page fault case, and
convert all the straightforward architectures to it.
Thus the new 'lock\_mm\_and\_find\_vma()' helper function, which ends up
being used by x86, arm, powerpc, mips, riscv, alpha, arc, csky, hexagon,
loongarch, nios2, sh, sparc32, and xtensa. So we not only convert more
than half the architectures, we now have more shared code and avoid some
of those twisty little passages.
And largely due to this common helper function, the full diffstat of
this series ends up deleting more lines than it adds.
That still leaves eight architectures (ia64, m68k, microblaze, openrisc,
parisc, s390, sparc64 and um) that end up doing 'expand\_stack()'
manually because they are doing something slightly different from the
normal pattern. Along with the couple of special cases in execve() and
GUP.
So there's a couple of patches that first create 'locked' helper
versions of the stack expansion functions, so that there's a obvious
path forward in the conversion. The execve() case is then actually
pretty simple, and is a nice cleanup from our old "grow-up stackls are
special, because at execve time even they grow down".
The #ifdef CONFIG\_STACK\_GROWSUP in that code just goes away, because
it's just more straightforward to write out the stack expansion there
manually, instead od having get\_user\_pages\_remote() do it for us in some
situations but not others and have to worry about locking rules for GUP.
And the final step is then to just convert the remaining odd cases to a
new world order where 'expand\_stack()' is called with the mmap\_lock held
for reading, but where it might drop it and upgrade it to a write, only
to return with it held for reading (in the success case) or with it
completely dropped (in the failure case).
In the process, we remove all the stack expansion from GUP (where
dropping the lock wouldn't be ok without special rules anyway), and add
it in manually to \_\_access\_remote\_vm() for ptrace().
Thanks to Adrian Glaubitz and Frank Scheiner who tested the ia64 cases.
Everything else here felt pretty straightforward, but the ia64 rules for
stack expansion are really quite odd and very different from everything
else. Also thanks to Vegard Nossum who caught me getting one of those
odd conditions entirely the wrong way around.
Anyway, I think I want to actually move all the stack expansion code to
a whole new file of its own, rather than have it split up between
mm/mmap.c and mm/memory.c, but since this will have to be backported to
the initial maple tree vma introduction anyway, I tried to keep the
patches \_fairly\_ minimal.
Also, while I don't think it's valid to expand the stack from GUP, the
final patch in here is a "warn if some crazy GUP user wants to try to
expand the stack" patch. That one will be reverted before the final
release, but it's left to catch any odd cases during the merge window
and release candidates.
Reported-by: Ruihan Li <lrh2000@pku.edu.cn>
\* branch 'expand-stack':
gup: add warning if some caller would seem to want stack expansion
mm: always expand the stack with the mmap write lock held
execve: expand new process stack manually ahead of time
mm: make find\_extend\_vma() fail if write lock not held
powerpc/mm: convert coprocessor fault to lock\_mm\_and\_find\_vma()
mm/fault: convert remaining simple cases to lock\_mm\_and\_find\_vma()
arm/mm: Convert to using lock\_mm\_and\_find\_vma()
riscv/mm: Convert to using lock\_mm\_and\_find\_vma()
mips/mm: Convert to using lock\_mm\_and\_find\_vma()
powerpc/mm: Convert to using lock\_mm\_and\_find\_vma()
arm64/mm: Convert to using lock\_mm\_and\_find\_vma()
mm: make the page fault mmap locking killable
mm: introduce new 'lock\_mm\_and\_find\_vma()' page fault helper
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)

| -rw-r--r-- | [arch/alpha/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/alpha/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/alpha/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/alpha/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 13 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 63 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm64/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm64/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/arm64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/arm64/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 47 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/csky/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/csky/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/csky/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/csky/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 22 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/hexagon/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/hexagon/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/hexagon/mm/vm\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/hexagon/mm/vm_fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 18 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/ia64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/ia64/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 36 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/loongarch/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/loongarch/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/loongarch/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/loongarch/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 16 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/m68k/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/m68k/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 9 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/microblaze/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/microblaze/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/mips/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/mips/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/mips/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/mips/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 12 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/nios2/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/nios2/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/nios2/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/nios2/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 17 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/openrisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/openrisc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/parisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/parisc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 23 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/powerpc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/mm/copro\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/powerpc/mm/copro_fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 14 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/powerpc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/powerpc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 39 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/riscv/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/riscv/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/riscv/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/riscv/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 31 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/s390/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/s390/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/sh/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/sh/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/sh/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/sh/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 17 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/sparc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/sparc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/sparc/mm/fault\_32.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/sparc/mm/fault_32.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 32 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/sparc/mm/fault\_64.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/sparc/mm/fault_64.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 8 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/um/kernel/trap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/um/kernel/trap.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/x86/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/x86/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/x86/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 52 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/xtensa/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/xtensa/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [arch/xtensa/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/arch/xtensa/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 14 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/iommu/amd/iommu\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/iommu/amd/iommu_v2.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/iommu/iommu-sva.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/iommu/iommu-sva.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [fs/binfmt\_elf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/binfmt_elf.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 6 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [fs/exec.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/fs/exec.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 38 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [include/linux/mm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/include/linux/mm.h?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 16 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 4 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mm/gup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/gup.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 14 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mm/memory.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/memory.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 150 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mm/mmap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/mmap.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 121 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [mm/nommu.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/nommu.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009) | 17 | |  |  |  | | --- | --- | --- | |

49 files changed, 439 insertions, 468 deletions

| diff --git a/arch/alpha/Kconfig b/arch/alpha/Kconfigindex a5c2b1aa46b02e..d6968d090d49a7 100644--- a/[arch/alpha/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/alpha/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/alpha/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/alpha/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -30,6 +30,7 @@ config ALPHA select HAS\_IOPORT select HAVE\_ARCH\_AUDITSYSCALL select HAVE\_MOD\_ARCH\_SPECIFIC+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select ODD\_RT\_SIGACTION select OLD\_SIGSUSPENDdiff --git a/arch/alpha/mm/fault.c b/arch/alpha/mm/fault.cindex 7b01ae4f3bc6c7..8c9850437e6744 100644--- a/[arch/alpha/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/alpha/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/alpha/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/alpha/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -119,20 +119,12 @@ do\_page\_fault(unsigned long address, unsigned long mmcsr, flags |= FAULT\_FLAG\_USER; perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;+ goto bad\_area\_nosemaphore;  /\* Ok, we have a good vm\_area for this memory access, so we can handle it. \*/- good\_area: si\_code = SEGV\_ACCERR; if (cause < 0) { if (!(vma->vm\_flags & VM\_EXEC))@@ -192,6 +184,7 @@ retry: bad\_area: mmap\_read\_unlock(mm); + bad\_area\_nosemaphore: if (user\_mode(regs)) goto do\_sigsegv; diff --git a/arch/arc/Kconfig b/arch/arc/Kconfigindex ab6d701365bb00..96cf8720bb9391 100644--- a/[arch/arc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arc/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -41,6 +41,7 @@ config ARC select HAVE\_PERF\_EVENTS select HAVE\_SYSCALL\_TRACEPOINTS select IRQ\_DOMAIN+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select OF select OF\_EARLY\_FLATTREEdiff --git a/arch/arc/mm/fault.c b/arch/arc/mm/fault.cindex 5ca59a482632a8..f59e722d147f91 100644--- a/[arch/arc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arc/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -113,15 +113,9 @@ void do\_page\_fault(unsigned long address, struct pt\_regs \*regs)  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); retry:- mmap\_read\_lock(mm);-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (unlikely(address < vma->vm\_start)) {- if (!(vma->vm\_flags & VM\_GROWSDOWN) || expand\_stack(vma, address))- goto bad\_area;- }+ goto bad\_area\_nosemaphore;  /\* \* vm\_area is good, now check permissions for this memory access@@ -161,6 +155,7 @@ retry: bad\_area: mmap\_read\_unlock(mm); +bad\_area\_nosemaphore: /\* \* Major/minor page fault accounting \* (in case of retry we only land here once)diff --git a/arch/arm/Kconfig b/arch/arm/Kconfigindex cef741bb03b378..d60b73d93e03ae 100644--- a/[arch/arm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -127,6 +127,7 @@ config ARM select HAVE\_VIRT\_CPU\_ACCOUNTING\_GEN select HOTPLUG\_CORE\_SYNC\_DEAD if HOTPLUG\_CPU select IRQ\_FORCED\_THREADING+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_REL select NEED\_DMA\_MAP\_STATE select OF\_EARLY\_FLATTREE if OFdiff --git a/arch/arm/mm/fault.c b/arch/arm/mm/fault.cindex 83598649a094f0..fef62e4a9edde6 100644--- a/[arch/arm/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arm/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -235,37 +235,11 @@ static inline bool is\_permission\_fault(unsigned int fsr) return false; } -static vm\_fault\_t \_\_kprobes-\_\_do\_page\_fault(struct mm\_struct \*mm, unsigned long addr, unsigned int flags,- unsigned long vma\_flags, struct pt\_regs \*regs)-{- struct vm\_area\_struct \*vma = find\_vma(mm, addr);- if (unlikely(!vma))- return VM\_FAULT\_BADMAP;-- if (unlikely(vma->vm\_start > addr)) {- if (!(vma->vm\_flags & VM\_GROWSDOWN))- return VM\_FAULT\_BADMAP;- if (addr < FIRST\_USER\_ADDRESS)- return VM\_FAULT\_BADMAP;- if (expand\_stack(vma, addr))- return VM\_FAULT\_BADMAP;- }-- /\*- \* ok, we have a good vm\_area for this memory access, check the- \* permissions on the VMA allow for the fault which occurred.- \*/- if (!(vma->vm\_flags & vma\_flags))- return VM\_FAULT\_BADACCESS;-- return handle\_mm\_fault(vma, addr & PAGE\_MASK, flags, regs);-}- static int \_\_kprobes do\_page\_fault(unsigned long addr, unsigned int fsr, struct pt\_regs \*regs) { struct mm\_struct \*mm = current->mm;+ struct vm\_area\_struct \*vma; int sig, code; vm\_fault\_t fault; unsigned int flags = FAULT\_FLAG\_DEFAULT;@@ -304,31 +278,21 @@ do\_page\_fault(unsigned long addr, unsigned int fsr, struct pt\_regs \*regs)  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, addr); - /\*- \* As per x86, we may deadlock here. However, since the kernel only- \* validly references user space from well defined areas of the code,- \* we can bug out early if this is from code which shouldn't.- \*/- if (!mmap\_read\_trylock(mm)) {- if (!user\_mode(regs) && !search\_exception\_tables(regs->ARM\_pc))- goto no\_context; retry:- mmap\_read\_lock(mm);- } else {- /\*- \* The above down\_read\_trylock() might have succeeded in- \* which case, we'll have missed the might\_sleep() from- \* down\_read()- \*/- might\_sleep();-#ifdef CONFIG\_DEBUG\_VM- if (!user\_mode(regs) &&- !search\_exception\_tables(regs->ARM\_pc))- goto no\_context;-#endif+ vma = lock\_mm\_and\_find\_vma(mm, addr, regs);+ if (unlikely(!vma)) {+ fault = VM\_FAULT\_BADMAP;+ goto bad\_area; } - fault = \_\_do\_page\_fault(mm, addr, flags, vm\_flags, regs);+ /\*+ \* ok, we have a good vm\_area for this memory access, check the+ \* permissions on the VMA allow for the fault which occurred.+ \*/+ if (!(vma->vm\_flags & vm\_flags))+ fault = VM\_FAULT\_BADACCESS;+ else+ fault = handle\_mm\_fault(vma, addr & PAGE\_MASK, flags, regs);  /\* If we need to retry but a fatal signal is pending, handle the \* signal first. We do not need to release the mmap\_lock because@@ -359,6 +323,7 @@ retry: if (likely(!(fault & (VM\_FAULT\_ERROR | VM\_FAULT\_BADMAP | VM\_FAULT\_BADACCESS)))) return 0; +bad\_area: /\* \* If we are in kernel mode at this point, we \* have no context to handle this fault with.diff --git a/arch/arm64/Kconfig b/arch/arm64/Kconfigindex 3ae5c03ded0e35..595028bd9160b0 100644--- a/[arch/arm64/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arm64/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -231,6 +231,7 @@ config ARM64 select IRQ\_DOMAIN select IRQ\_FORCED\_THREADING select KASAN\_VMALLOC if KASAN+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select NEED\_DMA\_MAP\_STATE select NEED\_SG\_DMA\_LENGTHdiff --git a/arch/arm64/mm/fault.c b/arch/arm64/mm/fault.cindex c60100791bccca..935f0a8911f903 100644--- a/[arch/arm64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/arm64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/arm64/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -497,27 +497,14 @@ static void do\_bad\_area(unsigned long far, unsigned long esr, #define VM\_FAULT\_BADMAP ((\_\_force vm\_fault\_t)0x010000) #define VM\_FAULT\_BADACCESS ((\_\_force vm\_fault\_t)0x020000) -static vm\_fault\_t \_\_do\_page\_fault(struct mm\_struct \*mm, unsigned long addr,+static vm\_fault\_t \_\_do\_page\_fault(struct mm\_struct \*mm,+ struct vm\_area\_struct \*vma, unsigned long addr, unsigned int mm\_flags, unsigned long vm\_flags, struct pt\_regs \*regs) {- struct vm\_area\_struct \*vma = find\_vma(mm, addr);-- if (unlikely(!vma))- return VM\_FAULT\_BADMAP;- /\* \* Ok, we have a good vm\_area for this memory access, so we can handle \* it.- \*/- if (unlikely(vma->vm\_start > addr)) {- if (!(vma->vm\_flags & VM\_GROWSDOWN))- return VM\_FAULT\_BADMAP;- if (expand\_stack(vma, addr))- return VM\_FAULT\_BADMAP;- }-- /\* \* Check that the permissions on the VMA allow for the fault which \* occurred. \*/@@ -631,31 +618,15 @@ static int \_\_kprobes do\_page\_fault(unsigned long far, unsigned long esr, } lock\_mmap: #endif /\* CONFIG\_PER\_VMA\_LOCK \*/- /\*- \* As per x86, we may deadlock here. However, since the kernel only- \* validly references user space from well defined areas of the code,- \* we can bug out early if this is from code which shouldn't.- \*/- if (!mmap\_read\_trylock(mm)) {- if (!user\_mode(regs) && !search\_exception\_tables(regs->pc))- goto no\_context;+ retry:- mmap\_read\_lock(mm);- } else {- /\*- \* The above mmap\_read\_trylock() might have succeeded in which- \* case, we'll have missed the might\_sleep() from down\_read().- \*/- might\_sleep();-#ifdef CONFIG\_DEBUG\_VM- if (!user\_mode(regs) && !search\_exception\_tables(regs->pc)) {- mmap\_read\_unlock(mm);- goto no\_context;- }-#endif+ vma = lock\_mm\_and\_find\_vma(mm, addr, regs);+ if (unlikely(!vma)) {+ fault = VM\_FAULT\_BADMAP;+ goto done; } - fault = \_\_do\_page\_fault(mm, addr, mm\_flags, vm\_flags, regs);+ fault = \_\_do\_page\_fault(mm, vma, addr, mm\_flags, vm\_flags, regs);  /\* Quick path to respond to signals \*/ if (fault\_signal\_pending(fault, regs)) {@@ -674,9 +645,7 @@ retry: } mmap\_read\_unlock(mm); -#ifdef CONFIG\_PER\_VMA\_LOCK done:-#endif /\* \* Handle the "normal" (no error) case first. \*/diff --git a/arch/csky/Kconfig b/arch/csky/Kconfigindex 95f1e9bfd1c7d3..cf2a6fd7dff871 100644--- a/[arch/csky/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/csky/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/csky/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/csky/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -97,6 +97,7 @@ config CSKY select HAVE\_STACKPROTECTOR select HAVE\_SYSCALL\_TRACEPOINTS select HOTPLUG\_CORE\_SYNC\_DEAD if HOTPLUG\_CPU+ select LOCK\_MM\_AND\_FIND\_VMA select MAY\_HAVE\_SPARSE\_IRQ select MODULES\_USE\_ELF\_RELA if MODULES select OFdiff --git a/arch/csky/mm/fault.c b/arch/csky/mm/fault.cindex e15f736cca4b4a..ae9781b7d92ea5 100644--- a/[arch/csky/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/csky/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/csky/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/csky/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -97,13 +97,12 @@ static inline void mm\_fault\_error(struct pt\_regs \*regs, unsigned long addr, vm\_f BUG(); } -static inline void bad\_area(struct pt\_regs \*regs, struct mm\_struct \*mm, int code, unsigned long addr)+static inline void bad\_area\_nosemaphore(struct pt\_regs \*regs, struct mm\_struct \*mm, int code, unsigned long addr) { /\* \* Something tried to access memory that isn't in our memory map. \* Fix it, but check if it's kernel or user first. \*/- mmap\_read\_unlock(mm); /\* User mode accesses just cause a SIGSEGV \*/ if (user\_mode(regs)) { do\_trap(regs, SIGSEGV, code, addr);@@ -238,20 +237,9 @@ asmlinkage void do\_page\_fault(struct pt\_regs \*regs) if (is\_write(regs)) flags |= FAULT\_FLAG\_WRITE; retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, addr);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (unlikely(!vma)) {- bad\_area(regs, mm, code, addr);- return;- }- if (likely(vma->vm\_start <= addr))- goto good\_area;- if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN))) {- bad\_area(regs, mm, code, addr);- return;- }- if (unlikely(expand\_stack(vma, addr))) {- bad\_area(regs, mm, code, addr);+ bad\_area\_nosemaphore(regs, mm, code, addr); return; } @@ -259,11 +247,11 @@ retry: \* Ok, we have a good vm\_area for this memory access, so \* we can handle it. \*/-good\_area: code = SEGV\_ACCERR;  if (unlikely(access\_error(regs, vma))) {- bad\_area(regs, mm, code, addr);+ mmap\_read\_unlock(mm);+ bad\_area\_nosemaphore(regs, mm, code, addr); return; } diff --git a/arch/hexagon/Kconfig b/arch/hexagon/Kconfigindex 54eadf26517868..6726f4941015f3 100644--- a/[arch/hexagon/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/hexagon/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/hexagon/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/hexagon/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -28,6 +28,7 @@ config HEXAGON select GENERIC\_SMP\_IDLE\_THREAD select STACKTRACE\_SUPPORT select GENERIC\_CLOCKEVENTS\_BROADCAST+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select GENERIC\_CPU\_DEVICES select ARCH\_WANT\_LD\_ORPHAN\_WARNdiff --git a/arch/hexagon/mm/vm\_fault.c b/arch/hexagon/mm/vm\_fault.cindex 4b578d02fd01a9..7295ea3f8cc8d3 100644--- a/[arch/hexagon/mm/vm\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/hexagon/mm/vm_fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/hexagon/mm/vm\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/hexagon/mm/vm_fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -57,21 +57,10 @@ void do\_page\_fault(unsigned long address, long cause, struct pt\_regs \*regs)  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, address);- if (!vma)- goto bad\_area;+ vma = lock\_mm\_and\_find\_vma(mm, address, regs);+ if (unlikely(!vma))+ goto bad\_area\_nosemaphore; - if (vma->vm\_start <= address)- goto good\_area;-- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;-- if (expand\_stack(vma, address))- goto bad\_area;--good\_area: /\* Address space is OK. Now check access rights. \*/ si\_code = SEGV\_ACCERR; @@ -143,6 +132,7 @@ good\_area: bad\_area: mmap\_read\_unlock(mm); +bad\_area\_nosemaphore: if (user\_mode(regs)) { force\_sig\_fault(SIGSEGV, si\_code, (void \_\_user \*)address); return;diff --git a/arch/ia64/mm/fault.c b/arch/ia64/mm/fault.cindex 85c4d9ac8686d8..5458b52b400996 100644--- a/[arch/ia64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/ia64/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/ia64/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -110,10 +110,12 @@ retry: \* register backing store that needs to expand upwards, in \* this case vma will be null, but prev\_vma will ne non-null \*/- if (( !vma && prev\_vma ) || (address < vma->vm\_start) )- goto check\_expansion;+ if (( !vma && prev\_vma ) || (address < vma->vm\_start) ) {+ vma = expand\_stack(mm, address);+ if (!vma)+ goto bad\_area\_nosemaphore;+ } - good\_area: code = SEGV\_ACCERR;  /\* OK, we've got a good vm\_area for this memory area. Check the access permissions: \*/@@ -177,35 +179,9 @@ retry: mmap\_read\_unlock(mm); return; - check\_expansion:- if (!(prev\_vma && (prev\_vma->vm\_flags & VM\_GROWSUP) && (address == prev\_vma->vm\_end))) {- if (!vma)- goto bad\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (REGION\_NUMBER(address) != REGION\_NUMBER(vma->vm\_start)- || REGION\_OFFSET(address) >= RGN\_MAP\_LIMIT)- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;- } else {- vma = prev\_vma;- if (REGION\_NUMBER(address) != REGION\_NUMBER(vma->vm\_start)- || REGION\_OFFSET(address) >= RGN\_MAP\_LIMIT)- goto bad\_area;- /\*- \* Since the register backing store is accessed sequentially,- \* we disallow growing it by more than a page at a time.- \*/- if (address > vma->vm\_end + PAGE\_SIZE - sizeof(long))- goto bad\_area;- if (expand\_upwards(vma, address))- goto bad\_area;- }- goto good\_area;- bad\_area: mmap\_read\_unlock(mm);+ bad\_area\_nosemaphore: if ((isr & IA64\_ISR\_SP) || ((isr & IA64\_ISR\_NA) && (isr & IA64\_ISR\_CODE\_MASK) == IA64\_ISR\_CODE\_LFETCH)) {diff --git a/arch/loongarch/Kconfig b/arch/loongarch/Kconfigindex cbab4f9ca15c1f..32b9da4622ce4e 100644--- a/[arch/loongarch/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/loongarch/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/loongarch/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/loongarch/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -131,6 +131,7 @@ config LOONGARCH select HAVE\_VIRT\_CPU\_ACCOUNTING\_GEN if !SMP select IRQ\_FORCED\_THREADING select IRQ\_LOONGARCH\_CPU+ select LOCK\_MM\_AND\_FIND\_VMA select MMU\_GATHER\_MERGE\_VMAS if MMU select MODULES\_USE\_ELF\_RELA if MODULES select NEED\_PER\_CPU\_EMBED\_FIRST\_CHUNKdiff --git a/arch/loongarch/mm/fault.c b/arch/loongarch/mm/fault.cindex 449087bd589d33..da5b6d518cdb1d 100644--- a/[arch/loongarch/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/loongarch/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/loongarch/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/loongarch/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -169,22 +169,18 @@ static void \_\_kprobes \_\_do\_page\_fault(struct pt\_regs \*regs,  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, address);- if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (!expand\_stack(vma, address))- goto good\_area;+ vma = lock\_mm\_and\_find\_vma(mm, address, regs);+ if (unlikely(!vma))+ goto bad\_area\_nosemaphore;+ goto good\_area;+ /\* \* Something tried to access memory that isn't in our memory map.. \* Fix it, but check if it's kernel or user first.. \*/ bad\_area: mmap\_read\_unlock(mm);+bad\_area\_nosemaphore: do\_sigsegv(regs, write, address, si\_code); return; diff --git a/arch/m68k/mm/fault.c b/arch/m68k/mm/fault.cindex 228128e45c673b..c290c5c0cfb93a 100644--- a/[arch/m68k/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/m68k/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/m68k/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/m68k/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -105,8 +105,9 @@ retry: if (address + 256 < rdusp()) goto map\_err; }- if (expand\_stack(vma, address))- goto map\_err;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto map\_err\_nosemaphore;  /\* \* Ok, we have a good vm\_area for this memory access, so@@ -196,10 +197,12 @@ bus\_err: goto send\_sig;  map\_err:+ mmap\_read\_unlock(mm);+map\_err\_nosemaphore: current->thread.signo = SIGSEGV; current->thread.code = SEGV\_MAPERR; current->thread.faddr = address;- goto send\_sig;+ return send\_fault\_sig(regs);  acc\_err: current->thread.signo = SIGSEGV;diff --git a/arch/microblaze/mm/fault.c b/arch/microblaze/mm/fault.cindex 687714db6f4d0c..d3c3c33b73a6ed 100644--- a/[arch/microblaze/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/microblaze/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/microblaze/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/microblaze/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -192,8 +192,9 @@ retry: && (kernel\_mode(regs) || !store\_updates\_sp(regs))) goto bad\_area; }- if (expand\_stack(vma, address))- goto bad\_area;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto bad\_area\_nosemaphore;  good\_area: code = SEGV\_ACCERR;diff --git a/arch/mips/Kconfig b/arch/mips/Kconfigindex ada18f3be2298f..d49d5fc4002113 100644--- a/[arch/mips/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/mips/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/mips/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/mips/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -92,6 +92,7 @@ config MIPS select HAVE\_VIRT\_CPU\_ACCOUNTING\_GEN if 64BIT || !SMP select IRQ\_FORCED\_THREADING select ISA if EISA+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_REL if MODULES select MODULES\_USE\_ELF\_RELA if MODULES && 64BIT select PERF\_USE\_VMALLOCdiff --git a/arch/mips/mm/fault.c b/arch/mips/mm/fault.cindex a27045f5a556df..d7878208bd3fa9 100644--- a/[arch/mips/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/mips/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/mips/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/mips/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -99,21 +99,13 @@ static void \_\_do\_page\_fault(struct pt\_regs \*regs, unsigned long write,  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;+ goto bad\_area\_nosemaphore; /\* \* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/-good\_area: si\_code = SEGV\_ACCERR;  if (write) {diff --git a/arch/nios2/Kconfig b/arch/nios2/Kconfigindex e5936417d3cd3c..d54464021a618e 100644--- a/[arch/nios2/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/nios2/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/nios2/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/nios2/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -16,6 +16,7 @@ config NIOS2 select HAVE\_ARCH\_TRACEHOOK select HAVE\_ARCH\_KGDB select IRQ\_DOMAIN+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select OF select OF\_EARLY\_FLATTREEdiff --git a/arch/nios2/mm/fault.c b/arch/nios2/mm/fault.cindex ca64eccea5511d..e3fa9c15181df2 100644--- a/[arch/nios2/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/nios2/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/nios2/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/nios2/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -86,27 +86,14 @@ asmlinkage void do\_page\_fault(struct pt\_regs \*regs, unsigned long cause,  perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address); - if (!mmap\_read\_trylock(mm)) {- if (!user\_mode(regs) && !search\_exception\_tables(regs->ea))- goto bad\_area\_nosemaphore; retry:- mmap\_read\_lock(mm);- }-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;+ goto bad\_area\_nosemaphore; /\* \* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/-good\_area: code = SEGV\_ACCERR;  switch (cause) {diff --git a/arch/openrisc/mm/fault.c b/arch/openrisc/mm/fault.cindex 6734fee3134f4f..a9dcd4381d1a11 100644--- a/[arch/openrisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/openrisc/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/openrisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/openrisc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -127,8 +127,9 @@ retry: if (address + PAGE\_SIZE < regs->sp) goto bad\_area; }- if (expand\_stack(vma, address))- goto bad\_area;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto bad\_area\_nosemaphore;  /\* \* Ok, we have a good vm\_area for this memory access, sodiff --git a/arch/parisc/mm/fault.c b/arch/parisc/mm/fault.cindex 6941fdbf251738..6e894afa424991 100644--- a/[arch/parisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/parisc/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/parisc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/parisc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -288,15 +288,19 @@ void do\_page\_fault(struct pt\_regs \*regs, unsigned long code, retry: mmap\_read\_lock(mm); vma = find\_vma\_prev(mm, address, &prev\_vma);- if (!vma || address < vma->vm\_start)- goto check\_expansion;+ if (!vma || address < vma->vm\_start) {+ if (!prev || !(prev->vm\_flags & VM\_GROWSUP))+ goto bad\_area;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto bad\_area\_nosemaphore;+ }+ /\* \* Ok, we have a good vm\_area for this memory access. We still need to \* check the access permissions. \*/ -good\_area:- if ((vma->vm\_flags & acc\_type) != acc\_type) goto bad\_area; @@ -347,17 +351,13 @@ good\_area: mmap\_read\_unlock(mm); return; -check\_expansion:- vma = prev\_vma;- if (vma && (expand\_stack(vma, address) == 0))- goto good\_area;- /\* \* Something tried to access memory that isn't in our memory map.. \*/ bad\_area: mmap\_read\_unlock(mm); +bad\_area\_nosemaphore: if (user\_mode(regs)) { int signo, si\_code; @@ -449,7 +449,7 @@ handle\_nadtlb\_fault(struct pt\_regs \*regs) { unsigned long insn = regs->iir; int breg, treg, xreg, val = 0;- struct vm\_area\_struct \*vma, \*prev\_vma;+ struct vm\_area\_struct \*vma; struct task\_struct \*tsk; struct mm\_struct \*mm; unsigned long address;@@ -485,7 +485,7 @@ handle\_nadtlb\_fault(struct pt\_regs \*regs) /\* Search for VMA \*/ address = regs->ior; mmap\_read\_lock(mm);- vma = find\_vma\_prev(mm, address, &prev\_vma);+ vma = vma\_lookup(mm, address); mmap\_read\_unlock(mm);  /\*@@ -494,7 +494,6 @@ handle\_nadtlb\_fault(struct pt\_regs \*regs) \*/ acc\_type = (insn & 0x40) ? VM\_WRITE : VM\_READ; if (vma- && address >= vma->vm\_start && (vma->vm\_flags & acc\_type) == acc\_type) val = 1; }diff --git a/arch/powerpc/Kconfig b/arch/powerpc/Kconfigindex 8eb6c5e9e4f8b0..395044b705a19f 100644--- a/[arch/powerpc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/powerpc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -277,6 +277,7 @@ config PPC select IRQ\_DOMAIN select IRQ\_FORCED\_THREADING select KASAN\_VMALLOC if KASAN && MODULES+ select LOCK\_MM\_AND\_FIND\_VMA select MMU\_GATHER\_PAGE\_SIZE select MMU\_GATHER\_RCU\_TABLE\_FREE select MMU\_GATHER\_MERGE\_VMASdiff --git a/arch/powerpc/mm/copro\_fault.c b/arch/powerpc/mm/copro\_fault.cindex 7c507fb48182bd..f49fd873df8da2 100644--- a/[arch/powerpc/mm/copro\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/mm/copro_fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/powerpc/mm/copro\_fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/mm/copro_fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -33,19 +33,11 @@ int copro\_handle\_mm\_fault(struct mm\_struct \*mm, unsigned long ea, if (mm->pgd == NULL) return -EFAULT; - mmap\_read\_lock(mm);- ret = -EFAULT;- vma = find\_vma(mm, ea);+ vma = lock\_mm\_and\_find\_vma(mm, ea, NULL); if (!vma)- goto out\_unlock;-- if (ea < vma->vm\_start) {- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto out\_unlock;- if (expand\_stack(vma, ea))- goto out\_unlock;- }+ return -EFAULT; + ret = -EFAULT; is\_write = dsisr & DSISR\_ISSTORE; if (is\_write) { if (!(vma->vm\_flags & VM\_WRITE))diff --git a/arch/powerpc/mm/fault.c b/arch/powerpc/mm/fault.cindex 531177a4ee0881..5bfdf6ecfa9650 100644--- a/[arch/powerpc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/powerpc/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/powerpc/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -84,11 +84,6 @@ static int \_\_bad\_area(struct pt\_regs \*regs, unsigned long address, int si\_code) return \_\_bad\_area\_nosemaphore(regs, address, si\_code); } -static noinline int bad\_area(struct pt\_regs \*regs, unsigned long address)-{- return \_\_bad\_area(regs, address, SEGV\_MAPERR);-}- static noinline int bad\_access\_pkey(struct pt\_regs \*regs, unsigned long address, struct vm\_area\_struct \*vma) {@@ -515,40 +510,12 @@ lock\_mmap: \* we will deadlock attempting to validate the fault against the \* address space. Luckily the kernel only validly references user \* space from well defined areas of code, which are listed in the- \* exceptions table.- \*- \* As the vast majority of faults will be valid we will only perform- \* the source reference check when there is a possibility of a deadlock.- \* Attempt to lock the address space, if we cannot we then validate the- \* source. If this is invalid we can skip the address space check,- \* thus avoiding the deadlock.+ \* exceptions table. lock\_mm\_and\_find\_vma() handles that logic. \*/- if (unlikely(!mmap\_read\_trylock(mm))) {- if (!is\_user && !search\_exception\_tables(regs->nip))- return bad\_area\_nosemaphore(regs, address);- retry:- mmap\_read\_lock(mm);- } else {- /\*- \* The above down\_read\_trylock() might have succeeded in- \* which case we'll have missed the might\_sleep() from- \* down\_read():- \*/- might\_sleep();- }-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (unlikely(!vma))- return bad\_area(regs, address);-- if (unlikely(vma->vm\_start > address)) {- if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN)))- return bad\_area(regs, address);-- if (unlikely(expand\_stack(vma, address)))- return bad\_area(regs, address);- }+ return bad\_area\_nosemaphore(regs, address);  if (unlikely(access\_pkey\_error(is\_write, is\_exec, (error\_code & DSISR\_KEYFAULT), vma)))diff --git a/arch/riscv/Kconfig b/arch/riscv/Kconfigindex c69572fbe613ed..a08917f681af2c 100644--- a/[arch/riscv/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/riscv/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/riscv/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/riscv/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -127,6 +127,7 @@ config RISCV select IRQ\_DOMAIN select IRQ\_FORCED\_THREADING select KASAN\_VMALLOC if KASAN+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA if MODULES select MODULE\_SECTIONS if MODULES select OFdiff --git a/arch/riscv/mm/fault.c b/arch/riscv/mm/fault.cindex 8685f85a7474ef..35a84ec69a9fd4 100644--- a/[arch/riscv/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/riscv/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/riscv/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/riscv/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -84,13 +84,13 @@ static inline void mm\_fault\_error(struct pt\_regs \*regs, unsigned long addr, vm\_f BUG(); } -static inline void bad\_area(struct pt\_regs \*regs, struct mm\_struct \*mm, int code, unsigned long addr)+static inline void+bad\_area\_nosemaphore(struct pt\_regs \*regs, int code, unsigned long addr) { /\* \* Something tried to access memory that isn't in our memory map. \* Fix it, but check if it's kernel or user first. \*/- mmap\_read\_unlock(mm); /\* User mode accesses just cause a SIGSEGV \*/ if (user\_mode(regs)) { do\_trap(regs, SIGSEGV, code, addr);@@ -100,6 +100,15 @@ static inline void bad\_area(struct pt\_regs \*regs, struct mm\_struct \*mm, int code no\_context(regs, addr); } +static inline void+bad\_area(struct pt\_regs \*regs, struct mm\_struct \*mm, int code,+ unsigned long addr)+{+ mmap\_read\_unlock(mm);++ bad\_area\_nosemaphore(regs, code, addr);+}+ static inline void vmalloc\_fault(struct pt\_regs \*regs, int code, unsigned long addr) { pgd\_t \*pgd, \*pgd\_k;@@ -287,23 +296,10 @@ void handle\_page\_fault(struct pt\_regs \*regs) else if (cause == EXC\_INST\_PAGE\_FAULT) flags |= FAULT\_FLAG\_INSTRUCTION; retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, addr);+ vma = lock\_mm\_and\_find\_vma(mm, addr, regs); if (unlikely(!vma)) { tsk->thread.bad\_cause = cause;- bad\_area(regs, mm, code, addr);- return;- }- if (likely(vma->vm\_start <= addr))- goto good\_area;- if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN))) {- tsk->thread.bad\_cause = cause;- bad\_area(regs, mm, code, addr);- return;- }- if (unlikely(expand\_stack(vma, addr))) {- tsk->thread.bad\_cause = cause;- bad\_area(regs, mm, code, addr);+ bad\_area\_nosemaphore(regs, code, addr); return; } @@ -311,7 +307,6 @@ retry: \* Ok, we have a good vm\_area for this memory access, so \* we can handle it. \*/-good\_area: code = SEGV\_ACCERR;  if (unlikely(access\_error(cause, vma))) {diff --git a/arch/s390/mm/fault.c b/arch/s390/mm/fault.cindex b65144c392b01a..dbe8394234e2b1 100644--- a/[arch/s390/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/s390/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/s390/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/s390/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -457,8 +457,9 @@ retry: if (unlikely(vma->vm\_start > address)) { if (!(vma->vm\_flags & VM\_GROWSDOWN)) goto out\_up;- if (expand\_stack(vma, address))- goto out\_up;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto out; }  /\*diff --git a/arch/sh/Kconfig b/arch/sh/Kconfigindex e339745f62a155..2b3ce4fd39563d 100644--- a/[arch/sh/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sh/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/sh/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sh/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -60,6 +60,7 @@ config SUPERH select HAVE\_STACKPROTECTOR select HAVE\_SYSCALL\_TRACEPOINTS select IRQ\_FORCED\_THREADING+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select NEED\_SG\_DMA\_LENGTH select NO\_DMA if !MMU && !DMA\_COHERENTdiff --git a/arch/sh/mm/fault.c b/arch/sh/mm/fault.cindex acd2f5e50bfcd0..06e6b49529245a 100644--- a/[arch/sh/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sh/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/sh/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sh/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -439,21 +439,9 @@ asmlinkage void \_\_kprobes do\_page\_fault(struct pt\_regs \*regs, }  retry:- mmap\_read\_lock(mm);-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (unlikely(!vma)) {- bad\_area(regs, error\_code, address);- return;- }- if (likely(vma->vm\_start <= address))- goto good\_area;- if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN))) {- bad\_area(regs, error\_code, address);- return;- }- if (unlikely(expand\_stack(vma, address))) {- bad\_area(regs, error\_code, address);+ bad\_area\_nosemaphore(regs, error\_code, address); return; } @@ -461,7 +449,6 @@ retry: \* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/-good\_area: if (unlikely(access\_error(error\_code, vma))) { bad\_area\_access\_error(regs, error\_code, address); return;diff --git a/arch/sparc/Kconfig b/arch/sparc/Kconfigindex 6197b87f2b3bb7..49849790e66dc3 100644--- a/[arch/sparc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/sparc/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -58,6 +58,7 @@ config SPARC32 select DMA\_DIRECT\_REMAP select GENERIC\_ATOMIC64 select HAVE\_UID16+ select LOCK\_MM\_AND\_FIND\_VMA select OLD\_SIGACTION select ZONE\_DMA diff --git a/arch/sparc/mm/fault\_32.c b/arch/sparc/mm/fault\_32.cindex 179295b14664a5..a3ccc0267bc205 100644--- a/[arch/sparc/mm/fault\_32.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/mm/fault_32.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/sparc/mm/fault\_32.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/mm/fault_32.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -143,28 +143,19 @@ asmlinkage void do\_sparc\_fault(struct pt\_regs \*regs, int text\_fault, int write, if (pagefault\_disabled() || !mm) goto no\_context; + if (!from\_user && address >= PAGE\_OFFSET)+ goto no\_context;+ perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address);  retry:- mmap\_read\_lock(mm);-- if (!from\_user && address >= PAGE\_OFFSET)- goto bad\_area;-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;+ goto bad\_area\_nosemaphore; /\* \* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/-good\_area: code = SEGV\_ACCERR; if (write) { if (!(vma->vm\_flags & VM\_WRITE))@@ -321,17 +312,9 @@ static void force\_user\_fault(unsigned long address, int write)  code = SEGV\_MAPERR; - mmap\_read\_lock(mm);- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;-good\_area:+ goto bad\_area\_nosemaphore; code = SEGV\_ACCERR; if (write) { if (!(vma->vm\_flags & VM\_WRITE))@@ -350,6 +333,7 @@ good\_area: return; bad\_area: mmap\_read\_unlock(mm);+bad\_area\_nosemaphore: \_\_do\_fault\_siginfo(code, SIGSEGV, tsk->thread.kregs, address); return; diff --git a/arch/sparc/mm/fault\_64.c b/arch/sparc/mm/fault\_64.cindex d8a407fbe350ae..e326caf708c609 100644--- a/[arch/sparc/mm/fault\_64.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/mm/fault_64.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/sparc/mm/fault\_64.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/sparc/mm/fault_64.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -386,8 +386,9 @@ continue\_fault: goto bad\_area; } }- if (expand\_stack(vma, address))- goto bad\_area;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto bad\_area\_nosemaphore; /\* \* Ok, we have a good vm\_area for this memory access, so \* we can handle it..@@ -490,8 +491,9 @@ exit\_exception: \* Fix it, but check if it's kernel or user first.. \*/ bad\_area:- insn = get\_fault\_insn(regs, insn); mmap\_read\_unlock(mm);+bad\_area\_nosemaphore:+ insn = get\_fault\_insn(regs, insn);  handle\_kernel\_fault: do\_kernel\_fault(regs, si\_code, fault\_code, insn, address);diff --git a/arch/um/kernel/trap.c b/arch/um/kernel/trap.cindex d3ce21c4ca32a8..6d8ae86ae978fd 100644--- a/[arch/um/kernel/trap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/um/kernel/trap.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/um/kernel/trap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/um/kernel/trap.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -47,14 +47,15 @@ retry: vma = find\_vma(mm, address); if (!vma) goto out;- else if (vma->vm\_start <= address)+ if (vma->vm\_start <= address) goto good\_area;- else if (!(vma->vm\_flags & VM\_GROWSDOWN))+ if (!(vma->vm\_flags & VM\_GROWSDOWN)) goto out;- else if (is\_user && !ARCH\_IS\_STACKGROW(address))- goto out;- else if (expand\_stack(vma, address))+ if (is\_user && !ARCH\_IS\_STACKGROW(address)) goto out;+ vma = expand\_stack(mm, address);+ if (!vma)+ goto out\_nosemaphore;  good\_area: \*code\_out = SEGV\_ACCERR;diff --git a/arch/x86/Kconfig b/arch/x86/Kconfigindex d5c69145a73c04..b3ebf58cf77e61 100644--- a/[arch/x86/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/x86/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -279,6 +279,7 @@ config X86 select HOTPLUG\_SMT if SMP select HOTPLUG\_SPLIT\_STARTUP if SMP && X86\_32 select IRQ\_FORCED\_THREADING+ select LOCK\_MM\_AND\_FIND\_VMA select NEED\_PER\_CPU\_EMBED\_FIRST\_CHUNK select NEED\_PER\_CPU\_PAGE\_FIRST\_CHUNK select NEED\_SG\_DMA\_LENGTHdiff --git a/arch/x86/mm/fault.c b/arch/x86/mm/fault.cindex e4399983c50c05..e8711b2cafaf70 100644--- a/[arch/x86/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/x86/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -880,12 +880,6 @@ \_\_bad\_area(struct pt\_regs \*regs, unsigned long error\_code, \_\_bad\_area\_nosemaphore(regs, error\_code, address, pkey, si\_code); } -static noinline void-bad\_area(struct pt\_regs \*regs, unsigned long error\_code, unsigned long address)-{- \_\_bad\_area(regs, error\_code, address, 0, SEGV\_MAPERR);-}- static inline bool bad\_area\_access\_from\_pkeys(unsigned long error\_code, struct vm\_area\_struct \*vma) {@@ -1366,51 +1360,10 @@ void do\_user\_addr\_fault(struct pt\_regs \*regs, lock\_mmap: #endif /\* CONFIG\_PER\_VMA\_LOCK \*/ - /\*- \* Kernel-mode access to the user address space should only occur- \* on well-defined single instructions listed in the exception- \* tables. But, an erroneous kernel fault occurring outside one of- \* those areas which also holds mmap\_lock might deadlock attempting- \* to validate the fault against the address space.- \*- \* Only do the expensive exception table search when we might be at- \* risk of a deadlock. This happens if we- \* 1. Failed to acquire mmap\_lock, and- \* 2. The access did not originate in userspace.- \*/- if (unlikely(!mmap\_read\_trylock(mm))) {- if (!user\_mode(regs) && !search\_exception\_tables(regs->ip)) {- /\*- \* Fault from code in kernel from- \* which we do not expect faults.- \*/- bad\_area\_nosemaphore(regs, error\_code, address);- return;- } retry:- mmap\_read\_lock(mm);- } else {- /\*- \* The above down\_read\_trylock() might have succeeded in- \* which case we'll have missed the might\_sleep() from- \* down\_read():- \*/- might\_sleep();- }-- vma = find\_vma(mm, address);+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (unlikely(!vma)) {- bad\_area(regs, error\_code, address);- return;- }- if (likely(vma->vm\_start <= address))- goto good\_area;- if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN))) {- bad\_area(regs, error\_code, address);- return;- }- if (unlikely(expand\_stack(vma, address))) {- bad\_area(regs, error\_code, address);+ bad\_area\_nosemaphore(regs, error\_code, address); return; } @@ -1418,7 +1371,6 @@ retry: \* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/-good\_area: if (unlikely(access\_error(error\_code, vma))) { bad\_area\_access\_error(regs, error\_code, address, vma); return;diff --git a/arch/xtensa/Kconfig b/arch/xtensa/Kconfigindex c1bcfc2a85815c..2a51a466779fe4 100644--- a/[arch/xtensa/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/xtensa/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/xtensa/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/xtensa/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -49,6 +49,7 @@ config XTENSA select HAVE\_SYSCALL\_TRACEPOINTS select HAVE\_VIRT\_CPU\_ACCOUNTING\_GEN select IRQ\_DOMAIN+ select LOCK\_MM\_AND\_FIND\_VMA select MODULES\_USE\_ELF\_RELA select PERF\_USE\_VMALLOC select TRACE\_IRQFLAGS\_SUPPORTdiff --git a/arch/xtensa/mm/fault.c b/arch/xtensa/mm/fault.cindex faf7cf35a0ee3d..d1eb8d6c5b8267 100644--- a/[arch/xtensa/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/xtensa/mm/fault.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[arch/xtensa/mm/fault.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/xtensa/mm/fault.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -130,23 +130,14 @@ void do\_page\_fault(struct pt\_regs \*regs) perf\_sw\_event(PERF\_COUNT\_SW\_PAGE\_FAULTS, 1, regs, address);  retry:- mmap\_read\_lock(mm);- vma = find\_vma(mm, address);-+ vma = lock\_mm\_and\_find\_vma(mm, address, regs); if (!vma)- goto bad\_area;- if (vma->vm\_start <= address)- goto good\_area;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- goto bad\_area;- if (expand\_stack(vma, address))- goto bad\_area;+ goto bad\_area\_nosemaphore;  /\* Ok, we have a good vm\_area for this memory access, so \* we can handle it.. \*/ -good\_area: code = SEGV\_ACCERR;  if (is\_write) {@@ -205,6 +196,7 @@ good\_area: \*/ bad\_area: mmap\_read\_unlock(mm);+bad\_area\_nosemaphore: if (user\_mode(regs)) { force\_sig\_fault(SIGSEGV, code, (void \*) address); return;diff --git a/drivers/iommu/amd/iommu\_v2.c b/drivers/iommu/amd/iommu\_v2.cindex 864e4ffb6aa94e..261352a2327162 100644--- a/[drivers/iommu/amd/iommu\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/iommu/amd/iommu_v2.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[drivers/iommu/amd/iommu\_v2.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/iommu/amd/iommu_v2.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -485,8 +485,8 @@ static void do\_fault(struct work\_struct \*work) flags |= FAULT\_FLAG\_REMOTE;  mmap\_read\_lock(mm);- vma = find\_extend\_vma(mm, address);- if (!vma || address < vma->vm\_start)+ vma = vma\_lookup(mm, address);+ if (!vma) /\* failed to get a vma in the right range \*/ goto out; diff --git a/drivers/iommu/iommu-sva.c b/drivers/iommu/iommu-sva.cindex 9821bc44f5ac1d..3ebd4b6586b3ee 100644--- a/[drivers/iommu/iommu-sva.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/iommu/iommu-sva.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[drivers/iommu/iommu-sva.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/iommu/iommu-sva.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -175,7 +175,7 @@ iommu\_sva\_handle\_iopf(struct iommu\_fault \*fault, void \*data)  mmap\_read\_lock(mm); - vma = find\_extend\_vma(mm, prm->addr);+ vma = vma\_lookup(mm, prm->addr); if (!vma) /\* Unmapped area \*/ goto out\_put\_mm;diff --git a/fs/binfmt\_elf.c b/fs/binfmt\_elf.cindex 983ce34115d5b9..7b3d2d4914073f 100644--- a/[fs/binfmt\_elf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/binfmt_elf.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[fs/binfmt\_elf.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/binfmt_elf.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -320,10 +320,10 @@ create\_elf\_tables(struct linux\_binprm \*bprm, const struct elfhdr \*exec, \* Grow the stack manually; some architectures have a limit on how \* far ahead a user-space access may be in order to grow the stack. \*/- if (mmap\_read\_lock\_killable(mm))+ if (mmap\_write\_lock\_killable(mm)) return -EINTR;- vma = find\_extend\_vma(mm, bprm->p);- mmap\_read\_unlock(mm);+ vma = find\_extend\_vma\_locked(mm, bprm->p);+ mmap\_write\_unlock(mm); if (!vma) return -EFAULT; diff --git a/fs/exec.c b/fs/exec.cindex 25c65b64544b26..80b8611c416d32 100644--- a/[fs/exec.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[fs/exec.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/fs/exec.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -200,33 +200,39 @@ static struct page \*get\_arg\_page(struct linux\_binprm \*bprm, unsigned long pos, int write) { struct page \*page;+ struct vm\_area\_struct \*vma = bprm->vma;+ struct mm\_struct \*mm = bprm->mm; int ret;- unsigned int gup\_flags = 0; -#ifdef CONFIG\_STACK\_GROWSUP- if (write) {- ret = expand\_downwards(bprm->vma, pos);- if (ret < 0)+ /\*+ \* Avoid relying on expanding the stack down in GUP (which+ \* does not work for STACK\_GROWSUP anyway), and just do it+ \* by hand ahead of time.+ \*/+ if (write && pos < vma->vm\_start) {+ mmap\_write\_lock(mm);+ ret = expand\_downwards(vma, pos);+ if (unlikely(ret < 0)) {+ mmap\_write\_unlock(mm); return NULL;- }-#endif-- if (write)- gup\_flags |= FOLL\_WRITE;+ }+ mmap\_write\_downgrade(mm);+ } else+ mmap\_read\_lock(mm);  /\* \* We are doing an exec(). 'current' is the process- \* doing the exec and bprm->mm is the new process's mm.+ \* doing the exec and 'mm' is the new process's mm. \*/- mmap\_read\_lock(bprm->mm);- ret = get\_user\_pages\_remote(bprm->mm, pos, 1, gup\_flags,+ ret = get\_user\_pages\_remote(mm, pos, 1,+ write ? FOLL\_WRITE : 0, &page, NULL);- mmap\_read\_unlock(bprm->mm);+ mmap\_read\_unlock(mm); if (ret <= 0) return NULL;  if (write)- acct\_arg\_size(bprm, vma\_pages(bprm->vma));+ acct\_arg\_size(bprm, vma\_pages(vma));  return page; }@@ -853,7 +859,7 @@ int setup\_arg\_pages(struct linux\_binprm \*bprm, stack\_base = vma->vm\_end - stack\_expand; #endif current->mm->start\_stack = bprm->p;- ret = expand\_stack(vma, stack\_base);+ ret = expand\_stack\_locked(vma, stack\_base); if (ret) ret = -EFAULT; diff --git a/include/linux/mm.h b/include/linux/mm.hindex eef34f6a035122..39aa409e84d572 100644--- a/[include/linux/mm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/mm.h?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[include/linux/mm.h](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/include/linux/mm.h?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -2334,6 +2334,8 @@ void unmap\_mapping\_pages(struct address\_space \*mapping, pgoff\_t start, pgoff\_t nr, bool even\_cows); void unmap\_mapping\_range(struct address\_space \*mapping, loff\_t const holebegin, loff\_t const holelen, int even\_cows);+struct vm\_area\_struct \*lock\_mm\_and\_find\_vma(struct mm\_struct \*mm,+ unsigned long address, struct pt\_regs \*regs); #else static inline vm\_fault\_t handle\_mm\_fault(struct vm\_area\_struct \*vma, unsigned long address, unsigned int flags,@@ -3228,16 +3230,11 @@ extern vm\_fault\_t filemap\_page\_mkwrite(struct vm\_fault \*vmf);  extern unsigned long stack\_guard\_gap; /\* Generic expand stack which grows the stack according to GROWS{UP,DOWN} \*/-extern int expand\_stack(struct vm\_area\_struct \*vma, unsigned long address);+int expand\_stack\_locked(struct vm\_area\_struct \*vma, unsigned long address);+struct vm\_area\_struct \*expand\_stack(struct mm\_struct \* mm, unsigned long addr);  /\* CONFIG\_STACK\_GROWSUP still needs to grow downwards at some places \*/-extern int expand\_downwards(struct vm\_area\_struct \*vma,- unsigned long address);-#if VM\_GROWSUP-extern int expand\_upwards(struct vm\_area\_struct \*vma, unsigned long address);-#else- #define expand\_upwards(vma, address) (0)-#endif+int expand\_downwards(struct vm\_area\_struct \*vma, unsigned long address);  /\* Look up the first VMA which satisfies addr < vm\_end, NULL if none. \*/ extern struct vm\_area\_struct \* find\_vma(struct mm\_struct \* mm, unsigned long addr);@@ -3332,7 +3329,8 @@ unsigned long change\_prot\_numa(struct vm\_area\_struct \*vma, unsigned long start, unsigned long end); #endif -struct vm\_area\_struct \*find\_extend\_vma(struct mm\_struct \*, unsigned long addr);+struct vm\_area\_struct \*find\_extend\_vma\_locked(struct mm\_struct \*,+ unsigned long addr); int remap\_pfn\_range(struct vm\_area\_struct \*, unsigned long addr, unsigned long pfn, unsigned long size, pgprot\_t); int remap\_pfn\_range\_notrack(struct vm\_area\_struct \*vma, unsigned long addr,diff --git a/mm/Kconfig b/mm/Kconfigindex 12f32f8d26bffd..e00df648c91d7e 100644--- a/[mm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/Kconfig?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[mm/Kconfig](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/Kconfig?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -1222,6 +1222,10 @@ config PER\_VMA\_LOCK This feature allows locking each virtual memory area separately when handling page faults instead of taking mmap\_lock. +config LOCK\_MM\_AND\_FIND\_VMA+ bool+ depends on !STACK\_GROWSUP+ source "mm/damon/Kconfig"  endmenudiff --git a/mm/gup.c b/mm/gup.cindex 48c1659314b0da..ef29641671c7d3 100644--- a/[mm/gup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/gup.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[mm/gup.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/gup.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -1168,7 +1168,11 @@ static long \_\_get\_user\_pages(struct mm\_struct \*mm,  /\* first iteration or cross vma bound \*/ if (!vma || start >= vma->vm\_end) {- vma = find\_extend\_vma(mm, start);+ vma = find\_vma(mm, start);+ if (vma && (start < vma->vm\_start)) {+ WARN\_ON\_ONCE(vma->vm\_flags & VM\_GROWSDOWN);+ vma = NULL;+ } if (!vma && in\_gate\_area(mm, start)) { ret = get\_gate\_page(mm, start & PAGE\_MASK, gup\_flags, &vma,@@ -1333,9 +1337,13 @@ int fixup\_user\_fault(struct mm\_struct \*mm, fault\_flags |= FAULT\_FLAG\_ALLOW\_RETRY | FAULT\_FLAG\_KILLABLE;  retry:- vma = find\_extend\_vma(mm, address);- if (!vma || address < vma->vm\_start)+ vma = find\_vma(mm, address);+ if (!vma)+ return -EFAULT;+ if (address < vma->vm\_start ) {+ WARN\_ON\_ONCE(vma->vm\_flags & VM\_GROWSDOWN); return -EFAULT;+ }  if (!vma\_permits\_fault(vma, fault\_flags)) return -EFAULT;diff --git a/mm/memory.c b/mm/memory.cindex 58029fd5adda70..d8a9a770b1f164 100644--- a/[mm/memory.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/memory.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[mm/memory.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/memory.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -5245,6 +5245,125 @@ out: } EXPORT\_SYMBOL\_GPL(handle\_mm\_fault); +#ifdef CONFIG\_LOCK\_MM\_AND\_FIND\_VMA+#include <linux/extable.h>++static inline bool get\_mmap\_lock\_carefully(struct mm\_struct \*mm, struct pt\_regs \*regs)+{+ /\* Even if this succeeds, make it clear we \*might\* have slept \*/+ if (likely(mmap\_read\_trylock(mm))) {+ might\_sleep();+ return true;+ }++ if (regs && !user\_mode(regs)) {+ unsigned long ip = instruction\_pointer(regs);+ if (!search\_exception\_tables(ip))+ return false;+ }++ return !mmap\_read\_lock\_killable(mm);+}++static inline bool mmap\_upgrade\_trylock(struct mm\_struct \*mm)+{+ /\*+ \* We don't have this operation yet.+ \*+ \* It should be easy enough to do: it's basically a+ \* atomic\_long\_try\_cmpxchg\_acquire()+ \* from RWSEM\_READER\_BIAS -> RWSEM\_WRITER\_LOCKED, but+ \* it also needs the proper lockdep magic etc.+ \*/+ return false;+}++static inline bool upgrade\_mmap\_lock\_carefully(struct mm\_struct \*mm, struct pt\_regs \*regs)+{+ mmap\_read\_unlock(mm);+ if (regs && !user\_mode(regs)) {+ unsigned long ip = instruction\_pointer(regs);+ if (!search\_exception\_tables(ip))+ return false;+ }+ return !mmap\_write\_lock\_killable(mm);+}++/\*+ \* Helper for page fault handling.+ \*+ \* This is kind of equivalend to "mmap\_read\_lock()" followed+ \* by "find\_extend\_vma()", except it's a lot more careful about+ \* the locking (and will drop the lock on failure).+ \*+ \* For example, if we have a kernel bug that causes a page+ \* fault, we don't want to just use mmap\_read\_lock() to get+ \* the mm lock, because that would deadlock if the bug were+ \* to happen while we're holding the mm lock for writing.+ \*+ \* So this checks the exception tables on kernel faults in+ \* order to only do this all for instructions that are actually+ \* expected to fault.+ \*+ \* We can also actually take the mm lock for writing if we+ \* need to extend the vma, which helps the VM layer a lot.+ \*/+struct vm\_area\_struct \*lock\_mm\_and\_find\_vma(struct mm\_struct \*mm,+ unsigned long addr, struct pt\_regs \*regs)+{+ struct vm\_area\_struct \*vma;++ if (!get\_mmap\_lock\_carefully(mm, regs))+ return NULL;++ vma = find\_vma(mm, addr);+ if (likely(vma && (vma->vm\_start <= addr)))+ return vma;++ /\*+ \* Well, dang. We might still be successful, but only+ \* if we can extend a vma to do so.+ \*/+ if (!vma || !(vma->vm\_flags & VM\_GROWSDOWN)) {+ mmap\_read\_unlock(mm);+ return NULL;+ }++ /\*+ \* We can try to upgrade the mmap lock atomically,+ \* in which case we can continue to use the vma+ \* we already looked up.+ \*+ \* Otherwise we'll have to drop the mmap lock and+ \* re-take it, and also look up the vma again,+ \* re-checking it.+ \*/+ if (!mmap\_upgrade\_trylock(mm)) {+ if (!upgrade\_mmap\_lock\_carefully(mm, regs))+ return NULL;++ vma = find\_vma(mm, addr);+ if (!vma)+ goto fail;+ if (vma->vm\_start <= addr)+ goto success;+ if (!(vma->vm\_flags & VM\_GROWSDOWN))+ goto fail;+ }++ if (expand\_stack\_locked(vma, addr))+ goto fail;++success:+ mmap\_write\_downgrade(mm);+ return vma;++fail:+ mmap\_write\_unlock(mm);+ return NULL;+}+#endif+ #ifdef CONFIG\_PER\_VMA\_LOCK /\* \* Lookup and lock a VMA under RCU protection. Returned VMA is guaranteed to be@@ -5584,25 +5703,32 @@ int \_\_access\_remote\_vm(struct mm\_struct \*mm, unsigned long addr, void \*buf, gup\_flags, &vma);  if (IS\_ERR\_OR\_NULL(page)) {-#ifndef CONFIG\_HAVE\_IOREMAP\_PROT- break;-#else- int res = 0;+ /\* We might need to expand the stack to access it \*/+ vma = vma\_lookup(mm, addr);+ if (!vma) {+ vma = expand\_stack(mm, addr);++ /\* mmap\_lock was dropped on failure \*/+ if (!vma)+ return buf - old\_buf;++ /\* Try again if stack expansion worked \*/+ continue;+ }+  /\* \* Check if this is a VM\_IO | VM\_PFNMAP VMA, which \* we can access using slightly different code. \*/- vma = vma\_lookup(mm, addr);- if (!vma)- break;+ bytes = 0;+#ifdef CONFIG\_HAVE\_IOREMAP\_PROT if (vma->vm\_ops && vma->vm\_ops->access)- res = vma->vm\_ops->access(vma, addr, buf,- len, write);- if (res <= 0)- break;- bytes = res;+ bytes = vma->vm\_ops->access(vma, addr, buf,+ len, write); #endif+ if (bytes <= 0)+ break; } else { bytes = len; offset = addr & (PAGE\_SIZE-1);diff --git a/mm/mmap.c b/mm/mmap.cindex 8f1000bc35df1d..9b5188b658006a 100644--- a/[mm/mmap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/mmap.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[mm/mmap.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/mmap.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -1948,7 +1948,7 @@ static int acct\_stack\_growth(struct vm\_area\_struct \*vma, \* PA-RISC uses this for its stack; IA64 for its Register Backing Store. \* vma is the last one with address > vma->vm\_end. Have to extend vma. \*/-int expand\_upwards(struct vm\_area\_struct \*vma, unsigned long address)+static int expand\_upwards(struct vm\_area\_struct \*vma, unsigned long address) { struct mm\_struct \*mm = vma->vm\_mm; struct vm\_area\_struct \*next;@@ -2040,6 +2040,7 @@ int expand\_upwards(struct vm\_area\_struct \*vma, unsigned long address)  /\* \* vma is the first one with address < vma->vm\_start. Have to extend vma.+ \* mmap\_lock held for writing. \*/ int expand\_downwards(struct vm\_area\_struct \*vma, unsigned long address) {@@ -2048,16 +2049,20 @@ int expand\_downwards(struct vm\_area\_struct \*vma, unsigned long address) struct vm\_area\_struct \*prev; int error = 0; + if (!(vma->vm\_flags & VM\_GROWSDOWN))+ return -EFAULT;+ address &= PAGE\_MASK;- if (address < mmap\_min\_addr)+ if (address < mmap\_min\_addr || address < FIRST\_USER\_ADDRESS) return -EPERM;  /\* Enforce stack\_guard\_gap \*/ prev = mas\_prev(&mas, 0); /\* Check that both stack segments have the same anon\_vma? \*/- if (prev && !(prev->vm\_flags & VM\_GROWSDOWN) &&- vma\_is\_accessible(prev)) {- if (address - prev->vm\_end < stack\_guard\_gap)+ if (prev) {+ if (!(prev->vm\_flags & VM\_GROWSDOWN) &&+ vma\_is\_accessible(prev) &&+ (address - prev->vm\_end < stack\_guard\_gap)) return -ENOMEM; } @@ -2137,13 +2142,12 @@ static int \_\_init cmdline\_parse\_stack\_guard\_gap(char \*p) \_\_setup("stack\_guard\_gap=", cmdline\_parse\_stack\_guard\_gap);  #ifdef CONFIG\_STACK\_GROWSUP-int expand\_stack(struct vm\_area\_struct \*vma, unsigned long address)+int expand\_stack\_locked(struct vm\_area\_struct \*vma, unsigned long address) { return expand\_upwards(vma, address); } -struct vm\_area\_struct \*-find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr)+struct vm\_area\_struct \*find\_extend\_vma\_locked(struct mm\_struct \*mm, unsigned long addr) { struct vm\_area\_struct \*vma, \*prev; @@ -2151,20 +2155,23 @@ find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr) vma = find\_vma\_prev(mm, addr, &prev); if (vma && (vma->vm\_start <= addr)) return vma;- if (!prev || expand\_stack(prev, addr))+ if (!prev)+ return NULL;+ if (expand\_stack\_locked(prev, addr)) return NULL; if (prev->vm\_flags & VM\_LOCKED) populate\_vma\_page\_range(prev, addr, prev->vm\_end, NULL); return prev; } #else-int expand\_stack(struct vm\_area\_struct \*vma, unsigned long address)+int expand\_stack\_locked(struct vm\_area\_struct \*vma, unsigned long address) {+ if (unlikely(!(vma->vm\_flags & VM\_GROWSDOWN)))+ return -EINVAL; return expand\_downwards(vma, address); } -struct vm\_area\_struct \*-find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr)+struct vm\_area\_struct \*find\_extend\_vma\_locked(struct mm\_struct \*mm, unsigned long addr) { struct vm\_area\_struct \*vma; unsigned long start;@@ -2175,10 +2182,8 @@ find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr) return NULL; if (vma->vm\_start <= addr) return vma;- if (!(vma->vm\_flags & VM\_GROWSDOWN))- return NULL; start = vma->vm\_start;- if (expand\_stack(vma, addr))+ if (expand\_stack\_locked(vma, addr)) return NULL; if (vma->vm\_flags & VM\_LOCKED) populate\_vma\_page\_range(vma, addr, start, NULL);@@ -2186,7 +2191,91 @@ find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr) } #endif -EXPORT\_SYMBOL\_GPL(find\_extend\_vma);+/\*+ \* IA64 has some horrid mapping rules: it can expand both up and down,+ \* but with various special rules.+ \*+ \* We'll get rid of this architecture eventually, so the ugliness is+ \* temporary.+ \*/+#ifdef CONFIG\_IA64+static inline bool vma\_expand\_ok(struct vm\_area\_struct \*vma, unsigned long addr)+{+ return REGION\_NUMBER(addr) == REGION\_NUMBER(vma->vm\_start) &&+ REGION\_OFFSET(addr) < RGN\_MAP\_LIMIT;+}++/\*+ \* IA64 stacks grow down, but there's a special register backing store+ \* that can grow up. Only sequentially, though, so the new address must+ \* match vm\_end.+ \*/+static inline int vma\_expand\_up(struct vm\_area\_struct \*vma, unsigned long addr)+{+ if (!vma\_expand\_ok(vma, addr))+ return -EFAULT;+ if (vma->vm\_end != (addr & PAGE\_MASK))+ return -EFAULT;+ return expand\_upwards(vma, addr);+}++static inline bool vma\_expand\_down(struct vm\_area\_struct \*vma, unsigned long addr)+{+ if (!vma\_expand\_ok(vma, addr))+ return -EFAULT;+ return expand\_downwards(vma, addr);+}++#elif defined(CONFIG\_STACK\_GROWSUP)++#define vma\_expand\_up(vma,addr) expand\_upwards(vma, addr)+#define vma\_expand\_down(vma, addr) (-EFAULT)++#else++#define vma\_expand\_up(vma,addr) (-EFAULT)+#define vma\_expand\_down(vma, addr) expand\_downwards(vma, addr)++#endif++/\*+ \* expand\_stack(): legacy interface for page faulting. Don't use unless+ \* you have to.+ \*+ \* This is called with the mm locked for reading, drops the lock, takes+ \* the lock for writing, tries to look up a vma again, expands it if+ \* necessary, and downgrades the lock to reading again.+ \*+ \* If no vma is found or it can't be expanded, it returns NULL and has+ \* dropped the lock.+ \*/+struct vm\_area\_struct \*expand\_stack(struct mm\_struct \*mm, unsigned long addr)+{+ struct vm\_area\_struct \*vma, \*prev;++ mmap\_read\_unlock(mm);+ if (mmap\_write\_lock\_killable(mm))+ return NULL;++ vma = find\_vma\_prev(mm, addr, &prev);+ if (vma && vma->vm\_start <= addr)+ goto success;++ if (prev && !vma\_expand\_up(prev, addr)) {+ vma = prev;+ goto success;+ }++ if (vma && !vma\_expand\_down(vma, addr))+ goto success;++ mmap\_write\_unlock(mm);+ return NULL;++success:+ mmap\_write\_downgrade(mm);+ return vma;+}  /\* \* Ok - we have the memory areas we should free on a maple tree so release them,diff --git a/mm/nommu.c b/mm/nommu.cindex f670d9979a2610..37d0b03143f175 100644--- a/[mm/nommu.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/nommu.c?id=3a8a670eeeaa40d87bd38a587438952741980c18)+++ b/[mm/nommu.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/nommu.c?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009)@@ -631,23 +631,20 @@ struct vm\_area\_struct \*find\_vma(struct mm\_struct \*mm, unsigned long addr) EXPORT\_SYMBOL(find\_vma);  /\*- \* find a VMA- \* - we don't extend stack VMAs under NOMMU conditions- \*/-struct vm\_area\_struct \*find\_extend\_vma(struct mm\_struct \*mm, unsigned long addr)-{- return find\_vma(mm, addr);-}--/\* \* expand a stack to a given address \* - not supported under NOMMU conditions \*/-int expand\_stack(struct vm\_area\_struct \*vma, unsigned long address)+int expand\_stack\_locked(struct vm\_area\_struct \*vma, unsigned long addr) { return -ENOMEM; } +struct vm\_area\_struct \*expand\_stack(struct mm\_struct \*mm, unsigned long addr)+{+ mmap\_read\_unlock(mm);+ return NULL;+}+ /\* \* look up the first VMA exactly that exactly matches addr \* - should be called with mm->mmap\_lock at least held readlocked |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 11:40:54 +0000



=== Content from lists.fedoraproject.org_6ac6ef12_20250114_191734.html ===


[![Fedora Mailing-Lists](/static/logo-hyperkitty-fedora.png)](/archives/ "Fedora Mailing-Lists")

[Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/)
[Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/)

* [Sign In](/accounts/login/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/)
* [Sign Up](/accounts/signup/?next=/archives/list/package-announce%40lists.fedoraproject.org/message/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/)

* [Manage this list](/admin/lists/package-announce.lists.fedoraproject.org/)


#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

### 2025

* [January](/archives/list/package-announce%40lists.fedoraproject.org/2025/1/)

### 2024

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2024/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2024/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2024/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2024/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2024/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2024/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2024/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2024/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2024/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2024/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2024/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2024/1/)

### 2023

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2023/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2023/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2023/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2023/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2023/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2023/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2023/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2023/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2023/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2023/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2023/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2023/1/)

### 2022

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2022/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2022/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2022/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2022/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2022/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2022/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2022/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2022/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2022/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2022/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2022/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2022/1/)

### 2021

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2021/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2021/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2021/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2021/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2021/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2021/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2021/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2021/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2021/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2021/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2021/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2021/1/)

### 2020

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2020/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2020/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2020/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2020/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2020/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2020/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2020/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2020/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2020/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2020/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2020/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2020/1/)

### 2019

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2019/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2019/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2019/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2019/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2019/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2019/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2019/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2019/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2019/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2019/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2019/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2019/1/)

### 2018

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2018/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2018/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2018/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2018/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2018/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2018/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2018/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2018/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2018/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2018/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2018/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2018/1/)

### 2017

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2017/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2017/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2017/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2017/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2017/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2017/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2017/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2017/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2017/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2017/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2017/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2017/1/)

### 2016

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2016/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2016/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2016/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2016/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2016/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2016/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2016/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2016/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2016/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2016/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2016/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2016/1/)

### 2015

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2015/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2015/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2015/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2015/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2015/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2015/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2015/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2015/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2015/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2015/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2015/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2015/1/)

### 2014

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2014/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2014/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2014/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2014/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2014/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2014/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2014/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2014/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2014/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2014/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2014/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2014/1/)

### 2013

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2013/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2013/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2013/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2013/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2013/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2013/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2013/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2013/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2013/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2013/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2013/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2013/1/)

### 2012

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2012/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2012/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2012/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2012/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2012/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2012/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2012/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2012/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2012/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2012/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2012/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2012/1/)

### 2011

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2011/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2011/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2011/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2011/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2011/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2011/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2011/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2011/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2011/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2011/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2011/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2011/1/)

### 2010

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2010/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2010/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2010/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2010/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2010/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2010/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2010/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2010/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2010/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2010/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2010/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2010/1/)

### 2009

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2009/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2009/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2009/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2009/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2009/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2009/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2009/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2009/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2009/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2009/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2009/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2009/1/)

### 2008

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2008/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2008/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2008/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2008/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2008/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2008/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2008/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2008/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2008/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2008/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2008/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2008/1/)

### 2007

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2007/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2007/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2007/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2007/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2007/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2007/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2007/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2007/5/)
* [April](/archives/list/package-announce%40lists.fedoraproject.org/2007/4/)
* [March](/archives/list/package-announce%40lists.fedoraproject.org/2007/3/)
* [February](/archives/list/package-announce%40lists.fedoraproject.org/2007/2/)
* [January](/archives/list/package-announce%40lists.fedoraproject.org/2007/1/)

### 2006

* [December](/archives/list/package-announce%40lists.fedoraproject.org/2006/12/)
* [November](/archives/list/package-announce%40lists.fedoraproject.org/2006/11/)
* [October](/archives/list/package-announce%40lists.fedoraproject.org/2006/10/)
* [September](/archives/list/package-announce%40lists.fedoraproject.org/2006/9/)
* [August](/archives/list/package-announce%40lists.fedoraproject.org/2006/8/)
* [July](/archives/list/package-announce%40lists.fedoraproject.org/2006/7/)
* [June](/archives/list/package-announce%40lists.fedoraproject.org/2006/6/)
* [May](/archives/list/package-announce%40lists.fedoraproject.org/2006/5/)

[List overview](/archives/list/package-announce%40lists.fedoraproject.org/)

[Download](/archives/list/package-announce%40lists.fedoraproject.org/export/package-announce%40lists.fedoraproject.org-U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L.mbox.gz?message=U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L "This message in gzipped mbox format")

[thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/#U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L)

# [SECURITY] Fedora 37 Update: kernel-6.3.12-100.fc37

![](https://seccdn.libravatar.org/avatar/be256568dfce45c1862b55e6cf3f2726.jpg?s=120&d=retro&r=g)

[updatesfedoraproject.org](/archives/users/3d8bb2e4c1d843beb492d4f8a7c44761/ "See the profile for updatesfedoraproject.org")

11 Jul
2023

11 Jul
'23

9:21 p.m.

--------------------------------------------------------------------------------
Fedora Update Notification
FEDORA-2023-2932e6c7d8
2023-07-12 01:19:22.675590
--------------------------------------------------------------------------------

Name : kernel
Product : Fedora 37
Version : 6.3.12
Release : 100.fc37
URL : <https://www.kernel.org/>
Summary : The Linux kernel
Description :
The kernel meta package

--------------------------------------------------------------------------------
Update Information:

The 6.3.12 stable kernel update contains a number of important fixes across the
tree. ---- The 6.3.11 stable kernel update contains a number of important
fixes across the tree. ---- The 6.3.10 stable kernel update contains a number
of important fixes across the tree.
--------------------------------------------------------------------------------
ChangeLog:

\* Wed Jul 5 2023 Augusto Caringi acaringi@redhat.com [6.3.12-0]
- Linux v6.3.12
\* Sun Jul 2 2023 Justin M. Forbes jforbes@fedoraproject.org [6.3.11-0]
- Linux v6.3.11
\* Wed Jun 28 2023 Augusto Caringi acaringi@redhat.com [6.3.10-0]
- Linux v6.3.10
\* Wed Jun 21 2023 Augusto Caringi acaringi@redhat.com [6.3.9-0]
- Turn on CONFIG\_RMNET for Fedora (Justin M. Forbes)
- redhat/config: common: Enable CONFIG\_GPIO\_SIM for software development (Kate Hsuan)
- Add the MT7922 Bluetooth bug to BugsFixed (Augusto Caringi)
- Bluetooth: Add VID/PID 0489/e0e4 for MediaTek MT7922 (Meng Tang)
- Linux v6.3.9
--------------------------------------------------------------------------------
References:

[ 1 ] Bug #2215268 - CVE-2023-3269 kernel: distros-[DirtyVMA] Privilege escalation via non-RCU-protected VMA traversal
<https://bugzilla.redhat.com/show_bug.cgi?id=2215268>
--------------------------------------------------------------------------------

This update can be installed with the "dnf" update program. Use
su -c 'dnf upgrade --advisory FEDORA-2023-2932e6c7d8' at the command
line. For more information, refer to the dnf documentation available at
<http://dnf.readthedocs.io/en/latest/command_ref.html#upgrade-command-label>

All packages are signed with the Fedora Project GPG key. More details on the
GPG keys used by the Fedora Project can be found at
<https://fedoraproject.org/keys>
--------------------------------------------------------------------------------

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/package-announce%40lists.fedoraproject.org/thread/U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L/#U6AAA64CUPSMBW6XDTXPQJ3KQWYQ4K7L)

[Back to the list](/archives/list/package-announce%40lists.fedoraproject.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.7.



=== Content from www.openwall.com_5f45ed86_20250114_191730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2023/07/27/1) [[next>]](../../../2023/07/29/1) [[<thread-prev]](../../../2023/07/07/4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <tkggwmpgmqj3vujgtqaugqajjuuot2areurrayhbumy5dsrhrz@sejaur5ldzhl>
Date: Fri, 28 Jul 2023 21:25:12 +0800
From: Ruihan Li <lrh2000@....edu.cn>
To: oss-security@...ts.openwall.com
Cc: Ruihan Li <lrh2000@....edu.cn>
Subject: Re: StackRot (CVE-2023-3269): Linux kernel privilege escalation
 vulnerability

Hi all,

The PoC code and exploit write-up of the StackRot vulnerability has been
published to [GitHub][gh]. I'm going to copy the write-up here, but I
recommend the GitHub version because there are some figures embedded.

 [gh]: <https://github.com/lrh2000/StackRot>

Besides, the exploit is verified by the GitHub CI. Therefore, the most
straightforward way to understand how this exploit operates without
having to set up a local environment is by reviewing the GitHub CI pass
procedure, which can be found [here][ci].

 [ci]: <https://github.com/lrh2000/StackRot/actions>

## Exploit

The exploit primarily focuses on the Google kCTF challenge, specifically when
neither CONFIG_PREEMPT nor CONFIG_SLAB_MERGE_DEFAULT is set. To exploit
StackRot, the most important task is to locate a VMA iteration that fulfills
the following criteria:
 1. The iteration's timing can be controlled. This control allows us to ensure
    that the RCU grace period concludes during the VMA iteration.
 2. The iteration retrieves specific information from the VMA structure, and
    returns the information to the userspace. This feature enables us to
    exploit the UAF vulnerability of the maple node to leak some kernel
    addresses.
 3. The iteration invokes certain function pointers in the VMA structure. This
    particular capability allows us to exploit the UAF of the maple node to
    control the kernel-mode program counter (PC).

The chosen VMA iteration is the iteration responsible for generating the
contents of `/proc/[pid]/maps`. The following sections will show how this
iteration satisfies the above criteria.

### Step 0: From UAFBR to UAF

During any VMA iteration, the reference to the root node of the VMA tree is
obtained, and the iteration proceeds through its slots. Thus, by triggering
stack expansion in another thread on a separate CPU during the VMA iteration,
the node replacement can be concurrently initiated. At this point, accessing
the old node is considered a use-after-free-by-RCU (UAFBR) situation. However,
actual issues arise only when the old node is truly freed, which occurs in the
RCU callback.

This presents two challenges: (i) determining when the old node is freed and
(ii) ensuring that the VMA iteration does not complete before the old node is
freed.

The first question is relatively straightforward. In the kernel, the
`synchronize_rcu()` function can be employed to wait until the RCU grace period
concludes, ensuring that all pre-existing RCU callbacks have been invoked. In
userspace, system calls that ultimately call `synchronize_rcu()` can be
utilized for the same purpose. Thus, when such system calls terminate, it is
known that the old node has been freed. Notably, there is a system call,
`membarrier(MEMBARRIER_CMD_GLOBAL, 0, -1)`, that solely invokes
`synchronize_rcu()`.

```c
SYSCALL_DEFINE3(membarrier, int, cmd, unsigned int, flags, int, cpu_id)
{
	// ...

	switch (cmd) {
	// ...
	case MEMBARRIER_CMD_GLOBAL:
		/* MEMBARRIER_CMD_GLOBAL is not compatible with nohz_full. */
		if (tick_nohz_full_enabled())
			return -EINVAL;
		if (num_online_cpus() > 1)
			synchronize_rcu();
		return 0;
	// ...
	}
}
```

The second question necessitates further consideration. Several potential
solutions are as follows:
 1. The iteration task gets preempted, the RCU grace period ends, and the
    iteration resumes execution. However, this approach is ineffective if
    CONFIG_PREEMPT is not set.
 2. The iteration task enters a sleep state (e.g., waiting for I/O), the RCU
    grace period ends, and the iteration continues. Currently, I am unaware of
    any VMA iteration that satisfies this requirement and can be exploited to
    leak kernel addresses and control the program counter (PC). It may exist,
    but a thorough investigation is required.
 3. The iteration task experiences an interruption (e.g., timer interrupt),
    during which the RCU grace period concludes. It is possible to employ
    timerfd to create multiple hardware timers that, upon timeout during the
    VMA iteration, can trigger a lengthy interrupt. However, this approach is
    not viable because the interrupt handler operates with interrupts disabled,
    and if a CPU cannot handle inter-processor interrupts (IPIs), the RCU grace
    period will not end.
 4. The iteration task is deliberately prolonged, allowing the RCU grace period
    to expire. This is the chosen solution. If the current RCU grace period
    surpasses RCU_TASK_IPI_DELAY (defaulting to 0.5 seconds), inter-processor
    interrupts (IPIs) are dispatched to all CPUs to verify that they are not in
    RCU critical sections. In the case of VMA iteration, the answer is
    negative, signifying that the RCU grace period concludes and the maple node
    is freed, effectively converting UAFBR into a genuine use-after-free (UAF)
    scenario.

One significant observation is that during VMA iteration for
`/proc/[pid]/maps`, it generates the entire file path for file-mapped memory
regions. Although the directory name is typically restricted to a maximum of
255 characters, there is no limitation on the directory depth. This means that
by creating a file with an exceedingly large directory depth and establishing a
memory mapping for this file, accessing `/proc/[pid]/maps` can take a
considerable amount of time during the VMA iteration. Consequently, this
extended duration enables the possibility of concluding the RCU grace period
and acquiring the UAF primitive.

```c
static void
show_map_vma(struct seq_file *m, struct vm_area_struct *vma)
{
	// ...

	/*
	 * Print the dentry name for named mappings, and a
	 * special [heap] marker for the heap:
	 */
	if (file) {
		seq_pad(m, ' ');
		/*
		 * If user named this anon shared memory via
		 * prctl(PR_SET_VMA ..., use the provided name.
		 */
		if (anon_name)
			seq_printf(m, "[anon_shmem:%s]", anon_name->name);
		else
			seq_file_path(m, file, "\n");
		goto done;
	}

	// ...
}
```

This step is illustrated in the following figure:

![Step 0: From UAFBR to UAF](<https://github.com/lrh2000/StackRot/raw/master/pic/nodes_free_and_use.png>)

### Step 1: From slab UAF to page UAF

Now that UAF is functioning within a slab. If CONFIG_SLAB_MERGE_DEFAULT is
enabled and the slab of maple nodes merges with kmalloc-256, the contents
within the old node can be controlled by allocating a new structure from
kmalloc-256 and populating it with userspace data. However, if
CONFIG_SLAB_MERGE_DEFAULT is not set, an alternative approach is required. In
this case, one needs to return the page of the freed node to the page
allocator, allowing the old node to be controlled by allocating a new page and
filling it accordingly.

Recall that the VMA tree will only contain one node. Hence, by utilizing
`fork()`/`clone()`, multiple VMA trees and an equal number of maple nodes are
generated. Assuming one slab encompasses M maple nodes, and one node per M
nodes is retained while all other nodes are freed via `exit()`, the remaining
nodes become the sole nodes within their respective slabs. Initially, these
slabs reside in the CPU's partial list. When the partial list reaches its
capacity, the slabs are flushed back to the partial list of the corresponding
NUMA node.

If the last maple node within a slab is freed, the slab becomes empty. If this
slab resides in the partial list of a NUMA node, and the partial list of that
particular NUMA node is already at maximum capacity, the page is immediately
returned to the page allocator. Consequently, the slab UAF transforms into a
page UAF scenario. The contents within the freed page can be manipulated by
sending some data via `msgsnd()`, which allocates elastic objects and directly
populates them with the provided user data.

```c
static void __slab_free(struct kmem_cache *s, struct slab *slab,
			void *head, void *tail, int cnt,
			unsigned long addr)

{
	// ...

	if (unlikely(!new.inuse && n->nr_partial >= s->min_partial))
		goto slab_empty;

	// ...
	return;

slab_empty:
	// ...
	discard_slab(s, slab);
}
```

The number of maple nodes per slab, M, depends on the number of CPUs. The
exploit implementation considers a situation with two CPUs and therefore
assumes 16 as the value of M, as illustrated in the following figure:

![Step 1: From slab UAF to page UAF](<https://github.com/lrh2000/StackRot/raw/master/pic/node_master_fengshui.png>)

### Step 2: From UAF to address leaking

Upon gaining control of the maple node, it becomes possible to manipulate the
addresses of subsequent VMAs that will be later iterated. As the targeted
iteration is aimed at generating `/proc/self/maps`, certain VMA information,
such as the start and end addresses, which reside within the VMA structure, are
returned to the user space.

However, a challenge arises: the address of a VMA structure in the maple node
can only be appropriately set if some addresses are already known. Fortunately,
CVE-2023-0597 directly serves this purpose. According to CVE-2023-0597, the
address of `cpu_entry_area` is not randomized. Although this vulnerability has
been patched in Linux 6.2, it has not been backported to earlier stable kernels
as of the time of writing. Consequently, by overwriting the address of the VMA
structure with that of the last IDT entry, the entry that contains the address
of `asm_sysvec_spurious_apic_interrupt` is directly leaked, thereby revealing
the base addresses of the kernel code and kernel data.

![Step 2: From UAF to address leaking (1)](<https://github.com/lrh2000/StackRot/raw/master/pic/node_master_code_leak.png>)

The previously discussed method can be used recurrently to incrementally expose
more addresses from the kernel data section. For instance, the
`init_task.tasks.prev` pointer within the data section directs to the
`task_struct` structure of the latest created task, which is without question
allocated on the heap.

![Step 2: From UAF to address leaking (2)](<https://github.com/lrh2000/StackRot/raw/master/pic/node_master_heap_leak.png>)

When all newly established tasks are terminated, their `task_struct` structures
will subsequently be deallocated. If the quantity of these tasks is large
enough, the corresponding pages can be surrendered back to the page allocator.
This allows for the possibility to reallocate these pages and fill them with
user data. However, keep in mind that the released pages generally belong to
the per-cpu page (PCP) list. For pages present in the PCP list, they can be
reallocated exclusively in the same page order. Consequently, solely mapping
new pages into the user space, which requires only order-0 pages from the page
allocator, won't fulfill the objectives.

Nonetheless, the msgsnd system call will solicit memory chunks via kmalloc and
populate these chunks with user-defined data. When the kmalloc cache is
exhausted, it will requisition pages from the page allocator at a specific
order. If the message size is accurately adjusted, the exact order will be
desired. Thus, the page whose address has been previously leaked will be
reallocated. As a result, it becomes possible to obtain a page with a known
address and user-manipulated data.

### Step 3: From UAF to root privileges

It is now possible to forge the VMA structure in the address-known page and
control the `vma->vm_ops->name` function pointer. The next step involves
finding suitable gadgets to escape containers and acquire root privileges.

```c
static void
show_map_vma(struct seq_file *m, struct vm_area_struct *vma)
{
	// ...

	if (vma->vm_ops && vma->vm_ops->name) {
		name = vma->vm_ops->name(vma);
		if (name)
			goto done;
	}

	// ...
}
```

![Step 3: From UAF to root privileges](<https://github.com/lrh2000/StackRot/raw/master/pic/node_master_kern_exec.png>)

The gadget constructions are as follows:
 1. Stack pivot: `movq %rbx, %rsi; movq %rbp, %rdi; call
    __x86_indirect_thunk_r13` -> `pushq %rsi; jmp 46(%rsi)` -> `popq %rsp; ret`
    -> `popq %rsp; ret`, where %rdi, %rbx, and %r13 _initially_ points to
    user-controllable data.
 2. Gain root privileges: `popq %rdi; ret` -> `prepare_kernel_cred` -> `popq
    %rdi; ret` -> `movq %rax, (%rdi); ret`, where %rdi _now_ points to the
    stack top; `popq %rdi; ret` -> `commit_creds`, effectively executing
    `commit_creds(prepare_kernel_cred(&init_task))`.
 3. Escape containers: `popq %rdi; ret` -> `find_task_by_vpid` -> `popq %rdi;
    ret` -> `movq %rax, (%rdi); ret`, where %rdi _now_ points to the stack top;
    `popq %rdi; ret` -> `popq %rsi; ret` -> `switch_task_namespaces`,
    effectively performing `switch_task_namespaces(find_task_by_vpid(1),
    &init_nsproxy)`.
 4. Unlock mm: `popq %rax; ret` -> `movq %rbp, %rdi; call
    __x86_indirect_thunk_rax`, where %rbp points to the original seq_file;
    `popq %rax; ret` -> `m_stop`, effectively executing `m_stop(seq_file, ..)`.
 5. Return to userspace: use `swapgs_restore_regs_and_return_to_usermode`, and
    call `execve()` to get the shell.

Finally, using `nsenter --mount=/proc/1/ns/mnt` to restore the mount namespace
and get the flag via `cat /flag/flag`.

### Source code

The full exploit source is available [here][exp]. For more details, refer to
its README file.

 [exp]: <https://github.com/lrh2000/StackRot/tree/master/exp>

Thanks,
Ruihan Li

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_cf64cedb_20250114_191731.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](../../../2023/08/26/1) [[thread-next>]](../../../2023/08/26/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20230825222359.GA10424@openwall.com>
Date: Sat, 26 Aug 2023 00:23:59 +0200
From: Solar Designer <solar@...nwall.com>
To: oss-security@...ts.openwall.com
Cc: Vegard Nossum <vegard.nossum@...cle.com>, Jiri Kosina <jkosina@...e.cz>,
	Donald Buczek <buczek@...gen.mpg.de>,
	Greg KH <gregkh@...uxfoundation.org>
Subject: linux-distros list policy and Linux kernel, again

Hi,

This is sort of continuation to a thread I started in here last year, at
the time focusing on allowing "embargoes" on publicly fixed Linux kernel
issues, which we ended up agreeing to:

<https://www.openwall.com/lists/oss-security/2022/05/15/1>

BTW, this recent thread on "Quality standards for embargoed code" is
relevant to that previous topic:

[https://lore.kernel.org/ksummit/2023081527-amendment-professed-0a42@gregkh/T/#t](https://lore.kernel.org/ksummit/2023081527-amendment-professed-0a42%40gregkh/T/#t)

(It's harder/worse to test code changes that are not yet public, which
is something we also recently discussed in context of and granted an
exception to the curl project.)

This time, there are at least two more points of contention to discuss.

Thank you Donald Buczek for bringing this to oss-security (and beating
me to it), with your specific needs explained:

<https://www.openwall.com/lists/oss-security/2023/08/25/1>
[https://lore.kernel.org/ksummit/nycvar.YFH.7.76.2308160014330.14207@cbobk.fhfr.pm/T/#t](https://lore.kernel.org/ksummit/nycvar.YFH.7.76.2308160014330.14207%40cbobk.fhfr.pm/T/#t)

Here I'd like to start a new thread just on oss-security (no cross-post,
but some people CC'ed) and with more context given.

For some years until recently, the Linux kernel's
Documentation/admin-guide/security-bugs.rst directed people to also
report "sensitive bugs, such as those that might lead to privilege
escalations" to linux-distros.  On one hand, that was great -
cooperation between Linux kernel upstream and Linux distros.  On the
other hand, the specific wording did not fully match linux-distros
policy, yet it bypassed a visit to the wiki page on linux-distros with
the instructions and policy on it by directly giving out the posting
address.  This resulted in people reporting issues to linux-distros
without having actually read and accepted the policy.

Last year, Vegard Nossum suggested edits (and then revised them this
year) to try and make things much clearer for reporters:

[https://lore.kernel.org/all/20230305220010.20895-1-vegard.nossum@oracle.com/](https://lore.kernel.org/all/20230305220010.20895-1-vegard.nossum%40oracle.com/)
<https://vegard.github.io/security-v3/Documentation/output/process/security-bugs.html>

As I recall, when Vegard offered this edited documentation (the second
URL above) to people who reported something to linux-distros but were
confused, they said that version of the documentation was indeed much
clearer.  However, the changes didn't get merged, which I speculate is
in part a result of them changing several things at once and thus making
it harder for all reviewers to agree on them.  Besides, I am not sure
this was the right direction: maybe rather than duplicate and explain
linux-distros policy aspects in Linux kernel documentation, it was
better to refer to linux-distros instructions and omit the linux-distros
posting address from the kernel documentation.

Then there was the recent lengthy linux-distros and s@k.o thread on the
StackRot (CVE-2023-3269) vulnerability, publicly disclosed here:

<https://www.openwall.com/lists/oss-security/2023/07/05/1>

In that private thread, two linux-distros policy aspects came up as
being inconsistent with s@k.o preferences:

1. For s@k.o, public disclosure is typically in up to 7 days since fix
is ready, but for linux-distros the deadline is 14 days max since
linux-distros is notified even if the fix is not ready.  Apparently,
this one makes Greg KH particularly unhappy about linux-distros.

2. _If_ the reporter shares PoCs/exploits with linux-distros, then per
current policy those should also be made public (within up to 7 days
more after the vulnerability is publicly disclosed as such).  Linus
Torvalds said that this must be up to the reporter only, and we should
not be imposing such policy.  In a sense, this is already up to the
reporter - if they disagree, they just shouldn't post PoCs/exploits to
linux-distros - can instead post an offer to share with individual
distros if they want to, or not share at all.  However, this is
problematic in practice because not everyone reads the rules before
posting and sometimes people change their mind during the embargo time
(or are required to "change their mind" by their employer, etc.)

I had already recognized both of these as problems - e.g., the latter
one also came up in Mathias Krause's disclosure of another Linux kernel
vulnerability in 2022:

<https://www.openwall.com/lists/oss-security/2022/02/03/1>

At the time, I thought that maybe increasing the maximum delay for
PoC/exploit publication from 7 to 30 days would be appropriate, but we
did not formally do it.  I effectively granted a similar exception to
Ruihan Li for StackRot this time, even though the full exploit wasn't
even shared with linux-distros and Ruihan was willing to publish the
PoCs that he did share on time.  I also informed Ruihan of this policy
aspect early enough, so we dodged that bullet that time, but at the same
time made Linus aware of this general issue, triggering his criticism.
(That's fine, it's good to have criticism.)

Overall, even though these issues were mostly avoided for StackRot in
particular, bringing them up in this thread ended up being the last
straw for the Linux kernel security folks to say they don't want to deal
with linux-distros anymore, resulting in this edit to the documentation:

<https://git.kernel.org/linus/4fee0915e649b>

This has a spiteful commit message and a calmer almost constructive
actual change.  Knowing that the status quo was problematic and not
having a better solution ready (other than Vegard's elaborate edits), I
actually approved of this edit as well.  It says:

---
The kernel security team strongly recommends that reporters of potential
security issues NEVER contact the "linux-distros" mailing list until
AFTER discussing it with the kernel security team.  Do not Cc: both
lists at once.  You may contact the linux-distros mailing list after a
fix has been agreed on and you fully understand the requirements that
doing so will impose on you and the kernel community.

The different lists have different goals and the linux-distros rules do
not contribute to actually fixing any potential security problems.
---

(I take issue with the second paragraph, as I explained in the message
Donald forwarded in here earlier today.)

So the kernel security team can, after having arrived at a fix, choose
to direct the reporter to also contact linux-distros.  I don't know
whether this would actually be happening or not.  Maybe some friendly
dialogue (which I hope this message can be a part of) and agreeing on
things could make that more likely.

I think the two linux-distros policy aspects above do not preclude such
cooperation.  However, I am willing to discuss possible policy changes
(or perhaps Linux kernel exceptions).

I recognize that 14 days might not always be enough to get a fix ready,
especially not for many of the CPU microarchitectural issues being
handled since mid-2017 and affecting many proprietary OSes as well (who
may be used to much longer disclosure timelines and would object to
Linux's earlier fix and disclosure).  I am glad that almost none of such
issues were brought to (linux-)distros, and never when it was still more
than 14 days until public disclosure.  We had a lot of luck there.
Linux kernel security team has its own mailing list (encrypted, so more
secure than s@k.o) for handling of those, which is great:

<https://www.kernel.org/doc/html/latest/process/embargoed-hardware-issues.html>

I mean, this is "great" within the constraints of the rest of the
industry.  Of course, I'd very much like disclosure timelines for that
kind of issues to also become much shorter.  This is just not the case.

In terms of (linux-)distros list policy, what can we do here?  Accept up
to 7 days since fix is ready and thus accept arbitrarily long embargoes
and more likely have issues "requiring" such embargoes brought to the
list?  BTW, for CPU microarchitectural issues, that would probably need
to be for the full distros list, not limited to Linux, and from what I
know disclosure timelines for such issues may be 3 to 12+ months.

As to publishing PoCs/exploits, this is already mitigated by the Linux
kernel documentation edit making it less likely (but far from
impossible) that people would send stuff to linux-distros without being
aware of the policy.  We could further mitigate this issue by allowing
up to 30 days (but perhaps suggesting at most 7 days?)  As I recall, how
much time to allow here was first discussed in context of an Exim issue
that was expected to be so easy to independently come up with an exploit
for that even 7 days seemed excessive, so 24 hours was agreed upon for
that occasion:

<https://www.openwall.com/lists/oss-security/2019/06/05/4>

However, issues vary, and maybe 1 to 30 days on a case-by-case basis is
reasonable?

Another option is to completely remove this requirement (only for Linux
kernel issues or for all), but there are reasons to keep it:

1. To reduce the value of information staying in linux-distros members'
mailboxes/computers to potential attackers.

The issues with highly valuable information staying in there are that
such people/resources become more lucrative attack targets, and that
compromises/leaks might not be detected, in which case the situation is
worse than with full publication (only bad actors benefit).

2. To let the wider community benefit from those PoCs/exploits.

There are many uses for PoCs/exploits other than testing by upstream
developers or attacking systems in the wild.  Other uses include:
testing of (possibly different or backported) fixes by other distros
(not all of which are on linux-distros for a variety of reasons) and by
advanced users, reuses by other developers and security researchers to
better understand the problem and as templates for further PoC/exploit
development (such as in determining and demonstrating exploitability of
further related bugs), testing and improvement of (non-)effectiveness of
general security hardening mitigations and of security monitoring tools.

I'd appreciate any well-reasoned votes and constructive suggestions.
Maybe there are good ideas that didn't cross my mind yet.

Thanks,

Alexander

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from seclists.org_7f31a1b2_20250114_191730.html ===

[![](/shared/images/nst-icons.svg#menu)](#menu)
![](/shared/images/nst-icons.svg#close)
[![Home page logo](/images/sitelogo.png)](/)
[Nmap.org](https://nmap.org/)
[Npcap.com](https://npcap.com/)
[Seclists.org](https://seclists.org/)
[Sectools.org](https://sectools.org)
[Insecure.org](https://insecure.org/)

![](/shared/images/nst-icons.svg#search)

# SecLists.Org Security Mailing List Archive

Any hacker will tell you that the latest news and exploits are not
found on any web sitenot even [Insecure.Org](https://insecure.org). No, the cutting edge
in security research is and will continue to be the full
disclosure mailing lists such as Bugtraq. Here we provide web
archives and RSS feeds (now including message extracts), updated in real-time, for many of our favorite lists.
Browse the individual lists below, or search them all using the Site Search box above.
## Insecure.Org Lists

[![nmap-dev logo](/images/nmap-dev-logo.png)](/nmap-dev/)

**[Nmap Development](/nmap-dev/)**  Unmoderated technical development forum for debating ideas, patches, and suggestions regarding proposed changes to [Nmap](https://nmap.org) and related projects. [Subscribe to nmap-dev here](https://nmap.org/mailman/listinfo/dev).

* [![Current period icon](/images/current-icon-16x16.png)Previous Quarter](/nmap-dev/2024/q4/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/nmap-dev/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/nmap-dev.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://nmap.org/mailman/listinfo/dev)* [nmap-devLatest Posts](/nmap-dev/)

> **[Post Quantum hackathon and nmap](https://seclists.org/nmap-dev/2024/q4/8)**
> *Loganaden Velvindron (Dec 09)*
>
> Hi Folks,
>
>
>
> I'm logan from the cyberstorm.mu team. We have opened several PRs for
>
> nmap to improve support for Post Quantum algorithms:
>
>
>
> <https://github.com/nmap/nmap/pull/2977>
>
> <https://github.com/nmap/nmap/pull/2978>
>
> <https://github.com/nmap/nmap/pull/2987>
>
>
>
> We are working on other PRs for PQ which we will send in due time.
>
> Feedback is welcome and we are willing to commit time to improve our
>
> PRs.
>
>
>
> Kind regards,
>
> Logan
>
> (On behalf of the...
>
>
> **[crash report](https://seclists.org/nmap-dev/2024/q4/7)**
> *Dmitriy Solodunenko (Oct 31)*
>
> Ubuntu 24.04
>
> Version: 7.94+SVN
>
> TypeError: Couldn't find foreign struct converter for 'cairo.Context'
>
>
> **[crash](https://seclists.org/nmap-dev/2024/q4/6)**
> *Tim Millard (Oct 31)*
>
> Version: 7.94+SVN
>
> TypeError: Couldn't find foreign struct converter for 'cairo.Context'
>
>
>
> Ubuntu 24.04.01
>
>
> **[Re: Regarding NMAP Retrigger for snmp-sysdescr](https://seclists.org/nmap-dev/2024/q4/5)**
> *Daniel Miller (Oct 31)*
>
> Ramu,
>
>
>
> Nmap's snmp-sysdescr script currently uses a 5-second timeout and attempts
>
> only once to send the SNMPv1 request. We agree that this could be improved
>
> to provide better reliability. I will investigate further and respond again
>
> with specific suggestions.
>
>
>
> Dan
>
>
> **[Regarding NMAP Retrigger for snmp-sysdescr](https://seclists.org/nmap-dev/2024/q4/4)**
> *Ramu Burra via dev (Oct 31)*
>
> Hi Daniel & NMAP team,
>
>
>
> I hope this email finds you well.
>
>
>
> I'm writing to inquire about the specific behaviour of Nmap's SNMP-SYSDescr query in situations where the target device
>
> responds intermittently.
>
>
>
> I'm particularly interested in knowing if there are any specific configuration options or techniques that can be
>
> employed to increase the likelihood of successful SNMP-SYSDescr queries, especially when dealing with...
>
>
> **[Re: Nmap PR #2909](https://seclists.org/nmap-dev/2024/q4/3)**
> *Sinan Doan (Oct 21)*
>
> thanks
>
>
>
> Vahagn Vardanian via dev <dev () nmap org>, 17 Eyl 2024 Sal, 18:59 tarihinde
>
> unu yazd:
>
>
> **[Re: NSConnection Probe](https://seclists.org/nmap-dev/2024/q4/2)**
> *Harrison Neal (Oct 11)*
>
> Apologies, it looks like the probe suggestion was cut off now that I
>
> re-read it.
>
>
>
> Probe TCP NSConnection\_rootProxy...
>
>
> **[NSConnection Probe](https://seclists.org/nmap-dev/2024/q4/1)**
> *Harrison Neal (Oct 11)*
>
> Good day,
>
>
>
> It appears that nmap doesn't currently recognize TCP-bound NSConnection (
>
> <https://developer.apple.com/documentation/foundation/nsconnection> ).
>
>
>
> Example server code:
>
>
>
> NSConnection \*a = [NSConnection connectionWithReceivePort:[[NSSocketPort
>
> alloc] init] sendPort:nil];
>
> [a setRootObject:[[NSObject alloc] init]];
>
> [a runInNewThread];
>
> [NSThread sleepForTimeInterval:300.0f];
>
>
>
> Example client code:
>
>
>
> NSLog(@"%@\n", [[NSConnection...
>
>
> **[NSE scripts for SNMPv3?](https://seclists.org/nmap-dev/2024/q4/0)**
> *Johan Kuuse (Oct 03)*
>
> Hi, my first mail to this list,
>
>
>
> I have used (and modified) quite a few NSE scripts for SNMP.
>
> Anyhow, AFAIK, all SNMP scripts (except "snmp-info") are limited to SNMPv1
>
> and SNMPv2c:
>
>
>
> nmap --script-help=snmp\* | grep -B3 -A1 -i v3
>
> ----------------------------------
>
> snmp-info
>
> Categories: default version safe
>
> <https://nmap.org/nsedoc/scripts/snmp-info.html>
>
> Extracts basic information from an SNMPv3 GET request. The same probe is
>
> used
>
> here...
>
>
>
> **[Nmap PR #2909](https://seclists.org/nmap-dev/2024/q3/13)**
> *Vahagn Vardanian via dev (Sep 17)*
>
> Hello there,
>
> My name is Vahagn, and I am the co-founder and CTO of RedRays.
>
> A few weeks ago, we created a pull request to Nmap Github to add a new
>
> check for detecting the most popular information disclosure in SAP systems.
>
>
>
> You can get list of SAp systems using this google dork: inurl:/irj/portal
>
> Thank you
>
>
> **[NPCAP 1.60 high CPU usage with pcap filter that does not pass anything (Win10)](https://seclists.org/nmap-dev/2024/q3/12)**
> *Vladimir Soldatov (Sep 17)*
>
> Hi guys,
>
>
>
> I've a setup (Win10, Intel X520, NPCAP 1.60) with relatively high traffic
>
> around 700 Mbit/s and I am trying to test the following cases:
>
> 1. Capture everything with empty pcap filter and just print stats with some
>
> period calculating captured data size
>
> 2. Capture nothing with an intentionally created filter that does not match
>
> the received traffic at all.
>
> 3. Capture some subset of traffic like 10%.
>
>
>
> In all the cases, CPU usage...
>
>
> **[[PATCH 1/1] Improved the legibility of `Makefile`](https://seclists.org/nmap-dev/2024/q3/11)**
> *Ariel Otilibili (Sep 17)*
>
> \* source files obtained by a wildcard
>
> \* headers and objects generated by differences.
>
>
>
> ```
>
> $ grep -P '(SRCS|HDRS|OBJS) =' Makefile.in | \
>
> sed -e 's/^export.\*= //g; s/\$.\*//g; s/OBJS = //' | \
>
> sed -ne '2p' | \
>
> tr ' ' '\n' | \
>
> sed -e 's/\.h//' | \
>
> sort -d | \
>
> grep -vP '^$' > headers
>
>
>
> $ grep -P '(SRCS|HDRS|OBJS) =' Makefile.in | \
>
> sed -e...
>
>
> **[[PATCH 0/1] Improved the legibility of Makefile](https://seclists.org/nmap-dev/2024/q3/10)**
> *Ariel Otilibili (Sep 17)*
>
> Hello committers,
>
>
>
> The same patch is on this PR: <https://github.com/nmap/nmap/pull/2938>
>
>
>
> Have a good weekend,
>
> Ariel
>
>
>
> Ariel Otilibili (1):
>
> Improved the legibility of `Makefile`
>
>
>
> Makefile.in | 14 +++-----------
>
> 1 file changed, 3 insertions(+), 11 deletions(-)
>
>
> **[How to make a minimal HTTPS request with ncat --ssl with explicit HTTP content?](https://seclists.org/nmap-dev/2024/q3/9)**
> *Ciro Santilli OurBigBook via dev (Sep 17)*
>
> Hello, I was trying for fun to make an HTTPS request with explicit hand-written HTTP content.
>
>
>
> Something analogous to:
>
>
>
> printf 'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n' | ncat example.com 80
>
>
>
> but for HTTPS. After Googling one of the tools that I found that seemed it might do the job was ncat from the nmap
>
> project, so I tried:
>
>
>
> printf 'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n' | ncat --ssl example.com 443
>
>
>
> an that works...
>
>
> **[[PATCH 1/1] Updated ALPN IDs](https://seclists.org/nmap-dev/2024/q3/8)**
> *Ariel Otilibili (Sep 15)*
>
> ```
>
> $ URL=<https://www.iana.org/assignments/tls-extensiontype-values/alpn-protocol-ids.csv>
>
> $ curl -sL ${URL} |
>
> perl -nE 'say $& if /(?<=\"\").\*(?=\"\")/' |
>
> sort > iana;
>
> < scripts/tls-alpn.nse perl -nE 'say $& if m!(?<=")[\w/\.\-]+(?=",)!' |
>
> sort > nmap.alpn;
>
> diff iana nmap.alpn | grep '<'
>
>
>
> < co
>
> < postgresql
>
>
>
> $ curl --silent ${URL} --output...

[![nmap-announce logo](/images/nmap-announce-logo.png)](/nmap-announce/)

**[Nmap Announce](/nmap-announce/)**  Moderated list for the most important new releases and announcements regarding the [Nmap Security Scanner](https://nmap.org) and related projects. We recommend that all Nmap users [subscribe to stay informed](https://nmap.org/mailman/listinfo/announce).

* [![Current period icon](/images/current-icon-16x16.png)Previous Year](/nmap-announce/2024/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/nmap-announce/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/nmap-announce.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://nmap.org/mailman/listinfo/announce)* [nmap-announceLatest Posts](/nmap-announce/)

> **[Nmap 7.95 released: OS and service detection signatures galore!](https://seclists.org/nmap-announce/2024/0)**
> *Gordon Fyodor Lyon (May 05)*
>
> Dear Nmap Community,
>
>
>
> I just arrived in San Francisco for the RSA conference and am delighted to
>
> announce our Nmap Version 7.95 release! I'm most excited that we finally
>
> tackled our backlog of OS and service detection fingerprint submissions.
>
> We're not talking about dozens or hundreds of them-we processed more than
>
> 6,500 fingerprints!
>
>
>
> For OS detection, we added 336 signatures, bringing the new total to 6,036.
>
> Additions include iOS 15...
>
>
>
> **[Npcap Celebrates its 10th Anniversary In Space!](https://seclists.org/nmap-announce/2023/1)**
> *Gordon Fyodor Lyon (Oct 05)*
>
> Dear Nmap community,
>
>
>
> Last month we celebrated Nmap's 26th birthday and today I'm happy to share
>
> another big milestone: Our Npcap driver for capturing and sending raw
>
> packets on Windows turned 10 this year! From humble beginnings as a
>
> security and modernization patch for the discontinued WinPcap project,
>
> Npcap has become an indispensable component for both Nmap and Wireshark.
>
> And it's used by hundreds of other software products and...
>
>
> **[Nmap 26th Birthday Announcement: Version 7.94](https://seclists.org/nmap-announce/2023/0)**
> *Gordon Fyodor Lyon (Sep 01)*
>
> Dear Nmap community,
>
>
>
> Today is Nmaps 26th birthday, which reminded me that I hadnt yet
>
> announced our Nmap 7.94 release from May. And its a great one! The biggest
>
> improvement was the Zenmap and Ndiff upgrades from the obsolete Python 2
>
> language to Python 3 on all platforms. Big thanks to Daniel Miller, Jakub
>
> Kulk, Brian Quigley, Sam James, Eli Schwartz, Romain Leonard, Varunram
>
> Ganesh, Pavel Zhukov, Carey Balboa, and Hasan Aliyev for...

[![fulldisclosure logo](/images/fulldisclosure-logo.png)](/fulldisclosure/)

**[Full Disclosure](/fulldisclosure/)**  A public, vendor-neutral forum for detailed discussion of vulnerabilities and exploitation techniques, as well as tools, papers, news, and events of interest to the community. The relaxed atmosphere of this quirky list provides some comic relief and certain industry gossip. More importantly, fresh vulnerabilities sometimes hit this list many hours or days before they pass through the Bugtraq moderation queue.

* [![Current period icon](/images/current-icon-16x16.png)Previous Month](/fulldisclosure/2024/Dec/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/fulldisclosure/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/fulldisclosure.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://nmap.org/mailman/listinfo/fulldisclosure)* [fulldisclosureLatest Posts](/fulldisclosure/)

> **[Multiple vulnerabilities in CTFd versions <= 3.7.4](https://seclists.org/fulldisclosure/2024/Dec/21)**
> *Blazej Adamczyk (Dec 30)*
>
> 
>
> Multiple vulnerabilities in CTFd versions <= 3.7.4
>
> 
>
>
>
> 1 General information
>
> ...
>
>
> **[IBMi Navigator / CVE-2024-51464 / HTTP Security Token Bypass](https://seclists.org/fulldisclosure/2024/Dec/20)**
> *hyp3rlinx (Dec 30)*
>
> [+] Credits: John Page (aka hyp3rlinx)
>
> [+] Website: hyp3rlinx.altervista.org
>
> [+] Source: <https://hyp3rlinx.altervista.org/advisories/IBMi_Navigator_HTTP_Security_Token_Bypass-CVE-2024-51464.txt>
>
> [+] x.com/hyp3rlinx
>
> [+] ISR: ApparitionSec
>
>
>
> [Vendor]www.ibm.com
>
>
>
> [Product]
>
> Navigator for i is a Web console interface where you can perform the
>
> key tasks to administer your IBM i.
>
> IBM Navigator for i supports the vast majority of tasks that were...
>
>
> **[IBMi Navigator / CVE-2024-51463 / Server Side Request Forgery (SSRF)](https://seclists.org/fulldisclosure/2024/Dec/19)**
> *hyp3rlinx (Dec 30)*
>
> [+] Credits: John Page (aka hyp3rlinx)
>
> [+] Website: hyp3rlinx.altervista.org
>
> [+] Source: <https://hyp3rlinx.altervista.org/advisories/IBMi_Navigator_Server_Side_Request_Forgery_CVE-2024-51463.txt>
>
> [+] x.com/hyp3rlinx
>
> [+] ISR: ApparitionSec
>
>
>
> [Vendor]www.ibm.com
>
>
>
> [Product]
>
> Navigator for i is a Web console interface where you can perform the
>
> key tasks to administer your IBM i.
>
> IBM Navigator for i supports the vast majority of tasks that...
>
>
> **[CyberDanube Security Research 20241219-0 | Authenticated Remote Code Execution in Ewon Flexy 205](https://seclists.org/fulldisclosure/2024/Dec/18)**
> *Thomas Weber | CyberDanube via Fulldisclosure (Dec 21)*
>
> CyberDanube Security Research 20241219-0
>
> -------------------------------------------------------------------------------
>
> title| Authenticated Remote Code Execution
>
> product| Ewon Flexy 205
>
> vulnerable version| <= v14.8s0 (#2633)
>
> fixed version| -
>
> CVE number| CVE-2024-9154
>
> impact| High
>
> homepage| <https://www.hms-networks.com/>
>
> found| 2024-09-03...
>
>
> **[Stored XSS with Filter Bypass - blogenginev3.3.8](https://seclists.org/fulldisclosure/2024/Dec/17)**
> *Andrey Stoykov (Dec 18)*
>
> # Exploit Title: Stored XSS with Filter Bypass - blogenginev3.3.8
>
> # Date: 12/2024
>
> # Exploit Author: Andrey Stoykov
>
> # Version: 3.3.8
>
> # Tested on: Ubuntu 22.04
>
> # Blog:
>
> <https://msecureltd.blogspot.com/2024/12/friday-fun-pentest-series-16-stored-xss.html>
>
>
>
> Stored XSS Filter Bypass #1:
>
>
>
> Steps to Reproduce:
>
>
>
> 1. Login as admin and go to "Content" > "Posts"
>
> 2. On the right side of the page choose "Categories"
>
> 3. In...
>
>
> **[[SYSS-2024-085]: Broadcom CA Client Automation - Improper Privilege Management (CWE-269)](https://seclists.org/fulldisclosure/2024/Dec/16)**
> *Matthias Deeg via Fulldisclosure (Dec 18)*
>
> Advisory ID: SYSS-2024-085
>
> Product: CA Client Automation (CA DSM)
>
> Manufacturer: Broadcom
>
> Affected Version(s): 14.5.0.15
>
> Tested Version(s): 14.5.0.15
>
> Vulnerability Type: Improper Privilege Management (CWE-269)
>
> Risk Level: High
>
> Solution Status: Fixed
>
> Manufacturer Notification: 2024-10-18
>
> Solution Date: 2024-12-17
>
> Public Disclosure:...
>
>
> **[[KIS-2024-07] GFI Kerio Control <= 9.4.5 Multiple HTTP Response Splitting Vulnerabilities](https://seclists.org/fulldisclosure/2024/Dec/15)**
> *Egidio Romano (Dec 16)*
>
> ---------------------------------------------------------------------------
>
> GFI Kerio Control <= 9.4.5 Multiple HTTP Response Splitting Vulnerabilities
>
> ---------------------------------------------------------------------------
>
>
>
> [-] Software Links:
>
>
>
> <https://gfi.ai/products-and-solutions/network-security-solutions/keriocontrol>
>
> <http://download.kerio.com>
>
>
>
> [-] Affected Versions:
>
>
>
> All versions from 9.2.5 to 9.4.5.
>
>
>
> [-] Vulnerabilities Description:...
>
>
> **[RansomLordNG - anti-ransomware exploit tool](https://seclists.org/fulldisclosure/2024/Dec/14)**
> *malvuln (Dec 16)*
>
> This next generation version dumps process memory of the targeted
>
> Malware prior to termination The process memory dump file MalDump.dmp
>
> varies in size and can be 50 MB plus RansomLord now intercepts and
>
> terminates ransomware from 54 different threat groups Adding GPCode,
>
> DarkRace, Snocry, Hydra and Sage to the ever growing victim list.
>
>
>
> Lang: C
>
> SHA256: fcb259471a4a7afa938e3aa119bdff25620ae83f128c8c7d39266f410a7ec9aa
>
>
>
> RansomLordNG leverages code...
>
>
> **[APPLE-SA-12-11-2024-9 Safari 18.2](https://seclists.org/fulldisclosure/2024/Dec/13)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-9 Safari 18.2
>
>
>
> Safari 18.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121846>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> Safari
>
> Available for: macOS Ventura and macOS Sonoma
>
> Impact: On a device with Private Relay enabled, adding a website to the
>
> Safari...
>
>
> **[APPLE-SA-12-11-2024-8 visionOS 2.2](https://seclists.org/fulldisclosure/2024/Dec/12)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-8 visionOS 2.2
>
>
>
> visionOS 2.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121845>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> Crash Reporter
>
> Available for: Apple Vision Pro
>
> Impact: An app may be able to access sensitive user data
>
> Description: A permissions...
>
>
> **[APPLE-SA-12-11-2024-7 tvOS 18.2](https://seclists.org/fulldisclosure/2024/Dec/11)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-7 tvOS 18.2
>
>
>
> tvOS 18.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121844>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> AppleMobileFileIntegrity
>
> Available for: Apple TV HD and Apple TV 4K (all models)
>
> Impact: A malicious app may be able to access private...
>
>
> **[APPLE-SA-12-11-2024-6 watchOS 11.2](https://seclists.org/fulldisclosure/2024/Dec/10)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-6 watchOS 11.2
>
>
>
> watchOS 11.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121843>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> AppleMobileFileIntegrity
>
> Available for: Apple Watch Series 6 and later
>
> Impact: A malicious app may be able to access private...
>
>
> **[APPLE-SA-12-11-2024-5 macOS Ventura 13.7.2](https://seclists.org/fulldisclosure/2024/Dec/9)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-5 macOS Ventura 13.7.2
>
>
>
> macOS Ventura 13.7.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121842>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> Apple Software Restore
>
> Available for: macOS Ventura
>
> Impact: An app may be able to access user-sensitive data...
>
>
> **[APPLE-SA-12-11-2024-4 macOS Sonoma 14.7.2](https://seclists.org/fulldisclosure/2024/Dec/8)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-4 macOS Sonoma 14.7.2
>
>
>
> macOS Sonoma 14.7.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121840>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> Apple Software Restore
>
> Available for: macOS Sonoma
>
> Impact: An app may be able to access user-sensitive data
>
> Description:...
>
>
> **[APPLE-SA-12-11-2024-3 macOS Sequoia 15.2](https://seclists.org/fulldisclosure/2024/Dec/7)**
> *Apple Product Security via Fulldisclosure (Dec 12)*
>
> APPLE-SA-12-11-2024-3 macOS Sequoia 15.2
>
>
>
> macOS Sequoia 15.2 addresses the following issues.
>
> Information about the security content is also available at
>
> <https://support.apple.com/121839>.
>
>
>
> Apple maintains a Security Releases page at
>
> <https://support.apple.com/100100> which lists recent
>
> software updates with security advisories.
>
>
>
> Apple Software Restore
>
> Available for: macOS Sequoia
>
> Impact: An app may be able to access user-sensitive data
>
> Description:...

## Other Excellent Security Lists

[![bugtraq logo](/images/bugtraq-logo.png)](/bugtraq/)

**[Bugtraq](/bugtraq/)**  The premier general security mailing list. Vulnerabilities are often announced here first, so check frequently!

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/bugtraq/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/bugtraq.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/1/description)

[![basics logo](/images/basics-logo.png)](/basics/)

**[Security Basics](/basics/)**  A high-volume list which permits people to ask "stupid questions" without being derided as "n00bs". I recommend this list to network security newbies, but be sure to read Bugtraq and other lists as well.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/basics/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/basics.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/105/description)

[![pen-test logo](/images/pen-test-logo.png)](/pen-test/)

**[Penetration Testing](/pen-test/)**  While this list is intended for "professionals", participants frequenly disclose techniques and strategies that would be useful to anyone with a practical interest in security and network auditing.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/pen-test/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/pen-test.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/101/description)

[![isn logo](/images/isn-logo.png)](/isn/)

**[Info Security News](/isn/)**  Carries news items (generally from mainstream sources) that relate to security.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/isn/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/isn.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.infosecnews.org/)

[![firewall-wizards logo](/images/firewall-wizards-logo.png)](/firewall-wizards/)

**[Firewall Wizards](/firewall-wizards/)**  Tips and tricks for firewall administrators

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/firewall-wizards/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/firewall-wizards.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://listserv.icsalabs.com/mailman/listinfo/firewall-wizards)

[![focus-ids logo](/images/focus-ids-logo.png)](/focus-ids/)

**[IDS Focus](/focus-ids/)**  Technical discussion about Intrusion Detection Systems. You can also read the archives of a [previous IDS list](https://seclists.org/ids/)

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/focus-ids/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/focus-ids.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/96/description)

[![webappsec logo](/images/webappsec-logo.png)](/webappsec/)

**[Web App Security](/webappsec/)**  Provides insights on the unique challenges which make web applications notoriously hard to secure, as well as attack methods including SQL injection, cross-site scripting (XSS), cross-site request forgery, and more.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/webappsec/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/webappsec.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/107/description)

[![dailydave logo](/images/dailydave-logo.png)](/dailydave/)

**[Daily Dave](/dailydave/)**  This technical discussion list covers vulnerability research, exploit development, and security events/gossip. It was started by [ImmunitySec](http://www.immunitysec.com/) founder Dave Aitel and many security luminaries participate. Many posts simply advertise Immunity products, but you can't really fault Dave for being self-promotional on a list named DailyDave.

* [![Current period icon](/images/current-icon-16x16.png)Current Quarter](/dailydave/2025/q1/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/dailydave/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/dailydave.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://lists.immunityinc.com/mailman/listinfo/dailydave)* [dailydaveLatest Posts](/dailydave/)

> **[Re: (the root of the root and the bud of the bud)](https://seclists.org/dailydave/2025/q1/5)**
> *Sean Heelan via Dailydave (Jan 13)*
>
> As it happens, Ive found the most effective way to use LLMs is to de-anthropomorphise them entirely and treat them
>
> very like fuzzers (large scale generation of results, lots of false positives/nonsense, filtered by some oracle).
>
>
>
> The conversation with an AI approach where you imagine yourself as having a single artificial brain to interact with
>
> is (currently at least) practically far less useful than one in which you are content with...
>
>
> **[Anthropological "Hacker" Map](https://seclists.org/dailydave/2025/q1/4)**
> *A K via Dailydave (Jan 13)*
>
> Hi all,
>
>
>
> In the latest "Security Weekly" (<https://www.youtube.com/watch?v=CXefYdEGW04>
>
> )
>
> they present the Anthropological "Hacker" Map
>
> <https://wherewarlocksstayuplate.com/map/>
>
>
>
> While the map is incomplete (how can it ever be complete?), I think it is
>
> one of the few times, outside of David Aitel's writings about the cross-cut
>
> between the "underground" (for a lack of a better term) and subsequent
>
> commercial...
>
>
> **[Re: (the root of the root and the bud of the bud)](https://seclists.org/dailydave/2025/q1/3)**
> *Don A. Bailey via Dailydave (Jan 12)*
>
> I designed one of the first working fuzzers (albeit unintentionally) back
>
> in the late 90's. I don't remember if I published it, but I still have the
>
> code. It, however, worked - badly - but it worked. I was heavily flamed,
>
> however, because as you stated - it was not hip. It only attacked
>
> environment variable and command-line argument based vulnerabilities. But,
>
> in the 90's and early 00's, we had no shortage of local suid-based...
>
>
> **[Re: (the root of the root and the bud of the bud)](https://seclists.org/dailydave/2025/q1/2)**
> *Thomas Dullien via Dailydave (Jan 12)*
>
> Hey,
>
>
>
> I have one quibble: We are using "reasoning" in a qualitative, not
>
> descriptive, form here -- "fuzzing is or is not reasoning", "LLMs reason or
>
> do not reason". I am not sure this is helpful. Fuzzing is empirically
>
> successful at finding crashes. Somebody that needs to light a fire and
>
> smashes two stones together until they throw sparks does not, once the fire
>
> burns, need to justify that 'stones perform...
>
>
> **[Re: (the root of the root and the bud of the bud)](https://seclists.org/dailydave/2025/q1/1)**
> *Darren Bounds via Dailydave (Jan 12)*
>
> Everything old is new and the way we reason is the same way LLMs reason. It's
>
> not about looking for the same problem the same way it's about going to
>
> searchingfor that flaw the same way with unlimited (nearly) resources.
>
>
>
> Traditional human-led vulnerability research and discovery is, today, a short
>
> lived venture.
>
>
>
> Things will change very rapidly over the coming 24 months.
>
>
>
> Memories and thoughts are the same thing, someone tried to...
>
>
> **[(the root of the root and the bud of the bud)](https://seclists.org/dailydave/2025/q1/0)**
> *Dave Aitel via Dailydave (Jan 11)*
>
> Memories and thoughts are the same thing, someone tried to explain to me
>
> recently. You have to think to remember, in other words. This is hard to
>
> grasp for a lot of people because they \*think \*they have \*memories\*. They
>
> wrongly think memory is a noun instead of a verb, which is ok in philosophy
>
> and psychology but in cutting edge computer science we have to be precise
>
> about these sorts of things.
>
>
>
> Twenty-five years ago, when I first started...
>
>
>
> **[the endless stream](https://seclists.org/dailydave/2024/q4/3)**
> *Dave Aitel via Dailydave (Dec 31)*
>
> I've seen great people in our industry crushed under the weight of the
>
> secrets they carry into a singularity from which no information can emerge.
>
> In some ways the lesson from apache\_nosejob.c
>
> <<https://www.exploit-db.com/exploits/21560>> was that we cannot take
>
> ourselves seriously, that at the heart of our discipline there must remain
>
> a jester, that we must float upon the stream of endless information rather
>
> than absorb it into our...
>
>
> **[Hacking the Edges of Knowledge: LLMs, Vulnerabilities, and the Quest for Understanding](https://seclists.org/dailydave/2024/q4/2)**
> *Dave Aitel via Dailydave (Nov 02)*
>
> [image: image.png]
>
>
>
> It's impossible not to notice that we live in an age of technological
>
> wonders, stretching back to the primitive hominids who dared to ask "Why?"
>
> but also continually accelerating and pulling everything apart while it
>
> does, in the exact same manner as the Universe at large. It is why all the
>
> hackers you know are invested so heavily in Deep Learning right now, as if
>
> someone got on a megaphone at Chaos...
>
>
> **[Old Infosec Talks: Metlstorm's Take on Hacky Hacking](https://seclists.org/dailydave/2024/q4/1)**
> *Dave Aitel via Dailydave (Oct 31)*
>
> The Anatomy of Compromise
>
>
>
> One of my demented hobbies is watching old infosec talks and then seeing
>
> how well they hold up to modern times. Recently I excavated Metlstorm's
>
> 2017 BSides Canberra
>
> <<https://www.youtube.com/watch?v=OjgvP9UB9GI&list=TLGGvAY1CcIr-AcyNjEwMjAyNA>>
>
> talk on "How people get hacked" - a pretty generic topic that gives a lot
>
> of room for opinion, and one a lot of people have opined on, but the talk
>
> itself...
>
>
> **[Grace Hopper and the Rebirth of US Conferences](https://seclists.org/dailydave/2024/q4/0)**
> *Dave Aitel via Dailydave (Oct 10)*
>
> I spent some time watching all the Grace Hopper videos on the youtubes, as
>
> I prepared for what up North is a horrible storm, but here in Miami is, so
>
> far, a breezy and clear day. You can hear her talk about how subroutines
>
> used to be literal handwritten pages of instructions in notebooks. When you
>
> wanted SIN or COS you would go over to whoever had the notebook with the
>
> working version, and copy it out into your code.
>
>
>
> It was this experience that...

[![pauldotcom logo](/images/pauldotcom-logo.png)](/pauldotcom/)

**[PaulDotCom](/pauldotcom/)**  General discussion of security news, research, vulnerabilities, and the PaulDotCom Security Weekly podcast.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/pauldotcom/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/pauldotcom.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://mail.pauldotcom.com/cgi-bin/mailman/listinfo/pauldotcom)

[![honeypots logo](/images/honeypots-logo.png)](/honeypots/)

**[Honeypots](/honeypots/)**  Discussions about tracking attackers by setting up decoy honeypots or entire [honeynet](http://www.honeynet.org) networks.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/honeypots/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/honeypots.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securityfocus.com/archive/119/description)

[![microsoft logo](/images/microsoft-logo.png)](/microsoft/)

**[Microsoft Sec Notification](/microsoft/)**  Beware that MS often uses these security bulletins as marketing propaganda to downplay serious vulnerabilities in their productsnote how most have a prominent and often-misleading "mitigating factors" section.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/microsoft/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/microsoft.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.microsoft.com/technet/security/bulletin/notify.mspx)

[![funsec logo](/images/funsec-logo.png)](/funsec/)

**[Funsec](/funsec/)**  While most security lists ban off-topic discussion, Funsec is a haven for free community discussion and enjoyment of the lighter, more humorous side of the security community

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/funsec/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/funsec.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://linuxbox.org/cgi-bin/mailman/listinfo/funsec)

[![cert logo](/images/cert-logo.png)](/cert/)

**[CERT Advisories](/cert/)**  The [Computer Emergency Response Team](http://www.cert.org/) has been responding to security incidents and sharing vulnerability information since the Morris Worm hit in 1986. This archive combines their technical security alerts, tips, and current activity lists.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/cert/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/cert.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.us-cert.gov/cas/signup.html)* [certLatest Posts](/cert/)

> **[Apple Releases Security Updates for Multiple Products](https://seclists.org/cert/2023/3)**
> *CISA (Mar 28)*
>
> Cybersecurity and Infrastructure Security Agency (CISA) - Defend Today, Secure Tomorrow
>
>
>
> You are subscribed to Cybersecurity Advisories for Cybersecurity and Infrastructure Security Agency. This information
>
> has recently been updated and is now available.
>
>
>
> Apple Releases Security Updates for Multiple Products [
>
> <https://www.cisa.gov/news-events/alerts/2023/03/28/apple-releases-security-updates-multiple-products> ] 03/28/2023 01:00
>
> PM EDT
>
>
>
> Apple...
>
>
> **[CISA Releases Six Industrial Control Systems Advisories](https://seclists.org/cert/2023/2)**
> *CISA (Mar 23)*
>
> Cybersecurity and Infrastructure Security Agency (CISA) - Defend Today, Secure Tomorrow
>
>
>
> You are subscribed to Cybersecurity Advisories for Cybersecurity and Infrastructure Security Agency. This information
>
> has recently been updated, and is now available.
>
>
>
> CISA Releases Six Industrial Control Systems Advisories [
>
> <https://www.cisa.gov/news-events/alerts/2023/03/23/cisa-releases-six-industrial-control-systems-advisories> ] 03/23/2023
>
> 08:00 AM EDT...
>
>
> **[CISA Releases Eight Industrial Control Systems Advisories](https://seclists.org/cert/2023/1)**
> *CISA (Mar 21)*
>
> Cybersecurity and Infrastructure Security Agency (CISA) - Defend Today, Secure Tomorrow
>
>
>
> You are subscribed to Cybersecurity Advisories for Cybersecurity and Infrastructure Security Agency. This information
>
> has recently been updated, and is now available.
>
>
>
> CISA Releases Eight Industrial Control Systems Advisories [
>
> <https://www.cisa.gov/news-events/alerts/2023/03/21/cisa-releases-eight-industrial-control-systems-advisories> ]
>
> 03/21/2023 08:00 AM...
>
>
> **[CISA and NSA Release Enduring Security Framework Guidance on Identity and Access Management](https://seclists.org/cert/2023/0)**
> *CISA (Mar 21)*
>
> Cybersecurity and Infrastructure Security Agency (CISA) - Defend Today, Secure Tomorrow
>
>
>
> You are subscribed to Cybersecurity Advisories for Cybersecurity and Infrastructure Security Agency. This information
>
> has recently been updated, and is now available.
>
>
>
> CISA and NSA Release Enduring Security Framework Guidance on Identity and Access Management [...

[![oss-sec logo](/images/oss-sec-logo.png)](/oss-sec/)

**[Open Source Security](/oss-sec/)**  Discussion of security flaws, concepts, and practices in the Open Source community

* [![Current period icon](/images/current-icon-16x16.png)Current Quarter](/oss-sec/2025/q1/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/oss-sec/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/oss-sec.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://oss-security.openwall.org/wiki/mailing-lists/oss-security)* [oss-secLatest Posts](/oss-sec/)

> **[git: 2 vulnerabilities fixed](https://seclists.org/oss-sec/2025/q1/17)**
> *Johannes Schindelin (Jan 14)*
>
> Team,
>
>
>
> The Git project released new security bug-fix versions today, January
>
> 14th, 2025: v2.48.1, v2.47.1, v2.46.3, v2.45.3, v2.44.3, v2.43.6, v2.42.4,
>
> v2.41.3, and v2.40.4.
>
>
>
> The addressed issues are:
>
>
>
> - CVE-2024-50349:
>
>
>
> Printing unsanitized URLs when asking for credentials makes the user
>
> susceptible to crafted URLs (e.g. in recursive clones). These URLs
>
> can mislead the user into typing in passwords for trusted sites that...
>
>
> **[RSYNC: 6 vulnerabilities](https://seclists.org/oss-sec/2025/q1/16)**
> *Nick Tait (Jan 14)*
>
> Hello OSS-security,
>
>
>
> Two independent groups of researchers have identified a total of 6
>
> vulnerabilities in rsync. In the most severe CVE, an attacker only requires
>
> anonymous read access to a rsync server, such as a public mirror, to
>
> execute arbitrary code on the machine the server is running on.
>
>
>
> Upstream has prepared patches for these CVEs. These fixes will be included
>
> in rsync 3.4.0 which is to be released shortly.
>
>
>
> CVE Details:
>
> [1] Heap Buffer...
>
>
> **[CVE-2024-56374: Django: Potential denial-of-service vulnerability in IPv6 validation](https://seclists.org/oss-sec/2025/q1/15)**
> *Natalia Bidart (Jan 14)*
>
> <https://www.djangoproject.com/weblog/2025/jan/14/security-releases/>
>
>
>
> In accordance with `our security release policy
>
> <<https://docs.djangoproject.com/en/dev/internals/security/>>`\_, the Django
>
> team
>
> is issuing releases for
>
> `Django 5.1.5 <<https://docs.djangoproject.com/en/dev/releases/5.1.5/>>`\_,
>
> `Django 5.0.11 <<https://docs.djangoproject.com/en/dev/releases/5.0.11/>>`\_,
>
> and
>
> `Django 4.2.18 <...
>
>
> **[CVE-2024-45627: Apache Linkis Metadata Query Service JDBC: JDBC Datasource Module with Mysql has file read vulnerability](https://seclists.org/oss-sec/2025/q1/14)**
> *Heping Wang (Jan 14)*
>
> Severity: important
>
>
>
> Affected versions:
>
>
>
> - Apache Linkis Metadata Query Service JDBC 1.5.0 before 1.7.0
>
>
>
> Description:
>
>
>
> In Apache Linkis <1.7.0, due to the lack of effective filtering
>
> of parameters, an attacker configuring malicious Mysql JDBC parameters in the DataSource Manager Module will
>
>
>
> allow the attacker to read arbitrary files from the Linkis server. Therefore, the parameters in the Mysql JDBC URL
>
> should be blacklisted. This attack...
>
>
> **[CVE-2025-22828: Apache CloudStack: Unauthorised access to annotations](https://seclists.org/oss-sec/2025/q1/13)**
> *Nux (Jan 13)*
>
> Severity: Low
>
>
>
> Affected versions:
>
>
>
> - Apache CloudStack 4.16.0 or later
>
>
>
> Description:
>
>
>
> CloudStack users can add and read comments (annotations) on resources they are authorised to access.
>
>
>
> Due to an access validation issue that affects Apache CloudStack versions from 4.16.0, users who have access, prior
>
> access or knowledge of resource UUIDs can list and add comments (annotations) to such resources.
>
>
>
> An attacker with a user-account and access...
>
>
> **[[vim-security] heap-buffer-overflow in Vim < 9.1.1003](https://seclists.org/oss-sec/2025/q1/12)**
> *Christian Brabandt (Jan 11)*
>
> heap-buffer-overflow with visual mode in Vim < 9.1.1003
>
> =======================================================
>
> Date: 11.01.2025
>
> Severity: Medium
>
> CVE: CVE-2025-22134
>
> CWE: Heap-based Buffer Overflow (CWE-122)
>
>
>
> When switching to other buffers using the :all command and visual mode
>
> still being active, this may cause a heap-buffer overflow, because Vim
>
> does not properly end visual mode and therefore may try to access
>
> beyond the end of a line in a...
>
>
> **["/bin/sh: The Biggest Unix Security Loophole" paper from 1984](https://seclists.org/oss-sec/2025/q1/11)**
> *Alan Coopersmith (Jan 08)*
>
> The Unix Historical Society has recently received and shared a copy
>
> of a Bell Labs technical report from 1984 by James Allen titled
>
> "/bin/sh: The Biggest Unix Security Loophole" - the scanned doc is at:
>
> <https://www.tuhs.org/Archive/Documentation/TechReports/Bell_Labs/ReedsShellHoles.pdf>
>
>
>
> While this report reveals no real surprises 40 years later, it's conclusion
>
> is advice that wouldn't sound out of place today:
>
>
>
> Setuid...
>
>
> **[CVE-2024-45033: Apache Airflow Fab Provider: Application does not invalidate session after password change via Airflow cli](https://seclists.org/oss-sec/2025/q1/10)**
> *Elad Kalif (Jan 08)*
>
> Severity: low
>
>
>
> Affected versions:
>
>
>
> - Apache Airflow Fab Provider before 1.5.2
>
>
>
> Description:
>
>
>
> Insufficient Session Expiration vulnerability in Apache Airflow Fab Provider.
>
>
>
> This issue affects Apache Airflow Fab Provider: before 1.5.2.
>
>
>
> When user password has been changed with admin CLI, the sessions for that user have not been cleared, leading to
>
> insufficient session expiration, thus logged users could continue to be logged in even after the...
>
>
> **[CVE-2024-54676: Apache OpenMeetings: Deserialisation of untrusted data in cluster mode](https://seclists.org/oss-sec/2025/q1/9)**
> *Maxim Solodovnik (Jan 07)*
>
> Severity: important
>
>
>
> Affected versions:
>
>
>
> - Apache OpenMeetings 2.1 before 8.0.0
>
>
>
> Description:
>
>
>
> Vendor: The Apache Software Foundation
>
>
>
> Versions Affected: Apache OpenMeetings from 2.1.0 before 8.0.0
>
>
>
> Description: Default clustering instructions at <https://openmeetings.apache.org/Clustering.html> doesn't specify
>
> white/black lists for OpenJPA this leads to possible deserialisation of untrusted data.
>
> Users are recommended to upgrade to...
>
>
> **[Re: Linux: general protection fault in \_\_vmx\_vcpu\_run with nested virtualization](https://seclists.org/oss-sec/2025/q1/8)**
> *Solar Designer (Jan 07)*
>
> Hi,
>
>
>
> Thank you very much for bringing this to oss-security (as it also was on
>
> linux-distros).
>
>
>
> I assume you identified this commit by bisecting?
>
>
>
> Do you know / can explain how your PoC triggers this bug? Where does
>
> the POP SS instruction come from?
>
>
>
> Also, in another message (not CC'ed to you) Demi Marie Obenour asked:
>
> "Is this exploitable for anything other than denial of service?"
>
>
>
> The corresponding mainline commit is:
>
>
>
> commit...
>
>
> **[Re: Linux: general protection fault in \_\_vmx\_vcpu\_run with nested virtualization](https://seclists.org/oss-sec/2025/q1/7)**
> *Demi Marie Obenour (Jan 06)*
>
> Is this exploitable for anything other than denial of service?
>
>
> **[Re: Linux: general protection fault in \_\_vmx\_vcpu\_run with nested virtualization](https://seclists.org/oss-sec/2025/q1/6)**
> *Greg KH (Jan 06)*
>
> For those wanting to understand this, that means that any kernel version
>
> from release of:
>
> 3.17
>
> to the following releases:
>
> 4.9.331 4.14.296 4.19.262 5.4.220 5.10.150 5.15.75 5.19.17 6.0.3 6.1
>
> is vulnerable, and anything newer than that (i.e. any kernel newer than
>
> August of 2022) is just fine.
>
>
>
> Hopefully everyone here is running a kernel newer than August of 2022,
>
> but hey, who knows!
>
>
>
> hope this helps,
>
>
>
> greg k-h
>
>
> **[Linux: general protection fault in \_\_vmx\_vcpu\_run with nested virtualization](https://seclists.org/oss-sec/2025/q1/5)**
> *Linfeng Sun (Jan 06)*
>
> Hello list,
>
>
>
> A bug has been detected in the Linux kernel's nested virtualization implementation, which
>
> can lead to a general protection fault in \_\_vmx\_vcpu\_run when running a higher
>
> version L1 hypervisor kernel on an L0 host kernel version predating the following
>
> commit: <https://github.com/torvalds/linux/commit/45779be5ced626db836e612e0dc638a1601abcf2>
>
>
>
> The issue can be reproduced by running the provided PoC in the L1 environment as a user...
>
>
> **[Re: Xen Security Advisory 466 v3 (CVE-2024-53241) - Xen hypercall page unsafe against speculative attacks](https://seclists.org/oss-sec/2025/q1/4)**
> *Solar Designer (Jan 04)*
>
> Hi,
>
>
>
> As oss-security moderator, I let this thread through up to and including
>
> the message below, but not beyond, as further discussion went too far
>
> into Xen development specifics. Those interested in further replies may
>
> see them e.g. here:
>
>
>
> <https://lists.xenproject.org/archives/html/xen-devel/2025-01/threads.html#00015>
>
>
>
> Alexander
>
>
> **[Re: Xen Security Advisory 466 v3 (CVE-2024-53241) - Xen hypercall page unsafe against speculative attacks](https://seclists.org/oss-sec/2025/q1/3)**
> *Jrgen Gro (Jan 04)*
>
> The downside of this approach would be to have another variant to do
>
> hypercalls. So you'd have to replace the variant being able to use AMD
>
> or INTEL specific instructions with a function doing the hypercall via
>
> the hypercall page.
>
>
>
> I'm planning to send patches for Xen and the kernel to add CPUID feature
>
> bits indicating which instruction to use. This will make life much easier.
>
>
>
> I'm seeing potential problems with that approach when...

[![securecoding logo](/images/securecoding-logo.png)](/securecoding/)

**[Secure Coding](/securecoding/)**  The Secure Coding list (SC-L) is an open forum for the discussion on developing secure applications. It is moderated by the authors of [Secure Coding: Principles and Practices](http://www.amazon.com/dp/0596002424?tag=secbks-20).

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/securecoding/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/securecoding.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.securecoding.org/list/)

[![educause logo](/images/educause-logo.png)](/educause/)

**[Educause Security Discussion](/educause/)**  Securing networks and computers in an academic environment.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/educause/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/educause.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.educause.edu/groups/security)

## Internet Issues and Infrastructure

[![nanog logo](/images/nanog-logo.png)](/nanog/)

**[NANOG](/nanog/)**  The [North American Network Operators' Group](http://www.nanog.org/) discusses fundamental Internet infrastructure issues such as routing, IP address allocation, and containing malicious activity.

* [![Current period icon](/images/current-icon-16x16.png)Current Month](/nanog/2025/Jan/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/nanog/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/nanog.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.nanog.org/mailinglist/)* [nanogLatest Posts](/nanog/)

> **[View N93 Agenda, 2nd Keynote Speaker Announced + More!](https://seclists.org/nanog/2025/Jan/83)**
> *Nanog News (Jan 14)*
>
> \*\*\* NANOG 93 Agenda is Available!\*
>
> ------------------------------------------------------------
>
> \*Sync Your Calendar + View Full Schedule Now\*
>
>
>
> Explore the full schedule for NANOG 93. Add talks directly to your calendar
>
> to stay on track and never miss a session.
>
>
>
> \*SEE AGENDA\* <<https://nanog.org/events/nanog-93/agenda/>>(
>
> <https://nanog.org/events/nanog-93/agenda/>)
>
>
>
> \*\*\* Robohn Joins N93 as a Keynote Speaker!\*...
>
>
> **[Re: Free pass NANOG](https://seclists.org/nanog/2025/Jan/82)**
> *Ilissa Miller (Jan 14)*
>
> Thank you for your very generous offer for this very important community. I
>
> hope there are people on this list that take you up on it - very kind!
>
>
> **[Re: Free pass NANOG](https://seclists.org/nanog/2025/Jan/81)**
> *Tom Beecher (Jan 14)*
>
> Well if you purchased them, then of course yours to do with what you wish.
>
>
> **[Re: Free pass NANOG](https://seclists.org/nanog/2025/Jan/80)**
> *Lu Heng (Jan 13)*
>
> Hi
>
>
>
> I am a capitalist and philanthropist who doesnt believe in central
>
> distribution. So, no thanks.
>
>
>
> I will give to the person in need myself.
>
>
>
> And those passes arent given, I purchased them.
>
>
>
> For those need help I still have few left, PM me.
>
>
> **[Re: Free pass NANOG](https://seclists.org/nanog/2025/Jan/79)**
> *Christopher Hawker (Jan 13)*
>
> Lu,
>
>
>
> As @Tom<mailto:beecher () beecher cc> said, you'd be better off handing them back to your NANOG rep who can then
>
> allocate them to people who need it. They would be in the best position to allocate them where they may be needed, i.e.
>
> sponsoring someone to attend who otherwise may not have the capacity to purchase a ticket.
>
>
>
> Regards,
>
> Christopher Hawker
>
> \_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_\_
>
> From: NANOG...
>
>
> **[NANOG 93 - Atlanta](https://seclists.org/nanog/2025/Jan/78)**
> *jblack (Jan 13)*
>
> NANOG 93 <<https://nanog.org/events/nanog-93/>> in Atlanta is a few weeks
>
> away. The Program Committee has put together some great content. AI and
>
> Automation are Keynote topics. Tutorials and Workshops will cover AI,
>
> Automation and Whiteboarding too! The agenda has been posted so have a look
>
> (NANOG | Agenda <<https://nanog.org/events/nanog-93/agenda/>> ), register
>
> (Register <<https://nanog.org/events/nanog-93/register/>> ) and...
>
>
> **[Re: Level3 4.2.2.1 and 4.2.2.2 not responding to pings, DNS queries work](https://seclists.org/nanog/2025/Jan/77)**
> *Justin Krejci (Jan 13)*
>
> A tangent came to mind while reading over this thread: Google has a similar feature to aid in troubleshooting.
>
> <https://redirector.googlevideo.com/report_mapping>
>
> It will indicate which YouTube node/cluster your current IP prefix is currently served by; I have found this to be
>
> helpful in the past.
>
>
>
> -----Original Message-----
>
> From: nanog--- via NANOG <nanog () nanog org<mailto:nanog---%20via%20NANOG%20%3cnanog () nanog org%3e>>...
>
>
> **[Re: Level3 4.2.2.1 and 4.2.2.2 not responding to pings, DNS queries work](https://seclists.org/nanog/2025/Jan/76)**
> *nanog--- via NANOG (Jan 13)*
>
> Dans not here, man! But Im glad to spread the word so it can help more people in their troubleshoot efforts.
>
>
>
> -T
>
>
> **[Re: ARIN Online update to provide auto-managed IRR objects for RPKI ROAs (Fwd: [arin-announce] New Features Added to ARIN Online)](https://seclists.org/nanog/2025/Jan/75)**
> *Randy Bush (Jan 13)*
>
> thank you for making it optional and giving the op the choice
>
>
>
> randy
>
>
> **[ARIN Online update to provide auto-managed IRR objects for RPKI ROAs (Fwd: [arin-announce] New Features Added to ARIN Online)](https://seclists.org/nanog/2025/Jan/74)**
> *John Curran (Jan 13)*
>
> NANOGers -
>
>
>
> For those using RPKI, there is now optional functionality in ARIN Online that allows for automatic syncing of IRR route
>
> objects to ROAs - see additional information below.
>
>
>
> FYI,
>
> /John
>
>
>
> John Curran
>
> President and CEO
>
> American Registry for Internet Numbers
>
>
>
> Begin forwarded message:
>
>
>
> From: ARIN <info () arin net>
>
> Subject: [arin-announce] New Features Added to ARIN Online
>
> Date: January 13, 2025 at 11:01:00AM PST
>
> To:...
>
>
> **[Re: HBO / MAX Geolocation Contact](https://seclists.org/nanog/2025/Jan/73)**
> *Chris (Jan 13)*
>
> You might check if it's up to date on MaxMind and the like, HBO probably
>
> just pulls their data from one of those.
>
>
>
> On Thu, Jan 9, 2025 at 9:24PM Esteban Hernandez <esteban.hernandez () lixer mx>
>
> wrote:
>
>
> **[Re: HBO / MAX Geolocation Contact](https://seclists.org/nanog/2025/Jan/72)**
> *Justin Krejci (Jan 13)*
>
> According to this page
>
> <https://help.max.com/US/Answer/Detail/000002518>
>
>
>
> They provide a "Contact Us" web chat in step 4 of Troubleshooting.
>
> I have not used it to contact them but it does successfully launch a simple web chat client when I hit the embedded
>
> link.
>
>
>
> -----Original Message-----
>
> From: Esteban Hernandez <esteban.hernandez () lixer mx<mailto:Esteban%20Hernandez%20%3cesteban.hernandez () lixer
>
> mx%3e>>
>
> To: Justin...
>
>
> **[Re: 400G link L2 flakiness over DWDM](https://seclists.org/nanog/2025/Jan/71)**
> *Mark Tinka (Jan 13)*
>
> Based on how the issue was described in the report, the problem seems to
>
> occur if there are multiple ports on the line card configured with
>
> different mixes of Ethernet and OTN on ports 3 and 11, as well as on
>
> ports 4, 8, 12, and 16.
>
>
>
> The 2nd scenario is if on Waveserver, 400G Ethernet is enabled on ports
>
> 6 and 12, but a mix of both Ethernet and OTN are configured on ports 6,
>
> 7, 12, and 13 without 400G.
>
>
>
> The 3rd scenario is 400G Ethernet and...
>
>
> **[Re: Level3 4.2.2.1 and 4.2.2.2 not responding to pings, DNS queries work](https://seclists.org/nanog/2025/Jan/70)**
> *Tom Beecher (Jan 13)*
>
> The 4's have definitely had occasional ICMP allergies over the last 20
>
> years.
>
>
> **[Re: 400G link L2 flakiness over DWDM](https://seclists.org/nanog/2025/Jan/69)**
> *Brandon Martin (Jan 13)*
>
> I've been looking at the Waveserver line, so this is somewhat relevant
>
> to my interests.
>
>
>
> Given that this is a "not uncommon", do you or anyone else happen to
>
> know if there are other options such as e.g. configuring the port for
>
> only one of Ethernet or OTU service?

[![interesting-people logo](/images/interesting-people-logo.png)](/interesting-people/)

**[Interesting People](/interesting-people/)**  David Farber moderates this list for discussion involving internet governance, infrastructure, and any other topics he finds fascinating

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/interesting-people/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/interesting-people.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.listbox.com/subscribe/?list_id=247)

[![risks logo](/images/risks-logo.png)](/risks/)

**[The RISKS Forum](/risks/)**  Peter G. Neumann moderates this regular digest of current events which demonstrate risks to the public in computers and related systems. Security risks are often discussed.

* [![Current period icon](/images/current-icon-16x16.png)Current Quarter](/risks/2025/q1/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/risks/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/risks.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://catless.ncl.ac.uk/Risks)* [risksLatest Posts](/risks/)

> **[(no subject)](https://seclists.org/risks/2025/q1/0)**
> *RISKS List Owner (Jan 11)*
>
> Risks Digest 34.52
>
>
>
> RISKS-LIST: Risks-Forum Digest Saturday 11 January 2025 Volume 34 : Issue 52
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.52>>
>
> The current issue can also be found at...
>
>
>
> **[Risks Digest 34.51](https://seclists.org/risks/2024/q4/5)**
> *RISKS List Owner (Dec 29)*
>
> RISKS-LIST: Risks-Forum Digest Sunday 29 December 2024 Volume 34 : Issue 51
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.51>>
>
> The current issue can also be found at
>
> <...
>
>
> **[Risks Digest 34.50](https://seclists.org/risks/2024/q4/4)**
> *RISKS List Owner (Nov 23)*
>
> RISKS-LIST: Risks-Forum Digest Saturday 23 Nov 2024 Volume 34 : Issue 50
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.50>>
>
> The current issue can also be found at
>
> <...
>
>
> **[Risks Digest 34.49](https://seclists.org/risks/2024/q4/3)**
> *RISKS List Owner (Nov 16)*
>
> RISKS-LIST: Risks-Forum Digest Saturday 15 Nov 2024 Volume 34 : Issue No 49
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.49>>
>
> The current issue can also be found at
>
> <...
>
>
> **[Risks Digest 34.48](https://seclists.org/risks/2024/q4/2)**
> *RISKS List Owner (Nov 08)*
>
> RISKS-LIST: Risks-Forum Digest Friday 8 Nov 2024 Volume 34 : Issue 48
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.48>>
>
> The current issue can also be found at
>
> <...
>
>
> **[Risks Digest 34.47](https://seclists.org/risks/2024/q4/1)**
> *RISKS List Owner (Oct 17)*
>
> RISKS-LIST: Risks-Forum Digest Thursday 17 Oct 2024 Volume 34 : Issue 47
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.47>>
>
> The current issue can also be found at
>
> <...
>
>
> **[Risks Digest 34.46](https://seclists.org/risks/2024/q4/0)**
> *RISKS List Owner (Oct 01)*
>
> RISKS-LIST: Risks-Forum Digest Tuesday 1 Oct 2024 Volume 34 : Issue 46
>
>
>
> ACM FORUM ON RISKS TO THE PUBLIC IN COMPUTERS AND RELATED SYSTEMS (comp.risks)
>
> Peter G. Neumann, founder and still moderator
>
>
>
> \*\*\*\*\* See last item for further information, disclaimers, caveats, etc. \*\*\*\*\*
>
> This issue is archived at <<http://www.risks.org>> as
>
> <<http://catless.ncl.ac.uk/Risks/34.46>>
>
> The current issue can also be found at
>
> <...

[![dataloss logo](/images/dataloss-logo.png)](/dataloss/)

**[BreachExchange](/dataloss/)**  BreachExchange focuses on all things data breach. Topics include actual data breaches, cyber insurance, risk management, metrics and more. This archive includes its predecessor, the Data Loss news and discussion lists.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/dataloss/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/dataloss.rss)* [![About icon](/images/about-icon-16x16.png)About List](https://www.riskbasedsecurity.com/mailing-lists/)* [datalossLatest Posts](/dataloss/)

> **[Healthcare organizations face rising ransomware attacks  and are paying up](https://seclists.org/dataloss/2022/q2/51)**
> *Matthew Wheeler (Jun 03)*
>
> <https://www.theregister.com/2022/06/03/healthcare-ransomware-pay-sophos/>
>
>
>
> Healthcare organizations, already an attractive target for ransomware given
>
> the highly sensitive data they hold, saw such attacks almost double between
>
> 2020 and 2021, according to a survey released this week by Sophos.
>
>
>
> The outfit's team also found that while polled healthcare orgs are quite
>
> likely to pay ransoms, they rarely get all of their data returned if they
>
> do...
>
>
> **[A digital conflict between Russia and Ukraine rages on behind the scenes of war](https://seclists.org/dataloss/2022/q2/50)**
> *Matthew Wheeler (Jun 03)*
>
> <https://wskg.org/npr_story_post/a-digital-conflict-between-russia-and-ukraine-rages-on-behind-the-scenes-of-war/>
>
>
>
> SEATTLE  On the sidelines of a conference in Estonia on Wednesday, a
>
> senior U.S. intelligence official told British outlet Sky News that the
>
> U.S. is running offensive cyber operations in support of Ukraine.
>
>
>
> My job is to provide a series of options to the secretary of defense and
>
> the president, and so thats what I do, said...
>
>
> **[Researchers Uncover Malware Controlling Thousands of Sites in Parrot TDS Network](https://seclists.org/dataloss/2022/q2/49)**
> *Matthew Wheeler (Jun 03)*
>
> <https://thehackernews.com/2022/06/researchers-uncover-malware-controlling.html>
>
>
>
> The Parrot traffic direction system (TDS) that came to light earlier this
>
> year has had a larger impact than previously thought, according to new
>
> research.
>
>
>
> Sucuri, which has been tracking the same campaign since February 2019 under
>
> the name "NDSW/NDSX," said that "the malware was one of the top infections"
>
> detected in 2021, accounting for more than...
>
>
> **[FBI, CISA: Don't get caught in Karakurt's extortion web](https://seclists.org/dataloss/2022/q2/48)**
> *Matthew Wheeler (Jun 03)*
>
> <https://www.theregister.com/2022/06/03/fbi_cisa_warn_karakurt_extortion/>
>
>
>
> The Feds have warned organizations about a lesser-known extortion gang
>
> Karakurt, which demands ransoms as high as $13 million and, some
>
> cybersecurity folks say, may be linked to the notorious Conti crew.
>
>
>
> In a joint advisory [PDF] this week, the FBI, CISA and US Treasury
>
> Department outlined technical details about how Karakurt operates, along
>
> with actions to take,...
>
>
> **[DOJ Seizes 3 Web Domains Used to Sell Stolen Data and DDoS Services](https://seclists.org/dataloss/2022/q2/47)**
> *Matthew Wheeler (Jun 02)*
>
> <https://thehackernews.com/2022/06/doj-seizes-3-web-domains-used-to-sell.html>
>
>
>
> The U.S. Department of Justice (DoJ) on Wednesday announced the seizure of
>
> three domains used by cybercriminals to trade stolen personal information
>
> and facilitate distributed denial-of-service (DDoS) attacks for hire.
>
>
>
> This includes weleakinfo[.]to, ipstress[.]in, and ovh-booter[.]com, the
>
> former of which allowed its users to traffic hacked personal data and
>
> offered a...
>
>
> **[Chinese Hackers Begin Exploiting Latest Microsoft Office Zero-Day Vulnerability](https://seclists.org/dataloss/2022/q2/46)**
> *Matthew Wheeler (Jun 02)*
>
> <https://thehackernews.com/2022/05/chinese-hackers-begin-exploiting-latest.html>
>
>
>
> An advanced persistent threat (APT) actor aligned with Chinese state
>
> interests has been observed weaponizing the new zero-day flaw in Microsoft
>
> Office to achieve code execution on affected systems.
>
>
>
> "TA413 CN APT spotted [in-the-wild] exploiting the Follina zero-day using
>
> URLs to deliver ZIP archives which contain Word Documents that use the
>
> technique,"...
>
>
> **[US military hackers conducting offensive operations in support of Ukraine, says head of Cyber Command](https://seclists.org/dataloss/2022/q2/45)**
> *Matthew Wheeler (Jun 02)*
>
> <https://www.three.fm/news/world-news/us-military-hackers-conducting-offensive-operations-in-support-of-ukraine-says-head-of-cyber-command/>
>
>
>
> US military hackers have conducted offensive operations in support of
>
> Ukraine, the head of US Cyber Command has told Sky News.
>
>
>
> In an exclusive interview, General Paul Nakasone also explained how "hunt
>
> forward" operations were allowing the United States to search out foreign
>
> hackers and identify...
>
>
> **[SideWinder Hackers Launched Over a 1, 000 Cyber Attacks Over the Past 2 Years](https://seclists.org/dataloss/2022/q2/44)**
> *Matthew Wheeler (May 31)*
>
> <https://thehackernews.com/2022/05/sidewinder-hackers-launched-over-1000.html>
>
>
>
> An "aggressive" advanced persistent threat (APT) group known as SideWinder
>
> has been linked to over 1,000 new attacks since April 2020.
>
>
>
> "Some of the main characteristics of this threat actor that make it stand
>
> out among the others, are the sheer number, high frequency and persistence
>
> of their attacks and the large collection of encrypted and obfuscated...
>
>
> **[Hackers are Selling US University Credentials Online, FBI Says](https://seclists.org/dataloss/2022/q2/43)**
> *Matthew Wheeler (May 31)*
>
> <https://tech.co/news/hackers-are-selling-us-university-credentials-online-fbi-says>
>
>
>
> The Federal Bureau of Investigation has warned US universities and colleges
>
> that it has found banks of login credentials and other data relating to VPN
>
> access circulating on cybercriminals forums.
>
>
>
> The fear is that such data will be sold and subsequently used by malicious
>
> actors to orchestrate attacks on other accounts owned by the same students,
>
> in the hope...
>
>
> **[Interpol Nabs 3 Nigerian Scammers Behind Malware-based Attacks](https://seclists.org/dataloss/2022/q2/42)**
> *Matthew Wheeler (May 31)*
>
> <https://thehackernews.com/2022/05/interpol-nabs-3-nigerian-scammers.html>
>
>
>
> Interpol on Monday announced the arrest of three suspected global scammers
>
> in Nigeria for using remote access trojans (RATs) such as Agent Tesla to
>
> facilitate malware-enabled cyber fraud.
>
>
>
> "The men are thought to have used the RAT to reroute financial
>
> transactions, stealing confidential online connection details from
>
> corporate organizations, including oil and gas...
>
>
> **[U.S. Warns Against North Korean Hackers Posing as IT Freelancers](https://seclists.org/dataloss/2022/q2/41)**
> *Matthew Wheeler (May 18)*
>
> <https://thehackernews.com/2022/05/us-warns-against-north-korean-hackers.html>
>
>
>
> Highly skilled software and mobile app developers from the Democratic
>
> People's Republic of Korea (DPRK) are posing as "non-DPRK nationals" in
>
> hopes of landing freelance employment in an attempt to enable the regime's
>
> malicious cyber intrusions.
>
>
>
> That's according to a joint advisory from the U.S. Department of State, the
>
> Department of the...
>
>
> **[FBI and NSA say: Stop doing these 10 things that let the hackers in](https://seclists.org/dataloss/2022/q2/40)**
> *Matthew Wheeler (May 18)*
>
> <https://www.zdnet.com/article/fbi-and-nsa-say-stop-doing-these-10-things-that-let-the-hackers-in/>
>
>
>
> Cyber attackers regularly exploit unpatched software vulnerabilities, but
>
> they "routinely" target security misconfigurations for initial access, so
>
> the US Cybersecurity and Infrastructure Security Agency (CISA) and its
>
> peers have created a to-do list for defenders in today's heightened threat
>
> environment.
>
>
>
> CISA, the FBI and National...
>
>
> **[Fifth of Businesses Say Cyber-Attack Nearly Broke Them](https://seclists.org/dataloss/2022/q2/39)**
> *Matthew Wheeler (May 18)*
>
> <https://www.infosecurity-magazine.com/news/fifth-of-businesses-cyber-attack/>
>
>
>
> A fifth of US and European businesses have warned that a serious
>
> cyber-attack nearly rendered them insolvent, with most (87%) viewing
>
> compromise as a bigger threat than an economic downturn, according to
>
> Hiscox.
>
>
>
> The insurer polled over 5000 businesses in the US, UK, Ireland, France,
>
> Spain, Germany, the Netherlands and Belgium to compile its annual Hiscox
>
> Cyber...
>
>
> **[Hacker And Ransomware Designer Charged For Use And Sale Of Ransomware, And Profit Sharing Arrangements With Cybercriminals](https://seclists.org/dataloss/2022/q2/38)**
> *Matthew Wheeler (May 18)*
>
> <https://www.shorenewsnetwork.com/2022/05/16/hacker-and-ransomware-designer-charged-for-use-and-sale-of-ransomware-and-profit-sharing-arrangements-with-cybercriminals/>
>
>
>
> A criminal complaint was unsealed today in federal court in Brooklyn, New
>
> York, charging Moises Luis Zagala Gonzalez (Zagala), also known as
>
> Nosophoros, Aesculapius and Nebuchadnezzar, a citizen of France and
>
> Venezuela who resides in Venezuela, with attempted...
>
>
> **[State of Ransomware shows huge growth in threat and impacts](https://seclists.org/dataloss/2022/q2/37)**
> *Matthew Wheeler (May 04)*
>
> <https://www.continuitycentral.com/index.php/news/technology/7275-state-of-ransomware-shows-huge-growth-in-threat-and-impacts>
>
>
>
> Sophos has released its annual survey and review of real-world ransomware
>
> experiences in its State of Ransomware 2022 report. This shows that 66
>
> percent of organizations surveyed were hit with ransomware in 2021, up from
>
> 37 percent in 2020.
>
>
>
> The average ransom paid by organizations that had data encrypted in their...

## Open Source Tool Development

[![metasploit logo](/images/metasploit-logo.png)](/metasploit/)

**[Metasploit](/metasploit/)**  Development discussion for [Metasploit](http://metasploit.com/), the premier open source remote exploitation tool

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/metasploit/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/metasploit.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://spool.metasploit.com/mailman/listinfo/framework)

[![wireshark logo](/images/wireshark-logo.png)](/wireshark/)

**[Wireshark](/wireshark/)**  Discussion of the free and open source [Wireshark](http://www.wireshark.org/) network sniffer. No other sniffer (commercial or otherwise) comes close. This archive combines the Wireshark announcement, users, and developers mailing lists.

* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/wireshark/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/wireshark.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.wireshark.org/lists/)

[![snort logo](/images/snort-logo.png)](/snort/)

**[Snort](/snort/)**  Everyone's favorite open source IDS, [Snort](http://www.snort.org/). This archive combines the snort-announce, snort-devel, snort-users, and snort-sigs lists.

* [![Current period icon](/images/current-icon-16x16.png)Current Quarter](/snort/2025/q1/index.html)* [![Archive icon](/images/archive-icon-16x16.png)Archived Posts](/snort/)* [![RSS icon](/images/feed-icon-16x16.png)RSS Feed](/rss/snort.rss)* [![About icon](/images/about-icon-16x16.png)About List](http://www.snort.org/community/mailing-lists)* [snortLatest Posts](/snort/)

> **[Snort Subscriber Rules Update 2025-01-09](https://seclists.org/snort/2025/q1/2)**
> *Research via Snort-sigs (Jan 09)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-office and
>
> server-webapp rule sets to provide coverage for emerging threats from
>
> these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2025-01-07](https://seclists.org/snort/2025/q1/1)**
> *Research via Snort-sigs (Jan 07)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the malware-cnc,
>
> malware-other, os-windows and server-webapp rule sets to provide
>
> coverage for emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2025-01-02](https://seclists.org/snort/2025/q1/0)**
> *Research via Snort-sigs (Jan 02)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the and server-webapp
>
> rule sets to provide coverage for emerging threats from these
>
> technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
>
> **[Snort Subscriber Rules Update 2024-12-23](https://seclists.org/snort/2024/q4/42)**
> *Research via Snort-sigs (Dec 23)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-identify,
>
> file-office, file-other, malware-cnc, malware-other, protocol-imap and
>
> server-webapp rule sets to provide coverage for emerging threats from
>
> these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-12-19](https://seclists.org/snort/2024/q4/41)**
> *Research via Snort-sigs (Dec 19)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-flash,
>
> file-office, malware-other and server-webapp rule sets to provide
>
> coverage for emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-12-17](https://seclists.org/snort/2024/q4/40)**
> *Research via Snort-sigs (Dec 17)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the browser-webkit,
>
> file-image, malware-cnc, malware-other and server-webapp rule sets to
>
> provide coverage for emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-12-12](https://seclists.org/snort/2024/q4/39)**
> *Research via Snort-sigs (Dec 12)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-image,
>
> malware-cnc, malware-other, policy-other, server-mail and server-webapp
>
> rule sets to provide coverage for emerging threats from these
>
> technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-12-10](https://seclists.org/snort/2024/q4/38)**
> *Research via Snort-sigs (Dec 10)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> Talos is aware of vulnerabilities affecting products from Microsoft
>
> Corporation.
>
>
>
> Details:
>
> Microsoft Vulnerability CVE-2024-49088:
>
> A coding deficiency exists in Microsoft Windows Common Log File System
>
> Driver that may lead to an escalation of privilege.
>
>
>
> Rules to detect attacks targeting these vulnerabilities are included in
>
> this release and are identified with:
>
> Snort 2: GID 1, SIDs 64308 through...
>
>
> **[Snort Subscriber Rules Update 2024-12-05](https://seclists.org/snort/2024/q4/37)**
> *Research via Snort-sigs (Dec 05)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-other,
>
> policy-other and server-webapp rule sets to provide coverage for
>
> emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-12-03](https://seclists.org/snort/2024/q4/36)**
> *Research via Snort-sigs (Dec 03)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the browser-chrome,
>
> file-image, malware-cnc, malware-other, policy-other, server-mail and
>
> server-webapp rule sets to provide coverage for emerging threats from
>
> these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort Subscriber Rules Update 2024-11-26](https://seclists.org/snort/2024/q4/35)**
> *Research via Snort-sigs (Nov 26)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-executable,
>
> malware-cnc, policy-other and server-webapp rule sets to provide
>
> coverage for emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[Snort VRT rule Consulting](https://seclists.org/snort/2024/q4/34)**
> * via Snort-sigs (Nov 21)*
>
> Hello, I want to buy Snort VRT rules, but I have purchased Proofpoint ET
>
> Pro, whose rule set contains snort rules, and I am not sure whether the
>
> rules in Proofpoint ET Pro include Snort VRT
>
>
> **[Snort 2025 Wall Calendars are available now!](https://seclists.org/snort/2024/q4/33)**
> *Brendan Bell (brebell) via Snort-sigs (Nov 21)*
>
> The 2025 Snort Calendar has arrived! This years theme is Video Games! To get your copy of the 2025 Snort Calendar,
>
> fill out our short survey here: <https://ciscocx.qualtrics.com/jfe/form/SV_8vtgX1JTR9exUFM>
>
>
>
> Thanks,
>
> Snort Team
>
>
> **[Snort Subscriber Rules Update 2024-11-21](https://seclists.org/snort/2024/q4/32)**
> *Research via Snort-sigs (Nov 21)*
>
> Talos Snort Subscriber Rules Update
>
>
>
> Synopsis:
>
> This release adds and modifies rules in several categories.
>
>
>
> Details:
>
> Talos has added and modified multiple rules in the file-image,
>
> malware-cnc and server-webapp rule sets to provide coverage for
>
> emerging threats from these technologies.
>
>
>
> For a complete list of new and modified rules please see:
>
>
>
> <https://www.snort.org/advisories>
>
>
> **[calender where do i get a 2025 snort Wall Calender? Please help](https://seclists.org/snort/2024/q4/31)**
> *Jenny Kie via Snort-sigs (Nov 20)*
>
> i would know how tp receive a snort Wall Calender my email where i can
>
> be reached is JENKIE222 () aol com thank you,

## More Lists

We also maintain archives for these lists (some are currently inactive):

* [Declan McCullagh's Politech](/politech/)* [TCPDump/LibPCAP Dev](/tcpdump/)* [Security Incidents](/incidents/)* [Vulnerability Development](/vuln-dev/)* [Vulnerability Watch](/vulnwatch/)

## Related Resources

Read some old-school private security digests such as Zardoz at [SecurityDigest.Org](http://securitydigest.org)

We're always looking for great network security related lists to archive. To suggest one, mail Fyodor.

![](/shared/images/nst-icons.svg#search)

## [Nmap Security Scanner](https://nmap.org/)

* [Ref Guide](https://nmap.org/book/man.html)* [Install Guide](https://nmap.org/book/install.html)* [Docs](https://nmap.org/docs.html)* [Download](https://nmap.org/download.html)* [Nmap OEM](https://nmap.org/oem/)

## [Npcap packet capture](https://npcap.com/)

* [User's Guide](https://npcap.com/guide/)* [API docs](https://npcap.com/guide/npcap-devguide.html#npcap-api)* [Download](https://npcap.com/#download)* [Npcap OEM](https://npcap.com/oem/)

## [Security Lists](https://seclists.org/)

* [Nmap Announce](https://seclists.org/nmap-announce/)* [Nmap Dev](https://seclists.org/nmap-dev/)* [Full Disclosure](https://seclists.org/fulldisclosure/)* [Open Source Security](https://seclists.org/oss-sec/)* [BreachExchange](https://seclists.org/dataloss/)

## [Security Tools](https://sectools.org)

* [Vuln scanners](https://sectools.org/tag/vuln-scanners/)* [Password audit](https://sectools.org/tag/pass-audit/)* [Web scanners](https://sectools.org/tag/web-scanners/)* [Wireless](https://sectools.org/tag/wireless/)* [Exploitation](https://sectools.org/tag/sploits/)

## [About](https://insecure.org/)

* [About/Contact](https://insecure.org/fyodor/)* [Privacy](https://insecure.org/privacy.html)* [Advertising](https://insecure.org/advertising.html)* [Nmap Public Source License](https://nmap.org/npsl/)

[![](/shared/images/nst-icons.svg#twitter)](https://twitter.com/nmap "Visit us on Twitter")
[![](/shared/images/nst-icons.svg#facebook)](https://facebook.com/nmap "Visit us on Facebook")
[![](/shared/images/nst-icons.svg#github)](https://github.com/nmap/ "Visit us on Github")
[![](/shared/images/nst-icons.svg#reddit)](https://reddit.com/r/nmap/ "Discuss Nmap on Reddit")



=== Content from access.redhat.com_840f308e_20250115_114218.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Franais](https://access.redhat.com/changeLanguage?language=fr)
* [](https://access.redhat.com/changeLanguage?language=ko)
* [](https://access.redhat.com/changeLanguage?language=ja)
* [ ()](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

  2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from www.openwall.com_0fa4be6e_20250114_191735.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2023/07/04/1) [[next>]](2) [[thread-next>]](../../../2023/07/07/4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <xhhkp3aknwwlmrmmqmr532yfq3ioqh6jbkrxfqf6ovlj2szsai@f3sjwakyq323>
Date: Wed, 5 Jul 2023 20:12:01 +0800
From: Ruihan Li <lrh2000@....edu.cn>
To: oss-security@...ts.openwall.com
Cc: Ruihan Li <lrh2000@....edu.cn>
Subject: StackRot (CVE-2023-3269): Linux kernel privilege escalation
 vulnerability

Hi all,

**This serves as an "early" disclosure of the StackRot vulnerability, in
compliance with [the policy of the linux-distros list][po]. While all the
essential vulnerability details have been provided here, the complete exploit
code and a comprehensive write-up will be made publicly available no later than
the end of July. This oss-security thread will be notified, and any
updates will be reflected in [the GitHub repository][gh].**

 [po]: <https://oss-security.openwall.org/wiki/mailing-lists/distros>
 [gh]: <https://github.com/lrh2000/StackRot>

A flaw was found in the handling of stack expansion in the Linux kernel 6.1
through 6.4, aka "Stack Rot". The maple tree, responsible for managing virtual
memory areas, can undergo node replacement without properly acquiring the MM
write lock, leading to use-after-free issues. An unprivileged local user could
use this flaw to compromise the kernel and escalate their privileges.

As StackRot is a Linux kernel vulnerability found in the memory management
subsystem, it affects almost all kernel configurations and requires minimal
capabilities to trigger. However, it should be noted that maple nodes are freed
using RCU callbacks, delaying the actual memory deallocation until after the
RCU grace period. Consequently, exploiting this vulnerability is considered
challenging.

To the best of my knowledge, there are currently no publicly available exploits
targeting use-after-free-by-RCU (UAFBR) bugs. This marks the first instance
where UAFBR bugs have been proven to be exploitable, even without the presence
of CONFIG_PREEMPT or CONFIG_SLAB_MERGE_DEFAULT settings. Notably, this exploit
has been successfully demonstrated in the environment provided by [Google kCTF
VRP][ctf] ([bzImage_upstream_6.1.25][img], [config][cfg]).

 [ctf]: <https://google.github.io/kctf/vrp.html>
 [img]: <https://storage.googleapis.com/kctf-vrp-public-files/bzImage_upstream_6.1.25>
 [cfg]: <https://storage.googleapis.com/kctf-vrp-public-files/bzImage_upstream_6.1.25_config>

The StackRot vulnerability has been present in the Linux kernel since version
6.1 when the VMA tree structure was [changed][ch] from red-black trees to maple
trees.

 [ch]: [https://lore.kernel.org/lkml/20220906194824.2110408-1-Liam.Howlett@oracle.com/](https://lore.kernel.org/lkml/20220906194824.2110408-1-Liam.Howlett%40oracle.com/)

## Background

Whenever the `mmap()` system call is utilized to establish a memory mapping,
the kernel generates a structure called `vm_area_struct` to represent the
corresponding virtual memory area (VMA). This structure stores various
information including flags, properties, and other pertinent details related to
the mapping.

```c
struct vm_area_struct {
        long unsigned int          vm_start;             /*     0     8 */
        long unsigned int          vm_end;               /*     8     8 */
        struct mm_struct *         vm_mm;                /*    16     8 */
        pgprot_t                   vm_page_prot;         /*    24     8 */
        long unsigned int          vm_flags;             /*    32     8 */
        union {
                struct {
                        struct rb_node rb __attribute__((__aligned__(8))); /*    40    24 */
                        /* --- cacheline 1 boundary (64 bytes) --- */
                        long unsigned int rb_subtree_last; /*    64     8 */
                } __attribute__((__aligned__(8))) shared __attribute__((__aligned__(8))); /*    40    32 */
                struct anon_vma_name * anon_name;        /*    40     8 */
        } __attribute__((__aligned__(8)));               /*    40    32 */
        /* --- cacheline 1 boundary (64 bytes) was 8 bytes ago --- */
        struct list_head           anon_vma_chain;       /*    72    16 */
        struct anon_vma *          anon_vma;             /*    88     8 */
        const struct vm_operations_struct  * vm_ops;     /*    96     8 */
        long unsigned int          vm_pgoff;             /*   104     8 */
        struct file *              vm_file;              /*   112     8 */
        void *                     vm_private_data;      /*   120     8 */
        /* --- cacheline 2 boundary (128 bytes) --- */
        atomic_long_t              swap_readahead_info;  /*   128     8 */
        struct vm_userfaultfd_ctx  vm_userfaultfd_ctx;   /*   136     0 */

        /* size: 136, cachelines: 3, members: 14 */
        /* forced alignments: 1 */
        /* last cacheline: 8 bytes */
} __attribute__((__aligned__(8)));
```

Subsequently, when the kernel encounters page faults or other memory-related
system calls, it requires fast lookup of the VMA solely based on the address.
Previously, the VMAs were managed using red-black trees. However, starting from
Linux kernel version 6.1, the migration to maple trees took place. [Maple
trees][mt] are RCU-safe B-tree data structures optimized for storing
non-overlapping ranges. Nonetheless, their intricate nature adds complexity to
the codebase and introduces the StackRot vulnerability.

 [mt]: <https://docs.kernel.org/6.4/core-api/maple_tree.html>

In essence, the maple tree is composed of maple nodes. Throughout this article,
it is assumed that the maple tree has only a single root node, which can
contain a maximum of 16 intervals. Each interval can either represent a gap or
point to a VMA. Thus, no gaps are allowed between two intervals.

```c
struct maple_range_64 {
        struct maple_pnode *       parent;               /*     0     8 */
        long unsigned int          pivot[15];            /*     8   120 */
        /* --- cacheline 2 boundary (128 bytes) --- */
        union {
                void *             slot[16];             /*   128   128 */
                struct {
                        void *     pad[15];              /*   128   120 */
                        /* --- cacheline 3 boundary (192 bytes) was 56 bytes ago --- */
                        struct maple_metadata meta;      /*   248     2 */
                };                                       /*   128   128 */
        };                                               /*   128   128 */

        /* size: 256, cachelines: 4, members: 3 */
};
```

The structure `maple_range_64` represents a maple node in the following manner.
The pivots indicate the endpoints of 16 intervals, while the slots are used to
reference the VMA structure when the node is considered a leaf node. The layout
of pivots and slots can be visualized as shown below:

```
 Slots -> | 0 | 1 | 2 | ... | 12 | 13 | 14 | 15 |
                                        
                                         Implied maximum
                                     Pivot 14
                                 Pivot 13
                             Pivot 12
                         Pivot 11
                    Pivot 2
                 Pivot 1
              Pivot 0
            Implied minimum
```

Regarding concurrent modification, the maple tree imposes restrictions,
requiring an exclusive lock to be held by writers. In the case of the VMA tree,
the exclusive lock corresponds to the MM write lock. As for readers, two
options are available. The first option involves holding the MM read lock,
which results in the writer being blocked by the MM read-write lock.
Alternatively, the second option is to enter the RCU critical section. By doing
so, the writer is not blocked, and readers can continue their operations since
the maple tree is RCU-safe. While most existing VMA accesses opt for the first
option, the second option is employed in a few performance-critical scenarios,
such as lockless page faults.

However, there is an additional aspect that requires particular attention,
which pertains to stack expansion. The stack represents a memory area that is
mapped with the MAP_GROWSDOWN flag, indicating automatic expansion when an
address below the region is accessed. In such cases, the start address of the
corresponding VMA is adjusted, as well as the associated interval within the
maple tree. Notably, these adjustments are made without holding the MM write
lock.

```c
static inline
void do_user_addr_fault(struct pt_regs *regs,
                        unsigned long error_code,
                        unsigned long address)
{
	// ...

	if (unlikely(!mmap_read_trylock(mm))) {
		// ...
	}
	// ...
	if (unlikely(expand_stack(vma, address))) {
		// ...
	}

	// ...
}
```

Typically, a gap exists between the stack VMA and its neighboring VMA, as the
kernel enforces a stack guard. In this scenario, when expanding the stack, only
the pivot value in the maple node needs updating, a process that can be
performed atomically. However, if the neighboring VMA also possesses the
MAP_GROWSDOWN flag, no stack guard is enforced. Consequently, the stack
expansion can eliminate the gap. In such situations, the gap interval within
the maple node must be removed. As the maple tree is RCU-safe, overwriting the
node in-place is not possible. Instead, a new node is created, triggering node
replacement, and the old node is subsequently destroyed using an RCU callback.

```c
int expand_downwards(struct vm_area_struct *vma, unsigned long address)
{
	// ...

	if (prev) {
		if (!(prev->vm_flags & VM_GROWSDOWN) &&
		    vma_is_accessible(prev) &&
		    (address - prev->vm_end < stack_guard_gap))
			return -ENOMEM;
	}

	// ...
}
```

The RCU callback is invoked only after all pre-existing RCU critical sections
have concluded. However, the issue arises when accessing VMAs, as only the MM
read lock is held, and it does not enter the RCU critical section.
Consequently, in theory, the callback could be invoked at any time, resulting
in the freeing of the old maple node. However, pointers to the old node may
have already been fetched, leading to a use-after-free bug when attempting
subsequent access to it.

The backtrace where use-after-free (UAF) occurs is shown below:

```
  - CPU 0 -                                        - CPU 1 -

  mm_read_lock()                                    mm_read_lock()
  expand_stack()                                    find_vma_prev()
    expand_downwards()                                mas_walk()
      mas_store_prealloc()                              mas_state_walk()
        mas_wr_story_entry()                              mas_start()
          mas_wr_modify()                                   mas_root()
            mas_wr_store_node()                               node = rcu_dereference_check()
              mas_replace()                                   [ The node pointer is recorded ]
                mas_free()
                  ma_free_rcu()
                    call_rcu(&mt_free_rcu)
                    [ The node is dead ]
  mm_read_unlock()

  [ Wait for the next RCU grace period.. ]
  rcu_do_batch()                                      mas_prev()
    mt_free_rcu()                                       mas_prev_entry()
      kmem_cache_free()                                   mas_prev_nentry()
      [ The node is freed ]                                 mas_slot()
                                                              mt_slot()
                                                                rcu_dereference_check(node->..)
                                                                [ UAF occurs here ]
                                                    mm_read_unlock()
```

## Fix

I reported this vulnerability to the Linux kernel security team on June 15th.
Following that, the process of addressing this bug was led by Linus Torvalds.
Given its complexity, it took nearly two weeks to develop a set of patches that
received consensus.

On June 28th, during the merge window for Linux kernel 5.5, the fix was merged
into Linus' tree. Linus provided a [comprehensive merge message][fix] to
elucidate the patch series from a technical perspective.

 [fix]: <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009>

These patches were subsequently backported to stable kernels ([6.1.37][6.1],
[6.3.11][6.3], and [6.4.1][6.4]), effectively resolving the "Stack Rot" bug on
July 1st.

 [6.1]: [https://lore.kernel.org/stable/2023070133-create-stainless-9a8c@gregkh/T/](https://lore.kernel.org/stable/2023070133-create-stainless-9a8c%40gregkh/T/)
 [6.3]: [https://lore.kernel.org/stable/2023070146-endearing-bounding-d21a@gregkh/T/](https://lore.kernel.org/stable/2023070146-endearing-bounding-d21a%40gregkh/T/)
 [6.4]: [https://lore.kernel.org/stable/2023070140-eldercare-landlord-133c@gregkh/T/](https://lore.kernel.org/stable/2023070140-eldercare-landlord-133c%40gregkh/T/)

## Exploit

**The complete exploit code and a comprehensive write-up will be made publicly
available no later than the end of July.**

Thanks,
Ruihan Li

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from security.netapp.com_a8336429_20250114_191735.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English


[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2023-3269 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20230908-0001)

## CVE-2023-3269 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close 

#### Subscribe to NTAP-20230908-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20230908-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close 

#### Unsubscribe from NTAP-20230908-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20230908-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20230908-0001
**Version:**
7.0

**Last updated:**
10/22/2024

**Status:**
Interim.

**CVEs:** CVE-2023-3269

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions prior to 6.5 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2023-3269](https://nvd.nist.gov/vuln/detail/CVE-2023-3269) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C

#### Products Under Investigation

* NetApp HCI Compute Node (Bootstrap OS)

#### Products Not Affected

* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20230908-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20230908 | Initial Public Release |
| 2.0 | 20230918 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 3.0 | 20231003 | NetApp SolidFire & HCI Storage Node (Element Software), NetApp SolidFire & HCI Management Node moved to Products Not Affected |
| 4.0 | 20231101 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S moved to Won't Fix status |
| 5.0 | 20231107 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Won't Fix status |
| 6.0 | 20231117 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Products Not Affected |
| 7.0 | 20241022 | AFF Baseboard Management Controller (BMC) - A700s moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetApps current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp.  2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

   NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from www.openwall.com_b809c0bc_20250114_191731.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists  *for password cracking*](/wordlists/)+ [passwdqc  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt  *KDF & password hashing*](/yescrypt/)+ [yespower  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish  *password hashing*](/crypt/)+ [phpass  *ditto in PHP*](/phpass/)+ [tcb  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd  *port scan detector*](/scanlogd/)+ [popa3d  *tiny POP3 daemon*](/popa3d/)+ [blists  *web interface to mailing lists*](/blists/)+ [msulogin  *single user mode login*](/msulogin/)+ [php\_mt\_seed  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2023/08/23/6) [[next>]](2) [[thread-next>]](../../../2023/08/27/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <12aa367f-9934-7450-1016-fe303c72cc5a@molgen.mpg.de>
Date: Fri, 25 Aug 2023 13:17:01 +0200
From: Donald Buczek <buczek@...gen.mpg.de>
To: Solar Designer <solar@...nwall.com>, oss-security@...ts.openwall.com
Cc: Vegard Nossum <vegard.nossum@...cle.com>, Jiri Kosina <jkosina@...e.cz>,
 ksummit@...ts.linux.dev
Subject: Re: Re: [MAINTAINERS SUMMIT] Handling of embargoed security issues --
 security@...g vs. linux-distros@

Hi, Alexander and all,

I was more or less waiting for a public discussion to start on oss-security or somewhere else, because I'd like to express how important the announcements of Linux kernel issues via linux-distros is to us.

We operate the IT infrastructure of a scientific research institute (456 users, 144 Linux servers, 98 Linux workstations, about 6 PB used storage). We are not using any distro, everything is build locally and we maintain the systems by continuous rolling upgrades.

All systems from workstations to cluster servers run the same (set of) kernels and identical userspace. The setting is rather unusual these days, all shared storage including homes is on software raid and available to the other systems via automounted nfs. We have a few public servers and a rather big computer cluster with a job scheduler. Everything is multi-user. We need to maintain separation between users and to defend the systems against attacks from the (possible abused) unprivileged user accounts.

Our scientist run software on cluster-servers which often take many, many days to complete because of the size of the input data. Other might, for example, experiment with Jupyter Notebooks and have a lot of in-memory state. We have long running remote login sessions round the clock. For efficiency, most things run natively on hardware and not in virtual machines. System reboots have a lot of negative impact for our users.

Even nowadays not everything is single-user or microservices. "All users of the X:X kernel series must upgrade" or "just run mainline" is not a helpful strategy for us, because there is the operational issue of booting into a new kernel. Also, because we have a rather unusual settings, it is not unusual that we run into bugs others haven't discovered before. That's why we rather test new releases and roll them out slowly. That may be a corner case, but these corner cases exist, too.

We heavily rely on the information about kernel security issues published to linux-distros, which we, of course, can only receive via oss-security after the embargo. We analyze each and every new topic on oss-security to decide, whether it is relevant to us and what we can do about it. Nearly all of the userspace issues are of no relevance to us, but many of the kernel issues are, if we happen to run affected kernel versions.

We go a long way to avoid rebooting. This might be as easy as disabling unused dynamic modules by just removing the .ko files from userspace, but sometimes we even convert an upstream fix into a loadable module which uses ftrace to replace or wrap the buggy functions in the running systems. A "reboot party" would only be a measure of last resort.

oss-security gives us the notifications and enough information or references so that we can deal with the problems. We can not just follow mainline (or a stable series) and analyze every patch ourself to identify, whether a security bug was silently fixed. We can not boot into a new kernel every few days, just in case.

Exploits are sometimes helpful, too, for example to quickly identify whether we run affected versions, which sometimes isn't that trivial to find out otherwise, or to verify that our mitigations are working as intended.

I would very much appreciate if a policy could be found with the kernel community that encourages to send information to linux-distros. If that requires that the rather strict procedures and deadlines of linux-distros are relaxed, I hope there is room for compromise.

Best

  Donald

On 8/16/23 5:26 PM, Solar Designer wrote:
> On Tue, Aug 15, 2023 at 12:17:03PM +0200, Vegard Nossum wrote:
>> (Sending this with a few extra people in Bcc so they'll see it without
>> getting spammed with replies if they don't want them.)
>
> Thank you, Vegard!
>
> I've also now skimmed this thread at
> [https://lore.kernel.org/ksummit/nycvar.YFH.7.76.2308160014330.14207@cbobk.fhfr.pm/T/#t](https://lore.kernel.org/ksummit/nycvar.YFH.7.76.2308160014330.14207%40cbobk.fhfr.pm/T/#t)
>
> I also found interesting the adjacent thread on "Quality standards for
> embargoed code".
>
> I notice these are tagged "MAINTAINERS SUMMIT", I assume in reference to
> the one in Richmond, VA on November 16th, 2023?  I cannot easily get to
> the US, but I'd consider getting to the summit in Bilbao, Spain on
> September 19-21 if the relevant people would be there as well and my
> attendance would be expected to help?  I don't think there's anything we
> can't discuss over e-mail (and in fact e-mail is more specific), but
> meeting in person is a gesture that might help establish an atmosphere
> of trust and assurance of good intent.
>
>> I think it's worth pointing out that the latest update to the
>> documentation (where reporters are discouraged from reporting kernel
>> issues to linux-distros@ ever)
>
> It isn't "ever" - rather, it is "NEVER contact the "linux-distros"
> mailing list until AFTER discussing it with the kernel security team."
> So the kernel security team can, perhaps after having arrived at a fix,
> choose to direct the reporter to also contact linux-distros.  Now, I
> don't know whether this would actually be happening or not.  Maybe some
> friendly dialogue and agreeing on things could affect that.
>
>> came just after a private discussion (on
>> both mailing lists) about the StackRot/CVE-2023-3269 vulnerability where
>> Linus in particular came out hard against the linux-distros policy, in
>> particular the requirement to disclose PoCs if those were shared with
>> the list in the first place. I therefore think that Linus himself needs
>> to be involved in this discussion and that his arguments need to be made
>> in public instead of just paraphrased by me.
>
> In that private thread, two linux-distros policy aspects came up as
> being inconsistent with s@k.o preferences:
>
> 1. For s@k.o, public disclosure is typically in up to 7 days since fix
> is ready, but for linux-distros the deadline is 14 days max since
> linux-distros is notified even if the fix is not ready.  Apparently,
> this one makes Greg particularly unhappy about linux-distros.
>
> 2. _If_ the reporter shares PoCs/exploits with linux-distros, then per
> current policy those should also be made public (within up to 7 days
> more after the vulnerability is publicly disclosed as such).  Linus said
> that this must be up to the reporter only, and we should not be imposing
> such policy.  In a sense, this is already up to the reporter - if they
> disagree, they just shouldn't post PoCs/exploits to linux-distros (can
> instead post an offer to share with individual distros) - however, this
> is problematic in practice because not everyone reads the rules before
> posting and sometimes people change their mind during the embargo time
> (or are required to "change their mind" by their employer, etc.)
>
> I agree both of these are problems, and I suggest discussing them on
> oss-security.  Maybe we can arrive at satisfactory solutions/exceptions.
>
> While we're at it, I'd like to point out that while the wording (in the
> commit above) that "the linux-distros rules do not contribute to
> actually fixing any potential security problems" is technically correct
> (yes, the _rules_ do not contribute to _upstream_ fixes), it may be
> misleading.  It implies that linux-distros members would not help fix
> bugs, whereas in that very StackRot/CVE-2023-3269 thread Vegard,
> receiving the messages as part of Oracle Linux's linux-distros
> membership, has actually contributed to fixing the bug upstream.  Vegard
> is probably too humble to bring this up, so I do.  Also, even when not
> contributing to upstream fixes, linux-distros members will generally
> "contribute to actually fixing any potential security problems" in their
> respective distros (even if e.g. by back-porting upstream fixes when
> those are ready).  So I would omit this wording if it were up to me.
>
>> On 8/15/23 11:28, Jiri Kosina wrote:
>>> With my distro hat on, I really want the kernel security bugs to be
>>> *eventually* processed through linux-distros@ somehow, for one sole
>>> reason: it means that our distro security people will be aware of it,
>>> track it internally, and keep an eye on the fix being ported to all of our
>>> codestreams. This is exactly how this is done for all other packages.
>>>
>>> I would be curious to hear about this from other distros, but I sort of
>>> expect that they would agree.
>>
>> +1 from me; the distros list has been an extremely important resource
>> for distros in order to get fixes shipped out with minimal delay.
>
> Yes, I'd like this to be happening as well, and the current kernel
> documentation does not preclude that from happening.  So now it's up to
> the people on s@....
>
>>> [1] <https://git.kernel.org/linus/4fee0915e649b>
>
> Alexander
>

--
Donald Buczek
buczek@...gen.mpg.de
Tel: +49 30 8413 1433

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from access.redhat.com_639c39d1_20250115_114218.html ===


[Skip to navigation](#pfe-navigation)
[Skip to main content](#cp-main)
### Utilities

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)

[![Red Hat Customer Portal](https://access.redhat.com/chrome_themes/nimbus/img/red-hat-customer-portal.svg)](https://access.redhat.com/)

* [Subscriptions](https://access.redhat.com/management/)
* [Downloads](https://access.redhat.com/downloads/)
* [Red Hat Console](//console.redhat.com/)
* [Get Support](https://access.redhat.com/support/)
* [Products](https://access.redhat.com/)
  ### Top Products

  + [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
  + [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
  + [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
  [All Products](https://access.redhat.com/products/)

  ### Downloads and Containers

  + [Downloads](https://access.redhat.com/downloads/)
  + [Packages](https://access.redhat.com/downloads/content/package-browser)
  + [Containers](https://catalog.redhat.com/software/containers/explore/)
  ### Top Resources

  + [Documentation](//docs.redhat.com/)
  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Product Compliance](https://access.redhat.com/articles/1202803)
  + [Errata](https://access.redhat.com/errata/)
* [Knowledge](https://access.redhat.com/labs/)
  ### Red Hat Knowledge Center

  + [Knowledgebase Solutions](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Solution)
  + [Knowledgebase Articles](https://access.redhat.com/search/?q=*&p=1&rows=10&documentKind=Article)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Errata](https://access.redhat.com/errata/)
  ### Top Product Docs

  + [Red Hat Enterprise Linux](//docs.redhat.com/en/documentation/red_hat_enterprise_linux/)
  + [Red Hat OpenShift](//docs.redhat.com/en/documentation/openshift_container_platform/)
  + [Red Hat Ansible Automation Platform](//docs.redhat.com/en/documentation/red_hat_ansible_automation_platform/)
  [All Product Docs](//docs.redhat.com/en/products)

  ### [Training and Certification](//www.redhat.com/en/services/training-and-certification)

  + [About](//www.redhat.com/en/services/training-and-certification)
  + [Course Index](//www.redhat.com/en/services/training/all-courses-exams)
  + [Certification Index](//www.redhat.com/en/services/certifications)
  + [Skill Assessment](//skills.ole.redhat.com/)
* [Security](https://access.redhat.com/security/)
  ### [Red Hat Product Security Center](https://access.redhat.com/security)

  + [Security Updates](https://access.redhat.com/security)
  + [Security Advisories](https://access.redhat.com/security/security-updates/#/security-advisories)
  + [Red Hat CVE Database](https://access.redhat.com/security/security-updates/#/cve)
  + [Errata](https://access.redhat.com/errata/)
  ### References

  + [Security Bulletins](https://access.redhat.com/security/vulnerabilities)
  + [Security Measurement](https://www.redhat.com/security/data/metrics/)
  + [Severity Ratings](https://access.redhat.com/security/updates/classification/)
  + [Security Data](https://access.redhat.com/security/data)
  ### Top Resources

  + [Security Labs](https://access.redhat.com/security/security-updates/#/security-labs)
  + [Backporting Policies](https://access.redhat.com/security/updates/backporting/)
  + [Security Blog](//redhat.com/en/blog/channel/security)
* [Support](https://access.redhat.com/support/)
  ### [Red Hat Support](https://access.redhat.com/support/)

  + [Support Cases](https://access.redhat.com/support/cases/)
  + [Troubleshoot](https://access.redhat.com/support/cases/#/troubleshoot)
  + [Get Support](https://access.redhat.com/support/)
  + [Contact Red Hat Support](https://access.redhat.com/support/contact/)
  ### [Red Hat Community Support](https://access.redhat.com/community)

  + [Customer Portal Community](https://access.redhat.com/community/)
  + [Community Discussions](https://access.redhat.com/discussions/)
  + [Red Hat Accelerator Program](https://access.redhat.com/accelerators/)
  ### Top Resources

  + [Product Life Cycles](https://access.redhat.com/product-life-cycles/)
  + [Customer Portal Labs](https://access.redhat.com/labs/)
  + [Red Hat JBoss Supported Configurations](https://access.redhat.com/support/configurations/jboss)
  + [Red Hat Insights](https://cloud.redhat.com/insights)

Or [troubleshoot an issue](/support/cases/#/troubleshoot).

English

## Select Your Language

* [English](https://access.redhat.com/changeLanguage?language=en)
* [Franais](https://access.redhat.com/changeLanguage?language=fr)
* [](https://access.redhat.com/changeLanguage?language=ko)
* [](https://access.redhat.com/changeLanguage?language=ja)
* [ ()](https://access.redhat.com/changeLanguage?language=zh_CN)

### Infrastructure and Management

* [Red Hat Enterprise Linux](https://access.redhat.com/products/red-hat-enterprise-linux/)
* [Red Hat Satellite](https://access.redhat.com/products/red-hat-satellite/)
* [Red Hat Subscription Management](https://access.redhat.com/products/red-hat-subscription-management/)
* [Red Hat Insights](https://access.redhat.com/products/red-hat-insights/)
* [Red Hat Ansible Automation Platform](https://access.redhat.com/products/red-hat-ansible-automation-platform/)
### Cloud Computing

* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform)
* [Red Hat OpenStack Platform](https://access.redhat.com/products/red-hat-openstack-platform/)
* [Red Hat OpenShift](https://access.redhat.com/products/red-hat-openshift-container-platform/)
* [Red Hat OpenShift AI](https://access.redhat.com/products/red-hat-openshift-ai/)
* [Red Hat OpenShift Dedicated](https://access.redhat.com/products/openshift-dedicated-red-hat/)
* [Red Hat Advanced Cluster Security for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-security-for-kubernetes/)
* [Red Hat Advanced Cluster Management for Kubernetes](https://access.redhat.com/products/red-hat-advanced-cluster-management-for-kubernetes/)
* [Red Hat Quay](https://access.redhat.com/products/red-hat-quay/)
* [Red Hat OpenShift Dev Spaces](https://access.redhat.com/products/red-hat-openshift-dev-spaces)
* [Red Hat OpenShift Service on AWS](https://access.redhat.com/products/red-hat-openshift-service-aws)
### Storage

* [Red Hat Gluster Storage](https://access.redhat.com/products/red-hat-storage/)
* [Red Hat Hyperconverged Infrastructure](https://access.redhat.com/products/red-hat-hyperconverged-infrastructure/)
* [Red Hat Ceph Storage](https://access.redhat.com/products/red-hat-ceph-storage/)
* [Red Hat OpenShift Data Foundation](https://access.redhat.com/products/red-hat-openshift-data-foundation)
### Runtimes

* [Red Hat Runtimes](https://access.redhat.com/products/red-hat-runtimes/)
* [Red Hat JBoss Enterprise Application Platform](https://access.redhat.com/products/red-hat-jboss-enterprise-application-platform/)
* [Red Hat Data Grid](https://access.redhat.com/products/red-hat-data-grid/)
* [Red Hat JBoss Web Server](https://access.redhat.com/products/red-hat-jboss-web-server/)
* [Red Hat build of Keycloak](https://access.redhat.com/products/red-hat-build-of-keycloak/)
* [Red Hat support for Spring Boot](https://access.redhat.com/products/spring-boot/)
* [Red Hat build of Node.js](https://access.redhat.com/products/nodejs/)
* [Red Hat build of Quarkus](https://access.redhat.com/products/quarkus/)
### Integration and Automation

* [Red Hat Application Foundations](https://access.redhat.com/products/red-hat-application-foundations/)
* [Red Hat Fuse](https://access.redhat.com/products/red-hat-fuse/)
* [Red Hat AMQ](https://access.redhat.com/products/red-hat-amq/)
* [Red Hat 3scale API Management](https://access.redhat.com/products/red-hat-3scale/)

[All Products](https://access.redhat.com/products/)

**We're sorry but cve-details doesn't work properly without JavaScript enabled. Please enable it to continue.**

[![Red Hat](https://static.redhat.com/libs/redhat/brand-assets/2/corp/logo--on-dark.svg)](https://redhat.com/en)
[X (formerly Twitter)](https://twitter.com/RedHat)
### Quick Links

* [Downloads](https://access.redhat.com/downloads/)
* [Subscriptions](https://access.redhat.com/management)
* [Support Cases](https://access.redhat.com/support)
* [Customer Service](https://access.redhat.com/support/customer-service)
* [Product Documentation](//docs.redhat.com/)

### Help

* [Contact Us](https://access.redhat.com/support/contact/)
* [Customer Portal FAQ](https://access.redhat.com/articles/33844)
* [Log-in Assistance](https://access.redhat.com/help/login_assistance)

### Site Info

* [Trust Red Hat](https://www.redhat.com/en/trust)
* [Browser Support Policy](https://www.redhat.com/en/about/browser-support)
* [Accessibility](https://www.redhat.com/en/about/digital-accessibility)
* [Awards and Recognition](https://access.redhat.com/recognition/)
* [Colophon](https://access.redhat.com/help/colophon/)

### Related Sites

* [redhat.com](https://www.redhat.com/)
* [developers.redhat.com](http://developers.redhat.com/)
* [connect.redhat.com](https://connect.redhat.com/)
* [cloud.redhat.com](https://cloud.redhat.com/)

### Red Hat legal and privacy links

* [About Red Hat](https://redhat.com/en/about/company)
* [Jobs](https://redhat.com/en/jobs)
* [Events](https://redhat.com/en/events)
* [Locations](https://redhat.com/en/about/office-locations)
* [Contact Red Hat](https://redhat.com/en/contact)
* [Red Hat Blog](https://redhat.com/en/blog)
* [Diversity, equity, and inclusion](https://redhat.com/en/about/our-culture/diversity-equity-inclusion)
* [Cool Stuff Store](https://coolstuff.redhat.com/)
* [Red Hat Summit](https://www.redhat.com/en/summit)

  2025 Red Hat, Inc.
### Red Hat legal and privacy links

* [Privacy statement](https://redhat.com/en/about/privacy-policy)
* [Terms of use](https://redhat.com/en/about/terms-use)
* [All policies and guidelines](https://redhat.com/en/about/all-policies-guidelines)
* [Digital accessibility](https://redhat.com/en/about/digital-accessibility)



=== Content from bugzilla.redhat.com_03b4df7d_20250114_191733.html ===


* Login
  + Log in using an SSO provider:- [Fedora Account System](saml2_login.cgi?idp=Fedora%20Account%20System&target=show_bug.cgi%3Fid%3D2215268)
    - [Red Hat Associate](saml2_login.cgi?idp=Red%20Hat%20Associate&target=show_bug.cgi%3Fid%3D2215268)
    - [Red Hat Customer](saml2_login.cgi?idp=Red%20Hat%20Customer&target=show_bug.cgi%3Fid%3D2215268)+ Login using a Red Hat Bugzilla account
  + ForgotPassword
  + [Create an Account](createaccount.cgi)

Red Hat Bugzilla  Bug2215268

* [Home](./)
* [New](enter_bug.cgi)
* Search
  + [Simple Search](query.cgi?format=specific)
  + [Advanced Search](query.cgi?format=advanced)
* My Links
  + [Browse](describecomponents.cgi)
  + [Requests](request.cgi)
  + Reports
  + Current State
    - [Search](query.cgi)
    - [Tabular reports](query.cgi?format=report-table)
    - [Graphical reports](query.cgi?format=report-graph)
    - [Duplicates](duplicates.cgi)
  + Other Reports
    - [User Changes](https://bugzilla.redhat.com/page.cgi?id=user_activity.html)
  + Plotly Reports
    - [Bug Status](https://bugzilla.redhat.com/page.cgi?id=bug_status.html)
    - [Bug Severity](https://bugzilla.redhat.com/page.cgi?id=bug_severity.html)
    - [Non-Defaults](https://bugzilla.redhat.com/page.cgi?id=non_defaults.html)
* [Product Dashboard](page.cgi?id=productdashboard.html)

- Help
  * [Page Help!](docs/en/html/using/understanding.html)
  * [Bug Writing Guidelines](page.cgi?id=bug-writing.html)
  * [What's new](page.cgi?id=whats-new.html)
  * [Browser Support Policy](https://access.redhat.com/help/browsers)
  * [5.0.4.rh103 Release notes](page.cgi?id=release-notes.html)
  * [FAQ](page.cgi?id=faq.html)
  * [Guides index](docs/en/html/index.html)
  * [User guide](docs/en/html/using/index.html)
  * [Web Services](docs/en/html/integrating/api/Bugzilla/WebService/Bug.html)
  * [Contact](page.cgi?id=redhat/contact.html)
  * [Legal](page.cgi?id=terms-conditions.html)
- [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")

This site requires JavaScript to be enabled to function correctly, please enable it.

[**Bug2215268**](show_bug.cgi?id=2215268)
(CVE-2023-3269)
- [CVE-2023-3269](https://access.redhat.com/security/cve/CVE-2023-3269) kernel: distros-[DirtyVMA] Privilege escalation via non-RCU-protected VMA traversal

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
CVE-2023-3269 kernel: distros-[DirtyVMA] Privilege escalation via non-RCU-pro...

| | [Keywords](describekeywords.cgi): | Security | | --- | --- | | [Status](page.cgi?id=fields.html#bug_status): | CLOSED NOTABUG | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | CVE-2023-3269 | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components. Select a Classification to narrow down this list.") | Security Response | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Other | | [Component:](describecomponents.cgi?product=Security Response "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | vulnerability | | [Sub Component:](page.cgi?id=fields.html#rh_sub_components "The sub component of a specific component") | --- | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All | | [OS:](page.cgi?id=fields.html#op_sys "The operating system the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | Linux | | [Priority:](page.cgi?id=fields.html#priority) | high | | [Severity:](page.cgi?id=fields.html#bug_severity) | high | | [Target Milestone:](page.cgi?id=fields.html#target_milestone "The Target Milestone field is used to define when the engineer the bug is assigned to expects to fix it.") | --- | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Red Hat Product Security | | [QA Contact:](page.cgi?id=fields.html#qa_contact "The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.") |  | | [Docs Contact:](page.cgi?id=fields.html#docs_contact "The person responsible for documenting once the bug has been resolved.") |  | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Depends On:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") | [2219916](show_bug.cgi?id=2219916 "CLOSED ERRATA - CVE-2023-3269 kernel: distros-[DirtyVMA] Privilege escalation via non-RCU-protected VMA traversal [fedora-all]") [2221550](show_bug.cgi?id=2221550) [2221551](show_bug.cgi?id=2221551) [2221552](show_bug.cgi?id=2221552) [2221553](show_bug.cgi?id=2221553) [2221554](show_bug.cgi?id=2221554) [2221555](show_bug.cgi?id=2221555) [2221556](show_bug.cgi?id=2221556) [2221557](show_bug.cgi?id=2221557) [2221558](show_bug.cgi?id=2221558) | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [2215253](show_bug.cgi?id=2215253) | | TreeView+ | [depends on](buglist.cgi?bug_id=2215268&bug_id_type=anddependson&format=tvp) / [blocked](buglist.cgi?bug_id=2215268&bug_id_type=andblocked&format=tvp&tvp_dir=blocked) |  | |  | | [Reported:](page.cgi?id=fields.html#reporter) | 2023-06-15 09:04 UTC by Rohit Keshri | | --- | --- | | [Modified:](page.cgi?id=fields.html#modified) | 2023-07-17 14:28 UTC ([History](show_activity.cgi?id=2215268)) | | [CC List:](page.cgi?id=fields.html#cclist) | 51 users (show)  acaringi allarkin aquini bhu chwhite crwood dbohanno ddepaula debarbos dfreiber dvlasenk ezulian hkrzesin jarod jburrell jdenham jfaracco jferlan jforbes jlelli joe.lawrence jpoimboe jshortt jstancek jwyatt kcarcia kernel-mgr kpatch-maint ldoskova lgoncalv lleshchi lzampier nmurray ptalbert qzhao rhandlin rogbas rrobaina rvrbovsk rysulliv scweaver security-response-team tglozar tyberry vkumar walters wcosta williams wmealing ycote ymankad | | Fixed In Version: |  | | | Doc Type: | If docs needed, set a value | | | Doc Text: | A vulnerability exists in the memory management subsystem of the Linux kernel. The lock handling for accessing and updating virtual memory areas (VMAs) is incorrect, leading to use-after-free problems. This issue can be successfully exploited to execute arbitrary kernel code, escalate containers, and gain root privileges. | | | Clone Of: |  | | | Environment: |  | | | Last Closed: | 2023-07-05 23:01:17 UTC | | | Embargoed: |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | [(Terms of Use)](page.cgi?id=terms-conditions.html) | | | --- | --- | --- | |  | | | |  |
| --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=2215268#c0)  Rohit Keshri    2023-06-15 09:04:00 UTC  ``` A vulnerability exists in the memory management subsystem of the Linux kernel. The lock handling for accessing and updating virtual memory areas (VMAs) is incorrect, leading to use-after-free problems. This issue can be successfully exploited to execute arbitrary kernel code, escalate containers, and gain root privileges.   The BUG is introduced in conjunction with the introduction of the maple tree in kernel v6.1.  The maple tree, responsible for managing virtual memory areas, can undergo node replacement without properly acquiring the MM write lock, leading to use-after-free issues.  Upstream fix: <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=9471f1f2f50282b9e8f59198ec6bb738b4ccc009>   ```  [Comment 1](show_bug.cgi?id=2215268#c1)  Guilherme de Almeida Suckevicz    2023-07-05 18:35:25 UTC  ``` Created kernel tracking bugs for this issue:  Affects: fedora-all [[bug 2219916](show_bug.cgi?id=2219916 "CLOSED ERRATA - CVE-2023-3269 kernel: distros-[DirtyVMA] Privilege escalation via non-RCU-protected VMA traversal [fedora-all]")]   ```  [Comment 2](show_bug.cgi?id=2215268#c2)  Product Security DevOps Team    2023-07-05 23:01:14 UTC  ``` This bug is now closed. Further updates for individual products will be reflected on the CVE page(s):  <https://access.redhat.com/security/cve/cve-2023-3269>   ```  [Comment 3](show_bug.cgi?id=2215268#c3)  Rohit Keshri    2023-07-07 15:30:52 UTC  ``` There was no shipped RHEL kernel seen affected with this problem.  The StackRot vulnerability has been present in the Linux kernel since version 6.1 when the VMA tree structure was changed from red-black trees to maple trees.   ``` |  |
| --- | --- |

---

| Note You need to [log in](show_bug.cgi?id=2215268&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. |
| --- |

---

[Privacy](page.cgi?id=redhat/privacy.html)
[Contact](page.cgi?id=redhat/contact.html)
[FAQ](page.cgi?id=faq.html)
[Legal](page.cgi?id=terms-conditions.html)



=== Content from security.netapp.com_3624f1de_20250115_114216.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English


[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2023-3269 Linux Kernel Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20230908-0001)

## CVE-2023-3269 Linux Kernel Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close 

#### Subscribe to NTAP-20230908-0001 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20230908-0001 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close 

#### Unsubscribe from NTAP-20230908-0001 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20230908-0001 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20230908-0001
**Version:**
7.0

**Last updated:**
10/22/2024

**Status:**
Interim.

**CVEs:** CVE-2023-3269

Overview
#### Summary

Multiple NetApp products incorporate Linux kernel. Linux kernel versions prior to 6.5 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of sensitive information, addition or modification of data, or Denial of Service (DoS).

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2023-3269](https://nvd.nist.gov/vuln/detail/CVE-2023-3269) | 7.8 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

Affected Products
#### Affected Products

* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C

#### Products Under Investigation

* NetApp HCI Compute Node (Bootstrap OS)

#### Products Not Affected

* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A700s
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for Microsoft Windows
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* NetApp XCP NFS
* NetApp XCP SMB
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* System Manager 9.x

Remediation
#### Software Versions and Fixes

NetApp's currently available patches are listed below.

| **Product** | **First Fixed in Release** |
| --- | --- |
| **NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S** | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |
| **NetApp HCI Baseboard Management Controller (BMC) - H410C** | NetApp HCI Baseboard Management Controller (BMC) - H410C has no plans to address this vulnerability. See the [EOA announcement](https://mysupport.netapp.com/info/communications/ECMLP2876227.html) for more information. |

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20230908-0001>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20230908 | Initial Public Release |
| 2.0 | 20230918 | Brocade Fabric Operating System Firmware moved to Products Not Affected |
| 3.0 | 20231003 | NetApp SolidFire & HCI Storage Node (Element Software), NetApp SolidFire & HCI Management Node moved to Products Not Affected |
| 4.0 | 20231101 | NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S moved to Won't Fix status |
| 5.0 | 20231107 | NetApp HCI Baseboard Management Controller (BMC) - H410C moved to Won't Fix status |
| 6.0 | 20231117 | NetApp HCI Baseboard Management Controller (BMC) - H610C, NetApp HCI Baseboard Management Controller (BMC) - H610S and NetApp HCI Baseboard Management Controller (BMC) - H615C moved to Products Not Affected |
| 7.0 | 20241022 | AFF Baseboard Management Controller (BMC) - A700s moved to Products Not Affected |

This document is provided solely for informational purposes. All information is based upon NetApps current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp.  2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

   NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)


