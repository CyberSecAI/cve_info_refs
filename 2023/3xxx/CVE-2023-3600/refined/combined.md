=== Content from www.mozilla.org_78f2d8e5_20250114_191446.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-27

## Security Vulnerabilities fixed in Thunderbird 115.0.1

Announced
July 20, 2023
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 115.0.1

#### [#CVE-2023-3600: Use-after-free in workers](#CVE-2023-3600)

Reporter
Andrew McCreight
Impact
high
##### Description

During the worker lifecycle, a use-after-free condition could have occured, which could have led to a potentially exploitable crash.

##### References

* [Bug 1839703](https://bugzilla.mozilla.org/show_bug.cgi?id=1839703)

#### [#CVE-2023-3417: File Extension Spoofing using the Text Direction Override Character](#CVE-2023-3417)

Reporter
이준성 (Junsung Lee)
Impact
moderate
##### Description

Thunderbird allowed the Text Direction Override Unicode Character in filenames.
An email attachment could be incorrectly shown as being a document file, while in
fact it was an executable file. Newer versions of Thunderbird will strip the character
and show the correct file extension.

##### References

* [Bug 1835582](https://bugzilla.mozilla.org/show_bug.cgi?id=1835582)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_c01a3986_20250114_191445.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-26

## Security Vulnerabilities fixed in Firefox 115.0.2 and Firefox ESR 115.0.2

Announced
July 11, 2023
Impact
high
Products
Firefox, Firefox ESR
Fixed in

* Firefox 115.0.2
* Firefox ESR 115.0.2

#### [#CVE-2023-3600: Use-after-free in workers](#CVE-2023-3600)

Reporter
Andrew McCreight
Impact
high
##### Description

During the worker lifecycle, a use-after-free condition could have occured, which could have led to a potentially exploitable crash.

##### References

* [Bug 1839703](https://bugzilla.mozilla.org/show_bug.cgi?id=1839703)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_851b0e39_20250114_191443.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1839703)
* [XML](/show_bug.cgi?ctype=xml&id=1839703)

Closed
[Bug 1839703](/show_bug.cgi?id=1839703)
(CVE-2023-3600)

Opened 2 years ago
Closed 1 years ago

# Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]

## Categories

### (Core :: DOM: Workers, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Workers#DOM%3A%20Workers)

DOM: Workers
▾

Core :: DOM: Workers
This component covers the [Web Workers](https://developer.mozilla.org/En/DOM/Worker) implementation in Gecko.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Workers&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Workers)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Windows 11

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

116 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| a11y-review | --- |
| --- | --- |
| Webcompat Priority | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |
| Webcompat Score | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=unaffected) |
| firefox-esr115 | [116+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=116%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox114 | --- | [unaffected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=unaffected) |
| firefox115 | [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B) | [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix) |
| firefox116 | [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | unaffected |
| firefox-esr115 | 116+ | fixed |
| firefox-esr128 | --- | --- |
| firefox114 |  | unaffected |
| firefox115 | + | wontfix |
| firefox116 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: mccr8, Assigned: jesup)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/ae002109ba1cfbb7f5ad990cc5d9fbaf?d=mm&size=40)  [jesup](/user_profile?user_id=11539)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=40)  [mccr8](/user_profile?user_id=406194)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/056757eff6ed7c8ec26f61e3bf7695fe?d=mm&size=40)  [smaug](/user_profile?user_id=39966)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

15 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

[1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms")

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

Dependency [tree](/showdependencytree.cgi?id=1839703&hide_resolved=1)
/ [graph](/showdependencygraph.cgi?id=1839703)

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[1840136](/show_bug.cgi?id=1840136 "RESOLVED DUPLICATE - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"), [1840922](/show_bug.cgi?id=1840922 "RESOLVED DUPLICATE - Crash in [@ CallbackHolder::CallbackHolder::<T>::operator()]"), [1841123](/show_bug.cgi?id=1841123 "RESOLVED DUPLICATE - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1840922](/show_bug.cgi?id=1840922 "RESOLVED DUPLICATE - Crash in [@ CallbackHolder::CallbackHolder::<T>::operator()]"), [1836607](/show_bug.cgi?id=1836607 "RESOLVED FIXED - Intermittent FetchStreamReader not thread-safe [@ libxul.so + 0x000000000026ff1b] | single tracking bug")

[1842190](/show_bug.cgi?id=1842190 "NEW - Make some refcount asserts DIAGNOSTIC to catch attempts to add refs to an e5e5... refcount")

## Details

### (4 keywords, Whiteboard: [adv-main115.0.2+][adv-esr115.0.2+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-3600

[Keywords:](/describekeywords.cgi)

[crash](/buglist.cgi?keywords=crash&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main115.0.2+][adv-esr115.0.2+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [avaida](/user_profile?user_id=488993) | [qe-verify](#a1681430_488993 "2 years ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

[[@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator() ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Aipc%3A%3ADataPipeReceiver%3A%3AAsyncWait%3A%3A%3CT%3E%3A%3Aoperator%28%29)

[[@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Aipc%3A%3ADataPipeReceiver%3A%3AAsyncWait%3A%3A%3CT%3E%3A%3A~)

[[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Aipc%3A%3ADataPipeReceiver%3A%3AAsyncWait%3A%3A%24%3A%3A~%24_0)

[[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_7 ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Aipc%3A%3ADataPipeReceiver%3A%3AAsyncWait%3A%3A%24%3A%3A~%24_7)

[[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]](https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Aipc%3A%3ADataPipeReceiver%3A%3AAsyncWait%3A%3A%24%3A%3Aoperator%28%29)

[[@ CallbackHolder::CallbackHolder::<T>::operator() ]](https://crash-stats.mozilla.org/signature/?signature=CallbackHolder%3A%3ACallbackHolder%3A%3A%3CT%3E%3A%3Aoperator%28%29)

[[@ nsCOMPtr<T>::~nsCOMPtr | CallbackHolder::CallbackHolder::<T>::~ ]](https://crash-stats.mozilla.org/signature/?signature=nsCOMPtr%3CT%3E%3A%3A~nsCOMPtr%20%7C%20CallbackHolder%3A%3ACallbackHolder%3A%3A%3CT%3E%3A%3A~)

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (1 file)

| [Bug 1839703: Move worker create into an Init() method r=nika](/attachment.cgi?id=9341791)  [2 years ago](#c17)  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)   48 bytes, text/x-phabricator-request | dmeehan : [approval-mozilla-release+](#c25 "2 years ago")  dmeehan : [approval-mozilla-esr115+](#c25 "2 years ago")  RyanVM : [sec-approval+](#a722557_75935 "2 years ago") | [Details](/attachment.cgi?id=9341791&action=edit) | [Review](/attachment.cgi?id=9341791) |
| --- | --- | --- |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1839703#c0)• 2 years ago |
|  | |

Crash report: <https://crash-stats.mozilla.org/report/index/85986019-c55b-471d-a851-e951d0230621>

Reason: `EXCEPTION_ACCESS_VIOLATION_READ`

Top 10 frames of crashing thread:

```
0  xul.dll  mozilla::ipc::DataPipeReceiver::AsyncWait::<lambda_8>::operator const  ipc/glue/DataPipe.cpp:660
0  xul.dll  NS_NewCancelableRunnableFunction<`lambda at /builds/worker/checkouts/gecko/ipc/glue/DataPipe.cpp:656:23'>::FuncCancelableRunnable::Run  xpcom/threads/nsThreadUtils.h:667
1  xul.dll  mozilla::dom::  dom/workers/WorkerPrivate.cpp:202
2  xul.dll  mozilla::dom::WorkerRunnable::Run  dom/workers/WorkerRunnable.cpp:377
3  xul.dll  nsThread::ProcessNextEvent  xpcom/threads/nsThread.cpp:1234
3  xul.dll  NS_ProcessNextEvent  xpcom/threads/nsThreadUtils.cpp:479
4  xul.dll  mozilla::dom::WorkerPrivate::DoRunLoop  dom/workers/WorkerPrivate.cpp:3287
5  xul.dll  mozilla::dom::workerinternals::  dom/workers/RuntimeService.cpp:2149
6  xul.dll  nsThread::ProcessNextEvent  xpcom/threads/nsThread.cpp:1234
6  xul.dll  NS_ProcessNextEvent  xpcom/threads/nsThreadUtils.cpp:479

```

13 crashes on this signature, mostly on poison values. All of them are on workers.

The crash is on this line: `callback->OnInputStreamReady(self);`

Both `callback` and `self` are strong references held by the callback, so I'm not sure how we can have a UAF here.

Also odd is that this crash is only showing up on 115b7 and 115b8.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1839703#c1)• 2 years ago |
|  | |

Nika, any ideas? Maybe we're actually crashing inside OnInputStreamReady somehow and it isn't showing up in the stack?

Keywords: [csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a415_406194)• 2 years ago |

[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1839703#c2)• 2 years ago |
|  | |

By looking for UAF crashes with ExternalRunnableWrapper in the proto signature, I found a few similar crashes. They are much rarer than this one.

[bp-f8a735c1-927a-43f8-a1c8-e966e0230621](https://crash-stats.mozilla.org/report/index/f8a735c1-927a-43f8-a1c8-e966e0230621)

[bp-82fd3618-b172-4faf-b16f-d74ef0230620](https://crash-stats.mozilla.org/report/index/82fd3618-b172-4faf-b16f-d74ef0230620)

|  | [Jens Stutte [:jstutte]](/user_profile?user_id=646284) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1839703#c3)• 2 years ago |
|  | |

Hi Eden, did we uplift something to 115.0b7 that might be relevant?

Flags: needinfo?(echuang)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a189601_406194)• 2 years ago |

Duplicate of this bug: [1840136](/show_bug.cgi?id=1840136 "RESOLVED DUPLICATE - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]")

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1839703#c5)• 2 years ago |
|  | |

No, we did not upflit something to 115.0b7.

Flags: needinfo?(echuang)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a501361_8340)• 2 years ago |

Severity: -- → S3Priority: -- → P2

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1839703#c6)• 2 years ago |
|  | |

It is possible the compiler is just doing something different so this top frame actually shows up correctly now. Also present on 115b9 but still nowhere else.

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1839703#c7)• 2 years ago |
|  | |

The severity field for this bug is set to S3. However, the bug is flagged with the `sec-high` keyword.

:janv, could you consider increasing the severity of this security bug?

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#severity_high_security.py).

Flags: needinfo?(jvarga)

|  | [Jan Varga [:janv]](/user_profile?user_id=8340) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a584741_8340)• 2 years ago |

Severity: S3 → S2Flags: needinfo?(jvarga)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1839703#c8)• 2 years ago |
|  | |

I'm seeing another signature that looks very similar, [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ]: [bp-74c98a3e-dcdf-4c7c-bedb-0b2560230628](https://crash-stats.mozilla.org/report/index/74c98a3e-dcdf-4c7c-bedb-0b2560230628)

Crash Signature: [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] → [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1839703#c9)• 2 years ago |
|  | |

Two more variations (rarer)

[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [bp-cc5073a5-87e7-410b-a543-be7450230625](https://crash-stats.mozilla.org/report/index/cc5073a5-87e7-410b-a543-be7450230625)

[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ] [bp-3791f9ad-0ccd-4372-87e6-5887d0230627](https://crash-stats.mozilla.org/report/index/3791f9ad-0ccd-4372-87e6-5887d0230627)

Crash Signature: [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] → [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1839703#c10)• 2 years ago |
|  | |

I won't add the signature because it doesn't look exactly the same, but these [@ CallbackHolder::CallbackHolder::<T>::operator() ] crashes look similar: showing up heavily on 115, on a worker thread, happening on the access of a strong pointer in the closure of a lambda on a callback.

[bp-1dae6e84-81a5-4113-91a5-8cdef0230628](https://crash-stats.mozilla.org/report/index/1dae6e84-81a5-4113-91a5-8cdef0230628)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a612795_406194)• 2 years ago |

See Also: → [1840922](/show_bug.cgi?id=1840922 "RESOLVED DUPLICATE - Crash in [@ CallbackHolder::CallbackHolder::<T>::operator()]")

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1839703#c11)• 2 years ago |
|  | |

I filed a separate bug for the CallbackHolder crashes.

|  | [Eden Chuang[:edenchuang]](/user_profile?user_id=516138) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1839703#c12)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1839703&comment_id=16476474 "2 revisions") |
|  | |

It is a bit hard to get helpful information from the crash stack.

I am not sure if there could be [a race between creating the CancelableRunnable and releasing the nsIInputStreamCallback](https://searchfox.org/mozilla-central/rev/3b707c8fd7e978eebf24279ee51ccf07895cfbcb/ipc/glue/DataPipe.cpp#656)

|  | [Valentin Gosu [:valentin] (he/him)](/user_profile?user_id=415378) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a690335_415378)• 2 years ago |

Duplicate of this bug: [1841123](/show_bug.cgi?id=1841123 "RESOLVED DUPLICATE - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]")

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1839703#c14)• 2 years ago |
|  | |

I've found one place where we could end up with a crash like this so far. In the `InputStreamHolder` constructor we attempt to create a `StrongWorkerRef` which take sa strong reference to `this`: <https://searchfox.org/mozilla-central/rev/3b707c8fd7e978eebf24279ee51ccf07895cfbcb/dom/streams/UnderlyingSourceCallbackHelpers.cpp#171-179>. If this fails for whatever reason, then we will end up destroying the callback `aCallback` when leaving the constructor, causing the object to be `delete`-ed during the constructor. This could easily lead to a UAF like the one we're seeing here.

I'm not sure if it's the root cause of the issue here, but I think it would cause these symptoms.

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1839703#c15)• 2 years ago |
|  | |

To fix this we'd want to move the logic which creates the strong worker ref out of the `InputStreamHolder` constructor, to a separate function, so that we can make sure to already be holding a reference before it has a chance to fail.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1839703#c16)• 2 years ago |
|  | |

Oh yes, and any error in the constructor should not be silently ignored after all. Nice catch.

Should `RefPtr{this}` be statically prevented in the constructor?

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1839703#c17)• 2 years ago |
|  | |

Attached file
[Bug 1839703: Move worker create into an Init() method r=nika](attachment.cgi?id=9341791)
— [Details](attachment.cgi?id=9341791&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a694702_600971)• 2 years ago |

Assignee: nobody → rjesupStatus: NEW → ASSIGNED

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1839703#c18)• 2 years ago |
|  | |

Comment on [attachment 9341791](/attachment.cgi?id=9341791 "Bug 1839703: Move worker create into an Init() method r=nika") [[details]](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika")

[Bug 1839703](/show_bug.cgi?id=1839703 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"): Move worker create into an Init() method r=nika

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Pretty hard, even if you know it's a sec issue. The relationship to workers is there; you'd have to guess that it was due to possible failure to Create. And then you'd have to figure out how to trigger it. Not impossible, though.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: 115 only it appears, though 114 in theory might be affected
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: No
* **If not, how different, hard to create, and risky will they be?**: Trivial to create if needed. We have no crashes in 114, so I think it might happen to be immune. 116 is unaffected, though the latent bug is there
* **How likely is this patch to cause regressions; how much testing does it need?**: Very unlikely to regress
* **Is Android affected?**: Yes

### Beta/Release Uplift Approval Request

* **User impact if declined**: We'll want this in 115 release next week, or in 115.0.1
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: Twitch has turned off the WebTransport code that triggered this. (It was left on accidentally)
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Low risk
* **String changes made/needed**: none
* **Is Android affected?**: Yes
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: sec-approval?
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release?

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1839703#c19)• 2 years ago |
|  | |

(In reply to Jens Stutte [:jstutte] from [comment #3](/show_bug.cgi?id=1839703#c3 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"))

> Hi Eden, did we uplift something to 115.0b7 that might be relevant?

I believe beta 7 is when all the EARLY\_BETA\_OR\_EARLIER features switch off. Things might be going great up to that point and that's when we find out someone merged something that depends on "nightly-only" code changes and doesn't work with the code/settings we're actually shipping. EARLY\_BETA\_OR\_EARLIER is a cursed temptation: use sparingly

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1839703#c20)• 2 years ago |
|  | |

Comment on [attachment 9341791](/attachment.cgi?id=9341791 "Bug 1839703: Move worker create into an Init() method r=nika") [[details]](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika")

[Bug 1839703](/show_bug.cgi?id=1839703 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"): Move worker create into an Init() method r=nika

sec-approval+ = dveditz

Please work w/Release managers on uplift. OK to land on nightly 116 now either way.

[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a722557_75935)• 2 years ago |

[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: sec-approval?
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: sec-approval+
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release?
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a722662_75935)• 2 years ago |

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix)
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [unaffected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=unaffected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox115](/buglist.cgi?f1=cf_tracking_firefox115&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B)
[tracking-firefox116](/buglist.cgi?f1=cf_tracking_firefox116&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [115+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=115%2B)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1839703#c21)• 2 years ago |
|  | |

Move worker create into an Init() method r=nika

<https://hg.mozilla.org/integration/autoland/rev/878cb82fefe45fbd753bf9df19c7b44691234fdc>

<https://hg.mozilla.org/mozilla-central/rev/878cb82fefe4>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 2 years ago
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 116 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1839703#c22)• 2 years ago |
|  | |

The patch landed in nightly and beta is affected.

:jesup, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox115` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(rjesup)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a763229_11539)• 2 years ago |

Flags: needinfo?(rjesup)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1364046_11539)• 2 years ago |

Duplicate of this bug: [1840922](/show_bug.cgi?id=1840922 "RESOLVED DUPLICATE - Crash in [@ CallbackHolder::CallbackHolder::<T>::operator()]")

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1364738_11539)• 2 years ago |

See Also: → [1842190](/show_bug.cgi?id=1842190 "NEW - Make some refcount asserts DIAGNOSTIC to catch attempts to add refs to an e5e5... refcount")

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1839703#c24)• 2 years ago |
|  | |

Copying crash signatures from duplicate bugs.

Crash Signature: [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ] → [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]
[@ CallbackHolder::…

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1839703#c25)• 2 years ago |
|  | |

Comment on [attachment 9341791](/attachment.cgi?id=9341791 "Bug 1839703: Move worker create into an Init() method r=nika") [[details]](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika")

[Bug 1839703](/show_bug.cgi?id=1839703 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"): Move worker create into an Init() method r=nika

Approved for 115.0.2

Approved for 115.0.2esr

[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release?
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-release+
[Attachment #9341791](/attachment.cgi?id=9341791&action=edit "Bug 1839703: Move worker create into an Init() method r=nika") -
Flags: approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1839703#c26)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/6a1bd37c214e>

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1638022_695136)• 2 years ago |

Crash Signature: [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]
[@ CallbackHolder::… → [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]
[@ CallbackHolder:…
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1639843_578488)• 2 years ago |

Alias: CVE-2023-3600

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1839703#c27)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/7c3a2326c53a>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1839703#c28)• 2 years ago |
|  | |

The only one of these signature that appears before 115 is `CallbackHolder::CallbackHolder::<T>::operator()`, with 5 crashes in 114, 6 crashes in 113, and 9 crashes in 107-111. Almost all of those were on the Main Thread while all the >=115.0b7 crashes are on the DOM Worker thread. Safe to call 114 "unaffected" rather than imply this was a danger there.

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
[wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix) → [unaffected](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=unaffected)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1642487_1689)• 2 years ago |

Whiteboard: [adv-main115.0.2+][adv-esr115.0.2+]

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1644004_695136)• 2 years ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1839703#c29)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/4998d404a895>

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1681430_488993)• 2 years ago |

Flags: qe-verify-

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1839703#c30)• 2 years ago |
|  | |

:jesup there are still some reports from 115.0.2 which includes the patch

Flags: needinfo?(rjesup)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1839703#c31)• 2 years ago |
|  | |

I looked through the classes on m-c that have `nsCOMPtr<nsIInputStreamCallback>` and didn't see any misuses of `this` in their ctor. I guess I should check subclasses of nsIInputStreamCallback, too. Also looking at release specifically might be better, because maybe the relevant class got deleted or incidentally changed and that's why it went away.

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194)  Reporter |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1839703#c32)• 2 years ago |
|  | |

I looked through the subclasses of nsIInputStreamCallback on release and I didn't see any other dodgy uses of `this` in ctors.

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1839703#c33)• 2 years ago |
|  | |

I'm on PTO, though I'll try to look at this as I have time. NI'ing some other people who might have ideas what's causing this. Certainly what we fixed and uplifted here should have fixed any problem from that constructor, which had seemed like a reasonable guess as to a cause (it might cause something like this), but these continuing reports imply that's NOT the source of the problem (or not the only source).

Flags: needinfo?(smaug)Flags: needinfo?(rjesup)Flags: needinfo?(nika)Flags: needinfo?(krosylight)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1839703#c34)• 2 years ago |
|  | |

Reopening, since it's still happening.

Status: RESOLVED → REOPENEDResolution: FIXED → ---

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1839703#c35)• 2 years ago |
|  | |

The bug is linked to topcrash signatures, which match the following [criterion](https://wiki.mozilla.org/CrashKill/Topcrash):

* Top 10 content process crashes on release

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#topcrash_highlight.py).

Keywords: [topcrash](/buglist.cgi?keywords=topcrash&resolution=---)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a1901987_75935)• 2 years ago |

Status: REOPENED → ASSIGNED
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed) → [wontfix](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=wontfix)
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[115+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=115%2B) → [?](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=%3F)Target Milestone: 116 Branch → ---

|  | [Olli Pettay [:smaug][bugs@pettay.fi]](/user_profile?user_id=39966) |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1839703#c36)• 2 years ago |
|  | |

Have we seen this on 116 or 117?

krosylight, I think some of UnderlyingSourceCallbackHelpers.cpp changed recently.

Is it possible that we now keep mInput alive longer or something when calling some method on it and on 115 we somehow release mInput at wrong time? (just pondering about options here)

Flags: needinfo?(smaug)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1839703#c37)• 2 years ago |
|  | |

Oh, indeed it's not in 116 beta, interesting. Per the commit list:

Today's beta: <https://hg.mozilla.org/releases/mozilla-beta/log/878cb82fefe45fbd753bf9df19c7b44691234fdc/dom/streams/UnderlyingSourceCallbackHelpers.cpp>

Today's release: <https://hg.mozilla.org/releases/mozilla-release/log/6a1bd37c214e0d0bb321ea0f7244583f45c81a63/dom/streams/UnderlyingSourceCallbackHelpers.cpp>

Only [bug 1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") and [bug 1811440](/show_bug.cgi?id=1811440 "RESOLVED FIXED - Fix BodyStream to support actual Bring-Your-Own-Buffer(BYOB)"). IMO [bug 1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") shouldn't affect DataPipeReceiver usage so it's only [bug 1811440](/show_bug.cgi?id=1811440 "RESOLVED FIXED - Fix BodyStream to support actual Bring-Your-Own-Buffer(BYOB)"), which did change some mInput handling, specifically it added a cautious `if (mInput)` check before calling `AsyncWait()`: <https://searchfox.org/mozilla-central/rev/2d06b7d5fbfa7a31776389da87c5f895b80df8d9/dom/streams/UnderlyingSourceCallbackHelpers.cpp#306-316>

But not sure that matters here as we are crashing on e5e5 and not a null pointer. 🤔

Flags: needinfo?(krosylight)

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1839703#c38)• 2 years ago |
|  | |

(In reply to Kagami [:saschanaz] from [comment #37](/show_bug.cgi?id=1839703#c37 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"))

> Only [bug 1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") and [bug 1811440](/show_bug.cgi?id=1811440 "RESOLVED FIXED - Fix BodyStream to support actual Bring-Your-Own-Buffer(BYOB)"). IMO [bug 1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") shouldn't affect DataPipeReceiver usage so it's only [bug 1811440](/show_bug.cgi?id=1811440 "RESOLVED FIXED - Fix BodyStream to support actual Bring-Your-Own-Buffer(BYOB)"), which did change some mInput handling, specifically it added a cautious `if (mInput)` check before calling `AsyncWait()`: <https://searchfox.org/mozilla-central/rev/2d06b7d5fbfa7a31776389da87c5f895b80df8d9/dom/streams/UnderlyingSourceCallbackHelpers.cpp#306-316>
>
> But not sure that matters here as we are crashing on e5e5 and not a null pointer. 🤔

Looking at bug 11811882, that patch does end up removing `BodyStream`, which does implement `nsIInputStreamCallback` (<https://searchfox.org/mozilla-release/rev/9eef5f03dfa0edffe746121c05e51583c88439fd/dom/base/BodyStream.h#75>), so it's definitely a potential culprit if there's some reference counting issue which could lead to the `BodyStream` type being destroyed early while there's still an outstanding reference from `AsyncWait`. I don't quite know what that situation would be off the top of my head though unfortunately, and I don't see any sketchy looking reference counting in the class on first glance, unless it is used from the wrong thread in some error case.

I also did a quick scan over the changes in [bug 1811440](/show_bug.cgi?id=1811440 "RESOLVED FIXED - Fix BodyStream to support actual Bring-Your-Own-Buffer(BYOB)"), and didn't see anything which stuck out like a sore thumb, though it might just be that the specific code path which is triggering the issue ended up changing to using some other mechanism which isn't vulnerable to the same issue. I'm unsure.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1839703#c39)• 2 years ago |
|  | |

My understanding is that DataPipeReceiver is specifically for WebTransport and can only be used there..............

Oh wait, one can pass DataPipeReceiver-based WebTransportReceiveStream to `new Response()` and then Fetch will extract the pipe [here](https://searchfox.org/mozilla-central/rev/2d06b7d5fbfa7a31776389da87c5f895b80df8d9/dom/fetch/Response.cpp#293-298) (which was [here](https://searchfox.org/mozilla-release/rev/9eef5f03dfa0edffe746121c05e51583c88439fd/dom/fetch/Response.cpp#293-303) in pre-116) and then BodyStream would get the access to DataPipeReceiver.

But yeah, not sure what could be a problem in BodyStream. Something to take a good look at.

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1839703#c40)• 2 years ago |
|  | |

(But wouldn't we get tons of similar errors from other nsIInputStreams if BodyStream was the culprit? It can extract nsIInputStream from blob for example and there's a good established pattern to do so e.g. `new Response(blob).text()`.)

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1839703#c41)• 2 years ago |
|  | |

One notable difference between BodyStream and InputToReadableStreamAlgorithms is that worker shutdown won't close the DOM stream (although both close the corresponding nsIInputStream). Still not sure what could happen by that...

|  | [Nika Layzell [:nika] (ni? for response)](/user_profile?user_id=534482) |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1839703#c42)• 1 years ago |
|  | |

One of the big differences between `DataPipeReceiver` and other stream types might be when callbacks like `AsyncWait` happen. Unlike other streams, the data is made available by a completely different process at arbitrary times, so if we don't close down the DOM stream (as you note) we could e.g. receive notifications much later during the object's lifecycle than it would normally expect for an in-process stream? That being said, I don't know if that's the culprit, and I haven't seen code which could lead to this kind of issue.

Maybe we have some issue with the logic in `BodyStream::ReleaseObjects` (<https://searchfox.org/mozilla-release/rev/9eef5f03dfa0edffe746121c05e51583c88439fd/dom/base/BodyStream.cpp#553-554>) which destroys both a reference to `this` and `mStreamHolder` before returning from the function? I don't know how we'd end up setting up an `AsyncWait` after this point though, especially given that we'd need to have the `mInputStream` reference around to call `AsyncWait` with (<https://searchfox.org/mozilla-release/rev/9eef5f03dfa0edffe746121c05e51583c88439fd/dom/base/BodyStream.cpp#218>).

(In reply to Kagami [:saschanaz] from [comment #39](/show_bug.cgi?id=1839703#c39 "RESOLVED FIXED - Crash in [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()]"))

> My understanding is that DataPipeReceiver is specifically for WebTransport and can only be used there..............

No, `DataPipeReceiver` is an IPC primitive type used for all kinds of `nsIInputStream` IPC. We've been focused on `WebTransport` because of the more recent changes there, and it using `DataPipeReceiver` in a bare fashion, but it's also used to send normal `IPCStream` data between processes (<https://searchfox.org/mozilla-central/rev/7a4c08f2c3a895c9dc064734ada320f920250c1f/ipc/glue/InputStreamParams.ipdlh#56>), as the fallback case for sending non-serializable pipes.

It's unfortunately quite possible for just about any listener to be potentially listening to a `DataPipeReceiver` if they are dealing with a stream sent over IPC. We definitely shouldn't be limiting our search to only `WebTransport` code.

Flags: needinfo?(nika)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a2417407_690067)• 1 years ago |

See Also: → [1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms")

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1839703#c43)• 1 years ago |
|  | |

Kagami -- given we believe your change in 116 makes this go away, can you look at what it might be about that patch that either fixes or avoids this failure? If it only avoids it, we may have a latent bug still there waiting for some future change to show up again. And we can't avoid doing the bad thing in the future (or fix the underlying bug) if we don't know what causes this.

Thanks!

Flags: needinfo?(krosylight)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a2886222_11539)• 1 years ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=unaffected)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [unaffected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=unaffected)
[tracking-firefox116](/buglist.cgi?f1=cf_tracking_firefox116&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B) → ---
[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
[+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) → ---

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1839703#c44)• 1 years ago |
|  | |

Still have no idea.

What I can newly note is that BodyStream::Close could skip closing any streams at all: <https://searchfox.org/mozilla-release/source/dom/base/BodyStream.cpp#504-507>

So it was possible for an nsIInputStream to call on a closed BodyStream, but that doesn't really explain UAF.

The only possible owner of BodyStream is nsIInputStreams and BodyStreamHolder, which is FetchBody. Can FetchBody be UAF-ed like InputStreamHolder once was? 🤷🏻‍♀️

Flags: needinfo?(krosylight)

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1839703#c45)• 1 years ago |
|  | |

Crashes all continue to be 115.\*

|  | [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)  Assignee |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1839703#c46)• 1 years ago |
|  | |

One thing we should be careful about: making sure 116 didn't change the signature of problems. Quite likely it didn't, but since we don't have a string candidate for the actual bug, it's smart to be cautious

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1839703#c47)• 1 years ago |
|  | |

Calling this fixed by [bug 1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") as we haven't seen any crashes in 116.\* or 115.1esr since they shipped. This bug has already gotten pretty messy for tracking, so I would suggest that any further work happen in a new bug for the sake of better tracking.

Status: ASSIGNED → RESOLVEDClosed: 2 years ago → 1 years ago
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=unaffected) → [fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[unaffected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=unaffected) → ---
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)
[tracking-firefox116](/buglist.cgi?f1=cf_tracking_firefox116&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=%3F) → [116+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=116%2B)Depends on: [1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms")Resolution: --- → FIXEDSee Also: [1811882](/show_bug.cgi?id=1811882 "RESOLVED FIXED - Merge BodyStream and InputToReadableStreamAlgorithms") → Target Milestone: --- → 116 Branch

|  | [Kagami Rosylight [:saschanaz] (they/them)](/user_profile?user_id=473060) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a4123922_473060)• 1 years ago |

See Also: → [1836607](/show_bug.cgi?id=1836607 "RESOLVED FIXED - Intermittent FetchStreamReader not thread-safe [@ libxul.so + 0x000000000026ff1b] | single tracking bug")

|  | [Chris Peterson [:cpeterson]](/user_profile?user_id=430528) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a4142211_430528)• 1 years ago |

Crash Signature: [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::operator() ]
[@ CallbackHolder:… → [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::operator()] [@ mozilla::ipc::DataPipeReceiver::AsyncWait::<T>::~ ]
[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_0 ]
[@ mozilla::ipc::DataPipeReceiver::AsyncWait::$::~$\_7 ]
[@ mozilla::ipc::DataP…

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839703#a16983289_1689)• 1 year ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1839703&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Randell Jesup [:jesup] (needinfo me)](/user_profile?user_id=11539)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


