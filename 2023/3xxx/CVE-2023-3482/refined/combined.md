=== Content from security.gentoo.org_897e22ca_20250114_220705.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
Security

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Stay informed](/subscribe)
* [Advisories](/glsa)

# Mozilla Firefox: Multiple Vulnerabilities — GLSA **202401-10**

Multiple vulnerabilities have been found in Mozilla Firefox, the worst of which could lead to remote code execution.

### Affected packages

| Package | **www-client/firefox** on all architectures |
| --- | --- |
| Affected versions | < **121.0**< **115.6.0** |
| Unaffected versions | >= **121.0**>= **115.6.0** |

| Package | **www-client/firefox-bin** on all architectures |
| --- | --- |
| Affected versions | < **121.0**< **115.6.0** |
| Unaffected versions | >= **121.0**>= **115.6.0** |

### Background

Mozilla Firefox is a popular open-source web browser from the Mozilla project.

### Description

Multiple vulnerabilities have been discovered in Mozilla Firefox. Please review the CVE identifiers referenced below for details.

### Impact

Please review the referenced CVE identifiers for details.

### Workaround

There is no known workaround at this time.

### Resolution

All Mozilla Firefox ESR binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-115.6.0:esr"

```

All Mozilla Firefox ESR users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-115.6.0:esr"

```

All Mozilla Firefox binary users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-bin-121.0:rapid"

```

All Mozilla Firefox users should upgrade to the latest version:

```
 # emerge --sync
 # emerge --ask --oneshot --verbose ">=www-client/firefox-121.0:rapid"

```
### References

* [CVE-2023-3482](https://nvd.nist.gov/vuln/detail/CVE-2023-3482)
* [CVE-2023-4058](https://nvd.nist.gov/vuln/detail/CVE-2023-4058)
* [CVE-2023-4579](https://nvd.nist.gov/vuln/detail/CVE-2023-4579)
* [CVE-2023-4863](https://nvd.nist.gov/vuln/detail/CVE-2023-4863)
* [CVE-2023-5129](https://nvd.nist.gov/vuln/detail/CVE-2023-5129)
* [CVE-2023-5170](https://nvd.nist.gov/vuln/detail/CVE-2023-5170)
* [CVE-2023-5172](https://nvd.nist.gov/vuln/detail/CVE-2023-5172)
* [CVE-2023-5173](https://nvd.nist.gov/vuln/detail/CVE-2023-5173)
* [CVE-2023-5175](https://nvd.nist.gov/vuln/detail/CVE-2023-5175)
* [CVE-2023-5722](https://nvd.nist.gov/vuln/detail/CVE-2023-5722)
* [CVE-2023-5723](https://nvd.nist.gov/vuln/detail/CVE-2023-5723)
* [CVE-2023-5729](https://nvd.nist.gov/vuln/detail/CVE-2023-5729)
* [CVE-2023-5731](https://nvd.nist.gov/vuln/detail/CVE-2023-5731)
* [CVE-2023-5758](https://nvd.nist.gov/vuln/detail/CVE-2023-5758)
* [CVE-2023-6135](https://nvd.nist.gov/vuln/detail/CVE-2023-6135)
* [CVE-2023-6210](https://nvd.nist.gov/vuln/detail/CVE-2023-6210)
* [CVE-2023-6211](https://nvd.nist.gov/vuln/detail/CVE-2023-6211)
* [CVE-2023-6213](https://nvd.nist.gov/vuln/detail/CVE-2023-6213)
* [CVE-2023-6856](https://nvd.nist.gov/vuln/detail/CVE-2023-6856)
* [CVE-2023-6857](https://nvd.nist.gov/vuln/detail/CVE-2023-6857)
* [CVE-2023-6858](https://nvd.nist.gov/vuln/detail/CVE-2023-6858)
* [CVE-2023-6859](https://nvd.nist.gov/vuln/detail/CVE-2023-6859)
* [CVE-2023-6860](https://nvd.nist.gov/vuln/detail/CVE-2023-6860)
* [CVE-2023-6861](https://nvd.nist.gov/vuln/detail/CVE-2023-6861)
* [CVE-2023-6862](https://nvd.nist.gov/vuln/detail/CVE-2023-6862)
* [CVE-2023-6863](https://nvd.nist.gov/vuln/detail/CVE-2023-6863)
* [CVE-2023-6864](https://nvd.nist.gov/vuln/detail/CVE-2023-6864)
* [CVE-2023-6865](https://nvd.nist.gov/vuln/detail/CVE-2023-6865)
* [CVE-2023-6866](https://nvd.nist.gov/vuln/detail/CVE-2023-6866)
* [CVE-2023-6867](https://nvd.nist.gov/vuln/detail/CVE-2023-6867)
* [CVE-2023-6868](https://nvd.nist.gov/vuln/detail/CVE-2023-6868)
* [CVE-2023-6869](https://nvd.nist.gov/vuln/detail/CVE-2023-6869)
* [CVE-2023-6870](https://nvd.nist.gov/vuln/detail/CVE-2023-6870)
* [CVE-2023-6871](https://nvd.nist.gov/vuln/detail/CVE-2023-6871)
* [CVE-2023-6872](https://nvd.nist.gov/vuln/detail/CVE-2023-6872)
* [CVE-2023-6873](https://nvd.nist.gov/vuln/detail/CVE-2023-6873)
* [CVE-2023-32205](https://nvd.nist.gov/vuln/detail/CVE-2023-32205)
* [CVE-2023-32206](https://nvd.nist.gov/vuln/detail/CVE-2023-32206)
* [CVE-2023-32207](https://nvd.nist.gov/vuln/detail/CVE-2023-32207)
* [CVE-2023-32208](https://nvd.nist.gov/vuln/detail/CVE-2023-32208)
* [CVE-2023-32209](https://nvd.nist.gov/vuln/detail/CVE-2023-32209)
* [CVE-2023-32210](https://nvd.nist.gov/vuln/detail/CVE-2023-32210)
* [CVE-2023-32211](https://nvd.nist.gov/vuln/detail/CVE-2023-32211)
* [CVE-2023-32212](https://nvd.nist.gov/vuln/detail/CVE-2023-32212)
* [CVE-2023-32213](https://nvd.nist.gov/vuln/detail/CVE-2023-32213)
* [CVE-2023-32214](https://nvd.nist.gov/vuln/detail/CVE-2023-32214)
* [CVE-2023-32215](https://nvd.nist.gov/vuln/detail/CVE-2023-32215)
* [CVE-2023-32216](https://nvd.nist.gov/vuln/detail/CVE-2023-32216)
* [CVE-2023-34414](https://nvd.nist.gov/vuln/detail/CVE-2023-34414)
* [CVE-2023-34415](https://nvd.nist.gov/vuln/detail/CVE-2023-34415)
* [CVE-2023-34416](https://nvd.nist.gov/vuln/detail/CVE-2023-34416)
* [CVE-2023-34417](https://nvd.nist.gov/vuln/detail/CVE-2023-34417)
* [CVE-2023-37203](https://nvd.nist.gov/vuln/detail/CVE-2023-37203)
* [CVE-2023-37204](https://nvd.nist.gov/vuln/detail/CVE-2023-37204)
* [CVE-2023-37205](https://nvd.nist.gov/vuln/detail/CVE-2023-37205)
* [CVE-2023-37206](https://nvd.nist.gov/vuln/detail/CVE-2023-37206)
* [CVE-2023-37209](https://nvd.nist.gov/vuln/detail/CVE-2023-37209)
* [CVE-2023-37210](https://nvd.nist.gov/vuln/detail/CVE-2023-37210)
* [CVE-2023-37212](https://nvd.nist.gov/vuln/detail/CVE-2023-37212)
* MFSA-2023-40
* MFSA-TMP-2023-0002

**Release date**

January 07, 2024

**Latest revision**

January 07, 2024: 1

**Severity**

high

**Exploitable**

remote

**Bugzilla entries**

* [908245](https://bugs.gentoo.org/show_bug.cgi?id=908245)
* [914073](https://bugs.gentoo.org/show_bug.cgi?id=914073)
* [918433](https://bugs.gentoo.org/show_bug.cgi?id=918433)
* [920507](https://bugs.gentoo.org/show_bug.cgi?id=920507)

### Questions or comments?

Please feel free to contact us.

**© 2001–2020 Gentoo Foundation, Inc.**



=== Content from www.mozilla.org_ecd955a5_20250114_220706.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    ## Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    ## Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [## Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    ## Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    ## Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    ## Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    ## Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    ## MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    ## Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    ## Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [## About Mozilla](/en-US/about/)
  + [## The Mozilla Manifesto](/en-US/about/manifesto/)
  + [## Get Involved](/en-US/contribute/)
  + [## Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [## Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [## Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2023-22

## Security Vulnerabilities fixed in Firefox 115

Announced
July 4, 2023
Impact
high
Products
Firefox
Fixed in

* Firefox 115

#### [#CVE-2023-3482: Block all cookies bypass for localstorage](#CVE-2023-3482)

Reporter
Martin Hostettler
Impact
moderate
##### Description

When Firefox is configured to block storage of all cookies, it was still possible to store data in localstorage by using an iframe with a source of 'about:blank'. This could have led to malicious websites storing tracking data without permission.

##### References

* [Bug 1839464](https://bugzilla.mozilla.org/show_bug.cgi?id=1839464)

#### [#CVE-2023-37201: Use-after-free in WebRTC certificate generation](#CVE-2023-37201)

Reporter
Irvan Kurniawan
Impact
high
##### Description

An attacker could have triggered a use-after-free condition when creating a WebRTC connection over HTTPS.

##### References

* [Bug 1826002](https://bugzilla.mozilla.org/show_bug.cgi?id=1826002)

#### [#CVE-2023-37202: Potential use-after-free from compartment mismatch in SpiderMonkey](#CVE-2023-37202)

Reporter
zx
Impact
high
##### Description

Cross-compartment wrappers wrapping a scripted proxy could have caused objects from other compartments to be stored in the main compartment resulting in a use-after-free.

##### References

* [Bug 1834711](https://bugzilla.mozilla.org/show_bug.cgi?id=1834711)

#### [#CVE-2023-37203: Drag and Drop API may provide access to local system files](#CVE-2023-37203)

Reporter
Paul Nickerson and Ameen Basha M K
Impact
moderate
##### Description

Insufficient validation in the Drag and Drop API in conjunction with social engineering, may have allowed an attacker to trick end-users into creating a shortcut to local system files. This could have been leveraged to execute arbitrary code.

##### References

* [Bug 291640](https://bugzilla.mozilla.org/show_bug.cgi?id=291640)

#### [#CVE-2023-37204: Fullscreen notification obscured via option element](#CVE-2023-37204)

Reporter
Irvan Kurniawan
Impact
moderate
##### Description

A website could have obscured the fullscreen notification by using an option element by introducing lag via an expensive computational function. This could have led to user confusion and possible spoofing attacks.

##### References

* [Bug 1832195](https://bugzilla.mozilla.org/show_bug.cgi?id=1832195)

#### [#CVE-2023-37205: URL spoofing in address bar using RTL characters](#CVE-2023-37205)

Reporter
Rohan Sharma
Impact
moderate
##### Description

The use of RTL Arabic characters in the address bar may have allowed for URL spoofing.

##### References

* [Bug 1704420](https://bugzilla.mozilla.org/show_bug.cgi?id=1704420)

#### [#CVE-2023-37206: Insufficient validation of symlinks in the FileSystem API](#CVE-2023-37206)

Reporter
Ameen Basha M K
Impact
moderate
##### Description

Uploading files which contain symlinks may have allowed an attacker to trick a user into submitting sensitive data to a malicious website.

##### References

* [Bug 1813299](https://bugzilla.mozilla.org/show_bug.cgi?id=1813299)

#### [#CVE-2023-37207: Fullscreen notification obscured](#CVE-2023-37207)

Reporter
Shaheen Fazim
Impact
moderate
##### Description

A website could have obscured the fullscreen notification by using a URL with a scheme handled by an external program, such as a mailto URL. This could have led to user confusion and possible spoofing attacks.

##### References

* [Bug 1816287](https://bugzilla.mozilla.org/show_bug.cgi?id=1816287)

#### [#CVE-2023-37208: Lack of warning when opening Diagcab files](#CVE-2023-37208)

Reporter
P Umar Farooq
Impact
moderate
##### Description

When opening Diagcab files, Firefox did not warn the user that these files may contain malicious code.

##### References

* [Bug 1837675](https://bugzilla.mozilla.org/show_bug.cgi?id=1837675)

#### [#CVE-2023-37209: Use-after-free in "NotifyOnHistoryReload"](#CVE-2023-37209)

Reporter
Simon Descarpentries
Impact
moderate
##### Description

A use-after-free condition existed in `NotifyOnHistoryReload` where a `LoadingSessionHistoryEntry` object was freed and a reference to that object remained. This resulted in a potentially exploitable condition when the reference to that object was later reused.

##### References

* [Bug 1837993](https://bugzilla.mozilla.org/show_bug.cgi?id=1837993)

#### [#CVE-2023-37210: Full-screen mode exit prevention](#CVE-2023-37210)

Reporter
Hafiizh
Impact
low
##### Description

A website could prevent a user from exiting full-screen mode via alert and prompt calls. This could lead to user confusion and possible spoofing attacks.

##### References

* [Bug 1821886](https://bugzilla.mozilla.org/show_bug.cgi?id=1821886)

#### [#CVE-2023-37211: Memory safety bugs fixed in Firefox 115, Firefox ESR 102.13, and Thunderbird 102.13](#CVE-2023-37211)

Reporter
Andrew McCreight, Matthew Gaudet, Tom Ritter, and the Mozilla Fuzzing Team,
Impact
high
##### Description

Memory safety bugs present in Firefox 114, Firefox ESR 102.12, and Thunderbird 102.12. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 115, Firefox ESR 102.13, and Thunderbird 102.13](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1832306%2C1834862%2C1835886%2C1836550%2C1837450)

#### [#CVE-2023-37212: Memory safety bugs fixed in Firefox 115](#CVE-2023-37212)

Reporter
Andrew McCreight, and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 114. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 115](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1750870%2C1825552%2C1826206%2C1827076%2C1828690%2C1833503%2C1835710%2C1838587)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0.1/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_f7b21807_20250114_220705.html ===


![](/static/v20250114.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1839464)
* [XML](/show_bug.cgi?ctype=xml&id=1839464)

Closed
[Bug 1839464](/show_bug.cgi?id=1839464)
(CVE-2023-3482)

Opened 2 years ago
Closed 2 years ago

# "Block all cookies" bypass for localstorage using about:blank iframe, plus document.cookie weirdness

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

"Block all cookies" bypass for localstorage using about:blank iframe, plus document.cookie weirdness

## Categories

### (Core :: Privacy: Anti-Tracking, defect, P2)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Privacy%3A%20Anti-Tracking#Privacy%3A%20Anti-Tracking)

Privacy: Anti-Tracking
▾

Core :: Privacy: Anti-Tracking
Tracking detection and content-blocking; part of the Enhanced Tracking Protection functionality
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Privacy%3A%20Anti-Tracking&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Privacy%3A%20Anti-Tracking&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Privacy%3A%20Anti-Tracking)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

VERIFIED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

116 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox-esr115 | [115+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=115%2B) | [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified) |
| firefox114 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix) |
| firefox115 | [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=verified) |
| firefox116 | [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B) | [verified](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=verified) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | 115+ | verified |
| firefox-esr128 | --- | --- |
| firefox114 |  | wontfix |
| firefox115 | + | verified |
| firefox116 | + | verified |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: textshell, Assigned: timhuang)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/9c043b04a6702f66940ab8ea398e08a3?d=mm&size=40)  [timhuang](/user_profile?user_id=547199)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/85db24fb5dcd3bf7f596a668bd8b7bfe?d=mm&size=40)  [textshell](/user_profile?user_id=729574)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/9c043b04a6702f66940ab8ea398e08a3?d=mm&size=40)  [timhuang](/user_profile?user_id=547199)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

16 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (4 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main115+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-3482

[Keywords:](/describekeywords.cgi)

[csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main115+]

QA Whiteboard:

[qa-triaged]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a609786_1689 "2 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (5 files)

| [testfiles.zip](/attachment.cgi?id=9340109)  [2 years ago](#c0)  [Martin Hostettler](/user_profile?user_id=729574)   863 bytes, application/zip |  | [Details](/attachment.cgi?id=9340109&action=edit) |
| --- | --- | --- |
| [test-noiframe.html](/attachment.cgi?id=9340186)  [2 years ago](#c2)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   398 bytes, text/html |  | [Details](/attachment.cgi?id=9340186&action=edit) |
| [test2.html](/attachment.cgi?id=9340187)  [2 years ago](#c3)  [Daniel Veditz [:dveditz]](/user_profile?user_id=1689)   520 bytes, text/html |  | [Details](/attachment.cgi?id=9340187&action=edit) |
| [testcookie.html](/attachment.cgi?id=9340226)  [2 years ago](#c6)  [Martin Hostettler](/user_profile?user_id=729574)   548 bytes, text/html |  | [Details](/attachment.cgi?id=9340226&action=edit) |
| [Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!](/attachment.cgi?id=9340567)  [2 years ago](#c10)  [Tim Huang[:timhuang]](/user_profile?user_id=547199)   48 bytes, text/x-phabricator-request | dmeehan : [approval-mozilla-release+](#c23 "2 years ago") | [Details](/attachment.cgi?id=9340567&action=edit) | [Review](/attachment.cgi?id=9340567) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | Multiple Authors |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1839464#c0)• 2 years ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1839464&comment_id=16463761 "1 revision") |
|  | |

Attached file
[testfiles.zip](attachment.cgi?id=9340109)
— [Details](attachment.cgi?id=9340109&action=edit)

[originally submitted via email, but the autoresponder asked to resubmit via bugzilla]

While testing a cookie auto deletion addon, i came across what seem to be a cookie/storage permission bypass.

Steps to reproduce:

0. As usual serve the attached files using a local webserver (like python3 -mhttp.server) and access them on a

   non localhost ip.
1. I have tested this with a fresh firefox nightly (116.0a1 (2023-06-16)(64bit).
2. In the fresh profile set cookie blocking to "custom" and select to block "All cookies".[1]
3. Confirm that normal access to local storage is blocked by using the attached test-noiframe.html

   3a: Access to the storage APIs gives a "DOMException: The operation is insecure.", the storage tab in developer tools show no saved data.
4. But Using the attached test2.html give unblocked access to local storage.

Expected Result:

Firefox blocks storage access the same as when using the non iframe version of the test. No data stored.

Actual Result:

The storage apis work and ignore the setting to block the access:

* No exception on usage
* When entering data in the textbox and pressing save, on reloading the page, the page can retrieve the data.
* The saved data is not visible in developer tools, but even after restarting firefox the page can still read back the data.
* The origin with the saved data is shown in "Manage Cookies and Site Data" as having used storage.

I have not tracked done the regression point, but using firefox 100, the blocking works and the api access gives the expected exceptions.

This seems to be a recent regression.

The core part of test2.html is as follows. It seems by just using the contentWindow of a otherwise defaulted iframe,

the blocking of the storage api is evaded.

```
<iframe id="preview" name="preview"></iframe>
<script>
let p = document.getElementById('preview');
let currentData = p.contentWindow.localStorage.getItem('blah');
document.getElementById('odata').innerText = currentData;

function setTest() {
    p.contentWindow.localStorage.setItem('blah', document.getElementById('idata').value);
}
</script>

```

From looking at the profile directory the local storage seems to be attributed to the origin used to access test2.html.

storage.sqlite

INSERT INTO origin VALUES(2,'','192.168.123.123','<http://192.168.123.123:4567','L9',9,1686945337316151,1,0>);

storage/default/http+++192.168.123.123+4567/ls/data.sqlite

INSERT INTO "database" VALUES('<http://192.168.123.123:4567',9,1686944680773745,0,6144>);

I've played around a bit if this also allows evading storage isolation, but i did not the storage to leak across.

But this still evades supported data privacy settings.

[1] The problem also manifests with other global settings and blocking the specific origin.

Flags: sec-bounty?

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a2068_406194)• 2 years ago |

Group: firefox-core-security → dom-core-securityComponent: Security → Storage: localStorage & sessionStorageProduct: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1839464#c1)• 2 years ago |
|  | |

Paul, Tim: is "Storage" the right component for this, or is "Privacy: anti-tracking" better?

Flags: needinfo?(tihuang)Flags: needinfo?(pbz)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a17041_1689)• 2 years ago |

Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1839464#c2)• 2 years ago |
|  | |

Attached file
[test-noiframe.html](attachment.cgi?id=9340186)
— [Details](attachment.cgi?id=9340186&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1839464#c3)• 2 years ago |
|  | |

Attached file
[test2.html](attachment.cgi?id=9340187)
— [Details](attachment.cgi?id=9340187&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1839464#c4)• 2 years ago |
|  | |

> From looking at the profile directory the local storage seems to be attributed to the origin used to access test2.html.

A frame (or window.open()) with no source URL contains an "about:blank" document, which inherits the origin of the browsing context that created it. The "same origin policy" means that If the frame were not the same origin, when your code tried to access anything inside the frame it would have have thrown security errors. "p" is OK (the frame element is part of the outer document), "p.contentWindow" wouldn't have worked

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1839464#c5)• 2 years ago |
|  | |

Interesting. Similarly, `p.contentDocument.cookie` or `p.contentWindow.document.cookie` can be used to set cookies but I'm not sure where they live. When you switch the cookie setting back to normal (and refresh the testcase to pick up the new settings) those cookies are gone. If you switch back to blocking all cookies and refresh, the cookie you set on the frame's document.cookie is back again. At least as seen by the document.cookie API. It doesn't get sent to the site nor does it show up in devtools cookie storage either way the cookie blocking is set.

Since cookies are a different group than storage but the DOM level confusion is similar I think anti-tracking is probably a better place to start. There's some confusion wrt that "about:blank" frame. Is some code checking against the URL and getting a null host rather than checking the principal for the true origin?

Status: UNCONFIRMED → NEWComponent: Storage: localStorage & sessionStorage → Privacy: Anti-TrackingEver confirmed: true

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a20046_1689)• 2 years ago |

Summary: Local storage access block bypass using iframe → "Block all cookies" bypass for localstorage using about:blank iframe, plus document.cookie weirdness

|  | [Martin Hostettler](/user_profile?user_id=729574)  Reporter |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1839464#c6)• 2 years ago |
|  | |

Attached file
[testcookie.html](attachment.cgi?id=9340226)
— [Details](attachment.cgi?id=9340226&action=edit)

|  | [Martin Hostettler](/user_profile?user_id=729574)  Reporter |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1839464#c7)• 2 years ago |
|  | |

Yes, the cookie behavior is strange.

I'm testing with

```
let p = document.getElementById('preview');
let currentData = p.contentWindow.document.cookie
document.getElementById('odata').innerText = currentData;

function setTest() {
    p.contentWindow.document.cookie = 'blah=' + document.getElementById('idata').value + '; expires=Mon, 01 Jan 2024 00:00:00 GMT';
}

```

In contrast to local storage, setting a new cookie case seem to get blocked by setting an explicit "block" exception for the origin.

And the cookie data disappears when i use about:processes to kill the content process of the tab. Testing further using 2 tabs the cookie jar seems to have different storage for each tab/content process (each tab can set a different value and read it back on page reload).

And using the "clear recent history" feature selecting "today" does not clear the cookie, but selecting "everything" does clear it.

So the cookie code seems to do different checks in different code paths and so has more than one behavior. And its behavior is different to the detailed behavior with storage.

|  | [Emma Zühlcke [:emz]](/user_profile?user_id=636491) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1839464#c8)• 2 years ago |
|  | |

Tim is looking into this.

Flags: needinfo?(pbz)

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a155271_547199)• 2 years ago |

Flags: needinfo?(tihuang)

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199)  Assignee |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1839464#c9)• 2 years ago |
|  | |

The bypass of cookie blocking is because we exempt the storage access check for the "about:blank" iframe due to [here](https://searchfox.org/mozilla-central/rev/3424c000a7ff304b2d1efb8561a924232f7f12fc/toolkit/components/antitracking/StorageAccess.cpp#136-140). So, we will get `StorageAccess::eAllow` even in the setting with blocking all cookies. I think this is an oversight of the storage access check for `about:blank` iframe.

After talking with Ben about this issue, we think we should restrict more storage access checks on about pages. We think we should still do storage access checks for content exposed about pages.

Assignee: nobody → tihuangSeverity: -- → S2Status: NEW → ASSIGNEDPriority: -- → P2

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1839464#c10)• 2 years ago |
|  | |

Attached file
[Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!](attachment.cgi?id=9340567)
— [Details](attachment.cgi?id=9340567&action=edit)

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1839464#c11)• 2 years ago |
|  | |

This bug has been marked as a regression. Setting status flag for Nightly to `affected`.

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected)

|  | [Martin Hostettler](/user_profile?user_id=729574)  Reporter |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1839464#c12)• 2 years ago |
|  | |

I've applied the patch to a slightly older checkout of the release branch (around 114), and i can no longer reproduce the problem with the patch applied.

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1839464#c13)• 2 years ago |
|  | |

Check storage access in content accessible about pages. r=bvandersloot,anti-tracking-reviewers

<https://hg.mozilla.org/integration/autoland/rev/d451c1b17cfda3ebedad6d117c5022f2871f1018>

<https://hg.mozilla.org/mozilla-central/rev/d451c1b17cfd>

Group: dom-core-security → core-security-release
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed)

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a515739_258347)• 2 years ago |

Status: ASSIGNED → RESOLVEDClosed: 2 years agoResolution: --- → FIXEDTarget Milestone: --- → 116 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1839464#c14)• 2 years ago |
|  | |

Looks like this affects all branches. Can we assign a sec rating to this bug please?

[status-firefox114](/buglist.cgi?f1=cf_status_firefox114&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox114&o1=equals&v1=wontfix)
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)Flags: needinfo?(tihuang)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1839464#c15)• 2 years ago |
|  | |

Relatedly, this should have gotten sec-approval before landing.

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1839464#c16)• 2 years ago |
|  | |

Very odd: Searchfox gives blame to [bug 1765313](/show_bug.cgi?id=1765313 "RESOLVED FIXED - Move Storage Access API logic from ContentBlocking.h to its own file/folder in the AT module") for touching the code pointed at in [comment 9](/show_bug.cgi?id=1839464#c9 "VERIFIED FIXED - \"Block all cookies\" bypass for localstorage using about:blank iframe, plus document.cookie weirdness") that you patched in D181807. That would indicate it regressed in Fx103, which is consistent with the reporter's statement that Firefox 100 was fine. It would also mean Firefox 102 was unaffected.

But I don't see those lines touched in the patches for [bug 1765313](/show_bug.cgi?id=1765313 "RESOLVED FIXED - Move Storage Access API logic from ContentBlocking.h to its own file/folder in the AT module"). Nor was it in the patch as actually checked in to mozilla-centra so it's hard to claim a check-in merge introduced phantom blame. I see the same code in **ESR 91** blamed on [bug 1612378](/show_bug.cgi?id=1612378 "RESOLVED FIXED - Make CheckContentBlockingAllowList fission compatible").

<https://searchfox.org/mozilla-esr91/source/toolkit/components/antitracking/StorageAccess.cpp#154-157>

Is something else interacting with this that made the reporter experience OK behavior in Firefox 100? Maybe this code was there, but the isolation was off by default?

I'm unhappy with these custom scheme checks and code that has to have deep knowledge of protocols (such as checking a list of specific URLs or matches and pulling out a couple that are causing problems. That means when we add more such URLs or protocols, or someone writes new code that needs to behave like this it will potentially break in unsafe ways. That's the whole point of using principal comparisons and bundling knowledge into protocol flags (and even "dynamic" protocol flags for schemes like "about" where different URLs have different properties).

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1839464#c17)• 2 years ago |
|  | |

Looks like the TCP roll-out was in Firefox 103, and I assume this bug doesn't happen without partitioning enabled. Some folks might have stumbled on it slightly earlier and manually enabled it in about:config but that's not going to be a huge number of people.

We should definitely get this fix into Firefox 115 based on it's privacy severity, and because that will be the next ESR. We don't need to go out of our way to fix ESR-102, though it looks like it might apply pretty cleanly so I wouldn't object to it.

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fix-optional](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fix-optional)
[tracking-firefox115](/buglist.cgi?f1=cf_tracking_firefox115&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox115&o1=equals&v1=%2B)
[tracking-firefox116](/buglist.cgi?f1=cf_tracking_firefox116&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox116&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [115+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=115%2B)Keywords: [regression](/buglist.cgi?keywords=regression&resolution=---),
[regressionwindow-wanted](/buglist.cgi?keywords=regressionwindow-wanted&resolution=---) → [csectype-disclosure](/buglist.cgi?keywords=csectype-disclosure&resolution=---),
[privacy](/buglist.cgi?keywords=privacy&resolution=---),
[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1839464#c18)• 2 years ago |
|  | |

:timhuang could you please add a release uplift request on this?

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1839464#c19)• 2 years ago |
|  | |

Comment on [attachment 9340567](/attachment.cgi?id=9340567 "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!") [[details]](/attachment.cgi?id=9340567&action=edit "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!")

[Bug 1839464](/show_bug.cgi?id=1839464 "VERIFIED FIXED - \"Block all cookies\" bypass for localstorage using about:blank iframe, plus document.cookie weirdness") - Check storage access in content accessible about pages. r?bvandersloot!

### Beta/Release Uplift Approval Request

* **User impact if declined**: The iframe can access the storage/cookies even if the user disables cookie/storage access.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The code change of the patch is small.
* **String changes made/needed**: none
* **Is Android affected?**: Yes
Flags: needinfo?(tihuang)
[Attachment #9340567](/attachment.cgi?id=9340567&action=edit "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!") -
Flags: approval-mozilla-release?

|  | [Tim Huang[:timhuang]](/user_profile?user_id=547199)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1839464#c20)• 2 years ago |
|  | |

Do I need to request another uplift for beta, or is the release uplift enough?

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1839464#c21)• 2 years ago |
|  | |

The patch landed in nightly and beta is affected.

:timhuang, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox115` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(tihuang)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1839464#c22)• 2 years ago |
|  | |

(In reply to Tim Huang[:timhuang] from [comment #20](/show_bug.cgi?id=1839464#c20 "VERIFIED FIXED - \"Block all cookies\" bypass for localstorage using about:blank iframe, plus document.cookie weirdness"))

> Do I need to request another uplift for beta, or is the release uplift enough?

Release is enough, 115 is now in release and there's where the uplift needs to happen

Flags: needinfo?(tihuang)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a609786_1689)• 2 years ago |

Flags: sec-bounty? → sec-bounty+

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a639481_75935)• 2 years ago |

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[fix-optional](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fix-optional) → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [115+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=115%2B)

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a677189_586683)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main115+]

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a677225_586683)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main115+] → [reporter-external] [client-bounty-form] [verif?][adv-main115+][adv-esr102.13+]

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a677685_586683)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main115+][adv-esr102.13+] → [reporter-external] [client-bounty-form] [verif?]

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1839464#c23)• 2 years ago |
|  | |

Comment on [attachment 9340567](/attachment.cgi?id=9340567 "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!") [[details]](/attachment.cgi?id=9340567&action=edit "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!")

[Bug 1839464](/show_bug.cgi?id=1839464 "VERIFIED FIXED - \"Block all cookies\" bypass for localstorage using about:blank iframe, plus document.cookie weirdness") - Check storage access in content accessible about pages. r?bvandersloot!

Approved for 115.0 RC2

[Attachment #9340567](/attachment.cgi?id=9340567&action=edit "Bug 1839464 - Check storage access in content accessible about pages. r?bvandersloot!") -
Flags: approval-mozilla-release? → approval-mozilla-release+

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1839464#c24)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-release/rev/48449fb439a1>

[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
[115+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=115%2B) → ---

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1839464#c25)• 2 years ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/bc76b1e5169a>

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Mihai Boldan, Desktop QA [:mboldan]](/user_profile?user_id=551058) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a827159_551058)• 2 years ago |

QA Whiteboard: [qa-triaged]Flags: qe-verify+

|  | [Ciprian Georgiu, Desktop QA](/user_profile?user_id=576182) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1839464#c26)• 2 years ago |
|  | |

I've reproduced this issue with STR from [comment 0](/show_bug.cgi?id=1839464#c0 "VERIFIED FIXED - \"Block all cookies\" bypass for localstorage using about:blank iframe, plus document.cookie weirdness"), on an affected Nightly build (116.0a1, 2023-06-20) with macOS 11.

The issue is verified as fixed on the latest builds, 115.0-build2 RC, 115.0-build2 ESR, and latest Nightly 116.0a1, across platforms: Win 11 x64, macOS 11 and Ubuntu 18.04 x64.

Status: RESOLVED → VERIFIED
[status-firefox115](/buglist.cgi?f1=cf_status_firefox115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox115&o1=equals&v1=verified)
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=verified)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) → [verified](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=verified)Flags: qe-verify+

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a859990_586683)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main115+][adv-esr102.13+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a863749_1689)• 2 years ago |

Alias: CVE-2023-3482

|  | [Jason Kratzer [:jkratzer]](/user_profile?user_id=586683) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a864101_586683)• 2 years ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main115+][adv-esr102.13+] → [reporter-external] [client-bounty-form] [verif?][adv-main115+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a10320413_1689)• 1 year ago |

Group: core-security-release

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1839464#a29811192_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1839464&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Martin Hostettler](/user_profile?user_id=729574)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review


