=== Content from plugins.trac.wordpress.org_56bd0fec_20250114_184435.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-remote-users-sync%2Ftrunk%2Finc%2Fapi%2Fclass-wprus-api-abstract.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=3178475 "Revision 3178475")
* Next Revision →
* [Blame](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-remote-users-sync](/browser/wp-remote-users-sync?order=name "View wp-remote-users-sync")/[trunk](/browser/wp-remote-users-sync/trunk?order=name "View trunk")/[inc](/browser/wp-remote-users-sync/trunk/inc?order=name "View inc")/[api](/browser/wp-remote-users-sync/trunk/inc/api?order=name "View api")/[class-wprus-api-abstract.php](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?order=name "View class-wprus-api-abstract.php")

View diff against:

View revision:

| [Last change](/changeset/3191742/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php "View differences") on this file was [3191742](/changeset/3191742/ "View changeset 3191742"), checked in by frogerme, [8 weeks ago](/timeline?from=2024-11-19T02%3A15%3A37Z&precision=second "See timeline at 11/19/2024 02:15:37 AM") |
| --- |
| v2.0.5 |
| **File size:** 37.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { |
| [4](#L4) | exit; // Exit if accessed directly |
| [5](#L5) | } |
| [6](#L6) |  |
| [7](#L7) | abstract class Wprus\_Api\_Abstract { |
| [8](#L8) | const TOKEN\_EXPIRY\_BUFFER = MINUTE\_IN\_SECONDS / 2; |
| [9](#L9) |  |
| [10](#L10) | /\*\* |
| [11](#L11) | \* The encryption settings. |
| [12](#L12) | \* |
| [13](#L13) | \* @var array |
| [14](#L14) | \*/ |
| [15](#L15) | protected static $encryption\_settings; |
| [16](#L16) | /\*\* |
| [17](#L17) | \* The browser support settings. |
| [18](#L18) | \* |
| [19](#L19) | \* @var array |
| [20](#L20) | \*/ |
| [21](#L21) | protected static $browser\_support\_settings; |
| [22](#L22) | /\*\* |
| [23](#L23) | \* The whitelist of IP ranges. |
| [24](#L24) | \* |
| [25](#L25) | \* @var array |
| [26](#L26) | \*/ |
| [27](#L27) | protected static $ip\_whitelist; |
| [28](#L28) | /\*\* |
| [29](#L29) | \* The settings class. |
| [30](#L30) | \* |
| [31](#L31) | \* @var string |
| [32](#L32) | \*/ |
| [33](#L33) | protected static $settings\_class; |
| [34](#L34) | /\*\* |
| [35](#L35) | \* Whether the token can be requested - used to retry if failed first. |
| [36](#L36) | \* |
| [37](#L37) | \* @var bool |
| [38](#L38) | \*/ |
| [39](#L39) | protected static $can\_request\_token = true; |
| [40](#L40) |  |
| [41](#L41) | /\*\* |
| [42](#L42) | \* The settings object. |
| [43](#L43) | \* |
| [44](#L44) | \* @var Wprus\_Settings|mixed |
| [45](#L45) | \*/ |
| [46](#L46) | protected $settings; |
| [47](#L47) | /\*\* |
| [48](#L48) | \* The endpoint method - 'post' or 'get'. |
| [49](#L49) | \* |
| [50](#L50) | \* @var string |
| [51](#L51) | \*/ |
| [52](#L52) | protected $method; |
| [53](#L53) | /\*\* |
| [54](#L54) | \* The endpoint key. |
| [55](#L55) | \* |
| [56](#L56) | \* @var string |
| [57](#L57) | \*/ |
| [58](#L58) | protected $endpoint; |
| [59](#L59) | /\*\* |
| [60](#L60) | \* The data received from remote sites. |
| [61](#L61) | \* |
| [62](#L62) | \* @var array |
| [63](#L63) | \*/ |
| [64](#L64) | protected $data; |
| [65](#L65) | /\*\* |
| [66](#L66) | \* The user ID used to save and fire async actions. |
| [67](#L67) | \* |
| [68](#L68) | \* @var int |
| [69](#L69) | \*/ |
| [70](#L70) | protected $async\_user\_id; |
| [71](#L71) | /\*\* |
| [72](#L72) | \* Whether the current request is received from a website. |
| [73](#L73) | \* |
| [74](#L74) | \* @var bool |
| [75](#L75) | \*/ |
| [76](#L76) | protected $doing\_remote\_action = false; |
| [77](#L77) | /\*\* |
| [78](#L78) | \* The list of async actions to add to the footer. |
| [79](#L79) | \* |
| [80](#L80) | \* @var array |
| [81](#L81) | \*/ |
| [82](#L82) | protected $async\_actions; |
| [83](#L83) | /\*\* |
| [84](#L84) | \* The role handler object. |
| [85](#L85) | \* |
| [86](#L86) | \* @var Wprus\_Api\_Role|mixed |
| [87](#L87) | \*/ |
| [88](#L88) | protected $role\_handler; |
| [89](#L89) | /\*\* |
| [90](#L90) | \* The password handler object. |
| [91](#L91) | \* |
| [92](#L92) | \* @var Wprus\_Api\_Password|mixed |
| [93](#L93) | \*/ |
| [94](#L94) | protected $password\_handler; |
| [95](#L95) | /\*\* |
| [96](#L96) | \* Whether the current action is authorized |
| [97](#L97) | \* |
| [98](#L98) | \* @var bool |
| [99](#L99) | \*/ |
| [100](#L100) | protected $is\_authorized\_remote; |
| [101](#L101) |  |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Constructor |
| [105](#L105) | \* |
| [106](#L106) | \* @param string $endpoint The endpoint key of the current instance. |
| [107](#L107) | \* @param Wprus\_Settings|mixed $settings The settings object. |
| [108](#L108) | \* @param bool $init\_hooks Whether to add WordPress action and filter hooks on object creation ; default `false`. |
| [109](#L109) | \*/ |
| [110](#L110) | public function \_\_construct( $endpoint, $settings, $init\_hooks = false ) { |
| [111](#L111) | $this->endpoint            = $endpoint; |
| [112](#L112) | $this->settings            = $settings; |
| [113](#L113) | $this->doing\_remote\_action = self::is\_doing\_remote\_action(); |
| [114](#L114) | $this->async\_actions       = array(); |
| [115](#L115) |  |
| [116](#L116) | $this->init(); |
| [117](#L117) | $this->init\_data(); |
| [118](#L118) |  |
| [119](#L119) | if ( $init\_hooks ) { |
| [120](#L120) |  |
| [121](#L121) | if ( $this->doing\_remote\_action ) { |
| [122](#L122) | add\_action( 'init', array( $this, 'init\_remote\_hooks\_authorization' ), PHP\_INT\_MIN + 100, 0 ); |
| [123](#L123) | add\_action( 'init', array( $this, 'init\_remote\_hooks' ), PHP\_INT\_MIN + 100, 0 ); |
| [124](#L124) | } else { |
| [125](#L125) | add\_action( 'init', array( $this, 'init\_local\_hooks' ), PHP\_INT\_MIN + 100, 0 ); |
| [126](#L126) | add\_action( |
| [127](#L127) | 'wp\_ajax\_wprus\_' . $endpoint . '\_notify\_ping\_remote', |
| [128](#L128) | array( $this, 'notify\_ping\_remote' ), |
| [129](#L129) | 10, |
| [130](#L130) | 0 |
| [131](#L131) | ); |
| [132](#L132) |  |
| [133](#L133) | if ( $this->has\_async\_actions() ) { |
| [134](#L134) |  |
| [135](#L135) | if ( ! has\_action( 'init', array( $this, 'set\_pending\_async\_actions\_user\_id' ) ) ) { |
| [136](#L136) | add\_action( 'init', array( $this, 'set\_pending\_async\_actions\_user\_id' ), PHP\_INT\_MIN + 100, 0 ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | add\_action( 'init', array( $this, 'init\_async\_hooks' ), PHP\_INT\_MIN + 100, 0 ); |
| [140](#L140) | } |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | add\_filter( 'wprus\_wp\_endpoints', array( $this, 'add\_action\_endpoints' ), 10, 1 ); |
| [144](#L144) | } |
| [145](#L145) | } |
| [146](#L146) |  |
| [147](#L147) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [148](#L148) | \* Public methods |
| [149](#L149) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [150](#L150) |  |
| [151](#L151) | /\*\* |
| [152](#L152) | \* Determine whether the current request is received from a remote website. |
| [153](#L153) | \* |
| [154](#L154) | \* @return bool whether the current request comes from a remote site |
| [155](#L155) | \*/ |
| [156](#L156) | public static function is\_doing\_remote\_action() { |
| [157](#L157) | return strpos( $\_SERVER['REQUEST\_URI'], '/wprus/' ) !== false; |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | /\*\* |
| [161](#L161) | \* Encrypt data to be sent to remote sites |
| [162](#L162) | \* |
| [163](#L163) | \* @param mixed $data The data to encrypt. |
| [164](#L164) | \* @return string the encrypted bundle |
| [165](#L165) | \*/ |
| [166](#L166) | public function encrypt\_data( $data ) { |
| [167](#L167) | $bundle = Wprus\_Crypto::encrypt( |
| [168](#L168) | wp\_json\_encode( $data, JSON\_UNESCAPED\_UNICODE ), |
| [169](#L169) | self::$encryption\_settings['aes\_key'], |
| [170](#L170) | self::$encryption\_settings['hmac\_key'] |
| [171](#L171) | ); |
| [172](#L172) |  |
| [173](#L173) | return $bundle; |
| [174](#L174) | } |
| [175](#L175) |  |
| [176](#L176) | /\*\* |
| [177](#L177) | \* Decrypt data received from remote sites |
| [178](#L178) | \* |
| [179](#L179) | \* @param string $bundle The bundle to decrypt. |
| [180](#L180) | \* @return mixed The decrypted data |
| [181](#L181) | \*/ |
| [182](#L182) | public function decrypt\_data( $bundle ) { |
| [183](#L183) | $data    = false; |
| [184](#L184) | $payload = false; |
| [185](#L185) |  |
| [186](#L186) | try { |
| [187](#L187) | $payload = Wprus\_Crypto::decrypt( |
| [188](#L188) | $bundle, |
| [189](#L189) | self::$encryption\_settings['aes\_key'], |
| [190](#L190) | self::$encryption\_settings['hmac\_key'] |
| [191](#L191) | ); |
| [192](#L192) | } catch ( Exception $e ) { |
| [193](#L193) | Wprus\_Logger::log( 'Could not decrypt data: ' . $e->getMessage(), 'alert', 'db\_log' ); |
| [194](#L194) | } |
| [195](#L195) |  |
| [196](#L196) | if ( $payload ) { |
| [197](#L197) | $data = json\_decode( $payload, true ); |
| [198](#L198) | } else { |
| [199](#L199) | Wprus\_Logger::log( \_\_( 'Could not decrypt data: invalid bundle.', 'wprus' ) ); |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | return $data; |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | /\*\* |
| [206](#L206) | \* Initialise the current API endpoint with its configuration |
| [207](#L207) | \* |
| [208](#L208) | \*/ |
| [209](#L209) | public function init() { |
| [210](#L210) | self::$settings\_class = get\_class( $this->settings ); |
| [211](#L211) |  |
| [212](#L212) | if ( ! isset( self::$encryption\_settings ) ) { |
| [213](#L213) | self::$encryption\_settings = self::$settings\_class::get\_option( 'encryption' ); |
| [214](#L214) | } |
| [215](#L215) |  |
| [216](#L216) | if ( ! isset( self::$browser\_support\_settings ) ) { |
| [217](#L217) | self::$browser\_support\_settings = self::$settings\_class::get\_option( 'browser\_support' ); |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | if ( ! isset( self::$ip\_whitelist ) ) { |
| [221](#L221) | $ip\_whitelist = self::$settings\_class::get\_option( 'ip\_whitelist' ); |
| [222](#L222) |  |
| [223](#L223) | if ( ! empty( $ip\_whitelist ) ) { |
| [224](#L224) | $ip\_whitelist       = array\_filter( array\_map( 'trim', explode( "\n", $ip\_whitelist ) ) ); |
| [225](#L225) | self::$ip\_whitelist = array\_map( |
| [226](#L226) | function ( $ip ) { |
| [227](#L227) |  |
| [228](#L228) | return preg\_match( '/\//', $ip ) ? $ip : $ip . '/32'; |
| [229](#L229) | }, |
| [230](#L230) | $ip\_whitelist |
| [231](#L231) | ); |
| [232](#L232) | } else { |
| [233](#L233) | self::$ip\_whitelist = false; |
| [234](#L234) | } |
| [235](#L235) | } |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | /\*\* |
| [239](#L239) | \* Handle notifications from remote websites when an action is triggered |
| [240](#L240) | \* |
| [241](#L241) | \* @return $result whether the operation was successful |
| [242](#L242) | \*/ |
| [243](#L243) | public function handle\_notification() { |
| [244](#L244) | return null; |
| [245](#L245) | } |
| [246](#L246) |  |
| [247](#L247) | /\*\* |
| [248](#L248) | \* Initialize the hooks to trigger when the action is triggered |
| [249](#L249) | \*/ |
| [250](#L250) | public function init\_notification\_hooks() { } |
| [251](#L251) |  |
| [252](#L252) | /\*\* |
| [253](#L253) | \* Handle request for security tokens and reply with JSON data |
| [254](#L254) | \* |
| [255](#L255) | \*/ |
| [256](#L256) | public function handle\_token\_request() { |
| [257](#L257) | $data       = $this->get\_data\_post(); |
| [258](#L258) | $token\_info = false; |
| [259](#L259) |  |
| [260](#L260) | if ( $data && isset( $data['method'] ) ) { |
| [261](#L261) | $token\_info = Wprus\_Nonce::create\_nonce( true ); |
| [262](#L262) | } |
| [263](#L263) |  |
| [264](#L264) | if ( $token\_info ) { |
| [265](#L265) | $action\_label   = isset( $data['action'] ) ? $data['action'] : \_\_( 'Token', 'wprus' ); |
| [266](#L266) | $settings\_class = self::$settings\_class; |
| [267](#L267) | $class\_vars     = get\_class\_vars( $settings\_class ); |
| [268](#L268) |  |
| [269](#L269) | if ( isset( $class\_vars['actions'][ $action\_label ] ) ) { |
| [270](#L270) | $action\_label = $class\_vars['actions'][ $action\_label ]; |
| [271](#L271) | } |
| [272](#L272) |  |
| [273](#L273) | Wprus\_Logger::log( |
| [274](#L274) | // translators: %1$s is the remote site ; %2$s is the action |
| [275](#L275) | sprintf( \_\_( 'Token created: site %1$s - action "%2$s"', 'wprus' ), $data['base\_url'], $action\_label ), |
| [276](#L276) | 'info', |
| [277](#L277) | 'db\_log' |
| [278](#L278) | ); |
| [279](#L279) | wp\_send\_json( $token\_info ); |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | Wprus\_Logger::log( \_\_( 'Failed to create token - invalid payload', 'wprus' ), 'alert', 'db\_log' ); |
| [283](#L283) |  |
| [284](#L284) | exit(); |
| [285](#L285) | } |
| [286](#L286) |  |
| [287](#L287) | /\*\* |
| [288](#L288) | \* Inititialise WordPress action hooks to process remote sites requests |
| [289](#L289) | \* |
| [290](#L290) | \*/ |
| [291](#L291) | public function init\_remote\_hooks() { |
| [292](#L292) | $data = $this->get\_data(); |
| [293](#L293) |  |
| [294](#L294) | if ( isset( $data['ping'] ) ) { |
| [295](#L295) | add\_action( 'wprus\_api\_' . $this->endpoint, array( $this, 'handle\_ping\_notification' ), 10, 0 ); |
| [296](#L296) | } else { |
| [297](#L297) | add\_action( 'wprus\_api\_' . $this->endpoint, array( $this, 'handle\_request' ), 10, 0 ); |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | add\_action( 'wprus\_api\_token', array( $this, 'handle\_token\_request' ), 10, 0 ); |
| [301](#L301) | } |
| [302](#L302) |  |
| [303](#L303) | /\*\* |
| [304](#L304) | \* Inititialise WordPress action hooks to authorise remote sites requests |
| [305](#L305) | \* |
| [306](#L306) | \*/ |
| [307](#L307) | public function init\_remote\_hooks\_authorization() { |
| [308](#L308) | add\_action( 'wprus\_api\_' . $this->endpoint, array( $this, 'authorize\_notification' ), 5, 0 ); |
| [309](#L309) | } |
| [310](#L310) |  |
| [311](#L311) | /\*\* |
| [312](#L312) | \* Inititialise the endpoint's role handler object |
| [313](#L313) | \* |
| [314](#L314) | \*/ |
| [315](#L315) | public function init\_role\_handler( $role\_api ) { |
| [316](#L316) | $this->role\_handler = $role\_api; |
| [317](#L317) | } |
| [318](#L318) |  |
| [319](#L319) | /\*\* |
| [320](#L320) | \* Inititialise the endpoint's password handler object |
| [321](#L321) | \* |
| [322](#L322) | \*/ |
| [323](#L323) | public function init\_password\_handler( $password\_api ) { |
| [324](#L324) | $this->password\_handler = $password\_api; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | /\*\* |
| [328](#L328) | \* Process a remote site request |
| [329](#L329) | \* |
| [330](#L330) | \*/ |
| [331](#L331) | public function handle\_request() { |
| [332](#L332) | $data = $this->get\_data(); |
| [333](#L333) |  |
| [334](#L334) | if ( method\_exists( $this, 'handle\_notification' ) ) { |
| [335](#L335) | do\_action( 'wprus\_before\_handle\_action\_notification', $this->endpoint, $data ); |
| [336](#L336) |  |
| [337](#L337) | $result = $this->handle\_notification(); |
| [338](#L338) |  |
| [339](#L339) | do\_action( 'wprus\_after\_handle\_action\_notification', $this->endpoint, $data, $result ); |
| [340](#L340) |  |
| [341](#L341) | if ( $this->needs\_redirect() ) { |
| [342](#L342) | $url = isset( $data['callback\_url'] ) ? $data['callback\_url'] : home\_url(); |
| [343](#L343) |  |
| [344](#L344) | wp\_redirect( $url, 303 ); // phpcs:ignore WordPress.Security.SafeRedirect.wp\_redirect\_wp\_redirect |
| [345](#L345) |  |
| [346](#L346) | exit(); |
| [347](#L347) | } |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | add\_filter( 'wprus\_api\_needs\_redirect', array( $this, 'needs\_redirect' ), 10, 0 ); |
| [351](#L351) | } |
| [352](#L352) |  |
| [353](#L353) | /\*\* |
| [354](#L354) | \* Authorise or deny a remote site request |
| [355](#L355) | \* |
| [356](#L356) | \*/ |
| [357](#L357) | public function authorize\_notification() { |
| [358](#L358) | $token\_filter         = FILTER\_UNSAFE\_RAW; |
| [359](#L359) | $token                = filter\_input( INPUT\_GET, 'token', $token\_filter ); |
| [360](#L360) | $token                = ( ! $token ) ? filter\_input( INPUT\_POST, 'token', $token\_filter ) : $token; |
| [361](#L361) | $is\_authorized\_remote = false; |
| [362](#L362) | $origin               = false; |
| [363](#L363) | $remote\_data          = $this->get\_data(); |
| [364](#L364) |  |
| [365](#L365) | if ( isset( $remote\_data['base\_url'] ) ) { |
| [366](#L366) | $origin = $remote\_data['base\_url']; |
| [367](#L367) | } |
| [368](#L368) |  |
| [369](#L369) | if ( 'get' === $this->method ) { |
| [370](#L370) | Wprus\_Nonce::init( true, false, self::$encryption\_settings['token\_expiry'] ); |
| [371](#L371) | } |
| [372](#L372) |  |
| [373](#L373) | if ( ! Wprus\_Nonce::validate\_nonce( $token ) ) { |
| [374](#L374) | $message = \_\_( 'Unauthorized access (invalid token)', 'wprus' ); |
| [375](#L375) | } else { |
| [376](#L376) |  |
| [377](#L377) | if ( 'get' === $this->method ) { |
| [378](#L378) | $is\_authorized\_remote = true; |
| [379](#L379) | } elseif ( 'post' === $this->method ) { |
| [380](#L380) |  |
| [381](#L381) | if ( self::$ip\_whitelist ) { |
| [382](#L382) | foreach ( self::$ip\_whitelist as $range ) { |
| [383](#L383) | if ( $this->cidr\_match( $\_SERVER['REMOTE\_ADDR'], $range ) ) { |
| [384](#L384) | $is\_authorized\_remote = true; |
| [385](#L385) | break; |
| [386](#L386) | } |
| [387](#L387) | } |
| [388](#L388) | } else { |
| [389](#L389) | $is\_authorized\_remote = true; |
| [390](#L390) | } |
| [391](#L391) | } |
| [392](#L392) |  |
| [393](#L393) | $is\_authorized\_remote = apply\_filters( |
| [394](#L394) | 'wprus\_is\_authorized\_remote', |
| [395](#L395) | $is\_authorized\_remote, |
| [396](#L396) | $this->method, |
| [397](#L397) | $\_SERVER['REMOTE\_ADDR'], |
| [398](#L398) | self::$ip\_whitelist |
| [399](#L399) | ); |
| [400](#L400) |  |
| [401](#L401) | if ( $is\_authorized\_remote ) { |
| [402](#L402) | $message = \_\_( 'Access granted', 'wprus' ); |
| [403](#L403) | } elseif ( 'post' === $this->method && self::$ip\_whitelist ) { |
| [404](#L404) | // translators: %s is the remote IP address |
| [405](#L405) | $message = sprintf( \_\_( 'Unauthorized access (invalid remote IP address %s)', 'wprus' ), $\_SERVER['REMOTE\_ADDR'] ); |
| [406](#L406) | } else { |
| [407](#L407) | $message = \_\_( 'Unauthorized access (invalid method)', 'wprus' ); |
| [408](#L408) | } |
| [409](#L409) | } |
| [410](#L410) |  |
| [411](#L411) | if ( 'get' === $this->method ) { |
| [412](#L412) | Wprus\_Nonce::init( false, false, self::$encryption\_settings['token\_expiry'] ); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | $message                   .= ( $origin ) ? ' - ' . $origin : ''; |
| [416](#L416) | $log\_type                   = ( $is\_authorized\_remote ) ? 'success' : 'alert'; |
| [417](#L417) | $this->is\_authorized\_remote = $is\_authorized\_remote; |
| [418](#L418) |  |
| [419](#L419) | Wprus\_Logger::log( $message, $log\_type, 'db\_log' ); |
| [420](#L420) |  |
| [421](#L421) | if ( ! $is\_authorized\_remote ) { |
| [422](#L422) | do\_action( 'wprus\_unauthorized\_access', $this->endpoint, $remote\_data, $token, $this ); |
| [423](#L423) |  |
| [424](#L424) | if ( isset( $remote\_data['ping'] ) ) { |
| [425](#L425) | $message = \_\_( 'The remote website encountered the following error: ', 'wprus' ) . $message; |
| [426](#L426) |  |
| [427](#L427) | wp\_send\_json\_error( $message ); |
| [428](#L428) | } elseif ( $this->needs\_redirect() ) { |
| [429](#L429) | $url = isset( $remote\_data['callback\_url'] ) ? $remote\_data['callback\_url'] : home\_url(); |
| [430](#L430) |  |
| [431](#L431) | wp\_redirect( $url, 303 ); // phpcs:ignore WordPress.Security.SafeRedirect.wp\_redirect\_wp\_redirect |
| [432](#L432) |  |
| [433](#L433) | exit(); |
| [434](#L434) | } else { |
| [435](#L435) |  |
| [436](#L436) | exit(); |
| [437](#L437) | } |
| [438](#L438) | } |
| [439](#L439) |  |
| [440](#L440) | do\_action( 'wprus\_authorized\_access', $this->endpoint, $remote\_data, $token, $this ); |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | /\*\* |
| [444](#L444) | \* Inititialise WordPress action hooks to send requests to remote sites |
| [445](#L445) | \* |
| [446](#L446) | \*/ |
| [447](#L447) | public function init\_local\_hooks() { |
| [448](#L448) | $init\_notification\_hooks = apply\_filters( 'wprus\_init\_notification\_hooks', true ); |
| [449](#L449) |  |
| [450](#L450) | if ( ! $init\_notification\_hooks ) { |
| [451](#L451) |  |
| [452](#L452) | return; |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | if ( method\_exists( $this, 'init\_notification\_hooks' ) ) { |
| [456](#L456) | do\_action( 'wprus\_before\_init\_notification\_hooks', $this->endpoint, $this ); |
| [457](#L457) |  |
| [458](#L458) | $this->init\_notification\_hooks(); |
| [459](#L459) |  |
| [460](#L460) | do\_action( 'wprus\_after\_init\_notification\_hooks', $this->endpoint, $this ); |
| [461](#L461) | } |
| [462](#L462) | } |
| [463](#L463) |  |
| [464](#L464) | /\*\* |
| [465](#L465) | \* Inititialise WordPress action hooks used to process redirected async actions |
| [466](#L466) | \* |
| [467](#L467) | \*/ |
| [468](#L468) | public function init\_async\_redirect\_hooks() { |
| [469](#L469) |  |
| [470](#L470) | if ( ! $this->is\_silent\_async\_action\_redirect() ) { |
| [471](#L471) |  |
| [472](#L472) | if ( ! has\_action( 'wp\_head', array( $this, 'fire\_async\_actions' ) ) ) { |
| [473](#L473) | add\_action( 'wp\_head', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [474](#L474) | } |
| [475](#L475) |  |
| [476](#L476) | if ( ! has\_action( 'admin\_head', array( $this, 'fire\_async\_actions' ) ) ) { |
| [477](#L477) | add\_action( 'admin\_head', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [478](#L478) | } |
| [479](#L479) |  |
| [480](#L480) | if ( ! has\_action( 'login\_head', array( $this, 'fire\_async\_actions' ) ) ) { |
| [481](#L481) | add\_action( 'login\_head', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [482](#L482) | } |
| [483](#L483) | } else { |
| [484](#L484) | $this->init\_silent\_async\_redirect\_hooks(); |
| [485](#L485) | } |
| [486](#L486) | } |
| [487](#L487) |  |
| [488](#L488) | /\*\* |
| [489](#L489) | \* Inititialise WordPress action hooks used to process async actions |
| [490](#L490) | \* |
| [491](#L491) | \*/ |
| [492](#L492) | public function init\_async\_hooks() { |
| [493](#L493) | $init\_notification\_hooks = apply\_filters( 'wprus\_init\_notification\_hooks', true ); |
| [494](#L494) |  |
| [495](#L495) | if ( ! $init\_notification\_hooks ) { |
| [496](#L496) |  |
| [497](#L497) | return; |
| [498](#L498) | } |
| [499](#L499) |  |
| [500](#L500) | if ( ! $this->needs\_redirect() ) { |
| [501](#L501) |  |
| [502](#L502) | if ( ! has\_action( 'wp\_footer', array( $this, 'fire\_async\_actions' ) ) ) { |
| [503](#L503) | add\_action( 'wp\_footer', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [504](#L504) | } |
| [505](#L505) |  |
| [506](#L506) | if ( ! has\_action( 'admin\_footer', array( $this, 'fire\_async\_actions' ) ) ) { |
| [507](#L507) | add\_action( 'admin\_footer', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | if ( ! has\_action( 'login\_footer', array( $this, 'fire\_async\_actions' ) ) ) { |
| [511](#L511) | add\_action( 'login\_footer', array( $this, 'fire\_async\_actions' ), PHP\_INT\_MIN + 100, 0 ); |
| [512](#L512) | } |
| [513](#L513) | } else { |
| [514](#L514) | $this->init\_async\_redirect\_hooks(); |
| [515](#L515) | } |
| [516](#L516) |  |
| [517](#L517) | if ( ! has\_action( 'shutdown', array( $this, 'save\_async\_actions' ) ) ) { |
| [518](#L518) | add\_action( 'shutdown', array( $this, 'save\_async\_actions' ), 10, 0 ); |
| [519](#L519) | } |
| [520](#L520) | } |
| [521](#L521) |  |
| [522](#L522) | /\*\* |
| [523](#L523) | \* Inititialise WordPress action hooks used to process silent redirected async actions |
| [524](#L524) | \* |
| [525](#L525) | \*/ |
| [526](#L526) | public function init\_silent\_async\_redirect\_hooks() {} |
| [527](#L527) |  |
| [528](#L528) | /\*\* |
| [529](#L529) | \* Determine whether the endpoint can handle async actions. |
| [530](#L530) | \* |
| [531](#L531) | \* @return bool whether the endpoint can handle async actions |
| [532](#L532) | \*/ |
| [533](#L533) | public function has\_async\_actions() { |
| [534](#L534) | return false; |
| [535](#L535) | } |
| [536](#L536) |  |
| [537](#L537) | /\*\* |
| [538](#L538) | \* Determines wether the endpoint needs to redirect the current page |
| [539](#L539) | \* |
| [540](#L540) | \* @return bool wether the endpoint needs to redirect the current page |
| [541](#L541) | \*/ |
| [542](#L542) | public function needs\_redirect() { |
| [543](#L543) | return false; |
| [544](#L544) | } |
| [545](#L545) |  |
| [546](#L546) | /\*\* |
| [547](#L547) | \* Determines wether the endpoint redirections need to be silent or output content |
| [548](#L548) | \* |
| [549](#L549) | \* @return bool wether the endpoint redirections need to be silent or output content |
| [550](#L550) | \*/ |
| [551](#L551) | public function is\_silent\_async\_action\_redirect() { |
| [552](#L552) | return false; |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | /\*\* |
| [556](#L556) | \* Inititialise data received from remote sites |
| [557](#L557) | \* |
| [558](#L558) | \*/ |
| [559](#L559) | public function init\_data() { |
| [560](#L560) | $data\_get     = filter\_input( INPUT\_GET, 'wprusdata', FILTER\_UNSAFE\_RAW ); |
| [561](#L561) | $data\_post    = filter\_input( INPUT\_POST, 'wprusdata', FILTER\_UNSAFE\_RAW ); |
| [562](#L562) | $this->method = ( $data\_post ) ? 'post' : 'get'; |
| [563](#L563) | $this->data   = array( |
| [564](#L564) | 'get'  => ( $data\_get ) ? $this->decrypt\_data( $data\_get ) : null, |
| [565](#L565) | 'post' => ( $data\_post ) ? $this->decrypt\_data( $data\_post ) : null, |
| [566](#L566) | ); |
| [567](#L567) | } |
| [568](#L568) |  |
| [569](#L569) | /\*\* |
| [570](#L570) | \* Add endpoint entries to a list of endpoints |
| [571](#L571) | \* |
| [572](#L572) | \* @param array $endpoints The list of endpoints |
| [573](#L573) | \* @return array The list of endpoints |
| [574](#L574) | \*/ |
| [575](#L575) | public function add\_action\_endpoints( $endpoints ) { |
| [576](#L576) | $endpoints = array\_merge( |
| [577](#L577) | $endpoints, |
| [578](#L578) | $this->get\_endpoints() |
| [579](#L579) | ); |
| [580](#L580) |  |
| [581](#L581) | return $endpoints; |
| [582](#L582) | } |
| [583](#L583) |  |
| [584](#L584) | /\*\* |
| [585](#L585) | \* Get the site information where the specified endpoint is active for the specify direction |
| [586](#L586) | \* |
| [587](#L587) | \* @param string $endpoint The endpoints key |
| [588](#L588) | \* @param string $site\_url The URL of the site ; `false` will use the URL of the local site |
| [589](#L589) | \* @param string $direction The direction for which the endpoint is active - 'incoming' or 'outgoing' ; 'incoming by default' |
| [590](#L590) | \* @return array|bool The site information ; `false` if no corresponding site information |
| [591](#L591) | \*/ |
| [592](#L592) | public function get\_active\_site\_for\_action( $endpoint, $site\_url = false, $direction = 'incoming' ) { |
| [593](#L593) | $site\_url = ( $site\_url ) ? $site\_url : get\_option( 'home' ); |
| [594](#L594) | $site     = $this->settings->get\_site( $site\_url, $endpoint, $direction ); |
| [595](#L595) |  |
| [596](#L596) | return $site; |
| [597](#L597) | } |
| [598](#L598) |  |
| [599](#L599) | /\*\* |
| [600](#L600) | \* Handle requests for test pings and reply with JSON data |
| [601](#L601) | \* |
| [602](#L602) | \*/ |
| [603](#L603) | public function handle\_ping\_notification() { |
| [604](#L604) | $data = $this->get\_data\_post(); |
| [605](#L605) |  |
| [606](#L606) | if ( empty( $data ) ) { |
| [607](#L607) | Wprus\_Logger::log( \_\_( 'A ping was received but the initiator did not use matching encryption and signature action keys', 'wprus' ), 'info', 'db\_log' ); |
| [608](#L608) | wp\_send\_json\_error( \_\_( 'Mismatch Encryption settings - please make sure the action keys are correctly configured on both sites.', 'wprus' ) ); |
| [609](#L609) | } |
| [610](#L610) |  |
| [611](#L611) | if ( |
| [612](#L612) | empty( $data['base\_url'] ) || |
| [613](#L613) | empty( $data['direction'] ) || |
| [614](#L614) | ( |
| [615](#L615) | 'incoming' !== $data['direction'] && |
| [616](#L616) | 'outgoing' !== $data['direction'] |
| [617](#L617) | ) |
| [618](#L618) | ) { |
| [619](#L619) | Wprus\_Logger::log( \_\_( 'A ping was received but the initiator did not send the proper data.', 'wprus' ), 'info', 'db\_log' ); |
| [620](#L620) | wp\_send\_json\_error( \_\_( 'Malformed data - the test request was received but the data could not be extracted.', 'wprus' ) ); |
| [621](#L621) | } |
| [622](#L622) |  |
| [623](#L623) | $site            = $this->get\_active\_site\_for\_action( $this->endpoint, $data['base\_url'], $data['direction'] ); |
| [624](#L624) | $action\_label    = $this->endpoint; |
| [625](#L625) | $direction\_label = ( 'incoming' === $data['direction'] ) ? \_\_( 'incoming', 'wprus' ) : \_\_( 'outgoing', 'wprus' ); |
| [626](#L626) | $remote\_addr     = $\_SERVER['REMOTE\_ADDR']; |
| [627](#L627) | $settings\_class  = self::$settings\_class; |
| [628](#L628) | $class\_vars      = get\_class\_vars( $settings\_class ); |
| [629](#L629) |  |
| [630](#L630) | if ( isset( $class\_vars['actions'][ $action\_label ] ) ) { |
| [631](#L631) | $action\_label = $class\_vars['actions'][ $action\_label ]; |
| [632](#L632) | } |
| [633](#L633) |  |
| [634](#L634) | if ( $site ) { |
| [635](#L635) | do\_action( 'wprus\_ping\_success', $this->endpoint, $data, $remote\_addr ); |
| [636](#L636) |  |
| [637](#L637) | // translators: %1$s is the sync action name, %2$s is the remote site URL, %3$s is the remote IP, %4$s is the direction |
| [638](#L638) | $message = \_\_( 'Ping received for activated action "%1$s" from %2$s with remote IP %3$s (%4$s)', 'wprus' ); |
| [639](#L639) |  |
| [640](#L640) | Wprus\_Logger::log( |
| [641](#L641) | sprintf( |
| [642](#L642) | $message, |
| [643](#L643) | $action\_label, |
| [644](#L644) | $data['base\_url'], |
| [645](#L645) | $remote\_addr, |
| [646](#L646) | $direction\_label |
| [647](#L647) | ), |
| [648](#L648) | 'success', |
| [649](#L649) | 'db\_log' |
| [650](#L650) | ); |
| [651](#L651) |  |
| [652](#L652) | // translators: %1$s is the sync action name, %2$s is the current site URL, %3$s is the remote IP, %4$s is the direction |
| [653](#L653) | $message = \_\_( 'Ping success for action "%1$s" from %2$s with remote IP %3$s (%4$s)', 'wprus' ); |
| [654](#L654) |  |
| [655](#L655) | wp\_send\_json\_success( |
| [656](#L656) | sprintf( |
| [657](#L657) | $message, |
| [658](#L658) | $action\_label, |
| [659](#L659) | get\_option( 'home' ), |
| [660](#L660) | $remote\_addr, |
| [661](#L661) | $direction\_label |
| [662](#L662) | ) |
| [663](#L663) | ); |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) | do\_action( 'wprus\_ping\_failure', $this->endpoint, $data, $remote\_addr ); |
| [667](#L667) |  |
| [668](#L668) | // translators: %1$s is the sync action name, %2$s is the remote site URL, %3$s is the remote IP, %4$s is the direction |
| [669](#L669) | $message = \_\_( 'Ping received for deactivated action "%1$s" from %2$s with remote IP %3$s (%4$s)', 'wprus' ); |
| [670](#L670) |  |
| [671](#L671) | Wprus\_Logger::log( |
| [672](#L672) | sprintf( |
| [673](#L673) | $message, |
| [674](#L674) | $action\_label, |
| [675](#L675) | $data['base\_url'], |
| [676](#L676) | $remote\_addr, |
| [677](#L677) | $direction\_label |
| [678](#L678) | ), |
| [679](#L679) | 'warning', |
| [680](#L680) | 'db\_log' |
| [681](#L681) | ); |
| [682](#L682) |  |
| [683](#L683) | // translators: %1$s is the sync action name, %2$s is the current site URL, %3$s is the remote IP, %4$s is the direction |
| [684](#L684) | $message = \_\_( '"%1$s" action is not activated on %2$s with remote IP %3$s (%4$s).', 'wprus' ); |
| [685](#L685) | $message = sprintf( |
| [686](#L686) | $message, |
| [687](#L687) | $action\_label, |
| [688](#L688) | get\_option( 'home' ), |
| [689](#L689) | $remote\_addr, |
| [690](#L690) | $direction\_label |
| [691](#L691) | ); |
| [692](#L692) |  |
| [693](#L693) | wp\_send\_json\_error( $message ); |
| [694](#L694) | } |
| [695](#L695) |  |
| [696](#L696) | /\*\* |
| [697](#L697) | \* Send a test ping request to a remote website and send the response to the user interface |
| [698](#L698) | \* |
| [699](#L699) | \*/ |
| [700](#L700) | public function notify\_ping\_remote() { |
| [701](#L701) | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
| [702](#L702) |  |
| [703](#L703) | if ( ! wp\_verify\_nonce( $nonce, 'wprus\_ping\_nonce' ) ) { |
| [704](#L704) | wp\_send\_json\_error( \_\_( 'Error: unauthorized access - please reload the page and try again.', 'wprus' ) ); |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) | $url          = filter\_input( INPUT\_POST, 'site\_url', FILTER\_VALIDATE\_URL ); |
| [708](#L708) | $direction    = filter\_input( INPUT\_POST, 'direction', FILTER\_UNSAFE\_RAW ); |
| [709](#L709) | $data         = filter\_input( INPUT\_POST, 'data', FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
| [710](#L710) | $success      = false; |
| [711](#L711) | $payload      = false; |
| [712](#L712) | $default\_data = array( |
| [713](#L713) | 'ping'      => 1, |
| [714](#L714) | 'direction' => ( 'incoming' === $direction ) ? 'outgoing' : 'incoming', |
| [715](#L715) | ); |
| [716](#L716) |  |
| [717](#L717) | if ( $data ) { |
| [718](#L718) | $data = array\_merge( $default\_data, $data ); |
| [719](#L719) | } else { |
| [720](#L720) | $data = $default\_data; |
| [721](#L721) | } |
| [722](#L722) |  |
| [723](#L723) | $response = $this->fire\_action( |
| [724](#L724) | $url, |
| [725](#L725) | $data, |
| [726](#L726) | true, |
| [727](#L727) | 5 |
| [728](#L728) | ); |
| [729](#L729) |  |
| [730](#L730) | do\_action( 'wprus\_ping\_fired', $this->endpoint, $data, $response ); |
| [731](#L731) |  |
| [732](#L732) | if ( 200 === absint( $response['response\_code'] ) ) { |
| [733](#L733) | $data = json\_decode( $response['body'], true ); |
| [734](#L734) |  |
| [735](#L735) | if ( JSON\_ERROR\_NONE !== json\_last\_error() ) { |
| [736](#L736) | $payload  = \_\_( 'Error contacting the remote site: ', 'wprus' ); |
| [737](#L737) | $payload .= \_\_( 'Payload error - ' ) . json\_last\_error\_msg(); |
| [738](#L738) | } else { |
| [739](#L739) |  |
| [740](#L740) | if ( $data['success'] ) { |
| [741](#L741) | $success = true; |
| [742](#L742) | } |
| [743](#L743) |  |
| [744](#L744) | $payload = $data['data']; |
| [745](#L745) | } |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | if ( ! $success && ! $payload ) { |
| [749](#L749) | $payload = \_\_( 'Error contacting the remote site: ', 'wprus' ); |
| [750](#L750) |  |
| [751](#L751) | if ( |
| [752](#L752) | ! empty( $response['response\_code'] ) && |
| [753](#L753) | 200 !== $response['response\_code'] && |
| [754](#L754) | ! empty( $response['response\_message'] ) |
| [755](#L755) | ) { |
| [756](#L756) | $payload .= $response['response\_code'] . ' - ' . $response['response\_message']; |
| [757](#L757) | } else { |
| [758](#L758) | // translators: %s is the error code |
| [759](#L759) | $payload .= ( ! empty( $response['response\_code'] ) ) ? sprintf( \_\_( ' - code: %s - ', 'wprus' ), $response['response\_code'] ) : ''; |
| [760](#L760) | $payload .= \_\_( 'an undefined error occured. Please make sure the address is correct and try again.', 'wprus' ); |
| [761](#L761) | $payload .= "\n"; |
| [762](#L762) | $payload .= \_\_( 'On the remote site, please make sure the plugin is activated and that the permalinks are up to date by visiting the permalinks settings page.', 'wprus' ); |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | if ( 404 === absint( $response['response\_code'] ) ) { |
| [766](#L766) | $payload .= "\n"; |
| [767](#L767) | $payload .= \_\_( 'On the remote site, please make sure the permalinks are not using the "Plain" option.', 'wprus' ); |
| [768](#L768) | } |
| [769](#L769) | } |
| [770](#L770) |  |
| [771](#L771) | $log\_type = ( $success ) ? 'success' : 'alert'; |
| [772](#L772) |  |
| [773](#L773) | Wprus\_Logger::log( $payload, $log\_type, 'db\_log' ); |
| [774](#L774) |  |
| [775](#L775) | if ( ! $success ) { |
| [776](#L776) | Wprus\_Logger::log( |
| [777](#L777) | array( |
| [778](#L778) | 'message' => 'Response data received from the remote site: ', |
| [779](#L779) | $response, |
| [780](#L780) | ), |
| [781](#L781) | 'info', |
| [782](#L782) | 'db\_log' |
| [783](#L783) | ); |
| [784](#L784) | } |
| [785](#L785) |  |
| [786](#L786) | if ( $success ) { |
| [787](#L787) | wp\_send\_json\_success( $payload ); |
| [788](#L788) | } |
| [789](#L789) |  |
| [790](#L790) | wp\_send\_json\_error( $payload ); |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | /\*\* |
| [794](#L794) | \* Persist the user ID used to save and fire async actions. |
| [795](#L795) | \* |
| [796](#L796) | \*/ |
| [797](#L797) | public function set\_pending\_async\_actions\_user\_id() { |
| [798](#L798) |  |
| [799](#L799) | if ( 0 !== get\_current\_user\_id() ) { |
| [800](#L800) | $this->async\_user\_id = get\_current\_user\_id(); |
| [801](#L801) |  |
| [802](#L802) | $this->setcookie( |
| [803](#L803) | 'wprus\_user\_pending\_async\_actions', |
| [804](#L804) | bin2hex( $this->encrypt\_data( get\_current\_user\_id() ) ) |
| [805](#L805) | ); |
| [806](#L806) | } |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | /\*\* |
| [810](#L810) | \* Add async action to the list of async actions to add to the footer |
| [811](#L811) | \* |
| [812](#L812) | \*/ |
| [813](#L813) | public function add\_async\_action( $url, $data ) { |
| [814](#L814) | $data['base\_url'] = get\_option( 'home' ); |
| [815](#L815) | $data['url']      = $url; |
| [816](#L816) |  |
| [817](#L817) | $this->async\_actions[] = $data; |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) | /\*\* |
| [821](#L821) | \* Persist the list of async actions to add to the footer |
| [822](#L822) | \* |
| [823](#L823) | \*/ |
| [824](#L824) | public function save\_async\_actions() { |
| [825](#L825) |  |
| [826](#L826) | if ( ! empty( $this->async\_actions ) && $this->async\_user\_id ) { |
| [827](#L827) | update\_user\_meta( |
| [828](#L828) | $this->async\_user\_id, |
| [829](#L829) | 'wprus\_' . $this->endpoint . '\_pending\_async\_actions', |
| [830](#L830) | $this->async\_actions |
| [831](#L831) | ); |
| [832](#L832) | } |
| [833](#L833) | } |
| [834](#L834) |  |
| [835](#L835) | /\*\* |
| [836](#L836) | \* Fire the async actions |
| [837](#L837) | \* |
| [838](#L838) | \*/ |
| [839](#L839) | public function fire\_async\_actions() { |
| [840](#L840) | $location\_headers = preg\_grep( '/^Location:/i', headers\_list() ); |
| [841](#L841) |  |
| [842](#L842) | if ( ! empty( $location\_headers ) ) { |
| [843](#L843) |  |
| [844](#L844) | return; |
| [845](#L845) | } |
| [846](#L846) |  |
| [847](#L847) | if ( ! empty( $this->async\_actions ) ) { |
| [848](#L848) | $user\_id = get\_current\_user\_id() ? get\_current\_user\_id() : $this->async\_user\_id; |
| [849](#L849) | $actions = $this->async\_actions; |
| [850](#L850) | } else { |
| [851](#L851) |  |
| [852](#L852) | if ( is\_user\_logged\_in() ) { |
| [853](#L853) | $user\_id = get\_current\_user\_id(); |
| [854](#L854) | } else { |
| [855](#L855) | $cookie  = filter\_input( INPUT\_COOKIE, 'wprus\_user\_pending\_async\_actions' ); |
| [856](#L856) | $user\_id = ( $cookie ) ? $this->decrypt\_data( hex2bin( $cookie ) ) : false; |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | $user    = ( $user\_id ) ? get\_user\_by( 'ID', $user\_id ) : false; |
| [860](#L860) | $actions = ( $user ) ? get\_user\_meta( $user->ID, 'wprus\_' . $this->endpoint . '\_pending\_async\_actions', true ) : false; |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) | if ( $actions && $user\_id ) { |
| [864](#L864) | do\_action( 'wprus\_before\_firing\_async\_actions', $this->endpoint, $actions, $user\_id ); |
| [865](#L865) |  |
| [866](#L866) | if ( $this->needs\_redirect() ) { |
| [867](#L867) | $this->do\_async\_actions\_redirect( $actions, $user\_id ); |
| [868](#L868) | do\_action( 'wprus\_after\_firing\_async\_actions', $this->endpoint, $actions, $user\_id ); |
| [869](#L869) |  |
| [870](#L870) | exit(); |
| [871](#L871) | } else { |
| [872](#L872) | $this->print\_async\_actions\_markup( $actions, $user\_id ); |
| [873](#L873) | do\_action( 'wprus\_after\_firing\_async\_actions', $this->endpoint, $actions, $user\_id ); |
| [874](#L874) | } |
| [875](#L875) | } |
| [876](#L876) | } |
| [877](#L877) |  |
| [878](#L878) | /\*\* |
| [879](#L879) | \* Fire a sync action |
| [880](#L880) | \* |
| [881](#L881) | \* @param string $url The remote website's URL |
| [882](#L882) | \* @param mixed $data The data to send |
| [883](#L883) | \* @param bool $blocking whether the request needs to wait for a response - default `false` |
| [884](#L884) | \* @param int $timeout the maximum time to wait for a response in seconds - default `1` |
| [885](#L885) | \* @param string $endpoint the endpoint to send the request to - default `null` ; will use the $endpoint attribute value of the instance |
| [886](#L886) | \* @return array Response data |
| [887](#L887) | \*/ |
| [888](#L888) | public function fire\_action( $url, $data, $blocking = false, $timeout = 1, $endpoint = null ) { |
| [889](#L889) | $data['base\_url'] = get\_option( 'home' ); |
| [890](#L890) | $endpoint         = $endpoint ? $endpoint : $this->endpoint; |
| [891](#L891) | $timeout          = apply\_filters( 'wprus\_fire\_action\_timeout', $timeout, $endpoint, $url, $blocking ); |
| [892](#L892) |  |
| [893](#L893) | do\_action( 'wprus\_before\_firing\_action', $endpoint, $url, $data ); |
| [894](#L894) |  |
| [895](#L895) | $data     = apply\_filters( 'wprus\_action\_data', $data, $endpoint, $url ); |
| [896](#L896) | $body     = array( |
| [897](#L897) | 'wprusdata' => $this->encrypt\_data( $data ), |
| [898](#L898) | 'token'     => $this->get\_token( $url, $data['username'], 'post' ), |
| [899](#L899) | ); |
| [900](#L900) | $response = wp\_safe\_remote\_post( |
| [901](#L901) | trailingslashit( $url ) . 'wprus/' . trailingslashit( $endpoint ), |
| [902](#L902) | array( |
| [903](#L903) | 'body'     => $body, |
| [904](#L904) | 'blocking' => $blocking, |
| [905](#L905) | 'compress' => true, |
| [906](#L906) | 'timeout'  => $timeout, |
| [907](#L907) | ) |
| [908](#L908) | ); |
| [909](#L909) | $headers  = wp\_remote\_retrieve\_headers( $response ); |
| [910](#L910) |  |
| [911](#L911) | if ( ! empty( $headers ) ) { |
| [912](#L912) | $headers = $headers->getAll(); |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | do\_action( 'wprus\_after\_firing\_action', $endpoint, $url, $data, $response ); |
| [916](#L916) |  |
| [917](#L917) | return array( |
| [918](#L918) | 'headers'          => $headers, |
| [919](#L919) | 'response\_code'    => wp\_remote\_retrieve\_response\_code( $response ), |
| [920](#L920) | 'response\_message' => wp\_remote\_retrieve\_response\_message( $response ), |
| [921](#L921) | 'body'             => wp\_remote\_retrieve\_body( $response ), |
| [922](#L922) | ); |
| [923](#L923) | } |
| [924](#L924) |  |
| [925](#L925) | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
| [926](#L926) | \* Protected methods |
| [927](#L927) | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
| [928](#L928) |  |
| [929](#L929) | /\*\* |
| [930](#L930) | \* Get security token for the specified remote site URL and username |
| [931](#L931) | \* |
| [932](#L932) | \* @param string $url The remote website's URL |
| [933](#L933) | \* @param string $username The WordPress user login name |
| [934](#L934) | \* @param string $method The request method - `'get'` or `'post'` ; if `'get'`, the token will not be stored ; default `'post'` |
| [935](#L935) | \* @return string|bool The security token |
| [936](#L936) | \*/ |
| [937](#L937) | protected function get\_token( $url, $username, $method = 'post' ) { |
| [938](#L938) | $user        = get\_user\_by( 'login', $username ); |
| [939](#L939) | $tokens\_info = ( $user ) ? get\_user\_meta( $user->ID, 'wprus\_api\_tokens', true ) : null; |
| [940](#L940) | $tokens\_info = ( null !== $tokens\_info && ! $tokens\_info ) ? array() : $tokens\_info; |
| [941](#L941) |  |
| [942](#L942) | if ( null === $tokens\_info ) { |
| [943](#L943) |  |
| [944](#L944) | return false; |
| [945](#L945) | } |
| [946](#L946) |  |
| [947](#L947) | if ( isset( $tokens\_info[ $url ] ) && 'get' === $method ) { |
| [948](#L948) | unset( $tokens\_info[ $url ] ); |
| [949](#L949) | } |
| [950](#L950) |  |
| [951](#L951) | if ( |
| [952](#L952) | ! isset( $tokens\_info[ $url ] ) || |
| [953](#L953) | $tokens\_info[ $url ]['expiry'] <= time() - self::TOKEN\_EXPIRY\_BUFFER |
| [954](#L954) | ) { |
| [955](#L955) | $payload    = array( |
| [956](#L956) | 'action'   => $this->endpoint, |
| [957](#L957) | 'method'   => $method, |
| [958](#L958) | 'base\_url' => $url, |
| [959](#L959) | ); |
| [960](#L960) | $token\_info = $this->get\_remote\_token( $payload ); |
| [961](#L961) |  |
| [962](#L962) | if ( $token\_info ) { |
| [963](#L963) | $tokens\_info[ $url ] = $token\_info; |
| [964](#L964) | } elseif ( isset( $tokens\_info[ $url ] ) ) { |
| [965](#L965) | unset( $tokens\_info[ $url ] ); |
| [966](#L966) | } |
| [967](#L967) |  |
| [968](#L968) | if ( 'post' === $method ) { |
| [969](#L969) | update\_user\_meta( $user->ID, 'wprus\_api\_tokens', $tokens\_info ); |
| [970](#L970) | } |
| [971](#L971) | } |
| [972](#L972) |  |
| [973](#L973) | return isset( $tokens\_info[ $url ]['nonce'] ) ? $tokens\_info[ $url ]['nonce'] : false; |
| [974](#L974) | } |
| [975](#L975) |  |
| [976](#L976) | /\*\* |
| [977](#L977) | \* Renew the security token for a specific payload |
| [978](#L978) | \* |
| [979](#L979) | \* @param array $payload The payload to send to the remote site |
| [980](#L980) | \* @return array|bool The security token information on success - `false` on failure |
| [981](#L981) | \*/ |
| [982](#L982) | protected function get\_remote\_token( $payload ) { |
| [983](#L983) |  |
| [984](#L984) | if ( self::$can\_request\_token ) { |
| [985](#L985) | $timeout = apply\_filters( 'wprus\_request\_token\_timeout', 1 ); |
| [986](#L986) |  |
| [987](#L987) | // translators: %s is the url of the caller |
| [988](#L988) | Wprus\_Logger::log( sprintf( \_\_( 'Renewing token for %s', 'wprus' ), $payload['base\_url'] ), 'info', 'db\_log' ); |
| [989](#L989) | } else { |
| [990](#L990) | $timeout = apply\_filters( 'wprus\_request\_token\_retry\_timeout', 5 ); |
| [991](#L991) | } |
| [992](#L992) |  |
| [993](#L993) | $token\_info = false; |
| [994](#L994) | $response   = wp\_remote\_post( |
| [995](#L995) | trailingslashit( $payload['base\_url'] ) . 'wprus/token/', |
| [996](#L996) | array( |
| [997](#L997) | 'body'     => array( |
| [998](#L998) | 'wprusdata' => $this->encrypt\_data( $payload ), |
| [999](#L999) | ), |
| [1000](#L1000) | 'compress' => true, |
| [1001](#L1001) | 'timeout'  => $timeout, |
| [1002](#L1002) | ) |
| [1003](#L1003) | ); |
| [1004](#L1004) |  |
| [1005](#L1005) | $body = wp\_remote\_retrieve\_body( $response ); |
| [1006](#L1006) |  |
| [1007](#L1007) | if ( $body && 200 === wp\_remote\_retrieve\_response\_code( $response ) ) { |
| [1008](#L1008) | $token\_info = json\_decode( $body, true ); |
| [1009](#L1009) | } elseif ( self::$can\_request\_token ) { |
| [1010](#L1010) | Wprus\_Logger::log( |
| [1011](#L1011) | sprintf( |
| [1012](#L1012) | // translators: %s is the url of the caller |
| [1013](#L1013) | \_\_( 'Failed to renew token for %s - retrying...', 'wprus' ), |
| [1014](#L1014) | $payload['base\_url'] |
| [1015](#L1015) | ), |
| [1016](#L1016) | 'warning', |
| [1017](#L1017) | 'db\_log' |
| [1018](#L1018) | ); |
| [1019](#L1019) |  |
| [1020](#L1020) | self::$can\_request\_token = false; |
| [1021](#L1021) | $token\_info              = $this->get\_remote\_token( $payload ); |
| [1022](#L1022) | } |
| [1023](#L1023) |  |
| [1024](#L1024) | if ( ! $token\_info && ! self::$can\_request\_token ) { |
| [1025](#L1025) | Wprus\_Logger::log( |
| [1026](#L1026) | sprintf( |
| [1027](#L1027) | // translators: %s is the url of the caller |
| [1028](#L1028) | \_\_( 'Failed to renew token for %s', 'wprus' ), |
| [1029](#L1029) | $payload['base\_url'] |
| [1030](#L1030) | ), |
| [1031](#L1031) | 'alert', |
| [1032](#L1032) | 'db\_log' |
| [1033](#L1033) | ); |
| [1034](#L1034) |  |
| [1035](#L1035) | if ( is\_wp\_error( $response ) ) { |
| [1036](#L1036) | Wprus\_Logger::log( |
| [1037](#L1037) | array( |
| [1038](#L1038) | 'message' => 'A WordPress error was triggered: ', |
| [1039](#L1039) | $response->get\_error\_code() . ' ' . $response->get\_error\_message(), |
| [1040](#L1040) | ), |
| [1041](#L1041) | 'info', |
| [1042](#L1042) | 'db\_log' |
| [1043](#L1043) | ); |
| [1044](#L1044) | } else { |
| [1045](#L1045) | $headers = wp\_remote\_retrieve\_headers( $response ); |
| [1046](#L1046) |  |
| [1047](#L1047) | if ( ! empty( $headers ) ) { |
| [1048](#L1048) | $headers = $headers->getAll(); |
| [1049](#L1049) | } |
| [1050](#L1050) |  |
| [1051](#L1051) | Wprus\_Logger::log( |
| [1052](#L1052) | array( |
| [1053](#L1053) | 'message' => 'Response data received from the remote site: ', |
| [1054](#L1054) | array( |
| [1055](#L1055) | 'headers'          => $headers, |
| [1056](#L1056) | 'response\_code'    => wp\_remote\_retrieve\_response\_code( $response ), |
| [1057](#L1057) | 'response\_message' => wp\_remote\_retrieve\_response\_message( $response ), |
| [1058](#L1058) | 'body'             => wp\_remote\_retrieve\_body( $response ), |
| [1059](#L1059) | ), |
| [1060](#L1060) | ), |
| [1061](#L1061) | 'info', |
| [1062](#L1062) | 'db\_log' |
| [1063](#L1063) | ); |
| [1064](#L1064) | } |
| [1065](#L1065) | } |
| [1066](#L1066) |  |
| [1067](#L1067) | return $token\_info; |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) | /\*\* |
| [1071](#L1071) | \* Set cookie helper |
| [1072](#L1072) | \* |
| [1073](#L1073) | \* @param string $name The name of the cookie |
| [1074](#L1074) | \* @param mixed $value The cookie value |
| [1075](#L1075) | \* @param int $expire The time the cookie expires ; this is a Unix timestamp so is in number of seconds since the epoch - default `0` |
| [1076](#L1076) | \* @return array|bool The security token information on success - `false` on failure |
| [1077](#L1077) | \*/ |
| [1078](#L1078) | protected function setcookie( $name, $value, $expire = 0 ) { |
| [1079](#L1079) |  |
| [1080](#L1080) | if ( ! headers\_sent( $file, $line ) ) { |
| [1081](#L1081) |  |
| [1082](#L1082) | if ( PHP\_VERSION\_ID < 70300 ) { |
| [1083](#L1083) | setcookie( $name, $value, $expire, COOKIEPATH ? COOKIEPATH . '; SameSite=None' : '/; SameSite=None', COOKIE\_DOMAIN, true, false ); |
| [1084](#L1084) | } else { |
| [1085](#L1085) | setcookie( |
| [1086](#L1086) | $name, |
| [1087](#L1087) | $value, |
| [1088](#L1088) | array( |
| [1089](#L1089) | 'expires'  => $expire, |
| [1090](#L1090) | 'path'     => COOKIEPATH ? COOKIEPATH : '/', |
| [1091](#L1091) | 'domain'   => COOKIE\_DOMAIN, |
| [1092](#L1092) | 'secure'   => true, |
| [1093](#L1093) | 'httponly' => false, |
| [1094](#L1094) | 'samesite' => 'None', |
| [1095](#L1095) | ) |
| [1096](#L1096) | ); |
| [1097](#L1097) | } |
| [1098](#L1098) | } elseif ( defined( 'WP\_DEBUG' ) && WP\_DEBUG ) { |
| [1099](#L1099) | trigger\_error(  // phpcs:ignore WordPress.PHP.DevelopmentFunctions.error\_log\_trigger\_error |
| [1100](#L1100) | esc\_html( $name . 'cookie cannot be set - headers already sent by ' . $file . 'on line' . $line ), |
| [1101](#L1101) | E\_USER\_NOTICE |
| [1102](#L1102) | ); |
| [1103](#L1103) | } |
| [1104](#L1104) | } |
| [1105](#L1105) |  |
| [1106](#L1106) | /\*\* |
| [1107](#L1107) | \* Get data received from remote site with GET method |
| [1108](#L1108) | \* |
| [1109](#L1109) | \* @return mixed The data |
| [1110](#L1110) | \*/ |
| [1111](#L1111) | protected function get\_data\_get() { |
| [1112](#L1112) | $data\_get = $this->data['get']; |
| [1113](#L1113) |  |
| [1114](#L1114) | return $data\_get; |
| [1115](#L1115) | } |
| [1116](#L1116) |  |
| [1117](#L1117) | /\*\* |
| [1118](#L1118) | \* Get data received from remote site with POST method |
| [1119](#L1119) | \* |
| [1120](#L1120) | \* @return mixed The data |
| [1121](#L1121) | \*/ |
| [1122](#L1122) | protected function get\_data\_post() { |
| [1123](#L1123) | $data\_post = $this->data['post']; |
| [1124](#L1124) |  |
| [1125](#L1125) | return $data\_post; |
| [1126](#L1126) | } |
| [1127](#L1127) |  |
| [1128](#L1128) | /\*\* |
| [1129](#L1129) | \* Get data received from remote site with both GET and POST methods |
| [1130](#L1130) | \* |
| [1131](#L1131) | \* @return array The data |
| [1132](#L1132) | \*/ |
| [1133](#L1133) | protected function get\_data() { |
| [1134](#L1134) | $data = array(); |
| [1135](#L1135) |  |
| [1136](#L1136) | if ( ! empty( $this->data['get'] ) && is\_array( $this->data['get'] ) ) { |
| [1137](#L1137) | $data = array\_merge( $data, $this->data['get'] ); |
| [1138](#L1138) | } elseif ( ! empty( $this->data['get'] ) ) { |
| [1139](#L1139) | $data[] = $this->data['get']; |
| [1140](#L1140) | } |
| [1141](#L1141) |  |
| [1142](#L1142) | if ( ! empty( $this->data['post'] ) && is\_array( $this->data['post'] ) ) { |
| [1143](#L1143) | $data = array\_merge( $data, $this->data['post'] ); |
| [1144](#L1144) | } elseif ( ! empty( $this->data['post'] ) ) { |
| [1145](#L1145) | $data[] = $this->data['post']; |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | return $data; |
| [1149](#L1149) | } |
| [1150](#L1150) |  |
| [1151](#L1151) | /\*\* |
| [1152](#L1152) | \* Check whether the data received from remote site is valid |
| [1153](#L1153) | \* @param array The data to validate |
| [1154](#L1154) | \* @return bool Whether the data is valid |
| [1155](#L1155) | \*/ |
| [1156](#L1156) | protected function validate( $data ) { |
| [1157](#L1157) | $valid = |
| [1158](#L1158) | isset( $data['username'] ) && |
| [1159](#L1159) | ! empty( $data['username'] ) && |
| [1160](#L1160) | isset( $data['base\_url'] ) && |
| [1161](#L1161) | ! empty( $data['base\_url'] ); |
| [1162](#L1162) |  |
| [1163](#L1163) | return $valid; |
| [1164](#L1164) | } |
| [1165](#L1165) |  |
| [1166](#L1166) | /\*\* |
| [1167](#L1167) | \* Sanitize data received from remote site |
| [1168](#L1168) | \* @param array The data to sanitize |
| [1169](#L1169) | \* @return bool The sanitized data |
| [1170](#L1170) | \*/ |
| [1171](#L1171) | protected function sanitize( $data ) { |
| [1172](#L1172) | return $data; |
| [1173](#L1173) | } |
| [1174](#L1174) |  |
| [1175](#L1175) | /\*\* |
| [1176](#L1176) | \* Get endpoints entries for this instance |
| [1177](#L1177) | \* |
| [1178](#L1178) | \* @return array The instance's endpoint entries |
| [1179](#L1179) | \*/ |
| [1180](#L1180) | protected function get\_endpoints() { |
| [1181](#L1181) | return array( |
| [1182](#L1182) | $this->endpoint => $this->endpoint, |
| [1183](#L1183) | ); |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | /\*\* |
| [1187](#L1187) | \* Get the URL to redirect to when performing async actions requiring redirections |
| [1188](#L1188) | \* |
| [1189](#L1189) | \* @param string $ajax\_fallback The URL to fallback to in case we're in an ajax request ; default false, which will result to home\_url() |
| [1190](#L1190) | \* @return string the current URL |
| [1191](#L1191) | \*/ |
| [1192](#L1192) | protected function get\_redirect\_url( $ajax\_fallback = false ) { |
| [1193](#L1193) | $parts = wp\_parse\_url( home\_url() ); |
| [1194](#L1194) | $url   = $parts['scheme'] . '://' . $parts['host'] . add\_query\_arg( null, null ); |
| [1195](#L1195) |  |
| [1196](#L1196) | if ( false !== strpos( $url, 'admin-ajax.php' ) ) { |
| [1197](#L1197) | $ajax\_fallback = ( $ajax\_fallback ) ? $ajax\_fallback : home\_url(); |
| [1198](#L1198) | $url           = apply\_filters( 'wprus\_get\_redirect\_url\_ajax', $ajax\_fallback, $this->endpoint ); |
| [1199](#L1199) | } |
| [1200](#L1200) |  |
| [1201](#L1201) | return $url; |
| [1202](#L1202) | } |
| [1203](#L1203) |  |
| [1204](#L1204) | /\*\* |
| [1205](#L1205) | \* Redirect the page to perform asyn actions with fallback output for javascript redirection |
| [1206](#L1206) | \* |
| [1207](#L1207) | \* @param array $actions The async actions to fire |
| [1208](#L1208) | \* @param int $user\_id The ID of the user for which the actions are to be fired |
| [1209](#L1209) | \*/ |
| [1210](#L1210) | protected function do\_async\_actions\_redirect( $actions, $user\_id ) { |
| [1211](#L1211) | $data                 = array\_pop( $actions ); |
| [1212](#L1212) | $data['callback\_url'] = $this->get\_redirect\_url(); |
| [1213](#L1213) | $url                  = trailingslashit( $data['url'] ); |
| [1214](#L1214) | $async\_url            = $url . 'wprus/' . trailingslashit( $this->endpoint ); |
| [1215](#L1215) |  |
| [1216](#L1216) | unset( $data['url'] ); |
| [1217](#L1217) |  |
| [1218](#L1218) | $data      = apply\_filters( 'wprus\_action\_data', $data, $this->endpoint, $url ); |
| [1219](#L1219) | $args      = array( |
| [1220](#L1220) | 'wprusdata' => rawurlencode( $this->encrypt\_data( $data ) ), |
| [1221](#L1221) | 'token'     => rawurlencode( $this->get\_token( $url, $data['username'], 'get' ) ), |
| [1222](#L1222) | ); |
| [1223](#L1223) | $async\_url = add\_query\_arg( $args, $async\_url ); |
| [1224](#L1224) | $output    = $this->get\_async\_action\_output( $async\_url, true ); |
| [1225](#L1225) |  |
| [1226](#L1226) | update\_user\_meta( $user\_id, 'wprus\_' . $this->endpoint . '\_pending\_async\_actions', $actions ); |
| [1227](#L1227) | Wprus\_Logger::log( |
| [1228](#L1228) | sprintf( |
| [1229](#L1229) | // translators: %1$s is the url of the endpoint ; %2$s is the action called |
| [1230](#L1230) | \_\_( 'Ready to redirect to %1$s async URL in %2$s', 'wprus' ), |
| [1231](#L1231) | $async\_url, |
| [1232](#L1232) | current\_filter() |
| [1233](#L1233) | ), |
| [1234](#L1234) | 'info', |
| [1235](#L1235) | 'db\_log' |
| [1236](#L1236) | ); |
| [1237](#L1237) |  |
| [1238](#L1238) | if ( $this->is\_silent\_async\_action\_redirect() ) { |
| [1239](#L1239) | wp\_redirect( $async\_url, 303 ); // phpcs:ignore WordPress.Security.SafeRedirect.wp\_redirect\_wp\_redirect |
| [1240](#L1240) | } |
| [1241](#L1241) |  |
| [1242](#L1242) | echo $output; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
| [1243](#L1243) | } |
| [1244](#L1244) |  |
| [1245](#L1245) | /\*\* |
| [1246](#L1246) | \* Print the markup used by async actions |
| [1247](#L1247) | \* |
| [1248](#L1248) | \* @param array $actions The async actions to fire |
| [1249](#L1249) | \* @param int $user\_id The ID of the user for which the actions are to be fired |
| [1250](#L1250) | \*/ |
| [1251](#L1251) | protected function print\_async\_actions\_markup( $actions, $user\_id ) { |
| [1252](#L1252) | $output = ''; |
| [1253](#L1253) |  |
| [1254](#L1254) | foreach ( $actions as $action\_index => $data ) { |
| [1255](#L1255) | $url       = trailingslashit( $data['url'] ); |
| [1256](#L1256) | $async\_url = $url . 'wprus/' . trailingslashit( $this->endpoint ); |
| [1257](#L1257) |  |
| [1258](#L1258) | unset( $data['url'] ); |
| [1259](#L1259) |  |
| [1260](#L1260) | $data      = apply\_filters( 'wprus\_action\_data', $data, $this->endpoint, $url ); |
| [1261](#L1261) | $args      = array( |
| [1262](#L1262) | 'wprusdata' => rawurlencode( $this->encrypt\_data( $data ) ), |
| [1263](#L1263) | 'token'     => rawurlencode( $this->get\_token( $url, $data['username'], 'get' ) ), |
| [1264](#L1264) | ); |
| [1265](#L1265) | $async\_url = add\_query\_arg( $args, $async\_url ); |
| [1266](#L1266) | $output   .= $this->get\_async\_action\_output( $async\_url ); |
| [1267](#L1267) |  |
| [1268](#L1268) | Wprus\_Logger::log( |
| [1269](#L1269) | sprintf( |
| [1270](#L1270) | // translators: %1$s is the url of the script ; %2$s is the action called |
| [1271](#L1271) | \_\_( 'Added %1$s async URL in %2$s', 'wprus' ), |
| [1272](#L1272) | $async\_url, |
| [1273](#L1273) | current\_filter() |
| [1274](#L1274) | ), |
| [1275](#L1275) | 'info', |
| [1276](#L1276) | 'db\_log' |
| [1277](#L1277) | ); |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) | echo $output; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
| [1281](#L1281) | do\_action( 'wprus\_after\_firing\_async\_actions', $this->endpoint, $actions, $user\_id ); |
| [1282](#L1282) | delete\_user\_meta( $user\_id, 'wprus\_' . $this->endpoint . '\_pending\_async\_actions' ); |
| [1283](#L1283) |  |
| [1284](#L1284) | $this->async\_actions = array(); |
| [1285](#L1285) | } |
| [1286](#L1286) |  |
| [1287](#L1287) | /\*\* |
| [1288](#L1288) | \* Get the output needed to perform an async action |
| [1289](#L1289) | \* |
| [1290](#L1290) | \* @param string $async\_url The URL of an action |
| [1291](#L1291) | \* @param bool $redirect Whether the page needs to be redirected - if true, gets the fallback output for javascript redirection ; if false, gets the iframe used to perform the action ; default false |
| [1292](#L1292) | \*/ |
| [1293](#L1293) | protected function get\_async\_action\_output( $async\_url, $redirect = false ) { |
| [1294](#L1294) |  |
| [1295](#L1295) | if ( ! $redirect ) { |
| [1296](#L1296) | return '<iframe style="display:none" src="' . $async\_url . '"></iframe>'; // phpcs:ignor |
| [1297](#L1297) | } |
| [1298](#L1298) |  |
| [1299](#L1299) | ob\_start(); |
| [1300](#L1300) |  |
| [1301](#L1301) | wprus\_get\_template( 'redirect-processing.php' ); |
| [1302](#L1302) |  |
| [1303](#L1303) | $output  = ob\_get\_clean(); |
| [1304](#L1304) | $search  = array( |
| [1305](#L1305) | '/\>[^\S ]+/s', |
| [1306](#L1306) | '/[^\S ]+\</s', |
| [1307](#L1307) | '/(\s)+/s', |
| [1308](#L1308) | '/<!--(.|\s)\*?-->/', |
| [1309](#L1309) | ); |
| [1310](#L1310) | $replace = array( |
| [1311](#L1311) | '>', |
| [1312](#L1312) | '<', |
| [1313](#L1313) | '\\1', |
| [1314](#L1314) | '', |
| [1315](#L1315) | ); |
| [1316](#L1316) | $output  = preg\_replace( $search, $replace, $output ); |
| [1317](#L1317) |  |
| [1318](#L1318) | ob\_start(); |
| [1319](#L1319) |  |
| [1320](#L1320) | wprus\_get\_template( |
| [1321](#L1321) | 'redirect-processing-script.php', |
| [1322](#L1322) | array( |
| [1323](#L1323) | 'async\_url' => $async\_url, |
| [1324](#L1324) | 'output'    => $output, |
| [1325](#L1325) | ) |
| [1326](#L1326) | ); |
| [1327](#L1327) |  |
| [1328](#L1328) | $output = ob\_get\_clean(); |
| [1329](#L1329) |  |
| [1330](#L1330) | return $output; |
| [1331](#L1331) | } |
| [1332](#L1332) |  |
| [1333](#L1333) | /\*\* |
| [1334](#L1334) | \* check if ip is in range |
| [1335](#L1335) | \* |
| [1336](#L1336) | \* @param string $ip The ip address to check against the range |
| [1337](#L1337) | \* @param string $range The CIDR |
| [1338](#L1338) | \* @return bool True if the ip is in range, false otherwise |
| [1339](#L1339) | \*/ |
| [1340](#L1340) | protected function cidr\_match( $ip, $range ) { |
| [1341](#L1341) | list ( $subnet, $bits ) = explode( '/', $range ); |
| [1342](#L1342) | $ip                     = ip2long( $ip ); |
| [1343](#L1343) | $subnet                 = ip2long( $subnet ); |
| [1344](#L1344) |  |
| [1345](#L1345) | if ( ! $ip || ! $subnet || ! $bits ) { |
| [1346](#L1346) |  |
| [1347](#L1347) | return false; |
| [1348](#L1348) | } |
| [1349](#L1349) |  |
| [1350](#L1350) | $mask    = -1 << ( 32 - $bits ); |
| [1351](#L1351) | $subnet &= $mask; // in case the supplied subnet was not correctly aligned |
| [1352](#L1352) |  |
| [1353](#L1353) | return ( $ip & $mask ) === $subnet; |
| [1354](#L1354) | } |
| [1355](#L1355) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?format=txt)
* [Original Format](/export/3222438/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_6d6781b7_20250114_184442.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2953845%2Fwp-remote-users-sync)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2946667/wp-remote-users-sync "Changeset 2946667 for wp-remote-users-sync")
* [Next Change](/changeset/2983826/wp-remote-users-sync "Changeset 2983826 for wp-remote-users-sync") →

---

# Changeset [2953845](/changeset/2953845 "Show full changeset") for [wp-remote-users-sync](/browser/wp-remote-users-sync?rev=2953845 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/15/2023 01:59:03 PM
([17 months](/timeline?from=2023-08-15T13%3A59%3A03Z&precision=second "See timeline at 08/15/2023 01:59:03 PM") ago)

Author:
frogerme
Message:

v1.2.13

Location:
[wp-remote-users-sync/trunk](/browser/wp-remote-users-sync/trunk?rev=2953845)
Files:

3 edited

* [inc/api/class-wprus-api-abstract.php](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2953845 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [readme.txt](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2953845 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [wprus.php](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2953845 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php](/changeset/2953845/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php "Show the changeset 2953845 restricted to wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php")

  | [r2946667](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L879 "Show revision 2946667 of this file in browser") | [r2953845](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2953845#L879 "Show revision 2953845 of this file in browser") |  |
  | --- | --- | --- |
  | 879 | 879 | 'token'     => $this->get\_token( $url, $data['username'], 'post' ), |
  | 880 | 880 | ); |
  | 881 |  | $response = wp\_remote\_post( |
  |  | 881 | $response = wp\_safe\_remote\_post( |
  | 882 | 882 | trailingslashit( $url ) . 'wprus/' . trailingslashit( $endpoint ), |
  | 883 | 883 | array( |
* ## [wp-remote-users-sync/trunk/readme.txt](/changeset/2953845/wp-remote-users-sync/trunk/readme.txt "Show the changeset 2953845 restricted to wp-remote-users-sync/trunk/readme.txt")

  | [r2946667](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L169 "Show revision 2946667 of this file in browser") | [r2953845](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2953845#L169 "Show revision 2953845 of this file in browser") |  |
  | --- | --- | --- |
  | 169 | 169 | More help can be found on <a href="https://wordpress.org/support/plugin/wp-remote-users-sync/">the WordPress support forum</a> for general inquiries and on <a href="https://github.com/froger-me/wp-remote-users-sync">Github</a> for advanced troubleshooting. |
  | 170 | 170 |  |
  | 171 |  | Help is provided for general enquiries and bug fixes only: feature requests, extra integration or conflict resolution with third-party themes or plugins, and specific setup troubleshooting requests will not be addressed (Web~~iste administrators must cont~~). |
  |  | 171 | Help is provided for general enquiries and bug fixes only: feature requests, extra integration or conflict resolution with third-party themes or plugins, and specific setup troubleshooting requests will not be addressed (Website administrators must contact a third-party developer). |
  | 172 | 172 |  |
  | 173 | 173 | == Changelog == |
  |  | 174 |  |
  |  | 175 | = 1.2.13 = |
  |  | 176 | \* Use `wp\_safe\_remote\_post` instead of `wp\_remote\_post` |
  | 174 | 177 |  |
  | 175 | 178 | = 1.2.12 = |
* ## [wp-remote-users-sync/trunk/wprus.php](/changeset/2953845/wp-remote-users-sync/trunk/wprus.php "Show the changeset 2953845 restricted to wp-remote-users-sync/trunk/wprus.php")

  | [r2946667](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2946667#L4 "Show revision 2946667 of this file in browser") | [r2953845](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2953845#L4 "Show revision 2953845 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: https://github.com/froger-me/wp-remote-users-sync |
  | 5 | 5 | Description: Synchronise WordPress Users across Multiple Sites. |
  | 6 |  | Version: 1.2.1~~2~~ |
  |  | 6 | Version: 1.2.13 |
  | 7 | 7 | Author: Alexandre Froger |
  | 8 | 8 | Author URI: https://froger.me/ |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2953845)
* [Zip Archive](?format=zip&new=2953845)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_b8a8294b_20250114_184435.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2946667%2Fwp-remote-users-sync)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2708689/wp-remote-users-sync "Changeset 2708689 for wp-remote-users-sync")
* [Next Change](/changeset/2953845/wp-remote-users-sync "Changeset 2953845 for wp-remote-users-sync") →

---

# Changeset [2946667](/changeset/2946667 "Show full changeset") for [wp-remote-users-sync](/browser/wp-remote-users-sync?rev=2946667 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/02/2023 02:01:16 PM
([18 months](/timeline?from=2023-08-02T14%3A01%3A16Z&precision=second "See timeline at 08/02/2023 02:01:16 PM") ago)

Author:
frogerme
Message:

v1.2.12

Location:
[wp-remote-users-sync](/browser/wp-remote-users-sync?rev=2946667)
Files:

124 added
15 edited

* [tags/1.2.11](/browser/wp-remote-users-sync/tags/1.2.11?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/LICENSE](/browser/wp-remote-users-sync/tags/1.2.11/LICENSE?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/README.md](/browser/wp-remote-users-sync/tags/1.2.11/README.md?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css](/browser/wp-remote-users-sync/tags/1.2.11/css?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/admin](/browser/wp-remote-users-sync/tags/1.2.11/css/admin?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/admin/main.css](/browser/wp-remote-users-sync/tags/1.2.11/css/admin/main.css?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/admin/main.min.css](/browser/wp-remote-users-sync/tags/1.2.11/css/admin/main.min.css?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/lib](/browser/wp-remote-users-sync/tags/1.2.11/css/lib?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/lib/select2](/browser/wp-remote-users-sync/tags/1.2.11/css/lib/select2?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/lib/select2/select2.css](/browser/wp-remote-users-sync/tags/1.2.11/css/lib/select2/select2.css?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/css/lib/select2/select2.scss](/browser/wp-remote-users-sync/tags/1.2.11/css/lib/select2/select2.scss?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/functions.php](/browser/wp-remote-users-sync/tags/1.2.11/functions.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc](/browser/wp-remote-users-sync/tags/1.2.11/inc?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api](/browser/wp-remote-users-sync/tags/1.2.11/inc/api?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-abstract.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-abstract.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-create.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-create.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-delete.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-delete.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-login.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-login.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-logout.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-logout.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-meta.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-meta.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-password.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-password.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-role.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-role.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/api/class-wprus-api-update.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/api/class-wprus-api-update.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus-crypto.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus-crypto.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus-import-export.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus-import-export.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus-logger.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus-logger.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus-nonce.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus-nonce.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus-settings.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus-settings.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/class-wprus.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/class-wprus.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/integration](/browser/wp-remote-users-sync/tags/1.2.11/inc/integration?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/integration/class-wprus-integration.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/integration/class-wprus-integration.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/add-site-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/add-site-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/authorization-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/authorization-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/browser-support-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/browser-support-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/encryption-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/encryption-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/export-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/export-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/help.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/help.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/import-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/import-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/ip-whitelist-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/ip-whitelist-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/log-row.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/log-row.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/logs-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/logs-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/main-settings-page.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/main-settings-page.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/site-metabox-template.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/site-metabox-template.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/site-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/site-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/admin/submit-settings-metabox.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/admin/submit-settings-metabox.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/redirect-processing-script.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/redirect-processing-script.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/inc/templates/redirect-processing.php](/browser/wp-remote-users-sync/tags/1.2.11/inc/templates/redirect-processing.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js](/browser/wp-remote-users-sync/tags/1.2.11/js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/admin](/browser/wp-remote-users-sync/tags/1.2.11/js/admin?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/admin/main.js](/browser/wp-remote-users-sync/tags/1.2.11/js/admin/main.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/admin/main.min.js](/browser/wp-remote-users-sync/tags/1.2.11/js/admin/main.min.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib](/browser/wp-remote-users-sync/tags/1.2.11/js/lib?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/af.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/af.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ar.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ar.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/az.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/az.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/bg.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/bg.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/bn.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/bn.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/bs.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/bs.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ca.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ca.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/cs.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/cs.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/da.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/da.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/de.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/de.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/dsb.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/dsb.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/el.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/el.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/en.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/en.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/es.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/es.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/et.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/et.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/eu.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/eu.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/fa.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/fa.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/fi.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/fi.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/fr.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/fr.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/gl.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/gl.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/he.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/he.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/hi.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/hi.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/hr.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/hr.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/hsb.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/hsb.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/hu.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/hu.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/hy.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/hy.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/id.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/id.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/is.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/is.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/it.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/it.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ja.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ja.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ka.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ka.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/km.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/km.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ko.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ko.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/lt.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/lt.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/lv.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/lv.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/mk.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/mk.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ms.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ms.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/nb.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/nb.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ne.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ne.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/nl.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/nl.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/pl.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/pl.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ps.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ps.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/pt-BR.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/pt-BR.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/pt.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/pt.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ro.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ro.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/ru.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/ru.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sk.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sk.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sl.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sl.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sq.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sq.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sr-Cyrl.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sr-Cyrl.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sr.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sr.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/sv.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/sv.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/th.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/th.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/tk.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/tk.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/tr.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/tr.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/uk.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/uk.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/vi.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/vi.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/zh-CN.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/zh-CN.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/i18n/zh-TW.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/i18n/zh-TW.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/select2.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/select2.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/js/lib/select2/select2.min.js](/browser/wp-remote-users-sync/tags/1.2.11/js/lib/select2/select2.min.js?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/languages](/browser/wp-remote-users-sync/tags/1.2.11/languages?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/languages/wprus-zh\_CN.mo](/browser/wp-remote-users-sync/tags/1.2.11/languages/wprus-zh_CN.mo?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/languages/wprus-zh\_CN.po](/browser/wp-remote-users-sync/tags/1.2.11/languages/wprus-zh_CN.po?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/languages/wprus.pot](/browser/wp-remote-users-sync/tags/1.2.11/languages/wprus.pot?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/readme.txt](/browser/wp-remote-users-sync/tags/1.2.11/readme.txt?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/uninstall.php](/browser/wp-remote-users-sync/tags/1.2.11/uninstall.php?rev=2946667 "Show entry in browser")
  (added)
* [tags/1.2.11/wprus.php](/browser/wp-remote-users-sync/tags/1.2.11/wprus.php?rev=2946667 "Show entry in browser")
  (added)
* [trunk/README.md](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667 "Show entry in browser")
  (modified)
  ([5 diffs](#file124 "Show differences"))
* [trunk/css/admin/main.css](/browser/wp-remote-users-sync/trunk/css/admin/main.css?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file125 "Show differences"))
* [trunk/css/admin/main.min.css](/browser/wp-remote-users-sync/trunk/css/admin/main.min.css?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file126 "Show differences"))
* [trunk/inc/api/class-wprus-api-abstract.php](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667 "Show entry in browser")
  (modified)
  ([5 diffs](#file127 "Show differences"))
* [trunk/inc/api/class-wprus-api-login.php](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file128 "Show differences"))
* [trunk/inc/class-wprus-import-export.php](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667 "Show entry in browser")
  (modified)
  ([5 diffs](#file129 "Show differences"))
* [trunk/inc/class-wprus-logger.php](/browser/wp-remote-users-sync/trunk/inc/class-wprus-logger.php?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file130 "Show differences"))
* [trunk/inc/class-wprus-settings.php](/browser/wp-remote-users-sync/trunk/inc/class-wprus-settings.php?rev=2946667 "Show entry in browser")
  (modified)
  ([2 diffs](#file131 "Show differences"))
* [trunk/inc/integration/class-wprus-integration.php](/browser/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php?rev=2946667 "Show entry in browser")
  (modified)
  ([2 diffs](#file132 "Show differences"))
* [trunk/inc/templates/admin/help.php](/browser/wp-remote-users-sync/trunk/inc/templates/admin/help.php?rev=2946667 "Show entry in browser")
  (modified)
  ([2 diffs](#file133 "Show differences"))
* [trunk/inc/templates/admin/main-settings-page.php](/browser/wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file134 "Show differences"))
* [trunk/js/admin/main.js](/browser/wp-remote-users-sync/trunk/js/admin/main.js?rev=2946667 "Show entry in browser")
  (modified)
  ([2 diffs](#file135 "Show differences"))
* [trunk/js/admin/main.min.js](/browser/wp-remote-users-sync/trunk/js/admin/main.min.js?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file136 "Show differences"))
* [trunk/readme.txt](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667 "Show entry in browser")
  (modified)
  ([8 diffs](#file137 "Show differences"))
* [trunk/wprus.php](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2946667 "Show entry in browser")
  (modified)
  ([1 diff](#file138 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-remote-users-sync/trunk/README.md](/changeset/2946667/wp-remote-users-sync/trunk/README.md "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/README.md")

  | [r2418499](/browser/wp-remote-users-sync/trunk/README.md?rev=2418499#L607 "Show revision 2418499 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667#L607 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 607 | 607 | \_\_\_ |
  | 608 | 608 |  |
  |  | 609 | #### wprus\_require\_integration\_file |
  |  | 610 |  |
  |  | 611 | ```php |
  |  | 612 | do\_action( 'wprus\_require\_integration\_file', (string) $plugin\_slug, (string) $class\_name ); |
  |  | 613 | ``` |
  |  | 614 | \*\*Description\*\* |
  |  | 615 | Fired when an integration with a third-party plugin needs to load a class file inheriting `Wprus\_Integration`. |
  |  | 616 |  |
  |  | 617 | \*\*Parameters\*\* |
  |  | 618 | $plugin\_slug |
  |  | 619 | > (string) The slug of the plugin integrated. |
  |  | 620 |  |
  |  | 621 | $class\_name |
  |  | 622 | > (string) The name of the integration class - must inherit `Wprus\_Integration`. |
  |  | 623 |  |
  |  | 624 | \_\_\_ |
  |  | 625 |  |
  | 609 | 626 | #### wprus\_integration |
  | 610 | 627 |  |
  | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2418499#L624) | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667#L641) |  |
  | 624 | 641 | \_\_\_ |
  | 625 | 642 |  |
  | 626 |  | #### wprus\_integration |
  |  | 643 | #### wprus\_integration\_run |
  | 627 | 644 |  |
  | 628 | 645 | ```php |
  | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2418499#L630) | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667#L647) |  |
  | 630 | 647 | ``` |
  | 631 | 648 | \*\*Description\*\* |
  | 632 |  | Fired when an integration with a third-party plugin~~' hooks are~~ fully initialized. |
  |  | 649 | Fired when an integration with a third-party plugin hooks is fully initialized. |
  | 633 | 650 |  |
  | 634 | 651 | \*\*Parameters\*\* |
  | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2418499#L662) | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667#L679) |  |
  | 662 | 679 | \* [wprus\_debug](#user-content-wprus\_debug) |
  | 663 | 680 | \* [wprus\_action\_data](#user-content-wprus\_action\_data) |
  |  | 681 | \* [wprus\_registered\_integration](#user-content-wprus\_registered\_integration) |
  | 664 | 682 |  |
  | 665 | 683 | \_\_\_ |
  | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2418499#L1080) | […](/browser/wp-remote-users-sync/trunk/README.md?rev=2946667#L1098) |  |
  | 1080 | 1098 |  |
  | 1081 | 1099 | \_\_\_ |
  |  | 1100 |  |
  |  | 1101 | #### wprus\_registered\_integration |
  |  | 1102 |  |
  |  | 1103 | ```php |
  |  | 1104 | apply\_filters( 'wprus\_registered\_integration', array $integrations ); |
  |  | 1105 | ``` |
  |  | 1106 | \*\*Description\*\* |
  |  | 1107 | Filter integrations. See `inc/integration/class-wprus-integration.php`. |
  |  | 1108 |  |
  |  | 1109 | \*\*Parameters\*\* |
  |  | 1110 | $integrations |
  |  | 1111 | > (array) The integrations info. Structure: |
  |  | 1112 | ```php |
  |  | 1113 | array ( |
  |  | 1114 | $slug => array(                          // $slug is the unique integration slug |
  |  | 1115 | 'plugin'     => 'plugin\_name',       // name of the plugin being integrated ; passed to is\_plugin\_active() to determine if the integration needs to be loaded |
  |  | 1116 | 'class\_name' => 'Integration\_Class', // Class name of the integration class ; the class must be included using the action wprus\_require\_integration\_file, and must inherit the Wprus\_Integration class |
  |  | 1117 | ), |
  |  | 1118 | ); |
  |  | 1119 | ``` |
  |  | 1120 |  |
  |  | 1121 | \_\_\_ |
  |  | 1122 |  |
* ## [wp-remote-users-sync/trunk/css/admin/main.css](/changeset/2946667/wp-remote-users-sync/trunk/css/admin/main.css "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/css/admin/main.css")

  | [r2367213](/browser/wp-remote-users-sync/trunk/css/admin/main.css?rev=2367213#L51 "Show revision 2367213 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/css/admin/main.css?rev=2946667#L51 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 51 | 51 | #postbox-container-2 .wprus-site .wprus-container > div { |
  | 52 | 52 | white-space: normal; |
  |  | 53 | } |
  |  | 54 |  |
  |  | 55 | #site\_add .wprus-container { |
  |  | 56 | display: inline-flex; |
  |  | 57 | gap: 0.5em; |
  |  | 58 | } |
  |  | 59 |  |
  |  | 60 | #wprus\_add\_value { |
  |  | 61 | width: 90%; |
  | 53 | 62 | } |
  | 54 | 63 |  |
* ## [wp-remote-users-sync/trunk/css/admin/main.min.css](/changeset/2946667/wp-remote-users-sync/trunk/css/admin/main.min.css "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/css/admin/main.min.css")

  | [r2367213](/browser/wp-remote-users-sync/trunk/css/admin/main.min.css?rev=2367213#L1 "Show revision 2367213 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/css/admin/main.min.css?rev=2946667#L1 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | .settings\_page\_wprus a.nav-tab:focus{box-shadow:none}#logs .handlediv,#side-sortables .handlediv,.settings\_page\_wprus .handle-order-higher,.settings\_page\_wprus .handle-order-lower,.wprus-ui-wait{display:none}.js .postbox .hndle{cursor:default}.js .postbox.wprus-site .hndle{cursor:pointer}#major-publishing-actions{border-top:0}#postbox-container-2 .wprus-site.postbox{display:block;margin-bottom:0;box-shadow:none;border-top-width:0}#postbox-container-2 .wprus-site.closed{border-bottom-width:0}#postbox-container-2 .postbox:not(.wprus-site)+.wprus-site{border-top-width:1px}#postbox-container-2 .wprus-site.closed .hndle{border-top-width:0}#postbox-container-2 .wprus-site .wprus-container{white-space:nowrap}#postbox-container-2 .wprus-site .wprus-container>div{white-space:normal}.wprus-site select{width:100%;display:block}.wprus-site hr{margin:20px 0 10px}.wprus-export-row,.wprus-site-row{margin-bottom:15px}.incoming\_actions,.outgoing\_actions,.wprus-export-row{width:45%;display:inline-block;padding:0 2%;vertical-align:top}.incoming\_actions h4,.outgoing\_actions h4{margin:.5em 0}.outgoing\_actions{border-right:1px solid #eee}.export-roles-options,.incoming-roles-options{margin-top:15px}.export-roles-options label,.incoming-roles-options label{display:inline-block;vertical-align:top}table.wprus-actions{width:100%}table.wprus-actions td.action-checkbox{width:15px}table.wprus-actions td.action-test{text-align:right}.wprus-site-footer{padding-top:1em;border-top:1px solid #eee;text-align:right}.wprus-site-footer .deletion{color:#a00}.wp-core-ui .wprus-actions .button{min-height:25px;line-height:1.5;padding:0 1em}.action-test-result .failure,.action-test-result .success{display:none}.action-test-result .failure,.wprus-container #logs\_view .wprus-log-row.alert .log-message,.wprus-export-actions .failure,.wprus-security .alert{color:#dc3232}.action-test-result .success,.wprus-container #logs\_view .wprus-log-row.success .log-message,.wprus-export-actions .success{color:#46b450}.wprus-container #logs\_view .wprus-log-row.warning .log-message,.wprus-export-actions .warning{color:#ff9a02}#wprus\_logs\_min\_num{max-width:75px}.wprus-container .logs-container{padding:10px}#wprus\_import\_results .errors,.wprus-container #logs\_view{margin-bottom:15px;padding:10px;background:#f1f1f1;height:300px;overflow:scroll;border:1px solid #ccd0d4;color:#555}.wprus-container #logs\_view .wprus-log-row{font-weight:700}.wprus-container #logs\_view .wprus-log-row.info{color:#888}.wprus-container #logs\_view .trace{margin:10px 5px;font-weight:400;background:#fff;box-shadow:0 0 5px 0 #ccd0d4;padding:5px 20px;width:max-content}.wprus-export-actions,.wprus-users .form-table{padding:0 2%}.wprus-export-actions .export-result.show{display:inline-block;min-height:30px;line-height:30px;margin-left:15px}.export-result-icons span{vertical-align:middle}.wprus-export-actions .export-result,.wprus-export-actions .failure,.wprus-export-actions .success,.wprus-export-actions .warning{display:none}#wprus\_import\_file\_filename{width:50%}#wprus\_import\_results .errors,#wprus\_import\_results .summary{display:none}#sites\_placeholder{display:none;position:relative;min-height:250px;background-image:linear-gradient(to right,#ccd0d4 50%,transparent 50%),linear-gradient(to right,#ccd0d4 50%,transparent 50%),linear-gradient(to bottom,#ccd0d4 50%,transparent 50%),linear-gradient(to bottom,#ccd0d4 50%,transparent 50%);background-position:left top,left bottom,left top,right top;background-repeat:repeat-x,repeat-x,repeat-y,repeat-y;background-size:20px 3px,20px 3px,3px 20px,3px 20px}#sites\_placeholder span{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:150%;font-weight:700;color:#ababab}#wprus\_ip\_whitelist{width:100%;min-height:100px}#help{padding:5px 16px;background:#fff;border:1px solid #ccd0d4;display:block}.wprus-help{border:1px solid #ccd0d4;margin:10px 0}.wprus-help-inner{display:none;border-top:1px solid #f1f1f1;padding:8px 12px}.wprus-help-inner ul{margin-left:15px;list-style:disc}.wprus-help h2{text-decoration:underline;color:#0073aa;transition-property:border,background,color;transition-duration:.05s;transition-timing-function:ease-in-out;cursor:pointer}.wprus-help h2:hover{color:#124964} |
  |  | 1 | .settings\_page\_wprus a.nav-tab:focus{box-shadow:none}#logs .handlediv,#side-sortables .handlediv,.settings\_page\_wprus .handle-order-higher,.settings\_page\_wprus .handle-order-lower,.wprus-ui-wait{display:none}.js .postbox .hndle{cursor:default}.js .postbox.wprus-site .hndle{cursor:pointer}#major-publishing-actions{border-top:0}#postbox-container-2 .wprus-site.postbox{display:block;margin-bottom:0;box-shadow:none;border-top-width:0}#postbox-container-2 .wprus-site.closed{border-bottom-width:0}#postbox-container-2 .postbox:not(.wprus-site)+.wprus-site{border-top-width:1px}#postbox-container-2 .wprus-site.closed .hndle{border-top-width:0}#postbox-container-2 .wprus-site .wprus-container{white-space:nowrap}#postbox-container-2 .wprus-site .wprus-container>div{white-space:normal}#site\_add .wprus-container{display:inline-flex;gap:.5em}#wprus\_add\_value{width:90%}.wprus-site select{width:100%;display:block}.wprus-site hr{margin:20px 0 10px}.wprus-export-row,.wprus-site-row{margin-bottom:15px}.incoming\_actions,.outgoing\_actions,.wprus-export-row{width:45%;display:inline-block;padding:0 2%;vertical-align:top}.incoming\_actions h4,.outgoing\_actions h4{margin:.5em 0}.outgoing\_actions{border-right:1px solid #eee}.export-roles-options,.incoming-roles-options{margin-top:15px}.export-roles-options label,.incoming-roles-options label{display:inline-block;vertical-align:top}table.wprus-actions{width:100%}table.wprus-actions td.action-checkbox{width:15px}table.wprus-actions td.action-test{text-align:right}.wprus-site-footer{padding-top:1em;border-top:1px solid #eee;text-align:right}.wprus-site-footer .deletion{color:#a00}.wp-core-ui .wprus-actions .button{min-height:25px;line-height:1.5;padding:0 1em}.action-test-result .failure,.action-test-result .success{display:none}.action-test-result .failure,.wprus-container #logs\_view .wprus-log-row.alert .log-message,.wprus-export-actions .failure,.wprus-security .alert{color:#dc3232}.action-test-result .success,.wprus-container #logs\_view .wprus-log-row.success .log-message,.wprus-export-actions .success{color:#46b450}.wprus-container #logs\_view .wprus-log-row.warning .log-message,.wprus-export-actions .warning{color:#ff9a02}#wprus\_logs\_min\_num{max-width:75px}.wprus-container .logs-container{padding:10px}#wprus\_import\_results .errors,.wprus-container #logs\_view{margin-bottom:15px;padding:10px;background:#f1f1f1;height:300px;overflow:scroll;border:1px solid #ccd0d4;color:#555}.wprus-container #logs\_view .wprus-log-row{font-weight:700}.wprus-container #logs\_view .wprus-log-row.info{color:#888}.wprus-container #logs\_view .trace{margin:10px 5px;font-weight:400;background:#fff;box-shadow:0 0 5px 0 #ccd0d4;padding:5px 20px;width:max-content}.wprus-export-actions,.wprus-users .form-table{padding:0 2%}.wprus-export-actions .export-result.show{display:inline-block;min-height:30px;line-height:30px;margin-left:15px}.export-result-icons span{vertical-align:middle}.wprus-export-actions .export-result,.wprus-export-actions .failure,.wprus-export-actions .success,.wprus-export-actions .warning{display:none}#wprus\_import\_file\_filename{width:50%}#wprus\_import\_results .errors,#wprus\_import\_results .summary{display:none}#sites\_placeholder{display:none;position:relative;min-height:250px;background-image:linear-gradient(to right,#ccd0d4 50%,transparent 50%),linear-gradient(to right,#ccd0d4 50%,transparent 50%),linear-gradient(to bottom,#ccd0d4 50%,transparent 50%),linear-gradient(to bottom,#ccd0d4 50%,transparent 50%);background-position:left top,left bottom,left top,right top;background-repeat:repeat-x,repeat-x,repeat-y,repeat-y;background-size:20px 3px,20px 3px,3px 20px,3px 20px}#sites\_placeholder span{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:150%;font-weight:700;color:#ababab}#wprus\_ip\_whitelist{width:100%;min-height:100px}#help{padding:5px 16px;background:#fff;border:1px solid #ccd0d4;display:block}.wprus-help{border:1px solid #ccd0d4;margin:10px 0}.wprus-help-inner{display:none;border-top:1px solid #f1f1f1;padding:8px 12px}.wprus-help-inner ul{margin-left:15px;list-style:disc}.wprus-help h2{text-decoration:underline;color:#0073aa;transition-property:border,background,color;transition-duration:.05s;transition-timing-function:ease-in-out;cursor:pointer}.wprus-help h2:hover{color:#124964} |
* ## [wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php")

  | [r2703820](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2703820#L88 "Show revision 2703820 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L88 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 88 | 88 | protected $role\_handler; |
  | 89 | 89 | /\*\* |
  |  | 90 | \* The password handler object. |
  |  | 91 | \* |
  |  | 92 | \* @var Wprus\_Api\_Password|mixed |
  |  | 93 | \*/ |
  |  | 94 | protected $password\_handler; |
  |  | 95 | /\*\* |
  | 90 | 96 | \* Whether the current action is authorized |
  | 91 | 97 | \* |
  | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2703820#L93) | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L99) |  |
  | 93 | 99 | \*/ |
  | 94 | 100 | protected $is\_authorized\_remote; |
  |  | 101 |  |
  | 95 | 102 |  |
  | 96 | 103 | /\*\* |
  | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2703820#L332) | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L339) |  |
  | 332 | 339 | \*/ |
  | 333 | 340 | public function authorize\_notification() { |
  | 334 |  | $token\_filter         = FILTER\_~~SANITIZE\_STRING~~; |
  |  | 341 | $token\_filter         = FILTER\_UNSAFE\_RAW; |
  | 335 | 342 | $token                = filter\_input( INPUT\_GET, 'token', $token\_filter ); |
  | 336 | 343 | $token                = ( ! $token ) ? filter\_input( INPUT\_POST, 'token', $token\_filter ) : $token; |
  | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2703820#L534) | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L541) |  |
  | 534 | 541 | \*/ |
  | 535 | 542 | public function init\_data() { |
  | 536 |  | $data\_get     = filter\_input( INPUT\_GET, 'wprusdata', FILTER\_~~SANITIZE\_STRING~~ ); |
  | 537 |  | $data\_post    = filter\_input( INPUT\_POST, 'wprusdata', FILTER\_~~SANITIZE\_STRING~~ ); |
  |  | 543 | $data\_get     = filter\_input( INPUT\_GET, 'wprusdata', FILTER\_UNSAFE\_RAW ); |
  |  | 544 | $data\_post    = filter\_input( INPUT\_POST, 'wprusdata', FILTER\_UNSAFE\_RAW ); |
  | 538 | 545 | $this->method = ( $data\_post ) ? 'post' : 'get'; |
  | 539 | 546 | $this->data   = array( |
  | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2703820#L673) | […](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php?rev=2946667#L680) |  |
  | 673 | 680 | \*/ |
  | 674 | 681 | public function notify\_ping\_remote() { |
  |  | 682 | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
  |  | 683 |  |
  |  | 684 | if ( ! wp\_verify\_nonce( $nonce, 'wprus\_ping\_nonce' ) ) { |
  |  | 685 | wp\_send\_json\_error( \_\_( 'Error: unauthorized access - please reload the page and try again.', 'wprus' ) ); |
  |  | 686 | } |
  |  | 687 |  |
  | 675 | 688 | $url          = filter\_input( INPUT\_POST, 'site\_url', FILTER\_VALIDATE\_URL ); |
  | 676 |  | $direction    = filter\_input( INPUT\_POST, 'direction', FILTER\_~~SANITIZE\_STRING~~ ); |
  | 677 |  | $data         = filter\_input( INPUT\_POST, 'data', FILTER\_~~SANITIZE\_STRING~~, FILTER\_REQUIRE\_ARRAY ); |
  |  | 689 | $direction    = filter\_input( INPUT\_POST, 'direction', FILTER\_UNSAFE\_RAW ); |
  |  | 690 | $data         = filter\_input( INPUT\_POST, 'data', FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
  | 678 | 691 | $success      = false; |
  | 679 | 692 | $payload      = false; |
* ## [wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php")

  | [r2708689](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php?rev=2708689#L133 "Show revision 2708689 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-login.php?rev=2946667#L133 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 133 | 133 |  |
  | 134 | 134 | if ( ! empty( $sites ) ) { |
  | 135 |  | $remember = filter\_input( INPUT\_POST, 'rememberme', FILTER\_~~SANITIZE\_STRING~~ ); |
  |  | 135 | $remember = filter\_input( INPUT\_POST, 'rememberme', FILTER\_UNSAFE\_RAW ); |
  | 136 | 136 |  |
  | 137 | 137 | Wprus\_Logger::log( |
* ## [wp-remote-users-sync/trunk/inc/class-wprus-import-export.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/class-wprus-import-export.php")

  | [r2375768](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2375768#L75 "Show revision 2375768 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667#L75 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 75 | 75 |  |
  | 76 | 76 | public function export() { |
  | 77 |  | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_~~SANITIZE\_STRING~~ ); |
  |  | 77 | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
  | 78 | 78 |  |
  | 79 | 79 | if ( ! wp\_verify\_nonce( $nonce, 'wprus\_import\_export\_nonce' ) ) { |
  | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2375768#L102) | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667#L102) |  |
  | 102 | 102 | $max         = absint( filter\_input( INPUT\_POST, 'max', FILTER\_VALIDATE\_INT ) ); |
  | 103 | 103 | $keep\_role   = absint( filter\_input( INPUT\_POST, 'keep\_role', FILTER\_VALIDATE\_INT ) ); |
  | 104 |  | $user\_roles  = filter\_input( INPUT\_POST, 'user\_roles', FILTER\_~~SANITIZE\_STRING~~, FILTER\_REQUIRE\_ARRAY ); |
  | 105 |  | $meta\_keys   = filter\_input( INPUT\_POST, 'meta\_keys', FILTER\_~~SANITIZE\_STRING~~, FILTER\_REQUIRE\_ARRAY ); |
  | 106 |  | $user\_logins = filter\_input( INPUT\_POST, 'user\_list', FILTER\_~~SANITIZE\_STRING~~, FILTER\_REQUIRE\_ARRAY ); |
  |  | 104 | $user\_roles  = filter\_input( INPUT\_POST, 'user\_roles', FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
  |  | 105 | $meta\_keys   = filter\_input( INPUT\_POST, 'meta\_keys', FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
  |  | 106 | $user\_logins = filter\_input( INPUT\_POST, 'user\_list', FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
  | 107 | 107 | $pages       = null; |
  | 108 | 108 | $limit       = self::RESULTS\_PER\_QUERY; |
  | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2375768#L209) | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667#L209) |  |
  | 209 | 209 |  |
  | 210 | 210 | public function import() { |
  | 211 |  | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_~~SANITIZE\_STRING~~ ); |
  |  | 211 | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
  | 212 | 212 |  |
  | 213 | 213 | if ( ! wp\_verify\_nonce( $nonce, 'wprus\_import\_export\_nonce' ) ) { |
  | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2375768#L220) | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667#L220) |  |
  | 220 | 220 |  |
  | 221 | 221 | if ( isset( $\_FILES['file'] ) ) { |
  | 222 |  | $file\_info = filter\_var( $\_FILES['file'], FILTER\_~~SANITIZE\_STRING~~, FILTER\_REQUIRE\_ARRAY ); |
  |  | 222 | $file\_info = filter\_var( $\_FILES['file'], FILTER\_UNSAFE\_RAW, FILTER\_REQUIRE\_ARRAY ); |
  | 223 | 223 | } else { |
  | 224 | 224 | $file\_info = false; |
  | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2375768#L320) | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-import-export.php?rev=2946667#L320) |  |
  | 320 | 320 |  |
  | 321 | 321 | public function get\_usernames\_json() { |
  | 322 |  | $nonce     = filter\_input( INPUT\_POST, 'nonce', FILTER\_~~SANITIZE\_STRING~~ ); |
  | 323 |  | $term      = filter\_input( INPUT\_POST, 'q', FILTER\_~~SANITIZE\_STRING~~ ); |
  |  | 322 | $nonce     = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
  |  | 323 | $term      = filter\_input( INPUT\_POST, 'q', FILTER\_UNSAFE\_RAW ); |
  | 324 | 324 | $page      = filter\_input( INPUT\_POST, 'page', FILTER\_VALIDATE\_INT ); |
  | 325 | 325 | $user\_info = array(); |
* ## [wp-remote-users-sync/trunk/inc/class-wprus-logger.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/class-wprus-logger.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/class-wprus-logger.php")

  | [r2367213](/browser/wp-remote-users-sync/trunk/inc/class-wprus-logger.php?rev=2367213#L116 "Show revision 2367213 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/class-wprus-logger.php?rev=2946667#L116 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 116 | 116 |  |
  | 117 | 117 | public function refresh\_logs\_async() { |
  |  | 118 | $nonce = filter\_input( INPUT\_POST, 'nonce', FILTER\_UNSAFE\_RAW ); |
  |  | 119 |  |
  |  | 120 | if ( ! wp\_verify\_nonce( $nonce, 'wprus\_logs\_nonce' ) ) { |
  |  | 121 | wp\_send\_json\_error( |
  |  | 122 | array( |
  |  | 123 | 'message' => \_\_( 'Error: unauthorized access - please reload the page and try again.', 'wprus' ), |
  |  | 124 | ) |
  |  | 125 | ); |
  |  | 126 | } |
  |  | 127 |  |
  | 118 | 128 | wp\_send\_json\_success( |
  | 119 | 129 | array( |
* ## [wp-remote-users-sync/trunk/inc/class-wprus-settings.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/class-wprus-settings.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/class-wprus-settings.php")

  | [r2418499](/browser/wp-remote-users-sync/trunk/inc/class-wprus-settings.php?rev=2418499#L38 "Show revision 2418499 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/class-wprus-settings.php?rev=2946667#L38 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 38 | 38 | add\_action( 'init', array( $this, 'set\_cache\_policy' ), PHP\_INT\_MIN - 10, 0 ); |
  | 39 | 39 | add\_action( 'admin\_menu', array( $this, 'plugin\_options\_menu\_main' ), 10, 0 ); |
  | 40 |  | add\_action( 'add\_meta\_boxes', array( $this, 'add\_settings\_meta\_boxes' ), 10, ~~0~~ ); |
  |  | 40 | add\_action( 'add\_meta\_boxes', array( $this, 'add\_settings\_meta\_boxes' ), 10, 1 ); |
  | 41 | 41 |  |
  | 42 | 42 | add\_filter( 'pre\_update\_option\_wprus', array( $this, 'require\_flush' ), 10, 2 ); |
  | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-settings.php?rev=2418499#L238) | […](/browser/wp-remote-users-sync/trunk/inc/class-wprus-settings.php?rev=2946667#L238) |  |
  | 238 | 238 | } |
  | 239 | 239 |  |
  | 240 |  | public function add\_settings\_meta\_boxes() { |
  |  | 240 | public function add\_settings\_meta\_boxes( $post\_type ) { |
  |  | 241 |  |
  |  | 242 | if ( $post\_type !== self::$settings\_page\_id ) { |
  |  | 243 |  |
  |  | 244 | return; |
  |  | 245 | } |
  |  | 246 |  |
  | 241 | 247 | $page\_hook\_id = self::$settings\_page\_id; |
  | 242 | 248 | $sites        = $this->get\_sites(); |
* ## [wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php")

  | [r2418499](/browser/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php?rev=2418499#L35 "Show revision 2418499 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php?rev=2946667#L35 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 35 | 35 |  |
  | 36 | 36 | if ( is\_plugin\_active( $info['plugin'] ) ) { |
  | 37 |  | ~~$filename   = 'class-' . strtolower( str\_replace( '\_', '-', $info['class\_name'] ) ) . '.php';~~ |
  | 38 |  | ~~$file\_path  = WPRUS\_PLUGIN\_PATH . 'inc/integration/' . $slug . '/' . $filename;~~ |
  | 39 | 37 | $class\_name = $info['class\_name']; |
  | 40 | 38 |  |
  | 41 |  | if ( ! class\_exists( $class\_name ) && file\_exists( $file\_path ) ) { |
  | 42 |  | require\_once $file\_path; |
  | 43 |  | } else { |
  | 44 |  | do\_action( 'wprus\_require\_integration\_file', $slug, $class\_name ); |
  |  | 39 | if ( ! class\_exists( $class\_name ) ) { |
  |  | 40 | do\_action( 'wprus\_require\_integration\_file', $slug, $info['class\_name'] ); |
  | 45 | 41 | } |
  | 46 | 42 |  |
  | […](/browser/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php?rev=2418499#L60) | […](/browser/wp-remote-users-sync/trunk/inc/integration/class-wprus-integration.php?rev=2946667#L56) |  |
  | 60 | 56 | $this->wprus\_logger = $wprus\_logger; |
  | 61 | 57 |  |
  | 62 |  | ~~$this->init\_hooks();~~ |
  | 63 | 58 | do\_action( 'wprus\_integration\_run', $this ); |
  | 64 | 59 | } |
  | 65 |  |  |
  | 66 |  | ~~public function init\_hooks() {}~~ |
  | 67 | 60 |  |
  | 68 | 61 | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
* ## [wp-remote-users-sync/trunk/inc/templates/admin/help.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/templates/admin/help.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/templates/admin/help.php")

  | [r2375768](/browser/wp-remote-users-sync/trunk/inc/templates/admin/help.php?rev=2375768#L63 "Show revision 2375768 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/templates/admin/help.php?rev=2946667#L63 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 63 | 63 | <?php |
  | 64 | 64 | // translators: %1$s is the bold englisg word "exactly" ; %2$s is 'http'; %3$s is 'https'; %4$s is 'home' option key in the database ; %5$s is 'wp\_options' table name |
  | 65 |  | printf( \_\_( 'The URLs used in settings of WP Remote Users Sync %1$s match the URL in your WordPress settings: the protocol (%2$s vs. %3$s) and the subdomain (www vs. non-www) must be the same across the board. It is also worth checking the %4$s option in the %5$s table of the WordPress databases, because in some cases the content of Settings > General > WordPress Address (URL) gets abusively overwritten by plugins or themes.', 'wprus' ), '<strong>' . esc\_html\_~~e~~( 'exactly', 'wprus' ) . '</strong>', '<code>http</code>', '<code>https</code>', '<code>home</code>', '<code>wp\_options</code>' ); // @codingStandardsIgnoreLine |
  |  | 65 | printf( \_\_( 'The URLs used in settings of WP Remote Users Sync %1$s match the URL in your WordPress settings: the protocol (%2$s vs. %3$s) and the subdomain (www vs. non-www) must be the same across the board. It is also worth checking the %4$s option in the %5$s table of the WordPress databases, because in some cases the content of Settings > General > WordPress Address (URL) gets abusively overwritten by plugins or themes.', 'wprus' ), '<strong>' . esc\_html\_\_( 'exactly', 'wprus' ) . '</strong>', '<code>http</code>', '<code>https</code>', '<code>home</code>', '<code>wp\_options</code>' ); // @codingStandardsIgnoreLine |
  | 66 | 66 | ?> |
  | 67 | 67 | </li> |
  | […](/browser/wp-remote-users-sync/trunk/inc/templates/admin/help.php?rev=2375768#L302) | […](/browser/wp-remote-users-sync/trunk/inc/templates/admin/help.php?rev=2946667#L302) |  |
  | 302 | 302 | // translators: %1$s is the WordPress support forum URL, %2$s is the Github URL |
  | 303 | 303 | esc\_html\_\_( 'More help can be found on %1$s for general inquiries and on %2$s for advanced troubleshooting.', 'wprus' ), |
  | 304 |  | '<a href="https://wordpress.org/support/plugin/wp-remote-users-sync/">' . esc\_html\_~~e~~( 'the WordPress support forum', 'wprus' ) . '</a>', |
  |  | 304 | '<a href="https://wordpress.org/support/plugin/wp-remote-users-sync/">' . esc\_html\_\_( 'the WordPress support forum', 'wprus' ) . '</a>', |
  | 305 | 305 | '<a href="https://github.com/froger-me/wp-remote-users-sync">' . esc\_html( 'Github' ) . '</a>' |
  | 306 | 306 | ); |
* ## [wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php](/changeset/2946667/wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php")

  | [r2375768](/browser/wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php?rev=2375768#L34 "Show revision 2375768 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/inc/templates/admin/main-settings-page.php?rev=2946667#L34 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 34 | 34 | <?php wp\_nonce\_field( 'meta-box-order', 'meta-box-order-nonce', false ); ?> |
  | 35 | 35 | <?php wp\_nonce\_field( 'wprus\_import\_export\_nonce', 'wprus\_import\_export\_nonce' ); ?> |
  |  | 36 | <?php wp\_nonce\_field( 'wprus\_logs\_nonce', 'wprus\_logs\_nonce' ); ?> |
  |  | 37 | <?php wp\_nonce\_field( 'wprus\_ping\_nonce', 'wprus\_ping\_nonce' ); ?> |
  | 36 | 38 | <div id="poststuff"> |
  | 37 | 39 | <div id="post-body" class="metabox-holder columns-<?php echo 1 === get\_current\_screen()->get\_columns() ? '1' : '2'; ?>"> |
* ## [wp-remote-users-sync/trunk/js/admin/main.js](/changeset/2946667/wp-remote-users-sync/trunk/js/admin/main.js "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/js/admin/main.js")

  | [r2375768](/browser/wp-remote-users-sync/trunk/js/admin/main.js?rev=2375768#L29 "Show revision 2375768 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/js/admin/main.js?rev=2946667#L29 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 29 | 29 | url: WPRUS.ajax\_url, |
  | 30 | 30 | type: 'POST', |
  | 31 |  | data: { action: 'wprus\_refresh\_logs' }, |
  |  | 31 | data: { |
  |  | 32 | nonce : $('#wprus\_logs\_nonce').val(), |
  |  | 33 | action: 'wprus\_refresh\_logs' |
  |  | 34 | }, |
  | 32 | 35 | success: function(response) { |
  | 33 | 36 |  |
  | […](/browser/wp-remote-users-sync/trunk/js/admin/main.js?rev=2375768#L166) | […](/browser/wp-remote-users-sync/trunk/js/admin/main.js?rev=2946667#L169) |  |
  | 166 | 169 | row           = button.closest('tr'), |
  | 167 | 170 | data          = { |
  |  | 171 | nonce     : $('#wprus\_ping\_nonce').val(), |
  | 168 | 172 | site\_url  : button.closest('.wprus-container').data('url'), |
  | 169 | 173 | direction : dataContainer.data('direction'), |
* ## [wp-remote-users-sync/trunk/js/admin/main.min.js](/changeset/2946667/wp-remote-users-sync/trunk/js/admin/main.min.js "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/js/admin/main.min.js")

  | [r2375768](/browser/wp-remote-users-sync/trunk/js/admin/main.min.js?rev=2375768#L1 "Show revision 2375768 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/js/admin/main.min.js?rev=2946667#L1 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | jQuery(document).ready(function(n){WPRUS.debug&&n("body").addClass("wprus-debug");var a=function(){n(".wprus-togglable").hide(),n("."+n(".nav-tab-active").data("toggle")).show(),t(),"wprus-site"!==n(".nav-tab-active").data("toggle")||n("#postbox-container-2 .postbox.wprus-site").length?n("#sites\_placeholder").hide():n("#sites\_placeholder").show()},~~i=function(e){void 0!==e&&e.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:{action:"wprus\_refresh\_logs"},success:function(e){e.success&&(n("#logs\_view").html(e.data.html),n(".logs-clean-trigger").val(e.data.clean\_trigger\_text))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t(),void 0!==e&&e.removeAttr("disabled")}})},t=function(){var e=document.getElementById("logs\_view");e.scrollTop=e.scrollHeight};function e(){n("#wprus\_force\_login\_redirect").prop("checked")?(n("#wprus\_disable\_login\_redirect").prop("checked",!1),n("#wprus\_disable\_login\_redirect").attr("disabled","disabled")):n("#wprus\_disable\_login\_redirect").prop("checked")?(n("#wprus\_force\_login\_redirect").prop("checked",!1),n("#wprus\_force\_login\_redirect").attr("disabled","disabled")):(n("#wprus\_force\_login\_redirect").removeAttr("disabled"),n("#wprus\_disable\_login\_redirect").removeAttr("disabled"))}n(".nav-tab").on("click",function(e){e.preventDefault(),n(".nav-tab-active").removeClass("nav-tab-active"),n(this).addClass("nav-tab-active"),a()}),n(".wprus-container").each(function(e,t){var s=n(t);s.closest(".postbox").addClass(s.data("postbox\_class"))}),a(),n("#postbox-container-2 .wprus-site").closest(".postbox").addClass("closed"),n("#normal-sortables").on("click",".handlediv, .wprus-site .hndle",function(e){e.preventDefault(),n(this).closest(".postbox").toggleClass("closed")}),n("#postbox-container-2").on("click",".deletion",function(e){e.preventDefault(),window.confirm(WPRUS.delete\_site\_confirm)&&n(this).closest(".wprus-site").remove()}),n("#wprus\_add\_trigger").on("click",function(e){e.preventDefault();var t=n("#wprus\_add\_value").val();if(t&&!n('.wprus-site[data-url="'+t+'"]').length)if(t.startsWith("http")){var s=n("#postbox-container-2 .wprus-site-template").clone(),r=n(".wprus-site").length;s.find("input, select").each(function(e,t){var s=n(t);s.attr("name","wprus[sites]["+r+"]"+s.data("name"))}),s.find(".wprus-container").attr("data-url",t),s.find(".hndle span").html(t),s.find('input[type="hidden"]').val(t),s.removeClass("wprus-site-template").addClass("wprus-site"),s.attr({"data-url":t,id:"site\_"+r}),s.find(".wprus-select").select2({width:"100%"}),s.find(".wprus-select-tag").select2({width:"100%",tags:!0}),n("#site\_template").before(s),a()}else window.alert(WPRUS.http\_required)}),n(".wprus-site .wprus-select, .wprus-users .wprus-select").select2({width:"100%"}),n(".wprus-site .wprus-select-tag").select2({width:"100%",tags:!0}),n("#normal-sortables").on("change",".wprus-select-tag",function(){n(this).find("option").each(function(e,t){var s=n(t);s.attr("value",s.html())})}),n("#normal-sortables").on("change",".action-checkbox input",function(){var e=n(this),t=e.closest("tr"),s=t.find(".action-test button");t.find(".action-test-result span").hide(),e.prop("checked")?s.removeAttr("disabled"):s.attr("disabled","disabled")}),n("#normal-sortables").on("click",".action-test button",function(e){e.preventDefault();var t=n(this),s=t.parent(),r=t.closest("tr"),a={site\_url:t.closest(".wprus-container").data("url"),direction:s.data("direction"),data:{username:WPRUS.username},action:"wprus\_"+s.data("action")+"\_notify\_ping\_remote"};t.attr("disabled","disabled"),r.find(".failure").hide(),r.find(".success").hide(),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:a,success:function(e){e.success?r.find(".success").show():(r.find(".failure").show(),setTimeout(function(){window.alert(e.data)},10))},error:function(e,t){r.find(".success").hide(),r.find(".failure").show(),setTimeout(function(){window.alert(WPRUS.undefined\_error)},10),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),i()}})}),n('input[type="password"].toggle').on("focus",function(){n(this).attr("type","text")}),n('input[type="password"].toggle').on("blur",function(){n(this).attr("type","password")}),n("#wprus\_log\_refresh").on("click",function(e){e.preventDefault(),i(n(this))}),n(".logs-clean-trigger").on("click",function(e){e.preventDefault();var t=n(this);t.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:{action:"wprus\_clear\_logs"},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),i()}})}),n("#wprus\_export\_trigger").on("click",function(e){e.preventDefault();var t=n(this),s={action:"wprus\_export\_users",nonce:n("#wprus\_import\_export\_nonce").val(),offset:n("#wprus\_export\_offset").val(),max:n("#wprus\_export\_max").val(),keep\_role:n("#wprus\_export\_keep\_roles").val(),user\_roles:n("#wprus\_roles\_export\_select").val(),meta\_keys:n("#wprus\_metadata\_export\_select").val(),user\_list:n("#wprus\_export\_users").val(),doing\_import\_export\_operation:1};t.attr("disabled","disabled"),t.next().css("visibility","visible"),n(".export-result").removeClass("show"),n(".export-result a, .export-result-icons, .export-result-icons \*").hide(),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:s,success:function(e){e.success?(n(".export-result-icons .success").show(),n(".export-result a").show()):e.data.file\_name?(n(".export-result-icons .warning").show(),n(".export-result a").show()):n(".export-result-icons .failure").show(),e.data&&e.data.file\_name&&(n(".export-result a").attr("data-file\_name",e.data.file\_name),n(".export-result a").attr("href",WPRUS.download\_url+"?wprus\_file="+e.data.file\_name+"&nonce="+s.nonce)),e.data&&e.data.message&&(n("#export\_message").html(e.data.message),n(".export-result-icons").show(),n(".export-result").addClass("show"))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})}),n(".export-result a").on("click",function(e){n(this).hasClass("invalidate")?e.preventDefault():n(this).addClass("invalidated")}),n("#wprus\_import\_file").on("change",function(){var e=n(this);0<e.prop("files").length?(n("#wprus\_import\_file\_filename").val(e.prop("files")[0].name),n("#wprus\_import\_file\_trigger").removeAttr("disabled")):(n("#wprus\_import\_file\_filename").val(""),n("#wprus\_import\_file\_trigger").attr("disabled","disabled"))}),n("#wprus\_import\_file\_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(e){var t=n("#wprus\_import\_file");t.prop("files",e.originalEvent.dataTransfer.files),t.trigger("change")}),n("#wprus\_import\_file\_trigger").on("click",function(e){e.preventDefault();var t=n(this),s=!0,r=new FormData,a=n("#wprus\_import\_file").prop("files")[0],i=n("#wprus\_import\_results .summary"),o=n("#wprus\_import\_results .errors");t.attr("disabled","disabled"),t.next().css("visibility","visible"),i.hide(),o.hide(),void 0!==a&&void 0!==a.type&&void 0!==a.size&&void 0!==a.name?/^([a-zA-Z0-9\-\\_]\*)\.dat/gm.test(a.name)||(window.alert(WPRUS.invalid\_file\_name),s=!1):(window.alert(WPRUS.invalid\_file),s=!1),s?(r.append("action","wprus\_import\_users"),r.append("file",a),r.append("nonce",n("#wprus\_import\_export\_nonce").val()),r.append("doing\_import\_export\_operation",1),n.ajax({url:WPRUS.ajax\_url,data:r,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){e.data&&(e.data.message&&(i.html(e.data.message),i.show()),e.data.errors&&(o.html(""),n.each(e.data.errors,function(e,t){var s=n("<li>"+t+"</li>");o.append(s)}),o.show()))},error:function(e,t){i.html(WPRUS.undefined\_import\_error),i~~.show(),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})):(t.next().css("visibility","hidden"),t.removeAttr("disabled"))}),n("#wprus\_export\_users").select2({width:"100%",cache:!0,closeOnSelect:!1,ajax:{url:WPRUS.ajax\_url,dataType:"json",language:WPRUS.locale,cache:!1,type:"POST",data:function(e){return{q:e.term,page:e.page||1,action:"wprus\_get\_usernames",nonce:n("#wprus\_import\_export\_nonce").val()}},processResults:function(e){var s=[];return e&&e.success&&e.data&&n.each(e.data.users,function(e,t){s.push({id:t.username,text:t.username})}),{results:s,pagination:{more:e.data.more}}}}}),n(".wprus-help-title").on("click",function(e){e.preventDefault(),n(this).next().slideToggle(200)}),n("#wprus\_force\_login\_redirect, #wprus\_disable\_login\_redirect").on("change",function(){e()}),e(),n(".wprus-ui-wait").show()}); |
  |  | 1 | jQuery(document).ready(function(n){WPRUS.debug&&n("body").addClass("wprus-debug");var a=function(){n(".wprus-togglable").hide(),n("."+n(".nav-tab-active").data("toggle")).show(),t(),"wprus-site"!==n(".nav-tab-active").data("toggle")||n("#postbox-container-2 .postbox.wprus-site").length?n("#sites\_placeholder").hide():n("#sites\_placeholder").show()},o=function(e){void 0!==e&&e.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:{nonce:n("#wprus\_logs\_nonce").val(),action:"wprus\_refresh\_logs"},success:function(e){e.success&&(n("#logs\_view").html(e.data.html),n(".logs-clean-trigger").val(e.data.clean\_trigger\_text))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t(),void 0!==e&&e.removeAttr("disabled")}})},t=function(){var e=document.getElementById("logs\_view");e.scrollTop=e.scrollHeight};function e(){n("#wprus\_force\_login\_redirect").prop("checked")?(n("#wprus\_disable\_login\_redirect").prop("checked",!1),n("#wprus\_disable\_login\_redirect").attr("disabled","disabled")):n("#wprus\_disable\_login\_redirect").prop("checked")?(n("#wprus\_force\_login\_redirect").prop("checked",!1),n("#wprus\_force\_login\_redirect").attr("disabled","disabled")):(n("#wprus\_force\_login\_redirect").removeAttr("disabled"),n("#wprus\_disable\_login\_redirect").removeAttr("disabled"))}n(".nav-tab").on("click",function(e){e.preventDefault(),n(".nav-tab-active").removeClass("nav-tab-active"),n(this).addClass("nav-tab-active"),a()}),n(".wprus-container").each(function(e,t){var s=n(t);s.closest(".postbox").addClass(s.data("postbox\_class"))}),a(),n("#postbox-container-2 .wprus-site").closest(".postbox").addClass("closed"),n("#normal-sortables").on("click",".handlediv, .wprus-site .hndle",function(e){e.preventDefault(),n(this).closest(".postbox").toggleClass("closed")}),n("#postbox-container-2").on("click",".deletion",function(e){e.preventDefault(),window.confirm(WPRUS.delete\_site\_confirm)&&n(this).closest(".wprus-site").remove()}),n("#wprus\_add\_trigger").on("click",function(e){e.preventDefault();var t=n("#wprus\_add\_value").val();if(t&&!n('.wprus-site[data-url="'+t+'"]').length)if(t.startsWith("http")){var s=n("#postbox-container-2 .wprus-site-template").clone(),r=n(".wprus-site").length;s.find("input, select").each(function(e,t){var s=n(t);s.attr("name","wprus[sites]["+r+"]"+s.data("name"))}),s.find(".wprus-container").attr("data-url",t),s.find(".hndle span").html(t),s.find('input[type="hidden"]').val(t),s.removeClass("wprus-site-template").addClass("wprus-site"),s.attr({"data-url":t,id:"site\_"+r}),s.find(".wprus-select").select2({width:"100%"}),s.find(".wprus-select-tag").select2({width:"100%",tags:!0}),n("#site\_template").before(s),a()}else window.alert(WPRUS.http\_required)}),n(".wprus-site .wprus-select, .wprus-users .wprus-select").select2({width:"100%"}),n(".wprus-site .wprus-select-tag").select2({width:"100%",tags:!0}),n("#normal-sortables").on("change",".wprus-select-tag",function(){n(this).find("option").each(function(e,t){var s=n(t);s.attr("value",s.html())})}),n("#normal-sortables").on("change",".action-checkbox input",function(){var e=n(this),t=e.closest("tr"),s=t.find(".action-test button");t.find(".action-test-result span").hide(),e.prop("checked")?s.removeAttr("disabled"):s.attr("disabled","disabled")}),n("#normal-sortables").on("click",".action-test button",function(e){e.preventDefault();var t=n(this),s=t.parent(),r=t.closest("tr"),a={nonce:n("#wprus\_ping\_nonce").val(),site\_url:t.closest(".wprus-container").data("url"),direction:s.data("direction"),data:{username:WPRUS.username},action:"wprus\_"+s.data("action")+"\_notify\_ping\_remote"};t.attr("disabled","disabled"),r.find(".failure").hide(),r.find(".success").hide(),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:a,success:function(e){e.success?r.find(".success").show():(r.find(".failure").show(),setTimeout(function(){window.alert(e.data)},10))},error:function(e,t){r.find(".success").hide(),r.find(".failure").show(),setTimeout(function(){window.alert(WPRUS.undefined\_error)},10),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),o()}})}),n('input[type="password"].toggle').on("focus",function(){n(this).attr("type","text")}),n('input[type="password"].toggle').on("blur",function(){n(this).attr("type","password")}),n("#wprus\_log\_refresh").on("click",function(e){e.preventDefault(),o(n(this))}),n(".logs-clean-trigger").on("click",function(e){e.preventDefault();var t=n(this);t.attr("disabled","disabled"),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:{action:"wprus\_clear\_logs"},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),o()}})}),n("#wprus\_export\_trigger").on("click",function(e){e.preventDefault();var t=n(this),s={action:"wprus\_export\_users",nonce:n("#wprus\_import\_export\_nonce").val(),offset:n("#wprus\_export\_offset").val(),max:n("#wprus\_export\_max").val(),keep\_role:n("#wprus\_export\_keep\_roles").val(),user\_roles:n("#wprus\_roles\_export\_select").val(),meta\_keys:n("#wprus\_metadata\_export\_select").val(),user\_list:n("#wprus\_export\_users").val(),doing\_import\_export\_operation:1};t.attr("disabled","disabled"),t.next().css("visibility","visible"),n(".export-result").removeClass("show"),n(".export-result a, .export-result-icons, .export-result-icons \*").hide(),n.ajax({url:WPRUS.ajax\_url,type:"POST",data:s,success:function(e){e.success?(n(".export-result-icons .success").show(),n(".export-result a").show()):e.data.file\_name?(n(".export-result-icons .warning").show(),n(".export-result a").show()):n(".export-result-icons .failure").show(),e.data&&e.data.file\_name&&(n(".export-result a").attr("data-file\_name",e.data.file\_name),n(".export-result a").attr("href",WPRUS.download\_url+"?wprus\_file="+e.data.file\_name+"&nonce="+s.nonce)),e.data&&e.data.message&&(n("#export\_message").html(e.data.message),n(".export-result-icons").show(),n(".export-result").addClass("show"))},error:function(e,t){WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})}),n(".export-result a").on("click",function(e){n(this).hasClass("invalidate")?e.preventDefault():n(this).addClass("invalidated")}),n("#wprus\_import\_file").on("change",function(){var e=n(this);0<e.prop("files").length?(n("#wprus\_import\_file\_filename").val(e.prop("files")[0].name),n("#wprus\_import\_file\_trigger").removeAttr("disabled")):(n("#wprus\_import\_file\_filename").val(""),n("#wprus\_import\_file\_trigger").attr("disabled","disabled"))}),n("#wprus\_import\_file\_dropzone").on("drag dragstart dragend dragover dragenter dragleave drop",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(e){var t=n("#wprus\_import\_file");t.prop("files",e.originalEvent.dataTransfer.files),t.trigger("change")}),n("#wprus\_import\_file\_trigger").on("click",function(e){e.preventDefault();var t=n(this),s=!0,r=new FormData,a=n("#wprus\_import\_file").prop("files")[0],o=n("#wprus\_import\_results .summary"),i=n("#wprus\_import\_results .errors");t.attr("disabled","disabled"),t.next().css("visibility","visible"),o.hide(),i.hide(),void 0!==a&&void 0!==a.type&&void 0!==a.size&&void 0!==a.name?/^([a-zA-Z0-9\-\\_]\*)\.dat/gm.test(a.name)||(window.alert(WPRUS.invalid\_file\_name),s=!1):(window.alert(WPRUS.invalid\_file),s=!1),s?(r.append("action","wprus\_import\_users"),r.append("file",a),r.append("nonce",n("#wprus\_import\_export\_nonce").val()),r.append("doing\_import\_export\_operation",1),n.ajax({url:WPRUS.ajax\_url,data:r,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(e){e.data&&(e.data.message&&(o.html(e.data.message),o.show()),e.data.errors&&(i.html(""),n.each(e.data.errors,function(e,t){var s=n("<li>"+t+"</li>");i.append(s)}),i.show()))},error:function(e,t){o.html(WPRUS.undefined\_import\_error),o.show(),WPRUS.debug&&console.log(t)},complete:function(){t.removeAttr("disabled"),t.next().css("visibility","hidden")}})):(t.next().css("visibility","hidden"),t.removeAttr("disabled"))}),n("#wprus\_export\_users").select2({width:"100%",cache:!0,closeOnSelect:!1,ajax:{url:WPRUS.ajax\_url,dataType:"json",language:WPRUS.locale,cache:!1,type:"POST",data:function(e){return{q:e.term,page:e.page||1,action:"wprus\_get\_usernames",nonce:n("#wprus\_import\_export\_nonce").val()}},processResults:function(e){var s=[];return e&&e.success&&e.data&&n.each(e.data.users,function(e,t){s.push({id:t.username,text:t.username})}),{results:s,pagination:{more:e.data.more}}}}}),n(".wprus-help-title").on("click",function(e){e.preventDefault(),n(this).next().slideToggle(200)}),n("#wprus\_force\_login\_redirect, #wprus\_disable\_login\_redirect").on("change",function(){e()}),e(),n(".wprus-ui-wait").show()}); |
* ## [wp-remote-users-sync/trunk/readme.txt](/changeset/2946667/wp-remote-users-sync/trunk/readme.txt "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/readme.txt")

  | [r2708689](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L4 "Show revision 2708689 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L4 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: sync, share login, multiple sites |
  | 5 | 5 | Requires at least: 4.9.5 |
  | 6 |  | Tested up to: ~~5.9~~ |
  |  | 6 | Tested up to: 6.3 |
  | 7 | 7 | Stable tag: trunk |
  | 8 | 8 | Requires PHP: 7.0 |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L33) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L33) |  |
  | 33 | 33 | Please read the plugin FAQ, there is a lot that may help you there! |
  | 34 | 34 |  |
  | 35 |  | WP Remote Users Sync is regularly updated, and bug reports are welcome, preferably on [Github](https://github.com/froger-me/wp-remote-users-sync/issues), especially for advanced troubleshooting. |
  | 36 |  |  |
  | 37 |  | Each \*\*bug\*\* report will be addressed in a timely manner, but general inquiries and issues reported on the WordPress forum may take significantly longer to receive a response. |
  |  | 35 | WP Remote Users Sync is regularly updated for compatibility, and bug reports are welcome, preferably on [Github](https://github.com/froger-me/wp-remote-users-sync/issues). |
  |  | 36 |  |
  |  | 37 | In case the plugin has not been updated for a while, no panic: it simply means the compatibility flag has not been changed, and it very likely remains compatible with the latest version of WordPress. This is because it was designed with long-term compatibility in mind from the ground up. |
  |  | 38 |  |
  |  | 39 | Each \*\*bug\*\* report will be addressed in a timely manner if properly documented - general inquiries and issues reported on the WordPress forum may take significantly longer to receive a response (if any). |
  | 38 | 40 |  |
  | 39 | 41 | \*\*Only issues occurring with included integrated plugins (or plugin features), core WordPress and default WordPress themes (incl. WooCommerce Storefront) will be considered without compensation.\*\* |
  | 40 | 42 |  |
  | 41 |  | \*\*Troubleshooting involving 3rd-party plugins or themes will ~~require compensation in any case, and will~~ not be addressed on the WordPress support forum\*\*. |
  |  | 43 | \*\*Troubleshooting involving 3rd-party plugins or themes will not be addressed on the WordPress support forum\*\*. |
  | 42 | 44 |  |
  | 43 | 45 | == Integrations == |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L45) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L47) |  |
  | 45 | 47 | Although WP Remote Users Sync works out of the box with most combinations of WordPress plugins and themes, there are some edge cases necessitating integration, with code included in the core files of WP Remote Users Sync executing under certain conditions. |
  | 46 | 48 |  |
  | 47 |  | Integrations added to core are limited to popular plugins and themes: any extra code specific to a handful of installations require a separate custom plugin not shared with the community (decision at the discretion of the WP Remote Users Sync plugin author). |
  | 48 |  |  |
  | 49 |  | A typical examples include plugins or themes directly updating the database with SQL queries instead of using WordPress built-in functions, destroying sessions with low-level functions instead of using the built-in WordPress method, etc. |
  | 50 |  |  |
  | 51 |  | If such need for plugin integration arises, website administrators may contact the author of WP Remote Users Sync to become a patron. |
  | 52 |  |  |
  | 53 |  | \*\*All integrations are to be funded by plugin users, with downpayment and delivery payment, at the plugin author's discretion, without exception\*\*. |
  | 54 |  | The patron in return may be credited with their name (or company name) and a link to a page of their choice in the plugin's Changelog. |
  | 55 |  |  |
  | 56 |  | == Upgrade Notice == |
  | 57 |  |  |
  | 58 |  | Because WP Remote Users Sync settings do not need to be changed often once set, the settings page has been moved under "Settings > WP Remote Users Sync" to avoid making the main WordPress admin menu more crowded than necessary. |
  |  | 49 | Integrations added to core are limited to popular plugins and themes: any extra code specific to a handful of installations require a separate custom plugin not shared with the community (created and maintained by a third-party developer). |
  |  | 50 |  |
  |  | 51 | A typical example necessitating a  includes plugins or themes directly updating the database with SQL queries instead of using WordPress built-in functions, destroying sessions with low-level functions instead of using the built-in WordPress method, etc. |
  |  | 52 |  |
  |  | 53 | If such need for plugin integration arises, website administrators \*\*MUST\*\* contact a third-party developer. The plugin author currently does not have the bandwidth to take on custom work for WPRUS. |
  | 59 | 54 |  |
  | 60 | 55 | == Installation == |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L102) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L97) |  |
  | 102 | 97 | Login and Logout User Actions need to output some code in the browser to have an effect on the remote website because of the cookies used for authentication. |
  | 103 | 98 |  |
  | 104 |  | What this means in practice is that if your theme or a thirdparty plugin allows users to login/logout without page reload, WP Remote Users Sync cannot output its code on the page, and without extra change to your website code base, the synchronisation can only happen after the page where the user logged in or logged out is actually reloaded. |
  | 105 |  |  |
  | 106 |  | Please also note that unless "Force Login Redirects & Logout Everywhere" is active, or if "Force Disable Login Redirects & Logout Everywhere" options is active in the "Browser Support" section of the "Miscellaneous" tab, Login and Logout User Actions will not work in browsers preventing cross-domain thirdparty cookie manipulation when the connected websites are on different domains. |
  |  | 99 | What this means in practice is that if your theme or a third-party plugin allows users to login/logout without page reload, WP Remote Users Sync cannot output its code on the page, and without extra change to your website code base, the synchronisation can only happen after the page where the user logged in or logged out is actually reloaded. |
  |  | 100 |  |
  |  | 101 | Please also note that unless "Force Login Redirects & Logout Everywhere" is active, or if "Force Disable Login Redirects & Logout Everywhere" options is active in the "Browser Support" section of the "Miscellaneous" tab, Login and Logout User Actions will not work in browsers preventing cross-domain third-party cookie manipulation when the connected websites are on different domains. |
  | 107 | 102 |  |
  | 108 | 103 | = What happens to existing users after activating WP Remote Users Sync? = |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L174) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L169) |  |
  | 174 | 169 | More help can be found on <a href="https://wordpress.org/support/plugin/wp-remote-users-sync/">the WordPress support forum</a> for general inquiries and on <a href="https://github.com/froger-me/wp-remote-users-sync">Github</a> for advanced troubleshooting. |
  | 175 | 170 |  |
  | 176 |  | Help is provided for general enquiries and bug fixes only: feature requests, extra integration or conflict resolution with third-party themes or plugins, and specific setup troubleshooting requests will not be addressed ~~without a fee (transfer method and amount at the discretion of the plugin author~~). |
  |  | 171 | Help is provided for general enquiries and bug fixes only: feature requests, extra integration or conflict resolution with third-party themes or plugins, and specific setup troubleshooting requests will not be addressed (Webiste administrators must cont). |
  | 177 | 172 |  |
  | 178 | 173 | == Changelog == |
  |  | 174 |  |
  |  | 175 | = 1.2.12 = |
  |  | 176 | \* WordPress tested up to: 6.3 |
  |  | 177 | \* Optimise settings page - thx to @foloed on Github |
  |  | 178 | \* Update variable filter IDs - php 8.x compat |
  |  | 179 | \* Ping & log refresh ajax check - thx to István Márton from Wordfence |
  |  | 180 | \* Drop paid custom code support from `readme.txt` |
  |  | 181 | \* Refactor integration class & documentation |
  |  | 182 | \* Minor fixes |
  | 179 | 183 |  |
  | 180 | 184 | = 1.2.11 = |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L213) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L217) |  |
  | 213 | 217 |  |
  | 214 | 218 | = 1.2.5 = |
  | 215 |  | \* Add compatibility with Safari and iOS devices: do not rely on cross-domain thirdparty cookies manipulation, but use explicit redirections for Login, and destroy all sessions for Logout |
  |  | 219 | \* Add compatibility with Safari and iOS devices: do not rely on cross-domain third-party cookies manipulation, but use explicit redirections for Login, and destroy all sessions for Logout |
  | 216 | 220 | \* Add template for explicit redirection processing screen |
  | 217 | 221 | \* Add Miscellaneous settings with a section for Browser Support |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L238) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L242) |  |
  | 238 | 242 | \* Removed unused URL parameter from the API |
  | 239 | 243 | \* Fix flushing of rewrite rules |
  | 240 |  | \* Set priority of all `init` action hooks to `PHP\_INT\_MIN - 10` to maximize compatibility with thirdparty plugins |
  |  | 244 | \* Set priority of all `init` action hooks to `PHP\_INT\_MIN - 10` to maximize compatibility with third-party plugins |
  | 241 | 245 | \* Refactor integrations |
  | 242 | 246 | \* Remove `wprus\_integration` filter ; add `wprus\_integration` action instead. |
  | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2708689#L290) | […](/browser/wp-remote-users-sync/trunk/readme.txt?rev=2946667#L294) |  |
  | 290 | 294 |  |
  | 291 | 295 | = 1.1.5 = |
  | 292 |  | \* Integration - make sure thirdparty plugins calling `wp\_redirect()` or `wp\_safe\_redirect()` without calling `exit` afterwards do not interfere with asynchronous actions ; `exit` should be called after these 2 functions unless there is a documented good reason not to, but some plugins (like Gravity Forms User Registration Add-On) or themes may not follow the WordPress best practices. |
  |  | 296 | \* Integration - make sure third-party plugins calling `wp\_redirect()` or `wp\_safe\_redirect()` without calling `exit` afterwards do not interfere with asynchronous actions ; `exit` should be called after these 2 functions unless there is a documented good reason not to, but some plugins (like Gravity Forms User Registration Add-On) or themes may not follow the WordPress best practices. |
  | 293 | 297 | \* Add missing Logout action logs |
  | 294 | 298 | \* Update Async actions logs |
* ## [wp-remote-users-sync/trunk/wprus.php](/changeset/2946667/wp-remote-users-sync/trunk/wprus.php "Show the changeset 2946667 restricted to wp-remote-users-sync/trunk/wprus.php")

  | [r2708689](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2708689#L4 "Show revision 2708689 of this file in browser") | [r2946667](/browser/wp-remote-users-sync/trunk/wprus.php?rev=2946667#L4 "Show revision 2946667 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Plugin URI: https://github.com/froger-me/wp-remote-users-sync |
  | 5 | 5 | Description: Synchronise WordPress Users across Multiple Sites. |
  | 6 |  | Version: 1.2.1~~1~~ |
  |  | 6 | Version: 1.2.12 |
  | 7 | 7 | Author: Alexandre Froger |
  | 8 | 8 | Author URI: https://froger.me/ |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2946667)
* [Zip Archive](?format=zip&new=2946667)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_7305c17b_20250114_184443.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WP Remote Users Sync <= 1.2.12 - Authenticated (Subscriber+) Server Side Request Forgery

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WP Remote Users Sync <= 1.2.12 - Authenticated (Subscriber+) Server Side Request Forgery

8.5

**Server-Side Request Forgery (SSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:L/A:N)

| CVE | [CVE-2023-3958](https://www.cve.org/CVERecord?id=CVE-2023-3958) |
| --- | --- |
| CVSS | 8.5 (High) |
| Publicly Published | August 15, 2023 |
| Last Updated | January 22, 2024 |
| Researcher | [István Márton - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lana-codes) |

### Description

The WP Remote Users Sync plugin for WordPress is vulnerable to Server Side Request Forgery via the 'notify\_ping\_remote' AJAX function in versions up to, and including, 1.2.12. This can allow authenticated attackers with subscriber-level permissions or above to make web requests to arbitrary locations originating from the web application and can be used to query and modify information from internal services. This was partially patched in version 1.2.12 and fully patched in version 1.2.13.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-remote-users-sync/trunk/inc/api/class-wprus-api-abstract.php#L674)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2946667/wp-remote-users-sync#file127)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/2953845/wp-remote-users-sync#file0)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-remote-users-sync%2Fwp-remote-users-sync-1212-authenticated-subscriber-server-side-request-forgery&t=WP%20Remote%20Users%20Sync%20%3C%3D%201.2.12%20-%20Authenticated%20%28Subscriber%2B%29%20Server%20Side%20Request%20Forgery "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-remote-users-sync%2Fwp-remote-users-sync-1212-authenticated-subscriber-server-side-request-forgery&text=WP%20Remote%20Users%20Sync%20%3C%3D%201.2.12%20-%20Authenticated%20%28Subscriber%2B%29%20Server%20Side%20Request%20Forgery "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-remote-users-sync%2Fwp-remote-users-sync-1212-authenticated-subscriber-server-side-request-forgery "LinkedIn")
Email

## Vulnerability Details for WP Remote Users Sync

#### [WP Remote Users Sync](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-remote-users-sync)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-remote-users-sync [(view on wordpress.org)](https://wordpress.org/plugins/wp-remote-users-sync) |
| Patched? | Yes |
| Remediation | Update to version 1.2.13, or a newer patched version |
| Affected Version | * <= 1.2.12 |
| Patched Version | * 1.2.13 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


