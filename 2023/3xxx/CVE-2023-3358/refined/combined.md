=== Content from git.kernel.org_b938d541_20250115_090349.html ===


| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jiasheng Jiang <jiasheng@iscas.ac.cn> | 2022-11-22 21:48:23 +0800 |
| --- | --- | --- |
| committer | Jiri Kosina <jkosina@suse.cz> | 2023-01-02 13:50:14 +0100 |
| commit | [b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)) | |
| tree | [0847d321031afa770bf1149a9dafd67b02f5632d](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8) | |
| parent | [54f27dc53f1764986d417cfafe1013806deba668](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=54f27dc53f1764986d417cfafe1013806deba668) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8&id2=54f27dc53f1764986d417cfafe1013806deba668)) | |
| download | [linux-b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8.tar.gz) | |

HID: intel\_ish-hid: Add check for ishtp\_dma\_tx\_mapAs the kcalloc may return NULL pointer,
it should be better to check the ishtp\_dma\_tx\_map
before use in order to avoid NULL pointer dereference.
Fixes: 3703f53b99e4 ("HID: intel\_ish-hid: ISH Transport layer")
Signed-off-by: Jiasheng Jiang <jiasheng@iscas.ac.cn>
Acked-by: Srinivas Pandruvada <srinivas.pandruvada@linux.intel.com>
Signed-off-by: Jiri Kosina <jkosina@suse.cz>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)

| -rw-r--r-- | [drivers/hid/intel-ish-hid/ishtp/dma-if.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/drivers/hid/intel-ish-hid/ishtp/dma-if.c?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 0 deletions

| diff --git a/drivers/hid/intel-ish-hid/ishtp/dma-if.c b/drivers/hid/intel-ish-hid/ishtp/dma-if.cindex 40554c8daca07b..00046cbfd4ed07 100644--- a/[drivers/hid/intel-ish-hid/ishtp/dma-if.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/intel-ish-hid/ishtp/dma-if.c?id=54f27dc53f1764986d417cfafe1013806deba668)+++ b/[drivers/hid/intel-ish-hid/ishtp/dma-if.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/hid/intel-ish-hid/ishtp/dma-if.c?id=b3d40c3ec3dc4ad78017de6c3a38979f57aaaab8)@@ -104,6 +104,11 @@ void \*ishtp\_cl\_get\_dma\_send\_buf(struct ishtp\_device \*dev, int required\_slots = (size / DMA\_SLOT\_SIZE) + 1 \* (size % DMA\_SLOT\_SIZE != 0); + if (!dev->ishtp\_dma\_tx\_map) {+ dev\_err(dev->devc, "Fail to allocate Tx map\n");+ return NULL;+ }+ spin\_lock\_irqsave(&dev->ishtp\_dma\_tx\_lock, flags); for (i = 0; i <= (dev->ishtp\_dma\_num\_slots - required\_slots); i++) { free = 1;@@ -150,6 +155,11 @@ void ishtp\_cl\_release\_dma\_acked\_mem(struct ishtp\_device \*dev, return; } + if (!dev->ishtp\_dma\_tx\_map) {+ dev\_err(dev->devc, "Fail to allocate Tx map\n");+ return;+ }+ i = (msg\_addr - dev->ishtp\_host\_dma\_tx\_buf) / DMA\_SLOT\_SIZE; spin\_lock\_irqsave(&dev->ishtp\_dma\_tx\_lock, flags); for (j = 0; j < acked\_slots; j++) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-15 09:02:26 +0000


