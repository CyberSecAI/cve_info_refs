=== Content from gitlab.com_7c54c541_20250115_080547.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# TIFFClose() avoid NULL pointer dereferencing. fix#515

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/libtiff/libtiff/-/merge_requests/468.patch)
* [Plain diff](/libtiff/libtiff/-/merge_requests/468.diff)

[Su Laus](/Su_Laus) requested to merge  [Su\_Laus/libtiff:TiffClose\_NULL\_ptr\_dereferencing\_fix\_515](/Su_Laus/libtiff/-/tree/TiffClose_NULL_ptr_dereferencing_fix_515 "Su_Laus/libtiff:TiffClose_NULL_ptr_dereferencing_fix_515")
 into [master](/libtiff/libtiff/-/tree/master "master") Feb 03, 2023

* [Overview
  1](/libtiff/libtiff/-/merge_requests/468)
* [Commits
  1](/libtiff/libtiff/-/merge_requests/468/commits)
* [Pipelines
  1](/libtiff/libtiff/-/merge_requests/468/pipelines)
* [Changes
  2](/libtiff/libtiff/-/merge_requests/468/diffs)

Expand

TIFFClose() avoid NULL pointer dereferencing.

Closes [#515 (closed)](/libtiff/libtiff/-/issues/515 "Null Pointer Dereference in TIFFClose()")

## Merge request reports

Assignee
Loading

Reviewers
Loading

Select reviewersRequest review fromLoading

Time tracking
Loading

Loading



=== Content from lists.debian.org_bdc4043c_20250115_080547.html ===


---

[[Date Prev](msg00033.html)][Date Next]
[[Thread Prev](msg00033.html)][Thread Next]
[[Date Index](maillist.html#00034)]
[[Thread Index](threads.html#00034)]

# [SECURITY] [DLA 3513-1] tiff security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3513-1] tiff security update
* *From*: Adrian Bunk <bunk@debian.org>
* *Date*: Mon, 31 Jul 2023 23:56:20 +0000
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/ZMhKJKxZFUd888sD%40localhost)Â [ZMhKJKxZFUd888sD@localhost](msg00034.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

- -------------------------------------------------------------------------
Debian LTS Advisory DLA-3513-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                          Adrian Bunk
July 31, 2023                                 <https://wiki.debian.org/LTS>
- -------------------------------------------------------------------------

Package        : tiff
Version        : 4.1.0+git191117-2~deb10u8
CVE ID         : CVE-2023-2908 CVE-2023-3316 CVE-2023-3618 CVE-2023-25433
                 CVE-2023-26965 CVE-2023-26966 CVE-2023-38288 CVE-2023-38289
Debian Bug     : 1040945

Multiple vulnerabilities were found in tiff, a library and tools
providing support for the Tag Image File Format (TIFF).

CVE-2023-2908

    NULL pointer dereference in tif_dir.c

CVE-2023-3316

    NULL pointer dereference in TIFFClose()

CVE-2023-3618

    Buffer overflow in tiffcrop

CVE-2023-25433

    Buffer overflow in tiffcrop

CVE-2023-26965

    Use after free in tiffcrop

CVE-2023-26966

    Buffer overflow in uv_encode()

CVE-2023-38288

    Integer overflow in tiffcp

CVE-2023-38289

    Integer overflow in raw2tiff

For Debian 10 buster, these problems have been fixed in version
4.1.0+git191117-2~deb10u8.

We recommend that you upgrade your tiff packages.

For the detailed security status of tiff please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/tiff>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEOvp1f6xuoR0v9F3wiNJCh6LYmLEFAmTISiQACgkQiNJCh6LY
mLE4oxAAsLoU6HtnZqYIurv0h/+D1aJ1AkSSlp9pfLvJiuPl5nWa5h5E+jYEGkK1
O39SOJNVXoDqixLv4LfCqhyGWffY8NZB+d9fidV5lHml7PwOjsLECAN2to4WJW7m
tsCzG0STEwGn9W1kS12zGBKJt8La+h8V4T4ZrCZIW41RzkOhmUhFYIpKCrB1Z0qs
Z2wGLR2zBnMBr9RiwGVEHKiogZgOYr0VS0g0pZasDFGR++ra/JZfjotzIxmWTt4v
Nkued+JWymGMmieiM93SHPA6BRbWI3fU0bQ4mKXuJppMBy0wDL3DXdu9HG+NlU9T
U9WVWLoY5xqUGBaYaMirDcVslPTjYAuTyCiUtHIlkv8EV+6Eafl1CBZnzNPdyGId
wuMxCHPQjAScUue3WpYX8hd2xSpgC1M0q+CLUde1sav7v9idOJFNe4jZ656cMcKY
6NS5ZxIwHEj8GnbN15qvkpuvIfsrOfXQhkNr9TLE4iOs2V4bSBWumGK7FsML7uMR
HfHtZk1CYojq59yQFNIbV58oqLghsmDuJBgQOEOTnS9Kau0Bbjum5+I/LSlmdweF
Qjpv1ARfc5SMoDYSA6/Yl0Zwx0j58hWopK2wDyzY6HQduTCNk4XkRWHROCEaSmiC
G2wKf9KsM6lgruHhHNB1r817J5bwNZ42X6ClGvP5Je+WHBJffyY=
=GGoQ
-----END PGP SIGNATURE-----

```

---



=== Content from research.jfrog.com_689e9d3f_20250115_080547.html ===

[![JFrog Security Research](/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg)](/)JFrog Security Research

* [Discover](/vulnerabilities/)
* [Follow JFrog Security
  ![twitter](/assets/static/twitter.e0519be.9769aec62433fd58c76ad32c2d613842.svg)](https://twitter.com/JFrogSecurity)
![Menu](/assets/static/hamburger.a58a0fd.dc5087fee70346d455e75c87bc430716.svg)![Menu](data:image/svg+xml...)![Menu](/assets/static/close.5cd2673.91b568c73f917f773ea7915d69802829.svg)

* [Home](/)
* [Discover](/vulnerabilities/)
* [Follow JFrog Security](https://twitter.com/JFrogSecurity)
[< Back](/vulnerabilities/)
# XRAY-522144 - libtiff NULL dereference DoS

CVE-2023-3316
| CVSS 5.9

 JFrog Severity:medium

Discovered By**Yair Mizrahi**of the JFrog Security Research Team

Published 19 Jun, 2023 | Last updated 19 Jun, 2023

## [Summary](#summary)

A NULL pointer dereference in TIFFClose() is caused by a failure to open an output file (non-existent path or a path that requires permissions like /dev/null) while specifying zones.

## [Component](#component)

libtiff:libtiff

## [Affected versions](#affected-versions)

[3.9.0,4.5.1), Fixed in 4.5.1

## [Description](#description)

A NULL pointer dereference in TIFFClose() is caused by a failure to open an output file (non-existent path or a path that requires permissions like /dev/null) while specifying zones.

## [PoC](#poc)

```
$ git clone https://gitlab.com/libtiff/libtiff.git
$ cd libtiff/
$ ./autogen.sh
$ ./configure && make
$ tools/tiffcrop -Z 1:1 empty.tif /non-existent-path

```
## [Vulnerability Mitigations](#vulnerability-mitigations)

No mitigations are supplied for this issue

## [References](#references)

[Advisory](https://gitlab.com/libtiff/libtiff/-/issues/515)

[Original issue](https://gitlab.com/libtiff/libtiff/-/issues/515)

[Fix MR](https://gitlab.com/libtiff/libtiff/-/merge_requests/468)

[< Back](/vulnerabilities/)[![JFrog Security Research](/assets/static/jfrog-logo-svg.5788598.74a3bea875bf053c65a0663c9ec9a0fd.svg)](/)

* [Terms of Use](https://jfrog.com/terms-of-use/)
* [Cookies Policy](https://jfrog.com/jfrog-cookies-policy/)
* [Privacy Policy](https://jfrog.com/privacy-policy/)
* Cookies Settings

Â©2025 All Rights Reserved. JFrog Ltd.



=== Content from gitlab.com_08dc8e47_20250115_080545.html ===


[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Null Pointer Dereference in TIFFClose()

***Summary***

A NULL pointer dereference in `TIFFClose()` that is caused by a failure to open an output file (non-existent path or a path that requires permissions like `/dev/null`) while specifying zones.

***Version***

v4.5.0, master (commit [0f8ae944](/libtiff/libtiff/-/commit/0f8ae9442a2c4ab2993069e1e270bd726c31c3b4 "Merge branch 'tif_hash_set_order_include' into 'master'")) and **every version since v3.9.0 Beta from 2007**.

***Steps to reproduce***

```
$ git clone https://gitlab.com/libtiff/libtiff.git
$ cd libtiff/
$ ./autogen.sh
$ ./configure && make
$ tools/tiffcrop -Z 1:1 empty.tif /non-existent-path
TIFFOpen: /non-existent-path: Permission denied.
update_output_file: Unable to open output file /non-existent-path.
Segmentation fault
$ dmesg
[255894.797214] tiffcrop[20792]: segfault at 488 ip 00007f6a8f60578a sp 00007ffe57a7d7b0 error 4 in libtiff.so.6.0.0[7f6a8f603000+41000]
[255894.798588] Code: 49 8b 75 20 48 89 ef e8 b4 ed 02 00 4c 89 ee 48 89 ef e8 a9 ed 02 00 e9 40 ff ff ff 0f 1f 40 00 f3 0f 1e fa 55 53 48 83 ec 08 <48> 8b 9f 88 04 00 00 48 8b af 68 04 00 00 e8 33 ea ff ff 48 83 c4
[255894.800019] potentially unexpected fatal signal 11.
[255894.800360] CPU: 6 PID: 20792 Comm: tiffcrop Not tainted 5.15.79.1
[255894.801010] RIP: 0033:0x7f6a8f60578a
[255894.801315] Code: 49 8b 75 20 48 89 ef e8 b4 ed 02 00 4c 89 ee 48 89 ef e8 a9 ed 02 00 e9 40 ff ff ff 0f 1f 40 00 f3 0f 1e fa 55 53 48 83 ec 08 <48> 8b 9f 88 04 00 00 48 8b af 68 04 00 00 e8 33 ea ff ff 48 83 c4
[255894.802838] RSP: 002b:00007ffe57a7d7b0 EFLAGS: 00010202
[255894.803306] RAX: 0000000000000001 RBX: 0000000000000001 RCX: 0000000000000032
[255894.804013] RDX: 000000055eae8010 RSI: 000055eae7ffb010 RDI: 0000000000000000
[255894.804645] RBP: 00007ffe57a7d9e8 R08: 000055eae80109f0 R09: 000000007fffffff
[255894.805338] R10: 00007f6a8f3d9f20 R11: e3f53316e5ab21bb R12: 00007ffe57a8432a
[255894.806034] R13: 0000000000000001 R14: 000055eae80109f0 R15: 000055eae7ffb2d0
[255894.806707] FS:  00007f6a8f299740 GS:  0000000000000000
```

***Platform***

```
user@user-pc:~/libtiff/libtiff$ gcc --version
gcc (Ubuntu 11.3.0-1ubuntu1~22.04) 11.3.0
Copyright (C) 2021 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
user@user-pc:~/libtiff/libtiff$ cat /etc/os-release
PRETTY_NAME="Ubuntu 22.04.1 LTS"
NAME="Ubuntu"
VERSION_ID="22.04"
VERSION="22.04.1 LTS (Jammy Jellyfish)"
VERSION_CODENAME=jammy
ID=ubuntu
ID_LIKE=debian
HOME_URL="https://www.ubuntu.com/"
SUPPORT_URL="https://help.ubuntu.com/"
BUG_REPORT_URL="https://bugs.launchpad.net/ubuntu/"
PRIVACY_POLICY_URL="https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"
UBUNTU_CODENAME=jammy
```

***Reproducer file***

Any valid TIFF would work: [empty.tif](/-/project/4720790/uploads/ba127b1fb589cc225de8fc1859105b3c/empty.tif)

***In-Depth Details***

Tiffcrop's main() function tries to close the output file at the end: [Line 2923](https://gitlab.com/libtiff/libtiff/-/blob/0f8ae9442a2c4ab2993069e1e270bd726c31c3b4/tools/tiffcrop.c#L2923)

The null-dereference happens inside the `TIFFClose()` functions:

```
void TIFFClose(TIFF *tif)
{
    TIFFCloseProc closeproc = tif->tif_closeproc;  ----------------> Null-dereference
    thandle_t fd = tif->tif_clientdata;

    TIFFCleanup(tif);
    (void)(*closeproc)(fd);
}
```

We can see that it dereferences a TIFF struct, to get the close function pointer:

```
struct tiff
{
    char *tif_name; /* name of open file */
    int tif_fd;     /* open file descriptor */
    int tif_mode;   /* open mode (O_*) */
    uint32_t tif_flags;
    ....................
    TIFFCloseProc tif_closeproc;     /* close method */   -----------> on master +0x488, on v4.5.0 +0x498
    ....................
};
```

`TIFFClose()` will then execute this pointer at the last line.

However, it is important to note that modern Linux systems do not allow the allocation of memory around the `NULL` (`0x0`) address.

***Root-Cause Analysis***

The root cause of this is this code inside tiffcrop's main():

```
................................
/* Format and write selected image parts to output file(s). */
if (page.mode == PAGE_MODE_NONE)
{ /* Whole image or sections not based on output page size */
	if (crop.selections > 0)
	{
		writeSelections(in, &out, &crop, &image, &dump, seg_buffs,
						mp, argv[argc - 1], &next_page,
						total_pages);
................................
```

`writeSelections()` is responsible to open the output file:

```
case FILE_PER_SELECTION:
	autoindex = 1;
	page_count = 1;
	for (i = 0; i < crop->selections; i++)
	{
		if (update_output_file(out, mp, autoindex, filename, page))
			return (1);

		.............
	}
```

But then, `update_output_file()` will fail when trying to open one:

```
................................
if (*tiffout == NULL)
{
	TIFFError("update_output_file", "Unable to open output file %s",
			  exportname);
	return 1;
}
................................
```

***Proposed Patches***

For `libtiff/tiffcrop.c`: [tiffcrop.patch](/-/project/4720790/uploads/ec54aac0631a2e795d0dd37fdea97428/tiffcrop.patch)

For `libtiff/tif_close.c`: [tif\_close.patch](/-/project/4720790/uploads/1fc42f6d29a5c7bad0b2792fa6067eed/tif_close.patch)

***Notes***

We can create a CVE entry after the fixed version is released since we are a CNA (JFrog Ltd).

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


