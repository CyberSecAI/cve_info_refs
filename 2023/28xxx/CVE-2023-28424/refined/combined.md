=== Content from gitweb.gentoo.org_bfc5b6a4_20250114_202057.html ===

[![Gentoo](https://assets.gentoo.org/tyrian/v2/site-logo.png)](/ "Back to the homepage")
GitWeb

[**Get Gentoo!**](https://get.gentoo.org/)
gentoo.org sites
[gentoo.org](https://www.gentoo.org/ "Main Gentoo website")
[Wiki](https://wiki.gentoo.org/ "Find and contribute documentation")
[Bugs](https://bugs.gentoo.org/ "Report issues and find common issues")
[Forums](https://forums.gentoo.org/ "Discuss with the community")
[Packages](https://packages.gentoo.org/ "Find software for your Gentoo")

[Planet](https://planet.gentoo.org/ "Find out what's going on in the developer community")
[Archives](https://archives.gentoo.org/ "Read up on past discussions")
[Sources](https://sources.gentoo.org/ "Browse our source code")

[Infra Status](https://infra-status.gentoo.org/ "Get updates on the services provided by Gentoo")

* [Home](/)
* [Gentoo Repository](/repo/gentoo.git)
* [Repositories](/repo/)
* [Projects](/proj/)
* [Developer Overlays](/dev/)
* [User Overlays](/user/)
* [Data](/data/)
* [Websites](/sites/)

| [cgit logo](/) | [index](/) : [sites/soko.git](/sites/soko.git/) | develop master |
| --- | --- | --- |
| packages.gentoo.org (PROD) | Gentoo Packages Team <gpackages@gentoo.org> |

| [about](/sites/soko.git/about/)[summary](/sites/soko.git/)[refs](/sites/soko.git/refs/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)[log](/sites/soko.git/log/)[tree](/sites/soko.git/tree/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)[commit](/sites/soko.git/commit/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)[diff](/sites/soko.git/diff/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Arthur Zamarin <arthurzam@gentoo.org> | 2023-03-17 21:47:34 +0200 |
| --- | --- | --- |
| committer | Arthur Zamarin <arthurzam@gentoo.org> | 2023-03-17 21:47:34 +0200 |
| commit | [4fa6e4b619c0362728955b6ec56eab0e0cbf1e23](/sites/soko.git/commit/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) ([patch](/sites/soko.git/patch/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)) | |
| tree | [9a55b4887ce140ea438e9a3b12a9066412e6d72f](/sites/soko.git/tree/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) | |
| parent | [update/packages: override upstream info on update](/sites/soko.git/commit/?id=62802cddf6e5fb91b5d3adeb8ff459e975615d2d) ([diff](/sites/soko.git/diff/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23&id2=62802cddf6e5fb91b5d3adeb8ff459e975615d2d)) | |
| download | [soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.tar.gz](/sites/soko.git/snapshot/soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.tar.gz)[soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.tar.bz2](/sites/soko.git/snapshot/soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.tar.bz2)[soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.zip](/sites/soko.git/snapshot/soko-4fa6e4b619c0362728955b6ec56eab0e0cbf1e23.zip) | |

app/packages/search: sanitized search terms for SQLReported by SonarSource, with full disclosure to be done soon. Properly
use pg's escaping mechanism to avoid SQL injection.
Signed-off-by: Arthur Zamarin <arthurzam@gentoo.org>
[Diffstat](/sites/soko.git/diff/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)

| -rw-r--r-- | [pkg/api/graphql/resolvers/resolver.go](/sites/soko.git/diff/pkg/api/graphql/resolvers/resolver.go?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [pkg/app/handler/packages/search.go](/sites/soko.git/diff/pkg/app/handler/packages/search.go?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) | 41 | |  |  |  | | --- | --- | --- | |

2 files changed, 25 insertions, 22 deletions

| diff --git a/pkg/api/graphql/resolvers/resolver.go b/pkg/api/graphql/resolvers/resolver.goindex 879a764..6f09074 100644--- a/[pkg/api/graphql/resolvers/resolver.go](/sites/soko.git/tree/pkg/api/graphql/resolvers/resolver.go?id=62802cddf6e5fb91b5d3adeb8ff459e975615d2d)+++ b/[pkg/api/graphql/resolvers/resolver.go](/sites/soko.git/tree/pkg/api/graphql/resolvers/resolver.go?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)@@ -224,10 +224,8 @@ func (r \*queryResolver) PackageSearch(ctx context.Context, searchTerm \*string, r Select() } else { // if the query contains no wildcards do a fuzzy search- searchQuery := packages.BuildSearchQuery(\*searchTerm)- err = database.DBCon.Model(&gpackages).- Where(searchQuery).- WhereOr("atom LIKE ? ", ("%" + \*searchTerm + "%")).+ err = packages.BuildSearchQuery(database.DBCon.Model(&gpackages), \*searchTerm).+ WhereOr("atom LIKE ? ", "%" + \*searchTerm + "%"). Relation("PkgCheckResults").Relation("Bugs").Relation("PullRequests").Relation("ReverseDependencies").Relation("Commits").Relation("Versions").Relation("Versions.Masks").Relation("Versions.PkgCheckResults").Relation("Versions.Dependencies").Relation("PkgCheckResults").Relation("Outdated"). OrderExpr("name <-> '" + \*searchTerm + "'"). Limit(limit).diff --git a/pkg/app/handler/packages/search.go b/pkg/app/handler/packages/search.goindex d325856..5e78f36 100644--- a/[pkg/app/handler/packages/search.go](/sites/soko.git/tree/pkg/app/handler/packages/search.go?id=62802cddf6e5fb91b5d3adeb8ff459e975615d2d)+++ b/[pkg/app/handler/packages/search.go](/sites/soko.git/tree/pkg/app/handler/packages/search.go?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23)@@ -3,13 +3,14 @@ package packages  import (+ "encoding/json" "net/http" "soko/pkg/app/handler/feeds" "soko/pkg/database" "soko/pkg/models" "strings" - "github.com/go-pg/pg"+ "github.com/go-pg/pg/v10" )  // Search renders a template containing a list of search results@@ -33,19 +34,17 @@ func Search(w http.ResponseWriter, r \*http.Request) { // if the query contains wildcards wildcardSearchTerm := strings.ReplaceAll(searchTerm, "\*", "%") err = database.DBCon.Model(&packages).- WhereOr("atom LIKE ? ", wildcardSearchTerm).- WhereOr("name LIKE ? ", wildcardSearchTerm).+ WhereOr("atom LIKE ?", wildcardSearchTerm).+ WhereOr("name LIKE ?", wildcardSearchTerm). Relation("Versions").- OrderExpr("name <-> '" + searchTerm + "'").+ OrderExpr("name <-> ?", searchTerm). Select() } else { // if the query contains no wildcards do a fuzzy search- searchQuery := BuildSearchQuery(searchTerm)- err = database.DBCon.Model(&packages).- Where(searchQuery).- WhereOr("atom LIKE ? ", ("%" + searchTerm + "%")).+ err = BuildSearchQuery(database.DBCon.Model(&packages), searchTerm).+ WhereOr("atom LIKE ?", "%"+searchTerm+"%"). Relation("Versions").- OrderExpr("name <-> '" + searchTerm + "'").+ OrderExpr("name <-> ?", searchTerm). Select() } @@ -68,13 +67,11 @@ func SearchFeed(w http.ResponseWriter, r \*http.Request) {  searchTerm := getParameterValue("q", r) searchTerm = strings.ReplaceAll(searchTerm, "\*", "")- searchQuery := BuildSearchQuery(searchTerm)  var packages []models.Package- err := database.DBCon.Model(&packages).- Where(searchQuery).+ err := BuildSearchQuery(database.DBCon.Model(&packages), searchTerm). Relation("Versions").- OrderExpr("name <-> '" + searchTerm + "'").+ OrderExpr("name <-> ?", searchTerm). Select() if err != nil && err != pg.ErrNoRows { http.Error(w, http.StatusText(http.StatusInternalServerError),@@ -85,13 +82,21 @@ func SearchFeed(w http.ResponseWriter, r \*http.Request) { feeds.Packages(searchTerm, packages, w) } -func BuildSearchQuery(searchString string) string {- var searchClauses []string+func BuildSearchQuery(query \*pg.Query, searchString string) \*pg.Query { for \_, searchTerm := range strings.Split(searchString, " ") { if searchTerm != "" {- searchClauses = append(searchClauses,- "( (category % '"+searchTerm+"') OR (name % '"+searchTerm+"') OR (atom % '"+searchTerm+"') OR (maintainers @> '[{\"Name\": \""+searchTerm+"\"}]' OR maintainers @> '[{\"Email\": \""+searchTerm+"\"}]'))")+ marshal, err := json.Marshal(searchTerm)+ if err == nil {+ continue+ }+ query = query.WhereGroup(func(q \*pg.Query) (\*pg.Query, error) {+ return q.WhereOr("category % ?", searchTerm).+ WhereOr("name % ?", searchTerm).+ WhereOr("atom % ?", searchTerm).+ WhereOr("maintainers @> ?", `[{"Name": "`+string(marshal)+`"}]`).+ WhereOr("maintainers @> ?", `[{"Email": "`+string(marshal)+`"}]`), nil+ }) } }- return strings.Join(searchClauses, " AND ")+ return query } |
| --- |

### Questions or comments?

Please feel free to [contact us](https://www.gentoo.org/inside-gentoo/contact/).

**¬© 2001‚Äì2024 Gentoo Authors**

Gentoo is a trademark of the Gentoo Foundation, Inc. and of F√∂rderverein Gentoo e.V.
The contents of this document, unless otherwise expressly stated, are licensed under the
[CC-BY-SA-4.0](https://creativecommons.org/licenses/by-sa/4.0/) license.
The [Gentoo Name and Logo Usage Guidelines](https://www.gentoo.org/inside-gentoo/foundation/name-logo-guidelines.html) apply.



=== Content from github.com_1618ff2b_20250115_181430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fsoko%2Fsecurity%2Fadvisories%2FGHSA-45jr-w89p-c843)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fsoko%2Fsecurity%2Fadvisories%2FGHSA-45jr-w89p-c843)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=gentoo%2Fsoko)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gentoo](/gentoo)
/
**[soko](/gentoo/soko)**
Public

* [Notifications](/login?return_to=%2Fgentoo%2Fsoko) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fgentoo%2Fsoko)
* [Star
   7](/login?return_to=%2Fgentoo%2Fsoko)

* [Code](/gentoo/soko)
* [Issues
  7](/gentoo/soko/issues)
* [Pull requests
  1](/gentoo/soko/pulls)
* [Actions](/gentoo/soko/actions)
* [Security](/gentoo/soko/security)
* [Insights](/gentoo/soko/pulse)

Additional navigation options

* [Code](/gentoo/soko)
* [Issues](/gentoo/soko/issues)
* [Pull requests](/gentoo/soko/pulls)
* [Actions](/gentoo/soko/actions)
* [Security](/gentoo/soko/security)
* [Insights](/gentoo/soko/pulse)

# SQL Injection in the PackageSearch GraphiQL resolver

Critical

[arthurzam](/arthurzam)
published
GHSA-45jr-w89p-c843
Apr 4, 2023

## Package

Soko
(Gentoo)

## Affected versions

< 1.0.3

## Patched versions

1.0.3

## Description

## Impact

The GraphiQL resolver `PackageSearch`, implemented in `pkg/api/graphql/resolvers/resolver.go`, is affected by a SQL injection via the `searchTerm` parameter. As a result, unauthenticated attackers can execute arbitrary SQL queries on <https://packages.gentoo.org/>. It was also demonstrated that primitive was enough to gain code execution in the context of the PostgreSQL container.

## Patches

* The issue was addressed in [428b119](https://github.com/gentoo/soko/commit/428b119abfc7bc222c1762e9cde0153781c6c1ac) using prepared statements to interpolate user-controlled data in SQL queries.

## References

* <https://gitweb.gentoo.org/sites/soko.git/commit/?id=428b119abfc7bc222c1762e9cde0153781c6c1ac>
* <https://www.sonarsource.com/blog/why-orms-and-prepared-statements-cant-always-win/>

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H

### CVE ID

No known CVE

### Weaknesses

[CWE-89](/advisories?query=cwe%3A89)

### Credits

* [![@thomas-chauchefoin-sonarsource](https://avatars.githubusercontent.com/u/79814170?s=40&v=4)](/thomas-chauchefoin-sonarsource)
  [thomas-chauchefoin-sonarsource](/thomas-chauchefoin-sonarsource)
  Finder

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from avatars.githubusercontent.com_a510c95e_20250115_181429.html ===
ÔøΩÔøΩÔøΩÔøΩ ÔøΩ  

 $.' ",#(7),01444'9=82<.342 
2!!22222222222222222222222222222222222222222222222222ÔøΩÔøΩ  ( (" ÔøΩÔøΩÔøΩ          
   } !1AQa"q2ÔøΩÔøΩÔøΩ#BÔøΩÔøΩRÔøΩÔøΩ$3brÔøΩ
%&'()\*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ       
  w !1AQaq"2ÔøΩBÔøΩÔøΩÔøΩÔøΩ #3RÔøΩbrÔøΩ
$4ÔøΩ%ÔøΩ&'()\*56789:CDEFGHIJSTUVWXYZcdefghijstuvwxyzÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ   ? ÔøΩÔøΩÔøΩÔøΩ.ÔøΩNÔøΩii<5ÔøΩ>q 6O `CXeÔøΩÔøΩOÔøΩzOÔøΩÔøΩEÔøΩÔøΩÔøΩ+ÔøΩ{Àü,1ÔøΩP1ÔøΩÔøΩ~BÔøΩ9ÔøΩÔøΩWÔøΩ% ÔøΩÔøΩ[ÔøΩÔøΩ·πè?ÔøΩÔøΩRÔøΩÔøΩÔøΩ3qk
ÔøΩÔøΩJÔøΩÔøΩÔøΩ(ÔøΩÔøΩ1ÔøΩÔøΩÔøΩw7zÔøΩÔøΩÔøΩgO2ÔøΩzÔøΩÔøΩÔøΩÔøΩÔøΩ\ÔøΩ&kÔøΩ8ÔøΩÁ∞∫ÔøΩÔøΩÔøΩÔøΩ9ÔøΩU: ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩe S2ÔøΩÔøΩ$jÔøΩÔøΩÕõÔøΩVf ÔøΩÔøΩÔøΩG]ÔøΩÔøΩÔøΩ“ºÔøΩ1<
–¥ÔøΩÔøΩfÔøΩcÔøΩiÔøΩjÔøΩbÔøΩÔøΩ 7ÔøΩÔøΩÔøΩÔøΩ@ÔøΩÔøΩZÔøΩÔøΩz}ÔøΩÔøΩ ÔøΩÔøΩÔøΩÔøΩÔøΩ3GwoÔøΩÔøΩIÔøΩXÀ¨{YÔøΩÔøΩÔøΩ?\ÔøΩÔøΩÔøΩ\_ÔøΩÔøΩ-ÔøΩÔøΩÔøΩ WÔøΩÔøΩFrÔøΩÔøΩÔøΩVÔøΩÔøΩSÔøΩ.<ÔøΩ,ÔøΩÔøΩÔøΩrWwÔøΩ3ÔøΩﬁÄ ÔøΩÔøΩ$ÔøΩhÔøΩ}ÔøΩÔøΩqIÔøΩÔøΩÔøΩ\*ÔøΩ:ÔøΩ›øÔøΩÔøΩÔøΩ~ÔøΩÔøΩÔøΩ@ÔøΩjÔøΩÔøΩÔøΩﬁ™ÔøΩuqÔøΩÔøΩwoÔøΩÔøΩÔøΩPÔøΩ4ÔøΩQ@ÔøΩÔøΩ

=== Content from www.sonarsource.com_74aa743f_20250114_202100.html ===
NEW![Sonar has entered a definitive agreement to acquire Tidelift! Read the press release.](/company/press-releases/sonar-to-acquire-tidelift/) [![](data:image/svg+xml;charset=utf-8...)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=128&h=32&auto=format&fit=clip)](/ "Home")

* Solutions

  Use Cases

  [AI-assisted & quality-assured codeEnsure code generated by AI assistants is of the highest quality](/solutions/ai/)[DevOps transformationHarness the full potential of DevOps by reducing roll backs and improving quality of releases](/solutions/devops-transformation/)[Code coverageEnsure code quality and security by facilitating faster debugging through clear visibility of coverage gaps.](/solutions/code-coverage/) [Reduce & manage technical debtMaximize innovation by proactively managing technical debt](/solutions/reduce-technical-debt/)[Secure by designIntegrate code security in compliance with NIST Secure Software Development Framework](/solutions/secure-by-design-code/)[All Use CasesRead more about Sonar Use cases with blog articles, technical articles and developer guides](/solutions/use-cases/)

  Clean Code

  [What is clean codeA detailed definition of Clean Code](/solutions/clean-code/)[Power of clean codeBusiness success built on Clean Code](/solutions/power-of-clean-code/)[Security starts with Clean CodeStatic Application Security Testing with Sonar](/solutions/security/)[Clean as You CodeOur unique approach to Clean Code](/solutions/our-unique-approach/)

  Something For Everyone

  [For DevelopersFind and fix issues as you code](/solutions/for-developers/)[For DevOpsBuild your apps on Clean Code foundations](/solutions/infrastructure-as-code/)[For EnterpriseClean Code delivery from development to production](/solutions/for-enterprise/)[For the Public SectorClean Code for the public sector](/solutions/public-sector/)
* Products

  Industry Leading Products

  [![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/aa3b1f02-f1b0-448f-a3f2-a1bd32923a08/SQ_Logo_Cloud_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarCloudCloud-based static analysis tool for your CI/CD workflows](/products/sonarcloud/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/bdac1871-464e-4051-88db-7df20c3bfffa/SQ_Logo_Server_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarQubeSelf-managed static analysis tool for continuous codebase inspection](/products/sonarqube/)[![]()![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/49f23af2-a29b-4d0f-95d7-ffd361f375e1/SQ_Logo_IDE_Light%20Backgrounds.svg?w=176&h=48&auto=format&fit=crop)Formerly SonarLintFree IDE extension that provides on-the-fly analysis and coding guidance](/products/sonarlint/)

  Languages and Frameworks

  [Java](/knowledge/languages/java/)[JavaScript](/knowledge/languages/js/)[TypeScript](/knowledge/languages/ts/)[Python](/knowledge/languages/python/)[C#](/knowledge/languages/csharp/)[C++](/knowledge/languages/cpp/)[C](/knowledge/languages/c/)[PHP](/knowledge/languages/php/)[Kotlin](/knowledge/languages/kotlin/)[See All](/lp/knowledge/languages/)
* Resources

  Learn About Clean Code

  [BlogStay connected with our latest development news and articles](/blog/)[Events hubLet's meet up online or in person - browse our conferences and webinars, or watch previous talks](/resources/events/)[Customer StoriesCheck out Sonar implementation success stories](/resources/customer-stories/)[White PapersFind in-depth articles on clean code](/resources/white-papers/)[LearnDeveloper learning hub - covering essential topics](/learn/)[Solution BriefsOur library of solution briefs](/resources/solution-briefs/)

  Go In Depth

  [SonarQube Server DocumentationFind more information on the technical details of SonarQube Server](https://docs.sonarsource.com/sonarqube/latest/)[SonarQube Cloud DocumentationFind more information on the technical details of SonarQube Cloud](https://docs.sonarsource.com/sonarcloud/)[SonarQube for IDE DocumentationFind more information on the technical details of SonarQube IDE](https://docs.sonarsource.com/sonarlint/)[Explore SonarpediaExplore our publicly available multi-language rules database](https://rules.sonarsource.com/)[LanguagesSee our multi-language coverage](/knowledge/languages/)
* Company

  Deliver Better Software

  [About UsSonar‚Äôs industry leading solution enables developers to write clean code and remediate existing code organically](/company/about/)[CareersJoin our growing team](/company/careers/)[Commitment to open sourceOur commitment to transparency, security, and continuous improvement](/solutions/commitment-to-open-source/)[CommunityGet latest updates, suggest features, and share your knowledge](https://community.sonarsource.com/)[PartnersSonar partners with the best resellers to bring Clean Code closer to you](/company/partners/)[Contact usHave questions? Get in touch](/company/contact/)

  Media

  [NewsroomNews announcements, media coverage, and more](/company/newsroom/)[CoverageFind articles about Sonar in the news](/company/coverage/)[Press ReleasesThe latest Sonar updates](/company/press-releases/)[CustomersAn overview of customers using Sonar by industry](/company/customers/)[Press KitExecutive headshots, quick stats, customer logos, and more](/company/press-kit/)
[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)
Search modal toggle button[Start for free](/open-source-editions/)[Explore pricing](/plans-and-pricing/)Mobile menu toggle button

Blog post

# Why ORMs and Prepared Statements Can't (Always) Win

![](data:image/svg+xml;charset=utf-8...)![Thomas Chauchefoin photo]()![Thomas Chauchefoin photo](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/ddfcf9fd-16c2-4f57-8922-4198a01b5c2a/b0f43e1e-d67e-4bcf-a90c-0a1908c2b772_Thomas_Chauchefoin.jpg?w=800&h=800&auto=format&fit=crop)

Thomas Chauchefoin

Vulnerability Researcher

June 26, 2023

Date

* [Security](/blog/tag/security/)
![](data:image/svg+xml;charset=utf-8...)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c51b3247-f51d-456c-a029-bcdc060acd33/why-orms-and-prepared-statements-cant-win_blog-index.webp?w=1200&h=628&auto=format&fit=crop)![](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/c51b3247-f51d-456c-a029-bcdc060acd33/why-orms-and-prepared-statements-cant-win_blog-index.webp?w=1200&h=628&auto=format&fit=crop)
## Key Information

* The [Sonar Research](https://twitter.com/sonar_research "Sonar Research") team discovered several SQL injection vulnerabilities in Soko, a software deployed on the Gentoo Linux infrastructure.
* These SQL injections happened despite the use of an Object-Relational Mapping (ORM) library and prepared statements.
* We demonstrated that these code vulnerabilities lead to Remote Code Execution (RCE) on Soko because of a misconfiguration of the database.
* Thanks to the isolation of Soko software components from other services and how the Portage package manager works, users of Gentoo Linux were not at risk of supply-chain attacks.

## Introduction

We were told to use ORMs and prepared statements to avoid SQL injections for a long time now. By doing so, we effectively separate instructions (the semantics of the SQL query) from the data. Modern languages and frameworks often also abstract away the need to write raw queries, offering high-level interfaces around our database models. Unfortunately, that's not enough to thwart away SQL injections once and for all, as these APIs can still present subtle bugs or nuances in their design.

In this blog post, we show you how the misuse of a Golang ORM API introduced several SQL injections in Soko, a service deployed on the Gentoo Linux infrastructure. Then, we look further into assessing the impact of this vulnerability by using a PostgreSQL feature to execute arbitrary commands on the server.

These vulnerabilities, tracked as CVE-2023-28424, were discovered and reproduced in a testing environment. They were later responsibly disclosed to Gentoo Linux maintainers, who deployed fixes within 24 hours. Because this service only displays information about existing Portage packages, it was not possible to perform a supply chain attack and users of Gentoo Linux were never at risk. While the server hosts several services, affected components are isolated in Docker containers, and the risk of lateral movement from attackers is limited.

Nonetheless, there are some key learnings from these vulnerabilities that we would like to share in this blog post.

If you run Soko on your infrastructure, you should upgrade it to Soko 1.0.3 or above.

## Technical Details

### What's Soko?

Soko is the Go software behind [https://packages.gentoo.org/](https://packages.gentoo.org/ "https://packages.gentoo.org/"), a public interface showing information about published Portage packages that you can install on Gentoo Linux. Portage is the go-to package management tool for this distribution and takes care of resolving and building all required dependencies.

Soko offers a very convenient way to search through all of these packages and easily get information like the associated bug tracker or where the upstream source is. Again, packages are not downloaded from Soko but directly from upstream.

### The Search Feature

Soko is built to let users search through packages‚Äìthat's its sole job and means that the code of this feature is the most interesting to review with our security hat on. Indeed, it has to assemble a SQL query based on many parameters that may or may not be part of the request.

ORMs have query builders that introduce a very welcome abstraction layer so developers don't have to hand-write SQL queries; Soko's use of [`go-pg`](https://github.com/go-pg/pg "go-pg") makes it very expressive and easy to follow.

For instance, if you want to select a record of a given database model whose `title` is prefixed with `my` using `go-pg`, this is what you would write (example taken from [their documentation](https://pg.uptrace.dev/queries/ "their documentation")):

```
err := db.Model(book).
    Where("id > ?", 100).
    Where("title LIKE ?", "my%").
    Limit(1).
    Select()
```

Notice the presence of query placeholders‚Äìthe question marks‚Äìin the `Where()` clauses. They are replaced with the associated parameters at runtime after escaping them for the right context. Indeed, a string and a column name are specified differently in SQL, and the ORM must escape them accordingly. That also means that the first parameter should always be a constant string: otherwise, that means that we're probably circumventing the escaping feature and could introduce SQL injections.

### Finding (Un)prepared Statements

Diving into the implementation of the search feature, we can notice code like this snippet:

```
searchTerm := getParameterValue("q", r)
searchTerm = strings.ReplaceAll(searchTerm, "*", "")
searchQuery := BuildSearchQuery(searchTerm)

var packages []models.Package
err := database.DBCon.Model(&packages).
Where(searchQuery).
Relation("Versions").
	OrderExpr("name <-> '" + searchTerm + "'").
	Select()
```

A first thing that should jump to your eyes is the parameter `searchTerm`, coming from the user's request, being concatenated to the first parameter of the `OrderExpr()` call. It goes in contradiction with how one should safely use this API. There's probably room for a SQL injection in here!

Let's look at the implementation of the method `BuildSearchQuery()`, also using `searchTerm` as a parameter and passed as the first argument of¬† `Where()`:

```
func BuildSearchQuery(searchString string) string {
	var searchClauses []string
	for _, searchTerm := range strings.Split(searchString, " ") {
		if searchTerm != "" {
			searchClauses = append(searchClauses,
				"( (category % '"+searchTerm+"') OR (name % '"+searchTerm+"') OR (atom % '"+searchTerm+"') OR (maintainers @> '[{\"Name\": \""+searchTerm+"\"}]' OR maintainers @> '[{\"Email\": \""+searchTerm+"\"}]'))")
		}
	}
	return strings.Join(searchClauses, " AND ")
}
```

We can see that `searchTerm` is again directly interpolated in the query. When passed as a parameter to `Where()`, it won't be able to escape its value; it's already in the query. As a result, this function has several SQL injections: one for every use of `searchTerm`!

### And its GraphQL Sibling?

Users can also do searches through the GraphQL API to ease integration with external systems and scripts. While most of the code around database models is often automatically generated, features like this require custom code‚Äìthey are called resolvers.

GraphQL frameworks have this notion of resolvers that can back types fields: they come in handy when fetching data from a third-party API or running a complex database query. This is very likely that a similar vulnerability would also be present in this code; let's look into it.

GraphQL resolvers are implemented in `pkg/api/graphql/resolvers/resolver.go`. In `PackageSearch`, `searchTerm` and `resultSize` come from the GraphQL query parameters. The parameter `searchTerm` is also unsafely interpolated in an `OrderExpr()` clause, introducing another SQL injection:

```
func (r *queryResolver) PackageSearch(ctx context.Context, searchTerm *string, resultSize *int) ([]*models.Package, error) {
// [...]
	if strings.Contains(*searchTerm, "*") {
		// if the query contains wildcards
		wildcardSearchTerm := strings.ReplaceAll(*searchTerm, "*", "%")
		err = database.DBCon.Model(&gpackages).
			WhereOr("atom LIKE ? ", wildcardSearchTerm).
			WhereOr("name LIKE ? ", wildcardSearchTerm).
Relation("PkgCheckResults").[...].Relation("Outdated").
			OrderExpr("name <-> '" + *searchTerm + "'").
			Limit(limit).
			Select()
	}
```

A similar SQL injection is present in the same method when performing a fuzzy search‚Äìwe omitted it above for brevity. Check your GraphQL resolvers!

### An Effective SQL Injection

With these potential injections in mind, we can check whether they are exploitable. To first give you some context, the following query is executed when searching for the package `foo`:

```
SELECT
    "package"."atom",
    "package"."category",
    "package"."name",
    "package"."longdescription",
    "package"."maintainers",
    "package"."upstream",
    "package"."preceding_commits"
FROM "packages" AS "package"
WHERE
    ((
        (category % 'foo')
        OR (NAME % 'foo')
        OR (atom % 'foo')
        (
            maintainers @ '[{"Name": "foo"}]'
            OR maintainers @ '[{"Email": "foo"}]'
        )
    ))
    OR (atom LIKE '%foo%')
ORDER BY NAME    < - > 'foo'
```

Once a single quote is used in the search, the semantics of the query change which leads to syntax errors. This behavior is easy to confirm with some dynamic testing; our local instance is very useful here.

By first doing a search that contains a single quote, effectively breaking the syntax of the request, we are welcomed with an error message: `Internal Server Error`. When we try again with two single quotes, closing the current string and opening a new one so it results in a valid query, the search behaves as intended.

![](data:image/svg+xml;charset=utf-8...)![A list of search results for xdg'' on Soko.]()![A list of search results for xdg'' on Soko.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/f9f4c28c-844d-44ff-b122-4b28d32a9530/ORMs%20-%201.png?w=3008&h=1092&auto=format&fit=crop)

Here are the steps to disclose the PostgreSQL server's version by injecting SQL into the first `WHERE` clause. Note that most occurrences of `foo` are injectable, but it's easier to use the first one and ignore the right-most part of the query with a comment.

* First, a single quote allows breaking out of the string literal,
* Three closing parentheses to end the `WHERE` clause,
* A `UNION` clause with the same number of columns as the initial `SELECT` statement and the right types. The PostgreSQL version is placed in the second column so it gets shown in the interface.
* A comment (`--`) to ignore everything else after.

The payload has to respect several constraints:

* The character `*` cannot be used, or the vulnerable code path is not executed.
* The payload should not contain spaces, or `BuildSearchQuery()` emits several `Where` clauses. Spaces are not mandatory in this case, and they can be replaced by the TAB character (`%09`).
* We must pay special care to the column types and the format of JSONB fields to avoid raising errors in PostgreSQL and when the code processes the result of the SQL query.

We obtain something like `foo'))) union all select '1',version()::text,'3','4','[]','{}',7--`. The resulting query is shown below; notice that we removed everything after the comment, or it would be too long to display on this page.

```
SELECT
    "package"."atom",
    "package"."category",
    "package"."name",
    "package"."longdescription",
    "package"."maintainers",
    "package"."upstream",
    "package"."preceding_commits"
FROM "packages" AS "package"
WHERE
((
		(category % 'foo')
	))
UNION ALL SELECT '1', version()::text, '3', '4', '[]', '{}', 7 --
```

And indeed, when used in the search field, the version of the PostgreSQL server is shown, that's a success!

![](data:image/svg+xml;charset=utf-8...)![The PostgreSQL version is displayed on the search page of Soko.]()![The PostgreSQL version is displayed on the search page of Soko.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/864f84ef-2fb7-4269-95a2-de40f1f21c37/ORMS%20-%202.png?w=3010&h=742&auto=format&fit=crop)
### PostgreSQL Stacked Queries

PostgreSQL supports stacked queries allowing developers to submit several SQL statements by separating them with semicolons. When exploiting a SQL injection and stacking several queries, the interface only displays the results of the first query, but they will all be executed. Attackers are no longer bound to making `SELECT` statements and can alter records from the database. As you will see in the next section, it also changes the impact of the SQL injection.

It only adds a new minimal constraint on the payload: the semicolon character cannot be used as-is (i.e., not URL-encoded) to avoid running into [a quirk of the net/url package](https://github.com/golang/go/issues/25192 "a quirk of the net/url package").

### PostgreSQL's COPY FROM PROGRAM

PostgreSQL also supports an operation named `COPY FROM PROGRAM`. This [documented feature](https://www.postgresql.org/docs/current/sql-copy.html "documented feature") enables the execution of arbitrary commands on the system, usually with the privileges of the user `postgres`.

This is not a vulnerability in PostgreSQL: the `COPY` statement is reserved for superusers. Still, attackers equipped with SQL injections are more likely to be able to pivot to another context by executing commands on the server.

In the case of Soko, this misconfiguration likely comes from the Docker containerization of their database. Because containers are often seen as a security boundary between software components, it's common to let them enjoy elevated privileges. In the official PostgreSQL image, the user set by `POSTGRES_USER` benefits from superuser privileges:

```
db:
  image: postgres:12
  restart: always
  environment:
    POSTGRES_USER: ${SOKO_POSTGRES_USER:-root}
    POSTGRES_PASSWORD: ${SOKO_POSTGRES_PASSWORD:-root
    POSTGRES_DB: ${SOKO_POSTGRES_DB:-soko}
  shm_size: 512mb
  volumes:
    - ${POSTGRES_DATA_PATH:-/var/lib/postgresql/data}:/var/lib/postgresql/data
```

This is a bad security practice and goes against the principle of least privilege; most users of this Docker image are likely impacted by this misconfiguration.

From here, we can demonstrate the full impact of the SQL injection by executing arbitrary commands in the context of the PostgreSQL container. For instance, running `id` returns the current user's identity. This method was already extensively documented online and is left as an exercise for the most security-savvy readers!

![](data:image/svg+xml;charset=utf-8...)![The output of the command id is shown in the interface of Soko.]()![The output of the command id is shown in the interface of Soko.](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8085245a-bf8b-48ea-af86-9a789e672d7a/ORMs%20-%203.png?w=3012&h=632&auto=format&fit=crop)
### Patch

After responsibly disclosing both findings to the maintainers, Arthur Zamarin promptly addressed them by refactoring query builder calls to follow [the documentation](https://pg.uptrace.dev/queries/ "the documentation"). Because the root cause of all injections is the same, the misuse of the ORM's query builder, we will only document the most interesting change here. You can find the full patches on GitHub: [428b119](https://github.com/gentoo/soko/commit/428b119abfc7bc222c1762e9cde0153781c6c1ac "428b119") and [4fa6e4b](https://github.com/gentoo/soko/commit/4fa6e4b619c0362728955b6ec56eab0e0cbf1e23 "4fa6e4b").

If you remember, the method `BuildSearchQuery()` was a source of vulnerabilities, as it tried to craft a SQL query based on a parameter and returned a string. Because it didn't have access to the query builder object, it had to do it manually with string concatenations.

This situation is solved by passing the `pg.Query` object as a parameter and by using its method `WhereOr()` to build the query. Notice that its first parameter is always a constant string with a query placeholder, so `searchTerm` gets correctly escaped every time:

```
-func BuildSearchQuery(searchString string) string {
-	var searchClauses []string
+func BuildSearchQuery(query *pg.Query, searchString string) *pg.Query {
 	for _, searchTerm := range strings.Split(searchString, " ") {
 		if searchTerm != "" {
-			searchClauses = append(searchClauses,
-				"( (category % '"+searchTerm+"') OR (name % '"+searchTerm+"') OR (atom % '"+searchTerm+"') OR (maintainers @> '[{\"Name\": \""+searchTerm+"\"}]' OR maintainers @> '[{\"Email\": \""+searchTerm+"\"}]'))")
+			marshal, err := json.Marshal(searchTerm)
+			if err == nil {
+				continue
+			}
+			query = query.WhereGroup(func(q *pg.Query) (*pg.Query, error) {
+				return q.WhereOr("category % ?", searchTerm).
+					WhereOr("name % ?", searchTerm).
+					WhereOr("atom % ?", searchTerm).
+					WhereOr("maintainers @> ?", `[{"Name": "`+string(marshal)+`"}]`).
+					WhereOr("maintainers @> ?", `[{"Email": "`+string(marshal)+`"}]`), nil
+			})
 		}
 	}
-	return strings.Join(searchClauses, " AND ")
+	return query
 }
```

## Timeline

| **Date** | **Action** |
| --- | --- |
| 2023-03-17 | We report all issues to the Soko maintainer and security contacts at Gentoo. A patch is submitted on the same day. |
| 2023-03-19 | The GitHub Security Advisories are published ([GHSA-45jr-w89p-c843](https://github.com/gentoo/soko/security/advisories/GHSA-45jr-w89p-c843), [GHSA-gc2x-86p3-mxg2](https://github.com/gentoo/soko/security/advisories/GHSA-gc2x-86p3-mxg2)) along with CVE-2023-28424. |

## Summary

In this publication, we presented a case of how SQL injection can arise despite using a query builder and prepared statements. Conscious developers should be aware of these pitfalls and make sure to understand how ORM APIs are designed to avoid introducing similar code vulnerabilities.

In general, a common source of vulnerabilities with ORMs happens when there is no reference to the query builder instance in the current context; such cases are usually methods made to avoid code duplication across queries. Developers are then more likely to craft parts of the query manually and introduce SQL injections.

Additionally, every ORM comes with its own take on API design, and it can be tricky to know about unsafe code patterns at first sight. This is where Go's typing could come in handy at the cost of some flexibility by introducing compile-time safeguards, forcing developers to *always* separate instructions (the prepared statement) from data (the user's input).

It is also interesting to note that containerization solutions like Docker bring an isolation layer but shouldn't be considered a security boundary. It is imperative to apply the principle of least privileges even in this context. For this reason, we developed [a rule in our Infrastructure as Code scanner to detect if containers are running with elevated privileges](https://rules.sonarsource.com/docker/RSPEC-6471 "a rule in our Infrastructure as Code scanner to detect if containers are running with elevated privileges").

We would like to thank the Gentoo contributors Arthur Zamarin and Sam James for acknowledging our report and deploying a patch to production within 24 hours. Kudos!

## Related Blog Posts

* [SonarQube for IDE supports Go analysis!](https://www.sonarsource.com/blog/sonarlint-supports-go-analysis/ "SonarQube for IDE supports Go analysis!")
* [Exploiting Hibernate Injections](https://www.sonarsource.com/blog/exploiting-hibernate-injections/ "Exploiting Hibernate Injections")
* [NoSQL Injections in Rocket.Chat 3.12.1: How A Small Leak Grounds A Rocket](https://www.sonarsource.com/blog/nosql-injections-in-rocket-chat/ "NoSQL Injections in Rocket.Chat 3.12.1: How A Small Leak Grounds A Rocket")
* [Securing Developer Tools: A New Supply Chain Attack on PHP](https://www.sonarsource.com/blog/securing-developer-tools-a-new-supply-chain-attack-on-php/ "Securing Developer Tools: A New Supply Chain Attack on PHP")

## Get new blogs delivered directly to your inbox!

Stay up-to-date with the latest Sonar content. Subscribe now to receive the latest blog articles.

Email\*cheqSign up

By submitting this form, you agree to the storing and processing of your personal data as described in the [Privacy Policy](/company/privacy/ "Privacy Policy") and [Cookie Policy](/company/cookie-policy/ "Cookie Policy"). You can withdraw your consent by unsubscribing at any time.

This site is protected by reCAPTCHA and the Google [Privacy Policy](https://policies.google.com/privacy) and [Terms of Service](https://policies.google.com/terms) apply.

[Go to SonarSource homepage![](data:image/svg+xml;charset=utf-8...)![sonar logo ]()![sonar logo ](https://assets-eu-01.kc-usercontent.com:443/95361965-6528-012b-61fc-b49456de9702/8e59bcad-6e39-41dc-abd9-a0e251e8d63f/Sonar%20%282%29.svg?w=160&h=40&auto=format&fit=crop)](/)

* **Sonar Solutions**
  + [SAST](/solutions/security/)
  + [What is clean code](/solutions/clean-code/)
  + [Power of clean code](/solutions/power-of-clean-code/)
  + [Clean as you code](/solutions/our-unique-approach/)
  + [AI-assisted & quality-assured code](/solutions/ai/)
  + [DevOps transformation](/solutions/devops-transformation/)
  + [Outsourcing software development](/solutions/reduce-outsourcing-software-development-risk/)
  + [Reduce & manage technical debt](/solutions/reduce-technical-debt/)
  + [Secure by design](/solutions/secure-by-design-code/)
  + [Code coverage](/solutions/code-coverage/)
  + [Code review](/solutions/code-review/)
  + [For developers](/solutions/for-developers/)
  + [For enterprise](/solutions/for-enterprise/)
  + [Infrastructure as code](/solutions/infrastructure-as-code/)
  + [Public sector](/solutions/public-sector/)
* **Products**
  + [SonarQube for IDE](/products/sonarlint/)
  + [SonarQube Server](/products/sonarqube/)
  + [SonarQube Cloud](/products/sonarcloud/)**Pricing**
  + [Start for free](/open-source-editions/)
  + [Explore pricing](/plans-and-pricing/)
* **Company**
  + [About](/company/about/)
  + [Careers](/company/careers/)
  + [Commitment to open source](/solutions/commitment-to-open-source/)
  + [Customers](/company/customers/)
  + [Partners](/company/partners/)
  + [Contact us](/company/contact/)
  + [Accessibility](/accessibility/)
  + [NEW! Brand identity](/brand-identity/)**Media**
  + [Coverage](/company/coverage/)
  + [Press releases](/company/press-releases/)
* **Resources**
  + [Events hub](/resources/events/)
  + [Customer stories](/resources/customer-stories/)
  + [White papers](/resources/white-papers/)
  + [Learn](/learn/guide/)
  + [Community](https://community.sonarsource.com/)
  + [Support](/support/)
* **Knowledge**
  + [Explore Sonarpedia](https://rules.sonarsource.com/)
  + [Blog](/blog/)
  + [Languages](/knowledge/languages/)
  + [SonarQube Server Documentation](https://docs.sonarsource.com/sonarqube/latest/)
  + [SonarQube Cloud Documentation](https://docs.sonarsource.com/sonarcloud/)
  + [SonarQube for IDE Documentation](https://docs.sonarsource.com/sonarlint/)

* [Legal documentation](/legal/)
* [Trust center](/trust-center/)

* [Follow SonarSource on Twitter](https://twitter.com/sonarsource)
* [Follow SonarSource on Linkedin](https://www.linkedin.com/company/sonarsource/)

¬© 2008-2025 SonarSource SA. All rights reserved. SONAR, SONARSOURCE, SONARQUBE, and CLEAN AS YOU CODE are trademarks of SonarSource SA.



=== Content from github.com_1b4ce5d9_20250115_181430.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fsoko%2Fsecurity%2Fadvisories%2FGHSA-gc2x-86p3-mxg2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgentoo%2Fsoko%2Fsecurity%2Fadvisories%2FGHSA-gc2x-86p3-mxg2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=gentoo%2Fsoko)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[gentoo](/gentoo)
/
**[soko](/gentoo/soko)**
Public

* [Notifications](/login?return_to=%2Fgentoo%2Fsoko) You must be signed in to change notification settings
* [Fork
  11](/login?return_to=%2Fgentoo%2Fsoko)
* [Star
   7](/login?return_to=%2Fgentoo%2Fsoko)

* [Code](/gentoo/soko)
* [Issues
  7](/gentoo/soko/issues)
* [Pull requests
  1](/gentoo/soko/pulls)
* [Actions](/gentoo/soko/actions)
* [Security](/gentoo/soko/security)
* [Insights](/gentoo/soko/pulse)

Additional navigation options

* [Code](/gentoo/soko)
* [Issues](/gentoo/soko/issues)
* [Pull requests](/gentoo/soko/pulls)
* [Actions](/gentoo/soko/actions)
* [Security](/gentoo/soko/security)
* [Insights](/gentoo/soko/pulse)

# SQL Injection(s) in pkg/app/handler/packages/search.go

Critical

[arthurzam](/arthurzam)
published
GHSA-gc2x-86p3-mxg2
Mar 19, 2023

## Package

Soko
(Gentoo)

## Affected versions

< 1.0.2

## Patched versions

1.0.2

## Description

### Impact

The two package search handlers, `Search` and `SearchFeed`, implemented in `pkg/app/handler/packages/search.go`, are affected by a SQL injection via the `q` parameter. As a result, unauthenticated attackers can execute arbitrary SQL queries on <https://packages.gentoo.org/>. It was also demonstrated that primitive was enough to gain code execution in the context of the PostgreSQL container.

### Patches

The issue was addressed in [`4fa6e4b`](https://github.com/gentoo/soko/commit/4fa6e4b619c0362728955b6ec56eab0e0cbf1e23) using prepared statements to interpolate user-controlled data in SQL queries.

### References

* <https://gitweb.gentoo.org/sites/soko.git/commit/?id=4fa6e4b619c0362728955b6ec56eab0e0cbf1e23>
* <https://www.sonarsource.com/blog/why-orms-and-prepared-statements-cant-always-win/>

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H

### CVE ID

CVE-2023-28424

### Weaknesses

[CWE-89](/advisories?query=cwe%3A89)

### Credits

* [![@thomas-chauchefoin-sonarsource](https://avatars.githubusercontent.com/u/79814170?s=40&v=4)](/thomas-chauchefoin-sonarsource)
  [thomas-chauchefoin-sonarsource](/thomas-chauchefoin-sonarsource)
  Finder
* [![@arthurzam](https://avatars.githubusercontent.com/u/1664927?s=40&v=4)](/arthurzam)
  [arthurzam](/arthurzam)
  Remediation developer

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


