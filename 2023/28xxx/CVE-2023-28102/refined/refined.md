Based on the provided information, here's a breakdown of the vulnerability:

**Root Cause:**

*   The `encode_file` method in the `discordrb` library constructs a shell command string using the `file` parameter without proper sanitization. This allows for command injection if the `file` parameter contains malicious shell commands.

**Weaknesses/Vulnerabilities:**

*   **Command Injection:** The primary vulnerability is the unsafe construction of a shell command string using user-provided input. Specifically, the `file` parameter of the `encode_file` method is directly embedded into the shell command.
*   **Unsafe use of `IO.popen`:** The `IO.popen` method is used to execute the constructed command string, which makes it vulnerable to command injection attacks.

**Impact of Exploitation:**

*   **Remote Code Execution (RCE):** Successful exploitation allows an attacker to execute arbitrary shell commands on the host machine where the vulnerable code is running.

**Attack Vectors:**

*   The vulnerability is exposed through the `encode_file` method.
*   An attacker needs to control the `file` parameter passed to the `encode_file` method.

**Required Attacker Capabilities/Position:**

*   The attacker needs to find a way to control the input to the `encode_file` function in a client application using the vulnerable library. This is not a vulnerability within the library itself.
*   The attacker needs to be able to pass a crafted string as a file argument.

**Additional Notes:**

*   The provided code diff shows that the vulnerability was fixed by changing the way the command is constructed from a string to an array, which is passed to IO.popen.
*   The vulnerability is not directly exploitable in the library itself, but requires the library to be used in a vulnerable manner within a client application.
*   The provided proof-of-concept (PoC) demonstrates how an attacker can execute arbitrary commands by injecting them into the `file` parameter.
*  The fix commit switched from `IO.popen(command)` to using `IO.popen(command, in: io)`.  The command variable changed from a string to an array. The commit also changed `def ffmpeg_command` to `def ffmpeg_command(input: '-', options: null)`.