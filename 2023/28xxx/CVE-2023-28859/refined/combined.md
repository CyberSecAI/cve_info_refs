=== Content from github.com_975d9e5e_20250114_190557.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2666)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2666)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=redis%2Fredis-py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[redis](/redis)
/
**[redis-py](/redis/redis-py)**
Public

* [Notifications](/login?return_to=%2Fredis%2Fredis-py) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fredis%2Fredis-py)
* [Star
   12.8k](/login?return_to=%2Fredis%2Fredis-py)

* [Code](/redis/redis-py)
* [Issues
  206](/redis/redis-py/issues)
* [Pull requests
  72](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects
  0](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

Additional navigation options

* [Code](/redis/redis-py)
* [Issues](/redis/redis-py/issues)
* [Pull requests](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fredis%2Fredis-py%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fredis%2Fredis-py%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fixing cancelled async futures #2666

 Merged

[chayim](/chayim)
merged 18 commits into
[redis:master](/redis/redis-py/tree/master "redis/redis-py:master")
from
[chayim:ck-dh-asyncalls](/chayim/redis-py/tree/ck-dh-asyncalls "chayim/redis-py:ck-dh-asyncalls")

Mar 29, 2023

 Merged

# [Fixing cancelled async futures](#top) #2666

[chayim](/chayim)
merged 18 commits into
[redis:master](/redis/redis-py/tree/master "redis/redis-py:master")
from
[chayim:ck-dh-asyncalls](/chayim/redis-py/tree/ck-dh-asyncalls "chayim/redis-py:ck-dh-asyncalls")

Mar 29, 2023

[Conversation
21](/redis/redis-py/pull/2666)
[Commits
18](/redis/redis-py/pull/2666/commits)
[Checks
0](/redis/redis-py/pull/2666/checks)
[Files changed](/redis/redis-py/pull/2666/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![chayim](https://avatars.githubusercontent.com/u/1333958?s=60&v=4)](/chayim)

Copy link

Contributor

### @chayim **[chayim](/chayim)** commented [Mar 26, 2023](#issue-1640922616)

The following pull request contains changes to Async cancelling. Specifically, all cases where a command is sent to redis, via execute\_command (and friends), and now wrapped with a shield. This builds on the helpful proxy provided in [#2665](https://github.com/redis/redis-py/issues/2665).

This change covers the following usage patterns.

* Async
* Async pipeline
* Async pubsub
* Async sentinel
* Async cluster
* Async cluster pipelines

Reproducible tests currently exist for async, async pipeline, and async cluster. But note - the async cluster pipeline seems at best incorrect.

Feedback and changes are very much welcomed. Bonus points for assistance with testing,

Sorry, something went wrong.

All reactions

 [dvora-h](/dvora-h)
and others
added 4 commits
[March 26, 2023 12:45](#commits-pushed-a3a9a73)

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)

`[try to fix](/redis/redis-py/pull/2666/commits/a3a9a73398b6f585d7bf97d3d02c5aaf44221886 "try to fix")`

`[a3a9a73](/redis/redis-py/pull/2666/commits/a3a9a73398b6f585d7bf97d3d02c5aaf44221886)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[starting testing](/redis/redis-py/pull/2666/commits/0cf8aaeb6fc3fcac001938e3178cfa320c7a3f7d "starting testing")`

`[0cf8aae](/redis/redis-py/pull/2666/commits/0cf8aaeb6fc3fcac001938e3178cfa320c7a3f7d)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[pipeline](/redis/redis-py/pull/2666/commits/4163e8595d9da50e78b35ddeaeed272c64be3f38 "pipeline")`

`[4163e85](/redis/redis-py/pull/2666/commits/4163e8595d9da50e78b35ddeaeed272c64be3f38)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[partial fix](/redis/redis-py/pull/2666/commits/20893a4710a29a2372a9eef6e5b27b7e1dd1d40a "partial fix")`

`[20893a4](/redis/redis-py/pull/2666/commits/20893a4710a29a2372a9eef6e5b27b7e1dd1d40a)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
added
[bug](/redis/redis-py/labels/bug)
Bug
[experimental](/redis/redis-py/labels/experimental)
labels
[Mar 26, 2023](#event-8847293326)

[![jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=60&v=4)](/jamestiotio)

**[jamestiotio](/jamestiotio)**
reviewed
[Mar 26, 2023](#pullrequestreview-1358039465)

 [View reviewed changes](/redis/redis-py/pull/2666/files/20893a4710a29a2372a9eef6e5b27b7e1dd1d40a)

[tests/test\_asyncio/test\_cwe\_404.py](/redis/redis-py/pull/2666/files/20893a4710a29a2372a9eef6e5b27b7e1dd1d40a#diff-a90c3a19dad7803c9726358f223a3b7b8fb23ccb1d573d580d6640f04fdd3f27)
Outdated

Show resolved

Hide resolved

 [chayim](/chayim)
and others
added 3 commits
[March 27, 2023 08:47](#commits-pushed-38f7957)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&v=4)](/jamestiotio)

`[Update tests/test_asyncio/test_cwe_404.py](/redis/redis-py/pull/2666/commits/38f795764df36b30e4bfdc427f5ae47daca28b2a "Update tests/test_asyncio/test_cwe_404.py

Co-authored-by: James R T <jamestiotio@gmail.com>")`
 …

`[38f7957](/redis/redis-py/pull/2666/commits/38f795764df36b30e4bfdc427f5ae47daca28b2a)`

```
Co-authored-by: James R T <jamestiotio@gmail.com>
```

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[fail-fast false](/redis/redis-py/pull/2666/commits/e54d3bba77700f9e433fb365901d49af849794a0 "fail-fast false")`

`[e54d3bb](/redis/redis-py/pull/2666/commits/e54d3bba77700f9e433fb365901d49af849794a0)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[syntax](/redis/redis-py/pull/2666/commits/b9e92f0d23b198b23218570712621174555e28b6 "syntax")`

`[b9e92f0](/redis/redis-py/pull/2666/commits/b9e92f0d23b198b23218570712621174555e28b6)`

[![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=80&u=b7ee84d82e25b493051d810390e97b15f716d7ef&v=4)](/codecov-commenter)

Copy link

### **[codecov-commenter](/codecov-commenter)** commented [Mar 27, 2023](#issuecomment-1484660295) • edited Loading

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) Report Patch coverage: **`94.55`**% and project coverage change: **`+0.04`** 🎉  Comparison is base [(`326bb1c`)](https://codecov.io/gh/redis/redis-py/commit/326bb1cf156279919101cc88a696d6cfcd9f3fe9?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) 92.25% compared to head [(`bb65a25`)](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) 92.29%.  📣 This organization is not using Codecov’s [GitHub App Integration](https://github.com/apps/codecov). We recommend you install it so Codecov can continue to function properly for your repositories. [Learn more](https://about.codecov.io/blog/codecov-is-updating-its-github-integration/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) Additional details and impacted files ``` @@            Coverage Diff             @@ ##           master    #2666      +/-   ## ========================================== + Coverage   92.25%   92.29%   +0.04%      ==========================================   Files         115      116       +1        Lines       29788    29893     +105      ========================================== + Hits        27481    27590     +109      + Misses       2307     2303       -4      ```  | [Impacted Files](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) | Coverage Δ |  | | --- | --- | --- | | [tests/test\_asyncio/test\_cluster.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfY2x1c3Rlci5weQ==) | `97.48% <ø> (+0.10%)` | ⬆️ | | [tests/test\_asyncio/test\_connection.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfY29ubmVjdGlvbi5weQ==) | `98.06% <ø> (+1.00%)` | ⬆️ | | [redis/asyncio/cluster.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-cmVkaXMvYXN5bmNpby9jbHVzdGVyLnB5) | `91.82% <81.81%> (+0.40%)` | ⬆️ | | [redis/asyncio/client.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-cmVkaXMvYXN5bmNpby9jbGllbnQucHk=) | `92.34% <92.10%> (-0.64%)` | ⬇️ | | [tests/test\_asyncio/test\_cwe\_404.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfY3dlXzQwNC5weQ==) | `96.90% <96.90%> (ø)` |  | | [tests/test\_asyncio/test\_pubsub.py](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfcHVic3ViLnB5) | `99.06% <100.00%> (-0.16%)` | ⬇️ |   ... and [3 files with indirect coverage changes](https://codecov.io/gh/redis/redis-py/pull/2666/indirect-changes?src=pr&el=tree-more&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis)  Help us with your feedback. Take ten seconds to tell us [how you rate us](https://about.codecov.io/nps?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). Have a feature suggestion? [Share it here.](https://app.codecov.io/gh/feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis)  [☔ View full report in Codecov by Sentry](https://codecov.io/gh/redis/redis-py/pull/2666?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). 📢 Do you have feedback about the report comment? [Let us know in this issue](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). |

All reactions

Sorry, something went wrong.

[![sileht](https://avatars.githubusercontent.com/u/200878?s=60&v=4)](/sileht)

**[sileht](/sileht)**
reviewed
[Mar 27, 2023](#pullrequestreview-1358720424)

 [View reviewed changes](/redis/redis-py/pull/2666/files/b9e92f0d23b198b23218570712621174555e28b6)

[.github/workflows/integration.yaml](/redis/redis-py/pull/2666/files/b9e92f0d23b198b23218570712621174555e28b6#diff-8eddb0045a2f69770230f0d41ff383cd2a7b040efe2881330606b787d97f48ef)

Show resolved

Hide resolved

 [chayim](/chayim)
added 2 commits
[March 27, 2023 16:24](#commits-pushed-f373962)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[con reconnect in one state](/redis/redis-py/pull/2666/commits/f3739629f4f1d3f9c009c172e18850ac16383c62 "con reconnect in one state")`

`[f373962](/redis/redis-py/pull/2666/commits/f3739629f4f1d3f9c009c172e18850ac16383c62)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[moved the shield](/redis/redis-py/pull/2666/commits/e4854de7f5c335b0000f2b79901bf600118a1468 "moved the shield")`

`[e4854de](/redis/redis-py/pull/2666/commits/e4854de7f5c335b0000f2b79901bf600118a1468)`

[![fps7806](https://avatars.githubusercontent.com/u/7218057?s=60&v=4)](/fps7806)

**[fps7806](/fps7806)**
reviewed
[Mar 27, 2023](#pullrequestreview-1359247099)

 [View reviewed changes](/redis/redis-py/pull/2666/files/e4854de7f5c335b0000f2b79901bf600118a1468)

[redis/asyncio/client.py](/redis/redis-py/pull/2666/files/e4854de7f5c335b0000f2b79901bf600118a1468#diff-46904a04a307aa876e0c135549e1ac744aed3c44a127cab584ed99dcc272670a)
Outdated

Show resolved

Hide resolved

[redis/asyncio/client.py](/redis/redis-py/pull/2666/files/e4854de7f5c335b0000f2b79901bf600118a1468#diff-46904a04a307aa876e0c135549e1ac744aed3c44a127cab584ed99dcc272670a)
Outdated

Show resolved

Hide resolved

[![sileht](https://avatars.githubusercontent.com/u/200878?s=60&v=4)](/sileht)

**[sileht](/sileht)**
reviewed
[Mar 28, 2023](#pullrequestreview-1360327441)

 [View reviewed changes](/redis/redis-py/pull/2666/files/e4854de7f5c335b0000f2b79901bf600118a1468)

Copy link

Contributor

### @sileht **[sileht](/sileht)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Even in theory, this change should fix the issue. asyncio.CancelledError may never reaches this redispy code due to this bug: [aio-libs/async-timeout#229](https://github.com/aio-libs/async-timeout/issues/229).

Sorry, something went wrong.

All reactions

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=80&v=4)](/chayim)

Copy link

Contributor

Author

### **[chayim](/chayim)** commented [Mar 28, 2023](#issuecomment-1486367902)

| [@fps7806](https://github.com/fps7806) [@sileht](https://github.com/sileht) I saw that when doing some research on this a couple of days back. That's what lead down some of the paths.  IMHO the right thing to do on the security side - is this series of changes. Yes, this can lead to the side affect of a true connection issue, if the connection has been cancelled. I think, looking at that we can safely say that the use of the client should handle that, as opposed to the client.  We're going to have a look at some try/catch work here. If try/catch within the shield triggers properly - I think we're good for release.  Targeting tomorrow. |
| --- |

All reactions

Sorry, something went wrong.

 [chayim](/chayim)
and others
added 4 commits
[March 28, 2023 10:41](#commits-pushed-6a92da7)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[linter fix](/redis/redis-py/pull/2666/commits/6a92da78d5459d202ff3f957c7af421b133795d0 "linter fix")`

`[6a92da7](/redis/redis-py/pull/2666/commits/6a92da78d5459d202ff3f957c7af421b133795d0)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[Merge branch 'master' into ck-dh-asyncalls](/redis/redis-py/pull/2666/commits/715fd8d9acdc6f03fead7e94506097185956d800 "Merge branch 'master' into ck-dh-asyncalls")`

`[715fd8d](/redis/redis-py/pull/2666/commits/715fd8d9acdc6f03fead7e94506097185956d800)`

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)

`[move try-except inside the asyncio.shield](/redis/redis-py/pull/2666/commits/7744dc6c5d385472d0806c5ad5b3de97c007bef5 "move try-except inside the asyncio.shield")`

`[7744dc6](/redis/redis-py/pull/2666/commits/7744dc6c5d385472d0806c5ad5b3de97c007bef5)`

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)

`[fix pipeline](/redis/redis-py/pull/2666/commits/7f820521ea672c6593a6b5266fdde5b8290f37ca "fix pipeline")`

`[7f82052](/redis/redis-py/pull/2666/commits/7f820521ea672c6593a6b5266fdde5b8290f37ca)`

[![fps7806](https://avatars.githubusercontent.com/u/7218057?s=60&v=4)](/fps7806)

**[fps7806](/fps7806)**
reviewed
[Mar 28, 2023](#pullrequestreview-1361194480)

 [View reviewed changes](/redis/redis-py/pull/2666/files/7f820521ea672c6593a6b5266fdde5b8290f37ca)

[redis/asyncio/client.py](/redis/redis-py/pull/2666/files/7f820521ea672c6593a6b5266fdde5b8290f37ca#diff-46904a04a307aa876e0c135549e1ac744aed3c44a127cab584ed99dcc272670a)

Show resolved

Hide resolved

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=80&v=4)](/chayim)

Copy link

Contributor

Author

### **[chayim](/chayim)** commented [Mar 28, 2023](#issuecomment-1487106034)

| Relevent: [python/cpython#28149](https://github.com/python/cpython/pull/28149) |
| --- |

All reactions

Sorry, something went wrong.

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[catching, handling, and validating the error](/redis/redis-py/pull/2666/commits/f89c0a7fa5e5941e15e8be8b23ee0ee367639929 "catching, handling, and validating the error")`

`[f89c0a7](/redis/redis-py/pull/2666/commits/f89c0a7fa5e5941e15e8be8b23ee0ee367639929)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=80&v=4)](/chayim)

Copy link

Contributor

Author

### **[chayim](/chayim)** commented [Mar 28, 2023](#issuecomment-1487453796)

| Taking a final look at things.. it appears the *best* way to solve this, it to properly break the pipeline, when this timing issue occurs. In breaking the pipeline *only* in this case a RuntimeError is raised.  This exception is ultimately raised from below, at least in the specific asyncio/streams code: /usr/lib/python3.10/asyncio/streams.py:616.  As a result, the shield needs to catch the RuntimeError - exception, and we can trigger the pipeline reset. This is necessary because the CancelledError, as alluded to previously, doesn't trigger - though should.  Our choices are either to:   1. Raise the RuntimeError , and leave it up to the user. This strikes me as inelligant. 2. Catch it (as done here). In this case the pipeline will reset properly, and return a None.   This final change, has that in it. |
| --- |

All reactions

Sorry, something went wrong.

[![fps7806](https://avatars.githubusercontent.com/u/7218057?s=60&v=4)](/fps7806)

**[fps7806](/fps7806)**
reviewed
[Mar 28, 2023](#pullrequestreview-1361883561)

 [View reviewed changes](/redis/redis-py/pull/2666/files/f89c0a7fa5e5941e15e8be8b23ee0ee367639929)

[redis/asyncio/client.py](/redis/redis-py/pull/2666/files/f89c0a7fa5e5941e15e8be8b23ee0ee367639929#diff-46904a04a307aa876e0c135549e1ac744aed3c44a127cab584ed99dcc272670a)

Show resolved

Hide resolved

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)
[dvora-h](/dvora-h)
mentioned this pull request
[Mar 28, 2023](#ref-pullrequest-1632098647)

[Fix UDS in v4.5.2: UnixDomainSocketConnection missing constructor argument
#2630](/redis/redis-py/pull/2630)
 Merged

6 tasks

 [chayim](/chayim)
added 3 commits
[March 29, 2023 10:10](#commits-pushed-9516f21)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[skip specific test on python 3.7](/redis/redis-py/pull/2666/commits/9516f2122e84c0c46ac156fde9017d9b8a769743 "skip specific test on python 3.7")`

`[9516f21](/redis/redis-py/pull/2666/commits/9516f2122e84c0c46ac156fde9017d9b8a769743)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[except and the finally](/redis/redis-py/pull/2666/commits/e0517a8aec407b53af0a155460ccb3ce05715c0f "except and the finally")`

`[e0517a8](/redis/redis-py/pull/2666/commits/e0517a8aec407b53af0a155460ccb3ce05715c0f)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[tagging tests appropriately](/redis/redis-py/pull/2666/commits/ceda6ac73e6fe504a2f629f8a1df7c08b93b33a5 "tagging tests appropriately")`

`[ceda6ac](/redis/redis-py/pull/2666/commits/ceda6ac73e6fe504a2f629f8a1df7c08b93b33a5)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=80&v=4)](/chayim)

Copy link

Contributor

Author

### **[chayim](/chayim)** commented [Mar 29, 2023](#issuecomment-1488149565)

| Failures are the result of [#2670](https://github.com/redis/redis-py/issues/2670) and unrelated. |
| --- |

All reactions

Sorry, something went wrong.

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[awaits ho](/redis/redis-py/pull/2666/commits/bb65a25d6d38d7f71111679ffd50a4d40b7816a3 "awaits ho")`

`[bb65a25](/redis/redis-py/pull/2666/commits/bb65a25d6d38d7f71111679ffd50a4d40b7816a3)`

[![dvora-h](https://avatars.githubusercontent.com/u/67596500?s=60&v=4)](/dvora-h)

**[dvora-h](/dvora-h)**
approved these changes
[Mar 29, 2023](#pullrequestreview-1362517699)

 [View reviewed changes](/redis/redis-py/pull/2666/files/bb65a25d6d38d7f71111679ffd50a4d40b7816a3)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
merged commit [`5acbde3`](/redis/redis-py/commit/5acbde355058ab7d9c2f95bcef3993ab4134e342)
into
redis:master

[Mar 29, 2023](https://github.com/redis/redis-py/pull/2666#event-8873755564)

[dvora-h](/dvora-h)
added a commit
that referenced
this pull request
[Mar 29, 2023](#ref-commit-af2ca45)
[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&u=7c66b0d3054a0a780678e3059efb0e2f07cc5059&v=4)](/jamestiotio) [![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)

`[Fixing cancelled async futures (](/redis/redis-py/commit/af2ca450c7b348b39a22b3e20dab05a20e2d75e6 "Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>")[#2666](https://github.com/redis/redis-py/pull/2666)[)](/redis/redis-py/commit/af2ca450c7b348b39a22b3e20dab05a20e2d75e6 "Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>")`
…

`[af2ca45](/redis/redis-py/commit/af2ca450c7b348b39a22b3e20dab05a20e2d75e6)`

```
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
```

[dvora-h](/dvora-h)
added a commit
that referenced
this pull request
[Mar 29, 2023](#ref-commit-6cd5173)
[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&u=7c66b0d3054a0a780678e3059efb0e2f07cc5059&v=4)](/jamestiotio) [![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h)

`[Fixing cancelled async futures (](/redis/redis-py/commit/6cd5173b29f80adfefa7c6350bdd8cd6c98ac94f "Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>")[#2666](https://github.com/redis/redis-py/pull/2666)[)](/redis/redis-py/commit/6cd5173b29f80adfefa7c6350bdd8cd6c98ac94f "Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>")`
…

`[6cd5173](/redis/redis-py/commit/6cd5173b29f80adfefa7c6350bdd8cd6c98ac94f)`

```
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
```

[dvora-h](/dvora-h)
added a commit
that referenced
this pull request
[Mar 29, 2023](#ref-commit-49d9cb7)
[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h) [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&u=7c66b0d3054a0a780678e3059efb0e2f07cc5059&v=4)](/jamestiotio)

`[Version 4.4.4 (](/redis/redis-py/commit/49d9cb751c7c30546fc86d11f8168d7aa007edae "Version 4.4.4 (#2671)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.4.4

* fix  tests

* linters

* fixing the test for the 4.4 state

* remove superfluous try-except

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>")[#2671](https://github.com/redis/redis-py/pull/2671)[)](/redis/redis-py/commit/49d9cb751c7c30546fc86d11f8168d7aa007edae "Version 4.4.4 (#2671)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.4.4

* fix  tests

* linters

* fixing the test for the 4.4 state

* remove superfluous try-except

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>")`
…

`[49d9cb7](/redis/redis-py/commit/49d9cb751c7c30546fc86d11f8168d7aa007edae)`

```
* Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.4.4

* fix  tests

* linters

* fixing the test for the 4.4 state

* remove superfluous try-except

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
```

[![@risicle](https://avatars.githubusercontent.com/u/807447?s=80&v=4)](/risicle)

Copy link

### **[risicle](/risicle)** commented [Mar 31, 2023](#issuecomment-1492663160) • edited Loading

| ❤️ for the backports, folks.  (Oh, I see 4.3.7 has been tagged but not released yet) |
| --- |

All reactions

Sorry, something went wrong.

[![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=40&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur)
[kristjanvalur](/kristjanvalur)
mentioned this pull request
[Apr 3, 2023](#ref-pullrequest-1492929880)

[Revert #2104, provide way to disable disconnects in `read_response()`
#2506](/redis/redis-py/pull/2506)
 Closed

6 tasks

[![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=80&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur)

Copy link

Contributor

### **[kristjanvalur](/kristjanvalur)** commented [Apr 3, 2023](#issuecomment-1495099760)

| This change makes it impossible to cancel a command and retry, because the cancellation never happens and the single connection lock is held indefinetly. So, the unit-tests I devised for pr [#2506](https://github.com/redis/redis-py/pull/2506) no longer work.  Is this really intentional? Not to cancel operation at all? Is there a tl/dr somewhere on why this is desirable? |
| --- |

All reactions

Sorry, something went wrong.

[![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=80&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur)

Copy link

Contributor

### **[kristjanvalur](/kristjanvalur)** commented [Apr 4, 2023](#issuecomment-1495566753)

| Anyone reading the code will be clueless. "Wait, it is creating a new `Task` for each operation? That adds latency. and then shielding it? Whatever for?" Even the unit tests have no comments on them on what specifically they are trying to fix. |
| --- |

All reactions

Sorry, something went wrong.

[![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=80&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur)

Copy link

Contributor

### **[kristjanvalur](/kristjanvalur)** commented [Apr 4, 2023](#issuecomment-1495594072) • edited Loading

| This testing code now breaks:  ```         ready = asyncio.Event()          async def helper():             with pytest.raises(asyncio.CancelledError):                 # blocking pop                 ready.set()                 await r.brpop(["nonexist"])              # if all is well, we can continue.  The following should not hang.     # DEADLOCK, here:             await r.set("status", "down")          task = asyncio.create_task(helper())         await ready.wait()         await asyncio.sleep(0.01)         # the task is now sleeping, lets send it an exception         task.cancel()   ```  The task was interrupted with a CancelledError. but the inner task (shileded()) was not interrupted and continues to wait, hanging on to the `_single_connection_lock` and the second attempt at `r.set()` is now deadlocked.  Basically, task interruption has been nerfed... Is there a workaround? |
| --- |

All reactions

Sorry, something went wrong.

[![@ikonst](https://avatars.githubusercontent.com/u/1186084?s=40&v=4)](/ikonst)
[ikonst](/ikonst)
mentioned this pull request
[Apr 18, 2023](#ref-pullrequest-1654483695)

[Optionally disable disconnects in read\_response
#2695](/redis/redis-py/pull/2695)
 Merged

6 tasks

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=80&v=4)](/agronholm)

Copy link

Contributor

### **[agronholm](/agronholm)** commented [Apr 19, 2023](#issuecomment-1514452720)

| For what reason does this shield the sub-task running `_try_send_command_parse_response()`? If I cancel a task that is performing a blocking command on Redis, the shielded subtask crashes with `redis.exceptions.ConnectionError: Connection closed by server.` when the client is closed.  In other words: **Always** manage your tasks! Having unmanaged tasks lying around is bad practice. |
| --- |

 👍
3
 sileht, x0day, and Zac-HD reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

Sorry, something went wrong.

[![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=80&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur)

Copy link

Contributor

### **[kristjanvalur](/kristjanvalur)** commented [Apr 20, 2023](#issuecomment-1516738801) • edited Loading

| [@agronholm](https://github.com/agronholm) I believe this PR was a mistake. It is an attempt to fix an issue caused by a regression that I caused last year, but without understanding the problem. I have had a fix for that regression lying around for four months without being accepted.  Please see pr [#2695](https://github.com/redis/redis-py/pull/2695) which undoes this change and applies the correct fix to the original regression. |
| --- |

 👍
1
 sileht reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@agronholm](https://avatars.githubusercontent.com/u/130003?s=40&v=4)](/agronholm)
[agronholm](/agronholm)
mentioned this pull request
[Apr 22, 2023](#ref-issue-1678181335)

[Redis pubsub task cancellation raises ConnectionError
#2717](/redis/redis-py/issues/2717)

Open

[![@dcki](https://avatars.githubusercontent.com/u/2041952?s=40&v=4)](/dcki)
[dcki](/dcki)
mentioned this pull request
[May 2, 2023](#ref-issue-1691529665)

[`RedisChannelLayer.receive()` drops events due to `asyncio.shield()` in redis-py 4.5.4
django/channels\_redis#366](/django/channels_redis/issues/366)

Closed

[dvora-h](/dvora-h)
added a commit
that referenced
this pull request
[Jul 3, 2023](#ref-commit-f2f8c34)
[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h) [![@bellini666](https://avatars.githubusercontent.com/u/134025?s=40&u=c5f80f2212a3a5603b26a75111dbc4275ab12884&v=4)](/bellini666)
[![@woutdenolf](https://avatars.githubusercontent.com/u/7264703?s=40&u=a97a3b4de3c941b938f30b60ed9e05ce5ee1f1cf&v=4)](/woutdenolf) [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim) [![@shacharPash](https://avatars.githubusercontent.com/u/93581407?s=40&u=16561186e665684910852a15568f4c729e33dc57&v=4)](/shacharPash) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&u=7c66b0d3054a0a780678e3059efb0e2f07cc5059&v=4)](/jamestiotio) [![@mirekdlugosz](https://avatars.githubusercontent.com/u/12373754?s=40&u=477a1353702ac77e0cbf3dd7685893f9c5bfaec6&v=4)](/mirekdlugosz) [![@oranav](https://avatars.githubusercontent.com/u/252748?s=40&u=a14bb2f92e6e3e0f99388f8d8fd1ff844e39cfdd&v=4)](/oranav) [![@mzdehbashi-github](https://avatars.githubusercontent.com/u/85902780?s=40&v=4)](/mzdehbashi-github) [![@tylerhutcherson](https://avatars.githubusercontent.com/u/20304844?s=40&u=f00461bcedad6ba384a4e234a44c906802448b4e&v=4)](/tylerhutcherson) [![@felipou](https://avatars.githubusercontent.com/u/462154?s=40&v=4)](/felipou) [![@AYMENJD](https://avatars.githubusercontent.com/u/53928879?s=40&u=8f3fbf03f6a7a6c0cb45b653f3b78c8bdce26708&v=4)](/AYMENJD) [![@scoopex](https://avatars.githubusercontent.com/u/288876?s=40&u=0776f95fbf62efa717714d4a930d16ead1891cf8&v=4)](/scoopex) [![@Avasam](https://avatars.githubusercontent.com/u/1350584?s=40&u=97d3c0fea7000b30a5f1a302767f55546e90f9f5&v=4)](/Avasam) [![@Anthchirp](https://avatars.githubusercontent.com/u/2102431?s=40&u=f6641e51aef3ec7c325588cc5eb9161efbce7ca9&v=4)](/Anthchirp) [![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=40&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur) [![@NickG123](https://avatars.githubusercontent.com/u/8438951?s=40&v=4)](/NickG123) [![@cristianmatache](https://avatars.githubusercontent.com/u/16057902?s=40&u=99544fcb9bce96b3fe927fec143cd59f9f091170&v=4)](/cristianmatache) [![@SoulPancake](https://avatars.githubusercontent.com/u/70265851?s=40&u=07ddd828b35c923c36ff721ec99bbc65fef14aab&v=4)](/SoulPancake) [![@aciddust](https://avatars.githubusercontent.com/u/18468557?s=40&u=138976f2f57d18c2d4cf00f3f396d9fd1dd59a55&v=4)](/aciddust) [![@bodevone](https://avatars.githubusercontent.com/u/19284074?s=40&u=c349dd0982d266cb7f8cfb848d8012aeeb8dca1d&v=4)](/bodevone) [![@Smit-Parmar](https://avatars.githubusercontent.com/u/61695474?s=40&u=1c27bf38cb6c563c12850c4b56089452e3659373&v=4)](/Smit-Parmar) [![@bmacphee](https://avatars.githubusercontent.com/u/5386001?s=40&u=fd499ffd948501a0be1a4ce90ed49dbd4ddc3866&v=4)](/bmacphee) [![@uglide](https://avatars.githubusercontent.com/u/1655867?s=40&u=7d9c85e26798bb0dd160a4fc570e3cabc149c5f9&v=4)](/uglide) [![@shahar-lev](https://avatars.githubusercontent.com/u/16762374?s=40&u=0ef216d719a89098dde91cfb0965e6d16e5d2a0e&v=4)](/shahar-lev) [![@vmihailenco](https://avatars.githubusercontent.com/u/290976?s=40&u=82c40b7d1c461933290bf7441acfa5d7bf09456f&v=4)](/vmihailenco) [![@TheKevJames](https://avatars.githubusercontent.com/u/3341822?s=40&v=4)](/TheKevJames)

`[Merge master to 5.0 (](/redis/redis-py/commit/f2f8c342091c2a093b911d38327436c4adc80f66 "Merge master to 5.0 (#2827)

* fix: do not use asyncio's timeout lib before 3.11.2 (#2659)

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49
[2] https://github.com/redis/redis-py/issues/2633

* UnixDomainSocketConnection missing constructor argument (#2630)

* removing useless files (#2642)

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async (#2673)

* Version 4.5.4 (#2674)

* Really do not use asyncio's timeout lib before 3.11.2 (#2699)

480253037afe4c12e38a0f98cadd3019a3724254 made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis (#2693) (#2694)

* Update example of Redisearch creating index (#2703)

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example (#2661)

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel (#2718)

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the \"test_ckquorum\" test).

* Fix topk list example. (#2724)

* Improve error output for master discovery (#2720)

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError (#2628)

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command (#2725)

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection (#2719)

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add \"address_remap\" feature to RedisCluster (#2726)

* add cluster \"host_port_remap\" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack (#2736)

* Updated AWS Elasticache IAM Connection Example (#2702)

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI (#2748)

* Add RedisCluster.remap_host_port, Update tests for CWE 404 (#2706)

* Use provided redis address. Bind to IPv4

* Add missing \"await\" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common \"master_host\" test fixture

* Update redismodules.rst (#2747)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid (#2704)

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings (#2731)

* fix parse_slowlog_get (#2732)

* Optionally disable disconnects in read_response (#2695)

* Add regression tests and fixes for issue #1128

* Fix tests for resumable read_response to use \"disconnect_on_error\"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch (#2745)

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url (#2752)

* Fix `xadd` allow non negative maxlen (#2739)

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 (#2753)

* Kristjan/issue #2754: Add missing argument to SentinelManagedConnection.read_response() (#2756)

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add \"disconnect_on_error\" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command (#2761)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue #2749: Remove unnecessary __del__ handlers (#2755)

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK (#2758)

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary (#2786)

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream (#2788)

* insert newline to prevent sphinx from assuming code block (#2796)

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors (#2778)

* expose OutOfMemoryError as explicit exception type

- handle \"OOM\" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes (#2631)

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)

* Fix dead weakref in sentinel conn (#2767)

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups (#2801)

* Add waitaof (#2760)

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class (#2734)

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster (#2804)

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI (#2809)

* Support JSON.MSET Command (#2766)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 (#2810)

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>")[#2827](https://github.com/redis/redis-py/pull/2827)[)](/redis/redis-py/commit/f2f8c342091c2a093b911d38327436c4adc80f66 "Merge master to 5.0 (#2827)

* fix: do not use asyncio's timeout lib before 3.11.2 (#2659)

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49
[2] https://github.com/redis/redis-py/issues/2633

* UnixDomainSocketConnection missing constructor argument (#2630)

* removing useless files (#2642)

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async (#2673)

* Version 4.5.4 (#2674)

* Really do not use asyncio's timeout lib before 3.11.2 (#2699)

480253037afe4c12e38a0f98cadd3019a3724254 made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis (#2693) (#2694)

* Update example of Redisearch creating index (#2703)

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example (#2661)

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel (#2718)

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the \"test_ckquorum\" test).

* Fix topk list example. (#2724)

* Improve error output for master discovery (#2720)

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError (#2628)

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command (#2725)

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection (#2719)

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add \"address_remap\" feature to RedisCluster (#2726)

* add cluster \"host_port_remap\" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack (#2736)

* Updated AWS Elasticache IAM Connection Example (#2702)

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI (#2748)

* Add RedisCluster.remap_host_port, Update tests for CWE 404 (#2706)

* Use provided redis address. Bind to IPv4

* Add missing \"await\" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common \"master_host\" test fixture

* Update redismodules.rst (#2747)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid (#2704)

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings (#2731)

* fix parse_slowlog_get (#2732)

* Optionally disable disconnects in read_response (#2695)

* Add regression tests and fixes for issue #1128

* Fix tests for resumable read_response to use \"disconnect_on_error\"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch (#2745)

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url (#2752)

* Fix `xadd` allow non negative maxlen (#2739)

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 (#2753)

* Kristjan/issue #2754: Add missing argument to SentinelManagedConnection.read_response() (#2756)

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add \"disconnect_on_error\" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command (#2761)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue #2749: Remove unnecessary __del__ handlers (#2755)

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK (#2758)

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary (#2786)

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream (#2788)

* insert newline to prevent sphinx from assuming code block (#2796)

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors (#2778)

* expose OutOfMemoryError as explicit exception type

- handle \"OOM\" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes (#2631)

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)

* Fix dead weakref in sentinel conn (#2767)

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups (#2801)

* Add waitaof (#2760)

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class (#2734)

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster (#2804)

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI (#2809)

* Support JSON.MSET Command (#2766)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 (#2810)

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>")`
…

`[f2f8c34](/redis/redis-py/commit/f2f8c342091c2a093b911d38327436c4adc80f66)`

```
* fix: do not use asyncio's timeout lib before 3.11.2 ([#2659](https://github.com/redis/redis-py/pull/2659))

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] [python/cpython@04adf2d](https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49)
[2] [#2633](https://github.com/redis/redis-py/issues/2633)

* UnixDomainSocketConnection missing constructor argument ([#2630](https://github.com/redis/redis-py/pull/2630))

* removing useless files ([#2642](https://github.com/redis/redis-py/pull/2642))

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client ([#2669](https://github.com/redis/redis-py/pull/2669))

* Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async ([#2673](https://github.com/redis/redis-py/pull/2673))

* Version 4.5.4 ([#2674](https://github.com/redis/redis-py/pull/2674))

* Really do not use asyncio's timeout lib before 3.11.2 ([#2699](https://github.com/redis/redis-py/pull/2699))

[4802530](https://github.com/redis/redis-py/commit/480253037afe4c12e38a0f98cadd3019a3724254) made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis ([#2693](https://github.com/redis/redis-py/issues/2693)) ([#2694](https://github.com/redis/redis-py/pull/2694))

* Update example of Redisearch creating index ([#2703](https://github.com/redis/redis-py/pull/2703))

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example ([#2661](https://github.com/redis/redis-py/pull/2661))

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel ([#2718](https://github.com/redis/redis-py/pull/2718))

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the "test_ckquorum" test).

* Fix topk list example. ([#2724](https://github.com/redis/redis-py/pull/2724))

* Improve error output for master discovery ([#2720](https://github.com/redis/redis-py/pull/2720))

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError ([#2628](https://github.com/redis/redis-py/pull/2628))

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command ([#2725](https://github.com/redis/redis-py/pull/2725))

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol ([#2729](https://github.com/redis/redis-py/pull/2729))

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection ([#2719](https://github.com/redis/redis-py/pull/2719))

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add "address_remap" feature to RedisCluster ([#2726](https://github.com/redis/redis-py/pull/2726))

* add cluster "host_port_remap" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack ([#2736](https://github.com/redis/redis-py/pull/2736))

* Updated AWS Elasticache IAM Connection Example ([#2702](https://github.com/redis/redis-py/pull/2702))

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI ([#2748](https://github.com/redis/redis-py/pull/2748))

* Add RedisCluster.remap_host_port, Update tests for CWE 404 ([#2706](https://github.com/redis/redis-py/pull/2706))

* Use provided redis address. Bind to IPv4

* Add missing "await" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common "master_host" test fixture

* Update redismodules.rst ([#2747](https://github.com/redis/redis-py/pull/2747))

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid ([#2704](https://github.com/redis/redis-py/pull/2704))

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings ([#2731](https://github.com/redis/redis-py/pull/2731))

* fix parse_slowlog_get ([#2732](https://github.com/redis/redis-py/pull/2732))

* Optionally disable disconnects in read_response ([#2695](https://github.com/redis/redis-py/pull/2695))

* Add regression tests and fixes for issue [#1128](https://github.com/redis/redis-py/issues/1128)

* Fix tests for resumable read_response to use "disconnect_on_error"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch ([#2745](https://github.com/redis/redis-py/pull/2745))

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url ([#2752](https://github.com/redis/redis-py/pull/2752))

* Fix `xadd` allow non negative maxlen ([#2739](https://github.com/redis/redis-py/pull/2739))

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 ([#2753](https://github.com/redis/redis-py/pull/2753))

* Kristjan/issue [#2754](https://github.com/redis/redis-py/issues/2754): Add missing argument to SentinelManagedConnection.read_response() ([#2756](https://github.com/redis/redis-py/pull/2756))

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add "disconnect_on_error" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command ([#2761](https://github.com/redis/redis-py/pull/2761))

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue [#2749](https://github.com/redis/redis-py/issues/2749): Remove unnecessary __del__ handlers ([#2755](https://github.com/redis/redis-py/pull/2755))

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK ([#2758](https://github.com/redis/redis-py/pull/2758))

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary ([#2786](https://github.com/redis/redis-py/pull/2786))

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream ([#2788](https://github.com/redis/redis-py/pull/2788))

* insert newline to prevent sphinx from assuming code block ([#2796](https://github.com/redis/redis-py/pull/2796))

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors ([#2778](https://github.com/redis/redis-py/pull/2778))

* expose OutOfMemoryError as explicit exception type

- handle "OOM" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes ([#2631](https://github.com/redis/redis-py/pull/2631))

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError ([#2767](https://github.com/redis/redis-py/issues/2767)) ([#2771](https://github.com/redis/redis-py/pull/2771))

* Fix dead weakref in sentinel conn ([#2767](https://github.com/redis/redis-py/issues/2767))

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups ([#2801](https://github.com/redis/redis-py/pull/2801))

* Add waitaof ([#2760](https://github.com/redis/redis-py/pull/2760))

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class ([#2734](https://github.com/redis/redis-py/pull/2734))

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster ([#2804](https://github.com/redis/redis-py/pull/2804))

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI ([#2809](https://github.com/redis/redis-py/pull/2809))

* Support JSON.MSET Command ([#2766](https://github.com/redis/redis-py/pull/2766))

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 ([#2810](https://github.com/redis/redis-py/pull/2810))

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
```

[dvora-h](/dvora-h)
added a commit
that referenced
this pull request
[Jul 16, 2023](#ref-commit-2732a85)
[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h) [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[![@leibale](https://avatars.githubusercontent.com/u/7086055?s=40&v=4)](/leibale) [![@bellini666](https://avatars.githubusercontent.com/u/134025?s=40&u=c5f80f2212a3a5603b26a75111dbc4275ab12884&v=4)](/bellini666) [![@woutdenolf](https://avatars.githubusercontent.com/u/7264703?s=40&u=a97a3b4de3c941b938f30b60ed9e05ce5ee1f1cf&v=4)](/woutdenolf) [![@shacharPash](https://avatars.githubusercontent.com/u/93581407?s=40&u=16561186e665684910852a15568f4c729e33dc57&v=4)](/shacharPash) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&u=7c66b0d3054a0a780678e3059efb0e2f07cc5059&v=4)](/jamestiotio) [![@mirekdlugosz](https://avatars.githubusercontent.com/u/12373754?s=40&u=477a1353702ac77e0cbf3dd7685893f9c5bfaec6&v=4)](/mirekdlugosz) [![@oranav](https://avatars.githubusercontent.com/u/252748?s=40&u=a14bb2f92e6e3e0f99388f8d8fd1ff844e39cfdd&v=4)](/oranav) [![@mzdehbashi-github](https://avatars.githubusercontent.com/u/85902780?s=40&v=4)](/mzdehbashi-github) [![@tylerhutcherson](https://avatars.githubusercontent.com/u/20304844?s=40&u=f00461bcedad6ba384a4e234a44c906802448b4e&v=4)](/tylerhutcherson) [![@felipou](https://avatars.githubusercontent.com/u/462154?s=40&v=4)](/felipou) [![@AYMENJD](https://avatars.githubusercontent.com/u/53928879?s=40&u=8f3fbf03f6a7a6c0cb45b653f3b78c8bdce26708&v=4)](/AYMENJD) [![@scoopex](https://avatars.githubusercontent.com/u/288876?s=40&u=0776f95fbf62efa717714d4a930d16ead1891cf8&v=4)](/scoopex) [![@Avasam](https://avatars.githubusercontent.com/u/1350584?s=40&u=97d3c0fea7000b30a5f1a302767f55546e90f9f5&v=4)](/Avasam) [![@Anthchirp](https://avatars.githubusercontent.com/u/2102431?s=40&u=f6641e51aef3ec7c325588cc5eb9161efbce7ca9&v=4)](/Anthchirp) [![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=40&u=1419f20bbfff8f031be8cb470962e7e62de2595e&v=4)](/kristjanvalur) [![@NickG123](https://avatars.githubusercontent.com/u/8438951?s=40&v=4)](/NickG123) [![@cristianmatache](https://avatars.githubusercontent.com/u/16057902?s=40&u=99544fcb9bce96b3fe927fec143cd59f9f091170&v=4)](/cristianmatache) [![@SoulPancake](https://avatars.githubusercontent.com/u/70265851?s=40&u=07ddd828b35c923c36ff721ec99bbc65fef14aab&v=4)](/SoulPancake) [![@aciddust](https://avatars.githubusercontent.com/u/18468557?s=40&u=138976f2f57d18c2d4cf00f3f396d9fd1dd59a55&v=4)](/aciddust) [![@bodevone](https://avatars.githubusercontent.com/u/19284074?s=40&u=c349dd0982d266cb7f8cfb848d8012aeeb8dca1d&v=4)](/bodevone) [![@Smit-Parmar](https://avatars.githubusercontent.com/u/61695474?s=40&u=1c27bf38cb6c563c12850c4b56089452e3659373&v=4)](/Smit-Parmar) [![@bmacphee](https://avatars.githubusercontent.com/u/5386001?s=40&u=fd499ffd948501a0be1a4ce90ed49dbd4ddc3866&v=4)](/bmacphee) [![@uglide](https://avatars.githubusercontent.com/u/1655867?s=40&u=7d9c85e26798bb0dd160a4fc570e3cabc149c5f9&v=4)](/uglide) [![@shahar-lev](https://avatars.githubusercontent.com/u/16762374?s=40&u=0ef216d719a89098dde91cfb0965e6d16e5d2a0e&v=4)](/shahar-lev) [![@vmihailenco](https://avatars.githubusercontent.com/u/290976?s=40&u=82c40b7d1c461933290bf7441acfa5d7bf09456f&v=4)](/vmihailenco) [![@TheKevJames](https://avatars.githubusercontent.com/u/3341822?s=40&v=4)](/TheKevJames)

`[Merge 5.0 to master (](/redis/redis-py/commit/2732a8553e58d9e77f16566b9132fc7205614a53 "Merge 5.0 to master (#2849)

* Reorganizing the parsers code, and add support for RESP3 (#2574)

* Reorganizing the parsers code

* fix build package

* fix imports

* fix flake8

* add resp to Connection class

* core commands

* python resp3 parser

* pipeline

* async resp3 parser

* some asymc tests

* resp3 parser for async cluster

* async commands tests

* linters

* linters

* linters

* fix ModuleNotFoundError

* fix tests

* fix assert_resp_response_in

* fix command_getkeys in cluster

* fail-fast false

* version

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Fix async client with resp3 (#2657)

* Add support for PubSub with RESP3 parser (#2721)

* add resp3 pubsub

* linters

* _set_info_logger func

* async pubsun

* docstring

* 5.0.0b2 (#2723)

* Fix `COMMAND` response in resp3 (redis 7+) (#2740)

* Fix protocol version checking (#2737)

* bumping beta version to 5.0.0b3 (#2743)

* Fix parse resp3 dict response: don't use dict comprehension (#2757)

* Fix parse respp3 dict response

* linters

* pin urlib version

* Sharded pubsub (#2762)

* sharded pubsub

* sharded pubsub

Co-authored-by: Leibale Eidelman <me@leibale.com>

* Shrded Pubsub TestPubSubSubscribeUnsubscribe

* fix TestPubSubSubscribeUnsubscribe

* more tests

* linters

* TestPubSubSubcommands

* fix @leibale comments

* linters

* fix @chayim comments

---------

Co-authored-by: Leibale Eidelman <me@leibale.com>

* 5.0.0b4 (#2781)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* RESP3 tests (#2780)

* fix command response in resp3

* linters

* acl_log & acl_getuser

* client_info

* test_commands and test_asyncio/test_commands

* fix test_command_parser

* fix asyncio/test_connection/test_invalid_response

* linters

* all the tests

* push handler sharded pubsub

* Use assert_resp_response wherever possible

* fix test_xreadgroup

* fix cluster_zdiffstore and cluster_zinter

* fix review comments

* fix review comments

* linters

* Fixing asyncio import (#2759)

* asyncio import fix

* pinning urllib3 to fix CI (#2748)

* noqa

* fixint linters

* fix (#2799)

* RESP3 response callbacks (#2798)

* start cleaning

* clean sone callbacks

* response callbacks

* revert redismod-url change

* fix async tests

* linters

* async cluster

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* RESP3 modules support (#2803)

* start cleaning

* clean sone callbacks

* response callbacks

* modules

* tests

* finish sync search tests

* linters

* async modules

* linters

* revert redismod-url change

* RESP3 fix async tests (#2806)

* fix tests

* add stralgo callback in resp2

* add callback to acl list in resp2

* Adding RESP3 tests support (#2793)

* start cleaning

* clean sone callbacks

* first phase

* tox wrap back

* changing cancel format

* syntax

* lint

* docker

* contain the docker

* tox dev reqs

* back to testing

* response callbacks

* protocol into async conftest

* fix for 3.11 invoke

* docker changes

* fix tests

* linters

* adding

* resp3 tox, until killed

* remove tox

* tests

* requirements.txt

* restoring requirements.txt

* adding a sleep, hopefully enough time for the cluster dockers to settle

* fix search tests

* search test, disable uvloop for pypy due to bug

* syn

* reg

* dialect test improvement

* sleep+, xfail

* tests

* resp

* flaky search test too

* timing

* timing for async test

* test changes

* fix assert_interval_advanced

* revert

* mark async health_check tests with xfail

* change strict to false

* fix github actions package validation

---------

Co-authored-by: dvora-h <dvora.heller@redis.com>

* change sismember return type (#2813)

* Version 5.0.0rc1 (#2815)

* Merge master to 5.0 (#2827)

* fix: do not use asyncio's timeout lib before 3.11.2 (#2659)

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49
[2] https://github.com/redis/redis-py/issues/2633

* UnixDomainSocketConnection missing constructor argument (#2630)

* removing useless files (#2642)

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async (#2673)

* Version 4.5.4 (#2674)

* Really do not use asyncio's timeout lib before 3.11.2 (#2699)

480253037afe4c12e38a0f98cadd3019a3724254 made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis (#2693) (#2694)

* Update example of Redisearch creating index (#2703)

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example (#2661)

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel (#2718)

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the \"test_ckquorum\" test).

* Fix topk list example. (#2724)

* Improve error output for master discovery (#2720)

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError (#2628)

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command (#2725)

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection (#2719)

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add \"address_remap\" feature to RedisCluster (#2726)

* add cluster \"host_port_remap\" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack (#2736)

* Updated AWS Elasticache IAM Connection Example (#2702)

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI (#2748)

* Add RedisCluster.remap_host_port, Update tests for CWE 404 (#2706)

* Use provided redis address. Bind to IPv4

* Add missing \"await\" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common \"master_host\" test fixture

* Update redismodules.rst (#2747)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid (#2704)

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings (#2731)

* fix parse_slowlog_get (#2732)

* Optionally disable disconnects in read_response (#2695)

* Add regression tests and fixes for issue #1128

* Fix tests for resumable read_response to use \"disconnect_on_error\"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch (#2745)

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url (#2752)

* Fix `xadd` allow non negative maxlen (#2739)

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 (#2753)

* Kristjan/issue #2754: Add missing argument to SentinelManagedConnection.read_response() (#2756)

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add \"disconnect_on_error\" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command (#2761)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue #2749: Remove unnecessary __del__ handlers (#2755)

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK (#2758)

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary (#2786)

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream (#2788)

* insert newline to prevent sphinx from assuming code block (#2796)

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors (#2778)

* expose OutOfMemoryError as explicit exception type

- handle \"OOM\" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes (#2631)

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)

* Fix dead weakref in sentinel conn (#2767)

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups (#2801)

* Add waitaof (#2760)

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class (#2734)

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster (#2804)

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI (#2809)

* Support JSON.MSET Command (#2766)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 (#2810)

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>

* RESP3 response-callbacks cleanup (#2841)

* cluenup

* sentinel callbacks

* move callbacks

* fix async cluster tests

* _parsers and import fix in tests

* linters

* make modules callbacks private

* fix async search

* fix

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Version 5.0.0rc2 (#2843)

* linters

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>")[#2849](https://github.com/redis/redis-py/pull/2849)[)](/redis/redis-py/commit/2732a8553e58d9e77f16566b9132fc7205614a53 "Merge 5.0 to master (#2849)

* Reorganizing the parsers code, and add support for RESP3 (#2574)

* Reorganizing the parsers code

* fix build package

* fix imports

* fix flake8

* add resp to Connection class

* core commands

* python resp3 parser

* pipeline

* async resp3 parser

* some asymc tests

* resp3 parser for async cluster

* async commands tests

* linters

* linters

* linters

* fix ModuleNotFoundError

* fix tests

* fix assert_resp_response_in

* fix command_getkeys in cluster

* fail-fast false

* version

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Fix async client with resp3 (#2657)

* Add support for PubSub with RESP3 parser (#2721)

* add resp3 pubsub

* linters

* _set_info_logger func

* async pubsun

* docstring

* 5.0.0b2 (#2723)

* Fix `COMMAND` response in resp3 (redis 7+) (#2740)

* Fix protocol version checking (#2737)

* bumping beta version to 5.0.0b3 (#2743)

* Fix parse resp3 dict response: don't use dict comprehension (#2757)

* Fix parse respp3 dict response

* linters

* pin urlib version

* Sharded pubsub (#2762)

* sharded pubsub

* sharded pubsub

Co-authored-by: Leibale Eidelman <me@leibale.com>

* Shrded Pubsub TestPubSubSubscribeUnsubscribe

* fix TestPubSubSubscribeUnsubscribe

* more tests

* linters

* TestPubSubSubcommands

* fix @leibale comments

* linters

* fix @chayim comments

---------

Co-authored-by: Leibale Eidelman <me@leibale.com>

* 5.0.0b4 (#2781)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* RESP3 tests (#2780)

* fix command response in resp3

* linters

* acl_log & acl_getuser

* client_info

* test_commands and test_asyncio/test_commands

* fix test_command_parser

* fix asyncio/test_connection/test_invalid_response

* linters

* all the tests

* push handler sharded pubsub

* Use assert_resp_response wherever possible

* fix test_xreadgroup

* fix cluster_zdiffstore and cluster_zinter

* fix review comments

* fix review comments

* linters

* Fixing asyncio import (#2759)

* asyncio import fix

* pinning urllib3 to fix CI (#2748)

* noqa

* fixint linters

* fix (#2799)

* RESP3 response callbacks (#2798)

* start cleaning

* clean sone callbacks

* response callbacks

* revert redismod-url change

* fix async tests

* linters

* async cluster

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* RESP3 modules support (#2803)

* start cleaning

* clean sone callbacks

* response callbacks

* modules

* tests

* finish sync search tests

* linters

* async modules

* linters

* revert redismod-url change

* RESP3 fix async tests (#2806)

* fix tests

* add stralgo callback in resp2

* add callback to acl list in resp2

* Adding RESP3 tests support (#2793)

* start cleaning

* clean sone callbacks

* first phase

* tox wrap back

* changing cancel format

* syntax

* lint

* docker

* contain the docker

* tox dev reqs

* back to testing

* response callbacks

* protocol into async conftest

* fix for 3.11 invoke

* docker changes

* fix tests

* linters

* adding

* resp3 tox, until killed

* remove tox

* tests

* requirements.txt

* restoring requirements.txt

* adding a sleep, hopefully enough time for the cluster dockers to settle

* fix search tests

* search test, disable uvloop for pypy due to bug

* syn

* reg

* dialect test improvement

* sleep+, xfail

* tests

* resp

* flaky search test too

* timing

* timing for async test

* test changes

* fix assert_interval_advanced

* revert

* mark async health_check tests with xfail

* change strict to false

* fix github actions package validation

---------

Co-authored-by: dvora-h <dvora.heller@redis.com>

* change sismember return type (#2813)

* Version 5.0.0rc1 (#2815)

* Merge master to 5.0 (#2827)

* fix: do not use asyncio's timeout lib before 3.11.2 (#2659)

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49
[2] https://github.com/redis/redis-py/issues/2633

* UnixDomainSocketConnection missing constructor argument (#2630)

* removing useless files (#2642)

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)

* Fixing cancelled async futures (#2666)

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async (#2673)

* Version 4.5.4 (#2674)

* Really do not use asyncio's timeout lib before 3.11.2 (#2699)

480253037afe4c12e38a0f98cadd3019a3724254 made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis (#2693) (#2694)

* Update example of Redisearch creating index (#2703)

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example (#2661)

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel (#2718)

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the \"test_ckquorum\" test).

* Fix topk list example. (#2724)

* Improve error output for master discovery (#2720)

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError (#2628)

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command (#2725)

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection (#2719)

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add \"address_remap\" feature to RedisCluster (#2726)

* add cluster \"host_port_remap\" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack (#2736)

* Updated AWS Elasticache IAM Connection Example (#2702)

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI (#2748)

* Add RedisCluster.remap_host_port, Update tests for CWE 404 (#2706)

* Use provided redis address. Bind to IPv4

* Add missing \"await\" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common \"master_host\" test fixture

* Update redismodules.rst (#2747)

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid (#2704)

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings (#2731)

* fix parse_slowlog_get (#2732)

* Optionally disable disconnects in read_response (#2695)

* Add regression tests and fixes for issue #1128

* Fix tests for resumable read_response to use \"disconnect_on_error\"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch (#2745)

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url (#2752)

* Fix `xadd` allow non negative maxlen (#2739)

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 (#2753)

* Kristjan/issue #2754: Add missing argument to SentinelManagedConnection.read_response() (#2756)

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add \"disconnect_on_error\" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command (#2761)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue #2749: Remove unnecessary __del__ handlers (#2755)

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK (#2758)

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary (#2786)

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream (#2788)

* insert newline to prevent sphinx from assuming code block (#2796)

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors (#2778)

* expose OutOfMemoryError as explicit exception type

- handle \"OOM\" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes (#2631)

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)

* Fix dead weakref in sentinel conn (#2767)

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups (#2801)

* Add waitaof (#2760)

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class (#2734)

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster (#2804)

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI (#2809)

* Support JSON.MSET Command (#2766)

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 (#2810)

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>

* RESP3 response-callbacks cleanup (#2841)

* cluenup

* sentinel callbacks

* move callbacks

* fix async cluster tests

* _parsers and import fix in tests

* linters

* make modules callbacks private

* fix async search

* fix

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Version 5.0.0rc2 (#2843)

* linters

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>")`
…

`[2732a85](/redis/redis-py/commit/2732a8553e58d9e77f16566b9132fc7205614a53)`

```
* Reorganizing the parsers code, and add support for RESP3 ([#2574](https://github.com/redis/redis-py/pull/2574))

* Reorganizing the parsers code

* fix build package

* fix imports

* fix flake8

* add resp to Connection class

* core commands

* python resp3 parser

* pipeline

* async resp3 parser

* some asymc tests

* resp3 parser for async cluster

* async commands tests

* linters

* linters

* linters

* fix ModuleNotFoundError

* fix tests

* fix assert_resp_response_in

* fix command_getkeys in cluster

* fail-fast false

* version

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Fix async client with resp3 ([#2657](https://github.com/redis/redis-py/pull/2657))

* Add support for PubSub with RESP3 parser ([#2721](https://github.com/redis/redis-py/pull/2721))

* add resp3 pubsub

* linters

* _set_info_logger func

* async pubsun

* docstring

* 5.0.0b2 ([#2723](https://github.com/redis/redis-py/pull/2723))

* Fix `COMMAND` response in resp3 (redis 7+) ([#2740](https://github.com/redis/redis-py/pull/2740))

* Fix protocol version checking ([#2737](https://github.com/redis/redis-py/pull/2737))

* bumping beta version to 5.0.0b3 ([#2743](https://github.com/redis/redis-py/pull/2743))

* Fix parse resp3 dict response: don't use dict comprehension ([#2757](https://github.com/redis/redis-py/pull/2757))

* Fix parse respp3 dict response

* linters

* pin urlib version

* Sharded pubsub ([#2762](https://github.com/redis/redis-py/pull/2762))

* sharded pubsub

* sharded pubsub

Co-authored-by: Leibale Eidelman <me@leibale.com>

* Shrded Pubsub TestPubSubSubscribeUnsubscribe

* fix TestPubSubSubscribeUnsubscribe

* more tests

* linters

* TestPubSubSubcommands

* fix [@leibale](https://github.com/leibale) comments

* linters

* fix [@chayim](https://github.com/chayim) comments

---------

Co-authored-by: Leibale Eidelman <me@leibale.com>

* 5.0.0b4 ([#2781](https://github.com/redis/redis-py/pull/2781))

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* RESP3 tests ([#2780](https://github.com/redis/redis-py/pull/2780))

* fix command response in resp3

* linters

* acl_log & acl_getuser

* client_info

* test_commands and test_asyncio/test_commands

* fix test_command_parser

* fix asyncio/test_connection/test_invalid_response

* linters

* all the tests

* push handler sharded pubsub

* Use assert_resp_response wherever possible

* fix test_xreadgroup

* fix cluster_zdiffstore and cluster_zinter

* fix review comments

* fix review comments

* linters

* Fixing asyncio import ([#2759](https://github.com/redis/redis-py/pull/2759))

* asyncio import fix

* pinning urllib3 to fix CI ([#2748](https://github.com/redis/redis-py/pull/2748))

* noqa

* fixint linters

* fix ([#2799](https://github.com/redis/redis-py/pull/2799))

* RESP3 response callbacks ([#2798](https://github.com/redis/redis-py/pull/2798))

* start cleaning

* clean sone callbacks

* response callbacks

* revert redismod-url change

* fix async tests

* linters

* async cluster

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* RESP3 modules support ([#2803](https://github.com/redis/redis-py/pull/2803))

* start cleaning

* clean sone callbacks

* response callbacks

* modules

* tests

* finish sync search tests

* linters

* async modules

* linters

* revert redismod-url change

* RESP3 fix async tests ([#2806](https://github.com/redis/redis-py/pull/2806))

* fix tests

* add stralgo callback in resp2

* add callback to acl list in resp2

* Adding RESP3 tests support ([#2793](https://github.com/redis/redis-py/pull/2793))

* start cleaning

* clean sone callbacks

* first phase

* tox wrap back

* changing cancel format

* syntax

* lint

* docker

* contain the docker

* tox dev reqs

* back to testing

* response callbacks

* protocol into async conftest

* fix for 3.11 invoke

* docker changes

* fix tests

* linters

* adding

* resp3 tox, until killed

* remove tox

* tests

* requirements.txt

* restoring requirements.txt

* adding a sleep, hopefully enough time for the cluster dockers to settle

* fix search tests

* search test, disable uvloop for pypy due to bug

* syn

* reg

* dialect test improvement

* sleep+, xfail

* tests

* resp

* flaky search test too

* timing

* timing for async test

* test changes

* fix assert_interval_advanced

* revert

* mark async health_check tests with xfail

* change strict to false

* fix github actions package validation

---------

Co-authored-by: dvora-h <dvora.heller@redis.com>

* change sismember return type ([#2813](https://github.com/redis/redis-py/pull/2813))

* Version 5.0.0rc1 ([#2815](https://github.com/redis/redis-py/pull/2815))

* Merge master to 5.0 ([#2827](https://github.com/redis/redis-py/pull/2827))

* fix: do not use asyncio's timeout lib before 3.11.2 ([#2659](https://github.com/redis/redis-py/pull/2659))

There's an issue in asyncio's timeout lib before 3.11.3 that causes
async calls to raise `CancelledError`.

This is a cpython issue that was fixed in this commit [1] and
cherry-picked to previous versions, meaning 3.11.3 will work correctly.

Check [2] for more info.

[1] [python/cpython@04adf2d](https://github.com/python/cpython/commit/04adf2df395ded81922c71360a5d66b597471e49)
[2] [#2633](https://github.com/redis/redis-py/issues/2633)

* UnixDomainSocketConnection missing constructor argument ([#2630](https://github.com/redis/redis-py/pull/2630))

* removing useless files ([#2642](https://github.com/redis/redis-py/pull/2642))

* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client ([#2669](https://github.com/redis/redis-py/pull/2669))

* Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))

Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Fix async ([#2673](https://github.com/redis/redis-py/pull/2673))

* Version 4.5.4 ([#2674](https://github.com/redis/redis-py/pull/2674))

* Really do not use asyncio's timeout lib before 3.11.2 ([#2699](https://github.com/redis/redis-py/pull/2699))

[4802530](https://github.com/redis/redis-py/commit/480253037afe4c12e38a0f98cadd3019a3724254) made async-timeout required
only on Python 3.11.2 and earlier. However, according to PEP-508,
python_version marker is compared to first two numbers of Python version
tuple - so it will evaluate to True also on 3.11.3, and install a
package as a dependency.

* asyncio: Fix memory leak caused by hiredis ([#2693](https://github.com/redis/redis-py/issues/2693)) ([#2694](https://github.com/redis/redis-py/pull/2694))

* Update example of Redisearch creating index ([#2703](https://github.com/redis/redis-py/pull/2703))

When creating index, fields should be passed inside an iterable (e.g. list or tuple)

* Improving Vector Similarity Search Example ([#2661](https://github.com/redis/redis-py/pull/2661))

* update vss docs

* add embeddings creation and storage examples

* update based on feedback

* fix version and link

* include more realistic search examples and clean up indices

* completely remove initial cap reference

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>

* Fix incorrect usage of once flag in async Sentinel ([#2718](https://github.com/redis/redis-py/pull/2718))

In the execute_command of the async Sentinel, the once flag was being
used incorrectly, with its meaning inverted. To fix we just needed to invert
the if and else bodies. This isn't being caught by the tests currently
because the tests of commands that use this flag do not check their
results/effects (for example the "test_ckquorum" test).

* Fix topk list example. ([#2724](https://github.com/redis/redis-py/pull/2724))

* Improve error output for master discovery ([#2720](https://github.com/redis/redis-py/pull/2720))

Make MasterNotFoundError exception more precise in the case of
ConnectionError and TimeoutError to help the user to identify
configuration errors

Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>

* return response in case of KeyError ([#2628](https://github.com/redis/redis-py/pull/2628))

* return response in case of KeyError

* fix code linters error

* fix linters 2

* fix linters 3

* Add WITHSCORES to ZREVRANK Command ([#2725](https://github.com/redis/redis-py/pull/2725))

* add withscores to zrevrank

* change 0 -> 2

* fix errors

* split test

* Fix `ClusterCommandProtocol` not itself being marked as a protocol ([#2729](https://github.com/redis/redis-py/pull/2729))

* Fix `ClusterCommandProtocol` not itself being marked as a protocol

* Update CHANGES

* Fix potential race condition during disconnection ([#2719](https://github.com/redis/redis-py/pull/2719))

When the disconnect() function is called twice in parallel it is possible that
one thread deletes the self._sock reference, while the other thread will
attempt to call .close() on it, leading to an AttributeError.

This situation can routinely be encountered by closing the connection in a
PubSubWorkerThread error handler in a blocking thread (ie. with
sleep_time==None), and then calling .close() on the PubSub object.
The main thread will then run into the disconnect() function, and the listener
thread is woken up by the closure and will race into the disconnect()
function, too.

This can be fixed easily by copying the object reference before doing the
None-check, similar to what we do in the redis.client.close() function.

* add "address_remap" feature to RedisCluster ([#2726](https://github.com/redis/redis-py/pull/2726))

* add cluster "host_port_remap" feature for asyncio.RedisCluster

* Add a unittest for asyncio.RedisCluster

* Add host_port_remap to _sync_ RedisCluster

* add synchronous tests

* rename arg to `address_remap` and take and return an address tuple.

* Add class documentation

* Add CHANGES

* nermina changes from NRedisStack ([#2736](https://github.com/redis/redis-py/pull/2736))

* Updated AWS Elasticache IAM Connection Example ([#2702](https://github.com/redis/redis-py/pull/2702))

Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>

* pinning urllib3 to fix CI ([#2748](https://github.com/redis/redis-py/pull/2748))

* Add RedisCluster.remap_host_port, Update tests for CWE 404 ([#2706](https://github.com/redis/redis-py/pull/2706))

* Use provided redis address. Bind to IPv4

* Add missing "await" and perform the correct test for pipe eimpty

* Wait for a send event, rather than rely on sleep time. Excpect cancel errors.

* set delay to 0 except for operation we want to cancel
This speeds up the unit tests considerably by eliminating unnecessary delay.

* Release resources in test

* Fix cluster test to use address_remap and multiple proxies.

* Use context manager to manage DelayProxy

* Mark failing pipeline tests

* lint

* Use a common "master_host" test fixture

* Update redismodules.rst ([#2747](https://github.com/redis/redis-py/pull/2747))

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add support for cluster myshardid ([#2704](https://github.com/redis/redis-py/pull/2704))

* feat: adding support for cluster myshardid

* lint fix

* fix: comment fix and async test

* fix: adding version check

* fix lint:

* linters

---------

Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* clean warnings ([#2731](https://github.com/redis/redis-py/pull/2731))

* fix parse_slowlog_get ([#2732](https://github.com/redis/redis-py/pull/2732))

* Optionally disable disconnects in read_response ([#2695](https://github.com/redis/redis-py/pull/2695))

* Add regression tests and fixes for issue [#1128](https://github.com/redis/redis-py/issues/1128)

* Fix tests for resumable read_response to use "disconnect_on_error"

* undo prevision fix attempts in async client and cluster

* re-enable cluster test

* Suggestions from code review

* Add CHANGES

* Add client no-touch ([#2745](https://github.com/redis/redis-py/pull/2745))

* Add client no-touch

* Update redis/commands/core.py

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Update test_commands.py

Improve test_client_no_touch

* Update test_commands.py

Add async version test case

* Chore remove whitespace

Oops

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* fix create single_connection_client from url ([#2752](https://github.com/redis/redis-py/pull/2752))

* Fix `xadd` allow non negative maxlen ([#2739](https://github.com/redis/redis-py/pull/2739))

* Fix xadd allow non negative maxlen

* Update change log

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Version 4.5.5 ([#2753](https://github.com/redis/redis-py/pull/2753))

* Kristjan/issue [#2754](https://github.com/redis/redis-py/issues/2754): Add missing argument to SentinelManagedConnection.read_response() ([#2756](https://github.com/redis/redis-py/pull/2756))

* Increase timeout for a test which would hang completely if failing.
Timeouts in virtualized CI backends can occasionally fail if too short.

* add "disconnect_on_error" argument to SentinelManagedConnection

* update Changes

* lint

* support JSON.MERGE Command ([#2761](https://github.com/redis/redis-py/pull/2761))

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Issue [#2749](https://github.com/redis/redis-py/issues/2749): Remove unnecessary __del__ handlers ([#2755](https://github.com/redis/redis-py/pull/2755))

* Remove unnecessary __del__ handlers
There normally should be no logic attached to del.  Cleanly disconnecting network resources is not needed at that time.

* add CHANGES

* Add WITHSCORE to ZRANK ([#2758](https://github.com/redis/redis-py/pull/2758))

* add withscore to zrank with tests

* fix test

* Fix JSON.MERGE Summary ([#2786](https://github.com/redis/redis-py/pull/2786))

* Fix JSON.MERGE Summary

* linters

* Fixed key error in parse_xinfo_stream ([#2788](https://github.com/redis/redis-py/pull/2788))

* insert newline to prevent sphinx from assuming code block ([#2796](https://github.com/redis/redis-py/pull/2796))

* Introduce OutOfMemoryError exception for Redis write command rejections due to OOM errors ([#2778](https://github.com/redis/redis-py/pull/2778))

* expose OutOfMemoryError as explicit exception type

- handle "OOM" error code string by raising explicit
  exception type instance
- enables callers to avoid string matching after
  catching ResponseError

* add OutOfMemoryError exception class docstring

* Provide more info in the exception docstring

* Fix formatting

* Again

* linters

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Add unit tests for the `connect` method of all Redis connection classes ([#2631](https://github.com/redis/redis-py/pull/2631))

* tests: move certificate discovery to a separate module

* tests: add 'connect' tests for all Redis connection classes

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix dead weakref in sentinel connection causing ReferenceError ([#2767](https://github.com/redis/redis-py/issues/2767)) ([#2771](https://github.com/redis/redis-py/pull/2771))

* Fix dead weakref in sentinel conn ([#2767](https://github.com/redis/redis-py/issues/2767))

* Update CHANGES

---------

Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* chore(documentation): fix redirects and some small cleanups ([#2801](https://github.com/redis/redis-py/pull/2801))

* Add waitaof ([#2760](https://github.com/redis/redis-py/pull/2760))

* Add waitaof

* Update test_commands.py

add test_waitaof

* Update test_commands.py

Add test_waitaof

* Fix doc string

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>

* Extract abstract async connection class ([#2734](https://github.com/redis/redis-py/pull/2734))

* make 'socket_timeout' and 'socket_connect_timeout' equivalent for TCP and UDS connections

* abstract asynio connection in analogy with the synchronous connection

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix type hint for retry_on_error in async cluster ([#2804](https://github.com/redis/redis-py/pull/2804))

* fix(asyncio.cluster): fixup retry_on_error type hint

This parameter accepts a list of _classes of Exceptions_, not a list of instantiated Exceptions. Fixup the type hint accordingly.

* chore: update changelog

---------

Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>

* Fix CI ([#2809](https://github.com/redis/redis-py/pull/2809))

* Support JSON.MSET Command ([#2766](https://github.com/redis/redis-py/pull/2766))

* support JSON.MERGE Command

* linters

* try with abc instead person

* change @skip_ifmodversion_lt to latest ReJSON 2.4.7

* change version

* fix test

* linters

* add async test

* Support JSON.MSET command

* trying to run CI

* linters

* add async test

* reminder do delete the integration changes

* delete the line from integration

* fix the interface

* change docstring

---------

Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>

* Version 4.6.0 ([#2810](https://github.com/redis/redis-py/pull/2810))

* master changes

* linters

* fix test_cwe_404 cluster test

---------

Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>

* RESP3 response-callbacks cleanup ([#2841](https://github.com/redis/redis-py/pull/2841))

* cluenup

* sentinel callbacks

* move callbacks

* fix async cluster tests

* _parsers and import fix in tests

* linters

* make modules callbacks private

* fix async search

* fix

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>

* Version 5.0.0rc2 ([#2843](https://github.com/redis/redis-py/pull/2843))

* linters

---------

Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
```

[chayim](/chayim)
pushed a commit
that referenced
this pull request
[Aug 31, 2023](#ref-commit-0e56165)
[![@dwdougherty](https://avatars.githubusercontent.com/u/1371932?s=40&v=4)](/dwdougherty)

`[DOC-2544: Adding new doctest to support updated VSS article (](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b "DOC-2544: Adding new doctest to support updated VSS article (#2886)

Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung \"Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix (#2566)
Fix unlink in cluster pipeline (#2562)
Fix issue 2540: Synchronise concurrent command calls to single-client mode. (#2568)
Fix: tuple function cannot be passed more than one argument (#2573)
Fix issue 2567: NoneType check before raising exception (#2569)
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() (#2557)
Fix issue with `pack_commands` returning an empty byte sequence (#2416)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' (#2583)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing (#2590)
Fixed CredentialsProvider examples (#2587)
Fixed issue #2598 - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout (#2602)
Fix behaviour of async PythonParser to match RedisParser as for issue #2349 (#2582)
Fix (#2641)
fix: do not use asyncio's timeout lib before 3.11.2 (#2659)
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)
Fixing cancelled async futures (#2666)
Fix async (#2673)
Fix memory leak caused by hiredis (#2693) (#2694)
Fix incorrect usage of once flag in async Sentinel (#2718)
Fix topk list example. (#2724)
Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)
Fix potential race condition during disconnection (#2719)
fix CI (#2748)
fix parse_slowlog_get (#2732)
fixes for issue #1128
fix create single_connection_client from url (#2752)
Fix `xadd` allow non negative maxlen (#2739)
Fix JSON.MERGE Summary (#2786)
Fixed key error in parse_xinfo_stream (#2788)
Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)
Fix dead weakref in sentinel conn (#2767)
fix redirects and some small cleanups (#2801)
Fix type hint for retry_on_error in async cluster (#2804)
Fix CI (#2809)
Fix async client with resp3 (#2657)
Fix `COMMAND` response in resp3 (redis 7+) (#2740)
Fix protocol version checking (#2737)
Fix parse resp3 dict response: don't use dict comprehension (#2757)
Fixing asyncio import (#2759)
fix (#2799)
fix async tests (#2806)
Fix socket garbage collection (#2859)
Fixing doc builds (#2869)
Fix a duplicate word in `CONTRIBUTING.md` (#2848)
Fix timeout retrying on Redis pipeline execution (#2812)
Fix type hints in SearchCommands (#2817)")[#2886](https://github.com/redis/redis-py/pull/2886)[)](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b "DOC-2544: Adding new doctest to support updated VSS article (#2886)

Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung \"Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix (#2566)
Fix unlink in cluster pipeline (#2562)
Fix issue 2540: Synchronise concurrent command calls to single-client mode. (#2568)
Fix: tuple function cannot be passed more than one argument (#2573)
Fix issue 2567: NoneType check before raising exception (#2569)
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() (#2557)
Fix issue with `pack_commands` returning an empty byte sequence (#2416)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' (#2583)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing (#2590)
Fixed CredentialsProvider examples (#2587)
Fixed issue #2598 - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout (#2602)
Fix behaviour of async PythonParser to match RedisParser as for issue #2349 (#2582)
Fix (#2641)
fix: do not use asyncio's timeout lib before 3.11.2 (#2659)
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)
Fixing cancelled async futures (#2666)
Fix async (#2673)
Fix memory leak caused by hiredis (#2693) (#2694)
Fix incorrect usage of once flag in async Sentinel (#2718)
Fix topk list example. (#2724)
Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)
Fix potential race condition during disconnection (#2719)
fix CI (#2748)
fix parse_slowlog_get (#2732)
fixes for issue #1128
fix create single_connection_client from url (#2752)
Fix `xadd` allow non negative maxlen (#2739)
Fix JSON.MERGE Summary (#2786)
Fixed key error in parse_xinfo_stream (#2788)
Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)
Fix dead weakref in sentinel conn (#2767)
fix redirects and some small cleanups (#2801)
Fix type hint for retry_on_error in async cluster (#2804)
Fix CI (#2809)
Fix async client with resp3 (#2657)
Fix `COMMAND` response in resp3 (redis 7+) (#2740)
Fix protocol version checking (#2737)
Fix parse resp3 dict response: don't use dict comprehension (#2757)
Fixing asyncio import (#2759)
fix (#2799)
fix async tests (#2806)
Fix socket garbage collection (#2859)
Fixing doc builds (#2869)
Fix a duplicate word in `CONTRIBUTING.md` (#2848)
Fix timeout retrying on Redis pipeline execution (#2812)
Fix type hints in SearchCommands (#2817)")`
…

`[0e56165](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b)`

```
Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung "Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix ([#2566](https://github.com/redis/redis-py/pull/2566))
Fix unlink in cluster pipeline ([#2562](https://github.com/redis/redis-py/pull/2562))
Fix issue 2540: Synchronise concurrent command calls to single-client mode. ([#2568](https://github.com/redis/redis-py/pull/2568))
Fix: tuple function cannot be passed more than one argument ([#2573](https://github.com/redis/redis-py/pull/2573))
Fix issue 2567: NoneType check before raising exception ([#2569](https://github.com/redis/redis-py/pull/2569))
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() ([#2557](https://github.com/redis/redis-py/pull/2557))
Fix issue with `pack_commands` returning an empty byte sequence ([#2416](https://github.com/redis/redis-py/pull/2416))
Fix [#2581](https://github.com/redis/redis-py/issues/2581) UnixDomainSocketConnection' object has no attribute '_command_packer' ([#2583](https://github.com/redis/redis-py/pull/2583))
Fix [#2581](https://github.com/redis/redis-py/issues/2581) UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing ([#2590](https://github.com/redis/redis-py/pull/2590))
Fixed CredentialsProvider examples ([#2587](https://github.com/redis/redis-py/pull/2587))
Fixed issue [#2598](https://github.com/redis/redis-py/issues/2598) - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout ([#2602](https://github.com/redis/redis-py/pull/2602))
Fix behaviour of async PythonParser to match RedisParser as for issue [#2349](https://github.com/redis/redis-py/issues/2349) ([#2582](https://github.com/redis/redis-py/pull/2582))
Fix ([#2641](https://github.com/redis/redis-py/pull/2641))
fix: do not use asyncio's timeout lib before 3.11.2 ([#2659](https://github.com/redis/redis-py/pull/2659))
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client ([#2669](https://github.com/redis/redis-py/pull/2669))
Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))
Fix async ([#2673](https://github.com/redis/redis-py/pull/2673))
Fix memory leak caused by hiredis ([#2693](https://github.com/redis/redis-py/issues/2693)) ([#2694](https://github.com/redis/redis-py/pull/2694))
Fix incorrect usage of once flag in async Sentinel ([#2718](https://github.com/redis/redis-py/pull/2718))
Fix topk list example. ([#2724](https://github.com/redis/redis-py/pull/2724))
Fix `ClusterCommandProtocol` not itself being marked as a protocol ([#2729](https://github.com/redis/redis-py/pull/2729))
Fix potential race condition during disconnection ([#2719](https://github.com/redis/redis-py/pull/2719))
fix CI ([#2748](https://github.com/redis/redis-py/pull/2748))
fix parse_slowlog_get ([#2732](https://github.com/redis/redis-py/pull/2732))
fixes for issue [#1128](https://github.com/redis/redis-py/issues/1128)
fix create single_connection_client from url ([#2752](https://github.com/redis/redis-py/pull/2752))
Fix `xadd` allow non negative maxlen ([#2739](https://github.com/redis/redis-py/pull/2739))
Fix JSON.MERGE Summary ([#2786](https://github.com/redis/redis-py/pull/2786))
Fixed key error in parse_xinfo_stream ([#2788](https://github.com/redis/redis-py/pull/2788))
Fix dead weakref in sentinel connection causing ReferenceError ([#2767](https://github.com/redis/redis-py/issues/2767)) ([#2771](https://github.com/redis/redis-py/pull/2771))
Fix dead weakref in sentinel conn ([#2767](https://github.com/redis/redis-py/issues/2767))
fix redirects and some small cleanups ([#2801](https://github.com/redis/redis-py/pull/2801))
Fix type hint for retry_on_error in async cluster ([#2804](https://github.com/redis/redis-py/pull/2804))
Fix CI ([#2809](https://github.com/redis/redis-py/pull/2809))
Fix async client with resp3 ([#2657](https://github.com/redis/redis-py/pull/2657))
Fix `COMMAND` response in resp3 (redis 7+) ([#2740](https://github.com/redis/redis-py/pull/2740))
Fix protocol version checking ([#2737](https://github.com/redis/redis-py/pull/2737))
Fix parse resp3 dict response: don't use dict comprehension ([#2757](https://github.com/redis/redis-py/pull/2757))
Fixing asyncio import ([#2759](https://github.com/redis/redis-py/pull/2759))
fix ([#2799](https://github.com/redis/redis-py/pull/2799))
fix async tests ([#2806](https://github.com/redis/redis-py/pull/2806))
Fix socket garbage collection ([#2859](https://github.com/redis/redis-py/pull/2859))
Fixing doc builds ([#2869](https://github.com/redis/redis-py/pull/2869))
Fix a duplicate word in `CONTRIBUTING.md` ([#2848](https://github.com/redis/redis-py/pull/2848))
Fix timeout retrying on Redis pipeline execution ([#2812](https://github.com/redis/redis-py/pull/2812))
Fix type hints in SearchCommands ([#2817](https://github.com/redis/redis-py/pull/2817))
```

This was referenced May 1, 2024

[MEDIUM - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#27](/FabioBartoli/Linuxtips-telegram-communication/issues/27)

Closed

[MEDIUM: redis - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#41](/FabioBartoli/Linuxtips-telegram-communication/issues/41)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2666)

Reviewers

[![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=40&v=4)](/jamestiotio) [jamestiotio](/jamestiotio)

jamestiotio left review comments

[![@fps7806](https://avatars.githubusercontent.com/u/7218057?s=40&v=4)](/fps7806) [fps7806](/fps7806)

fps7806 left review comments

[![@sileht](https://avatars.githubusercontent.com/u/200878?s=40&v=4)](/sileht) [sileht](/sileht)

sileht left review comments

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h) [dvora-h](/dvora-h)

dvora-h approved these changes

Assignees

No one assigned

Labels

[bug](/redis/redis-py/labels/bug)
Bug
[experimental](/redis/redis-py/labels/experimental)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

9 participants

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=52&v=4)](/chayim) [![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=52&v=4)](/codecov-commenter) [![@risicle](https://avatars.githubusercontent.com/u/807447?s=52&v=4)](/risicle) [![@kristjanvalur](https://avatars.githubusercontent.com/u/6009543?s=52&v=4)](/kristjanvalur) [![@agronholm](https://avatars.githubusercontent.com/u/130003?s=52&v=4)](/agronholm) [![@sileht](https://avatars.githubusercontent.com/u/200878?s=52&v=4)](/sileht) [![@fps7806](https://avatars.githubusercontent.com/u/7218057?s=52&v=4)](/fps7806) [![@jamestiotio](https://avatars.githubusercontent.com/u/18364745?s=52&v=4)](/jamestiotio) [![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=52&v=4)](/dvora-h)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_513b7d1d_20250115_113825.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-8fww-64cx-x8p5)

**CVE-2023-28859**

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fadvisories%2FGHSA-8fww-64cx-x8p5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2Fadvisories%2F%3Cid%3E&source=header)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

1. [GitHub Advisory Database](/advisories)
2. [GitHub Reviewed](/advisories?query=type%3Areviewed)
3. [CVE-2023-28859](/advisories/GHSA-8fww-64cx-x8p5)

## redis-py Race Condition due to incomplete fix

High severity

GitHub Reviewed

Published
Mar 26, 2023
to the GitHub Advisory Database
•
Updated Oct 25, 2024

[Vulnerability details](/advisories/GHSA-8fww-64cx-x8p5)
[Dependabot alerts
0](/advisories/GHSA-8fww-64cx-x8p5/dependabot)

## Package

pip

redis
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

>= 4.5.0, < 4.5.4
>= 4.2.0, < 4.4.4

## Patched versions

4.5.4
4.4.4

## Description

redis-py through 4.5.3 and 4.4.3 leaves a connection open after canceling an async Redis command at an inopportune time (in the case of a non-pipeline operation), and can send response data to the client of an unrelated request. NOTE: this issue exists because of an incomplete fix for [CVE-2023-28858](https://github.com/advisories/GHSA-24wv-mv5m-xv4h "CVE-2023-28858").

### References

* <https://nvd.nist.gov/vuln/detail/CVE-2023-28859>
* [redis/redis-py#2665](https://github.com/redis/redis-py/issues/2665)
* [redis/redis-py#2641](https://github.com/redis/redis-py/pull/2641)
* [redis/redis-py#2666](https://github.com/redis/redis-py/pull/2666)
* [redis/redis-py#2671](https://github.com/redis/redis-py/pull/2671)
* <https://github.com/redis/redis-py/releases/tag/v4.4.4>
* <https://github.com/redis/redis-py/releases/tag/v4.5.4>
* <https://github.com/pypa/advisory-database/tree/main/vulns/redis/PYSEC-2023-46.yaml>
* [redis/redis-py#1899](https://github.com/redis/redis-py/pull/1899)
* [redis/redis-py@66a4d6b](https://github.com/redis/redis-py/commit/66a4d6b2a493dd3a20cc299ab5fef3c14baad965)
* [redis/redis-py@b3c89ac](https://github.com/redis/redis-py/commit/b3c89acd0ffe8303649ad8207bc911b1d6a033eb)

Published by the [National Vulnerability Database](https://nvd.nist.gov/vuln/detail/CVE-2023-28859)
Mar 26, 2023

Published to the GitHub Advisory Database
Mar 26, 2023

Reviewed
Mar 27, 2023

Last updated
Oct 25, 2024

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector
Network

Attack Complexity
Low

Attack Requirements
None

Privileges Required
Low

User interaction
None
##### Vulnerable System Impact Metrics

Confidentiality
High

Integrity
None

Availability
None
##### Subsequent System Impact Metrics

Confidentiality
None

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v4 base metrics

##### Exploitability Metrics

Attack Vector:
This metric reflects the context by which vulnerability exploitation is possible. This metric value (and consequently the resulting severity) will be larger the more remote (logically, and physically) an attacker can be in order to exploit the vulnerable system. The assumption is that the number of potential attackers for a vulnerability that could be exploited from across a network is larger than the number of potential attackers that could exploit a vulnerability requiring physical access to a device, and therefore warrants a greater severity.

Attack Complexity:
This metric captures measurable actions that must be taken by the attacker to actively evade or circumvent existing built-in security-enhancing conditions in order to obtain a working exploit. These are conditions whose primary purpose is to increase security and/or increase exploit engineering complexity. A vulnerability exploitable without a target-specific variable has a lower complexity than a vulnerability that would require non-trivial customization. This metric is meant to capture security mechanisms utilized by the vulnerable system.

Attack Requirements:
This metric captures the prerequisite deployment and execution conditions or variables of the vulnerable system that enable the attack. These differ from security-enhancing techniques/technologies (ref Attack Complexity) as the primary purpose of these conditions is not to explicitly mitigate attacks, but rather, emerge naturally as a consequence of the deployment and execution of the vulnerable system.

Privileges Required:
This metric describes the level of privileges an attacker must possess prior to successfully exploiting the vulnerability. The method by which the attacker obtains privileged credentials prior to the attack (e.g., free trial accounts), is outside the scope of this metric. Generally, self-service provisioned accounts do not constitute a privilege requirement if the attacker can grant themselves privileges as part of the attack.

User interaction:
This metric captures the requirement for a human user, other than the attacker, to participate in the successful compromise of the vulnerable system. This metric determines whether the vulnerability can be exploited solely at the will of the attacker, or whether a separate user (or user-initiated process) must participate in some manner.
##### Vulnerable System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the VULNERABLE SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the VULNERABLE SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the VULNERABLE SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.
##### Subsequent System Impact Metrics

Confidentiality:
This metric measures the impact to the confidentiality of the information managed by the SUBSEQUENT SYSTEM due to a successfully exploited vulnerability. Confidentiality refers to limiting information access and disclosure to only authorized users, as well as preventing access by, or disclosure to, unauthorized ones.

Integrity:
This metric measures the impact to integrity of a successfully exploited vulnerability. Integrity refers to the trustworthiness and veracity of information. Integrity of the SUBSEQUENT SYSTEM is impacted when an attacker makes unauthorized modification of system data. Integrity is also impacted when a system user can repudiate critical actions taken in the context of the system (e.g. due to insufficient logging).

Availability:
This metric measures the impact to the availability of the SUBSEQUENT SYSTEM resulting from a successfully exploited vulnerability. While the Confidentiality and Integrity impact metrics apply to the loss of confidentiality or integrity of data (e.g., information, files) used by the system, this metric refers to the loss of availability of the impacted system itself, such as a networked service (e.g., web, database, email). Since availability refers to the accessibility of information resources, attacks that consume network bandwidth, processor cycles, or disk space all impact the availability of a system.

 CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:N/VA:N/SC:N/SI:N/SA:N

### [EPSS score](https://www.first.org/epss/user-guide)

0.094%
 (41st percentile)

### Weaknesses

[CWE-459](/advisories?query=cwe%3A459)

### CVE ID

CVE-2023-28859

### GHSA ID

GHSA-8fww-64cx-x8p5

### Source code

[redis/redis-py](https://github.com/redis/redis-py)

### Credits

* [![@artoj-iceye](https://avatars.githubusercontent.com/u/101089661?s=40&v=4)](/artoj-iceye)
  [artoj-iceye](/artoj-iceye)
  Analyst
* [![@sreecharanguduri](https://avatars.githubusercontent.com/u/97174322?s=40&v=4)](/sreecharanguduri)
  [sreecharanguduri](/sreecharanguduri)
  Analyst

 Loading

Checking history

See something to contribute?
[Suggest improvements for this vulnerability](/advisories/GHSA-8fww-64cx-x8p5/improve).

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e14f15b2_20250114_190552.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fissues%2F2665)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fissues%2F2665)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=redis%2Fredis-py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[redis](/redis)
/
**[redis-py](/redis/redis-py)**
Public

* [Notifications](/login?return_to=%2Fredis%2Fredis-py) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fredis%2Fredis-py)
* [Star
   12.8k](/login?return_to=%2Fredis%2Fredis-py)

* [Code](/redis/redis-py)
* [Issues
  206](/redis/redis-py/issues)
* [Pull requests
  72](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects
  0](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

Additional navigation options

* [Code](/redis/redis-py)
* [Issues](/redis/redis-py/issues)
* [Pull requests](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

# Canceling async Redis command leaves connection open, in unsafe state for future commands #2665

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#2674](https://github.com/redis/redis-py/pull/2674)Closed[Canceling async Redis command leaves connection open, in unsafe state for future commands](#top)#2665[#2674](https://github.com/redis/redis-py/pull/2674)Copy link![@drago-balto](https://avatars.githubusercontent.com/u/84727709?v=4&size=80)
## Description

![@drago-balto](https://avatars.githubusercontent.com/u/84727709?v=4&size=48)[drago-balto](https://github.com/drago-balto)opened [on Mar 25, 2023](https://github.com/redis/redis-py/issues/2665#issue-1640603645)

**Version**: 4.5.3

**Platform**: Python 3.8 on Ubuntu / Generic

**Description**: Canceling async Redis command leaves connection open, in unsafe state for future commands

This is a reincarnation of [#2624](https://github.com/redis/redis-py/issues/2624), which was closed with an incomplete fix and a possibly unreliable test case. This is the same issue that recently got a lot of attention due to ChatGPT outage, and that remains only partially fixed. The cancellation shielding introduced in [#2641](https://github.com/redis/redis-py/pull/2641) addressed only the cancellation of Redis pipeline operation, but non-pipelined ops are still vulnerable.

This time I am attaching a script that reproduces the issue reliably without relying on an external, slow Redis server. This is achieved by inserting a small TCP socket proxy between the Redis client and local Redis server, with the proxy introducing a 0.1 second delay when sending data in either direction.

Running this script with a Redis server running locally on port 6379 produces the following output:

```
$ python redis_cancel.py
managed to cancel the task, connection is left open with unread response
bar: b'foo'
ping: False
foo: b'PONG'

```

```
import asyncio

from redis.asyncio import Redis

async def pipe(reader: asyncio.StreamReader, writer: asyncio.StreamWriter, delay: float, name=''):
    while data := await reader.read(1000):
        # print(name, 'received:', data)
        await asyncio.sleep(delay)
        writer.write(data)
        await writer.drain()

class DelayProxy:

    def __init__(self, addr, redis_addr, delay: float):
        self.addr = addr
        self.redis_addr = redis_addr
        self.delay = delay

    async def start(self):
        server = await asyncio.start_server(self.handle, *self.addr)
        asyncio.create_task(server.serve_forever())

    async def handle(self, reader, writer):
        # establish connection to redis
        redis_reader, redis_writer = await asyncio.open_connection(*self.redis_addr)
        pipe1 = asyncio.create_task(pipe(reader, redis_writer, self.delay, 'to redis:'))
        pipe2 = asyncio.create_task(pipe(redis_reader, writer, self.delay, 'from redis:'))
        await asyncio.gather(pipe1, pipe2)

async def main():

    # create a tcp socket proxy that relays data to Redis and back, inserting 0.1 seconds of delay
    dp = DelayProxy(addr=('localhost', 6380), redis_addr=('localhost', 6379), delay=0.1)
    await dp.start()

    # note that we connect to proxy, rather than to Redis directly
    async with Redis(host='localhost', port=6380) as r:

        await r.set('foo', 'foo')
        await r.set('bar', 'bar')

        t = asyncio.create_task(r.get('foo'))
        await asyncio.sleep(0.050)
        t.cancel()
        try:
            await t
            print('try again, we did not cancel the task in time')
        except asyncio.CancelledError:
            print('managed to cancel the task, connection is left open with unread response')

        print('bar:', await r.get('bar'))
        print('ping:', await r.ping())
        print('foo:', await r.get('foo'))

if __name__ == '__main__':
    asyncio.run(main())
```
👍8👀4
## Metadata

### Assignees

No one assigned

### Labels

No labelsNo labels
### Type

No type
### Projects

No projects
### Milestone

No milestone

### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1c23ac08_20250114_190600.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Freleases%2Ftag%2Fv4.5.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Freleases%2Ftag%2Fv4.5.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=redis%2Fredis-py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[redis](/redis)
/
**[redis-py](/redis/redis-py)**
Public

* [Notifications](/login?return_to=%2Fredis%2Fredis-py) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fredis%2Fredis-py)
* [Star
   12.8k](/login?return_to=%2Fredis%2Fredis-py)

* [Code](/redis/redis-py/tree/v4.5.4)
* [Issues
  206](/redis/redis-py/issues)
* [Pull requests
  72](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects
  0](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

Additional navigation options

* [Code](/redis/redis-py/tree/v4.5.4)
* [Issues](/redis/redis-py/issues)
* [Pull requests](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

1. [Releases](/redis/redis-py/releases)
2. [v4.5.4](/redis/redis-py/releases/tag/v4.5.4)

# 4.5.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/redis/redis-py/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v4.5.4)

 Loading

[View all tags](/redis/redis-py/tags)

![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)
[github-actions](/apps/github-actions)
released this
29 Mar 13:23

·
[249 commits](/redis/redis-py/compare/v4.5.4...refs/heads/master)
to refs/heads/master
since this release

[v4.5.4](/redis/redis-py/tree/v4.5.4)

[`e1017fd`](/redis/redis-py/commit/e1017fd77afd2f56dca90f986fc82e398e518a26)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Changes

Upgrade urgency: SECURITY, contains fixes to security issues.

* ([CVE-2023-28859](https://github.com/advisories/GHSA-8fww-64cx-x8p5 "CVE-2023-28859")) - Cancelling an async future does not, properly trigger, leading to a potential data leak in specific cases.
* ([CVE-2023-28858](https://github.com/advisories/GHSA-24wv-mv5m-xv4h "CVE-2023-28858")) - Cancelling an async future does not, properly trigger, leading to a potential data leak in specific cases.

## 🐛 Bug Fixes

* Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))
* Fix: do not use asyncio's timeout lib before 3.11.2 ([#2659](https://github.com/redis/redis-py/pull/2659))
* Fix UDS in v4.5.2: UnixDomainSocketConnection missing constructor argument ([#2630](https://github.com/redis/redis-py/pull/2630))

## 🧰 Maintenance

* Minor fixes for [#2666](https://github.com/redis/redis-py/pull/2666) and enhanced async test ([#2673](https://github.com/redis/redis-py/pull/2673))
* Fix issue 2660: PytestUnraisableExceptionWarning from asycio client ([#2669](https://github.com/redis/redis-py/pull/2669))
* Removing accidentally checked in files ([#2642](https://github.com/redis/redis-py/pull/2642))

## Contributors

We'd like to thank all the contributors who worked on this release!

[@bellini666](https://github.com/bellini666), [@chayim](https://github.com/chayim), [@dvora-h](https://github.com/dvora-h), [@shacharPash](https://github.com/shacharPash) and [@woutdenolf](https://github.com/woutdenolf)

### Contributors

* [![@bellini666](https://avatars.githubusercontent.com/u/134025?s=64&v=4)](https://github.com/bellini666)
* [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=64&v=4)](https://github.com/chayim)
* [![@woutdenolf](https://avatars.githubusercontent.com/u/7264703?s=64&v=4)](https://github.com/woutdenolf)
* [![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=64&v=4)](https://github.com/dvora-h)
* [![@shacharPash](https://avatars.githubusercontent.com/u/93581407?s=64&v=4)](https://github.com/shacharPash)

bellini666, chayim, and 3 other contributors

 Assets
2

 Loading

 👍
4
 ShadowUser17, hyeongguen-song, DmytroLitvinov, and deepanjan-nsk reacted with thumbs up emoji
 🎉
3
 crisvlean, jacobowitz, and afvca reacted with hooray emoji
 🚀
1
 leynier reacted with rocket emoji
 👀
1
 douglasjunior reacted with eyes emoji

All reactions

* 👍
  4 reactions
* 🎉
  3 reactions
* 🚀
  1 reaction
* 👀
  1 reaction

 9 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_22206db0_20250114_190553.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2641)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2641)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=redis%2Fredis-py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[redis](/redis)
/
**[redis-py](/redis/redis-py)**
Public

* [Notifications](/login?return_to=%2Fredis%2Fredis-py) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fredis%2Fredis-py)
* [Star
   12.8k](/login?return_to=%2Fredis%2Fredis-py)

* [Code](/redis/redis-py)
* [Issues
  206](/redis/redis-py/issues)
* [Pull requests
  72](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects
  0](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

Additional navigation options

* [Code](/redis/redis-py)
* [Issues](/redis/redis-py/issues)
* [Pull requests](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fredis%2Fredis-py%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fredis%2Fredis-py%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# AsyncIO Race Condition Fix #2641

 Merged

[chayim](/chayim)
merged 5 commits into
[redis:master](/redis/redis-py/tree/master "redis/redis-py:master")
from
[chayim:ck-asyncio](/chayim/redis-py/tree/ck-asyncio "chayim/redis-py:ck-asyncio")

Mar 22, 2023

 Merged

# [AsyncIO Race Condition Fix](#top) #2641

[chayim](/chayim)
merged 5 commits into
[redis:master](/redis/redis-py/tree/master "redis/redis-py:master")
from
[chayim:ck-asyncio](/chayim/redis-py/tree/ck-asyncio "chayim/redis-py:ck-asyncio")

Mar 22, 2023

+764

−6

[Conversation
3](/redis/redis-py/pull/2641)
[Commits
5](/redis/redis-py/pull/2641/commits)
[Checks
0](/redis/redis-py/pull/2641/checks)
[Files changed
7](/redis/redis-py/pull/2641/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![chayim](https://avatars.githubusercontent.com/u/1333958?s=60&v=4)](/chayim)

Copy link

Contributor

### @chayim **[chayim](/chayim)** commented [Mar 22, 2023](#issue-1635870913) • edited Loading

closes [#2624](https://github.com/redis/redis-py/issues/2624)

closes [#2579](https://github.com/redis/redis-py/issues/2579)

Sorry, something went wrong.

 🎉
3
 merunes-goldman, lzm0, and jondcallahan reacted with hooray emoji
 ❤️
1
 transitive-bullshit reacted with heart emoji

All reactions

* 🎉
  3 reactions
* ❤️
  1 reaction

 [chayim](/chayim)
added 3 commits
[March 22, 2023 10:29](#commits-pushed-7bebfe5)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[guard](/redis/redis-py/pull/2641/commits/7bebfe526e22a6e6ea37150598ccd2ee4105e38f "guard")`

`[7bebfe5](/redis/redis-py/pull/2641/commits/7bebfe526e22a6e6ea37150598ccd2ee4105e38f)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[fixing variable in cancel](/redis/redis-py/pull/2641/commits/c8f4b24dd594e70259c849315f8f720a6a7d6bfb "fixing variable in cancel")`

`[c8f4b24](/redis/redis-py/pull/2641/commits/c8f4b24dd594e70259c849315f8f720a6a7d6bfb)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[version change](/redis/redis-py/pull/2641/commits/3e0e0044914c7cffc22ff2b776bc7a3b2cf16e18 "version change")`

`[3e0e004](/redis/redis-py/pull/2641/commits/3e0e0044914c7cffc22ff2b776bc7a3b2cf16e18)`

 [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
requested review from
[leibale](/leibale) and
[dvora-h](/dvora-h)
[March 22, 2023 14:25](#event-8817472958)

[![leibale](https://avatars.githubusercontent.com/u/7086055?s=60&v=4)](/leibale)

**[leibale](/leibale)**
approved these changes
[Mar 22, 2023](#pullrequestreview-1352746591)

 [View reviewed changes](/redis/redis-py/pull/2641/files/3e0e0044914c7cffc22ff2b776bc7a3b2cf16e18)

 [chayim](/chayim)
added 2 commits
[March 22, 2023 16:49](#commits-pushed-900e2c0)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[and tests](/redis/redis-py/pull/2641/commits/900e2c0088af4fd491f805ed078ea231d83352cf "and tests")`

`[900e2c0](/redis/redis-py/pull/2641/commits/900e2c0088af4fd491f805ed078ea231d83352cf)`

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)

`[removing file](/redis/redis-py/pull/2641/commits/53302573ceec22a1787a26741bd3e106bb93b276 "removing file")`

`[5330257](/redis/redis-py/pull/2641/commits/53302573ceec22a1787a26741bd3e106bb93b276)`

[![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=80&u=b7ee84d82e25b493051d810390e97b15f716d7ef&v=4)](/codecov-commenter)

Copy link

### **[codecov-commenter](/codecov-commenter)** commented [Mar 22, 2023](#issuecomment-1479761564)

|  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| [Codecov](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) Report Patch coverage: **`44.73`**% and project coverage change: **`-14.06`** ⚠️  Comparison is base [(`318b114`)](https://codecov.io/gh/redis/redis-py/commit/318b114f4da9846a2a7c150e1fb702e9bebd9fdf?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) 92.28% compared to head [(`900e2c0`)](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) 78.22%.  ❗ Current head [900e2c0](https://github.com/redis/redis-py/commit/900e2c0088af4fd491f805ed078ea231d83352cf) differs from pull request most recent head [5330257](https://github.com/redis/redis-py/commit/53302573ceec22a1787a26741bd3e106bb93b276). Consider uploading reports for the commit [5330257](https://github.com/redis/redis-py/commit/53302573ceec22a1787a26741bd3e106bb93b276) to get more accurate results  📣 This organization is not using Codecov’s [GitHub App Integration](https://github.com/apps/codecov). We recommend you install it so Codecov can continue to function properly for your repositories. [Learn more](https://about.codecov.io/blog/codecov-is-updating-its-github-integration/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) Additional details and impacted files ``` @@             Coverage Diff             @@ ##           master    #2641       +/-   ## =========================================== - Coverage   92.28%   78.22%   -14.06%      ===========================================   Files         115      115                  Lines       29751    29787       +36      =========================================== - Hits        27455    23301     -4154      - Misses       2296     6486     +4190      ```  | [Impacted Files](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis) | Coverage Δ |  | | --- | --- | --- | | [setup.py](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-c2V0dXAucHk=) | `0.00% <ø> (ø)` |  | | [tests/test\_asyncio/test\_cluster.py](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfY2x1c3Rlci5weQ==) | `18.42% <7.69%> (-79.06%)` | ⬇️ | | [redis/asyncio/cluster.py](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-cmVkaXMvYXN5bmNpby9jbHVzdGVyLnB5) | `16.99% <16.66%> (-74.69%)` | ⬇️ | | [redis/asyncio/client.py](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-cmVkaXMvYXN5bmNpby9jbGllbnQucHk=) | `92.80% <50.00%> (-0.47%)` | ⬇️ | | [tests/test\_asyncio/test\_connection.py](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis#diff-dGVzdHMvdGVzdF9hc3luY2lvL3Rlc3RfY29ubmVjdGlvbi5weQ==) | `96.47% <86.66%> (-1.60%)` | ⬇️ |   ... and [38 files with indirect coverage changes](https://codecov.io/gh/redis/redis-py/pull/2641/indirect-changes?src=pr&el=tree-more&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis)  Help us with your feedback. Take ten seconds to tell us [how you rate us](https://about.codecov.io/nps?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). Have a feature suggestion? [Share it here.](https://app.codecov.io/gh/feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis)  [☔ View full report in Codecov by Sentry](https://codecov.io/gh/redis/redis-py/pull/2641?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). 📢 Do you have feedback about the report comment? [Let us know in this issue](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=redis). |

All reactions

Sorry, something went wrong.

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
added
the
[bug](/redis/redis-py/labels/bug)
Bug
label
[Mar 22, 2023](#event-8818646104)

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
merged commit [`66a4d6b`](/redis/redis-py/commit/66a4d6b2a493dd3a20cc299ab5fef3c14baad965)
into
redis:master

[Mar 22, 2023](https://github.com/redis/redis-py/pull/2641#event-8818652088)

[![@drago-balto](https://avatars.githubusercontent.com/u/84727709?s=80&v=4)](/drago-balto)

Copy link

### **[drago-balto](/drago-balto)** commented [Mar 22, 2023](#issuecomment-1479957187)

| [@chayim](https://github.com/chayim) I think this only fixed the pipeline, while the race condition still exists in the `Redis` class:   [redis-py/redis/asyncio/client.py](https://github.com/redis/redis-py/blob/66a4d6b2a493dd3a20cc299ab5fef3c14baad965/redis/asyncio/client.py#L514)  Line 514 in [66a4d6b](/redis/redis-py/commit/66a4d6b2a493dd3a20cc299ab5fef3c14baad965)   |  | return await conn.retry.call\_with\_retry( | | --- | --- |      I can still reproduce [#2624](https://github.com/redis/redis-py/issues/2624) using the latest redis-py `4.5.3`.  Keep in mind that you need slow enough Redis connection to reproduce this, otherwise the cancellation does not happen simply because the entire RESP exchange with Redis happens before there is a chance to cancel the task.  Also, are you sure that shielding from cancellation is the right approach? For example, this means that there would be no way to cancel a blocking BLPOP. |
| --- | --- | --- |

 👍
1
 selfboot reacted with thumbs up emoji
 👀
11
 merunes-goldman, devhaozi, dgilmanAIDENTIFIED, transitive-bullshit, iKlsR, ifox, m-hammad-khan, danielwburch, shivanshu3, leonee, and Kxrr reacted with eyes emoji

All reactions

* 👍
  1 reaction
* 👀
  11 reactions

Sorry, something went wrong.

This was referenced Mar 24, 2023

[Off by 1 - Canceling async Redis command leaves connection open, in unsafe state for future commands
#2624](/redis/redis-py/issues/2624)

Closed

[Canceling async Redis command leaves connection open, in unsafe state for future commands
#2665](/redis/redis-py/issues/2665)

Closed

 [![@chayim](https://avatars.githubusercontent.com/u/1333958?s=40&v=4)](/chayim)
[chayim](/chayim)
deleted the
ck-asyncio

branch
[March 26, 2023 08:29](#event-8846792103)

[![@so1n](https://avatars.githubusercontent.com/u/28426591?s=80&v=4)](/so1n)

Copy link

### **[so1n](/so1n)** commented [Mar 26, 2023](#issuecomment-1484043843)

| [@chayim](https://github.com/chayim) I think this only fixed the pipeline, while the race condition still exists in the `Redis` class:     [redis-py/redis/asyncio/client.py](https://github.com/redis/redis-py/blob/66a4d6b2a493dd3a20cc299ab5fef3c14baad965/redis/asyncio/client.py#L514)  Line 514 in [66a4d6b](/redis/redis-py/commit/66a4d6b2a493dd3a20cc299ab5fef3c14baad965)   |  | return await conn.retry.call\_with\_retry( | | --- | --- |      I can still reproduce [#2624](https://github.com/redis/redis-py/issues/2624) using the latest redis-py `4.5.3`.  Keep in mind that you need slow enough Redis connection to reproduce this, otherwise the cancellation does not happen simply because the entire RESP exchange with Redis happens before there is a chance to cancel the task.  Also, are you sure that shielding from cancellation is the right approach? For example, this means that there would be no way to cancel a blocking BLPOP.  I found the same problem. Just install the Redis service locally and run the following code and it will definitely reproduce:  ``` import asyncio from redis.asyncio import Redis   async def main():     async with Redis(single_connection_client=True) as r:          await r.set('foo', 'foo')         await r.set('bar', 'bar')          t = asyncio.create_task(r.get('foo'))         await asyncio.sleep(0)  # <--- must 0          t.cancel()         try:             await t             print('try again, we did not cancel the task in time')         except asyncio.CancelledError as e:             print('managed to cancel the task, connection is left open with unread response')          print('bar:', await r.get('bar'))         print('ping:', await r.ping())         print('foo:', await r.get('foo'))   if __name__ == '__main__':     asyncio.run(main()) ``` |
| --- | --- | --- |

 👍
3
 mtomilov, selfboot, and LipezJ reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

Sorry, something went wrong.

[![@kurtseifried](https://avatars.githubusercontent.com/u/582211?s=40&v=4)](/kurtseifried)
[kurtseifried](/kurtseifried)
mentioned this pull request
[Mar 29, 2023](#ref-issue-1645020129)

[affected[].ranges[].type missing timestamp type
ossf/osv-schema#129](/ossf/osv-schema/issues/129)

Closed

[chayim](/chayim)
pushed a commit
that referenced
this pull request
[Aug 31, 2023](#ref-commit-0e56165)
[![@dwdougherty](https://avatars.githubusercontent.com/u/1371932?s=40&v=4)](/dwdougherty)

`[DOC-2544: Adding new doctest to support updated VSS article (](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b "DOC-2544: Adding new doctest to support updated VSS article (#2886)

Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung \"Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix (#2566)
Fix unlink in cluster pipeline (#2562)
Fix issue 2540: Synchronise concurrent command calls to single-client mode. (#2568)
Fix: tuple function cannot be passed more than one argument (#2573)
Fix issue 2567: NoneType check before raising exception (#2569)
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() (#2557)
Fix issue with `pack_commands` returning an empty byte sequence (#2416)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' (#2583)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing (#2590)
Fixed CredentialsProvider examples (#2587)
Fixed issue #2598 - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout (#2602)
Fix behaviour of async PythonParser to match RedisParser as for issue #2349 (#2582)
Fix (#2641)
fix: do not use asyncio's timeout lib before 3.11.2 (#2659)
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)
Fixing cancelled async futures (#2666)
Fix async (#2673)
Fix memory leak caused by hiredis (#2693) (#2694)
Fix incorrect usage of once flag in async Sentinel (#2718)
Fix topk list example. (#2724)
Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)
Fix potential race condition during disconnection (#2719)
fix CI (#2748)
fix parse_slowlog_get (#2732)
fixes for issue #1128
fix create single_connection_client from url (#2752)
Fix `xadd` allow non negative maxlen (#2739)
Fix JSON.MERGE Summary (#2786)
Fixed key error in parse_xinfo_stream (#2788)
Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)
Fix dead weakref in sentinel conn (#2767)
fix redirects and some small cleanups (#2801)
Fix type hint for retry_on_error in async cluster (#2804)
Fix CI (#2809)
Fix async client with resp3 (#2657)
Fix `COMMAND` response in resp3 (redis 7+) (#2740)
Fix protocol version checking (#2737)
Fix parse resp3 dict response: don't use dict comprehension (#2757)
Fixing asyncio import (#2759)
fix (#2799)
fix async tests (#2806)
Fix socket garbage collection (#2859)
Fixing doc builds (#2869)
Fix a duplicate word in `CONTRIBUTING.md` (#2848)
Fix timeout retrying on Redis pipeline execution (#2812)
Fix type hints in SearchCommands (#2817)")[#2886](https://github.com/redis/redis-py/pull/2886)[)](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b "DOC-2544: Adding new doctest to support updated VSS article (#2886)

Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung \"Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix (#2566)
Fix unlink in cluster pipeline (#2562)
Fix issue 2540: Synchronise concurrent command calls to single-client mode. (#2568)
Fix: tuple function cannot be passed more than one argument (#2573)
Fix issue 2567: NoneType check before raising exception (#2569)
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() (#2557)
Fix issue with `pack_commands` returning an empty byte sequence (#2416)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' (#2583)
Fix #2581 UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing (#2590)
Fixed CredentialsProvider examples (#2587)
Fixed issue #2598 - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout (#2602)
Fix behaviour of async PythonParser to match RedisParser as for issue #2349 (#2582)
Fix (#2641)
fix: do not use asyncio's timeout lib before 3.11.2 (#2659)
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client (#2669)
Fixing cancelled async futures (#2666)
Fix async (#2673)
Fix memory leak caused by hiredis (#2693) (#2694)
Fix incorrect usage of once flag in async Sentinel (#2718)
Fix topk list example. (#2724)
Fix `ClusterCommandProtocol` not itself being marked as a protocol (#2729)
Fix potential race condition during disconnection (#2719)
fix CI (#2748)
fix parse_slowlog_get (#2732)
fixes for issue #1128
fix create single_connection_client from url (#2752)
Fix `xadd` allow non negative maxlen (#2739)
Fix JSON.MERGE Summary (#2786)
Fixed key error in parse_xinfo_stream (#2788)
Fix dead weakref in sentinel connection causing ReferenceError (#2767) (#2771)
Fix dead weakref in sentinel conn (#2767)
fix redirects and some small cleanups (#2801)
Fix type hint for retry_on_error in async cluster (#2804)
Fix CI (#2809)
Fix async client with resp3 (#2657)
Fix `COMMAND` response in resp3 (redis 7+) (#2740)
Fix protocol version checking (#2737)
Fix parse resp3 dict response: don't use dict comprehension (#2757)
Fixing asyncio import (#2759)
fix (#2799)
fix async tests (#2806)
Fix socket garbage collection (#2859)
Fixing doc builds (#2869)
Fix a duplicate word in `CONTRIBUTING.md` (#2848)
Fix timeout retrying on Redis pipeline execution (#2812)
Fix type hints in SearchCommands (#2817)")`
…

`[0e56165](/redis/redis-py/commit/0e56165d4a26001cff288dc11f728f6c353fc62b)`

```
Co-authored-by: Viktor Ivanov <viktor@infogrid.io>
Co-authored-by: Sergey Prokazov <sergey.prokazov@redis.com>
Co-authored-by: Anuragkillswitch <70265851+Anuragkillswitch@users.noreply.github.com>
Co-authored-by: dvora-h <67596500+dvora-h@users.noreply.github.com>
Co-authored-by: Alex Schmitz <aschmitz@box.com>
Co-authored-by: Alex Schmitz <alex.schmitz@gmail.com>
Co-authored-by: Chayim <chayim@users.noreply.github.com>
Co-authored-by: Bar Shaul <88437685+barshaul@users.noreply.github.com>
Co-authored-by: CrimsonGlory <CrimsonGlory@users.noreply.github.com>
Co-authored-by: Raymond Yin <raymond@tryevergreen.com>
Co-authored-by: zach.lee <zach.lee@sendbird.com>
Co-authored-by: James R T <jamestiotio@gmail.com>
Co-authored-by: dvora-h <dvora.heller@redis.com>
Co-authored-by: Marc Schöchlin <marc.schoechlin@flipapp.de>
Co-authored-by: Nick Gerow <nick.gerow@enlightedinc.com>
Co-authored-by: Igor Malinovskiy <u.glide@gmail.com>
Co-authored-by: Chayim I. Kirshen <c@kirshen.com>
Co-authored-by: Leibale Eidelman <me@leibale.com>
Co-authored-by: Thiago Bellini Ribeiro <hackedbellini@gmail.com>
Co-authored-by: woutdenolf <woutdenolf@users.sf.net>
Co-authored-by: shacharPash <93581407+shacharPash@users.noreply.github.com>
Co-authored-by: Mirek Długosz <miniopl+github@gmail.com>
Co-authored-by: Oran Avraham <252748+oranav@users.noreply.github.com>
Co-authored-by: mzdehbashi-github <85902780+mzdehbashi-github@users.noreply.github.com>
Co-authored-by: Tyler Hutcherson <tyler.hutcherson@redis.com>
Co-authored-by: Felipe Machado <462154+felipou@users.noreply.github.com>
Co-authored-by: AYMEN Mohammed <53928879+AYMENJD@users.noreply.github.com>
Co-authored-by: Marc Schöchlin <ms-github@256bit.org>
Co-authored-by: Avasam <samuel.06@hotmail.com>
Co-authored-by: Markus Gerstel <2102431+Anthchirp@users.noreply.github.com>
Co-authored-by: Kristján Valur Jónsson <sweskman@gmail.com>
Co-authored-by: Nick Gerow <Nick.G.123@hotmail.com>
Co-authored-by: Cristian Matache <cristianmatache@hotmail.com>
Co-authored-by: Anurag Bandyopadhyay <angbpy@gmail.com>
Co-authored-by: Seongchuel Ahn <aciddust20@gmail.com>
Co-authored-by: Alibi <aliby.bbb@gmail.com>
Co-authored-by: Smit Parmar <smitraj333@gmail.com>
Co-authored-by: Brad MacPhee <macphee@gmail.com>
Co-authored-by: Shahar Lev <shahar_lev@hotmail.com>
Co-authored-by: Vladimir Mihailenco <vladimir.webdev@gmail.com>
Co-authored-by: Kevin James <KevinJames@thekev.in>
Co-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>
Co-authored-by: David Pacsuta <34983281+ant1fact@users.noreply.github.com>
Co-authored-by: Rich Bowen <rbowen@rcbowen.com>
Co-authored-by: gmbnomis <gmbnomis@users.noreply.github.com>
Co-authored-by: Vivanov98 <66319645+Vivanov98@users.noreply.github.com>
Co-authored-by: Kosuke <kosuke.zhang@gmail.com>
Co-authored-by: Sergey Prokazov <prokazov@users.noreply.github.com>
Co-authored-by: jmcbailey <jmcbailey@gmail.com>
Co-authored-by: Galtozzy <14139502+Galtozzy@users.noreply.github.com>
Co-authored-by: Abhishek Kumar Sinha <aksinha334@gmail.com>
Co-authored-by: Eom Taegyung "Iggy <iggy.eom@sendbird.com>
Co-authored-by: Mehdi ABAAKOUK <sileht@sileht.net>
Co-authored-by: Dongkeun Lee <3315213+zakaf@users.noreply.github.com>
Co-authored-by: woutdenolf <wout.de_nolf@esrf.eu>
Co-authored-by: Kurt McKee <contactme@kurtmckee.org>
Co-authored-by: Juraj Páll <palljuraj1@gmail.com>
Co-authored-by: Joan Fontanals <jfontanalsmartinez@gmail.com>
Co-authored-by: Stanislav Zmiev <zmievsa@gmail.com>
fix ([#2566](https://github.com/redis/redis-py/pull/2566))
Fix unlink in cluster pipeline ([#2562](https://github.com/redis/redis-py/pull/2562))
Fix issue 2540: Synchronise concurrent command calls to single-client mode. ([#2568](https://github.com/redis/redis-py/pull/2568))
Fix: tuple function cannot be passed more than one argument ([#2573](https://github.com/redis/redis-py/pull/2573))
Fix issue 2567: NoneType check before raising exception ([#2569](https://github.com/redis/redis-py/pull/2569))
Fix issue 2349: Let async HiredisParser finish parsing after a Connection.disconnect() ([#2557](https://github.com/redis/redis-py/pull/2557))
Fix issue with `pack_commands` returning an empty byte sequence ([#2416](https://github.com/redis/redis-py/pull/2416))
Fix [#2581](https://github.com/redis/redis-py/issues/2581) UnixDomainSocketConnection' object has no attribute '_command_packer' ([#2583](https://github.com/redis/redis-py/pull/2583))
Fix [#2581](https://github.com/redis/redis-py/issues/2581) UnixDomainSocketConnection' object has no attribute '_command_packer' .
Fix for `lpop` and `rpop` return typing ([#2590](https://github.com/redis/redis-py/pull/2590))
Fixed CredentialsProvider examples ([#2587](https://github.com/redis/redis-py/pull/2587))
Fixed issue [#2598](https://github.com/redis/redis-py/issues/2598) - make Document class subscriptable
fix: replace async_timeout by asyncio.timeout ([#2602](https://github.com/redis/redis-py/pull/2602))
Fix behaviour of async PythonParser to match RedisParser as for issue [#2349](https://github.com/redis/redis-py/issues/2349) ([#2582](https://github.com/redis/redis-py/pull/2582))
Fix ([#2641](https://github.com/redis/redis-py/pull/2641))
fix: do not use asyncio's timeout lib before 3.11.2 ([#2659](https://github.com/redis/redis-py/pull/2659))
Fix issue 2660: PytestUnraisableExceptionWarning from asycio client ([#2669](https://github.com/redis/redis-py/pull/2669))
Fixing cancelled async futures ([#2666](https://github.com/redis/redis-py/pull/2666))
Fix async ([#2673](https://github.com/redis/redis-py/pull/2673))
Fix memory leak caused by hiredis ([#2693](https://github.com/redis/redis-py/issues/2693)) ([#2694](https://github.com/redis/redis-py/pull/2694))
Fix incorrect usage of once flag in async Sentinel ([#2718](https://github.com/redis/redis-py/pull/2718))
Fix topk list example. ([#2724](https://github.com/redis/redis-py/pull/2724))
Fix `ClusterCommandProtocol` not itself being marked as a protocol ([#2729](https://github.com/redis/redis-py/pull/2729))
Fix potential race condition during disconnection ([#2719](https://github.com/redis/redis-py/pull/2719))
fix CI ([#2748](https://github.com/redis/redis-py/pull/2748))
fix parse_slowlog_get ([#2732](https://github.com/redis/redis-py/pull/2732))
fixes for issue [#1128](https://github.com/redis/redis-py/issues/1128)
fix create single_connection_client from url ([#2752](https://github.com/redis/redis-py/pull/2752))
Fix `xadd` allow non negative maxlen ([#2739](https://github.com/redis/redis-py/pull/2739))
Fix JSON.MERGE Summary ([#2786](https://github.com/redis/redis-py/pull/2786))
Fixed key error in parse_xinfo_stream ([#2788](https://github.com/redis/redis-py/pull/2788))
Fix dead weakref in sentinel connection causing ReferenceError ([#2767](https://github.com/redis/redis-py/issues/2767)) ([#2771](https://github.com/redis/redis-py/pull/2771))
Fix dead weakref in sentinel conn ([#2767](https://github.com/redis/redis-py/issues/2767))
fix redirects and some small cleanups ([#2801](https://github.com/redis/redis-py/pull/2801))
Fix type hint for retry_on_error in async cluster ([#2804](https://github.com/redis/redis-py/pull/2804))
Fix CI ([#2809](https://github.com/redis/redis-py/pull/2809))
Fix async client with resp3 ([#2657](https://github.com/redis/redis-py/pull/2657))
Fix `COMMAND` response in resp3 (redis 7+) ([#2740](https://github.com/redis/redis-py/pull/2740))
Fix protocol version checking ([#2737](https://github.com/redis/redis-py/pull/2737))
Fix parse resp3 dict response: don't use dict comprehension ([#2757](https://github.com/redis/redis-py/pull/2757))
Fixing asyncio import ([#2759](https://github.com/redis/redis-py/pull/2759))
fix ([#2799](https://github.com/redis/redis-py/pull/2799))
fix async tests ([#2806](https://github.com/redis/redis-py/pull/2806))
Fix socket garbage collection ([#2859](https://github.com/redis/redis-py/pull/2859))
Fixing doc builds ([#2869](https://github.com/redis/redis-py/pull/2869))
Fix a duplicate word in `CONTRIBUTING.md` ([#2848](https://github.com/redis/redis-py/pull/2848))
Fix timeout retrying on Redis pipeline execution ([#2812](https://github.com/redis/redis-py/pull/2812))
Fix type hints in SearchCommands ([#2817](https://github.com/redis/redis-py/pull/2817))
```

This was referenced May 1, 2024

[MEDIUM - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#27](/FabioBartoli/Linuxtips-telegram-communication/issues/27)

Closed

[MEDIUM: redis - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#41](/FabioBartoli/Linuxtips-telegram-communication/issues/41)

Closed

[LOW: redis - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#61](/FabioBartoli/Linuxtips-telegram-communication/issues/61)

Open

[LOW: redis - redis: Async command information disclosure
FabioBartoli/Linuxtips-telegram-communication#64](/FabioBartoli/Linuxtips-telegram-communication/issues/64)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Fpull%2F2641)

Reviewers

[![@leibale](https://avatars.githubusercontent.com/u/7086055?s=40&v=4)](/leibale) [leibale](/leibale)

leibale approved these changes

[![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)](/dvora-h) [dvora-h](/dvora-h)

 Awaiting requested review from dvora-h

Assignees

No one assigned

Labels

[bug](/redis/redis-py/labels/bug)
Bug

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [Off by 1 - Canceling async Redis command leaves connection open, in unsafe state for future commands](https://github.com/redis/redis-py/issues/2624)

 [[Bug] Aioredis cancellation of blocking operations stucks next operations](https://github.com/redis/redis-py/issues/2579)

5 participants

[![@chayim](https://avatars.githubusercontent.com/u/1333958?s=52&v=4)](/chayim) [![@codecov-commenter](https://avatars.githubusercontent.com/u/65553080?s=52&v=4)](/codecov-commenter) [![@drago-balto](https://avatars.githubusercontent.com/u/84727709?s=52&v=4)](/drago-balto) [![@so1n](https://avatars.githubusercontent.com/u/28426591?s=52&v=4)](/so1n) [![@leibale](https://avatars.githubusercontent.com/u/7086055?s=52&v=4)](/leibale)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b829efcf_20250114_190558.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Freleases%2Ftag%2Fv4.4.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fredis%2Fredis-py%2Freleases%2Ftag%2Fv4.4.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=redis%2Fredis-py)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[redis](/redis)
/
**[redis-py](/redis/redis-py)**
Public

* [Notifications](/login?return_to=%2Fredis%2Fredis-py) You must be signed in to change notification settings
* [Fork
  2.5k](/login?return_to=%2Fredis%2Fredis-py)
* [Star
   12.8k](/login?return_to=%2Fredis%2Fredis-py)

* [Code](/redis/redis-py/tree/v4.4.4)
* [Issues
  206](/redis/redis-py/issues)
* [Pull requests
  72](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects
  0](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

Additional navigation options

* [Code](/redis/redis-py/tree/v4.4.4)
* [Issues](/redis/redis-py/issues)
* [Pull requests](/redis/redis-py/pulls)
* [Actions](/redis/redis-py/actions)
* [Projects](/redis/redis-py/projects)
* [Security](/redis/redis-py/security)
* [Insights](/redis/redis-py/pulse)

1. [Releases](/redis/redis-py/releases)
2. [v4.4.4](/redis/redis-py/releases/tag/v4.4.4)

# 4.4.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/redis/redis-py/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v4.4.4)

 Loading

[View all tags](/redis/redis-py/tags)

![@dvora-h](https://avatars.githubusercontent.com/u/67596500?s=40&v=4)
[dvora-h](/dvora-h)
released this
29 Mar 13:53

[v4.4.4](/redis/redis-py/tree/v4.4.4)

[`49d9cb7`](/redis/redis-py/commit/49d9cb751c7c30546fc86d11f8168d7aa007edae)

This commit was created on GitHub.com and signed with GitHub’s **verified signature**.
The key has expired.

GPG key ID: 4AEE18F83AFDEB23
Expired

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

# Changes

Upgrade urgency: SECURITY, contains fixes to security issues.

* ([CVE-2023-28859](https://github.com/advisories/GHSA-8fww-64cx-x8p5 "CVE-2023-28859")) - Cancelling an async future does not, properly trigger, leading to a potential data leak in specific cases.
* ([CVE-2023-28858](https://github.com/advisories/GHSA-24wv-mv5m-xv4h "CVE-2023-28858")) - Cancelling an async future does not, properly trigger, leading to a potential data leak in specific cases.

## 🐛 Bug Fixes

* Fixing cancelled async futures ([#2671](https://github.com/redis/redis-py/pull/2671) )

 Assets
2

 Loading

 👍
6
 ShadowUser17, alexted, hsenot, dvermaas, hyeongguen-song, and denjas reacted with thumbs up emoji
 😄
1
 alexted reacted with laugh emoji
 🎉
1
 alexted reacted with hooray emoji
 ❤️
2
 alexted and veekaybee reacted with heart emoji
 🚀
2
 alexted and leynier reacted with rocket emoji
 👀
1
 alexted reacted with eyes emoji

All reactions

* 👍
  6 reactions
* 😄
  1 reaction
* 🎉
  1 reaction
* ❤️
  2 reactions
* 🚀
  2 reactions
* 👀
  1 reaction

 8 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


