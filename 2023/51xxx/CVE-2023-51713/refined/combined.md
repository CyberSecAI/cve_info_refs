=== Content from github.com_0d058649_20250115_093115.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=proftpd%2Fproftpd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[proftpd](/proftpd)
/
**[proftpd](/proftpd/proftpd)**
Public

* [Notifications](/login?return_to=%2Fproftpd%2Fproftpd) You must be signed in to change notification settings
* [Fork
  207](/login?return_to=%2Fproftpd%2Fproftpd)
* [Star
   543](/login?return_to=%2Fproftpd%2Fproftpd)

* [Code](/proftpd/proftpd)
* [Issues
  100](/proftpd/proftpd/issues)
* [Pull requests
  54](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects
  0](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

Additional navigation options

* [Code](/proftpd/proftpd)
* [Issues](/proftpd/proftpd/issues)
* [Pull requests](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fproftpd%2Fproftpd%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fproftpd%2Fproftpd%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Out-of-bounds buffer read when handling FTP commands #1683

Closed

[Marti2203](/Marti2203) opened this issue
Jun 6, 2023
¬∑ 16 comments

Closed

# [Out-of-bounds buffer read when handling FTP commands](#top) #1683

[Marti2203](/Marti2203) opened this issue
Jun 6, 2023
¬∑ 16 comments

Assignees
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&v=4)](/Castaglia)

Labels
[backport](/proftpd/proftpd/labels/backport)
[bug](/proftpd/proftpd/labels/bug)

Milestone
[1.3.9](/proftpd/proftpd/milestone/5 "1.3.9")

## Comments

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

### **[Marti2203](/Marti2203)** commented [Jun 6, 2023](#issue-1743120578)

| What I Did Cloned latest version of ProFTPD ([5e57d41](https://github.com/proftpd/proftpd/commit/5e57d419328ca48c1fb0e8d47c88a5324aec0cd3)) in a container running Ubuntu 20.04, configured with flags for ASAN and UBSan. Started the tool as such `./proftpd -n -c <SOMEDIR>/basic.conf -X`. Sent over a sequence of packets, gathered from a fuzz campaign using the `aflnet-replay` utility. What I Expected/Wanted Expected to have ProFTPD not crash. ProFTPD Version and Configuration ``` Compile-time Settings:   Version: 1.3.9rc1 (git)   Platform: LINUX [Linux 5.4.0-120-generic x86_64]   OS/Release:     NAME="Ubuntu"     VERSION="20.04.6 LTS (Focal Fossa)"     ID=ubuntu     ID_LIKE=debian     PRETTY_NAME="Ubuntu 20.04.6 LTS"     VERSION_ID="20.04"     VERSION_CODENAME=focal     UBUNTU_CODENAME=focal   Built: Tue Jun 6 2023 05:18:02 UTC   Built With:     configure  '--enable-devel=nodaemon:nofork' 'CC=cc' 'CFLAGS=-fsanitize=address,undefined -g' 'LDFLAGS=-fsanitize=address,undefined'    CFLAGS: -g2 -fsanitize=address,undefined -g -Wall -fno-omit-frame-pointer -fno-strict-aliasing -Wdangling-else -Wextra -Werror=implicit-function-declaration -Winit-self -Wno-missing-field-initializers -Wno-unused-parameter -Wnull-derefere nce -fdelete-null-pointer-checks -DPR_DEVEL_NO_FORK -DPR_DEVEL_NO_DAEMON -g3 -O0 -Wcast-align -Wchar-subscripts -Winline -Wstrict-prototypes -Wmissing-declarations -Wnested-externs -Wpointer-arith -Wshadow -Wundef -Wcomment -Wdangling-else -Wdeclaration-after-statement -Wduplicated-branches -Wfloat-equal -Wformat -Wformat-security -Wimplicit-function-declaration -Wmaybe-uninitialized -Wmissing-braces -Wparentheses -Wpointer-to-int-cast -Wreturn-local-addr -Wstack-protector -W strict-overflow -Wswitch -Wunreachable-code -Wunused-variable -fstack-protector -fstack-protector-all -fno-common   LDFLAGS: -Wl,-L$(top_srcdir)/lib,-L$(top_builddir)/lib -fsanitize=address,undefined -rdynamic   LIBS:  -lcap -lidn2 -lcrypt    Files:     Configuration File:       /usr/local/etc/proftpd.conf     Pid File:       /usr/local/var/proftpd.pid     Scoreboard File:       /usr/local/var/proftpd.scoreboard    Info:     + Max supported UID: 4294967295     + Max supported GID: 4294967295   Features:     - Autoshadow support     - Controls support     + curses support     + Developer support     - DSO support     + IPv6 support     + Largefile support     - Lastlog support     - Memcache support     + ncurses support     - NLS support     - OpenSSL support     - PCRE support     - PCRE2 support     - POSIX ACL support     - Redis support     + Sendfile support     + Shadow file support     - Sodium support     + Trace support     + xattr support    Tunable Options:     PR_TUNABLE_BUFFER_SIZE = 1024     PR_TUNABLE_DEFAULT_RCVBUFSZ = 8192     PR_TUNABLE_DEFAULT_SNDBUFSZ = 8192     PR_TUNABLE_ENV_MAX = 2048     PR_TUNABLE_GLOBBING_MAX_MATCHES = 100000     PR_TUNABLE_GLOBBING_MAX_RECURSION = 8     PR_TUNABLE_HASH_TABLE_SIZE = 40     PR_TUNABLE_LOGIN_MAX = 256     PR_TUNABLE_NEW_POOL_SIZE = 512     PR_TUNABLE_PATH_MAX = 4096     PR_TUNABLE_SCOREBOARD_BUFFER_SIZE = 80     PR_TUNABLE_SCOREBOARD_SCRUB_TIMER = 30     PR_TUNABLE_SELECT_TIMEOUT = 30     PR_TUNABLE_TIMEOUTIDENT = 10     PR_TUNABLE_TIMEOUTIDLE = 600     PR_TUNABLE_TIMEOUTLINGER = 10     PR_TUNABLE_TIMEOUTLOGIN = 300     PR_TUNABLE_TIMEOUTNOXFER = 300     PR_TUNABLE_TIMEOUTSTALLED = 3600     PR_TUNABLE_XFER_SCOREBOARD_UPDATES = 10  ```  In addition, we need to see **all** of the ProFTPD configuration files you are using (**minus** any sensitive information like passwords, of course). Armed with the version and configuration data, then, we can set up ProFTPD locally using the same configuration, and see what happens. Config and input are provided in the archive below [data.tar.gz](https://github.com/proftpd/proftpd/files/11660286/data.tar.gz) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 6, 2023](#issuecomment-1577946991)

| Output of ASAN  ``` ==2288394==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62100001a320 at pc 0x562e102ac29d bp 0x7ffc9a7ba260 sp 0x7ffc9a7ba250 READ of size 1 at 0x62100001a320 thread T0     #0 0x562e102ac29c in make_ftp_cmd /home/ubuntu/experiments/proftpd-clean/src/main.c:862     #1 0x562e102a9a11 in pr_cmd_read /home/ubuntu/experiments/proftpd-clean/src/main.c:571     #2 0x562e102acc88 in cmd_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:910     #3 0x562e102b028a in fork_server /home/ubuntu/experiments/proftpd-clean/src/main.c:1519     #4 0x562e102b1834 in daemon_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:1764     #5 0x562e102b2106 in standalone_main /home/ubuntu/experiments/proftpd-clean/src/main.c:1965     #6 0x562e102b4928 in main /home/ubuntu/experiments/proftpd-clean/src/main.c:2790     #7 0x7fe618414082 in __libc_start_main ../csu/libc-start.c:308     #8 0x562e102a537d in _start (/home/ubuntu/experiments/proftpd-clean/proftpd+0x46437d)  0x62100001a320 is located 0 bytes to the right of 4640-byte region [0x621000019100,0x62100001a320) allocated by thread T0 here:     #0 0x7fe6190c1808 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cc:144     #1 0x562e102ba510 in smalloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:114     #2 0x562e102ba56a in malloc_block /home/ubuntu/experiments/proftpd-clean/src/pool.c:127     #3 0x562e102baf70 in new_block /home/ubuntu/experiments/proftpd-clean/src/pool.c:219     #4 0x562e102bf451 in alloc_pool /home/ubuntu/experiments/proftpd-clean/src/pool.c:672     #5 0x562e102bf734 in palloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:684     #6 0x562e102bf846 in pcalloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:699     #7 0x562e102a9144 in pr_cmd_read /home/ubuntu/experiments/proftpd-clean/src/main.c:494     #8 0x562e102acc88 in cmd_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:910     #9 0x562e102b028a in fork_server /home/ubuntu/experiments/proftpd-clean/src/main.c:1519     #10 0x562e102b1834 in daemon_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:1764     #11 0x562e102b2106 in standalone_main /home/ubuntu/experiments/proftpd-clean/src/main.c:1965     #12 0x562e102b4928 in main /home/ubuntu/experiments/proftpd-clean/src/main.c:2790     #13 0x7fe618414082 in __libc_start_main ../csu/libc-start.c:308  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/ubuntu/experiments/proftpd-clean/src/main.c:862 in make_ftp_cmd Shadow bytes around the buggy address:   0x0c427fffb410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb420: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb430: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c427fffb460: 00 00 00 00[fa]fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb470: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb490: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb4a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb4b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2288394==ABORTING Aborted  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
self-assigned this
[Jun 10, 2023](#event-9491154487)

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 10, 2023](#issuecomment-1585718241) ‚Ä¢ edited Loading

| [@Marti2203](https://github.com/Marti2203) Thanks for the report. I'm attempting to reproduce this behavior locally now. How are you feeding the provided `input` file to the daemon? I've tried using *e.g.* `telnet 127.0.0.1 21 < /path/to/input`, but haven't yet reproduced the ASAN crash, and I think I might be missing some tool or step.  I just installed [aflnet](https://github.com/aflnet/aflnet), and attempting to use its `aflnet-replay` now:  ``` $ aflnet-replay /path/to/input FTP 21  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 10, 2023](#issuecomment-1585826125)

| Out of curiosity, which ASAN options to you have set in your environment? For example, in my current local setup to try to reproduce this, I am using:  ``` ASAN_OPTIONS=verbosity=3,detect_leaks=0,abort_on_error=1,debug=true,check_initialization_order=true,detect_stack_use_after_return=true,strict_string_checks=true,detect_invalid_pointer_pairs=2  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 11, 2023](#issuecomment-1585973488) ‚Ä¢ edited Loading

| Hi [@Castaglia](https://github.com/Castaglia), I used these options to reproduce it `ASAN_OPTIONS="abort_on_error=1:symbolize=1:detect_leaks=1:detect_stack_use_after_return=1:detect_container_overflow=1:poison_array_cookie=1:malloc_fill_byte=0:max_malloc_fill_size=16777216"`  Were you able to reproduce it earlier? |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592268980)

| Unfortunately no, I've not been able to reproduce the ASAN report yet. I suspect I know the cause -- but it would greatly help to have a working reproduction recipe, to verify a fix. Would you be able to provide a Dockerfile (and instructions), that I might run the same locally? Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592269871)

| I can send a docker container image with the instance running and all. Will need 1-2 hours and get back to you :) |
| --- |

 üëç
1
 Castaglia reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592276663) ‚Ä¢ edited Loading

| [Link to the docker image](https://drive.google.com/file/d/1RuS1TQdqfA5JtnjCSXs7fzYH4vVc2JFa/view?usp=sharing)  Steps for reproduction:   * Docker load the tar.gz (`docker load < file.tar.gz` ) * Create an instance of the container * In one terminal in the directory `/home/ubuntu/experiments/proftpd` , run `./proftpd -n -c /home/ubuntu/replayable-crashes-proftpd/basic.conf -X` * In another terminal in the directory `/home/ubuntu/replayable-crashes-proftpd` run `aflnet-replay input FTP 21 1` * ProFTPD should crash in the first terminal |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592284415)

| Thanks! I might not have free time to spend on this until this weekend, but I will take a look at the provided Dockerfile; many thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592285047)

| No problem :) |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592287058)

| Happen to have the actual `Dockerfile` as well, so that I can build the image locally? |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592288210)

| Yes, just a moment |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592293620) ‚Ä¢ edited Loading

| If it helps, here's what I've been building up locally:  ``` FROM ubuntu:20.04  ARG USER=docker ARG PASSWORD=docker  ENV DEBIAN_FRONTEND=noninteractive ENV TZ=UTC  RUN apt-get update && \   apt-get install -y \     clang \     ftp \     git \     graphviz-dev \     libcap-dev \     make \     netcat \     telnet \     vim  # Create the account, and files, used for testing RUN mkdir -p /var/log/proftpd RUN useradd -s /bin/bash -m -d "/home/$USER" "$USER" && \   yes "$PASSWORD" | passwd "$USER"  # Install AFLnet RUN git clone --depth 10 https://github.com/aflnet/aflnet.git /src/aflnet RUN cd /src/aflnet && \   make clean all && \   cd llvm_mode/ && \   LLVM_CONFIG=/usr/bin/llvm-config-10 make  ENV AFLNET=/src/aflnet ENV AFL_PATH=/src/aflnet  COPY commands.txt /src/commands.txt  ENV ASAN_OPTIONS=abort_on_error=1:symbolize=1:detect_leaks=1:detect_stack_use_after_return=1:detect_container_overflow=1:poison_array_cookie=1:malloc_fill_byte=0:max_malloc_fill_size=16777216  # Run these locally with an outdated Mac OSX Docker Desktop installation # $ docker run --security-opt seccomp=unconfined --privileged --rm=true -it -v $(PWD):/src/proftpd heap-overflow-issue1683 bash # cd /src/proftpd  # CC=clang CFLAGS=-fsanitize=address,undefined LDFLAGS=-fsanitize=address,undefined ./configure --enable-devel=nodaemon:nofork # make # make install # /usr/local/sbin/proftpd -X -nd10  CMD ["bash"]  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592392054)

| [proftpd-repro.tar.gz](https://github.com/proftpd/proftpd/files/11753209/proftpd-repro.tar.gz)  Command for executing proftpd - `./proftpd -n -c ${WORKDIR}/basic.conf -X` Command for executing the aflnet-replay `aflnet-replay input FTP 21 1` |
| --- |

 ‚ù§Ô∏è
1
 Castaglia reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Aug 6, 2023](#issuecomment-1666917041)

| Many apologies for the delay; I've been dealing with other things.  Using the provided tarball (with some minor tweaks for my local Mac-based environment), I'm now able to reproduce the report from `aflnet`. Thanks! Now to see about fixing this issue properly. |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
added
[bug](/proftpd/proftpd/labels/bug)
[backport](/proftpd/proftpd/labels/backport)
labels
[Aug 6, 2023](#event-10017615296)

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
added this to the [1.3.9](/proftpd/proftpd/milestone/5) milestone
[Aug 6, 2023](#event-10017615356)

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Aug 6, 2023](#ref-commit-f8c1561)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[f8c1561](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Aug 6, 2023](#issuecomment-1666960691)

| [@Marti2203](https://github.com/Marti2203) [#1696](https://github.com/proftpd/proftpd/pull/1696) looks to address this issue using your reproduction recipe, without causing any other regressions that I've seen so far. Care to try it out yourself, see if there any other related issues lingering? Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
changed the title
~~Heap Buffer Overflow bug in ProFTPD~~
Out-of-bounds buffer read when handling FTP commands
[Aug 12, 2023](#event-10077440065)

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-1376d8c)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[1376d8c](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-97bbe68)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[97bbe68](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-fd43edf)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Updating NEWS for backport of fix for Issue](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f "Updating NEWS for backport of fix for Issue #1683 to 1.3.8 branch.") [#1683](https://github.com/proftpd/proftpd/issues/1683) [to 1.3.8 branch.](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f "Updating NEWS for backport of fix for Issue #1683 to 1.3.8 branch.")`

`[fd43edf](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f)`

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-35bfba4)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Merge pull request](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4 "Merge pull request #1696 from proftpd/ftp-text-quote-mode-issue1683

Issue #1683: Avoid an edge case when handling unexpectedly formatted ‚Ä¶") [#1696](https://github.com/proftpd/proftpd/pull/1696) [from proftpd/ftp-text-quote-mode-issue1683](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4 "Merge pull request #1696 from proftpd/ftp-text-quote-mode-issue1683

Issue #1683: Avoid an edge case when handling unexpectedly formatted ‚Ä¶")`
‚Ä¶

`[35bfba4](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4)`

```
Issue [#1683](https://github.com/proftpd/proftpd/issues/1683): Avoid an edge case when handling unexpectedly formatted ‚Ä¶
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-631c012)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Updating NEWS for fix for Issue](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299 "Updating NEWS for fix for Issue #1683.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[.](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299 "Updating NEWS for fix for Issue #1683.")`

`[631c012](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299)`

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Sep 10, 2023](#issuecomment-1712887554)

| I've merged the PR to master, and backported the fix to the 1.3.8 branch. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
closed this as [completed](/proftpd/proftpd/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Sep 10, 2023](#event-10326929776)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

Assignees

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&v=4)](/Castaglia) [Castaglia](/Castaglia)

Labels

[backport](/proftpd/proftpd/labels/backport)
[bug](/proftpd/proftpd/labels/bug)

Projects

None yet

Milestone

 [**1.3.9**](/proftpd/proftpd/milestone/5 "1.3.9")

Development

No branches or pull requests

2 participants

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=52&v=4)](/Castaglia) [![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=52&v=4)](/Marti2203)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_347d4edb_20250115_093114.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fblob%2F1.3.8%2FNEWS)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fblob%2F1.3.8%2FNEWS)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=proftpd%2Fproftpd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[proftpd](/proftpd)
/
**[proftpd](/proftpd/proftpd)**
Public

* [Notifications](/login?return_to=%2Fproftpd%2Fproftpd) You must be signed in to change notification settings
* [Fork
  207](/login?return_to=%2Fproftpd%2Fproftpd)
* [Star
   543](/login?return_to=%2Fproftpd%2Fproftpd)

* [Code](/proftpd/proftpd/tree/1.3.8)
* [Issues
  100](/proftpd/proftpd/issues)
* [Pull requests
  54](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects
  0](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

Additional navigation options

* [Code](/proftpd/proftpd/tree/1.3.8)
* [Issues](/proftpd/proftpd/issues)
* [Pull requests](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

## Files

¬†1.3.8
## Breadcrumbs

1. [proftpd](/proftpd/proftpd/tree/1.3.8)
/
# NEWS

Copy path Blame  Blame
## Latest commit

## History

[History](/proftpd/proftpd/commits/1.3.8/NEWS)3519 lines (3414 loc) ¬∑ 191 KB¬†1.3.8
## Breadcrumbs

1. [proftpd](/proftpd/proftpd/tree/1.3.8)
/
# NEWS

Top
## File metadata and controls

* Code
* Blame

3519 lines (3414 loc) ¬∑ 191 KB[Raw](https://github.com/proftpd/proftpd/raw/refs/heads/1.3.8/NEWS)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000
----------------------------------------------------------------------------- More details on the bugs listed below can be found by using the bug number indicated in the following URL:
 http://bugs.proftpd.org/show\_bug.cgi?id=N
 where `N' is the bug number.
 If the issue listed below mentions "Issue" instead of "Bug", the number there references a GitHub issue, which can be found using a URL like:
 https://github.com/proftpd/proftpd/issues/N
 where `N' is the issue number.-----------------------------------------------------------------------------
1.3.8d--------------------------------- Issue 1855 - Use of HideNoAccess for SFTP sessions can lead to segfault and/or unexpected behavior.
1.3.8c - Released 11-Dec-2024--------------------------------- Issue 1770 - Using FTPS after upgrading from 1.3.8a to 1.3.8b leads to crash.- Issue 1785 - Bad handling of lack of extended attributes leads to SFTP out of memory error.- Issue 1529 - mod\_sftp\_sql logs "header value too long" due to unexpected key header text.- Issue 1839 - SSH ECDSA host key algorithms not be used as expected despite configuring appropriate key.- Issue 1840 - RADIUS Message-Authenticator verification failed with ProFTPD mod\_radius.- Issue 1830 - Supplemental group inheritance grants unintended access to GID 0 due to lack of supplemental groups from mod\_sql.
1.3.8b - Released 19-Dec-2023--------------------------------- Issue 1735 - Compiling ProFTPD 1.3.8a mod\_sftp, mod\_tls using libressl 3.7.3 fails.- Issue 1756 - Build system fails for specific module names.- Issue 1760 - mod\_sftp is affected by "Terrapin" Prefix Truncation Attacks in SSH Specification (CVE-2023-48795).
1.3.8a - Released 08-Oct-2023--------------------------------- Issue 1581 - mod\_sftp fails to handle SFTP requests to truncate files to zero size.- Issue 1584 - mod\_sftp improperly handles SFTP WRITE requests for files opened for appending.- Issue 1568 - Build-time detection of Linux POSIX ACL support broken since 1.3.8rc2.- Issue 1590 - Unable to load mod\_rewrite as a dynamic module due to incomplete/missing library linker flags.- Issue 1597 - <Class> section is allowed to be in <Global>, but From directive is not.- Issue 1617 - ExtendedLog SSH, SFTP classes not working as expected.- Issue 1646 - mod\_sftp does not handle multiple concurrent open file handles/transfers well for logging.- Issue 1679 - "TLSRequired off" plus Protocols directive causes mod\_tls to terminate the session abruptly.- Issue 1689 - mod\_tls fails to compile against OpenSSL 3.0.8 due to missing ENGINE\_METHOD\_ flags.- Issue 1659 - Unknown named connection error when using different SQL backends.- Issue 1697 - mod\_sql is not properly closing all named backend connections on session exit.- Issue 1694 - SSH key exchanges fail unexpectedly with "unable to write X bytes of raw data" errors due to small ProFTPD buffer.- Issue 1678 - High session memory usage caused by SFTP outgoing data buffering.- Issue 1683 - Out-of-bounds buffer read when handling FTP commands.- Issue 1712 - SFTP algorithm settings in <Global> section not being used.
1.3.8 - Released 04-Dec-2022--------------------------------- Issue 1488 - 1.3.8rc4 failing to build mod\_sftp with OpenSSL 1.1.0 due to X448 check.- Issue 1494 - 1.3.8rc4 failing to build on Solaris due to missing type declarations.- Issue 1500 - mod\_ifsession doesn't change the effect of SFTPMaxChannels.- Issue 1533 - mod\_tls module unexpectedly allows TLS handshake after authentication in some configurations.- Issue 1528 - Disable FSCachePolicy by default.- Issue 1539 - Avoid logging "session closed" messages unless there is a corresponding "session opened" log message, to avoid user confusion.- Issue 1550 - Implement support for the CSID FTP command.- Bug 4491 - unable to verify signed data: signature type 'rsa-sha2-512' does not match publickey algorithm 'ssh-rsa'.- Issue 1560 - mod\_auth\_otp improperly allows keyboard-interactive logins for users lacking OTP entries.
1.3.8rc4 - Released 23-Jul-2022--------------------------------- Issue 1434 - mod\_sftp should fail on startup when SFTP and TLS are both enabled for a vhost.- Issue 1440 - DelayTable not properly using documented default value. This is a regression caused by the changes for Bug#4020.- Issue 1444 - Support customizing SSH ciphers, digests, key exchanges via SFTPClientMatch.- Issue 1448 - Ensure that mod\_sftp algorithms work properly with OpenSSL 3.x.- Issue 1445 - BanOnEvent BadProtocol triggers segfault.- Issue 1439 - SFTP "check-file" implementation computes incorrect results.- Issue 1457 - Implement SFTPHostKeys directive for configuring the SSH host key algorithms.- Issue 1437 - Implement the "curve448-sha512" SSH key exchange algorithm.- Issue 1472 - Include directive broken when using wildcards for directory components.- Bug 4485 - mod\_sftp fails to build using OpenSSL 1.0.x: undefined reference to `EVP\_MD\_CTX\_reset'.- Issue 1476 - Reload after omitting explicit ModulePath value causes fatal module load failures.
1.3.8rc3 - Released 23-Apr-2022--------------------------------- Issue 1323 - Support SSH hostkey rotation via OpenSSH extensions.- Issue 1325 - NLST does not behave consistently for relative paths.- Bug 3759 - Support AES Galois Counter Mode (AES-GCM) in SSH. Support for the "aes128-gcm@openssh.com" and "aes256-gcm@openssh.com" ciphers has been added to mod\_sftp.- Issue 1333 - Implement an LDAPConnectTimeout directive, to configure the timeout used when connecting to LDAP servers.- Issue 1330 - Implement OpenSSH "Encrypt-Then-MAC" (ETM) algorithm extensions.- Issue 1346 - Implement AllowForeignAddress class matching for passive data transfers.- Issue 1353 - Implement support for PCRE2.- Bug 4466 - ProFTPD won't start with several locales.- Issue 1367 - Auth sources providing space-bearing user/group names cause compliance issues with MLSD/MLST responses.- Bug 4467 - DeleteAbortedStores removes successfully transferred files unexpectedly.- Issue 1383 - Omit EPRT/EPSV from FEAT response when denied by <Limit> configuration.- Issue 1379 - Support uploading to symlinked files.- Issue 1401 - Keepalive socket options should be set using IPPROTO\_TCP, not SOL\_SOCKET.- Issue 1402 - TCP keepalive SocketOptions should apply to control as well as data connection.- Issue 1396 - ProFTPD always uses the same PassivePorts port for first transfer.- Issue 1410 - mod\_sftp needs to handle unknown SSH messages in an RFC-compliant manner, ignoring rather than disconnecting.- Issue 1418 - Improve handling of some globally applied configuration directives.- Issue 1369 - Name-based virtual hosts not working as expected after upgrade from 1.3.7a to 1.3.7b.
1.3.8rc2 - Released 29-Aug-2021--------------------------------- Bug 4401 - mod\_sftp crashes when handling aes256-ctr OpenSSH-specific key with some old OpenSSL versions.- Issue 1273 - Improve mod\_tls log messages for unsupported older TLS protocol requests.- Issue 1284 - Fix memory disclosure to RADIUS servers by mod\_radius.- Issue 1282 - Properly handle <VirtualHost> sections that use interface/device names.- Bug 4315 - mod\_ifsession fails to reset directory config lookup after <Directory> section merges.- Issue 1296 - Support <Limit> configurations for HELP command.- Issue 1300 - PCRE expressions with capture groups are not being handled properly.- Issue 1307 - AuthUserFile permissions check fails during SIGHUP, causing ProFTPD to stop.- Issue 1286 - Add support for the libidn2 library, over libidn, for e.g. mod\_rewrite mappings.- Bug 4443 - Changed the default behavior of mod\_tls, such that TLS renegotiations on control/data connections are not requested by default. TLS renegotiations have a long and sordid history; many SSL/TLS libraries no longer implement them, or disable them by default.- Issue 1319 - mod\_auth\_otp should honor RequireTableEntry semantics for SFTP logins.
1.3.8rc1 - Released 13-Jun-2021--------------------------------- Issue 1063 - FTPS data transfers using TLSv1.3 might segfault when session tickets cannot be decrypted.- Issue 1070 - Implement support for Redis 6.x AUTH semantics.- Issue 1068 - Define an OpenSSL API version compatibility macro, currently set to OpenSSL 1.0.0 and later.- Bug 4405 - Memory use-after-free in mod\_sftp causes unexpected login/authentication issues.- Bug 4402 - Inappropriate handling of aborted FTP data transfers causes issues for some FTP clients.- Issue 1084 - Implement support for configuring TLSv1.3 ciphersuites.- Issue 1086 - Update TLSRenegotiate to work properly for TLSv1.3 sessions.- Issue 1079 - prxs fails to detect module-specific configure/Makefile, leading to unexpected module load errors.- Issue 1074 - TLS SNI connections to name-based VirtualHosts with TLSCertificateChainFile fail unexpectedly.- Issue 1089 - Deprecate the MultilineRFC2228 directive.- Issue 1067 - Generate new DH parameters for mod\_tls, mod\_sftp for 1.3.8.- Issue 1101 - Update TLS minimum supported DH parameter size to 2048.- Issue 811 - Support adding custom key/values to RedisLogOnCommand.- Issue 1106 - TLS SNI can cause mod\_quotatab to crash due to null pointer dereferences.- Issue 1076 - TLS client-initiated renegotiations are supported unexpectedly.- Issue 1105 - Improper handling of multiple IP addresses, ServerAliases in <VirtualHost> sections.- Issue 1048 - Support using weak TLS certificates via the new AllowWeakSecurity TLSOption.- Issue 1149 - mod\_quotatab\_sql failing due to SQL syntax errors. This is a regression caused by Issue #392.- Issue 1061 - Freeing uninitialized memory causes SFTP issues with ed25519 keys.- Issue 1111 - "Corrupted MAC on input" errors using SFTP umac-64@openssh.com digest.- Issue 1171 - PassivePort randomization is broken due to SO\_REUSEPORT option.- Issue 1072 - Support configurable certificate settings in Redis SSL/TLS connections.- Issue 369 - Provide function for obtaining memory pool information as e.g. JSON.- Issue 1134 - AuthUserFile-based logins, directory listings are very slow due to unbuffered reads.- Issue 1193 - Improper checking for reused TLS session for data transfers using OpenSSL 1.1.1.- Issue 1168 - Improve error handling of OpenSSH host keys converted to PEM format.- Issue 1179 - TLSRSACertificateKeyFile sanity checks fail unexpectedly for passphrase-protected keys.- Issue 1174 - ftptop segfaults when using libncursesw on Gentoo.- Issue 1204 - Once TLSTimeoutHandshake is reached, internal "timed out" flag never reset.- Issue 1133 - Support include files in mod\_wrap2 allow/deny tables.- Issue 1200 - Disconnect SFTP clients that request unsupportable protocol versions.- Issue 1207 - On Gentoo, "./configure --disable-ncurses" fails to link ftptop, due to "undefined reference to symbol 'stdscr'" error.- Issue 1212 - mod\_sql\_mysql needs to quote table names due to reserved MySQL keywords.- Issue 1175 - Unable to set per-user TLSOptions using mod\_ifsession.- Issue 754 - Some mod\_snmp counters were not being incremented properly.- Issue 548 - `make install` target should install only, not recompile any code.- Bug 4428 - <VirtualHost> name resolution does not include all associated IPv6 records.- Issue 1230 - Stack overflow due to unlimited recursion possible when parsing JSON text.- Issue 1232 - Unable to use %{env:FTPS} in a SQLNamedQuery. The fix is to now use %{note:FTPS} instead.- Issue 1170 - Implement support for user/host combination bans in mod\_ban.- Issue 1246 - mod\_sftp\_sql crashes (sigsegv) on NULL key.- Issue 1237 - ftpasswd should default to SHA256, not MD5.- Issue 490 - Support syntax checks on AuthUserFiles, AuthGroupFiles on startup.
1.3.7 - Released 20-Jul-2020--------------------------------- Issue 1027 - mod\_ldap crashes at ldap\_mod\_init().- Issue 1038 - Support the SOURCE\_DATE\_EPOCH environment variable, for reproducible builds.- Issue 1043 - Invalid SCP command leads to null pointer dereference.
1.3.7rc4 - Released 30-May-2020--------------------------------- Bug 4376 - mod\_sftp incorrectly handles SFTP protocol version 5/6 disposition flag.- Issue 908 - mod\_sql\_passwd fails to compile on FreeBSD due to timingsafe\_bcmp function.- Issue 907 - Implemented support for RSA SHA-2 publickey signatures in mod\_sftp, per RFC 8332.- Issue 912 - Support logging of data transfer remote ports in ExtendedLog.- Issue 317 - Implement pread(2), pwrite(2) FSIO API.- Issue 857 - Fixed regression in the handling of `%{env:...}` configuration variables when the environment variable is not present.- Issue 940 - Second LIST of the same symlink shows different results.- Bug 4394 - LogFormat %a gives local server IP address instead of remote client IP address.- Issue 946 - Improve handling of ldaps URLs, LDAPUseTLS directive in mod\_ldap.- Issue 82 - Support configurable certificate settings in LDAP SSL/TLS connections.- Issue 947 - Support use of SASL auth mechanisms for LDAPBindDN binds.- Issue 954 - Support buggy/ill-behaved FTPS client shutdown behavior for CCC command.- Issue 959 - FTPS uploads using TLSv1.3 are likely to fail unexpectedly.- Issue 682 - IPv6 addresses not properly parsed in From directives, causing unexpected <IfClass> mismatches.- Issue 964 - Unable to load mod\_sftp, mod\_sql\_passwd as shared modules on Alpine.- Issue 968 - Require TLSv1.3 data connection sessions to reuse same session as control connection for TLSv1.3 session tickets.- Issue 366 - ftptop should support batch mode. ftptop now supports -b and -n command-line options, like top(1).- Issue 808 - ProFTPD should ignore supplemental groups when run as a non-root user.- Issue 980 - mod\_sftp sends broken response when CREATETIME attribute is requested.- Bug 4390 - Implement keepalive support for mod\_sql/database connections.- Issue 693 - mod\_sftp unsuccessful login count issues on AIX.- Issue 984 - Do not send EXT\_INFO messages to SSH clients which did not signal "ext-info-c".- Issue 983 - Use re-entrant versions of time functions where available.- Bug 4398 - Handle zero-length SFTP WRITE requests without error.- Bug 4185 - Implement options for tuning fields used in syslog/module logging.- Issue 1010 - Allow ban entries to apply to all <VirtualHost> sections.- Issue 1018 - PidFile should not be world-writable.- Issue 1014 - TLSv1.3 handshake fails due to missing session ticket key on some systems.- Issue 1023 - Lowercased FTP commands not properly identified.
1.3.7rc3 - Released 20-Feb-2020--------------------------------- Issue 810 - mod\_tls does not compile with LibreSSL 2.9.x.- Issue 750 - MaxClientsPerUser not enforced for SFTP logins when mod\_digest enabled.- Issue 850 - mod\_tls should honor SNI in TLS handshake.- Issue 692 - Support bcrypt passwords in mod\_sql\_passwd.- Issue 793 - mod\_sftp does not support OpenSSH-specific private key format.- Bug 4221 - Add support for ssh-ed25519 keys.- Issue 863 - Directory listing is slower compared to previous ProFTPD versions.- Issue 859 - Improper handling of TLS CRL lookups.- Bug 4340 - "SocketOptions keepalive off" does not disable TCP keepalive on control connection.- Issue 870 - Leaking PAM handler and data in case of unsuccessful authentication.- Bug 4385 - SSH authentication fails for many clients due to receiving of SSH\_MSG\_IGNORE packet.- Issue 872 - Show PathAllowFilter, PathDenyFilter failure in system logging. Commands denied by these Filter directives are now logged at the NOTICE level in the system logging.- Bug 4382 - Incorrect %F SQLLog with SFTP, not FTP, uploads.- Issue 882 - mod\_sql "named connection already exists" error when using name-based virtual hosts.- Issue 890 - SFTP publickey authentication fails unexpectedly when user has no shadow password info.- Issue 898 - ftpasswd fails to restore password file permissions in some cases.- Issue 903 - Use-after-free vulnerability in memory pools during data transfer.- Issue 902 - Out-of-bounds read in mod\_cap getstateflags() function. This happens because of an out-of-date libcap version; we now rely solely on the system-provided libcap library.
1.3.7rc2 - Released 19-Oct-2019--------------------------------- Issue 846 - Remote denial-of-service due to issue in network IO handling (CVE-2019-18217).
1.3.7rc1 - Released 12-Oct-2019--------------------------------- Bug 4304 - Configure script wrongly detects AIX lastlog functions.- Bug 3127 - ProFTPD does not build when configure is run from directory other than source directory.- Bug 4279 - Disable Blowfish, RC4, RIPE-MD160 SSH2 algorithms by default.- Bug 4306 - AllowChrootSymlinks off could cause login failures depending on filesystem permissions.- Issue 269 - Disable building of mod\_ident by default.- Issue 501 - mod\_ctrls: error: unable to bind to local socket: Address already in use.- Issue 507 - Failed to handle multiple %{env:...} variables in single word in configuration.- Issue 515 - Support %b variable for ExecEnviron directive.- Issue 521 - Broken OCSP Stapling implementation fails to find issuing certificate properly.- Issue 518 - Provide option to disable sending of fake "tryLater" OCSP response.- Issue 519 - Improve handling of cached OCSP responses.- Bug 4307 - High CPU load on CWD to non existing directory. This has been addressed by improving the in-memory config tree DFS algorithm to short-circuit recursive searching where possible.- Issue 505 - Support MODE Z even for FTPS sessions.- Issue 351 - Support FTP RANG command.- Bug 4308 - mod\_sftp fails to check shadow password information when publickey authentication used.- Bug 4309 - Use of "AllowEmptyPasswords off" breaks SFTP/SCP logins.- Issue 534 - Support configuring multiple curves using TLSECDHCurve.- Bug 4310 - Use of mod\_facl as static module causes ProFTPD to die on SIGHUP/restart.- Bug 4311 - Directory creation in mod\_site\_misc, mod\_copy does not honor directory Umask.- Issue 445 - Remove non-functional TransferPriority directive.- Issue 550 - Support Redis SELECT for multiple databases.- Issue 396 - Support for Redis Sentinel deployments in mod\_redis.- Issue 556 - Use of curve25519-sha256@libssh.org SSH2 key exchange sometimes fails.- Issue 536 - Support TLSv1.3 (assuming OpenSSL support).- Bug 4312 - Close extra file descriptors at startup.- Bug 4314 - <Anonymous> with AuthAliasOnly in effect does not work as expected.- Issue 568 - CreateHome NoRootPrivs only works partially.- Bug 4313 - ExtendedLog incorrectly/unexpectedly logs unknown/unsupported commands.- Issue 578 - SFTP OPEN response includes attribute flags that are not actually provided.- Bug 4318 - Truncation of file while being downloaded with sendfile enabled causes timeouts due to infinite loop.- Bug 4320 - Confusing mod\_sftp log message "disconnected by user (Application error)" changed to "(Application disconnected)".- Bug 4241 - RootRevoke should be on/true by default.- Bug 4281 - Redesign support for Backend SQLAuthType for MySQL. If the MySQL client library cannot support the SQLAuthType Backend, mod\_sql\_mysql will emit a warning on startup.- Bug 4319 - FTP uploads frequently break due to "Interrupted system call" error.- Issue 618 - Site-to-site transfers over TLS fail.- Bug 4322 - Can't see symlinks using any FTP client when using MLSD.- Issue 610 - Generate new DH parameters for mod\_tls, mod\_sftp for 1.3.7.- Bug 4325 - mod\_tls 1.3.6 fails to compile using OpenSSL 0.9.8e.- Bug 4326 - Using MaxClientsPerHost 1 in <Anonymous> section denies logins.- Issue 642 - SQLNamedConnectInfo with different backend database does not work properly.- Issue 654 - mod\_sql\_sqlite should error if configured SQLite database does not exist.- Issue 656 - Segfault with mod\_sftp+mod\_sftp\_pam after successful authentication using keyboard-interactive method- Issue 660 - autoconf always fails to detect support for FIPS.- Issue 663 - SFTP connections fail when using "arcfour256" cipher.- Bug 4335 - mod\_auth\_otp fails to build with OpenSSL 1.1.x.- Bug 4341 - scp broken on FreeBSD 11.- Issue 676 - SQLLog for SCP: %{file-size} is not available.- Issue 674 - Update mod\_sftp to handle changed APIs in OpenSSL 1.1.x releases.- Bug 4356 - Infinite loop possible in mod\_sftp's set\_sftphostkey() function.- Bug 4352 - Some ASCII text files corrupted when downloading.- Issue 797 - Properly use the --includedir, --libdir configure variables in the generated proftpd.pc pkgconfig file.- Bug 4350 - Reading invalid SSH key from database results in unexpected/unlogged disconnect failures.- Bug 4332 - Symlink navigation broken after 1.3.6 update. The changes for Bug#4219 have been rolled back.- Issue 795 - Unable to connect to ProFTPD using TLSSessionTickets and TLSv1.3.- Bug 4372 - SITE CPFR/CPTO do not honor <Limit> configurations.- Issue 807 - Using "TLSProtocol SSLv23" does not enable all protocol versions.
1.3.6 - Released 09-Apr-2017--------------------------------- Bug 4284 - SITE UTIME not working with group permissions.- Bug 4289 - LDAPSearchScope does not alter search scope as expected. When the LDAPServer directive is used with LDAP URLs, the LDAPSearchScope should not be used; the handler was failing to handle this case properly.- Bug 4285 - In AIX, log failed logins so that user accounts can be locked by the OS after multiple failed login attempts.- Added mod\_wrap2\_redis to the contrib/ modules directory.- Bug 4295 - AllowChrootSymlinks off does not check entire DefaultRoot path for symlinks (CVE-2017-7418).- Bug 4299 - TimeoutLogin not working for SFTP connections.
1.3.6rc4 - Released 15-Jan-2017--------------------------------- Bug 4283 - All FTP logins treated as anonymous logins again. This is a regression of Bug#3307.
1.3.6rc3 - Released 14-Jan-2017--------------------------------- Bug 4222 - Add support for curve25519-sha256@libssh.org key exchange.- Bug 4186 - ProFTPD creates name-based vhost when it should not.- Bug 4233 - Support enforcing minimum key lengths for SFTP/SCP.- Bug 4235 - Recursive SCP uploads of directories fail with "No such file or directory".- Bug 4154 - Support for scrypt in mod\_sql\_passwd. This also includes support for Argon2, assuming use of libsodium-1.0.9 or later.- Bug 4237 - Corrupted ASCII uploads. The refactoring work for Bug#4151 had introduced a bug in the handling of ASCII uploads, now fixed.- Bug 4220 - Support reading geoip filters from SQL databases.- Bug 4242 - Using mod\_memcache results in segfault (signal 11). Caused by a bug in libmemcached-1.0.18 and earlier.- Bug 4244 - Long-running sessions consume memory continuously.- Bug 4248 - ALLO command failed unexpectedly.- Bug 4247 - ProFTPD runs out of memory when listing very large directories (e.g. over 400GB).- Bug 4254 - SSH rekey during authentication can cause issues with clients.- Bug 4257 - Recursive SCP uploads of multiple directories not handled properly.- Bug 4252 - Clients sometimes receive extra 450 response on ABOR.- Bug 4259 - LIST returns different results for file, depending on path syntax.- Bug 4255 - "AuthAliasOnly on" in server config breaks anonymous logins. - Bug 4240 - Support OpenSSL 1.1.x API.- Bug 4262 - SITE CPTO returns 250 even when the copy operation fails due to the user's quota being exceeded.- Bug 4263 - SITE CPTO terminated by TimeoutIdle.- Bug 4265 - Omit version information from ServerIdent banner by default.- Bug 4264 - Support larger fixed DH groups in SSH key exchange.- Bug 3849 - Allow wildcarded directory names in Include patterns.- Bug 3662 - Allow SIZE command while in ASCII mode via build-time option.- Bug 4272 - CapabilitiesEngine directive not honored for <IfUser>/<IfGroup> sections.- Bug 4267 - NLST should allow for sorted output. The ListOptions directive now supports a SortedNLST flag for such use cases.- Bug 4260 - Restarting server fails when using password-protected SSL certificates and no TLSPassPhraseProvider.- Bug 4216 - SSH rekeying causes invalid packet due to interrupting timer.- Bug 4278 - Memory leak when mod\_facl is used.
1.3.6rc2 - Released 10-Mar-2016--------------------------------- Bug 4187 - mod\_geoip does not load all of the GeoIPTables properly.- Bug 4167 - CR/LF characters are not supported in filenames.- Bug 4188 - Support filtering based on country code and regional code in mod\_geoip.- Bug 4151 - FTP ASCII mode conversion algorithm is painfully slow.- Bug 4139 - Support rejecting empty passwords. See new AllowEmptyPasswords directive.- Bug 4189 - Support protocol exclusion via TLSProtocol directive.- Bug 4153 - Support requiring multiple SSH authentication methods.- Bug 4191 - "Incorrect string value" reported by mod\_sql\_mysql for some UTF8 characters.- Bug 4097 - SSH rekey fails when using RSA hostkey smaller than 2048 bits.- Bug 4198 - MLSD/MLST fact type "cdir" is incorrectly used for the current working directory.- Bug 4201 - HiddenStores temporary files not removed when exceeding quota using SCP.- Bug 4202 - MLSD lines not properly terminated with CRLF.- Bug 4209 - Zero-length memory allocation possible, with undefined results.- Bug 4210 - Avoid unbounded SFTP extended attribute key/values.- Bug 4104 - Handle MasqueradeAddress resolution errors due to startup sequencing.- Bug 4056 - Support using JSON when storing ban information in memcached.- Bug 4057 - Support using JSON when storing TLS session information in memcached.- Bug 4212 - Ensure that FTP data transfer commands fail appropriately when "RootRevoke on" is in effect.- Bug 4175 - Support for OCSP stapling.- Bug 4176 - Support for TLS session tickets.- Bug 4200 - Support TLS client configuration for SQL servers.- Bug 4213 - Deprecate the NoCertRequest TLSOption.- Bug 4214 - Allow UseEncoding to be set on a per-user basis.- Bug 4217 - Handle FTP re-authentication attempts better.- Bug 4218 - Support a LogFormat variable for logging command duration in milliseconds.- Bug 4223 - Permissions on files uploaded via STOU do not honor configured Umask.- Bug 4219 - Better handling of symlinks when chrooted.- Bug 4224 - Prohibit FTP indexing by web crawlers via auto-generated robots.txt.- Added mod\_auth\_otp, mod\_digest, mod\_statcache to the contrib/ modules directory.- Bug 4227 - Support SFTP clients that send multiple INIT requests.- Bug 4230 - TLSDHParamFile directive appears ignored because unexpected DH is chosen.
1.3.6rc1 - Released 27-May-2015--------------------------------- Bug 4055 - "error setting listen fd IPV6\_TCLASS: Protocol not available" log message.- Bug 3944 - Session closed if active data transfer fails due to "Address already in use" error.- Bug 3983 - Change default SyslogLevel to be NOTICE rather than DEBUG.- Bug 3990 - Use 213 response code for STAT on a file. STAT on a directory now results in a 212 response code as well, per RFC 959.- Bug 4061 - SNMPAgent should support multiple addresses, including IPv6 addresses.- Bug 4062 - Support PID variable in HiddenStores filename.- Bug 4065 - mod\_sftp should provide the SSH client banner as environment variable, for logging.- Bug 4067 - Create ExtendedLog class for SFTP requests.- Bug 4068 - MaxClients directive doesn't work for <Anonymous> sessions.- Bug 4069 - NLST -a shows / directory instead of the current directory.- Bug 4063 - Unable to create directory on NFS/CIFS partition: Permission denied.- Bug 4073 - Polycom VOIP phones unable to use FTPS data transfers.- Bug 4070 - Support wider range of causes of authentication failure.- Bug 4077 - ShaperLog not closed/reopened on SIGHUP, causing log rotation problems.- Bug 4076 - Ability to disable mod\_exec on a per-directory basis.- Bug 4079 - Invalid response encoding for SFTP space-available request.- Bug 4080 - mod\_sftp does not implement SFTP LINK request properly.- Bug 4083 - Using SQLDefaultHomedir with null home results in "No such user".- Bug 4084 - "NLST \*" returns files from subdirectories.- Bug 4081 - Not possible to create relative symlinks with SFTP.- Bug 4087 - mod\_sftp does not handle "MaxLoginAttempts none" properly.- Bug 4089 - mod\_sftp does not allow multiple attempts using a given authentication method.- Bug 4090 - mod\_wrap2\_file does not support IPv6 addresses properly.- Bug 4091 - Log "Operation not permitted" privs errors at NOTICE rather than ERROR.- Bug 4093 - Improve mod\_sftp handling of missing packet payloads.- Bug 4050 - Use of PIPE\_BUF causes build failure on platforms without it.- Bug 4020 - Add minimum delay options to mod\_delay functionality.- Bug 4030 - Cache negative/failed Auth API name/ID lookups.- Bug 4094 - Available space on file system using %f displays wrong value.- Bug 4012 - Failure to build mod\_tls when using static libcrypto due to libdl linker errors.- Bug 4098 - mod\_sftp unable to use SFTPHostKey due to being group readable in CentOS 7.- Bug 4108 - SSL handshakes for data connections sometimes stall for 3-30 seconds.- Bug 4109 - setsockopt() call for IPV6\_TCLASS should use IPPROTO\_IPV6.- Bug 4110 - proftpd on Solaris should use /dev/conslog instead of /dev/log.- Bug 4114 - mod\_tls should not support SSLv3 by default.- Bug 4112 - Failure to connect using mod\_sftp sometimes due to too-small buffers.- Bug 4035 - HiddenStores file not renamed every time.- Bug 4116 - Report exact SSL/TLS protocol version used in client connections.- Bug 4124 - DeleteAbortedStores defaults to "on" for all transfers, not just HiddenStores.- Bug 4129 - mod\_sql caches incorrect UID/GID when name cannot be retrieved.- Bug 4130 - Support the 3-timestamp form of SITE UTIME.- Bug 4131 - mod\_sftp's autoconf script does not detect OpenSSL SHA2 support.- Bug 4058 - Create a 'timing' trace channel, for timing-related data.- Bug 4125 - mod\_lang should provide way to reject illegally-encoded filenames.- Bug 4060 - Support unsorted LIST entries (-U) to decrease memory/CPU usage for large directory listings.- Bug 4133 - LDAPUsers directive does not honor uid-number-filter-template parameter.- Bug 4137 - GeoIPDenyFilter incorrectly takes precedence over GeoIPAllowFilter.- Bug 4138 - Support for hex-encoded salts in mod\_sql\_passwd.- Bug 4140 - SFTP READLINK requests to symlinks to directories fail.- Bug 4143 - HTTPS/FTPS protocol confusion leads to XSS.- Bug 4144 - Support APPE when HiddenStores are enabled.- Bug 4031 - Support JSON output format for ftpwho.- Bug 4145 - Segfault if AuthUserFile is a relative symlink.- Bug 4152 - Reduce logging of non-fatal "unable to open incoming connection" errors.- Bug 4155 - SSH keys with too-long Comment headers aren't recognized by mod\_sftp\_sql.- Bug 4159 - Support ability to disable ASCII translation transparently to FTP clients.- Bug 4156 - Segfault handling LIST/NLST FTP command on Mac OS X.- Bug 4160 - Malformed response to SSH\_FXP\_REALPATH with SFTP version 6.- Bug 4163 - Remove support for EXPORT grade ciphers.- Bug 4164 - mod\_sql fails to read UID/GID values larger than 32 bits from SQL tables.- Bug 4157 - LIST/NLST of 1000s of files is slow on some platforms.- Bug 4059 - Implement additional RADIUS attributes.- Bug 4166 - mod\_sftp sessions consume large amounts of memory due to rekeying.- Bug 4169 - Unauthenticated copying of files via SITE CPFR/CPTO allowed by mod\_copy.- Bug 4170 - Incorrect handling of control-byte field of SSH\_FXP\_REALPATH as bitmask rather than enumeration for SFTP protocol version 6.- Bug 4168 - Race condition with HiddenStores and TimeoutIdle timeout, causing hidden file not to be cleaned up properly.- Bug 3125 - Support for Mac OS X implementation of POSIX ACLs.- Bug 4174 - Support for TLS-PSK (pre-shared keys).- Bug 4178 - TLS session reuse requirement for data connections not properly enforced.- Bug 4184 - Remove support for "weak" Diffie-Hellman groups.- Bug 3289 - Support the HOST command.
1.3.5 - Released 15-May-2014--------------------------------- Bug 4018 - Implement checks for sensitive directories when chrooted.- Bug 4022 - "Directory not empty" error when creating directory is misleading.- Bug 4025 - <IfClass> sections do not work for multiple SQLLog directives.- Bug 4029 - TLSOptions EnableDiags logs "unknown version (771)" for TLS 1.1/1.2 connections.- Bug 3938 - mod\_wrap2 uses reverse DNS regardless "UseReverseDNS off".- Bug 4032 - Restarting proftpd with mod\_sftp fails due to permissions on SFTPHostKey file.- Bug 4033 - mod\_sftp fails to create SSH2 session using 'none' cipher.- Bug 4034 - SSH publickey authentication fails with "MaxLoginAttempts 1".- Bug 4024 - TLS 1.1/1.2 configurable, but not properly implemented.- Bug 4046 - ALLO command failed because of bad size check.- Bug 4048 - Race condition in mod\_ban can lead to segfault of all new connections.- Bug 4049 - mod\_exec should include supplemental groups when running commands as logged-in user.- Bug 4042 - MIC command between RNFR and RNTO should not be rejected.- Bug 4044 - mod\_facl prevents a normal SIGHUP reload.- Bug 4052 - Enhance SQLPasswordPBKDF2 to support per-user query for settings.
1.3.5rc4 - Released 28-Jan-2014--------------------------------- Bug 3945 - Spurious log messages at session close.- Bug 3946 - Null pointer dereference causes segfault when logging %{transfer-status}, %{transfer-failure} LogFormat variables on EXIT.- Bug 3947 - LogFormat %f variable not resolved properly for SFTP renames.- Bug 3950 - LogFormat %d/%D variables not resolved properly for directory listings.- Bug 3949 - RNFR/RNTO not logged as expected for SFTP EXTENDED posix-rename@openssh.com requests.- Bug 3948 - Support FTP response codes in ExtendedLog for SFTP data transfers.- Bug 3858 - mod\_delay allows too-large values, leading to client hang on authentication.- Bug 3951 - Null pointer dereference for mod\_ldap logins when LDAPDefaultAuthScheme not configured.- Bug 3954 - scp downloads result in segfault.- Bug 3957 - ProFTPD configuration with thousands of <Directory>/<Limit> sections leads to slow logins.- Bug 3959 - mod\_sftp does not honor <Directory>/<Limit> sections when symlinks are involved.- Bug 3958 - Directory creation does not honor single-parameter Umask setting.- Bug 3960 - Support the CAP\_FSETID Linux capability, for preserving directory SGID bit.- Bug 3962 - Directory creation fails (chmod(2) EPERM) when root privs are used in some cases.- Bug 3955 - Support secure FXP (site-to-site) transfers using SSCN.- Bug 3966 - LogFormat %f variable not resolved for some commands.- Bug 3971 - Support SQLOption for ignoring client library config files when needed.- Bug 3972 - Authentication error on Cygwin due to bad code.- Bug 3973 - mod\_sftp can be forced to allocate too much memory for keyboard-interactive authentication.- Bug 3974 - PathDenyFilter directive does not work as expected for SFTP sessions.- Bug 3963 - Improve permission setting when creating directories.- Bug 3975 - Error printed to stderr when loading GeoIP Lite country database using IndexCache flag.- Bug 3976 - ProFTPD terminating (signal 11) crash for GeoLiteCity-20130903 database lookup.- Bug 3964 - Support running ExecOnEvent actions with logged-in user's permissions.- Bug 3979 - mod\_sql\_odbc compiler warnings on 64-bit systems using unixODBC.- Bug 3952 - Make PersistentPasswd default to 'off'.- Bug 3981 - Null pointer dereference in mod\_exec with ExecOption useStdin.- Bug 3982 - Normalize log messages and levels.- Bug 3888 - Add LDAPLog directive to mod\_ldap.- Bug 3986 - Support filesystems which do not support chmod(2)/chown(2), e.g. FAT/ExFAT.- Bug 3991 - SSL session caching modules use incorrect OpenSSL cache mode flags, breaking session caching.- Bug 3987 - LogFormat variable for just the filename.- Bug 3965 - Timeout directives have inconsistent maximum values.- Bug 3998 - Support IgnoreSCPUploadTimes SFTPOption.- Bug 3995 - ftpasswd utility should prevent concurrent modification of files.- Bug 3994 - ftpasswd utility should support --lock/--unlock options.- Bug 3970 - ProFTPD should not use fd 2 (stderr) for files. - Bug 3772 - Support Elliptic Curve Cryptography (ECC) certs for FTPS connections.- Bug 3992 - RSA signature issue when connecting using PuTTY/WinSCP.- Bug 3996 - Handling ALLO command can result in wrong response when chrooted.- Bug 3876 - ExecOnEvent should be configurable per <VirtualHost>/<Global>.- Bug 4001 - mod\_sftp fails key exchange for 8192-bit DH group.- Bug 4002 - Add 7680-bit DH parameter to mod\_sftp bundled dhparams.pem file. A 3072-bit DH group was also added.- Bug 4004 - IgnoreSCPUploadPerms SFTPOption not honored properly for SCP directory upload.- Bug 4006 - RADIUS "service-type" attribute encoded with wrong length on 64-bit system.- Bug 4011 - NLST ../ shows current directory contents rather than parent directory.- Bug 4013 - SCP upload of shorter file does not completely overwrite existing file of same name.- Bug 4014 - CommandBufferSize should override PR\_DEFAULT\_CMD\_BUFSZ.
1.3.5rc3 - Released 14-Jun-2013--------------------------------- Bug 3910 - Clang's scan-build warns on set[u][g]id unchecked return value.- Bug 3914 - 1.3.5rc2 fails to build on Solaris 10.- Bug 3917 - Make DeleteAbortedStores on by default when HiddenStores enabled.- Bug 3918 - mod\_sftp segfault after SIGHUP when evaluating client banner.- Bug 3864 - Support SQL query to lookup/use primary key for logged-in user/group.- Bug 3920 - Support umac-64@openssh.com digest for mod\_sftp.- Bug 3921 - Single failed keyboard-interactive login attempt causes SSH connection to close prematurely.- Bug 3923 - mod\_cap does not revoke root privileges properly for SFTP connections.- Bug 3926 - Support OpenSSH fsync SFTP extension.- Bug 3925 - SFTP directory listings are sensitive to locale environment variables.- Bug 3924 - HideFiles does not filter symlinks.- Bug 3929 - pam\_session\_close() requires root privs on some platforms.- Bug 3932 - SQLAuthType Backend returns "password mismatch" for MySQL PASSWORD().- Bug 3934 - HideUser/HideGroup do not work as expected for virtual users.- Bug 3935 - scp download of nonexistent file results in client hang.- Bug 3927 - Default ControlsSocket created despite custom ControlsSocket path.- Bug 3937 - Segfault when retrieving SSH public key from LDAP directory.- Added new mod\_snmp contrib module.- Bug 3939 - Disable Controls for "ServerType inetd" servers.- Bug 3942 - mod\_sftp\_sql should support multiple keys concatenated together in a single column.- Bug 3943 - Support for PBKDF2 passwords in mod\_sql\_passwd.- Bug 3941 - RLimitProcesses causes problems with setuid/setreuid.
1.3.5rc2 - Released 06-Mar-2013--------------------------------- Bug 3859 - MLSD fails to show symlinks when ShowSymlinks is not configured.- Bug 3860 - Add a default deny option for mod\_geoip.- Bug 3862 - Support for FTPS-specific MasqueradeAddress functionality. A new TLSMasqueradeAddress directive has been added to mod\_tls.- Bug 3863 - mod\_sftp does not handle MaxLoginAttempts properly.- Bug 3865 - BanEngine not set in "server config" results in "mod\_ban not enabled" ftpdctl error.- Bug 3866 - Issuing invalid 'ftpdctl ban' request causes segfault.- Bug 3867 - ftpasswd fails with "Permission denied" when adding subsequent passwd/group entries.- Bug 3868 - Only first DH param in TLSDHParamFile is used, regardless of requested keylength.- Bug 3870 - Handling of OPTS command can lead to crash.- Bug 3779 - Generate new DH parameters for mod\_tls and mod\_sftp.- Bug 3871 - REALPATH SFTP request not properly handled by <Limit DIRS> configuration.- Bug 3872 - Use HiddenStores directive to customise suffix.- Bug 3873 - Provide FTP response code in ExtendedLog for failed SFTP REMOVE request.- Bug 3869 - Use longer SSL session cache expiration by default.- Bug 3874 - Use of O\_EXCL flag on HiddenStores files might break for NFS filesystems.- Bug 3878 - QuotaExcludeFilter not honored for uploads when 'hard' limits are used.- Bug 3879 - Allow additional columns in SQLNamedQuery queries used for quota limits and tallies.- Bug 3882 - DisplayLogin with an absolute path does not work properly within an <IfGroup> section.- Added new mod\_log\_forensic contrib module.- Bug 3881 - <Directory> sections within <IfGroup> sections not applied as expected.- Bug 3884 - Configure script not detecting MySQL make\_scrambled\_password functions.- Bug 3887 - <Limit ALL> erroneously blocks the PROT command used for FTPS.- Bug 3819 - Second and subsequent LIST of directory with many files is very slow.- Bug 3889 - Support millisecond timestamp LogFormat variable.- Bug 3891 - Allow TLSProtocol directive in <VirtualHost> and <Global> sections.- Bug 3753 - Support SFTP request names in <Limit> sections better.- Bug 3892 - mod\_auth\_file should have strict permission checks of configured files.- Bug 3893 - Add SQLLogOnEvent directive, for performing SQL query on configurable event.- Bug 3894 - ftptop doesn't work with --enable-nls.- Bug 3895 - Missing TransferLog entry under some out-of-space conditions.- Bug 3897 - mod\_sftp does not handle a REALPATH request properly for SFTP protocol version 6.- Bug 3896 - Warn when world-writable config files are used.- Bug 3899 - Support authentication of users based on SSL/TLS client certificate.- Bug 3903 - With mod\_log\_forensic enabled, SSH connections fail randomly.- Bug 3905 - Handle the Linux-specific PAM\_RADIO\_TYPE message properly.- Bug 3709 - Support download-triggered emails in the ftpmail script.- Bug 3904 - scp downloads using glob pattern sometimes fails.- Bug 3900 - ProFTPD terminating (signal 11) on some sftp connections.- Bug 3906 - Support ban rule for clients which perform SSL/TLS handshakes too frequently.
1.3.5rc1 - Released 04-Jan-2013--------------------------------- Bug 3712 - mod\_wrap2/mod\_load build errors: missing config.h.- Bug 3713 - mod\_tls cannot be compiled using Openssl 0.9.6.- Bug 3646 - Debug logging to stderr should include timestamps and PID.- Bug 3714 - ftpwho/ftptop are not showing command arguments (e.g. downloaded file name).- Bug 3715 - MLSD/MLST fail when "DirFakeUser off" or "DirFakeGroup off" used.- Bug 3717 - proftpd fails to run with "Abort trap" error message.- Bug 3719 - LIST -R can loop endlessly if bad directory symlink exists.- Bug 3720 - Various module logfile permissions are 0600 instead of 0640.- Bug 3723 - mod\_memcache segfault on server restart.- Bug 3721 - mod\_rewrite does not replace characters if there are more than 8 occurrences. To handle this situation, a new RewriteMaxReplace directive has been added for configuring this limit.- Bug 3724 - Unloading mod\_quotatab causes segfault.- Bug 3686 - Support SHA2 digests in mod\_sftp. See the SFTPDigests directive documentation for more information.- Bug 3629 - Support <IfAuthenticated> conditional config section.- Bug 3682 - Configure does not detect libiconv under Gentoo FreeBSD.- Bug 3726 - mod\_exec does not always capture stdout/stderr output from executed command.- Bug 3727 - mod\_wrap2 causes unexpected LogFormat %u expansion for SFTP connections.- Bug 3729 - mod\_ldap can segfault when LDAPUsers is used with no optional filters.- Bug 3728 - Build failure in wtmp.c on Gentoo/FreeBSD on sparc.- Bug 3734 - DirFakeUser/DirFakeGroup off with name causes SIGSEGV for MLSD/MLST commands.- Bug 3739 - Allow for configurable SSH version identifiers in mod\_sftp. The SSH version identifier can now be configured for mod\_sftp via the ServerIdent directive.- Bug 3718 - ftptop fails to build on OpenSUSE.- Bug 3699 - ProFTPD crash on start up on Mac OSX Lion with NLS enabled.- Bug 3744 - Support ls(1) -1 option for LIST command.- Bug 3746 - Support applying ListOptions only to NLST or to LIST commands.- Bug 3747 - Support option for displaying symlinks via MLSD using syntax preferred by FileZilla. The new FactsOptions directive can be used for this purpose.- Bug 3745 - Reject PASV command if no IPv4 address available.- Bug 3701 - Modify ScoreboardFile directive to support disabling scoreboarding.- Bug 3742 - Improper handling of self-signed certificate in client-sent cert list when "TLSVerifyClient on" is used.- Bug 3749 - Compile of src/netacl.c fails on Tru64 UNIX (OSF/1) due to conflict with system header.- Bug 3743 - Random stalls/segfaults seen when transferring large files via SFTP.- Bug 3752 - proftpd process exit status is zero for "Failed binding to address, port N: Address already in use" startup failure.- Bug 3751 - mod\_ban does not close/reopen the BanLog/BanTable file descriptors on restart, causing a file descriptor leak.- Bug 3707 - Add request/transfer ID to the logging of the initial and closing commands for SFTP file transfers. This can now be accomplished using a LogFormat variable of '%{note:sftp.file-handle}'.- Bug 3757 - Support SFTPOption for ignoring requests to modify file ownership.- Bug 3756 - mod\_ctrls no longer listens on ControlsSocket after restart.- Bug 3731 - Support active data transfers while RootRevoke is in effect.- Bug 3737 - Allow UTF8 when UseEncoding is used.- Bug 3573 - Support Elliptic Curve Cryptography (ECC) in SSH.- Bug 3758 - ProFTPD crashes when handling mod\_gss authentication due to null pointer.- Ability to load SSH host keys from an SSH agent, in addition to files on disk. See doc/contrib/mod\_sftp.html#SFTPHostKey for more information.- Bug 3761 - SSH2 key exchange fails if client sends certain SSH message before NEWKEYS.- Bug 3763 - Ensure that mod\_sftp operates properly when OpenSSL FIPS mode is enabled.- Bug 3764 - mod\_sftp does not correctly handle a 'guess' KEX message when the client guesses correctly.- Bug 3765 - mod\_sftp should honor the GroupOwner directive for MKDIR requests.- Bug 3626 - Display variable %f off by a factor of 1024 on 64-bit platforms.- Bug 3673 - Support date/timestamp variables in mod\_rewrite.- Bug 3754 - ProFTPD refuses to delete/rename a symlink pointing outside a writable directory.- Bug 3766 - Support a QuotaDefault directive, for configuring default limits.- Bug 3767 - mod\_rewrite segfault when handling SITE CHGRP without a parameter.- Bug 3768 - ExecTimeout 0 (zero) not treated as infinite.- Added new mod\_geoip contrib module.- Bug 3769 - Ensure that encoded strings are NUL-terminated.- Bug 3732 - AIX build error: undefined symbol: .alloca.- Bug 3782 - SQLShowInfo does not work properly for error responses.- Bug 3780 - AIX gives "error setting listen fd IP\_TOS: Invalid argument".- Bug 3736 - Trying to re-authenticate an existing FTP connection causes invalid 503 response.- Bug 3785 - Support resolution of tilde (~) within a chrooted session.- Bug 3787 - Read-only SFTP OPEN request permissions not properly ignored.- Bug 3740 - Overwrite permission denied when reloading multiple times and multiple <VirtualHost> sections in proftpd.conf.- Bug 3791 - Invalid handling of SCP control messages fragmented over multiple SSH packets.- Bug 3794 - Cygwin build failure in lib/tpl.c due to wrong include of mman.h.- Bug 3795 - ProFTPD needs to use -pthread linker option if linking against OpenSSL with thread support.- Bug 3790 - Logfile timestamps change to GMT after MFMT command.- Bug 3798 - Downloading nonexistent file via SCP results in timeout rather than error.- Bug 3800 - Multiple \*Options directives should be handled properly.- Bug 3801 - mod\_tls should have directive like Apache mod\_ssl's SSLHonorCipherOrder. The mod\_tls module now supports a TLSServerCipherPreference directive.- Bug 3804 - ioctl(RPROTDIS) code no longer needed on Solaris 11.- Bug 3808 - Segfault in mod\_tls when mod\_tls\_shmcache used.- Bug 3809 - Segfaults in mod\_radius when configured with RadiusGroupInfo.- Bug 3811 - ExtendedLog entries not written if MaxClients limit reached.- Bug 3814 - Support "configtest" command for contrib init.d script.- Bug 3816 - Installation of ftpasswd does not honor DESTDIR environment variable.- Bug 3813 - Ability to use CreateHome to create parent directories as non-root user, for better interoperability with NFS.- Bug 3806 - Support reverse DNS resolution for IPv6 addresses when gethostbyname2(3) is not available.- Bug 3820 - Support device/interface names in <VirtualHost>, MasqueradeAddress, and DefaultAddress.- Bug 3822 - Resolving %U/%u LogFormat variables inconsistent between mod\_log/mod\_sql in certain cases.- Bug 3824 - Use RFC compliant address/port for data transfer if FTP client has not sent PORT/PASV/EPRT/EPSV commands.- Bug 3825 - Handle RFC 1918 IP addresses in PORT/EPRT commands.- Bug 3827 - Use non-filesystem based SFTP handle generator instead of mktemp(3).- Bug 3828 - Certain sequences of FTP data transfer commands lead to NULL pointer dereferences in mod\_deflate.- Bug 3830 - MFF/MFMT command segfaults due to insufficient parameter checks.- Bug 3829 - RNFR without following RNTO can lead to NULL pointer dereference.- Bug 3832 - Support disabling of system logging on per-connection basis.- Bug 3792 - Recursive SCP uploads using preserve-time (-p) option may not work.- Bug 3831 - Sporadic "451 Insufficient memory or file locked" failure when downloading.- Bug 3833 - Enable TCP keepalive by default, with configurable SocketOption.- Bug 3837 - mod\_tls unable to read certificate files after SIGHUP.- Bug 3842 - Incorrect handling of REALPATH requests for symlink paths in mod\_sftp.- Bug 3843 - ProFTPD should not fail when starting up due to loading same module multiple times.- Bug 3845 - mod\_sftp does not provide response codes for %s LogFormat variable for AUTH ExtendedLog.- Bug 3846 - Avoid scanning ScoreboardFile needlessly on login if limits are not configured.- Bug 3850 - ftpasswd should support generating SHA-256, SHA-512 hashes where possible.- Bug 3851 - SFTPPassPhraseProvider fails due to incorrect pointer.- Bug 3852 - Support directive for ignoring symlink DefaultRoot directories. See the new AllowChrootSymlinks directive.- Bug 3839 - Enhance mod\_cap to support dropping root privs entirely.- Bug 3841 - Possible symlink race when applying UserOwner to newly created directory.- Bug 3855 - Restarting proftpd may cause Include files not to be parsed.
1.3.4 - Released 09-Nov-2011--------------------------------- Bug 3702 - ProFTPD with mod\_sql\_mysql dies of "Alarm clock" on FreeBSD.- Bug 3669 - mod\_sql\_mysql.so: undefined symbol: make\_scrambled\_password with MySQL 5.5 on Fedora.- Bug 3192 - PQescapeStringConn() needs a better check.- Bug 3704 - Enable OpenSSL countermeasure against SSLv3/TLSv1 BEAST attacks. To disable this countermeasure, which may cause interoperability issues with some clients, use the NoEmptyFragments TLSOption.- Bug 3706 - Support SFTPOption for ignoring requests to modify timestamps.- Bug 3640 - rpmbuild on CentOS5.5 (64bit): "File not found by glob". - Bug 3711 - Response pool use-after-free memory corruption error.
1.3.4rc3 - Released 26-Sep-2011--------------------------------- Bug 3637 - Enforce pcre and libmemcached version requirements.- Bug 3639 - Avoid spinning proftpd process if read(2) returns EAGAIN.- Bug 3641 - SITE CPFR/CPTO does not update quota tally.- Bug 3642 - Segfault seen in mod\_sql\_mysql if "SQLAuthenticate groupsetfast" used.- Bug 3645 - Ensure that SQLNamedConnectInfos with PERSESSION connection policies are opened before chroot.- Bug 3644 - Disable signal handling for exiting session processes.- Bug 3649 - MaxStoreFileSize can be bypassed using REST/APPE.- Bug 3652 - TCPAccessSyslogLevel directive broken by Bug#3317.- Bug 3653 - Segfault with "DefaultServer off" and no matching server for incoming IP address.- Bug 3656 - Prefer "File too big" error message for MaxStoreFilesize.- Bug 3658 - TLSVerifyOrder directive is broken.- Bug 3555 - Support optional maximum number of clients to be disconnected via 'ftpdctl kick'.- Bug 3660 - SITE MKDIR/RMDIR should update quota tallies properly.- Bug 3663 - TimeoutLogin cannot interrupt mod\_delay as it should.- Bug 3664 - mod\_sftp does not update process title.- Bug 3667 - Scoreboard scrubbing can block daemon process for long periods of time.- mod\_ldap configuration directives have been overhauled, hopefully yielding a more straightforward, easier way to configure mod\_ldap. See the Changes section of README.LDAP for details.- Bug 3665 - GID of new files are inherited from parent directory on FreeBSD. To provide the more expected behavior, where the GID of new files is that of the logged-in user, on FreeBSD machines, the GroupOwner directive can now handles a parameter value of "~" as "use GID of logged-in user".- Bug 3668 - File descriptor leak during scoreboard scrubbing. This leak was inadvertently introduced by the fix for Bug#3667.- Bug 3670 - WrapDenyMsg not displayed when using mod\_wrap2 + mod\_sftp.- Bug 3671 - TLSOption AllowClientRenegotiations to be unconditionally required[View remainder of file in raw view](https://github.com/proftpd/proftpd/raw/refs/heads/1.3.8/NEWS)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_69d520d3_20250115_093121.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=proftpd%2Fproftpd)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[proftpd](/proftpd)
/
**[proftpd](/proftpd/proftpd)**
Public

* [Notifications](/login?return_to=%2Fproftpd%2Fproftpd) You must be signed in to change notification settings
* [Fork
  207](/login?return_to=%2Fproftpd%2Fproftpd)
* [Star
   543](/login?return_to=%2Fproftpd%2Fproftpd)

* [Code](/proftpd/proftpd)
* [Issues
  100](/proftpd/proftpd/issues)
* [Pull requests
  54](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects
  0](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

Additional navigation options

* [Code](/proftpd/proftpd)
* [Issues](/proftpd/proftpd/issues)
* [Pull requests](/proftpd/proftpd/pulls)
* [Actions](/proftpd/proftpd/actions)
* [Projects](/proftpd/proftpd/projects)
* [Security](/proftpd/proftpd/security)
* [Insights](/proftpd/proftpd/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fproftpd%2Fproftpd%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fproftpd%2Fproftpd%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Out-of-bounds buffer read when handling FTP commands #1683

Closed

[Marti2203](/Marti2203) opened this issue
Jun 6, 2023
¬∑ 16 comments

Closed

# [Out-of-bounds buffer read when handling FTP commands](#top) #1683

[Marti2203](/Marti2203) opened this issue
Jun 6, 2023
¬∑ 16 comments

Assignees
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&v=4)](/Castaglia)

Labels
[backport](/proftpd/proftpd/labels/backport)
[bug](/proftpd/proftpd/labels/bug)

Milestone
[1.3.9](/proftpd/proftpd/milestone/5 "1.3.9")

## Comments

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

### **[Marti2203](/Marti2203)** commented [Jun 6, 2023](#issue-1743120578)

| What I Did Cloned latest version of ProFTPD ([5e57d41](https://github.com/proftpd/proftpd/commit/5e57d419328ca48c1fb0e8d47c88a5324aec0cd3)) in a container running Ubuntu 20.04, configured with flags for ASAN and UBSan. Started the tool as such `./proftpd -n -c <SOMEDIR>/basic.conf -X`. Sent over a sequence of packets, gathered from a fuzz campaign using the `aflnet-replay` utility. What I Expected/Wanted Expected to have ProFTPD not crash. ProFTPD Version and Configuration ``` Compile-time Settings:   Version: 1.3.9rc1 (git)   Platform: LINUX [Linux 5.4.0-120-generic x86_64]   OS/Release:     NAME="Ubuntu"     VERSION="20.04.6 LTS (Focal Fossa)"     ID=ubuntu     ID_LIKE=debian     PRETTY_NAME="Ubuntu 20.04.6 LTS"     VERSION_ID="20.04"     VERSION_CODENAME=focal     UBUNTU_CODENAME=focal   Built: Tue Jun 6 2023 05:18:02 UTC   Built With:     configure  '--enable-devel=nodaemon:nofork' 'CC=cc' 'CFLAGS=-fsanitize=address,undefined -g' 'LDFLAGS=-fsanitize=address,undefined'    CFLAGS: -g2 -fsanitize=address,undefined -g -Wall -fno-omit-frame-pointer -fno-strict-aliasing -Wdangling-else -Wextra -Werror=implicit-function-declaration -Winit-self -Wno-missing-field-initializers -Wno-unused-parameter -Wnull-derefere nce -fdelete-null-pointer-checks -DPR_DEVEL_NO_FORK -DPR_DEVEL_NO_DAEMON -g3 -O0 -Wcast-align -Wchar-subscripts -Winline -Wstrict-prototypes -Wmissing-declarations -Wnested-externs -Wpointer-arith -Wshadow -Wundef -Wcomment -Wdangling-else -Wdeclaration-after-statement -Wduplicated-branches -Wfloat-equal -Wformat -Wformat-security -Wimplicit-function-declaration -Wmaybe-uninitialized -Wmissing-braces -Wparentheses -Wpointer-to-int-cast -Wreturn-local-addr -Wstack-protector -W strict-overflow -Wswitch -Wunreachable-code -Wunused-variable -fstack-protector -fstack-protector-all -fno-common   LDFLAGS: -Wl,-L$(top_srcdir)/lib,-L$(top_builddir)/lib -fsanitize=address,undefined -rdynamic   LIBS:  -lcap -lidn2 -lcrypt    Files:     Configuration File:       /usr/local/etc/proftpd.conf     Pid File:       /usr/local/var/proftpd.pid     Scoreboard File:       /usr/local/var/proftpd.scoreboard    Info:     + Max supported UID: 4294967295     + Max supported GID: 4294967295   Features:     - Autoshadow support     - Controls support     + curses support     + Developer support     - DSO support     + IPv6 support     + Largefile support     - Lastlog support     - Memcache support     + ncurses support     - NLS support     - OpenSSL support     - PCRE support     - PCRE2 support     - POSIX ACL support     - Redis support     + Sendfile support     + Shadow file support     - Sodium support     + Trace support     + xattr support    Tunable Options:     PR_TUNABLE_BUFFER_SIZE = 1024     PR_TUNABLE_DEFAULT_RCVBUFSZ = 8192     PR_TUNABLE_DEFAULT_SNDBUFSZ = 8192     PR_TUNABLE_ENV_MAX = 2048     PR_TUNABLE_GLOBBING_MAX_MATCHES = 100000     PR_TUNABLE_GLOBBING_MAX_RECURSION = 8     PR_TUNABLE_HASH_TABLE_SIZE = 40     PR_TUNABLE_LOGIN_MAX = 256     PR_TUNABLE_NEW_POOL_SIZE = 512     PR_TUNABLE_PATH_MAX = 4096     PR_TUNABLE_SCOREBOARD_BUFFER_SIZE = 80     PR_TUNABLE_SCOREBOARD_SCRUB_TIMER = 30     PR_TUNABLE_SELECT_TIMEOUT = 30     PR_TUNABLE_TIMEOUTIDENT = 10     PR_TUNABLE_TIMEOUTIDLE = 600     PR_TUNABLE_TIMEOUTLINGER = 10     PR_TUNABLE_TIMEOUTLOGIN = 300     PR_TUNABLE_TIMEOUTNOXFER = 300     PR_TUNABLE_TIMEOUTSTALLED = 3600     PR_TUNABLE_XFER_SCOREBOARD_UPDATES = 10  ```  In addition, we need to see **all** of the ProFTPD configuration files you are using (**minus** any sensitive information like passwords, of course). Armed with the version and configuration data, then, we can set up ProFTPD locally using the same configuration, and see what happens. Config and input are provided in the archive below [data.tar.gz](https://github.com/proftpd/proftpd/files/11660286/data.tar.gz) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 6, 2023](#issuecomment-1577946991)

| Output of ASAN  ``` ==2288394==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x62100001a320 at pc 0x562e102ac29d bp 0x7ffc9a7ba260 sp 0x7ffc9a7ba250 READ of size 1 at 0x62100001a320 thread T0     #0 0x562e102ac29c in make_ftp_cmd /home/ubuntu/experiments/proftpd-clean/src/main.c:862     #1 0x562e102a9a11 in pr_cmd_read /home/ubuntu/experiments/proftpd-clean/src/main.c:571     #2 0x562e102acc88 in cmd_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:910     #3 0x562e102b028a in fork_server /home/ubuntu/experiments/proftpd-clean/src/main.c:1519     #4 0x562e102b1834 in daemon_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:1764     #5 0x562e102b2106 in standalone_main /home/ubuntu/experiments/proftpd-clean/src/main.c:1965     #6 0x562e102b4928 in main /home/ubuntu/experiments/proftpd-clean/src/main.c:2790     #7 0x7fe618414082 in __libc_start_main ../csu/libc-start.c:308     #8 0x562e102a537d in _start (/home/ubuntu/experiments/proftpd-clean/proftpd+0x46437d)  0x62100001a320 is located 0 bytes to the right of 4640-byte region [0x621000019100,0x62100001a320) allocated by thread T0 here:     #0 0x7fe6190c1808 in __interceptor_malloc ../../../../src/libsanitizer/asan/asan_malloc_linux.cc:144     #1 0x562e102ba510 in smalloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:114     #2 0x562e102ba56a in malloc_block /home/ubuntu/experiments/proftpd-clean/src/pool.c:127     #3 0x562e102baf70 in new_block /home/ubuntu/experiments/proftpd-clean/src/pool.c:219     #4 0x562e102bf451 in alloc_pool /home/ubuntu/experiments/proftpd-clean/src/pool.c:672     #5 0x562e102bf734 in palloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:684     #6 0x562e102bf846 in pcalloc /home/ubuntu/experiments/proftpd-clean/src/pool.c:699     #7 0x562e102a9144 in pr_cmd_read /home/ubuntu/experiments/proftpd-clean/src/main.c:494     #8 0x562e102acc88 in cmd_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:910     #9 0x562e102b028a in fork_server /home/ubuntu/experiments/proftpd-clean/src/main.c:1519     #10 0x562e102b1834 in daemon_loop /home/ubuntu/experiments/proftpd-clean/src/main.c:1764     #11 0x562e102b2106 in standalone_main /home/ubuntu/experiments/proftpd-clean/src/main.c:1965     #12 0x562e102b4928 in main /home/ubuntu/experiments/proftpd-clean/src/main.c:2790     #13 0x7fe618414082 in __libc_start_main ../csu/libc-start.c:308  SUMMARY: AddressSanitizer: heap-buffer-overflow /home/ubuntu/experiments/proftpd-clean/src/main.c:862 in make_ftp_cmd Shadow bytes around the buggy address:   0x0c427fffb410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb420: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb430: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c427fffb450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 =>0x0c427fffb460: 00 00 00 00[fa]fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb470: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb480: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb490: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb4a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c427fffb4b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07   Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2288394==ABORTING Aborted  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
self-assigned this
[Jun 10, 2023](#event-9491154487)

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 10, 2023](#issuecomment-1585718241) ‚Ä¢ edited Loading

| [@Marti2203](https://github.com/Marti2203) Thanks for the report. I'm attempting to reproduce this behavior locally now. How are you feeding the provided `input` file to the daemon? I've tried using *e.g.* `telnet 127.0.0.1 21 < /path/to/input`, but haven't yet reproduced the ASAN crash, and I think I might be missing some tool or step.  I just installed [aflnet](https://github.com/aflnet/aflnet), and attempting to use its `aflnet-replay` now:  ``` $ aflnet-replay /path/to/input FTP 21  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 10, 2023](#issuecomment-1585826125)

| Out of curiosity, which ASAN options to you have set in your environment? For example, in my current local setup to try to reproduce this, I am using:  ``` ASAN_OPTIONS=verbosity=3,detect_leaks=0,abort_on_error=1,debug=true,check_initialization_order=true,detect_stack_use_after_return=true,strict_string_checks=true,detect_invalid_pointer_pairs=2  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 11, 2023](#issuecomment-1585973488) ‚Ä¢ edited Loading

| Hi [@Castaglia](https://github.com/Castaglia), I used these options to reproduce it `ASAN_OPTIONS="abort_on_error=1:symbolize=1:detect_leaks=1:detect_stack_use_after_return=1:detect_container_overflow=1:poison_array_cookie=1:malloc_fill_byte=0:max_malloc_fill_size=16777216"`  Were you able to reproduce it earlier? |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592268980)

| Unfortunately no, I've not been able to reproduce the ASAN report yet. I suspect I know the cause -- but it would greatly help to have a working reproduction recipe, to verify a fix. Would you be able to provide a Dockerfile (and instructions), that I might run the same locally? Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592269871)

| I can send a docker container image with the instance running and all. Will need 1-2 hours and get back to you :) |
| --- |

 üëç
1
 Castaglia reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592276663) ‚Ä¢ edited Loading

| [Link to the docker image](https://drive.google.com/file/d/1RuS1TQdqfA5JtnjCSXs7fzYH4vVc2JFa/view?usp=sharing)  Steps for reproduction:   * Docker load the tar.gz (`docker load < file.tar.gz` ) * Create an instance of the container * In one terminal in the directory `/home/ubuntu/experiments/proftpd` , run `./proftpd -n -c /home/ubuntu/replayable-crashes-proftpd/basic.conf -X` * In another terminal in the directory `/home/ubuntu/replayable-crashes-proftpd` run `aflnet-replay input FTP 21 1` * ProFTPD should crash in the first terminal |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592284415)

| Thanks! I might not have free time to spend on this until this weekend, but I will take a look at the provided Dockerfile; many thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592285047)

| No problem :) |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592287058)

| Happen to have the actual `Dockerfile` as well, so that I can build the image locally? |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592288210)

| Yes, just a moment |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Jun 15, 2023](#issuecomment-1592293620) ‚Ä¢ edited Loading

| If it helps, here's what I've been building up locally:  ``` FROM ubuntu:20.04  ARG USER=docker ARG PASSWORD=docker  ENV DEBIAN_FRONTEND=noninteractive ENV TZ=UTC  RUN apt-get update && \   apt-get install -y \     clang \     ftp \     git \     graphviz-dev \     libcap-dev \     make \     netcat \     telnet \     vim  # Create the account, and files, used for testing RUN mkdir -p /var/log/proftpd RUN useradd -s /bin/bash -m -d "/home/$USER" "$USER" && \   yes "$PASSWORD" | passwd "$USER"  # Install AFLnet RUN git clone --depth 10 https://github.com/aflnet/aflnet.git /src/aflnet RUN cd /src/aflnet && \   make clean all && \   cd llvm_mode/ && \   LLVM_CONFIG=/usr/bin/llvm-config-10 make  ENV AFLNET=/src/aflnet ENV AFL_PATH=/src/aflnet  COPY commands.txt /src/commands.txt  ENV ASAN_OPTIONS=abort_on_error=1:symbolize=1:detect_leaks=1:detect_stack_use_after_return=1:detect_container_overflow=1:poison_array_cookie=1:malloc_fill_byte=0:max_malloc_fill_size=16777216  # Run these locally with an outdated Mac OSX Docker Desktop installation # $ docker run --security-opt seccomp=unconfined --privileged --rm=true -it -v $(PWD):/src/proftpd heap-overflow-issue1683 bash # cd /src/proftpd  # CC=clang CFLAGS=-fsanitize=address,undefined LDFLAGS=-fsanitize=address,undefined ./configure --enable-devel=nodaemon:nofork # make # make install # /usr/local/sbin/proftpd -X -nd10  CMD ["bash"]  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=80&u=2cd6036fd80dac13aec6cc9e6361996a035da5e1&v=4)](/Marti2203)

Copy link

Author

### **[Marti2203](/Marti2203)** commented [Jun 15, 2023](#issuecomment-1592392054)

| [proftpd-repro.tar.gz](https://github.com/proftpd/proftpd/files/11753209/proftpd-repro.tar.gz)  Command for executing proftpd - `./proftpd -n -c ${WORKDIR}/basic.conf -X` Command for executing the aflnet-replay `aflnet-replay input FTP 21 1` |
| --- |

 ‚ù§Ô∏è
1
 Castaglia reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Aug 6, 2023](#issuecomment-1666917041)

| Many apologies for the delay; I've been dealing with other things.  Using the provided tarball (with some minor tweaks for my local Mac-based environment), I'm now able to reproduce the report from `aflnet`. Thanks! Now to see about fixing this issue properly. |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
added
[bug](/proftpd/proftpd/labels/bug)
[backport](/proftpd/proftpd/labels/backport)
labels
[Aug 6, 2023](#event-10017615296)

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
added this to the [1.3.9](/proftpd/proftpd/milestone/5) milestone
[Aug 6, 2023](#event-10017615356)

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Aug 6, 2023](#ref-commit-f8c1561)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[f8c1561](/proftpd/proftpd/commit/f8c156147e0c16b0eb119a90ad49ad0006dfc724)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Aug 6, 2023](#issuecomment-1666960691)

| [@Marti2203](https://github.com/Marti2203) [#1696](https://github.com/proftpd/proftpd/pull/1696) looks to address this issue using your reproduction recipe, without causing any other regressions that I've seen so far. Care to try it out yourself, see if there any other related issues lingering? Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
changed the title
~~Heap Buffer Overflow bug in ProFTPD~~
Out-of-bounds buffer read when handling FTP commands
[Aug 12, 2023](#event-10077440065)

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-1376d8c)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[1376d8c](/proftpd/proftpd/commit/1376d8ccc0966d1ce9a1c76b32c6a9ca61bbe67f)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-97bbe68)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Issue](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[: Avoid an edge case when handling unexpectedly formatted ‚Ä¶](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592 "Issue #1683: Avoid an edge case when handling unexpectedly formatted input text from client, caused by quote/backslash semantics, by skipping those semantics.")`
‚Ä¶

`[97bbe68](/proftpd/proftpd/commit/97bbe68363ccf2de0c07f67170ec64a8b4d62592)`

```
‚Ä¶input text from client, caused by quote/backslash semantics, by skipping those semantics.
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-fd43edf)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Updating NEWS for backport of fix for Issue](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f "Updating NEWS for backport of fix for Issue #1683 to 1.3.8 branch.") [#1683](https://github.com/proftpd/proftpd/issues/1683) [to 1.3.8 branch.](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f "Updating NEWS for backport of fix for Issue #1683 to 1.3.8 branch.")`

`[fd43edf](/proftpd/proftpd/commit/fd43edfbeeee8ccec51a731ba5b9348098f4132f)`

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-35bfba4)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Merge pull request](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4 "Merge pull request #1696 from proftpd/ftp-text-quote-mode-issue1683

Issue #1683: Avoid an edge case when handling unexpectedly formatted ‚Ä¶") [#1696](https://github.com/proftpd/proftpd/pull/1696) [from proftpd/ftp-text-quote-mode-issue1683](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4 "Merge pull request #1696 from proftpd/ftp-text-quote-mode-issue1683

Issue #1683: Avoid an edge case when handling unexpectedly formatted ‚Ä¶")`
‚Ä¶

`[35bfba4](/proftpd/proftpd/commit/35bfba4b7e26479d29d200c3369f0a08500e78b4)`

```
Issue [#1683](https://github.com/proftpd/proftpd/issues/1683): Avoid an edge case when handling unexpectedly formatted ‚Ä¶
```

[Castaglia](/Castaglia)
added a commit
that referenced
this issue
[Sep 10, 2023](#ref-commit-631c012)
[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

`[Updating NEWS for fix for Issue](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299 "Updating NEWS for fix for Issue #1683.") [#1683](https://github.com/proftpd/proftpd/issues/1683)[.](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299 "Updating NEWS for fix for Issue #1683.")`

`[631c012](/proftpd/proftpd/commit/631c012b18eb16f4bad82b02d60ddc69ef312299)`

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=80&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)

Copy link

Member

### **[Castaglia](/Castaglia)** commented [Sep 10, 2023](#issuecomment-1712887554)

| I've merged the PR to master, and backported the fix to the 1.3.8 branch. Thanks! |
| --- |

All reactions

Sorry, something went wrong.

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&u=efbec647a59de5fb55e146e64d7176e345f06f72&v=4)](/Castaglia)
[Castaglia](/Castaglia)
closed this as [completed](/proftpd/proftpd/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Sep 10, 2023](#event-10326929776)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fproftpd%2Fproftpd%2Fissues%2F1683)

Assignees

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=40&v=4)](/Castaglia) [Castaglia](/Castaglia)

Labels

[backport](/proftpd/proftpd/labels/backport)
[bug](/proftpd/proftpd/labels/bug)

Projects

None yet

Milestone

 [**1.3.9**](/proftpd/proftpd/milestone/5 "1.3.9")

Development

No branches or pull requests

2 participants

[![@Castaglia](https://avatars.githubusercontent.com/u/821749?s=52&v=4)](/Castaglia) [![@Marti2203](https://avatars.githubusercontent.com/u/7456946?s=52&v=4)](/Marti2203)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


