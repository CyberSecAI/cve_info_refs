=== Content from gerrit.wikimedia.org_fbdfefe9_20250114_210515.html ===




=== Content from phabricator.wikimedia.org_9a100701_20250114_210517.html ===
Page Menu[HomePhabricator](/)

* SearchConfigure Global Search

[Log In](https://phabricator.wikimedia.org/auth/start/?next=%2FT326952)[Create Task](/maniphest/task/edit/nocreate/) [Maniphest](/maniphest/)  T326952
# CVE-2023-37253: ProofreadPage leaks suppressed user via the API and config variablesClosed, Resolved[Public](/policy/explain/PHID-TASK-nquqtb6hs7egmbwzw3a4/view/)SecurityActions

* [Edit Task](/maniphest/task/edit/326952/)
* Edit Related Tasks...
* [Create Subtask](/maniphest/task/subtask/326952/)
* [Edit Parent Tasks](/search/rel/task.has-parent/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Edit Subtasks](/search/rel/task.has-subtask/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Merge Duplicates In](/search/rel/task.merge-in/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Close As Duplicate](/search/rel/task.close-as-duplicate/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* Edit Related Objects...
* [Edit Commits](/search/rel/task.has-commit/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Edit Mocks](/search/rel/task.has-mock/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* Subscribe
* [Mute Notifications](/subscriptions/mute/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Protect as security issue](/wmf/escalate-task/326952/)
* [Award Token](/token/give/PHID-TASK-nquqtb6hs7egmbwzw3a4/)
* [Flag For Later](/flag/edit/PHID-TASK-nquqtb6hs7egmbwzw3a4/)

Assigned To

|  | [Mstyles](/p/Mstyles/) |
| --- | --- |

Authored By

|  | [Soda](/p/Soda/) |
| --- | --- |
| Jan 13 2023, 12:45 PM2023-01-13 12:45:58 (UTC+0) |

Tags

* [Security-Team](/tag/security-team/) [(Our Part Is Done)](/project/board/1179/)
* [Security](/tag/security/)
* [ProofreadPage](/tag/proofreadpage/) [(Backlog)](/project/board/276/)
* [Vuln-Infoleak](/tag/vuln-infoleak/)
* [Patch-For-Review](/tag/patch-for-review/)
Referenced Files

|  | [F36196874: 0001-Prevent-hidden-users-from-being-exposed-via-public-i.patch](/F36196874) |
| --- | --- |
| Jan 13 2023, 6:11 PM2023-01-13 18:11:55 (UTC+0) |

Subscribers

|  | [Aklapper](/p/Aklapper/) |
| --- | --- |

|  | [gerritbot](/p/gerritbot/) |
| --- | --- |

|  | [mmartorana](/p/mmartorana/) |
| --- | --- |

|  | [Mstyles](/p/Mstyles/) |
| --- | --- |

|  | [Samwilson](/p/Samwilson/) |
| --- | --- |

|  | [sbassett](/p/sbassett/) |
| --- | --- |

|  | [Soda](/p/Soda/) |
| --- | --- |

|  | [Tpt](/p/Tpt/) |
| --- | --- |

# Description

[ProofreadPage](/tag/proofreadpage/) does not suppress the name of the reviewer of a Page: namespace page, when accessed via the API (and via the config variables):

### Proof of concept

* Setup [ProofreadPage](/tag/proofreadpage/) locally
* Create a new Page: namespace page
* Create a new account and edit the Page: namespace page by setting the Page quality level
* Create an edit on the edited page that does not reset the Page quality level
* Block the account with Hide username from edits and lists box checked via an admin account
* As a non-logged-in user, navigate to the Page: namespace page and mw.config.get( 'prpPageQualityUser' )
* Note that the suppressed users username is visible
* Use the API to return the most current revision of the page, the hidden users name will be visible as part of the returned wikitext.

Realized this while looking at [T326940](/T326940) :(

# Details

Risk Rating Medium Author Affiliation Wikimedia Communities

|  | Subject | Repo | Branch | Lines +/- |
| --- | --- | --- | --- | --- |
|  | [SECURITY: Prevent hidden users from being exposed via public interfaces](https://gerrit.wikimedia.org/r/c/934410) | [mediawiki/extensions/ProofreadPage](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage) | [master](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage/%2B/master) | +46 -5 |
|  | [SECURITY: Prevent hidden users from being exposed via public interfaces](https://gerrit.wikimedia.org/r/c/934356) | [mediawiki/extensions/ProofreadPage](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage) | [REL1\_38](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage/%2B/REL1_38) | +46 -5 |
|  | [SECURITY: Prevent hidden users from being exposed via public interfaces](https://gerrit.wikimedia.org/r/c/934354) | [mediawiki/extensions/ProofreadPage](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage) | [REL1\_40](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage/%2B/REL1_40) | +46 -5 |
|  | [SECURITY: Prevent hidden users from being exposed via public interfaces](https://gerrit.wikimedia.org/r/c/934355) | [mediawiki/extensions/ProofreadPage](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage) | [REL1\_39](https://gerrit.wikimedia.org/r/plugins/gitiles/mediawiki/extensions/ProofreadPage/%2B/REL1_39) | +46 -5 |

[Customize query in gerrit](https://gerrit.wikimedia.org/r/#/q/bug:T326952)
# Related Objects

* Mentions

Mentioned In [T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626) Mentioned Here [T326940: Prepare ProofreadPage extension for IP Masking](/T326940)
### Event Timeline

[Soda](/p/Soda/) created this task.[Jan 13 2023, 12:45 PM2023-01-13 12:45:58 (UTC+0)](#8523559)Restricted Application added a subscriber: [Aklapper](/p/Aklapper/).  · [View Herald Transcript](/herald/transcript/5128728/)[Jan 13 2023, 12:45 PM2023-01-13 12:45:59 (UTC+0)](#8523572)[Soda](/p/Soda/) added a project: [ProofreadPage](/tag/proofreadpage/).[Jan 13 2023, 12:48 PM2023-01-13 12:48:46 (UTC+0)](#8523576)[Soda](/p/Soda/) renamed this task from ProofreadPage leaks suppressed user via the API to ProofreadPage leaks suppressed user via the API and config variables.[Jan 13 2023, 1:03 PM2023-01-13 13:03:13 (UTC+0)](#8523588)[Zabe](/p/Zabe/) added a subscriber: [Tpt](/p/Tpt/).[Jan 13 2023, 1:36 PM2023-01-13 13:36:49 (UTC+0)](#8523669)

[Soda](/p/Soda/) added a comment.[Jan 13 2023, 6:11 PM2023-01-13 18:11:55 (UTC+0)](#8524394)Comment Actions

0001-Prevent-hidden-users-from-being-exposed-via-public-i.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/gplxze5rlefbgovzzgho/PHID-FILE-6v2k3iff2xdn2gvh4wjl/0001-Prevent-hidden-users-from-being-exposed-via-public-i.patch)

Proposed patch

[Legoktm](/p/Legoktm/) added a project: [Vuln-Infoleak](/tag/vuln-infoleak/).[Jan 13 2023, 6:24 PM2023-01-13 18:24:40 (UTC+0)](#8524423)[mmartorana](/p/mmartorana/) changed the task status from Open to In Progress.[Jan 23 2023, 3:28 PM2023-01-23 15:28:30 (UTC+0)](#8549396)[mmartorana](/p/mmartorana/) triaged this task as Medium priority.[mmartorana](/p/mmartorana/) changed Risk Rating from N/A to Medium.

[Soda](/p/Soda/) added a comment.[Jan 23 2023, 3:53 PM2023-01-23 15:53:29 (UTC+0)](#8549538)Comment Actions

[@Tpt](/p/Tpt/) Can you take a look at the patch above :)

[Tpt](/p/Tpt/) added a comment.Edited · [Jan 23 2023, 4:35 PM2023-01-23 16:35:51 (UTC+0)](#8549816)Comment Actions

[@Soda](/p/Soda/) Thank you for reaching out with this problem and moving forward with it.

I am not sure to understand the task background. Displaying publicly the editors name/IPs seems to have been the policy from the beginning of Wikipedia. Do you have a good link?

If Wikimedia want to go the route 'if hidden the user name should be totaly hidden from everywhere and not recoverable', I got a few concerns:

1. This is not removing the user id from the revision content but just from some API outputs and the UI. For examples, dumps won't be changed. Changing that would require more mork.
2. We need to also cover the diff output (Page\PageSlotDiffRenderer).
3. A maybe easier way to make sure the user name is removed from anywhere but past revisions is to just give null as the user when building the PageLevel object (in PageContentHandler and EditPagePage) if the user is hidden.

Also, I am not sure this is a security issue. It seem seems more like a subtask of [T326940](/T326940).

[sbassett](/p/sbassett/) subscribed.[Jan 23 2023, 10:32 PM2023-01-23 22:32:11 (UTC+0)](#8551538)Comment Actions

[@Tpt](/p/Tpt/) - it looks like [@Soda](/p/Soda/)'s proposed patch is not displaying suppressed usernames (via if ( $user->isHidden() ) checks). This should be correct as suppressed usernames *should never* be displayed to users on Wikimedia projects unless they are oversighters or otherwise have hideuser rights. Changing existing public dumps is difficult if not impossible, but the good news is that they should be overwritten in days or weeks. If there are more places where we should be checking for suppressed usernames within ext:ProofreadPage, then the patch should be amended to include those. This isn't really a subtask of [T326940](/T326940) as this, again, is only concerning suppressed usernames, which should never include anon IP-based usernames.

[Soda](/p/Soda/) added a comment.[Jan 24 2023, 1:26 PM2023-01-24 13:26:19 (UTC+0)](#8553336)Comment Actions
> In [T326952#8549816](/T326952#8549816), [@Tpt](/p/Tpt/) wrote:
>
> [@Soda](/p/Soda/) Thank you for reaching out with this problem and moving forward with it.
>
> I am not sure to understand the task background. Displaying publicly the editors name/IPs seems to have been the policy from the beginning of Wikipedia. Do you have a good link?
>
> If Wikimedia want to go the route 'if hidden the user name should be totaly hidden from everywhere and not recoverable', I got a few concerns:
>
> 1. This is not removing the user id from the revision content but just from some API outputs and the UI. For examples, dumps won't be changed. Changing that would require more mork.
> 2. We need to also cover the diff output (Page\PageSlotDiffRenderer).
> 3. A maybe easier way to make sure the user name is removed from anywhere but past revisions is to just give null as the user when building the PageLevel object (in PageContentHandler and EditPagePage) if the user is hidden.
>
> Also, I am not sure this is a security issue. It seem seems more like a subtask of [T326940](/T326940).

This is specifically about overighted/suppressed usernames that shouldn't be shown to anyone except oversighters/anyone with the hideuser permission (the on-wiki policy document would be <https://meta.wikimedia.org/wiki/Oversight_policy>).

Wrt to the patch itself, I assumed that if a Oversighter wanted to check if the name of the person who set the PageLevel, they could use a combinations of the Edit tags and unhide revisions functionality to view the username of the person who had set the Page status.

> 2. We need to also cover the diff output (Page\PageSlotDiffRenderer).

I don't think we reveal the user via that method, we only show the changed PageLevel status in a diff.

> 3. A maybe easier way to make sure the user name is removed from anywhere but past revisions is to just give null as the user when building the PageLevel object (in PageContentHandler and EditPagePage) if the user is hidden.

I did try a variation of this, but it appears that whenever the next edit is made (after the reviewing editor has been supressed), we end up assigning the user that most recently edited the page as the reviewer of the Page: namespace page which I feel would be somewhat unexpected and counterintuitive for individual users (since they will not be informed on this).

[mmartorana](/p/mmartorana/) moved this task from [Incoming](/project/board/1179/) to [Security Patch To Deploy](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Mar 14 2023, 3:11 PM2023-03-14 15:11:35 (UTC+0)](#8692409)[mmartorana](/p/mmartorana/) subscribed.Comment Actions

Hello - we plan to deploy this patch in the upcoming deployment window.

[sbassett](/p/sbassett/) added a comment.[Mar 14 2023, 3:25 PM2023-03-14 15:25:09 (UTC+0)](#8692484)Comment Actions

As of today, the patch from [T326952#8524394](/T326952#8524394) still applies to master/main. And while it might not be a complete solution per feedback at [T326952#8549816](/T326952#8549816), it gets us to a much better place than where we're at now, and follow-up patches can be worked upon while at least part of the immediate issue is mitigated within Wikimedia production.

[Mstyles](/p/Mstyles/) subscribed.[Mar 27 2023, 10:01 PM2023-03-27 22:01:39 (UTC+0)](#8731639)Comment Actions
> In [T326952#8524394](/T326952#8524394), [@Soda](/p/Soda/) wrote:
>
> 0001-Prevent-hidden-users-from-being-exposed-via-public-i.patch2 KB[Download](https://phab.wmfusercontent.org/file/download/gplxze5rlefbgovzzgho/PHID-FILE-6v2k3iff2xdn2gvh4wjl/0001-Prevent-hidden-users-from-being-exposed-via-public-i.patch)
>
> Proposed patch

[Deployed](https://sal.toolforge.org/log/bhgUJYcB0IdT-khDoH3u)

[sbassett](/p/sbassett/) moved this task from [Security Patch To Deploy](/project/board/1179/) to [Watching](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Apr 3 2023, 4:15 PM2023-04-03 16:15:15 (UTC+0)](#8751243)

[Soda](/p/Soda/) added a subscriber: [Samwilson](/p/Samwilson/).[Apr 6 2023, 11:43 AM2023-04-06 11:43:57 (UTC+0)](#8762182)Comment Actions

Adding [@Samwilson](/p/Samwilson/) who also works on [ProofreadPage](/tag/proofreadpage/)

[sbassett](/p/sbassett/) mentioned this in [T333626: Write and send supplementary release announcement for extensions and skins with security patches (1.35.11/1.38.7/1.39.4/1.40.0)](/T333626).[May 15 2023, 8:27 PM2023-05-15 20:27:15 (UTC+0)](#8852206)[Mstyles](/p/Mstyles/) added a subscriber: [gerritbot](/p/gerritbot/).[Jun 29 2023, 8:44 PM2023-06-29 20:44:04 (UTC+0)](#8978123)[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2023, 8:49 PM2023-06-29 20:49:09 (UTC+0)](#8978134)Comment Actions

Change 934354 had a related patch set uploaded (by Mstyles; author: Sohom Datta):

[mediawiki/extensions/ProofreadPage@REL1\_40] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934354>

[gerritbot](/p/gerritbot/) added a project: [Patch-For-Review](/tag/patch-for-review/).[Jun 29 2023, 8:49 PM2023-06-29 20:49:12 (UTC+0)](#8978135)Comment Actions

Change 934355 had a related patch set uploaded (by Mstyles; author: Sohom Datta):

[mediawiki/extensions/ProofreadPage@REL1\_39] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934355>

[gerritbot](/p/gerritbot/) added a comment.[Jun 29 2023, 8:50 PM2023-06-29 20:50:01 (UTC+0)](#8978138)Comment Actions

Change 934356 had a related patch set uploaded (by Mstyles; author: Sohom Datta):

[mediawiki/extensions/ProofreadPage@REL1\_38] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934356>

[Mstyles](/p/Mstyles/) renamed this task from ProofreadPage leaks suppressed user via the API and config variables to CVE-2023-37253 ProofreadPage leaks suppressed user via the API and config variables.[Jun 30 2023, 5:46 PM2023-06-30 17:46:15 (UTC+0)](#8982227)[Mstyles](/p/Mstyles/) renamed this task from CVE-2023-37253 ProofreadPage leaks suppressed user via the API and config variables to CVE-2023-37253: ProofreadPage leaks suppressed user via the API and config variables.[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:31 PM2023-06-30 18:31:08 (UTC+0)](#8982523)Comment Actions

Change 934356 **abandoned** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_38] Prevent hidden users from being exposed via public interfaces

Reason:

fixed in master

<https://gerrit.wikimedia.org/r/934356>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:31 PM2023-06-30 18:31:15 (UTC+0)](#8982525)Comment Actions

Change 934355 **abandoned** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_39] Prevent hidden users from being exposed via public interfaces

Reason:

<https://gerrit.wikimedia.org/r/934355>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:31 PM2023-06-30 18:31:20 (UTC+0)](#8982526)Comment Actions

Change 934354 **abandoned** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_40] Prevent hidden users from being exposed via public interfaces

Reason:

<https://gerrit.wikimedia.org/r/934354>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:32 PM2023-06-30 18:32:14 (UTC+0)](#8982531)Comment Actions

Change 934356 **restored** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_38] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934356>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:32 PM2023-06-30 18:32:21 (UTC+0)](#8982532)Comment Actions

Change 934355 **restored** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_39] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934355>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:32 PM2023-06-30 18:32:23 (UTC+0)](#8982533)Comment Actions

Change 934354 **restored** by Mstyles:

[mediawiki/extensions/ProofreadPage@REL1\_40] Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934354>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:55 PM2023-06-30 18:55:06 (UTC+0)](#8982584)Comment Actions

Change 934410 **merged** by jenkins-bot:

[mediawiki/extensions/ProofreadPage@master] SECURITY: Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934410>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 6:59 PM2023-06-30 18:59:52 (UTC+0)](#8982603)Comment Actions

Change 934355 **merged** by jenkins-bot:

[mediawiki/extensions/ProofreadPage@REL1\_39] SECURITY: Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934355>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 7:00 PM2023-06-30 19:00:32 (UTC+0)](#8982604)Comment Actions

Change 934354 **merged** by jenkins-bot:

[mediawiki/extensions/ProofreadPage@REL1\_40] SECURITY: Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934354>

[gerritbot](/p/gerritbot/) added a comment.[Jun 30 2023, 7:31 PM2023-06-30 19:31:28 (UTC+0)](#8982675)Comment Actions

Change 934356 **merged** by Umherirrender:

[mediawiki/extensions/ProofreadPage@REL1\_38] SECURITY: Prevent hidden users from being exposed via public interfaces

<https://gerrit.wikimedia.org/r/934356>

[Mstyles](/p/Mstyles/) closed this task as Resolved.[Jun 30 2023, 7:48 PM2023-06-30 19:48:34 (UTC+0)](#8982697)[Mstyles](/p/Mstyles/) claimed this task.[Mstyles](/p/Mstyles/) moved this task from [Watching](/project/board/1179/) to [Our Part Is Done](/project/board/1179/) on the [Security-Team](/tag/security-team/) board.[Mstyles](/p/Mstyles/) changed the visibility from "[Custom Policy](/transactions/old/PHID-XACT-TASK-drg46iva645kmd2/)" to "Public (No Login Required)".[Mstyles](/p/Mstyles/) changed the edit policy from "[Custom Policy](/transactions/old/PHID-XACT-TASK-3r5mt33l5hooat3/)" to "All Users".Content licensed under Creative Commons Attribution-ShareAlike (CC BY-SA) 4.0 unless otherwise noted; code licensed under GNU General Public License (GPL) 2.0 or later and other open source licenses. By using this site, you agree to the Terms of Use, Privacy Policy, and Code of Conduct. · [Wikimedia Foundation](https://wikimediafoundation.org/) · [Privacy Policy](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ANon-wiki_privacy_policy) · [Code of Conduct](https://www.mediawiki.org/wiki/Special%3AMyLanguage/Code_of_Conduct) · [Terms of Use](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3ATerms_of_Use/Phabricator) · [Disclaimer](https://foundation.wikimedia.org/wiki/Special%3AMyLanguage/Policy%3AGeneral_disclaimer) · [CC-BY-SA](https://creativecommons.org/licenses/by-sa/4.0/) · [GPL](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html) · [Credits](https://www.mediawiki.org/wiki/Phabricator/Credits)
