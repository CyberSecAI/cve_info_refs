=== Content from github.com_f62f9fde_20250115_084916.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1165)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1165)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nanomq%2Fnanomq)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nanomq](/nanomq)
/
**[nanomq](/nanomq/nanomq)**
Public

* [Notifications](/login?return_to=%2Fnanomq%2Fnanomq) You must be signed in to change notification settings
* [Fork
  203](/login?return_to=%2Fnanomq%2Fnanomq)
* [Star
   1.7k](/login?return_to=%2Fnanomq%2Fnanomq)

* [Code](/nanomq/nanomq)
* [Issues
  68](/nanomq/nanomq/issues)
* [Pull requests
  4](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects
  0](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

Additional navigation options

* [Code](/nanomq/nanomq)
* [Issues](/nanomq/nanomq/issues)
* [Pull requests](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnanomq%2Fnanomq%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnanomq%2Fnanomq%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [Security]: wrong protocol name & data racing #1165

Closed

[ZuoYuanP](/ZuoYuanP) opened this issue
Apr 14, 2023
· 13 comments

Closed

# [[Security]: wrong protocol name & data racing](#top) #1165

[ZuoYuanP](/ZuoYuanP) opened this issue
Apr 14, 2023
· 13 comments

Assignees
[![@alvin1221](https://avatars.githubusercontent.com/u/68314044?s=40&v=4)](/alvin1221)

Labels
[bug](/nanomq/nanomq/labels/bug)
[security](/nanomq/nanomq/labels/security)
vulnerability

## Comments

[![@ZuoYuanP](https://avatars.githubusercontent.com/u/92987321?s=80&u=d6f9cb016d6dc49d7864ae038c5f06e26831bebe&v=4)](/ZuoYuanP)

Copy link

### **[ZuoYuanP](/ZuoYuanP)** commented [Apr 14, 2023](#issue-1668648319)

| **Describe the bug** Our team (School of Cyber Science and Technology, Shandong University)have found the a potential issue in the current version of nanomq,it may cause heap-use-after-free when it handles the publish messages  **Expected behavior** We use ASAN to compile the target server, and when we send a large number of malformed data packets to it, it may crash and output the following information ： [image](https://user-images.githubusercontent.com/92987321/232107702-eb628585-c956-48fb-817f-e72c71c3edf4.png) the Call stack information is： [image](https://user-images.githubusercontent.com/92987321/232110281-6445c4af-0e44-4b04-9f50-9682cef62c28.png)  **Actual Behavior** Describe what occurred.  **To Reproduce** we will provide the POC below to the developer for validation: [heap-use-after-free-poc.zip](https://github.com/emqx/nanomq/files/11235468/heap-use-after-free-poc.zip)  \*\* Environment Details \*\*   * NanoMQ version master branch version commit #8c54cd7 * Operating system and version Ubuntu 20.04 * Compiler and language used gcc 9.4.0 clang 10.0.0 * testing scenario   start nanomq with ./nanomq start Send the packet：nc 127.0.0.1 1883 < heap-use-after-free-poc（Repeat multiple times） util cause NanoMQ crashes  **Additional context** To trigger the issue, it is necessary to continuously replay the poc multiple times until nanomq crashes,it may need 2 - 15 times |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
added
the
[security](/nanomq/nanomq/labels/security)
vulnerability
label
[Apr 15, 2023](#event-9012474523)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
changed the title
~~heap-use-after-free in NanoMQ~~
[Security]: heap-use-after-free in NanoMQ
[Apr 15, 2023](#event-9012476126)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
changed the title
~~[Security]: heap-use-after-free in NanoMQ~~
[Security]: Vulnerability awaits to be verified
[Apr 15, 2023](#event-9012724136)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 15, 2023](#issuecomment-1509619856) • edited Loading

| Thanks for your report. The vulnerability seems exist, but I am unable to reproduce this issue from your raw data. Gonna fix this anyway. plz try with most updated nanonng branch. |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
assigned [alvin1221](/alvin1221)
[Apr 15, 2023](#event-9013165164)

[![@ZuoYuanP](https://avatars.githubusercontent.com/u/92987321?s=80&u=d6f9cb016d6dc49d7864ae038c5f06e26831bebe&v=4)](/ZuoYuanP)

Copy link

Author

### **[ZuoYuanP](/ZuoYuanP)** commented [Apr 15, 2023](#issuecomment-1509676888)

| Thank you for your timely reply. We replayed the raw we provided on the previous branch again, and it can still trigger stably. We will try the new updated nanonng branch! |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
mentioned this issue
[Apr 15, 2023](#ref-issue-1669254202)

[[Security]: Vulnerability in sub info list
#1167](/nanomq/nanomq/issues/1167)

Closed

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
unassigned [alvin1221](/alvin1221)
[Apr 17, 2023](#event-9020721545)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 19, 2023](#issuecomment-1514584840)

| This issue is pretty interesting, it helps me identify a rarely seen data racing |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
assigned [alvin1221](/alvin1221)
[Apr 19, 2023](#event-9045607577)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
added
the
[bug](/nanomq/nanomq/labels/bug)
label
[Apr 19, 2023](#event-9045608240)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
changed the title
~~[Security]: Vulnerability awaits to be verified~~
[Security]: wrong protocol name & data racing
[Apr 19, 2023](#event-9045610637)

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 19, 2023](#issuecomment-1514991022) • edited Loading

| This issue is pretty interesting, it helps me identify a rarely seen data racing  I suspect this vulnerability is triggered by multithreading because POC replicates are not stable.  Similarly, I offer a completely different new UAF vulnerability in **nmq\_mqtt.c:404**:   * NanoMQ version：master branch version commit #0485998, NanoNNG Git Commit#bb6f17f (all newest) * running server: ./nanomq start * Send the packet：nc 127.0.0.1 1883 < poc.raw（Repeat multiple times, ） until cause NanoMQ crashes   It is worth mentioning that even with the same POC, the location of the vulnerability may change, so it is doubtful that this could be related to a multithreaded implementation  This poc.zip may trigger the uaf vulnerability discovered above ([@ZuoYuanP](https://github.com/ZuoYuanP)), or it may trigger the new uaf vulnerability situation below, so try replaying the poc as much as you can until the server crashes.  [image](https://user-images.githubusercontent.com/44093631/233134021-1bd65005-eb99-41bc-a018-9c6955674705.png)  [anothe\_uaf\_asan\_log.txt](https://github.com/emqx/nanomq/files/11275118/anothe_uaf_asan_log.txt)  [poc(new uaf).zip](https://github.com/emqx/nanomq/files/11275119/poc.new.uaf.zip) |
| --- |

All reactions

Sorry, something went wrong.

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 19, 2023](#issuecomment-1515019071) • edited Loading

| Similar to the reply above（NanoMQ master commit #0485998, NanoNNG #bb6f17f, the following raw file can trigger one new uaf in **mqtt\_codec.c:3919.**  It is worth noting that this vulnerability can be stably reproduced via GDB.  ``` # run gdb gdb nanomq b /home/songxiangpu/Documents/nanomq_newest/nng/src/supplemental/mqtt/mqtt_codec.c:3919 set args start run # replay poc nc 127.0.0.1 1883 < ./poc.raw # skip the breakpoint until NanoMQ crashes (may continue many times) c c c ... ```  [image](https://user-images.githubusercontent.com/44093631/233241185-c1eec1de-7e46-4ab6-b280-37ebe73b5ba4.png)  [uaf\_asan\_log.txt](https://github.com/emqx/nanomq/files/11275222/uaf_asan_log.txt)  [uaf in mqtt\_codec.c\_3919.zip](https://github.com/emqx/nanomq/files/11275224/uaf.in.mqtt_codec.c_3919.zip) |
| --- |

All reactions

Sorry, something went wrong.

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 20, 2023](#issuecomment-1515611319)

| **Another new use-after-free in sub\_handler.c:323**  I also found a new use-after-free vulnerability in sub\_handler.c:323, which I analyzed and found it could be triggered steadily with the help of gdb.  Environment: NanoMQ master commit #0485998, NanoNNG #bb6f17f  **To Reproduce**  ``` # run gdb gdb nanomq b /home/songxiangpu/Documents/nanomq_newest/nanomq/sub_handler.c:323 set args start run # replay poc nc 127.0.0.1 1883 < ./poc.raw # skip the breakpoint until NanoMQ crashes c c c ... ```  [image](https://user-images.githubusercontent.com/44093631/233239087-593f6bc4-b2c3-4da0-ab5b-56ac5d4cf565.png)  [UAF-sub\_handler.c-asan.txt](https://github.com/emqx/nanomq/files/11279119/UAF-sub_handler.c-asan.txt)  [UAF-sub\_handler.c-poc.zip](https://github.com/emqx/nanomq/files/11279116/UAF-sub_handler.c-poc.zip) |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 20, 2023](#issuecomment-1515667127)

| **Describe the bug** Our team (School of Cyber Science and Technology, Shandong University)have found the a potential issue in the current version of nanomq,it may cause heap-use-after-free when it handles the publish messages  **Expected behavior** We use ASAN to compile the target server, and when we send a large number of malformed data packets to it, it may crash and output the following information ： [image](https://user-images.githubusercontent.com/92987321/232107702-eb628585-c956-48fb-817f-e72c71c3edf4.png) the Call stack information is： [image](https://user-images.githubusercontent.com/92987321/232110281-6445c4af-0e44-4b04-9f50-9682cef62c28.png)  **Actual Behavior** Describe what occurred.  **To Reproduce** we will provide the POC below to the developer for validation: [heap-use-after-free-poc.zip](https://github.com/emqx/nanomq/files/11235468/heap-use-after-free-poc.zip)  \*\* Environment Details \*\*   * NanoMQ version master branch version commit #8c54cd7 * Operating system and version Ubuntu 20.04 * Compiler and language used gcc 9.4.0 clang 10.0.0 * testing scenario   start nanomq with ./nanomq start Send the packet：nc 127.0.0.1 1883 < heap-use-after-free-poc（Repeat multiple times） util cause NanoMQ crashes  **Additional context** To trigger the issue, it is necessary to continuously replay the poc multiple times until nanomq crashes,it may need 2 - 15 times  after [#1187](https://github.com/nanomq/nanomq/pull/1187) , there is only a bizarre memleak problem remaining. The poc data contains multiple issues, including an illegal protocol name packet. But memleak is gone once I refuse this illegal packet, it is worth tracking so I keep a log here. ==1909241==ERROR: LeakSanitizer: detected memory leaks  `` Direct leak of 168 byte(s) in 1 object(s) allocated from: #0 0x7f75e84b4a37 in \_\_interceptor\_calloc ../../../../src/libsanitizer/asan/asan\_malloc\_linux.cpp:154 [#1](https://github.com/nanomq/nanomq/pull/1) 0x56372d50aa58 in nni\_zalloc /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/platform/posix/posix\_alloc.c:26 [#2](https://github.com/nanomq/nanomq/pull/2) 0x56372d4f4822 in nni\_msg\_alloc /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/message.c:387 [#3](https://github.com/nanomq/nanomq/pull/3) 0x56372d87071d in tcptran\_pipe\_recv\_cb /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/sp/transport/mqtt/broker\_tcp.c:686 [#4](https://github.com/nanomq/nanomq/pull/4) 0x56372d504e52 in nni\_taskq\_thread /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/taskq.c:50 [#5](https://github.com/nanomq/nanomq/pull/5) 0x56372d50620a in nni\_thr\_wrap /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/thread.c:94 [#6](https://github.com/nanomq/nanomq/pull/6) 0x56372d50f3bf in nni\_plat\_thr\_main /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/platform/posix/posix\_thread.c:266 [#7](https://github.com/nanomq/nanomq/pull/7) 0x7f75e7c94b42 in start\_thread nptl/pthread\_create.c:442  Indirect leak of 125 byte(s) in 1 object(s) allocated from: #0 0x7f75e84b4a37 in \_\_interceptor\_calloc ../../../../src/libsanitizer/asan/asan\_malloc\_linux.cpp:154 [#1](https://github.com/nanomq/nanomq/pull/1) 0x56372d50aa58 in nni\_zalloc /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/platform/posix/posix\_alloc.c:26 [#2](https://github.com/nanomq/nanomq/pull/2) 0x56372d4f35fd in nni\_chunk\_grow /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/message.c:158 [#3](https://github.com/nanomq/nanomq/pull/3) 0x56372d4f4872 in nni\_msg\_alloc /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/message.c:397 [#4](https://github.com/nanomq/nanomq/pull/4) 0x56372d87071d in tcptran\_pipe\_recv\_cb /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/sp/transport/mqtt/broker\_tcp.c:686 [#5](https://github.com/nanomq/nanomq/pull/5) 0x56372d504e52 in nni\_taskq\_thread /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/taskq.c:50 [#6](https://github.com/nanomq/nanomq/pull/6) 0x56372d50620a in nni\_thr\_wrap /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/core/thread.c:94 [#7](https://github.com/nanomq/nanomq/pull/7) 0x56372d50f3bf in nni\_plat\_thr\_main /home/jaylin/Projects/EdgeComputing/nanomq/nng/src/platform/posix/posix\_thread.c:266 [#8](https://github.com/nanomq/nanomq/pull/8) 0x7f75e7c94b42 in start\_thread nptl/pthread\_create.c:442  SUMMARY: AddressSanitizer: 293 byte(s) leaked in 2 allocation(s). `` |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 20, 2023](#issuecomment-1515683020)

| The following issues are basically same problem. will be fixed with one PR |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 20, 2023](#issuecomment-1515683402)

| thanks for finding issues btw |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Apr 20, 2023

[Verify protocol name in conn\_handler
nanomq/NanoNNG#522](/nanomq/NanoNNG/pull/522)
 Closed

[\* FIX [mqtt\_parser] fix warnings & verify protocol name in conn\_handler
nanomq/NanoNNG#525](/nanomq/NanoNNG/pull/525)
 Merged

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 20, 2023](#issuecomment-1516032597) • edited Loading

| The following issues are basically same problem. will be fixed with one PR  I think the above issue may not be caused by the same problem, as the use-after-free vulnerability can still be triggered stably triggered in the newest branch.  **Reproduction reference** [#1165 (comment)](https://github.com/nanomq/nanomq/issues/1165#issuecomment-1515611319)  **Environment**   * NanoMQ：Git Commit #69224a88554e7187f6d303a23ed825a7875b8a7d * NNG Git Commit#df24367b201a7429a4c3daab4477c424113bda8b   [image](https://user-images.githubusercontent.com/44093631/233326032-2cf7abd4-6c27-47e6-a604-c27fd9d8e8fc.png)  [sub\_handler\_poc.zip](https://github.com/emqx/nanomq/files/11284748/sub_handler_poc.zip) |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 20, 2023](#issuecomment-1516060064)

| They all caused by parallel processing and replacing the retain msg, You can prove me wrong by submitting a PR, that would be wonderfu!  BTW, told you to move the head, or you can wait for us to publish a new version in next month |
| --- |

All reactions

Sorry, something went wrong.

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 20, 2023](#issuecomment-1516110054) • edited Loading

| They all caused by parallel processing and replacing the retain msg, You can prove me wrong by submitting a PR, that would be wonderfu!  BTW, told you to move the head, or you can wait for us to publish a new version in next month  Nevermind , and please don't misunderstand me.  I agree that it was caused by data competition, but perhaps the specific issue triggered by the vulnerability was not consistent, as regression testing was carried out and found that there was an omission, so I mention it again. |
| --- |

 👍
1
 JaylinYu reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 22, 2023](#issuecomment-1518603421)

| All bugs discovered by this issue/ticket have been fixed. I am gonna closed this |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
closed this as [completed](/nanomq/nanomq/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 25, 2023](#event-9090501520)

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=40&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)
[songxpu](/songxpu)
mentioned this issue
[May 1, 2023](#ref-issue-1690888683)

[[Security]: duplicate with #1180
#1216](/nanomq/nanomq/issues/1216)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1165)

Assignees

[![@alvin1221](https://avatars.githubusercontent.com/u/68314044?s=40&v=4)](/alvin1221) [alvin1221](/alvin1221)

Labels

[bug](/nanomq/nanomq/labels/bug)
[security](/nanomq/nanomq/labels/security)
vulnerability

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=52&v=4)](/songxpu) [![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=52&v=4)](/JaylinYu) [![@alvin1221](https://avatars.githubusercontent.com/u/68314044?s=52&v=4)](/alvin1221) [![@ZuoYuanP](https://avatars.githubusercontent.com/u/92987321?s=52&v=4)](/ZuoYuanP)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d6f94c4c_20250115_084914.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=nanomq%2Fnanomq)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nanomq](/nanomq)
/
**[nanomq](/nanomq/nanomq)**
Public

* [Notifications](/login?return_to=%2Fnanomq%2Fnanomq) You must be signed in to change notification settings
* [Fork
  203](/login?return_to=%2Fnanomq%2Fnanomq)
* [Star
   1.7k](/login?return_to=%2Fnanomq%2Fnanomq)

An ultra-lightweight and blazing-fast Messaging broker/bus for IoT edge & SDV

[nanomq.io](https://nanomq.io "https://nanomq.io")

### License

[MIT license](/nanomq/nanomq/blob/master/LICENSE.txt)

[1.7k
stars](/nanomq/nanomq/stargazers) [203
forks](/nanomq/nanomq/forks) [Branches](/nanomq/nanomq/branches) [Tags](/nanomq/nanomq/tags) [Activity](/nanomq/nanomq/activity)
 [Star](/login?return_to=%2Fnanomq%2Fnanomq)

 [Notifications](/login?return_to=%2Fnanomq%2Fnanomq) You must be signed in to change notification settings

* [Code](/nanomq/nanomq)
* [Issues
  68](/nanomq/nanomq/issues)
* [Pull requests
  4](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects
  0](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

Additional navigation options

* [Code](/nanomq/nanomq)
* [Issues](/nanomq/nanomq/issues)
* [Pull requests](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

# nanomq/nanomq

    master[Branches](/nanomq/nanomq/branches)[Tags](/nanomq/nanomq/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[3,598 Commits](/nanomq/nanomq/commits/master/) | | |
| [.github](/nanomq/nanomq/tree/master/.github ".github") | | [.github](/nanomq/nanomq/tree/master/.github ".github") |  |  |
| [cmake](/nanomq/nanomq/tree/master/cmake "cmake") | | [cmake](/nanomq/nanomq/tree/master/cmake "cmake") |  |  |
| [deploy/docker](/nanomq/nanomq/tree/master/deploy/docker "This path skips through empty directories") | | [deploy/docker](/nanomq/nanomq/tree/master/deploy/docker "This path skips through empty directories") |  |  |
| [docs](/nanomq/nanomq/tree/master/docs "docs") | | [docs](/nanomq/nanomq/tree/master/docs "docs") |  |  |
| [etc](/nanomq/nanomq/tree/master/etc "etc") | | [etc](/nanomq/nanomq/tree/master/etc "etc") |  |  |
| [extern](/nanomq/nanomq/tree/master/extern "extern") | | [extern](/nanomq/nanomq/tree/master/extern "extern") |  |  |
| [nanomq](/nanomq/nanomq/tree/master/nanomq "nanomq") | | [nanomq](/nanomq/nanomq/tree/master/nanomq "nanomq") |  |  |
| [nanomq\_cli](/nanomq/nanomq/tree/master/nanomq_cli "nanomq_cli") | | [nanomq\_cli](/nanomq/nanomq/tree/master/nanomq_cli "nanomq_cli") |  |  |
| [nng @ 64926f4](/nanomq/NanoNNG/tree/64926f4ec360ce2d4a0aedaae94f73db9620f064 "nng") | | [nng @ 64926f4](/nanomq/NanoNNG/tree/64926f4ec360ce2d4a0aedaae94f73db9620f064 "nng") |  |  |
| [.clang-format](/nanomq/nanomq/blob/master/.clang-format ".clang-format") | | [.clang-format](/nanomq/nanomq/blob/master/.clang-format ".clang-format") |  |  |
| [.codecov.yml](/nanomq/nanomq/blob/master/.codecov.yml ".codecov.yml") | | [.codecov.yml](/nanomq/nanomq/blob/master/.codecov.yml ".codecov.yml") |  |  |
| [.gitignore](/nanomq/nanomq/blob/master/.gitignore ".gitignore") | | [.gitignore](/nanomq/nanomq/blob/master/.gitignore ".gitignore") |  |  |
| [.gitmodules](/nanomq/nanomq/blob/master/.gitmodules ".gitmodules") | | [.gitmodules](/nanomq/nanomq/blob/master/.gitmodules ".gitmodules") |  |  |
| [.grcov.yml](/nanomq/nanomq/blob/master/.grcov.yml ".grcov.yml") | | [.grcov.yml](/nanomq/nanomq/blob/master/.grcov.yml ".grcov.yml") |  |  |
| [CHANGELOG.md](/nanomq/nanomq/blob/master/CHANGELOG.md "CHANGELOG.md") | | [CHANGELOG.md](/nanomq/nanomq/blob/master/CHANGELOG.md "CHANGELOG.md") |  |  |
| [CMakeLists.txt](/nanomq/nanomq/blob/master/CMakeLists.txt "CMakeLists.txt") | | [CMakeLists.txt](/nanomq/nanomq/blob/master/CMakeLists.txt "CMakeLists.txt") |  |  |
| [CONTRIBUTING.md](/nanomq/nanomq/blob/master/CONTRIBUTING.md "CONTRIBUTING.md") | | [CONTRIBUTING.md](/nanomq/nanomq/blob/master/CONTRIBUTING.md "CONTRIBUTING.md") |  |  |
| [CodeGuidance.md](/nanomq/nanomq/blob/master/CodeGuidance.md "CodeGuidance.md") | | [CodeGuidance.md](/nanomq/nanomq/blob/master/CodeGuidance.md "CodeGuidance.md") |  |  |
| [Docker-introduction](/nanomq/nanomq/blob/master/Docker-introduction "Docker-introduction") | | [Docker-introduction](/nanomq/nanomq/blob/master/Docker-introduction "Docker-introduction") |  |  |
| [LICENSE.txt](/nanomq/nanomq/blob/master/LICENSE.txt "LICENSE.txt") | | [LICENSE.txt](/nanomq/nanomq/blob/master/LICENSE.txt "LICENSE.txt") |  |  |
| [README.md](/nanomq/nanomq/blob/master/README.md "README.md") | | [README.md](/nanomq/nanomq/blob/master/README.md "README.md") |  |  |
| [libatomic-1.dll](/nanomq/nanomq/blob/master/libatomic-1.dll "libatomic-1.dll") | | [libatomic-1.dll](/nanomq/nanomq/blob/master/libatomic-1.dll "libatomic-1.dll") |  |  |
| [libwinpthread-1.dll](/nanomq/nanomq/blob/master/libwinpthread-1.dll "libwinpthread-1.dll") | | [libwinpthread-1.dll](/nanomq/nanomq/blob/master/libwinpthread-1.dll "libwinpthread-1.dll") |  |  |
| [package.mk](/nanomq/nanomq/blob/master/package.mk "package.mk") | | [package.mk](/nanomq/nanomq/blob/master/package.mk "package.mk") |  |  |
| [wix-patch.xml](/nanomq/nanomq/blob/master/wix-patch.xml "wix-patch.xml") | | [wix-patch.xml](/nanomq/nanomq/blob/master/wix-patch.xml "wix-patch.xml") |  |  |
| View all files | | |

## Repository files navigation

* README
* MIT license
# LF Edge NanoMQ

[![GitHub Release](https://camo.githubusercontent.com/72e1c61f615984e35055c836fdcfe7ae2bcac25da88f489ff66edc4519c42bfa/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f72656c656173652f656d71782f6e616e6f6d713f636f6c6f723d627269676874677265656e266c6162656c3d52656c65617365)](https://github.com/emqx/nanomq/releases)
[![Build Status](https://camo.githubusercontent.com/64449f396f7dede14f116cb6d9cce9ac125ccd2cc18e1df41206a7e61b290624/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f616374696f6e732f776f726b666c6f772f7374617475732f656d71782f6e616e6f6d712f6275696c645f7061636b616765732e79616d6c3f6272616e63683d6d6173746572266c6162656c3d4275696c64)](https://github.com/emqx/nanomq/actions)
[![Docker Pulls](https://camo.githubusercontent.com/9843201c6e61cefa1fce406de38d071b7d5ee9f30c45a4194ca6e3baf6b7e5d5/68747470733a2f2f696d672e736869656c64732e696f2f646f636b65722f70756c6c732f656d71782f6e616e6f6d713f6c6162656c3d446f636b657225323050756c6c73)](https://hub.docker.com/r/emqx/nanomq)
[![Discord](https://camo.githubusercontent.com/aafc2b0f1c4039cae5f670592db72983bb35bed2fef2eea75cbc29932ad9b2be/68747470733a2f2f696d672e736869656c64732e696f2f646973636f72642f3933313038363334313833383632323735313f6c6162656c3d446973636f7264266c6f676f3d646973636f7264)](https://discord.gg/xYGf3fQnES)
[![Twitter](https://camo.githubusercontent.com/044de852fa3a48f1b3c151c1a67f131de65d54fee0c27b1cc20a60f6dbf64654/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f466f6c6c6f772d454d512d3144413146323f6c6f676f3d74776974746572)](https://twitter.com/EMQTech)
[![YouTube](https://camo.githubusercontent.com/7f2c7325c04f3bfd3c12e9faea7a139e4868df08c6437c61104937e511fbd276/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f5375627363726962652d454d512d4646303030303f6c6f676f3d796f7574756265)](https://www.youtube.com/channel/UC5FjR77ErAxvZENEWzQaO5Q)
[![Community](https://camo.githubusercontent.com/a7763b3242cabbbb15b6d490b56196976df4a2236dca2613721a4a58e338fb44/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f436f6d6d756e6974792d4e616e6f4d512d79656c6c6f773f6c6f676f3d676974687562)](https://github.com/emqx/nanomq/discussions)
[![codecov](https://camo.githubusercontent.com/08d08bf1ea65778c8a7822941fb3ee5259d0cd5839f70f91ebeebf083fd33918/68747470733a2f2f636f6465636f762e696f2f67682f656d71782f6e616e6f6d712f6272616e63682f6d61737465722f67726170682f62616467652e7376673f746f6b656e3d32344539513343304d30)](https://codecov.io/gh/emqx/nanomq)
[![License](https://camo.githubusercontent.com/f6a4dde542e2f4fdffa7bf89384ecd52b8f8c352f35a6560c8e86852d05b6693/68747470733a2f2f696d672e736869656c64732e696f2f6769746875622f6c6963656e73652f656d71782f6e616e6f6d712e7376673f6c6f676f436f6c6f723d73696c766572266c6f676f3d6f70656e2d736f757263652d696e6974696174697665266c6162656c3d26636f6c6f723d626c7565)](https://github.com/emqx/nanomq/blob/master/LICENSE.txt)

NanoMQ MQTT Broker (NanoMQ) is an all-around Edge Messaging Platform that includes a blazing-fast MQTT Broker for the IoT/IIoT and a lightweight Messaging Bus for SDV.

NanoMQ's embedded Actor architecture extends NNG's internal asynchronous I/O, plus an enhanced message passing and scheduling system to maximize the overall capacity. Fine-tuned towards the embedded environment and mission-critical scenarios.

NanoMQ fully supports MQTT V3.1.1/3.1 and MQTT V5.0.

For more information, please visit [NanoMQ homepage](https://nanomq.io/).

## Features

* Cost-effective on an embedded platform;
* Fully based on native POSIX. High Compatibility;
* Pure C implementation. High portability;
* Fully asynchronous I/O and multi-threading;
* Good support for SMP;
* Low latency & High handling capacity;

[![image](https://user-images.githubusercontent.com/64823539/182988350-f6e2520f-6e6f-46db-b469-685bec977270.png)](https://user-images.githubusercontent.com/64823539/182988350-f6e2520f-6e6f-46db-b469-685bec977270.png)

## Get Started

### Run NanoMQ using Docker

```
docker run -d --name nanomq -p 1883:1883 -p 8083:8083 -p 8883:8883 emqx/nanomq:latest
```

### More installation options

If you prefer to install and manage NanoMQ yourself, you can download the latest version from [nanomq.io/downloads](https://nanomq.io/downloads).

#### Run NanoMQ:

```
nanomq start
## or run nanomq with a specified configuration file
nanomq start --conf <config_file>
```

## Build From Source

NanoMQ is dedicated to delivering a simple but powerful Messaging Hub on various edge platforms.

With this being said, NanoMQ can run on different architectures such like x86\_64 and ARM with minor migration efforts.

Building NanoMQ requires a C99-compatible compiler and [CMake](http://www.cmake.org/) (version 3.13 or newer).

* It is recommended to compile with `Ninja`:

  ```
  git clone https://github.com/emqx/nanomq.git
  cd nanomq
  git submodule update --init --recursive
  mkdir build && cd build
  cmake -G Ninja ..
  ninja
  ```
* Or compile with `make`:

  ```
  git clone https://github.com/emqx/nanomq.git
  cd nanomq
  git submodule update --init --recursive
  mkdir build && cd build
  cmake ..
  make
  ```

### Build option

There are some configuration options specified using CMake defines in addition to the standard options like `CMAKE_BUILD_TYPE`:

* `-DNNG_ENABLE_QUIC=ON`: to build NanoMQ with QUIC bridging feature
* `-DNNG_ENABLE_TLS=ON`: to build with TLS support. (Need to install [mbedTLS](https://tls.mbed.org) in advance)
* `-DBUILD_CLIENT=OFF`: to disable nanomq tools client suite (including pub / sub / conn )
* `-DBUILD_ZMQ_GATEWAY=ON`: to build `nanomq_cli` with zeromq gateway tool
* `-DBUILD_NFTP=ON`: to build `nanomq_cli` with nftp client
* `-DBUILD_DDS_PROXY=ON`: to build `nanomq_cli` with dds client ( proxy / sub / pub )
* `-DBUILD_BENCH=ON`: to build `nanomq_cli` mqtt bench
* `-DENABLE_JWT=ON`: to build JWT dependency for http server
* `-DNNG_ENABLE_SQLITE=ON`: to build nanomq with sqlite support
* `-DBUILD_STATIC_LIB=ON`: to build nanomq as a static library
* `-DBUILD_SHARED_LIBS=ON`: to build nanomq as a shared library
* `-DDEBUG=ON`: to enable debug flag
* `-DASAN=ON`: to enable sanitizer
* `-DDEBUG_TRACE=ON`: to enable ptrace (ptrace is a mechanism that allows one process to “trace” the execution of another process. The tracer is able to
  pause execution, and inspect and modify memory and registers in the tracee process)

## Resources

* NanoMQ

  + [Blog](https://www.emqx.com/en/blog/category/nanomq)
  + [Official website](https://nanomq.io/)
* MQTT Specifications

  + [MQTT Version 3.1.1](https://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html)
  + [MQTT Version 5.0](https://docs.oasis-open.org/mqtt/mqtt/v5.0/cs02/mqtt-v5.0-cs02.html)
  + [MQTT SN](http://mqtt.org/new/wp-content/uploads/2009/06/MQTT-SN_spec_v1.2.pdf)
  + *Unsupported features of MQTT 5.0*
    - Auth <https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901217>
    - Server Redirection <https://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901255>
* MQTT Client Examples

  + [MQTT-Client-Examples](https://github.com/emqx/MQTT-Client-Examples)
* MQTT Client SDK

  + [NanoSDK](https://github.com/nanomq/NanoSDK)
* Internet of Vehicles

  + [Internet of Vehicles](https://www.emqx.com/en/blog/category/internet-of-vehicles). Build a reliable, efficient, and industry-specific IoV platform based on EMQ's practical experience, from theoretical knowledge such as protocol selection to practical operations like platform architecture design.
* DDS

  + [CycloneDDS](https://cyclonedds.io/)
  + [DDS proxy on NanoMQ\_CLI](/nanomq/nanomq/blob/master/nanomq_cli/dds2mqtt/README.md)

## Get Involved

### Our Website

Visit our [official website](https://nanomq.io/) to have a good grasp on NanoMQ MQTT broker and see how it can be applied in current industries.

### Test Report

This [test report](https://nanomq.io/docs/latest/test-report.html#about-nanomq) shows how extraordinary and competitive the NanoMQ is in Edge Computing.

*Currently the benchmark is for 0.2.5, the updated one with ver 0.3.5 is coming soon*

### Questions

The [Github Discussions](https://github.com/emqx/nanomq/discussions) provides a place for you to ask questions and share your ideas with users around the world.

### Slack

You could join us on [Slack](https://slack-invite.emqx.io/). We now share a workspace with the entire EMQ X team. After joining, find your channel!

* `#nanomq`: is a channel for general usage, where for asking questions or sharing using experience;
* `#nanomq-dev`: is a channel for MQTT lovers and developers, your great thoughts are what we love to hear;
* `#nanomq-nng`: is a channel for guys who are interested in NNG, one of our fabulous dependencies.

## Community

Some quotes from NNG's maintainer --- Garrett:
I’m very excited about the synergy between the NanoMQ and NNG projects, and grateful for sponsorship that NNG has received from the NanoMQ team. The NanoMQ team has been able to push NNG's envelope, and the collaboration has already yielded substantial improvements for both projects. Further, the cooperation between these two project will make MQTT and SP (nanomsg) protocols easy to use within a single project as well as other capabilities (such as websockets, HTTPS clients and servers), greatly expanding the toolset within easy reach of the IoT developer. Further this comes without the usual licensing or portability/embeddability challenges that face other projects. Additional planned collaborative work will further expand on these capabilities to the benefit of our shared communities.

### Open Source

NanoMQ is fully open-sourced!

## License

[MIT License](/nanomq/nanomq/blob/master/LICENSE.txt)

## Authors

The EMQ Edge Computing team.

## About

An ultra-lightweight and blazing-fast Messaging broker/bus for IoT edge & SDV

[nanomq.io](https://nanomq.io "https://nanomq.io")

### Topics

[mqtt](/topics/mqtt "Topic: mqtt")
[iot](/topics/iot "Topic: iot")
[aio](/topics/aio "Topic: aio")
[asynchronous](/topics/asynchronous "Topic: asynchronous")
[messaging](/topics/messaging "Topic: messaging")
[actor-model](/topics/actor-model "Topic: actor-model")
[pubsub](/topics/pubsub "Topic: pubsub")
[mqtt-broker](/topics/mqtt-broker "Topic: mqtt-broker")
[smp](/topics/smp "Topic: smp")
[manufacturing](/topics/manufacturing "Topic: manufacturing")
[iiot](/topics/iiot "Topic: iiot")
[mosquitto](/topics/mosquitto "Topic: mosquitto")
[mqtt-server](/topics/mqtt-server "Topic: mqtt-server")
[mqtt-protocol](/topics/mqtt-protocol "Topic: mqtt-protocol")
[connected-vehicles](/topics/connected-vehicles "Topic: connected-vehicles")
[nng](/topics/nng "Topic: nng")
[iot-edge](/topics/iot-edge "Topic: iot-edge")
[parrallel-computing](/topics/parrallel-computing "Topic: parrallel-computing")
[mqtt5](/topics/mqtt5 "Topic: mqtt5")
[software-defined-vehicle](/topics/software-defined-vehicle "Topic: software-defined-vehicle")

### Resources

[Readme](#readme-ov-file)
### License

[MIT license](#MIT-1-ov-file)

[Activity](/nanomq/nanomq/activity)
[Custom properties](/nanomq/nanomq/custom-properties)
### Stars

[**1.7k**
stars](/nanomq/nanomq/stargazers)
### Watchers

[**48**
watching](/nanomq/nanomq/watchers)
### Forks

[**203**
forks](/nanomq/nanomq/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq&report=nanomq+%28user%29)

## [Releases 112](/nanomq/nanomq/releases)

[NanoMQ 0.23.2
Latest

Dec 25, 2024](/nanomq/nanomq/releases/tag/0.23.2)
[+ 111 releases](/nanomq/nanomq/releases)

## [Packages 0](/orgs/nanomq/packages?repo_name=nanomq)

No packages published

## [Contributors 33](/nanomq/nanomq/graphs/contributors)

* [![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=64&v=4)](https://github.com/JaylinYu)
* [![@xinyi-xs](https://avatars.githubusercontent.com/u/66231514?s=64&v=4)](https://github.com/xinyi-xs)
* [![@alvin1221](https://avatars.githubusercontent.com/u/68314044?s=64&v=4)](https://github.com/alvin1221)
* [![@wanghaEMQ](https://avatars.githubusercontent.com/u/68215275?s=64&v=4)](https://github.com/wanghaEMQ)
* [![@StargazerWayne](https://avatars.githubusercontent.com/u/53253973?s=64&v=4)](https://github.com/StargazerWayne)
* [![@LenaLenaPan](https://avatars.githubusercontent.com/u/120552185?s=64&v=4)](https://github.com/LenaLenaPan)
* [![@RanMaoyi](https://avatars.githubusercontent.com/u/16575896?s=64&v=4)](https://github.com/RanMaoyi)
* [![@AlvinWong2018](https://avatars.githubusercontent.com/u/34980408?s=64&v=4)](https://github.com/AlvinWong2018)
* [![@Rory-Z](https://avatars.githubusercontent.com/u/16801068?s=64&v=4)](https://github.com/Rory-Z)
* [![@Swilder-M](https://avatars.githubusercontent.com/u/43406141?s=64&v=4)](https://github.com/Swilder-M)
* [![@Hongwei-W](https://avatars.githubusercontent.com/u/56687458?s=64&v=4)](https://github.com/Hongwei-W)
* [![@hujung-de](https://avatars.githubusercontent.com/u/98020857?s=64&v=4)](https://github.com/hujung-de)
* [![@Smartmind12](https://avatars.githubusercontent.com/u/91927689?s=64&v=4)](https://github.com/Smartmind12)
* [![@lizhanhui](https://avatars.githubusercontent.com/u/641819?s=64&v=4)](https://github.com/lizhanhui)

[+ 19 contributors](/nanomq/nanomq/graphs/contributors)

## Languages

* [C
  95.8%](/nanomq/nanomq/search?l=c)
* [CMake
  2.5%](/nanomq/nanomq/search?l=cmake)
* [C++
  1.6%](/nanomq/nanomq/search?l=c%2B%2B)
* Other
  0.1%

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_78ce096a_20250115_084914.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1164)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1164)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=nanomq%2Fnanomq)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nanomq](/nanomq)
/
**[nanomq](/nanomq/nanomq)**
Public

* [Notifications](/login?return_to=%2Fnanomq%2Fnanomq) You must be signed in to change notification settings
* [Fork
  203](/login?return_to=%2Fnanomq%2Fnanomq)
* [Star
   1.7k](/login?return_to=%2Fnanomq%2Fnanomq)

* [Code](/nanomq/nanomq)
* [Issues
  68](/nanomq/nanomq/issues)
* [Pull requests
  4](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects
  0](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

Additional navigation options

* [Code](/nanomq/nanomq)
* [Issues](/nanomq/nanomq/issues)
* [Pull requests](/nanomq/nanomq/pulls)
* [Discussions](/nanomq/nanomq/discussions)
* [Actions](/nanomq/nanomq/actions)
* [Projects](/nanomq/nanomq/projects)
* [Security](/nanomq/nanomq/security)
* [Insights](/nanomq/nanomq/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fnanomq%2Fnanomq%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fnanomq%2Fnanomq%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# potential memleak #1164

Closed

[songxpu](/songxpu) opened this issue
Apr 14, 2023
· 2 comments

Closed

# [potential memleak](#top) #1164

[songxpu](/songxpu) opened this issue
Apr 14, 2023
· 2 comments

Labels
[security](/nanomq/nanomq/labels/security)
vulnerability

## Comments

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

### **[songxpu](/songxpu)** commented [Apr 14, 2023](#issue-1668392801)

| **Describe the bug** 您好，我们在NanoMQ当前版本中还发现了一项内存泄露，以下为详细漏洞信息以供开发人员参考。  School of Cyber Science and Technology, Shandong University  **Expected behavior**  如果在编译时启用 ASAN，NanoMQ 会崩溃并显示 ASAN 信息。 [image](https://user-images.githubusercontent.com/44093631/232076656-b9f891f5-6a0f-4018-ab19-a35cec93e74d.png)  **To Reproduce**   1. start nanomq with ./nanomq start 2. Send the packet：nc 127.0.0.1 1883 < ./leak.raw 3. NanoMQ crashes    [leak1.zip](https://github.com/emqx/nanomq/files/11234045/leak1.zip)   \*\* Environment Details \*\*   * NanoMQ version：master branch version commit #8c54cd7 * Operating system and version：Ubuntu 20.04 * Compiler and language used：gcc 9.4.0 clang 10.0.0 * testing scenario |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
changed the title
~~NanoMQ中的一项内存泄露~~
potential memleak
[Apr 14, 2023](#event-9008696218)

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
added
the
[security](/nanomq/nanomq/labels/security)
vulnerability
label
[Apr 14, 2023](#event-9008699002)

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=80&u=a6e627968107dafb9421adea7d6b814473805cfa&v=4)](/songxpu)

Copy link

Author

### **[songxpu](/songxpu)** commented [Apr 15, 2023](#issuecomment-1509468562)

| 您好， 由于不同于之前提交的安全问题，该内存泄露可能直接重放并不会直接造成程序crash 因此我们在这里对漏洞复现过程细节进行补充，以便于开发人员复现和排查问题。   * 运行nanomq start * 重放一次或多次POC后（需手动终止NC的连接状态）：nc 127.0.0.1 1883 < ./leak.raw , then ctrl+c. * 接着手动终止nanomq运行，可以成功复现并获取内存泄露的现场函数栈信息。   如下图所示： [image](https://user-images.githubusercontent.com/44093631/232178113-48df2300-8084-43af-a31c-19a1d145ed5c.png) |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=80&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)

Copy link

Member

### **[JaylinYu](/JaylinYu)** commented [Apr 15, 2023](#issuecomment-1509619331)

| Unable to reporduce your issue |
| --- |

All reactions

Sorry, something went wrong.

[![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=40&u=1545e684c0783e1df87674ceed94bc906df90ea3&v=4)](/JaylinYu)
[JaylinYu](/JaylinYu)
closed this as [completed](/nanomq/nanomq/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Apr 15, 2023](#event-9013155128)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fnanomq%2Fnanomq%2Fissues%2F1164)

Assignees

No one assigned

Labels

[security](/nanomq/nanomq/labels/security)
vulnerability

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@songxpu](https://avatars.githubusercontent.com/u/44093631?s=52&v=4)](/songxpu) [![@JaylinYu](https://avatars.githubusercontent.com/u/64823539?s=52&v=4)](/JaylinYu)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


