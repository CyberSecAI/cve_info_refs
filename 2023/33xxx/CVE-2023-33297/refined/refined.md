```text
{
  "cve": "CVE-2023-33297",
  "description": "Bitcoin Core before 24.1, when debug mode is not used, allows attackers to cause a denial of service (CPU consumption) because draining the inventory-to-send queue is inefficient, as exploited in the wild in May 2023.",
  "affected_versions": [
    "< 24.1"
  ],
  "patched_versions": [
    "24.1"
   ],
  "vulnerability_details": {
    "root_cause": "The vulnerability stems from an inefficient method of draining the inventory-to-send queue within Bitcoin Core, which leads to high CPU consumption, especially when debug mode is disabled. Specifically, the inefficient handling of the `getheaders` p2p message which returns up to 2000 block headers at once resulting in > 0.15MB responses that aren't rate limited, which allows a malicious peer to request a large amount of data, combined with an issue with `BOOST_MULTI_INDEX_ENABLE_SAFE_MODE` which causes iterator destruction to take O(n) time instead of O(1).",
    "weaknesses": [
        "Inefficient draining of the inventory-to-send queue.",
         "Lack of rate-limiting for certain protocol messages.",
         "Unbounded resource consumption in mempool processing",
         "Unoptimized iterator handling in Boost Multi-index library when safe mode is enabled",
         "Lack of per-connection rate-limiting"
        ],
    "impact": "Attackers can cause a denial of service (DoS) by exploiting the inefficient way the inventory-to-send queue is drained. This results in high CPU usage on targeted nodes making them unresponsive and potentially financially impacting node operators due to data overage fees.",
    "attack_vector": "The attack is carried out over the peer-to-peer network. An attacker connects to a vulnerable node as a peer, performing a complete handshake, and then begins to request protocol message content in a loop, specifically the `getheaders` message.",
    "attacker_capabilities": "Attacker needs the ability to connect to the peer-to-peer network and craft specific messages using the Bitcoin protocol.",
      "attacker_positioning": "Remote."
  },
   "additional_notes": [
    "The vulnerability was exploited in the wild in May 2023.",
    "Bitcoin Core version 24.1 includes fixes for the issue, but many node operators may not have upgraded.",
    "The `-maxuploadtarget` option can be used to mitigate but is not enabled by default",
    "The vulnerability affects not only Bitcoin, but also other forks like Dogecoin and Litecoin.",
        "The fix involves changes to how transactions are handled in the mempool and how the `inv` (inventory) messages are sent. Transactions that have been removed from mempool are now sorted first so that they can be dropped faster, and the rate at which inventory messages are sent are dynamically adjusted based on queue sizes."
  ]
}
```